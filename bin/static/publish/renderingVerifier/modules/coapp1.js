(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["CoSpaceApp"]=e():t["CoSpaceApp"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function s(a){if(e[a])return e[a].exports;var i=e[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=t,s.c=e,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(a,i,function(e){return t[e]}.bind(null,i));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s="fae3")}({"0795":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(){this.crossOrigin="anonymous"}setCrossOrigin(t){this.crossOrigin=t}async load(t,e,s=null,a=null,i="blob",r=""){if(null==e)throw Error("onload == null !!!");const l=new FileReader;l.onload=s=>{null!=e&&e(l.result,t)};const o=new XMLHttpRequest;o.open("GET",t,!0),""!=r&&o.setRequestHeader("Range",r),o.responseType=i,o.onload=e=>{o.status<=206?l.readAsArrayBuffer(o.response):null!=a&&a(o.status,t)},null!=s&&(o.onprogress=e=>{s(e,t)}),null!=a&&(o.onerror=e=>{a(o.status,t)}),o.send(null)}}e.FileLoader=a},"0817":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("a401");class i{constructor(t,e,s=a.ModuleFileType.JS){this.url=t,this.name=e,this.type=s}}e.TaskCodeModuleParam=i},1173:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(){}initialize(){}destroy(){}}e.CoSystem=a},"1e86":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{}a.DATA_PARSE=3501,a.DATA_QUEUE_PARSE=3502,a.THREAD_INIT=3601,a.INIT_COMMON_MODULE=3621,a.THREAD_ACQUIRE_DATA=3631,a.THREAD_TRANSMIT_DATA=3632,a.INIT_TASK=3701,a.INIT_PARAM=3801,e.ThreadCMD=a},"1eb2":function(t,e,s){"use strict";if("undefined"!==typeof window){var a=window.document.currentScript,i=s("8875");a=i(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:i});var r=a&&a.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);r&&(s.p=r[1])}},"1f9e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{}a.PARSE="CTM_PARSE",a.LOAD_AND_PARSE="CTM_LOAD_AND_PARSE",e.CTMTaskCMD=a},2033:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("698b");class i{constructor(){this.dataPhaseFlag=a.DataPhaseFlag.PHASE_NONE,this.dataUnitUUID=0,this.listUUID=0}receiveDataUnit(t,e){}}e.DataReceiverBase=i},2356:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(){this.taskclass=-1,this.srcuid=-1,this.dataIndex=-1,this.streams=null,this.sendStatus=-1,this.wfst=0}buildThis(t){}reset(){}static GetFreeId(){return a.m_freeIdList.length>0?a.m_freeIdList.pop():-1}static Create(){let t=null,e=a.GetFreeId();return e>=0?(t=a.m_unitList[e],t.dataIndex=e,a.m_unitFlagList[e]=a.s_FLAG_BUSY):(t=new a,a.m_unitList.push(t),a.m_unitFlagList.push(a.s_FLAG_BUSY),t.dataIndex=a.m_unitListLen,a.m_unitListLen++),t}static Contains(t){if(null!=t){let e=t.dataIndex;if(e>=0&&e<a.m_unitListLen)return a.m_unitList[e]==t}return!1}static Restore(t){if(a.Contains(t)){let e=t.dataIndex;a.m_unitFlagList[e]==a.s_FLAG_BUSY&&(a.m_freeIdList.push(e),a.m_unitFlagList[e]=a.s_FLAG_FREE,t.sendStatus=-1,t.reset())}}static RestoreByUid(t){t>=0&&a.m_unitFlagList[t]==a.s_FLAG_BUSY&&(a.m_freeIdList.push(t),a.m_unitFlagList[t]=a.s_FLAG_FREE,a.m_unitList[t].reset())}}a.s_FLAG_BUSY=1,a.s_FLAG_FREE=0,a.m_unitFlagList=[],a.m_unitListLen=0,a.m_unitList=[],a.m_freeIdList=[],e.ThreadSendData=a},2931:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("9cc2");class i{constructor(){this.m_receivers=[],this.m_flag=!0}addReceiver(t){this.m_receivers.push(t)}removeReceiver(t){let e=this.m_receivers;for(let s=0,a=e.length;s<a;++s)if(t==e[s]){e.splice(s,1);break}}testUnit(){if(this.m_flag){if(this.unit.isCpuPhase()){let t=this.m_receivers;for(let e=0,s=t.length;e<s;++e){const s=t[e];s.dataUnitUUID>0&&s.listUUID>0&&s.receiveDataUnit(this.unit,1)}return this.m_flag=!1,!0}return!1}return!0}destroy(t,e){let s=this.m_receivers;for(let a=0,i=s.length;a<i;++a){const e=s[a];t.removeItem(e)}e.delete(this.uuid),this.uuid=0,this.m_receivers=null}}class r{constructor(){this.m_nodeMap=new Map,this.m_nodes=[],this.m_receiverPool=new a.ListPool,this.m_receiversTotal=0}testUnit(t){if(null!=t){let e=this.m_nodeMap.get(t.getUUID());if(null!=e)return e.testUnit()}return!1}addReceiver(t,e){if(null!=e&&this.m_receiverPool.hasnotItem(t)){let s;this.m_nodeMap.has(e.getUUID())?s=this.m_nodeMap.get(e.getUUID()):(s=new i,s.unit=e,s.uuid=e.getUUID(),this.m_nodes.push(s),this.m_nodeMap.set(e.getUUID(),s)),t.dataUnitUUID=e.getUUID();let a=t.listUUID;if(this.m_receiverPool.addItem(t),a==t.listUUID)throw"ReceiverSchedule::addReceiver() is the illegal operation !!!(listUUID("+a+"), receiver.listUUID("+t.listUUID+"))";s.addReceiver(t),this.m_receiversTotal++}}removeReceiver(t){if(t.dataUnitUUID>0&&t.listUUID>0&&this.m_receiverPool.hasItem(t)){let e=this.m_nodeMap.get(t.dataUnitUUID);e.removeReceiver(t),this.m_receiverPool.removeItem(t),this.m_receiversTotal--}t.dataUnitUUID=0,t.listUUID=0}getReceiversTotal(){return this.m_receiversTotal}run(){if(this.m_receiversTotal>0){let t,e,s=this.m_nodes;for(let a=0,i=s.length;a<i;++a)e=s[a],t=e.testUnit(),t&&(this.m_receiversTotal--,s.splice(a,1),e.destroy(this.m_receiverPool,this.m_nodeMap),a--,i--)}}destroy(){}}e.ReceiverSchedule=r},"2a59":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("74ee"),i=s("7de1"),r=s("8eb0"),l=s("aeff"),o=s("73f9"),n=s("31e1");class d extends i.ResourceSchedule{constructor(){super()}createDataUnit(t,e,s=!1){l.DataUnitLock.lockStatus=207;let i=new l.GeometryDataUnit;switch(i.lossTime=Date.now(),i.immediate=s,i.data=new l.GeometryDataContainer,i.data.dataFormat=e,i.data.dataFormat){case a.DataFormat.CTM:this.m_ctmListener.addUrlToTask(t);break;case a.DataFormat.OBJ:this.m_objListener.addUrlToTask(t);break;case a.DataFormat.Draco:break;default:break}return i}initTask(t,e,s,a){for(let i=0;i<a.length;++i){const l=a[i];switch(l.name){case r.ModuleNS.objParser:this.m_objListener=new n.OBJParserListerner(t,e,l,s);break;case r.ModuleNS.ctmParser:this.m_ctmListener=new o.CTMParserListerner(t,e,l,s);break;default:break}}}destroy(){super.destroy()}}e.GeometryResourceSchedule=d},"31e1":function(t,e,s){"use strict";var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=s("0795"),r=s("aeff"),l=s("ceac"),o=a(s("3bda"));class n{constructor(t,e,s,a){this.m_parseTask=null,this.m_moduleUrl=s.url,this.m_unitPool=t,this.m_threadSchedule=e,this.m_receiverSchedule=a}addUrlToTask(t){if(!this.m_unitPool.hasUnitByUrl(t)){if(null==this.m_parseTask){let t=new l.OBJParseTask(this.m_moduleUrl);this.m_threadSchedule.bindTask(t),t.setListener(this),this.m_parseTask=t}(new i.FileLoader).load(t,(t,e)=>{o.default.ShowLogOnce("正在解析OBJ数据..."),this.m_parseTask.addBinaryData(t,e)},(t,e)=>{let s=Math.round(100*t.loaded/t.total);o.default.ShowLogOnce("obj file loading "+s+"%")},(t,e)=>{})}}objParseFinish(t,e){if(this.m_unitPool.hasUnitByUrl(e)){let s=this.m_unitPool.getUnitByUrl(e);null!=s&&(s.lossTime=Date.now()-s.lossTime,s.data.dataFormat=r.DataFormat.OBJ,s.data.models=t,r.DataUnitLock.lockStatus=209,s.toCpuPhase(),s.immediate&&this.m_receiverSchedule.testUnit(s))}}destroy(){null!=this.m_parseTask&&(this.m_parseTask.destroy(),this.m_parseTask=null),this.m_unitPool=null,this.m_threadSchedule=null,this.m_receiverSchedule=null}}e.OBJParserListerner=n},3844:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},"3a1d":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("fce7"),i=s("7566"),r=s("2356"),l=s("7ebf"),o=s("c917"),n=s("d2d9"),d=s("42a2"),h=s("85f5");class u{constructor(){this.m_initBoo=!0,this.m_teDelay=1e3,this.m_teTime=0,this.m_maxThreadsTotal=0,this.m_thrSupportFlag=-1,this.m_codeBlob=null,this.m_commonModuleUrls=[],this.m_threads=[],this.m_threadsTotal=0,this.m_threadEnabled=!0,this.m_thrIdexSDList=[],this.m_thrIndexList=[],this.m_codeStrList=[],this.m_dataPool=new i.ThrDataPool,this.m_graphJsonStr="",this.m_autoSendData=!1,this.m_currNewThr=null;let t=a.ThreadConfigure.MAX_TASKS_TOTAL;this.m_taskPool=new d.ThreadTaskPool(t),this.m_descList=new Array(t),this.m_descList.fill(null),this.m_tdrManager=new h.TDRManager(t),this.m_teTime=Date.now()}setParams(t,e=1e3){this.m_autoSendData=t,this.m_teDelay=e}hasRouterByTaskClass(t){return this.m_tdrManager.hasRouterByTaskClass(t)}setTaskDataRouter(t){this.m_tdrManager.setRouter(t)}bindTask(t,e=-1){if(null!=t){let s=t.attach(this.m_taskPool);if(s){let s=null;if(e>=0&&e<this.m_maxThreadsTotal){for(;;){if(!(e>=this.m_threadsTotal))break;this.createThread()}s=this.m_threads[e].localDataPool}t.setDataPool(this.m_dataPool,s);let a=t.dependency;null!=a&&(a.isJSFile()?this.initTaskByURL(a.threadCodeFileURL,t.getTaskClass()):a.isDependency()?this.initTaskByDependency(a.dependencyUniqueName,t.getTaskClass(),a.moduleName):a.isCodeString()&&this.initTaskByCodeStr(a.threadCodeString,t.getTaskClass(),a.moduleName))}}}sendDataToThreadAt(t,e){if(t>=0&&t<this.m_maxThreadsTotal){if(t>=this.m_threadsTotal)for(;;){if(!(t>=this.m_threadsTotal))break;this.createThread()}null!=e&&e.sendStatus<0&&(this.m_threads[t].isFree()?(e.sendStatus=0,this.m_threads[t].sendDataTo(e)):this.m_threads[t].localDataPool.addData(e))}else this.m_thrIdexSDList.push(e),this.m_thrIndexList.push(t)}hasTaskData(){return this.m_dataPool.isEnabled()}getThrDataPool(){return this.m_dataPool}run(){let t=!1;if(this.getThreadEnabled()){this.m_tdrManager.run();let e=0;if(this.m_dataPool.isEnabled())for(let t=0;t<this.m_threadsTotal;++t)this.m_threads[t].isFree()?this.m_dataPool.sendDataTo(this.m_threads[t]):this.m_dataPool.isEnabled()&&e++;else for(let t=0;t<this.m_threadsTotal;++t)this.m_threads[t].sendPoolDataToThread()||this.m_threads[t].hasDataToThread()&&e++;if(e+=this.m_dataPool.isEnabled()?1:0,e>0)this.createThread();else{e=0;for(let t=0;t<this.m_threadsTotal;++t)this.m_threads[t].isFree()&&e++;t=e>=this.m_threadsTotal,t||(this.m_teTime=Date.now())}}if(t&&this.m_threadsTotal>0){let t=Date.now()-this.m_teTime;if(t>this.m_teDelay){this.m_teTime=Date.now();let t=this.m_threads[this.m_threadsTotal-1];t.isFree()&&(this.m_threads.pop(),this.m_threadsTotal--,t.destroy())}}}createThread(){if(null!=this.m_currNewThr&&(this.m_currNewThr.isEnabled()||this.m_currNewThr.isDestroyed())&&(this.m_currNewThr=null),null==this.m_currNewThr&&this.m_threadsTotal<this.m_maxThreadsTotal){let t=new l.ThreadBase(this.m_tdrManager,this.m_taskPool,this.m_graphJsonStr);this.m_currNewThr=t,t.autoSendData=this.m_autoSendData,t.globalDataPool=this.m_dataPool,t.initialize(this.m_codeBlob),this.m_threads.push(t),this.m_threadsTotal++,this.m_tdrManager.setThreads(this.m_threads);for(let a=0,i=this.m_descList.length;a<i;++a)t.initModuleByTaskDescriptor(this.m_descList[a]);t.initModules(this.m_commonModuleUrls);for(let a=0;a<this.m_codeStrList.length;++a)t.initModuleByCodeString(this.m_codeStrList[a]);this.m_threadsTotal>=this.m_maxThreadsTotal&&(this.m_commonModuleUrls=[],this.m_codeStrList=[]);let e=this.m_thrIdexSDList.slice(0),s=this.m_thrIndexList.slice(0);this.m_thrIdexSDList=[],this.m_thrIndexList=[];for(let a=0;a<e.length;++a)this.sendDataToThreadAt(s[a],e[a])}}addDataWithParam(t,e=null,s=null){let a=r.ThreadSendData.Create();a.taskCmd=t,a.streams=e,a.descriptor=s,this.addData(a)}addData(t){null!=t&&t.srcuid>=0&&this.m_dataPool.addData(t)}getAFreeThread(){for(let t=0;t<this.m_threadsTotal;++t)if(this.m_threads[t].isFree())return this.m_threads[t];return null}getThreadsTotal(){return this.m_threadsTotal}getMaxThreadsTotal(){return this.m_maxThreadsTotal}setThreadEnabled(t){this.m_thrSupportFlag>0&&(this.m_thrSupportFlag=t?2:1),this.m_threadEnabled=t}getThreadEnabled(){return this.m_threadEnabled}isSupported(){if(this.m_thrSupportFlag>0)return 2==this.m_thrSupportFlag;let t="undefined"!==typeof Worker&&"undefined"!==typeof Blob;return this.m_thrSupportFlag=t?2:1,this.m_threadEnabled=t,t}initTaskByURL(t,e,s=""){if(""!=t&&e>=0&&e<this.m_descList.length){let a=this.m_descList[e];null==a&&(a=new o.TaskDescriptor(e,n.ThreadCodeSrcType.JS_FILE_CODE,t,s),this.m_descList[e]=a,this.initModuleByTaskDescriptor(a))}}initTaskByDependency(t,e,s=""){if(""!=t&&e>=0&&e<this.m_descList.length){let a=this.m_descList[e];null==a&&(a=new o.TaskDescriptor(e,n.ThreadCodeSrcType.DEPENDENCY,t,s),this.m_descList[e]=a,this.initModuleByTaskDescriptor(a))}}initTaskByCodeStr(t,e,s){if(""!=t&&e>=0&&e<this.m_descList.length){let a=this.m_descList[e];null==a&&(a=new o.TaskDescriptor(e,n.ThreadCodeSrcType.STRING_CODE,t,s),this.m_descList[e]=a,this.initModuleByTaskDescriptor(a))}}initModuleByTaskDescriptor(t){for(let e=0;e<this.m_threadsTotal;++e)this.m_threads[e].initModuleByTaskDescriptor(t)}initModules(t){if(null!=t&&t.length>0){for(let e=0;e<t.length;++e){if(""==t[e])throw Error("moduleUrls["+e+'] == ""');this.m_commonModuleUrls.push(t[e])}for(let e=0;e<this.m_threadsTotal;++e)this.m_threads[e].initModules(t)}}initModuleByCodeString(t){if(t.length>8){this.m_threadsTotal<this.m_maxThreadsTotal&&this.m_codeStrList.push(t);for(let e=0;e<this.m_threadsTotal;++e)this.m_threads[e].initModuleByCodeString(t)}}destroy(){if(null!=this.m_tdrManager){for(let t=0;t<this.m_threadsTotal;++t)this.m_threads[t].destroy();this.m_threads=[],this.m_tdrManager.destroy(),this.m_tdrManager=null,this.m_threadsTotal=0}}setDependencyGraphJsonString(t){this.m_graphJsonStr=t}initialize(t,e,s=""){if(this.m_initBoo){if(this.getThreadEnabled()&&this.isSupported()){if(""==e)throw Error('coreCodeUrl == "" !!!');e=this.getUrl(e);let a=new XMLHttpRequest;a.open("GET",e,!0),a.onload=()=>{if(a.status<=206){let e=""==s?new Blob([a.responseText]):new Blob([s+a.responseText]);this.initThread(t,e)}},a.onerror=t=>{},a.send(null)}this.m_initBoo=!1}}initThread(t,e){t<1&&(t=1),this.m_codeBlob=e,this.m_maxThreadsTotal=t}getUrl(t){let e=t.indexOf("http://");if(e<0&&(e=t.indexOf("https://")),e>=0)return t;let s=window.location.href,a=s.slice(0,s.lastIndexOf("/")+1);return t=a+t,t}}e.ThreadSchedule=u},"3b80":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("d2d9");class i{constructor(){this.moduleName="",this.threadCodeString="",this.threadCodeFileURL="",this.dependencyUniqueName="",this.threadCodeSrcType=a.ThreadCodeSrcType.JS_FILE_CODE}isCodeString(){return this.threadCodeSrcType==a.ThreadCodeSrcType.STRING_CODE}isJSFile(){return this.threadCodeSrcType==a.ThreadCodeSrcType.JS_FILE_CODE}isDependency(){return this.threadCodeSrcType==a.ThreadCodeSrcType.DEPENDENCY}isCodeBlob(){return this.threadCodeSrcType==a.ThreadCodeSrcType.BLOB_CODE}clone(){let t=new i;return this.isCodeString()&&(t.threadCodeString=this.threadCodeString),this.isJSFile()&&(t.threadCodeFileURL=this.threadCodeFileURL),this.isDependency()&&(t.dependencyUniqueName=this.dependencyUniqueName),t.threadCodeSrcType=this.threadCodeSrcType,t}}e.TaskDependency=i;class r extends i{constructor(t){super(),this.threadCodeFileURL=t,this.threadCodeSrcType=a.ThreadCodeSrcType.JS_FILE_CODE}}e.TaskJSFileDependency=r;class l extends i{constructor(t){super(),this.dependencyUniqueName=t,this.threadCodeSrcType=a.ThreadCodeSrcType.DEPENDENCY}}e.TaskUniqueNameDependency=l;class o extends i{constructor(t,e){super(),this.threadCodeString=t,this.moduleName=e,this.threadCodeSrcType=a.ThreadCodeSrcType.STRING_CODE}}e.TaskCodeStringDependency=o},"3bda":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("a567");class i{static SetDebugEnabled(t){i.s_debugEanbled=t}static SetXY(t,e){i.s_leftX=t,i.s_topY=e}static SetTextBgColor(t){i.s_textBGColor=a.RGBColorUtil.uint24RGBToCSSHeXRGBColor(t),null!=i.s_infoDiv&&(i.s_infoDiv.style.backgroundColor=this.s_textBGColor)}static SetTextColor(t){i.s_textColor=a.RGBColorUtil.uint24RGBToCSSHeXRGBColor(t),null!=i.s_infoDiv&&(i.s_infoDiv.style.color=this.s_textColor)}static SetTextBgEnabled(t){if(this.s_textBgEnabled=t,null!=i.s_infoDiv){let t=i.s_infoDiv;i.s_textBgEnabled?t.style.backgroundColor=this.s_textBGColor:t.style.backgroundColor=""}}static ShowLog(t){i.s_debugEanbled&&(i.s_logStr.length>0?i.s_logStr+="<br/>"+t:i.s_logStr=t,i.UpdateDivText())}static GetLog(){return i.s_logStr}static ShowLogOnce(t){i.s_debugEanbled&&(i.s_logStr=t,i.UpdateDivText())}static ClearLog(t=""){i.s_debugEanbled&&(i.s_logStr=t,i.UpdateDivText())}static UpdateDivText(){if(i.s_debugEanbled)if(null!=i.s_infoDiv)i.s_infoDiv.innerHTML=i.s_logStr;else{let t=document.createElement("div");t.style.color="";let e=t;e.width=128,e.height=64,i.s_textBgEnabled?e.style.backgroundColor=this.s_textBGColor:e.style.backgroundColor="",e.style.color=this.s_textColor,e.style.left=i.s_leftX+"px",e.style.top=i.s_topY+"px",e.style.zIndex="9999",e.style.position="absolute",document.body.appendChild(e),i.s_infoDiv=e,e.innerHTML=i.s_logStr}}static ShowAtTop(){null!=i.s_infoDiv&&(i.s_infoDiv.parentElement.removeChild(i.s_infoDiv),document.body.appendChild(i.s_infoDiv))}}i.s_logStr="",i.s_infoDiv=null,i.s_debugEanbled=!1,i.s_textBGColor="#aa0033",i.s_textColor="#000000",i.s_textBgEnabled=!0,i.s_leftX=0,i.s_topY=128,e.default=i},"42a2":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(t){this.m_total=0,this.m_total=t,this.m_taskList=new Array(t),this.m_taskList[0]=null,this.m_freeList=new Array(t);for(let e=1,s=t;e<s;++e)this.m_freeList[e]=e}getTaskByUid(t){return t<this.m_total&&t>0?this.m_taskList[t]:null}attachTask(t){if(t.getUid()<1&&this.m_freeList.length>0){let e=this.m_freeList.pop();return this.m_taskList[e]=t,e}return-1}detachTask(t){t.getUid()>0&&null!=this.m_taskList[t.getUid()]&&(this.m_taskList[t.getUid()]=null,this.m_freeList.push(t.getUid()))}}e.ThreadTaskPool=a},"58fc":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},"60cd":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(t,e,s,a){this.status=0,this.taskclass=t,this.cmd=e,this.taskCmd=s,this.threadIndex=a}}e.TDRParam=a},"698b":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{static clearAllPhase(t=0){return a.PHASE_NONE}static addNetPhase(t){return a.PHASE_NET|t}static addCpuPhase(t){return a.PHASE_CPU|t}static addGpuPhase(t){return a.PHASE_GPU|t}static removeNetPhase(t){return~a.PHASE_NET&t}static removeCpuPhase(t){return~a.PHASE_CPU&t}static removeGpuPhase(t){return~a.PHASE_GPU&t}static isNonePhase(t){return a.PHASE_NONE==t}static isNetPhase(t){return(a.PHASE_NET&t)==a.PHASE_NET}static isCpuPhase(t){return(a.PHASE_CPU&t)==a.PHASE_CPU}static isGpuPhase(t){return(a.PHASE_GPU&t)==a.PHASE_GPU}}a.PHASE_NONE=0,a.PHASE_NET=4,a.PHASE_CPU=8,a.PHASE_GPU=16,e.DataPhaseFlag=a},"73f9":function(t,e,s){"use strict";var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=s("0795"),r=s("aeff"),l=s("7dbf"),o=a(s("3bda"));class n{constructor(t,e,s,a){this.m_parseTask=null,this.m_moduleUrl=s.url,this.m_unitPool=t,this.m_threadSchedule=e,this.m_receiverSchedule=a}addUrlToTask(t){if(!this.m_unitPool.hasUnitByUrl(t)){if(null==this.m_parseTask){let t=new l.CTMParseTask(this.m_moduleUrl);this.m_threadSchedule.bindTask(t),t.setListener(this),this.m_parseTask=t}(new i.FileLoader).load(t,(t,e)=>{o.default.ShowLogOnce("正在解析CTM数据..."),this.m_parseTask.addBinaryData(new Uint8Array(t),e)},(t,e)=>{let s=Math.round(100*t.loaded/t.total);o.default.ShowLogOnce("ctm file loading "+s+"%")},(t,e)=>{})}}ctmParseFinish(t,e){if(this.m_unitPool.hasUnitByUrl(e)){let s=this.m_unitPool.getUnitByUrl(e);null!=s&&(s.lossTime=Date.now()-s.lossTime,s.data.models=[t],r.DataUnitLock.lockStatus=209,s.toCpuPhase(),s.immediate&&this.m_receiverSchedule.testUnit(s))}}destroy(){null!=this.m_parseTask&&(this.m_parseTask.destroy(),this.m_parseTask=null),this.m_unitPool=null,this.m_threadSchedule=null,this.m_receiverSchedule=null}}e.CTMParserListerner=n},"74ee":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("698b"),i=s("7a08");var r;e.DataFormat=i.DataFormat,function(t){t[t["Geometry"]=0]="Geometry",t[t["Texture"]=1]="Texture",t[t["Undefined"]=2]="Undefined"}(r||(r={})),e.DataClass=r;class l{}l.lockStatus=0,e.DataUnitLock=l;class o{constructor(){if(this.m_dataPhaseFlag=a.DataPhaseFlag.PHASE_NONE,this.immediate=!1,this.lossTime=0,207!==l.lockStatus)throw Error("illegal operation !!!");this.m_uuid=o.s_uuid++,l.lockStatus=0}getUUID(){return this.m_uuid}clone(){return null}test(){}isNetPhase(){return a.DataPhaseFlag.isCpuPhase(this.m_dataPhaseFlag)}isCpuPhase(){return a.DataPhaseFlag.isCpuPhase(this.m_dataPhaseFlag)}isGpuPhase(){return a.DataPhaseFlag.isGpuPhase(this.m_dataPhaseFlag)}clearAllPhase(){this.m_dataPhaseFlag=a.DataPhaseFlag.clearAllPhase(this.m_dataPhaseFlag)}toNetPhase(){if(208!==l.lockStatus)throw Error("illegal operation !!!");this.m_dataPhaseFlag=a.DataPhaseFlag.addNetPhase(this.m_dataPhaseFlag)}toCpuPhase(){if(209!==l.lockStatus)throw Error("illegal operation !!!");this.m_dataPhaseFlag=a.DataPhaseFlag.addCpuPhase(this.m_dataPhaseFlag)}toGpuPhase(){if(210!==l.lockStatus)throw Error("illegal operation !!!");this.m_dataPhaseFlag=a.DataPhaseFlag.addGpuPhase(this.m_dataPhaseFlag)}}o.s_uuid=0,e.DataUnit=o},7566:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(){this.m_dataList=[],this.m_waitingDataList=[],this.m_dataTotal=0,this.m_dataHaveTotal=0,this.m_startupFlag=0}sendDataTo(t){if(this.m_dataTotal>0){let e=null,s=this.m_waitingDataList.length;if(s>0&&(e=this.m_waitingDataList[0],t.sendDataTo(e),1==e.sendStatus))return this.m_dataTotal--,s--,this.m_waitingDataList.shift(),!0;if(s=this.m_dataTotal-s,s>0){if(e=this.m_dataList.shift(),t.sendDataTo(e),1==e.sendStatus)return this.m_dataTotal--,!0;this.m_waitingDataList.push(e)}}return!1}addData(t){t.sendStatus<0&&(t.sendStatus=0,this.m_dataTotal++,this.m_dataHaveTotal++,this.m_startupFlag=1,this.m_dataList.push(t))}getDataTotal(){return this.m_dataTotal}isEnabled(){return this.m_dataTotal*this.m_startupFlag>0}isStartup(){return this.m_startupFlag>0}}e.ThrDataPool=a},"7a08":function(t,e,s){"use strict";var a;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["CTM"]="ctm",t["Draco"]="draco",t["OBJ"]="obj",t["Jpg"]="jpg",t["Png"]="png"}(a||(a={})),e.DataFormat=a},"7dbf":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("83a3"),i=s("3b80"),r=s("1f9e");class l extends a.ThreadTask{constructor(t){super(),this.m_listener=null,t.indexOf("/")>0?this.dependency=new i.TaskJSFileDependency(t):this.dependency=new i.TaskUniqueNameDependency(t)}setListener(t){this.m_listener=t}addBinaryData(t,e){null!=t&&this.addDataWithParam(r.CTMTaskCMD.PARSE,[t],{url:e})}addURL(t){""!=t&&this.addDataWithParam(r.CTMTaskCMD.LOAD_AND_PARSE,null,{url:t})}parseDone(t,e){if(null!=this.m_listener){let e=t.data;void 0==e.normals&&(e.normals=null),void 0==e.uvsList&&(e.uvsList=null),this.m_listener.ctmParseFinish(e,t.descriptor.url)}return!0}getTaskClass(){return 101}destroy(){super.destroy(),this.m_listener=null}}e.CTMParseTask=l},"7de1":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("a092"),i=s("2033");class r extends i.DataReceiverBase{constructor(){super(),r.s_total++}receiveDataUnit(t,e){let s=this.callback;this.callback=null,null!=s&&s(t,e)}}r.s_total=0;class l{constructor(){this.m_unitPool=new a.DataUnitPool,this.m_taskModules=null}createDataUnit(t,e,s=!1){return null}initTask(t,e,s,a){}setTaskModuleUrls(t){null!=t&&(this.m_taskModules=t.slice(0))}initialize(t,e,s=null){null==this.m_receiverSchedule&&null==this.m_threadSchedule&&(this.m_receiverSchedule=t,this.m_threadSchedule=e,this.initTask(this.m_unitPool,e,t,null!=this.m_taskModules?this.m_taskModules:s))}hasDataUnit(t){return this.m_unitPool.hasUnitByUrl(t)}getCPUDataByUrlAndCallback(t,e,s,a=!1){let i=this.m_unitPool.getUnitByUrl(t);if(null!=i&&null!=s&&i.isCpuPhase())return i.lossTime=0,s(i,1),i;if(null==i){let l=new r;l.callback=s,i=this.getCPUDataByUrl(t,e,l,a)}return i}getCPUDataByUrl(t,e,s=null,a=!1){let i=this.m_unitPool.getUnitByUrl(t);return null!=i&&null!=s&&i.isCpuPhase()?(i.lossTime=0,s.receiveDataUnit(i,1),i):(null==i&&(i=this.createDataUnit(t,e,a),i.lossTime=Date.now(),i.url=t,this.m_unitPool.addUnit(t,i)),this.m_receiverSchedule.addReceiver(s,i),i)}getGPUDataByUrlAndCallback(t,e,s,a=!1){return null}getGPUDataByUrl(t,e,s=null,a=!1){return null}getGPUDataByUUIDAndCallback(t,e){return null}getGPUDataByUUID(t,e=null){return null}destroy(){}}e.ResourceSchedule=l},"7ebf":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("1e86"),i=s("2356"),r=s("7566"),l=s("d2d9"),o=s("fce7"),n=s("60cd");class d{constructor(t,e,s=""){this.m_uid=-1,this.m_worker=null,this.m_taskItems=[],this.m_free=!1,this.m_enabled=!1,this.m_initBoo=!0,this.m_thrData=null,this.m_commonModuleMap=new Map,this.autoSendData=!1,this.localDataPool=new r.ThrDataPool,this.globalDataPool=null,this.unlock=!0,this.m_tdrManager=t,this.m_taskPool=e,this.m_graphJsonStr=s,this.m_uid=d.s_uid++,this.m_taskfs=new Array(o.ThreadConfigure.MAX_TASKS_TOTAL),this.m_taskfs.fill(-1)}getUid(){return this.m_uid}isEnabled(){return this.m_enabled}isFree(){return this.m_free&&this.unlock}hasDataToThread(){return this.localDataPool.isEnabled()||this.globalDataPool.isEnabled()}sendPoolDataToThread(){if(this.m_free){let t=this.localDataPool.isEnabled();return t&&(t=this.localDataPool.sendDataTo(this)),t||(t=this.globalDataPool.sendDataTo(this)),t}return!1}sendDataTo(t){if(this.m_free&&this.m_taskfs[t.taskclass]>0){t.buildThis(!0);let e={streams:null};if(e.descriptor=t.descriptor,e.taskCmd=t.taskCmd,e.taskclass=t.taskclass,e.srcuid=t.srcuid,e.dataIndex=t.dataIndex,e.wfst=t.wfst,e.streams=t.streams,e.cmd=a.ThreadCMD.DATA_PARSE,e.threadIndex=this.m_uid,null!=t.streams){let s=t.streams,a=new Array(s.length);for(let t=0;t<s.length;++t)s[t]instanceof ArrayBuffer?a[t]=s[t]:a[t]=s[t].buffer;this.m_worker.postMessage(e,a)}else this.m_worker.postMessage(e);t.sendStatus=1,t.streams=null,e.descriptor=null,e.streams=null,this.m_thrData=t,this.m_free=!1}else this.m_taskfs[t.taskclass]}initModuleByTaskDescriptor(t){if(null!=t){let e=t.taskclass;e>=0&&e<this.m_taskfs.length&&this.m_taskfs[e]<0&&(this.m_taskfs[e]=0,this.m_taskItems.push(t))}}initModules(t){let e=[];for(let s=0;s<t.length;++s)this.m_commonModuleMap.has(t[s])||(this.m_commonModuleMap.set(t[s],1),e.push(t[s]));e.length>0&&this.m_worker.postMessage({cmd:a.ThreadCMD.INIT_COMMON_MODULE,threadIndex:this.getUid(),modules:e,type:l.ThreadCodeSrcType.JS_FILE_CODE})}initModuleByCodeString(t){this.m_worker.postMessage({cmd:a.ThreadCMD.INIT_COMMON_MODULE,threadIndex:this.getUid(),src:t,type:l.ThreadCodeSrcType.STRING_CODE})}updateInitTask(){if(this.m_taskItems.length>0){this.m_free=!1,this.m_enabled=!1;let t=this.m_taskItems.pop();this.m_worker.postMessage({cmd:a.ThreadCMD.INIT_TASK,threadIndex:this.getUid(),param:t})}}receiveData(t){this.m_free=!0,this.autoSendData&&this.sendPoolDataToThread();let e=this.m_taskPool.getTaskByUid(t.srcuid),s=!0;null!=e&&(s=e.parseDone(t,0)),this.updateInitTask()}sendRouterDataTo(t){let e=t.param;null!=t&&t.isTransmission()&&e.threadIndex==this.m_uid&&(t.param=null,this.m_worker.postMessage({cmd:e.cmd,taskCmd:e.taskCmd,threadIndex:this.getUid(),taskclass:e.taskclass,data:t.getData()},t.getTransfers()))}terminate(){null!=this.m_worker&&(this.m_worker.terminate(),this.m_worker=null,this.m_free=!1,this.m_enabled=!1)}destroy(){null!=this.m_worker&&(this.terminate(),this.m_taskPool=null,this.m_tdrManager=null,this.m_graphJsonStr="",this.localDataPool=null,this.globalDataPool=null)}isDestroyed(){return null==this.m_taskPool}initialize(t){if(this.m_initBoo&&null!=t&&null==this.m_worker){this.m_initBoo=!1;let e=new Worker(URL.createObjectURL(t));this.m_worker=e,this.m_worker.onmessage=t=>{null!=this.m_thrData&&(i.ThreadSendData.Restore(this.m_thrData),this.m_thrData.sendStatus=-1,this.m_thrData=null);let s=t.data;switch(s.cmd){case a.ThreadCMD.DATA_PARSE:this.receiveData(s);break;case a.ThreadCMD.THREAD_INIT:e.postMessage({cmd:a.ThreadCMD.INIT_PARAM,threadIndex:this.getUid(),graphJsonStr:this.m_graphJsonStr,total:o.ThreadConfigure.MAX_TASKS_TOTAL});break;case a.ThreadCMD.INIT_TASK:if(this.m_taskfs[s.taskclass]<0)throw Error("sub worker taskclass and main worker logic taskClass are not equal !!!");this.m_taskfs[s.taskclass]=1,this.m_free=!0,this.m_enabled=!0,this.updateInitTask();break;case a.ThreadCMD.INIT_PARAM:this.m_free=!0,this.m_enabled=!0,this.updateInitTask();break;case a.ThreadCMD.THREAD_ACQUIRE_DATA:let t=new n.TDRParam(s.taskclass,s.cmd,s.taskCmd,this.getUid()),i=this.m_tdrManager.getRouterByTaskClass(s.taskclass);null!=i&&(i.acquireTrigger(),i.isDataEnabled()&&!i.isTransmission()?(i.param=t,this.sendRouterDataTo(i)):i=null),null==i&&this.m_tdrManager.waitRouterByParam(t);break;case a.ThreadCMD.THREAD_TRANSMIT_DATA:let r=this.m_tdrManager.getRouterByTaskClass(s.taskclass);null!=r&&(r.isDataEnabled(),r.setData(s.data));break;case a.ThreadCMD.INIT_COMMON_MODULE:break;default:break}}}}}d.s_uid=0,e.ThreadBase=d},"83a3":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("2356");class i{constructor(){this.m_uid=-1,this.m_globalDataPool=null,this.m_localDataPool=null,this.m_taskPool=null,this.m_parseIndex=0,this.m_parseTotal=0,this.dependency=null}attach(t){if(this.m_uid<0&&null==this.m_taskPool&&null!=t){this.m_taskPool=t;let e=t.attachTask(this);if(e>0)return this.m_uid=e,!0;throw Error("illegal operation!!!")}return!1}detach(){this.m_uid>0&&null!=this.m_taskPool&&(this.m_taskPool.detachTask(this),this.m_uid=-1)}setDataPool(t,e=null){this.m_globalDataPool=t,this.m_localDataPool=e}reset(){this.m_parseIndex=0}setParseTotal(t){this.m_parseTotal=t}isFinished(){return this.m_parseIndex>=this.m_parseTotal}getParsedTotal(){return this.m_parseIndex>=this.m_parseTotal?this.m_parseTotal:this.m_parseIndex+1}getParseTotal(){return this.m_parseTotal}getParsedIndex(){return this.m_parseIndex}getUid(){return this.m_uid}parseDone(t,e){throw Error("ThreadTask::parseDone(), Need Override it!")}createSendData(){let t=a.ThreadSendData.Create();return t.srcuid=this.getUid(),t.taskclass=this.getTaskClass(),t}createSendDataWithParam(t,e=null,s=null){let i=a.ThreadSendData.Create();return i.srcuid=this.getUid(),i.taskclass=this.getTaskClass(),i.taskCmd=t,i.streams=e,i.descriptor=null,i}addDataWithParam(t,e=null,s=null,a=!1){let i=this.createSendData();i.taskCmd=t,i.streams=e,i.descriptor=s,this.addData(i,a)}addData(t,e=!1){if(!(this.m_uid>=0))throw Error("Need attach this task !");t.srcuid=this.m_uid,t.taskclass=this.getTaskClass(),e?null!=this.m_localDataPool&&this.m_localDataPool.addData(t):null!=this.m_globalDataPool&&this.m_globalDataPool.addData(t)}getWorkerSendDataAt(t){throw Error("ThreadTask::getWorkerSendDataAt(), Need Override !")}getTaskClass(){throw Error("ThreadTask::getTaskClass(), Need Override !")}destroy(){this.detach(),this.m_globalDataPool=null,this.m_localDataPool=null,this.dependency=null}}e.ThreadTask=i},"85f5":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(t){this.m_waitParams=[],this.m_enabledParams=[],this.m_threads=null,this.m_taskClassTotal=t>1024?t:1024,this.m_routers=new Array(t),this.m_routers.fill(null),this.m_rfs=new Array(t),this.m_rfs.fill(0)}setThreads(t){this.m_threads=t}hasRouterByTaskClass(t){return t>=0&&t<this.m_taskClassTotal&&null!=this.m_routers[t]}getRouterByTaskClass(t){if(t>=0&&t<this.m_taskClassTotal)return this.m_routers[t]}setRouter(t){let e=t.getTaskClass();if(!(e>=0&&e<this.m_taskClassTotal))throw Error("illegal object !!!");null==this.m_routers[e]&&(this.m_routers[e]=t)}waitRouterByParam(t){if(0!=t.status)throw Error("illegal param !!!");let e=t.taskclass;if(!(e>=0&&e<this.m_taskClassTotal))throw Error("illegal object !!!");this.m_waitParams.push(t),t.status=1}run(){let t=this.m_waitParams.length;if(t>0){let e=this.m_waitParams,s=null,a=null;for(let i=0;i<t;++i)a=e[i],s=this.m_routers[a.taskclass],null!=s&&s.isDataEnabled()&&!s.isTransmission()&&(s.acquireTrigger(),s.param=a,this.m_enabledParams.push(a),a.status=2,e.splice(i,1),--i,--t);if(t=this.m_enabledParams.length,t>0){e=this.m_enabledParams;for(let s=0;s<t;++s)this.m_threads[e[s].threadIndex].sendRouterDataTo(this.getRouterByTaskClass(e[s].taskclass));this.m_enabledParams=[]}}}getEnabledParams(){if(this.m_enabledParams.length>0){let t=this.m_enabledParams;return this.m_enabledParams=[],t}return null}destroy(){this.m_taskClassTotal=0,this.m_routers.length=0}}e.TDRManager=a},8875:function(t,e,s){var a,i,r;(function(s,l){i=[],a=l,r="function"===typeof a?a.apply(e,i):a,void 0===r||(t.exports=r)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(m){var s,a,i,r=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,l=/@([^@]*):(\d+):(\d+)\s*$/gi,o=r.exec(m.stack)||l.exec(m.stack),n=o&&o[1]||!1,d=o&&o[2]||!1,h=document.location.href.replace(document.location.hash,""),u=document.getElementsByTagName("script");n===h&&(s=document.documentElement.outerHTML,a=new RegExp("(?:[^\\n]+?\\n){0,"+(d-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),i=s.replace(a,"$1").trim());for(var c=0;c<u.length;c++){if("interactive"===u[c].readyState)return u[c];if(u[c].src===n)return u[c];if(n===h&&u[c].innerHTML&&u[c].innerHTML.trim()===i)return u[c]}return null}}return t}))},"8eb0":function(t,e,s){"use strict";var a;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["ctmParser"]="ctmGeomParser",t["objParser"]="objGeomParser",t["dracoParser"]="dracoGeomParser"}(a||(a={})),e.ModuleNS=a},"9cc2":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("3844");e.ListPoolItem=a.ListPoolItem;class i{constructor(){this.m_list=[null],this.m_total=1,this.m_freeUUIDs=[]}hasItemByUUID(t){return t>0&&t<this.m_total&&this.m_list[t],!1}hasItem(t){return null!=t&&t.listUUID>0&&t.listUUID<this.m_total&&this.m_list[t.listUUID],!1}hasnotItem(t){return null!=t&&t.listUUID>0&&t.listUUID<this.m_total&&this.m_list[t.listUUID],!0}getItemByUUID(t){return t>0&&t<this.m_total&&this.m_list[t],null}addItem(t){if(null!=t){if(0!=t.listUUID)throw Error("ListPool::addItem() is the illegal operation !!!");if(this.m_freeUUIDs.length>0){if(t.listUUID=this.m_freeUUIDs.pop(),null!=this.m_list[t.listUUID])throw Error("ListPool::addItem() is the illegal operation !!!");this.m_list[t.listUUID]=t}else t.listUUID=this.m_total,this.m_total++,this.m_list.push(t)}}removeItem(t){if(null!=t&&t.listUUID>0&&t.listUUID<this.m_total&&null!=this.m_list[t.listUUID]){if(this.m_list[t.listUUID]!=t)throw"ListPool::removeItem() is the illegal operation !!!";this.m_freeUUIDs.push(t.listUUID),this.m_list[t.listUUID]=null,t.listUUID=0}}}e.ListPool=i},a00a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("cbd5");class i{constructor(){this.cospace=new a.CoSpace}setTaskModuleUrls(t,e="geom"){this.cospace.geometry.setTaskModuleUrls(t)}initialize(t,e,s,a=!0){this.cospace.geometry.setTaskModuleUrls(s),this.cospace.initialize(t,e,a)}getCPUDataByUrlAndCallback(t,e,s,a=!1){return this.cospace.geometry.getCPUDataByUrlAndCallback(t,e,s,a)}destroy(){}}function r(){return new i}e.Instance=i,e.createInstance=r},a054:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("58fc");e.GeometryModelDataType=a.GeometryModelDataType},a092:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("74ee"),i=s("aeff");class r{constructor(){}}class l{constructor(){this.m_urlPool=new Map,this.m_idPool=new Map,l.s_inited&&(l.s_inited=!1,this.createUnit())}createUnit(){a.DataUnitLock.lockStatus=207;let t=new a.DataUnit;return t}createGeometryUnit(){a.DataUnitLock.lockStatus=207;let t=new i.GeometryDataUnit;return t}hasUnitByUrl(t){return this.m_urlPool.has(t)}hasUnitByUUID(t){return this.m_idPool.has(t)}addUnit(t,e){if(""!=t&&null!=e&&!this.m_urlPool.has(t)){let s=new r;s.uuid=e.getUUID(),s.url=t,s.unit=e,this.m_urlPool.set(t,s),this.m_idPool.set(e.getUUID(),s)}}removeUnit(t){if(null!=t&&this.m_idPool.has(t.getUUID())){let e=this.m_idPool.get(t.getUUID());this.m_idPool.delete(e.uuid),this.m_urlPool.delete(e.url),e.unit=null}}removeUnitByUUID(t){if(this.m_idPool.has(t)){let e=this.m_idPool.get(t);this.m_idPool.delete(e.uuid),this.m_urlPool.delete(e.url),e.unit=null}}removeUnitByUrl(t){if(this.m_urlPool.has(t)){let e=this.m_urlPool.get(t);this.m_idPool.delete(e.uuid),this.m_urlPool.delete(e.url),e.unit=null}}getUnitByUrl(t){let e=this.m_urlPool.get(t);return null!=e?e.unit:null}getUnitByUUID(t){let e=this.m_idPool.get(t);return null!=e?e.unit:null}}l.s_inited=!0,e.DataUnitPool=l},a401:function(t,e,s){"use strict";var a;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["JS"]="js-text",t["Binasy"]="binary"}(a||(a={})),e.ModuleFileType=a},a567:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{static uint24RGBToCSSHeXRGBColor(t){let e=Math.round(t).toString(16);if(e.length>6)e=e.slice(-6);else if(e.length<6){let t=6-e.length;const s="000000";e=s.slice(0,t)+e}return"#"+e}}e.RGBColorUtil=a},aeff:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("74ee");e.DataFormat=a.DataFormat,e.DataUnitLock=a.DataUnitLock,e.DataUnit=a.DataUnit;const i=s("58fc");e.GeometryModelDataType=i.GeometryModelDataType;class r{constructor(){this.dataFormat=a.DataFormat.CTM,this.models=null}setFormatBUrl(t){if(""!=t){let e=t.lastIndexOf(".");if(e<=0)throw Error("illegal geometry data url: "+t);switch(t.slice(e+1)){case a.DataFormat.CTM:this.dataFormat=a.DataFormat.CTM;break;case a.DataFormat.Draco:this.dataFormat=a.DataFormat.Draco;break;default:throw Error("illegal geometry data url: "+t)}}}destroy(){this.models=null}}e.GeometryDataContainer=r;class l extends a.DataUnit{constructor(){super(),this.data=null,this.dataClass=a.DataClass.Geometry}}e.GeometryDataUnit=l},b406:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(){}initialize(){}addModuleByUniqueName(t){}startupModuleByUniqueName(t){}destroy(){}}e.CoRuntime=a},bd49:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("74ee");e.DataUnitLock=a.DataUnitLock,e.DataUnit=a.DataUnit;class i{constructor(){this.dataFormat=a.DataFormat.CTM,this.image=null}setFormatBUrl(t){if(""!=t){let e=t.lastIndexOf(".");if(e<=0)throw Error("illegal geometry data url: "+t);switch(t.slice(e+1)){case a.DataFormat.CTM:this.dataFormat=a.DataFormat.CTM;break;case a.DataFormat.Draco:this.dataFormat=a.DataFormat.Draco;break;default:throw Error("illegal geometry data url: "+t)}}}}e.TextureDataContainer=i;class r extends a.DataUnit{constructor(){super(),this.data=null,this.dataClass=a.DataClass.Geometry}}e.TextureDataUnit=r},c917:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{constructor(t,e,s,a){this.inited=!1,this.taskclass=t,this.type=e,this.src=s,this.moduleName=a}}e.TaskDescriptor=a},cbd5:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("3a1d"),i=s("2a59"),r=s("2931"),l=s("eda7"),o=s("0817"),n=s("8eb0"),d=s("1173"),h=s("b406");class u{constructor(){this.m_inited=!0,this.m_receiver=new r.ReceiverSchedule,this.system=new d.CoSystem,this.runtime=new h.CoRuntime,this.thread=new a.ThreadSchedule,this.geometry=new i.GeometryResourceSchedule,this.texture=new l.TextureResourceSchedule,this.m_timeoutId=-1}initialize(t,e,s=!1){if(this.m_inited){this.m_inited=!1,this.thread.setParams(s),this.thread.initialize(t,e);let a=[new o.TaskCodeModuleParam("static/cospace/modules/ctm/ModuleCTMGeomParser.umd.min.js",n.ModuleNS.ctmParser)];this.geometry.initialize(this.m_receiver,this.thread,a),this.update()}}update(){let t=40;this.thread.isSupported()&&(this.thread.hasTaskData()||this.m_receiver.getReceiversTotal()>0)&&(t=20),this.thread.run(),this.m_receiver.run(),this.m_timeoutId>-1&&clearTimeout(this.m_timeoutId),this.m_timeoutId=setTimeout(this.update.bind(this),t)}destroy(){}}e.CoSpace=u},ceac:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("a054");e.OBJModelDataType=a.OBJModelDataType;const i=s("83a3"),r=s("3b80");class l extends i.ThreadTask{constructor(t){super(),this.m_listener=null,t.indexOf("/")>0?this.dependency=new r.TaskJSFileDependency(t):this.dependency=new r.TaskUniqueNameDependency(t)}setListener(t){this.m_listener=t}addBinaryData(t,e){null!=t&&this.addDataWithParam("",[t],{url:e})}addURL(t){if(""!=t)throw Error("illegal operation!!!")}parseDone(t,e){if(null!=this.m_listener){let e=t.data;this.m_listener.objParseFinish(e.models,t.descriptor.url)}return!0}getTaskClass(){return 103}destroy(){super.destroy(),this.m_listener=null}}e.OBJParseTask=l},d2d9:function(t,e,s){"use strict";var a;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["STRING_CODE"]=0]="STRING_CODE",t[t["BLOB_CODE"]=1]="BLOB_CODE",t[t["JS_FILE_CODE"]=2]="JS_FILE_CODE",t[t["DEPENDENCY"]=3]="DEPENDENCY"}(a||(a={})),e.ThreadCodeSrcType=a},eda7:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const a=s("74ee"),i=s("7de1"),r=s("bd49");class l extends i.ResourceSchedule{constructor(){super()}createDataUnit(t,e,s=!1){r.DataUnitLock.lockStatus=207;let i=new r.TextureDataUnit;switch(i.lossTime=Date.now(),i.immediate=s,i.data=new r.TextureDataContainer,i.data.dataFormat=e,i.data.dataFormat){case a.DataFormat.Jpg:case a.DataFormat.Png:break;default:break}return i}initTask(t,e,s,a){}destroy(){super.destroy()}}e.TextureResourceSchedule=l},fae3:function(t,e,s){"use strict";s.r(e);s("1eb2");var a=s("a00a");for(var i in a)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return a[t]}))}(i)},fce7:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class a{}a.MAX_TASKS_TOTAL=1024,e.ThreadConfigure=a}})}));