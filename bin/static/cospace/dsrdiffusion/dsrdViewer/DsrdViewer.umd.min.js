(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["DsrdViewer"]=t():e["DsrdViewer"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(r,a,function(t){return e[t]}.bind(null,a));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="fae3")}({"033e":function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i("622b"),s=i("12c7"),n=r(i("2c06")),o=i("8f2d");class l{constructor(){this.m_rscene=null,this.m_imgViewEntity=null,this.m_imageAlpha=1,this.m_imageFakeAlpha=.2,this.m_imageVisible=!0,this.m_viewImageUrl="static/assets/modules/apple_01/mini.jpg",this.m_imgResLoader=new n.default,this.m_imgLoaded=!0,this.m_imgUrls=[],this.m_imgTex=null,this.m_imgTexDelay=0,this.m_rsceneCamVer=-10,this.m_material=null,this.debugDev=!0}initialize(e){e.updateCamera(),this.m_rscene=e,this.m_rsceneCamVer=this.m_rscene.getCamera().version;let t=30;this.m_rscene.addEventListener(a.MouseEvent.MOUSE_DOUBLE_CLICK,this,e=>{this.m_imageAlpha>this.m_imageFakeAlpha?this.setViewImageAlpha(this.m_imageFakeAlpha):this.setViewImageAlpha(1)}),this.m_rscene.addEventListener(a.EventBase.ENTER_FRAME,this,e=>{const i=this.m_rscene.getCamera();this.m_rsceneCamVer!=i.version&&(this.m_rsceneCamVer=i.version,this.setViewImageAlpha(this.m_imageFakeAlpha)),t>0&&(t--,t<1&&(t=30,this.m_imgLoaded&&this.m_imgUrls.length>0&&this.setViewImageUrl(this.m_imgUrls.shift()))),null!=this.m_imgTex&&this.m_imgTex.isGpuEnabled()&&this.m_imgTexDelay>0&&(this.m_imgTexDelay--,this.m_imgTexDelay<1&&(this.setViewImageAlpha(this.m_imageAlpha),this.m_imgTex=null))})}filterUrl(e){return e}setViewImageUrls(e){null!==e&&void 0!==e||(e=[]),this.m_imgUrls=e}setViewImageUrl(e,t=!1,i=1){""!=e&&(this.m_imageAlpha=i,null!=this.m_imgViewEntity?this.m_viewImageUrl!=e&&(this.m_imgLoaded?(this.m_viewImageUrl=e,this.m_imgLoaded=!1,this.m_imgResLoader.load(this.filterUrl(e),(e,t)=>{let i=this.m_rscene.textureBlock.createImageTex2D();i.flipY=!0,i.setDataFromImage(e),this.m_imgViewEntity.setTextureList([i]),this.m_imgViewEntity.updateMaterialToGpu(),this.m_imgLoaded=!0,this.m_imgTex=i,this.m_imgTexDelay=5})):this.m_imgUrls.push(e)):(this.m_viewImageUrl=e,this.initImgViewer()))}setViewImageFakeAlpha(e){this.m_imageFakeAlpha=e}setViewImageAlpha(e){this.m_imageAlpha=e,null!=this.m_material&&this.m_material.setAlpha(this.m_imageAlpha)}getViewImageAlpha(){return this.m_imageAlpha}setViewImageVisible(e){this.m_imageVisible=e,null!=this.m_imgViewEntity&&this.m_imgViewEntity.setVisible(e)}getViewImageVisible(){return this.m_imageVisible}initImgViewer(){null==this.m_imgViewEntity&&this.m_imgResLoader.load(this.filterUrl(this.m_viewImageUrl),(e,t)=>{let i=this.m_rscene.textureBlock.createImageTex2D();i.flipY=!0,i.setDataFromImage(e);let r=o.VoxMaterial.createDefaultMaterial(!1);r.fixAlignScreen=!0,r.setAlpha(this.m_imageAlpha),r.setTextureList([i]),r.initializeByCodeBuf(!0),this.m_material=r,this.m_imgViewEntity=s.VoxEntity.createFixScreenPlane(-1,-1,2,2,r,!0),this.m_imgViewEntity.setRenderState(a.RendererState.BACK_TRANSPARENT_ALWAYS_STATE),this.m_imgViewEntity.setVisible(this.m_imageVisible),this.m_rscene.addEntity(this.m_imgViewEntity,1)})}}t.DsrdImageViewer=l},"0b88":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("4e9d");t.CoGeomDataType=r.CoGeomDataType,t.CoDataFormat=r.CoDataFormat;const a=i("b096");class s{constructor(){this.m_loadedCall=null,this.m_loadedAllCall=null,this.m_loadTotal=0,this.m_loadedTotal=0,this.verTool=null}setListener(e,t){this.m_loadedCall=e,this.m_loadedAllCall=t}load(e,t=""){if(s.s_coapp.verTool=this.verTool,null!=e&&e.length>0){s.s_coapp.initialize(null,!0);let i=e.slice(0);s.s_coapp.deferredInit(()=>{for(let e=0;e<i.length;++e)this.loadModel(i[e],t)})}}loadWithType(e,t){if(s.s_coapp.verTool=this.verTool,null!=e&&e.length>0){s.s_coapp.initialize(null,!0);let i=e.slice(0);s.s_coapp.deferredInit(()=>{for(let e=0;e<i.length;++e)this.loadModel(i[e],t[e])})}}reset(){this.m_loadedTotal=0,this.m_loadTotal=0}loadModel(e,t=""){let i=t;if(""==t){let t=e.lastIndexOf(".")+1,r=e.lastIndexOf("?");i=r<0?e.slice(t):e.slice(t,r)}i=i.toLocaleLowerCase();let a=r.CoDataFormat.Undefined;switch(i){case"obj":a=r.CoDataFormat.OBJ;break;case"fbx":a=r.CoDataFormat.FBX;break;case"drc":a=r.CoDataFormat.Draco;break;case"ctm":a=r.CoDataFormat.CTM;break;default:break}a!=r.CoDataFormat.Undefined&&this.loadGeomModel(e,a)}loadGeomModel(e,t){let i=s.s_coapp;if(null!=i){let a=i.getCPUDataByUrlAndCallback(e,t,(e,i)=>{t!=r.CoDataFormat.FBX&&(this.loadedModels(e.data.models,e.data.transforms,t,e.url),this.m_loadTotal++,this.loadedModelFromUnit(e,i))},!0);t==r.CoDataFormat.FBX&&(a.data.modelReceiver=(e,i,r,s)=>{0==r&&this.m_loadTotal++,this.loadedModels(e,i,t,a.url),this.loadedModelFromUnit(a,0,r+1==s)})}}loadedModels(e,t,i,r){null!=this.m_loadedCall&&this.m_loadedCall(e,t,i,r)}loadedModelFromUnit(e,t=0,i=!0){if(i&&this.m_loadedTotal++,this.m_loadedTotal>=this.m_loadTotal){let t=this.m_loadedTotal;this.reset(),this.m_loadedAllCall(t,e.url)}}destroy(){this.m_loadedCall=null}}s.s_coapp=new a.CoDataModule,t.CoGeomModelLoader=s},"12c7":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("4d3f");class a{constructor(){this.m_init=!0}initialize(e=null,t=""){return this.m_init=!this.isEnabled(),!!this.m_init&&(this.m_init=!1,""!=t&&void 0!==t||(t="static/cospace/coentity/CoEntity.umd.min.js"),new r.ModuleLoader(1,()=>{null!=e&&this.isEnabled()&&e([t])}).load(t),!0)}isEnabled(){return"undefined"!==typeof CoEntity&&"undefined"!==typeof CoRScene}createDataMeshFromModel(e,t,i){return CoEntity.createDataMeshFromModel(e,t,i)}createDisplayEntityFromModel(e,t,i){return CoEntity.createDisplayEntityFromModel(e,t,i)}createLine(e,t,i=null){return CoEntity.createLine(e,t,i)}createFreeAxis3DEntity(e,t){return CoEntity.createFreeAxis3DEntity(e,t)}createAxis3DEntity(e){return CoEntity.createAxis3DEntity(e)}createDisplayEntityWithDataMesh(e,t,i){return CoEntity.createDisplayEntityWithDataMesh(e,t,i)}createDisplayEntity(){return CoEntity.createDisplayEntity()}createMouseEventEntity(){return CoEntity.createMouseEventEntity()}createBoundsEntity(){return CoEntity.createBoundsEntity()}createCrossAxis3DEntity(e){return CoEntity.createCrossAxis3DEntity(e)}createDisplayEntityContainer(){return CoEntity.createDisplayEntityContainer()}createFixScreenPlane(e=-1,t=-1,i=2,r=2,a=null,s=!1){return CoEntity.createFixScreenPlane(e,t,i,r,a,s)}createXOYPlane(e,t,i,r,a=null,s=!1){return CoEntity.createXOYPlane(e,t,i,r,a,s)}createXOZPlane(e,t,i,r,a=null,s=!1){return CoEntity.createXOZPlane(e,t,i,r,a,s)}createYOZPlane(e,t,i,r,a=null,s=!1){return CoEntity.createYOZPlane(e,t,i,r,a,s)}createCube(e,t=null,i=!1){return CoEntity.createCube(e,t,i)}createBox(e,t,i=null,r=!1){return CoEntity.createBox(e,t,i,r)}createSphere(e,t=20,i=20,r=null,a=!1,s=!1){return CoEntity.createSphere(e,t,i,r,a,s)}createCone(e,t,i=20,r=null,a=!1,s=-.5){return CoEntity.createCone(e,t,i,r,a,s)}createCylinder(e,t,i=20,r=null,a=!1,s=1,n=-.5){return CoEntity.createCylinder(e,t,i,r,a,s,n)}createTube(e,t,i=20,r=1,a=0,s=null,n=!1,o=1,l=-.5){return CoEntity.createTube(e,t,i,r,a,s,n,o,l)}createTorus(e,t,i=20,r=1,a=0,s=null,n=!1,o=1,l=-.5){return CoEntity.createTorus(e,t,i,r,a,s,n,o,l)}}const s=new a;t.VoxEntity=s},"15e2":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.modelName="",this.color=16777215,this.metallic=1,this.roughness=.1,this.uvScales=[1,1],this.normalStrength=1,this.specular=.5,this.act="update"}copyFromJsonObj(e){if(e){let i=this;for(var t in e)i[t]=e[t];e["uvScales"]&&(this.uvScales=e["uvScales"].slice())}}clone(){let e=new r,t=e,i=this;for(var a in i)t[a]=i[a];return e.uvScales=this.uvScales.slice(),e}}t.MaterialJsonNode=r},"1c7d":function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(i("d33d")),s=i("4d3f");class n{constructor(e){if(this.m_infoObj=null,this.m_verMap=new Map,this.forceFiltering=!1,null!=e){this.m_infoObj=e;const t=this.m_infoObj,i=this.m_verMap;let r=t.items;for(let e=0;e<r.length;++e){const t=r[e];if(i.set(t.name,t),t.type&&"dir"==t.type){let e=t.items;for(let t=0;t<e.length;++t){const r=e[t];i.set(r.name,r)}}}}}filterUrl(e){let t=e.indexOf("/dracoLib/")>0;if(t){let t=a.default.getFileNameAndSuffixName(e,!0);if(this.m_verMap.has(t)){let i=this.m_verMap.get(t);e+="?ver="+i.ver}}else{let t=a.default.getFileName(e,!0);if(this.m_verMap.has(t)){let i=this.m_verMap.get(t);e+="?ver="+i.ver}}return e}}function o(e,t){let i=e.lastIndexOf("/"),r=e.indexOf(".",i),a=e.slice(i,r);return e.indexOf(".umd.")>0?(a=a.toLocaleLowerCase(),e=t+e.slice(0,i)+a+".js"):e=t+e,e}t.CoModuleVersion=n;class l extends s.ModuleLoader{constructor(e,t=null,i=null){super(e,t,null),this.forceFiltering=!1;let r=e=>{if(e.indexOf(".artvily.")>0)return e;let t=window.location.href;return e=e.trim(),t.indexOf(".artvily.")>0||this.forceFiltering?(l.urlHostFilterEnabled&&(t=this.forceFiltering?a.default.getHostUrl("9090"):"http://www.artvily.com:9090/"),e=o(e,t),i&&(e=i.filterUrl(e)),e):(l.forceReleaseEnabled&&(e=o(e,"")),i&&(e=i.filterUrl(e)),e)};this.setUrlChecker(r)}}l.urlHostFilterEnabled=!0,l.forceReleaseEnabled=!1,t.CoModuleLoader=l},"1eb2":function(e,t,i){"use strict";if("undefined"!==typeof window){var r=window.document.currentScript,a=i("8875");r=a(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:a});var s=r&&r.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);s&&(i.p=s[1])}},2513:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("7c47");class a{constructor(){this.m_rscene=null,this.m_camera=null}initialize(e){null==this.m_rscene&&null!=e&&(this.m_rscene=e,this.m_camera=e.getCamera())}setCamProjectParam(e,t,i){if(this.m_rscene){let r=this.m_rscene.getCamera();r.perspectiveRH(Math.PI*e/180,r.getAspect(),t,i)}}updateCamera(){this.m_rscene&&this.m_rscene.updateCamera()}updateCameraWithF32Arr16(e,t=!0){16==e.length&&this.applyCamvs(e,t)}getCameraData(e=.01,t=!1){if(this.m_rscene){let i=this.m_rscene.getCamera(),r=i.getViewMatrix().clone();r.invert(),t&&r.transpose();let a=r.getLocalFS32().slice(0);return a[3]*=e,a[7]*=e,a[11]*=e,a}return null}applyCamvs(e,t){null==e&&(e=[.7071067690849304,-.40824827551841736,.5773502588272095,2.390000104904175,.7071067690849304,.40824827551841736,-.5773502588272095,-2.390000104904175,0,.8164965510368347,.5773502588272095,2.390000104904175,0,0,0,1]);let i=r.VoxMath.createMat4(new Float32Array(e));i.transpose();let a=i.getLocalFS32(),s=0;s=4;let n=r.VoxMath.createVec3(a[s],a[s+1],a[s+2],a[s+3]);s=12;let o=r.VoxMath.createVec3(a[s],a[s+1],a[s+2]),l=this.m_rscene.getCamera();if(o.getLength()>.001){let e=o.clone().scaleBy(100);l.lookAtRH(e,r.VoxMath.createVec3(),n),t&&l.update()}}}t.CameraView=a},"2c06":function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(i("d33d"));class s{constructor(){this.m_listeners=[],this.url="",this.img=null,this.loaded=!1}addListener(e){let t=this.m_listeners,i=0;for(;i<t.length;++i)if(t[i]==e)break;i>=t.length&&t.push(e)}removeListener(e){let t=this.m_listeners;for(let i=0;i<t.length;++i)if(t[i]==e){t.splice(i,1);break}}dispatch(){if(this.loaded){let e=this.m_listeners;this.m_listeners=[];for(let t=0;t<e.length;++t)e[t](this.img,this.url)}}}class n{constructor(){this.m_map=new Map}load(e,t){if(""!=e){let i=e,r=this.m_map;if(e=""!=e?e:"static/assets/box.jpg",e=a.default.filterUrl(e),r.has(i)){let i=r.get(e);i.loaded?t(i.img,i.url):i.addListener(t)}let n=new Image,o=new s;o.img=n,o.url=i,o.addListener(t),r.set(i,o);const l=new XMLHttpRequest;l.open("GET",e,!0),l.responseType="blob",l.onload=e=>{n.onload=e=>{o.loaded=!0,o.dispatch()};let t=window;n.src=(t.URL||t.webkitURL).createObjectURL(l.response)},l.onerror=e=>{},l.send(null)}}}t.default=n},"2dfe":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.m_absorb=!1}filterScale(e){return Math.abs(e)<1?e<0?e=-1:e>0&&(e=1):e=Math.floor(e),e}setAbsorbing(e){this.m_absorb=e}ctrlValueFilter(e,t){if(this.m_absorb)switch(e){case 0:t.x=10*Math.round(t.x/10),t.y=10*Math.round(t.y/10),t.z=10*Math.round(t.z/10);break;case 1:t.x=this.filterScale(t.x),t.y=this.filterScale(t.y),t.z=this.filterScale(t.z);break;case 2:t.x=5*Math.round(t.x/5),t.y=5*Math.round(t.y/5),t.z=5*Math.round(t.z/5);break;default:break}}}t.VecValueFilter=r},3444:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{}r.EDIT_BEGIN=20001,r.EDIT_END=20002,t.UserEditEvent=r},3612:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},"3b42":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4312:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.m_scaleV=null,this.m_tempMat=null,this.m_currMat=null,this.m_aabb=null,this.m_sizeScale=1,this.m_entities=[],this.m_transforms=[],this.locationEnabled=!0,this.rotationEnabled=!1}initialize(){null==this.m_scaleV&&(this.m_scaleV=CoMath.createVec3(),this.m_tempMat=CoMath.createMat4(),this.m_currMat=CoMath.createMat4(),this.m_aabb=CoMath.createAABB())}getAABB(){return this.m_aabb}layoutReset(){this.m_sizeScale=1,this.m_scaleV=null,this.initialize(),this.m_entities=[],this.m_transforms=[]}getEntities(){return this.m_entities}layoutAppendItem(e,t){this.m_entities.push(e),this.m_transforms.push(t)}layoutUpdate(e=300,t=null,i=!1){this.rotationEnabled=i;for(let r=0;r<this.m_entities.length;++r){let e=this.m_entities[r];e.setXYZ(0,0,0),e.setScaleXYZ(1,1,1),e.setRotationXYZ(0,0,0)}null==t&&(t=CoMath.createVec3()),this.fixToPosition(this.m_entities,this.m_transforms,t,e)}calcAABB(e,t){this.initialize();let i=this.m_aabb;for(let r=0;r<e.length;++r)e[r].update(),r>0?i.union(e[r].getGlobalBounds()):i.copyFrom(e[r].getGlobalBounds());return i.update(),i}fixToPosition(e,t,i,r=300){this.initialize();let a,s=this.m_tempMat,n=this.m_currMat,o=this.m_aabb;for(let u=0;u<e.length;++u)a=t[u],s.identity(),this.rotationEnabled&&s.setRotationEulerAngle(.5*Math.PI,0,0),null!=a?(n.copyFrom(a),n.append(s),e[u].getTransform().setParentMatrix(n)):(n.copyFrom(s),e[u].getTransform().setParentMatrix(n)),e[u].update(),u>0?o.union(e[u].getGlobalBounds()):o.copyFrom(e[u].getGlobalBounds());o.update();let l=r/o.getWidth(),c=r/o.getHeight(),d=r/o.getLong();l=Math.min(l,c,d),this.m_sizeScale=l,this.m_scaleV.setXYZ(l,l,l),o.reset();for(let u=0;u<e.length;++u){a=t[u],s.identity(),s.setScale(this.m_scaleV),this.rotationEnabled&&s.setRotationEulerAngle(.5*Math.PI,0,0),null!=a?(n.copyFrom(a),n.append(s)):n.copyFrom(s);let i=n.decompose(CoMath.OrientationType.EULER_ANGLES);e[u].setScale3(i[2]),e[u].setRotation3(i[1]),e[u].setPosition(i[0]),e[u].getTransform().setParentMatrix(null),e[u].update(),u>0?o.union(e[u].getGlobalBounds()):o.copyFrom(e[u].getGlobalBounds())}if(o.update(),this.locationEnabled){let t=CoMath.createVec3();t.subVecsTo(i,o.center),o.reset();for(let i=0;i<e.length;++i){let r=e[i].getPosition();r.addBy(t),e[i].setPosition(r),e[i].update(),i>0?o.union(e[i].getGlobalBounds()):o.copyFrom(e[i].getGlobalBounds())}o.update()}}getSizeScale(){return this.m_sizeScale}}t.CoEntityLayouter2=r},4604:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t=null,i=null){this.m_uid=r.s_uid++,this.m_urlChecker=null,this.m_oneTimes=!0,this.m_loaderMap=null,this.m_callback=t,this.m_times=e,this.m_urlChecker=i}setUrlChecker(e=null){return this.m_urlChecker=e,this}getUrlChecker(){return this.m_urlChecker}getUid(){return this.m_uid}setCallback(e){return this.m_callback=e,this}addLoader(e){if(null!=e&&e!=this)if(this.isFinished())e.use();else{null==this.m_loaderMap&&(this.m_loaderMap=new Map);let t=this.m_loaderMap;t.has(e.getUid())||t.set(e.getUid(),e)}return this}isFinished(){return 0==this.m_times}useOnce(){this.m_oneTimes&&(this.m_oneTimes=!1,this.use())}use(){if(this.m_times>0&&(this.m_times--,this.isFinished()&&null!=this.m_callback&&(this.m_callback(),this.m_callback=null,null!=this.m_loaderMap))){for(let[e,t]of this.m_loaderMap)t.use();this.m_loaderMap=null}}hasModuleByUrl(e){return r.loadedMap.has(e)}load(e){if(""==e)return this;null!=this.m_urlChecker&&(e=this.m_urlChecker(e));let t=r.loadedMap;if(t.has(e))return void this.use();let i=r.loadingMap;if(!i.has(e))return i.set(e,[this]),this.loadData(e),this;{let t=i.get(e);for(let e=0;e<t.length;++e)if(t[e]==this)return;t.push(this)}}loadData(e){let t=new XMLHttpRequest;t.open("GET",e,!0),t.onerror=function(e){},t.onload=t=>{this.loadedUrl(e)},t.send(null)}loadedData(e,t){}loadedUrl(e){let t=r.loadedMap,i=r.loadingMap;t.set(e,1);let a=i.get(e);for(let r=0;r<a.length;++r)a[r].use();i.delete(e)}getDataByUrl(e){return null}clearAllData(){}destroy(){this.m_urlChecker=null}}r.s_uid=0,r.loadedMap=new Map,r.loadingMap=new Map,t.PackedLoader=r},"4d3f":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("4604");class a extends r.PackedLoader{constructor(e,t=null,i=null){super(e,t,i)}loadData(e){let t=new XMLHttpRequest;t.open("GET",e,!0),t.onerror=function(e){},t.onload=i=>{this.loadedData(t.response,e),this.loadedUrl(e)},t.send(null)}loadedData(e,t){let i=document.createElement("script");i.onerror=e=>{},i.type="text/javascript";try{i.innerHTML=e,document.head.appendChild(i)}catch(r){throw r}}}t.ModuleLoader=a},"4e9d":function(e,t,i){"use strict";var r,a,s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e["ctmParser"]="ctmGeomParser",e["objParser"]="objGeomParser",e["dracoParser"]="dracoGeomParser",e["pngParser"]="pngParser",e["fbxFastParser"]="fbxFastParser",e["threadCore"]="threadCore",e["coSpaceApp"]="coSpaceApp"}(r||(r={})),t.CoModuleNS=r,function(e){e["Undefined"]="undefined-format",e["CTM"]="ctm",e["Draco"]="draco",e["OBJ"]="obj",e["FBX"]="fbx",e["GLB"]="glb",e["Jpg"]="jpg",e["Png"]="png",e["Gif"]="gif"}(a||(a={})),t.CoDataFormat=a,function(e){e["JS"]="js-text",e["Binasy"]="binary"}(s||(s={})),t.CoModuleFileType=s},"521d":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.crossOrigin="anonymous"}setCrossOrigin(e){this.crossOrigin=e}async load(e,t,i=null,r=null,a="blob",s=""){if(null==t)throw Error("onload == null !!!");const n=new FileReader;n.onload=i=>{t&&t(n.result,e)};const o=new XMLHttpRequest;o.open("GET",e,!0),""!=s&&o.setRequestHeader("Range",s),o.responseType=a,o.onload=i=>{if(o.status<=206)switch(a){case"arraybuffer":case"blob":n.readAsArrayBuffer(o.response);break;case"json":t&&t(o.response,e);break;case"text":t&&t(o.response,e);break;default:t&&t(o.response,e);break}else r&&r(o.status,e)},null!=i&&(o.onprogress=t=>{let r=0;if(t.total>0||t.lengthComputable)r=Math.min(1,t.loaded/t.total);else{let e=parseInt(o.getResponseHeader("content-length"));e>0&&(e*=4,r=Math.min(1,t.loaded/e))}i(r,e)}),null!=r&&(o.onerror=t=>{r(o.status,e)}),o.send(null)}}t.HttpFileLoader=r},"622b":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("4d3f"),a=i("c77c");var s=null;t.RendererDevice=s;var n=null;t.SelectionEvent=n;var o=null;t.ProgressDataEvent=o;var l=null;t.MouseEvent=l;var c=null;t.EventBase=c;var d=null;t.RendererState=d;var u=null;t.TextureConst=u;var h=null;t.Keyboard=h;var m=null;t.KeyboardEvent=m;var p=null;t.RenderDrawMode=p;var _=null;t.CullFaceMode=_;var M=null;t.DepthTestMode=M;var f=null;t.RenderBlendMode=f;var C=null;t.GLStencilFunc=C;var g=null;t.GLStencilOp=g;var b=null;t.GLBlendMode=b;var y=null;t.GLBlendEquation=y;class E{constructor(){this.m_init=!0}init(){const e=CoRScene,i=CoRenderer;"undefined"!==typeof e&&(t.RendererDevice=s=e.RendererDevice,t.SelectionEvent=n=e.SelectionEvent,t.ProgressDataEvent=o=e.ProgressDataEvent,t.EventBase=c=e.EventBase,t.MouseEvent=l=e.MouseEvent,t.RendererState=d=e.RendererState,t.TextureConst=u=e.TextureConst,t.Keyboard=h=e.Keyboard,t.KeyboardEvent=m=e.KeyboardEvent,t.RenderDrawMode=p=i.RenderDrawMode,t.CullFaceMode=_=i.CullFaceMode,t.DepthTestMode=M=i.DepthTestMode,t.RenderBlendMode=f=i.RenderBlendMode,t.GLStencilFunc=C=i.GLStencilFunc,t.GLStencilOp=g=i.GLStencilOp,t.GLBlendMode=b=i.GLBlendMode,t.GLBlendEquation=y=i.GLBlendEquation)}initialize(e=null,t=""){if(this.m_init=!this.isEnabled(),this.m_init||(a.VoxRenderer.initialize(),this.init()),this.m_init){this.m_init=!1;let i=!1,s=0,n="";return i=a.VoxRenderer.initialize(i=>{n=i[0],s++,s>1&&null!=e&&this.isEnabled()&&e([n,t])}),""!=t&&void 0!==t||(t="static/cospace/engine/rscene/CoRScene.umd.min.js"),new r.ModuleLoader(1,()=>{a.VoxRenderer.initialize(),this.init(),i?(s++,s>1&&null!=e&&this.isEnabled()&&e([n,t])):null!=e&&"undefined"!==typeof CoRScene&&e([t])}).load(t),!0}return!1}get RendererDevice(){return CoRScene.RendererDevice}get RendererState(){return CoRScene.RendererState}get RenderDrawMode(){return CoRScene.RenderDrawMode}get VtxBufConst(){return CoRScene.VtxBufConst}get TextureConst(){return CoRScene.TextureConst}get Vector3D(){return CoRScene.Vector3D}get MouseEvent(){return CoRScene.MouseEvent}get EventBase(){return CoRScene.EventBase}get SelectionEvent(){return CoRScene.SelectionEvent}get ProgressDataEvent(){return CoRScene.ProgressDataEvent}get KeyboardEvent(){return CoRScene.KeyboardEvent}get Keyboard(){return CoRScene.Keyboard}get ShaderCodeUUID(){return CoRScene.ShaderCodeUUID}get MaterialContextParam(){return CoRScene.MaterialContextParam}get MaterialPipeType(){return CoRScene.MaterialPipeType}createSelectionEvent(){return CoRScene.createSelectionEvent()}createProgressDataEvent(){return CoRScene.createProgressDataEvent()}createVec3(e,t,i,r){return CoRScene.createVec3(e,t,i,r)}createMat4(e,t){return CoRScene.createMat4(e,t)}createColor4(e,t,i,r){return CoRScene.createColor4(e,t,i,r)}createAABB(){return CoRScene.createAABB()}applySceneBlock(e){return CoRScene.applySceneBlock(e)}createRendererSceneParam(e){return CoRScene.createRendererSceneParam(e)}createRendererScene(e,t,i){return CoRScene.createRendererScene(e,t,i)}setRendererScene(e){return CoRScene.setRendererScene(e)}getRendererScene(){return CoRScene.getRendererScene()}createMouseEvt3DDispatcher(){return CoRScene.createMouseEvt3DDispatcher()}createEventBaseDispatcher(){return CoRScene.createEventBaseDispatcher()}createVtxDrawingInfo(){return CoRScene.createVtxDrawingInfo()}createDefaultMaterial(e){return CoRScene.createDefaultMaterial(e)}createLineMaterial(e){return CoRScene.createLineMaterial(e)}createQuadLineMaterial(e){return CoRScene.createQuadLineMaterial(e)}createShaderMaterial(e){return CoRScene.createShaderMaterial(e)}createMaterial(e){return CoRScene.createMaterial(e)}createDataMesh(){return CoRScene.createDataMesh()}createRawMesh(){return CoRScene.createRawMesh()}createBoundsMesh(){return CoRScene.createBoundsMesh()}createDataMeshFromModel(e,t,i){return CoRScene.createDataMeshFromModel(e,t,i)}createDisplayEntityFromModel(e,t,i){return CoRScene.createDisplayEntityFromModel(e,t,i)}createFreeAxis3DEntity(e,t,i){return CoRScene.createFreeAxis3DEntity(e,t,i)}createAxis3DEntity(e,t){return CoRScene.createAxis3DEntity(e,t)}createCrossAxis3DEntity(e,t){return CoRScene.createCrossAxis3DEntity(e,t)}createDisplayEntityWithDataMesh(e,t,i){return CoRScene.createDisplayEntityWithDataMesh(e,t,i)}createDisplayEntity(e){return CoRScene.createDisplayEntity(e)}createMouseEventEntity(e){return CoRScene.createMouseEventEntity(e)}createBoundsEntity(e){return CoRScene.createBoundsEntity(e)}createDisplayEntityContainer(){return CoRScene.createDisplayEntityContainer()}creatMaterialContextParam(){return CoRScene.creatMaterialContextParam()}createMaterialContext(){return CoRScene.createMaterialContext()}VerticalCCWOnXOY(e){return CoRScene.VerticalCCWOnXOY(e)}VerticalCWOnXOY(e){return CoRScene.VerticalCWOnXOY(e)}createRendererSceneGraph(){return CoRScene.createRendererSceneGraph()}createEvtNode(){return CoRScene.createEvtNode()}isEnabled(){return a.VoxRenderer.isEnabled()&&"undefined"!==typeof CoRScene}}const v=new E;t.VoxRScene=v},"6ee3":function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i("7596"),s=i("622b"),n=i("7c47"),o=i("12c7"),l=i("a811"),c=r(i("d33d")),d=i("a0ee"),u=i("7750"),h=i("033e"),m=i("1c7d"),p=i("2513");class _ extends u.DsrdViewerBase{constructor(){super(),this.m_viewDiv=null,this.m_initCallback=null,this.m_zAxisUp=!1,this.m_debugDev=!1,this.imgViewer=new h.DsrdImageViewer,this.camView=new p.CameraView,this.m_loadingCallback=null,this.m_modelDataUrl="",this.m_baseSize=200,this.m_forceRot90=!1}initialize(e=null,t=null,i=!1,r=!1,a=!1){document.oncontextmenu=function(e){e.preventDefault()},m.CoModuleLoader.forceReleaseEnabled=a,this.m_viewDiv=e,this.m_initCallback=t,this.m_zAxisUp=i,this.m_debugDev=r,this.loadInfo()}keyDownDoes(e){return!0}initRenderer(){let e=s.RendererDevice;e.SHADERCODE_TRACE_ENABLED=!1,e.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0;let t=this.m_graph=s.VoxRScene.createRendererSceneGraph(),i=512,r=512,n=this.m_zAxisUp,o=this.m_viewDiv,l=window.devicePixelRatio,c=t.createRendererSceneParam(o||this.createDiv(0,0,i/l,r/l));c.autoSyncRenderBufferAndWindowSize=!1,c.syncBgColor=!1,c.setCamProject(45,10,2e3),c.setCamPosition(239,-239,239),n||null==o?c.setCamUpDirect(0,0,1):c.setCamUpDirect(0,1,0),c.setAttriAntialias(!0),this.m_rscene=t.createScene(c),this.m_rscene.enableMouseEvent(!0),s.VoxRScene.setRendererScene(this.m_rscene);let u=this.m_rscene.createSubScene(c,3,!1);u.enableMouseEvent(!0),u.setAccessor(new d.SceneAccessor),this.m_edit3DUIRScene=u,t.addScene(this.m_edit3DUIRScene),this.m_outline=new a.PostOutline(this.m_rscene,this.m_verTool),this.imgViewer.initialize(this.m_rscene),this.camView.initialize(this.m_rscene),this.init3DScene(),this.m_initCallback&&this.m_initCallback()}init3DScene(){this.m_modelTexUrl="static/assets/white.jpg",null==this.m_entityContainer&&(this.m_entityContainer=o.VoxEntity.createDisplayEntityContainer(),this.m_rscene.addEntity(this.m_entityContainer));let e=this.m_debugDev,t=this.m_viewDiv;if(this.m_layouter.locationEnabled=!1,this.m_debugDev=e,t&&!e);else{this.m_debugDev=!0,this.m_teamLoader=new l.CoModelTeamLoader,this.initModels();let e=["static/assets/modules/apple_01/mini.jpg","static/assets/box.jpg"];this.imgViewer.setViewImageUrl(e[0],!0)}}initModels(){this.m_forceRot90=!0;let e=[],t=[];for(let i=0;i<2;++i){let r="static/assets/modules/apple_01/export_"+i+".drc";e.push(r),t.push("drc")}this.initSceneByUrls(e,t,e=>{},200)}initSceneByUrls(e,t,i,r=200){this.m_baseSize=r,this.m_loadingCallback=i;let a=this.m_teamLoader;a.loadWithTypes(e,t,(i,r)=>{this.m_modelDataUrl=e[0]+"."+t[0];for(let e=0;e<i.length;++e){let t=new u.ModelData;t.url=i[e].url,t.models=i,t.transforms=r,this.m_models.push(t)}this.initModelScene()})}initModelScene(){if(this.m_models.length>0&&this.m_materialEanbled){this.m_layouter.layoutReset();for(let e=0;e<this.m_models.length;++e){let t=this.m_models[e],i=t.models,r=t.transforms;this.createEntity(i[e],null!=r?r[e]:null,t.url)}this.fitEntitiesSize(),this.m_loadingCallback&&this.m_loadingCallback(1)}}setForceRotate90(e){this.m_forceRot90=e}fitEntitiesSize(e=!1){e=e||this.m_forceRot90,this.m_layouter.layoutUpdate(this.m_baseSize,n.VoxMath.createVec3());let t=this.m_entityContainer,i=c.default.getFileSuffixName(this.m_modelDataUrl,!0,!0);switch(i){case"obj":t.setRotationXYZ(90,0,0);break;default:e&&t.setRotationXYZ(90,0,0);break}t.update()}}t.DsrdViewer=_},"702c":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("ea2a"),a=i("521d");class s{constructor(){this.m_effect=null,this.m_preLoadMaps=!0,this.m_loadSpecularData=!0,this.m_specEnvMapBuf=null,this.m_specEnvMap=null,this.m_loadSpecCallback=null,this.m_hdrBrnEnabled=!0,this.preloadMaps=!0,this.envMapUrl="",this.hdrBrnEnabled=!0}initialize(e){this.m_materialData=e,e&&e.pbr&&(this.m_texData=e.pbr.map)}preload(e){null==this.m_loadSpecCallback&&null!=e&&(this.loadSpecularData(this.hdrBrnEnabled),this.m_loadSpecCallback=e)}active(e,t,i){this.m_materialCtx=t,null==this.m_effect&&(this.m_rscene=e,this.m_effect=PBREffect.create(),this.m_effect.initialize(this.m_rscene)),this.preloadMap()}loadSpecularData(e){if(this.m_loadSpecularData){this.m_hdrBrnEnabled=e;let t=this.envMapUrl;this.m_texData&&(t=this.m_texData.envBrnMap,e&&(t=this.m_texData.envBrnMap)),(new a.HttpFileLoader).load(t,(e,t)=>{this.m_specEnvMapBuf=e,null!=this.m_effect&&(this.m_specEnvMap=this.m_effect.createSpecularTex(this.m_specEnvMapBuf,!0,this.m_specEnvMap)),null!=this.m_loadSpecCallback&&(this.m_loadSpecCallback(),this.m_loadSpecCallback=null)}),this.m_loadSpecularData=!1}}preloadMap(){if(this.m_preLoadMaps){let e=this.m_texData;this.preloadMaps&&e&&(void 0!==e.diffuseMap&&this.m_materialCtx.getTextureByUrl(e.diffuseMap),void 0!==e.normalMap&&this.m_materialCtx.getTextureByUrl(e.normalMap),void 0!==e.armMap&&this.m_materialCtx.getTextureByUrl(e.armMap),void 0!==e.displacementMap&&this.m_materialCtx.getTextureByUrl(e.displacementMap)),this.m_preLoadMaps=!1}}getUUID(){return r.ShaderCodeUUID.PBR}isEnabled(){const e=this.m_materialCtx;let t=null!=e&&e.hasShaderCodeObjectWithUUID(this.getUUID());return t}createMaterial(e,t=null,i=null){if(null==this.m_specEnvMap){if(null==this.m_specEnvMapBuf)throw Error("this.m_specEnvMapBuf is null !!!");this.m_specEnvMap=this.m_effect.createSpecularTex(this.m_specEnvMapBuf,!0,this.m_specEnvMap),this.m_specEnvMap.__$attachThis()}let r;t?r=t:this.m_materialData.pbr&&(r=this.m_materialData.pbr.defaultParam);const a=this.m_materialCtx;i=null==i?this.m_texData:i;let s={envMap:void 0!==r.specEnvMap?r.specEnvMap:this.m_specEnvMap,diffuseMap:i&&void 0!==i.diffuseMap?a.getTextureByUrl(i.diffuseMap):null,normalMap:i&&void 0!==i.normalMap?a.getTextureByUrl(i.normalMap):null,armMap:i&&void 0!==i.armMap?a.getTextureByUrl(i.armMap):null,displacementMap:i&&void 0!==i.displacementMap?a.getTextureByUrl(i.displacementMap):null,parallaxMap:i&&void 0!==i.parallaxMap?a.getTextureByUrl(i.parallaxMap):null,aoMap:null},n=this.m_effect.createMaterial(),o=n.getDecorator(),l=o.vertUniform;r.pipeline&&n.setMaterialPipeline(a.pipeline),void 0!==r.scatterEnabled&&(o.scatterEnabled=r.scatterEnabled),void 0!==r.woolEnabled&&(o.woolEnabled=r.woolEnabled),void 0!==r.absorbEnabled&&(o.absorbEnabled=r.absorbEnabled),void 0!==r.normalNoiseEnabled&&(o.normalNoiseEnabled=r.normalNoiseEnabled),o.hdrBrnEnabled=this.m_hdrBrnEnabled,void 0!==r.metallic&&o.setMetallic(r.metallic),void 0!==r.roughness&&o.setRoughness(r.roughness),void 0!==r.ao&&o.setAO(r.ao),void 0!==r.shadowReceiveEnabled&&(o.shadowReceiveEnabled=r.shadowReceiveEnabled&&e&&null!=a.vsmModule),void 0!==r.pipeline&&r.pipeline&&(o.fogEnabled=a.envLightModule&&r.fogEnabled),o.specularEnvMap=s.envMap,o.armMap=s.armMap,o.diffuseMap=s.diffuseMap,o.normalMap=s.normalMap,o.aoMap=s.aoMap,o.parallaxMap=s.parallaxMap,l.displacementMap=s.displacementMap,o.initialize(),l.initialize();let c=r.displacementParams;return void 0!==c&&l.setDisplacementParams(c[0],c[1]),c=r.uvScales,void 0!==c&&l.setUVScale(c[0],c[1]),c=r.albedoColor,void 0!==c&&o.setAlbedoColor(c[0],c[1],c[2]),c=r.parallaxParams,void 0!==c&&o.setParallaxParams(c[0],c[1],c[2],c[3]),void 0!==r.sideIntensity&&o.setSideIntensity(r.sideIntensity),void 0!==r.toneMapingExposure&&o.setToneMapingExposure(r.toneMapingExposure),void 0!==r.scatterIntensity&&o.setScatterIntensity(r.scatterIntensity),n}destroy(){this.m_rscene=null,null!=this.m_effect&&(this.m_effect.destroy(),this.m_effect=null),this.m_materialCtx=null,this.m_materialData=null,this.m_texData=null,null!=this.m_specEnvMap&&(this.m_specEnvMap.__$detachThis(),this.m_specEnvMap=null)}}t.PBRModule=s},7596:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("1c7d");class a{constructor(e,t=null){this.m_rscene=e;let i="static/cospace/renderEffect/occPostOutline/OccPostOutlineModule.umd.js";new r.CoModuleLoader(1,null,t).setCallback(()=>{this.m_postOutline=OccPostOutlineModule.create(),this.initOutline(),this.m_rscene.appendRenderNode(this)}).load(i)}initOutline(){this.m_postOutline.initialize(this.m_rscene,0,[0]),this.m_postOutline.setFBOSizeScaleRatio(.5),this.m_postOutline.setRGB3f(0,1,0),this.m_postOutline.setOutlineDensity(2),this.m_postOutline.setOcclusionDensity(.2)}select(e){null!=this.m_postOutline&&this.m_postOutline.setTargetList(e)}deselect(){null!=this.m_postOutline&&this.m_postOutline.setTargetList(null)}render(){null!=this.m_postOutline&&(this.m_postOutline.drawBegin(),this.m_postOutline.draw(),this.m_postOutline.drawEnd())}}t.PostOutline=a},7750:function(e,t,i){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i("1c7d"),s=i("3444"),n=i("622b"),o=i("e096"),l=i("f189"),c=i("8f2d"),d=i("7c47"),u=i("9a9d"),h=i("a811"),m=r(i("d33d")),p=i("521d"),_=i("2dfe"),M=i("4312"),f=i("cc0e"),C=i("e175"),g=i("a0f6");class b{constructor(){}}t.ModelData=b;class y{constructor(){this.m_verTool=null,this.m_teamLoader=new h.CoModelTeamLoader,this.m_edit3DUIRScene=null,this.m_materialEanbled=!1,this.m_scData=null,this.m_models=[],this.modelScene=new f.ModelScene,this.pbrCtx=new C.PBRMaterialCtx,this.m_graph=null,this.m_rscene=null,this.m_uiScene=null,this.m_mi=null,this.m_posV0=null,this.m_posV1=null,this.m_transCtr=null,this.m_selectFrame=null,this.m_valueFilter=new _.VecValueFilter,this.m_map=new Map,this.m_layouter=new M.CoEntityLayouter2,this.m_entityQuery=null,this.m_entities=[],this.m_modelTexUrl=""}loadInfo(){let e="static/cospace/info.json";e=m.default.filterUrl(e);let t=new p.HttpFileLoader;t.load(e,(e,t)=>{this.m_verTool=new a.CoModuleVersion(e),this.initEngineModule()},null,null,"json")}initEngineModule(){let e="static/cospace/engine/uiInteract/CoUIInteraction.umd.js",t=new a.CoModuleLoader(2,()=>{},this.m_verTool),i="static/cospace/engine/renderer/CoRenderer.umd.js",r="static/cospace/engine/rscene/CoRScene.umd.js",s="static/cospace/math/CoMath.umd.js",o="static/cospace/ageom/CoAGeom.umd.js",l="static/cospace/comesh/CoMesh.umd.js",c="static/cospace/coentity/CoEntity.umd.js",h="static/cospace/particle/CoParticle.umd.js",m="static/cospace/coMaterial/CoMaterial.umd.js",p=" static/cospace/cotexture/CoTexture.umd.js",_="static/cospace/ui/Lib_VoxUI.umd.js",M="static/cospace/modelEdit/Lib_VoxModelEdit.umd.js";new a.CoModuleLoader(2,()=>{n.VoxRScene.isEnabled()&&new a.CoModuleLoader(3,()=>{new a.CoModuleLoader(6,()=>{n.VoxRScene.initialize(),d.VoxMath.initialize(),u.VoxModelEdit.initialize(),this.initRenderer(),this.modelScene.__$init(),this.initMouseInteract(),this.createEditEntity(),this.initUIScene();let e="static/assets/scene/dsrdCfg02.json",t=new g.TextPackedLoader(1,()=>{this.m_scData=JSON.parse(t.getDataByUrl(e)),this.pbrCtx.pbrModule.envMapUrl="static/bytes/spb.bin",this.pbrCtx.pbrModule.preloadMaps=!1,this.pbrCtx.initialize(this.m_rscene,this.m_scData.material,()=>{this.m_materialEanbled=!0,this.initModelScene()})}).load(e)},this.m_verTool).load(o).load(c).load(h).load(p).load(_).load(M)},this.m_verTool).load(s).load(l).load(m)},this.m_verTool).addLoader(t).load(i).load(r),t.load(e)}initModelScene(){if(this.m_models.length>0&&this.m_materialEanbled){this.m_layouter.layoutReset();for(let e=0;e<this.m_models.length;++e){let t=this.m_models[e],i=t.models,r=t.transforms;this.createEntity(i[e],null!=r?r[e]:null,t.url)}this.m_layouter.layoutUpdate(200)}}initMouseInteract(){const e=o.VoxUIInteraction.createMouseInteraction();e.initialize(this.m_rscene,0).setAutoRunning(!0,1),this.m_mi=e,this.m_posV0=d.VoxMath.createVec3(),this.m_posV1=d.VoxMath.createVec3()}createDiv(e,t,i,r){let a=document.createElement("div");return a.style.width=i+"px",a.style.height=r+"px",document.body.appendChild(a),a.style.display="bolck",a.style.left=e+"px",a.style.top=t+"px",a.style.position="absolute",a.style.display="bolck",a.style.position="absolute",a}initRenderer(){}initUIScene(){let e=this.m_uiScene=l.VoxUI.createUIScene(this.m_graph);e.texAtlasNearestFilter=!0,e.rscene.addEventListener(n.MouseEvent.MOUSE_BG_DOWN,this,this.uiMouseDownListener),e.rscene.addEventListener(n.MouseEvent.MOUSE_UP,this,this.uiMouseUpListener),e.rscene.addEventListener(n.MouseEvent.MOUSE_MOVE,this,this.uiMouseMoveListener),this.initUIEntities(),this.m_entityQuery=u.VoxModelEdit.createRectFrameQuery(),this.m_entityQuery.initialize(this.m_rscene),null==this.m_selectFrame&&(this.m_selectFrame=u.VoxModelEdit.createUIRectLine(),this.m_selectFrame.initialize(e.rscene),this.m_selectFrame.enable());let t=this.m_rscene;t.addEventListener(n.KeyboardEvent.KEY_DOWN,this,this.keyDown),t.addEventListener(n.MouseEvent.MOUSE_BG_CLICK,this,this.mouseBGClickListener),t.addEventListener(n.MouseEvent.MOUSE_UP,this,this.mouseUpListener,!0,!0)}createBtn(e,t,i,r,a){let s=c.VoxMaterial.createColor4(1,1,1,1),o=l.VoxUI.createTextLabelButton(e,t,100,50,s);return o.setXY(i,r),this.m_uiScene.addEntity(o),o.addEventListener(n.MouseEvent.MOUSE_UP,this,this.btnMouseUpListener),a.addButton(o),o}createSelectBtn(e,t,i,r,a,s,o){let c=l.VoxUI.createSelectionEntity();c.uuid=r;let d=[4284333731,4281578057,4284144565,4281578057];return c.setBGColorsWithARGBUint32(d),c.initialize(this.m_uiScene,i,a,s,30),c.addEventListener(n.SelectionEvent.SELECT,this,this.selectChange),o?c.select(!1):c.deselect(!1),c.setXY(e,t),this.m_uiScene.addEntity(c),c}selectChange(e){this.m_valueFilter.setAbsorbing(e.flag)}initUIEntities(){this.m_btnGroup0=l.VoxUI.createSelectButtonGroup(),this.m_btnGroup1=l.VoxUI.createSelectButtonGroup(),this.m_btnGroup2=l.VoxUI.createSelectButtonGroup()}createEditEntity(){let e=this.m_edit3DUIRScene;this.m_transCtr=u.VoxModelEdit.createTransformController();const t=this.m_transCtr;t.initialize(e),t.addEventListener(s.UserEditEvent.EDIT_BEGIN,this,this.trans3DEditBegin),t.addEventListener(s.UserEditEvent.EDIT_END,this,this.trans3DEditEnd),this.m_transCtr.setCtrlValueFilter(this.m_valueFilter),this.m_prevPos=d.VoxMath.createVec3(),this.m_currPos=d.VoxMath.createVec3(),this.m_keyInterac=o.VoxUIInteraction.createKeyboardInteraction();const i=this.m_keyInterac;i.initialize(this.m_rscene);let r=n.Keyboard,a=i.createKeysEventType([r.CTRL,r.Y]);i.addKeysDownListener(a,this,this.keyCtrlYDown),a=i.createKeysEventType([r.CTRL,r.Z]),i.addKeysDownListener(a,this,this.keyCtrlZDown),this.m_recoder=u.VoxModelEdit.createTransformRecorder()}keyCtrlZDown(e){this.m_recoder.undo();let t=this.m_recoder.getCurrList();this.selectEntities(t)}keyCtrlYDown(e){this.m_recoder.redo();let t=this.m_recoder.getCurrList();this.selectEntities(t)}trans3DEditBegin(e){let t=e.currentTarget.getTargetEntities(),i=this.m_rscene.getStage3D();this.m_prevPos.setXYZ(i.mouseX,i.mouseY,0),this.m_recoder.saveBegin(t),this.m_selectFrame.disable()}trans3DEditEnd(e){let t=this.m_rscene.getStage3D();if(this.m_currPos.setXYZ(t.mouseX,t.mouseY,0),d.Vector3D.Distance(this.m_prevPos,this.m_currPos)>.5){let t=e.currentTarget.getTargetEntities();this.m_recoder.saveEnd(t)}else this.m_recoder.saveEnd(null);this.m_selectFrame.enable()}uiMouseDownListener(e){}uiMouseUpListener(e){}uiMouseMoveListener(e){this.m_selectFrame.move(e.mouseX,e.mouseY)}btnMouseUpListener(e){let t=e.uuid;switch(t){case"local":this.m_transCtr.toLocal();break;case"global":this.m_transCtr.toGlobal();break;case"move":this.m_transCtr.toTranslation();break;case"scale":this.m_transCtr.toScale();break;case"rotate":this.m_transCtr.toRotation();break;case"redo":this.keyCtrlYDown(null);break;case"undo":this.keyCtrlZDown(null);break;default:break}}createTexByUrl(e="",t=!0){let i=this.m_map;if(e=""!=e?e:"static/assets/box.jpg",e=m.default.filterUrl(e),i.has(e))return i.get(e);let r=this.m_rscene.textureBlock.createImageTex2D();t&&i.set(e,r);const a=new XMLHttpRequest;return a.open("GET",e,!0),a.responseType="blob",a.onload=e=>{let t=new Image;t.onload=e=>{r.setDataFromImage(t,0,0,0,!1)};let i=window;var s=(i.URL||i.webkitURL).createObjectURL(a.response);t.src=s},a.onerror=e=>{},a.send(null),r}keyDownDoes(e){return!0}keyDown(e){if(this.keyDownDoes(e)){let t=n.Keyboard;switch(e.keyCode){case t.W:this.m_transCtr.toTranslation();break;case t.E:this.m_transCtr.toScale();break;case t.R:this.m_transCtr.toRotation();break;default:break}}}loadModels(){let e="static/private/",t=e+"obj/base.obj";t=e+"fbx/base4.fbx",t="static/assets/fbx/base4.fbx",t=m.default.filterUrl(t);let i=this.m_teamLoader;i.verTool=this.m_verTool,i.load([t],(e,t)=>{this.m_layouter.layoutReset();for(let i=0;i<e.length;++i)this.createEntity(e[i],null!=t?t[i]:null);this.m_layouter.layoutUpdate(200,d.VoxMath.createVec3(0,0,0))})}createEntity(e,t=null,i=""){let r=null,a=!1;if(a=this.pbrCtx.isMCTXEnabled(),a){let e={roughness:.5,pipeline:!0,scatterEnabled:!1,toneMapingExposure:3,fogEnabled:!1,albedoColor:[1,1,1]},t={diffuseMap:""};r=this.pbrCtx.pbrModule.createMaterial(!0,e,t)}else{let e=n.VoxRScene.createDefaultMaterial(!0);e.setRGB3f(.85,.85,.85),e.setTextureList([this.createTexByUrl(this.m_modelTexUrl)]),e.initializeByCodeBuf(!0),r=e}let s=n.VoxRScene.createDataMeshFromModel(e,r),o=n.VoxRScene.createMouseEventEntity();return o.uuid=i,o.setMaterial(r),o.setMesh(s),o.update(),null==this.m_entityContainer?this.m_rscene.addEntity(o):this.m_entityContainer.addEntity(o),o.addEventListener(n.MouseEvent.MOUSE_OVER,this,this.mouseOverTargetListener),o.addEventListener(n.MouseEvent.MOUSE_OUT,this,this.mouseOutTargetListener),o.addEventListener(n.MouseEvent.MOUSE_DOWN,this,this.mouseDownTargetListener),o.addEventListener(n.MouseEvent.MOUSE_UP,this,this.mouseUpTargetListener),this.m_entities.push(o),this.m_layouter.layoutAppendItem(o,n.VoxRScene.createMat4(t)),this.modelScene.addModelNode(m.default.getFileName(i),o),o}mouseOverTargetListener(e){}mouseOutTargetListener(e){}mouseDownTargetListener(e){this.m_posV0.setXYZ(e.mouseX,e.mouseY,0),this.m_posV1.copyFrom(this.m_posV0),this.m_mi.drager.attach()}selectEntities(e,t=null){if(e&&e.length>0){let t=this.m_transCtr,i=d.VoxMath.createVec3();for(let r=0;r<e.length;++r)i.addBy(e[r].getGlobalBounds().center);if(i.scaleBy(1/e.length),e.length>0&&this.m_modelSelectCall){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].uuid);this.m_modelSelectCall(t)}t&&e.length>0&&this.m_outline.select(e)}}setMouseUpListener(e){this.m_mouseUpCall=e}setModelSelectListener(e){this.m_modelSelectCall=e}setMaterialParamWithUUID(e,t){}mouseUpTargetListener(e){if(this.m_posV1.setXYZ(e.mouseX,e.mouseY,0),this.m_posV0.subtractBy(this.m_posV1),this.m_posV0.getLength()<.5){let t=e.target;this.selectEntities([t],e.wpos)}this.m_mouseUpCall&&this.m_mouseUpCall(e)}mouseUpListener(e){this.m_transCtr&&this.m_transCtr.decontrol()}mouseBGClickListener(e){this.m_transCtr&&this.m_transCtr.disable(),this.m_outline.deselect(),this.m_mouseUpCall&&this.m_mouseUpCall(e),this.m_modelSelectCall&&this.m_modelSelectCall([])}run(){this.m_graph&&(this.m_transCtr&&this.m_transCtr.run(),this.m_graph.run())}}t.DsrdViewerBase=y},"7c47":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("4d3f");var a,s,n;t.OrientationType=a,t.MathConst=s,t.Vector3D=n;class o{constructor(){this.m_init=!0}init(){this.isEnabled()&&(t.OrientationType=a=CoMath.OrientationType,t.MathConst=s=CoMath.MathConst,t.Vector3D=n=CoMath.Vector3D)}initialize(e=null,t=""){return this.init(),this.m_init=!this.isEnabled(),!!this.m_init&&(this.m_init=!1,""!=t&&void 0!==t||(t="static/cospace/math/CoMath.umd.min.js"),new r.ModuleLoader(1,()=>{this.init(),null!=e&&this.isEnabled()&&e([t])}).load(t),!0)}isEnabled(){return"undefined"!==typeof CoMath}get Vector3D(){return CoMath.Vector3D}get MathConst(){return CoMath.MathConst}get OrientationType(){return CoMath.OrientationType}createVec3(e,t,i,r){return CoMath.createVec3(e,t,i,r)}createMat4(e,t){return CoMath.createMat4(e,t)}createAABB(){return CoMath.createAABB()}createAABB2D(e,t,i,r){return CoMath.createAABB2D(e,t,i,r)}isZero(e){return CoMath.isZero(e)}isNotZero(e){return CoMath.isNotZero(e)}isGreaterPositiveZero(e){return CoMath.isGreaterPositiveZero(e)}isLessNegativeZero(e){return CoMath.isLessNegativeZero(e)}isLessPositiveZero(e){return CoMath.isLessPositiveZero(e)}isGreaterNegativeZero(e){return CoMath.isGreaterNegativeZero(e)}isPostiveZero(e){return CoMath.isPostiveZero(e)}isNegativeZero(e){return CoMath.isNegativeZero(e)}isGreaterRealZero(e){return CoMath.isGreaterRealZero(e)}isLessRealZero(e){return CoMath.isLessRealZero(e)}}const l=new o;t.VoxMath=l},"7ce5":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},8875:function(e,t,i){var r,a,s;(function(i,n){a=[],r=n,s="function"===typeof r?r.apply(t,a):r,void 0===s||(e.exports=s)})("undefined"!==typeof self&&self,(function(){function e(){var t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==e&&document.currentScript)return document.currentScript;try{throw new Error}catch(m){var i,r,a,s=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,n=/@([^@]*):(\d+):(\d+)\s*$/gi,o=s.exec(m.stack)||n.exec(m.stack),l=o&&o[1]||!1,c=o&&o[2]||!1,d=document.location.href.replace(document.location.hash,""),u=document.getElementsByTagName("script");l===d&&(i=document.documentElement.outerHTML,r=new RegExp("(?:[^\\n]+?\\n){0,"+(c-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),a=i.replace(r,"$1").trim());for(var h=0;h<u.length;h++){if("interactive"===u[h].readyState)return u[h];if(u[h].src===l)return u[h];if(l===d&&u[h].innerHTML&&u[h].innerHTML.trim()===a)return u[h]}return null}}return e}))},"8f2d":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("4d3f");class a{constructor(){this.m_init=!0}initialize(e=null,t=""){return this.m_init=!this.isEnabled(),!!this.m_init&&(this.m_init=!1,""!=t&&void 0!==t||(t="static/cospace/coMaterial/CoMaterial.umd.min.js"),new r.ModuleLoader(1,()=>{null!=e&&this.isEnabled()&&e([t])}).load(t),!0)}isEnabled(){return"undefined"!==typeof CoMaterial}createColor4(e,t,i,r){return CoMaterial.createColor4(e,t,i,r)}createDefaultMaterial(e){return CoMaterial.createDefaultMaterial(e)}createLineMaterial(e){return CoMaterial.createLineMaterial(e)}createQuadLineMaterial(e){return CoMaterial.createQuadLineMaterial(e)}createShaderMaterial(e){return CoMaterial.createShaderMaterial(e)}createMaterial(e){return CoMaterial.createMaterial(e)}creatMaterialContextParam(){return CoMaterial.creatMaterialContextParam()}createMaterialContext(){return CoMaterial.createMaterialContext()}}const s=new a;t.VoxMaterial=s},"9a9d":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("3b42");t.ICoTransformRecorder=r.ICoTransformRecorder;const a=i("3612");t.ITransformController=a.ITransformController;const s=i("7ce5");t.IFloorLineGrid=s.IFloorLineGrid;const n=i("9ce7");t.IUIRectLine=n.IUIRectLine;const o=i("d518");t.IRectFrameQuery=o.IRectFrameQuery;const l=i("4d3f");var c=null;t.UserEditEvent=c;class d{constructor(){this.m_init=!0}initialize(e=null,i=""){return this.isEnabled()&&(t.UserEditEvent=c=Lib_VoxModelEdit.UserEditEvent),this.m_init=!this.isEnabled(),!!this.m_init&&(this.m_init=!1,""!=i&&void 0!==i||(i="static/cospace/modelEdit/Lib_VoxModelEdit.umd.min.js"),e&&new l.ModuleLoader(1,()=>{this.isEnabled()&&e([i])}).load(i),!0)}isEnabled(){return"undefined"!==typeof Lib_VoxModelEdit}get UserEditEvent(){return Lib_VoxModelEdit.UserEditEvent}createTransformRecorder(){return Lib_VoxModelEdit.createTransformRecorder()}createTransformController(){return Lib_VoxModelEdit.createTransformController()}createFloorLineGrid(){return Lib_VoxModelEdit.createFloorLineGrid()}createUIRectLine(){return Lib_VoxModelEdit.createUIRectLine()}createRectFrameQuery(){return Lib_VoxModelEdit.createRectFrameQuery()}}const u=new d;t.VoxModelEdit=u},"9ce7":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},a0ee:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){}renderBegin(e){let t=e.getRenderProxy();t.clearDepth(1)}renderEnd(e){}}t.SceneAccessor=r},a0f6:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("4604");class a extends r.PackedLoader{constructor(){super(...arguments),this.m_dataMap=new Map}loadData(e){let t=new XMLHttpRequest;t.open("GET",e,!0),t.onerror=function(e){},t.onload=i=>{this.m_dataMap.set(e,t.response),this.loadedUrl(e)},t.send(null)}getDataByUrl(e){return this.m_dataMap.get(e)}clearAllData(){this.m_dataMap.clear()}}t.TextPackedLoader=a},a811:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("1c7d");t.CoModuleVersion=r.CoModuleVersion;const a=i("0b88");t.CoGeomDataType=a.CoGeomDataType;class s{constructor(e){this.m_map=new Map,this.m_total=0,this.m_loadedTotal=0,this.types=null,this.models=[],this.transforms=[],this.init(e)}init(e){this.urls=e,this.m_total=e.length;for(let t=0;t<this.m_total;++t)this.m_map.set(e[t],0)}testWithUrl(e){let t=!1;if(this.m_map.has(e)&&this.m_map.get(e)<1&&(this.m_map.set(e,1),this.m_loadedTotal++,t=this.m_loadedTotal>=this.m_total,t)){let e=this.callback;e(this.models,this.transforms),this.callback=null}return t}}class n{constructor(){this.m_modelLoader=new a.CoGeomModelLoader,this.m_team=null,this.m_teams=[],this.m_enabled=!0,this.verTool=null,this.initialize()}initialize(){this.m_modelLoader.setListener((e,t,i,r)=>{if(null!=this.m_team)for(let a=0;a<e.length;++a)null!=e[a]&&(e[a].url=r,null!=e[a].vertices&&(t?this.m_team.transforms.push(t[a]):this.m_team.transforms.push(null),this.m_team.models.push(e[a])))},(e,t)=>{let i=this.m_team.testWithUrl(t);i&&(this.m_enabled=!0,this.loadNext())})}loadNext(){if(this.m_enabled&&this.m_teams.length>0){let e=this.m_teams.shift();this.m_team=e,this.m_enabled=!1,e.types?this.m_modelLoader.loadWithType(e.urls,e.types):this.m_modelLoader.load(e.urls)}}load(e,t){this.m_modelLoader.verTool=this.verTool;let i=new s(e);i.callback=t,this.m_teams.push(i),this.loadNext()}loadWithTypes(e,t,i){this.m_modelLoader.verTool=this.verTool;let r=new s(e);r.types=t,r.callback=i,this.m_teams.push(r),this.loadNext()}}t.CoModelTeamLoader=n},b096:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("4e9d"),a=i("1c7d");class s{constructor(){this.m_init=!0,this.m_sysIniting=!0,this.m_initInsFlag=!0,this.verTool=null,this.m_initCalls=[]}initialize(e=null,t=!1){if(this.m_init){this.m_init=!1,this.m_sysInitCallback=e,this.m_deferredInit=t;let i=[{url:"static/cospace/core/coapp/CoSpaceApp.umd.js",name:r.CoModuleNS.coSpaceApp,type:r.CoModuleFileType.JS},{url:"static/cospace/core/code/ThreadCore.umd.js",name:r.CoModuleNS.threadCore,type:r.CoModuleFileType.JS},{url:"static/cospace/modules/ctm/ModuleCTMGeomParser.umd.js",name:r.CoModuleNS.ctmParser,type:r.CoModuleFileType.JS},{url:"static/cospace/modules/obj/ModuleOBJGeomParser.umd.js",name:r.CoModuleNS.objParser,type:r.CoModuleFileType.JS},{url:"static/cospace/modules/png/ModulePNGParser.umd.js",name:r.CoModuleNS.pngParser,type:r.CoModuleFileType.JS},{url:"static/cospace/modules/fbxFast/ModuleFBXGeomFastParser.umd.js",name:r.CoModuleNS.fbxFastParser,type:r.CoModuleFileType.JS},{url:"static/cospace/modules/draco/ModuleDracoGeomParser.umd.js",name:r.CoModuleNS.dracoParser,type:r.CoModuleFileType.JS,params:["static/cospace/modules/dracoLib/"]}];this.m_modules=i;let s={nodes:[{uniqueName:"dracoGeomParser",path:"static/cospace/modules/draco/ModuleDracoGeomParser.umd.js"},{uniqueName:"dracoWasmWrapper",path:"static/cospace/modules/dracoLib/w2.js"},{uniqueName:"ctmGeomParser",path:"static/cospace/modules/ctm/ModuleCTMGeomParser.umd.js"}],maps:[{uniqueName:"dracoGeomParser",includes:[1]}]};this.m_dependencyGraphObj=s;let n=new a.CoModuleLoader(1,null,this.verTool);this.verTool&&(n.forceFiltering=this.verTool.forceFiltering);let o=n.getUrlChecker();if(o){for(let t=0;t<i.length;++t)i[t].url=o(i[t].url);let e=s.nodes;for(let t=0;t<e.length;++t)e[t].path=o(e[t].path)}t||this.loadSys()}}loadSys(){this.m_sysIniting&&(new a.CoModuleLoader(1,()=>{this.initCoSpaceSys()}).load(this.m_modules[0].url),this.m_sysIniting=!1)}getCPUDataByUrlAndCallback(e,t,i,r){if(null!=this.coappIns){let a=this.coappIns.getCPUDataByUrlAndCallback(e,t,i,r);if(this.m_deferredInit&&this.m_initInsFlag){this.m_initInsFlag=!1;let e=this.m_modules;this.coappIns.initialize(3,e[1].url,!0)}return a}return null}deferredInit(e){null==this.coappIns?(this.m_initCalls.push(e),this.loadSys()):null!=e&&e()}initCoSpaceSys(){if(null==this.coappIns&&"undefined"!==typeof CoSpaceApp){let e=CoSpaceApp.createInstance(),t=this.m_modules,i=JSON.stringify(this.m_dependencyGraphObj);e.setThreadDependencyGraphJsonString(i),e.setTaskModuleParams(t),this.m_deferredInit||e.initialize(3,t[1].url,!0);let r=this;r.coappIns=e;for(let a=0;a<this.m_initCalls.length;++a)null!=this.m_initCalls[a]&&this.m_initCalls[a]();this.m_initCalls=[]}null!=this.m_sysInitCallback&&this.m_sysInitCallback(),this.m_sysInitCallback=null}destroy(){}}t.CoDataModule=s,t.default=s},c77c:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("4d3f");var a,s,n,o,l,c,d,u;t.RenderDrawMode=a,t.CullFaceMode=s,t.DepthTestMode=n,t.RenderBlendMode=o,t.GLStencilFunc=l,t.GLStencilOp=c,t.GLBlendMode=d,t.GLBlendEquation=u;class h{constructor(){this.m_init=!0}init(){"undefined"!==typeof CoRenderer&&(t.RenderDrawMode=a=CoRenderer.RenderDrawMode,t.CullFaceMode=s=CoRenderer.CullFaceMode,t.DepthTestMode=n=CoRenderer.DepthTestMode,t.RenderBlendMode=o=CoRenderer.RenderBlendMode,t.GLStencilFunc=l=CoRenderer.GLStencilFunc,t.GLStencilOp=c=CoRenderer.GLStencilOp,t.GLBlendMode=d=CoRenderer.GLBlendMode,t.GLBlendEquation=u=CoRenderer.GLBlendEquation)}initialize(e=null,t=""){return this.init(),this.m_init=!this.isEnabled(),!!this.m_init&&(this.m_init=!1,""!=t&&void 0!==t||(t="static/cospace/engine/renderer/CoRenderer.umd.min.js"),new r.ModuleLoader(1,()=>{this.init(),null!=e&&this.isEnabled()&&e([t])}).load(t),!0)}get RenderDrawMode(){return CoRenderer.RenderDrawMode}get CullFaceMode(){return CoRenderer.CullFaceMode}get DepthTestMode(){return CoRenderer.DepthTestMode}get RenderBlendMode(){return CoRenderer.RenderBlendMode}get GLStencilFunc(){return CoRenderer.GLStencilFunc}get GLStencilOp(){return CoRenderer.GLStencilOp}get GLBlendMode(){return CoRenderer.GLBlendMode}get GLBlendEquation(){return CoRenderer.GLBlendEquation}get RendererDevice(){return CoRenderer.RendererDevice}get RendererState(){return CoRenderer.RendererState}createRendererInstance(){return CoRenderer.createRendererInstance()}isEnabled(){return"undefined"!==typeof CoRenderer}}const m=new h;t.VoxRenderer=m},cc0e:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("7c47"),a=i("15e2"),s=i("8f2d");class n{constructor(){this.modelName="",this.m_vec3A=null,this.m_colorA=null,this.mdecor=null,this.jsonNode=new a.MaterialJsonNode,this.changed=!0}getJsonObj(){return this.jsonNode.clone()}copyFromMDecor(){null==this.m_colorA&&(this.m_colorA=s.VoxMaterial.createColor4(),this.m_vec3A=r.VoxMath.createVec3());const e=this.jsonNode;let t=this.mdecor;if(t){e.metallic=t.getMetallic(),e.roughness=t.getRoughness();let i=this.m_colorA;t.getAlbedoColor(i),e.color=i.getRGBUint24();let r=t.vertUniform,a=this.m_vec3A;r&&(r.getUVScale(a),e.uvScales[0]=a.x,e.uvScales[1]=a.y)}}setJsonObj(e){null==this.m_colorA&&(this.m_colorA=s.VoxMaterial.createColor4(),this.m_vec3A=r.VoxMath.createVec3()),this.changed=!0;const t=this.jsonNode;t.copyFromJsonObj(e),t.modelName=this.modelName;let i=this.mdecor;if(i){let t=e["metallic"];t&&i.setMetallic(t),t=e["roughness"],t&&i.setRoughness(t);let r=this.m_colorA;t=e["color"],t&&(r.setRGBUint24(t),i.setAlbedoColor(r.r,r.g,r.b));let a=i.vertUniform,s=null;a&&(s=e["uvScales"],s&&a.setUVScale(s[0],s[1]))}}}class o{constructor(){this.uuid="",this.entity=null,this.materialNode=new n}copyEntityDataToMaterialNode(){this.materialNode.copyFromMDecor()}}t.ModelNode=o;class l{constructor(){this.m_modelMap=new Map}__$init(){}initialize(e){}getMaterialJsonObjs(e=!1){let t=[],i=this.m_modelMap;for(var[r,a]of i)(a.materialNode.changed||e)&&(t.push(a.materialNode.getJsonObj()),a.materialNode.changed=!1);return t}getMaterialJsonObjFromNode(e){if(this.m_modelMap.has(e)){let t=this.m_modelMap.get(e);return t.materialNode.getJsonObj()}return null}setMaterialParamToNodeByJsonObj(e,t){if(this.m_modelMap.has(e)){let i=this.m_modelMap.get(e);i.materialNode.setJsonObj(t)}}setMaterialParamToNode(e,t){if(this.m_modelMap.has(e)){let i=this.m_modelMap.get(e);if(null!=i.entity){let e=i.entity.getMaterial();if(e){let i=e.getDecorator();if(i){void 0!==t.metallic&&i.setMetallic(t.metallic),void 0!==t.roughness&&i.setRoughness(t.roughness),void 0!==t.ao&&i.setAO(t.ao);let e=t.displacementParams,r=i.vertUniform;r&&(void 0!==e&&r.setDisplacementParams(e[0],e[1]),e=t.uvScales,void 0!==e&&r.setUVScale(e[0],e[1])),e=t.albedoColor,void 0!==e&&i.setAlbedoColor(e[0],e[1],e[2]),e=t.parallaxParams,void 0!==e&&i.setParallaxParams(e[0],e[1],e[2],e[3]),void 0!==t.sideIntensity&&i.setSideIntensity(t.sideIntensity),void 0!==t.toneMapingExposure&&i.setToneMapingExposure(t.toneMapingExposure),void 0!==t.scatterIntensity&&i.setScatterIntensity(t.scatterIntensity)}}}}}getModelNode(e){if(this.m_modelMap.has(e)){let t=this.m_modelMap.get(e);return t}return null}addModelNode(e,t){if(!this.m_modelMap.has(e)){let i=new o;i.uuid=e,i.entity=t;let r=i.materialNode;r.modelName=e,r.mdecor=null;let a=i.entity.getMaterial();a&&(r.mdecor=a.getDecorator()),this.m_modelMap.set(e,i),i.copyEntityDataToMaterialNode(),r.changed=!1}return null}}t.ModelScene=l},d33d:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static getDomain(e){var t=/http:\/\/([^\/]+)/i;let i=e.match(t);return null!=i&&i.length>0?i[0]:""}static getHostUrl(e,t="/"){let i=location.href,a=r.getDomain(i),s=a.split(":");return i=s[0]+":"+s[1],e?i+":"+e+"/":a+t}static isEnabled(){let e=window.location.href;return e.indexOf(".artvily.com")>0}static filterUrl(e){if(e.indexOf("blob:")<0){let t=window.location.href;t.indexOf(".artvily.")>0&&(t="http://www.artvily.com:9090/",e=t+e)}return e}static getFileName(e,t=!1,i=!1){if(e.indexOf("blob:")<0||i){let i=e.lastIndexOf("/");if(i<0)return"";let r=e.lastIndexOf(".",e.length);if(r<0)return"";if(i+2<r){let a=e.slice(i+1,r);return t?a.toLocaleLowerCase():a}}return""}static getFileNameAndSuffixName(e,t=!1,i=!1){if(e.indexOf("blob:")<0||i){let i=e.lastIndexOf("/"),r=e.lastIndexOf(".",e.length);if(r<0)return"";let a=e.slice(i+1);return t?a.toLocaleLowerCase():a}return""}static getFileSuffixName(e,t=!1,i=!1){if(e.indexOf("blob:")<0||i){let i=e.lastIndexOf(".",e.length);if(i<0)return"";let r=e.slice(i+1);return t?r.toLocaleLowerCase():r}return""}}t.default=r},d518:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},e096:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("4d3f");class a{constructor(){this.m_init=!0}initialize(e=null,t=""){return!!this.m_init&&(this.m_init=!1,""!=t&&void 0!==t||(t="static/cospace/engine/uiInteract/CoUIInteraction.umd.min.js"),new r.ModuleLoader(1,()=>{null!=e&&this.isEnabled()&&e([t])}).load(t),!0)}createMouseInteraction(){return CoUIInteraction.createMouseInteraction()}createKeyboardInteraction(){return CoUIInteraction.createKeyboardInteraction()}isEnabled(){return"undefined"!==typeof CoUIInteraction}}const s=new a;t.VoxUIInteraction=s},e175:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("702c");t.PBRParam=r.PBRParam,t.PBRMapUrl=r.PBRMapUrl,t.PBRModule=r.PBRModule;const a=i("1c7d");class s{constructor(){this.m_mctxFlag=0,this.m_callback=null,this.pbrModule=new r.PBRModule}getMaterialCtx(){return this.m_mctx}initialize(e,t,i){null==this.m_rscene&&null!=e&&(this.m_rscene=e,this.m_materialData=t,this.m_callback=i,this.pbrModule.initialize(t),this.initMaterialModule())}initMaterialModule(){this.pbrModule.preload(()=>{this.updateMCTXInit()});let e="static/cospace/renderEffect/pbr/PBREffect.umd.js",t="static/cospace/renderEffect/lightModule/CoLightModule.umd.js",i="static/cospace/renderEffect/envLight/CoEnvLightModule.umd.js",r="static/cospace/renderEffect/vsmShadow/VSMShadowModule.umd.js";new a.CoModuleLoader(4,()=>{this.updateMCTXInit()}).load(e).load(t).load(i).load(r)}updateMCTXInit(){this.m_mctxFlag++,this.isMCTXEnabled()&&this.initMaterialCtx()}isMCTXEnabled(){return 2==this.m_mctxFlag}buildEnvLight(e,t,i){let r=CoEnvLightModule.create(this.m_rscene);if(r.initialize(),void 0!=i&&null!=i){r.setFogDensity(i.density);let e=i.rgb;r.setFogColorRGB3f(e[0],e[1],e[2])}else r.setFogDensity(5e-4),r.setFogColorRGB3f(0,.8,.1);e.envLightModule=r}buildLightModule(e,t,i){t.pointLightsTotal=0,t.spotLightsTotal=0,t.directionLightsTotal=0;let r=CoLightModule.createLightModule(this.m_rscene);if(i){void 0!=i.pointLights&&null!=i.pointLights&&(t.pointLightsTotal=i.pointLights.length),void 0!=i.spotLights&&null!=i.spotLights&&(t.spotLightsTotal=i.spotLights.length),void 0!=i.directionLights&&null!=i.directionLights&&(t.directionLightsTotal=i.directionLights.length);for(let e=0;e<t.pointLightsTotal;++e)r.appendPointLight();for(let e=0;e<t.spotLightsTotal;++e)r.appendSpotLight();for(let e=0;e<t.directionLightsTotal;++e)r.appendDirectionLight()}this.initLightModuleData(r,t,i),e.lightModule=r}initLightModuleData(e,t,i){if(i){for(let r=0;r<t.pointLightsTotal;++r){let t=i.pointLights[r],a=e.getPointLightAt(r);a.position.fromArray(t.position),a.color.fromArray4(t.rgb),a.attenuationFactor1=t.factor1,a.attenuationFactor2=t.factor2}for(let r=0;r<t.spotLightsTotal;++r){let t=i.spotLights[r],a=e.getSpotLightAt(r);a.position.fromArray(t.position),a.direction.fromArray(t.direction),a.color.fromArray4(t.rgb),a.attenuationFactor1=t.factor1,a.attenuationFactor2=t.factor2}for(let r=0;r<t.directionLightsTotal;++r){let t=i.directionLights[r],a=e.getDirectionLightAt(r);a.direction.fromArray(t.direction),a.color.fromArray4(t.rgb),a.attenuationFactor1=t.factor1,a.attenuationFactor2=t.factor2}}e.update()}initMaterialCtx(){this.m_mctx=CoRScene.createMaterialContext();let e=this.m_mctx,t=this.m_materialData,i=t.context,r=CoRScene.creatMaterialContextParam();r.shaderLibVersion=i.shaderLibVersion,r.loadAllShaderCode=!0,r.shaderCodeBinary=!0,r.pbrMaterialEnabled=!0,r.lambertMaterialEnabled=!1,r.shaderFileNickname=!0,r.vsmFboIndex=0,r.vsmEnabled=!0,this.buildEnvLight(e,r,t.fog),this.buildLightModule(e,r,t.light),this.buildShadowModule(e,r,t.shadow),e.addShaderLibListener(this),e.initialize(this.m_rscene,r),this.pbrModule.active(this.m_rscene,e,r.vsmEnabled)}shaderLibLoadComplete(e,t){null!=this.m_callback&&(this.m_callback(),this.m_callback=null)}buildShadowModule(e,t,i){let r=CoRScene.createVec3();r.fromArray(i.cameraPosition);let a=VSMShadowModule.create(t.vsmFboIndex);a.setCameraPosition(r),a.setCameraNear(i.cameraNear),a.setCameraFar(i.cameraFar);let s=i.mapSize,n=i.cameraViewSize;a.setMapSize(s[0],s[1]),a.setCameraViewSize(n[0],n[1]),a.setShadowRadius(i.radius),a.setShadowBias(i.bias),a.initialize(this.m_rscene,[0],3e3),a.setShadowIntensity(i.shadowIntensity),a.setColorIntensity(i.colorIntensity),e.vsmModule=a}run(){this.m_mctx&&this.m_mctx.run()}}t.PBRMaterialCtx=s},ea2a:function(e,t,i){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e["None"]="",e["Default"]="pbr",e["Lambert"]="lambert",e["PBR"]="pbr"}(r||(r={})),t.ShaderCodeUUID=r},f189:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i("4d3f");class a{constructor(){this.m_init=!0}initialize(e=null,t=""){return this.isEnabled()&&Lib_VoxUI.initialize(),this.m_init=!this.isEnabled(),!!this.m_init&&(this.m_init=!1,""!=t&&void 0!==t||(t="static/cospace/ui/Lib_VoxUI.umd.min.js"),null!=e&&new r.ModuleLoader(1,()=>{this.isEnabled()&&e([t])}).load(t),!0)}isEnabled(){return"undefined"!==typeof Lib_VoxUI}createColorLabel(){return Lib_VoxUI.createColorLabel()}createUILayout(){return Lib_VoxUI.createUILayout()}createTipInfo(){return Lib_VoxUI.createTipInfo()}createRectTextTip(){return Lib_VoxUI.createRectTextTip()}createClipLabel(){return Lib_VoxUI.createClipLabel()}createClipColorLabel(){return Lib_VoxUI.createClipColorLabel()}createColorClipLabel(){return Lib_VoxUI.createColorClipLabel()}createTextLabel(){return Lib_VoxUI.createTextLabel()}createButton(){return Lib_VoxUI.createButton()}createFlagButton(){return Lib_VoxUI.createFlagButton()}createSelectButtonGroup(){return Lib_VoxUI.createSelectButtonGroup()}createTextButton(e,t,i,r,a,s){return Lib_VoxUI.createTextButton(e,t,i,r,a,s)}createTextLabelButton(e,t,i,r,a,s,n){return Lib_VoxUI.createTextLabelButton(e,t,i,r,a,s,n)}createUIPanel(){return Lib_VoxUI.createUIPanel()}createPromptPanel(){return Lib_VoxUI.createPromptPanel()}createParamCtrlPanel(){return Lib_VoxUI.createParamCtrlPanel()}createUIScene(e,t,i,r){return Lib_VoxUI.createUIScene(e,t,i,r)}createSelectionEntity(){return Lib_VoxUI.createSelectionEntity()}createProgressEntity(){return Lib_VoxUI.createProgressEntity()}}const s=new a;t.VoxUI=s},fae3:function(e,t,i){"use strict";i.r(t);i("1eb2");var r=i("6ee3");for(var a in r)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(a)}})}));