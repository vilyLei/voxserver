(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["DSRDShell"]=t():e["DSRDShell"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(s,a,function(t){return e[t]}.bind(null,a));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="fae3")}({"06e0":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.taskid=0,this.version=-1,this.phase="new",this.filepath="",this.taskname="",this.success=!1,this.drcsTotal=0,this.fileName="",this.time=0,this.bgTransparent=!1,this.imgResolution=[512,512],this.imgsTotal=1,this.miniImgUrls=[],this.bigImgUrl="",this.modelLoadStatus=0,this.currentTaskAlive=!1,this.drcNames=[],this.rnode=null,this.reneringTimes=0,this.rtJsonData=null}isFinish(){return"finish"==this.phase}isCurrTaskAlive(){return this.currentTaskAlive}reset(){}isModelDataLoaded(){return 2==this.modelLoadStatus}copyFromJson(e){let t=this;void 0!==e.taskid&&(t.taskid=e.taskid),e.version!==e.version&&(t.version=e.version),void 0!==e.filepath&&(t.filepath=e.filepath),void 0!==e.taskname&&(t.taskname=e.taskname),void 0!==e.success&&(t.success=e.success),void 0!==e.filepath&&(t.filepath=e.filepath),void 0!==e.fileName&&(t.fileName=e.fileName),void 0!==e.phase&&(t.phase=e.phase),void 0!==e.imgsTotal&&(this.imgsTotal=e.imgsTotal),void 0!==e.sizes&&(this.imgResolution=e.sizes),void 0!==e.rnode&&(this.rnode=e.rnode),void 0!==e.bgTransparent&&(this.bgTransparent=1==e.bgTransparent),this.updateUrl()}getUrlParams(){let e="?ver="+Math.random()+"-"+Math.random()*Date.now()+"&rrtime="+this.reneringTimes;return e}updateUrl(){let e=this.filepath,t=this.bgTransparent?"png":"jpg",i=e.lastIndexOf("/"),s=e.slice(2,i+1);this.bigImgUrl=s+"bld_rendering."+t+this.getUrlParams();let a=this.imgResolution,n=s+"bld_rendering_mini_0."+t+this.getUrlParams();this.miniImgUrls=[],this.miniImgUrls.push(n),1==this.imgsTotal?(a[0]<=512||a[1]<=512)&&a[0]>128&&a[1]>128&&this.miniImgUrls.push(this.bigImgUrl):this.imgsTotal>1&&(n=s+"bld_rendering_mini_1."+t+this.getUrlParams(),this.miniImgUrls.push(n));for(let r=0;r<this.miniImgUrls.length;r++);}}t.RTaskData=s},"195d":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("a7c5"),a=i("9bbe");class n extends s.SettingDataPanel{constructor(){super()}setJsonObj(e){if(super.setJsonObj(e),e["resolution"]){let t=e["resolution"];this.setStringValueToItem("imageWidth",t[0]+""),this.setStringValueToItem("imageHeight",t[1]+"")}}getJsonStr(e="{",t="}"){let i=this.getItemCompByKeyName("imageWidth").getParam(),s=this.getItemCompByKeyName("imageHeight").getParam(),a=[i.numberValue,s.numberValue],n=`${e}"path":"", "resolution":[${a}]`;return super.getJsonStr(n,t)}init(e){let t,i=e=>{let i=this.getItemParamByKeyName(e);switch(e){case"imageWidth":t=this.getItemParamByKeyName("imageHeight"),t.updateValueWithStr(i.getCurrValueString(),!0,!1);break;case"imageHeight":t=this.getItemParamByKeyName("imageWidth"),t.updateValueWithStr(i.getCurrValueString(),!0,!1);break;default:break}this.m_unlockDataChanged},s=[];t=new a.DataItemComponentParam,t.keyName="imageWidth",t.name="图像宽",t.numberValue=512,t.inputType="number",t.numberMinValue=128,t.numberMaxValue=4096,t.editEnabled=!0,t.autoEncoding=!1,t.toNumber(),t.onchange=i,s.push(t),t=new a.DataItemComponentParam,t.keyName="imageHeight",t.name="图像高",t.numberValue=512,t.inputType="number",t.numberMinValue=128,t.numberMaxValue=4096,t.editEnabled=!0,t.autoEncoding=!1,t.toNumber(),t.onchange=i,s.push(t),t=new a.DataItemComponentParam,t.keyName="bgTransparent",t.name="背景透明",t.toBoolean(),t.booleanValue=!1,s.push(t),t=new a.DataItemComponentParam,t.keyName="outputType",t.name="出图类型",t.textValue="single_image",t.textContent="单张图",t.toText(),s.push(t),t=new a.DataItemComponentParam,t.keyName="bgColor",t.name="背景色",t.numberValue=16777215,t.editEnabled=!0,t.toColor(),s.push(t),this.m_params=s;let n=60,r=50,o=0;for(let a=0;a<s.length;++a)this.createItemComponent(n+o,s[a]),o+=r}}t.OutputDataPanel=n},"1eb2":function(e,t,i){"use strict";if("undefined"!==typeof window){var s=window.document.currentScript,a=i("8875");s=a(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:a});var n=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(i.p=n[1])}},"22b3":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.m_viewerLayer=null,this.m_panel=null,this.m_areaWidth=512,this.m_areaHeight=512,this.m_selected=!1,this.m_deselectColors=[12442081,11457759,8635607],this.m_selectColors=[8039642,4887509,3898293],this.group=null}initialize(e,t,i,s){this.m_viewerLayer=e,this.m_areaWidth=t,this.m_areaHeight=i,this.m_panel=s,e.innerHTML=s.getName(),this.initEvent(e)}getPanel(){return this.m_panel}getName(){return this.m_panel.getName()}getKeyName(){return this.m_panel.getKeyName()}getType(){return this.m_panel.getType()}applyColorAt(e){let t=this.m_selected?this.m_selectColors:this.m_deselectColors;this.m_viewerLayer.style.backgroundColor="#"+t[e].toString(16)}initEvent(e){e.onmouseover=e=>{this.applyColorAt(1)},e.onmouseout=e=>{this.applyColorAt(0)},e.onmouseup=e=>{this.select(),this.applyColorAt(1)},e.onmousedown=e=>{this.applyColorAt(2)}}isSelected(){return this.m_selected}select(){let e=this.group,t=e.length;for(let i=0;i<t;++i)if(e[i].isSelected()){e[i].deselect();break}this.m_selected=!0,this.applyColorAt(0),this.m_panel.setVisible(!0)}deselect(){this.m_selected=!1,this.applyColorAt(0),this.m_panel.setVisible(!1)}}t.RenderingSettingItem=s},"23ff":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.taskStatus=0,this.startTime=0,this.rt_phase_times=0,this.rt_phase=""}initialize(){}reset(){this.rt_phase="",this.rt_phase_times=0,this.taskStatus=0,this.startTime=Date.now(),this.showSpecInfo("waiting...")}taskSuccess(){}taskFailure(){}showSpecInfo(e,t=-1){var i=this.infoDiv;if(null!=i)if(t>=0){let s=t%3;switch(s){case 0:i.innerHTML=e+"&nbsp;.&nbsp;&nbsp;";break;case 1:i.innerHTML=e+"&nbsp;..&nbsp;";break;default:i.innerHTML=e+"&nbsp;...";break}}else i.innerHTML=e}parseSyncRStatuReqInfo(e,t=null){if(null!=e){const i=this.data;i.version!=e.version&&(i.version=e.version,i.phase=e.phase,this.process.toCurrRendering(),this.reset(),t&&t("current_rendering_begin"))}this.process.running=!0}parseModelReqInfo(e){void 0!==e.drcsTotal&&(this.data.drcsTotal=e.drcsTotal,this.process.updateModel(this.data.drcsTotal)),this.showSpecInfo("正在载入模型数据",this.rt_phase_times++),this.process.running=!0}parseRenderingReqInfo(e){e.status;let t=e.phase;this.rt_phase!=t&&(this.rt_phase=t,this.rt_phase_times=0);let i="",s=!1;switch(void 0!==e.drcsTotal&&(this.process.isModelFinish()||(this.data.drcsTotal=e.drcsTotal,this.process.updateModel(this.data.drcsTotal))),this.data.phase=t,this.process.renderingPhase=t,this.process.running=!0,t){case"running":e.progress<6?this.showSpecInfo("正在解析模型数据",this.rt_phase_times):this.showSpecInfo('正在进行渲染: <b><font color="#008800">'+e.progress+"%</font></b>"),s=!0;break;case"new":i='排队<b><font color="#880000">('+e.teamIndex+"/"+e.teamLength+")</font></b>等待可用的空闲渲染器",this.showSpecInfo(i,this.rt_phase_times);break;case"task_rendering_enter":this.rt_phase_times>2?this.showSpecInfo("配置渲染任务",this.rt_phase_times):this.showSpecInfo("启动渲染任务",this.rt_phase_times);break;case"task_rendering_load_res":this.showSpecInfo('同步模型资源: <b><font color="#008800">'+e.progress+"%</font></b>");break;case"task_rendering_begin":this.showSpecInfo("准备渲染数据",this.rt_phase_times);break;case"finish":if(this.taskStatus<1){this.data.version=e.version,this.taskStatus=1;let t=e.sizes,i=Date.now()-this.startTime,s=Math.round(i/1e3);this.showSpecInfo('<b><font color="#008800">'+t[0]+"x"+t[1]+"</font></b>效果图渲染完成<br/><b>(总耗时"+s+"s)</b>"),this.data.bgTransparent=1==e.bgTransparent,this.data.copyFromJson(e),this.taskSuccess()}break;case"rtaskerror":if(this.taskStatus<2)return this.taskStatus=2,this.showSpecInfo("渲染失败(模型数据不能正确解析)"),void this.taskFailure();case"query-re-rendering-task":break;default:break}this.rt_phase_times++}}t.RTaskInfoViewer=s},2403:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("7191");class a{constructor(e=null){this.unit="px",this.m_viewer=e,e&&(this.m_style=e.style)}getDiv(){return this.m_viewer}getStyle(){return this.m_viewer.style}setViewer(e){this.m_viewer=e,e&&(this.m_style=e.style)}setInnerHTML(e){this.m_viewer.innerHTML=e}clearInnerHTML(){this.m_viewer.innerHTML=""}setDisplayMode(e="block"){""!=e&&(this.m_style.display=e)}setPositionMode(e="relative"){""!=e&&(this.m_style.position=e)}setTextAlign(e){this.m_style.textAlign=e}contentAlignToCenter(){let e=this.m_style;e.textAlign="center",e.alignItems="center",e.justifyContent="center"}layoutToCenter(e=0,t=0){let i=this.m_viewer.getBoundingClientRect(),s=this.m_viewer.parentElement.getBoundingClientRect(),a=.5*(s.width-i.width)+e,n=.5*(s.height-i.height)+t;this.setXY(a,n)}setXY(e,t){this.m_style.left=e+this.unit,this.m_style.top=t+this.unit}setX(e){this.m_style.left=e+this.unit}setY(e){this.m_style.top=e+this.unit}setSize(e,t){e>0&&t>0&&(this.m_style.width=e+this.unit,this.m_style.height=t+this.unit)}setWidth(e){e>0&&(this.m_style.width=e+this.unit)}setHeight(e){e>0&&(this.m_style.height=e+this.unit)}setTextColor(e,t=1){this.m_style.color="#"+e.toString(16)}setBackgroundColor(e,t=1){this.m_style.backgroundColor="#"+e.toString(16)}setVisible(e){s.DivTool.setVisible(this.m_viewer,e)}isVisible(){return s.DivTool.isVisible(this.m_viewer)}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}clearDivAllEles(){s.DivTool.clearDivAllEles(this.m_viewer)}getRect(){return this.m_viewer.getBoundingClientRect()}}t.HTMLViewerLayer=a},"24cc":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("a7c5"),a=i("195d"),n=i("faa5"),r=i("4f1d"),o=i("2eea"),l=i("22b3"),h=i("538b"),m=i("47c8"),u=i("7191"),d=i("b800"),c=[{name:"出图设置",id:0,type:"output"},{name:"环境设置",id:1,type:"env"},{name:"摄像机",id:2,type:"camera"},{name:"材质",id:3,type:"material"},{name:"灯光",id:4,type:"light"}];class p{constructor(){this.m_viewerLayer=null,this.m_areaWidth=512,this.m_areaHeight=512,this.m_planeAreaWidth=512,this.m_planeAreaHeight=512,this.m_bottomAreaHeight=512,this.m_items=[],this.m_itemMap=new Map,this.m_paramInputPanel=new d.ParamInputPanel,this.taskNameDiv=null,this.rtaskSys=null,this.layoutHorizon=!0,this.m_rscViewer=null,this.m_materialPanel=null}initialize(e,t,i){this.m_viewerLayer=e,this.m_areaWidth=t,this.m_areaHeight=i,this.initUIScene(e,t,i)}setRSCViewer(e){this.m_rscViewer=e;for(let t=0;t<this.m_items.length;t++)this.m_items[t].getPanel().rscViewer=e}setTaskName(e){this.taskNameDiv.innerHTML=`<u>${e}</u>`}initUIScene(e,t,i){let s=5;this.m_planeAreaWidth=Math.floor(.8*t),this.m_planeAreaHeight=Math.floor(.8*i),this.m_bottomAreaHeight=i-this.m_planeAreaHeight;let a=this.m_planeAreaHeight,n=t-this.m_planeAreaWidth,r=a/s,o=0,h=u.DivTool.createDivT1(0,0,n,a,"flex","absolute",!1),m=h.style;m.backgroundColor="#668fb6",e.appendChild(h);let d=u.DivTool.createDivT1(0,a,t,i-a,"flex","absolute",!1);m=d.style,m.backgroundColor="#bdd9e1",e.appendChild(d),this.buildBtns(d);let p=u.DivTool.createDivT1(n,0,t-n,a,"flex","absolute",!1);this.taskNameDiv=u.DivTool.createDivT1(n+10,5,t-n-20,35,"flex","absolute",!1),m=this.taskNameDiv.style,m.color="#101033",m.textAlign="center",m.alignItems="center",m.justifyContent="center",e.appendChild(this.taskNameDiv),m=p.style,e.appendChild(p);let g=c,b=this.m_items,_=n,y=r-2;for(let c=0;c<s;++c){let t="#bdd9e1",i=u.DivTool.createDivT1(0,o+c*r,_,y,"flex","absolute",!0);m=i.style,m.backgroundColor=t,m.cursor="pointer",m.userSelect="none",e.appendChild(i);let s=this.createSettingPanel(p,this.m_planeAreaWidth,a,g[c]);const n=new l.RenderingSettingItem;n.group=b,n.initialize(i,_,y,s),b.push(n),this.m_itemMap.set(n.getType(),n)}b[0].select();let f=u.DivTool.createDivT1(0,0,t,i,"flex","absolute",!1);e.appendChild(f);let v=this.m_paramInputPanel;v.initialize(f,t,i,this.layoutHorizon),v.viewLayer.setBackgroundColor(12442081),v.close()}getItemByKeyName(e){return this.m_itemMap.get(e)}getPanelByKeyName(e){return this.m_itemMap.get(e).getPanel()}buildBtns(e){let t=Math.floor(.28*this.m_areaWidth),i=Math.floor(.6*this.m_bottomAreaHeight),s=Math.floor(.5*(this.m_bottomAreaHeight-i)),a=u.DivTool.createDivT1(1,s,t,i,"flex","absolute",!0);e.appendChild(a);let n=[a],r=new m.ButtonDivItem;r.initialize(a,"获取渲染任务","new_rendering"),r.toRoundedRectangleStyle(),r.onmouseup=e=>{this.rtaskSys.request.updatePage()},a=u.DivTool.createDivT1(1,s,t,i,"flex","absolute",!0),e.appendChild(a),n.push(a),r=new m.ButtonDivItem,r.initialize(a,"渲染图像","send_rendering"),r.toRoundedRectangleStyle(),r.onmouseup=e=>{this.rtaskSys.rerendering()},a=u.DivTool.createDivT1(1,s,t,i,"flex","absolute",!0),e.appendChild(a),n.push(a),r=new m.ButtonDivItem,r.initialize(a,"查看渲染原图","view_rendering_img"),r.toRoundedRectangleStyle(),r.onmouseup=e=>{window.open(this.rtaskSys.data.bigImgUrl,"_blank")},u.DivTool.hArrangementDivs(n)}isRTJsonActiveByKeyName(e){let t=this.getPanelByKeyName(e);return!!t&&t.isActive()}getRTJsonStrByKeyName(e,t=!0){let i="";switch(e){case"rnode":return i=this.getRSettingJsonStr(),i=`{"name":"rnode","unit":"m","version":0,${i}}`,i;default:let s=this.getPanelByKeyName(e);return i=s.getJsonStr(),t&&(i=`{"name":"rnode","unit":"m","version":0,${i}}`),i}}setRTDataFromRNode(e){if(e){let t=this.getPanelByKeyName("output");e["output"]&&t.updateData(e["output"]),t=this.getPanelByKeyName("camera"),e["camera"]&&t.updateData(e["camera"]),t=this.getPanelByKeyName("env"),e["env"]&&t.updateData(e["env"]);let i=e.materials;i&&(t=this.getPanelByKeyName("material"),t.updateData(i[0]))}}getRTJsonStrByKeyNames(e,t=!0){let i=e.length,s="";for(let a=0;a<i;a++){let t=e[a];switch(t){case"rnode":return s=this.getRSettingJsonStr(),s=`{"name":"rnode","unit":"m","version":0,${s}}`,s;default:let e=this.getPanelByKeyName(t);""!=s?s+=","+e.getJsonStr():s=e.getJsonStr();break}}return t&&(s=`{"name":"rnode","unit":"m","version":0,${s}}`),s}getRSettingJsonStr(){let e=this.getPanelByKeyName("output"),t="",i=e.getJsonStr();return t=i,e=this.getPanelByKeyName("env"),i=e.getJsonStr(),t+=","+i,e=this.getPanelByKeyName("camera"),i=e.getJsonStr(),t+=","+i,e=this.getPanelByKeyName("material"),i=e.getJsonStr(),t+=","+i,e=this.getPanelByKeyName("light"),i=e.getJsonStr(),t+=","+i,t}getMaterialPanel(){return this.m_materialPanel}createSettingPanel(e,t,i,l){let m=null;switch(l.type){case"output":m=new a.OutputDataPanel;break;case"env":m=new n.EnvDataPanel;break;case"camera":m=new r.CameraDataPanel;break;case"material":this.m_materialPanel=new o.MaterialDataPanel,m=this.m_materialPanel;break;case"light":m=new h.LightDataPanel;break;default:m=new s.SettingDataPanel}return m.paramInputPanel=this.m_paramInputPanel,m.initialize(e,t,i,l),m}}t.DsrdUI=p},"2eea":function(e,t,i){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i("a7c5"),n=i("9bbe"),r=s(i("d33d"));class o extends a.SettingDataPanel{constructor(){super(),this.m_preModelName="",this.modelNames=[],this.uvScales=[1,1]}test(){}setJsonObj(e){if(super.setJsonObj(e),e["uvScales"]){let t=e["uvScales"];this.setStringValueToItem("uvScaleX",t[0]+""),this.setStringValueToItem("uvScaleY",t[1]+"")}}setModelNamesWithUrls(e){if(e&&e.length>0){this.modelNames.length>0&&(this.m_preModelName=this.modelNames[0]),this.modelNames=[];for(let t=0;t<e.length;t++){let i=e[t],s=""!=i?r.default.getFileName(i):"";this.modelNames.push(s)}this.updateData()}else this.modelNames=[]}getJsonStr(e="{",t="}"){let i=this.rscViewer.modelScene.getMaterialJsonObjs(),s='"materials":'+JSON.stringify(i);return s}updateData(e=null){if(this.modelNames.length>0){const t=this.modelNames[0];if(this.m_preModelName!=t){const i=this.rscViewer.modelScene;let s=i.getMaterialJsonObjFromNode(t);e=s}}null!=e&&(this.m_unlockDataChanged=!1,this.setJsonObj(e),this.m_unlockDataChanged=!0)}init(e){let t=[],i=new n.DataItemComponentParam;i.keyName="type",i.name="材质类型",i.textContent="BSDF",i.textValue="bsdf",i.toText(),t.push(i),i=new n.DataItemComponentParam,i.keyName="color",i.name="颜色",i.numberValue=16777215,i.editEnabled=!0,i.toColor(),t.push(i),i=new n.DataItemComponentParam,i.keyName="specular",i.name="反射率",i.numberValue=.5,i.inputType="number",i.floatNumberEnabled=!0,i.numberMinValue=0,i.numberMaxValue=3,i.editEnabled=!0,i.toNumber(),t.push(i),i=new n.DataItemComponentParam,i.keyName="metallic",i.name="金属度",i.numberValue=.5,i.inputType="number",i.floatNumberEnabled=!0,i.numberMinValue=0,i.numberMaxValue=3,i.editEnabled=!0,i.toNumber(),t.push(i),i=new n.DataItemComponentParam,i.keyName="roughness",i.name="粗糙度",i.numberValue=.5,i.inputType="number",i.floatNumberEnabled=!0,i.numberMinValue=0,i.numberMaxValue=3,i.editEnabled=!0,i.toNumber(),t.push(i),i=new n.DataItemComponentParam,i.keyName="normalStrength",i.name="凹凸强度",i.numberValue=1,i.inputType="number",i.floatNumberEnabled=!0,i.numberMinValue=0,i.numberMaxValue=3,i.editEnabled=!0,i.toNumber(),t.push(i),i=new n.DataItemComponentParam,i.keyName="uvScaleX",i.name="X轴UV缩放",i.numberValue=1,i.inputType="number",i.floatNumberEnabled=!0,i.numberMinValue=0,i.numberMaxValue=30,i.editEnabled=!0,i.autoEncoding=!1,i.toNumber(),t.push(i),i=new n.DataItemComponentParam,i.keyName="uvScaleY",i.name="Y轴UV缩放",i.numberValue=1,i.inputType="number",i.floatNumberEnabled=!0,i.numberMinValue=0,i.numberMaxValue=30,i.editEnabled=!0,i.autoEncoding=!1,i.toNumber(),t.push(i),this.m_params=t;let s=e=>{if(this.m_unlockDataChanged){this.rscViewer.imgViewer.setViewImageAlpha(.1);let t="";switch(e){case"uvScaleX":case"uvScaleY":let i=this.getItemCompByKeyName("uvScaleX").getParam(),s=this.getItemCompByKeyName("uvScaleY").getParam(),a=[i.numberValue,s.numberValue];t=`{"uvScales":[${a}]}`;break;default:let n=this.getItemParamByKeyName(e);t=`{${n.getJsonStr()}}`;break}let i=JSON.parse(t),s=this.modelNames;const a=this.rscViewer.modelScene;for(let e=0;e<s.length;e++)a.setMaterialParamToNodeByJsonObj(s[e],i)}},a=45,r=31,o=0;for(let n=0;n<t.length;++n){let e=t[n];this.createItemComponent(a+o,e),o+=r,e.editEnabled&&(e.onchange=s)}}}t.MaterialDataPanel=o},"3a06":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("2403"),a=i("47c8"),n=i("438a"),r=i("7191");class o{constructor(){this.m_viewerLayer=null,this.m_areaWidth=512,this.m_areaHeight=512,this.m_time=0,this.m_resLoaded=0,this.m_textViewer=null,this.onaction=null,this.rtaskSys=null,this.m_backBtn=null}initialize(e,t,i){this.m_viewerLayer=e,this.m_areaWidth=t,this.m_areaHeight=i}uploadFile(e){this.m_time=(new Date).getTime()-100,this.m_resLoaded=0,this.initUI(),this.uploadAndSendRendering(e)}open(){}close(){}initUI(){if(this.open(),null==this.m_textViewer){let e=r.DivTool.createDiv(320,300);this.m_viewerLayer.appendChild(e);let t=new s.HTMLViewerLayer(e);t.setTextAlign("center"),t.layoutToCenter(),this.m_textViewer=t}else this.m_textViewer.show();this.m_textViewer.setInnerHTML("uploading...")}setInnerHTML(e){null==this.m_textViewer&&this.initUI(),this.m_textViewer.setInnerHTML(e)}getTextDiv(){return this.m_textViewer.getDiv()}completeCall(e){let t=e.target.responseText+"",i=null;try{i=JSON.parse(t)}catch(a){i={success:!1}}let s="upload_success";if(i.success){const e=this.rtaskSys;e.process.toFirstRendering(),e.data.copyFromJson(i),e.infoViewer.reset(),e.infoViewer.infoDiv=this.getTextDiv(),e.startup()}else s="upload_svr_failed",this.toUploadFailure(s)}toUploadFailure(e){this.m_textViewer.setInnerHTML("上传失败...");let t=80,i=50,s=.5*(this.m_areaWidth-t),n=.5*(this.m_areaHeight-i)+20,o=this.m_backBtn;if(null==o){let l=r.DivTool.createDivT1(s,n,t,i,"flex","absolute",!0),h=[1408115,1403525,1401995];this.m_viewerLayer.appendChild(l),o=new a.ButtonDivItem,o.setDeselectColors(h),o.initialize(l,"返回","upload_back"),o.onmouseup=t=>{let i=t;o.hide(),this.m_textViewer.clearInnerHTML(),this.m_textViewer.hide(),this.onaction&&this.onaction(i.button_idns,e)},o.setTextColor(15658734),this.m_backBtn=o}o.show()}progressCall(e){let t="0%";e.lengthComputable&&(t=Math.round(e.loaded/e.total*100)+"%");var i=(new Date).getTime(),s=(i-this.m_time)/1e3;this.m_time=(new Date).getTime();var a=e.loaded-this.m_resLoaded;this.m_resLoaded=e.loaded;var n=a/s,r=n,o="B/s";n/1024>1&&(n/=1024,o="K/s"),n/1024>1&&(n/=1024,o="M/s");let l=n.toFixed(1)+o,h=((e.total-e.loaded)/r).toFixed(1),m="uploading "+t+"<br/>"+l+"<br/>rest time: "+h+"s";this.m_textViewer.setInnerHTML(m)}uploadAndSendRendering(e){if(null==e)return;if(!e)return alert("the file dosen't exist !!!"),void this.updatePage();let t=Math.floor(e.size/1048576),i=30;if(t>i)return alert("模型文件超过"+i+"M, 带宽太小暂时不支持 !!!"),void this.updatePage();let s=this.rtaskSys.request;s.sendUploadReq(e,e=>{this.completeCall(e)},(e,t)=>{this.toUploadFailure("upload_net_failed")},e=>{this.progressCall(e)},e=>{this.m_time=(new Date).getTime(),this.m_resLoaded=0}),e=null}updatePage(){n.HTTPTool.updatePage()}}t.RModelUploadingUI=o},"438a":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{}s.host="/",t.HTTPUrl=s;class a{static updatePage(){location.reload()}}t.HTTPTool=a},"47c8":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("2403");class a extends s.HTMLViewerLayer{constructor(){super(),this.m_btn_name="",this.m_btn_idns="",this.m_selected=!1,this.m_selectColors=[12442081,11457759,8635607],this.m_deselectColors=[8039642,4887509,3898293],this.group=null,this.onmousedown=null,this.onmouseup=null}initialize(e,t,i){let s=e.style;s.cursor="pointer",s.userSelect="none",this.setViewer(e),this.m_btn_name=t,this.m_btn_idns=i,e.innerHTML=t,this.initEvent(e),this.applyColorAt(0)}toRoundedRectangleStyle(e=null){e||(e=this.getStyle()),e.borderRadius="10px",e.outline="none",e.boxShadow="0 0 0 5px #7aacda"}setSelectColors(e){this.m_selectColors=e}setDeselectColors(e){this.m_deselectColors=e}getName(){return this.m_btn_name}getIdns(){return this.m_btn_idns}applyColorAt(e){let t=this.m_selected?this.m_selectColors:this.m_deselectColors;this.setBackgroundColor(t[e])}initEvent(e){e.onmouseover=e=>{this.applyColorAt(1)},e.onmouseout=e=>{this.applyColorAt(0)},e.onmouseup=e=>{this.select(),this.applyColorAt(1),this.onmouseup&&(e.buttonTarget=this,e.button_idns=this.m_btn_idns,this.onmouseup(e))},e.onmousedown=e=>{this.applyColorAt(2),this.onmousedown&&(e.buttonTarget=this,e.button_idns=this.m_btn_idns,this.onmousedown(e))}}isSelected(){return this.m_selected}select(){if(null!=this.group){let e=this.group,t=e.length;for(let i=0;i<t;++i)if(e[i].isSelected()){e[i].deselect();break}this.m_selected=!0,this.applyColorAt(0)}}deselect(){null!=this.group&&(this.m_selected=!1,this.applyColorAt(0))}}t.ButtonDivItem=a},"4f1d":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("a7c5"),a=i("9bbe");class n extends s.SettingDataPanel{constructor(){super()}getCamMatrixData(){return this.rscViewer.camView.getCameraData(.01,!0)}getJsonStr(e="{",t="}"){let i=`${e}"matrix":[${this.getCamMatrixData()}]`;return super.getJsonStr(i,t)}init(e){let t=[],i=new a.DataItemComponentParam,s=e=>{if(this.m_unlockDataChanged)switch(e){case"viewAngle":case"near":case"far":let e=this.getItemParamByKeyName("viewAngle"),t=this.getItemParamByKeyName("near"),i=this.getItemParamByKeyName("far");this.rscViewer.camView.setCamProjectParam(e.numberValue,100*t.numberValue,100*i.numberValue);break;default:break}};i.keyName="type",i.name="类型",i.textValue="perspective",i.toText(),t.push(i),i=new a.DataItemComponentParam,i.keyName="viewAngle",i.name="视角",i.numberValue=45,i.inputType="number",i.numberMinValue=0,i.numberMaxValue=180,i.unit="度",i.editEnabled=!0,i.toNumber(),i.onchange=s,t.push(i),i=new a.DataItemComponentParam,i.keyName="near",i.name="近平面",i.numberValue=.1,i.inputType="number",i.floatNumberEnabled=!0,i.numberMinValue=0,i.numberMaxValue=10,i.editEnabled=!0,i.unit="m",i.toNumber(),i.onchange=s,t.push(i),i=new a.DataItemComponentParam,i.keyName="far",i.name="远平面",i.numberValue=20,i.inputType="number",i.floatNumberEnabled=!0,i.numberMinValue=0,i.numberMaxValue=100,i.editEnabled=!0,i.unit="m",i.toNumber(),i.onchange=s,t.push(i),this.m_params=t;let n=95,r=50,o=0;for(let a=0;a<t.length;++a)this.createItemComponent(n+o,t[a]),o+=r}}t.CameraDataPanel=n},"538b":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("a7c5"),a=i("9bbe");class n extends s.SettingDataPanel{constructor(){super()}getJsonStr(e="{",t="}"){let i=this.getJsonBodyStr(e,t);return`"lights":[${i}]`}init(e){let t=[],i=new a.DataItemComponentParam;i.keyName="type",i.name="类型",i.textValue="point",i.toText(),t.push(i),i=new a.DataItemComponentParam,i.keyName="color",i.name="灯光颜色",i.numberValue=11202235,i.editEnabled=!0,i.toColor(),t.push(i),i=new a.DataItemComponentParam,i.keyName="power",i.name="灯光功率",i.numberValue=500,i.inputType="number",i.numberMinValue=0,i.numberMaxValue=5e4,i.editEnabled=!0,i.unit="W",i.toNumber(),t.push(i),i=new a.DataItemComponentParam,i.keyName="new_light",i.name="新建光源",i.textValue="...",i.toText(),i.autoEncoding=!1,t.push(i),this.m_params=t;let s=95,n=50,r=0;for(let a=0;a<t.length;++a)this.createItemComponent(s+r,t[a]),r+=n}}t.LightDataPanel=n},7191:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{static hArrangementDivs(e){if(e.length>0){let t=e[0].parentElement;if(t){let i=t.getBoundingClientRect(),s=0;for(let t=0;t<e.length;++t){const i=e[t].getBoundingClientRect();s+=i.width}let a=i.width-s,n=.5*a;a/=e.length+1,a<=0?a=0:n=.5*(i.width-s-a*(e.length-1));for(let t=0;t<e.length;++t){let i=e[t];const s=i.getBoundingClientRect();i.style.left=Math.round(n)+"px",n+=s.width+a}}}}static createDiv(e,t,i="",s="",a=!1){const n=document.createElement("div");let r=n.style;return e>0&&t>0&&(r.width=e+"px",r.height=t+"px"),r.display="block",""!=i&&(r.display=i),r.position="relative",""!=s&&(r.position=s),a&&(r.alignItems="center",r.justifyContent="center"),n}static createDivT1(e,t,i,s,a="",n="",r=!0){const o=document.createElement("div");let l=o.style;return l.left=e+"px",l.top=t+"px",i>0&&s>0&&(l.width=i+"px",l.height=s+"px"),l.display="block",""!=a&&(l.display=a),l.position="relative",""!=n&&(l.position=n),r&&(l.alignItems="center",l.justifyContent="center"),o}static clearDivAllEles(e){e.replaceChildren()}static setVisible(e,t){let i=e.style;i.visibility=t?"visible":"hidden"}static isVisible(e){return"visible"==e.style.visibility}static setTextColor(e,t){e.style.color="#"+t.toString(16)}}t.DivTool=s},"79c5":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("438a");class a{constructor(){this.taskReqSvrUrl="",this.taskInfoGettingUrl="",this.uploadModelUrl=""}getDomain(e){var t=/http:\/\/([^\/]+)/i;let i=e.match(t);return null!=i&&i.length>0?i[0]:""}getHostUrl(e){let t=location.href,i=this.getDomain(t),s=i.split(":");return t=s[0]+":"+s[1],e?t+":"+e+"/":i+"/"}initialize(){this.taskReqSvrUrl=s.HTTPUrl.host+"renderingTask",this.taskInfoGettingUrl=s.HTTPUrl.host+"getRTInfo",this.uploadModelUrl=s.HTTPUrl.host+"uploadRTData"}reset(){}updatePage(){s.HTTPTool.updatePage()}createReqUrlStr(e,t,i,s,a,n=""){let r=e+"?srcType=viewer&&phase="+t+"&progress="+i+n;return s>0&&(r+="&taskid="+s+"&taskname="+a),r}sendRerenderingReq(e="",t=!1){const i=this.data;let s=["output","env","camera"],a=this.data.rtJsonData,n="material";s.push(n);let r=a.getRTJsonStrByKeyNames(s,!0),o=JSON.parse(r);this.data.rnode=o,e+="&rnode="+r;let l=this.createReqUrlStr(this.taskReqSvrUrl,"query-re-rendering-task",0,i.taskid,i.taskname,e);this.sendnotifyTaskInfoReq(l)}sendUploadReq(e,t,i,s,a){let n=this.data.rtJsonData.getRTJsonStrByKeyNames(["output","env","camera"],!0),r=this.uploadModelUrl+"?srcType=viewer&phase=newrtask&rnode="+n,o=new FormData;o.append("file",e);let l=new XMLHttpRequest;l.open("post",r,!0),l.onload=e=>{t(e)},l.onerror=e=>{i(e,"upload_net_failed")},l.upload.onprogress=e=>{s(e)},l.upload.onloadstart=e=>{a(e)},l.send(o)}sendACommonGetReq(e,t){let i=new XMLHttpRequest;i.open("GET",e,!0),i.onerror=function(e){},i.onload=s=>{t&&t(e,i.response)},i.onerror=e=>{},i.send(null)}notifyRenderingInfoToSvr(e=""){const t=this.data;let i=this.createReqUrlStr(this.taskReqSvrUrl,"queryataskrst",0,t.taskid,t.taskname,e);this.sendnotifyTaskInfoReq(i)}notifyModelInfoToSvr(e=""){const t=this.data;let i=this.createReqUrlStr(this.taskReqSvrUrl,"queryataskrst",0,t.taskid,t.taskname,e);this.sendACommonGetReq(i,(e,t)=>{let i=JSON.parse(t);this.taskInfoViewer.parseModelReqInfo(i)})}notifySyncRStatusToSvr(e="",t=null){const i=this.data;let s=this.createReqUrlStr(this.taskInfoGettingUrl,"syncAnAliveTask",0,i.taskid,i.taskname,e);this.sendACommonGetReq(s,(e,i)=>{let s=JSON.parse(i);this.taskInfoViewer.parseSyncRStatuReqInfo(s,t)})}syncRTaskInfoFromSvr(e="",t){const i=this.data;let s=this.createReqUrlStr(this.taskInfoGettingUrl,"syncAnAliveTaskInfo",0,i.taskid,i.taskname,e);this.sendACommonGetReq(s,(e,i)=>{let s=JSON.parse(i);t&&t(s)})}sendnotifyTaskInfoReq(e){let t=new XMLHttpRequest;t.open("GET",e,!0),t.onerror=function(e){},t.onprogress=e=>{},t.onload=e=>{let i=JSON.parse(t.response);this.taskInfoViewer.parseRenderingReqInfo(i)},t.send(null)}syncAliveTasks(e){let t=this.createReqUrlStr(this.taskInfoGettingUrl,"syncAliveTasks",0,0,"none");this.sendACommonGetReq(t,(t,i)=>{var s=JSON.parse(i);let a=s.tasks;e(a)})}}t.RTaskRquest=a},"7d31":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9f0f");class a{constructor(){this.m_viewerLayer=null,this.m_rscViewerInited=!1,this.rscViewer=null,this.entity3DScene=new s.Entity3DScene,this.data=null,this.onaction=null,this.m_camParams=null,this.m_camvs16=null,this.m_viewImgUrls=null,this.selectedModelUrls=[]}initialize(e){this.m_viewerLayer=e,this.entity3DScene.scene=this;let t="static/cospace/dsrdiffusion/dsrdViewer/DsrdViewer.umd.js";this.loadModule(t)}updateDataWithCurrRNode(){let e=this.data.rnode;if(e){this.entity3DScene.updateMaterials();const t=e.camera;if(void 0!==t){void 0!==t.viewAngle&&void 0!==t.near&&void 0!==t.far&&this.setCamProjectParam(t.viewAngle,t.near,t.far);let e=t.matrix;void 0!==e&&this.setCameraWithF32Arr16(e)}}}setCamProjectParam(e,t,i){null==this.m_camParams&&(this.m_camParams=new Array(4));const s=this.m_camParams;s[0]=e,s[1]=100*t,s[2]=100*i,this.m_rscViewerInited&&this.rscViewer.camView.setCamProjectParam(s[0],s[1],s[2])}setCameraWithF32Arr16(e){this.m_camvs16=e,this.m_rscViewerInited&&this.m_camvs16&&this.rscViewer.camView.updateCameraWithF32Arr16(this.m_camvs16)}setViewImageUrls(e){this.m_viewImgUrls=e,this.m_rscViewerInited&&this.m_viewImgUrls&&this.rscViewer.imgViewer.setViewImageUrls(this.m_viewImgUrls)}init3DScene(){let e=new DsrdViewer.DsrdViewer,t=this;t.rscViewer=e;let i=!0,s=location.href;s=s.toLowerCase(),s.indexOf("diffusion")>0&&(i=!1);let a=!i;e.initialize(this.m_viewerLayer,()=>{this.m_rscViewerInited=!0,this.m_viewImgUrls&&this.rscViewer.imgViewer.setViewImageUrls(this.m_viewImgUrls);const t=this.m_camParams;t&&this.rscViewer.camView.setCamProjectParam(t[0],t[1],t[2]),this.m_camvs16&&e.updateCameraWithF32Arr16(this.m_camvs16)},!0,i,a),e.setForceRotate90(!0),this.entity3DScene.setRSCViewer(e),e.setModelSelectListener(e=>{this.selectedModelUrls=e,this.onaction&&this.onaction("select_a_model","finish")}),this.onaction&&this.onaction("rsc_viewer_loaded","finish")}loadModule(e){let t=new XMLHttpRequest;t.open("GET",e,!0),t.onerror=function(e){},t.onprogress=e=>{},t.onload=()=>{let e=document.createElement("script");e.onerror=e=>{},e.innerHTML=t.response,document.head.appendChild(e),this.init3DScene()},t.send(null)}run(){this.rscViewer&&this.rscViewer.run()}}t.DsrdScene=a},8448:function(e,t,i){"use strict";function s(e,t,i){return Math.max(Math.min(e,i),t)}function a(e){let t=e.toString(16),i="000000",s=i.length-t.length;return s>0&&(t=i.slice(0,s)+t),t}function n(e){let t=e.replace(/[^\a,b,c,d,e,f\0-9]/g,"");if(t.length<1)t="0";else if(t.length>6){let e=t.length-6;t=t.slice(e)}return t}function r(e,t,i){let a=e.replace(/[^\.\0-9]/g,""),n=parseFloat(a);return isNaN(n)&&(n=0),n=Math.round(n),n=s(n,t,i),a=n+"",a}function o(e,t,i){let a=e.replace(/[^\.\0-9]/g,""),n=parseFloat(a);return isNaN(n)&&(n=0),n=s(n,t,i),a=n.toFixed(4),n=parseFloat(a),a=n+"",a.indexOf(".")<1&&(a+=".0"),a}Object.defineProperty(t,"__esModule",{value:!0});class l{constructor(){this.keyName="",this.name="",this.unit="",this.compType="number",this.editEnabled=!1,this.mobileWebEnabled=!1,this.inputType="text",this.numberMinValue=-16777215,this.numberMaxValue=16777215,this.floatNumberEnabled=!1,this.autoEncoding=!0,this.onchange=null}getJsonStr(){let e=this.getCurrValueString(!1);return e="text"==this.compType?`"${e}"`:e,`"${this.keyName}":${e}`}toNumber(){this.compType="number"}toBoolean(){this.compType="boolean"}toText(){this.compType="text"}toColor(){this.compType="color"}updateColorValueStr(e){let t=n(e);this.numberValue=parseInt("0x"+t)}updateFloatNumberValueStr(e){let t=o(e,this.numberMinValue,this.numberMaxValue);this.numberValue=parseFloat(t)}updateIntegerNumberValueStr(e){let t=r(e,this.numberMinValue,this.numberMaxValue);this.numberValue=parseInt(t)}updateValueWithStr(e,t=!0,i=!0){let s=!1;switch(this.compType){case"color":let t=this.numberValue;this.updateColorValueStr(e),s=this.numberValue!=t;break;case"number":let i=this.numberValue;this.floatNumberEnabled?this.updateFloatNumberValueStr(e):this.updateIntegerNumberValueStr(e),s=Math.abs(this.numberValue-i)>1e-4;break;case"text":let a="";void 0!==this.textContent?a=this.textContent:void 0!==this.textValue&&(a=this.textValue),void 0!==this.textContent?this.textContent=e:void 0!==this.textValue&&(this.textValue=e),s=e!=a;break;case"boolean":e=e.toLowerCase();let n=this.booleanValue;switch(e){case"是":case"1":case"yes":case"y":case"ok":case"t":case"true":this.booleanValue=!0;break;default:this.booleanValue=!1;break}s=n!=this.booleanValue;break;default:break}t&&this.displayToViewer(),i&&s&&this.onchange&&this.editEnabled&&this.onchange(this.keyName)}initEvents(){if(this.editEnabled)if(this.mobileWebEnabled)this.body_viewer.onmouseup=e=>{this.paramPanel&&(this.paramPanel.setParam(this),this.paramPanel.open())};else{let e=this.body_viewer;switch(e.type="text",this.compType){case"color":"text"==this.inputType&&(e.onblur=t=>{this.updateValueWithStr(e.value)});break;default:"number"==this.inputType&&(this.floatNumberEnabled,e.onblur=t=>{this.updateValueWithStr(e.value)})}}else{let e=this.body_viewer;switch(this.compType){case"boolean":e.onmouseup=e=>{this.booleanValue=!this.booleanValue,this.updateValueWithStr(this.booleanValue+"")};break}}}getCurrValueString(e=!0){let t="",i="";switch(this.compType){case"number":case"text":e?(i=this.unit,void 0!==this.numberValue?t=this.numberValue+"":void 0!==this.textContent?t=this.textContent:void 0!==this.textValue&&(t=this.textValue)):void 0!==this.numberValue?t=this.numberValue+"":void 0!==this.textValue?t=this.textValue:void 0!==this.textContent&&(t=this.textContent);break;case"boolean":t=e?this.booleanValue?"是":"否":this.booleanValue?"1":"0";break;case"color":t=e?a(this.numberValue):this.numberValue+"";break}return e?t+i:t}displayToViewer(){let e=this.head_viewer,t=this.body_viewer;e.innerHTML=this.name;let i=this.getCurrValueString(!0);""!=i&&(this.editEnabled?this.mobileWebEnabled?t.innerHTML=i:t.value=i:t.innerHTML=i)}}t.DataItemComponentParam=l},8875:function(e,t,i){var s,a,n;(function(i,r){a=[],s=r,n="function"===typeof s?s.apply(t,a):s,void 0===n||(e.exports=n)})("undefined"!==typeof self&&self,(function(){function e(){var t=Object.getOwnPropertyDescriptor(document,"currentScript");if(!t&&"currentScript"in document&&document.currentScript)return document.currentScript;if(t&&t.get!==e&&document.currentScript)return document.currentScript;try{throw new Error}catch(c){var i,s,a,n=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,r=/@([^@]*):(\d+):(\d+)\s*$/gi,o=n.exec(c.stack)||r.exec(c.stack),l=o&&o[1]||!1,h=o&&o[2]||!1,m=document.location.href.replace(document.location.hash,""),u=document.getElementsByTagName("script");l===m&&(i=document.documentElement.outerHTML,s=new RegExp("(?:[^\\n]+?\\n){0,"+(h-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),a=i.replace(s,"$1").trim());for(var d=0;d<u.length;d++){if("interactive"===u[d].readyState)return u[d];if(u[d].src===l)return u[d];if(l===m&&u[d].innerHTML&&u[d].innerHTML.trim()===a)return u[d]}return null}}return e}))},8900:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("47c8"),a=i("c32b"),n=i("3a06"),r=i("7191");class o{constructor(){this.m_viewerLayer=null,this.m_areaWidth=512,this.m_areaHeight=512,this.m_uploadModelBtn=null,this.m_openTasksListBtn=null,this.m_dropController=new a.DropFileController,this.m_uploadUI=new n.RModelUploadingUI,this.onaction=null,this.rtaskSys=null,this.m_dropEnabled=!0,this.m_tasksListDiv=null,this.m_backFromTaskListBtn=null}initialize(e,t,i){this.m_viewerLayer=e,this.m_areaWidth=t,this.m_areaHeight=i,this.buildBtns(this.m_viewerLayer),this.m_dropController.geomModelKeys.push("glb","usdz","usdc","blend","bld"),this.m_dropController.createObjectURLEnabled=!1,this.m_dropController.initialize(e,this),this.m_uploadUI.rtaskSys=this.rtaskSys,this.m_uploadUI.initialize(this.m_viewerLayer,t,i),this.m_uploadUI.onaction=(e,t)=>{switch(e){case"upload_back":this.m_uploadModelBtn.setVisible(!0),this.m_openTasksListBtn.setVisible(!0);break}}}initFileLoad(e){this.m_uploadModelBtn.setVisible(!1),this.m_openTasksListBtn.setVisible(!1),this.m_uploadUI.uploadFile(e[0].file)}isDropEnabled(){return this.m_dropEnabled}openDir(){const e=document.createElement("input");e.type="file",e.accept=".glb,.fbx,.obj,.usdz,.usdc,.blend,.bld",e.addEventListener("change",()=>{let t=Array.from(e.files);this.m_dropController.initFilesLoad(t)}),e.click()}showTasksList(e){this.m_uploadModelBtn.setVisible(!1),this.m_openTasksListBtn.setVisible(!1),this.buildTasksList(e)}gotoAliveTask(e){const t=this.rtaskSys;t.data.copyFromJson(e),t.process.toFirstRendering(),t.syncRendering=!0,t.infoViewer.reset(),this.m_uploadUI.initUI(),t.infoViewer.infoDiv=this.m_uploadUI.getTextDiv(),t.startup(),t.request.syncRTaskInfoFromSvr("",e=>{void 0!==e.task&&(t.data.rnode=e.task.rnode,t.updateRNode())}),this.m_tasksListDiv.style.visibility="hidden",this.m_backFromTaskListBtn.setVisible(!1)}backFromTasksList(){this.m_tasksListDiv.style.visibility="hidden",this.m_backFromTaskListBtn.setVisible(!1),this.m_uploadModelBtn.setVisible(!0),this.m_openTasksListBtn.setVisible(!0)}initInfoDiv(){let e=this.m_tasksListDiv;if(null==e){let t=320,i=.5*(this.m_areaWidth-t),s=50;this.m_tasksListDiv=r.DivTool.createDivT1(i,s,t,100,"flex","absolute",!1),e=this.m_tasksListDiv;let a=e.style;a.textAlign="center",a.display="block",this.m_viewerLayer.appendChild(e)}}buildTasksList(e){this.initInfoDiv();let t=this.m_tasksListDiv;if(null==this.m_backFromTaskListBtn){let e=80,t=50,i=.5*(this.m_areaWidth-e),a=this.m_areaHeight-t-20,n=r.DivTool.createDivT1(i,a,e,t,"flex","absolute",!0),o=[1408115,1403525,1401995];this.m_viewerLayer.appendChild(n);let l=new s.ButtonDivItem;l.setDeselectColors(o),l.initialize(n,"返回","back_from_tasks_list"),l.onmouseup=e=>{this.backFromTasksList()},this.m_backFromTaskListBtn=l,l.setTextColor(15658734)}this.m_tasksListDiv.style.visibility="visible",this.m_backFromTaskListBtn.setVisible(!0),r.DivTool.clearDivAllEles(t);let i=e.length;i>0&&e.sort((e,t)=>e.ctime-t.ctime);for(let s=0;s<i;++s){let i=document.createElement("br");t.appendChild(i);let a=document.createElement("a");a.innerHTML=`渲染任务<<b><font color="#008800">${e[s].taskname}</font></b>>`,a.href="#",a.addEventListener("click",()=>{this.gotoAliveTask(e[s])}),t.appendChild(a),i=document.createElement("br"),t.appendChild(i)}let a=document.createElement("br");t.appendChild(a),a=document.createElement("br"),t.appendChild(a)}buildBtns(e){let t=[1408115,1403525,1401995],i=150,a=60,n=50,o=.5*(this.m_areaWidth-(2*i+n)),l=.5*(this.m_areaHeight-2*a)+30,h=r.DivTool.createDivT1(o,l,i,a,"flex","absolute",!0);e.appendChild(h);let m=new s.ButtonDivItem;m.setDeselectColors(t),m.initialize(h,"新建渲染任务","upload_model"),m.toRoundedRectangleStyle(),m.applyColorAt(0),m.onmouseup=e=>{this.openDir()},m.setTextColor(15658734),this.m_uploadModelBtn=m,h=r.DivTool.createDivT1(o+n+i,l,i,a,"flex","absolute",!0),e.appendChild(h),m=new s.ButtonDivItem,m.setDeselectColors(t),m.initialize(h,"打开任务列表","open_task_list"),m.toRoundedRectangleStyle(),m.applyColorAt(0),m.onmouseup=e=>{let t=this.rtaskSys.request;t.syncAliveTasks(e=>{e&&e.length>0?this.showTasksList(e):alert("没有可操作的其他渲染任务")})},m.setTextColor(15658734),this.m_openTasksListBtn=m}setInnerHTML(e){this.initInfoDiv(),this.m_tasksListDiv.innerHTML=e}open(){this.m_viewerLayer.style.visibility="visible"}close(){this.m_viewerLayer.style.visibility="hidden"}}t.RTaskBeginUI=o},"9bbe":function(e,t,i){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i("7191"),n=i("8448");t.DataItemComponentParam=n.DataItemComponentParam;const r=s(i("ebbb"));class o{constructor(){this.m_areaWidth=512,this.m_areaHeight=512,this.m_isMobileWeb=!1,this.height=23,this.x=45,this.y=50}initialize(e,t,i,s){this.m_areaWidth=e,this.m_areaHeight=t,this.m_viewerLayer=i,this.m_param=s,this.m_isMobileWeb=r.default.IsMobileWeb(),this.init(i,s)}getKeyName(){return this.m_param.keyName}getParam(){return this.m_param}init(e,t){let i=this.height,s=Math.floor(.5*this.m_areaWidth)-2,n=a.DivTool.createDivT1(2,this.y,2*s+2,i,"block","absolute",!1),r=n.style,o=a.DivTool.createDivT1(0,0,s,i,"block","absolute",!1),l=a.DivTool.createDivT1(s+1,0,s,i,"block","absolute",!1);r=o.style,r.background="#286dab",r.color="#eeeeee",r=l.style,r.background="#286dab",r.color="#eeeeee",e.appendChild(n),this.m_containerDiv=n,this.m_headDiv=o,this.m_bodyDiv=l,t.head_viewer=o,t.body_viewer=l,this.createInput(l,t,s,i),n.appendChild(o),n.appendChild(l),t.mobileWebEnabled=this.m_isMobileWeb,t.displayToViewer(),t.initEvents()}createInput(e,t,i,s){if(t.editEnabled)if(this.m_isMobileWeb);else{var a=document.createElement("input");let n=a.style;n.position="absolute",n.left="0px",n.top="0px",n.width=i+"px",n.height=s+"px",n.background="transparent",n.borderWidth="0px",n.outline="none",n.color="#eeeeee",n.fontSize="17px",n.textAlign="center",n.userSelect="none",e.append(a),this.m_input=a,t.body_viewer=a}}}t.DataItemComponent=o},"9f0f":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.m_rscViewer=null,this.request=null,this.process=null,this.data=null,this.infoViewer=null,this.scene=null}setRSCViewer(e){this.m_rscViewer=e}isModelDataLoaded(){return 2==this.data.modelLoadStatus}rerendering(){this.m_rscViewer.imgViewer.setViewImageAlpha(.1)}updateMaterials(){let e=this.data.rnode;e&&(this.m_rscViewer.modelScene.setMaterialParamToNodesByJsonObjs(e.materials),this.data.rtJsonData.setRTDataFromRNode(this.data.rnode))}loadModel(){const e=this.data,t=this.process;if(0==e.modelLoadStatus&&t.isModelFinish()){(t.isAllFinish()||t.isSyncModelStatus())&&this.infoViewer.showSpecInfo("正在载入模型数据"),e.modelLoadStatus=1;let i=this.request,s="",a=i.createReqUrlStr(i.taskInfoGettingUrl,"modelToDrc",0,e.taskid,e.taskname,s);return i.sendACommonGetReq(a,(t,s)=>{var a=JSON.parse(s);let n=i.getHostUrl(9090)+a.filepath.slice(2),r=n+"status.json";i.sendACommonGetReq(r,(t,i)=>{let s=JSON.parse(i),a=s.list,r=a.length,o=[],l=[];for(let e=0;e<r;e++){let t=n+a[e];o.push(t),l.push("drc")}e.drcNames=a.slice(0);const h=this.m_rscViewer;h&&(h.initSceneByUrls(o,l,e=>{e>=1&&this.updateMaterials()},200),h.imgViewer.setViewImageFakeAlpha(.1)),e.modelLoadStatus=2,this.testTaskFinish()})}),!0}return t.isSyncModelStatus()?(t.running=!1,this.request.notifyModelInfoToSvr()):t.isFirstRendering()&&this.testTaskFinish(),!1}testTaskFinish(){const e=this.data,t=this.process;t.isAllFinish()&&!e.currentTaskAlive&&this.isModelDataLoaded()&&(e.currentTaskAlive=!0,this.scene.setViewImageUrls(e.miniImgUrls),t.toSyncRStatus())}}t.Entity3DScene=s},a7c5:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9bbe"),a=i("7191"),n=i("2403");class r extends n.HTMLViewerLayer{constructor(){super(),this.m_viewerLayer=null,this.m_container=null,this.m_itemData=null,this.m_areaWidth=512,this.m_areaHeight=512,this.m_itemCompDict=new Map,this.m_isActive=!1,this.m_unlockDataChanged=!0,this.paramInputPanel=null}initialize(e,t,i,s){this.m_viewerLayer=e,this.m_areaWidth=t,this.m_areaHeight=i,this.m_itemData=s,this.m_container=a.DivTool.createDivT1(0,0,t,t,"","absolute",!1),e.appendChild(this.m_container),this.setViewer(this.m_container),this.init(this.m_container),this.setVisible(!1)}setJsonObj(e){this.setJsonDataToItems(e)}setStringValueToItem(e,t){if(""!=e){const i=this.getItemParamByKeyName(e);i&&i.updateValueWithStr(t+"",!0)}}setJsonDataToItems(e){if(null!=e)for(var t in e)if(e[t]){const i=this.getItemParamByKeyName(t);if(i)switch(i.compType){case"color":i.updateValueWithStr(e[t].toString(16),!0);break;default:i.updateValueWithStr(e[t]+"",!0);break}}}getName(){return this.m_itemData.name}getKeyName(){return this.m_itemData.type}getType(){return this.m_itemData.type}getJsonBodyStr(e="{",t="}"){let i=this.m_params,s=e,a=e.length>1?",":"";for(let n=0;n<i.length;n++){const e=i[n];e.autoEncoding&&(s+=a+e.getJsonStr(),a=",")}return s+=t,s}getJsonStr(e="{",t="}"){return`"${this.getKeyName()}":${this.getJsonBodyStr(e,t)}`}addItemComp(e){e.getParam().paramPanel=this.paramInputPanel,this.m_itemCompDict.set(e.getKeyName(),e)}getItemCompByKeyName(e){return this.m_itemCompDict.get(e)}getItemParamByKeyName(e){let t=this.m_itemCompDict.get(e);return t?t.getParam():null}getItemParams(){return this.m_params}init(e){}isActive(){return this.m_isActive}createItemComponent(e,t){let i=new s.DataItemComponent;return i.y=e,i.initialize(this.m_areaWidth,this.m_areaHeight,this.m_container,t),this.addItemComp(i),i}updateData(e=null){e&&(this.m_unlockDataChanged=!1,this.setJsonObj(e),this.m_unlockDataChanged=!0)}}t.SettingDataPanel=r},b66b:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("06e0");t.IRTaskDataParam=s.IRTaskDataParam,t.RTaskData=s.RTaskData;const a=i("23ff"),n=i("79c5"),r=i("c758");class o{constructor(){this.m_startup=!0,this.process=new r.RTaskProcess,this.data=new s.RTaskData,this.request=new n.RTaskRquest,this.infoViewer=new a.RTaskInfoViewer,this.modelScene=null,this.onaction=null,this.m_timerId=-1,this.syncRendering=!1,this.m_rerenderingTimes=0,this.m_workSpaceStatus=0,this.m_preRTDataFinish=!1}initialize(){this.infoViewer.data=this.data,this.infoViewer.process=this.process,this.infoViewer.initialize(),this.request.data=this.data,this.request.taskInfoViewer=this.infoViewer,this.request.initialize()}startup(){this.m_startup&&(this.m_startup=!1,this.timerUpdate())}setProcess(e){}setTimerDelay(e){this.process.timerDelay=e}updateRNode(){this.onaction&&this.onaction("update-rnode","new")}timerUpdate(){this.m_timerId>-1&&clearTimeout(this.m_timerId),this.m_timerId=setTimeout(this.timerUpdate.bind(this),this.process.timerDelay);const e=this.data,t=this.process,i=this.modelScene;this.isRTDataFinish();if(t.running&&!t.isError()){switch(this.process.type){case r.RTPType.SyncRStatus:t.running=!1,this.request.notifySyncRStatusToSvr("",e=>{"current_rendering_begin"==e&&(this.syncRendering=!0,this.onaction&&this.onaction("curr-rendering","new"))});break;case r.RTPType.CurrRendering:if(t.isAllFinish()){this.modelScene.scene.setViewImageUrls(e.miniImgUrls),this.onaction&&this.onaction("curr-rendering","finish");const i=this;this.syncRendering?i.request.syncRTaskInfoFromSvr("",e=>{void 0!==e.task&&(i.data.rnode=e.task.rnode,i.updateRNode())}):i.updateRNode(),t.toSyncRStatus()}else t.running=!1,this.request.notifyRenderingInfoToSvr();break;case r.RTPType.FirstRendering:t.isRunning()?(i.loadModel(),t.isRenderingFinish()?t.isModelFinish()||t.toSyncModelStatus():(t.running=!1,this.request.notifyRenderingInfoToSvr())):t.isAllFinish()&&i.loadModel();break;case r.RTPType.SyncModelStatus:i.loadModel();break;default:break}this.isRTDataFinish()&&this.toWorkSpace()}this.m_preRTDataFinish=this.isRTDataFinish()}rerendering(){return!!this.isTaskAlive()&&(this.m_rerenderingTimes++,this.infoViewer.reset(),this.process.toCurrRendering(),this.request.sendRerenderingReq(),this.onaction&&this.onaction("curr-rendering","new"),this.modelScene.rerendering(),!0)}toWorkSpace(){0==this.m_workSpaceStatus&&(this.m_workSpaceStatus=1,this.onaction&&this.onaction("toWorkSpace","finish"))}isRTDataFinish(){return this.data.isModelDataLoaded()&&this.process.isAllFinish()}isTaskAlive(){return this.data.isCurrTaskAlive()}}t.RTaskSystem=o},b800:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("9bbe"),a=i("7191"),n=i("2403"),r=i("47c8");class o{constructor(){this.m_viewerLayer=null,this.m_areaWidth=512,this.m_areaHeight=512,this.m_confirmBtn=null,this.m_itemParam=new s.DataItemComponentParam,this.viewLayer=new n.HTMLViewerLayer,this.m_param=null}setParam(e){e!=this.m_itemParam&&(null!=e&&(this.m_itemParam.editEnabled=!0,this.m_itemParam.floatNumberEnabled=e.floatNumberEnabled,this.m_itemParam.compType=e.compType,this.m_itemParam.name=e.name,this.m_itemParam.updateValueWithStr(e.getCurrValueString())),this.m_param=e)}initialize(e,t,i,s){this.m_viewerLayer=e,this.m_areaWidth=t,this.m_areaHeight=i,this.viewLayer.setViewer(this.m_viewerLayer);let n=80,o=50,l=.5*(this.m_areaWidth-n),h=.7*this.m_areaHeight,m=a.DivTool.createDivT1(l,h,n,o,"flex","absolute",!0),u=[1408115,1403525,1401995];this.m_viewerLayer.appendChild(m);let d=new r.ButtonDivItem;d.setDeselectColors(u),d.initialize(m,"确认","confirm_param_update"),d.onmouseup=e=>{this.applyParamValue()},this.m_confirmBtn=d,d.setTextColor(15658734),this.init(e,t,i),this.open()}applyParamValue(){""!=this.m_input.value&&null!=this.m_param&&this.m_param.updateValueWithStr(this.m_input.value),this.close()}init(e,t,i){let s=50,n=Math.floor(.5*t)-2,r=a.DivTool.createDivT1(2,20,2*n+2,s,"block","absolute",!1),o=r.style,l=a.DivTool.createDivT1(0,0,n,s,"flex","absolute",!1),h=a.DivTool.createDivT1(n+1,0,n,s,"block","absolute",!1);o=l.style,o.textAlign="center",o.alignItems="center",o.justifyContent="center",o.background="#286dab",o.color="#eeeeee",o=h.style,o.background="#286dab",o.color="#eeeeee",r.appendChild(l),r.appendChild(h),e.appendChild(r),this.createInput(h,n,s);let m=this.m_itemParam;m.editEnabled=!0,m.head_viewer=l,m.body_viewer=this.m_input,m.initEvents()}createInput(e,t,i){var s=document.createElement("input");let a=s.style;a.position="absolute",a.left="0px",a.top="0px",a.width=t+"px",a.height=i+"px",a.background="transparent",a.borderWidth="0px",a.outline="none",a.color="#eeeeee",a.fontSize="17px",a.textAlign="center",a.userSelect="none",e.append(s),this.m_input=s,s.onkeyup=e=>{let t=e.key+"";"Enter"==t&&this.applyParamValue()}}setVisible(e){this.viewLayer.setVisible(e)}isVisible(){return this.viewLayer.isVisible()}open(){this.isVisible()||this.setVisible(!0)}isOpen(){return this.isVisible()}close(){this.isVisible()&&(this.m_input.value="",this.setParam(null),this.setVisible(!1))}}t.ParamInputPanel=o},c32b:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{constructor(){this.m_htmlObj=null,this.m_listener=null,this.m_files=null,this.imgKeys=["jpg","jpeg","png","gif","bmp","webp","jfif","ico","avif"],this.geomModelKeys=["obj","ctm","draco","drc","fbx"],this.createObjectURLEnabled=!0}initialize(e,t){null==this.m_htmlObj&&(this.m_htmlObj=e,this.m_listener=t,this.initDrop(this.m_htmlObj))}initDrop(e){e.addEventListener("dragenter",e=>{e.preventDefault(),e.stopPropagation()},!1),e.addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation()},!1),e.addEventListener("dragleave",e=>{e.preventDefault(),e.stopPropagation()},!1),e.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation(),this.receiveDropFile(e)},!1)}receiveDropFile(e){if(this.m_files=null,this.m_listener.isDropEnabled()){let t=e.dataTransfer,i=[],s=0,a=0;if(void 0!==t.items){let e=t.items;for(let t=0;t<e.length;t++){let n=e[t],r=n.webkitGetAsEntry();if(null!=r)if(r.isFile){let e=n.getAsFile();i.push(e),this.initFilesLoad(i,"drop"),s=1}else if(r.isDirectory){let e=r.createReader();e.readEntries(e=>{s=e.length,s>0?e.forEach(e=>{e.isFile&&e.file(e=>{i.push(e),a++,s==a&&this.initFilesLoad(i,"drop")})}):this.alertShow(31)});break}if(s>0)break}this.m_files=i}}}alertShow(e){switch(e){case 31:alert("无法找到或无法识别对应的文件");break;default:break}}initFilesLoad(e,t="undefine"){this.m_files=null,this.m_listener&&(this.m_files=e,this.m_listener.initFileLoad(this.getFiles(),t))}testFile(e){let t=e.toLocaleLowerCase(),i="";return t.lastIndexOf(".")>0&&(i=t.slice(t.lastIndexOf(".")+1)),this.imgKeys.includes(i)?{name:e,type:i,resType:s.Image_File,url:""}:this.geomModelKeys.includes(i)?{name:e,type:i,resType:s.Geometry_Model_File,url:""}:null}getFiles(){let e=1,t=this.m_files;if(t){if(t.length>0){let e=[];for(let i=0;i<t.length;i++){let s=this.testFile(t[i].name);s&&(this.createObjectURLEnabled?s.url=window.URL.createObjectURL(t[i]):s.file=t[i],e.push(s))}return e}e=31}return this.alertShow(e),null}}s.Image_File="image",s.Geometry_Model_File="geometryModel",t.DropFileController=s},c758:function(e,t,i){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e["None"]=0]="None",e[e["FirstRendering"]=1]="FirstRendering",e[e["CurrRendering"]=2]="CurrRendering",e[e["SyncRStatus"]=3]="SyncRStatus",e[e["SyncModelStatus"]=4]="SyncModelStatus"}(s||(s={})),t.RTPType=s;class a{constructor(){this.timerDelay=800,this.type=s.FirstRendering,this.renderingPhase="new",this.modelPhase="new",this.running=!0}updateModel(e){e>0&&"finish"!=this.modelPhase&&(this.modelPhase="finish")}isAllFinish(){return this.isModelFinish()&&this.isRenderingFinish()}isRenderingFinish(){let e="finish"==this.renderingPhase;return e}isModelFinish(){let e="finish"==this.modelPhase;return e}isRunning(){let e=!this.isModelFinish()||!this.isRenderingFinish();return e}isError(){let e="error"==this.renderingPhase||"rtaskerror"==this.renderingPhase;return e=e||"error"==this.modelPhase||"rtaskerror"==this.modelPhase,e}toFirstRendering(){this.renderingPhase="new",this.modelPhase="new",this.type=s.FirstRendering}isFirstRendering(){return this.type==s.FirstRendering}toCurrRendering(){this.renderingPhase="new",this.timerDelay=800,this.type=s.CurrRendering}isCurrRendering(){return this.type==s.CurrRendering}toSyncRStatus(){this.timerDelay=2500,this.type=s.SyncRStatus}isSyncRStatus(){return this.type==s.SyncRStatus}toSyncModelStatus(){this.modelPhase="new",this.timerDelay=1500,this.type=s.SyncModelStatus}isSyncModelStatus(){return this.type==s.SyncModelStatus}}t.RTaskProcess=a},d33d:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{static getDomain(e){var t=/http:\/\/([^\/]+)/i;let i=e.match(t);return null!=i&&i.length>0?i[0]:""}static getHostUrl(e,t="/"){let i=location.href,a=s.getDomain(i),n=a.split(":");return i=n[0]+":"+n[1],e?i+":"+e+"/":a+t}static isEnabled(){let e=window.location.href;return e.indexOf(".artvily.com")>0}static filterUrl(e){if(e.indexOf("blob:")<0){let t=window.location.href;t.indexOf(".artvily.")>0&&(t="http://www.artvily.com:9090/",e=t+e)}return e}static getFileName(e,t=!1,i=!1){if(e.indexOf("blob:")<0||i){let i=e.lastIndexOf("/");if(i<0)return"";let s=e.lastIndexOf(".",e.length);if(s<0)return"";if(i+2<s){let a=e.slice(i+1,s);return t?a.toLocaleLowerCase():a}}return""}static getFileNameAndSuffixName(e,t=!1,i=!1){if(e.indexOf("blob:")<0||i){let i=e.lastIndexOf("/"),s=e.lastIndexOf(".",e.length);if(s<0)return"";let a=e.slice(i+1);return t?a.toLocaleLowerCase():a}return""}static getFileSuffixName(e,t=!1,i=!1){if(e.indexOf("blob:")<0||i){let i=e.lastIndexOf(".",e.length);if(i<0)return"";let s=e.slice(i+1);return t?s.toLocaleLowerCase():s}return""}}t.default=s},ebbb:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{static SetWebBodyColor(e="white"){const t=document.body;t.style.background=e}static SetLanguage(e){s.s_language=e}static IsChineseLanguage(){let e=s.GetLanguage();return"zh-CN"==e}static GetLanguage(){return""!=s.s_language||(s.s_language=navigator.language),s.s_language}static GetDevicePixelRatio(){return window.devicePixelRatio}static IsWindowsPCOS(){return!(s.IsSafariWeb()||s.IsMobileWeb())}static TestSafariWeb(){return/Safari/.test(navigator.userAgent)&&/Mac OS/.test(navigator.userAgent)}static IsMobileWeb(){return s.s_mobileFlag>0?2==s.s_mobileFlag:s.TestMobileWeb()}static IsSafariWeb(){return s.s_safariFlag>0||(s.s_safariFlag=s.TestSafariWeb()?2:1),2==s.s_safariFlag}static IsIOS(){if(s.s_IOS_Flag>0)return 2==s.s_IOS_Flag;let e=!1;return e=!!/iPad|iPhone|iPod/.test(navigator.platform)||void 0!=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),s.s_IOS_Flag=e?2:1,e}static IsIpadOS(){if(s.s_IPad_Flag>0)return 2==s.s_IPad_Flag;let e=navigator.maxTouchPoints>0&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform);return!e&&/iPod|iPad|iPadPro|iPodPro/i.test(navigator.userAgent)&&(e=!0),s.s_IPad_Flag=e?2:1,e}static IsAndroidOS(){if(s.s_Android_Flag>0)return 2==s.s_Android_Flag;let e=s.TestMobileWeb();return e=!(!e||!/Android|Linux/i.test(navigator.userAgent)),s.s_Android_Flag=e?2:1,e}static TestMobileWeb(){return s.s_mobileFlag>0?2==s.s_mobileFlag:/mobile/.test(location.href)?(s.s_mobileFlag=2,2==s.s_mobileFlag):/Android/i.test(navigator.userAgent)?/Mobile/i.test(navigator.userAgent)?(s.s_mobileFlag=2,2==s.s_mobileFlag):(s.s_mobileFlag=1,2==s.s_mobileFlag):/webOS|iPhone|iPod|iPad|iPodPro|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(s.s_mobileFlag=2,2==s.s_mobileFlag):(s.s_mobileFlag=1,2==s.s_mobileFlag)}}s.s_mobileFlag=0,s.s_safariFlag=0,s.s_Android_Flag=0,s.s_IOS_Flag=0,s.s_IPad_Flag=0,s.s_language="",t.default=s},edb0:function(e,t,i){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i("7d31"),n=i("24cc"),r=i("8900"),o=i("b66b"),l=i("7191"),h=s(i("ebbb"));class m{constructor(){this.m_init=!0,this.m_rscene=new a.DsrdScene,this.m_ui=new n.DsrdUI,this.m_rtaskBeginUI=new r.RTaskBeginUI,this.m_rtaskSys=new o.RTaskSystem,this.m_entity3DScene=null,this.m_isMobileWeb=!1,this.m_viewerLayer=null,this.mIDV=null,this.m_areaWidth=512,this.m_areaHeight=512,this.m_layoutHorizon=!0,this.m_workSpaceStatus=0}initialize(){document.body.onload=e=>{this.init()}}init(){if(this.m_init){this.m_init=!1,this.m_isMobileWeb=h.default.IsMobileWeb();const e=this.m_rscene;this.m_entity3DScene=e.entity3DScene;const t=this.m_rtaskSys;e.data=t.data;const i=this.m_entity3DScene;t.modelScene=i,i.data=t.data,i.request=t.request,i.infoViewer=t.infoViewer,i.process=t.process;let s=(t,i)=>{switch(t){case"rsc_viewer_loaded":let t=e.rscViewer;this.m_ui.setRSCViewer(t);break;case"select_a_model":let i=this.m_ui.getMaterialPanel();i.setModelNamesWithUrls(this.m_rscene.selectedModelUrls);break;default:break}};this.m_rscene.onaction=s,this.initWorkSpace();let a=e=>{this.m_rscene.run(),window.requestAnimationFrame(a)};window.requestAnimationFrame(a)}}initViewLayer(){let e=document.body;e.style.background="#121212";let t=this.m_viewerLayer;t=document.createElement("div");let i=t.style;i.width="100vw",i.height="100vh",i.backgroundImage="linear-gradient(to right bottom, #159957, #155799)",this.elementCenter(t),e.appendChild(t),e.style.margin="0",this.m_viewerLayer=t}initWorkSpace(){this.initViewLayer(),this.initDSRDUI()}createLayers(e,t){let i,s,a,n,r=[],o=2,h=2;return this.m_layoutHorizon?(this.m_areaWidth=2*e,this.m_areaHeight=t,i=l.DivTool.createDivT1(0,0,this.m_areaWidth+2*o,this.m_areaHeight+2*h,"block"),s=l.DivTool.createDivT1(o,h,e,t,"block"),a=l.DivTool.createDivT1(e+o,h,e,t,"block","absolute"),n=l.DivTool.createDivT1(o,h,this.m_areaWidth,this.m_areaHeight,"block","absolute")):(this.m_areaWidth=e,this.m_areaHeight=2*t,i=l.DivTool.createDivT1(0,0,this.m_areaWidth+2*o,this.m_areaHeight+2*h,"block"),s=l.DivTool.createDivT1(o,h,e,t,"block"),a=l.DivTool.createDivT1(o,h+t,e,t,"block","absolute"),n=l.DivTool.createDivT1(o,h,this.m_areaWidth,this.m_areaHeight,"block","absolute")),r.push(i),r.push(s),r.push(a),r.push(n),i.appendChild(s),i.appendChild(a),i.appendChild(n),this.m_viewerLayer.appendChild(i),r}initDSRDUI(){let e=512,t=512,i=null,s=this.m_viewerLayer.getBoundingClientRect();if(this.m_isMobileWeb){let i=Math.floor(s.width),a=Math.floor(s.height);this.m_layoutHorizon=i>a;let n=0;i>a?(n=Math.floor(.5*i),n=Math.min(n,a)):(n=Math.floor(.5*a),n=Math.min(n,i)),e=t=n-4}i=this.createLayers(e,t),this.m_ui.layoutHorizon=this.m_layoutHorizon;let a=i[0],n=i[1],r=i[2],o=i[3],l=a.style;l.backgroundImage="linear-gradient(to right bottom, #5b6f93, #1d91a5, #375283)",l=n.style,l.backgroundColor="#335533",l=r.style,l.backgroundColor="#5b9bd5",l=o.style,l.backgroundImage="linear-gradient(to right bottom, #c0e1d1, #aec7dd)",l.visibility="hidden";this.m_rtaskSys.data;let h=(e,t)=>{switch(e){case"toWorkSpace":this.toWorkSpace();break;case"curr-rendering":"new"==t?this.m_rtaskBeginUI.open():"finish"==t&&this.m_rtaskBeginUI.close();break;case"update-rnode":this.m_rscene.updateDataWithCurrRNode();break;default:break}};this.initDSRDSys(n,r,e,t),this.m_ui.rtaskSys=this.m_rtaskSys,this.m_rtaskSys.initialize(),this.m_rtaskSys.onaction=h,this.m_rtaskSys.data.rtJsonData=this.m_ui,this.m_rtaskBeginUI.rtaskSys=this.m_rtaskSys,this.m_rtaskBeginUI.onaction=h,this.m_layoutHorizon?this.m_rtaskBeginUI.initialize(o,2*e,t):this.m_rtaskBeginUI.initialize(o,e,2*t);let m=window,u=m["CURR_PAGE_ST_INFO_LIST"];void 0!==u&&this.m_rtaskBeginUI.open()}toWorkSpace(){this.m_ui.setTaskName(this.m_rtaskSys.data.taskname),0==this.m_workSpaceStatus&&(this.m_workSpaceStatus=1,this.m_rtaskBeginUI.close())}initDSRDSys(e,t,i,s){this.m_rscene.initialize(e),this.m_ui.initialize(t,i,s),this.m_ui.setTaskName("rendering...")}elementCenter(e,t="50%",i="50%",s="absolute"){const a=e.style;a.textAlign="center",a.display="flex",a.flexDirection="column",a.justifyContent="center",a.alignItems="center"}}t.DsrdShell=m},faa5:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i("a7c5"),a=i("9bbe");class n extends s.SettingDataPanel{constructor(){super()}getJsonStr(e="{",t="}"){let i=e+'"path":""';return super.getJsonStr(i,t)}init(e){let t=[],i=new a.DataItemComponentParam;i.keyName="type",i.name="环境选择",i.textValue="inner_room",i.textContent="室内",i.toText(),t.push(i),i=new a.DataItemComponentParam,i.keyName="brightness",i.name="环境亮度",i.numberValue=.7,i.inputType="number",i.numberMinValue=0,i.numberMaxValue=3,i.floatNumberEnabled=!0,i.editEnabled=!0,i.toNumber(),t.push(i),i=new a.DataItemComponentParam,i.keyName="ao",i.name="AO",i.numberValue=0,i.inputType="number",i.numberMinValue=0,i.numberMaxValue=10,i.floatNumberEnabled=!0,i.editEnabled=!0,i.toNumber(),t.push(i),i=new a.DataItemComponentParam,i.keyName="rotation",i.name="旋转角度",i.numberValue=0,i.toNumber(),t.push(i),this.m_params=t;let s=95,n=50,r=0;for(let a=0;a<t.length;++a)this.createItemComponent(s+r,t[a]),r+=n}}t.EnvDataPanel=n},fae3:function(e,t,i){"use strict";i.r(t);i("1eb2");var s=i("edb0");for(var a in s)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return s[e]}))}(a)}})}));