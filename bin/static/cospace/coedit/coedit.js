(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["CoEdit"]=e():t["CoEdit"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="fae3")}({"0be3":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("46e0"),o=i("45f9");class r extends o.MoveCtr{constructor(){super(),this.m_entity=null,this.m_rscene=null,this.m_billPos=null,this.m_circle=null,this.m_planeNV=CoMath.createVec3(0,1,0),this.m_planePos=CoMath.createVec3(),this.m_planeDis=0,this.m_pos=CoMath.createVec3(),this.m_dv=CoMath.createVec3(),this.m_outV=CoMath.createVec3(),this.m_rpv=CoMath.createVec3(),this.m_rtv=CoMath.createVec3()}initialize(t,e,i=30){if(null==this.m_entity){this.m_rscene=t;let o=CoEntity.createBoundsEntity(),r=.5*i,l=CoMath.createVec3(r,r,r).scaleBy(-1),n=CoMath.createVec3(r,r,r);o.setBounds(l,n),o.setRayTester(new s.SphereRayTester(r)),this.applyEvent(o),this.m_rscene.addEntity(o,e),this.m_entity=o;let a=CoParticle.createBillboard();a.initializeSquare(.2*r,[this.createTexByUrl("static/assets/circle01.png")]),this.m_rscene.addEntity(a.entity,e+1);let h=CoRScene.RendererState;a.entity.setRenderState(h.NONE_TRANSPARENT_ALWAYS_STATE),this.m_billPos=a;let c=Math.floor(.5*r),m=CoParticle.createBillboardLine();m.initializeCircleXOY(r,c<50?50:c),this.m_rscene.addEntity(m.entity,e+1),m.entity.setRenderState(h.NONE_TRANSPARENT_ALWAYS_STATE),this.m_circle=m,this.showOutColor()}}createTexByUrl(t=""){let e=this.m_rscene.textureBlock.createImageTex2D(64,64,!1),i=new Image;return i.onload=t=>{e.setDataFromImage(i,0,0,0,!1)},i.src=""!=t?t:"static/assets/box.jpg",e}getEntity(){return this.m_entity}showOverColor(){let t=this.overColor;this.m_circle.setRGB3f(t.r,t.g,t.b)}showOutColor(){let t=this.outColor;this.m_circle.setRGB3f(t.r,t.g,t.b)}enable(){super.enable(),this.m_entity.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1}setRenderState(t){this.m_entity.setRenderState(t)}setVisible(t){this.m_entity.setVisible(t),this.m_circle.entity.setVisible(t),this.m_billPos.entity.setVisible(t)}getVisible(){return this.m_entity.getVisible()}setXYZ(t,e,i){this.m_entity.setXYZ(t,e,i),this.m_circle.setXYZ(t,e,i)}setPosition(t){this.m_entity.setPosition(t),this.m_circle.setPosition(t),this.m_billPos.setPosition(t)}getPosition(t){return this.m_entity.getPosition(t),t}setScaleXYZ(t,e,i){this.m_entity.setScaleXYZ(t,e,i),this.m_circle.setScaleXY(t,e),this.m_billPos.setScaleXY(t,e)}getScaleXYZ(t){this.m_entity.getScaleXYZ(t)}setRotation3(t){this.m_entity.setRotation3(t)}setRotationXYZ(t,e,i){this.m_entity.setRotationXYZ(t,e,i)}getRotationXYZ(t){this.m_entity.getRotationXYZ(t)}localToGlobal(t){this.m_entity.localToGlobal(t)}globalToLocal(t){this.m_entity.globalToLocal(t)}update(){this.m_entity.update(),this.m_circle.update(),this.m_billPos.update()}destroy(){super.destroy(),null!=this.m_entity&&(this.m_rscene.removeEntity(this.m_entity),this.m_entity.destroy()),null!=this.m_circle&&(this.m_rscene.removeEntity(this.m_circle.entity),this.m_circle.destroy()),null!=this.m_billPos&&(this.m_rscene.removeEntity(this.m_billPos.entity),this.m_billPos.destroy()),this.m_rscene=null}calcClosePos(t,e){CoAGeom.PlaneUtils.IntersectLinePos2(this.m_planeNV,this.m_planeDis,t,e,this.m_outV)}moveByRay(t,e){if(this.isEnabled()&&this.isSelected()){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e);const i=this.m_pos;this.calcClosePos(this.m_rpv,this.m_rtv),i.copyFrom(this.m_outV),i.addBy(this.m_dv),this.moveSelfEnabled&&(this.setPosition(i),this.update()),null!=this.m_target&&(this.m_target.setPosition(i),this.m_target.update())}}setPlaneNormal(t){this.m_planeNV.copyFrom(t),this.m_planeNV.normalize()}selectByParam(t,e,i){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e),this.m_planePos.copyFrom(i),this.m_planeNV.copyFrom(this.m_rtv),this.m_planeNV.normalize(),this.m_planeDis=this.m_planePos.dot(this.m_planeNV),this.calcClosePos(this.m_rpv,this.m_rtv),this.getPosition(this.m_dv),this.m_dv.subtractBy(this.m_outV)}mouseDownListener(t){this.isEnabled()&&(this.editBegin(),this.setThisVisible(!0),this.m_target.select(this),this.selectByParam(t.raypv,t.raytv,t.wpos))}}e.default=r},"1cb4":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e,i){this.m_pv0=CoMath.createVec3(),this.m_pv1=CoMath.createVec3(),this.m_tester=null,this.m_vs=t,this.m_rayTestRadius=i,this.m_lsTotal=e}setPrevTester(t){t!=this&&(this.m_tester=t)}testRay(t,e,i,s){if(null!=this.m_tester&&this.m_tester.testRay(t,e,i,s)>0)return 0;let o=0,r=this.m_vs,l=!1,n=this.m_rayTestRadius,a=this.m_pv0,h=this.m_pv1;const c=CoAGeom.RayLine;for(let m=0;m<this.m_lsTotal;++m){if(a.setXYZ(r[o],r[o+1],r[o+2]),h.setXYZ(r[o+3],r[o+4],r[o+5]),l=c.IntersectSegmentLine(t,e,a,h,i,n),l)return 1;o+=6}return 0}destroy(){this.m_vs=null}}e.DashedLineRayTester=s},"1eb2":function(t,e,i){"use strict";if("undefined"!==typeof window){var s=window.document.currentScript,o=i("8875");s=o(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:o});var r=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);r&&(i.p=r[1])}},"268d":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.EDIT_BEGIN=20001,s.EDIT_END=20002,e.UserEditEvent=s},"3fdf":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("8c24"),o=i("6e9f"),r=i("ccf5");class l extends o.RotationCtr{constructor(){super(),this.m_entity=null,this.m_cv=CoMath.createVec3(),this.m_planeNV=CoMath.createVec3(),this.m_outV=CoMath.createVec3(),this.m_rotV=CoMath.createVec3(),this.m_scaleV=CoMath.createVec3(),this.m_posV=CoMath.createVec3(),this.m_srcDV=CoMath.createVec3(),this.m_dstDV=CoMath.createVec3(),this.m_camPos=CoMath.createVec3(),this.m_mat0=CoMath.createMat4(),this.m_initDegree=0,this.m_planeDis=0,this.m_material=null,this.m_editRS=null,this.m_editRSPI=0,this.m_ring=null}initialize(t,e,i,o){if(null==this.m_entity){this.m_editRS=t,this.m_editRSPI=e,this.m_ring=new r.RotationRing,this.m_entity=CoEntity.createDisplayEntity();let l,n=CoMesh.line;n.dynColorEnabled=!0;let a=this.m_planeNV;l=n.createCircleYOZ(i,o),a.setXYZ(1,0,0),l.setRayTester(new s.CircleRayTester(i,this.m_cv,null,a,this.m_planeDis,this.pickTestRadius)),this.m_entity.setMesh(l),this.m_material=CoMaterial.createLineMaterial(n.dynColorEnabled),this.m_material.setColor(this.outColor),this.m_entity.setMaterial(this.m_material),this.m_entity.update(),this.applyEvent(this.m_entity),t.addEntity(this.m_entity,e),this.m_ring.initialize(t,e,i,120,2),this.m_ring.setVisible(!1)}}run(t,e){this.m_scaleV;let i=this.m_entity;i.getPosition(this.m_posV),this.m_camPos.copyFrom(t.getPosition()),this.m_srcDV.setXYZ(1,0,0),this.m_dstDV.subVecsTo(this.m_camPos,this.m_posV);let s=CoMath.Vector3D.RadianBetween(this.m_srcDV,this.m_dstDV),o=this.m_rotV;CoMath.Vector3D.Cross(this.m_srcDV,this.m_dstDV,o),o.normalize();let r=i.getTransform().getMatrix();r.identity(),r.appendRotation(s,o),r.appendTranslation(this.m_posV);let l=r.decompose(CoMath.OrientationType.EULER_ANGLES)[1];i.setRotation3(l.scaleBy(CoMath.MathConst.MATH_180_OVER_PI)),i.update(),this.m_ring.setPosition(this.m_posV),this.m_ring.setRotation3(l)}setVisible(t){this.m_entity.setVisible(t),t||this.m_ring.setVisible(t)}getVisible(){return this.m_entity.getVisible()}setXYZ(t,e,i){this.m_entity.setXYZ(t,e,i)}setRotation3(t){}setRotationXYZ(t,e,i){}setScaleXYZ(t,e,i){this.m_entity.setScaleXYZ(t,e,i)}getScaleXYZ(t){}getRotationXYZ(t){}localToGlobal(t){this.m_entity.localToGlobal(t)}globalToLocal(t){this.m_entity.globalToLocal(t)}enable(){super.enable(),this.m_entity.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1}showOverColor(){this.m_entity.getMaterial().setColor(this.overColor)}showOutColor(){this.m_entity.getMaterial().setColor(this.outColor),this.m_ring.setColor(this.outColor)}deselect(){this.isSelected()&&(this.editEnd(),this.setAllVisible(!0),this.m_ring.setVisible(!1))}destroy(){super.destroy(),null!=this.m_entity&&(this.m_editRS.removeEntity(this.m_entity),this.m_entity.destroy(),this.m_entity=null),null!=this.m_ring&&(this.m_ring.destroy(),this.m_ring=null),this.m_editRS=null,this.m_mat0=null,this.m_cv=null,this.m_planeNV=null}setPosition(t){this.m_entity.setPosition(t)}getPosition(t){return this.m_entity.getPosition(t),t}update(){this.m_entity.update(),this.m_ring.update()}moveByRay(t,e){if(this.isEnabled()&&this.isSelected()){let i=this.getDegree(t,e);i-=this.m_initDegree,i>360?i-=360:i<0&&(i+=360),this.m_ring.setProgress(i/360);let s=this.m_target;if(null!=s){let t=this.m_mat0,e=this.m_dstDV;e.subVecsTo(this.m_camPos,this.m_posV),e.normalize(),t.identity(),t.appendRotation(CoMath.MathConst.DegreeToRadian(i),e);let o=t.decompose(CoMath.OrientationType.EULER_ANGLES)[1];s.setRotation3(o.scaleBy(CoMath.MathConst.MATH_180_OVER_PI)),s.update()}}}mouseDownListener(t){this.isEnabled()&&(this.editBegin(),this.m_target.select(),this.setThisVisible(!0),this.m_initDegree=this.getDegree(t.raypv,t.raytv),this.m_ring.setVisible(!0),this.m_ring.setRingRotation(this.m_initDegree),this.m_ring.setProgress(0))}getDegree(t,e){let i=0;if(this.isSelected()){let s=CoAGeom.PlaneUtils,o=this.m_srcDV.copyFrom(e).scaleBy(-1),r=this.m_posV;this.m_entity.getPosition(r);let l=s.IntersectRayLinePos2(o,r.dot(o),t,e,this.m_outV),n=this.m_outV;if(this.m_entity.globalToLocal(n),l){l=s.Intersection==CoAGeom.Intersection.Hit;let t=CoMath.Vector3D;if(l&&t.Distance(n,this.m_cv)>2){n.subtractBy(this.m_cv);let t=this.m_target;null!=t&&(i=CoMath.MathConst.GetDegreeByXY(n.y,n.z),i>360?i-=360:i<0&&(i+=360))}}}return i}}e.RotationCamZCircle=l},"45f9":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("f60a");class o extends s.UserEditCtr{constructor(){super(),this.outColor=CoMaterial.createColor4(.9,.9,.9,1),this.overColor=CoMaterial.createColor4(1,1,1,1),this.pickTestRadius=10,this.m_ctrList=o.s_list,this.m_ctrList.push(this)}}o.s_list=[],e.MoveCtr=o},"46e0":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e=null){this.isHit=!1,null==e&&(e=CoMath.createVec3()),this.m_radius=t,this.m_center=e}setPrevTester(t){}testRay(t,e,i,s){return this.isHit=CoAGeom.RayLine.IntersectSphereNearPos(t,e,this.m_center,this.m_radius,i),this.isHit?1:0}destroy(){this.m_center=null}}e.SphereRayTester=s},"5b83":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("46e0"),o=i("1cb4"),r=i("9c00");class l extends r.ScaleCtr{constructor(){super(),this.m_entity=null,this.m_box=null,this.innerSphereRadius=30,this.type=0,this.tv=CoMath.createVec3(1,0,0),this.coneTransMat4=CoMath.createMat4(),this.boxScale=1,this.m_line_pv=CoMath.createVec3(),this.m_initPos=CoMath.createVec3(),this.m_dv=CoMath.createVec3(),this.m_outV=CoMath.createVec3(),this.m_initV=CoMath.createVec3(),this.m_mat4=CoMath.createMat4(),this.m_invMat4=CoMath.createMat4(),this.m_rpv=CoMath.createVec3(),this.m_rtv=CoMath.createVec3(),this.m_sv=CoMath.createVec3()}initialize(t=100,e=0){if(null==this.m_entity){let i=this.pickTestRadius;CoMesh.line.dynColorEnabled=!0;let r=this.tv.clone().scaleBy(e),l=this.tv.clone().scaleBy(t),n=CoMesh.line.createLine(r,l,i),a=CoMaterial.createLineMaterial(!0);if(this.m_entity=CoEntity.createDisplayEntity(),this.m_entity.setMaterial(a),this.m_entity.setMesh(n),null!=n){let t=new o.DashedLineRayTester(n.getVS(),1,i);t.setPrevTester(new s.SphereRayTester(this.innerSphereRadius)),n.setRayTester(t)}this.applyEvent(this.m_entity),a=CoMaterial.createDefaultMaterial(),a.initializeByCodeBuf(!1),CoMesh.box.setBufSortFormat(a.getBufSortFormat()),CoMesh.box.transMatrix=this.coneTransMat4,n=CoMesh.box.createCube(this.boxScale*i*2),this.m_box=CoEntity.createDisplayEntity(),this.m_box.setMaterial(a),this.m_box.setMesh(n),this.applyEvent(this.m_box)}}getBox(){return this.m_box}getEntity(){return this.m_entity}setVisible(t){this.m_entity.setVisible(t),this.m_box.setVisible(t)}getVisible(){return this.m_entity.getVisible()}setXYZ(t,e,i){this.m_entity.setXYZ(t,e,i)}setRotation3(t){this.m_entity.setRotation3(t)}setRotationXYZ(t,e,i){this.m_entity.setRotationXYZ(t,e,i)}setScaleXYZ(t,e,i){this.m_entity.setScaleXYZ(t,e,i)}getScaleXYZ(t){this.m_entity.getScaleXYZ(t)}getRotationXYZ(t){this.m_entity.getRotationXYZ(t)}localToGlobal(t){this.m_entity.localToGlobal(t)}globalToLocal(t){this.m_entity.globalToLocal(t)}showOverColor(){let t=this.m_entity.getMaterial();t.setColor(this.overColor),t=this.m_box.getMaterial(),t.setColor(this.overColor)}showOutColor(){let t=this.m_entity.getMaterial();t.setColor(this.outColor),t=this.m_box.getMaterial(),t.setColor(this.outColor)}enable(){super.enable(),this.m_entity.mouseEnabled=!0,this.m_box.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1,this.m_box.mouseEnabled=!1}destroy(){super.destroy(),null!=this.m_entity&&(this.m_entity.destroy(),this.m_entity=null),null!=this.m_box&&(this.m_box.destroy(),this.m_box=null)}setPosition(t){this.m_entity.setPosition(t)}getPosition(t){return this.m_entity.getPosition(t),t}update(){this.m_entity.update(),this.m_box.update()}calcClosePos(t,e){if(this.isSelected()){let i=this.m_invMat4;i.transformVector3Self(t),i.deltaTransformVectorSelf(e);let s=this.m_outV;CoAGeom.Line.CalcTwoSLCloseV2(t,e,this.m_line_pv,this.tv,s),i=this.m_mat4,i.transformVector3Self(s)}}moveByRay(t,e){if(this.isEnabled()&&this.isSelected()){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e),this.calcClosePos(this.m_rpv,this.m_rtv),this.m_dv.copyFrom(this.m_outV),this.m_dv.subtractBy(this.m_initV);const i=this.m_dv,s=this.m_sv;let o=1,r=1,l=1,n=1,a=this.tv,h=100;a.x>.1?(h+=i.x,h<1&&(h=1),o=h/100,r=o):a.y>.1?(h+=i.y,h<1&&(h=1),o=h/100,l=o):a.z>.1&&(h+=i.z,h<1&&(h=1),o=h/100,n=o),null!=this.m_target&&(this.m_target.setScaleXYZ(s.x*r,s.y*l,s.z*n),this.m_target.update())}}mouseDownListener(t){if(this.isEnabled()){this.editBegin(),this.setThisVisible(!0),this.m_target.select();let e=this.m_entity.getTransform();this.m_mat4.copyFrom(e.getMatrix()),this.m_invMat4.copyFrom(e.getInvMatrix()),this.m_rpv.copyFrom(t.raypv),this.m_rtv.copyFrom(t.raytv),this.calcClosePos(this.m_rpv,this.m_rtv),this.m_initV.copyFrom(this.m_outV),this.getPosition(this.m_initPos),this.m_target.getScaleXYZ(this.m_sv)}}}e.ScaleDragLine=l},"5cc0":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("9e36");class o extends s.CtrlTargetBase{constructor(){super(),this.m_rvs=[],this.m_rv=CoMath.createVec3(),this.m_pv=CoMath.createVec3(),this.m_mat0=CoMath.createMat4(),this.m_mat1=CoMath.createMat4()}select(t=null){let e=this.m_tars;if(null!=e){const t=this.m_vs,i=this.m_rvs;let s=Math.PI/180,o=this.position;o.setXYZ(0,0,0);for(let r=0;r<e.length;++r)t[r].copyFrom(e[r].getGlobalBounds().center),o.addBy(t[r]);o.scaleBy(1/e.length);for(let r=0;r<e.length;++r)t[r].copyFrom(e[r].getGlobalBounds().center),t[r].subtractBy(o),e[r].getRotationXYZ(i[r]),i[r].scaleBy(s)}}setTargets(t){if(this.m_tars=t,null!=t){if(null==this.m_vs||this.m_vs.length<t.length){this.m_vs=new Array(t.length),this.m_rvs=new Array(t.length);for(let e=0;e<t.length;++e)this.m_vs[e]=CoMath.createVec3(),this.m_rvs[e]=CoMath.createVec3()}}else this.m_vs=[],this.m_rvs=[]}setPosition(t){for(let e=0;e<this.m_controllers.length;++e)this.m_controllers[e].setPosition(t),this.m_flags[e]=!0}getPosition(t){return t.copyFrom(this.position),t}setRotation3(t){if(null!=this.m_tars){let e=this.m_tars,i=Math.PI/180,s=180/Math.PI,o=this.m_rv;o.copyFrom(t).scaleBy(i);let r=this.m_mat0,l=this.m_mat1;const n=this.m_vs,a=this.m_rvs,h=this.position;let c=this.m_pv;c.setXYZ(0,0,0);let m=CoMath.createVec3(),_=CoMath.createVec3(),u=CoMath.OrientationType.EULER_ANGLES;for(let t=0;t<e.length;++t){const i=a[t];r.identity(),r.setRotationEulerAngle(i.x,i.y,i.z),l.identity(),l.setRotationEulerAngle(o.x,o.y,o.z),r.append(l);let n=r.decompose(u),h=n[1];h.scaleBy(s),e[t].setRotation3(h)}for(let t=0;t<e.length;++t)r.identity(),r.setRotationEulerAngle(o.x,o.y,o.z),c.copyFrom(n[t]),r.transformVector3Self(c),c.addBy(h),e[t].update(),m.subVecsTo(e[t].getGlobalBounds().center,c),e[t].getPosition(_),_.subtractBy(m),e[t].setPosition(_);this.m_changed=!0}}getRotationXYZ(t){t.setXYZ(0,0,0)}}e.RotatedTarget=o},"5fe2":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("7fb5"),o=i("268d");e.UserEditEvent=o.UserEditEvent;const r=i("86dd"),l=i("ea99");function n(){return new r.CoTransformRecorder}function a(){return new l.TransformController}function h(){return new s.FloorLineGrid}e.createTransformRecorder=n,e.createTransformController=a,e.createFloorLineGrid=h},"6e9f":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("f60a");class o extends s.UserEditCtr{constructor(){super(),this.outColor=CoMaterial.createColor4(.9,.9,.9,1),this.overColor=CoMaterial.createColor4(1,1,1,1),this.pickTestRadius=20,this.m_ctrList=o.s_list,this.m_ctrList.push(this)}}o.s_list=[],e.RotationCtr=o},"700c":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=s(i("8b62")),r=s(i("0be3")),l=i("9b53"),n=i("d9b5"),a=i("a27e");class h extends a.DragTransController{constructor(){super(),this.circleSize=60,this.axisSize=100,this.planeSize=30,this.planeAlpha=.6,this.pickTestAxisRadius=20}createDragPlane(t,e,i){let s=new o.default;return s.moveSelfEnabled=!1,s.initialize(t,this.planeSize),i.a=e,s.outColor.copyFrom(i),i.scaleBy(1.5),i.a=1.3*e,s.overColor.copyFrom(i),s.showOutColor(),s.setTarget(this.m_target),this.m_target.addCtrlEntity(s),this.m_controllers.push(s),this.m_editRS.addEntity(s.getEntity(),this.m_editRSPI,!0),s}createDragLine(t,e,i){let s=t.clone().scaleBy(this.axisSize);i.setTranslation(s);let o=new n.DragLine;o.coneScale=.8,o.coneTransMat4.copyFrom(i),o.tv.copyFrom(t),o.innerSphereRadius=.5*this.circleSize,o.moveSelfEnabled=!0,o.pickTestRadius=this.pickTestAxisRadius,o.initialize(this.axisSize,o.innerSphereRadius),o.outColor.copyFrom(e),e.scaleBy(1.5),o.overColor.copyFrom(e),o.showOutColor(),o.setTarget(this.m_target),this.m_editRS.addEntity(o.getEntity(),this.m_editRSPI,!0),this.m_editRS.addEntity(o.getCone(),this.m_editRSPI,!0),this.m_target.addCtrlEntity(o.getEntity()),this.m_target.addCtrlEntity(o.getCone()),this.m_controllers.push(o)}init(){this.m_target=new l.MovedTarget;let t=this.planeAlpha,e=CoMaterial.createColor4,i=e();const s=CoMath.Vector3D;let o=CoMath.createMat4();o.identity(),o.rotationZ(-.5*Math.PI),i.setRGBUint8(240,55,80),this.createDragLine(s.X_AXIS,i,o),o.identity(),o.rotationX(.5*Math.PI),o.rotationY(.5*Math.PI),i.setRGBUint8(135,205,55),this.createDragLine(s.Y_AXIS,i,o),o.identity(),o.rotationY(.5*Math.PI),o.rotationX(.5*Math.PI),i.setRGBUint8(80,145,240),this.createDragLine(s.Z_AXIS,i,o),i.setRGBUint8(240,55,80),this.createDragPlane(0,t,i),i.setRGBUint8(135,205,55),this.createDragPlane(1,t,i),i.setRGBUint8(80,145,240),this.createDragPlane(2,t,i);let n=new r.default;n.moveSelfEnabled=!1,n.initialize(this.m_editRS,0,this.circleSize),n.setTarget(this.m_target),this.m_target.addCtrlEntity(n),this.m_controllers.push(n)}}e.DragMoveController=h},"7eec":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("9c00");class o extends s.ScaleCtr{constructor(){super(),this.m_entity=null,this.offsetV=CoMath.createVec3(30,30,30),this.m_planeAxisType=0,this.m_planeNV=CoMath.createVec3(0,1,0),this.m_planePos=CoMath.createVec3(),this.m_planeDis=0,this.m_pos=CoMath.createVec3(),this.m_dv=CoMath.createVec3(),this.m_outV=CoMath.createVec3(),this.m_rpv=CoMath.createVec3(),this.m_rtv=CoMath.createVec3(),this.m_sv=CoMath.createVec3(),this.m_dis=1}initialize(t,e){if(null==this.m_entity){const i=CoMath.Vector3D;let s=CoRScene.createDefaultMaterial();s.initializeByCodeBuf(!1),this.m_entity=CoRScene.createDisplayEntity();let o=this.m_entity;o.setMaterial(s);let r=CoMesh.plane;r.setBufSortFormat(s.getBufSortFormat());let l=this.offsetV;switch(this.m_planeAxisType=t,t){case 0:o.setMesh(r.createXOZ(l.x,l.z,e,e)),this.setPlaneNormal(i.Y_AXIS);break;case 1:o.setMesh(r.createXOY(l.x,l.y,e,e)),this.setPlaneNormal(i.Z_AXIS);break;case 2:o.setMesh(r.createYOZ(l.y,l.z,e,e)),this.setPlaneNormal(CoMath.Vector3D.X_AXIS);break;default:throw Error("Error type !!!")}o.setRenderState(CoRScene.RendererState.NONE_TRANSPARENT_STATE),this.showOutColor(),this.applyEvent(this.m_entity)}}getEntity(){return this.m_entity}mouseOverListener(t){this.showOverColor()}mouseOutListener(t){this.showOutColor()}showOverColor(){let t=this.m_entity.getMaterial();t.setColor(this.overColor)}showOutColor(){let t=this.m_entity.getMaterial();t.setColor(this.outColor)}enable(){super.enable(),this.m_entity.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1}setRenderState(t){this.m_entity.setRenderState(t)}setVisible(t){this.m_entity.setVisible(t)}getVisible(){return this.m_entity.getVisible()}setXYZ(t,e,i){this.m_entity.setXYZ(t,e,i)}setPosition(t){this.m_entity.setPosition(t)}getPosition(t){return this.m_entity.getPosition(t),t}setScaleXYZ(t,e,i){this.m_entity.setXYZ(t,e,i)}getScaleXYZ(t){this.m_entity.getScaleXYZ(t)}setRotation3(t){this.m_entity.setRotation3(t)}setRotationXYZ(t,e,i){this.m_entity.setRotationXYZ(t,e,i)}getRotationXYZ(t){this.m_entity.getRotationXYZ(t)}getGlobalBounds(){return this.m_entity.getGlobalBounds()}getLocalBounds(){return this.m_entity.getGlobalBounds()}localToGlobal(t){this.m_entity.localToGlobal(t)}globalToLocal(t){this.m_entity.globalToLocal(t)}update(){this.m_entity.update()}destroy(){super.destroy(),null!=this.m_entity&&this.m_entity.destroy()}calcClosePos(t,e){CoAGeom.PlaneUtils.IntersectLinePos2(this.m_planeNV,this.m_planeDis,t,e,this.m_outV)}moveByRay(t,e){if(this.isEnabled()&&this.isSelected()){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e),this.calcClosePos(this.m_rpv,this.m_rtv);let i=CoMath.Vector3D,s=i.Distance(this.m_pos,this.m_outV);s<1&&(s=1);const o=this.m_sv;let r=1,l=1,n=1,a=s/this.m_dis,h=this.m_planeAxisType;0==h?(r=a,n=a):1==h?(r=a,l=a):(l=a,n=a),null!=this.m_target&&(this.m_target.setScaleXYZ(o.x*r,o.y*l,o.z*n),this.m_target.update())}}setPlaneNormal(t){this.m_planeNV.copyFrom(t),this.m_planeNV.normalize()}selectByParam(t,e,i){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e),this.m_planePos.copyFrom(i),this.m_planeNV.normalize(),this.m_planeDis=this.m_planePos.dot(this.m_planeNV),this.calcClosePos(this.m_rpv,this.m_rtv),this.getPosition(this.m_dv),this.m_dv.subtractBy(this.m_outV)}mouseDownListener(t){if(this.isEnabled()){this.editBegin(),this.setThisVisible(!0),this.m_target.select(),this.selectByParam(t.raypv,t.raytv,t.wpos),this.m_target.getScaleXYZ(this.m_sv),this.getPosition(this.m_pos);let e=CoMath.Vector3D;this.m_dis=e.Distance(this.m_pos,this.m_outV),this.m_dis<1&&(this.m_dis=1)}}}e.default=o},"7fb5":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_entity=null}initialize(t,e,i,s,o=10,r=null){if(null==this.m_entity){e<0&&(e=0),o<1&&(o=1),null==r&&(r=CoMaterial.createColor4(.3,.3,.3,1)),this.m_rscene=t,this.m_entity=CoEntity.createDisplayEntity();let l=1,n=CoMath.createVec3().subVecsTo(s,i);n.z<.1?l=0:n.x<.1&&(l=2),n.scaleBy(1/o);let a=o+1,h=i.clone(),c=s.clone(),m=s.clone(),_=new Array(2*a),u=0;if(1==l)for(let t=0;t<a;++t)h.x=i.x+n.x*t,h.z=i.z,c.copyFrom(h),c.z=s.z,_[u++]=h.clone(),_[u++]=c.clone(),m.copyFrom(h),h.x=c.z,h.z=c.x,c.x=m.z,c.z=m.x,_[u++]=h.clone(),_[u++]=c.clone();else if(2==l)for(let t=0;t<a;++t)h.y=i.y+n.y*t,h.z=i.z,c.copyFrom(h),c.z=s.z,_[u++]=h.clone(),_[u++]=c.clone(),m.copyFrom(h),h.y=c.z,h.z=c.y,c.y=m.z,c.z=m.y,_[u++]=h.clone(),_[u++]=c.clone();else for(let t=0;t<a;++t)h.x=i.x+n.x*t,h.y=i.y,c.copyFrom(h),c.y=s.y,_[u++]=h.clone(),_[u++]=c.clone(),m.copyFrom(h),h.x=c.y,h.y=c.x,c.x=m.y,c.y=m.x,_[u++]=h.clone(),_[u++]=c.clone();CoMesh.line.dynColorEnabled=!0;let d=CoMaterial.createLineMaterial(CoMesh.line.dynColorEnabled);d.setColor(r),d.initializeByCodeBuf(!1),CoMesh.line.setBufSortFormat(d.getBufSortFormat());let y=CoMesh.line.createLines(_);this.m_entity.setMaterial(d),this.m_entity.setMesh(y),t.addEntity(this.m_entity,e)}}setVisible(t){null!=this.m_entity&&this.m_entity.setVisible(t)}}e.FloorLineGrid=s},"86dd":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.position=CoMath.createVec3(),this.scale=CoMath.createVec3(),this.rotation=CoMath.createVec3()}}class o{constructor(){this.list=[]}add(t){let e=new s;t.getPosition(e.position),t.getScaleXYZ(e.scale),t.getRotationXYZ(e.rotation),e.target=t,this.list.push(e)}use(){let t=this.list,e=[];for(let i=0;i<t.length;++i){let s=t[i];const o=s.target;o.setScale3(s.scale),o.setRotation3(s.rotation),o.setPosition(s.position),o.update(),e.push(o)}return e}destroy(){this.list=[]}}class r{constructor(){this.m_undoList=[],this.m_redoList=[],this.m_currList=null}save(t){if(this.m_currList=null,this.m_redoList.length>0&&(this.m_redoList=[]),null!=t){let e=new o;for(let i=0;i<t.length;++i)e.add(t[i]);this.m_undoList.push(e)}}undo(){this.m_currList=null;let t=this.m_undoList,e=t.length;if(e>1){let e=t.pop();this.m_redoList.push(e),this.m_currList=t[t.length-1].use()}}redo(){this.m_currList=null;let t=this.m_redoList,e=t.length;if(e>0){let e=t.pop();this.m_currList=e.use(),this.m_undoList.push(e)}}getCurrList(){let t=this.m_currList;return this.m_currList=null,t}}e.CoTransformRecorder=r},8875:function(t,e,i){var s,o,r;(function(i,l){o=[],s=l,r="function"===typeof s?s.apply(e,o):s,void 0===r||(t.exports=r)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(u){var i,s,o,r=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,l=/@([^@]*):(\d+):(\d+)\s*$/gi,n=r.exec(u.stack)||l.exec(u.stack),a=n&&n[1]||!1,h=n&&n[2]||!1,c=document.location.href.replace(document.location.hash,""),m=document.getElementsByTagName("script");a===c&&(i=document.documentElement.outerHTML,s=new RegExp("(?:[^\\n]+?\\n){0,"+(h-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),o=i.replace(s,"$1").trim());for(var _=0;_<m.length;_++){if("interactive"===m[_].readyState)return m[_];if(m[_].src===a)return m[_];if(a===c&&m[_].innerHTML&&m[_].innerHTML.trim()===o)return m[_]}return null}}return t}))},"8b62":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("45f9");class o extends s.MoveCtr{constructor(){super(),this.m_entity=null,this.offsetV=CoMath.createVec3(30,30,30),this.crossRay=!1,this.m_planeNV=CoMath.createVec3(0,1,0),this.m_planePos=CoMath.createVec3(),this.m_planeDis=0,this.m_pos=CoMath.createVec3(),this.m_dv=CoMath.createVec3(),this.m_outV=CoMath.createVec3(),this.m_rpv=CoMath.createVec3(),this.m_rtv=CoMath.createVec3()}initialize(t,e){if(null==this.m_entity){const i=CoMath.Vector3D;let s=CoRScene.getRendererScene(),o=(s.entityBlock,CoRScene.createDefaultMaterial());o.initializeByCodeBuf(!1),this.m_entity=CoRScene.createDisplayEntity();let r=this.m_entity;r.setMaterial(o);let l=CoMesh.plane;l.setBufSortFormat(o.getBufSortFormat());let n=this.offsetV;switch(t){case 0:r.setMesh(l.createXOZ(n.x,n.z,e,e)),this.setPlaneNormal(i.Y_AXIS);break;case 1:r.setMesh(l.createXOY(n.x,n.y,e,e)),this.setPlaneNormal(i.Z_AXIS);break;case 2:r.setMesh(l.createYOZ(n.y,n.z,e,e)),this.setPlaneNormal(CoMath.Vector3D.X_AXIS);break;default:throw Error("Error type !!!")}r.setRenderState(CoRScene.RendererState.NONE_TRANSPARENT_STATE),this.showOutColor(),this.applyEvent(this.m_entity)}}getEntity(){return this.m_entity}showOverColor(){this.m_entity.getMaterial().setRGBA4f(this.overColor.r,this.overColor.g,this.overColor.b,this.overColor.a)}showOutColor(){this.m_entity.getMaterial().setRGBA4f(this.outColor.r,this.outColor.g,this.outColor.b,this.outColor.a)}enable(){super.enable(),this.m_entity.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1}setRenderState(t){this.m_entity.setRenderState(t)}setVisible(t){this.m_entity.setVisible(t)}getVisible(){return this.m_entity.getVisible()}setXYZ(t,e,i){this.m_entity.setXYZ(t,e,i)}setPosition(t){this.m_entity.setPosition(t)}getPosition(t){return this.m_entity.getPosition(t),t}setScaleXYZ(t,e,i){this.m_entity.setXYZ(t,e,i)}getScaleXYZ(t){this.m_entity.getScaleXYZ(t)}setRotation3(t){this.m_entity.setRotation3(t)}setRotationXYZ(t,e,i){this.m_entity.setRotationXYZ(t,e,i)}getRotationXYZ(t){this.m_entity.getRotationXYZ(t)}localToGlobal(t){this.m_entity.localToGlobal(t)}globalToLocal(t){this.m_entity.globalToLocal(t)}update(){this.m_entity.update()}destroy(){super.destroy(),null!=this.m_entity&&this.m_entity.destroy()}calcClosePos(t,e){CoAGeom.PlaneUtils.IntersectLinePos2(this.m_planeNV,this.m_planeDis,t,e,this.m_outV)}moveByRay(t,e){if(this.isEnabled()&&this.isSelected()){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e);const i=this.m_pos;this.calcClosePos(this.m_rpv,this.m_rtv),i.copyFrom(this.m_outV),i.addBy(this.m_dv),this.moveSelfEnabled&&(this.setPosition(i),this.update()),null!=this.m_target&&(this.m_target.setPosition(i),this.m_target.update())}}mouseDownListener(t){this.isEnabled()&&(this.editBegin(),this.setThisVisible(!0),this.m_target.select(this),this.selectByParam(t.raypv,t.raytv,t.wpos))}setPlaneNormal(t){this.m_planeNV.copyFrom(t),this.m_planeNV.normalize()}selectByParam(t,e,i){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e),this.m_planePos.copyFrom(i),this.crossRay&&this.m_planeNV.copyFrom(this.m_rtv),this.m_planeNV.normalize(),this.m_planeDis=this.m_planePos.dot(this.m_planeNV),this.calcClosePos(this.m_rpv,this.m_rtv),this.getPosition(this.m_dv),this.m_dv.subtractBy(this.m_outV)}}e.default=o},"8c24":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e,i,s,o,r){this.isHit=!1,this.m_outV0=CoMath.createVec3(),this.m_radius=t,this.m_center=e,this.m_direcV=i,this.m_planeNV=s,this.m_planeDis=o,this.m_rayTestRadius=r}setPrevTester(t){}testRay(t,e,i,s){const o=this.m_outV0,r=CoAGeom.PlaneUtils;if(this.isHit=r.IntersectRayLinePos2(this.m_planeNV,this.m_planeDis,t,e,o),this.isHit&&(this.isHit=r.Intersection==CoAGeom.Intersection.Hit,this.isHit)){let t=CoMath.Vector3D.Distance(o,this.m_center);if(this.isHit=Math.abs(t-this.m_radius)<this.m_rayTestRadius,this.isHit&&(null==this.m_direcV||this.m_direcV.dot(o)>0))return i.copyFrom(o),1}return this.isHit=!1,0}destroy(){this.m_center=null,this.m_planeNV=null}}e.CircleRayTester=s},9386:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=s(i("7eec")),r=s(i("d2d6")),l=i("5b83"),n=i("aebd"),a=i("a27e");class h extends a.DragTransController{constructor(){super(),this.circleSize=60,this.axisSize=100,this.planeSize=30,this.planeAlpha=.6,this.pickTestAxisRadius=20}createDragPlane(t,e,i){let s=new o.default;return s.moveSelfEnabled=!1,s.initialize(t,this.planeSize),i.a=e,s.outColor.copyFrom(i),i.scaleBy(1.5),i.a=1.3*e,s.overColor.copyFrom(i),s.setTarget(this.m_target),this.m_target.addCtrlEntity(s),this.m_controllers.push(s),this.m_editRS.addEntity(s.getEntity(),this.m_editRSPI,!0),s.showOutColor(),s}createDragLine(t,e,i){let s=t.clone().scaleBy(this.axisSize);i.setTranslation(s);let o=new l.ScaleDragLine;o.boxScale=.4,o.coneTransMat4=i,o.tv.copyFrom(t),o.innerSphereRadius=.5*this.circleSize,o.moveSelfEnabled=!1,o.pickTestRadius=this.pickTestAxisRadius,o.initialize(this.axisSize,o.innerSphereRadius),o.outColor.copyFrom(e),e.scaleBy(1.5),o.overColor.copyFrom(e),o.showOutColor(),o.setTarget(this.m_target),this.m_editRS.addEntity(o.getEntity(),this.m_editRSPI,!0),this.m_editRS.addEntity(o.getBox(),this.m_editRSPI,!0),this.m_target.addCtrlEntity(o.getEntity()),this.m_target.addCtrlEntity(o.getBox()),this.m_controllers.push(o)}init(){this.m_target=new n.ScaleTarget;let t=this.planeAlpha,e=CoMaterial.createColor4,i=e();const s=CoMath.Vector3D;let o=CoMath.createMat4();i.setRGBUint8(240,55,80),o.identity(),this.createDragLine(s.X_AXIS,i,o),i.setRGBUint8(135,205,55),o.identity(),this.createDragLine(s.Y_AXIS,i,o),i.setRGBUint8(80,145,240),o.identity(),this.createDragLine(s.Z_AXIS,i,o),i.setRGBUint8(240,55,80),this.createDragPlane(0,t,i),i.setRGBUint8(135,205,55),this.createDragPlane(1,t,i),i.setRGBUint8(80,145,240),this.createDragPlane(2,t,i);let l=new r.default;l.moveSelfEnabled=!1,l.initialize(this.m_editRS,0,this.circleSize),l.setTarget(this.m_target),this.m_target.addCtrlEntity(l),this.m_controllers.push(l)}}e.DragScaleController=h},"9aa6":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("8c24"),o=i("6e9f"),r=i("ccf5");class l extends o.RotationCtr{constructor(){super(),this.m_entity=null,this.m_circle=null,this.m_cv=CoMath.createVec3(),this.m_planeNV=CoMath.createVec3(),this.m_outV=CoMath.createVec3(),this.m_preRotV=CoMath.createVec3(),this.m_rotV=CoMath.createVec3(),this.m_initDegree=0,this.m_planeDis=0,this.m_type=0,this.m_material=null,this.m_ring=null,this.m_editRS=null,this.m_editRSPI=0}initialize(t,e,i,o,l){if(null==this.m_entity){this.m_editRS=t,this.m_editRSPI=e,this.m_ring=new r.RotationRing,this.m_entity=CoEntity.createDisplayEntity(),this.m_circle=CoEntity.createDisplayEntity();let n,a,h=CoMesh.line;h.dynColorEnabled=!0,this.m_type=l;let c=CoMath.createVec3(),m=this.m_planeNV;switch(l){case 1:n=h.createCircleXOZ(i,Math.round(.5*o),null,0,Math.PI),a=h.createCircleXOZ(i,o),m.setXYZ(0,1,0),c.setXYZ(0,0,1);break;case 2:n=h.createCircleYOZ(i,Math.round(.5*o),null,0,Math.PI),a=h.createCircleYOZ(i,o),m.setXYZ(1,0,0),c.setXYZ(0,0,1);break;default:n=h.createCircleXOY(i,Math.round(.5*o),null,0,Math.PI),a=h.createCircleXOY(i,o),m.setXYZ(0,0,1),c.setXYZ(0,1,0),l=0;break}n.setRayTester(new s.CircleRayTester(i,this.m_cv,c,m,this.m_planeDis,this.pickTestRadius)),this.m_entity.setMesh(n),this.m_material=CoMaterial.createLineMaterial(h.dynColorEnabled),this.m_material.setColor(this.outColor),this.m_entity.setMaterial(this.m_material),this.m_entity.update(),this.m_circle.setMesh(a),this.m_circle.setMaterial(this.m_material),this.m_circle.update(),this.m_circle.setVisible(!1),this.applyEvent(this.m_entity),t.addEntity(this.m_entity,e),t.addEntity(this.m_circle,e),this.m_ring.initialize(t,e,i,120,l),this.m_ring.setVisible(!1)}}run(t,e){let i=this.m_outV,s=t.getPosition();i.copyFrom(s);let o=i.dot(this.m_planeNV);i.copyFrom(this.m_planeNV),i.scaleBy(-o),i.addBy(s);let r=CoMath.MathConst;const l=this.m_entity;let n=0;switch(this.m_type){case 0:n=-r.GetDegreeByXY(i.x,i.y),l.setRotationXYZ(0,0,270-n),l.update();break;case 1:n=-r.GetDegreeByXY(i.x,i.z),l.setRotationXYZ(0,90+n,0),l.update();break;case 2:n=-r.GetDegreeByXY(i.z,i.y),l.setRotationXYZ(n,0,0),l.update();break;default:break}}setVisible(t){this.m_entity.setVisible(t),t||this.m_ring.setVisible(t)}getVisible(){return this.m_entity.getVisible()}setXYZ(t,e,i){this.m_entity.setXYZ(t,e,i),this.m_circle.setXYZ(t,e,i),this.m_ring.setXYZ(t,e,i)}setRotation3(t){}setRotationXYZ(t,e,i){}setScaleXYZ(t,e,i){this.m_entity.setScaleXYZ(t,e,i),this.m_circle.setScaleXYZ(t,e,i),this.m_ring.setScaleXYZ(t,e,i)}getScaleXYZ(t){this.m_entity.getScaleXYZ(t)}getRotationXYZ(t){}localToGlobal(t){this.m_entity.localToGlobal(t)}globalToLocal(t){this.m_entity.globalToLocal(t)}enable(){super.enable(),this.m_entity.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1}showOverColor(){this.m_entity.getMaterial().setColor(this.overColor)}showOutColor(){this.m_entity.getMaterial().setColor(this.outColor),this.m_ring.setColor(this.outColor)}deselect(){this.isSelected()&&(super.deselect(),this.m_circle.getVisible()&&(this.m_entity.setVisible(!0),this.m_circle.setVisible(!1)),this.m_ring.setVisible(!1))}destroy(){super.destroy(),null!=this.m_entity&&(this.m_editRS.removeEntity(this.m_entity),this.m_entity.destroy(),this.m_entity=null),null!=this.m_circle&&(this.m_editRS.removeEntity(this.m_circle),this.m_circle.destroy(),this.m_circle=null),null!=this.m_ring&&(this.m_ring.destroy(),this.m_ring=null),this.m_editRS=null,this.m_cv=null,this.m_planeNV=null}setPosition(t){this.m_entity.setPosition(t),this.m_circle.setPosition(t),this.m_ring.setPosition(t)}getPosition(t){return this.m_entity.getPosition(t),t}update(){this.m_entity.update(),this.m_circle.update(),this.m_ring.update()}moveByRay(t,e){if(this.isEnabled()&&this.isSelected()){let i=this.getDegree(t,e);i-=this.m_initDegree,this.m_ring.setProgress(i/360);let s=this.m_target;if(null!=s){let t=this.m_rotV,e=this.m_preRotV;switch(s.getRotationXYZ(t),this.m_type){case 1:t.y=e.y+i;break;case 2:t.x=e.x+i;break;default:t.z=e.z+i;break}s.setRotation3(t),s.update()}}}mouseDownListener(t){this.isEnabled()&&(this.editBegin(),this.m_target.select(),this.m_entity.setVisible(!1),this.m_circle.setVisible(!0),this.setThisVisible(!0),this.m_initDegree=this.getDegree(t.raypv,t.raytv),this.m_ring.setVisible(!0),this.m_ring.setRingRotation(this.m_initDegree),this.m_ring.setProgress(0),this.m_preRotV.setXYZ(0,0,0),null!=this.m_target&&this.m_target.getRotationXYZ(this.m_preRotV))}getDegree(t,e){let i=0;if(this.isSelected()){let s=CoAGeom.PlaneUtils;this.getPosition(this.m_outV);let o=this.m_planeNV.dot(this.m_outV),r=s.IntersectRayLinePos2(this.m_planeNV,o,t,e,this.m_outV),l=this.m_outV;if(this.m_circle.globalToLocal(l),r){r=s.Intersection==CoAGeom.Intersection.Hit;let t=CoMath.Vector3D;if(r&&t.Distance(l,this.m_cv)>2){l.subtractBy(this.m_cv);let t=this.m_target;if(null!=t){switch(this.m_type){case 1:i=CoMath.MathConst.GetDegreeByXY(l.x,l.z),i=-i;break;case 2:i=CoMath.MathConst.GetDegreeByXY(l.y,l.z);break;default:i=CoMath.MathConst.GetDegreeByXY(l.x,l.y);break}i>360?i-=360:i<0&&(i+=360)}}}}return i}}e.RotationCircle=l},"9b53":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("9e36");class o extends s.CtrlTargetBase{constructor(){super()}select(t=null){let e=this.m_tars;if(null!=e){let i=this.m_vs;null==t&&(t=this.m_controllers[0]),t.getPosition(this.m_v3);for(let t=0;t<e.length;++t)i[t].copyFrom(e[t].getGlobalBounds().center),i[t].subtractBy(this.m_v3)}}setTargets(t){if(this.m_tars=t,null!=t){if(null==this.m_vs||this.m_vs.length<t.length){this.m_vs=new Array(t.length);for(let e=0;e<t.length;++e)this.m_vs[e]=CoMath.createVec3()}}else this.m_vs=[]}setPosition(t){let e=this.m_tars;if(null!=e){let i=this.m_vs;const s=this.m_v3;let o=CoMath.createVec3(),r=CoMath.createVec3();for(let l=0;l<e.length;++l)s.addVecsTo(t,i[l]),e[l].getPosition(r),o.subVecsTo(e[l].getGlobalBounds().center,r),s.subtractBy(o),e[l].setPosition(s)}for(let i=0;i<this.m_controllers.length;++i)this.m_controllers[i].setPosition(t),this.m_flags[i]=!0;this.position.copyFrom(t),this.m_changed=!0}}e.MovedTarget=o},"9c00":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("f60a");class o extends s.UserEditCtr{constructor(){super(),this.outColor=CoMaterial.createColor4(.9,.9,.9,1),this.overColor=CoMaterial.createColor4(1,1,1,1),this.pickTestRadius=10,this.m_ctrList=o.s_list,this.m_ctrList.push(this)}}o.s_list=[],e.ScaleCtr=o},"9e36":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_controllers=[],this.m_tars=null,this.m_vs=[],this.m_flags=[],this.m_changed=!1,this.m_v3=CoMath.createVec3(),this.position=CoMath.createVec3()}select(t=null){}deselect(){this.m_tars=null}addCtrlEntity(t){null!=t&&(this.m_controllers.push(t),this.m_flags.push(!0))}setTargets(t){}getTargets(){return this.m_tars}setCtrlScaleXYZ(t,e,i){const s=this.m_controllers;for(let o=0;o<s.length;++o)this.m_flags[o]=!0,s[o].setScaleXYZ(t,e,i)}setXYZ(t,e,i){}setPosition(t){}getPosition(t){return t.copyFrom(this.position),t}setRotation3(t){}setRotationXYZ(t,e,i){}setScaleXYZ(t,e,i){}getRotationXYZ(t){}getScaleXYZ(t){}getGlobalBounds(){return null}getLocalBounds(){return null}localToGlobal(t){}globalToLocal(t){}update(){if(this.m_changed){let t=this.m_tars;if(null!=t)for(let e=0;e<t.length;++e)t[e].update()}for(let t=0;t<this.m_controllers.length;++t)this.m_flags[t]&&(this.m_flags[t]=!1,this.m_controllers[t].update())}destroy(){this.m_tars=null,this.m_controllers=null}}e.CtrlTargetBase=s},a27e:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_controllers=[],this.m_pos0=CoMath.createVec3(),this.m_pos1=CoMath.createVec3(),this.m_rpv=CoMath.createVec3(),this.m_rtv=CoMath.createVec3(),this.m_tempPos=CoMath.createVec3(),this.m_mv0=CoMath.createVec3(-1e5,-1e5,0),this.m_mv1=CoMath.createVec3(),this.m_px=0,this.m_visible=!0,this.m_enabled=!0,this.m_editRS=null,this.m_editRSPI=0,this.m_target=null,this.fixSize=0,this.runningVisible=!0,this.uuid="DragTransController"}initialize(t,e=0){null==this.m_editRS&&(this.m_editRS=t,this.m_editRSPI=e,this.init(),this.applyEvt())}init(){}applyEvt(){for(let t=0;t<this.m_controllers.length;++t)this.m_controllers[t].addEventListener(CoRScene.MouseEvent.MOUSE_DOWN,this,this.dragMouseDownListener)}dragMouseDownListener(t){this.m_editRS.addEventListener(CoRScene.MouseEvent.MOUSE_UP,this,this.dragMouseUpListener,!0,!0)}dragMouseUpListener(t){this.m_editRS.removeEventListener(CoRScene.MouseEvent.MOUSE_UP,this,this.dragMouseUpListener)}addEventListener(t,e,i,s=!0,o=!1){for(let r=0;r<this.m_controllers.length;++r)this.m_controllers[r].addEventListener(t,e,i,s,o)}removeEventListener(t,e,i){for(let s=0;s<this.m_controllers.length;++s)this.m_controllers[s].removeEventListener(t,e,i)}enable(){this.m_enabled=!0;for(let t=0;t<this.m_controllers.length;++t)this.m_controllers[t].enable()}disable(){this.m_enabled=!1;for(let t=0;t<this.m_controllers.length;++t)this.m_controllers[t].disable();this.m_target.setTargets(null)}isEnabled(){return this.m_enabled}run(){if(this.m_enabled){let t=this.m_controllers;this.m_tempPos.copyFrom(this.m_target.position);let e=this.m_editRS.getCamera(),i=this.m_editRS.getStage3D();if(this.fixSize>.01){let t=e.getViewMatrix(),i=e.getProjectMatrix();if(t.transformVector3Self(this.m_tempPos),this.m_pos0.setXYZ(0,0,this.m_tempPos.z),this.m_pos1.setXYZ(100,0,this.m_tempPos.z),i.transformVectorSelf(this.m_pos0),i.transformVectorSelf(this.m_pos1),this.m_pos1.x=this.m_pos1.x/this.m_pos1.w-this.m_pos0.x/this.m_pos0.w,Math.abs(this.m_px-this.m_pos1.x)>1e-4){this.m_px=this.m_pos1.x;let t=this.fixSize/this.m_pos1.x;this.m_target.setCtrlScaleXYZ(t,t,t),this.m_target.update()}}for(let s=0;s<t.length;++s)t[s].getVisible()&&t[s].run(e,this.m_rtv);if(this.m_mv1.setXYZ(i.mouseX,i.mouseY,0),CoMath.Vector3D.DistanceSquared(this.m_mv0,this.m_mv1)>.001){this.m_mv0.copyFrom(this.m_mv1),this.m_editRS.getMouseXYWorldRay(this.m_rpv,this.m_rtv);for(let e=0;e<t.length;++e)t[e].isSelected()&&t[e].moveByRay(this.m_rpv,this.m_rtv)}}}isSelected(){let t=!1,e=this.m_controllers;for(let i=0;i<e.length;++i)t=t||e[i].isSelected();return t}select(t){this.m_target.setTargets(t),this.m_target.select(null),this.setVisible(null!=t)}deselect(){this.m_target.deselect();for(let t=0;t<this.m_controllers.length;++t)this.m_controllers[t].deselect()}decontrol(){for(let t=0;t<this.m_controllers.length;++t)this.m_controllers[t].deselect();this.setVisible(!0)}getTargets(){return this.m_target.getTargets()}setVisible(t){this.m_visible=t;for(let e=0;e<this.m_controllers.length;++e)this.m_controllers[e].setVisible(t)}moveByRay(t,e){}getVisible(){return this.m_visible}setXYZ(t,e,i){}setPosition(t){this.m_target.setPosition(t),this.m_target.update()}getPosition(t){return this.m_controllers[0].getPosition(t),t}setRotation3(t){this.m_target.setRotation3(t)}setRotationXYZ(t,e,i){}setScaleXYZ(t,e,i){this.m_target.setScaleXYZ(t,e,i)}getRotationXYZ(t){}getScaleXYZ(t){}getGlobalBounds(){return null}getLocalBounds(){return null}localToGlobal(t){}globalToLocal(t){}update(){}destroy(){if(this.m_controllers.length>0){for(let t=0;t<this.m_controllers.length;++t)this.m_controllers[t].destroy();this.m_controllers=[]}this.m_editRS=null}}e.DragTransController=s},aebd:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("9e36");class o extends s.CtrlTargetBase{constructor(){super(),this.m_svs=[],this.m_sv=CoMath.createVec3(),this.m_pv=CoMath.createVec3()}select(t=null){let e=this.m_tars;if(null!=e){const t=this.m_vs,i=this.m_svs;let s=this.position;s.setXYZ(0,0,0);for(let o=0;o<e.length;++o)t[o].copyFrom(e[o].getGlobalBounds().center),s.addBy(t[o]);s.scaleBy(1/e.length);for(let o=0;o<e.length;++o)t[o].copyFrom(e[o].getGlobalBounds().center),t[o].subtractBy(s),e[o].getScaleXYZ(i[o])}}setTargets(t){if(this.m_tars=t,null!=t){if(null==this.m_vs||this.m_vs.length<t.length){this.m_vs=new Array(t.length),this.m_svs=new Array(t.length);for(let e=0;e<t.length;++e)this.m_vs[e]=CoMath.createVec3(),this.m_svs[e]=CoMath.createVec3()}}else this.m_vs=[],this.m_svs=[]}setPosition(t){for(let e=0;e<this.m_controllers.length;++e)this.m_controllers[e].setPosition(t),this.m_flags[e]=!0}setScaleXYZ(t,e,i){if(null!=this.m_tars){this.m_sv.setXYZ(t,e,i);const s=this.m_vs,o=this.m_svs,r=this.position;let l=this.m_pv,n=CoMath.createVec3(),a=CoMath.createVec3(),h=this.m_tars;for(let c=0;c<h.length;++c){const s=o[c];h[c].setScaleXYZ(s.x*t,s.y*e,s.z*i)}for(let t=0;t<h.length;++t)l.copyFrom(s[t]).multBy(this.m_sv).addBy(r),h[t].update(),n.subVecsTo(h[t].getGlobalBounds().center,l),h[t].getPosition(a),a.subtractBy(n),h[t].setPosition(a);this.m_changed=!0}}getScaleXYZ(t){t.setXYZ(1,1,1)}}e.ScaleTarget=o},bb6e:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("6e9f"),o=i("46e0");class r extends s.RotationCtr{constructor(){super(),this.m_entity=null,this.m_rotV=CoMath.createVec3(),this.m_scaleV=CoMath.createVec3(),this.m_posV=CoMath.createVec3(),this.m_srcDV=CoMath.createVec3(),this.m_dstDV=CoMath.createVec3(),this.m_camPos=CoMath.createVec3(),this.m_mat0=CoMath.createMat4(),this.m_stage=null,this.m_stagePos=CoMath.createVec3(),this.m_circle=null,this.m_editRS=null,this.m_editRSPI=0}initialize(t,e,i){if(null==this.m_entity){this.m_editRS=t,this.m_editRSPI=e,this.m_stage=t.getStage3D();let s=CoEntity.createBoundsEntity(),r=CoMath.createVec3(i,i,i).scaleBy(-1),l=CoMath.createVec3(i,i,i);s.setBounds(r,l),s.setRayTester(new o.SphereRayTester(i)),this.applyEvent(s),this.m_entity=s;let n=Math.floor(i/2);n<30&&(n=30);let a=CoRScene.RendererState,h=CoMath.createMat4();h.setRotationEulerAngle(.5*Math.PI,0,.5*Math.PI);let c=CoMesh.plane;c.transMatrix=h;let m=CoMaterial.createDefaultMaterial(!1);m.initializeByCodeBuf(!1),c.setBufSortFormat(m.getBufSortFormat());let _=c.createCircle(i,n),u=CoEntity.createDisplayEntity();u.setMaterial(m),u.setMesh(_),u.setRenderState(a.NONE_TRANSPARENT_ALWAYS_STATE),t.addEntity(u,e),this.m_circle=u,this.applyEvent(s),t.addEntity(this.m_entity,e)}}enable(){super.enable(),this.m_entity.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1}run(t,e){this.m_scaleV;let i=this.m_circle;i.getPosition(this.m_posV),this.m_camPos.copyFrom(t.getPosition()),this.m_srcDV.setXYZ(1,0,0),this.m_dstDV.subVecsTo(this.m_camPos,this.m_posV);let s=CoMath.Vector3D.RadianBetween(this.m_srcDV,this.m_dstDV),o=this.m_rotV;CoMath.Vector3D.Cross(this.m_srcDV,this.m_dstDV,o),o.normalize();let r=i.getTransform().getMatrix();r.identity(),r.appendRotation(s,o),r.appendTranslation(this.m_posV);let l=r.decompose(CoMath.OrientationType.EULER_ANGLES)[1];i.setRotation3(l.scaleBy(CoMath.MathConst.MATH_180_OVER_PI))}setVisible(t){this.m_entity.setVisible(t),this.m_circle.setVisible(t)}getVisible(){return this.m_entity.getVisible()}setXYZ(t,e,i){this.m_entity.setXYZ(t,e,i),this.m_circle.setXYZ(t,e,i)}setRotation3(t){}setRotationXYZ(t,e,i){}getScaleXYZ(t){}getRotationXYZ(t){}setScaleXYZ(t,e,i){this.m_entity.setScaleXYZ(t,e,i),this.m_circle.setScaleXYZ(t,e,i)}localToGlobal(t){this.m_entity.localToGlobal(t)}globalToLocal(t){this.m_entity.globalToLocal(t)}showOverColor(){this.overColor.a=.1,this.m_circle.getMaterial().setColor(this.overColor)}showOutColor(){this.outColor.a=.05,this.m_circle.getMaterial().setColor(this.outColor)}destroy(){super.destroy(),null!=this.m_entity&&(this.m_editRS.removeEntity(this.m_entity),this.m_entity.destroy(),this.m_entity=null),this.m_editRS=null,this.m_stage=null,this.m_mat0=null}setPosition(t){this.m_entity.setPosition(t),this.m_circle.setPosition(t)}getPosition(t){return this.m_entity.getPosition(t),t}update(){this.m_entity.update(),this.m_circle.update()}moveByRay(t,e){if(this.isEnabled()&&this.isSelected()){let t=this.m_target;if(null!=t){const e=.02;let i=this.m_editRS.getCamera(),s=i.getUV(),o=i.getRV(),r=this.m_stagePos,l=this.m_stage,n=this.m_mat0,a=l.mouseX-r.x,h=r.y-l.mouseY,c=this.m_rotV;n.identity(),n.appendRotation(a*e,s),n.appendRotation(h*e,o),c=n.decompose(CoMath.OrientationType.EULER_ANGLES)[1],t.setRotation3(c.scaleBy(CoMath.MathConst.MATH_180_OVER_PI)),t.update()}}}mouseDownListener(t){if(this.isEnabled()){this.editBegin(),this.m_target.select(),this.setThisVisible(!0);let t=this.m_stage;this.m_stagePos.setXYZ(t.mouseX,t.mouseY,0)}}}e.RotationCamXYCircle=r},c0e0:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("a27e"),o=i("9aa6"),r=i("3fdf"),l=i("5cc0"),n=i("bb6e");class a extends s.DragTransController{constructor(){super(),this.radius=100,this.pickTestAxisRadius=20,this.camZCircleRadius=120,this.camYXCircleRadius=80}createCircle(t,e,i=100,s=20){let r=new o.RotationCircle;return r.pickTestRadius=this.pickTestAxisRadius,r.outColor.copyFrom(e),r.overColor.copyFrom(e),r.overColor.scaleBy(2),r.initialize(this.m_editRS,this.m_editRSPI+1,i,s,t),r.showOutColor(),r.setTarget(this.m_target),this.m_target.addCtrlEntity(r),this.m_controllers.push(r),r}init(){this.m_target=new l.RotatedTarget;let t=Math.floor(this.radius/2);t<30&&(t=30);let e=CoMaterial.createColor4();this.createCircle(0,e.setRGBUint8(240,55,80),this.radius,t),this.createCircle(1,e.setRGBUint8(135,205,55),this.radius,t),this.createCircle(2,e.setRGBUint8(80,145,240),this.radius,t),t=Math.floor(this.camZCircleRadius/2);let i=new r.RotationCamZCircle;i.pickTestRadius=this.pickTestAxisRadius,i.initialize(this.m_editRS,this.m_editRSPI,this.camZCircleRadius,t),i.setTarget(this.m_target),this.m_target.addCtrlEntity(i),this.m_controllers.push(i);let s=new n.RotationCamXYCircle;s.pickTestRadius=this.pickTestAxisRadius,s.initialize(this.m_editRS,this.m_editRSPI,this.camYXCircleRadius),s.showOutColor(),s.setTarget(this.m_target),this.m_target.addCtrlEntity(s),this.m_controllers.push(s)}}e.DragRotationController=a},ccf5:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_container=null,this.m_ring=null,this.m_material=null,this.m_editRS=null,this.m_editRSPI=0,this.m_type=0,this.m_total=0}initialize(t,e,i,s,o){if(null==this.m_container){this.m_editRS=t,this.m_editRSPI=e;let r=CoEntity.createDisplayEntity();this.m_container=CoEntity.createDisplayEntityContainer();let l,n=CoMesh.line;n.dynColorEnabled=!0,this.m_type=o;let a=0,h=null,c=0;const m=.95;let _=2*Math.PI;switch(h=new Array(2*s),this.m_total=s,o){case 1:for(let t=s-1;t>=0;--t){a=_*t/s;const e=i*Math.cos(a),o=i*Math.sin(a);h[c++]=CoMath.createVec3(e,0,o),h[c++]=CoMath.createVec3(e*m,0,o*m)}break;case 2:for(let t=0;t<s;++t){a=_*t/s;const e=i*Math.cos(a),o=i*Math.sin(a);h[c++]=CoMath.createVec3(0,e,o),h[c++]=CoMath.createVec3(0,e*m,o*m)}break;default:for(let t=0;t<s;++t){a=_*t/s;const e=i*Math.cos(a),o=i*Math.sin(a);h[c++]=CoMath.createVec3(e,o,0),h[c++]=CoMath.createVec3(e*m,o*m,0)}break}l=n.createLines(h),r.setMesh(l),this.m_material=CoMaterial.createLineMaterial(n.dynColorEnabled),r.setMaterial(this.m_material),r.update(),this.m_ring=r,this.m_container.addEntity(r),t.addContainer(this.m_container,e)}}getContainer(){return this.m_container}setProgress(t){if(null!=this.m_ring){t<0&&(t+=2*Math.round(t)),t-=Math.floor(t);let e=2*this.m_total,i=Math.round(e*t)+2;i>e&&(i=e),this.m_ring.setIvsParam(0,i)}}setRingRotation(t){if(null!=this.m_ring){switch(this.m_type){case 1:this.m_ring.setRotationXYZ(0,t,0);break;case 2:this.m_ring.setRotationXYZ(t,0,0);break;default:this.m_ring.setRotationXYZ(0,0,t);break}this.m_ring.update()}}setVisible(t){this.m_container.setVisible(t)}getVisible(){return this.m_container.getVisible()}setXYZ(t,e,i){this.m_container.setXYZ(t,e,i)}setRotation3(t){this.m_container.setRotation3(t)}setRotationXYZ(t,e,i){this.m_container.setRotationXYZ(t,e,i)}setScaleXYZ(t,e,i){this.m_container.setScaleXYZ(t,e,i)}getScaleXYZ(t){this.m_container.getScaleXYZ(t)}getRotationXYZ(t){this.m_container.getRotationXYZ(t)}localToGlobal(t){this.m_container.localToGlobal(t)}globalToLocal(t){this.m_container.globalToLocal(t)}setColor(t){this.m_ring.getMaterial().setColor(t)}destroy(){null!=this.m_container&&(this.m_editRS.removeContainer(this.m_container),this.m_container.destroy(),this.m_container=null),this.m_editRS=null}setPosition(t){this.m_container.setPosition(t)}getPosition(t){this.m_container.getPosition(t)}update(){this.m_container.update()}}e.RotationRing=s},d2d6:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("46e0"),o=i("9c00");class r extends o.ScaleCtr{constructor(){super(),this.m_entity=null,this.m_rscene=null,this.m_billPos=null,this.m_circle=null,this.m_planeNV=CoMath.createVec3(0,1,0),this.m_planePos=CoMath.createVec3(),this.m_planeDis=0,this.m_pos=CoMath.createVec3(),this.m_dv=CoMath.createVec3(),this.m_outV=CoMath.createVec3(),this.m_rpv=CoMath.createVec3(),this.m_rtv=CoMath.createVec3(),this.m_sv=CoMath.createVec3(),this.m_dis=1}initialize(t,e,i=30){if(null==this.m_entity){this.m_rscene=t;let o=CoEntity.createBoundsEntity(),r=.5*i,l=CoMath.createVec3(r,r,r).scaleBy(-1),n=CoMath.createVec3(r,r,r);o.setBounds(l,n),o.setRayTester(new s.SphereRayTester(r)),this.applyEvent(o),this.m_rscene.addEntity(o,e),this.m_entity=o;let a=CoParticle.createBillboard();a.initializeSquare(.2*r,[this.createTexByUrl("static/assets/circle01.png")]),this.m_rscene.addEntity(a.entity,e+1);let h=CoRScene.RendererState;a.entity.setRenderState(h.NONE_TRANSPARENT_ALWAYS_STATE),this.m_billPos=a;let c=Math.floor(.5*r),m=CoParticle.createBillboardLine();m.initializeCircleXOY(r,c<50?50:c),this.m_rscene.addEntity(m.entity,e+1),m.entity.setRenderState(h.NONE_TRANSPARENT_ALWAYS_STATE),this.m_circle=m,this.showOutColor()}}createTexByUrl(t=""){let e=this.m_rscene.textureBlock.createImageTex2D(64,64,!1),i=new Image;return i.onload=t=>{e.setDataFromImage(i,0,0,0,!1)},i.src=""!=t?t:"static/assets/box.jpg",e}getEntity(){return this.m_entity}showOverColor(){let t=this.overColor;this.m_circle.setRGB3f(t.r,t.g,t.b)}showOutColor(){let t=this.outColor;this.m_circle.setRGB3f(t.r,t.g,t.b)}enable(){super.enable(),this.m_entity.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1}setRenderState(t){this.m_entity.setRenderState(t)}setVisible(t){this.m_entity.setVisible(t),this.m_circle.entity.setVisible(t),this.m_billPos.entity.setVisible(t)}getVisible(){return this.m_entity.getVisible()}setXYZ(t,e,i){this.m_entity.setXYZ(t,e,i),this.m_circle.setXYZ(t,e,i)}setPosition(t){this.m_entity.setPosition(t),this.m_circle.setPosition(t),this.m_billPos.setPosition(t)}getPosition(t){return this.m_entity.getPosition(t),t}setScaleXYZ(t,e,i){this.m_entity.setScaleXYZ(t,e,i),this.m_circle.setScaleXY(t,e),this.m_billPos.setScaleXY(t,e)}getScaleXYZ(t){this.m_entity.getScaleXYZ(t)}setRotation3(t){this.m_entity.setRotation3(t)}setRotationXYZ(t,e,i){this.m_entity.setRotationXYZ(t,e,i)}getRotationXYZ(t){this.m_entity.getRotationXYZ(t)}getGlobalBounds(){return this.m_entity.getGlobalBounds()}getLocalBounds(){return this.m_entity.getGlobalBounds()}localToGlobal(t){this.m_entity.localToGlobal(t)}globalToLocal(t){this.m_entity.globalToLocal(t)}update(){this.m_entity.update(),this.m_circle.update(),this.m_billPos.update()}destroy(){super.destroy(),null!=this.m_entity&&(this.m_rscene.removeEntity(this.m_entity),this.m_entity.destroy()),null!=this.m_circle&&(this.m_rscene.removeEntity(this.m_circle.entity),this.m_circle.destroy()),null!=this.m_billPos&&(this.m_rscene.removeEntity(this.m_billPos.entity),this.m_billPos.destroy()),this.m_rscene=null}calcClosePos(t,e){CoAGeom.PlaneUtils.IntersectLinePos2(this.m_planeNV,this.m_planeDis,t,e,this.m_outV)}moveByRay(t,e){if(this.isEnabled()&&this.isSelected()){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e),this.calcClosePos(this.m_rpv,this.m_rtv);let i=CoMath.Vector3D,s=i.Distance(this.m_pos,this.m_outV);s<1&&(s=1);const o=this.m_sv;let r=s/this.m_dis;null!=this.m_target&&(this.m_target.setScaleXYZ(o.x*r,o.y*r,o.z*r),this.m_target.update())}}setPlaneNormal(t){this.m_planeNV.copyFrom(t),this.m_planeNV.normalize()}selectByParam(t,e,i){this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e),this.m_planePos.copyFrom(i),this.m_planeNV.copyFrom(this.m_rtv),this.m_planeNV.normalize(),this.m_planeDis=this.m_planePos.dot(this.m_planeNV),this.calcClosePos(this.m_rpv,this.m_rtv),this.getPosition(this.m_dv),this.m_dv.subtractBy(this.m_outV)}mouseDownListener(t){if(this.isEnabled()){this.editBegin(),this.setThisVisible(!0),this.m_target.select(),this.selectByParam(t.raypv,t.raytv,t.wpos),this.m_target.getScaleXYZ(this.m_sv),this.getPosition(this.m_pos);let e=CoMath.Vector3D;this.m_dis=e.Distance(this.m_pos,this.m_outV),this.m_dis<1&&(this.m_dis=1)}}}e.default=r},d9b5:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("46e0"),o=i("1cb4"),r=i("45f9");class l extends r.MoveCtr{constructor(){super(),this.m_entity=null,this.m_cone=null,this.innerSphereRadius=30,this.tv=CoMath.createVec3(1,0,0),this.coneTransMat4=CoMath.createMat4(),this.coneScale=1,this.m_line_pv=CoMath.createVec3(),this.m_initPos=CoMath.createVec3(),this.m_pos=CoMath.createVec3(),this.m_dv=CoMath.createVec3(),this.m_outV=CoMath.createVec3(),this.m_initV=CoMath.createVec3(),this.m_mat4=CoMath.createMat4(),this.m_invMat4=CoMath.createMat4(),this.m_rpv=CoMath.createVec3(),this.m_rtv=CoMath.createVec3()}initialize(t=100,e=0){if(null==this.m_entity){let i=this.pickTestRadius;CoMesh.line.dynColorEnabled=!0;let r=this.tv.clone().scaleBy(e),l=this.tv.clone().scaleBy(t),n=CoMesh.line.createLine(r,l,i),a=CoMaterial.createLineMaterial(!0);if(this.m_entity=CoEntity.createDisplayEntity(),this.m_entity.setMaterial(a),this.m_entity.setMesh(n),null!=n){let t=new o.DashedLineRayTester(n.getVS(),1,i);t.setPrevTester(new s.SphereRayTester(this.innerSphereRadius)),n.setRayTester(t)}this.applyEvent(this.m_entity),a=CoMaterial.createDefaultMaterial(),a.initializeByCodeBuf(!1),CoMesh.cone.setBufSortFormat(a.getBufSortFormat()),CoMesh.cone.transMatrix=this.coneTransMat4,n=CoMesh.cone.create(.5*this.coneScale*i,1.5*this.coneScale*i,10,0),this.m_cone=CoEntity.createDisplayEntity(),this.m_cone.setMaterial(a),this.m_cone.setMesh(n),this.applyEvent(this.m_cone)}}getCone(){return this.m_cone}getEntity(){return this.m_entity}setVisible(t){this.m_entity.setVisible(t),this.m_cone.setVisible(t)}getVisible(){return this.m_entity.getVisible()}setXYZ(t,e,i){this.m_entity.setXYZ(t,e,i)}setRotation3(t){this.m_entity.setRotation3(t)}setRotationXYZ(t,e,i){this.m_entity.setRotationXYZ(t,e,i)}setScaleXYZ(t,e,i){this.m_entity.setScaleXYZ(t,e,i)}getScaleXYZ(t){this.m_entity.getScaleXYZ(t)}getRotationXYZ(t){this.m_entity.getRotationXYZ(t)}localToGlobal(t){this.m_entity.localToGlobal(t)}globalToLocal(t){this.m_entity.globalToLocal(t)}showOverColor(){let t=this.m_entity.getMaterial();t.setColor(this.overColor),t=this.m_cone.getMaterial(),t.setColor(this.overColor)}showOutColor(){let t=this.m_entity.getMaterial();t.setColor(this.outColor),t=this.m_cone.getMaterial(),t.setColor(this.outColor)}enable(){super.enable(),this.m_entity.mouseEnabled=!0,this.m_cone.mouseEnabled=!0}disable(){super.disable(),this.m_entity.mouseEnabled=!1,this.m_cone.mouseEnabled=!1}destroy(){super.destroy(),null!=this.m_entity&&(this.m_entity.destroy(),this.m_entity=null),null!=this.m_cone&&(this.m_cone.destroy(),this.m_cone=null)}setPosition(t){this.m_entity.setPosition(t)}getPosition(t){return this.m_entity.getPosition(t),t}update(){this.m_entity.update(),this.m_cone.update()}calcClosePos(t,e){if(this.isSelected()){let i=this.m_invMat4;i.transformVector3Self(t),i.deltaTransformVectorSelf(e);let s=this.m_outV;CoAGeom.Line.CalcTwoSLCloseV2(t,e,this.m_line_pv,this.tv,s),i=this.m_mat4,i.transformVector3Self(s)}}moveByRay(t,e){this.isEnabled()&&this.isSelected()&&(this.m_rpv.copyFrom(t),this.m_rtv.copyFrom(e),this.calcClosePos(this.m_rpv,this.m_rtv),this.m_dv.copyFrom(this.m_outV),this.m_dv.subtractBy(this.m_initV),this.m_pos.copyFrom(this.m_initPos),this.m_pos.addBy(this.m_dv),this.moveSelfEnabled&&(this.setPosition(this.m_pos),this.update()),null!=this.m_target&&(this.m_target.setPosition(this.m_pos),this.m_target.update()))}mouseDownListener(t){if(this.isEnabled()){this.editBegin(),this.setThisVisible(!0),this.m_target.select(this);let e=this.m_entity.getTransform();this.m_mat4.copyFrom(e.getMatrix()),this.m_invMat4.copyFrom(e.getInvMatrix()),this.m_rpv.copyFrom(t.raypv),this.m_rtv.copyFrom(t.raytv),this.calcClosePos(this.m_rpv,this.m_rtv),this.m_initV.copyFrom(this.m_outV),this.getPosition(this.m_initPos)}}}e.DragLine=l},ea99:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("700c"),o=i("9386"),r=i("c0e0");class l{constructor(){this.m_rsc=null,this.m_enabled=!1,this.m_controllers=[null,null,null],this.m_wpos=CoMath.createVec3(),this.m_targets=null,this.m_movedCtr=null,this.m_scaleCtr=null,this.m_rotatedCtr=null,this.m_type=-1,this.TRANSLATION=0,this.SCALE=1,this.ROTATION=2}initialize(t,e=0){if(null==this.m_rsc){this.m_rsc=t;let e=this.m_controllers,i=this.m_movedCtr=new s.DragMoveController;i.axisSize=100,i.planeSize=30,i.pickTestAxisRadius=10,i.runningVisible=!0,i.initialize(t,0),i.disable(),i.setVisible(!1),e[0]=i;let l=this.m_scaleCtr=new o.DragScaleController;l.axisSize=100,l.planeSize=30,l.pickTestAxisRadius=10,l.initialize(t,0),l.disable(),l.setVisible(!1),e[1]=l;let n=this.m_rotatedCtr=new r.DragRotationController;n.pickTestAxisRadius=10,n.runningVisible=!0,n.initialize(t,0),n.disable(),n.setVisible(!1),e[2]=n}}addEventListener(t,e,i,s=!0,o=!1){let r=this.m_controllers;for(let l=0;l<r.length;++l)r[l].addEventListener(t,e,i,s,o)}removeEventListener(t,e,i){let s=this.m_controllers;for(let o=0;o<s.length;++o)s[o].removeEventListener(t,e,i)}toTranslation(){this.enable(this.TRANSLATION)}toScale(){this.enable(this.SCALE)}toRotation(){this.enable(this.ROTATION)}getCurrType(){return this.m_type}enable(t=-1){let e=this.m_controllers,i=this.m_type;if(this.m_enabled=!0,t>=0&&t<=2){if(i!=t){let s=this.m_targets;i>=0&&(null==s&&(s=e[i].getTargets()),e[i].getPosition(this.m_wpos),e[i].decontrol(),e[i].disable(),e[i].setVisible(!1)),this.m_type=t,e[t].enable(),null!=s&&this.select(s,this.m_wpos,!1)}}else i>=0&&e[i].enable()}disable(t=!1){this.m_enabled=!1,this.m_targets=null;let e=this.m_controllers,i=this.m_type;i>=0&&(e[i].decontrol(),e[i].disable(),e[i].setVisible(!1)),t&&(this.m_type=-1)}decontrol(){this.m_enabled&&this.m_type>=0&&this.m_controllers[this.m_type].decontrol()}select(t,e=null,i=!0){if(null!=t)if(this.m_type>=0){if(null==e){let e=this.m_wpos,i=CoMath.createVec3();e.setXYZ(0,0,0);for(let s=0;s<t.length;++s)e.addBy(t[s].getPosition(i));e.scaleBy(1/t.length)}else this.m_wpos.copyFrom(e);let s=this.m_controllers[this.m_type];i&&!s.isEnabled()&&(this.m_enabled=!0,s.enable()),s.deselect(),s.setPosition(this.m_wpos),s.update(),s.select(t),s.setVisible(!0)}else this.m_targets=t,this.m_wpos.copyFrom(e)}run(){this.m_enabled&&this.m_type>=0&&this.m_controllers[this.m_type].run()}}e.TransformController=l},f60a:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("268d");class o{constructor(){this.m_enabled=!1,this.m_flag=-1,this.m_dispatcher=null,this.m_target=null,this.m_ctrList=null,this.editType="",this.runningVisible=!0,this.uuid="editCtrl",this.moveSelfEnabled=!0;let t=new Map;const e=s.UserEditEvent;let i=CoRScene.createEvtNode();i.type=e.EDIT_BEGIN,t.set(i.type,i),i=CoRScene.createEvtNode(),i.type=e.EDIT_END,t.set(i.type,i),this.m_evtMap=t}editBegin(){this.m_flag=1;let t=this.m_evtMap.get(s.UserEditEvent.EDIT_BEGIN),e=t.createEvent(this,this);t.dispatch(e),e.target=null,e.currentTarget=null}editEnd(){this.m_flag=-1;let t=this.m_evtMap.get(s.UserEditEvent.EDIT_END),e=t.createEvent(this,this);t.dispatch(e),e.target=null,e.currentTarget=null}enable(){this.m_enabled=!0}disable(){this.m_enabled=!1}isEnabled(){return this.m_enabled}isSelected(){return this.m_flag>-1}select(){}deselect(){this.isSelected()&&(this.editEnd(),this.setAllVisible(!0))}setVisible(t){}getVisible(){return!1}getGlobalBounds(){return null}getLocalBounds(){return null}addEventListener(t,e,i,s=!0,o=!1){if(this.m_evtMap.has(t)){let s=this.m_evtMap.get(t);s.addListener(e,i)}else this.m_dispatcher.addEventListener(t,e,i,s,o)}removeEventListener(t,e,i){if(this.m_evtMap.has(t)){let s=this.m_evtMap.get(t);s.removeListener(e,i)}else this.m_dispatcher.removeEventListener(t,e,i)}setTarget(t){this.m_target=t}getTargetEntities(){if(null!=this.m_target)return this.m_target.getTargets()}applyEvent(t){if(null==this.m_dispatcher){const t=CoRScene.MouseEvent;let e=CoRScene.createMouseEvt3DDispatcher();e.addEventListener(t.MOUSE_DOWN,this,this.mouseDownListener),e.addEventListener(t.MOUSE_OVER,this,this.mouseOverListener),e.addEventListener(t.MOUSE_OUT,this,this.mouseOutListener),this.m_dispatcher=e}t.setEvtDispatcher(this.m_dispatcher),t.mouseEnabled=!0}mouseOverListener(t){this.showOverColor()}mouseOutListener(t){this.showOutColor()}mouseDownListener(t){}showOverColor(){}showOutColor(){}run(t,e){}destroy(){if(this.m_target=null,this.m_ctrList=null,null!=this.m_dispatcher){for(var[t,e]of this.m_evtMap.entries())e.destroy();this.m_dispatcher.destroy(),this.m_dispatcher=null}}setAllVisible(t){let e=this.m_ctrList;for(let i=0;i<e.length;++i)e[i].setVisible(t)}setThisVisible(t){let e=this.m_ctrList;if(t)for(let i=0;i<e.length;++i)e[i].setVisible(e[i]==this);else for(let i=0;i<e.length;++i)e[i].setVisible(e[i]!=this)}}e.UserEditCtr=o},fae3:function(t,e,i){"use strict";i.r(e);i("1eb2");var s=i("5fe2");for(var o in s)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(o)}})}));