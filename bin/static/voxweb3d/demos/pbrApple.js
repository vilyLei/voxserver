(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["VoxApp"]=e():t["VoxApp"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s="fae3")}({"01e3":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2fe8")),a=i(s("725b")),n=i(s("3930")),l=i(s("8e17"));class h{constructor(){this.A=null,this.B=0,this.C=!1,this.D=!1,this.E=0,this.F=0,this.step=2,this.fontSize=32,this.loadingName="resource",this.loadingInfo="loading",this.loadingNameScale=2,this.loadingInfoScale=2,this.loadingNamePos=new l.default(0,-230,0),this.loadingInfoPos=new l.default(0,-370,0),this.loadingNameColor=new n.default(.3,1.7,.5),this.loadingInfoColor=new n.default(.5,.5,1.3)}initialize(t,e=0){null==this.A&&(this.A=t,this.B=e,this.init())}init(){let t=a.default.GetInstance();t.mobileEnabled=!1,t.setRenderProxy(this.A.getRenderProxy()),t.initialize("fontTex",this.fontSize,512,512,!1,!0),""!=this.loadingName&&(this.G=new r.default,this.G.initialize(this.loadingName),this.G.setPosition(this.loadingNamePos),this.G.setScaleXY(this.loadingNameScale,this.loadingNameScale),this.G.setRGB3f(this.loadingNameColor.r,this.loadingNameColor.g,this.loadingNameColor.b),this.A.addEntity(this.G,this.B)),this.H=new r.default,this.H.initialize(this.loadingInfo+"..."),this.H.setPosition(this.loadingInfoPos),this.H.setScaleXY(this.loadingInfoScale,this.loadingInfoScale),this.H.setRGB3f(this.loadingInfoColor.r,this.loadingInfoColor.g,this.loadingInfoColor.b),this.A.addEntity(this.H,this.B)}isLoaded(){return this.C}reset(){this.E=0,this.F=0,this.D=this.C=!1}run(t){if(this.D)this.C=!0,this.H.getVisible()&&(this.H.setVisible(!1),this.A.removeEntity(this.H),null!=this.G&&(this.G.setVisible(!1),this.A.removeEntity(this.G)));else if(null!=this.H&&this.E<this.F&&this.F>0){this.E+=4,this.E>this.F&&(this.E=this.F);let t=this.E/100;this.H.setText(this.loadingInfo+" "+Math.round(100*t)+"%"),this.H.updateMeshToGpu(),this.H.update()}let e=t;this.F=Math.round(100*e),this.F>=100&&this.E>=this.F&&(this.D=!0)}}e.TextBillboardLoading=h},"0236":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("a996")),a=i(s("1710")),n=i(s("7045")),l=i(s("3024")),h=i(s("badb"));class o{constructor(t,e){this.I=0,this.pixelRatio=1,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.J=0,this.K=0,this.L=1,this.M=1,this.N=new h.default,this.O=[],this.P=[],this.Q=[],this.R=[],this.S=[],this.T=[],this.U=[],this.V=[],this.uProbe=null,this.W=0,this.X=0,this.Y=new a.default,this.Z=!0,this.a=new r.default,this.I=t}getRCUid(){return this.I}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.J}getViewY(){return this.K}getViewWidth(){return this.L}getViewHeight(){return this.M}setViewPort(t,e,s,i){this.Z=!1,this.J=t,this.K=e,s==this.L&&i==this.M||(this.L=s,this.M=i,this.updateViewUData())}updateViewUData(){null==this.uProbe&&(this.uProbe=new l.default(1),this.uProbe.bindSlotAt(this.I)),this.uProbe.setVec4Data(2/(this.L*this.pixelRatio),2/(this.M*this.pixelRatio),this.L*this.pixelRatio,this.M*this.pixelRatio),this.uProbe.update(),this.W=this.L,this.X=this.M}update(){this.W==this.stageWidth&&this.X==this.stageHeight||(this.Z&&(this.L=this.stageWidth,this.M=this.stageHeight,this.updateViewUData()),this.stageHalfWidth=.5*this.stageWidth,this.stageHalfHeight=.5*this.stageHeight)}mouseDown(t=1){this.Y.type=a.default.MOUSE_DOWN,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=t,this.N.dispatchEvt(this.Y)}mouseUp(t=1){this.Y.phase=1,this.Y.type=a.default.MOUSE_UP,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=t,this.N.dispatchEvt(this.Y)}mouseClick(){this.Y.type=a.default.MOUSE_CLICK,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseDoubleClick(){this.Y.type=a.default.MOUSE_DOUBLE_CLICK,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseRightDown(t=1){this.Y.type=a.default.MOUSE_RIGHT_DOWN,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseRightUp(t=1){this.Y.type=a.default.MOUSE_RIGHT_UP,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseBgDown(){this.Y.type=a.default.MOUSE_BG_DOWN,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseBgUp(){this.Y.type=a.default.MOUSE_BG_UP,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseBgClick(){this.Y.type=a.default.MOUSE_BG_CLICK,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseRightClick(){this.Y.type=a.default.MOUSE_RIGHT_CLICK,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseMove(){this.Y.type=a.default.MOUSE_MOVE,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseWheel(t){this.Y.type=a.default.MOUSE_WHEEL,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.wheelDeltaY=t.wheelDeltaY,this.Y.target=this,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseCancel(){this.Y.type=a.default.MOUSE_CANCEL,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseMultiDown(t){this.Y.type=a.default.MOUSE_MULTI_DOWN,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.Y.posArray=t,this.N.dispatchEvt(this.Y)}mouseMultiUp(t){this.Y.type=a.default.MOUSE_MULTI_UP,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.Y.posArray=t,this.N.dispatchEvt(this.Y)}mouseMultiMove(t){this.Y.type=a.default.MOUSE_MULTI_MOVE,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.Y.posArray=t,this.N.dispatchEvt(this.Y)}mouseWindowUp(t=1){}mouseWindowRightUp(t=1){}enterFrame(){this.a.type=r.default.ENTER_FRAME;let t=this.Q.length;for(var e=0;e<t;++e)this.Q[e].call(this.R[e],this.a)}addEventListener(t,e,s,i=!0,a=!0){if(null!=s&&null!=e){let l=0;switch(t){case r.default.RESIZE:break;case r.default.ENTER_FRAME:for(l=this.Q.length-1;l>=0;--l)if(e===this.R[l])break;l<0&&(this.R.push(e),this.Q.push(s));break;case n.default.KEY_DOWN:break;case n.default.KEY_UP:break;default:this.N.addEventListener(t,e,s,i,a);break}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=0;switch(t){case r.default.RESIZE:for(i=this.O.length-1;i>=0;--i)if(e===this.P[i]){this.P.splice(i,1),this.O.splice(i,1);break}break;case r.default.ENTER_FRAME:for(i=this.Q.length-1;i>=0;--i)if(e===this.R[i]){this.R.splice(i,1),this.Q.splice(i,1);break}break;case n.default.KEY_DOWN:for(i=this.S.length-1;i>=0;--i)if(e===this.T[i]){this.T.splice(i,1),this.S.splice(i,1);break}break;case n.default.KEY_UP:for(i=this.U.length-1;i>=0;--i)if(e===this.V[i]){this.V.splice(i,1),this.U.splice(i,1);break}break;default:this.N.removeEventListener(t,e,s);break}}}}e.default=o},"030e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Initialize(t,e){let s=this;1==t?(s.OES_standard_derivatives=e.getExtension("OES_standard_derivatives"),s.OES_standard_derivatives,s.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),s.EXT_shader_texture_lod,s.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),s.WEBGL_draw_buffers,s.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),s.OES_vertex_array_object,s.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),s.ANGLE_instanced_arrays,s.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),s.EXT_color_buffer_float,s.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),s.EXT_color_buffer_half_float,s.OES_texture_half_float=e.getExtension("OES_texture_half_float"),s.OES_texture_half_float,s.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),s.OES_texture_half_float_linear,s.OES_texture_float=e.getExtension("OES_texture_float"),s.OES_texture_float,s.OES_element_index_uint=e.getExtension("OES_element_index_uint"),s.OES_element_index_uint,s.EXT_blend_minmax=e.getExtension("EXT_blend_minmax"),s.EXT_blend_minmax):(s.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),s.EXT_shader_texture_lod,s.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),s.EXT_color_buffer_half_float,s.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),s.OES_texture_half_float_linear,s.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),s.EXT_color_buffer_float),s.OES_texture_float_linear=e.getExtension("OES_texture_float_linear"),s.OES_texture_float_linear,s.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),s.WEBGL_depth_texture,s.WEBGL_debug_renderer_info=e.getExtension("WEBGL_debug_renderer_info"),s.WEBGL_debug_renderer_info}}i.OES_standard_derivatives=null,i.EXT_shader_texture_lod=null,i.WEBGL_draw_buffers=null,i.OES_vertex_array_object=null,i.ANGLE_instanced_arrays=null,i.EXT_color_buffer_float=null,i.EXT_color_buffer_half_float=null,i.OES_texture_float_linear=null,i.OES_texture_half_float_linear=null,i.OES_texture_half_float=null,i.OES_texture_float=null,i.OES_element_index_uint=null,i.EXT_blend_minmax=null,i.WEBGL_depth_texture=null,i.WEBGL_debug_renderer_info=null,e.default=i},"0714":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t=null){this.b=i.F_0++,this.c=null,this.d=!1,this.e=new Map,this.f=[],this.g=null,this.h=null,this.i=null,this.j="",this.uuid="",this.h=t}getUid(){return this.b}addShaderCodeWithUUID(t,e){null!=this.h&&this.addShaderCode(this.h.getShaderCodeObjectWithUUID(t),e)}addShaderCode(t,e=!1){this.d=null!=t,(null==this.c||null!=t&&e)&&(this.c=t)}hasShaderCode(){return null!=this.c}addPipe(t){let e=t.getPipeTypes();for(let s=0;s<e.length;++s)this.e.has(e[s])||this.e.set(e[s],t)}getPipeByType(t){return this.e.get(t)}hasPipeByType(t){return this.e.has(t)}createKeys(t){if(this.f=[],null!=t){let e,s,i=t;for(let t=0;t<i.length;++t)s=i[t],this.e.has(s)&&(e=this.e.get(s),this.f.push(e.getPipeKey(s)))}}buildSharedUniforms(t){if(this.g=[],this.i=t,null!=t){let e,s,i=t;for(let t=0;t<i.length;++t)s=i[t],this.e.has(s)&&(e=this.e.get(s),e.resetPipe(),this.g.push(e.getGlobalUinform()))}}build(t){if(this.d&&null!=this.c&&t.addShaderObject(this.c),null!=this.i){let e,s,i=this.i;for(let r=0;r<i.length;++r)s=i[r],this.e.has(s)&&(e=this.e.get(s),e.useShaderPipe(t,s))}}getTextures(t,e,s){if(null!=s){let i,r,a=s;for(let s=0;s<a.length;++s)r=a[s],this.e.has(r)&&(i=this.e.get(r),i.getTextures(t,e,r))}}getSharedUniforms(){return this.g}getSelfUniformData(){return null}appendKeyString(t){this.j+=t}getKeys(){return this.f}getKeysString(){let t="";for(let e=0;e<this.f.length;++e)t+=this.f[e];return t+this.j}reset(){this.j="",this.d=!1}clear(){this.e=new Map,this.f=[],this.g=null,this.c=null,this.h=null,this.i=null}}i.F_0=0,e.MaterialPipeline=i},"0851":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("6e01")),n=i(s("da6a"));class l{constructor(t,e,s=!1){this.b=-1,this.k=0,this.l=null,this.m=null,this.n=-1,this.o=128,this.p=128,this.q=128,this.r=128,this.s=r.TextureTarget.TEXTURE_2D,this.t=-1,this.u=!1,this.v=r.TextureProxyType.Default,this.w=!0,this.name="TextureProxy",this.internalFormat=r.TextureFormat.RGBA,this.srcFormat=r.TextureFormat.RGBA,this.dataType=r.TextureDataType.UNSIGNED_BYTE,this.wrap_s=r.TextureConst.WRAP_CLAMP_TO_EDGE,this.wrap_t=r.TextureConst.WRAP_CLAMP_TO_EDGE,this.wrap_r=r.TextureConst.WRAP_CLAMP_TO_EDGE,this.mipmapEnabled=!1,this.flipY=!1,this.premultiplyAlpha=!1,this.unpackAlignment=4,this.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,this.magFilter=r.TextureConst.LINEAR,this.version=0,this.m=n.default.GetInstance(),this.b=this.m.getFreeUid(),t<1&&(t=128),e<1&&(e=128),s?(this.o=a.default.CalcNearestCeilPow2(t),this.p=a.default.CalcNearestCeilPow2(e)):(this.o=t,this.p=e),this.m.__$$addTexture(this)}__$$use(t){t.bindToGpu(this.getResUid())}__$setRenderProxy(t){null!=this.m||(this.m=n.default.GetInstance(),this.b=this.m.getFreeUid(),this.m.__$$addTexture(this)),this.l=t}__$attachThis(){-1==this.k&&(this.m.removeFreeUid(this.getUid()),this.k=0),++this.k}__$detachThis(){this.k>0&&(--this.k,this.k<1&&(this.k=-1,this.m.addFreeUid(this.getUid())))}getAttachCount(){return this.k}isDirect(){return!0}getType(){return this.v}getResUid(){return this.b}getUid(){return this.b}setWrap(t){this.wrap_s=this.wrap_t=this.wrap_r=t}isGpuEnabled(){return null!=this.l&&this.l.Texture.hasResUid(this.getResUid())}getSampler(){return this.t}getTargetType(){return this.s}getBufWidth(){return this.q}getBufHeight(){return this.r}getWidth(){return this.o}getHeight(){return this.p}isDataEnough(){return this.u}uploadFromFbo(t,e,s){}__$buildParam(t){this.q=this.o,this.r=this.p,t.texParameteri(this.t,t.TEXTURE_WRAP_S,r.TextureConst.GetConst(t,this.wrap_s)),t.texParameteri(this.t,t.TEXTURE_WRAP_T,r.TextureConst.GetConst(t,this.wrap_t)),t.texParameteri(this.t,t.TEXTURE_MIN_FILTER,r.TextureConst.GetConst(t,this.minFilter)),t.texParameteri(this.t,t.TEXTURE_MAG_FILTER,r.TextureConst.GetConst(t,this.magFilter)),this.s==r.TextureTarget.TEXTURE_3D&&(t.texParameteri(this.t,t.TEXTURE_WRAP_R,r.TextureConst.GetConst(t,this.wrap_r)),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_BASE_LEVEL,0),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MAX_LEVEL,Math.log2(this.o))),this.mipmapEnabled&&this.w&&t.generateMipmap(this.t)}generateMipmap(t){if(this.mipmapEnabled&&this.w){let e=t.getRC();t.bindToGpu(this.getResUid()),this.__$buildParam(e)}}uploadData(t){}__$updateToGpu(t){}updateDataToGpu(t=null,e=!0){null!=t&&(this.l=t),null!=this.l&&this.l.MaterialUpdater.updateTextureData(this,e)}createTexBuf(t){return!t.hasResUid(this.getResUid())&&(this.t=r.TextureTarget.GetValue(t.getRC(),this.s),t.createResByParams3(this.getResUid(),this.getWidth(),this.getHeight(),this.t),!0)}__$$upload(t){if(this.u&&null!=this.m){let e=this.createTexBuf(t);e&&(this.__$updateToGpuBegin(t),this.uploadData(t),this.__$buildParam(t.getRC()),this.w=!0)}}dataUploadToGpu(t,e,s,i=!1){this.version=0;let a=r.TextureFormat.ToGL(t,this.internalFormat),n=r.TextureFormat.ToGL(t,this.srcFormat),l=r.TextureDataType.ToGL(t,this.dataType),h=e;if(null==s)(h.status>-1||i)&&h.updateToGpu(t,this.t,a,n,l,i);else{let e=s;for(let s=0,r=e.length;s<r;++s)h=e[s],null!=h&&(h.status>-1||i)&&h.updateToGpu(t,this.t,a,n,l,i);this.w=!1}}__$updateToGpuBegin(t){let e=t.getRC();t.bindToGpu(this.getResUid()),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,this.unpackAlignment)}__$updateToGpuEnd(t){}isDestroyed(){return this.k<-1}__$destroy(){this.getAttachCount()<1&&(this.k=-2,this.u=!1,this.o=1,this.p=1,this.l=null)}__$$removeFromSlot(){null!=this.m&&-2==this.getAttachCount()&&(this.m=null,this.l=null,this.b=-1)}toString(){return"[TextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.TextureProxy=l,e.default=l},"090c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("030e")),a=i(s("3b73")),n=i(s("b0ef")),l=i(s("0c85")),h=s("e08e");class o{constructor(){this.b=o.F_0++,this.x=new l.default,this.y=null,this.z=null,this.A_=null,this.B_=!1,this.C_=!0,this.D_=!0,this.E_=null,this.F_=null,this.G_=null,this.H_=0,this.I_=0,this.J_=800,this.K_=600,this.L_=2,this.M_=2,this.N_=1,this.O_=new n.default,this.autoSyncRenderBufferAndWindowSize=!0,this.offscreenRenderEnabled=!1,this.P_=null,this.Q_=0,this.R_=0,this.S_=0,this.T_=0,this.U_=null,this.V_=null}contextrestoredHandler(t){}contextlostHandler(t){}setWebGLMaxVersion(t){1!=t&&2!=t||(this.L_=t)}getWebGLVersion(){return this.M_}getDiv(){return this.y}setDivStyleLeftAndTop(t,e){this.O_.setDivStyleLeftAndTop(t,e)}setDivStyleSize(t,e){this.O_.setDivStyleSize(t,e)}getCanvas(){return this.z}isDepthTestEnabled(){return this.C_}isStencilTestEnabled(){return this.D_}initialize(t,e,s,i=null){this.G_=e;var n=null,l=null;try{void 0!=document&&(n=document,l=window)}catch(m){}if(null!=n){this.O_.setDiv(s),this.O_.createViewEle(n,this.autoSyncRenderBufferAndWindowSize),this.y=s=this.O_.getDiv();let m=this.z=this.O_.getCanvas();this.N_=window.devicePixelRatio,this.x.dpr=this.N_;let _=i;null==i?_={depth:this.C_,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:this.D_,preserveDrawingBuffer:!0,powerPreference:"default"}:(this.C_=_.depth,this.D_=_.stencil);let u=null;if(this.offscreenRenderEnabled&&(u=m.transferControlToOffscreen()),this.E_=u,2==this.L_&&(this.F_=null==u?m.getContext("webgl2",_):u.getContext("webgl2",_),null!=this.F_&&(this.M_=2)),null==this.F_&&(this.F_=null==u?m.getContext("webgl",_)||m.getContext("experimental-webgl",_):u.getContext("webgl",_)||u.getContext("experimental-webgl",_),null!=this.F_&&(this.M_=1)),!this.F_)throw this.M_=-1,alert("Unable to initialize WebGL. Your browser or machine may not support it."),Error("WebGL initialization failure.");let d=this.F_;d.rcuid=t;let c=h.GLStencilFunc;c.NEVER=d.NEVER,c.LESS=d.LESS,c.EQUAL=d.EQUAL,c.GREATER=d.GREATER,c.NOTEQUAL=d.NOTEQUAL,c.GEQUAL=d.GEQUAL,c.ALWAYS=d.ALWAYS;let f=h.GLStencilOp;f.KEEP=d.KEEP,f.ZERO=d.ZERO,f.REPLACE=d.REPLACE,f.INCR=d.INCR,f.INCR_WRAP=d.INCR_WRAP,f.DECR=d.DECR,f.DECR_WRAP=d.DECR_WRAP,f.INVERT=d.INVERT;let p=h.GLBlendMode;p.ZERO=d.ZERO,p.ONE=d.ONE,p.SRC_COLOR=d.SRC_COLOR,p.DST_COLOR=d.DST_COLOR,p.SRC_ALPHA=d.SRC_ALPHA,p.DST_ALPHA=d.DST_ALPHA,p.ONE_MINUS_SRC_ALPHA=d.ONE_MINUS_SRC_ALPHA;let g=h.GLBlendEquation;g.FUNC_ADD=d.FUNC_ADD,g.FUNC_SUBTRACT=d.FUNC_SUBTRACT,g.FUNC_REVERSE_SUBTRACT=d.FUNC_REVERSE_SUBTRACT,g.MIN_EXT=d.MIN_EXT,g.MAX_EXT=d.MAX_EXT,g.MIN=d.MIN,g.MAX=d.MAX;let v=h.CullFaceMode;v.BACK=d.BACK,v.FRONT=d.FRONT,v.FRONT_AND_BACK=d.FRONT_AND_BACK;let x=a.default;x.MAX_TEXTURE_SIZE=this.F_.getParameter(this.F_.MAX_TEXTURE_SIZE),x.MAX_RENDERBUFFER_SIZE=this.F_.getParameter(this.F_.MAX_RENDERBUFFER_SIZE);let T=this.F_.getParameter(this.F_.MAX_VIEWPORT_DIMS);x.MAX_VIEWPORT_WIDTH=T[0],x.MAX_VIEWPORT_HEIGHT=T[1],r.default.Initialize(this.M_,this.F_),a.default.Initialize([this.M_]),null!=e&&this.x.initialize(m,s,e);let E=r.default.WEBGL_debug_renderer_info;if(null!=E){let t=this.F_.getParameter(E.UNMASKED_VENDOR_WEBGL),e=this.F_.getParameter(E.UNMASKED_RENDERER_WEBGL);x.GPU_VENDOR=t,x.GPU_RENDERER=e,a.default.IsWinExternalVideoCard()}var o=this;l.onresize=function(t){o.autoSyncRenderBufferAndWindowSize&&o.updateRenderBufferSize()},m.addEventListener("webglcontextrestored",this.contextrestoredHandler,!1),m.addEventListener("webglcontextlost",this.contextlostHandler,!1),this.updateRenderBufferSize()}}loseContext(){null==this.P_&&(this.P_=this.F_.getExtension("WEBGL_lose_context")),null==this.P_&&this.P_.loseContext()}isContextLost(){return this.F_.isContextLost()}getRC(){return this.F_}setScissorEnabled(t){t?this.B_||(this.B_=!0,this.F_.enable(this.F_.SCISSOR_TEST)):this.B_&&(this.B_=!1,this.F_.disable(this.F_.SCISSOR_TEST))}setScissorRect(t,e,s,i){this.F_.scissor(t,e,s,i)}setResizeCallback(t,e){this.V_=t,this.U_=e}getDevicePixelRatio(){return this.N_}resizeBufferSize(t,e){t=Math.floor(t),e=Math.floor(e);let s=window.devicePixelRatio,i=Math.abs(s-this.N_)>.02;this.N_=s,this.x.dpr=s,a.default.SetDevicePixelRatio(this.N_),(this.Q_!=t||this.R_!=e||i)&&(this.Q_=t,this.R_=e,this.S_=Math.floor(t*s),this.T_=Math.floor(e*s),null==this.E_?(this.z.width=this.S_,this.z.height=this.T_):(this.E_.width=this.S_,this.E_.height=this.T_),this.z.style.width=this.Q_+"px",this.z.style.height=this.R_+"px",null!=this.G_&&(this.G_.stageWidth=this.S_,this.G_.stageHeight=this.T_,this.G_.viewWidth=this.Q_,this.G_.viewHeight=this.R_,this.G_.pixelRatio=s,this.G_.update()),null!=this.U_&&this.U_.call(this.V_))}getStage(){return this.G_}getStageWidth(){return this.G_.stageWidth}getStageHeight(){return this.G_.stageHeight}getDisplayWidth(){return this.Q_}getDisplayHeight(){return this.R_}setViewport(t,e,s,i){let r=this.H_!=t||this.I_!=e;(this.J_!=s||this.K_!=i||r)&&(this.H_=t,this.I_=e,this.J_=s,this.K_=i)}setViewportSize(t,e){this.J_==t&&this.K_==e||(this.J_=t,this.K_=e)}testViewPortChanged(t,e,s,i){return this.H_!=t||this.I_!=e||this.J_!=s||this.K_!=i}getViewportX(){return this.H_}getViewportY(){return this.I_}getViewportWidth(){return this.J_}getViewportHeight(){return this.K_}getFBOWidth(){return this.J_<a.default.MAX_RENDERBUFFER_SIZE?this.J_:a.default.MAX_RENDERBUFFER_SIZE}getFBOHeight(){return this.K_<a.default.MAX_RENDERBUFFER_SIZE?this.K_:a.default.MAX_RENDERBUFFER_SIZE}getRCanvasWidth(){return this.S_}getRCanvasHeight(){return this.T_}updateRenderBufferSize(){let t=this.y.getBoundingClientRect();this.resizeBufferSize(t.width,t.height)}}o.F_0=0,e.default=o},"0929":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("2139")),n=i(s("9156"));class l{constructor(){this.b=0,this.W_=new Float32Array(16),this.X_=!1,this.Y_=!1,this.updatedStatus=l.UPDATE_POSITION,this.updateStatus=l.UPDATE_TRANSFORM,this.Z_=null,this.a_=null,this.b_=null,this.c_=null,this.d_=!0,this.e_=null,this.b=l.F_0++}getUid(){return this.b}getRotationFlag(){return this.Y_}getX(){return this.W_[12]}getY(){return this.W_[13]}getZ(){return this.W_[14]}setX(t){this.updateStatus|=1,this.updatedStatus|=1,this.W_[12]=t}setY(t){this.updateStatus|=1,this.updatedStatus|=1,this.W_[13]=t}setZ(t){this.updateStatus|=1,this.updatedStatus|=1,this.W_[14]=t}setXYZ(t,e,s){this.W_[12]=t,this.W_[13]=e,this.W_[14]=s,this.updateStatus|=1,this.updatedStatus|=1}offsetPosition(t){this.W_[12]+=t.x,this.W_[13]+=t.y,this.W_[14]+=t.z,this.updateStatus|=1,this.updatedStatus|=1}setPosition(t){this.W_[12]=t.x,this.W_[13]=t.y,this.W_[14]=t.z,this.updateStatus|=1,this.updatedStatus|=1}getPosition(t){t.x=this.W_[12],t.y=this.W_[13],t.z=this.W_[14]}copyPositionFrom(t){null!=t&&(this.W_[12]=t.W_[12],this.W_[13]=t.W_[13],this.W_[14]=t.W_[14],this.updateStatus|=l.UPDATE_POSITION,this.updatedStatus|=l.UPDATE_POSITION)}getRotationX(){return this.W_[1]}getRotationY(){return this.W_[6]}getRotationZ(){return this.W_[9]}setRotationX(t){this.W_[1]=t,this.Y_=!0,this.updateStatus|=l.UPDATE_ROTATION,this.updatedStatus|=l.UPDATE_ROTATION}setRotationY(t){this.W_[6]=t,this.Y_=!0,this.updateStatus|=l.UPDATE_ROTATION,this.updatedStatus|=l.UPDATE_ROTATION}setRotationZ(t){this.W_[9]=t,this.Y_=!0,this.updateStatus|=l.UPDATE_ROTATION,this.updatedStatus|=l.UPDATE_ROTATION}setRotationXYZ(t,e,s){this.W_[1]=t,this.W_[6]=e,this.W_[9]=s,this.updateStatus|=l.UPDATE_ROTATION,this.updatedStatus|=l.UPDATE_ROTATION,this.Y_=!0}getScaleX(){return this.W_[0]}getScaleY(){return this.W_[5]}getScaleZ(){return this.W_[10]}setScaleX(t){this.W_[0]=t,this.updateStatus|=l.UPDATE_SCALE,this.updatedStatus|=l.UPDATE_SCALE}setScaleY(t){this.W_[5]=t,this.updateStatus|=l.UPDATE_SCALE,this.updatedStatus|=l.UPDATE_SCALE}setScaleZ(t){this.W_[10]=t,this.updateStatus|=l.UPDATE_SCALE,this.updatedStatus|=l.UPDATE_SCALE}setScaleXYZ(t,e,s){this.W_[0]=t,this.W_[5]=e,this.W_[10]=s,this.updateStatus|=l.UPDATE_SCALE,this.updatedStatus|=l.UPDATE_SCALE}setScale(t){this.W_[0]=t,this.W_[5]=t,this.W_[10]=t,this.updateStatus|=l.UPDATE_SCALE,this.updatedStatus|=l.UPDATE_SCALE}getRotationXYZ(t){t.x=this.W_[1],t.y=this.W_[6],t.z=this.W_[9]}getScaleXYZ(t){t.x=this.W_[0],t.y=this.W_[5],t.z=this.W_[10]}localToGlobal(t){this.getMatrix().transformVectorSelf(t)}globalToLocal(t){this.getInvMatrix().transformVectorSelf(t)}getInvMatrix(){return null!=this.e_?this.X_&&(this.e_.copyFrom(this.Z_),this.e_.invert()):(this.e_=a.default.GetMatrix(),this.e_.copyFrom(this.Z_),this.e_.invert()),this.X_=!1,this.e_}getLocalMatrix(){return this.updateStatus>0&&this.update(),this.a_}getMatrix(t=!0){return this.updateStatus>0&&t&&this.update(),this.Z_}getToParentMatrix(){return null!=this.c_?this.c_:this.Z_}setParentMatrix(t){this.b_=t,this.X_=!0,null!=this.b_&&(this.a_==this.Z_?(this.updateStatus=l.UPDATE_TRANSFORM,this.updatedStatus=this.updateStatus,this.a_=a.default.GetMatrix()):(this.updateStatus|=l.UPDATE_PARENT_MAT,this.updatedStatus=this.updateStatus))}updateMatrixData(t){null!=t&&(this.updateStatus=l.UPDATE_NONE,this.X_=!0,this.Z_.copyFrom(t))}__$setMatrix(t){null!=t&&(this.updateStatus=l.UPDATE_NONE,this.X_=!0,this.a_==this.Z_&&(this.a_=t),null!=this.Z_&&(n.default.RemoveTransUniform(this.Z_),a.default.RetrieveMatrix(this.Z_)),this.Z_=t)}destroy(){null!=this.e_&&a.default.RetrieveMatrix(this.e_),null!=this.a_&&(this.Z_==this.a_&&n.default.RemoveTransUniform(this.Z_),a.default.RetrieveMatrix(this.a_)),null!=this.Z_&&this.Z_!=this.a_&&(n.default.RemoveTransUniform(this.Z_),a.default.RetrieveMatrix(this.Z_)),this.e_=null,this.a_=null,this.Z_=null,this.b_=null,this.updateStatus=l.UPDATE_TRANSFORM}copyFrom(t){this.W_.set(t.W_,0),this.updatedStatus|=1,this.updateStatus|=l.UPDATE_TRANSFORM,this.Y_=t.Y_}update(){this.updateStatus>0&&(this.X_=!0,this.updateStatus=this.updateStatus|this.updatedStatus,(this.updateStatus&l.UPDATE_TRANSFORM)>0&&(this.a_.getLocalFS32().set(this.W_,0),this.Y_&&this.a_.setRotationEulerAngle(this.W_[1]*r.default.MATH_PI_OVER_180,this.W_[6]*r.default.MATH_PI_OVER_180,this.W_[9]*r.default.MATH_PI_OVER_180),null!=this.b_&&(this.updateStatus=this.updateStatus|l.UPDATE_PARENT_MAT)),this.Z_!=this.a_&&this.Z_.copyFrom(this.a_),(this.updateStatus&l.UPDATE_PARENT_MAT)==l.UPDATE_PARENT_MAT&&(null!=this.c_||(this.c_=a.default.GetMatrix()),this.c_.copyFrom(this.Z_),this.d_=!0,this.Z_.append(this.b_)),this.updateStatus=l.UPDATE_NONE)}getMatrixFS32(){return this.getMatrix().getLocalFS32()}toString(){return"[ROTransform(uid = "+this.b+")]"}static GetFreeId(){return l.f_.length>0?l.f_.pop():-1}static Create(t=null){let e=null,s=l.GetFreeId();return s>=0?(e=l.g_[s],l.h_[s]=l.S_FLAG_BUSY):(e=new l,l.g_.push(e),l.h_.push(l.S_FLAG_BUSY),l.i_++),e.Z_=null==t?a.default.GetMatrix():t,e.a_=e.Z_,e.W_.set(l.F_1,0),e}static Restore(t){if(null!=t&&l.h_[t.getUid()]==l.S_FLAG_BUSY){let e=t.getUid();l.f_.push(e),l.h_[e]=l.S_FLAG_FREE,t.destroy()}}}l.F_0=0,l.F_1=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),l.UPDATE_NONE=0,l.UPDATE_POSITION=1,l.UPDATE_ROTATION=2,l.UPDATE_SCALE=4,l.UPDATE_TRANSFORM=7,l.UPDATE_PARENT_MAT=8,l.S_FLAG_BUSY=1,l.S_FLAG_FREE=0,l.h_=[],l.i_=0,l.g_=[],l.f_=[],e.default=l},"0c54":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("faa5")),n=i(s("b3bd")),l=i(s("3930")),h=i(s("0fc4"));class o extends a.default{constructor(){super(),this.j_=""}initialize(t){this.j_="BillboardAlphaTexShader"}getFragShaderCode(){let t="#version 300 es\nprecision mediump float;\nuniform sampler2D u_sampler0;\nin vec4 v_colorMult;\nin vec2 v_texUV;\nlayout(location = 0) out vec4 FragColor;\nvoid main()\n{\nFragColor = vec4(v_colorMult.xyz,v_colorMult.a * texture(u_sampler0, v_texUV).a);\n}\n";return t}getVertShaderCode(){let t="#version 300 es\nprecision mediump float;\nlayout(location = 0) in vec2 a_vs;\nlayout(location = 1) in vec2 a_uvs;\nuniform mat4 u_objMat;\nuniform mat4 u_viewMat;\nuniform mat4 u_projMat;\nuniform vec4 u_billParam[2];\nout vec4 v_colorMult;\nout vec2 v_texUV;\nvoid main()\n{\nvec4 temp = u_billParam[0];\nfloat cosv = cos(temp.z);\nfloat sinv = sin(temp.z);\nvec2 vtx = vec2(a_vs.x * temp.x, a_vs.y * temp.y);\nvec2 vtx_pos = vec2(vtx.x * cosv - vtx.y * sinv, vtx.x * sinv + vtx.y * cosv);\nvec4 pos = u_viewMat * u_objMat * vec4(0.0,0.0,0.0,1.0);\npos.xy += vtx_pos.xy;\ngl_Position =  u_projMat * pos;\nv_texUV = a_uvs;\nv_colorMult = u_billParam[1];\n}\n";return t}getUniqueShaderName(){return this.j_}toString(){return"[BillboardAlphaTexShaderBuffer()]"}static GetInstance(){return null!=o.F_2||(o.F_2=new o),o.F_2}}o.F_2=new o;class m extends h.default{constructor(){super(),this.k_=0,this.l_=new Float32Array([1,1,0,1,1,1,1,1]),this.o_=new l.default(1,1,1,1),this.n_=1}getCodeBuf(){let t=o.GetInstance();return t}createSelfUniformData(){let t=new n.default;return t.uniformNameList=["u_billParam"],t.dataList=[this.l_],t}setRGBA4f(t,e,s,i){this.o_.r=t,this.o_.g=e,this.o_.b=s,this.l_[4]=t*this.n_,this.l_[5]=e*this.n_,this.l_[6]=s*this.n_,this.l_[7]=i}setRGB3f(t,e,s){this.o_.r=t,this.o_.g=e,this.o_.b=s,this.l_[4]=t*this.n_,this.l_[5]=e*this.n_,this.l_[6]=s*this.n_}setAlpha(t){this.l_[7]=t}getAlpha(){return this.l_[6]}setBrightness(t){this.n_=t,this.l_[4]=this.o_.r*t,this.l_[5]=this.o_.g*t,this.l_[6]=this.o_.b*t}getBrightness(){return this.n_}getRotationZ(){return this.k_}setRotationZ(t){this.k_=t,this.l_[2]=t*r.default.MATH_PI_OVER_180}getScaleX(){return this.l_[0]}getScaleY(){return this.l_[1]}setScaleX(t){this.l_[0]=t}setScaleY(t){this.l_[1]=t}setScaleXY(t,e){this.l_[0]=t,this.l_[1]=e}getUniformData(){return this.l_}destroy(){super.destroy(),this.l_=null}}e.default=m},"0c85":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73"));class a{constructor(){this.p_=!1,this.q_=0,this.r_=0,this.F_3=0,this.dpr=1}initMobile(t,e,s){var i=null;try{void 0!=document&&(i=document)}catch(a){}if(null!=i){let t=this;if(e.addEventListener("touchstart",t=>{let e=t.targetTouches,i=0,r=0;if(e.length<2)i=0|this.dpr*t.targetTouches[0].pageX,r=0|this.dpr*t.targetTouches[0].pageY,s.mouseX=i,s.mouseY=s.stageHeight-r,s.mouseViewX=i,s.mouseViewY=r,this.p_=!0,this.q_=s.mouseX,this.r_=s.mouseY,this.F_3=Date.now(),s.mouseDown(1);else{let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiDown(a),this.p_=!1}t.preventDefault(),t.stopPropagation()},!1),e.addEventListener("touchend",t=>{this.p_=!1;let e=t.targetTouches,i=0,r=0;if(e.length<1)s.mouseUp(1),this.F_3=Date.now()-this.F_3,Math.abs(this.q_-s.mouseX)<3&&Math.abs(this.r_-s.mouseY)<3&&this.F_3<900&&(this.q_=s.mouseX,this.r_=s.mouseY,s.mouseClick());else{let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiUp(a)}t.preventDefault()},!1),e.addEventListener("touchcancel",e=>{t.p_=!1;e.targetTouches;s.mouseCancel(),e.preventDefault()},!1),e.addEventListener("touchmove",t=>{t.preventDefault();let e=t.targetTouches,i=0,r=0;if(this.p_&&(i=0|this.dpr*e[0].pageX,r=0|this.dpr*e[0].pageY,s.mouseViewX=i,s.mouseViewY=r,s.mouseX=i,s.mouseY=s.stageHeight-r,s.mouseMove()),e.length>1){let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiMove(a)}},{passive:!1},!1),r.default.IsIpadOS()){let t=document.createElement("meta");t.name="viewport",t.content="width=device-width,initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no",document.getElementsByTagName("head")[0].appendChild(t)}}}initialize(t,e,s){r.default.IsMobileWeb()||r.default.IsIpadOS()||this.initPC(t,e,s),this.initMobile(t,e,s)}initPC(t,e,s){var i=null;try{void 0!=document&&(i=document)}catch(r){}if(null!=i){if(void 0==t.onmousewheel&&void 0!=t.addEventListener){let e=function(t){t.wheelDeltaY=-t.detail,s.mouseWheel(t)};t.addEventListener("DOMMouseScroll",e,!1)}t.onmousewheel=t=>{t.preventDefault(),t.stopPropagation(),s.mouseWheel(t)},t.onmousedown=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,this.q_=s.mouseX,this.r_=s.mouseY,this.F_3=Date.now(),0==t.button?s.mouseDown(1):2==t.button&&s.mouseRightDown(1)},t.onmouseup=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,0==t.button?s.mouseUp(1):2==t.button&&s.mouseRightUp(1)},document.onmouseup=t=>{0==t.button?s.mouseWindowUp(1):2==t.button&&s.mouseWindowRightUp(1)},t.onmousemove=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,s.mouseMove()},t.onclick=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,this.F_3=Date.now()-this.F_3,Math.abs(this.q_-s.mouseX)<3&&Math.abs(this.r_-s.mouseY)<3&&this.F_3<900&&(this.q_=s.mouseX,this.r_=s.mouseY,0==t.button?s.mouseClick():2==t.button&&s.mouseRightClick())},t.ondblclick=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,0==t.button?s.mouseDoubleClick():t.button}}}}e.default=a},"0e01":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("baae")),a=i(s("5326")),n=i(s("29ef")),l=i(s("de9d")),h=i(s("4f27")),o=i(s("7499"));class m{constructor(t){this.t_=null,this.l=null,this.u_=null,this.v_=.1,this.w_=5e3,this.x_=45,this.I=0,this.I=t,this.l=new l.default(t)}getRCUid(){return this.I}getDiv(){return this.t_.getDiv()}getCanvas(){return this.t_.getCanvas()}getRenderAdapter(){return this.t_}getRenderMaterialProxy(){return this.u_}getRenderProxy(){return this.l}getTextureResTotal(){return this.l.Texture.getTextureResTotal()}getTextureAttachTotal(){return this.l.Texture.getAttachTotal()}getDevicePixelRatio(){return this.t_.getDevicePixelRatio()}getStage3D(){return this.l.getStage3D()}getCamera(){return null!=this.l?this.l.getCamera():null}cameraLock(){this.l.cameraLock()}cameraUnlock(){this.l.cameraUnlock()}updateCamera(){null!=this.l&&this.l.updateCamera()}updateCameraDataFromCamera(t){null!=this.l&&this.l.updateCameraDataFromCamera(t)}lockRenderColorMask(){null!=this.l&&this.l.lockRenderColorMask()}unlockRendererColorMask(){null!=this.l&&this.l.unlockRenderState()}useGlobalRenderColorMask(t){null!=this.l&&(this.l.unlockRenderColorMask(),this.l.useRenderColorMask(t),this.l.lockRenderColorMask())}useGlobalRenderColorMaskByName(t){null!=this.l&&(this.l.unlockRenderColorMask(),this.l.useRenderColorMask(n.default.GetRenderColorMaskByName(t)),this.l.lockRenderColorMask())}getRenderColorMaskByName(t){return n.default.GetRenderColorMaskByName(t)}lockRenderState(){null!=this.l&&this.l.lockRenderState()}unlockRenderState(){null!=this.l&&this.l.unlockRenderState()}useGlobalRenderState(t){null!=this.l&&(this.l.unlockRenderState(),this.l.useRenderState(t),this.l.lockRenderState())}useGlobalRenderStateByName(t){null!=this.l&&(this.l.unlockRenderState(),this.l.useRenderState(n.default.GetRenderStateByName(t)),this.l.lockRenderState())}getRenderStateByName(t){return n.default.GetRenderStateByName(t)}lockMaterial(){null!=this.u_&&this.u_.lockMaterial()}unlockMaterial(){null!=this.u_&&this.u_.unlockMaterial()}isUnlockMaterial(){return this.u_.isUnlockMatrial()}useGlobalMaterial(t,e=!1,s=!1){null!=this.u_&&(this.u_.unlockMaterial(),e?this.u_.unlockTexture():this.u_.lockTexture(),this.u_.useGlobalMaterial(t,s),this.u_.lockMaterial())}updateMaterialUniform(t){this.u_.updateMaterialUniform(t)}clearBackBuffer(){this.l.clearBackBuffer()}setScissorRect(t,e,s,i){this.t_.setScissorRect(t,e,s,i)}setScissorEnabled(t){this.t_.setScissorEnabled(t)}setViewPort(t,e,s,i){this.l.setViewPort(t,e,s,i)}synFBOSizeWithViewport(){this.t_.synFBOSizeWithViewport()}asynFBOSizeWithViewport(){this.t_.asynFBOSizeWithViewport()}setFBOSizeFactorWithViewPort(t){this.t_.setFBOSizeFactorWithViewPort(t)}createFBOAt(t,e,s,i,r=!1,a=!1,n=0){this.t_.createFBOAt(t,e,s,i,r,a,n)}bindFBOAt(t,e){this.t_.bindFBOAt(t,e)}setRenderToTexture(t,e=!1,s=!1,i=0){this.t_.setRenderToTexture(t,e,s,i)}useFBO(t=!1,e=!1,s=!1){this.t_.useFBO(t,e,s)}resetFBOAttachmentMask(t){this.t_.resetFBOAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){this.t_.setFBOAttachmentMaskAt(t,e)}setRenderToBackBuffer(){null!=this.t_&&(this.t_.setRenderToBackBuffer(r.default.FRAMEBUFFER),this.u_.renderBegin())}lockViewport(){this.t_.lockViewport()}unlockViewport(){this.t_.unlockViewport()}setClearDepth(t){this.t_.setClearDepth(t)}getClearDepth(){return this.t_.getClearDepth()}getViewportX(){return this.t_.getViewportX()}getViewportY(){return this.t_.getViewportY()}getViewportWidth(){return this.t_.getViewportWidth()}getViewportHeight(){return this.t_.getViewportHeight()}setContextViewSize(t,e){this.t_.setContextViewSize(t,e)}setCameraParam(t,e,s){this.x_=t,this.v_=e,this.w_=s,null!=this.l&&this.l.setCameraParam(t,e,s)}initialize(t,e,s,i,r){if(null==this.t_){a.default.Initialize(this.l.getUid()),this.l.setCameraParam(this.x_,this.v_,this.w_),this.l.setWebGLMaxVersion(t.maxWebGLVersion),this.l.initialize(t,e,s,i,i,r),this.I=this.l.getRCUid(),r.initialize(this.I,this.l.getRC(),this.l.getGLVersion()),this.t_=this.l.getRenderAdapter(),this.t_.bgColor.setRGBA4f(0,0,0,1);let n=this.l.getContext();n.setViewport(0,0,n.getRCanvasWidth(),n.getRCanvasHeight()),h.default.Initialize()}}initManager(t){null==this.u_&&(this.u_=new o.default,this.u_.setDispBuilder(t))}setClearRGBColor3f(t,e,s){this.l.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.l.setClearRGBAColor4f(t,e,s,i)}getClearRGBAColor4f(t){t.copyFrom(this.t_.bgColor)}updateRenderBufferSize(){this.t_.updateRenderBufferSize()}vertexRenderBegin(){this.l.Vertex.renderBegin()}renderBegin(t=!0){null!=this.t_&&(this.t_.unlockViewport(),this.t_.setClearDepth(1),this.l.Vertex.renderBegin(),this.u_.renderBegin(),this.t_.update(),this.t_.setClearMaskClearAll(),this.t_.renderBegin(),n.default.ResetInfo(),n.default.Reset(this.l.getRenderContext()),t&&(this.l.useCameraData(),this.l.updateCameraDataFromCamera(this.l.getCamera())))}resetState(){n.default.ResetState(),this.u_.renderBegin()}resetmaterial(){this.u_.renderBegin()}resetUniform(){this.u_.resetUniform()}runEnd(){}}e.default=m},"0fc4":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("9666")),a=i(s("faa5"));class n{constructor(){this.g=null,this.y_=null,this.z_=null,this.AA="",this.AB="",this.AC=null,this.AD=null,this.__$troMid=-1,this.__$uniform=null,this.pipeTypes=null,this.AE=null,this.AF=0,this.AG=!1,this.k=0}setPolygonOffset(t,e=0){null==this.AD?this.AD=[t,e]:(this.AD[0]=t,this.AD[1]=e)}getPolygonOffset(){return this.AD}setDepthOffset(t){}setMaterialPipeline(t){this.z_=t}getMaterialPipeline(){return this.z_}getShdUniqueName(){return this.AB}initializeByUniqueName(t){if(null==this.getShaderData()){let e=r.default.FindData(t);null!=e&&(this.AC=e)}return null!=this.getShaderData()}getCodeBuf(){return null!=n.F_4||(n.F_4=new a.default),n.F_4}hasShaderData(){return null!=this.AC&&(!this.AC.haveTexture()||this.texDataEnabled())}initializeByCodeBuf(t=!1){if(null==this.AC){let e=this.getCodeBuf();if(null!=e){let s;e.reset(),e.pipeline=this.z_,e.pipeTypes=this.pipeTypes,null!=e.pipeline&&e.pipeline.reset(),this.buildBuf();let i=this.AA;if(""!=i&&(s=r.default.FindData(i),this.AB=i),null==s?(null==n.F_4&&(n.F_4=new a.default),a.default.UseShaderBuffer(e),t=t||this.getTextureTotal()>0,e.initialize(t),i=e.getUniqueShaderName()+e.keysString+e.getShaderCodeBuilder().getUniqueNSKeyString(),this.AB=i,this.__$initShd(this.AB),s=r.default.FindData(i),this.AA=this.AB):(a.default.UseShaderBuffer(e),t=t||this.getTextureTotal()>0,e.initialize(t)),null==s){e.buildShader(),e.buildDefine(),null!=e.pipeline&&(null!=e.getShaderCodeObject()?e.pipeline.addShaderCode(e.getShaderCodeObject(),!1):e.pipeline.addShaderCodeWithUUID(e.getShaderCodeObjectUUID(),!1),e.pipeline.build(e.getShaderCodeBuilder()));let t=e.getFragShaderCode(),n=e.getVertShaderCode();s=r.default.CreateShdData(i,n,t,e.adaptationShaderVersion,a.default.GetPreCompileInfo())}null!=this.z_&&(this.g=this.z_.getSharedUniforms()),a.default.UseShaderBuffer(null),this.AC=s}}}buildBuf(){}__$initShd(t){}getShaderData(){return this.AC}setTextureList(t){if(this.AE!=t){this.AG=!1,this.AF=null!=t?t.length:0;let e=0;if(null!=this.AE)for(;e<this.AE.length;++e)this.AE[e].__$detachThis();if(this.AG=!0,this.AE=t,null!=this.AE){let t=31;for(e=0;e<this.AE.length;++e)t=131*t+this.AE[e].getUid(),this.AE[e].__$attachThis(),this.AE[e].isDataEnough()||(this.AG=!1);this.__$troMid=t}}}setTextureAt(t,e){if(t>=0&&null!=e){let s=this.AE,i=s.length;if(null!=s&&s[t]!=e&&t<i&&i>0){s=s.slice(0),s[t].__$detachThis(),s[t]=e,this.AG=e.isDataEnough(),e.__$attachThis();let r=31;for(let t=0;t<i;++t)r=131*r+s[t].getUid();this.__$troMid=r,this.AE=s}}}getTextureList(){return this.AE}getTextureAt(t){return this.AE[t]}getTextureTotal(){return this.AF}getShdTexTotal(){return null!=this.AC?this.AC.getTexTotal():0}texDataEnabled(){if(null!=this.AE){if(this.AG)return!0;let t=!0,e=this.AE;for(let s=0;s<this.AF;++s)if(!e[s].isDataEnough()){t=!1;break}return this.AG=t,t}return null!=this.AC&&this.AC.getTexTotal(),!1}createSharedUniforms(){return this.g}createSharedUniformsData(){return null}createSelfUniformData(){return this.y_}updateSelfData(t){}hasTexture(){return this.AC.haveTexture()}getBufSortFormat(){return null!=this.AC?this.AC.getLayoutBit():0}__$attachThis(){++this.k}__$detachThis(){--this.k,this.k<1&&(this.k=0)}getAttachCount(){return this.k}destroy(){if(this.g=null,this.y_=null,this.pipeTypes=null,this.getAttachCount()<1){if(null!=this.AE)for(let t=0;t<this.AE.length;++t)this.AE[t].__$detachThis();this.AC=null,this.AE=null,this.AG=!1,this.__$troMid=0,null!=this.__$uniform&&(this.__$uniform.destroy(),this.__$uniform=null)}}toString(){return"[MaterialBase()]"}}n.F_4=null,e.default=n},"11e6":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static AddContainerFlag(t){return 2147483648|t}static RemoveContainerFlag(t){return-2147483649&t}static AddSpaceUid(t,e){return-1048576&t|e}static RemoveSpaceUid(t){return-1048576&t}static GetSpaceUid(t){return 1048575&t}static AddRendererUid(t,e){return-133169153&t|e<<20}static RemoveRendererUid(t){return 133169152|t}static GetRendererUid(t){return t=(133169152&t)>>20,t<127?t:-1}static TestRendererUid(t){return t=(133169152&t)>>20,t<127}static AddSortEnabled(t){return 1073741824|t}static RemoveSortEnabled(t){return-1073741825&t}static TestSortEnabled(t){return 1073741824==(1073741824&t)}static AddRendererLoad(t){return 805306368|t}static RemoveRendererLoad(t){return-805306369&t}static TestSpaceContains(t){return(1048575&t)>0}static TestSpaceEnabled(t){return(1048575&t)<1}static TestSpaceEnabled2(t){return(1048575&t)<1&&2147483648!=(2147483648&t)}static TestContainerEnabled(t){return 133169152==(133169152&t)&&2147483648!=(2147483648&t)}static TestRendererEnabled(t){return 133169152==(938475520&t)&&2147483648!=(2147483648&t)}}i.DEFAULT=133169152,i.CONTAINER_FLAG=2147483648,i.CONTAINER_NOT_FLAG=-2147483649,i.SPACE_FLAG=1048575,i.SPACE_NOT_FLAG=-1048576,i.RENDERER_UID_FLAG=133169152,i.RENDERER_UID_NOT_FLAG=-133169153,i.RENDERER_UID_INVALID=127,i.SORT_FLAG=1073741824,i.SORT_NOT_FLAG=-1073741825,i.RENDERER_LOAD_FLAG=805306368,i.RENDERER_LOAD_NOT_FLAG=-805306369,i.RENDERER_ADN_LOAD_FLAG=938475520,e.default=i},1216:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("3930")),n=i(s("baae")),l=i(s("722e")),h=i(s("8333")),o=i(s("6d49")),m=s("e08e"),_=s("8d98"),u=s("7c63"),d=i(s("29ef")),c=i(s("3024"));class f{constructor(t,e){this.I=0,this.AH=null,this.F_=null,this.AI=!1,this.AJ={mr:!0,mg:!0,mb:!0,ma:!0},this.AK=null,this.AL=0,this.AM=null,this.AN=0,this.AO=n.default.FRAMEBUFFER,this.AP=[null,null,null,null,null,null,null,null],this.AQ=!0,this.AR=!1,this.AS=!1,this.AD=!1,this.J=0,this.K=0,this.AT=800,this.AU=600,this.AV=1,this.AW=0,this.AX=new r.default(0,0,800,600),this.AY=1,this.AZ=0,this.Aa=new Uint16Array(8),this.Ab=new Uint16Array(4),this.Ac=1,this.B_=!1,this.Ad=null,this.Ae=2,this.bgColor=new a.default,this.uViewProbe=null,this.Af=1,this.Ag=!0,this.Ah=!1,this.AH=e,this.I=t}initialize(t,e,s){if(null==this.AK&&(this.Ae=t.getWebGLVersion(),this.Ad=s,this.AK=t,this.F_=t.getRC(),this.F_.disable(this.F_.SCISSOR_TEST),t.isDepthTestEnabled()?this.F_.enable(this.F_.DEPTH_TEST):this.F_.disable(this.F_.DEPTH_TEST),t.isStencilTestEnabled()?this.F_.enable(this.F_.STENCIL_TEST):this.F_.disable(this.F_.STENCIL_TEST),e.getPolygonOffsetEanbled()?this.enabledPolygonOffset():this.disabledPolygonOffset(),this.F_.enable(this.F_.CULL_FACE),this.F_.cullFace(this.F_.BACK),this.F_.enable(this.F_.BLEND),e.getDitherEanbled()?this.F_.enable(this.F_.DITHER):this.F_.disable(this.F_.DITHER),this.F_.frontFace(this.F_.CCW),this.AL=this.F_.COLOR_BUFFER_BIT|this.F_.DEPTH_BUFFER_BIT|this.F_.STENCIL_BUFFER_BIT,null==this.uViewProbe)){let t=this;t.uViewProbe=new c.default(1),this.uViewProbe.bindSlotAt(this.I),this.uViewProbe.setVec4DataWithArr4([this.J,this.K,this.AT,this.AU])}}setFrontFaceFlipped(t){this.AI!=t&&(t?this.F_.frontFace(this.F_.CW):this.F_.frontFace(this.F_.CCW),this.AI=t)}enabledPolygonOffset(){this.AD||(this.AD=!0,this.F_.enable(this.F_.POLYGON_OFFSET_FILL))}disabledPolygonOffset(){this.AD&&(this.AD=!1,this.F_.disable(this.F_.POLYGON_OFFSET_FILL))}setPolygonOffset(t,e=0){this.F_.polygonOffset(t,e),this.AS=!0}resetPolygonOffset(){this.AS&&(this.F_.polygonOffset(0,0),this.AS=!1)}getDiv(){return this.AK.getDiv()}getCanvas(){return this.AK.getCanvas()}setClearDepth(t){this.AV=t}getClearDepth(){return this.AV}setContextViewSize(t,e){this.AK.autoSyncRenderBufferAndWindowSize=!1,this.AK.resizeBufferSize(t,e)}getViewportX(){return this.AK.getViewportX()}getViewportY(){return this.AK.getViewportY()}getViewportWidth(){return this.AK.getViewportWidth()}getViewportHeight(){return this.AK.getViewportHeight()}getFBOFitWidth(){return this.AK.getFBOWidth()}getFBOFitHeight(){return this.AK.getFBOHeight()}getRCanvasWidth(){return this.AK.getRCanvasWidth()}getRCanvasHeight(){return this.AK.getRCanvasHeight()}setColorMask(t,e,s,i){this.AJ.mr=t,this.AJ.mg=e,this.AJ.mb=s,this.AJ.ma=i}setClearMaskClearAll(){this.AL=this.F_.COLOR_BUFFER_BIT|this.F_.DEPTH_BUFFER_BIT|this.F_.STENCIL_BUFFER_BIT}setClearMaskClearOnlyColor(){this.AL=this.F_.COLOR_BUFFER_BIT}setClearMaskClearOnlyDepthAndStencil(){this.AL=this.F_.DEPTH_BUFFER_BIT|this.F_.STENCIL_BUFFER_BIT}setScissorRect(t,e,s,i){this.B_&&this.F_.scissor(t,e,s,i)}setScissorEnabled(t){t?this.B_||(this.B_=!0,this.F_.enable(this.F_.SCISSOR_TEST)):this.B_&&(this.B_=!1,this.F_.disable(this.F_.SCISSOR_TEST))}clearDepth(t=1){this.AV=t,this.AW!==this.AV&&(this.AW=this.AV,this.F_.clearDepth(this.AV)),this.F_.clear(this.F_.DEPTH_BUFFER_BIT)}clearColor(t){this.F_.clearColor(t.r,t.g,t.b,t.a),this.F_.clear(this.F_.COLOR_BUFFER_BIT)}clear(){this.AW!==this.AV&&(this.AW=this.AV,this.F_.clearDepth(this.AV)),this.AK.isStencilTestEnabled()&&this.F_.clearStencil(this.AZ),this.F_.clearColor(this.bgColor.r,this.bgColor.g,this.bgColor.b,this.bgColor.a),this.F_.clear(this.AL)}reset(){this.Ad.setCullFaceMode(m.CullFaceMode.BACK),this.Ad.setDepthTestMode(m.DepthTestMode.OPAQUE),d.default.Reset(this.F_)}getRenderContext(){return this.AK}renderBegin(){null!=this.AK&&(this.AY=1,this.reseizeViewPort(),u.RenderStateObject.Unlock(),u.RenderStateObject.UseRenderState(d.default.NORMAL_STATE),u.RenderColorMask.Unlock(),u.RenderColorMask.UseRenderState(u.RenderColorMask.ALL_TRUE_COLOR_MASK),this.clear())}reseizeViewPort(){if(this.Ag){let t=this.AK.getDevicePixelRatio(),e=this.J!=this.AK.getViewportX()||this.K!=this.AK.getViewportY();e=e||this.AT!=this.AK.getViewportWidth(),e=e||this.AU!=this.AK.getViewportHeight(),e=e||Math.abs(this.Af-t)>.01,e&&(this.Af=t,this.J=this.AK.getViewportX(),this.K=this.AK.getViewportY(),this.AT=this.AK.getViewportWidth(),this.AU=this.AK.getViewportHeight(),this.uViewProbe.setVec4Data(this.J,this.K,this.AT,this.AU),this.uViewProbe.update(),this.F_.viewport(this.J,this.K,this.AT,this.AU))}}reseizeFBOViewPort(){if(this.Ag){let t=this.AK.getDevicePixelRatio(),e=this.J!=this.AX.x||this.K!=this.AX.y;e=e||this.AT!=this.AX.z,e=e||this.AU!=this.AX.w,e=e||Math.abs(this.Af-t)>.01,e&&(this.Af=t,this.J=this.AX.x,this.K=this.AX.y,this.AT=this.AX.z,this.AU=this.AX.w,this.uViewProbe.setVec4Data(this.J,this.K,this.AT,this.AU),this.uViewProbe.update(),this.F_.viewport(this.J,this.K,this.AT,this.AU))}}setViewProbeValue(t,e,s,i){this.uViewProbe.setVec4Data(t,e,s,i),this.uViewProbe.update()}lockViewport(){this.Ag=!1}unlockViewport(){this.Ag=!0}renderEnd(){}update(){}updateRenderBufferSize(){this.AK.updateRenderBufferSize()}destroy(){this.AK=null,this.Ad=null}getDevicePixelRatio(){return this.AK.getDevicePixelRatio()}loseContext(){this.AK.loseContext()}isContextLost(){return this.AK.isContextLost()}readPixels(t,e,s,i,r,a,n){this.F_.readPixels(t,e,s,i,_.TextureFormat.ToGL(this.F_,r),_.TextureDataType.ToGL(this.F_,a),n)}setFBOViewRect(t,e,s,i){this.Ab[0]=t,this.Ab[1]=e,this.Ab[2]=s,this.Ab[3]=i,this.AR=!0}createFBOAt(t,e,s,i,r=!1,a=!1,n=0){null==this.AP[t]&&(t>7&&(t=7),this.AO=e,this.AM=new o.default(this.I,this.AH,this.AO),this.AM.multisampleEnabled=n>0,this.AM.multisampleLevel=n,this.AM.writeDepthEnabled=r,this.AM.writeStencilEnabled=a,this.AM.initialize(this.F_,s,i),this.AP[t]=this.AM,this.AM.sizeFixed=!0)}resizeFBOAt(t,e,s){t>7?t=7:t<0&&(t=0),null!=this.AP[t]&&this.AP[t].resize(e,s)}getFBOWidthAt(t){return null!=this.AP[t]?this.AP[t].getWidth():0}getFBOHeightAt(t){return null!=this.AP[t]?this.AP[t].getHeight():0}synFBOSizeWithViewport(){this.Ah=!0}asynFBOSizeWithViewport(){this.Ah=!1}setFBOSizeFactorWithViewPort(t){this.AY=t}bindFBOAt(t,e){if(t>7?t=7:t<0&&(t=0),this.AM=this.AP[t],null==this.AM)throw Error("Fatal Error!!! this.AM == null.");this.AN=t,this.AO=e,this.AM.bind(e),this.AQ=!0}clearFBODepthAt(t,e=1){let s=this.AP[t];null!=s&&s.clearOnlyDepth(e)}resetFBOAttachmentMask(t){null!=this.AM&&this.AM.resetAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){null!=this.AM&&this.AM.setAttachmentMaskAt(t,e)}getFBOAttachmentTotal(){return null!=this.AM?this.AM.getAttachmentTotal():0}setRenderToTexture(t,e=!1,s=!1,i=0){(i<0||i>=8)&&(i=0),null==t&&0==i?this.setRenderToBackBuffer(n.default.FRAMEBUFFER):(0==i&&(null!=this.AM&&(this.Ah?this.AM.initialize(this.F_,Math.floor(this.AK.getFBOWidth()*this.AY),Math.floor(this.AK.getFBOHeight()*this.AY)):this.AR?this.AM.initialize(this.F_,this.Ab[2],this.Ab[3]):this.AM.sizeFixed||this.AM.initialize(this.F_,t.getWidth(),t.getHeight())),this.AN>=0&&null==this.AM&&(this.AM=new o.default(this.I,this.AH,this.AO),this.AP[this.AN]=this.AM,this.AM.writeDepthEnabled=e,this.AM.writeStencilEnabled=s,this.Ah?this.AM.initialize(this.F_,Math.floor(this.AK.getFBOWidth()*this.AY),Math.floor(this.AK.getFBOHeight()*this.AY)):this.AR?this.AM.initialize(this.F_,this.Ab[2],this.Ab[3]):this.AM.initialize(this.F_,t.getWidth(),t.getHeight()))),null!=this.AM&&this.AM.renderToTexAt(this.F_,t,i),this.AQ=!0)}getActiveAttachmentTotal(){return this.Ac}getAttachmentTotal(){return this.Ac}useFBO(t=!1,e=!1,s=!1){null!=this.AM&&this.AQ&&(this.AQ=!1,this.AM.use(this.F_),this.Ac=this.AM.getActiveAttachmentTotal(),t&&this.AM.clearOnlyColor(this.bgColor),this.AM.writeDepthEnabled?this.AM.writeStencilEnabled?e&&s?this.AM.clearOnlyDepthAndStencil(this.AV,4294967295):e?this.AM.clearOnlyDepth(this.AV):s&&this.AM.clearOnlyStencil(255):e&&this.AM.clearOnlyDepth(this.AV):s&&this.AM.writeStencilEnabled&&this.AM.clearOnlyStencil(255),1==this.Ae&&this.F_.clear(this.AL),this.Aa[4]=this.Aa[0]=this.J,this.Aa[5]=this.Aa[1]=this.K,this.Aa[6]=this.Aa[2]=this.J+this.AT,this.Aa[7]=this.Aa[3]=this.K+this.AU,this.AR?(this.AR=!1,this.AX.setTo(this.Ab[0],this.Ab[1],this.Ab[2],this.Ab[3]),this.reseizeFBOViewPort()):(this.Ah?this.AX.setTo(0,0,Math.floor(this.AK.getFBOWidth()*this.AY),Math.floor(this.AK.getFBOHeight()*this.AY)):(this.AM.isSizeChanged()&&this.AM.initialize(this.F_,this.AM.getWidth(),this.AM.getHeight()),this.AX.setTo(0,0,this.AM.getWidth(),this.AM.getHeight())),this.reseizeFBOViewPort()))}setRenderToBackBuffer(t=n.default.FRAMEBUFFER){this.Ac=1,o.default.BindToBackbuffer(this.F_,t),this.reseizeViewPort()}bindFBOToDraw(){null!=this.AM&&this.AM.bind(n.default.DRAW_FRAMEBUFFER)}bindFBOToWrite(){null!=this.AM&&this.AM.bind(n.default.READ_FRAMEBUFFER)}setBlitFboSrcRect(t,e,s,i){this.Aa[0]=t,this.Aa[1]=e,this.Aa[2]=t+s,this.Aa[3]=e+i}setBlitFboDstRect(t,e,s,i){this.Aa[4]=t,this.Aa[5]=e,this.Aa[6]=t+s,this.Aa[7]=e+i}blitFBO(t=0,e=0,s=h.default.COLOR_BUFFER_BIT,i=l.default.NEAREST,r=0,a=0,m=null){t>7&&(t=7),e>7&&(e=7),t>=0&&null!=this.AP[t]?this.AP[t].bind(n.default.READ_FRAMEBUFFER):o.default.BindToBackbuffer(this.F_,n.default.READ_FRAMEBUFFER),e>=0&&null!=this.AP[e]?this.AP[e].bind(n.default.DRAW_FRAMEBUFFER):o.default.BindToBackbuffer(this.F_,n.default.DRAW_FRAMEBUFFER),r>0&&(a<0&&(a=0),null==m&&(m=[0,0,0,1]),this.F_.clearBufferfv(r,a,m));let _=this.Aa;this.F_.blitFramebuffer(_[0],_[1],_[2],_[3],_[4],_[5],_[6],_[7],s,i)}}e.default=f},1264:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=s("e08e"),n=s("eca0");class l{constructor(t,e,s,i){this.Ai=null,this.Aj=null,this.Ak=null,this.Al=[],this.Am=[],this.An=-1,this.Ao=0,this.Ap=null,this.Aq=null,this.version=0,this.An=t,this.Aj=e,this.Ai=s,this.Ak=i}setListener(t){this.Aq=t}isEmpty(){return this.Ao<1}isHaveEntity(){return this.Ao>0}removeEntity(t){this.Ao--;let e=t.getDisplay();if(null!=e&&null!=e.__$$runit){let t=e.__$ruid,s=this.Ai.getRCRPObj(t);if(null!=s){if(s.count>0)if(s.count<2)s.rprocessUid>-1&&(this.Ap=this.Ak.getNodeByUid(s.rprocessUid),this.Ap.removeDisp(e),s.rprocessUid=-1);else{let t=n.RCRPObj.RenerProcessMaxTotal;for(let i=0;i<t;++i)(s.idsFlag&1<<i)>0&&(this.Ap=this.Ak.getNodeByUid(i),this.Ap.removeDisp(e))}}else this.Ap=this.Ak.getNodeByUid(e.__$$runit.getRPROUid()),this.Ap.removeDisp(e);0==s.count&&(e.__$$rsign,a.DisplayRenderSign.LIVE_IN_RENDERER,e.__$$rsign=a.DisplayRenderSign.NOT_IN_RENDERER,this.Ai.restoreByUid(t)),this.version++}t.__$rseFlag=r.default.RemoveRendererUid(t.__$rseFlag),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.RemoveSortEnabled(t.__$rseFlag),null!=this.Aq&&this.Aq.removeFromRenderer(t,this.An,-1)}addEntity(t,e,s=!1){if(null!=t){let i=t.getDisplay();if(null!=i){if(i.__$$rsign==a.DisplayRenderSign.LIVE_IN_RENDERER&&!this.Ai.testRPNodeNotExists(i.__$ruid,e))return;this.Ap=this.Ak.getNodeByUid(e),t.__$rseFlag=this.Ap.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),s?(i.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(i.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.An),this.Al.push(t),this.Am.push(e)):this.testValidData(t)?this.ensureAdd(t,i,e):(i.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(i.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),this.Al.push(t),this.Am.push(e))}else t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.An)}return!1}testValidData(t){if(null!=t.getMaterial()&&t.hasMesh()){if(t.getMaterial().hasShaderData())return!0;null!=t.getMaterial().getCodeBuf()&&t.activeDisplay()}return!1}ensureAdd(t,e,s){t.update(),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.An),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$setRenderProxy(this.Aj.getRenderProxy()),this.Ao++,e.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(e.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),this.Ap=this.Ak.getNodeByUid(s),(e.__$ruid>-1||this.Aj.buildGpuDisp(e))&&this.Ap.addDisp(e),null!=this.Aq&&this.Aq.addToRenderer(t,this.An,s),null!=t.getGlobalBounds()&&(e.__$$runit.bounds=t.getGlobalBounds(),e.__$$runit.pos=e.__$$runit.bounds.center),this.version++}updateWaitList(){let t=this.Al.length,e=null,s=null;for(let i=0;i<t;++i)if(e=this.Al[i],(r.default.RENDERER_LOAD_FLAG&e.__$rseFlag)==r.default.RENDERER_LOAD_FLAG){if(this.testValidData(e)){if(s=e.getDisplay(),s.__$$rsign==a.DisplayRenderSign.LIVE_IN_RENDERER&&!this.Ai.testRPNodeNotExists(s.__$ruid,this.Am[i])){this.Al.splice(i,1),this.Am.splice(i,1),--t,--i;continue}this.ensureAdd(e,s,this.Am[i]),this.Al.splice(i,1),this.Am.splice(i,1),--t,--i}}else s=e.getDisplay(),null!=s&&s.__$$rsign==a.DisplayRenderSign.GO_TO_RENDERER&&(s.__$$rsign=a.DisplayRenderSign.NOT_IN_RENDERER),e.__$rseFlag=r.default.RemoveRendererLoad(e.__$rseFlag),e.__$rseFlag=r.default.RemoveRendererUid(e.__$rseFlag),e.__$rseFlag=r.default.RemoveSortEnabled(e.__$rseFlag),this.Al.splice(i,1),this.Am.splice(i,1),--t,--i,null!=this.Aq&&this.Aq.removeFromRenderer(e,this.An,-1)}update(){this.Al.length>0&&this.updateWaitList(),this.Aj.update()}}e.default=l},1710:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("a996"));class n extends a.default{constructor(){super(),this.lpos=new r.default,this.wpos=new r.default,this.raytv=new r.default(1,0,0),this.raypv=new r.default(0,0,0),this.mouseX=0,this.mouseY=0,this.mouseViewX=0,this.mouseViewY=0,this.posArray=null,this.wheelDeltaY=0}static GetMouseEvtTypeValueBase(){return 5001}static GetMouseEvtTypeValuesTotal(){return 18}getClassType(){return n.EventClassType}toString(){return"[MouseEvent]"}}n.EventClassType=1002,n.MOUSE_DOWN=5001,n.MOUSE_UP=5002,n.MOUSE_RIGHT_UP=5003,n.MOUSE_RIGHT_DOWN=5004,n.MOUSE_MOVE=5005,n.MOUSE_WHEEL=5006,n.MOUSE_OVER=5007,n.MOUSE_OUT=5008,n.MOUSE_CLICK=5009,n.MOUSE_RIGHT_CLICK=5010,n.MOUSE_DOUBLE_CLICK=5011,n.MOUSE_CANCEL=5012,n.MOUSE_MULTI_DOWN=5013,n.MOUSE_MULTI_UP=5014,n.MOUSE_MULTI_MOVE=5015,n.MOUSE_BG_DOWN=5016,n.MOUSE_BG_UP=5017,n.MOUSE_BG_CLICK=5018,e.default=n},"18c7":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("abdb"));class l{constructor(t=null,e=0){this.b=-1,this.Ar=0,this.W_=null,this.As=null,this.Ar=e,null!=t?(this.b=l.F_0++,this.W_=t,this.As=this.W_.subarray(e,e+16)):(this.b=l.F_7++,this.W_=new Float32Array(16),this.W_.set(l.F_6,0),this.As=this.W_)}setData(t){16==t.length&&this.As.set(t)}getCapacity(){return 16}GetMaxUid(){return l.F_0}getUid(){return this.b}getLocalFS32(){return this.As}getFS32(){return this.W_}getFSIndex(){return this.Ar}identity(){this.As.set(l.F_6,0)}determinant(){return(this.As[0]*this.As[5]-this.As[4]*this.As[1])*(this.As[10]*this.As[15]-this.As[14]*this.As[11])-(this.As[0]*this.As[9]-this.As[8]*this.As[1])*(this.As[6]*this.As[15]-this.As[14]*this.As[7])+(this.As[0]*this.As[13]-this.As[12]*this.As[1])*(this.As[6]*this.As[11]-this.As[10]*this.As[7])+(this.As[4]*this.As[9]-this.As[8]*this.As[5])*(this.As[2]*this.As[15]-this.As[14]*this.As[3])-(this.As[4]*this.As[13]-this.As[12]*this.As[5])*(this.As[2]*this.As[11]-this.As[10]*this.As[3])+(this.As[8]*this.As[13]-this.As[12]*this.As[9])*(this.As[2]*this.As[7]-this.As[6]*this.As[3])}append(t){let e=t.getLocalFS32(),s=this.As,i=s[0],r=s[4],a=s[8],n=s[12],l=s[1],h=s[5],o=s[9],m=s[13],_=s[2],u=s[6],d=s[10],c=s[14],f=s[3],p=s[7],g=s[11],v=s[15],x=e[0],T=e[4],E=e[8],y=e[12],S=e[1],b=e[5],M=e[9],A=e[13],L=e[2],R=e[6],P=e[10],D=e[14],F=e[3],w=e[7],B=e[11],C=e[15];s[0]=i*x+l*T+_*E+f*y,s[1]=i*S+l*b+_*M+f*A,s[2]=i*L+l*R+_*P+f*D,s[3]=i*F+l*w+_*B+f*C,s[4]=r*x+h*T+u*E+p*y,s[5]=r*S+h*b+u*M+p*A,s[6]=r*L+h*R+u*P+p*D,s[7]=r*F+h*w+u*B+p*C,s[8]=a*x+o*T+d*E+g*y,s[9]=a*S+o*b+d*M+g*A,s[10]=a*L+o*R+d*P+g*D,s[11]=a*F+o*w+d*B+g*C,s[12]=n*x+m*T+c*E+v*y,s[13]=n*S+m*b+c*M+v*A,s[14]=n*L+m*R+c*P+v*D,s[15]=n*F+m*w+c*B+v*C}append3x3(t){let e=t.getLocalFS32(),s=this.As,i=s[0],r=s[4],a=s[8],n=s[1],l=s[5],h=s[9],o=s[2],m=s[6],_=s[10],u=e[0],d=e[4],c=e[8],f=e[1],p=e[5],g=e[9],v=e[2],x=e[6],T=e[10];s[0]=i*u+n*d+o*c,s[1]=i*f+n*p+o*g,s[2]=i*v+n*x+o*T,s[4]=r*u+l*d+m*c,s[5]=r*f+l*p+m*g,s[6]=r*v+l*x+m*T,s[8]=a*u+h*d+_*c,s[9]=a*f+h*p+_*g,s[10]=a*v+h*x+_*T}appendRotationPivot(t,e,s=null){null==s&&(s=a.default.Z_AXIS),l.F_5.identity(),l.F_5.getAxisRotation(e.x,e.y,e.z,t),l.F_5.appendTranslationXYZ(s.x,s.y,s.z),this.append(l.F_5)}appendRotation(t,e){l.F_5.identity(),l.F_5.getAxisRotation(e.x,e.y,e.z,t),this.append(l.F_5)}appendRotationX(t){l.F_5.rotationX(t),this.append3x3(l.F_5)}appendRotationY(t){l.F_5.rotationY(t),this.append3x3(l.F_5)}appendRotationZ(t){l.F_5.rotationZ(t),this.append3x3(l.F_5)}appendRotationEulerAngle(t,e,s){l.F_5.rotationY(e),this.append3x3(l.F_5),l.F_5.rotationX(t),this.append3x3(l.F_5),l.F_5.rotationZ(s),this.append3x3(l.F_5)}setScaleXYZ(t,e,s){let i=this.As;i[0]=t,i[5]=e,i[10]=s}setRotationEulerAngle(t,e,s){let i=this.As,r=Math.cos(t),a=Math.sin(t),n=Math.cos(e),l=Math.sin(e),h=Math.cos(s),o=Math.sin(s),m=h*l,_=o*l,u=n*i[0],d=a*i[5],c=r*i[5],f=r*i[10],p=a*i[10];i[1]=o*u,i[2]=-l*i[0],i[0]=h*u,i[4]=m*d-o*c,i[8]=m*f+o*p,i[5]=_*d+h*c,i[9]=_*f-h*p,i[6]=n*d,i[10]=n*f}setRotationEulerAngle2(t,e,s,i,r,a){let n=this.As,l=r*i,h=a*i,o=s*n[0],m=e*n[5],_=t*n[5],u=t*n[10],d=e*n[10];n[1]=a*o,n[2]=-i*n[0],n[0]=r*o,n[4]=l*m-a*_,n[8]=l*u+a*d,n[5]=h*m+r*_,n[9]=h*u-r*d,n[6]=s*m,n[10]=s*u}setTranslationXYZ(t,e,s){this.As[12]=t,this.As[13]=e,this.As[14]=s}setTranslation(t){this.As[12]=t.x,this.As[13]=t.y,this.As[14]=t.z}appendScaleXYZ(t,e,s){let i=this.As;i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=e,i[5]*=e,i[6]*=e,i[7]*=e,i[8]*=s,i[9]*=s,i[10]*=s,i[11]*=s}appendScaleXY(t,e){this.As[0]*=t,this.As[1]*=t,this.As[2]*=t,this.As[3]*=t,this.As[4]*=e,this.As[5]*=e,this.As[6]*=e,this.As[7]*=e}appendTranslationXYZ(t,e,s){this.As[12]+=t,this.As[13]+=e,this.As[14]+=s}appendTranslation(t){this.As[12]+=t.x,this.As[13]+=t.y,this.As[14]+=t.z}copyColumnFrom(t,e){switch(t){case 0:this.As[0]=e.x,this.As[1]=e.y,this.As[2]=e.z,this.As[3]=e.w;break;case 1:this.As[4]=e.x,this.As[5]=e.y,this.As[6]=e.z,this.As[7]=e.w;break;case 2:this.As[8]=e.x,this.As[9]=e.y,this.As[10]=e.z,this.As[11]=e.w;break;case 3:this.As[12]=e.x,this.As[13]=e.y,this.As[14]=e.z,this.As[15]=e.w;break;default:break}}copyColumnTo(t,e){t<<=2,e.x=this.As[t],e.y=this.As[1+t],e.z=this.As[2+t],e.w=this.As[3+t]}setF32ArrAndIndex(t,e=0){null!=t&&e>=0&&(this.W_=t,this.Ar=e,this.As=this.W_.subarray(e,e+16))}setF32ArrIndex(t=0){t>=0&&(this.Ar=t,this.As=this.W_.subarray(t,t+16))}setF32Arr(t){null!=t&&(this.W_=t)}copyFromF32Arr(t,e=0){let s=0;for(let i=e+16;e<i;e++)this.As[s]=t[e],++s}copyToF32Arr(t,e=0){t.set(this.As,e)}copyFrom(t){this.As.set(t.As,0)}copyTo(t){t.As.set(this.As,0)}copyRawDataFrom(t,e=16,s=0,i=!1){i&&this.transpose(),e-=s;let r=0;while(r<e)this.W_[this.Ar+r]=t[r+s],++r;i&&this.transpose()}copyRawDataTo(t,e=16,s=0,i=!1){i&&this.transpose();let r=0;while(r<e)t[r+s]=this.W_[this.Ar+r],++r;i&&this.transpose()}copyRowFrom(t,e){switch(t){case 0:this.As[0]=e.x,this.As[4]=e.y,this.As[8]=e.z,this.As[12]=e.w;break;case 1:this.As[1]=e.x,this.As[5]=e.y,this.As[9]=e.z,this.As[13]=e.w;break;case 2:this.As[2]=e.x,this.As[6]=e.y,this.As[10]=e.z,this.As[14]=e.w;break;case 3:this.As[3]=e.x,this.As[7]=e.y,this.As[11]=e.z,this.As[15]=e.w;break;default:break}}copyRowTo(t,e){e.x=this.As[t],e.y=this.As[4+t],e.z=this.As[8+t],e.w=this.As[12+t]}decompose(t){let e=[],s=l.F_5,i=s.getFS32();s.copyFrom(this);let h=new a.default(i[12],i[13],i[14]),o=new a.default;o.x=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),o.y=Math.sqrt(i[4]*i[4]+i[5]*i[5]+i[6]*i[6]),o.z=Math.sqrt(i[8]*i[8]+i[9]*i[9]+i[10]*i[10]),i[0]*(i[5]*i[10]-i[6]*i[9])-i[1]*(i[4]*i[10]-i[6]*i[8])+i[2]*(i[4]*i[9]-i[5]*i[8])<0&&(o.z=-o.z),i[0]/=o.x,i[1]/=o.x,i[2]/=o.x,i[4]/=o.y,i[5]/=o.y,i[6]/=o.y,i[8]/=o.z,i[9]/=o.z,i[10]/=o.z;let m=new a.default;switch(t){case n.default.AXIS_ANGLE:{m.w=r.default.SafeACos((i[0]+i[5]+i[10]-1)/2);let t=Math.sqrt((i[6]-i[9])*(i[6]-i[9])+(i[8]-i[2])*(i[8]-i[2])+(i[1]-i[4])*(i[1]-i[4]));t>r.default.MATH_MIN_POSITIVE?(m.x=(i[6]-i[9])/t,m.y=(i[8]-i[2])/t,m.z=(i[1]-i[4])/t):m.x=m.y=m.z=0}break;case n.default.QUATERNION:{let t=i[0]+i[5]+i[10];t>0?(m.w=Math.sqrt(1+t)/2,m.x=(i[6]-i[9])/(4*m.w),m.y=(i[8]-i[2])/(4*m.w),m.z=(i[1]-i[4])/(4*m.w)):i[0]>i[5]&&i[0]>i[10]?(m.x=Math.sqrt(1+i[0]-i[5]-i[10])/2,m.w=(i[6]-i[9])/(4*m.x),m.y=(i[1]+i[4])/(4*m.x),m.z=(i[8]+i[2])/(4*m.x)):i[5]>i[10]?(m.y=Math.sqrt(1+i[5]-i[0]-i[10])/2,m.x=(i[1]+i[4])/(4*m.y),m.w=(i[8]-i[2])/(4*m.y),m.z=(i[6]+i[9])/(4*m.y)):(m.z=Math.sqrt(1+i[10]-i[0]-i[5])/2,m.x=(i[8]+i[2])/(4*m.z),m.y=(i[6]+i[9])/(4*m.z),m.w=(i[1]-i[4])/(4*m.z))}break;case n.default.EULER_ANGLES:m.y=Math.asin(-i[2]),1!=i[2]&&-1!=i[2]?(m.x=Math.atan2(i[6],i[10]),m.z=Math.atan2(i[1],i[0])):(m.z=0,m.x=Math.atan2(i[4],i[5]));break;default:break}return e.push(h),e.push(m),e.push(o),s=null,e}invert(){let t=this.determinant(),e=Math.abs(t)>r.default.MATH_MIN_POSITIVE;if(e){let e=this.As;t=1/t;let s=e[0],i=e[4],r=e[8],a=e[12],n=e[1],l=e[5],h=e[9],o=e[13],m=e[2],_=e[6],u=e[10],d=e[14],c=e[3],f=e[7],p=e[11],g=e[15];e[0]=t*(l*(u*g-d*p)-h*(_*g-d*f)+o*(_*p-u*f)),e[1]=-t*(n*(u*g-d*p)-h*(m*g-d*c)+o*(m*p-u*c)),e[2]=t*(n*(_*g-d*f)-l*(m*g-d*c)+o*(m*f-_*c)),e[3]=-t*(n*(_*p-u*f)-l*(m*p-u*c)+h*(m*f-_*c)),e[4]=-t*(i*(u*g-d*p)-r*(_*g-d*f)+a*(_*p-u*f)),e[5]=t*(s*(u*g-d*p)-r*(m*g-d*c)+a*(m*p-u*c)),e[6]=-t*(s*(_*g-d*f)-i*(m*g-d*c)+a*(m*f-_*c)),e[7]=t*(s*(_*p-u*f)-i*(m*p-u*c)+r*(m*f-_*c)),e[8]=t*(i*(h*g-o*p)-r*(l*g-o*f)+a*(l*p-h*f)),e[9]=-t*(s*(h*g-o*p)-r*(n*g-o*c)+a*(n*p-h*c)),e[10]=t*(s*(l*g-o*f)-i*(n*g-o*c)+a*(n*f-l*c)),e[11]=-t*(s*(l*p-h*f)-i*(n*p-h*c)+r*(n*f-l*c)),e[12]=-t*(i*(h*d-o*u)-r*(l*d-o*_)+a*(l*u-h*_)),e[13]=t*(s*(h*d-o*u)-r*(n*d-o*m)+a*(n*u-h*m)),e[14]=-t*(s*(l*d-o*_)-i*(n*d-o*m)+a*(n*_-l*m)),e[15]=t*(s*(l*u-h*_)-i*(n*u-h*m)+r*(n*_-l*m))}return e}pointAt(t,e,s){null!=e&&void 0!=e||(e=new a.default(0,0,-1)),null!=s&&void 0!=s||(s=new a.default(0,-1,0));let i=e.subtract(t),n=new a.default(s.x,s.y,s.z);i.normalize(),n.normalize();let l=new a.default(i.x,i.y,i.z);l.scaleBy(n.dot(i)),n.subtractBy(l),n.getLength()>r.default.MATH_MIN_POSITIVE?n.normalize():0!=i.x?n.setTo(-i.y,i.x,0):n.setTo(1,0,0);let h=n.crossProduct(i);h.normalize();let o=this.As;o[0]=h.x,o[4]=h.y,o[8]=h.z,o[12]=0,o[1]=n.x,o[5]=n.y,o[9]=n.z,o[13]=0,o[2]=i.x,o[6]=i.y,o[10]=i.z,o[14]=0,o[3]=t.x,o[7]=t.y,o[11]=t.z,o[15]=1}prepend(t){let e=t.getLocalFS32(),s=this.As,i=e[0],r=e[4],a=e[8],n=e[12],l=e[1],h=e[5],o=e[9],m=e[13],_=e[2],u=e[6],d=e[10],c=e[14],f=e[3],p=e[7],g=e[11],v=e[15],x=s[0],T=s[4],E=s[8],y=s[12],S=s[1],b=s[5],M=s[9],A=s[13],L=s[2],R=s[6],P=s[10],D=s[14],F=s[3],w=s[7],B=s[11],C=s[15];s[0]=i*x+l*T+_*E+f*y,s[1]=i*S+l*b+_*M+f*A,s[2]=i*L+l*R+_*P+f*D,s[3]=i*F+l*w+_*B+f*C,s[4]=r*x+h*T+u*E+p*y,s[5]=r*S+h*b+u*M+p*A,s[6]=r*L+h*R+u*P+p*D,s[7]=r*F+h*w+u*B+p*C,s[8]=a*x+o*T+d*E+g*y,s[9]=a*S+o*b+d*M+g*A,s[10]=a*L+o*R+d*P+g*D,s[11]=a*F+o*w+d*B+g*C,s[12]=n*x+m*T+c*E+v*y,s[13]=n*S+m*b+c*M+v*A,s[14]=n*L+m*R+c*P+v*D,s[15]=n*F+m*w+c*B+v*C}prepend3x3(t){let e=t.getLocalFS32(),s=this.As,i=e[0],r=e[4],a=e[8],n=e[1],l=e[5],h=e[9],o=e[2],m=e[6],_=e[10],u=s[0],d=s[4],c=s[8],f=s[1],p=s[5],g=s[9],v=s[2],x=s[6],T=s[10];s[0]=i*u+n*d+o*c,s[1]=i*f+n*p+o*g,s[2]=i*v+n*x+o*T,s[4]=r*u+l*d+m*c,s[5]=r*f+l*p+m*g,s[6]=r*v+l*x+m*T,s[8]=a*u+h*d+_*c,s[9]=a*f+h*p+_*g,s[10]=a*v+h*x+_*T}prependRotationPivot(t,e,s){l.F_5.identity(),l.F_5.getAxisRotation(e.x,e.y,e.z,t),l.F_5.appendTranslationXYZ(s.x,s.y,s.z),this.prepend(l.F_5)}prependRotation(t,e){l.F_5.identity(),l.F_5.getAxisRotation(e.x,e.y,e.z,t),this.prepend(l.F_5)}prependRotationX(t){l.F_5.rotationX(t),this.prepend3x3(l.F_5)}prependRotationY(t){l.F_5.rotationY(t),this.prepend3x3(l.F_5)}prependRotationZ(t){l.F_5.rotationZ(t),this.prepend3x3(l.F_5)}prependRotationEulerAngle(t,e,s){l.F_5.rotationY(e),this.prepend3x3(l.F_5),l.F_5.rotationX(t),this.prepend3x3(l.F_5),l.F_5.rotationZ(s),this.prepend3x3(l.F_5)}prependScale(t,e,s){let i=this.As;i[0]*=t,i[1]*=e,i[2]*=s,i[4]*=t,i[5]*=e,i[6]*=s,i[8]*=t,i[9]*=e,i[10]*=s,i[12]*=t,i[13]*=e,i[14]*=s}prependScaleXY(t,e){this.As[0]*=t,this.As[1]*=e,this.As[4]*=t,this.As[5]*=e,this.As[8]*=t,this.As[9]*=e,this.As[12]*=t,this.As[13]*=e}prependTranslationXYZ(t,e,s){l.F_5.identity(),this.prepend(l.F_5)}prependTranslation(t){l.F_5.identity(),this.prepend(l.F_5)}recompose(t,e){if(t.length<3||0==t[2].x||0==t[2].y||0==t[2].z)return!1;this.identity();let s=l.F_5.getFS32();s[0]=s[1]=s[2]=t[2].x,s[4]=s[5]=s[6]=t[2].y,s[8]=s[9]=s[10]=t[2].z;let i=this.As;switch(e){case n.default.EULER_ANGLES:{let e=Math.cos(t[1].x),r=Math.cos(t[1].y),a=Math.cos(t[1].z),n=Math.sin(t[1].x),l=Math.sin(t[1].y),h=Math.sin(t[1].z);i[0]=r*a*s[0],i[1]=r*h*s[1],i[2]=-l*s[2],i[3]=0,i[4]=(n*l*a-e*h)*s[4],i[5]=(n*l*h+e*a)*s[5],i[6]=n*r*s[6],i[7]=0,i[8]=(e*l*a+n*h)*s[8],i[9]=(e*l*h-n*a)*s[9],i[10]=e*r*s[10],i[11]=0,i[12]=t[0].x,i[13]=t[0].y,i[14]=t[0].z,i[15]=1}break;default:{let r=t[1].x,a=t[1].y,l=t[1].z,h=t[1].w;if(e==n.default.AXIS_ANGLE){let t=.5*h;r*=Math.sin(t),a*=Math.sin(t),l*=Math.sin(t),h=Math.cos(t)}i[0]=(1-2*a*a-2*l*l)*s[0],i[1]=(2*r*a+2*h*l)*s[1],i[2]=(2*r*l-2*h*a)*s[2],i[3]=0,i[4]=(2*r*a-2*h*l)*s[4],i[5]=(1-2*r*r-2*l*l)*s[5],i[6]=(2*a*l+2*h*r)*s[6],i[7]=0,i[8]=(2*r*l+2*h*a)*s[8],i[9]=(2*a*l-2*h*r)*s[9],i[10]=(1-2*r*r-2*a*a)*s[10],i[11]=0,i[12]=t[0].x,i[13]=t[0].y,i[14]=t[0].z,i[15]=1}break}return 0==t[2].x&&(this.As[0]=0),0==t[2].y&&(this.As[5]=0),0==t[2].z&&(this.As[10]=0),s=null,!0}setThreeAxes(t,e,s){let i=this.As;i[0]=t.x,i[1]=t.y,i[2]=t.z,i[4]=e.x,i[5]=e.y,i[6]=e.z,i[8]=s.x,i[9]=s.y,i[10]=s.z}deltaTransformVector(t){let e=t.x,s=t.y,i=t.z;return new a.default(e*this.As[0]+s*this.As[4]+i*this.As[8],e*this.As[1]+s*this.As[5]+i*this.As[9],e*this.As[2]+s*this.As[6]+i*this.As[10],0)}deltaTransformVectorSelf(t){let e=this.As,s=t.x,i=t.y,r=t.z;t.x=s*e[0]+i*e[4]+r*e[8],t.y=s*e[1]+i*e[5]+r*e[9],t.z=s*e[2]+i*e[6]+r*e[10]}deltaTransformOutVector(t,e){let s=this.As;e.x=t.x*s[0]+t.y*s[4]+t.z*s[8],e.y=t.x*s[1]+t.y*s[5]+t.z*s[9],e.z=t.x*s[2]+t.y*s[6]+t.z*s[10]}transformVector(t){let e=this.As,s=t.x,i=t.y,r=t.z;return new a.default(s*e[0]+i*e[4]+r*e[8]+e[12],s*e[1]+i*e[5]+r*e[9]+e[13],s*e[2]+i*e[6]+r*e[10]+e[14],s*e[3]+i*e[7]+r*e[11]+e[15])}transformOutVector(t,e){let s=t.x,i=t.y,r=t.z,a=this.As;e.setTo(s*a[0]+i*a[4]+r*a[8]+a[12],s*a[1]+i*a[5]+r*a[9]+a[13],s*a[2]+i*a[6]+r*a[10]+a[14],s*a[3]+i*a[7]+r*a[11]+a[15])}transformOutVector3(t,e){let s=this.As;e.x=t.x*s[0]+t.y*s[4]+t.z*s[8]+s[12],e.y=t.x*s[1]+t.y*s[5]+t.z*s[9]+s[13],e.z=t.x*s[2]+t.y*s[6]+t.z*s[10]+s[14]}transformVector3Self(t){let e=t.x,s=t.y,i=t.z,r=this.As;t.x=e*r[0]+s*r[4]+i*r[8]+r[12],t.y=e*r[1]+s*r[5]+i*r[9]+r[13],t.z=e*r[2]+s*r[6]+i*r[10]+r[14]}transformVectorSelf(t){let e=t.x,s=t.y,i=t.z,r=this.As;t.setTo(e*r[0]+s*r[4]+i*r[8]+r[12],e*r[1]+s*r[5]+i*r[9]+r[13],e*r[2]+s*r[6]+i*r[10]+r[14],e*r[3]+s*r[7]+i*r[11]+r[15])}transformVectors(t,e,s){let i,r,a,n=0,l=this.As;e-=3;while(n<=e)i=t[n],r=t[n+1],a=t[n+2],s[n]=i*l[0]+r*l[4]+a*l[8]+l[12],s[n+1]=i*l[1]+r*l[5]+a*l[9]+l[13],s[n+2]=i*l[2]+r*l[6]+a*l[10]+l[14],n+=3}transformVectorsSelf(t,e){let s,i,r,a=0,n=this.As;e-=3;while(a<=e)s=t[a],i=t[a+1],r=t[a+2],t[a]=s*n[0]+i*n[4]+r*n[8]+n[12],t[a+1]=s*n[1]+i*n[5]+r*n[9]+n[13],t[a+2]=s*n[2]+i*n[6]+r*n[10]+n[14],a+=3}transformVectorsRangeSelf(t,e,s){let i,r,a,n=e,l=this.As;s-=3;while(n<=s)i=t[n],r=t[n+1],a=t[n+2],t[n]=i*l[0]+r*l[4]+a*l[8]+l[12],t[n+1]=i*l[1]+r*l[5]+a*l[9]+l[13],t[n+2]=i*l[2]+r*l[6]+a*l[10]+l[14],n+=3}transpose(){l.F_5.copyFrom(this);let t=l.F_5.getFS32(),e=this.As;e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11]}interpolateTo(t,e){let s=t.getFS32(),i=t.getFSIndex(),r=0,a=this.Ar;while(r<16)this.W_[a]+=(s[i+r]-this.W_[a])*e,++a,++r}getAxisRotation(t,e,s,i){i=-i;let r=this.As,a=Math.sin(i),n=Math.cos(i),l=1-n;r[0]=n+t*t*l,r[5]=n+e*e*l,r[10]=n+s*s*l;let h=t*e*l,o=s*a;r[4]=h+o,r[1]=h-o,h=t*s*l,o=e*a,r[8]=h-o,r[2]=h+o,h=e*s*l,o=t*a,r[9]=h+o,r[6]=h-o}rotationX(t){let e=Math.sin(t),s=Math.cos(t);this.As[0]=1,this.As[1]=0,this.As[2]=0,this.As[4]=0,this.As[5]=s,this.As[6]=e,this.As[8]=0,this.As[9]=-e,this.As[10]=s}rotationY(t){let e=Math.sin(t),s=Math.cos(t);this.As[0]=s,this.As[1]=0,this.As[2]=-e,this.As[4]=0,this.As[5]=1,this.As[6]=0,this.As[8]=e,this.As[9]=0,this.As[10]=s}rotationZ(t){let e=Math.sin(t),s=Math.cos(t);this.As[0]=s,this.As[1]=e,this.As[2]=0,this.As[4]=-e,this.As[5]=s,this.As[6]=0,this.As[8]=0,this.As[9]=0,this.As[10]=1}toString(){let t="\n"+this.As[0]+","+this.As[1]+","+this.As[2]+","+this.As[3]+"\n";return t+=this.As[4]+","+this.As[5]+","+this.As[6]+","+this.As[7]+"\n",t+=this.As[8]+","+this.As[9]+","+this.As[10]+","+this.As[11]+"\n",t+=this.As[12]+","+this.As[13]+","+this.As[14]+","+this.As[15]+"\n",t}transformPerspV4Self(t){t.w=t.z,t.x*=this.As[0],t.y*=this.As[5],t.z*=this.As[10],t.z+=this.As[14],t.w*=this.As[11],t.w+=this.As[15]}perspectiveRH(t,e,s,i){let r=Math.tan(.5*t);this.identity(),this.As[0]=1/(e*r),this.As[5]=1/r,this.As[10]=-(i+s)/(i-s),this.As[11]=-1,this.As[14]=-2*i*s/(i-s)}perspectiveRH2(t,e,s,i,r){let a=e/Math.tan(.5*t),n=a/e,l=a/s,h=-r/(r-i),o=-i*h;this.identity(),this.As[0]=n,this.As[5]=l,this.As[10]=h,this.As[11]=-1,this.As[14]=o}orthoRH(t,e,s,i,r,a){this.identity(),this.As[0]=2/(i-s),this.As[5]=2/(e-t),this.As[10]=-2/(a-r),this.As[12]=-(i+s)/(i-s),this.As[13]=-(e+t)/(e-t),this.As[14]=-(a+r)/(a-r),this.As[15]=1}perspectiveLH(t,e,s,i){let r=Math.tan(.5*t);this.identity(),this.As[0]=1/(e*r),this.As[5]=1/r,this.As[10]=(i+s)/(i-s),this.As[11]=1,this.As[14]=2*i*s/(i-s)}orthoLH(t,e,s,i,r,a){this.identity(),this.As[0]=2/(i-s),this.As[5]=2/(e-t),this.As[10]=2/(a-r),this.As[12]=-(i+s)/(i-s),this.As[13]=-(e+t)/(e-t),this.As[14]=-(a+r)/(a-r),this.As[15]=1}lookAtRH(t,e,s){this.identity();let i=e.subtract(t);i.normalize();let r=i.crossProduct(s);r.normalize();let a=r.crossProduct(i);r.w=-r.dot(t),a.w=-a.dot(t),i.w=i.dot(t),i.negate(),this.copyRowFrom(0,r),this.copyRowFrom(1,a),this.copyRowFrom(2,i)}lookAtLH(t,e,s){this.identity();let i=e.subtract(t);i.normalize();let r=i.crossProduct(s);r.normalize();let a=r.crossProduct(i);r.w=-r.dot(t),a.w=-a.dot(t),i.w=-i.dot(t),this.copyRowFrom(0,r),this.copyRowFrom(1,a),this.copyRowFrom(2,i)}destroy(){this.As=null,this.W_=null,this.Ar=-1}}l.F_6=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),l.F_0=0,l.F_7=327679,l.F_5=new l,e.default=l},"1e15":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("030e"));class n{constructor(){this.I=0,this.At=2,this.Au=null,this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.vroUid=0,this.rioUid=0}getRC(){return this.Au}getRCUid(){return this.I}createBuf(){return this.Au.createBuffer()}deleteBuf(t){this.Au.deleteBuffer(t)}bindArrBuf(t){this.Au.bindBuffer(this.Au.ARRAY_BUFFER,t)}bindEleBuf(t){this.Au.bindBuffer(this.Au.ELEMENT_ARRAY_BUFFER,t)}arrBufSubData(t,e){this.Au.bufferSubData(this.Au.ARRAY_BUFFER,e,t)}arrBufData(t,e){this.Au.bufferData(this.Au.ARRAY_BUFFER,t,r.default.ToGL(this.Au,e))}eleBufSubData(t,e){this.Au.bufferSubData(this.Au.ELEMENT_ARRAY_BUFFER,e,t)}eleBufData(t,e){this.Au.bufferData(this.Au.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.Au,e))}arrBufDataMem(t,e){this.Au.bufferData(this.Au.ARRAY_BUFFER,t,r.default.ToGL(this.Au,e))}eleBufDataMem(t,e){this.Au.bufferData(this.Au.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.Au,e))}useVtxAttribsPtrTypeFloat(t,e,s,i,r,a){this.Au.bindBuffer(this.Au.ARRAY_BUFFER,e);for(let n=0;n<i;++n)t.vertexAttribPointerTypeFloat(s[n],a,r[n])}useVtxAttribsPtrTypeFloatMulti(t,e,s,i,r,a){for(let n=0;n<i;++n)this.Au.bindBuffer(this.Au.ARRAY_BUFFER,e[n]),t.vertexAttribPointerTypeFloat(s[n],a,r[n])}createVertexArray(){let t=null;return t=2==this.At?this.Au.createVertexArray():a.default.OES_vertex_array_object.createVertexArrayOES(),t}bindVertexArray(t){return 2==this.At?this.Au.bindVertexArray(t):a.default.OES_vertex_array_object.bindVertexArrayOES(t),t}deleteVertexArray(t){2==this.At?this.Au.deleteVertexArray(t):a.default.OES_vertex_array_object.deleteVertexArrayOES(t)}testVROUid(t){return this.vroUid!=t&&(this.vroUid=t,!0)}testRIOUid(t){return this.rioUid!=t&&(this.rioUid=t,!0)}initialize(t,e,s){this.Au=e,this.I=t,this.At=s;let i=this;i.RGBA=e.RGBA,i.UNSIGNED_BYTE=e.UNSIGNED_BYTE,i.TRIANGLE_STRIP=e.TRIANGLE_STRIP,i.TRIANGLE_FAN=e.TRIANGLE_FAN,i.TRIANGLES=e.TRIANGLES,i.LINES=this.Au.LINES,i.LINE_STRIP=e.LINE_STRIP,i.UNSIGNED_SHORT=e.UNSIGNED_SHORT,i.UNSIGNED_INT=e.UNSIGNED_INT,i.COLOR=e.COLOR,i.DEPTH=e.DEPTH,i.STENCIL=e.STENCIL,i.DEPTH_STENCIL=e.DEPTH_STENCIL,this.At>1?(i.MIN=e.MIN,i.MAX=e.MAX):(i.MIN=a.default.EXT_blend_minmax.MIN_EXT,i.MAX=a.default.EXT_blend_minmax.MAX_EXT),i.RContext=e}renderBegin(){this.vroUid=-2,this.rioUid=-3}toString(){return"[Object ROVtxBuilder()]"}}e.default=n},"1ea6":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73"));class a{constructor(){this.j_="PBRShd",this.codeBuilder=null,this.specularEnvMap=null,this.diffuseMap=null,this.normalMap=null,this.mirrorMap=null,this.indirectEnvMap=null,this.parallaxMap=null,this.aoMap=null,this.roughnessMap=null,this.metalhnessMap=null,this.armMap=null,this.glossinessEnabeld=!0,this.woolEnabled=!0,this.toneMappingEnabled=!0,this.specularEnvMapEnabled=!0,this.scatterEnabled=!0,this.specularBleedEnabled=!0,this.metallicCorrection=!0,this.gammaCorrection=!0,this.absorbEnabled=!1,this.normalNoiseEnabled=!1,this.pixelNormalNoiseEnabled=!1,this.mirrorProjEnabled=!1,this.mirrorMapLodEnabled=!1,this.diffuseMapEnabled=!1,this.normalMapEnabled=!1,this.aoMapEnabled=!1,this.indirectEnvMapEnabled=!1,this.hdrBrnEnabled=!1,this.vtxFlatNormal=!1,this.lightEnabled=!0,this.shadowReceiveEnabled=!1,this.fogEnabled=!1,this.texturesTotal=1,this.fragLocalParamsTotal=2,this.parallaxParamIndex=2}createTextureList(){let t=this.codeBuilder,e=t.uniform,s=[];return null!=this.armMap&&(this.aoMapEnabled=!0),this.specularEnvMapEnabled&&null!=this.specularEnvMap&&(s.push(this.specularEnvMap),e.addspecularEnvMap(!0)),this.diffuseMapEnabled&&null!=this.diffuseMap&&(s.push(this.diffuseMap),e.addDiffuseMap()),this.normalMapEnabled&&null!=this.normalMap&&(s.push(this.normalMap),e.addNormalMap()),null!=this.parallaxMap&&(s.push(this.parallaxMap),e.addParallaxMap(this.parallaxParamIndex)),this.aoMapEnabled&&null!=this.aoMap&&(s.push(this.aoMap),e.addAOMap()),null!=this.roughnessMap&&(s.push(this.roughnessMap),e.addRoughnessMap()),null!=this.metalhnessMap&&(s.push(this.metalhnessMap),e.addMetalnessMap()),null!=this.armMap&&(s.push(this.armMap),e.addARMMap()),this.mirrorProjEnabled&&null!=this.mirrorMap&&(s.push(this.mirrorMap),e.add2DMap("VOX_MIRROR_PROJ_MAP",!0,!0,!1)),this.indirectEnvMapEnabled&&null!=this.indirectEnvMap&&(s.push(this.indirectEnvMap),e.addCubeMap("VOX_INDIRECT_ENV_MAP",!0,!1)),this.texturesTotal=s.length,s}copyFrom(t){this.woolEnabled=t.woolEnabled,this.toneMappingEnabled=t.toneMappingEnabled,this.specularEnvMapEnabled=t.specularEnvMapEnabled,this.scatterEnabled=t.scatterEnabled,this.specularBleedEnabled=t.specularBleedEnabled,this.metallicCorrection=t.metallicCorrection,this.gammaCorrection=t.gammaCorrection,this.absorbEnabled=t.absorbEnabled,this.normalNoiseEnabled=t.normalNoiseEnabled,this.pixelNormalNoiseEnabled=t.pixelNormalNoiseEnabled,this.mirrorProjEnabled=t.mirrorProjEnabled,this.mirrorMapLodEnabled=t.mirrorMapLodEnabled,this.diffuseMapEnabled=t.diffuseMapEnabled,this.normalMapEnabled=t.normalMapEnabled,this.aoMapEnabled=t.aoMapEnabled,this.indirectEnvMapEnabled=t.indirectEnvMapEnabled,this.shadowReceiveEnabled=t.shadowReceiveEnabled,this.fogEnabled=t.fogEnabled,this.hdrBrnEnabled=t.hdrBrnEnabled,this.vtxFlatNormal=t.vtxFlatNormal,this.fragLocalParamsTotal=t.fragLocalParamsTotal,null==this.specularEnvMap&&(this.specularEnvMap=t.specularEnvMap),null==this.diffuseMap&&(this.diffuseMap=t.diffuseMap),null==this.normalMap&&(this.normalMap=t.normalMap),null==this.aoMap&&(this.aoMap=t.aoMap),null==this.mirrorMap&&(this.mirrorMap=t.mirrorMap),null==this.indirectEnvMap&&this.indirectEnvMapEnabled&&(this.indirectEnvMap=t.indirectEnvMap),null==this.parallaxMap&&(this.parallaxMap=t.parallaxMap),null==this.roughnessMap&&(this.roughnessMap=t.roughnessMap),this.lightEnabled=t.lightEnabled,this.texturesTotal=t.texturesTotal}buildShader(){let t=this.codeBuilder;t.normalMapEnabled=this.normalMapEnabled,t.mapLodEnabled=!0,t.useHighPrecious();let e=this.mirrorProjEnabled&&this.texturesTotal>0;this.normalNoiseEnabled&&t.addDefine("VOX_NORMAL_NOISE"),this.woolEnabled&&t.addDefine("VOX_WOOL"),this.toneMappingEnabled&&t.addDefine("VOX_TONE_MAPPING"),this.scatterEnabled&&t.addDefine("VOX_SCATTER"),this.specularBleedEnabled&&t.addDefine("VOX_SPECULAR_BLEED"),this.metallicCorrection&&t.addDefine("VOX_METALLIC_CORRECTION"),this.gammaCorrection&&t.addDefine("VOX_GAMMA_CORRECTION"),this.absorbEnabled&&t.addDefine("VOX_ABSORB"),this.pixelNormalNoiseEnabled&&t.addDefine("VOX_PIXEL_NORMAL_NOISE"),this.mirrorMapLodEnabled&&t.addDefine("VOX_MIRROR_MAP_LOD","1"),this.hdrBrnEnabled&&t.addDefine("VOX_HDR_BRN","1"),this.vtxFlatNormal&&t.addDefine("VOX_VTX_FLAT_NORMAL","1"),t.addFragUniform("vec4","u_fragLocalParams",this.fragLocalParamsTotal),t.addFragUniform("vec4","u_pbrParams",4),e&&(t.addFragUniformParam(r.default.StageParam),t.addFragUniform("vec4","u_mirrorParams",2)),t.vertMatrixInverseEnabled=!0}getUniqueShaderName(){let t=this.j_;return this.woolEnabled&&(t+="_wl"),this.toneMappingEnabled&&(t+="TM"),this.specularEnvMapEnabled&&(t+="EnvM"),this.scatterEnabled&&(t+="Sct"),this.specularBleedEnabled&&(t+="SpecBl"),this.metallicCorrection&&(t+="MetCorr"),this.gammaCorrection&&(t+="GmaCorr"),this.absorbEnabled&&(t+="Absorb"),this.pixelNormalNoiseEnabled&&(t+="PNNoise"),this.mirrorProjEnabled&&(t+="MirPrj"),this.normalNoiseEnabled&&(t+="NNoise"),this.indirectEnvMapEnabled&&(t+="IndirEnv"),this.normalMapEnabled&&(t+="NorMap"),this.aoMapEnabled&&(t+="AoMap"),this.shadowReceiveEnabled&&(t+="Shadow"),this.fogEnabled&&(t+="Fog"),this.hdrBrnEnabled&&(t+="HdrBrn"),this.vtxFlatNormal&&(t+="vtxFlagN"),t+="_T"+this.texturesTotal,this.j_=t,t}toString(){return"[PBRShaderBuffer()]"}}e.default=a},"1eb2":function(t,e,s){"use strict";if("undefined"!==typeof window){var i=window.document.currentScript,r=s("8875");i=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var a=i&&i.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(s.p=a[1])}},"20ef":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("8a0a"));class n{constructor(t){this.AC=null,this.b=-1,this.Av=null,this.I=-1,this.F_=null,this.Aw="",this.Ax=0,this.Ay=null,this.Az=null,this.A0=null,this.A1=null,this.A2=null,this.A3=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.A4=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.A5=null,this.A6=new Map,this.A7=new Map,this.A8=null,this.A9=null,this.dataUniformEnabled=!1,this.A_A=0,this.A_B=0,this.A_C=null,this.A_D=0,this.b=t}setShdData(t){this.AC=t,this.Aw=t.getUniqueShaderName()}getUid(){return this.b}getTexTotal(){return this.AC.getTexTotal()}useTexLocation(){for(let t=0;t<this.Ax;t++)this.F_.uniform1i(this.A2[t],t)}haveTexture(){return this.AC.haveTexture()}createLocations(){let t=0,e=0,s=this.AC.getAttriNSList();if(null!=s&&s.length>0&&null==this.Ay){this.dataUniformEnabled=!1;let i=this.AC.getAttriSizeList();this.Ay=[],this.Az=[],this.A0=[],e=s.length;let n=0,l=0;while(t<e)l=this.F_.getAttribLocation(this.Av,s[t]),this.Ay.push(l),n=a.default.GetVBufAttributeTypeByNS(s[t]),this.Az.push(n),this.A0.push(i[t]),this.A3[n]=l,this.A4[n]=i[t],this.dataUniformEnabled=!0,++t;for(this.A5=[],t=0;t<this.A4.length;++t)this.A4[t]>0&&this.A5.push(this.A4[t]);r.default.SHADERCODE_TRACE_ENABLED}if(this.AC.haveCommonUniform()&&null==this.A1){let s=this.AC.getUniforms();this.A1=[],e=s.length,t=0;let i=null,a="";while(t<e)s[t].isTex||(a=s[t].name,i=this.F_.getUniformLocation(this.Av,a),r.default.SHADERCODE_TRACE_ENABLED,null!=i?(i.uniformName=a,i.uniqueName=this.Aw,s[t].location=i,this.A6.set(a,s[t]),this.A7.set(a,i),this.A1.push(i),this.dataUniformEnabled=!0):r.default.SHADERCODE_TRACE_ENABLED),++t}if(this.Ax=this.AC.getTexTotal(),this.Ax>0){this.A2=new Array(this.Ax);let e=this.AC.getTexUniformNames();for(t=0;t<this.Ax;++t)e[t]="u_sampler"+t,this.A2[t]=this.F_.getUniformLocation(this.Av,e[t])}}getLayoutBit(){return this.AC.getLayoutBit()}getMid(){return this.AC.getMid()}getFragOutputTotal(){return this.AC.getFragOutputTotal()}getLocationsTotal(){return this.Az.length}getLocationTypeByIndex(t){return this.Az[t]}getLocationSizeByIndex(t){return this.A0[t]}testVertexAttribPointerOffset(t){let e=!1;if(null!=t&&null!=this.A5&&t.length>=this.A5.length){let s=0,i=0;for(;i<this.A5.length;++i){if(s!=t[i])break;s+=4*this.A5[i]}e=i>=this.A5.length}if(!e)throw Error("Shader program vertx attributes layout can not match float attribute vertex data !!!");return e}vertexAttribPointerType(t,e,s,i,r,a){this.A_A=this.A3[t],this.A_A>-1&&(this.F_.enableVertexAttribArray(this.A_A),this.F_.vertexAttribPointer(this.A_A,this.A4[t],s,i,r,a))}vertexAttribPointerTypeFloat(t,e,s){this.A_A=this.A3[t],this.A_A>-1&&(this.F_.enableVertexAttribArray(this.A_A),this.F_.vertexAttribPointer(this.A_A,this.A4[t],this.F_.FLOAT,!1,e,s))}testVertexAttribPointerType(t){return this.A3[t]>-1}getVertexAttribByTpye(t){return this.A3[t]}vertexAttribPointerAt(t,e,s,i,r,a){this.A_B=t,this.A_A=this.Ay[t],this.A_A>-1&&(this.F_.enableVertexAttribArray(this.A_A),this.F_.vertexAttribPointer(this.A_A,e,s,i,r,a))}vertexAttribPointerNext(t,e,s,i,r){this.A_A=this.Ay[this.A_B],this.A_A>-1&&(this.F_.enableVertexAttribArray(this.A_A),this.F_.vertexAttribPointer(this.A_A,t,e,s,i,r)),this.A_B++}vertexAttribPointerFirst(t,e,s,i,r){this.A_B=1,this.A_A=this.Ay[0],this.A_A>-1&&(this.F_.enableVertexAttribArray(this.A_A),this.F_.vertexAttribPointer(this.A_A,t,e,s,i,r))}getUniformLocationAt(t){return this.A_D=t+1,this.A1[t]}getUniformLocationNext(){return this.A_C=this.A1[this.A_D++],this.A_C}getUniformLocationFirst(){return this.A_D=1,this.A1[0]}getUniformLocationByNS(t){return this.A7.get(t)}getUniformTypeNameByNS(t){return this.A6.has(t)?this.A6.get(t).typeName:""}getUniformTypeByNS(t){return this.A6.has(t)?this.A6.get(t).type:0}hasUniformByName(t){return this.A6.has(t)}getUniformLengthByNS(t){return this.A6.has(t)?this.A6.get(t).arrLength:0}initShdProgram(){let t,e=this.AC.getVSCodeStr(),s=this.AC.getFSCodeStr();null==this.AC.preCompileInfo&&r.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(e.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),e=e.replace(t," highp ")),e.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),e=e.replace(t," highp "))),r.default.SHADERCODE_TRACE_ENABLED;let i=this.loadShader(this.F_.VERTEX_SHADER,e);null==this.AC.preCompileInfo&&r.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(s.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),s=s.replace(t," highp ")),s.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),s=s.replace(t," highp "))),r.default.SHADERCODE_TRACE_ENABLED;let a=this.loadShader(this.F_.FRAGMENT_SHADER,s),n=this.F_.createProgram();return this.F_.attachShader(n,a),this.F_.attachShader(n,i),this.F_.linkProgram(n),this.F_.getProgramParameter(n,this.F_.LINK_STATUS)?(this.A8=i,this.A9=a,n):(r.default.SHADERCODE_TRACE_ENABLED,null)}loadShader(t,e){let s=this.F_.createShader(t);return this.F_.shaderSource(s,e),this.F_.compileShader(s),this.F_.getShaderParameter(s,this.F_.COMPILE_STATUS)?s:(r.default.SHADERCODE_TRACE_ENABLED,this.F_.deleteShader(s),null)}getUniqueShaderName(){return this.Aw}enabled(){return null!=this.Av}upload(t,e){null==this.Av&&(this.I=e,this.F_=t,this.Av=this.initShdProgram(),this.Av.uniqueName=this.Aw,null!=this.Av&&this.createLocations())}getRCUid(){return this.I}uniformBlockBinding(t,e){this.F_.uniformBlockBinding(this.Av,this.F_.getUniformBlockIndex(this.Av,t),e)}toString(){return"[ShdProgram(uniqueName = "+this.Aw+")]"}getGPUProgram(){return this.Av}destroy(){this.Ay=null,this.A5=null,this.Ax>0&&(this.A2.fill(null),this.Ax=0),null!=this.Av&&(this.F_.deleteShader(this.A8),this.F_.deleteShader(this.A9),this.A8=null,this.A9=null,this.F_.deleteProgram(this.Av),this.Av=null),this.F_=null,this.AC=null}}e.default=n},2139:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("18c7"));class a{static GetMatTotal(){return a.F_}static GetFS32Arr(){return a.F_8}static SetFS32Arr(t){a.F_8=t;let e=a.F_,s=a.F_9;for(let i=0;i<e;++i)s[i].setF32Arr(t)}static GetFreeId(){return a.f_.length>0?a.f_.pop():-1}static Allocate(t){if(t<1024&&(t=1024),a.F_<1){a.F_=t,a.F_8=new Float32Array(16*t);let e=0,s=new r.default(a.F_8,16*e),i=s.getUid();for(a.GA=i,a.GB=i+t;e<i;++e)a.F_9.push(null),a.GC.push(a.S_FLAG_FREE);for(a.F_9.push(s),a.GC.push(a.S_FLAG_FREE),a.f_.push(s.getUid()),e=1;e<t;++e)s=new r.default(a.F_8,16*e),a.F_9.push(s),a.GC.push(a.S_FLAG_FREE),a.f_.push(s.getUid())}}static GetMatrix(){let t=null,e=a.GetFreeId()-a.GA;return e>=0?(t=a.F_9[e],t.identity(),a.GC[e]=a.S_FLAG_BUSY):t=new r.default,t}static RetrieveMatrix(t){if(null!=t){let e=t.getUid();e>=a.GA&&e<a.GB&&a.GC[e-a.GA]==a.S_FLAG_BUSY&&(a.f_.push(e),a.GC[e-a.GA]=a.S_FLAG_FREE)}}}a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.F_9=[],a.GC=[],a.f_=[],a.F_8=null,a.GA=0,a.GB=0,a.F_=0,e.default=a},2560:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279"));class n{create(t,e){let s=null,i=t.getCamera();return e.hasUniformByName(r.default.CameraViewMatUNS)&&e.hasUniformByName(r.default.CameraProjectiveMatUNS)?(s=new a.default,s.uns="u_viewAndProjMat",s.uniformNameList=[r.default.CameraViewMatUNS,r.default.CameraProjectiveMatUNS],s.copyDataFromProbe(i.matUProbe)):e.hasUniformByName(r.default.CameraViewMatUNS)?(s=new a.default,s.uns="u_viewMat",s.uniformNameList=[r.default.CameraViewMatUNS],s.copyDataFromProbeAt(0,i.matUProbe)):e.hasUniformByName(r.default.CameraProjectiveMatUNS)&&(s=new a.default,s.uns="u_projMat",s.uniformNameList=[r.default.CameraProjectiveMatUNS],s.copyDataFromProbeAt(1,i.matUProbe)),s}getIDNS(){return"CameraUniformBuilder"}}e.default=n},"264c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.A_E=null,this.A_F=null,this.A_G=null,this.A_H=null,this.A_I=[],this.A_J=0,this.A_K=null,this.A_L=0,this.A_M=null,this.sortEnabled=!0,this.A_K=t}setSorter(t){this.A_M=t}showInfo(){let t="",e=this.A_E;while(null!=e)t+=e.unit.value+",",e=e.next}clear(){if(null!=this.A_K){this.A_I.length>0&&(this.A_I=[]);let t=this.A_E,e=null;while(null!=t)e=t,t=t.next,e.prev=null,e.next=null;this.A_E=this.A_F=null,this.A_J=0,this.A_L=0,this.sortEnabled=!0,this.A_K=null}this.A_M=null}update(){this.sortEnabled&&this.sort()}run(t){this.A_K.resetUniform();let e=null,s=this.A_I;for(let i=0;i<this.A_L;++i)e=s[i],this.A_K.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t)}runLockMaterial(t){this.A_K.resetUniform();let e=null,s=this.A_I;for(let i=0;i<this.A_L;++i)e=s[i],this.A_K.bindToGpu(e.shdUid),e.vro.run(),e.runLockMaterial2(null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}sort(){if(this.A_J>0){let t=this.A_E;this.A_I.length<this.A_J&&(this.A_I=new Array(Math.round(1.1*this.A_J)+1));let e=0;while(null!=t)t.drawEnabled&&t.unit.drawEnabled&&(this.A_I[e]=t.unit,++e),t=t.next;this.A_L=e;let s=0;null!=this.A_M&&(s=this.A_M.sortRODisplay(this.A_I,e)),s<1&&this.snsort(0,e-1)}}sorting(t,e){let s=this.A_I;this.A_H=s[t];let i=this.A_H.value;while(t<e){while(t<e&&s[e].value>=i)--e;s[t]=s[e];while(t<e&&s[t].value<=i)++t;s[e]=s[t]}return s[t]=this.A_H,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}getNodesTotal(){return this.A_J}getBegin(){return this.A_G=this.A_E,this.A_E}getNext(){return null!=this.A_G&&(this.A_G=this.A_G.next),this.A_G}isEmpty(){return this.A_J<1}addNode(t){null==t.prev&&null==t.next&&(null==this.A_E?this.A_F=this.A_E=t:null!=this.A_F.prev?(this.A_F.next=t,t.prev=this.A_F,this.A_F=t):(this.A_E.next=t,t.prev=this.A_F,this.A_F=t),this.A_F.next=null,this.A_J++)}removeNode(t){null==t.prev&&null==t.next&&t!=this.A_E||(t==this.A_E?t==this.A_F?this.A_E=this.A_F=null:(this.A_E=t.next,this.A_E.prev=null):t==this.A_F?(this.A_F=t.prev,this.A_F.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null,this.A_J--)}}e.default=i},"265e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.__$ruid=-1,this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.prev=null,this.next=null,this.unit=null,this.vro=null,this.tro=null,this.rvroI=-1,this.rtroI=-1}setValue(t){this.unit.value=t}isVsible(){return null==this.unit||this.unit.drawEnabled}updateData(){let t=this.unit;this.drawMode=t.drawMode,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,this.vtxUid=t.vtxUid,this.vro=t.vro,this.shdUid=t.shdUid,this.texMid=t.texMid,this.tro=t.tro}reset(){this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.unit=null,this.vro=null,this.tro=null,this.prev=null,this.next=null}toString(){return"[Object RPONode(uid = "+this.uid+", index = "+this.index+", shdUid = "+this.shdUid+", vtxUid = "+this.vtxUid+")]"}}e.default=i},"278e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.A_N=null,this.A_O=null,this.slideSpeed=2,this.q_=0,this.r_=0,this.A_P=!1}initialize(t,e){null==this.A_N&&(this.A_N=t,this.A_O=e)}attach(){this.q_=this.A_N.mouseX,this.r_=this.A_N.mouseY,this.A_P=!0}detach(){this.A_P=!1}run(){if(this.A_P){let t=(this.q_-this.A_N.mouseX)*this.slideSpeed,e=(this.r_-this.A_N.mouseY)*this.slideSpeed;this.A_O.slideViewOffsetXY(t,e),this.q_=this.A_N.mouseX,this.r_=this.A_N.mouseY}}}e.CameraDragSlide=i},"28a9":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("f3a2"),r=s("69ed");class a{constructor(){this.types=[r.ShaderCodeType.VertHead,r.ShaderCodeType.VertBody,r.ShaderCodeType.FragHead,r.ShaderCodeType.FragBody],this.urls=null,this.uuid=i.ShaderCodeUUID.Default,this.binary=!1,this.buildBinaryFile=!1}}e.ShaderCodeConfigure=a},"29ef":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7c63"),a=s("e08e"),n=i(s("919c"));class l{static Initialize(){if(l.GD){l.GD=!1;let t=l;t.Rstate=new r.RODrawState,r.RenderColorMask.Rstate=l.Rstate,r.RenderStateObject.Rstate=l.Rstate,t.COLOR_MASK_ALL_TRUE=r.RenderColorMask.Create("all_true",!0,!0,!0,!0),t.COLOR_MASK_ALL_FALSE=r.RenderColorMask.Create("all_false",!1,!1,!1,!1),t.COLOR_MASK_RED_TRUE=r.RenderColorMask.Create("red_true",!0,!1,!1,!1),t.COLOR_MASK_GREEN_TRUE=r.RenderColorMask.Create("green_true",!1,!0,!1,!1),t.COLOR_MASK_BLUE_TRUE=r.RenderColorMask.Create("blue_true",!1,!1,!0,!1),t.COLOR_MASK_ALPHA_TRUE=r.RenderColorMask.Create("alpha_true",!1,!1,!1,!0),t.COLOR_MASK_RED_FALSE=r.RenderColorMask.Create("red_false",!1,!0,!0,!0),t.COLOR_MASK_GREEN_FALSE=r.RenderColorMask.Create("green_false",!0,!1,!0,!0),t.COLOR_MASK_BLUE_FALSE=r.RenderColorMask.Create("blue_false",!0,!0,!1,!0),t.COLOR_MASK_ALPHA_FALSE=r.RenderColorMask.Create("alpha_false",!0,!0,!0,!1);let e=r.RenderStateObject,s=a.RenderBlendMode;s.NORMAL=e.CreateBlendMode("NORMAL",a.GLBlendMode.ONE,a.GLBlendMode.ZERO,a.GLBlendEquation.FUNC_ADD),s.OPAQUE=e.CreateBlendMode("OPAQUE",a.GLBlendMode.ONE,a.GLBlendMode.ZERO,a.GLBlendEquation.FUNC_ADD),s.TRANSPARENT=e.CreateBlendMode("TRANSPARENT",a.GLBlendMode.SRC_ALPHA,a.GLBlendMode.ONE_MINUS_SRC_ALPHA,a.GLBlendEquation.FUNC_ADD),s.ALPHA_ADD=e.CreateBlendMode("ALPHA_ADD",a.GLBlendMode.ONE,a.GLBlendMode.ONE_MINUS_SRC_ALPHA,a.GLBlendEquation.FUNC_ADD),s.ADD=e.CreateBlendMode("ADD",a.GLBlendMode.SRC_ALPHA,a.GLBlendMode.ONE,a.GLBlendEquation.FUNC_ADD),s.ADD_LINEAR=e.CreateBlendMode("ADD_LINEAR",a.GLBlendMode.ONE,a.GLBlendMode.ONE,a.GLBlendEquation.FUNC_ADD),s.INVERSE_ALPHA=e.CreateBlendMode("INVERSE_ALPHA",a.GLBlendMode.ONE,a.GLBlendMode.SRC_ALPHA,a.GLBlendEquation.FUNC_ADD),s.BLAZE=e.CreateBlendMode("BLAZE",a.GLBlendMode.SRC_COLOR,a.GLBlendMode.ONE,a.GLBlendEquation.FUNC_ADD),s.OVERLAY=e.CreateBlendMode("OVERLAY",a.GLBlendMode.DST_COLOR,a.GLBlendMode.DST_ALPHA,a.GLBlendEquation.FUNC_ADD),s.OVERLAY2=e.CreateBlendMode("OVERLAY2",a.GLBlendMode.DST_COLOR,a.GLBlendMode.SRC_ALPHA,a.GLBlendEquation.FUNC_ADD),t.NORMAL_STATE=e.Create("normal",a.CullFaceMode.BACK,a.RenderBlendMode.NORMAL,a.DepthTestMode.OPAQUE),t.BACK_CULLFACE_NORMAL_STATE=t.NORMAL_STATE,t.FRONT_CULLFACE_NORMAL_STATE=e.Create("front_normal",a.CullFaceMode.FRONT,a.RenderBlendMode.NORMAL,a.DepthTestMode.OPAQUE),t.NONE_CULLFACE_NORMAL_STATE=e.Create("none_normal",a.CullFaceMode.NONE,a.RenderBlendMode.NORMAL,a.DepthTestMode.OPAQUE),t.ALL_CULLFACE_NORMAL_STATE=e.Create("all_cull_normal",a.CullFaceMode.FRONT_AND_BACK,a.RenderBlendMode.NORMAL,a.DepthTestMode.OPAQUE),t.BACK_NORMAL_ALWAYS_STATE=e.Create("back_normal_always",a.CullFaceMode.BACK,a.RenderBlendMode.NORMAL,a.DepthTestMode.ALWAYS),t.BACK_TRANSPARENT_STATE=e.Create("back_transparent",a.CullFaceMode.BACK,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.TRANSPARENT_SORT),t.BACK_TRANSPARENT_ALWAYS_STATE=e.Create("back_transparent_always",a.CullFaceMode.BACK,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.ALWAYS),t.NONE_TRANSPARENT_STATE=e.Create("none_transparent",a.CullFaceMode.NONE,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.TRANSPARENT_SORT),t.NONE_TRANSPARENT_ALWAYS_STATE=e.Create("none_transparent_always",a.CullFaceMode.NONE,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.ALWAYS),t.FRONT_CULLFACE_GREATER_STATE=e.Create("front_greater",a.CullFaceMode.FRONT,a.RenderBlendMode.NORMAL,a.DepthTestMode.TRUE_GREATER),t.BACK_ADD_BLENDSORT_STATE=e.Create("back_add_blendSort",a.CullFaceMode.BACK,a.RenderBlendMode.ADD,a.DepthTestMode.TRANSPARENT_SORT),t.BACK_ADD_ALWAYS_STATE=e.Create("back_add_always",a.CullFaceMode.BACK,a.RenderBlendMode.ADD,a.DepthTestMode.ALWAYS),t.BACK_ALPHA_ADD_ALWAYS_STATE=e.Create("back_alpha_add_always",a.CullFaceMode.BACK,a.RenderBlendMode.ALPHA_ADD,a.DepthTestMode.ALWAYS),t.NONE_ADD_ALWAYS_STATE=e.Create("none_add_always",a.CullFaceMode.NONE,a.RenderBlendMode.ADD,a.DepthTestMode.ALWAYS),t.NONE_ADD_BLENDSORT_STATE=e.Create("none_add_blendSort",a.CullFaceMode.NONE,a.RenderBlendMode.ADD,a.DepthTestMode.TRANSPARENT_SORT),t.NONE_ALPHA_ADD_ALWAYS_STATE=e.Create("none_alpha_add_always",a.CullFaceMode.NONE,a.RenderBlendMode.ALPHA_ADD,a.DepthTestMode.ALWAYS),t.FRONT_ADD_ALWAYS_STATE=e.Create("front_add_always",a.CullFaceMode.FRONT,a.RenderBlendMode.ADD,a.DepthTestMode.ALWAYS),t.FRONT_TRANSPARENT_STATE=e.Create("front_transparent",a.CullFaceMode.FRONT,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.TRANSPARENT_SORT),t.FRONT_TRANSPARENT_ALWAYS_STATE=e.Create("front_transparent_always",a.CullFaceMode.FRONT,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.ALWAYS),t.NONE_CULLFACE_NORMAL_ALWAYS_STATE=e.Create("none_normal_always",a.CullFaceMode.NONE,a.RenderBlendMode.NORMAL,a.DepthTestMode.ALWAYS),t.BACK_ALPHA_ADD_BLENDSORT_STATE=e.Create("back_alpha_add_blendSort",a.CullFaceMode.BACK,a.RenderBlendMode.ALPHA_ADD,a.DepthTestMode.TRANSPARENT_SORT)}}static CreateBlendMode(t,e,s,i=0){return r.RenderStateObject.CreateBlendMode(t,e,s,i)}static CreateBlendModeSeparate(t,e,s,i=0,a=0,n=0){return r.RenderStateObject.CreateBlendModeSeparate(t,e,s,i,a,n)}static CreateRenderState(t,e,s,i){return r.RenderStateObject.Create(t,e,s,i)}static CreateRenderColorMask(t,e,s,i,a){return r.RenderColorMask.Create(t,e,s,i,a)}static GetRenderStateByName(t){return r.RenderStateObject.GetRenderStateByName(t)}static GetRenderColorMaskByName(t){return r.RenderColorMask.GetColorMaskByName(t)}static UnlockBlendMode(){r.RenderStateObject.UnlockBlendMode()}static LockBlendMode(t){r.RenderStateObject.LockBlendMode(t)}static UnlockDepthTestMode(){r.RenderStateObject.UnlockDepthTestMode()}static LockDepthTestMode(t){r.RenderStateObject.LockDepthTestMode(t)}static ResetState(){r.RenderColorMask.Reset(),r.RenderStateObject.Reset(),l.Rstate.reset(),n.default.Reset()}static Reset(t){r.RenderColorMask.Reset(),r.RenderStateObject.Reset(),l.Rstate.setRenderContext(t),l.Rstate.reset()}static ResetInfo(){l.DrawCallTimes=0,l.DrawTrisNumber=0,l.POVNumber=0}static SetDepthTestEnable(t){l.Rstate.setDepthTestEnable(t)}static SetBlendEnable(t){l.Rstate.setBlendEnable(t)}static SetStencilFunc(t,e,s){l.Rstate.setStencilFunc(t,e,s)}static SetStencilMask(t){l.Rstate.setStencilMask(t)}static SetStencilOp(t,e,s){l.Rstate.setStencilOp(t,e,s)}}l.GD=!0,l.Rstate=null,l.DrawCallTimes=0,l.DrawTrisNumber=0,l.POVNumber=0,l.COLOR_MASK_ALL_TRUE=0,l.COLOR_MASK_ALL_FALSE=1,l.COLOR_MASK_RED_TRUE=2,l.COLOR_MASK_GREEN_TRUE=3,l.COLOR_MASK_BLUE_TRUE=4,l.COLOR_MASK_ALPHA_TRUE=5,l.COLOR_MASK_RED_FALSE=6,l.COLOR_MASK_GREEN_FALSE=7,l.COLOR_MASK_BLUE_FALSE=8,l.COLOR_MASK_ALPHA_FALSE=9,l.NORMAL_STATE=0,l.BACK_CULLFACE_NORMAL_STATE=0,l.FRONT_CULLFACE_NORMAL_STATE=1,l.NONE_CULLFACE_NORMAL_STATE=2,l.ALL_CULLFACE_NORMAL_STATE=3,l.BACK_NORMAL_ALWAYS_STATE=4,l.BACK_TRANSPARENT_STATE=5,l.BACK_TRANSPARENT_ALWAYS_STATE=6,l.NONE_TRANSPARENT_STATE=7,l.NONE_TRANSPARENT_ALWAYS_STATE=8,l.FRONT_CULLFACE_GREATER_STATE=9,l.BACK_ADD_BLENDSORT_STATE=10,l.BACK_ADD_ALWAYS_STATE=11,l.BACK_ALPHA_ADD_ALWAYS_STATE=12,l.NONE_ADD_ALWAYS_STATE=13,l.NONE_ADD_BLENDSORT_STATE=14,l.NONE_ALPHA_ADD_ALWAYS_STATE=15,l.FRONT_ADD_ALWAYS_STATE=16,l.FRONT_TRANSPARENT_STATE=17,l.FRONT_TRANSPARENT_ALWAYS_STATE=18,l.NONE_CULLFACE_NORMAL_ALWAYS_STATE=19,l.BACK_ALPHA_ADD_BLENDSORT_STATE=20,e.default=l},"2b5f":function(t,e,s){"use strict";s.r(e),s.d(e,"PBRShaderCode",(function(){return l}));var i="    vec3 color = vec3(0.0);\r\n\r\n    vec4 param4 = u_pbrParams[0];\r\n    vec4 color4;\r\n    float metallic = param4.x;\r\n    float roughness = param4.y;\r\n    float ao = param4.z;\r\n    #ifdef VOX_USE_2D_MAP\r\n        vec2 texUV = v_uv.xy;\r\n    #else\r\n        vec2 texUV = vec2(0.0);\r\n    #endif\r\n    \r\n    worldPosition.xyz = v_worldPosition.xyz;\r\n    vec3 V = normalize(u_cameraPosition.xyz - worldPosition.xyz);\r\n\r\n    #ifdef VOX_VTX_FLAT_NORMAL\r\n        worldNormal = getVtxFlatNormal(worldPosition.xyz);\r\n    #else\r\n        worldNormal = v_worldNormal;\r\n    #endif\r\n    \r\n    vec3 N = worldNormal;\r\n    #ifdef VOX_PARALLAX_MAP\r\n        #ifdef VOX_NORMAL_MAP\r\n            mat3 btnMat3 = getBTNMat3(v_uv, worldPosition.xyz, worldNormal.xyz);\r\n            vec3 tbnViewDir = btnMat3 * V;\r\n            \r\n            //default value: vec4(1.0,10.0,2.0,0.1)\r\n            param4 = u_fragLocalParams[ VOX_PARALLAX_PARAMS_INDEX ];\r\n            texUV = parallaxOccRayMarchDepth(VOX_PARALLAX_MAP, v_uv, -tbnViewDir, param4);\r\n            #ifdef VOX_NORMAL_MAP\r\n                N = btnMat3 * normalize(getNormalFromMap(VOX_NORMAL_MAP, texUV));\r\n            #endif\r\n            N = normalize(mix(worldNormal, N, u_fragLocalParams[0].w));\r\n        #endif\r\n    #else\r\n        #ifdef VOX_NORMAL_MAP\r\n            //  N = normalize(getNormalFromMap(VOX_NORMAL_MAP, texUV, worldNormal.xyz));\r\n            N = getNormalFromMap(VOX_NORMAL_MAP, texUV, worldPosition.xyz, worldNormal);\r\n            N = normalize(mix(worldNormal, N, u_fragLocalParams[0].w));\r\n        #endif\r\n    #endif\r\n    \r\n    #ifdef VOX_AO_MAP\r\n        ao = mix(1.0, VOX_Texture2D(VOX_AO_MAP, texUV).x, ao);\r\n    #endif\r\n    #ifdef VOX_ROUGHNESS_MAP\r\n        roughness = mix(1.0, VOX_Texture2D(VOX_ROUGHNESS_MAP, texUV).y, roughness);\r\n    #endif\r\n    #ifdef VOX_METALNESS_MAP\r\n        metallic = mix(1.0, VOX_Texture2D(VOX_METALNESS_MAP, texUV).z, metallic);\r\n    #endif\r\n    #ifdef VOX_ARM_MAP\r\n        color4.xyz = mix(vec3(1.0, 0.0, 1.0), VOX_Texture2D(VOX_ARM_MAP, texUV).xyz, vec3(ao, roughness, metallic));\r\n        ao = color4.x;\r\n        roughness = color4.y;\r\n        metallic = color4.z;\r\n    #endif\r\n\r\n    #ifdef VOX_USE_GLOSSINESS\r\n        float colorGlossiness = 1.0 - roughness;\r\n    #else\r\n        float colorGlossiness = roughness;\r\n    #endif\r\n    float reflectionIntensity = u_pbrParams[1].y;\r\n    float glossinessSquare = colorGlossiness * colorGlossiness;\r\n    float specularPower = exp2(8.0 * glossinessSquare + 1.0);\r\n\r\n    #ifdef VOX_PIXEL_NORMAL_NOISE\r\n        N = normalize(N + rand(N) * u_pbrParams[0].w);\r\n    #else\r\n        N = normalize(N);\r\n    #endif\r\n\r\n    float dotNV = clamp(dot(N, V), 0.0, 1.0);\r\n    #ifdef VOX_DIFFUSE_MAP\r\n    vec3 albedo = u_fragLocalParams[1].xyz * VOX_Texture2D(VOX_DIFFUSE_MAP, texUV).xyz;\r\n    #else\r\n    vec3 albedo = u_fragLocalParams[1].xyz;\r\n    #endif\r\n    \r\n    // calculate reflectance at normal incidence; if dia-electric (like plastic) use F0 \r\n    // of 0.04 and if it's a metal, use the albedo color as F0 (metallic workflow)    \r\n    vec3 F0 = u_fragLocalParams[0].xyz + vec3(0.04);\r\n    F0 = mix(F0, albedo.xyz, metallic);\r\n\r\n    vec3 diffuseColor = albedo.xyz;\r\n    albedo = gammaToLinear(albedo);\r\n\r\n    vec3 specularColor = vec3(mix(0.025 * reflectionIntensity, 0.078 * reflectionIntensity, colorGlossiness));\r\n    #ifdef VOX_METALLIC_CORRECTION    \r\n        vec3 specularColorMetal = mix(F0, albedo, metallic);\r\n        float ratio = clamp(metallic, 0.0, 1.0);\r\n        specularColor = mix(specularColor, specularColorMetal, ratio);\r\n    #endif\r\n    albedo = mix(albedo, F0, metallic);\r\n    \r\n    specularColor *= u_pbrParams[3].xyz;\r\n    \r\n    #ifdef VOX_ENV_MAP\r\n        float mipLv = floor(100.0 * fract(u_pbrParams[3].w));\r\n        mipLv -= glossinessSquare * mipLv;\r\n        mipLv = max(mipLv + floor(u_pbrParams[3].w), 0.0);\r\n\t    vec3 envDir = -getWorldEnvDir(N, -V);\r\n\t    envDir.x = -envDir.x;\r\n        #ifdef VOX_HDR_BRN\r\n            vec3 specularEnvColor3 = vec3(rgbaToHdrBrn(VOX_TextureCubeLod(VOX_ENV_MAP, envDir, mipLv)));\r\n        #else\r\n            vec3 specularEnvColor3 = VOX_TextureCubeLod(VOX_ENV_MAP, envDir, mipLv).xyz;\r\n        #endif\r\n        \r\n        specularEnvColor3 = gammaToLinear(specularEnvColor3);\r\n        specularColor = fresnelSchlick3(specularColor, dotNV, 0.25 * reflectionIntensity) * specularEnvColor3;\r\n    #endif\r\n\r\n    float frontIntensity = u_pbrParams[1].z;\r\n    float sideIntensity = u_pbrParams[1].w;\r\n\r\n    // reflectance equation    \r\n    RadianceLight rL;\r\n\r\n    vec3 diffuse = albedo.xyz * RECIPROCAL_PI;\r\n    vec3 rm = vec3(1.0 - metallic); // remainder metallic\r\n\r\n    rL.scatterIntensity = u_pbrParams[2].www;\r\n    rL.F0 = F0;\r\n    rL.specularColor = specularColor;\r\n    rL.dotNV = dotNV;\r\n    rL.N = N;\r\n    rL.V = V;\r\n    rL.specularPower = specularPower;\r\n    rL.frontIntensity = frontIntensity;\r\n    rL.sideIntensity = sideIntensity;\r\n    // point light process\r\n    #if VOX_POINT_LIGHTS_TOTAL > 0\r\n        for(int i = 0; i < VOX_POINT_LIGHTS_TOTAL; ++i) \r\n        {\r\n            // calculate per-light radiance\r\n            param4 = u_lightPositions[i];\r\n            color4 = u_lightColors[i];\r\n            rL.L = (param4.xyz - worldPosition.xyz);\r\n            float factor = length(rL.L);\r\n            factor = 1.0 / (1.0 + param4.w * factor + color4.w * factor * factor);\r\n            rL.L = normalize(rL.L);\r\n            calcPBRLight(roughness, rm, color4.xyz * factor, rL);\r\n        }\r\n    #endif\r\n    // parallel light process\r\n    #if VOX_DIRECTION_LIGHTS_TOTAL > 0\r\n        for(int i = VOX_POINT_LIGHTS_TOTAL; i < VOX_LIGHTS_TOTAL; ++i) \r\n        {\r\n            // calculate per-light radiance\r\n            rL.L = normalize(-u_lightPositions[i].xyz);\r\n            calcPBRLight(roughness, rm, u_lightColors[i].xyz, rL);\r\n        }\r\n    #endif\r\n    // spot light process\r\n    #if VOX_SPOT_LIGHTS_TOTAL > 0\r\n        \r\n        for(int i = (VOX_POINT_LIGHTS_TOTAL + VOX_DIRECTION_LIGHTS_TOTAL); i < VOX_LIGHTS_TOTAL; ++i) \r\n        {\r\n            param4 = u_lightPositions[i];\r\n            color4 = u_lightColors[i];\r\n            rL.L = (param4.xyz - worldPosition.xyz);\r\n            float factor = length(rL.L);\r\n            float attenuation = 1.0 / (1.0 + param4.w * factor + color4.w * factor * factor);\r\n\r\n            rL.L = normalize(rL.L);\r\n\r\n            param4 = u_lightPositions[i + VOX_SPOT_LIGHTS_TOTAL];\r\n            param4.xyz = normalize( param4.xyz );\r\n            factor = max(1.0 - (clamp((1.0 - max(dot(-param4.xyz, rL.L), 0.0)), 0.0, param4.w) / param4.w), 0.0001);\r\n\r\n            calcPBRLight(roughness, rm, color4.xyz * attenuation * factor, rL);\r\n        }\r\n    #endif\r\n    \r\n    #ifdef VOX_INDIRECT_ENV_MAP\r\n        rL.L = vec3(0.0, -1.0, 0.0);\r\n        float ifactor = clamp(abs(worldPosition.y - -210.0) / 300.0, 0.0,1.0);\r\n        float lv = 1.0 + 6.0 * ifactor;\r\n        #ifdef VOX_ENV_MAP\r\n            color = VOX_TextureCubeLod(VOX_INDIRECT_ENV_MAP, envDir, lv).xyz;\r\n            rL.specularColor = fresnelSchlick3(specularColor, dotNV, 0.25 * reflectionIntensity) * color;\r\n            color = VOX_TextureCubeLod(VOX_INDIRECT_ENV_MAP, N, lv).xyz;\r\n        #else\r\n            color = VOX_TextureCubeLod(VOX_INDIRECT_ENV_MAP, N, lv).xyz;\r\n            rL.specularColor = fresnelSchlick3(specularColor, dotNV, 0.25 * reflectionIntensity) * color;\r\n        #endif\r\n        calcPBRLight(roughness, rm, 2.0 * color, rL);\r\n        ifactor = 1.0 - ifactor;\r\n        float ifactor2 = max(dot(N, rL.L), 0.0);\r\n        color *= ifactor2 * ifactor2 * (ifactor * ifactor) * ((1.0 - metallic) * roughness) * 0.5;\r\n    #endif\r\n\r\n    specularColor = (rL.specular + specularColor);\r\n\r\n    #ifdef VOX_ABSORB\r\n        specularColor *= vec3(reflectionIntensity);\r\n    #endif\r\n    \r\n    vec3 Lo = rL.diffuse * diffuse + specularColor;\r\n    #ifdef VOX_ENV_AMBIENT_LIGHT_LIGHT_MAP\r\n        param4 = u_envLightParams[4];\r\n        Lo += diffuse * VOX_Texture2D(VOX_ENV_AMBIENT_LIGHT_LIGHT_MAP, (param4.xy + worldPosition.xz) / param4.zw).xyz;\r\n    #endif\r\n    \r\n    // ambient lighting (note that the next IBL tutorial will replace\r\n    // this ambient lighting with environment lighting).\r\n    vec3 ambient = ((color + u_pbrParams[2].xyz) * albedo.xyz) * ao;\r\n    \r\n\t#ifdef VOX_WOOL\r\n\t\tsideIntensity = getColorFactorIntensity(dotNV, frontIntensity, sideIntensity);\r\n\t\tambient *= sideIntensity;\r\n\t\tLo *= sideIntensity * frontIntensity;\r\n\t#endif\r\n\r\n    color = ambient + Lo;\r\n\r\n    // HDR tonemapping\r\n    #ifdef VOX_TONE_MAPPING\r\n        color = tonemapReinhard( color, u_pbrParams[1].x );\r\n    #endif\r\n    \r\n\r\n    // gamma correct\r\n    color = linearToGamma(color);\r\n    \r\n    // mirror inverted reflection\r\n    #ifdef VOX_MIRROR_PROJ_MAP\r\n        float factorY = max(dot(N, V), 0.01) * 0.4 + 0.4;\r\n        ao *= 0.8;\r\n        #ifdef VOX_MIRROR_MAP_LOD\r\n        vec4 mirrorColor4 = ao * VOX_Texture2DLod(VOX_MIRROR_PROJ_MAP, (gl_FragCoord.xy/u_stageParam.zw) + (N  * vec3(0.02)).xy, u_mirrorParams[0].w);\r\n        #else\r\n        vec4 mirrorColor4 = ao * VOX_Texture2D(VOX_MIRROR_PROJ_MAP, (gl_FragCoord.xy/u_stageParam.zw) + (N  * vec3(0.02)).xy);\r\n        #endif\r\n        factorY = mix(1.0, factorY, glossinessSquare);\r\n        color.xyz = mix(mirrorColor4.xyz, color.xyz, factorY);\r\n    #endif\r\n    FragColor0 = vec4(color, 1.0);\r\n//[x: ao, y: rough, z: metal, w: displacement]",r="\r\nconst vec3 vec3One = vec3(1.0);\r\n// ----------------------------------------------------------------------------\r\n\r\n// handy value clamping to 0 - 1 range\r\n#define saturate(a) clamp( a, 0.0, 1.0 )\r\n\r\n//Convert color to linear space\r\n#define VOX_GAMMA 2.2\r\nconst vec3 vec3Gamma = vec3(VOX_GAMMA);\r\nconst vec3 vec3ReciprocalGamma = vec3(1.0 / VOX_GAMMA);\r\n\r\nvec3 gammaToLinear(vec3 color) {\r\n    #ifdef VOX_GAMMA_CORRECTION\r\n\t    return pow(color, vec3Gamma);\r\n    #else\r\n        return color;\r\n    #endif\r\n}\r\nvec3 linearToGamma(vec3 color) { \r\n    #ifdef VOX_GAMMA_CORRECTION\r\n\t    return pow(color, vec3ReciprocalGamma); \r\n    #else\r\n        return color;\r\n    #endif\r\n}\r\nvec4 gammaToLinear(vec4 color) {\r\n    #ifdef VOX_GAMMA_CORRECTION\r\n        return vec4(pow(color.rgb, vec3Gamma), color.a);\r\n    #else\r\n        return color;\r\n    #endif\r\n}\r\n\r\nvec4 linearToGamma(vec4 color) {\r\n    #ifdef VOX_GAMMA_CORRECTION\r\n        return vec4(pow(color.rgb, vec3ReciprocalGamma), color.a);\r\n    #else\r\n        return color;\r\n    #endif\r\n}\r\n\r\nvec3 approximationSRGBToLinear(vec3 srgbColor) {\r\n    return pow(srgbColor, vec3Gamma);\r\n}\r\nvec3 approximationLinearToSRCB(vec3 linearColor) {\r\n    return pow(linearColor, vec3(1.0/2.2));\r\n}\r\nvec3 accurateSRGBToLinear(vec3 srgbColor) {\r\n    vec3 linearRGBLo = srgbColor / 12.92;\r\n    vec3 linearRGBHi = pow((srgbColor + vec3(0.055)) / vec3(1.055), vec3(2.4));\r\n    //vec3 linearRGB = (srgbColor <= 0.04045) ? linearRGBLo : linearRGBHi;\r\n    vec3 linearRGB = all(lessThanEqual(srgbColor, vec3(0.04045))) ? linearRGBLo : linearRGBHi;\r\n\r\n    return linearRGB;\r\n}\r\nvec3 accurateLinearToSRGB(vec3 linearColor) {\r\n    vec3 srgbLo = linearColor * 12.92;\r\n    vec3 srgbHi = (pow(abs(linearColor), vec3(1.0 / 2.4)) * 1.055) - 0.055;\r\n    vec3 srgb = all(lessThanEqual(linearColor, vec3(0.0031308))) ? srgbLo : srgbHi;\r\n\r\n    return srgb;\r\n}\r\n\r\n// Trowbridge-Reitz(Generalized-Trowbridge-ReitzGTR)\r\n\r\nfloat DistributionGTR1(float NdotH, float roughness) {\r\n    if (roughness >= 1.0) return 1.0/PI;\r\n    float a2 = roughness * roughness;\r\n    float t = 1.0 + (a2 - 1.0)*NdotH*NdotH;\r\n    return (a2 - 1.0) / (PI * log(a2) *t);\r\n}\r\nfloat distributionGTR2(float NdotH, float roughness) {\r\n    float a2 = roughness * roughness;\r\n    float t = 1.0 + (a2 - 1.0) * NdotH * NdotH;\r\n    return a2 / (PI * t * t);\r\n}\r\n\r\nfloat distributionGGX(vec3 N, vec3 H, float roughness) {\r\n    float a = roughness*roughness;\r\n    float a2 = a*a;\r\n    float NdotH = max(dot(N, H), 0.0);\r\n    float NdotH2 = NdotH*NdotH;\r\n\r\n    float nom   = a2;\r\n    float denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    denom = PI * denom * denom;\r\n\r\n    return nom / max(denom, 0.0000001); // prevent divide by zero for roughness=0.0 and NdotH=1.0\r\n}\r\n\r\n\r\nfloat geometryImplicit(float NdotV, float dotNL) {\r\n    return dotNL * NdotV;\r\n}\r\n\r\n// ----------------------------------------------------------------------------\r\nfloat geometrySchlickGGX(float NdotV, float roughness)\r\n{\r\n    float r = (roughness + 1.0);\r\n    float k = (r*r) / 8.0;\r\n\r\n    float nom   = NdotV;\r\n    float denom = NdotV * (1.0 - k) + k;\r\n\r\n    return nom / denom;\r\n}\r\n// ----------------------------------------------------------------------------\r\nfloat geometrySmith(vec3 N, vec3 V, vec3 L, float roughness) {\r\n    float NdotV = max(dot(N, V), 0.0);\r\n    float dotNL = max(dot(N, L), 0.0); \r\n    float ggx2 = geometrySchlickGGX(NdotV, roughness);\r\n    float ggx1 = geometrySchlickGGX(dotNL, roughness);\r\n\r\n    return ggx1 * ggx2;\r\n}\r\n// ----------------------------------------------------------------------------\r\n// @param cosTheta is clamp(dot(H, V), 0.0, 1.0)\r\nvec3 fresnelSchlick(float cosTheta, vec3 F0) {\r\n    return F0 + (1.0 - F0) * pow(max(1.0 - cosTheta, 0.0), 5.0);\r\n}\r\nvec3 fresnelSchlick2(vec3 specularColor, vec3 L, vec3 H) {\r\n   return specularColor + (1.0 - specularColor) * pow(1.0 - saturate(dot(L, H)), 5.0);\r\n}\r\n//fresnelSchlick2(specularColor, L, H) * ((SpecularPower + 2) / 8 ) * pow(saturate(dot(N, H)), SpecularPower) * dotNL;\r\n\r\n#define  OneOnLN2_x6 8.656171// == 1/ln(2) * 6 (6 is SpecularPower of 5 + 1)\r\n// dot: dot(N,V) or dot(H,V)\r\nvec3 fresnelSchlick3(vec3 specularColor, float dot, float glossiness) {\r\n\treturn specularColor + (max(vec3(glossiness), specularColor) - specularColor) * exp2(-OneOnLN2_x6 * dot); \r\n}\r\nvec3 fresnelSchlickWithRoughness(vec3 specularColor, vec3 L, vec3 N, float gloss) {\r\n   return specularColor + (max(vec3(gloss), specularColor) - specularColor) * pow(1.0 - saturate(dot(L, N)), 5.0);\r\n}\r\n\r\n//float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\r\n//float dotNV = saturate( dot( normal, viewDir ) );\r\n//specular *= computeSpecularOcclusion( dotNV, ambientOcclusion, specularRoughness );\r\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\r\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\r\n\r\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\r\n\r\n}\r\n\r\nvec3 acesToneMapping(vec3 color, float adapted_lum) {\r\n\tconst float A = 2.51;\r\n\tconst float B = 0.03;\r\n\tconst float C = 2.43;\r\n\tconst float D = 0.59;\r\n\tconst float E = 0.14;\r\n\r\n\tcolor *= adapted_lum;\r\n\treturn (color * (A * color + B)) / (color * (C * color + D) + E);\r\n}\r\n\r\n//color = color / (color + vec3One);\r\nvec3 reinhard(vec3 v) {\r\n    return v / (vec3One + v);\r\n}\r\nvec3 reinhard_extended(vec3 v, float max_white) {\r\n    vec3 numerator = v * (1.0 + (v / vec3(max_white * max_white)));\r\n    return numerator / (1.0 + v);\r\n}\r\nfloat luminance(vec3 v) {\r\n    return dot(v, vec3(0.2126, 0.7152, 0.0722));\r\n}\r\n\r\nvec3 change_luminance(vec3 c_in, float l_out) {\r\n    float l_in = luminance(c_in);\r\n    return c_in * (l_out / l_in);\r\n}\r\nvec3 reinhard_extended_luminance(vec3 v, float max_white_l) {\r\n    float l_old = luminance(v);\r\n    float numerator = l_old * (1.0 + (l_old / (max_white_l * max_white_l)));\r\n    float l_new = numerator / (1.0 + l_old);\r\n    return change_luminance(v, l_new);\r\n}\r\nvec3 tonemapReinhard(vec3 color, float exposure) {\r\n  vec3 c = color * exposure;\r\n  return c / (1.0 + c);\r\n}\r\nvec3 reinhardToneMapping( vec3 color, float toneMappingExposure ) {\r\n\r\n\tcolor *= toneMappingExposure;\r\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\r\n\r\n}\r\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\r\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\r\nhighp float randUV( const in vec2 uv ) {\r\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\r\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\r\n\treturn fract(sin(sn) * c);\r\n}\r\n// based on https://www.shadertoy.com/view/MslGR8\r\nvec3 dithering( vec3 color ) {\r\n    //Calculate grid position\r\n    float grid_position = randUV( gl_FragCoord.xy );\r\n\r\n    //Shift the individual colors differently, thus making it even harder to see the dithering pattern\r\n    vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\r\n\r\n    //modify shift acording to grid position.\r\n    dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\r\n\r\n    //shift the color by dither_shift\r\n    return color + dither_shift_RGB;\r\n}\r\nvec3 rotateY(vec3 dir, float radian)\r\n{\r\n\tvec3 result;\r\n\tresult.x = cos(radian) * dir.x - sin(radian) * dir.z;\r\n\tresult.y = dir.y;\r\n\tresult.z = sin(radian) * dir.x + cos(radian) * dir.z;\r\n\treturn result;\r\n}\r\n\r\nvec3 getWorldEnvDir(float rotateAngle, vec3 worldNormal,vec3 worldInvE)\r\n{\r\n\tvec3 worldR = reflect(worldInvE, worldNormal);\r\n    worldR.zy *= vec2(-1.0);\r\n\treturn rotateY(worldR, rotateAngle);\r\n}\r\nvec3 getWorldEnvDir(vec3 worldNormal,vec3 worldInvE)\r\n{\r\n\tvec3 worldR = reflect(worldInvE, worldNormal);\r\n    worldR.zy *= vec2(-1.0);\r\n    return worldR;\r\n}\r\nfloat FD_Schlick(float VoH, float f0, float f90) \r\n{\r\n\treturn f0 + (f90 - f0) * pow(1.0 - VoH, 5.0);\r\n}\r\nvec3 FD_Schlick(const in vec3 specularColor, const in float dotLH) {\r\n\r\n\t// Original approximation by Christophe Schlick '94\r\n\t//float fresnel = pow( 1.0 - dotLH, 5.0 );\r\n\t// Optimized variant (presented by Epic at SIGGRAPH '13)\r\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\r\n\r\n\tfloat fresnel = exp2((-5.55473 * dotLH - 6.98316) * dotLH);\r\n\treturn (vec3One - specularColor) * fresnel + specularColor;\r\n}\r\nvec3 fixSeams(vec3 vec, float mipmapIndex, float cubeTexsize) {\r\n    float scale = 1.0 - exp2(mipmapIndex) / cubeTexsize;\r\n    float M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\r\n    if (abs(vec.x) != M) vec.x *= scale;\r\n    if (abs(vec.y) != M) vec.y *= scale;\r\n    if (abs(vec.z) != M) vec.z *= scale;\r\n    return vec;\r\n}\r\n\r\nvec3 fixSeams(vec3 vec, float cubeTexsize ) {\r\n    float scale = 1.0 - 1.0 / cubeTexsize;\r\n    float M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\r\n    if (abs(vec.x) != M) vec.x *= scale;\r\n    if (abs(vec.y) != M) vec.y *= scale;\r\n    if (abs(vec.z) != M) vec.z *= scale;\r\n    return vec;\r\n}\r\n#ifdef VOX_WOOL\r\n\tfloat FD_Burley(float linearRoughness, float NoV, float NoL, float LoH)\r\n\t{\r\n\t\tfloat f90 = 0.5 + 2.0 * linearRoughness * LoH * LoH;\r\n\t\tfloat lightScatter = FD_Schlick(NoL, 1.0, f90);\r\n\t\tfloat viewScatter = FD_Schlick(NoV, 1.0, f90);\r\n\t\treturn lightScatter * viewScatter;\r\n\t}\r\n\tfloat getColorFactorIntensity(float NoV, float frontScale, float sideScale)\r\n\t{\r\n\t\tfloat invNoV = 1.0 - NoV;\r\n\t\tfloat x2 = invNoV * invNoV;\r\n\t\tfloat x3 = x2 * invNoV;\r\n\t\tfloat x4 = x3 * invNoV;\r\n\t\tfloat x5 = x4 * invNoV;\r\n\t\tfloat k = clamp(-10.15 * x5 + 20.189 * x4 - 12.811 * x3 + 4.0585 * x2 - 0.2931 * invNoV, 0.0, 1.0);\r\n\t\tfloat sideFactorIntensity = mix(frontScale, sideScale, k);\r\n\t\treturn sideFactorIntensity;\r\n\t}\r\n#else\r\n\tfloat FD_Burley(float linearRoughness, float NoV, float NoL, float LoH, float frontScale, float sideScale)\r\n\t{\r\n\t\tfloat f90 = 0.5 + 2.0 * linearRoughness * LoH * LoH;\r\n\t\tfloat lightScatter = FD_Schlick(NoL, 1.0, f90);\r\n\t\tfloat viewScatter = FD_Schlick(NoV, frontScale, sideScale * f90);\r\n\t\treturn lightScatter * viewScatter;\r\n\t}\r\n#endif\r\n\r\nstruct RadianceLight {\r\n\tvec3 diffuse;\r\n\tvec3 specular;\r\n    vec3 scatterIntensity;\r\n    vec3 F0;\r\n    vec3 N;\r\n    vec3 V;\r\n    vec3 L;\r\n    vec3 specularColor;\r\n\r\n    float dotNV;\r\n    float frontIntensity;\r\n    float sideIntensity;\r\n    float specularPower;\r\n};\r\n#ifdef VOX_PARALLAX_MAP\r\nmat3 getBTNMat3(in vec2 texUV, in vec3 pos, in vec3 nv)\r\n{\r\n    vec3 Q1  = dFdx(pos);\r\n    vec3 Q2  = dFdy(pos);\r\n    vec2 st1 = dFdx(texUV);\r\n    vec2 st2 = dFdy(texUV);\r\n\r\n    vec3 N  = normalize(nv);\r\n    vec3 T  = normalize(Q1*st2.t - Q2*st1.t);    \r\n    vec3 B  = -normalize(cross(N, T));\r\n    return mat3(T, B, N);\r\n}\r\n//example: const vec4 occParam = vec4(1.0,10.0,2.0,0.1);\r\nvec2 parallaxOccRayMarchDepth(sampler2D texSampler, vec2 puvs, vec3 viewDir,vec4 occParam)\r\n{\r\n    float depthValue = 1.0 - VOX_Texture2D(texSampler, puvs).r;\r\n    float numLayers = mix(occParam.x, occParam.y, max(dot(vec3(0.0, 0.0, 1.0), viewDir),0.0));\r\n    float layerHeight = occParam.z / numLayers;\r\n    vec2 tuv = (viewDir.xy * occParam.w) / numLayers;  \r\n    float ph = 0.0;\r\n    #ifndef VOX_GLSL_ES2\r\n        while(ph < depthValue)\r\n        {\r\n            puvs -= tuv;\r\n            depthValue = 1.0 - VOX_Texture2D(texSampler, puvs).r;\r\n            ph += layerHeight;\r\n        }\r\n    #else\r\n        for(int i = 0; i < 10; i++) {\r\n            if(ph < depthValue)\r\n            {\r\n                puvs -= tuv;\r\n                depthValue = 1.0 - VOX_Texture2D(texSampler, puvs).r;\r\n                ph += layerHeight;\r\n            }\r\n            else {\r\n                break;\r\n            }\r\n        }\r\n    #endif\r\n    tuv += puvs;\r\n    depthValue -= ph;\r\n    ph = 1.0 - VOX_Texture2D(texSampler, tuv).r - ph + layerHeight;\r\n    float weight = depthValue / (depthValue - ph);\r\n    //return puvs * (1.0 - weight) + tuv * weight;\r\n    return mix(puvs, tuv, weight);\r\n}\r\n#endif\r\n#if VOX_LIGHTS_TOTAL > 0\r\nvoid calcPBRLight(float roughness, vec3 rm, in vec3 inColor, inout RadianceLight rL) {\r\n    // rm is remainder metallic: vec3(1.0 - metallic)\r\n\r\n    vec3 H = normalize(rL.V + rL.L);\r\n\r\n    // scale light by dotNL\r\n    float dotNL = max(dot(rL.N, rL.L), 0.0);\r\n    float dotLH = max(dot(rL.L, H), 0.0);\r\n    float dotNH = max(dot(rL.N, H), 0.0);\r\n\r\n    // Cook-Torrance BRDF\r\n    float NDF = distributionGGX(rL.N, H, roughness);\r\n    float G   = geometrySmith(rL.N, rL.V, rL.L, roughness);\r\n    //vec3 F    = fresnelSchlick(clamp(dot(H, rL.V), 0.0, 1.0), rL.F0);\r\n    //vec3 F    = fresnelSchlick3(rL.F0,clamp(dot(H, V), 0.0, 1.0), roughness);\r\n    vec3 F    = fresnelSchlick3(rL.F0, rL.dotNV, roughness);\r\n    \r\n    vec3 nominator    = NDF * G * F;\r\n    float denominator = 4.0 * rL.dotNV * dotNL;\r\n    vec3 specular = nominator / max(denominator, 0.001); // prevent divide by zero for NdotV=0.0 or dotNL=0.0\r\n    \r\n    vec3 kD = (vec3One - F ) * rm;\r\n\r\n    #ifdef VOX_WOOL\r\n        float fdBurley = FD_Burley(roughness, rL.dotNV, dotNL, dotLH);\r\n    #else\r\n        float fdBurley = FD_Burley(roughness, rL.dotNV, dotNL, dotLH, rL.frontIntensity, rL.sideIntensity);\r\n    #endif\r\n    #ifdef VOX_SCATTER\r\n        vec3 specularScatter = rL.scatterIntensity * fresnelSchlick3(rL.specularColor, dotLH, 1.0) * ((rL.specularPower + 2.0) * 0.125) * pow(dotNH, rL.specularPower);\r\n    #else\r\n        vec3 specularScatter = vec3One;\r\n    #endif\r\n    \r\n    // add to outgoing radiance Lo\r\n    inColor *= dotNL;\r\n\r\n    #ifdef VOX_SPECULAR_BLEED\r\n        kD *= specularScatter;\r\n    #endif\r\n    rL.diffuse += fdBurley * inColor * kD;\r\n    rL.specular += specular * inColor * specularScatter;\r\n\r\n}\r\n#endif\r\nconst vec2 noise2 = vec2(12.9898,78.233);\r\nconst vec3 noise3 = vec3(12.9898,78.233,158.5453);\r\nvec2 rand(vec2 seed) {\r\n\r\n    float noiseX = (fract(sin(dot(seed, noise2)) * 43758.5453));\r\n    float noiseY = (fract(sin(dot(seed, noise2 * 2.0)) * 43758.5453));\r\n    return vec2(noiseX,noiseY);\r\n}\r\nvec3 rand(vec3 seed) {\r\n    float scale = 1.0;\r\n    float scale2 = 43758.54;\r\n    float noiseX = (fract(sin(scale * dot(seed, noise3)) * scale2));\r\n    float noiseY = (fract(sin(scale * dot(seed, noise3 * 2.0)) * scale2));\r\n    float noiseZ = (fract(sin(scale * dot(seed, noise3 * 3.0)) * scale2));\r\n    return vec3(noiseX, noiseY, noiseZ);\r\n}\r\n#ifdef VOX_NORMAL_MAP\r\nvec3 getNormalFromMap(sampler2D texSampler, vec2 texUV, vec3 wpos, vec3 nv)\r\n{\r\n    vec3 tangentNormal = VOX_Texture2D(texSampler, texUV).xyz * 2.0 - 1.0;\r\n\r\n    vec3 Q1  = dFdx(wpos);\r\n    vec3 Q2  = dFdy(wpos);\r\n    vec2 st1 = dFdx(texUV);\r\n    vec2 st2 = dFdy(texUV);\r\n\r\n    vec3 N   = normalize(nv);\r\n    vec3 T  = normalize(Q1*st2.t - Q2*st1.t);    \r\n    vec3 B  = -normalize(cross(N, T));\r\n    mat3 TBN = mat3(T, B, N);\r\n\r\n    return TBN * tangentNormal;\r\n}\r\nvec3 getNormalFromMap(in sampler2D texSampler, in vec2 texUV)\r\n{\r\n    return VOX_Texture2D(texSampler, texUV).xyz * 2.0 - 1.0;\r\n}\r\n#endif\r\n\r\n#ifdef VOX_HDR_BRN\r\n\r\nconst vec4 hdrBrnDecodeVec4 = vec4(255.0, 2.55, 0.0255, 0.000255);\r\nfloat rgbaToHdrBrn(in vec4 color)\r\n{\r\n    return dot(hdrBrnDecodeVec4, color);\r\n}\r\n#endif\r\n\r\n#ifdef VOX_VTX_FLAT_NORMAL\r\n\r\nvec3 getVtxFlatNormal(const in vec3 pos)\r\n{\r\n    return normalize(cross(dFdx(pos), dFdy(pos)));\r\n}\r\n#endif",a="    initLocalVtx();\r\n    \r\n    worldPosition = u_objMat * localPosition;\r\n    viewPosition = u_viewMat * worldPosition;\r\n    gl_Position = u_projMat * viewPosition;\r\n\r\n\r\n    #ifdef VOX_DISPLACEMENT_MAP\r\n        oWorldPosition = (u_objMat * vec4(a_vs.xyz, 1.0));\r\n    #else\r\n        oWorldPosition = worldPosition;\r\n    #endif\r\n    v_worldPosition.xyz = oWorldPosition.xyz;\r\n    \r\n    #ifndef VOX_VTX_FLAT_NORMAL\r\n        v_worldNormal = normalize(a_nvs * inverse(mat3(u_objMat)));\r\n    \r\n        #ifdef VOX_NORMAL_NOISE\r\n    \r\n            v_worldNormal += (rand(a_nvs)) * 0.1;\r\n    \r\n        #endif\r\n    #endif\r\n",n="// const vec4 zeroPosition = vec4(0.0,0.0,0.0, 1.0);\r\n\r\n#ifdef VOX_DISPLACEMENT_MAP\r\nvoid displaceLocalVtx(in vec2 param) {    \r\n    float dispFactor = VOX_Texture2D(VOX_DISPLACEMENT_MAP, v_uv.xy).x;\r\n    localPosition.xyz += normalize( a_nvs ) * vec3( dispFactor * param.x + param.y );\r\n}\r\n#endif\r\n\r\nconst vec2 noise2 = vec2(12.9898,78.233);\r\nconst vec3 noise3 = vec3(12.9898,78.233,158.5453);\r\nvec2 rand(vec2 seed) {\r\n\r\n  float noiseX = (fract(sin(dot(seed, noise2)) * 43758.5453));\r\n  float noiseY = (fract(sin(dot(seed, noise2 * 2.0)) * 43758.5453));\r\n  return vec2(noiseX,noiseY);\r\n}\r\nvec3 rand(vec3 seed) {\r\n  float noiseX = (fract(sin(dot(seed, noise3)) * 43758.5453));\r\n  float noiseY = (fract(sin(dot(seed, noise3 * 2.0)) * 43758.5453));\r\n  float noiseZ = (fract(sin(dot(seed, noise3 * 3.0)) * 43758.5453));\r\n  return vec3(noiseX, noiseY, noiseZ);\r\n}\r\n\r\nvoid initLocalVtx() {\r\n    localPosition = vec4(a_vs.xyz, 1.0);\r\n    int paramIndex = 0;\r\n    // vertex transform calculation\r\n    #ifdef VOX_VTX_CURVE_MOVE_PARAM_INDEX\r\n        vec4 params = u_vertLocalParams[VOX_VTX_CURVE_MOVE_PARAM_INDEX];\r\n        float index = abs(mod((a_vs.w + params[1]),params[2]));\r\n        index *= params[0];\r\n        vec2 puv = vec2(fract(index), floor(index) * params[0]);\r\n        localPosition.xyz += VOX_Texture2D(VTX_CURVE_MOVE_MAP, puv).xyz;\r\n    #endif\r\n    #ifdef VOX_USE_2D_MAP\r\n        #ifdef VOX_VTX_TRANSFORM_PARAM_INDEX\r\n            paramIndex = VOX_VTX_TRANSFORM_PARAM_INDEX;\r\n            v_uv = a_uvs.xy * u_vertLocalParams[paramIndex].xy + u_vertLocalParams[paramIndex].zw;\r\n        #else\r\n            v_uv = a_uvs.xy;\r\n        #endif\r\n    #endif\r\n\r\n    #ifdef VOX_DISPLACEMENT_MAP\r\n        displaceLocalVtx( u_vertLocalParams[VOX_DISPLACEMENT_PARAMS_INDEX].xy );\r\n    #endif\r\n}";const l={vert:"",vert_head:n,vert_body:a,frag:"",frag_head:r,frag_body:i,uuid:"pbr"}},"2be0":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uuid="BinaryLoader"}async load(t,e,s=""){const i=new FileReader;i.onload=t=>{e.loaded(i.result,this.uuid)};const r=new XMLHttpRequest;r.open("GET",t,!0),""!=s&&r.setRequestHeader("Range",s),r.responseType="blob",r.onload=t=>{r.status<=206?i.readAsArrayBuffer(r.response):e.loadError(r.status,this.uuid)},r.onerror=t=>{e.loadError(r.status,this.uuid)},r.send()}}e.default=i},"2be1":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.A_J=0,this.A_I=[],this.A_Q=[],this.f_=[]}createNode(){return null}restoreUid(t){}getFreeId(){return this.f_.length>0?this.f_.pop():-1}getNodeByUid(t){return this.A_I[t]}create(){let t=null,e=this.getFreeId();return e>=0?(t=this.A_I[e],t.uid=e,this.A_Q[e]=i.S_BUSY):(t=this.createNode(),this.A_I.push(t),this.A_Q.push(i.S_BUSY),t.uid=this.A_J,this.A_J++),t}restore(t){return null!=t&&t.uid>=0&&this.A_Q[t.uid]==i.S_BUSY&&(this.restoreUid(t.uid),this.f_.push(t.uid),this.A_Q[t.uid]=i.S_FREE,t.reset(),!0)}restoreByUid(t){return t>=0&&t<this.A_J&&this.A_Q[t]==i.S_BUSY&&(this.restoreUid(t),this.f_.push(t),this.A_Q[t]=i.S_FREE,this.A_I[t].reset(),!0)}}i.S_BUSY=1,i.S_FREE=0,e.default=i},"2e8a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("644c"));class n{constructor(){this.type=-1,this.attriType=-1,this.typeSize=3,this.typeName="",this.name="",this.layoutEnabled=!0}parseCode(t){const e=";",s=" ";t=t.replace(/^\s*|\s*$/g,"");let i=t.indexOf(e);i>0&&(t=t.slice(0,i));let n=t.split(s);this.typeName=n[n.length-2],this.name=n[n.length-1],this.type=a.default.GetTypeByTypeNS(this.typeName),this.typeSize=parseInt(this.typeName.slice(this.typeName.length-1)),this.attriType=r.default.GetVBufAttributeTypeByNS(this.name)}}e.default=n},"2fe8":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("29ef")),a=i(s("402a")),n=i(s("0c54")),l=i(s("efce")),h=i(s("725b"));class o extends a.default{constructor(t=!0){super(),this.A_R=!0,this.A_S=null,this.A_T=null,this.A_U="",this.A_V=.5,this.A_W=.5,this.flipVerticalUV=!1,this.fontSystem=null,this.A_R=t}getWidth(){return null!=this.A_T?this.A_T.getWidth():0}getHeight(){return null!=this.A_T?this.A_T.getHeight():0}setAlignFactor(t,e){this.A_V=t,this.A_W=e,null!=this.A_T&&this.A_T.updateCharStr(this.A_U)}alignLeftTop(){this.setAlignFactor(0,0)}alignCenter(){this.setAlignFactor(.5,.5)}alignLeftCenter(){this.setAlignFactor(0,.5)}setText(t){null!=this.A_T&&(this.A_U=t,this.A_T.alignFactorX=this.A_V,this.A_T.alignFactorY=this.A_W,this.A_T.updateCharStr(t),this.update())}setRGBA4f(t,e,s,i){null!=this.A_S&&this.A_S.setRGBA4f(t,e,s,i)}setRGB3f(t,e,s){null!=this.A_S&&this.A_S.setRGB3f(t,e,s)}setAlpha(t){this.A_S.setAlpha(t)}getAlpha(){return this.A_S.getAlpha()}setBrightness(t){this.A_S.setBrightness(t)}getBrightness(){return this.A_S.getBrightness()}getRotationZ(){return this.A_S.getRotationZ()}setRotationZ(t){this.A_S.setRotationZ(t)}getScaleX(){return this.A_S.getScaleX()}getScaleY(){return this.A_S.getScaleY()}setScaleX(t){this.A_S.setScaleX(t)}setScaleY(t){this.A_S.setScaleY(t)}setScaleXY(t,e){this.A_S.setScaleXY(t,e)}createMaterial(t){null==this.getMaterial()?(this.A_S=new n.default,this.A_S.setTextureList(t),this.setMaterial(this.A_S)):this.A_S.setTextureList(t)}initialize(t,e=null){if(this.A_U=t,null==e){let t=null!=this.fontSystem?this.fontSystem.getTextureAt(0):h.default.GetInstance().getTextureAt(0);this.createMaterial([t])}else this.createMaterial(e);this.activeDisplay(),this.setRenderState(r.default.BACK_TRANSPARENT_STATE)}createBounds(){}__activeMesh(t){if(null==this.getMesh()){let e=new l.default;e.fontSystem=this.fontSystem,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.alignFactorX=this.A_V,e.alignFactorY=this.A_W,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.A_U),this.setMesh(e),this.A_T=e}}update(){null!=this.A_Y&&(this.A_R&&this.A_X.isGeomDynamic()&&this.setIvsParam(0,this.A_X.vtCount),this.A_Y.update())}destroy(){super.destroy(),this.fontSystem=null}}e.default=o},3024:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3077"));class a extends r.default{constructor(t){super(),this.A_Z=null,this.A_a=1,t<1&&(t=1),this.A_a=t,this.A_Z=new Float32Array(4*t)}bindSlotAt(t){super.bindSlotAt(t),this.addVec4Data(this.A_Z,this.A_a)}destroy(){super.destroy(),this.A_Z=null}}e.default=a},3077:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("644c")),a=i(s("5326"));class n{constructor(){this.b=n.F_0++,this.m=null,this.A_b=null,this.A_c=0,this.A_d=-1,this.rst=-1,this.uniformsTotal=0,this.uniformTypes=null,this.dataSizeList=null}getUid(){return this.b}getSlotBeginIndex(){return this.A_d}getSlotUid(){return this.m.getUid()}getFS32At(t){return this.A_b[t]}setFS32At(t,e){this.A_b[e]=t}setVec4DataAt(t,e,s,i,r){let a=this.A_b[t];a[0]=e,a[1]=s,a[2]=i,a[3]=r}setVec4Data(t,e,s,i){let r=this.A_b[0];r[0]=t,r[1]=e,r[2]=s,r[3]=i}setVec4DataAtWithArr4(t,e){this.A_b[t].set(e,0)}setVec4DataWithArr4(t){this.A_b[0].set(t,0)}addVec4Data(t,e){t.length,this.A_b.push(t),this.uniformTypes.push(r.default.SHADER_VEC4),this.dataSizeList.push(e),this.m.dataList[this.A_c]=t,this.A_c++,this.uniformsTotal++,this.m.index++}addMat4Data(t,e){this.A_b.push(t),this.uniformTypes.push(r.default.SHADER_MAT4),this.dataSizeList.push(e),this.m.dataList[this.A_c]=t,this.A_c++,this.uniformsTotal++,this.m.index++}isEnabled(){return this.rst>=0}bindSlotAt(t){let e=a.default.GetSlotAt(t);this.rst>=0&&this.reset(),null==this.A_b&&(this.A_b=[],this.uniformTypes=[],this.dataSizeList=[]),this.m=e,this.rst=1,this.A_d=e.index,this.A_c=e.index}update(){if(this.rst++,this.uniformsTotal<2)this.m.flagList[this.A_d]=this.rst;else for(let t=this.A_d;t<=this.A_c;++t)this.m.flagList[t]=this.rst}reset(){this.rst=-1,this.A_d=-1,this.uniformsTotal=0,this.A_c=0,null!=this.A_b&&(this.A_b=null,this.uniformTypes=null,this.dataSizeList=null),this.m=null}destroy(){this.reset()}}n.F_0=0,e.default=n},3113:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("839a"),a=s("a9f4"),n=i(s("ab73"));class l{constructor(){this.A_e=null,this.A_f="",this.A_g=new Uint16Array(128),this.A_h=16,this.A_i=!1}__$setCodeBuilder(t){this.A_e=t}getUniqueNSKeyID(){if(this.A_i){let t=31;for(let e=0;e<this.A_h;++e)t=131*t+this.A_g[e];return t}return 0}getUniqueNSKeyString(){if(this.A_i){this.A_f="["+this.A_g[0];for(let t=1;t<this.A_h;++t)this.A_f+=""+this.A_g[t];return this.A_f+="]",this.A_f}return""}reset(){if(this.A_i){for(let t=0;t<this.A_h;++t)this.A_g[t]=0;this.A_i=!1}}useCameraPosition(t=!1,e=!0){t&&this.A_e.addVertUniformParam(n.default.CameraPosParam),e&&this.A_e.addFragUniformParam(n.default.CameraPosParam)}useViewPort(t=!1,e=!0){t&&this.A_e.addVertUniformParam(n.default.ViewportParam),e&&this.A_e.addFragUniformParam(n.default.ViewportParam)}useFrustum(t=!1,e=!0){t&&this.A_e.addVertUniformParam(n.default.FrustumParam),e&&this.A_e.addFragUniformParam(n.default.FrustumParam)}useStage(t,e){t&&this.A_e.addVertUniformParam(n.default.StageParam),e&&this.A_e.addFragUniformParam(n.default.StageParam)}addDiffuseMap(){this.A_e.addTextureSample2D("VOX_DIFFUSE_MAP",!0,!0,!1),this.A_g[0]=1,this.A_i=!0}addNormalMap(){this.A_e.addTextureSample2D("VOX_NORMAL_MAP",!0,!0,!1),this.A_e.normalMapEnabled=!0,this.A_g[1]=1,this.A_i=!0}addParallaxMap(t){this.A_e.addTextureSample2D("VOX_PARALLAX_MAP",!0,!0,!1),t>=0?(this.A_e.addDefine("VOX_PARALLAX_PARAMS_INDEX",""+t),this.A_g[2]=1+(t<<1)):this.A_g[2]=1,this.A_i=!0}addDisplacementMap(t){this.A_e.addTextureSample2D("VOX_DISPLACEMENT_MAP",!0,!1,!0),t>=0?(this.A_e.addDefine("VOX_DISPLACEMENT_PARAMS_INDEX",""+t),this.A_g[3]=1+(t<<1)):this.A_g[3]=1,this.A_i=!0}addSpecularMap(t=r.SpecularMode.Default){this.A_e.addTextureSample2D("VOX_SPECULAR_MAP",!0,!0,!1),this.A_e.addDefine("VOX_SPECULAR_MODE",""+t),this.A_g[5]=1+(t<<1),this.A_i=!0}addShadowMap(t=a.ShadowMode.VSM){this.A_e.addTextureSample2D("VOX_VSM_SHADOW_MAP",!1,!0,!1),this.A_g[6]=1+(t<<1),this.A_i=!0}addFogColorMap(){this.A_e.addTextureSample2D("VOX_FOG_COLOR_MAP",!0,!0,!1),this.A_g[7]=1,this.A_i=!0}addspecularEnvMap(t=!0){t?this.A_e.addTextureSampleCube("VOX_ENV_MAP",!0,!1):this.A_e.addTextureSample2D("VOX_ENV_MAP",!0,!0,!1),this.A_g[8]=1,this.A_i=!0}addAOMap(){this.A_e.addTextureSample2D("VOX_AO_MAP",!0,!0,!1),this.A_g[4]=1,this.A_i=!0}addRoughnessMap(){this.A_e.addTextureSample2D("VOX_ROUGHNESS_MAP",!0,!0,!1),this.A_g[9]=1,this.A_i=!0}addMetalnessMap(){this.A_e.addTextureSample2D("VOX_METALNESS_MAP",!0,!0,!1),this.A_g[10]=1,this.A_i=!0}addARMMap(){this.A_e.addTextureSample2D("VOX_ARM_MAP",!0,!0,!1),this.A_g[11]=1,this.A_i=!0}add2DMap(t="",e=!0,s=!0,i=!1){this.A_e.addTextureSample2D(t,e,s,i)}addCubeMap(t="",e=!0,s=!1){this.A_e.addTextureSampleCube(t,e,s)}add3DMap(t="",e=!0,s=!1){this.A_e.addTextureSample3D(t,e,s)}}e.ShaderCodeUniform=l},"319d":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("f3a2"),a=i(s("faa5")),n=s("839a");class l extends a.default{constructor(){super(),this.j_="",this.colorEnabled=!0,this.specularMode=n.SpecularMode.Default,this.fragLocalParamsTotal=2,this.lightParamsIndex=2,this.normalEnabled=!0,this.buildFlag=!0,this.diffuseMap2Matrix=!0,this.vertColorEnabled=!1,this.vertUniform=null}reset(){super.reset(),this.A_j.normalEnabled=!0,this.A_j.vertMatrixInverseEnabled=!0,this.AE=[],this.j_="LambertShd"}addDiffuseMap(t){null!=t&&(this.AE.push(t),this.buildFlag&&this.A_k.addDiffuseMap())}addDiffuseMap2(t){null!=t&&(this.AE.push(t),this.buildFlag&&(this.diffuseMap2Matrix&&(this.A_j.addDefine("VOX_USE_DIFFUSEMAP2_MAT"),this.A_j.addVarying("vec4","v_map2Pos"),this.A_j.addVertUniform("mat4","u_map2ViewMat"),this.A_j.addUniqueNSKeyString("M2VM")),this.A_k.add2DMap("VOX_DIFFUSE_MAP2",!this.diffuseMap2Matrix,!0,!1)))}addNormalMap(t){null!=t&&this.lightEnabled&&(this.AE.push(t),this.buildFlag&&this.A_k.addNormalMap())}addParallaxMap(t,e=0){null!=t&&this.lightEnabled&&(this.AE.push(t),this.buildFlag&&this.A_k.addParallaxMap(e))}addDisplacementMap(t,e=0){null!=t&&(this.AE.push(t),this.buildFlag&&this.A_k.addDisplacementMap(e))}addAOMap(t){null!=t&&(this.AE.push(t),this.buildFlag&&this.A_k.addAOMap())}addSpecularMap(t){null!=t&&this.lightEnabled&&(this.AE.push(t),this.buildFlag&&this.A_k.addSpecularMap(this.specularMode))}initialize(t){t=null!=this.AE&&this.AE.length>0,super.initialize(t),this.colorEnabled&&(this.j_+="Col"),this.j_+=this.fragLocalParamsTotal}buildShader(){null!=this.vertUniform&&this.vertUniform.use(this.A_j),this.A_j.addFragUniform("vec4","u_fragLocalParams",this.fragLocalParamsTotal),this.lightEnabled&&this.A_j.addDefine("VOX_LIGHT_LOCAL_PARAMS_INDEX",""+this.lightParamsIndex),this.vertColorEnabled&&(this.A_j.addVertLayout("vec3","a_cvs"),this.A_j.addVarying("vec3","v_cv"))}getShaderCodeObjectUUID(){return r.ShaderCodeUUID.Lambert}getUniqueShaderName(){return null!=this.vertUniform?this.j_+this.keysString+this.vertUniform.getUniqueNSKeyString():this.j_+this.keysString}toString(){return"[LambertLightShaderBuffer()]"}}e.AdvancedShaderCodeBuffer=l},3221:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.A_l=null,this.A_f=""}initialize(){}use(t){}getTextures(t,e=null){return null}reset(){}destroy(){}getUniqueNSKeyString(){return this.A_f}clone(){return null}getParams(){return this.A_l}getParamsTotal(){return null!=this.A_l?this.A_l.length>>2:0}buildShaderUniformData(t){}}e.UniformComp=i},"32fa":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("29ef")),a=i(s("725b")),n=i(s("617e")),l=i(s("3b73"));class h{constructor(){this.A_m=60,this.A_n=0,this.A_o=60,this.A_p=0}getFPS(){return this.A_m}getFPSStr(){return this.A_m>60?"60":this.A_m<10?"0"+this.A_m:""+this.A_m}updateFPS(){let t=Date.now();this.A_n>0&&(--this.A_o,this.A_o<1&&(this.A_m=Math.round(6e4/this.A_p),this.A_p=0,this.A_o=60),this.A_p+=t-this.A_n),this.A_n=t}}class o{constructor(){this.Ap=null,this.A_q=null,this.A_r=new h,this.A_s=null,this.A_t=null,this.A_m=60,this.A_u=null,this.A_v=null,this.A_w=0,this.A_x=null,this.A_y=null,this.A_z=0,this.A_0=null,this.A_1=null,this.A_2=0}initialize(t,e){if(null==this.A_q){let s=18;a.default.GetInstance().isEnabled()||(a.default.GetInstance().setRenderProxy(t.getRenderProxy()),a.default.GetInstance().initialize("fontTex",s,512,512,!1,!1)),this.A_q=t,this.Ap=e;let i=a.default.GetInstance().getFontSize()+2,r=2,h=100;l.default.IsMobileWeb()&&(h*=a.default.GetInstance().getFontSize()/s);let o=h-10,m=null;m=new n.default,m.initialize("FPS:"),m.setXY(o-m.getWidth(),r),this.A_q.addEntityToProcess(m,this.Ap),this.A_s=m;let _=m.getWidth();m=new n.default,m.__$setRenderProxy(t.getRenderProxy()),m.initialize("60"),m.setXY(h,2),this.A_q.addEntityToProcess(m,this.Ap),this.A_t=m,r+=i,m=new n.default,m.initialize("DrawCall:"),m.setXY(o-m.getWidth(),r),this.A_q.addEntityToProcess(m,this.Ap),this.A_u=m,_=m.getWidth(),m=new n.default,m.__$setRenderProxy(t.getRenderProxy()),m.initialize("00"),m.setXY(h,r),this.A_q.addEntityToProcess(m,this.Ap),this.A_v=m,r+=i,m=new n.default,m.initialize("DrawTris:"),m.setXY(o-m.getWidth(),r),this.A_q.addEntityToProcess(m,this.Ap),this.A_x=m,_=m.getWidth(),m=new n.default,m.__$setRenderProxy(t.getRenderProxy()),m.initialize("00"),m.setXY(h,r),this.A_q.addEntityToProcess(m,this.Ap),this.A_y=m,r+=i,m=new n.default,m.initialize("POV:"),m.setXY(o-m.getWidth(),r),this.A_q.addEntityToProcess(m,this.Ap),this.A_0=m,_=m.getWidth(),m=new n.default,m.__$setRenderProxy(t.getRenderProxy()),m.initialize("00"),m.setXY(h,r),this.A_q.addEntityToProcess(m,this.Ap),this.A_1=m}}getFPS(){return this.A_r.getFPS()}run(t){if(this.A_r.updateFPS(),this.A_m!=this.A_r.getFPS()&&(this.A_m=this.A_r.getFPS(),this.A_t.setText(this.A_r.getFPSStr()),this.A_t.updateMeshToGpu(),this.A_t.update()),this.A_w!=r.default.DrawCallTimes){let t=r.default.DrawCallTimes+"";this.A_w=r.default.DrawCallTimes,this.A_v.setText(t),this.A_v.updateMeshToGpu(),this.A_v.update()}if(this.A_z!=r.default.DrawTrisNumber){let t=r.default.DrawTrisNumber+"";this.A_z=r.default.DrawTrisNumber,this.A_y.setText(t),this.A_y.updateMeshToGpu(),this.A_y.update()}if(this.A_2!=r.default.POVNumber){let t=r.default.POVNumber+"";this.A_2=r.default.POVNumber,this.A_1.setText(t),this.A_1.updateMeshToGpu(),this.A_1.update()}t&&this.A_q.getRenderProxy().setViewPort(0,0,this.A_q.getViewWidth(),this.A_q.getViewHeight())}toString(){return"[RendererStatus]"}}e.default=o},"35fa":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{static ClacTriNormal(t,e,s,i){r.default.Subtract(e,t,a.GG),r.default.Subtract(s,e,a.GF),r.default.Cross(a.GG,a.GF,i),i.normalize()}static ClacTriNormalByVS(t,e,s){let i=9*e;a.GE.setTo(t[i],t[i+1],t[i+2]),s.setTo(t[i+3],t[i+4],t[i+5]),a.GF.setTo(t[i+6],t[i+7],t[i+8]),s.subtractBy(a.GE),a.GF.subtractBy(a.GE),s.crossBy(a.GF),s.normalize()}static ClacTriNormalByIVS(t,e,s,i){let r=3*e,n=3*s[r];a.GE.setTo(t[n],t[n+1],t[n+2]),n=3*s[r+1],i.setTo(t[n],t[n+1],t[n+2]),n=3*s[r+2],a.GF.setTo(t[n],t[n+1],t[n+2]),i.subtractBy(a.GE),a.GF.subtractBy(a.GE),i.crossBy(a.GF),i.normalize()}static ClacTrisNormal(t,e,s,i,n){let l=new r.default,h=0,o=0,m=0;for(m=0;m<e;++m)n[m]=0;for(m=0;m<s;++m)a.ClacTriNormalByIVS(t,m,i,l),h=3*m,o=3*i[h],n[o]+=l.x,n[o+1]+=l.y,n[o+2]+=l.z,o=3*i[h+1],n[o]+=l.x,n[o+1]+=l.y,n[o+2]+=l.z,o=3*i[h+2],n[o]+=l.x,n[o+1]+=l.y,n[o+2]+=l.z;for(m=0;m<e;m+=3)a.GE.setTo(n[m],n[m+1],n[m+2]),a.GE.normalize(),n[m]=a.GE.x,n[m+1]=a.GE.y,n[m+2]=a.GE.z}static ClacTriTangent(t,e,s,i,r,n,l){let h=3*i,o=3*r[h];a.GE.setTo(s[o],s[o+1],s[o+2]),a.GE.setTo(t[o],t[o+1],t[o+2]),o=3*r[h+1],a.GG.setTo(t[o],t[o+1],t[o+2]),o=3*r[h+2],a.GF.setTo(t[o],t[o+1],t[o+2]),o=2*r[h],a.GH.setTo(e[o],e[o+1],0),o=2*r[h+1],a.GI.setTo(e[o],e[o+1],0),o=2*r[h+2],a.GJ.setTo(e[o],e[o+1],0),a.GG.subtractBy(a.GE),a.GF.subtractBy(a.GE),a.GI.subtractBy(a.GH),a.GJ.subtractBy(a.GH);let m=1/(a.GI.x*a.GJ.y-a.GI.y*a.GJ.x);n.copyFrom(a.GG),n.scaleBy(a.GJ.y),a.GE.copyFrom(a.GF),a.GE.scaleBy(a.GI.y),n.subtractBy(a.GE),n.scaleBy(m),n.normalize(),l.copyFrom(a.GF),l.scaleBy(a.GI.x),a.GE.copyFrom(a.GG),a.GE.scaleBy(a.GJ.x),l.subtractBy(a.GE),l.scaleBy(m),l.normalize()}static ClacTrisTangent(t,e,s,i,n,l,h,o){let m=new r.default,_=new r.default,u=0,d=0,c=0;for(c=0;c<e;++c)h[c]=0,o[c]=0;for(c=0;c<n;++c)a.ClacTriTangent(t,s,i,c,l,m,_),u=3*c,d=3*l[u],h[d]=m.x,h[d+1]=m.y,h[d+2]=m.z,o[d]=_.x,o[d+1]=_.y,o[d+2]=_.z,d=3*l[u+1],h[d]=m.x,h[d+1]=m.y,h[d+2]=m.z,o[d]=_.x,o[d+1]=_.y,o[d+2]=_.z,d=3*l[u+2],h[d]=m.x,h[d+1]=m.y,h[d+2]=m.z,o[d]=_.x,o[d+1]=_.y,o[d+2]=_.z;for(c=0;c<e;c+=3)a.GH.setTo(h[c],h[c+1],h[c+2]),a.GH.normalize(),a.GG.setTo(o[c],o[c+1],o[c+2]),a.GG.normalize(),a.GF.setTo(i[c],i[c+1],i[c+2]),a.GE.copyFrom(a.GF),a.GF.scaleBy(a.GF.dot(a.GH)),a.GH.subtractBy(a.GF),a.GH.normalize(),a.GF.setTo(i[c],i[c+1],i[c+2]),a.GF.scaleBy(a.GG.dot(a.GF)),a.GG.subtractBy(a.GF),a.GG.normalize(),a.GE.crossBy(a.GH),a.GE.dot(a.GG)<0&&a.GH.scaleBy(-1),h[c]=a.GH.x,h[c+1]=a.GH.y,h[c+2]=a.GH.z,a.GG.setTo(i[c],i[c+1],i[c+2]),a.GG.crossBy(a.GH),a.GG.normalize(),o[c]=a.GG.x,o[c+1]=a.GG.y,o[c+2]=a.GG.z}}a.GE=new r.default,a.GG=new r.default,a.GF=new r.default,a.GH=new r.default,a.GI=new r.default,a.GJ=new r.default,a.GK=new r.default,e.default=a},"36cb":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("e08e"),a=i(s("ab73")),n=s("b02c"),l=i(s("4f27")),h=i(s("b30a")),o=i(s("9156")),m=s("670e");class _{constructor(){this.A_3=null,this.A_K=null,this.Ai=null,this.Ak=null,this.A_4=null,this.Au=null,this.A_5=null,this.A_6=null,this.A_7=[],this.A_8=[],this.A_9=[],this.A_=!1}initialize(t,e,s,i){null==this.A_K&&(this.Au=t,this.A_5=t.Vertex,this.A_6=t.Texture,this.A_K=new h.default(t.getRCUid(),t.getRC(),t.getRenderAdapter()),this.Ai=e,this.Ak=s,this.A_4=i,this.A_3=new n.EmptyTexRenderObj(this.A_6))}getRenderProxy(){return this.Au}getRenderShader(){return this.A_K}getTextureResource(){return this.A_6}updateTextureData(t,e){this.A_6.hasResUid(t.getResUid())&&(e?(this.A_9.push(t),this.A_=!0):t.__$updateToGpu(this.A_6))}updateDispTRO(t,e){t.__$ruid>-1&&(e?(this.A_8.push(t),this.A_=!0):this.updateTextureTRO(t))}createTRO(t,e){if(null!=t){for(let e=0;e<t.length;++e)null!=t[e]&&t[e].__$setRenderProxy(this.Au);return n.TextureRenderObj.Create(this.A_6,t,e)}return null}updateTextureTRO(t){if(null!=t.__$$runit){let e=t.getMaterial();if(null!=e){let s=this.A_6,i=t.__$$runit,r=n.TextureRenderObj.GetByMid(s.getRCUid(),e.__$troMid);if(null!=i.tro&&(null==r||i.tro.getMid()!=r.getMid())){let t=this.A_K.findShdProgramByShdData(e.getShaderData());null!=t&&(t.getTexTotal()>0?(null==r&&(r=this.createTRO(e.getTextureList(),t.getTexTotal())),i.tro!=r&&(null!=i.tro&&i.tro.__$detachThis(),i.tro=r,r.__$attachThis(),i.texMid=i.tro.getMid(),this.Ak.rejoinRunitForTro(i),e.__$troMid=i.tro.getMid())):i.tro!=this.A_3&&(null!=i.tro&&i.tro.__$detachThis(),i.tro=this.A_3,i.texMid=i.tro.getMid(),this.Ak.rejoinRunitForTro(i),e.__$troMid=i.texMid))}}}}updateDispMaterial(t,e){let s=null;if(e.__$ruid>=0){let i=this.Au,r=e.getMaterial();if(null!=r){if(null==r.getShaderData()){let t=r.getTextureList(),e=null!=t&&null!=t&&t.length>0;r.initializeByCodeBuf(e)}s=this.A_K.create(r.getShaderData()),s.upload(i.RContext,i.getUid()),t.shdUid=s.getUid();let n=null;if(s.getTexTotal()>0?(n=this.createTRO(r.getTextureList(),s.getTexTotal()),t.tro!=n&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=n,n.__$attachThis(),t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.Ak.rejoinRunitForTro(t),r.__$troMid=t.tro.getMid())):t.tro!=this.A_3&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=this.A_3,t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.Ak.rejoinRunitForTro(t),r.__$troMid=t.texMid),null==this.A_K.getSharedUniformByShd(s)){let t=this.createsharedMList(r,s);if(null!=t)for(let e=0;e<t.length;++e)t[e].program=s.getGPUProgram();this.A_K.setSharedUniformByShd(s,l.default.BuildShared(t,i,s))}let h=s.hasUniformByName(a.default.LocalTransformMatUNS);null==r.__$uniform&&(r.__$uniform=l.default.BuildLocalFromData(r.createSelfUniformData(),s)),h&&null!=e.getTransform()&&(t.transUniform=o.default.GetTransUniform(e.getTransform())),null==t.transUniform?(t.transUniform=l.default.BuildLocalFromTransformV(h?e.getMatrixFS32():null,s),o.default.SetTransUniform(e.getTransform(),t.transUniform)):t.transUniform=l.default.UpdateLocalFromTransformV(t.transUniform,h?e.getMatrixFS32():null,s),t.polygonOffset=r.getPolygonOffset(),t.uniform=r.__$uniform}}return s}updateVtxDataToGpuByUid(t,e){this.A_5.updateDataToGpu(t,e)}updateDispVbuf(t,e){if(t.__$ruid>-1)if(e)this.A_7.push(t),this.A_=!0;else{let e=t.__$$runit;if(null!=e&&e.vtxUid!=t.vbuf.getUid()){let s=e.vtxUid,i=this.A_5;i.hasResUid(s)&&i.__$detachRes(s),e.vro.__$detachThis(),this.buildVtxRes(t,e,this.A_K.findShdProgramByUid(e.shdUid)),e.__$rprouid>=0&&this.Ak.rejoinRunitForVro(e)}}}buildVtxRes(t,e,s){if(null!=t.vbuf){let i=this.A_5;e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,e.visible=t.visible,e.setVisible(t.visible),e.drawMode=t.drawMode,e.renderState=t.renderState,e.rcolorMask=t.rcolorMask,e.trisNumber=t.trisNumber;let r,a=t.vbuf.getUid(),n=!0;i.hasResUid(a)?(r=i.getVertexRes(a),n=r.version!=t.vbuf.version,n&&(i.destroyRes(a),r.rcuid=i.getRCUid(),r.resUid=a)):(r=new m.GpuVtxObject,r.rcuid=i.getRCUid(),r.resUid=a,i.addVertexRes(r)),n&&(r.indices.ibufStep=t.vbuf.getIBufStep(),r.indices.initialize(this.A_4,t.vbuf),r.vertex.initialize(this.A_4,s,t.vbuf),r.version=t.vbuf.version),i.__$attachRes(a),e.vro=r.createVRO(this.A_4,s,!0),e.indicesRes=e.vro.indicesRes,e.vro.__$attachThis(),e.vtxUid=t.vbuf.getUid(),e.ibufStep=e.vro.ibufStep,e.ibufType=4!=e.ibufStep?this.Au.UNSIGNED_SHORT:this.Au.UNSIGNED_INT}}buildGpuDisp(t){if(t.__$ruid<0&&null!=t.getMaterial()){t.__$$rsign=r.DisplayRenderSign.LIVE_IN_RENDERER;let e=this.Ai.create();if(t.__$ruid=e.uid,t.__$$runit=e,null!=t.getPartGroup()){e.partGroup=t.getPartGroup().slice(0),e.partTotal=e.partGroup.length;let s=e.partGroup;for(let t=0,i=e.partTotal;t<i;)t++,s[t++]*=e.ibufStep}return e.setDrawFlag(t.renderState,t.rcolorMask),this.buildVtxRes(t,e,this.updateDispMaterial(e,t)),!0}return!1}update(){if(this.A_){this.A_=!1;let t=this.A_7.length,e=0;if(t>0){for(;e<t;++e)this.updateDispVbuf(this.A_7[e],!1);this.A_7=[]}if(t=this.A_8.length,t>0){for(e=0;e<t;++e)this.updateTextureTRO(this.A_8[e]);this.A_8=[]}if(t=this.A_9.length,t>0){for(e=0;e<t;++e)this.A_9[e].__$updateToGpu(this.A_6);this.A_9=[]}}}createsharedMList(t,e){let s=t.createSharedUniforms();if(null==s){let i=t.createSharedUniformsData();if(null!=i&&i.length>0){s=[];for(let t=0;t<i.length;++t)if(null!=i[t]){let r=l.default.BuildLocalFromData(i[t],e);s.push(r)}s.length<1&&(s=null)}}return s}updateGlobalMaterial(t,e=!1){if(null!=t){let s=this.Au,i=null,r=null,a=null,n=!1;null==t.getShaderData()?(a=t.getTextureList(),n=null!=a&&a.length>0,t.initializeByCodeBuf(n)):a=t.getTextureList(),r=this.A_K.create(t.getShaderData()),r.upload(s.RContext,s.getUid());let h=r.getTexTotal();if(h>0&&(i=this.createTRO(a,h)),null==this.A_K.getSharedUniformByShd(r)){let e=this.createsharedMList(t,r);if(null!=e)for(let t=0;t<e.length;++t)e[t].program=r.getGPUProgram();this.A_K.setSharedUniformByShd(r,l.default.BuildShared(e,s,r))}null==t.__$uniform&&(t.__$uniform=l.default.BuildLocalFromData(t.createSelfUniformData(),r)),this.A_K.__$globalUniform=t.__$uniform,this.A_K.bindToGpu(r.getUid()),e&&null!=t.__$uniform&&this.A_K.useUniform(t.__$uniform),null!=i&&i.run()}}reset(){this.A_7=[],this.A_8=[]}}e.default=_},3806:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("a996")),a=i(s("1710")),n=i(s("7045")),l=i(s("9260")),h=i(s("3024")),o=i(s("badb"));class m{constructor(t,e){this.I=0,this.uProbe=null,this.pixelRatio=1,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.J=0,this.K=0,this.L=1,this.M=1,this.N=new o.default,this.O=[],this.P=[],this.Q=[],this.R=[],this.BA=new n.default,this.S=[],this.T=[],this.U=[],this.V=[],this.W=0,this.X=0,this.Y=new a.default,this.BB=new r.default,this.Z=!0,this.a=new r.default,this.I=t,null==m.GL&&(m.GL=e,e.onkeydown=function(t){l.default.KeyDown(t)},e.onkeyup=function(t){l.default.KeyUp(t)}),l.default.AddEventListener(n.default.KEY_DOWN,this,this.keyDown),l.default.AddEventListener(n.default.KEY_UP,this,this.keyUp)}getRCUid(){return this.I}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.J}getViewY(){return this.K}getViewWidth(){return this.L}getViewHeight(){return this.M}setViewPort(t,e,s,i){this.Z=!1,this.J=t,this.K=e,s==this.L&&i==this.M||(this.L=s,this.M=i,this.updateViewUData())}updateViewUData(){null==this.uProbe&&(this.uProbe=new h.default(1),this.uProbe.bindSlotAt(this.I)),this.uProbe.setVec4Data(2/this.stageWidth,2/this.stageHeight,this.stageWidth,this.stageHeight),this.uProbe.update(),this.W=this.L,this.X=this.M}update(){this.W==this.stageWidth&&this.X==this.stageHeight||(this.Z&&(this.L=this.stageWidth,this.M=this.stageHeight,this.updateViewUData()),this.stageHalfWidth=.5*this.stageWidth,this.stageHalfHeight=.5*this.stageHeight,this.BB.target=this,this.BB.type=r.default.RESIZE,this.BB.phase=1,this.sendResizeEvt(this.BB))}keyDown(t){this.BA.phase=1,this.BA.type=n.default.KEY_DOWN,this.BA.altKey=t.altKey,this.BA.ctrlKey=t.ctrlKey,this.BA.shiftKey=t.shiftKey,this.BA.repeat=t.repeat,this.BA.key=t.key,this.BA.keyCode=t.keyCode,this.BA.location=t.location;let e=this.S.length;for(var s=0;s<e;++s)this.S[s].call(this.T[s],this.BA)}keyUp(t){this.BA.phase=1,this.BA.type=n.default.KEY_UP,this.BA.altKey=t.altKey,this.BA.ctrlKey=t.ctrlKey,this.BA.shiftKey=t.shiftKey,this.BA.repeat=t.repeat,this.BA.key=t.key,this.BA.keyCode=t.keyCode,this.BA.location=t.location,this.BA.target=this;let e=this.U.length;for(var s=0;s<e;++s)this.U[s].call(this.V[s],this.BA)}sendResizeEvt(t){let e=this.O.length;for(var s=0;s<e;++s)this.O[s].call(this.P[s],t)}mouseDown(t=1){this.Y.type=a.default.MOUSE_DOWN,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=t,this.N.dispatchEvt(this.Y)}mouseUp(t=1){this.Y.phase=1,this.Y.type=a.default.MOUSE_UP,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=t,this.N.dispatchEvt(this.Y)}mouseClick(){this.Y.type=a.default.MOUSE_CLICK,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseDoubleClick(){this.Y.type=a.default.MOUSE_DOUBLE_CLICK,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseRightDown(t=1){this.Y.type=a.default.MOUSE_RIGHT_DOWN,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseRightUp(t=1){this.Y.type=a.default.MOUSE_RIGHT_UP,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseBgDown(){this.Y.type=a.default.MOUSE_BG_DOWN,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseBgUp(){this.Y.type=a.default.MOUSE_BG_UP,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseBgClick(){this.Y.type=a.default.MOUSE_BG_CLICK,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseRightClick(){this.Y.type=a.default.MOUSE_RIGHT_CLICK,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseMove(){this.Y.type=a.default.MOUSE_MOVE,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseWheel(t){this.Y.type=a.default.MOUSE_WHEEL,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.wheelDeltaY=t.wheelDeltaY,this.Y.target=this,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseCancel(){this.Y.type=a.default.MOUSE_CANCEL,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.N.dispatchEvt(this.Y)}mouseMultiDown(t){this.Y.type=a.default.MOUSE_MULTI_DOWN,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.Y.posArray=t,this.N.dispatchEvt(this.Y)}mouseMultiUp(t){this.Y.type=a.default.MOUSE_MULTI_UP,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.Y.posArray=t,this.N.dispatchEvt(this.Y)}mouseMultiMove(t){this.Y.type=a.default.MOUSE_MULTI_MOVE,this.Y.mouseX=this.mouseX,this.Y.mouseY=this.mouseY,this.Y.target=this,this.Y.phase=1,this.Y.posArray=t,this.N.dispatchEvt(this.Y)}mouseWindowUp(t=1){}mouseWindowRightUp(t=1){}enterFrame(){this.a.type=r.default.ENTER_FRAME;let t=this.Q.length;for(var e=0;e<t;++e)this.Q[e].call(this.R[e],this.a)}addEventListener(t,e,s,i=!0,a=!0){if(null!=s&&null!=e){let l=0;switch(t){case r.default.RESIZE:for(l=this.O.length-1;l>=0;--l)if(e===this.P[l])break;l<0&&(this.P.push(e),this.O.push(s));break;case r.default.ENTER_FRAME:for(l=this.Q.length-1;l>=0;--l)if(e===this.R[l])break;l<0&&(this.R.push(e),this.Q.push(s));break;case n.default.KEY_DOWN:for(l=this.S.length-1;l>=0;--l)if(e===this.T[l])break;l<0&&(this.T.push(e),this.S.push(s));break;case n.default.KEY_UP:for(l=this.U.length-1;l>=0;--l)if(e===this.V[l])break;l<0&&(this.V.push(e),this.U.push(s));break;default:this.N.addEventListener(t,e,s,i,a);break}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=0;switch(t){case r.default.RESIZE:for(i=this.O.length-1;i>=0;--i)if(e===this.P[i]){this.P.splice(i,1),this.O.splice(i,1);break}break;case r.default.ENTER_FRAME:for(i=this.Q.length-1;i>=0;--i)if(e===this.R[i]){this.R.splice(i,1),this.Q.splice(i,1);break}break;case n.default.KEY_DOWN:for(i=this.S.length-1;i>=0;--i)if(e===this.T[i]){this.T.splice(i,1),this.S.splice(i,1);break}break;case n.default.KEY_UP:for(i=this.U.length-1;i>=0;--i)if(e===this.V[i]){this.V.splice(i,1),this.U.splice(i,1);break}break;default:this.N.removeEventListener(t,e,s);break}}}}m.GL=null,e.default=m},3930:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{constructor(t=1,e=1,s=1,i=1){this.r=1,this.g=1,this.b=1,this.a=1,this.r=t,this.g=e,this.b=s,this.a=i}setRGB3Bytes(t,e,s){this.r=t/255,this.g=e/255,this.b=s/255}setRGB3f(t,e,s){this.r=t,this.g=e,this.b=s}setRGBUint24(t){this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255}setRGBA4f(t,e,s,i){this.r=t,this.g=e,this.b=s,this.a=i}copyFrom(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}copyFromRGB(t){this.r=t.r,this.g=t.g,this.b=t.b}scaleBy(t){this.r*=t,this.g*=t,this.b*=t}inverseRGB(){this.r=1-this.r,this.g=1-this.g,this.b=1-this.b}randomRGB(t=1,e=0){this.r=Math.random()*t,this.g=Math.random()*t,this.b=Math.random()*t,this.r+=e,this.g+=e,this.b+=e}normalizeRandom(t=1,e=0){this.r=Math.random(),this.g=Math.random(),this.b=Math.random();let s=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);s>r.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/s,this.g=t*this.g/s,this.b=t*this.b/s),this.r+=e,this.g+=e,this.b+=e}normalize(t){void 0==t&&(t=1);let e=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);e>r.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/e,this.g=t*this.g/e,this.b=t*this.b/e)}getCSSDecRGBAColor(){let t=Math.floor(255*this.r),e=Math.floor(255*this.g),s=Math.floor(255*this.b),i=this.a;return"rgba("+t+","+e+","+s+","+i+")"}getCSSHeXRGBColor(){let t="#",e=Math.floor(255*this.r);return t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.g),t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.b),t+=e<15?"0"+e.toString(16):""+e.toString(16),t}toString(){return"[Color4(r="+this.r+", g="+this.g+",b="+this.b+",a="+this.a+")]"}}e.default=a},"3b73":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetWebBodyColor(t="white"){const e=document.body;e.style.background=t}static SetLanguage(t){i.GM=t}static GetLanguage(){return""!=i.GM||(i.GM=navigator.language),i.GM}static SetThreadEnabled(t){i.GN=t}static GetThreadEnabled(){return i.GN}static GetDebugEnabled(){return i.GO}static SetDebugEnabled(t){i.GO=t}static SetDevicePixelRatio(t){i.GP=t}static GetDevicePixelRatio(){return i.GP}static Initialize(t){i.GQ&&(i.GQ=!1,i.GR=t[0],i.TestMobileWeb(),i.GM=navigator.language+"")}static IsWindowsPCOS(){return!(i.IsSafariWeb()||i.IsMobileWeb())}static IsWinExternalVideoCard(){if(i.GS>0)return 2==i.GS;let t=i.IsSafariWeb()||i.IsMobileWeb();return t||(t=i.GPU_RENDERER.indexOf("Intel(R)")<0),i.GS=t?2:1,2==i.GS}static TestSafariWeb(){return/Safari/.test(navigator.userAgent)&&/Mac OS/.test(navigator.userAgent)}static IsWebGL1(){return 1==i.GR}static IsWebGL2(){return 2==i.GR}static IsMobileWeb(){return i.GX>0?2==i.GX:i.TestMobileWeb()}static IsSafariWeb(){return i.GT>0||(i.GT=i.TestSafariWeb()?2:1),2==i.GT}static IsIOS(){if(i.GU>0)return 2==i.GU;let t=!1;return t=!!/iPad|iPhone|iPod/.test(navigator.platform)||void 0!=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),i.GU=t?2:1,t}static IsIpadOS(){if(i.GV>0)return 2==i.GV;let t=navigator.maxTouchPoints>0&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform);return!t&&/iPod|iPad|iPadPro|iPodPro/i.test(navigator.userAgent)&&(t=!0),i.GV=t?2:1,t}static IsAndroidOS(){if(i.GW>0)return 2==i.GW;let t=i.TestMobileWeb();return t=!(!t||!/Android|Linux/i.test(navigator.userAgent)),i.GW=t?2:1,t}static TestMobileWeb(){return i.GX>0?2==i.GX:/mobile/.test(location.href)?(i.GX=2,2==i.GX):/Android/i.test(navigator.userAgent)?/Mobile/i.test(navigator.userAgent)?(i.GX=2,2==i.GX):(i.GX=1,2==i.GX):/webOS|iPhone|iPod|iPad|iPodPro|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(i.GX=2,2==i.GX):(i.GX=1,2==i.GX)}}i.GQ=!0,i.GR=2,i.GP=1,i.GX=0,i.GT=0,i.GW=0,i.GU=0,i.GV=0,i.GS=0,i.GM="",i.GO=!0,i.GPU_VENDOR="unknown",i.GPU_RENDERER="unknown",i.MAX_TEXTURE_SIZE=4096,i.MAX_RENDERBUFFER_SIZE=4096,i.MAX_VIEWPORT_WIDTH=4096,i.MAX_VIEWPORT_HEIGHT=4096,i.SHOWLOG_ENABLED=!1,i.SHADERCODE_TRACE_ENABLED=!1,i.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,i.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,i.GN=!0,e.default=i},"3c81":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("7696"));class n extends r.default{setCreateParams(t,e,s,i,r,a){this.A_K=t,this.BC=e,this.Ai=s,this.BD=i,this.BE=r,this.BF=a}createNode(){return new a.default(this.A_K,this.BC,this.Ai,this.BD,this.BE,this.BF)}rejoinRunitForTro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForTro(t)}rejoinRunitForVro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForVro(t)}}e.default=n},"3d98":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("2be0"));class n{constructor(){this.A=null,this.texture=null}loadTextureWithUrl(t,e){let s=new a.default;s.uuid=t,s.load(t,this),this.A=e,this.createTexture()}createTexture(){this.texture=this.A.textureBlock.createFloatCubeTex(32,32)}loaded(t,e){this.parseTextureBuffer(t),this.A=null,this.texture=null}loadError(t,e){}parseTextureBuffer(t){let e=0,s=128,i=128,r=s*i*3,a=new Float32Array(t),n=null,l=this.texture;l.toRGBFormat();for(let h=0,o=6;h<o;++h)n=a.slice(e,e+r),l.setDataFromBytesToFaceAt(h,n,s,i,0),e+=r}}e.TextureLoader=n;class l extends n{constructor(){super(),this.hdrBrnEnabled=!1}createTexture(){this.hdrBrnEnabled?this.texture=this.A.textureBlock.createBytesCubeTex(32,32):this.texture=this.A.textureBlock.createFloatCubeTex(32,32)}parseFloat(t){let e=0,s=128,i=128,a=3,n=new Float32Array(t),l=null,h=this.texture;h.toRGBFormat(),h.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,h.magFilter=r.TextureConst.LINEAR;for(let r=0;r<9;r++){for(let t=0;t<6;t++){const o=s*i*a;l=n.subarray(e,e+o),h.setDataFromBytesToFaceAt(t,l,s,i,r),e+=o}s>>=1,i>>=1}}parseHdrBrn(t){let e=new Uint16Array(t),s=new Uint8Array(t),i=0,a=e[4],n=e[5],l=e[6],h=0,o=s.subarray(32),m=this.texture;l>1?(m.mipmapEnabled=!1,m.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,m.magFilter=r.TextureConst.LINEAR):(m.mipmapEnabled=!0,m.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,m.magFilter=r.TextureConst.LINEAR);for(let r=0;r<l;r++){for(let t=0;t<6;t++)h=a*n*4,m.setDataFromBytesToFaceAt(t,o.subarray(i,i+h),a,n,r),i+=h;a>>=1,n>>=1}}parseTextureBuffer(t){this.hdrBrnEnabled?this.parseHdrBrn(t):this.parseFloat(t)}}e.SpecularTextureLoader=l},"402a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=i(s("8e17")),n=i(s("fecb")),l=i(s("29ef")),h=i(s("0929")),o=s("cc48"),m=i(s("dc2b"));class _{constructor(t=null){this.b=0,this.A_Y=null,this.BG=null,this.BH=!0,this.BI=!0,this.BJ=l.default.COLOR_MASK_ALL_TRUE,this.BK=l.default.BACK_CULLFACE_NORMAL_STATE,this.BL=null,this.A_X=null,this.BM=null,this.BN=null,this.BO=-1,this.BP=null,this.l=null,this.z_=null,this.__$rseFlag=r.default.DEFAULT,this.name="DisplayEntity",this.spaceCullMask=o.SpaceCullingMask.CAMERA,this.drawEnabled=!1,this.mouseEnabled=!1,this.vbWholeDataEnabled=!0,this.pipeTypes=null,this.BQ=!1,this.BR=!1,this.BS=null,this.BT=h.default.UPDATE_TRANSFORM,this.b=_.F_0++,this.A_Y=null==t?h.default.Create():t,this.createBounds()}createBounds(){this.BN=new n.default}__$setRenderProxy(t){this.l=t}__$setParent(t){this.BP,this.BP=t}__$getParent(){return this.BP}__$testSpaceEnabled(){return r.default.TestSpaceEnabled2(this.__$rseFlag)}__$testContainerEnabled(){return r.default.TestContainerEnabled(this.__$rseFlag)}__$testRendererEnabled(){return r.default.TestRendererEnabled(this.__$rseFlag)}getRendererUid(){return r.default.GetRendererUid(this.__$rseFlag)}setMaterialPipeline(t){this.z_=t}getMaterialPipeline(){return this.z_}isFree(){return this.__$rseFlag==r.default.DEFAULT}dispatchEvt(t){return null!=this.BG?this.BG.dispatchEvt(t):0}getEvtDispatcher(t){return this.BG}setEvtDispatcher(t){this.BG=t}getGlobalBounds(){return this.BN}getLocalBounds(){return this.A_X.bounds}getGlobalBoundsVer(){return null!=this.BN?this.BN.version:-1}__$setDrawEnabled(t){this.BI!=t&&(this.BI=t,null!=this.BL&&(this.BL.visible=this.BH&&t,null!=this.BL.__$$runit&&this.BL.__$$runit.setVisible(this.BL.visible)))}isDrawEnabled(){return this.BI}updateMeshToGpu(t=null,e=!0){null!=t&&(this.l=t),null!=this.l&&null!=this.BL&&this.BL.__$ruid>-1&&(this.BR?(this.BR=!1,this.l.VtxBufUpdater.updateDispVbuf(this.BL,e)):this.l.VtxBufUpdater.updateVtxDataToGpuByUid(this.BL.vbuf.getUid(),e))}updateMaterialToGpu(t=null,e=!0){null!=t&&(this.l=t),null!=this.l&&null!=this.BL&&this.BL.__$ruid>-1&&this.BQ&&(this.BQ=!1,this.l.MaterialUpdater.updateDispTRO(this.BL,e))}setTextureList(t){null!=this.BL&&this.BL.__$ruid>-1&&null!=this.BL.getMaterial()&&(this.BL.getMaterial().setTextureList(t),this.BQ=!0)}setTextureAt(t,e){null!=this.BL&&this.BL.__$ruid>-1&&null!=this.BL.getMaterial()&&(this.BL.getMaterial().setTextureAt(t,e),this.BQ=!0)}setSortValue(t){null!=this.BL&&null!=this.BL.__$$runit&&(this.BL.__$$runit.value=t)}setVisible(t){this.BH!=t&&(this.BH=t,null!=this.BL&&(this.BL.visible=t&&this.BI,null!=this.BL.__$$runit&&this.BL.__$$runit.setVisible(this.BL.visible)))}getVisible(){return this.BH}getTransform(){return this.A_Y}copyPositionFrom(t){null!=t&&this.A_Y.copyPositionFrom(t.getTransform())}copyMeshFrom(t){null!=t&&this.setMesh(t.getMesh())}copyMaterialFrom(t){null!=t&&this.setMaterial(t.getMaterial())}copyTransformFrom(t){let e=t;null!=e&&this.A_Y.copyFrom(e.A_Y)}initDisplay(t){this.BL.vbuf=t.__$attachVBuf(),this.BL.ivsIndex=0,this.BL.ivsCount=t.vtCount,this.BL.drawMode=t.drawMode,this.BL.trisNumber=t.trisNumber,this.BL.visible=this.BH&&this.BI}setMesh(t){null==this.A_X?null!=t&&(t.isEnabled()||t.rebuild(),t.isEnabled()&&(this.A_X=t,t.__$attachThis(),null==this.BL&&this.createDisplay(),null!=this.BL&&(this.BL.setTransform(this.A_Y.getMatrix()),this.initDisplay(t)),null==this.BM?this.BM=t.bounds:this.BM.copyFrom(t.bounds),this.updateMesh())):null!=this.BL&&this.BL.__$ruid>-1&&this.A_X!=t&&null!=t&&(this.A_Y.updatedStatus|=2,this.A_X.__$detachVBuf(this.BL.vbuf),this.A_X.__$detachThis(),t.__$attachThis(),this.A_X=t,this.initDisplay(t),this.updateMesh(),this.BR=!0)}updateMesh(){}getIvsIndex(){return this.BL.ivsIndex}getIvsCount(){return this.BL.ivsCount}setIvsParam(t,e,s=!1){if(null!=this.BL&&(this.BL.ivsIndex=t,this.BL.ivsCount=e,this.BL.__$ruid>-1&&(this.BL.__$$runit.trisNumber=Math.floor((e-t)/3),this.BL.__$$runit.setIvsParam(t,e),this.BL.__$$runit.drawMode=this.A_X.drawMode,s&&this.isPolyhedral()))){this.BM==this.A_X.bounds&&(this.BM=new n.default,this.BM.copyFrom(this.A_X.bounds)),this.BT=h.default.UPDATE_TRANSFORM,this.BM.reset();let s=this.A_X.getIVS();this.BM.addXYZFloat32AndIndicesArr(this.A_X.getVS(),s.subarray(t,t+e)),this.BM.update()}}getMesh(){return this.A_X}hasMesh(){return null!=this.A_X}isPolyhedral(){return null==this.A_X||this.A_X.isPolyhedral()}testRay(t,e,s,i){return this.A_X.testRay(t,e,s,i)}setMaterial(t){null!=t&&(null==this.BL&&(this.BL=m.default.Create(),this.BL.setTransform(this.A_Y.getMatrix()),this.BL.visible=this.BH&&this.BI),this.BL.getMaterial()!=t&&(r.default.RENDERER_UID_FLAG&this.__$rseFlag)==r.default.RENDERER_UID_FLAG&&this.BL.__$ruid<0&&(this.BL.renderState=this.BK,this.BL.rcolorMask=this.BJ,this.BL.setMaterial(t)))}getMaterial(){return null!=this.BL?this.BL.getMaterial():null}getDisplay(){return this.BL}getInvMatrix(){return this.A_Y.getInvMatrix()}getMatrix(t=!0){return this.A_Y.getMatrix(t)}getToParentMatrix(){return this.A_Y.getToParentMatrix()}setRenderColorMask(t){this.BJ=t,null!=this.BL&&(this.BL.rcolorMask=this.BJ,null!=this.BL.__$$runit&&this.BL.__$$runit.setDrawFlag(this.BK,this.BJ))}setRenderColorMaskByName(t){this.BJ=l.default.GetRenderColorMaskByName(t),null!=this.BL&&(this.BL.rcolorMask=this.BJ,null!=this.BL.__$$runit&&this.BL.__$$runit.setDrawFlag(this.BK,this.BJ))}setRenderState(t){this.BK=t,null!=this.BL&&(this.BL.renderState=this.BK,null!=this.BL.__$$runit&&this.BL.__$$runit.setDrawFlag(this.BK,this.BJ))}setRenderStateByName(t){this.BK=l.default.GetRenderStateByName(t),null!=this.BL&&(this.BL.renderState=this.BK,null!=this.BL.__$$runit&&this.BL.__$$runit.setDrawFlag(this.BK,this.BJ))}createDisplay(){this.BL=m.default.Create()}activeDisplay(){if(null!=this.BL){let t=this.BL.getMaterial();if(null!=t){if(null==t.getShaderData()&&null!=t.getCodeBuf()&&null==t.getShaderData()){let e=t.getTextureList(),s=null!=e&&e.length>0;null==t.getMaterialPipeline()&&null!=this.getMaterialPipeline()&&t.setMaterialPipeline(this.getMaterialPipeline()),null==t.pipeTypes&&(t.pipeTypes=this.pipeTypes),t.initializeByCodeBuf(s)}null==this.getMesh()&&(this.__activeMesh(t),this.BL.name=this.name)}}}__activeMesh(t){}getUid(){return this.b}setXYZ(t,e,s){this.A_Y.setXYZ(t,e,s)}offsetPosition(t){this.A_Y.offsetPosition(t)}setPosition(t){this.A_Y.setPosition(t)}getPosition(t){this.A_Y.getPosition(t)}setRotation3(t){this.A_Y.setRotationXYZ(t.x,t.y,t.z)}setRotationXYZ(t,e,s){this.A_Y.setRotationXYZ(t,e,s)}setScale3(t){this.A_Y.setScaleXYZ(t.x,t.y,t.z)}setScaleXYZ(t,e,s){this.A_Y.setScaleXYZ(t,e,s)}getRotationXYZ(t){this.A_Y.getRotationXYZ(t)}getScaleXYZ(t){this.A_Y.getScaleXYZ(t)}localToGlobal(t){null!=this.A_Y&&this.A_Y.localToGlobal(t)}globalToLocal(t){null!=this.A_Y&&this.A_Y.globalToLocal(t)}isInRenderer(){return(this.__$rseFlag&r.default.RENDERER_UID_FLAG)!=r.default.RENDERER_UID_FLAG}isInRendererProcess(){return null!=this.BL&&this.BL.__$ruid>-1}isRenderEnabled(){return this.drawEnabled&&this.BH&&null!=this.BL&&this.BL.__$ruid>-1}updateBounds(){if(null!=this.A_Y){if(this.BT=h.default.UPDATE_TRANSFORM,null!=this.A_X&&this.BM!=this.A_X.bounds){this.BM.reset();let t=this.A_X.getIVS();this.BM.addXYZFloat32AndIndicesArr(this.A_X.getVS(),t.subarray(this.BL.ivsIndex,this.BL.ivsIndex+this.BL.ivsCount)),this.BM.update()}this.update()}}updateLocalBoundsVS(t){let e=t.min,s=t.max;null==this.BS&&(this.BS=new Float32Array(24));let i=this.BS;i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=s.x,i[4]=e.y,i[5]=e.z,i[6]=e.x,i[7]=e.y,i[8]=s.z,i[9]=s.x,i[10]=e.y,i[11]=s.z,i[12]=e.x,i[13]=s.y,i[14]=e.z,i[15]=s.x,i[16]=s.y,i[17]=e.z,i[18]=e.x,i[19]=s.y,i[20]=s.z,i[21]=s.x,i[22]=s.y,i[23]=s.z}updateGlobalBounds(){let t=this.BM;if(this.BT>h.default.UPDATE_POSITION||this.BO!=t.version){let e=this.A_Y.updateStatus;if(this.A_Y.update(),this.BO!=t.version||e!=this.A_Y.updateStatus){this.BO=t.version,this.updateLocalBoundsVS(t);let e=this.BS,s=_.GY;this.A_Y.getMatrix().transformVectors(e,24,s),this.BN.reset(),this.BN.addXYZFloat32Arr(s),this.BN.update()}}else{_.GZ.setXYZ(0,0,0),_.Ga.setXYZ(0,0,0);let t=this.A_Y.getMatrix(!1);t.transformVector3Self(_.GZ),this.A_Y.update(),t=this.A_Y.getMatrix(!1),t.transformVector3Self(_.Ga),_.Ga.subtractBy(_.GZ);let e=this.BN;e.min.addBy(_.Ga),e.max.addBy(_.Ga),e.center.addBy(_.Ga),++this.BN.version}}update(){this.A_Y.updatedStatus>this.BT&&(this.BT=this.A_Y.updatedStatus),this.BT!=h.default.UPDATE_NONE&&(null!=this.A_X&&null!=this.BN?this.updateGlobalBounds():this.A_Y.update(),this.BT=h.default.UPDATE_NONE,this.A_Y.updatedStatus=this.BT)}destroy(){null!=this.BG&&(this.BG.destroy(),this.BG=null),null!=this.A_Y&&this.isFree()&&(null!=this.BL&&(this.A_X.__$detachVBuf(this.BL.vbuf),m.default.Restore(this.BL),this.BL=null),h.default.Restore(this.A_Y),this.A_Y=null,null!=this.A_X&&(this.A_X.__$detachThis(),this.A_X=null),this.__$setParent(null),this.BH=!0,this.BI=!0,this.l=null,this.__$rseFlag=r.default.DEFAULT),this.BN=null,this.BM=null,this.z_=null}toString(){return"DisplayEntity(name="+this.name+",uid = "+this.b+", rseFlag = "+this.__$rseFlag+")"}}_.F_0=0,_.GY=new Float32Array(24),_.Ga=new a.default,_.GZ=new a.default,e.default=_},"442e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("265e"));class n extends r.default{createNode(){return new a.default}}e.default=n},"45db":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8def")),a=i(s("fa60"));class n{constructor(){this.BU=null,this.BV=-1,this.BW=[],this.BX=0,this.v=0,this.BY=0,this.BZ=0,this.Ba=null,this.Bb=null,this.Bc=null,this.Bd=[],this.Be=0}updateToGpu(t){let e=this.BW.length;if(e>0){let s=this.BU;if(this.version!=s.vertexVer){let i,r=s.getBufDataUsage(),a=this.Bc;for(let n=0;n<e;++n)i=s.getF32DataAt(n),a[n]>=i.length?(t.bindArrBuf(this.BW[n]),t.arrBufSubData(i,0)):(t.bindArrBuf(this.BW[n]),t.arrBufData(i,r),a[n]=i.length);this.version=s.vertexVer}}}uploadCombined(t,e){let s=this.BU,i=s.getF32DataAt(0);if(this.BW.push(t.createBuf()),t.bindArrBuf(this.BW[0]),t.arrBufData(i,s.getBufDataUsage()),this.BX=1,this.Bc=[i.length],null==this.Ba){this.BZ=0,this.Ba=new Array(this.BY),this.Bb=new Array(this.BY);for(let t=0;t<this.BY;++t)this.Bb[t]=this.BZ,this.BZ+=4*e.getLocationSizeByIndex(t),this.Ba[t]=e.getLocationTypeByIndex(t)}}uploadSeparated(t,e){let s=this.BU,i=0,r=null,a=s.getBufDataUsage();if(this.BX=this.BU.getBuffersTotal(),this.Bc=new Array(this.BY),null==s.bufData)for(;i<this.BY;++i)r=t.createBuf(),this.BW.push(r),t.bindArrBuf(r),t.arrBufData(s.getF32DataAt(i),a),this.Bc[i]=s.getF32DataAt(i).length;else{let e=null,n=0,l=0,h=0,o=0;for(;i<this.BY;++i){for(r=t.createBuf(),this.BW.push(r),t.bindArrBuf(r),t.arrBufDataMem(s.bufData.getAttributeDataTotalBytesAt(i),a),h=0,o=0,l=s.bufData.getAttributeDataTotalAt(i),n=0;n<l;++n)e=s.bufData.getAttributeDataAt(i,n),o+=e.length,t.arrBufSubData(e,h),h+=e.byteLength;this.Bc[i]=o}}if(null==this.Ba){this.Ba=new Array(this.BY),this.Bb=new Array(this.BY);for(let t=0;t<this.BY;++t)this.Bb[t]=this.BZ,this.BZ+=4*e.getLocationSizeByIndex(t),this.Ba[t]=e.getLocationTypeByIndex(t);this.BZ=0}}initialize(t,e,s){this.BW.length<1&&null!=s&&(this.version=s.vertexVer,this.BU=s,this.BV=s.getUid(),this.v=s.getType(),e.getLocationsTotal(),s.getAttribsTotal(),this.BY=e.getLocationsTotal(),this.v<1?this.uploadCombined(t,e):this.uploadSeparated(t,e))}getVROMid(t,e,s,i){let r=(131+t.getRCUid())*this.BV;return s&&(r=131*r+1),r=131*r+e.getMid(),r=131*r+i,r}createVRO(t,e,s,i,n){let l=e.getLocationsTotal();if(this.BY*l>0&&l<=this.BY){let h=this.getVROMid(t,e,s,n),o=0,m=a.default.GetByMid(h);if(null!=m)return m;if(s){let s=a.default.Create(t,h,this.BU.getUid());if(s.indicesRes=i,s.vao=t.createVertexArray(),t.bindVertexArray(s.vao),this.v<1)for(t.bindArrBuf(this.BW[0]),o=0;o<l;++o)e.vertexAttribPointerTypeFloat(this.Ba[o],this.BZ,this.Bb[o]);else for(o=0;o<l;++o)t.bindArrBuf(this.BW[o]),e.vertexAttribPointerTypeFloat(this.Ba[o],0,0);m=s,s.ibuf=i.getGpuBuf(),t.bindVertexArray(null)}else{let s=r.default.Create(t,h,this.BU.getUid());for(s.indicesRes=i,s.shdp=e,s.attribTypes=[],s.wholeOffsetList=[],s.wholeStride=this.BZ,this.v<1?s.vbuf=this.BW[0]:s.vbufs=this.BW,o=0;o<l;++o)e.testVertexAttribPointerType(this.Ba[o])&&(s.attribTypes.push(this.Ba[o]),s.wholeOffsetList.push(0));s.attribTypesLen=s.attribTypes.length,s.ibuf=i.getGpuBuf(),m=s}return this.Bd.push(m),++this.Be,m}return null}destroy(t){if(this.BW.length>0){this.v=-1;let e=0,s=null;for(;e<this.Be;++e)s=this.Bd.pop(),s.restoreThis(),this.Bd[e]=null;for(this.Be=0,e=0;e<this.BY;++e)t.deleteBuf(this.BW[e]),this.BW[e]=null;this.BY=0,this.BW=[]}}}e.ROVertexRes=n},4835:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("faa5")),n=i(s("b3bd")),l=i(s("0fc4"));class h extends a.default{constructor(){super(),this.j_="",this.Bf=!1}initialize(t){this.j_="Text2DShd",this.Bf=t,t&&(this.j_+="_tex")}getFragShaderCode(){let t="#version 300 es\nprecision mediump float;\nin vec4 v_color;\n";return this.Bf&&(t+="uniform sampler2D u_sampler0;\nin vec2 v_texUV;\nlayout(location = 0) out vec4 FragColor;\n"),t+="void main()\n{\n",this.Bf?t+="float pa = pow(texture(u_sampler0, v_texUV).a,0.8);\nFragColor = vec4(v_color.xyz, min(v_color.w * pa,1.0));\n":t+="FragColor = v_color;\n",t+="}\n",t}getVertShaderCode(){let t="#version 300 es\nprecision mediump float;\nlayout(location = 0) in vec2 a_vs;\nuniform vec4 u_stageParam;\nuniform vec4 u_params[3];\nout vec4 v_color;\n";return this.Bf&&(t+="layout(location = 1) in vec2 a_uvs;\nout vec2 v_texUV;\n"),t+="void main()\n{\nvec4 pv4 = vec4(a_vs.xy,0.0,1.0);\npv4.xy *= u_params[1].xy;\nfloat cosv = cos(u_params[1].w);\nfloat sinv = sin(u_params[1].w);\npv4.xy = vec2(pv4.x * cosv - pv4.y * sinv, pv4.x * sinv + pv4.y * cosv);\npv4.xy += u_params[0].xy;\npv4.xy *= u_stageParam.xy;\npv4.xy += -1.0;\ngl_Position = pv4;\n",this.Bf&&(t+="v_texUV = a_uvs.xy;\n"),t+="v_color = u_params[2];\n}\n",t}getUniqueShaderName(){return this.j_}toString(){return"[Text2DShaderBuffer()]"}static GetInstance(){return null!=h.F_2||(h.F_2=new h),h.F_2}}h.F_2=null;class o extends l.default{constructor(){super(),this.Bg=0,this.Bh=0,this.Bi=0,this.Bj=0,this.n_=1,this.Bk=new Float32Array([0,0,0,0,1,1,0,0,1,1,1,1])}getCodeBuf(){return h.GetInstance()}setXY(t,e){this.Bk[0]=t,this.Bk[1]=e}setX(t){this.Bk[0]=t}setY(t){this.Bk[1]=t}getX(){return this.Bk[0]}getY(){return this.Bk[1]}setScale(t){this.Bk[4]=t,this.Bk[5]=t}setScaleXY(t,e){this.Bk[4]=t,this.Bk[5]=e}setScaleX(t){this.Bk[4]=t}setScaleY(t){this.Bk[5]=t}getScaleX(){return this.Bk[4]}getScaleY(){return this.Bk[5]}setRotation(t){this.Bg=t,this.Bk[7]=r.default.MATH_PI_OVER_180*t}getRotation(){return this.Bg}setRGB3f(t,e,s){this.Bh=t,this.Bi=e,this.Bj=s,this.Bk[8]=t*this.n_,this.Bk[9]=e*this.n_,this.Bk[10]=s*this.n_}setRGBA4f(t,e,s,i){this.Bh=t,this.Bi=e,this.Bj=s,this.Bk[8]=t*this.n_,this.Bk[9]=e*this.n_,this.Bk[10]=s*this.n_,this.Bk[11]=i}setAlpha(t){this.Bk[11]=t}getAlpha(){return this.Bk[6]}setBrightness(t){this.n_=t,this.Bk[4]=this.Bh*t,this.Bk[5]=this.Bi*t,this.Bk[6]=this.Bj*t}getBrightness(){return this.n_}createSelfUniformData(){let t=new n.default;return t.uniformNameList=["u_params"],t.dataList=[this.Bk],t}}e.default=o},"4a54":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("81ce")),n=i(s("f208")),l=s("c164");class h{constructor(t){this.Bl="#version 300 es\n",this.Bm="precision mediump float;\n",this.Bn=[],this.Bo=[],this.Bp=[],this.Bq=[],this.Br=[],this.Bs=[],this.Bt=[],this.Bu=[],this.Bv=[],this.Bw=[],this.Bx=[],this.By=[],this.Bz=[],this.B0=[],this.B1=[],this.B2=[],this.B3=[],this.B4=[],this.B5=[],this.B6=[],this.B7="",this.B8=[],this.B9=!1,this.B_A=!1,this.B_B=!1,this.B_C=!1,this.B_D=!1,this.B_E=!1,this.B_F="",this.B_G="",this.B_H="",this.B_I="",this.A_f="",this.A_h=10,this.B_J=!1,this.B_K=null,this.fragHeadCodeUnlock=!0,this.fragMainCodeUnlock=!0,this.vertHeadCodeUnlock=!0,this.vertMainCodeUnlock=!0,this.autoBuildHeadCodeEnabled=!0,this.mathDefineEanbled=!0,this.normalEnabled=!1,this.normalMapEnabled=!1,this.mapLodEnabled=!1,this.derivatives=!1,this.vertMatrixInverseEnabled=!1,this.vtxUVTransfromEnabled=!1,this.fragMatrixInverseEnabled=!1;let e=this;e.uniform=t}getUniqueNSKeyID(){throw Error("can not use this function !!!")}getUniqueNSKeyString(){let t=this.A_f;return this.vtxUVTransfromEnabled&&(t+="VtxUVT"),this.normalEnabled&&(t+="Nor"),this.uniform.getUniqueNSKeyString()+t}reset(){this.B9=!0,this.B_A=!0,this.B_B=!0,this.B_C=!1,this.B_D=!1,this.B_E=!1,this.fragHeadCodeUnlock=!0,this.fragMainCodeUnlock=!0,this.vertHeadCodeUnlock=!0,this.vertMainCodeUnlock=!0,this.autoBuildHeadCodeEnabled=!0,this.B_J=!1,this.B_F="",this.B_G="",this.B_H="",this.B_I="",this.A_f="",this.Bo=[],this.Bn=[],this.Br=[],this.Bs=[],this.Bt=[],this.Bu=[],this.Bv=[],this.B0=[],this.B1=[],this.Bw=[],this.Bx=[],this.By=[],this.Bz=[],this.B2=[],this.B3=[],this.Bp=[],this.Bq=[],this.B4=[],this.B5=[],this.B6=[],this.B8=[],this.B7="",this.mathDefineEanbled=!0,this.normalEnabled=!1,this.normalMapEnabled=!1,this.mapLodEnabled=!1,this.vertMatrixInverseEnabled=!1,this.fragMatrixInverseEnabled=!1,this.vtxUVTransfromEnabled=!1,this.B_K=null,this.uniform.reset()}addUniqueNSKeyString(t){this.A_f+=t}getPreCompileInfo(){let t=this.B_K;return this.B_K=null,t}useHighPrecious(){this.Bm="precision highp float;"}useMediumPrecious(){this.Bm="precision mediump float;"}useLowPrecious(){this.Bm="precision lowp float;"}addDefine(t,e="1"){return!this.Bp.includes(t)&&(this.Bp.push(t),this.Bq.push(e),!0)}addVertLayout(t,e){this.Br.includes(e)||(this.Br.push(e),this.Bs.push(t))}addFragOutputHighp(t,e){this.Bu.includes(e)||(this.Bt.push("highp"),this.Bu.push(e),this.Bv.push(t))}addFragOutput(t,e){this.Bu.includes(e)||(this.Bt.push(""),this.Bu.push(e),this.Bv.push(t))}addVarying(t,e){this.B0.includes(e)||(this.B0.push(e),this.B1.push(t))}addVertUniform(t,e,s=0){this.Bw.includes(e)||(s>0?this.Bw.push(e+"["+s+"]"):this.Bw.push(e),this.Bx.push(t))}addVertUniformParam(t){this.addVertUniform(t.type,t.name,t.arrayLength)}addFragUniform(t,e,s=0){this.By.includes(e)||(s>0?this.By.push(e+"["+s+"]"):this.By.push(e),this.Bz.push(t))}addFragUniformParam(t){this.addFragUniform(t.type,t.name,t.arrayLength)}addVertAndFragUniform(t,e,s=0){this.addVertUniform(t,e,s),this.addFragUniform(t,e,s)}addFragFunction(t){this.B2.push(t)}addVertFunction(t){this.B3.push(t)}useTexturePreciseHighp(){this.B7="highp"}addTextureSample2D(t="",e=!0,s=!0,i=!1){if(""==t||!this.B6.includes(t)){this.B4.push("sampler2D"),this.B6.push(t),this.B5.push(this.B7);let r=0;s&&(r|=2),i&&(r|=4),this.B8.push(r),this.B7="",e&&(this.B_J=!0)}}addTextureSampleCube(t="",e=!0,s=!1){if(""==t||!this.B6.includes(t)){this.B4.push("samplerCube"),this.B6.push(t),this.B5.push(this.B7);let i=0;e&&(i|=2),s&&(i|=4),this.B8.push(i),this.B7=""}}addTextureSample3D(t="",e=!0,s=!1){if(""==t||!this.B6.includes(t)){this.B4.push("sampler3D"),this.B6.push(t),this.B5.push(this.B7);let i=0;e&&(i|=2),s&&(i|=4),this.B8.push(i),this.B7=""}}isHaveTexture(){return this.B4.length>0}isHaveTexture2D(){return this.B_J}useVertSpaceMats(t=!0,e=!0,s=!0){this.B9=t,this.B_A=e,this.B_B=s}useFragSpaceMats(t=!0,e=!0,s=!0){this.B_C=t,this.B_D=e,this.B_E=s}addVertExtend(t){this.Bo.push(t)}addFragExtend(t){this.Bn.push(t)}addVertHeadCode(t){""!=t&&(this.B_F+="\n"+t)}addVertMainCode(t){""!=t&&(this.B_G+="\n"+t)}addFragHeadCode(t){""!=t&&(this.B_H+="\n"+t)}addFragMainCode(t){""!=t&&(this.B_I+="\n"+t)}addShaderObject(t){this.fragHeadCodeUnlock&&this.addFragHeadCode(t.frag_head),this.fragMainCodeUnlock&&this.addFragMainCode(t.frag_body),this.vertHeadCodeUnlock&&this.addVertHeadCode(t.vert_head),this.vertMainCodeUnlock&&this.addVertMainCode(t.vert_body)}addShaderObjectHead(t){this.fragHeadCodeUnlock&&this.addFragHeadCode(t.frag_head),this.vertHeadCodeUnlock&&this.addVertMainCode(t.vert_head)}autoBuildHeadCode(){this.addVertLayout("vec3","a_vs"),(this.B_J||this.Br.includes("a_uvs"))&&(this.addVertLayout("vec2","a_uvs"),this.addVarying("vec2","v_uv")),(this.normalEnabled||this.normalMapEnabled||this.Br.includes("a_nvs"))&&(this.addVertLayout("vec3","a_nvs"),this.addVarying("vec3","v_worldNormal"),this.addVarying("vec3","v_worldPosition"),this.addDefine("VOX_USE_NORMAL"));let t=["a_vs","a_uvs","a_nvs"],e=[],s=[];for(;t.length>0;){let i=this.Br.indexOf(t[0]);i>=0&&(e.push(this.Br[i]),s.push(this.Bs[i]),this.Br.splice(i,1),this.Bs.splice(i,1)),t.shift()}this.Br=e.concat(this.Br),this.Bs=s.concat(this.Bs),this.vtxUVTransfromEnabled&&this.addDefine("VOX_VTX_TRANSFORM_PARAM_INDEX","0")}buildFragCode(){this.autoBuildHeadCodeEnabled&&this.autoBuildHeadCode(),this.Bu.length<1&&this.addFragOutput("vec4","FragColor0");let t=0,e=0,s="";for((r.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED||r.default.IsMobileWeb())&&this.useHighPrecious(),r.default.IsWebGL2()&&(s+=this.Bl),this.B_K=new n.default,this.B_K.info="\n//##COMPILE_INFO_BEGIN",this.B_K.info+="\n//##COMPILE_INFO_END",t=0,e=this.Bn.length;t<e;t++)s+="\n"+this.Bn[t];for(r.default.IsWebGL1()&&(this.Bu.length>1&&(s+="\n#extension GL_EXT_draw_buffers: require"),(this.normalMapEnabled||this.derivatives)&&(s+="\n#extension GL_OES_standard_derivatives : enable"),this.mapLodEnabled&&(s+="\n#extension GL_EXT_shader_texture_lod : enable")),r.default.IsMobileWeb()?s+="\nprecision highp float;":s+="\n"+this.Bm,r.default.IsWebGL2()?(s+="\n#define VOX_GLSL_ES3 1",s+="\n#define VOX_IN in",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureLod",s+="\n#define VOX_Texture2DLod textureLod"),s+="\n#define VOX_Texture2D texture",s+="\n#define VOX_TextureCube texture"):(s+="\n#define VOX_GLSL_ES2 1",s+="\n#define VOX_IN varying",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureCubeLodEXT",s+="\n#define VOX_Texture2DLod texture2DLodEXT"),s+="\n#define VOX_TextureCube textureCube",s+="\n#define VOX_Texture2D texture2D"),this.mathDefineEanbled&&(s+=l.MathShaderCode.BasePredefined),e=this.Bp.length,t=0;t<e;t++)""!=this.Bq[t]?s+="\n#define "+this.Bp[t]+" "+this.Bq[t]:s+="\n#define "+this.Bp[t]+" 1";for(t=0,e=this.B6.length;t<e;t++)""!=this.B6[t]&&0!=(2&this.B8[t])&&(s+="\n#define "+this.B6[t]+" u_sampler"+t);for(this.B_J&&(s+="\n#define VOX_USE_2D_MAP 1"),t=0,e=this.B4.length;t<e;t++)0!=(2&this.B8[t])&&(""==this.B5[t]?s+="\nuniform "+this.B4[t]+" u_sampler"+t+";":s+="\nuniform "+this.B5[t]+" "+this.B4[t]+" u_sampler"+t+";");for(t=0,e=this.Bz.length;t<e;t++)s+="\nuniform "+this.Bz[t]+" "+this.By[t]+";";if(this.B_C&&(s+="\nuniform mat4 u_objMat;"),this.B_D&&(s+="\nuniform mat4 u_viewMat;"),this.B_E&&(s+="\nuniform mat4 u_projMat;"),e=this.B0.length,r.default.IsWebGL2())for(t=0;t<e;t++)s+="\nin "+this.B1[t]+" "+this.B0[t]+";";else for(t=0;t<e;t++)s+="\nvarying "+this.B1[t]+" "+this.B0[t]+";";for(s+=l.ShaderCode.BasePredefined,this.fragMatrixInverseEnabled&&r.default.IsWebGL1()&&(this.addVertFunction(a.default.__glslInverseMat3),this.addVertFunction(a.default.__glslInverseMat4)),s+=this.B_H,t=0,e=this.B2.length;t<e;t++)s+="\n"+this.B2[t];if(t=0,e=this.Bu.length,r.default.IsWebGL2())for(;t<e;t++)""!=this.Bt[t]?s+="\nlayout(location = "+t+") out "+this.Bt[t]+" "+this.Bv[t]+" "+this.Bu[t]+";":s+="\nlayout(location = "+t+") out "+this.Bv[t]+" "+this.Bu[t]+";";else 1==e&&(s+="\n#define "+this.Bu[t]+" gl_FragColor");let i=!1,h=this.B_I.indexOf("{");if(h>0){let t=this.B_I.slice(0,h);i=t.indexOf(" main")>0,i||(i=this.B_I.indexOf(" main")>0)}if(i?s+=this.B_I:(s+="\nvoid main() {\n",s+=this.B_I,s+="\n}\n"),e=this.Bu.length,r.default.IsWebGL1()&&e>1)for(t=0;t<e;t++){let e=new RegExp(this.Bu[t],"g");s=s.replace(e,"gl_FragData["+t+"]")}return s}buildVertCode(){let t=0,e=0,s="";for(r.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&this.useHighPrecious(),r.default.IsWebGL2()&&(s+=this.Bl),t=0,e=this.Bo.length;t<e;t++)s+="\n"+this.Bo[t];for(r.default.IsMobileWeb()?s+="\nprecision highp float;":s+="\n"+this.Bm,r.default.IsWebGL2()?(s+="\n#define VOX_GLSL_ES3 1",s+="\n#define VOX_IN in",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureLod",s+="\n#define VOX_Texture2DLod textureLod"),s+="\n#define VOX_Texture2D texture",s+="\n#define VOX_TextureCube texture"):(s+="\n#define VOX_GLSL_ES2 1",s+="\n#define VOX_IN varying",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureCubeLodEXT",s+="\n#define VOX_Texture2DLod texture2DLodEXT"),s+="\n#define VOX_TextureCube textureCube",s+="\n#define VOX_Texture2D texture2D"),r.default.IsWebGL2()?s+="\n#define VOX_OUT out":s+="\n#define VOX_OUT varying",this.mathDefineEanbled&&(s+=l.MathShaderCode.BasePredefined),e=this.Bp.length,t=0;t<e;t++)""!=this.Bq[t]?s+="\n#define "+this.Bp[t]+" "+this.Bq[t]:s+="\n#define "+this.Bp[t];for(t=0,e=this.B6.length;t<e;t++)""!=this.B6[t]&&0!=(4&this.B8[t])&&(s+="\n#define "+this.B6[t]+" u_sampler"+t);for(this.B_J&&(s+="\n#define VOX_USE_2D_MAP 1"),t=0,e=this.B4.length;t<e;t++)0!=(4&this.B8[t])&&(""==this.B5[t]?s+="\nuniform "+this.B4[t]+" u_sampler"+t+";":s+="\nuniform "+this.B5[t]+" "+this.B4[t]+" u_sampler"+t+";");if(e=this.Br.length,r.default.IsWebGL2())for(t=0;t<e;t++)s+="\nlayout(location = "+t+") in "+this.Bs[t]+" "+this.Br[t]+";";else for(t=0;t<e;t++)s+="\nattribute "+this.Bs[t]+" "+this.Br[t]+";";for(e=this.Bx.length,t=0;t<e;t++)s+="\nuniform "+this.Bx[t]+" "+this.Bw[t]+";";if(this.B9&&(s+="\nuniform mat4 u_objMat;"),this.B_A&&(s+="\nuniform mat4 u_viewMat;"),this.B_B&&(s+="\nuniform mat4 u_projMat;"),e=this.B0.length,r.default.IsWebGL2())for(t=0;t<e;t++)s+="\nout "+this.B1[t]+" "+this.B0[t]+";";else for(t=0;t<e;t++)s+="\nvarying "+this.B1[t]+" "+this.B0[t]+";";for(s+=l.ShaderCode.BasePredefined,s+=l.ShaderCode.VertPredefined,this.vertMatrixInverseEnabled&&r.default.IsWebGL1()&&(this.addVertFunction(a.default.__glslInverseMat3),this.addVertFunction(a.default.__glslInverseMat4)),s+=this.B_F,t=0,e=this.B3.length;t<e;t++)s+="\n"+this.B3[t];let i=!1,n=this.B_G.indexOf("{");if(n>0){let t=this.B_G.slice(0,n);i=t.indexOf(" main")>0,i||(i=this.B_G.indexOf(" main")>0)}return i?s+=this.B_G:(s+="\nvoid main() {\n",s+=this.B_G,s+="\n}\n"),s}}e.default=h},"4b10":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.B_L=!1,this.B_M=!1,this.B_N=!0,this.B_O=1,this.B_P=0,this.B_Q=null,this.B_R=0,this.B_S=null,this.B_T=0,this.B_U=null,this.B_V=0,this.B_W=null,this.B_X=0,this.B_Y=null,this.B_Z=null,this.B_a=null,this.B_b=null,this.B_c=null,this.baseVertexIndex=0,this.baseNormalIndex=0,this.baseUvIndex=0,this.idns="obj",this.B_d=!0,this.B_e=null}parseStrData(t,e,s=!1,r=!1){void 0==e&&(e=1),void 0==s&&(s=!1),void 0==r&&(r=!1),this.B_L=s,this.B_M=r,this.B_c=[],this.B_Y=[],this.B_Z=[],this.B_a=[],this.B_b=[],this.B_O=e,this.B_Q=[],this.B_S=[],this.B_U=[];let a=t.split(i.LINE_FEED),n=a.length;for(let i=0;i<n;++i)this.parseLine(a[i]);this.B_X=this.B_Z.length/3}getVtxTotal(){return this.B_X}parseLine(t){let e=t.split(i.SPACE),s=null;if(!(e.length>0))return;s=e.slice(1);let r=e[0];switch(r){case i.VERTEX:this.parseVertex(s);break;case i.NORMAL:this.parseNormal(s);break;case i.UV:this.parseUV(s);break;case i.INDEX_DATA:this.parseIndex(s);break}}parseVertex(t){if(""!=t[0]&&" "!=t[0]||(t=t.slice(1)),this.B_L)this.B_Q.push(Number(t[1])*this.B_O),this.B_Q.push(Number(t[2])*this.B_O),this.B_Q.push(Number(t[0])*this.B_O);else{let e=t.length;e>3&&(e=3);for(let s=0;s<e;++s)this.B_Q.push(Number(t[s])*this.B_O)}this.B_R=this.B_Q.length}getVS(){return this.B_Z}getCVS(){if(null!=this.B_e)return this.B_e;this.B_e=[];let t=0,e=this.B_Z.length/3;for(;t<e;t++)this.B_e.push(1,1,1,1);return this.B_e}parseNormal(t){""!=t[0]&&" "!=t[0]||(t=t.slice(1));let e=t.length;e>3&&(e=3);for(let s=0;s<e;++s){let e=t[s];null!=e&&this.B_S.push(Number(e))}this.B_T=this.B_S.length}getNVS(){return this.B_b}parseUV(t){""!=t[0]&&" "!=t[0]||(t=t.slice(1));let e=t.length;e>2&&(e=2);for(let s=0;s<e;++s){let e=t[s];this.B_U.push(Number(e))}this.B_V=this.B_U.length}getUVS(){return this.B_a}parseIndex(t){let e="",s=null,r=0,a=0,n=0,l=0,h=0,o=t.length,m=0;while(""==t[m]||" "==t[m])m++;for(o=m+3,h=m;h<o;++h)e=t[h],""!=e&&(s=e.split(i.SLASH),r=parseInt(s[0])-1-this.baseVertexIndex,a=parseInt(s[1])-1-this.baseUvIndex,n=parseInt(s[2])-1-this.baseNormalIndex,r<0&&(r=0),a<0&&(a=0),n<0&&(n=0),l=3*r,this.B_Z.push(this.B_Q[l],this.B_Q[l+1],this.B_Q[l+2]),this.B_N?this.B_c.push(Math.random(),Math.random(),Math.random(),1):this.B_c.push(1,1,1,1),this.B_S.length&&(l=3*n,this.B_b.push(this.B_S[l],this.B_S[l+1],this.B_S[l+2])),l=2*a,this.B_M?this.B_a.push(1-this.B_U[l],1-this.B_U[l+1]):this.B_a.push(this.B_U[l],this.B_U[l+1]));this.B_Y.push(this.B_P,this.B_P+1,this.B_P+2),this.B_P+=3}getIVS(){return this.B_Y}getTriTotal(){return this.B_Y.length/3}restoreNormals(){this.B_b=this.B_W.concat()}}i.LINE_FEED=String.fromCharCode(10),i.SPACE=String.fromCharCode(32),i.SLASH="/",i.VERTEX="v",i.NORMAL="vn",i.UV="vt",i.INDEX_DATA="f",e.ObjStrDataParser=i;class r{constructor(){this.B_f=[]}parseStrData(t,e=1,s=!1,r=!1){let a=t.split("# object"),n=1,l=null;for(;n<a.length;++n)l=new i,l.parseStrData("# object"+a[n],e,s,r),this.B_f.push(l)}getParserTotal(){return this.B_f.length}getParserAt(t){return this.B_f[t]}}e.ObjsStrDataParser=r},"4cf7":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98");class r{constructor(){this.B_g=[],this.B_h=[],this.B_i=[],this.B_j=[]}addTexture(t){switch(t.getType()){case i.TextureProxyType.Image:this.B_g.push(t);break;case i.TextureProxyType.Bytes:this.B_h.push(t);break;case i.TextureProxyType.Float:this.B_i.push(t);break;case i.TextureProxyType.Wrapper:this.B_j.push(t);break;default:break}}getTexture(t){switch(t){case i.TextureProxyType.Image:if(this.B_g.length>0)return this.B_g.pop();break;case i.TextureProxyType.Bytes:if(this.B_h.length>0)return this.B_h.pop();break;case i.TextureProxyType.Float:if(this.B_i.length>0)return this.B_i.pop();break;case i.TextureProxyType.Wrapper:if(this.B_j.length>0)return this.B_j.pop();break;default:break}return null}}e.TexturePool=r,e.default=r},"4df3":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("b4ea");e.IShaderLibConfigure=r.IShaderLibConfigure,e.ShaderCodeType=r.ShaderCodeType,e.ShaderCodeUUID=r.ShaderCodeUUID,e.ShaderCodeConfigure=r.ShaderCodeConfigure,e.IShaderLibListener=r.IShaderLibListener,e.MaterialContext=r.MaterialContext,e.MaterialContextParam=r.MaterialContextParam;const a=i(s("b409")),n=i(s("cf91")),l=i(s("1ea6")),h=i(s("f63e")),o=s("debe"),m=s("3d98");class _ extends r.MaterialContext{constructor(){super(),this.B_k=null,this.B_l=null,this.lambertPipeline=null,this.pbrPipeline=null}createDefaultMaterial(t,e=!0){let s=new h.default;if(s.setMaterialPipeline(this.pipeline),s.setTextureList(t),e){let e=null!=t&&t.length>0&&null!=t[0];s.initializeByCodeBuf(e)}return s}createLambertLightMaterial(t=!1){let e=new a.default;return e.setMaterialPipeline(this.lambertPipeline),t&&(e.vertUniform=new o.VertUniformComp),e}createPBRLightMaterial(t=!0,e=!1,s=!1){let i=new n.default;if(i.setMaterialPipeline(this.pbrPipeline),t&&(i.decorator=new l.default),e&&(i.vertUniform=new o.VertUniformComp),null!=i.decorator&&s){if(i.decorator.hdrBrnEnabled=!0,null==this.B_l){let t="static/bytes/spe.mdf";i.decorator.hdrBrnEnabled&&(t="static/bytes/speBrn.bin"),this.B_k=new m.SpecularTextureLoader,this.B_k.hdrBrnEnabled=i.decorator.hdrBrnEnabled,this.B_k.loadTextureWithUrl(t,this.A),this.B_l=this.B_k.texture,this.B_l.__$attachThis()}i.decorator.specularEnvMap=this.B_l}return i}initialize(t,e=null,s=null){null==this.A&&(s=this.buildConfigure(e,s),super.initialize(t,e,s))}buildConfigure(t,e){if(null==e){let s=this.createShaderLibConfig(),i=null;null==t&&(t=new r.MaterialContextParam),t.loadAllShaderCode=!0,t.loadAllShaderCode&&(t.lambertMaterialEnabled&&(i=new r.ShaderCodeConfigure,i.buildBinaryFile=t.buildBinaryFile,i.uuid=r.ShaderCodeUUID.Lambert,i.types=[r.ShaderCodeType.VertHead,r.ShaderCodeType.VertBody,r.ShaderCodeType.FragHead,r.ShaderCodeType.FragBody],t.shaderCodeBinary&&(i.urls=["static/shader/glsl/lambert/glsl01.bin","static/shader/glsl/lambert/glsl02.bin","static/shader/glsl/lambert/glsl03.bin","static/shader/glsl/lambert/glsl04.bin"]),i.binary=t.shaderCodeBinary,s.shaderCodeConfigures.push(i)),t.pbrMaterialEnabled&&(i=new r.ShaderCodeConfigure,i.buildBinaryFile=t.buildBinaryFile,i.uuid=r.ShaderCodeUUID.PBR,i.types=[r.ShaderCodeType.VertHead,r.ShaderCodeType.VertBody,r.ShaderCodeType.FragHead,r.ShaderCodeType.FragBody],t.shaderCodeBinary&&(i.urls=["static/shader/glsl/pbr/glsl01.bin","static/shader/glsl/pbr/glsl02.bin","static/shader/glsl/pbr/glsl03.bin","static/shader/glsl/pbr/glsl04.bin"],i.binary=t.shaderCodeBinary),s.shaderCodeConfigures.push(i))),e=s}return e}initEnd(t){let e=this;null==this.pbrPipeline&&(e.pbrPipeline=this.createPipeline()),null==this.lambertPipeline&&(e.lambertPipeline=this.createPipeline()),this.pbrPipeline.uuid="pbr",this.lambertPipeline.uuid="lambert",super.initEnd(t)}}e.CommonMaterialContext=_},"4f27":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=s("d53d"),n=i(s("2560")),l=i(s("83d1")),h=i(s("a7ed")),o=i(s("857b")),m=i(s("e87b"));class _ extends a.ShaderUniform{use(t){}useByLocation(t,e,s,i){}useByShd(t,e){}updateData(){}destroy(){}}_.EmptyUniform=new _;class u{static appendUniformBuilder(t){u.Gb.has(t.getIDNS())||(u.Gc.push(t),u.Gb.set(t.getIDNS(),t),u.Gd=u.Gc.length)}static Initialize(){u.GD&&(u.GD=!1,u.appendUniformBuilder(new n.default),u.appendUniformBuilder(new h.default),u.appendUniformBuilder(new o.default),u.appendUniformBuilder(new l.default),u.appendUniformBuilder(new m.default))}static AddSharedUniformBuilder(t){null==t||u.Gb.has(t.getIDNS())||(u.Gc.push(t),u.Gb.set(t.getIDNS(),t),++u.Gd)}static removeSharedUniformBuilder(t){if(null!=t&&u.Gb.has(t.getIDNS())){for(let e=0;e<u.Gd;++e)if(t==u.Gc[e]){u.Gc.splice(e,1),--u.Gd;break}u.Gb.delete(t.getIDNS())}}static removeSharedUniformBuilderByName(t){if(u.Gb.has(t)){let e=u.Gb.get(t);for(let t=0;t<u.Gd;++t)if(e==u.Gc[t]){u.Gc.splice(t,1),--u.Gd;break}u.Gb.delete(t)}}static BuildShared(t,e,s){let i,r=null,a=null,n=u.Gc,l=0,h=u.Gd,o=null;for(;l<h;++l)o=n[l].create(e,s),null!=o&&(null!=a?a.next=o:null==r&&(r=o),a=o);if(null==t)i=r;else if(null!=r){for(let e=0;e<t.length;++e)a.next=t[e],a=a.next;i=r}if(null==i)i=_.EmptyUniform;else{let t=i,e=0;while(null!=t){if(null!=t.uniformNameList&&null==t.locations)for(t.types=[],t.locations=[],t.uniformSize=t.uniformNameList.length,e=0;e<t.uniformSize;++e)t.types.push(s.getUniformTypeByNS(t.uniformNameList[e])),t.locations.push(s.getUniformLocationByNS(t.uniformNameList[e]));t=t.next}}return i}static BuildLocalFromTransformV(t,e){if(null!=t){let s;return s=new a.ShaderMat4Uniform,s.uniformSize=0,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize+=1,s.uniformNameList.push("u_objMat"),s.types.push(e.getUniformTypeByNS("u_objMat")),s.locations.push(e.getUniformLocationByNS("u_objMat")),s.dataList.push(t),s.dataSizeList.push(1),s}return u.Ge}static UpdateLocalFromTransformV(t,e,s){if(null!=e){let i,r=t;return null==r?(r=new a.ShaderMat4Uniform,i=r,i.uniformSize=0,i.uniformNameList=[],i.types=[],i.locations=[],i.dataList=[],i.dataSizeList=[],i.uniformSize+=1,i.uniformNameList.push("u_objMat"),i.types.push(s.getUniformTypeByNS("u_objMat")),i.locations.push(s.getUniformLocationByNS("u_objMat")),i.dataList.push(e),i.dataSizeList.push(1)):(i=r,i.locations=[],i.locations.push(s.getUniformLocationByNS("u_objMat"))),i}return u.Ge}static BuildLocalFromData(t,e){if(null!=t){let s;s=r.default.IsWebGL1()?new a.ShaderUniformV1:new a.ShaderUniformV2,s.uns=t.uns,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize=0;let i=t,n=0;while(null!=i){if(null!=i.uniformNameList&&null==i.locations)for(s.uniformSize+=i.uniformNameList.length,n=0;n<s.uniformSize;++n)s.uniformNameList.push(i.uniformNameList[n]),s.types.push(e.getUniformTypeByNS(i.uniformNameList[n])),s.locations.push(e.getUniformLocationByNS(i.uniformNameList[n])),s.dataList.push(i.dataList[n]),s.dataSizeList.push(e.getUniformLengthByNS(i.uniformNameList[n]));i=i.next}return s}return _.EmptyUniform}static BuildLocal(t,e){let s=new a.ShaderUniform;s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize=0;let i=t,r=0;while(null!=i){if(null!=i.uniformNameList&&null==i.locations)for(s.uniformSize+=i.uniformNameList.length,r=0;r<s.uniformSize;++r)s.uniformNameList.push(i.uniformNameList[r]),s.types.push(e.getUniformTypeByNS(i.uniformNameList[r])),s.locations.push(e.getUniformLocationByNS(i.uniformNameList[r])),s.dataList.push(i.dataList[r]),s.dataSizeList.push(e.getUniformLengthByNS(i.uniformNameList[r]));i=i.next}return s}}u.GD=!0,u.Gb=new Map,u.Gc=[],u.Gd=0,u.Ge=new a.ShaderUniform,e.default=u},"519e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("cb29")),n=i(s("e7d2")),l=i(s("fecb")),h=i(s("35fa"));class o extends a.default{constructor(t=r.default.VTX_STATIC_DRAW){super(t),this.B_m=null,this.B_n=!0,this.B_o=null,this.B_U=null,this.B_p=null,this.B_e=null,this.B_q=null,this.B_r=null,this.B_s=-2,this.vsStride=3,this.uvsStride=2,this.nvsStride=3,this.cvsStride=3}setVS(t){this.B_o=t,this.B_n=!0}getVS(){return this.B_o}setUVS(t){this.B_U=t}getUVS(){return this.B_U}setNVS(t){this.B_p=t}getNVS(){return this.B_p}setTVS(t){this.B_q=t}getTVS(){return this.B_q}setBTVS(t){this.B_r=t}setCVS(t){this.B_e=t}getBTVS(){return this.B_r}setIVS(t){this.B_m=t,this.B_t=t,this.B_n=!0}initializeFromGeometry(t){this.B_o=t.getVS(),this.B_U=t.getUVS(),this.B_p=t.getNVS(),this.B_q=t.getTVS(),this.B_r=t.getBTVS(),this.B_e=t.getCVS(),this.B_t=t.getIVS(),this.B_m=this.B_t,this.B_n=!0,this.initialize()}initialize(){null!=this.B_o&&(null==this.bounds?(this.bounds=new l.default,this.bounds.addXYZFloat32Arr(this.B_o),this.bounds.update(),this.B_s=this.bounds.version):(this.B_n||this.B_s==this.bounds.version)&&(this.bounds.reset(),this.bounds.addXYZFloat32Arr(this.B_o),this.bounds.update(),this.B_s=this.bounds.version),this.B_n=!1,this.B_t=this.B_m,n.default.Reset(),n.default.AddFloat32Data(this.B_o,this.vsStride),this.isVBufEnabledAt(r.default.VBUF_UVS_INDEX)&&n.default.AddFloat32Data(this.B_U,this.uvsStride),this.isVBufEnabledAt(r.default.VBUF_NVS_INDEX)&&(null==this.B_p&&(this.vtCount=this.B_t.length,this.trisNumber=this.vtCount/3,this.B_p=new Float32Array(this.B_o.length),h.default.ClacTrisNormal(this.B_o,this.B_o.length,this.trisNumber,this.B_t,this.B_p)),n.default.AddFloat32Data(this.B_p,this.nvsStride)),this.isVBufEnabledAt(r.default.VBUF_CVS_INDEX)&&n.default.AddFloat32Data(this.B_e,this.cvsStride),this.isVBufEnabledAt(r.default.VBUF_TVS_INDEX)&&(n.default.AddFloat32Data(this.B_q,3),n.default.AddFloat32Data(this.B_r,3)),n.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.updateWireframeIvs(),this.vtCount=this.B_t.length,null!=this.B_u?n.default.UpdateBufData(this.B_u):this.B_u=n.default.CreateBySaveData(this.getBufDataUsage(),this.getBufSortFormat()),this.B_u.setUintIVSData(this.B_t),this.trisNumber=this.vtCount/3,this.buildEnd())}testRay(t,e,s,i){return-1}toString(){return"[DataMesh()]"}__$destroy(){this.isResFree()&&(this.bounds=null,this.B_o=null,this.B_U=null,this.B_p=null,this.B_e=null,this.B_q=null,this.B_r=null,this.B_m=null,super.__$destroy())}}e.default=o},5216:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["ENV_LIGHT_PARAM"]=0]="ENV_LIGHT_PARAM",t[t["ENV_AMBIENT_LIGHT"]=1]="ENV_AMBIENT_LIGHT",t[t["FOG"]=2]="FOG",t[t["FOG_EXP2"]=3]="FOG_EXP2",t[t["VSM_SHADOW"]=4]="VSM_SHADOW",t[t["GLOBAL_LIGHT"]=5]="GLOBAL_LIGHT"}(i||(i={})),e.MaterialPipeType=i},"52e0":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class n extends a.default{constructor(t,e){super(t,e,!1),this.B_v=null,this.s=r.TextureTarget.TEXTURE_CUBE,this.mipmapEnabled=!0,this.v=r.TextureProxyType.BytesCube}toAlphaFormat(){this.srcFormat=r.TextureFormat.ALPHA,this.internalFormat=r.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=r.TextureFormat.RED,this.internalFormat=r.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB,this.unpackAlignment=1}toRGBAFormat(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4}setDataFromBytesToFaceAt(t,e,s,i,r=0){if(null==this.B_v&&(this.B_v=[null,null,null,null,null,null]),s>0&&i>0){0==t&&r<1&&(this.o=s,this.p=i,this.n=r),null==this.B_v[t]&&(this.B_v[t]=new Array(16));let a=this.B_v[t];a[r]={width:s,height:i,imgData:e,miplevel:r},this.u=null!=a[r].imgData}}uploadData(t){let e,s,i=t.getRC(),a=null,n=this.getWidth(),l=this.getHeight();for(let h=0;h<6;++h){let t=this.B_v[h];if(this.mipmapEnabled&&this.w)a=t[0],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,r.TextureFormat.ToGL(i,this.internalFormat),n,l,0,r.TextureFormat.ToGL(i,this.srcFormat),r.TextureDataType.ToGL(i,this.dataType),a.imgData);else{e=n,s=l;let o=0;for(;e>0||s>0;)null!=t[o]&&(a=t[o],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+h,o,r.TextureFormat.ToGL(i,this.internalFormat),e,s,0,r.TextureFormat.ToGL(i,this.srcFormat),r.TextureDataType.ToGL(i,this.dataType),a.imgData)),e>0&&(e>>=1),s>0&&(s>>=1),++o}}this.version=0}toString(){return"[BytesCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.B_v)for(let t=0;t<6;++t)null!=this.B_v[t]&&(this.B_v[t].imgData=null);super.__$destroy()}}}e.default=n},5326:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.B_w=256,this.b=0,this.index=0,this.dataList=[],this.flagList=null,this.b=t}getUid(){return this.b}static GetSlotAt(t){return i.Gf[t]}static Initialize(t){let e=i.Gf[t];if(null==e&&(e=new i(t),i.Gf[t]=e),null==e.flagList){e.flagList=new Uint16Array(e.B_w);for(let t=0;t<e.B_w;++t)e.dataList.push(null),e.flagList[t]=0}}}i.Gf=new Array(16),e.default=i},5336:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.A_n=0,this.A_m=60,this.B_x=null,this.B_y=null,this.B_z=10,this.B_0=128,this.B_1=128,this.B_2=70,this.delayTime=40,this.statusInfo="",this.statusEnbled=!0}initialize(){var t=null;try{void 0!=document&&(t=document)}catch(e){}if(null!=t){this.B_0=window.innerWidth;let t=this.B_0-20;this.createCanvas(t)}}createCanvas(t){null==this.B_x&&(this.B_x=document.createElement("canvas"),document.body.appendChild(this.B_x),this.B_x.style.display="bolck",this.B_x.style.left="0px",this.B_x.style.top="0px",this.B_x.style.position="absolute",this.B_x.style.backgroundColor="transparent",this.B_x.style.pointerEvents="none",this.B_x.height=this.B_2),t=t<10?10:t,this.B_x.width=t,this.B_y=this.B_x.getContext("2d"),this.B_y.font="50px Verdana",this.B_y.fillStyle="red",this.B_y.textAlign="left",this.B_1=this.B_x.width}getFPS(){return this.A_m}getFPSStr(){return this.A_m>60?"FPS: 60":this.A_m<10?"FPS: 0"+this.A_m:"FPS: "+this.A_m}render(){if(this.B_0!=window.innerWidth){this.B_0=window.innerWidth;let t=this.B_0-20;this.createCanvas(t)}this.statusEnbled&&(this.B_y.clearRect(0,0,this.B_1,this.B_2),this.B_y.fillText("FPS:"+this.A_m+this.statusInfo,5,50))}update(t=!0){if(this.B_z>0)--this.B_z,this.A_n=Date.now();else{if(null!=this.B_y){let e=Date.now();this.A_n>0&&(this.A_n=e-this.A_n,this.A_m=Math.round(1e3/this.A_n),t&&this.render()),this.A_n=e}this.B_z=this.delayTime}}}e.default=i},"53ea":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("e214"));class n{constructor(){this.A_O=null,this.G_=null,this.B_3=new r.default,this.B_4=new r.default,this.B_5=new r.default(0,1,0),this.B_6=0,this.position=new r.default}bindCameraAndStage(t,e){this.A_O=t,this.G_=e}setPlaneParam(t,e){this.B_5.copyFrom(t),this.B_5.normalize(),this.B_6=e}intersectPlane(){null!=this.A_O&&null!=this.G_&&(this.A_O.update(),this.A_O.getWorldPickingRayByScreenXY(this.G_.mouseX,this.G_.mouseY,this.B_3,this.B_4),a.default.IntersectionSLV2(this.B_5,this.B_6,this.B_3,this.B_4,this.position))}destroy(){this.A_O=null,this.G_=null}}e.default=n},"557f":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class n extends a.default{constructor(t,e,s=1,i=!1){super(t,e,i),this.B_7=null,this.B_8=1,this.internalFormat=r.TextureFormat.R8,this.srcFormat=r.TextureFormat.RED,this.B_8=s,this.s=r.TextureTarget.TEXTURE_3D,this.v=r.TextureProxyType.Texture3D,this.unpackAlignment=1}getDepth(){return this.B_8}uploadFromTypedArray(t,e=0){this.isGpuEnabled()||(this.B_7=t,this.n=e,this.u=!0)}uploadData(t){if(null!=this.B_7){let e=t.getRC();e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage3D(e.TEXTURE_3D,0,r.TextureFormat.ToGL(e,this.internalFormat),this.o,this.p,this.B_8,0,r.TextureFormat.ToGL(e,this.srcFormat),e.UNSIGNED_BYTE,this.B_7),e.pixelStorei(e.UNPACK_ALIGNMENT,4)}}__$destroy(){this.getAttachCount()<1&&(this.B_7=null,super.__$destroy())}toString(){return"[Texture3DProxy(width="+this.getWidth()+",height="+this.getHeight()+",depth="+this.getDepth()+")]"}}e.default=n},"56c5":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("030e"));class a{static SetRenderer(t){a.Au=t.getRC(),a.B_9=t.getWebGLVersion();let e=a;1==a.B_9&&null!=r.default.WEBGL_draw_buffers?e.COLOR_ATTACHMENT0=r.default.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL:e.COLOR_ATTACHMENT0=a.Au.COLOR_ATTACHMENT0}static DrawBuffers(t){2==a.B_9?a.Au.drawBuffers(t):null!=r.default.WEBGL_draw_buffers&&r.default.WEBGL_draw_buffers.drawBuffersWEBGL(t)}}a.Au=null,a.B_9=2,a.COLOR_ATTACHMENT0=0,e.default=a},"5d04":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("4cf7")),n=i(s("5e78")),l=i(s("fe7f")),h=i(s("9f3e")),o=i(s("f928")),m=i(s("eaee")),_=i(s("52e0")),u=i(s("d314")),d=i(s("557f")),c=i(s("cfaf")),f=i(s("85b6")),p=i(s("da6a")),g=i(s("ccdf"));class v{constructor(){this.B_=new a.default,this.CA=null,this.A_q=null,this.CB=[],this.CC=128}addTexLoader(t){if(null!=t){let e=0,s=this.CB.length;for(;e<s;++e)if(t==this.CB[e])break;e>=s&&this.CB.push(t)}}removeTexLoader(t){if(null!=t){let e=0,s=this.CB.length;for(;e<s;++e)if(t==this.CB[e]){this.CB.slice(e,1);break}}}setRenderer(t){this.A_q=t,p.default.GetInstance().setRenderProxy(t.getRenderProxy()),null==this.CA&&null!=t&&(this.CA=new g.default(t.getRenderProxy()))}getRTTStrore(){return this.CA}createWrapperTex(t,e,s=!1){let i=new f.default(t,e,s);return i.__$setRenderProxy(this.A_q.getRenderProxy()),i}createRTTTex2D(t,e,s=!1){let i=new c.default(t,e,s);return i.__$setRenderProxy(this.A_q.getRenderProxy()),i}createImageTex2D(t,e,s=!1){let i=this.B_.getTexture(r.TextureProxyType.Image);return null==i&&(i=new n.default(t,e,s)),i.__$setRenderProxy(this.A_q.getRenderProxy()),i.mipmapEnabled=!0,i.setWrap(r.TextureConst.WRAP_REPEAT),i}createHalfFloatTex2D(t,e,s=!1){let i=this.B_.getTexture(r.TextureProxyType.Float);return null==i&&(i=new o.default(t,e,s)),i.__$setRenderProxy(this.A_q.getRenderProxy()),i.srcFormat=r.TextureFormat.RGBA,i.dataType=r.TextureDataType.HALF_FLOAT_OES,i}createFloatTex2D(t,e,s=!1){let i=this.B_.getTexture(r.TextureProxyType.Float);return null==i&&(i=new o.default(t,e,s)),i.__$setRenderProxy(this.A_q.getRenderProxy()),i}createUint16Tex2D(t,e,s=!1){return new h.default(t,e,s)}createFloatCubeTex(t,e,s=!1){return new m.default(t,e)}createBytesTex(t,e){let s=this.B_.getTexture(r.TextureProxyType.Bytes);return null==s&&(s=new l.default(t,e)),s.__$setRenderProxy(this.A_q.getRenderProxy()),s}createBytesCubeTex(t,e){let s=new _.default(t,e);return s.__$setRenderProxy(this.A_q.getRenderProxy()),s}createImageCubeTex(t,e){let s=new u.default(t,e);return s.__$setRenderProxy(this.A_q.getRenderProxy()),s}createTex3D(t,e,s=1){s<1&&(s=1);let i=new d.default(t,e,s);return i.__$setRenderProxy(this.A_q.getRenderProxy()),i}createRGBATex2D(t,e,s){t=t>1?t:1,e=e>1?e:1;let i=t*e,r=this.createBytesTex(t,e),a=new Uint8Array(4*i),n=Math.round(255*s.r),l=Math.round(255*s.g),h=Math.round(255*s.b),o=Math.round(255*s.a),m=0,_=[n,l,h,o];for(let u=0;u<i;++u)a.set(_,m),m+=4;return r.setDataFromBytes(a,0,t,e),r.__$setRenderProxy(this.A_q.getRenderProxy()),r}createAlphaTex2D(t,e,s){t=t>1?t:1,e=e>1?e:1;let i=t*e,r=this.createBytesTex(t,e);r.toAlphaFormat();let a=new Uint8Array(i),n=Math.round(255*s);return a.fill(n,0,i),r.setDataFromBytes(a,0,t,e),r.__$setRenderProxy(this.A_q.getRenderProxy()),r}createAlphaTexBytes2D(t,e,s){let i=this.createBytesTex(t,e);return i.setDataFromBytes(s,0,t,e),i.toAlphaFormat(),i.__$setRenderProxy(this.A_q.getRenderProxy()),i}getCubeRTTTextureAt(t){return this.CA.getCubeRTTTextureAt(t)}createCubeRTTTextureAt(t,e,s){return this.CA.createCubeRTTTextureAt(t,e,s)}getRTTTextureAt(t){return this.CA.getRTTTextureAt(t)}createRTTTextureAt(t,e,s){return this.CA.createRTTTextureAt(t,e,s)}getDepthTextureAt(t){return this.CA.getDepthTextureAt(t)}createDepthTextureAt(t,e,s){return this.CA.createDepthTextureAt(t,e,s)}getRTTFloatTextureAt(t){return this.CA.getRTTFloatTextureAt(t)}createRTTFloatTextureAt(t,e,s){return this.CA.createRTTFloatTextureAt(t,e,s)}run(){let t=0,e=this.CB.length;for(;t<e;++t)this.CB[t].run();if(this.CC<1){let t;this.CC=128;let e=p.default.GetInstance().getFreeResUidMap(),s=32;for(const[i,r]of e){if(s<1)break;s--,r>2?(e.delete(i),t=p.default.GetInstance().removeTextureByUid(i),null!=t&&this.B_.addTexture(t)):e.set(i,r+1)}}this.CC--}}e.TextureBlock=v,e.default=v},"5e78":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("7181")),n=i(s("0851"));class l extends n.default{constructor(t,e,s=!1){super(t,e,s),this.CD=null,this.CE=null,this.CF=0,this.mipmapEnabled=!0,this.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,this.v=r.TextureProxyType.Image}getTexData(){return this.CD}setDataFromImage(t,e=0,s=0,i=0,r=!1){if(null!=t&&t.width>0&&t.height>0){this.u=!0,e<0&&(e=0),e>15&&(e=15),e>=this.CF&&(this.CF=e+1);let n=this.CD;null!=n?this.CD.miplevel!=e?(null==this.CE&&(this.CE=[this.CD,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),n=this.CE[e],null==n&&(n=a.default.Create(),n.miplevel=e,r=!0,this.CE[e]=n)):this.isGpuEnabled()&&(n.status=0):(n=this.CD=a.default.Create(),n.miplevel=e,r=!0,this.o=t.width,this.p=t.height),n.data==t&&n.offsetx==s&&n.offsety==i||(0==e&&(this.o=t.width,this.p=t.height),n.data=t,n.status=0,(n.width<t.width||n.height<t.height||r)&&(n.width=t.width,n.height=t.height,n.status=1),n.offsetx=s,n.offsety=i),this.version++}}uploadData(t){null!=this.CD&&this.dataUploadToGpu(t.getRC(),this.CD,this.CE,!0),this.version=0}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())&&null!=this.CD){let e=t.getRC();this.__$updateToGpuBegin(t),this.dataUploadToGpu(e,this.CD,this.CE),this.__$buildParam(e),this.w=!0}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.CE){for(let t=0;t<this.CF;++t)a.default.Restore(this.CE[t]);this.CF=0,this.CE=null,this.CD=null}null!=this.CD&&(a.default.Restore(this.CD),this.CD=null),super.__$destroy()}}toString(){return"[ImageTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=l},"5f3c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("df9d")),n=s("7c63");class l{constructor(t){this.b=-1,this.CG=new a.default,this.A_K=null,this.index=-1,this.shdUid=-1,this.procuid=-1,this.batchEnabled=!0,this.fixedState=!0,this.runMode=0,this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null,this.A_K=t,this.b=l.F_0++}showInfo(){this.CG.showInfo()}addNode(t){this.CG.addNodeAndSort(t)}rejoinNode(t){this.CG.containsNode(t)&&(this.CG.removeNodeAndSort(t),this.CG.addNodeAndSort(t))}removeNode(t){this.CG.removeNodeAndSort(t)}isEmpty(){return null==this.CG.getBegin()}run(t){switch(this.runMode){case 2:this.run2(t);break;case 1:this.run1(t);break;case 0:this.run0(t);break;default:break}}run0(t){let e=this.CG.getBegin();if(null!=e){this.A_K.bindToGpu(this.shdUid),this.A_K.resetUniform();let s=null;while(null!=e)e.drawEnabled&&(s=e.unit,s.drawEnabled&&(s.run(t),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}run1(t){let e=this.CG.getBegin();if(null!=e){this.A_K.bindToGpu(this.shdUid),this.A_K.resetUniform();let s=null,i=this.CG.getVtxTotalAt(e.rvroI),r=this.CG.getTexTotalAt(e.rtroI),a=i>0,n=r>0;while(null!=e)i<1&&(i=this.CG.getVtxTotalAt(e.rvroI),a=!0),i--,r<1&&(r=this.CG.getTexTotalAt(e.rtroI),n=!0),r--,e.drawEnabled&&(s=e.unit,s.drawEnabled&&(a&&(e.vro.run(),a=!1),n&&(e.tro.run(),n=!1),s.run2(t),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}run2(t){let e=this.CG.getBegin();if(null!=e){this.A_K.bindToGpu(this.shdUid),this.A_K.resetUniform();let s=null;n.RenderStateObject.UseRenderState(e.unit.renderState),n.RenderColorMask.UseRenderState(e.unit.rcolorMask);let i=this.CG.getVtxTotalAt(e.rvroI),r=this.CG.getTexTotalAt(e.rtroI),a=i>0,l=r>0;while(null!=e)i<0&&(i=this.CG.getVtxTotalAt(e.rvroI),a=!0),i--,r<0&&(r=this.CG.getTexTotalAt(e.rtroI),l=!0),r--,e.drawEnabled&&(s=e.unit,s.drawEnabled&&(a&&(e.vro.run(),a=!1),l&&(e.tro.run(),l=!1),null!=s.ubo&&s.ubo.run(t),this.A_K.useTransUniform(s.transUniform),this.A_K.useUniform(s.uniform),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}runLockMaterial(t){let e=this.CG.getBegin();if(null!=e){this.A_K.bindToGpu(this.shdUid),this.A_K.resetUniform();let s=this.A_K.isTextureUnLocked();t.Texture.unlocked=s;let i=null;if(this.batchEnabled){let r=this.CG.getVtxTotalAt(e.rvroI),a=r>0;while(null!=e)r<1&&(r=this.CG.getVtxTotalAt(e.rvroI),a=!0),r--,i=e.unit,e.drawEnabled&&i.drawEnabled&&(a&&(e.vro.run(),a=!1),s&&e.tro.run(),i.runLockMaterial2(null),i.partTotal<1?i.drawThis(t):i.drawPart(t)),e=e.next}else while(null!=e)i=e.unit,e.drawEnabled&&i.drawEnabled&&(i.runLockMaterial(),s&&e.tro.run(),i.partTotal<1?i.drawThis(t):i.drawPart(t)),e=e.next;t.Texture.unlocked=!1}}drawUnit(t,e,s){e.drawEnabled&&(this.A_K.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t))}drawLockMaterialByUnit(t,e,s,i,a){if(e.drawEnabled){if(a&&this.A_K.resetUniform(),r.default.IsMobileWeb()){let t=this.vtxResource.getVROByResUid(s.vbuf.getUid(),this.A_K.getCurrentShd(),!0);t.run()}else e.vro.run();e.runLockMaterial2(i?this.A_K.__$globalUniform:null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}}reset(){let t=this.CG.getBegin(),e=null;if(null!=t){let s;while(null!=t)e=t,t=t.next,this.rpoUnitBuilder.setRPNodeParam(e.__$ruid,this.procuid,-1),e.reset(),s=e.unit,this.rpoNodeBuilder.restore(e)&&this.rpoUnitBuilder.restore(s)}this.index=-1,this.shdUid=-1,this.procuid=-1,this.CG.clear(),this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null}destroy(){this.reset()}getUid(){return this.b}toString(){return"[RPOBlock(uid = "+this.b+", index = "+this.index+", shdUid = "+this.shdUid+")]"}}l.F_0=0,e.default=l},"617e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("29ef")),a=i(s("402a")),n=i(s("4835")),l=i(s("efce")),h=i(s("725b")),o=s("cc48");class m extends a.default{constructor(t=!0){super(),this.A_R=!0,this.CH=null,this.CI=null,this.A_U="",this.A_V=.5,this.A_W=.5,this.flipVerticalUV=!1,this.A_R=t}setAlignFactor(t,e){this.A_V=t,this.A_W=e,null!=this.CI&&this.CI.updateCharStr(this.A_U)}alignLeftTop(){this.setAlignFactor(0,0)}alignCenter(){this.setAlignFactor(.5,.5)}alignLeftCenter(){this.setAlignFactor(0,.5)}setText(t){null!=this.CI&&(this.A_U=t,this.CI.alignFactorX=this.A_V,this.CI.alignFactorY=this.A_W,this.CI.updateCharStr(t),this.update())}setRGBA4f(t,e,s,i){null!=this.CH&&this.CH.setRGBA4f(t,e,s,i)}setRGB3f(t,e,s){null!=this.CH&&this.CH.setRGB3f(t,e,s)}setAlpha(t){this.CH.setAlpha(t)}getAlpha(){return this.CH.getAlpha()}setBrightness(t){this.CH.setBrightness(t)}getBrightness(){return this.CH.getBrightness()}getWidth(){return this.CI.getWidth()*this.CH.getScaleX()}getHeight(){return this.CI.getHeight()*this.CH.getScaleY()}setXYZ(t,e,s){null!=this.CH&&this.CH.setXY(t,e)}setXY(t,e){null!=this.CH&&this.CH.setXY(t,e)}setX(t){null!=this.CH&&this.CH.setX(t)}setY(t){null!=this.CH&&this.CH.setY(t)}getX(){return null!=this.CH?this.CH.getX():0}getY(){return null!=this.CH?this.CH.getY():0}setScale(t){null!=this.CH&&this.CH.setScale(t)}getScaleX(){return this.CH.getScaleX()}getScaleY(){return this.CH.getScaleY()}setScaleX(t){this.CH.setScaleX(t)}setScaleY(t){this.CH.setScaleY(t)}setScaleXY(t,e){this.CH.setScaleXY(t,e)}createMaterial(t){null==this.getMaterial()?(this.CH=new n.default,this.CH.setTextureList(t),this.setMaterial(this.CH)):this.CH.setTextureList(t)}initialize(t,e=null){this.A_U=t,this.spaceCullMask=o.SpaceCullingMask.NONE,this.spaceCullMask=0,this.A_V=0,this.A_W=0,null==e?this.createMaterial([h.default.GetInstance().getTextureAt(0)]):this.createMaterial(e),this.activeDisplay(),this.setRenderState(r.default.BACK_TRANSPARENT_ALWAYS_STATE)}createBounds(){}__activeMesh(t){if(null==this.getMesh()){let e=new l.default;e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.alignFactorX=this.A_V,e.alignFactorY=this.A_W,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.A_U),this.setMesh(e),this.CI=e}}update(){this.A_R&&this.A_X.isGeomDynamic()&&this.setIvsParam(0,this.A_X.vtCount),this.A_Y.update()}toString(){return"Text2DEntity(uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=m},"644c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}static GetTypeByTypeNS(t){switch(t){case"mat4":return i.SHADER_MAT4;case"mat3":return i.SHADER_MAT3;case"mat2":return i.SHADER_MAT2;case"float":return i.SHADER_FLOAT;case"int":return i.SHADER_INT;case"vec4":return i.SHADER_VEC4;case"vec3":return i.SHADER_VEC3;case"vec2":return i.SHADER_VEC2;case"vec4[]":return i.SHADER_VEC4FV;case"vec3[]":return i.SHADER_VEC3FV;case"vec2[]":return i.SHADER_VEC2FV;case"sampler2D":return i.SHADER_SAMPLER2D;case"sampler3D":return i.SHADER_SAMPLER3D;case"samplerCube":return i.SHADER_SAMPLERCUBE;default:break}return i.SHADER_UNDEFINED}static GetTypeNSByType(t){switch(t){case i.SHADER_MAT4:return"mat4";case i.SHADER_MAT3:return"mat3";case i.SHADER_MAT2:return"mat2";case i.SHADER_FLOAT:return"float";case i.SHADER_VEC4:return"vec4";case i.SHADER_VEC3:return"vec3";case i.SHADER_VEC2:return"vec2";case i.SHADER_SAMPLER2D:return"sampler2D";case i.SHADER_SAMPLER3D:return"sampler3D";case i.SHADER_SAMPLERCUBE:return"samplerCube";case i.SHADER_UNDEFINED:return"undefined";default:break}return""}}i.ATTRINS_VTX_VS="a_vs",i.ATTRINS_VTX_UVS="a_uvs",i.ATTRINS_VTX_NVS="a_nvs",i.ATTRINS_VTX_CVS="a_cvs",i.UNIFORMNS_OBJ_MAT_NS="u_objMat",i.UNIFORMNS_VIEW_MAT_NS="u_viewMat",i.UNIFORMNS_PROJ_MAT_NS="u_projMat",i.SHADER_UNDEFINED=3010,i.SHADER_VEC2=3011,i.SHADER_VEC3=3012,i.SHADER_VEC4=3013,i.SHADER_VEC2FV=3014,i.SHADER_VEC3FV=3015,i.SHADER_VEC4FV=3016,i.SHADER_MAT2=3017,i.SHADER_MAT3=3018,i.SHADER_MAT4=3019,i.SHADER_FLOAT=3020,i.SHADER_INT=3021,i.SHADER_MAT2FV=3022,i.SHADER_MAT3FV=3023,i.SHADER_MAT4FV=3024,i.SHADER_SAMPLER2D=3031,i.SHADER_SAMPLERCUBE=3032,i.SHADER_SAMPLER3D=3033,i.SHADER_PRECISION_LOWP=3101,i.SHADER_PRECISION_MEDIUMP=3111,i.SHADER_PRECISION_HIGHP=3121,i.UNIFORM_TEX_SAMPLER2D="sampler2D",i.UNIFORM_TEX_SAMPLERCUBE="samplerCube",i.UNIFORM_TEX_SAMPLER3D="sampler3D",i.UNIFORMNS_TEX_SAMPLER_0="u_sampler0",i.UNIFORMNS_TEX_SAMPLER_1="u_sampler1",i.UNIFORMNS_TEX_SAMPLER_2="u_sampler2",i.UNIFORMNS_TEX_SAMPLER_3="u_sampler3",i.UNIFORMNS_TEX_SAMPLER_4="u_sampler4",i.UNIFORMNS_TEX_SAMPLER_5="u_sampler5",i.UNIFORMNS_TEX_SAMPLER_6="u_sampler6",i.UNIFORMNS_TEX_SAMPLER_7="u_sampler7",i.UNIFORMNS_TEX_SAMPLER_LIST=[i.UNIFORMNS_TEX_SAMPLER_0,i.UNIFORMNS_TEX_SAMPLER_1,i.UNIFORMNS_TEX_SAMPLER_2,i.UNIFORMNS_TEX_SAMPLER_3,i.UNIFORMNS_TEX_SAMPLER_4,i.UNIFORMNS_TEX_SAMPLER_5,i.UNIFORMNS_TEX_SAMPLER_6,i.UNIFORMNS_TEX_SAMPLER_7],e.default=i},6661:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("faa5")),n=i(s("b3bd")),l=i(s("0fc4"));class h extends a.default{constructor(){super(),this.j_=""}initialize(t){this.j_="PingpongHBlurBlurShd"}getFragShaderCode(){let t="";return t=r.default.IsWebGL2()?"#version 300 es\nprecision mediump float;\nfloat weight[5] = float[] (0.227027, 0.1945946, 0.1216216, 0.054054, 0.016216);\nuniform vec4 u_texSize;\nuniform sampler2D u_sampler0;\nin vec2 v_uvs;\nout vec4 FragColor;\nvoid main()\n{\n    vec2 tex_offset = u_texSize.w / u_texSize.xy;\n    float dx = tex_offset.x;\n    tex_offset.y = 0.0;\n    vec4 result = texture(u_sampler0, v_uvs) * weight[0];\n    for(int i = 1; i < 5; ++i)\n    {\n        tex_offset.x = dx * float(i);\n        result += texture(u_sampler0, v_uvs + tex_offset) * weight[i];\n        result += texture(u_sampler0, v_uvs - tex_offset) * weight[i];\n    }\n    FragColor = result;\n}\n":"\nprecision mediump float;\nuniform vec4 u_texSize;\nuniform sampler2D u_sampler0;\nin vec2 v_uvs;\nout vec4 FragColor;\nvoid main()\n{\n    vec2 tex_offset = u_texSize.w / u_texSize.xy;\n    float dx = tex_offset.x;\n    tex_offset.y = 0.0;\n    vec4 result = texture2D(u_sampler0, v_uvs) * 0.227027;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.1945946;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.1945946;\n    tex_offset.x = dx * 2.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.1216216;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.1216216;\n    tex_offset.x = dx * 3.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.054054;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.054054;\n    tex_offset.x = dx * 4.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.016216;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.016216;\n    FragColor = result;\n}\n",t}getVertShaderCode(){let t="#version 300 es\nprecision mediump float;\nlayout(location = 0) in vec3 a_vs;\nlayout(location = 1) in vec2 a_uvs;\nout vec2 v_uvs;\nvoid main()\n{\n    gl_Position = vec4(a_vs, 1.0);\n    v_uvs = vec2(a_uvs.x, a_uvs.y);\n}\n";return t}getUniqueShaderName(){return this.j_}toString(){return"[PingpongHBlurShaderBuffer()]"}static GetInstance(){return h.F_2}}h.F_2=new h;class o extends a.default{constructor(){super(),this.j_=""}initialize(t){this.j_="PingpongVBlurBlurShd"}getFragShaderCode(){let t="";return t=r.default.IsWebGL2()?"#version 300 es\nprecision mediump float;\nfloat weight[5] = float[] (0.227027, 0.1945946, 0.1216216, 0.054054, 0.016216);\nuniform vec4 u_texSize;\nuniform sampler2D u_sampler0;\nin vec2 v_uvs;\nout vec4 FragColor;\nvoid main()\n{\n    //vec2 tex_offset = u_texSize.w / vec2(textureSize(u_sampler0, 0));\n    vec2 tex_offset = u_texSize.w / u_texSize.xy;\n    float dy = tex_offset.y;\n    tex_offset.x = 0.0;\n    vec4 result = texture(u_sampler0, v_uvs) * weight[0];\n    for(int i = 1; i < 5; ++i)\n    {\n        tex_offset.y = dy * float(i);\n        result += texture(u_sampler0, v_uvs + tex_offset) * weight[i];\n        result += texture(u_sampler0, v_uvs - tex_offset) * weight[i];\n    }\n    FragColor = result;\n}\n":"\nprecision mediump float;\nuniform vec4 u_texSize;\nuniform sampler2D u_sampler0;\nin vec2 v_uvs;\nout vec4 FragColor;\nvoid main()\n{\n    vec2 tex_offset = u_texSize.w / u_texSize.xy;\n    float dy = tex_offset.y;\n    tex_offset.x = 0.0;\n    vec4 result = texture2D(u_sampler0, v_uvs) * 0.227027;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.1945946;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.1945946;\n    tex_offset.y = dy * 2.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.1216216;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.1216216;\n    tex_offset.y = dy * 3.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.054054;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.054054;\n    tex_offset.y = dy * 4.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.016216;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.016216;\n\n    FragColor = result;\n}\n",t}getVertShaderCode(){let t="#version 300 es\nprecision mediump float;\nlayout(location = 0) in vec3 a_vs;\nlayout(location = 1) in vec2 a_uvs;\nout vec2 v_uvs;\nvoid main()\n{\n    gl_Position = vec4(a_vs, 1.0);\n    v_uvs = vec2(a_uvs.x, a_uvs.y);\n}\n";return t}getUniqueShaderName(){return this.j_}toString(){return"[PingpongVBlurShaderBuffer()]"}static GetInstance(){return o.F_2}}o.F_2=new o,e.PingpongVBlurShaderBuffer=o;class m extends l.default{constructor(t=0){super(),this.CJ=0,this.CK=new Float32Array([800,600,0,0]),this.CJ=t}setTexSize(t,e){this.CK[0]=t,this.CK[1]=e}setBlurDensity(t){this.CK[3]=t}getCodeBuf(){return this.CJ>0?o.GetInstance():h.GetInstance()}createSelfUniformData(){let t=new n.default;return t.uniformNameList=["u_texSize"],t.dataList=[this.CK],t}}e.default=m},"670e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("45db"),r=s("8ae4");class a{constructor(){this.version=-1,this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.vertex=new i.ROVertexRes,this.indices=new r.ROIndicesRes,this.k=0}__$attachThis(){++this.k}__$detachThis(){--this.k,this.k<1&&(this.k=0)}getAttachCount(){return this.k}createVRO(t,e,s){let i=this.vertex.createVRO(t,e,s,this.indices,this.indices.getUid());return i.ibufStep=this.indices.ibufStep,i}updateToGpu(t){this.indices.updateToGpu(t),this.vertex.updateToGpu(t)}destroy(t){this.getAttachCount()<1&&this.resUid>=0&&(this.vertex.destroy(t),this.indices.destroy(t),this.resUid=-1)}}e.GpuVtxObject=a},"68aa":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,s,i,r,a){1==this.status||a?t.texImage2D(e,this.miplevel,s,this.width,this.height,0,i,r,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,this.width,this.height,i,r,this.data),this.status=-1}static Create(){return i.Gg.length>0?i.Gg.pop():new i}static Restore(t){null!=t&&(t.data=null,i.Gg.push(t))}}i.Gg=[],e.default=i},"69ed":function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["VertHead"]="vertHead",t["VertBody"]="vertBody",t["FragHead"]="fragHead",t["FragBody"]="fragBody"}(i||(i={})),e.ShaderCodeType=i},"6a30":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("3930"));class n{constructor(){this.direction=new r.default(0,-1,0,0),this.color=new a.default(1,1,1,1),this.attenuationFactor1=0,this.attenuationFactor2=0}}e.DirectionLight=n},"6d49":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("baae")),n=s("8d98"),l=i(s("56c5"));class h{constructor(t,e,s){this.b=-1,this.I=0,this.CL=0,this.CM=null,this.CN=null,this.CO=null,this.CP=null,this.B_1=512,this.B_2=512,this.CQ=0,this.F_=null,this.CR=0,this.CS=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.CT=[!0,!0,!0,!0,!0,!0,!0,!0],this.CU=0,this.CV=0,this.Ac=0,this.CW=0,this.CX=new Float32Array(1),this.CY=new Float32Array(4),this.CZ=new Int16Array(4),this.Ca=!1,this.textureLevel=0,this.sizeFixed=!1,this.writeDepthEnabled=!0,this.writeStencilEnabled=!1,this.multisampleEnabled=!1,this.multisampleLevel=0,this.Cb=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.Cc=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.Cd=0,this.Ce=!1,this.Cf=2,this.Cg=2,this.I=t,this.A_6=e,this.CQ=s,this.b=h.F_0++}getUid(){return this.b}resetAttachmentMask(t){let e=this.CT.length-1;while(e>=0)this.CT[e]=t,--e}setAttachmentMaskAt(t,e){this.CT[t]=e}getActiveAttachmentTotal(){return this.Ce?this.Ac-1:this.Ac}getAttachmentTotal(){return this.CT.length}bindToBackbuffer(t){switch(t){case a.default.DRAW_FRAMEBUFFER:this.F_.bindFramebuffer(this.F_.DRAW_FRAMEBUFFER,null);break;case a.default.READ_FRAMEBUFFER:this.F_.indFramebuffer(this.F_.READ_FRAMEBUFFER,null);break;default:this.F_.bindFramebuffer(this.F_.FRAMEBUFFER,null)}}bind(t){if(null!=this.CM)switch(t){case a.default.DRAW_FRAMEBUFFER:this.F_.bindFramebuffer(this.F_.DRAW_FRAMEBUFFER,this.CM);break;case a.default.READ_FRAMEBUFFER:this.F_.bindFramebuffer(this.F_.READ_FRAMEBUFFER,this.CM);break;default:this.F_.bindFramebuffer(this.F_.FRAMEBUFFER,this.CM)}}getFBO(){return this.CM}getDepthStencilRBO(){return this.CN}getDepthRBO(){return this.CO}getWidth(){return this.B_1}getHeight(){return this.B_2}getFramebufferType(){return this.CQ}renderToTexAt(t,e,s){let i=null!=e?e.internalFormat:-1;this.F_=t,0==s&&(this.Cd=0,this.Ce=!1,this.F_.bindFramebuffer(this.CR,this.CM),i!=n.TextureFormat.DEPTH_COMPONENT&&i!=n.TextureFormat.DEPTH_STENCIL&&(this.Ac=0,this.CW=0));let r=-1,a=null;null!=e?(r=e.getTargetType(),a=this.A_6.getGpuBuffer(e.getResUid()),e.uploadFromFbo(this.A_6,this.B_1,this.B_2)):r=this.CS[this.Ac],this.framebufferTextureBind(t,r,i,a)}glFramebufferTex2D(t,e){let s=this.F_;s.framebufferTexture2D(this.CR,t,s.TEXTURE_2D,e,0),this.Cb[this.Cd]=t,this.Cc[this.Cd]=s.TEXTURE_2D,this.Cd++}glFramebufferTexCube(t,e,s){let i=this.F_;i.framebufferTexture2D(this.CR,t,i.TEXTURE_CUBE_MAP_POSITIVE_X+e,s,0),this.Cb[this.Cd]=t,this.Cc[this.Cd]=i.TEXTURE_CUBE_MAP_POSITIVE_X+e,this.Cd++}framebufferTexture2D(t,e,s,i){let r=-1;switch(s){case n.TextureFormat.DEPTH_COMPONENT:this.Ce=!0,r=this.F_.DEPTH_ATTACHMENT;break;case n.TextureFormat.DEPTH_STENCIL:this.Ce=!0,r=this.F_.DEPTH_STENCIL_ATTACHMENT;break;default:r=this.CL+this.CW;break}r>0&&(this.CT[this.Ac]?(this.glFramebufferTex2D(r,i),++this.CW,this.CS[this.Ac]=null!=i?e:0):this.CS[this.Ac]=0,++this.Ac)}framebufferTextureBind(t,e,s,i){switch(e){case n.TextureTarget.TEXTURE_2D:this.framebufferTexture2D(t,e,s,i);break;case n.TextureTarget.TEXTURE_CUBE:let r=0;for(let t=0;t<6;++t)this.CT[t]?(this.glFramebufferTexCube(this.CL+this.CW,t,i),++this.CW,this.CS[this.Ac+t]=null!=i?e:0,r++):this.CS[this.Ac+t]=0;r=r>0?r:6,this.Ac+=r;break;case n.TextureTarget.TEXTURE_SHADOW_2D:this.CT[this.Ac]?(this.glFramebufferTex2D(this.F_.DEPTH_ATTACHMENT,i),this.CS[this.Ac]=null!=i?e:0):this.CS[this.Ac]=0,++this.Ac;break;default:break}}reset(){this.CU=-1,this.CV=-1}use(t){if(this.F_=t,null!=this.CM){if(this.Ac>1){if(this.CV!=this.CW){let t=[],e=0;for(;e<this.CW;++e)t.push(this.CL+e);if(this.CV>this.CW)for(;e<this.CV;++e)this.F_.framebufferTexture2D(this.CR,this.Cb[e],this.Cc[e],null,0);l.default.DrawBuffers(t),this.CV=this.CW}}else if(this.CV!=this.CW){if(this.CV>this.CW)for(let e=1;e<this.CV;++e)this.F_.framebufferTexture2D(this.CR,this.Cb[e],this.Cc[e],null,0);let t=[this.CL];l.default.DrawBuffers(t),this.CV=this.CW}this.CU=this.Ac}}clearOnlyColor(t){if(null!=this.CM)if(r.default.IsWebGL2())if(this.CY[0]=t.r,this.CY[1]=t.g,this.CY[2]=t.b,this.CY[3]=t.a,this.CU>1)for(let e=0;e<this.CU;++e)this.F_.clearBufferfv(this.F_.COLOR,e,this.CY);else this.F_.clearBufferfv(this.F_.COLOR,0,this.CY);else this.F_.clearColor(t.r,t.g,t.b,t.a)}clearOnlyDepth(t=1){r.default.IsWebGL2()?(this.CX[0]=t,this.F_.clearBufferfv(this.F_.DEPTH,0,this.CX)):this.F_.clearDepth(t)}clearOnlyStencil(t){this.CZ[0]=t,this.F_.clearBufferuiv(this.F_.STENCIL,0,this.CZ)}clearOnlyDepthAndStencil(t,e){this.F_.clearBufferfi(this.F_.DEPTH_STENCIL,0,t,e)}invalidateFramebuffer(){}resize(t,e){this.Cf==t&&this.Cg==e||(this.Ca=!0,this.Cf=t,this.Cg=e)}initialize(t,e,s){this.F_=t,this.CL=l.default.COLOR_ATTACHMENT0,this.Ca&&(e=this.Cf,s=this.Cg),null==this.CM?this.createNewFBO(t,e,s):this.B_1==e&&this.B_2==s||this.createNewFBO(t,e,s),this.Ca=!1}isSizeChanged(){return this.Ca}destroy(t){null!=this.CM&&(null!=this.CN&&(t.deleteFramebuffer(this.CN),this.CN=null),null!=this.CO&&(t.deleteFramebuffer(this.CO),this.CO=null),null!=this.CP&&(t.deleteFramebuffer(this.CP),this.CP=null),t.deleteFramebuffer(this.CM),this.CM=null),this.F_=null,this.CR=0,this.Ca=!1}buildDepthStencilRBO(t,e,s){null==this.CN&&(this.CN=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.CN),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_STENCIL,e,s),t.framebufferRenderbuffer(this.CR,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.CN),null==this.CP&&(this.CP=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.CP),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.CR,this.CL,t.RENDERBUFFER,this.CP)):(t.bindRenderbuffer(t.RENDERBUFFER,this.CN),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e,s),t.framebufferRenderbuffer(this.CR,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.CN))}buildDepthRBO(t,e,s){null==this.CO&&(this.CO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.CO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_COMPONENT24,e,s),t.framebufferRenderbuffer(this.CR,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.CO),null==this.CP&&(this.CP=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.CP),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.CR,this.CL,t.RENDERBUFFER,this.CP)):(t.bindRenderbuffer(t.RENDERBUFFER,this.CO),r.default.IsWebGL2()?t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT24,e,s):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,s),t.framebufferRenderbuffer(this.CR,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.CO))}buildStencilRBO(t,e,s){null==this.CN&&(null==this.CN&&(this.CN=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.CN),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.STENCIL_INDEX8,e,s),t.framebufferRenderbuffer(this.CR,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.CN),null==this.CP&&(this.CP=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.CP),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.CR,this.CL,t.RENDERBUFFER,this.CP)):(t.bindRenderbuffer(t.RENDERBUFFER,this.CN),t.renderbufferStorage(t.RENDERBUFFER,t.STENCIL_INDEX8,e,s),t.framebufferRenderbuffer(this.CR,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.CN)))}buildColorRBO(t,e,s){this.multisampleEnabled&&(null==this.CP&&(this.CP=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.CP),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.CR,this.CL,t.RENDERBUFFER,this.CP))}createNewFBO(t,e,s){let i=null==this.CM;switch(this.CU=this.Ac=0,this.CV=this.CW=0,this.B_1=e,this.B_2=s,this.Cf=e,this.Cg=s,i&&(this.CM=t.createFramebuffer()),this.CQ){case a.default.DRAW_FRAMEBUFFER:this.CR=t.DRAW_FRAMEBUFFER;break;case a.default.READ_FRAMEBUFFER:this.CR=t.READ_FRAMEBUFFER;break;default:this.CR=t.FRAMEBUFFER;break}if(t.bindFramebuffer(this.CR,this.CM),this.writeDepthEnabled?this.writeStencilEnabled?null==this.CN&&this.buildDepthStencilRBO(t,e,s):this.buildDepthRBO(t,e,s):this.writeStencilEnabled?this.buildStencilRBO(t,e,s):this.buildColorRBO(t,e,s),i){t.checkFramebufferStatus(this.CR);t.FRAMEBUFFER_COMPLETE}h.BindToBackbuffer(t,this.CQ)}static BindToBackbuffer(t,e){switch(e){case a.default.DRAW_FRAMEBUFFER:t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null);break;case a.default.READ_FRAMEBUFFER:t.indFramebuffer(t.READ_FRAMEBUFFER,null);break;default:t.bindFramebuffer(t.FRAMEBUFFER,null);break}}}h.F_0=0,e.default=h},"6e01":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Clamp(t,e,s){return Math.max(Math.min(t,s),e)}static IsPowerOf2(t){return 0==(t&t-1)}static CalcCeilPowerOfTwo(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}static CalcNearestCeilPow2(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}static CalcFloorCeilPow2(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}static DegreeToRadian(t){return i.MATH_PI_OVER_180*t}static Log2(t){return Math.log(t)/Math.LN2}static GetMaxMipMapLevel(t,e){return Math.round(i.Log2(Math.max(t,e))+1)}static SafeACos(t){return t<=-1?i.MATH_PI:t>=1?0:Math.acos(t)}static GetNearestCeilPow2(t){let e=1;while(e<t)e<<=1;return e}static GetMinRadian(t,e){return e%=i.MATH_2PI,t%=i.MATH_2PI,e<t?(e=i.MATH_2PI-t+e,e>i.MATH_PI?e-i.MATH_2PI:e):e>t?(t=i.MATH_2PI-e+t,t>i.MATH_PI?i.MATH_2PI-t:-t):0}static GetMinDegree(t,e){let s=0;return e>=270&&t<90?s=(e-(t+360))%180:e<=90&&t>=270?s=(e+360-t)%180:(s=e-t,s>180?(s-=360,s%=360):s<-180&&(s+=360,s%=360)),s}static GetDegreeByXY(t,e){if(Math.abs(t)<1e-5)return e>=0?270:90;let s=180*Math.atan(e/t)/Math.PI;return t>=0?s:180+s}static GetRadianByXY(t,e){if(Math.abs(t)<i.MATH_MIN_POSITIVE)return e>=0?i.MATH_1PER2PI:i.MATH_3PER2PI;let s=Math.atan(e/t);return t>=0?s:i.MATH_PI+s}static GetRadianByCos(t,e,s){var r=Math.acos(t);return e>=0?r:i.MATH_PI+r}}i.MATH_MIN_POSITIVE=1e-5,i.MATH_MAX_NEGATIVE=-1e-5,i.MATH_MAX_POSITIVE=268435454,i.MATH_MIN_NEGATIVE=-268435454,i.MATH_1_OVER_255=1/255,i.MATH_PI=Math.PI,i.MATH_2PI=2*i.MATH_PI,i.MATH_3PER2PI=1.5*i.MATH_PI,i.MATH_1PER2PI=.5*i.MATH_PI,i.MATH_1_OVER_PI=1/i.MATH_PI,i.MATH_1_OVER_360=1/360,i.MATH_1_OVER_180=1/180,i.MATH_180_OVER_PI=180/i.MATH_PI,i.MATH_PI_OVER_180=i.MATH_PI/180,i.MATH_LN2=.6931471805599453,e.default=i},7045:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.phase=0,this.type=i.KEY_DOWN,this.target=null,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.repeat=!1,this.key="",this.keyCode=0,this.location=0}getClassType(){return i.EventClassType}toString(){return"[KeyboardEvent]"}}i.EventClassType=1003,i.KEY_DOWN=6001,i.KEY_UP=6002,e.default=i},"70f2":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("0236")),l=i(s("c51d")),h=i(s("af68")),o=i(s("a80a")),m=i(s("a446")),_=i(s("c711")),u=i(s("955e")),d=i(s("765c")),c=i(s("af29"));class f{constructor(t,e,s){this.b=-1,this.t_=null,this.l=null,this.AK=null,this.A_q=null,this.BP=null,this.Ch=new Uint8Array(128),this.Ci=0,this.Cj=null,this.Ck=new a.default,this.Cl=new a.default,this.Cm=null,this.Cn=!1,this.Co=null,this.Cp=!0,this.A_O=null,this.J=0,this.K=0,this.L=800,this.M=800,this.Cq=null,this.Cr=null,this.Cs=!0,this.Ct=null,this.A_N=null,this.A_K=null,this.Cu=-1,this.Cv=!0,this.Cw=null,this.A_P=!0,this.textureBlock=null,this.Cx=[],this.Cy=0,this.Cz=!0,this.C0=!0,this.C1=!0,this.C2=!0,this.Cn=s,this.BP=t,this.A_q=e,this.A_K=e.getDataBuilder().getRenderShader(),this.b=1024+f.__s_uid++}enable(){this.A_P=!0}disable(){this.A_P=!1}isEnabled(){return this.A_P}getUid(){return this.b}getRPONodeBuilder(){return null}getRenderProxy(){return this.l}setViewPort(t,e,s,i){null!=this.l&&(this.J=t,this.K=e,this.L=s,this.M=i)}reseizeViewPort(){this.l.reseizeRCViewPort()}getRendererAdapter(){return this.t_}getRenderer(){return this.A_q}getRendererContext(){return this.AK}getStage3D(){return this.l.getStage3D()}getCurrentStage3D(){return this.Cw}getCamera(){return this.A_O}getRendererStatus(){return this.A_q.getRendererStatus()}getMouseXYWorldRay(t,e){this.A_O.getWorldPickingRayByScreenXY(this.A_N.mouseX,this.A_N.mouseY,t,e)}createCamera(){return new l.default}createFBOInstance(){return new c.default(this,this.textureBlock.getRTTStrore())}setEvt3DController(t){null!=t&&(null==this.Cw&&(this.Cw=new n.default(this.l.getRCUid(),null)),t.initialize(this.getStage3D(),this.Cw),t.setRaySelector(this.Cj.getRaySelector())),this.Co=t}isRayPickSelected(){return null!=this.Co&&this.Co.isSelected()}enableMouseEvent(t=!0){null==this.Co&&(t?this.Cj.setRaySelector(new u.default):this.Cj.setRaySelector(new _.default),this.setEvt3DController(new d.default)),this.Cp=!0}disableMouseEvent(){this.Cp=!1}getEvt3DController(){return this.Co}getSpace(){return this.Cj}getDevicePixelRatio(){return this.t_.getDevicePixelRatio()}addEventListener(t,e,s,i=!0,r=!1){this.Cw.addEventListener(t,e,s,i,r)}removeEventListener(t,e,s){this.Cw.removeEventListener(t,e,s)}setAccessor(t){this.Cm=t}initialize(t,e=3,s=!0){if(null==this.l){e<1&&(e=1),e>8&&(e=8),this.Ct=t,this.Cs=t.cameraPerspectiveEnabled;let i=null;for(;e>=0;)i=this.A_q.appendProcess(t.batchEnabled,t.processFixedState),this.Ch[this.Ci]=i.getRPIndex(),this.Ci++,--e;this.AK=this.A_q.getRendererContext(),this.l=this.AK.getRenderProxy(),this.t_=this.l.getRenderAdapter(),this.A_N=this.l.getStage3D(),this.J=this.A_N.getViewX(),this.K=this.A_N.getViewY(),this.L=this.A_N.getViewWidth(),this.M=this.A_N.getViewHeight(),s?this.createMainCamera():this.A_O=this.l.getCamera(),null==this.Cj&&(this.Cj=new m.default,this.Cj.initialize(this.A_q,this.A_O))}}createMainCamera(){this.A_O=new l.default,this.A_O.setViewXY(this.J,this.K),this.A_O.setViewSize(this.L,this.M);let t=this.Ct.camProjParam;this.Cs?this.A_O.perspectiveRH(r.default.DegreeToRadian(t.x),this.L/this.M,t.y,t.z):this.A_O.orthoRH(t.y,t.z,-.5*this.M,.5*this.M,-.5*this.L,.5*this.L),this.A_O.lookAtRH(this.Ct.camPosition,this.Ct.camLookAtPos,this.Ct.camUpDirect),this.A_O.update()}cameraLock(){this.A_O.lock()}cameraUnlock(){this.A_O.unlock()}updateRenderBufferSize(){this.t_.updateRenderBufferSize()}setRendererProcessParam(t,e,s){this.A_q.setRendererProcessParam(this.Ch[t],e,s)}appendARendererProcess(t=!0,e=!1){let s=this.A_q.appendProcess(t,e);this.Ch[this.Ci]=s.getRPIndex(),this.Ci++}getRenderProcessAt(t){return this.A_q.getProcessAt(this.Ch[t])}addContainer(t,e=0){if(e<0&&(e=0),null!=t&&t.__$wuid<0&&t.__$contId<1){let s=0;for(;s<this.Cy;++s)if(this.Cx[s]==t)return;s>=this.Cy&&(t.__$wuid=this.b,t.wprocuid=e,t.__$setRenderer(this),this.Cx.push(t),this.Cy++)}}removeContainer(t){if(null!=t&&t.__$wuid==this.b&&t.getRenderer()==this.A_q){let e=0;for(;e<this.Cy;++e)if(this.Cx[e]==t){t.__$wuid=-1,t.wprocuid=-1,t.__$setRenderer(null),this.Cx.splice(e,1),--this.Cy;break}}}setAutoRunningEnabled(t){this.Cv=t}moveEntityTo(t,e){this.A_q.moveEntityToProcessAt(t,this.Ch[e])}drawEntity(t,e=!1,s=!0){this.A_q.drawEntity(t,e,s)}addEntity(t,e=0,s=!0){if(null!=t&&t.__$testSpaceEnabled())if(t.isPolyhedral())if(t.hasMesh())this.A_q.addEntity(t,this.Ch[e],s),null!=this.Cj&&this.Cj.addEntity(t);else{null==this.Cq&&(this.Cq=new o.default,this.Cr=new h.default);let s=this.Cr.addEntity(t);s.rstatus=e,this.Cq.addNode(s)}else this.A_q.addEntity(t,this.Ch[e],s),null!=this.Cj&&this.Cj.addEntity(t)}removeEntity(t){if(null!=t){let e=null;if(null!=this.Cq){let e=this.Cr.getNodeByEntity(t);null!=e&&(this.Cq.removeNode(e),this.Cr.removeEntity(t))}null==e&&(this.A_q.removeEntity(t),null!=this.Cj&&this.Cj.removeEntity(t))}}updateMaterialUniformToCurrentShd(t){this.A_q.updateMaterialUniformToCurrentShd(t)}drawEntityByLockMaterial(t){this.A_q.drawEntityByLockMaterial(t)}showInfoAt(t){this.A_q.showInfoAt(t)}updateCameraData(t){this.AK.updateCameraDataFromCamera(this.l.getCamera())}renderBegin(t=!1){t&&this.AK.renderBegin(),this.l.getCamera()!=this.A_O&&(this.l.isAutoSynViewAndStage()&&(this.J=this.l.getViewX(),this.K=this.l.getViewY(),this.L=this.l.getViewWidth(),this.M=this.l.getViewHeight()),this.A_O.setViewXY(this.J,this.K),this.A_O.setViewSize(this.L,this.M),this.l.setRCViewPort(this.J,this.K,this.L,this.M,this.l.isAutoSynViewAndStage()),this.l.reseizeRCViewPort()),this.A_O.update(),this.AK.updateCameraDataFromCamera(this.A_O),this.A_K.renderBegin(),null!=this.Cm&&this.Cm.renderBegin(this)}runBegin(t=!0,e=!1){t&&this.Cv&&(this.Cu>=0&&this.runEnd(),this.Cu=0),this.renderBegin(e),null!=this.Cj&&(this.Cj.setCamera(this.A_O),this.Cj.runBegin())}setRayTestEanbled(t){this.C2=t}runMouseTest(t,e){let s=-1;if(null!=this.Co&&this.Cp){if(this.C1&&this.Co.getEvtType()>0){let t=this.Cj.getRaySelector();if(null!=t){this.C2?this.mouseRayTest():t.clear();let e=t.getSelectedNodesTotal();if(e>1){let s=0,i=t.getSelectedNodes(),r=null;for(;s<e;++s)r=i[s],r.entity.isPolyhedral()}}this.C1=!1}s=this.Co.run(t,e)}return this.Cz=!1,s}update(t=!0,e=!0){if(null!=this.Cw&&this.Cw.enterFrame(),t&&this.Cv&&(0!=this.Cu&&this.runBegin(),this.Cu=1),this.Cz=!0,this.C0=!0,this.C1=!0,null!=this.Cq){let t=this.Cq.getBegin();if(null!=t){let e,s,i;while(null!=t)t.entity.hasMesh()?(e=t,t=t.next,s=e.entity,i=e.rstatus,this.Cq.removeNode(e),this.Cr.removeEntity(e.entity),this.addEntity(s,i)):t=t.next}}let s=0;for(;s<this.Cy;++s)this.Cx[s].update();null!=this.Cj&&this.Cj.update(),null!=this.Cj&&this.C0&&(null==this.Co&&null==this.Cj.getRaySelector()||this.Cj.run()),this.Cz&&!this.Cn&&(e?this.runMouseTest(1,0):null!=this.Co&&this.Co.mouseOutEventTarget())}cullingTest(){null!=this.Cj&&this.Cj.run(),this.C0=!1}mouseRayTest(){null!=this.Cj&&(this.getMouseXYWorldRay(this.Cl,this.Ck),this.Cj.rayTest(this.Cl,this.Ck))}run(t=!1){if(this.A_P){t&&this.Cv&&(1!=this.Cu&&this.update(),this.Cu=2);for(let t=0;t<this.Ci;++t)this.A_q.runAt(this.Ch[t]);t&&this.runEnd()}}runAt(t){this.A_q.runAt(this.Ch[t])}runEnd(){null!=this.Co&&this.Co.runEnd(),null!=this.Cj&&this.Cj.runEnd(),this.Cv&&(this.Cu=-1),null!=this.Cm&&this.Cm.renderEnd(this)}useCamera(t,e=!1){this.BP.useCamera(t,e)}useMainCamera(){this.BP.useMainCamera()}updateCamera(){null!=this.A_O&&this.A_O.update()}setClearUint24Color(t,e=1){this.l.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,s){this.l.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.l.setClearRGBAColor4f(t,e,s,i)}setClearColor(t){this.l.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.l.setRenderToBackBuffer()}toString(){return"[RendererSubScene(uid = "+this.b+")]"}}f.__s_uid=0,e.default=f},"710f":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){if(this.C3=[],this.C4=[],null!=i.Gh)throw Error("ROVtxBufUidStore is a singleton class!!");i.Gh=this}static GetInstance(){return i.Gh}__$getRemovedListLen(){return this.C4.length}__$getRemovedList(){return this.C4}__$attachAt(t){if(t<this.C3.length)++this.C3[t];else{let e=this.C3.length;for(;e<=t;++e)this.C3.push(0);++this.C3[t]}}__$detachAt(t){--this.C3[t],this.C3[t]<1&&(this.C3[t]=0,this.C4.push(t))}getAttachCountAt(t){return t<this.C3.length?this.C3[t]:0}getAttachAllCount(){let t=0,e=0,s=this.C3.length;for(;e<s;++e)this.C3[e]>0&&(t+=this.C3[e]);return t}}i.Gh=null,e.default=i},7181:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,s,i,r,a){1==this.status||a?t.texImage2D(e,this.miplevel,s,i,r,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,i,r,this.data),this.status=-1}static Create(){return i.Gg.length>0?i.Gg.pop():new i}static Restore(t){null!=t&&(t.data=null,i.Gg.push(t))}}i.Gg=[],e.default=i},"722e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.NEAREST=4001,i.LINEAR=4002,i.LINEAR_MIPMAP_LINEAR=4003,i.NEAREST_MIPMAP_NEAREST=4004,i.LINEAR_MIPMAP_NEAREST=4005,i.NEAREST_MIPMAP_LINEAR=4006,e.default=i},"725b":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("fe7f")),n=i(s("3b73"));class l{constructor(){this.width=4,this.height=4,this.x=0,this.y=0,this.uvs=new Float32Array(8)}toString(){return"FontTexCharGrid(x="+this.x+",y="+this.y+",width="+this.width+",height="+this.height+")"}}class h{constructor(){this.o=512,this.p=256,this.C5=new Map,this.layoutDataStr="",this.C6=0,this.C7=0,this.C8=0,this.C9=0}initialize(t,e){this.o=t,this.p=e}addCharsByRawData(t,e){let s=0,i=0,r=e.split(","),a=r.length/4;for(;s<a;++s)i=4*s,this.addUV8RawDataFromChar(t.charAt(s),parseInt(r[i]),parseInt(r[i+1]),parseInt(r[i+2]),parseInt(r[i+3]))}addUV8RawDataFromChar(t,e,s,i,r){if(null==this.C5.get(t)){let a=new l,n=a.uvs,h=this.o,o=this.p;this.C6=e/h,this.C7=s/o,this.C8=(e+i)/h,this.C9=(s+r)/o,n[0]=this.C6,n[1]=this.C9,n[2]=this.C8,n[3]=this.C9,n[4]=this.C8,n[5]=this.C7,n[6]=this.C6,n[7]=this.C7,a.x=e,a.y=s,a.width=i,a.height=r,this.C5.set(t,a)}}getGridByChar(t){return this.C5.get(t)}getUV8FromChar(t,e,s=0){let i=this.C5.get(t);null==i&&(i=this.C5.get("?")),e.set(i.uvs,s)}getVtxFromChar(t,e,s=0){let i=this.C5.get(t);null==i&&(i=this.C5.get("?"));let r=[0,0,0,i.width,0,0,i.width,i.height,0,0,i.height,0];e.set(r,s)}getUV8AndVtxFromChar(t,e,s,i=0,r=0){let a=this.C5.get(t);null==a&&(a=this.C5.get("?")),e.set(a.uvs,i);let n=[0,0,0,a.width,0,0,a.width,a.height,0,0,a.height,0];s.set(n,r)}getUV8AndSizeFromChar(t,e,s,i=0){let r=this.C5.get(t);null==r&&(r=this.C5.get("?")),e.set(r.uvs,i),s[0]=r.width,s[1]=r.height}getUV8AndOffsetXYVtxFromChar(t,e,s,i=0,r=0,a=0,n=0){let l=this.C5.get(t);null==l&&(l=this.C5.get("?")),e.set(l.uvs,a);let h=[i,r,0,i+l.width,r,0,i+l.width,r+l.height,0,i,r+l.height,0];s.set(h,n)}}e.FontTexCharTable=h;class o{constructor(){this.C_A=0,this.C_B=0,this.C_C="",this.C_D=null,this.pixMinPos={x:0,y:0},this.pixMaxPos={x:0,y:0},this.canvas=null,this.ctx2d=null,this.C_E=0,this.charTexWidth=0,this.px=0,this.py=0,this.ph=0,this.linedis=2,this.charHDis=1,this.tx=0,this.char="",this.meao=null}setFontCharTable(t){this.C_D=t}textFilte(t){let e=t.length,s="",i="";for(let r=0;r<e;++r)i=t.charAt(r),this.C_C.indexOf(i)<0&&s.indexOf(i)<0&&(s+=i);return s}crateTextUVData(t,e,s,i=18){this.C_C+=t;let r=this.ctx2d;this.C_B<2&&(this.C_B=i),this.charTexWidth=0,r.textAlign="left",r.fillStyle="white",r.font=i+"px Arial";let a=t.length;this.pixMinPos.x=2e4,this.pixMinPos.y=2e4,this.pixMaxPos.x=-2e4,this.pixMaxPos.y=-2e4,this.ph=i+8;for(let n=0;n<a;n++)this.char=t.charAt(n),this.meao=r.measureText(this.char),this.charTexWidth=Math.floor(this.meao.width)+1,this.tx=this.C_A+this.charTexWidth,this.tx<e?(r.fillText(this.char,this.C_A,this.C_B),this.C_E=this.C_B-i,this.pixMinPos.x>this.C_A&&(this.pixMinPos.x=this.C_A),this.pixMinPos.y>this.C_E&&(this.pixMinPos.y=this.C_E),this.px=this.C_A+this.charTexWidth,this.py=this.C_E+this.ph,this.pixMaxPos.x<this.px&&(this.pixMaxPos.x=this.px),this.pixMaxPos.y<this.py&&(this.pixMaxPos.y=this.py),this.C_D.addUV8RawDataFromChar(this.char,this.C_A,this.C_E+1,this.charTexWidth,this.ph),this.C_A=this.tx+this.charHDis):(this.C_A=0,this.C_B+=this.ph+this.linedis,r.fillText(this.char,this.C_A,this.C_B),this.C_E=this.C_B-i,this.pixMinPos.x>this.C_A&&(this.pixMinPos.x=this.C_A),this.pixMinPos.y>this.C_E&&(this.pixMinPos.y=this.C_E),this.px=this.C_A+this.charTexWidth,this.py=this.C_E+this.ph,this.pixMaxPos.x<this.px&&(this.pixMaxPos.x=this.px),this.pixMaxPos.y<this.py&&(this.pixMaxPos.y=this.py),this.C_D.addUV8RawDataFromChar(this.char,this.C_A,this.C_E+1,this.charTexWidth,this.ph),this.C_A+=this.charTexWidth)}}e.FontTexDataBuilder=o;class m{constructor(){this.o=512,this.p=256,this.z=null,this.B_y=null,this.C_F=null,this.C_G=18,this.C_D=new h,this.C_H=new o,this.l=null,this.mobileEnabled=!0,this.C_I=0,this.C_J=0,this.C_K=null}setRenderProxy(t){null!=t&&(this.l=t,null!=this.C_F&&this.C_F.__$setRenderProxy(t))}isEnabled(){return null!=this.z}getFontSize(){return this.C_G}initialize(t,e=10,s=512,i=512,l=!1,h=!1){if(this.mobileEnabled&&n.default.IsMobileWeb()&&(e*=2,s=i*=2),null==this.z){s<32&&(s=32),i<32&&(i=32),this.o=s,this.p=i,e<10&&(e=10),this.C_G=e;var o=null;try{void 0!=document&&(o=document)}catch(m){}this.z=o.getElementById(t),null==this.z&&(this.z=document.createElement("canvas"),this.z.style.width="128px",this.z.style.height="128px",this.z.style.display="bolck",this.z.style.overflow="hidden",this.z.style.left="0px",this.z.style.top="0px",this.z.style.position="absolute",this.z.style.backgroundColor="transparent",this.z.style.pointerEvents="none"),this.z.width=s,this.z.height=i,l?(document.body.appendChild(this.z),this.z.style.visibility="visible"):this.z.style.visibility="hidden",this.B_y=this.z.getContext("2d"),this.C_H.canvas=this.z,this.C_H.ctx2d=this.B_y,this.C_H.setFontCharTable(this.C_D),this.C_D.initialize(this.o,this.p),this.C_F=new a.default(this.o,this.p),this.C_F.__$setRenderProxy(this.l),this.C_F.toAlphaFormat(),this.C_F.mipmapEnabled=h,this.C_F.minFilter=r.TextureConst.LINEAR,this.C_F.magFilter=r.TextureConst.NEAREST,this.createInitTexAndChars()}}setStyleSize(t,e){null!=this.z&&(this.C_I==t&&this.C_J==e||(this.C_I=t,this.C_J=e,this.z.style.width=t+"px",this.z.style.height=e+"px"))}setCanvasVisible(t){this.z.style.visibility=t?"visible":"hidden"}getUV8FromChar(t,e,s=0){this.C_D.getUV8FromChar(t,e,s)}getCharTable(){return this.C_D}createCharsTexFromStr(t){if(t=this.C_H.textFilte(t),t.length<1)return;let e=t;this.C_H.crateTextUVData(e,this.o,this.p,this.C_G);let s=0,i=0,r=0,a=0,n=0,l=this.C_H.pixMaxPos.x-this.C_H.pixMinPos.x,h=this.C_H.pixMaxPos.y-this.C_H.pixMinPos.y,o=this.B_y.getImageData(this.C_H.pixMinPos.x,this.C_H.pixMinPos.y,l,h),m=o.data,_=new Uint8Array(l*h),u=this.C_H.pixMinPos.x,d=this.C_H.pixMinPos.y;for(i=0;i<h;++i)for(r=0;r<l;++r)n=(i+d)*this.o+(u+r),s=4*(i*l+r),this.C_K[n]=m[s+3],_[a]=this.C_K[n],a++;this.C_F.setPartDataFromeBytes(_,this.C_H.pixMinPos.x,this.C_H.pixMinPos.y,l,h),this.C_F.updateDataToGpu()}createInitTexAndChars(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890~`!@#$%^&*()_+-={}[]:\";\\|'<>,.?/\n ",e=t;this.C_H.crateTextUVData(e,this.o,this.p,this.C_G);let s=this.B_y.getImageData(0,0,this.o,this.p),i=s.data,r=0,a=0,n=0;this.C_K=new Uint8Array(this.o*this.p);let l=0;for(r=0;r<this.p;++r)for(a=0;a<this.o;++a)n=4*(r*this.o+a),this.C_K[l]=i[n+3],l++;this.C_F.setDataFromBytes(this.C_K,0,this.o,this.p)}getTextureAt(t=0){return this.C_F}static GetInstance(){return null!=m.Gh||(m.Gh=new m),m.Gh}}m.Gh=null,e.default=m},7279:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("5326")),a=i(s("3b73")),n=i(s("d53d"));class l extends n.default{constructor(){super(),this.slotId=0,this.slotIndex=0,this.uniformsTotal=0,this.locationIndexList=null,this.locations=null,this.rst=0,this.always=!1}clone(){let t=new l;return t.types=this.types.slice(0),t.uniformNameList=this.uniformNameList.slice(0),t.dataSizeList=this.dataSizeList.slice(0),t.slotIndex=this.slotIndex,t.uniformsTotal=this.uniformsTotal,t.slotId=this.slotId,t.always=this.always,t.rst=this.rst,t}copyDataFromProbe(t){this.types=t.uniformTypes.slice(0),this.dataSizeList=t.dataSizeList.slice(0),this.slotIndex=t.getSlotBeginIndex(),this.uniformsTotal=t.uniformsTotal,this.slotId=t.getSlotUid()}copyDataFromProbeAt(t,e){null==this.types&&(this.types=[],this.dataSizeList=[]),this.slotIndex=e.getSlotBeginIndex()+t,this.uniformsTotal=1,this.slotId=e.getSlotUid(),this.types[0]=e.uniformTypes[t],this.dataSizeList[0]=e.dataSizeList[t]}use(t){let e=r.default.GetSlotAt(t.getRCUid());if(this.always||this.rst!=e.flagList[this.slotIndex]){this.rst=e.flagList[this.slotIndex];let s=0;if(a.default.IsWebGL1())for(;s<this.uniformsTotal;++s)t.useUniformV1(this.locations[s],this.types[s],e.dataList[this.slotIndex+s],this.dataSizeList[s]);else for(;s<this.uniformsTotal;++s)t.useUniformV2(this.locations[s],this.types[s],e.dataList[this.slotIndex+s],this.dataSizeList[s],0)}}destroy(){this.types=null,this.dataSizeList=null,this.slotIndex=-1,this.uniformsTotal=0}}e.default=l},7499:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.C_L=null,this.A_K=null,this.A_6=null}setDispBuilder(t){null==this.C_L&&(this.C_L=t,this.A_K=t.getRenderShader(),this.A_6=t.getTextureResource())}unlockMaterial(){this.A_K.unlock(),this.A_6.unlocked=!0}lockMaterial(){this.A_K.lock(),this.A_6.unlocked=!1}isUnlockMatrial(){return this.A_6.unlocked}unlockTexture(){this.A_K.textureUnlock()}lockTexture(){this.A_K.textureLock()}renderBegin(){this.A_K.renderBegin(),this.A_6.renderBegin()}resetUniform(){this.A_K.resetUniform()}useGlobalMaterial(t,e=!1){null!=t&&this.C_L.updateGlobalMaterial(t,e)}updateMaterialUniform(t){this.A_K.updateUniform(t.__$uniform)}}e.default=i},"749c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("1710")),n=i(s("3b73")),l=i(s("5336")),h=i(s("c497")),o=i(s("b161")),m=i(s("e943")),_=i(s("899a")),u=i(s("402a")),d=s("4df3"),c=s("ab2e"),f=i(s("519e")),p=i(s("af2e")),g=s("da82"),v=i(s("a63a")),x=s("01e3");class T{constructor(){this.A=null,this.C_M=new l.default,this.C_N=new m.default,this.C_O=new g.UserInteraction,this.C_P=new c.DebugMaterialContext,this.C_Q=new x.TextBillboardLoading,this.C_R=0,this.fogEnabled=!1,this.vtxFlatNormal=!1,this.aoMapEnabled=!1,this.C_S=null,this.C_T=new r.default(360*Math.random(),360*Math.random(),360*Math.random()),this.Cu=!0,this.C_U=-1}initialize(){if(null==this.A){n.default.SHADERCODE_TRACE_ENABLED=!0,n.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0;let t=new h.default;t.setCamProject(45,50,1e4),t.setAttriStencil(!0),t.setAttriAntialias(!0),t.setCamPosition(800,800,800),this.A=new o.default,this.A.initialize(t,5),this.A.updateCamera(),this.A.addEventListener(a.default.MOUSE_DOWN,this,this.mouseDown),this.A.addEventListener(a.default.MOUSE_UP,this,this.mouseUp),this.C_O.initialize(this.A),this.C_O.cameraZoomController.syncLookAt=!0,this.C_M.initialize(),this.A.setClearRGBColor3f(.2,.2,.2),this.initMaterialCtx(),this.C_Q.loadingInfoScale=this.C_Q.loadingNameScale=1,this.C_Q.initialize(this.A),this.update()}}initMaterialCtx(){let t=new d.MaterialContextParam;t.pointLightsTotal=1,t.directionLightsTotal=2,t.spotLightsTotal=0,t.loadAllShaderCode=!0,t.shaderCodeBinary=!0,t.lambertMaterialEnabled=!1,t.pbrMaterialEnabled=!0,this.C_P.addShaderLibListener(this),this.C_P.initialize(this.A,t);let e=this.C_P.lightModule.getPointLightAt(0);null!=e&&(e.position.setXYZ(0,190,0),e.color.setRGB3f(0,2.2,0),e.attenuationFactor1=1e-5,e.attenuationFactor2=5e-5);let s=this.C_P.lightModule.getSpotLightAt(0);null!=s&&(s.position.setXYZ(0,30,0),s.direction.setXYZ(0,-1,0),s.color.setRGB3f(0,40.2,0),s.attenuationFactor1=1e-6,s.attenuationFactor2=1e-6,s.angleDegree=30);let i=this.C_P.lightModule.getDirectionLightAt(0);null!=i&&(i.color.setRGB3f(2,0,0),i.direction.setXYZ(-1,-1,0),i=this.C_P.lightModule.getDirectionLightAt(1),null!=i&&(i.color.setRGB3f(0,0,2),i.direction.setXYZ(1,1,0))),this.C_P.lightModule.update()}initScene(){this.createEntity(),this.C_R=this.C_P.getTextureLoader().getWaitTotal()}shaderLibLoadComplete(t,e){this.initScene()}createMeshPlane(t){let e=400,s=new p.default;s.normalEnabled=!0,s.initializeXOZPlane(new r.default(-.5*e,0,-.5*e),e,e,200,200);let i=new f.default;i.setBufSortFormat(t.getBufSortFormat()),i.initializeFromGeometry(s);let a=new u.default;a.setMaterial(t),a.setMesh(i),this.A.addEntity(a),this.C_T=new r.default,this.C_S=a}createEntity(){let t=null,e=null,s=null,i=null;this.aoMapEnabled=!0;let a="rust_coarse_01";a="medieval_blocks_02",a="rough_plaster_broken",t=this.C_P.getTextureByUrl("static/assets/pbrtex/"+a+"_diff_1k.jpg"),e=this.C_P.getTextureByUrl("static/assets/pbrtex/"+a+"_nor_1k.jpg"),s=this.C_P.getTextureByUrl("static/assets/pbrtex/"+a+"_arm_1k.jpg"),this.aoMapEnabled;let n=null;n=this.C_P.getTextureByUrl("static/assets/pbrtex/"+a+"_disp_1k.jpg");let l=null;l=n;let h,o,m=700,_=500,u=[],d=new r.default(-m,0,-m),c=4,f=4;for(let v=0;v<c;++v)for(let t=0;t<f;++t)if(v<1||v>c-2||t<1||t>f-2){let e=new r.default(d.x+_*t,d.y,d.z+_*v);u.push(e)}h=this.createMaterial(1,.4,1),o=h.vertUniform,h.decorator.aoMapEnabled=this.aoMapEnabled,h.decorator.armMap=s,h.decorator.scatterEnabled=!1,h.decorator.diffuseMap=t,h.decorator.normalMap=e,h.decorator.aoMap=i,o.displacementMap=n,h.decorator.parallaxMap=l,h.initializeByCodeBuf(!0),o.setDisplacementParams(.02,-.01),h.setAlbedoColor(1,1,1),h.setScatterIntensity(8),h.setParallaxParams(1,10,5,.02),h.setSideIntensity(8);let p="static/assets/obj/apple_01.obj",g=new v.default;g.baseParsering=!1,g.setMaterial(h),g.showDoubleFace();let x=400;g.initializeByObjDataUrl(p),g.setScaleXYZ(x,x,x),this.A.addEntity(g),this.C_S=g}mouseDown(t){this.Cu=!0,_.default.Flag_0=1}mouseUp(t){}update(){this.C_U>-1&&clearTimeout(this.C_U),this.C_U=setTimeout(this.update.bind(this),50),this.C_M.render()}run(){if(this.C_M.update(!1),!this.C_Q.isLoaded()){let t=null!=this.C_S&&this.C_S.isInRendererProcess()?1:0,e=(t+this.C_R-this.C_P.getTextureLoader().getWaitTotal())/(this.C_R+1);this.C_Q.run(e)}this.C_O.run(),this.A.run()}makePBRMaterial(t,e,s){let i=this.C_P.createPBRLightMaterial(!0,!0,!0),r=i.decorator;return r.scatterEnabled=!1,r.woolEnabled=!0,r.absorbEnabled=!1,r.normalNoiseEnabled=!1,i.setMetallic(t),i.setRoughness(e),i.setAO(s),i}createMaterial(t=1,e=0,s=1){let i;i=this.makePBRMaterial(s,e,t);let r=i.decorator;return r.shadowReceiveEnabled=!1,r.fogEnabled=this.fogEnabled,r.indirectEnvMapEnabled=!1,r.specularEnvMapEnabled=!0,r.diffuseMapEnabled=!0,r.normalMapEnabled=!0,i}}e.DemoPBRTexViewer=T,e.default=T},"74c3":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,s){this.C_W=new Map,this.C_X=new Map,this.C_Y=[],this.C_Z=0,this.C_a=0,this.C_b=128,this.A_=!1,this.C_c=16,this.I=0,this.F_=null,this.C_d=null,this.unlocked=!0,this.I=t,this.F_=e,this.C_d=s}setVtxUpdateTimesTotal(t){this.C_c=t>4?t:4}createResByParams3(t,e,s,i){return!1}getRCUid(){return this.I}getRC(){return this.F_}hasResUid(t){return this.C_W.has(t)}bindToGpu(t){}getGpuBuffer(t){return null}renderBegin(){this.C_d.renderBegin()}getVertexResTotal(){return this.C_Z}updateDataToGpu(t,e){e?(this.C_Y.push(t),this.A_=!0):this.C_W.has(t)&&this.C_W.get(t).updateToGpu(this.C_d)}addVertexRes(t){this.C_W.has(t.resUid)||(t.waitDelTimes=0,this.C_W.set(t.resUid,t),this.C_Z++)}getVertexRes(t){return this.C_W.get(t)}destroyRes(t){this.C_W.has(t)&&this.C_W.get(t).destroy(this.C_d)}__$attachRes(t){if(this.C_W.has(t)){this.C_a++;let e=this.C_W.get(t);e.getAttachCount()<1&&this.C_X.has(t)&&this.C_X.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.C_W.has(t)&&this.C_W.has(t)){let e=this.C_W.get(t);e.getAttachCount()>0&&(this.C_a--,e.__$detachThis(),e.getAttachCount()<1&&this.C_X.set(t,e))}}getVROByResUid(t,e,s){let i=this.C_W.get(t);return null!=i?i.createVRO(this.C_d,e,s):null}update(){if(this.A_){let t=this.C_Y.length;if(t>0){let e;t>this.C_c&&(t=this.C_c);for(let s=0;s<t;++s)e=this.C_Y.shift(),this.C_W.has(e)&&this.C_W.get(e).updateToGpu(this.C_d)}else this.A_=!1}if(this.C_b--,this.C_b<1){this.C_b=128;for(const[t,e]of this.C_X)e.waitDelTimes++,e.getAttachCount()<1?e.waitDelTimes>5&&(this.C_W.delete(e.resUid),this.C_X.delete(e.resUid),e.destroy(this.C_d),this.C_Z--):this.C_X.delete(e.resUid)}}}e.ROVertexResource=i,e.default=i},"765c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("1710"));class a{constructor(){this.b=0,this.C_e=null,this.C_f=null,this.C_g=null,this.C_h=!0,this.Y=new r.default,this.C_i=new r.default,this.C_j=new r.default,this.C_k=new Float32Array(64),this.C_l=new Float32Array(64),this.C_m=new Float32Array(64),this.C_n=new Float32Array(64),this.C_o=0,this.C_p=null,this.C_q=null,this.C_r=-1,this.b=a.F_0++}initialize(t,e){null==this.C_e&&(this.C_e=t,this.C_f=e,t.addEventListener(r.default.MOUSE_DOWN,this,this.mouseDownListener,!0,!1),t.addEventListener(r.default.MOUSE_UP,this,this.mouseUpListener,!0,!1),t.addEventListener(r.default.MOUSE_CLICK,this,this.mouseClickListener,!0,!1),t.addEventListener(r.default.MOUSE_MOVE,this,this.mouseMoveListener,!0,!1),t.addEventListener(r.default.MOUSE_WHEEL,this,this.mouseWheeelListener,!0,!1))}setRaySelector(t){this.C_g=t}mouseWheeelListener(t){null!=this.C_f&&(this.C_f.mouseX=this.C_e.mouseX,this.C_f.mouseY=this.C_e.mouseY),this.C_k[this.C_o]=t.type,this.C_l[this.C_o]=t.mouseX,this.C_m[this.C_o]=t.mouseY,this.C_n[this.C_o]=t.wheelDeltaY,this.Y.type=t.type,this.C_o++}mouseMoveListener(t){null!=this.C_f&&(this.C_f.mouseX=this.C_e.mouseX,this.C_f.mouseY=this.C_e.mouseY),this.C_k[this.C_o]=t.type,this.C_l[this.C_o]=t.mouseX,this.C_m[this.C_o]=t.mouseY,this.C_n[this.C_o]=0,this.Y.type=t.type,this.C_o++}mouseDownListener(t){null!=this.C_f&&(this.C_f.mouseX=this.C_e.mouseX,this.C_f.mouseY=this.C_e.mouseY),a.Gi&&(this.C_k[this.C_o]=t.type,this.C_l[this.C_o]=t.mouseX,this.C_m[this.C_o]=t.mouseY,this.C_n[this.C_o]=0,this.Y.type=t.type,this.C_o++)}mouseUpListener(t){null!=this.C_f&&(this.C_f.mouseX=this.C_e.mouseX,this.C_f.mouseY=this.C_e.mouseY),a.Gi&&(this.C_k[this.C_o]=t.type,this.C_l[this.C_o]=t.mouseX,this.C_m[this.C_o]=t.mouseY,this.C_n[this.C_o]=0,this.Y.type=t.type,this.C_o++)}mouseClickListener(t){null!=this.C_f&&(this.C_f.mouseX=this.C_e.mouseX,this.C_f.mouseY=this.C_e.mouseY),a.Gi&&(this.C_k[this.C_o]=t.type,this.C_l[this.C_o]=t.mouseX,this.C_m[this.C_o]=t.mouseY,this.C_n[this.C_o]=0,this.Y.type=t.type,this.C_o++)}mouseOutEventTarget(){if(null!=this.C_f&&(this.C_f.mouseX=this.C_e.mouseX,this.C_f.mouseY=this.C_e.mouseY),null!=this.C_p){let t=this.C_p.getEvtDispatcher(r.default.EventClassType);if(null!=t)return this.C_j.phase=this.C_r,this.C_j.type=r.default.MOUSE_OUT,this.C_j.mouseX=this.Y.mouseX,this.C_j.mouseY=this.Y.mouseY,this.C_j.target=this.C_p,this.C_g.getRay(this.C_j.raypv,this.C_j.raytv),this.C_p=null,t.dispatchEvt(this.C_j);this.C_p=null}return 0}run(t,e){let s=-1;if(this.C_h){this.C_r=t;let i=0;s=this.C_o>0?0:-1;let n,l,h,o=null;if(s>-1){if(this.C_f!=this.C_e&&null!=this.C_f){for(a.Gi=!1,i=0;i<this.C_o;i++)switch(this.C_k[i]){case r.default.MOUSE_DOWN:this.C_f.mouseDown(1);break;case r.default.MOUSE_UP:this.C_f.mouseUp(1);break;case r.default.MOUSE_MOVE:this.C_f.mouseMove();break;default:break}a.Gi=!0}if(n=e<1?this.C_g.getSelectedNode():null,null!=n){l=n.lpv,h=n.wpv;let e=n.entity;o=e.getEvtDispatcher(r.default.EventClassType);let i=e.__$getParent(),a=null!=i&&i.mouseEnabled;a||(s+=this.mouseOutContainer(t,null,null,null),this.C_q=null);let m=this.C_p;for(let _=0;_<this.C_o;_++)this.Y.type=this.C_k[_],this.Y.mouseX=this.C_l[_],this.Y.mouseY=this.C_m[_],this.Y.wheelDeltaY=this.C_n[_],this.Y.type>0&&null!=n&&null!=o&&(this.Y.target=e,this.Y.currentTarget=e,this.Y.phase=t,this.Y.lpos.copyFrom(l),this.Y.wpos.copyFrom(h),this.C_g.getRay(this.Y.raypv,this.Y.raytv),s+=this.mouseOutEntity(t,e,l,h),this.C_p!=e&&(this.C_i.phase=t,this.C_i.type=r.default.MOUSE_OVER,this.C_i.mouseX=this.Y.mouseX,this.C_i.mouseY=this.Y.mouseY,this.C_i.target=e,this.C_i.currentTarget=e,this.C_i.lpos.copyFrom(l),this.C_i.wpos.copyFrom(h),this.C_g.getRay(this.C_i.raypv,this.C_i.raytv),s+=o.dispatchEvt(this.C_i)),s+=o.dispatchEvt(this.Y),this.C_p=e);if(a){null!=m&&null==m.__$getParent()&&(this.C_p=m,s+=this.mouseOutEntity(t,null,null,null),this.C_p=null);for(let a=0;a<this.C_o;a++)this.Y.type=this.C_k[a],this.Y.mouseX=this.C_l[a],this.Y.mouseY=this.C_m[a],this.Y.wheelDeltaY=this.C_n[a],this.Y.type>0&&null!=n&&(this.Y.target=i,this.Y.currentTarget=e,this.Y.phase=t,this.Y.lpos.copyFrom(l),this.Y.wpos.copyFrom(h),this.C_g.getRay(this.Y.raypv,this.Y.raytv),s+=this.mouseOutContainer(t,i,l,h),this.C_q!=i&&(this.C_i.phase=t,this.C_i.type=r.default.MOUSE_OVER,this.C_i.mouseX=this.Y.mouseX,this.C_i.mouseY=this.Y.mouseY,this.C_i.target=i,this.C_i.currentTarget=e,this.C_i.lpos.copyFrom(l),this.C_i.wpos.copyFrom(h),this.C_g.getRay(this.C_i.raypv,this.C_i.raytv),s+=i.dispatchEvt(this.C_i)),s+=i.dispatchEvt(this.Y),this.C_q=i)}}else if(this.mouseOutEntity(t,null,null,null),this.mouseOutContainer(t,null,null,null),this.C_p=null,this.C_q=null,s+=this.mouseOutEventTarget(),null!=this.C_f)for(i=0;i<this.C_o;i++)switch(this.C_k[i]){case r.default.MOUSE_DOWN:this.C_f.mouseBgDown();break;case r.default.MOUSE_UP:this.C_f.mouseBgUp();break;case r.default.MOUSE_CLICK:this.C_f.mouseBgClick();break;default:break}if(null!=this.C_f){for(a.Gi=!1,i=0;i<this.C_o;i++)switch(this.C_k[i]){case r.default.MOUSE_DOWN:this.C_f.mouseDown(2);break;case r.default.MOUSE_UP:this.C_f.mouseUp(2);break;default:break}a.Gi=!0}}0==s&&null!=o&&(s=o.passTestPhase(t))}return s>0?1:0}mouseOutEntity(t,e,s,i){if(null!=this.C_p&&this.C_p!=e){let e=this.C_p.getEvtDispatcher(r.default.EventClassType);if(null!=e)return this.C_j.phase=t,this.C_j.type=r.default.MOUSE_OUT,this.C_j.mouseX=this.Y.mouseX,this.C_j.mouseY=this.Y.mouseY,this.C_j.target=this.C_p,this.C_i.currentTarget=this.C_p,null!=s&&this.C_j.lpos.copyFrom(s),null!=i&&this.C_j.wpos.copyFrom(i),this.C_g.getRay(this.C_j.raypv,this.C_j.raytv),e.dispatchEvt(this.C_j)}return 0}mouseOutContainer(t,e,s,i){return null!=this.C_q&&this.C_q!=e?(this.C_j.phase=t,this.C_j.type=r.default.MOUSE_OUT,this.C_j.mouseX=this.Y.mouseX,this.C_j.mouseY=this.Y.mouseY,this.C_j.target=this.C_q,this.C_j.currentTarget=null,null!=s&&this.C_j.lpos.copyFrom(s),null!=i&&this.C_j.wpos.copyFrom(i),this.C_g.getRay(this.C_j.raypv,this.C_j.raytv),this.C_q.dispatchEvt(this.C_j)):0}runEnd(){this.C_o=0,this.Y.type=0}reset(){this.C_o=0}getEvtType(){return this.Y.type}isSelected(){return null!=this.C_g.getSelectedNode()}lock(){this.C_h=!1}unlock(){this.C_h=!0}isUnlock(){return this.C_h}}a.Gi=!0,a.F_0=0,e.default=a},7696:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("264c")),a=i(s("5f3c"));class n{constructor(t,e,s,i,r,a){this.I=-1,this.C_s=-1,this.C_t=0,this.A_P=!0,this.C_u=[],this.C_v=0,this.C_w=new Int8Array(n.Gj),this.C_x=n.Gj,this.A_K=null,this.BC=null,this.Ai=null,this.BD=null,this.C_y=null,this.C_z=null,this.A_M=null,this.BE=!0,this.BF=!0,this.C_0=!1,this.C_1=0,this.uid=-1,this.A_K=t,this.BC=e,this.Ai=s,this.BD=i,this.C_y=this.createBlock(),this.BE=r,this.BF=a;for(let n=0;n<this.C_x;++n)this.C_w[n]=-1}createBlock(){let t=new a.default(this.A_K);return t.rpoNodeBuilder=this.BC,t.rpoUnitBuilder=this.Ai,t.vtxResource=this.BD,t}setRenderParam(t,e){this.C_v<1&&(this.BE=t,this.BF=e)}setRendererParam(t,e){this.Au=t,this.I=t.getRCUid(),this.C_s=e}getUid(){return this.uid}getRCUid(){return this.I}getRPIndex(){return this.C_s}hasSorter(){return null!=this.A_M}setSorter(t){this.A_M=t,null!=this.C_z&&this.C_z.setSorter(t)}setSortEnabled(t){this.C_t<1?this.C_0=t:null!=this.C_z&&(this.C_z.sortEnabled=t)}getSortEnabled(){return this.C_0}getUnitsTotal(){return this.C_t}addNodeToBlock(t){let e=null;if(t.shdUid>=n.Gj)throw Error("Shader uid >= "+n.Gj);this.C_w[t.shdUid]<0?(e=this.createBlock(),e.batchEnabled=this.BE,e.fixedState=this.BF,e.batchEnabled?e.fixedState?e.runMode=2:e.runMode=1:e.runMode=0,e.shdUid=t.shdUid,e.index=this.C_v,e.procuid=this.C_s,this.C_u.push(e),this.C_w[t.shdUid]=this.C_v,++this.C_v):e=this.C_u[this.C_w[t.shdUid]],t.index=e.index,e.addNode(t)}rejoinRunitForTro(t){let e=this.BC.getNodeByUid(t.__$rpuid);null!=e&&(e.tro=t.tro,e.texMid=e.unit.texMid,this.C_u[e.index].rejoinNode(e))}rejoinRunitForVro(t){let e=this.BC.getNodeByUid(t.__$rpuid);null!=e&&(e.drawMode=t.drawMode,e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,e.vtxUid=t.vtxUid,e.vro=t.vro,this.C_u[e.index].rejoinNode(e),this.C_1++)}addDisp(t){if(null!=t&&null!=t.__$$runit&&t.__$$runit.getRPROUid()<0&&t.__$$runit.getRPROUid()!=this.uid){let e=this.BC.create();e.unit=this.Ai.getNodeByUid(t.__$ruid),e.unit.shader=this.A_K,e.unit.__$rprouid=this.uid,t.__$rpuid=e.uid,e.__$ruid=t.__$ruid,e.unit.__$rpuid=e.uid,e.updateData(),++this.C_t,this.Ai.setRPNodeParam(t.__$ruid,this.getUid(),e.uid),this.C_0?(null!=this.C_z||(this.C_z=new r.default(this.A_K),this.C_z.setSorter(this.A_M)),this.C_z.addNode(e)):this.addNodeToBlock(e),this.C_1++}}updateDispMateiral(t){if(null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),s=this.BC.getNodeByUid(e);s.shdUid=s.unit.shdUid,s.texMid=s.unit.texMid,s.tro=s.unit.tro;let i=this.C_u[s.index];i.removeNode(s),this.addNodeToBlock(s)}}removeDisp(t){if(null!=t&&null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),s=this.BC.getNodeByUid(e);if(null!=s){if(null==this.C_z){let t=this.C_u[s.index];t.removeNode(s)}else this.C_z.removeNode(s);this.Ai.setRPNodeParam(t.__$ruid,this.getUid(),-1),--this.C_t;let e=s.unit;this.BC.restore(s)&&this.Ai.restore(e),this.BD.__$detachRes(t.vbuf.getUid()),t.__$$runit=null,t.__$ruid=-1,this.C_1++}}}getStatus(){return this.C_1}removeDispUnit(t){if(null!=t&&t.__$ruid>-1){let e=t.__$$runit.getRPOUid(),s=this.BC.getNodeByUid(e);if(null!=s){if(null==this.C_z){let t=this.C_u[s.index];t.removeNode(s)}else this.C_z.removeNode(s);this.Ai.setRPNodeParam(t.__$ruid,this.C_s,-1),s.unit.__$rprouid=-1,--this.C_t,this.BC.restore(s)}}}update(){this.A_P&&this.C_t>0&&null!=this.C_z&&this.C_z.update()}run(){if(this.A_P&&this.C_t>0){let t=this.Au;if(null==this.C_z)if(this.A_K.isUnLocked())for(let e=0;e<this.C_v;++e)this.C_u[e].run(t);else for(let e=0;e<this.C_v;++e)this.C_u[e].runLockMaterial(t);else this.A_K.isUnLocked()?this.C_z.run(t):this.C_z.runLockMaterial(t)}}drawDisp(t,e=!1,s=!0){if(null!=t){let i=t.__$$runit;null!=i&&(this.A_K.isUnLocked()?(s&&this.A_K.resetUniform(),this.C_y.drawUnit(this.Au,i,t)):this.C_y.drawLockMaterialByUnit(this.Au,i,t,e,s))}}drawLockMaterialByDisp(t,e=!1,s=!0){if(null!=t){let i=t.__$$runit;null!=i&&this.C_y.drawLockMaterialByUnit(this.Au,i,t,e,s)}}reset(){this.C_0=!1,this.C_t=0,this.uid=-1,this.C_s=-1,this.I=-1,this.C_s=-1;let t=0;for(;t<this.C_v;++t)this.C_u[t].reset();this.C_v=0,this.C_u=[],this.BC=null,this.Ai=null,this.BD=null,this.Au=null,null!=this.C_z&&(this.C_z.clear(),this.C_z=null)}showInfo(){let t=0;for(;t<this.C_v;++t)this.C_u[t].showInfo()}destroy(){this.reset()}setEnabled(t){this.A_P=t}getEnabled(){return this.A_P}toString(){return"[RenderProcess(uid = "+this.C_s+")]"}}n.Gj=1024,e.default=n},"76b0":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("35fa")),a=i(s("8a0a")),n=i(s("fecb")),l=i(s("cb29")),h=i(s("e7d2")),o=s("e08e"),m=i(s("3930"));class _ extends l.default{constructor(t=a.default.VTX_STATIC_DRAW){super(t),this.color0=new m.default,this.color1=new m.default,this.color2=new m.default,this.color3=new m.default,this.offsetU=0,this.offsetV=0,this.uScale=1,this.vScale=1,this.flipVerticalUV=!1,this.axisFlag=0,this.C_2=!0,this.B_o=null,this.B_U=null,this.B_p=null,this.B_e=null,this.B_q=null,this.B_r=null,this.vsFloat32=null,this.dataStepList=null}getVS(){return this.B_o}getUVS(){return this.B_U}setUVS(t){null!=t&&8==t.length&&(null==this.B_U?this.B_U=t.slice(0):this.B_U.set(t))}getNVS(){return this.B_p}getCVS(){return this.B_e}initialize(t,e,s,i){if(null!=this.B_o)return;let l=t,m=e,_=t+s,u=e+i,d=0;switch(this.B_t=new Uint16Array([0,1,2,0,2,3]),this.axisFlag){case 0:this.B_o=new Float32Array([l,m,d,_,m,d,_,u,d,l,u,d]);break;case 1:this.B_o=new Float32Array([_,d,m,l,d,m,l,d,u,_,d,u]);break;case 2:this.B_o=new Float32Array([d,l,m,d,_,m,d,_,u,d,l,u]);break;default:break}if(null==this.bounds&&(this.bounds=new n.default),this.bounds.addXYZFloat32Arr(this.B_o),this.bounds.updateFast(),h.default.Reset(),h.default.AddFloat32Data(this.B_o,3),null==this.B_U&&this.isVBufEnabledAt(a.default.VBUF_UVS_INDEX)&&(this.flipVerticalUV?this.B_U=new Float32Array([this.offsetU+0*this.uScale,this.offsetV+1*this.vScale,this.offsetU+1*this.uScale,this.offsetV+1*this.vScale,this.offsetU+1*this.uScale,this.offsetV+0*this.vScale,this.offsetU+0*this.uScale,this.offsetV+0*this.vScale]):this.B_U=new Float32Array([this.offsetU+0*this.uScale,this.offsetV+0*this.vScale,this.offsetU+1*this.uScale,this.offsetV+0*this.vScale,this.offsetU+1*this.uScale,this.offsetV+1*this.vScale,this.offsetU+0*this.uScale,this.offsetV+1*this.vScale])),this.isVBufEnabledAt(a.default.VBUF_NVS_INDEX))switch(this.axisFlag){case 0:this.B_p=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]);break;case 1:this.B_p=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0]);break;case 2:this.B_p=new Float32Array([1,0,0,1,0,0,1,0,0,1,0,0]);break;default:break}if(this.isVBufEnabledAt(a.default.VBUF_CVS_INDEX)&&(this.B_e=new Float32Array([this.color0.r,this.color0.g,this.color0.b,this.color1.r,this.color1.g,this.color1.b,this.color2.r,this.color2.g,this.color2.b,this.color3.r,this.color3.g,this.color3.b])),this.isVBufEnabledAt(a.default.VBUF_TVS_INDEX)){let t=2;this.B_q=new Float32Array(12),this.B_r=new Float32Array(12),r.default.ClacTrisTangent(this.B_o,this.B_o.length,this.B_U,this.B_p,t,this.B_t,this.B_q,this.B_r)}this.drawMode=o.RenderDrawMode.ELEMENTS_TRIANGLES,this.buildVbuf(),this.vtxTotal=4,this.trisNumber=2,this.buildEnd()}reinitialize(){this.buildVbuf()}buildVbuf(){h.default.Reset(),h.default.AddFloat32Data(this.B_o,3),this.isVBufEnabledAt(a.default.VBUF_UVS_INDEX)&&h.default.AddFloat32Data(this.B_U,2),this.isVBufEnabledAt(a.default.VBUF_NVS_INDEX)&&h.default.AddFloat32Data(this.B_p,3),this.isVBufEnabledAt(a.default.VBUF_CVS_INDEX)&&h.default.AddFloat32Data(this.B_e,3),this.isVBufEnabledAt(a.default.VBUF_TVS_INDEX)&&(h.default.AddFloat32Data(this.B_q,3),h.default.AddFloat32Data(this.B_r,3)),h.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.updateWireframeIvs(),this.vtCount=this.B_t.length,null!=this.B_u?(this.forceUpdateIVS&&this.B_u.setUintIVSData(this.B_t),h.default.UpdateBufData(this.B_u)):this.B_u=h.default.CreateBySaveData(this.getBufDataUsage(),this.getBufSortFormat()),this.B_u.setUintIVSData(this.B_t),this.buildEnd()}isPolyhedral(){return this.C_2}setPolyhedral(t){this.C_2=t}testRay(t,e,s,i){if(this.C_2)return-1;if(i){let i=n.default.IntersectionRL2(e,t,this.bounds,s);return i?1:-1}return-1}toString(){return"[RectPlaneMesh()]"}__$destroy(){this.isResFree()&&(this.bounds=null,this.B_o=null,this.B_U=null,this.B_p=null,this.B_e=null,super.__$destroy())}}e.default=_},"77cf":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("3077")),n=s("5216"),l=s("a9bf"),h=s("c70f");class o{constructor(t=0){this.b=-1,this.C_3=new h.GlobalEnvLightUniformParam,this.C_4=null,this.C_5=null,this.C_6=!1,this.C_7=0,this.C_8=!0,this.C_9=!0,this.C_=null,this.C_7=t,this.b=o.F_0++}setEnvAmbientMap(t){null==this.C_&&null!=t&&(this.C_=t,this.C_.__$attachThis())}getUid(){return this.b}setAmbientColorRGB3f(t,e,s){let i=r.default.EnvLightParams.data;i[0]=t,i[1]=e,i[2]=s,this.C_6=!0}setFogColorRGB3f(t,e,s){let i=r.default.EnvLightParams.data;i[8]=t,i[9]=e,i[10]=s,this.C_6=!0}setFogDensity(t){r.default.EnvLightParams.data[11]=t,this.C_6=!0}setFogNear(t){r.default.EnvLightParams.data[6]=t,this.C_6=!0}setFogFar(t){r.default.EnvLightParams.data[7]=t,this.C_6=!0}setFogAreaOffset(t,e){r.default.EnvLightParams.data[12]=t,r.default.EnvLightParams.data[13]=e,this.C_6=!0}setFogAreaSize(t,e){r.default.EnvLightParams.data[14]=t,r.default.EnvLightParams.data[15]=e,this.C_6=!0}setEnvAmbientLightAreaOffset(t,e){r.default.EnvLightParams.data[16]=t,r.default.EnvLightParams.data[17]=e,this.C_6=!0}setEnvAmbientLightAreaSize(t,e){r.default.EnvLightParams.data[18]=t,r.default.EnvLightParams.data[19]=e,this.C_6=!0}resetPipe(){this.C_8=!0,this.C_9=!0}getTextures(t,e,s){return null!=this.C_&&s==n.MaterialPipeType.ENV_AMBIENT_LIGHT?(null==e&&(e=[]),e.push(this.C_),t.uniform.add2DMap("VOX_ENV_AMBIENT_LIGHT_LIGHT_MAP",!0,!0,!1),e):null}useShaderPipe(t,e){if(null!=this.C_4)switch(e){case n.MaterialPipeType.ENV_LIGHT_PARAM:this.buildUniformCode(t);break;case n.MaterialPipeType.FOG:case n.MaterialPipeType.FOG_EXP2:this.buildUniformCode(t),this.useFogData(t,e==n.MaterialPipeType.FOG_EXP2,!0);break;case n.MaterialPipeType.ENV_AMBIENT_LIGHT:this.buildUniformCode(t);break;default:break}}getPipeTypes(){return[n.MaterialPipeType.ENV_LIGHT_PARAM,n.MaterialPipeType.FOG,n.MaterialPipeType.FOG_EXP2,n.MaterialPipeType.ENV_AMBIENT_LIGHT]}getPipeKey(t){switch(t){case n.MaterialPipeType.ENV_LIGHT_PARAM:case n.MaterialPipeType.FOG:case n.MaterialPipeType.FOG_EXP2:case n.MaterialPipeType.ENV_AMBIENT_LIGHT:return"["+t+"]";default:break}return""}useUniforms(t){null!=this.C_4&&t.addFragUniformParam(r.default.EnvLightParams)}buildUniformCode(t){this.C_9&&(this.C_9=!1,this.C_3.use(t))}useFogData(t,e,s){t.addDefine("VOX_USE_FOG","1"),e&&t.addDefine("VOX_FOG_EXP2","1"),t.addVarying("float","v_fogDepth"),this.useShaderCode(t,s)}useShaderCode(t,e){this.C_8&&(this.C_8=!1,e?t.addShaderObject(l.EnvShaderCode):t.addShaderObjectHead(l.EnvShaderCode))}initialize(){null==this.C_4&&(this.C_4=new a.default,this.C_4.bindSlotAt(this.C_7),this.C_4.addVec4Data(r.default.EnvLightParams.data,r.default.EnvLightParams.arrayLength),this.C_5=this.C_3.createGlobalUinform(this.C_4),this.C_4.update())}update(){null!=this.C_4&&this.C_6&&(this.C_6=!1,this.C_4.update())}getGlobalUinform(){return this.C_5.clone()}}o.F_0=0,e.default=o},"78e9":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("644c"));class a{constructor(){this.type=-1,this.typeName="",this.name="",this.isArray=!1,this.arrLength=0,this.isTex=!1,this.location=null}parseCode(t){const e=";";let s=t.indexOf(e);if(s<0)return!1;const i=" ";t=t.replace(/^\s*|\s*$/g,""),s>0&&(t=t.slice(0,s));let a=t.split(i);return this.typeName=a[a.length-2],this.name=a[a.length-1],s=this.name.indexOf("["),this.isArray=s>0,this.arrLength=0,this.isArray&&(this.arrLength=parseInt(this.name.slice(s+1,this.name.indexOf("]",s+1))),this.name=this.name.slice(0,s),this.typeName+="[]"),this.type=r.default.GetTypeByTypeNS(this.typeName),!(this.type<0)&&(this.isTex=this.type==r.default.SHADER_SAMPLER2D||this.type==r.default.SHADER_SAMPLERCUBE||this.type==r.default.SHADER_SAMPLER3D,!0)}}e.default=a},"7a04":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("f044"));class a{constructor(){this.b=-1,this.B_w=0,this.layoutBit=0,this.DA=null,this.DB=null,this.DC=null,this.DD=null,this.DE=null,this.DF=null,this.DG=0,this.b=r.default.CreateNewID()}getUid(){return this.b}getType(){return 1}getBuffersTotal(){return this.DB.length}getAttribsTotal(){return this.DB.length}getF32DataAt(t){return this.DB[t]}setF32DataAt(t,e,s,i){null==this.DB&&(this.DB=[null,null,null,null,null,null,null,null],this.DE=[!1,!1,!1,!1,!1,!1,!1,!1],this.DC=[0,0,0,0,0,0,0,0],this.DD=[0,0,0,0,0,0,0,0]),this.DB[t]=e,null!=this.DF&&null!=e&&(this.DE[t]=!0),null!=i&&(this.DA=i),this.DG=s,null!=e&&(this.DC[t]=e.length)}setData4fAt(t,e,s,i,r,a){t*=this.DA[e],this.DB[e][t++]=s,this.DB[e][t++]=i,this.DB[e][t++]=r,this.DB[e][t++]=a}setData3fAt(t,e,s,i,r){t*=this.DA[e],this.DB[e][t++]=s,this.DB[e][t++]=i,this.DB[e][t++]=r}setData2fAt(t,e,s,i){t*=this.DA[e],this.DB[e][t++]=s,this.DB[e][t++]=i}destroy(){this.DB=null,this.DE=null,this.DC=null,this.DD=null,this.DB=null}toString(){return"VtxSeparatedBuf(uid = "+this.b+")"}}e.default=a},"7b0e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("bbf4"));class a{constructor(){this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rayTestState=0,this.rpoNode=null,this.spaceId=-1,this.camVisiSt=0,this.camVisi=r.default.CAMERA_VISIBLE_ENABLE}reset(){this.rayTestState=0,this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rpoNode=null,this.spaceId=-1,this.camVisi=0}static GetFreeId(){return a.f_.length>0?a.f_.pop():-1}static GetByUid(t){return t>-1&&t<a.DI?a.DH[t]:null}static SetCamVisiByUid(t,e){a.DH[t].camVisi=e}static GetCamVisiByUid(t){return a.DH[t].camVisi}static Create(){let t=null,e=a.GetFreeId();return e>=0?(t=a.DH[e],t.uid=e,a.EB[e]=a.S_FLAG_BUSY):(t=new a,a.DH.push(t),a.EB.push(a.S_FLAG_BUSY),t.uid=a.DI,a.DI++),t}static Restore(t){null!=t&&t.uid>=0&&a.EB[t.uid]==a.S_FLAG_BUSY&&(a.f_.push(t.uid),a.EB[t.uid]=a.S_FLAG_FREE,t.reset())}}a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.DI=0,a.DH=[],a.EB=[],a.f_=[],e.default=a},"7c63":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("e08e");class r{constructor(t,e,s,i){this.b=-1,this.DJ=!0,this.DK=!0,this.DL=!0,this.DM=!0,this.b=r.F_0++,this.DJ=t,this.DK=e,this.DL=s,this.DM=i}getUid(){return this.b}getR(){return this.DJ}getG(){return this.DK}getB(){return this.DL}getA(){return this.DM}use(){r.Gk!=this.b&&(r.Rstate.setColorMask(this.DJ,this.DK,this.DL,this.DM),r.Gk=this.b)}static Create(t,e,s,i,a){if(r.Gl.has(t)){let e=r.Gl.get(t);return e.getUid()}let n=(e?64:32)|(s?16:8)|(i?4:2)|(a?1:0);if(r.Gm.has(n)){let t=r.Gm.get(n);n=t.getUid()}else{let l=new r(e,s,i,a);n=l.getUid(),r.Gm.set(n,l),r.Gl.set(t,l),r.Gn.push(l),++r.Gp}return n}static GetColorMaskByName(t){if(r.Gl.has(t)){let e=r.Gl.get(t);return e.getUid()}return-1}static UseRenderState(t){r.Go&&r.Rstate.roColorMask!=t&&t>-1&&t<r.Gp&&r.Gn[t].use()}static UseColorMaskByName(t){let e=r.GetColorMaskByName(t);r.Go&&r.Rstate.roColorMask!=e&&e>-1&&e<r.Gp&&r.Gn[e].use()}static Lock(){r.Go=!1}static Unlock(){r.Go=!0}static Reset(){r.Gk=-1}}r.F_0=0,r.Gk=-1,r.Gn=[],r.Gp=1,r.Gm=new Map,r.Gl=new Map,r.Go=!0,r.ALL_TRUE_COLOR_MASK=0,r.ALL_FALSE_COLOR_MASK=1,r.Rstate=null,e.RenderColorMask=r;class a{constructor(t,e,s){this.b=-1,this.DN=0,this.DO=0,this.DP=0,this.DQ=0,this.b=a.F_0++,this.DN=t,this.DO=e,this.DP=s}getUid(){return this.b}getCullFaceMode(){return this.DN}getDepthTestMode(){return this.DP}getBlendMode(){return this.DO}use(){if(a.Gk!=this.b){a.Rstate.setCullFaceMode(this.DN);a.Gw[a.DO];a.DO<0?a.Rstate.setBlendMode(this.DO,a.Gw[this.DO]):a.Rstate.setBlendMode(a.DO,a.Gw[a.DO]),a.Gu<0?a.Rstate.setDepthTestMode(this.DP):a.Rstate.setDepthTestMode(a.Gu),a.Gk=this.b}}static CreateBlendModeSeparate(t,e,s,r,n,l=0,h=0){if(null!=t&&""!=t){let o;if(a.Gq.has(t))return o=a.Gq.get(t),a.Gr.get(o);l<1&&(l=i.GLBlendEquation.FUNC_ADD),h<1&&(h=i.GLBlendEquation.FUNC_ADD);let m=1;if(o=31,o=131*o+e,o=131*o+s,r>0&&n>0&&(o=131*o+r,o=131*o+n,m=1),a.Gr.has(o))return a.Gq.set(t,o),a.Gr.get(o);let _=++a.Gs;a.Gq.set(t,o),a.Gr.set(o,_);let u=[m,l,h,e,s,r,n];return a.Gw[_]=u,_}return 0}static CreateBlendMode(t,e,s,r=0){if(null!=t&&""!=t){let n;if(a.Gq.has(t))return n=a.Gq.get(t),a.Gr.get(n);r<1&&(r=i.GLBlendEquation.FUNC_ADD);let l=0;if(n=31,n=131*n+e,n=131*n+s,a.Gr.has(n))return a.Gr.get(n);let h=++a.Gs;a.Gq.set(t,n),a.Gr.set(n,h);let o=[l,r,0,e,s,0,0];return a.Gw[h]=o,h}return 0}static Create(t,e,s,i){if(a.Gl.has(t)){let e=a.Gl.get(t);return e.getUid()}let r=31;if(r=131*r+i,r=131*r+s,r=131*r+e,a.Gm.has(r)){let t=a.Gm.get(r);r=t.getUid()}else{let n=new a(e,s,i);r=n.getUid(),a.Gm.set(r,n),a.Gl.set(t,n),a.Gn.push(n),++a.Gp}return r}static GetRenderStateByName(t){if(a.Gl.has(t)){let e=a.Gl.get(t);return e.getUid()}return-1}static UseRenderState(t){a.Go&&a.Gk!=t&&t>-1&&t<a.Gp&&a.Gn[t].use()}static UseRenderStateByName(t){if(a.Go){let e=a.GetRenderStateByName(t);a.Gk!=e&&e>-1&&e<a.Gp&&a.Gn[e].use()}}static UnlockBlendMode(){a.DO=a.Gt}static LockBlendMode(t){a.Gt=a.DO,a.DO=t}static UnlockDepthTestMode(){a.Gu=a.Gv}static LockDepthTestMode(t){a.Gv=a.Gu,a.Gu=t}static Lock(){a.Go=!1}static Unlock(){a.Go=!0}static Reset(){a.Gk=-1}}a.F_0=0,a.Gk=-1,a.Gn=[],a.Gp=1,a.DO=-1,a.Gu=-1,a.Gm=new Map,a.Gl=new Map,a.Gq=new Map,a.Gr=new Map,a.Gs=0,a.Gw=new Array(256),a.Go=!0,a.Rstate=null,a.Gt=-1,a.Gv=-1,e.RenderStateObject=a;class n{constructor(){this.stencilMask=-1}}class l{constructor(){this.DR=new Array(128),this.DS=null,this.DO=i.RenderBlendMode.NORMAL,this.DT=i.CullFaceMode.NONE,this.DU=i.DepthTestMode.DISABLE,this.DV=!0,this.DW=null,this.F_=null,this.roColorMask=-11}reset(){this.roColorMask=-11}setRenderContext(t){this.DW=t,this.F_=t.getRC();let e=this.F_.rcuid;this.DS=this.DR[e],null==this.DS&&(this.DS=this.DR[e]=new n)}setColorMask(t,e,s,i){this.F_.colorMask(t,e,s,i)}setStencilFunc(t,e,s){this.F_.stencilFunc(t,e,s)}setStencilMask(t){this.DS.stencilMask!=t&&t>=0&&(this.DS.stencilMask=t,this.F_.stencilMask(t))}setStencilOp(t,e,s){this.F_.stencilOp(t,e,s)}setDepthTestEnable(t){t?this.F_.enable(this.F_.DEPTH_TEST):this.F_.disable(this.F_.DEPTH_TEST)}setCullFaceEnable(t){t?this.F_.enable(this.F_.CULL_FACE):this.F_.disable(this.F_.CULL_FACE)}setBlendEnable(t){t?this.F_.enable(this.F_.BLEND):this.F_.disable(this.F_.BLEND)}setCullFaceMode(t){this.DT!=t&&(this.DT=t,t!=i.CullFaceMode.NONE?(this.DV&&(this.DV=!1,this.F_.enable(this.F_.CULL_FACE)),this.F_.cullFace(t)):this.DV||(this.DV=!0,this.F_.disable(this.F_.CULL_FACE)))}setBlendMode(t,e){this.DO!=t&&(this.DO=t,t>0?e[0]<1?(this.F_.blendEquation(this.F_.FUNC_ADD),this.F_.blendFunc(this.F_.ONE,this.F_.ZERO),this.F_.blendEquation(e[1]),this.F_.blendFunc(e[3],e[4])):(this.F_.blendEquationSeparate(e[1],e[2]),this.F_.blendFuncSeparate(e[3],e[4],e[5],e[6])):this.F_.disable(this.F_.BLEND))}setDepthTestMode(t){if(this.DU!=t)switch(this.DU=t,t){case i.DepthTestMode.ALWAYS:this.F_.depthMask(!1),this.F_.depthFunc(this.F_.ALWAYS);break;case i.DepthTestMode.SKY:this.F_.depthMask(!0),this.F_.depthFunc(this.F_.LEQUAL);break;case i.DepthTestMode.OPAQUE:this.F_.depthMask(!0),this.F_.depthFunc(this.F_.LESS);break;case i.DepthTestMode.OPAQUE_OVERHEAD:this.F_.depthMask(!1),this.F_.depthFunc(this.F_.EQUAL);break;case i.DepthTestMode.DECALS:this.F_.depthMask(!1),this.F_.depthFunc(this.F_.LEQUAL);break;case i.DepthTestMode.BLEND:this.F_.depthMask(!1),this.F_.depthFunc(this.F_.LESS);break;case i.DepthTestMode.WIRE_FRAME:this.F_.depthMask(!0),this.F_.depthFunc(this.F_.LEQUAL);break;case i.DepthTestMode.NEXT_LAYER:this.F_.depthMask(!1),this.F_.depthFunc(this.F_.ALWAYS);break;case i.DepthTestMode.TRUE_EQUAL:this.F_.depthMask(!0),this.F_.depthFunc(this.F_.EQUAL);break;case i.DepthTestMode.TRUE_GREATER:this.F_.depthMask(!0),this.F_.depthFunc(this.F_.GREATER);break;case i.DepthTestMode.TRUE_GEQUAL:this.F_.depthMask(!0),this.F_.depthFunc(this.F_.GEQUAL);break;case i.DepthTestMode.WIRE_FRAME_NEXT:break;default:break}}}e.RODrawState=l},"81c4":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("f48d")),n=i(s("d1a0"));class l extends a.default{constructor(){super(...arguments),this.radiusSquared=2500,this.tv=new r.default(1,0,0),this.center=new r.default(50,0,0),this.anotherPosition=new r.default(100,0,0),this.length=100}intersectionCopSLV2(t,e,s){r.default.Cross(this.tv,e,a.default.__tV1),r.default.Cross(this.tv,a.default.__tV1,a.default.__tV2),a.default.__tV2.normalize(),n.default.IntersectionSLV2(a.default.__tV2,a.default.__tV2.dot(this.position),t,e,s),a.default.__tV2.x=s.x-this.position.x,a.default.__tV2.y=s.y-this.position.y,a.default.__tV2.z=s.z-this.position.z;let i=a.default.__tV2.dot(this.tv);i<0?s.copyFrom(this.position):i>this.length&&s.copyFrom(this.anotherPosition)}update(){this.tv.x=this.anotherPosition.x-this.position.x,this.tv.y=this.anotherPosition.y-this.position.y,this.tv.z=this.anotherPosition.z-this.position.z,this.length=this.tv.getLength(),this.tv.x*=.5,this.tv.y*=.5,this.tv.z*=.5,this.center.x=this.position.x+this.tv.x,this.center.y=this.position.y+this.tv.y,this.center.z=this.position.z+this.tv.z,this.radiusSquared=this.tv.getLengthSquared(),this.tv.normalize()}updateFast(){this.update()}}e.default=l},"81ce":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Es2VtxShderToES3(t){let e=t;const s="attribute",i="varying ";let r=e.indexOf(s),a=0;while(r>=0)e=e.slice(0,r)+"layout(location="+a+") in"+e.slice(r+9),r=e.indexOf(s),a++;let n=new RegExp(i,"g");return e=e.replace(n,"out "),"#version 300 es\n"+e}static Es2FragShderToES3(t){let e=t;const s="gl_FragColor",i="varying ";let r=e.indexOf(s),a=0,n="FragColorOut_"+a;r>=0&&(e=e.slice(0,r)+n+e.slice(r+12)),r=e.indexOf("void "),e=e.slice(0,r)+"out vec4 "+n+";\n"+e.slice(r);let l=new RegExp(i,"g");return e=e.replace(l,"in "),l=new RegExp(" texture2D","g"),e=e.replace(l," texture"),l=new RegExp(" textureCube","g"),e=e.replace(l," texture"),"#version 300 es\n"+e}static Es3VtxShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const s=/\blayout\b.+\bin\b/g;t=t.replace(s,"attribute");const r=/\bout\b/g;t=t.replace(r,"varying");const a=/\btexture\b/g;t=t.replace(a,"texture2D"),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version"));let n=0,l=0,h=t.indexOf("inverse(");h<0&&(h=t.indexOf("inverse ("));let o="",m=!1,_=!1;while(h>3){if(n=t.indexOf(")",h+2),o=t.slice(h+2,n),o.indexOf("mat3")>0)m=!0;else if(o=o.replace(/\s+/g,""),n=o.indexOf("("),o=o.slice(n+1),n=t.indexOf(o,1),l=t.lastIndexOf("mat",n),l>0)switch(o=t.slice(l,n),o=o.replace(/\s+/g,""),o){case"mat3":m=!0;break;case"mat4":_=!0;break}if(h=t.indexOf("inverse(",h+5),h<0&&(h=t.indexOf("inverse (",h+5)),m&&_)break}n=0,h=t.indexOf("transpose("),h<0&&(h=t.indexOf("transpose (")),o="";let u=!1,d=!1;while(h>3){if(n=t.indexOf(")",h+2),o=t.slice(h+2,n+1),o.indexOf("mat3")>0)u=!0;else if(o=o.replace(/\s+/g,""),n=o.indexOf("("),o=o.slice(n+1),n=t.indexOf(o,1),l=t.lastIndexOf("mat",n),l>0)switch(o=t.slice(l,n),o=o.replace(/\s+/g,""),o){case"mat3":u=!0;break;case"mat4":d=!0;break}if(h=t.indexOf("transpose(",h+5),h<0&&(h=t.indexOf("transpose (",h+5)),u&&d)break}return(m||_)&&(h=t.indexOf("void "),h>10&&(m&&_?t=t.slice(0,h)+i.__glslInverseMat3+i.__glslInverseMat4+t.slice(h):m?t=t.slice(0,h)+i.__glslInverseMat3+t.slice(h):_&&(t=t.slice(0,h)+i.__glslInverseMat4+t.slice(h)))),(u||d)&&(h=t.indexOf("void "),h>10&&(u&&d?t=t.slice(0,h)+i.__glslTransposeMat3+i.__glslTransposeMat4+t.slice(h):u?t=t.slice(0,h)+i.__glslTransposeMat3+t.slice(h):d&&(t=t.slice(0,h)+i.__glslTransposeMat4+t.slice(h)))),t}static Es3FragShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const s=new RegExp(" in ","g");t=t.replace(s,"_fref_");const i=/\bin\b/g;t=t.replace(i,"varying");const r=new RegExp("_fref_","g");t=t.replace(r," in ");const a=/\btexture\b/g;t=t.replace(a,"texture2D");const n=/" "/g;let l=t;const h=";",o="layout";let m=l.indexOf(o),_=0,u=0,d="",c="",f=0,p=null,g=[],v=[];while(m>=0)_=l.indexOf(h,m+1),d=l.slice(m+1,_),c=d.slice(d.lastIndexOf(" ")+1),f=d.indexOf(")"),m=d.lastIndexOf("=",f)+1,d=d.slice(m+1,f),f=parseInt(d.replace(n,"")),g.push(c),v.push(f),m=l.indexOf(o,_);let x=g.length;if(x>0)if(p=/layout/g,t=t.replace(p,"//layout"),x>1){m=0;while(m<x)p=new RegExp(g[m],"g"),t=t.replace(p,"gl_FragData["+v[m]+"]"),++m}else p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor");else m=l.indexOf("out "),m>0&&(_=l.indexOf(h,m+1),d=l.slice(m+1,_),c=d.slice(d.lastIndexOf(" ")+1),p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor"),p=/\bout\b/g,t=t.replace(p,"//out"));x>1&&(t="#extension GL_EXT_draw_buffers: require\n"+t),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version")),m=0;for(let T=0;T<16;++T){if(m=t.indexOf("samplerCube ",m),!(m>0))break;{_=t.indexOf(";",m),d=l.slice(m+12,_),c="";let e=d.split(" ");for(let t=0;t<16;++t)if(""!=e[t]){c=e[t];break}for(x=0;x<16;++x){if(_=t.indexOf(c,_+1),!(_>0))break;if(u=t.lastIndexOf("texture2D",_-1),u<0)break;d=t.slice(u,_),t=t.slice(0,u)+"textureCube("+t.slice(_),_+=2}}m+=4}return t}}i.__glslTransposeMat3="\n    mat3 transpose(mat3 m) {\n        return mat3(m[0][0],m[1][0],m[2][0],\n            m[0][1],m[1][1],m[2][1],\n            m[0][2],m[1][2],m[2][2]);\n    }\n    ",i.__glslTransposeMat4="\n    mat4 transpose(mat4 m) {\n        return mat4(m[0][0],m[1][0],m[2][0],m[3][0],\n            m[0][1],m[1][1],m[2][1],m[3][1],\n            m[0][2],m[1][2],m[2][2],m[3][2],\n            m[0][3],m[1][3],m[2][3],m[3][3]);\n    }\n    ",i.__glslInverseMat3="\n    mat3 inverse(mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];  \n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;  \n        float det = a00 * b01 + a01 * b11 + a02 * b21;  \n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n    ",i.__glslInverseMat4="\n    mat4 inverse(mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n        }\n    ",e.default=i},"829f":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("cfaf")),a=i(s("bd6f")),n=i(s("6661")),l=i(s("29ef")),h=i(s("85b6")),o=i(s("baae"));class m{constructor(t,e=2){if(this.DX=2,this.A_q=null,this.DY=null,this.DZ=null,this.Da=null,this.Db=null,this.Dc=[null,null],this.Dd=null,this.De=!1,this.Df=6,this.Dg=2,this.Dh=-1,this.Di=!0,this.Dj=0,this.Dk=0,this.Dl=null,this.A_q=t,e>=0&&e<3&&(this.DX=e),null==this.Dd){this.Dd=[null,null];let t=new h.default(32,32,!0);t.__$setRenderProxy(this.A_q.getRenderProxy());let e=new h.default(32,32,!0);e.__$setRenderProxy(this.A_q.getRenderProxy()),this.Dd[0]=t,this.Dd[1]=e,this.Dc=[new r.default(32,32),new r.default(32,32)],t.attachTex(this.Dc[0]),e.attachTex(this.Dc[1])}}bindSrcProcessId(t){this.Dh=t}bindSrcProcess(t){this.Dh=t.getRPIndex()}bindDrawEntity(t){this.Dl=t}setBackbufferVisible(t){this.De=t}setSyncViewSizeEnabled(t){this.Di=t}setBlurCount(t){t<1&&(t=1),this.Df=t}setBlurDensity(t){this.Dg=t}setFBOSize(t,e){(Math.abs(this.Dj-t)>.1||Math.abs(this.Dk-e))&&(this.Dj=t,this.Dk=e,this.Di=!1,null!=this.Dc[0]&&this.Dc[0].setSize(t,e),null!=this.Dc[1]&&this.Dc[1].setSize(t,e))}getDstTexture(){return this.getTextureAt(this.Df%2)}swapTextureAt(t,e){t>0&&t<2&&null!=e&&e!=this.Dc[t]&&(this.Dc[t]=e,this.Dd[t].attachTex(e))}getTextureAt(t){return null!=this.Dc[t]?(this.Dj*this.Dk>0?this.Dc[t].setSize(this.Dj,this.Dk):this.Dc[t].setSize(this.A_q.getViewWidth(),this.A_q.getViewHeight()),this.Dc[t]):null}updateState(t){if(null==this.DY){let t=0,e=1;switch(this.DX){case m.HORIZONTAL:e=0;break;case m.VERTICAL:t=1;break;default:break}this.Db=new n.default(e),this.Db.setBlurDensity(this.Dg);let s=new a.default;s.setMaterial(this.Db),s.initializeXOY(-1,-1,2,2,[this.Dd[0]]),s.setRenderState(l.default.BACK_NORMAL_ALWAYS_STATE),this.DY=s,this.Da=new n.default(t),this.Da.setBlurDensity(this.Dg),s=new a.default,s.setMaterial(this.Da),s.copyMeshFrom(this.DY),s.initializeXOY(-1,-1,2,2,[this.Dd[1]]),s.setRenderState(l.default.BACK_NORMAL_ALWAYS_STATE),this.DZ=s}let e=t.getFBOFitWidth(),s=t.getFBOFitHeight();this.Dj*this.Dk>0&&(e=this.Dj,s=this.Dk),this.Db.setTexSize(e,s),this.Da.setTexSize(e,s)}run(t=-1){let e=this.A_q.getRenderProxy(),s=e.getRenderAdapter();this.Di?s.synFBOSizeWithViewport():s.asynFBOSizeWithViewport(),t<0&&(t=this.Dh),this.updateState(s),s.setRenderToTexture(this.getTextureAt(0),!0,!1,0),s.useFBO(!0,!0,!1),null!=this.Dl&&this.A_q.drawEntity(this.Dl),t>=0&&this.A_q.runAt(t);let i=0;for(;i<this.Df;++i)s.setRenderToTexture(this.getTextureAt(1-i%2),!0,!1,0),s.useFBO(!0,!0,!1),i%2==0?this.A_q.drawEntity(this.DY):this.A_q.drawEntity(this.DZ);this.De&&(s.setRenderToBackBuffer(o.default.FRAMEBUFFER),e.unlockRenderState(),i%2==0?this.A_q.drawEntity(this.DY):this.A_q.drawEntity(this.DZ))}destroy(){null!=this.A_q&&(this.A_q.removeEntity(this.DY),this.A_q.removeEntity(this.DZ),this.DY.destroy(),this.DZ.destroy(),this.DY=null,this.DZ=null,this.Da=null,this.Db=null,this.Dc[0]=null,this.Dc[1]=null,this.A_q=null)}}m.HORIZONTAL=0,m.VERTICAL=1,m.DEFALUT=2,e.default=m},8333:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.COLOR_BUFFER_BIT=131,i.DEPTH_BUFFER_BIT=132,i.STENCIL_BUFFER_BIT=133,e.default=i},"839a":function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["Default"]=1]="Default",t[t["FragColor"]=2]="FragColor",t[t["SpecularMapColor"]=3]="SpecularMapColor"}(i||(i={})),e.SpecularMode=i},"83d1":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279"));class n{create(t,e){let s=null,i=r.default.StageParam;return e.hasUniformByName(i.name)&&(s=new a.default,s.uns=i.name,s.uniformNameList=[i.name],s.copyDataFromProbe(t.getStage3D().uProbe)),s}getIDNS(){return"StageParamUniformBuilder"}}e.default=n},"857b":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279"));class n{create(t,e){let s=null,i=r.default.CameraPosParam;return e.hasUniformByName(i.name)&&(s=new a.default,s.uns=i.name,s.uniformNameList=[i.name],s.copyDataFromProbe(t.getCamera().ucameraPosProbe)),s}getIDNS(){return"CameraPosUniformBuilder"}}e.default=n},"85b6":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class n extends a.default{constructor(t,e,s=!1){super(t,e,s),this.Dm=null,this.v=r.TextureProxyType.Wrapper}getResUid(){return this.Dm.getResUid()}getBufWidth(){return this.Dm.getBufWidth()}getBufHeight(){return this.Dm.getBufHeight()}getWidth(){return this.Dm.getWidth()}getHeight(){return this.Dm.getHeight()}isDirect(){return!1}getAttachTex(){return this.Dm}attachTex(t){null!=t&&t!=this&&(this.Dm!=t&&t.__$attachThis(),this.Dm=t)}detachTex(){null!=this.Dm&&this.Dm.__$detachThis(),this.Dm=null}__$attachThis(){super.__$attachThis(),null!=this.Dm&&this.Dm.__$attachThis()}__$detachThis(){super.__$detachThis(),null!=this.Dm&&this.Dm.__$detachThis()}__$$use(t){this.Dm.__$$use(t)}isGpuEnabled(){return this.Dm.isGpuEnabled()}getSampler(){return this.Dm.getSampler()}__$updateToGpu(t){this.Dm.__$updateToGpu(t)}__$$upload(t){this.Dm.__$$upload(t)}__$destroy(){this.getAttachCount()<1&&(null!=this.Dm&&this.Dm.__$detachThis(),this.Dm=null,super.__$destroy())}isDataEnough(){return this.Dm.isDataEnough()}getTargetType(){return this.Dm.getTargetType()}toString(){return"[WrapperTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},8602:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("3930"));class n{constructor(){this.position=new r.default(0,100,0),this.color=new a.default(1,1,1,1),this.attenuationFactor1=1e-4,this.attenuationFactor2=5e-4}}e.PointLight=n},8875:function(t,e,s){var i,r,a;(function(s,n){r=[],i=n,a="function"===typeof i?i.apply(e,r):i,void 0===a||(t.exports=a)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(d){var s,i,r,a=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,n=/@([^@]*):(\d+):(\d+)\s*$/gi,l=a.exec(d.stack)||n.exec(d.stack),h=l&&l[1]||!1,o=l&&l[2]||!1,m=document.location.href.replace(document.location.hash,""),_=document.getElementsByTagName("script");h===m&&(s=document.documentElement.outerHTML,i=new RegExp("(?:[^\\n]+?\\n){0,"+(o-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=s.replace(i,"$1").trim());for(var u=0;u<_.length;u++){if("interactive"===_[u].readyState)return _[u];if(_[u].src===h)return _[u];if(h===m&&_[u].innerHTML&&_[u].innerHTML.trim()===r)return _[u]}return null}}return t}))},"899a":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}static Reset(){i.Flag_0=0}}i.Flag_0=0,e.default=i},"8a0a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ca6c"));class a{static ToGL(t,e){switch(e){case a.VTX_STATIC_DRAW:return t.STATIC_DRAW;case a.VTX_DYNAMIC_DRAW:return t.DYNAMIC_DRAW;case a.VTX_STREAM_DRAW:return t.STREAM_DRAW;case a.VTX_STATIC_READ:return t.STATIC_READ;case a.VTX_DYNAMIC_READ:return t.DYNAMIC_READ;case a.VTX_STREAM_READ:return t.STREAM_READ;case a.VTX_STATIC_COPY:return t.STATIC_COPY;case a.VTX_DYNAMIC_COPY:return t.DYNAMIC_COPY;case a.VTX_STREAM_COPY:return t.STREAM_COPY;default:break}return t.STATIC_DRAW}static GetVBufTypeByNS(t){switch(t){case a.VBUF_VS_NS:return a.VBUF_VS;case a.VBUF_UVS_NS:return a.VBUF_UVS;case a.VBUF_NVS_NS:return a.VBUF_NVS;case a.VBUF_CVS_NS:return a.VBUF_CVS;case a.VBUF_VS2_NS:return a.VBUF_VS2;case a.VBUF_UVS2_NS:return a.VBUF_UVS2;case a.VBUF_NVS2_NS:return a.VBUF_NVS2;case a.VBUF_CVS2_NS:return a.VBUF_CVS2;case a.VBUF_TVS_NS:return a.VBUF_TVS;case a.VBUF_TVS2_NS:return a.VBUF_TVS2;default:}return-1}static GetVBufNSByType(t){switch(t){case a.VBUF_VS:return a.VBUF_VS_NS;case a.VBUF_UVS:return a.VBUF_UVS_NS;case a.VBUF_NVS:return a.VBUF_NVS_NS;case a.VBUF_CVS:return a.VBUF_CVS_NS;case a.VBUF_VS2:return a.VBUF_VS2_NS;case a.VBUF_UVS2:return a.VBUF_UVS2_NS;case a.VBUF_NVS2:return a.VBUF_NVS2_NS;case a.VBUF_CVS2:return a.VBUF_CVS2_NS;case a.VBUF_TVS:return a.VBUF_TVS_NS;case a.VBUF_TVS2:return a.VBUF_TVS2_NS;default:}return""}static GetVBufAttributeTypeByNS(t){return a.GetVBufTypeByNS(t)-3e3}}a.VTXTYPE_GL_POINTS=101,a.VTXTYPE_GL_LINES=102,a.VTXTYPE_GL_LINE_STRIP=103,a.VTXTYPE_GL_TRIANGLES=111,a.VTX_STATIC_DRAW=0,a.VTX_DYNAMIC_DRAW=1,a.VTX_STREAM_DRAW=2,a.VTX_STATIC_READ=3,a.VTX_DYNAMIC_READ=4,a.VTX_STREAM_READ=5,a.VTX_STATIC_COPY=6,a.VTX_DYNAMIC_COPY=7,a.VTX_STREAM_COPY=8,a.VBUF_VS=3001,a.VBUF_UVS=3002,a.VBUF_NVS=3003,a.VBUF_CVS=3004,a.VBUF_TVS=3005,a.VBUF_VS2=3006,a.VBUF_UVS2=3007,a.VBUF_NVS2=3008,a.VBUF_CVS2=3009,a.VBUF_TVS2=3010,a.VBUF_VS_INDEX=r.default.BIT_ONE_0,a.VBUF_UVS_INDEX=r.default.BIT_ONE_1,a.VBUF_NVS_INDEX=r.default.BIT_ONE_2,a.VBUF_CVS_INDEX=r.default.BIT_ONE_3,a.VBUF_TVS_INDEX=r.default.BIT_ONE_4,a.VBUF_VS2_INDEX=r.default.BIT_ONE_5,a.VBUF_UVS2_INDEX=r.default.BIT_ONE_6,a.VBUF_NVS2_INDEX=r.default.BIT_ONE_7,a.VBUF_CVS2_INDEX=r.default.BIT_ONE_8,a.VBUF_TVS2_INDEX=r.default.BIT_ONE_9,a.VBUF_VS_NS="a_vs",a.VBUF_VS2_NS="a_vs2",a.VBUF_UVS_NS="a_uvs",a.VBUF_UVS2_NS="a_uvs2",a.VBUF_NVS_NS="a_nvs",a.VBUF_NVS2_NS="a_nvs2",a.VBUF_CVS_NS="a_cvs",a.VBUF_CVS2_NS="a_cvs2",a.VBUF_TVS_NS="a_tvs",a.VBUF_TVS2_NS="a_tvs2";class n{}n.FLAT=210,n.GOURAND=310,e.VtxNormalType=n,e.default=a},"8ae4":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.b=0,this.BU=null,this.BV=0,this.Dn=null,this.Do=0,this.ibufStep=0,this.b=i.F_0+1}getUid(){return this.b}getVtxUid(){return this.BV}getGpuBuf(){return this.Dn}getVTCount(){return this.Do}updateToGpu(t){if(null!=this.Dn&&this.Do>0){let e=this.BU;this.version!=e.indicesVer&&(this.B_t=e.getIvsData(),t.bindEleBuf(this.Dn),this.Do>=this.B_t.length?t.eleBufSubData(this.B_t,e.getBufDataUsage()):t.eleBufData(this.B_t,e.getBufDataUsage()),this.Do=this.B_t.length,this.version=e.indicesVer)}}initialize(t,e){if(null==this.Dn&&null!=e.getIvsData())if(this.version=e.indicesVer,this.BU=e,this.BV=e.getUid(),this.B_t=e.getIvsData(),this.Dn=t.createBuf(),t.bindEleBuf(this.Dn),null==e.bufData)t.eleBufData(this.B_t,e.getBufDataUsage()),this.Do=this.B_t.length;else{t.eleBufDataMem(e.bufData.getIndexDataTotalBytes(),e.getBufDataUsage());let s=null,i=0;this.Do=0;for(let r=0,a=e.bufData.getIndexDataTotal();r<a;++r)s=e.bufData.getIndexDataAt(r),t.eleBufSubData(s,i),i+=s.byteLength,this.Do+=s.length}}destroy(t){null!=this.Dn&&(this.BU=null,t.deleteBuf(this.Dn),this.Dn=null,this.B_t=null,this.Do=0)}}i.F_0=0,e.ROIndicesRes=i},"8d98":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("030e"));class n{static ToGL(t,e){switch(e){case n.RGBA:break;case n.R8:return t.R8;case n.RGB:return t.RGB;case n.RGB8:return t.RGB8;case n.RGBA8:return t.RGBA8;case n.ALPHA:return t.ALPHA;case n.RGB16F:return r.default.IsWebGL2()?t.RGB16F:t.RGB;case n.RGBA16F:return r.default.IsWebGL2()?t.RGBA16F:t.RGBA;case n.RGB32F:return r.default.IsWebGL2()&&t.RGB32F,t.RGB;case n.RGBA32F:return r.default.IsWebGL2()&&t.RGBA32F,t.RGBA;case n.RED:return t.RED;case n.DEPTH_COMPONENT:return t.DEPTH_COMPONENT;case n.DEPTH_STENCIL:return t.DEPTH_STENCIL;default:break}return t.RGBA}}n.R8=101,n.RGB=110,n.RED=111,n.RGBA=121,n.RGB8=122,n.RGBA8=123,n.ALPHA=132,n.RGB16F=331,n.RGBA16F=332,n.RGB32F=341,n.RGBA32F=342,n.DEPTH_COMPONENT=351,n.DEPTH_STENCIL=352,e.TextureFormat=n;class l{static ToGL(t,e){switch(e){case l.UNSIGNED_BYTE:return t.UNSIGNED_BYTE;case l.BYTE:return t.BYTE;case l.FLOAT:return t.FLOAT;case l.HALF_FLOAT:return t.HALF_FLOAT;case l.HALF_FLOAT_OES:return null!=a.default.OES_texture_half_float?a.default.OES_texture_half_float.HALF_FLOAT_OES:t.FLOAT;case l.UNSIGNED_SHORT:return t.UNSIGNED_SHORT;case l.UNSIGNED_INT:return t.UNSIGNED_INT;case l.UNSIGNED_SHORT_5_6_5:return t.UNSIGNED_SHORT_5_6_5;case l.UNSIGNED_SHORT_4_4_4_4:return t.UNSIGNED_SHORT_4_4_4_4;case l.UNSIGNED_SHORT_5_5_5_1:return t.UNSIGNED_SHORT_5_5_5_1;case l.UNSIGNED_INT_24_8_WEBGL:return a.default.WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL;default:break}return t.UNSIGNED_BYTE}}l.UNSIGNED_BYTE=1108,l.UNSIGNED_SHORT=1109,l.UNSIGNED_INT=1110,l.BYTE=1111,l.FLOAT=1211,l.HALF_FLOAT=1212,l.HALF_FLOAT_OES=1213,l.UNSIGNED_SHORT_5_6_5=1214,l.UNSIGNED_SHORT_4_4_4_4=1215,l.UNSIGNED_SHORT_5_5_5_1=1216,l.UNSIGNED_INT_24_8_WEBGL=1217,e.TextureDataType=l;class h{static GetValue(t,e){switch(e){case h.TEXTURE_2D:return t.TEXTURE_2D;case h.TEXTURE_2D_ARRAY:return t.TEXTURE_2D_ARRAY;case h.TEXTURE_CUBE:return t.TEXTURE_CUBE_MAP;case h.TEXTURE_3D:return t.TEXTURE_3D;default:break}return t.TEXTURE_2D}}h.TEXTURE_2D=20,h.TEXTURE_2D_ARRAY=22,h.TEXTURE_SHADOW_2D=23,h.TEXTURE_CUBE=25,h.TEXTURE_3D=30,e.TextureTarget=h,function(t){t[t["Default"]=0]="Default",t[t["Depth"]=1]="Depth",t[t["Wrapper"]=2]="Wrapper",t[t["RTT"]=3]="RTT",t[t["Image"]=4]="Image",t[t["Float"]=5]="Float",t[t["Uint16"]=6]="Uint16",t[t["FloatCube"]=7]="FloatCube",t[t["Bytes"]=8]="Bytes",t[t["BytesCube"]=9]="BytesCube",t[t["ImageCube"]=10]="ImageCube",t[t["Texture3D"]=11]="Texture3D"}(e.TextureProxyType||(e.TextureProxyType={}));class o{static GetConst(t,e){switch(e){case o.NEAREST:return t.NEAREST;case o.LINEAR:return t.LINEAR;case o.LINEAR_MIPMAP_LINEAR:return t.LINEAR_MIPMAP_LINEAR;case o.NEAREST_MIPMAP_NEAREST:return t.NEAREST_MIPMAP_NEAREST;case o.LINEAR_MIPMAP_NEAREST:return t.LINEAR_MIPMAP_NEAREST;case o.NEAREST_MIPMAP_LINEAR:return t.NEAREST_MIPMAP_LINEAR;case o.WRAP_REPEAT:return t.REPEAT;case o.WRAP_CLAMP_TO_EDGE:return t.CLAMP_TO_EDGE;case o.WRAP_MIRRORED_REPEAT:return t.MIRRORED_REPEAT;default:break}return-1}}o.WRAP_REPEAT=3001,o.WRAP_CLAMP_TO_EDGE=3002,o.WRAP_MIRRORED_REPEAT=3003,o.NEAREST=4001,o.LINEAR=4002,o.LINEAR_MIPMAP_LINEAR=4003,o.NEAREST_MIPMAP_NEAREST=4004,o.LINEAR_MIPMAP_NEAREST=4005,o.NEAREST_MIPMAP_LINEAR=4006,e.TextureConst=o},"8def":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("919c"));class a extends r.default{constructor(){super(),this.shdp=null,this.vbufs=null,this.vbuf=null,this.attribTypes=null,this.wholeOffsetList=null,this.attribTypesLen=0,this.updateUnlocked=!0,this.wholeStride=0,this.b=a.F_0++}run(){this.Au.testVROUid(this.b)&&(null!=this.vbuf?this.Au.useVtxAttribsPtrTypeFloat(this.shdp,this.vbuf,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride):this.Au.useVtxAttribsPtrTypeFloatMulti(this.shdp,this.vbufs,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride),this.Au.testRIOUid(this.BV)&&this.Au.bindEleBuf(this.ibuf))}__$destroy(){r.default.Gx.delete(this.Dp),this.Dp=0,this.BV=-1,this.Au=null,this.shdp=null,this.vbufs=null,this.vbuf=null,this.ibuf=null,this.attribTypes=null,this.attribTypesLen=0,this.wholeStride=0}restoreThis(){a.Restore(this)}toString(){return"VertexRenderObj(uid = "+this.b+", type="+this.Dp+")"}static HasMid(t){return r.default.Gx.has(t)}static GetByMid(t){return r.default.Gx.get(t)}static GetFreeId(){return a.Gy.length>0?a.Gy.pop():-1}static Create(t,e,s){let i=null,n=a.GetFreeId();return n>=0?(i=a.Gz[n],a.G0[n]=a.S_FLAG_BUSY,i.setMidAndBufUid(e,s)):(i=new a,i.setMidAndBufUid(e,s),a.Gz.push(i),a.G0.push(a.S_FLAG_BUSY),a.G1++),i.setRC(t),r.default.Gx.set(e,i),i}static Restore(t){if(null!=t&&t.k<1&&a.G0[t.getUid()]==a.S_FLAG_BUSY){let e=t.getUid();a.Gy.push(e),a.G0[e]=a.S_FLAG_FREE,t.__$destroy()}}}a.F_0=0,a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.G0=[],a.G1=0,a.Gz=[],a.Gy=[],e.default=a},"8e17":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{constructor(t=0,e=0,s=0,i=1){this.x=0,this.y=0,this.z=0,this.w=0,this.x=t,this.y=e,this.z=s,this.w=i}clone(){return new a(this.x,this.y,this.z,this.w)}setTo(t,e,s,i=1){this.x=t,this.y=e,this.z=s,this.w=i}setXYZ(t,e,s){this.x=t,this.y=e,this.z=s}copyFrom(t){this.x=t.x,this.y=t.y,this.z=t.z}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}multBy(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);t>r.default.MATH_MIN_POSITIVE&&(this.x/=t,this.y/=t,this.z/=t)}normalizeTo(t){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);e>r.default.MATH_MIN_POSITIVE?(t.x=this.x/e,t.y=this.y/e,t.z=this.z/e):(t.x=this.x,t.y=this.y,t.z=this.z)}scaleVector(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}scaleBy(t){this.x*=t,this.y*=t,this.z*=t}negate(){this.x=-this.x,this.y=-this.y,this.z=-this.z}equalsXYZ(t){return Math.abs(this.x-t.x)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.y-t.y)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.z-t.z)<r.default.MATH_MIN_POSITIVE}equalsAll(t){return Math.abs(this.x-t.x)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.y-t.y)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.z-t.z)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.w-t.w)<r.default.MATH_MIN_POSITIVE}project(){let t=1/this.w;this.x*=t,this.y*=t,this.z*=t}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getLengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}addBy(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}subtractBy(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}subtract(t){return new a(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new a(this.x+t.x,this.y+t.y,this.z+t.z)}crossProduct(t){return new a(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}crossBy(t){let e=this.y*t.z-this.z*t.y,s=this.z*t.x-this.x*t.z,i=this.x*t.y-this.y*t.x;this.x=e,this.y=s,this.z=i}reflectBy(t){let e=2*(this.x*t.x+this.y*t.y+this.z*t.z);this.x=this.x-e*t.x,this.y=this.y-e*t.y,this.z=this.z-e*t.z}scaleVecTo(t,e){this.x=t.x*e,this.y=t.y*e,this.z=t.z*e}subVecsTo(t,e){this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z}addVecsTo(t,e){this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z}crossVecsTo(t,e){this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x}toString(){return"Vector3D("+this.x+this.y+this.z+")"}static Cross(t,e,s){s.x=t.y*e.z-t.z*e.y,s.y=t.z*e.x-t.x*e.z,s.z=t.x*e.y-t.y*e.x}static CrossSubtract(t,e,s,i,r){a.__vtor3Stv0.x=e.x-t.x,a.__vtor3Stv0.y=e.y-t.y,a.__vtor3Stv0.z=e.z-t.z,a.__vtor3Stv1.x=i.x-s.x,a.__vtor3Stv1.y=i.y-s.y,a.__vtor3Stv1.z=i.z-s.z,t=a.__vtor3Stv0,s=a.__vtor3Stv1,r.x=t.y*s.z-t.z*s.y,r.y=t.z*s.x-t.x*s.z,r.z=t.x*s.y-t.y*s.x}static Subtract(t,e,s){s.x=t.x-e.x,s.y=t.y-e.y,s.z=t.z-e.z}static DistanceSquared(t,e){return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,a.__vtor3Stv0.getLengthSquared()}static DistanceXYZ(t,e,s,i,r,n){return a.__vtor3Stv0.x=t-i,a.__vtor3Stv0.y=e-r,a.__vtor3Stv0.z=s-n,a.__vtor3Stv0.getLength()}static Distance(t,e){return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,a.__vtor3Stv0.getLength()}static AngleBetween(t,e){return t.normalizeTo(a.__vtor3Stv0),e.normalizeTo(a.__vtor3Stv1),Math.acos(a.__vtor3Stv0.dot(a.__vtor3Stv1))*r.default.MATH_180_OVER_PI}static RadianBetween(t,e){return t.normalizeTo(a.__vtor3Stv0),e.normalizeTo(a.__vtor3Stv1),Math.acos(a.__vtor3Stv0.dot(a.__vtor3Stv1))}static RadianBetween2(t,e){let s=t.getLengthSquared(),i=e.getLengthSquared();return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,Math.acos((s+i-a.__vtor3Stv0.getLengthSquared())/(2*Math.sqrt(s)*Math.sqrt(i)))}static Reflect(t,e,s){let i=2*(t.x*e.x+t.y*e.y+t.z*e.z);s.x=t.x-i*e.x,s.y=t.y-i*e.y,s.z=t.z-i*e.z}}a.X_AXIS=new a(1,0,0),a.Y_AXIS=new a(0,1,0),a.Z_AXIS=new a(0,0,1),a.__vtor3Stv0=new a,a.__vtor3Stv1=new a,a.ZERO=new a,e.default=a},9156:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetTransUniform(t,e){i.G2.set(t.getUid(),e)}static GetTransUniform(t){if(t.getUid()<0)throw Error("mat.getUid() < 0");return i.G2.has(t.getUid())?i.G2.get(t.getUid()):null}static HasTransUniform(t){return i.G2.has(t.getUid())}static RemoveTransUniform(t){i.G2.delete(t.getUid())}}i.G2=new Map,e.default=i},"919c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.b=0,this.Dp=0,this.BV=0,this.Au=null,this.indicesRes=null,this.ibuf=null,this.ibufStep=2,this.k=0}getVTCount(){return null!=this.indicesRes?this.indicesRes.getVTCount():0}setRC(t){this.Au=t}setMidAndBufUid(t,e){this.Dp=t,this.BV=e,this.k=0}getUid(){return this.b}getVtxUid(){return this.BV}getMid(){return this.Dp}run(){}__$attachThis(){++this.k}__$detachThis(){--this.k,this.k<1&&(this.k=0)}__$destroy(){i.Gx.delete(this.Dp),this.Dp=0,this.BV=-1,this.ibuf=null,this.Au=null,this.indicesRes=null}restoreThis(){}static HasMid(t){return i.Gx.has(t)}static GetByMid(t){return i.Gx.get(t)}static Reset(){i.G3=-1}}i.G3=0,i.Gx=new Map,e.default=i},9260:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("7045"));class a{static KeyDown(t){for(var e=a.Dq.length,s=0;s<e;++s)a.Dq[s].call(a.Ds[s],t)}static KeyUp(t){let e=a.Dr.length;for(let s=0;s<e;++s)a.Dr[s].call(a.Dt[s],t)}static RemoveEventListener(t,e){if(null!=e){let s;switch(t){case r.default.KEY_DOWN:for(s=a.Dq.length-1;s>=0;--s)if(e===a.Dq[s]){a.Ds.splice(s,1),a.Dq.splice(s,1);break}break;case r.default.KEY_UP:for(s=a.Dr.length-1;s>=0;--s)if(e===a.Dr[s]){a.Dt.splice(s,1),a.Dr.splice(s,1);break}break;default:break}}}}a.Ds=[],a.Dq=[],a.Dt=[],a.Dr=[],a.AddEventListener=function(t,e,s){if(null!=s){let i=0;switch(t){case r.default.KEY_DOWN:for(i=a.Dq.length-1;i>=0;--i)if(s===a.Dq[i])break;i<0&&(a.Ds.push(e),a.Dq.push(s));break;case r.default.KEY_UP:for(i=a.Dr.length-1;i>=0;--i)if(s===a.Dr[i])break;i<0&&(a.Dt.push(e),a.Dr.push(s));break;default:break}}},e.default=a},"955e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("fecb")),l=i(s("c120")),h=s("e08e"),o=i(s("29ef")),m=i(s("3930")),_=i(s("e7ce"));class u{constructor(){this.Du=new m.default,this.Dv=new _.default,this.A_q=null,this.A_O=null,this.Dw=null,this.Dx=null,this.Dy=new Uint8Array(256),this.Dz=null,this.D0=null,this.D1=0,this.D2=0,this.D3=new a.default,this.D4=new a.default,this.B_3=null,this.B_4=null,this.D5=new Uint8Array(4),this.D6=new a.default,this.D7=new a.default,this.D8=[null,null],this.D9=!0,this.D_A=new Uint8Array(4),this.D_B=new Uint8Array(256)}setRenderer(t){this.A_q=t}setRayTestMode(t){this.D2=t}setRay(t,e){this.B_3=t,this.B_4=e}getRay(t,e){t.copyFrom(this.B_3),e.copyFrom(this.B_4)}setCamera(t){this.A_O=t}setCullingNodeHead(t){if(this.Dw=t,null==this.Dz){this.Dz=[];let t=0;for(;t<256;++t)this.Dz.push(new l.default)}}getSelectedNode(){return this.D0}getSelectedNodes(){return this.Dz}getSelectedNodesTotal(){return this.D1}sorting(t,e){let s=this.Dz;this.Dx=s[t];while(t<e){while(t<e&&s[e].dis>=this.Dx.dis)--e;s[t]=s[e];while(t<e&&s[t].dis<=this.Dx.dis)++t;s[e]=s[t]}return s[t]=this.Dx,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}run(){let t=this.Dw;if(null!=t){let e=0,s=this.B_4,i=this.B_3,a=this.D7,l=null,h=0;Math.abs(s.x)>r.default.MATH_MIN_POSITIVE?this.D6.x=1/s.x:this.D6.x=r.default.MATH_MAX_POSITIVE,Math.abs(s.y)>r.default.MATH_MIN_POSITIVE?this.D6.y=1/s.y:this.D6.y=r.default.MATH_MAX_POSITIVE,Math.abs(s.z)>r.default.MATH_MIN_POSITIVE?this.D6.z=1/s.z:this.D6.z=r.default.MATH_MAX_POSITIVE,this.D6.x<0?this.D5[0]=1:this.D5[0]=0,this.D6.y<0?this.D5[1]=1:this.D5[1]=0,this.D6.z<0?this.D5[2]=1:this.D5[2]=0;while(null!=t)t.drawEnabled&&t.entity.mouseEnabled&&(a.x=t.bounds.center.x-i.x,a.y=t.bounds.center.y-i.y,a.z=t.bounds.center.z-i.z,e=a.dot(s),a.x-=e*s.x,a.y-=e*s.y,a.z-=e*s.z,a.getLengthSquared()<=t.bounds.radius2&&t.rayTestState<1&&(this.D8[0]=t.bounds.min,this.D8[1]=t.bounds.max,n.default.IntersectionRL3(this.D8,this.D5,this.D6,s,i,a)&&(l=this.Dz[h],l.entity=t.entity,l.dis=this.D6.w,l.wpv.copyFrom(a),++h))),t=t.next;this.D0=null;let o=0;if(h>0){let t=this.D3,e=this.D4,r=null,n=0,l=0,m=null,_=null,u=s.dot(i),d=0,c=!this.D9,f=0;if(h>1){for(this.snsort(0,h-1),o=0;o<h;++o){if(_=this.Dz[o],r=this.Dz[o].entity,r.isPolyhedral()?c?(m=r.getInvMatrix(),m.transformOutVector3(i,t),m.deltaTransformOutVector(s,e),e.normalize(),n=r.testRay(t,e,a,!0)):(++f,n=0):(m=r.getInvMatrix(),m.transformOutVector3(i,t),m.deltaTransformOutVector(s,e),e.normalize(),n=r.testRay(t,e,a,!0)),n>0){if(_.lpv.copyFrom(a),r.getMatrix().transformOutVector3(a,_.wpv),_.dis=s.dot(_.wpv)-u,this.Dy[l]=o,++l,_.dis>d){this.D0=_;break}}else if(n<0&&(this.Dy[l]=o,++l,_.dis>d)){this.D0=_;break}d=_.dis}null==this.D0&&l>0&&(this.D0=this.Dz[this.Dy[0]])}else _=this.Dz[0],r=this.Dz[0].entity,m=r.getInvMatrix(),m.transformOutVector3(i,t),m.deltaTransformOutVector(s,e),e.normalize(),r.isPolyhedral()?c?n=r.testRay(t,e,a,!0):(++f,n=0):n=r.testRay(t,e,a,!0),n>0?(_.lpv.copyFrom(a),r.getMatrix().transformOutVector3(a,_.wpv),_.dis=s.dot(_.wpv)-u,this.D0=_):n<0&&(this.D0=_);f>0&&(this.D2<1||null==this.D0||this.D0.entity.isPolyhedral())&&this.gpuPick(h)}for(o=h;o<this.D1;++o)this.D0!=this.Dz[o]&&(this.Dz[o].entity=null);this.D1=h}}gpuPick(t){let e=this.A_q.getRendererContext(),s=this.A_q.getRenderProxy(),i=s.getStage3D().mouseX,r=s.getStage3D().mouseY;e.vertexRenderBegin(),e.getClearRGBAColor4f(this.Du),e.setClearRGBAColor4f(0,0,0,0),e.setScissorEnabled(!0),e.setScissorRect(i,r,1,1),e.clearBackBuffer(),this.D_A[3]=0,o.default.LockBlendMode(h.RenderBlendMode.OPAQUE),o.default.LockDepthTestMode(h.DepthTestMode.OPAQUE),e.unlockMaterial(),e.unlockRenderState(),e.useGlobalMaterial(this.Dv,!1,!1);let a=null,n=null,l=-1,m=0;for(;m<t;++m)a=this.Dz[m],n=this.Dz[m].entity,n.isPolyhedral()&&(++l,this.Dv.setIndex(l+2),this.D_B[l]=m,this.A_q.updateMaterialUniformToCurrentShd(this.Dv),this.A_q.drawEntity(n,!1,!0));if(l>-1&&s.readPixels(i,r,1,1,s.RGBA,s.UNSIGNED_BYTE,this.D_A),o.default.UnlockBlendMode(),o.default.UnlockDepthTestMode(),this.D_A[3]>1){m=this.D_B[this.D_A[3]-2],a=this.Dz[m];let t=(this.D_A[0]<<8)+this.D_A[1]+this.D_A[2]/255;if(null!=this.D0){let e=this.D0.entity;this.D0==a||e.isPolyhedral()||this.D0.dis<t&&(m=-1)}m>-1&&(a.dis=t,this.getWorldPosByRayDistance(t,this.B_4,this.A_O.getPosition(),a.wpv),this.D0=a)}e.setScissorEnabled(!1),e.unlockMaterial(),e.unlockRenderState(),o.default.UnlockBlendMode(),o.default.UnlockDepthTestMode(),e.setClearRGBAColor4f(this.Du.r,this.Du.g,this.Du.b,this.Du.a),e.resetState()}clear(){this.D0=null}getWorldPosByRayDistance(t,e,s,i){i.x=e.x*t+s.x,i.y=e.y*t+s.y,i.z=e.z*t+s.z}}e.default=u},9666:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("acfe"));class n{static CreateShdData(t,e,s,i,l){if(n.G4.has(t))return n.G4.get(t);let h=new a.default;return h.adaptationShaderVersion=i,h.preCompileInfo=l,h.initialize(t,e,s),n.G5[h.getUid()]=h,++n.s_shdDataListLen,n.G4.set(t,h),r.default.SHADERCODE_TRACE_ENABLED,h}static FindData(t){return n.G4.has(t)?n.G4.get(t):null}}n.G4=new Map,n.G5=[],n.s_shdDataListLen=0,e.default=n},"984e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.width=0,this.height=0,this.depth=0,this.sampler=0,this.texBuf=null,this.k=0}__$attachThis(){++this.k}__$detachThis(){--this.k,this.k<1&&(this.k=0)}bindToGpu(t){t.bindTexture(this.sampler,this.texBuf)}getAttachCount(){return this.k}}class r{constructor(t,e){this.C_W=new Map,this.C_X=new Map,this.D_C=0,this.C_a=0,this.C_b=128,this.I=0,this.F_=null,this.texMid=-1,this.unlocked=!0,this.I=t,this.F_=e}createBuf(){return this.F_.createTexture()}createResByParams3(t,e,s,r){if(!this.C_W.has(t)){let a=new i;return a.rcuid=this.getRCUid(),a.resUid=t,a.width=e,a.height=s,a.sampler=r,a.texBuf=this.createBuf(),a.texBuf.resUid=t,this.addTextureRes(a),!0}return!1}getRCUid(){return this.I}getRC(){return this.F_}hasResUid(t){return this.C_W.has(t)}renderBegin(){this.texMid=-1}getTextureResTotal(){return this.D_C}addTextureRes(t){this.C_W.has(t.resUid)||(t.waitDelTimes=0,this.C_W.set(t.resUid,t),this.D_C++)}getGpuBuffer(t){return this.C_W.has(t)?this.C_W.get(t).texBuf:null}bindToGpu(t){this.C_W.has(t)&&this.C_W.get(t).bindToGpu(this.F_)}getAttachTotal(){return this.C_a}__$attachRes(t){if(this.C_W.has(t)){this.C_a++;let e=this.C_W.get(t);e.getAttachCount()<1&&this.C_X.has(t)&&this.C_X.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.C_W.has(t)&&this.C_W.has(t)){let e=this.C_W.get(t);e.getAttachCount()>0&&(this.C_a--,e.__$detachThis(),e.getAttachCount()<1&&this.C_X.set(t,e))}}update(){if(this.C_b--,this.C_b<1){this.C_b=128;for(const[t,e]of this.C_X)e.waitDelTimes++,e.waitDelTimes>5&&(this.C_W.delete(e.resUid),this.C_X.delete(e.resUid),this.F_.deleteTexture(e.texBuf),e.texBuf=null,this.D_C--)}}}e.default=r},"9bb7":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("faa5")),a=i(s("0fc4"));class n extends r.default{constructor(){super(),this.j_=""}initialize(t){super.initialize(t),this.j_="DepthShd",this.adaptationShaderVersion=!1}buildThisCode(){let t=this.A_j;t.reset(),t.addVertLayout("vec3","a_vs"),t.addVarying("vec4","v_pos"),t.addFragOutput("vec4","FragColor0"),t.useVertSpaceMats(!0,!0,!0),t.addFragFunction("\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\n\treturn r * PackUpscale;\n}\n")}getFragShaderCode(){return this.buildThisCode(),this.A_j.addFragMainCode("\nvoid main() {\n    // Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\n    float fragCoordZ = 0.5 * v_pos[2] / v_pos[3] + 0.5;\n    FragColor0 = packDepthToRGBA( fragCoordZ );\n}\n"),this.A_j.buildFragCode()}getVertShaderCode(){return this.A_j.addVertMainCode("\nvoid main() {\n    vec4 wpos = u_objMat * vec4(a_vs, 1.0);\n    vec4 viewPos = u_viewMat * wpos;\n    gl_Position =  u_projMat * viewPos;\n    v_pos = gl_Position;\n}\n"),this.A_j.buildVertCode()}getUniqueShaderName(){return this.j_}toString(){return"[DepthShaderBuffer()]"}static GetInstance(){return n.F_2}}n.F_2=new n;class l extends a.default{constructor(){super()}getCodeBuf(){return n.GetInstance()}createSelfUniformData(){return null}}e.default=l},"9c4d":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.prev=null,this.next=null,this.flag=0,this.target=null}reset(){this.flag=0,this.target=null}}class r{constructor(){this.A_E=null,this.A_F=null}destroy(){this.clear()}clear(){this.A_E=this.A_F=null}getBegin(){return this.A_E}isEmpty(){return this.A_E==this.A_F&&null==this.A_F}addNode(t){null==this.A_E?this.A_F=this.A_E=t:null!=this.A_F.prev?(this.A_F.next=t,t.prev=this.A_F,this.A_F=t):(this.A_E.next=t,t.prev=this.A_F,this.A_F=t),this.A_F.next=null}removeNode(t){t==this.A_E?t==this.A_F?this.A_E=this.A_F=null:(this.A_E=t.next,this.A_E.prev=null):t==this.A_F?(this.A_F=t.prev,this.A_F.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}class a{constructor(){this.D_D=new r,this.D_E=[],this.D_F=[new i]}getFreeId(){if(this.D_E.length>0)return this.D_E.pop();let t=new i;return t.flag=this.D_F.length,this.D_F.push(t),t.flag}addRunner(t){if(null!=t&&t.getRunFlag()<1){let e=this.getFreeId(),s=this.D_F[e];s.flag=e,s.target=t,t.setRunFlag(e),this.D_D.addNode(s)}}removeRunner(t){if(null!=t&&t.getRunFlag()>0){let e=t.getRunFlag();this.D_E.push(e);let s=this.D_F[e];s.flag=e,s.target=null,t.setRunFlag(0),this.D_D.removeNode(s)}}run(){let t=this.D_D.getBegin(),e=t;while(null!=e)t=e,e=t.next,t.target.isRunning()&&t.target.run()}}e.default=a},"9f3e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("df25"));class n extends a.default{constructor(t,e,s=!1){super(t,e,s),this.v=r.TextureProxyType.Uint16,this.minFilter=r.TextureConst.LINEAR,this.dataType=r.TextureDataType.UNSIGNED_SHORT}toHalfFloatOes(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4,this.dataType=r.TextureDataType.HALF_FLOAT_OES}toUShort565(){this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB,this.unpackAlignment=3,this.dataType=r.TextureDataType.UNSIGNED_SHORT_5_6_5}toUShort4444(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4,this.dataType=r.TextureDataType.UNSIGNED_SHORT_4_4_4_4}toUShort5551(){this.unpackAlignment=4,this.dataType=r.TextureDataType.UNSIGNED_SHORT_5_5_5_1}toUShort(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.dataType=r.TextureDataType.UNSIGNED_SHORT}toAlphaFormat(){this.dataType==r.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=r.TextureFormat.ALPHA,this.internalFormat=r.TextureFormat.ALPHA,this.unpackAlignment=1)}toRedFormat(){this.dataType==r.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=r.TextureFormat.RED,this.internalFormat=r.TextureFormat.RED,this.unpackAlignment=1)}toRGBFormat(){this.dataType==r.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB,this.unpackAlignment=3)}toRGBAFormat(){this.dataType==r.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4)}uploadFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,n=!1){super.setDataFromBytes(t,e,s,i,r,a,n)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[Uint16TextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},a221:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},a254:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("faa5")),a=i(s("b3bd")),n=i(s("0fc4"));class l extends r.default{constructor(){super(),this.j_="",this.Bf=!1,this.mapLodEnabled=!1}initialize(t){this.j_="ScreenPlaneShd",this.Bf=t,t&&(this.j_+="_tex",this.mapLodEnabled&&(this.j_+="Lod"))}buildShader(){let t=this.A_j;t.mapLodEnabled=!1,this.Bf&&(t.mapLodEnabled=this.mapLodEnabled,this.A_k.addDiffuseMap()),t.addFragUniform("vec4","u_param",3),t.useVertSpaceMats(!0,!1,!1),this.A_j.addFragMainCode("\nvoid main() {\n#ifdef VOX_USE_2D_MAP\n    #ifdef VOX_Texture2DLod\n    vec4 color4 = VOX_Texture2DLod(VOX_DIFFUSE_MAP, v_uv, u_param[2].w);\n    #else\n    vec4 color4 = VOX_Texture2D(VOX_DIFFUSE_MAP, v_uv);\n    #endif\n    color4 *= u_param[0];\n    color4 += u_param[1];\n    FragColor0 = color4;\n#else\n    FragColor0 = u_param[0] + u_param[1];\n#endif\n}\n"),this.A_j.addVertMainCode("\nvoid main() {\n    gl_Position = u_objMat * vec4(a_vs,1.0);\n#ifdef VOX_USE_2D_MAP\n    v_uv = a_uvs.xy;\n#endif\n}\n")}getUniqueShaderName(){return this.j_}toString(){return"[ScreenPlaneShaderBuffer()]"}static GetInstance(){return null!=l.F_2||(l.F_2=new l),l.F_2}}l.F_2=null;class h extends n.default{constructor(){super(),this.mapLodEnabled=!1,this.D_G=new Float32Array([1,1,1,1,0,0,0,0,0,0,0,0])}buildBuf(){let t=l.GetInstance();t.mapLodEnabled=this.mapLodEnabled}getCodeBuf(){return l.GetInstance()}setRGB3f(t,e,s){this.D_G[0]=t,this.D_G[1]=e,this.D_G[2]=s}setRGBA4f(t,e,s,i){this.D_G[0]=t,this.D_G[1]=e,this.D_G[2]=s,this.D_G[3]=i}setOffsetRGB3f(t,e,s){this.D_G[0]=t,this.D_G[1]=e,this.D_G[2]=s}setOffsetRGBA4f(t,e,s,i){this.D_G[0]=t,this.D_G[1]=e,this.D_G[2]=s,this.D_G[3]=i}setTextureLodLevel(t){this.D_G[11]=t}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_param"],t.dataList=[this.D_G],t}}e.default=h},a446:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=s("cc48"),n=i(s("265e")),l=i(s("af68")),h=i(s("a80a"));class o{constructor(){this.b=-1,this.A_q=null,this.A_O=null,this.D_H=null,this.D_I=new n.default,this.BC=null,this.D_J=new l.default,this.D_K=new h.default,this.D_L=new h.default,this.D_M=null,this.C_g=null,this.D_N=0,this.b=o.F_0++,this.D_J.initialize(1)}getUid(){return this.b}initialize(t,e=null){null==this.A_q&&(this.A_q=t,this.D_H=t.getStage3D(),this.A_O=e,this.BC=t.getRPONodeBuilder())}getStage3D(){return this.D_H}setCamera(t){this.A_O=t}getCamera(){return this.A_O}getMouseXYWorldRay(t,e){this.A_O.getWorldPickingRayByScreenXY(this.D_H.mouseX,this.D_H.mouseY,t,e)}setSpaceCullingor(t){this.D_M=t}setRaySelector(t){this.C_g=t,this.C_g.setRenderer(this.A_q)}getRaySelector(){return this.C_g}addEntity(t){if(null!=t.getGlobalBounds()&&t.spaceCullMask>a.SpaceCullingMask.NONE&&r.default.TestSpaceEnabled(t.__$rseFlag)){t.update(),++this.D_N;let e=this.D_J.addEntity(t);e.bounds=t.getGlobalBounds(),e.pcoEnabled=(t.spaceCullMask&a.SpaceCullingMask.POV)==a.SpaceCullingMask.POV;let s=t.isInRendererProcess()||null==t.getMaterial();s&&(t.spaceCullMask&a.SpaceCullingMask.POV)==a.SpaceCullingMask.POV?(e.rstatus=1,null==t.getMaterial()&&(e.rpoNode=this.D_I),null==e.rpoNode&&(e.rpoNode=this.BC.getNodeByUid(t.getDisplay().__$rpuid)),this.D_L.addNode(e)):null==t.getMaterial()?(e.rstatus=1,e.rpoNode=this.D_I,this.D_L.addNode(e)):(e.rstatus=0,this.D_K.addNode(e))}}removeEntity(t){if(null!=t&&r.default.TestSpaceContains(t.__$rseFlag)){let e=this.D_J.getNodeByEntity(t);null!=e&&(e.rstatus>0?this.D_L.removeNode(e):this.D_K.removeNode(e),this.D_J.removeEntity(t),--this.D_N)}}updateEntity(t){}update(){}runBegin(){}run(){let t=this.D_K.getBegin();if(null!=t){let e=null;while(null!=t)t.entity.isInRendererProcess()?(e=t,e.rstatus=1,t=t.next,this.D_K.removeNode(e),this.D_L.addNode(e),null==e.rpoNode&&(e.rpoNode=this.BC.getNodeByUid(e.entity.getDisplay().__$rpuid))):t=t.next}if(t=this.D_L.getBegin(),null!=t)if(null!=this.D_M)this.D_M.setCamera(this.A_O),this.D_M.setCullingNodeHead(t),this.D_M.run();else{let e=null,s=this.A_O;while(null!=t)t.rpoNode.isVsible()&&t.entity.isDrawEnabled()?(e=t.bounds,t.drawEnabled=s.visiTestSphere2(e.center,e.radius),t.entity.drawEnabled=t.drawEnabled,t.rpoNode.drawEnabled=t.drawEnabled):(t.drawEnabled=!1,t.entity.drawEnabled=!1,t.rpoNode.drawEnabled=!1),t=t.next}}rayTest(t,e){null!=this.C_g&&(this.C_g.setCamera(this.A_O),this.C_g.setCullingNodeHead(this.D_L.getBegin()),this.C_g.setRay(t,e),this.C_g.run())}runEnd(){}getCullingNodeHead(){return this.D_L.getBegin()}toString(){return"[RendererSpace(uid = "+this.b+")]"}}o.F_0=0,e.default=o},a46e:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("1710")),n=i(s("3b73"));class l{constructor(){this.A_O=null,this.D_O=!1,this.D_P=0,this.D_Q=2,this.D_R=1,this.D_S=6,this.D_T=new r.default,this.D_U=new r.default,this.D_V=new r.default,this.D_W=new r.default,this.D_X=new r.default,this.D_Y=new r.default,this.D_Z=new r.default,this.D_a=0,this.D_b=!0,this.D_c=!0,this.D_d=0,this.D_e=0,this.D_f=!0,this.syncLookAt=!1,this.D_g=2,this.D_f=!(n.default.IsMobileWeb()||n.default.IsSafariWeb())}setMobileZoomSpeed(t){this.D_Q=t}seSlideSpeed(t){this.D_R=t}setMouseWheelZoomSpd(t){this.D_S=t}bindCamera(t){this.A_O=t}initialize(t){this.D_b&&(this.D_b=!1,t.addEventListener(a.default.MOUSE_WHEEL,this,this.mouseWheelListener,!0,!0),t.addEventListener(a.default.MOUSE_MULTI_MOVE,this,this.mouseMultiMoveListener,!0,!0),t.addEventListener(a.default.MOUSE_MULTI_UP,this,this.mouseMultiUpListener,!0,!0))}setLookAtCtrlEnabled(t){this.D_c=t}mouseWheelListener(t){t.wheelDeltaY>0?this.D_a+=this.D_S:this.D_a-=this.D_S}mouseMultiMoveListener(t){this.setTouchPosArray(t.posArray)}mouseMultiUpListener(t){this.setTouchPosArray(t.posArray)}resetState(){this.D_d=0,this.D_e=0,this.D_g=0}setTouchPosArray(t){if(null!=t&&t.length>1){let e=0;if(this.D_X.setXYZ(t[0].x,t[0].y,0),this.D_Y.setXYZ(t[1].x,t[1].y,0),this.D_O){e=r.default.Distance(this.D_X,this.D_Y),this.D_g<1?(this.D_T.copyFrom(this.D_X),this.D_U.copyFrom(this.D_Y),this.D_T.subVecsTo(this.D_X,this.D_V),this.D_U.subVecsTo(this.D_Y,this.D_W),this.D_T.normalize(),this.D_U.normalize(),this.D_T.dot(this.D_U)>.9?this.D_d++:this.D_e++,(this.D_d>3||this.D_e>3)&&(this.D_g=this.D_d>this.D_e?1:2)):this.D_T.subVecsTo(this.D_X,this.D_V);let t=Math.abs(this.D_P-e);t>.1&&(this.D_a=(e-this.D_P)*this.D_Q,this.D_P=e)}else this.D_O=!0,this.D_P=r.default.Distance(this.D_X,this.D_Y),this.resetState()}else this.resetState(),this.D_O=!1;this.D_V.copyFrom(this.D_X),this.D_W.copyFrom(this.D_Y)}run(t,e){let s=this.D_c;if(null==t&&(t=this.D_Z),null!=this.A_O)if(this.syncLookAt&&this.A_O.setLookAtPosition(t),2==this.D_g){if(Math.abs(this.D_a)>.001){let i=r.default.Distance(this.A_O.getPosition(),this.A_O.getLookAtPosition()),a=this.D_a;this.D_a>0&&(i>e?(a=i-e,a>this.D_a&&(a=this.D_a)):a=0),Math.abs(a)>.1&&(this.A_O.forward(a),s&&this.A_O.setLookPosXYZFixUp(t.x,t.y,t.z)),this.D_f?this.D_a*=.95:this.D_a=0}}else 1==this.D_g&&this.A_O.slideViewOffsetXY(-this.D_T.x*this.D_R,this.D_T.y*this.D_R)}}e.default=l},a63a:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("402a")),a=i(s("f63e")),n=i(s("c4ab")),l=i(s("29ef"));class h extends r.default{constructor(t=null){super(t),this.moduleScale=1,this.dataIsZxy=!1,this.vtxColor=null,this.normalEnabled=!1,this.wireframe=!1,this.baseParsering=!1,this.D_h=""}createMaterial(t){if(null==this.getMaterial()){let e=new a.default;e.normalEnabled=this.normalEnabled,e.vertColorEnabled=null!=this.vtxColor,e.setTextureList(t),this.setMaterial(e)}else null!=t&&this.getMaterial().getTextureTotal()<1&&this.getMaterial().setTextureList(t)}initialize(t,e=null){this.D_h=t,this.activeDisplay()}showBackFace(){this.setRenderState(l.default.BACK_CULLFACE_NORMAL_STATE)}showFrontFace(){this.setRenderState(l.default.FRONT_CULLFACE_NORMAL_STATE)}showDoubleFace(){this.setRenderState(l.default.NONE_CULLFACE_NORMAL_STATE)}initializeByObjDataUrl(t,e=null){if(this.createMaterial(e),null==this.getMesh()){let s=new XMLHttpRequest;s.open("GET",t,!0),s.onload=()=>{s.status<=206&&s.responseText.indexOf(" OBJ ")>0&&this.initialize(s.responseText,e)},s.onerror=t=>{},s.send()}}__activeMesh(t){if(null==this.getMesh()){let t=new n.default;t.baseParsering=this.baseParsering,t.moduleScale=this.moduleScale,t.vbWholeDataEnabled=this.vbWholeDataEnabled,t.wireframe=this.wireframe,t.setBufSortFormat(this.getMaterial().getBufSortFormat()),t.initialize(this.D_h,this.dataIsZxy),this.setMesh(t)}}isPolyhedral(){return!0}}e.default=h},a7ed:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279"));class n{create(t,e){let s=null,i=r.default.FrustumParam;return e.hasUniformByName(i.name)&&(s=new a.default,s.uns=i.name,s.uniformNameList=[i.name],s.copyDataFromProbe(t.getCamera().ufrustumProbe)),s}getIDNS(){return"FrustumUniformBuilder"}}e.default=n},a80a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.A_E=null,this.A_F=null}destroy(){this.clear()}clear(){this.A_E=this.A_F=null}getBegin(){return this.A_E}isEmpty(){return this.A_E==this.A_F&&null==this.A_F}addNode(t){null==this.A_E?this.A_F=this.A_E=t:null!=this.A_F.prev?(this.A_F.next=t,t.prev=this.A_F,this.A_F=t):(this.A_E.next=t,t.prev=this.A_F,this.A_F=t),this.A_F.next=null}removeNode(t){t==this.A_E?t==this.A_F?this.A_E=this.A_F=null:(this.A_E=t.next,this.A_E.prev=null):t==this.A_F?(this.A_F=t.prev,this.A_F.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}e.default=i},a996:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uuid="",this.phase=0,this.type=i.RESIZE,this.target=null,this.currentTarget=null,this.data=null,this.__$preventBoo=!1}getClassType(){return i.EventClassType}preventDefault(){this.__$preventBoo=!0}reset(){this.__$preventBoo=!1}toString(){return"[EventBase]"}}i.EventClassType=1001,i.RESIZE=3001,i.ENTER_FRAME=3002,e.default=i},a9bf:function(t,e,s){"use strict";s.r(e),s.d(e,"EnvShaderCode",(function(){return l}));var i="#ifdef VOX_USE_FOG\r\n    #ifdef VOX_FOG_COLOR_MAP\r\n        vec3 fogEnvColor = vec3(1.0);\r\n        vec4 getFogColorFromTexture2D(sampler2D tex) {\r\n            vec4 color = VOX_Texture2D(tex, (u_envLightParams[3].xy + worldPosition.xz) / u_envLightParams[3].zw);\r\n            fogEnvColor = color.xyz;\r\n            return color;\r\n        }\r\n    #endif\r\n    void useFog(inout vec4 color) {\r\n        vec3 fogColor = u_envLightParams[2].xyz;\r\n        #ifdef VOX_FOG_COLOR_MAP\r\n            fogColor *= fogEnvColor;\r\n        #endif\r\n        #ifdef VOX_FOG_EXP2\r\n            float fogDensity = u_envLightParams[2].w;\r\n            float fogFactor = 1.0 - exp( - fogDensity * fogDensity * v_fogDepth * v_fogDepth );\r\n        #else\r\n            float fogNear = u_envLightParams[1].z;\r\n            float fogFar = u_envLightParams[1].w;\r\n            float fogFactor = smoothstep( fogNear, fogFar, v_fogDepth );\r\n        #endif\r\n        #ifdef VOX_USE_BRIGHTNESS_OVERLAY_COLOR\r\n            color.xyz = mix( color.rgb, fogColor, fogFactor ) * length(color.rgb) * (1.0 - fogFactor);\r\n        #else\r\n            color.xyz = mix( color.rgb, fogColor, fogFactor );\r\n            #ifdef VOX_PREMULTIPLY_ALPHA\r\n                color.xyz *= color.w;\r\n            #endif\r\n        #endif\r\n    }\r\n#endif",r="void calcFogDepth(in vec4 viewPos) {\r\n    v_fogDepth = -viewPosition.z;\r\n}",a="#ifdef VOX_FOG_COLOR_MAP\r\n    getFogColorFromTexture2D( VOX_FOG_COLOR_MAP );\r\n#endif\r\n\r\n#ifdef VOX_USE_FOG\r\n    useFog( FragColor0 );\r\n#endif ",n="#ifdef VOX_USE_FOG\r\n\r\ncalcFogDepth(viewPosition);\r\n\r\n#endif";const l={vert:"",vert_head:r,vert_body:n,frag:"",frag_head:i,frag_body:a}},a9f4:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["Default"]=1]="Default",t[t["VSM"]=1]="VSM"}(i||(i={})),e.ShadowMode=i},ab2e:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("4df3");e.IShaderLibConfigure=i.IShaderLibConfigure,e.ShaderCodeType=i.ShaderCodeType,e.ShaderCodeUUID=i.ShaderCodeUUID,e.ShaderCodeConfigure=i.ShaderCodeConfigure,e.IShaderLibListener=i.IShaderLibListener,e.MaterialContextParam=i.MaterialContextParam;const r=s("d63d"),a=s("2b5f");class n extends i.CommonMaterialContext{constructor(){super()}initialize(t,e=null,s=null){null==e&&(e=new i.MaterialContextParam),e.shaderCodeBinary=!1,e.loadAllShaderCode=!1,super.initialize(t,e,s)}buildConfigure(t,e){return null}initEnd(t){super.initEnd(t),this.addShaderCodeObject(i.ShaderCodeUUID.PBR,a.PBRShaderCode),this.addShaderCodeObject(i.ShaderCodeUUID.Lambert,r.LambertLightShaderCode)}}e.DebugMaterialContext=n},ab73:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.type="vec4",this.data=null,this.name="u_vsmParams",this.arrayLength=3}}class r{constructor(){this.type="vec4",this.data=new Float32Array([.1,.1,.1,1,1,.1,600,3500,.3,0,.9,5e-4,0,0,800,800,-500,-500,1e3,1e3]),this.name="u_envLightParams",this.arrayLength=5}}class a{constructor(){this.type="mat4",this.data=null,this.name="u_shadowMat",this.arrayLength=0}}class n{constructor(){this.type="vec4",this.data=null,this.name="u_stageParam",this.arrayLength=0}}class l{constructor(){this.type="vec4",this.data=null,this.name="u_viewParam",this.arrayLength=0}}class h{constructor(){this.type="vec4",this.data=null,this.name="u_frustumParam",this.arrayLength=0}}class o{constructor(){this.type="vec4",this.data=null,this.name="u_cameraPosition",this.arrayLength=0}}class m{constructor(){this.type="vec4",this.positionName="u_lightPositions",this.colorName="u_lightColors"}}class _{}_.LocalTransformMatUNS="u_objMat",_.CameraViewMatUNS="u_viewMat",_.CameraProjectiveMatUNS="u_projMat",_.FrustumParam=new h,_.CameraPosParam=new o,_.StageParam=new n,_.ViewportParam=new l,_.ShadowMatrix=new a,_.ShadowVSMParams=new i,_.GlobalLight=new m,_.EnvLightParams=new r,e.default=_},abdb:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.AXIS_ANGLE=0,i.QUATERNION=1,i.EULER_ANGLES=2,e.default=i},acaa:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("cfaf"));class n extends a.default{constructor(t,e,s=!1){super(t,e,s),this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.srcFormat=r.TextureFormat.DEPTH_COMPONENT,this.internalFormat=r.TextureFormat.DEPTH_COMPONENT,this.dataType=r.TextureDataType.UNSIGNED_SHORT,this.w=!1,this.u=!0,this.mipmapEnabled=!1,this.v=r.TextureProxyType.Depth}toDepthUnsignedInt(){this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.srcFormat=r.TextureFormat.DEPTH_COMPONENT,this.internalFormat=r.TextureFormat.DEPTH_COMPONENT,this.dataType=r.TextureDataType.UNSIGNED_INT,this.w=!1,this.u=!0,this.mipmapEnabled=!1}toDepthUnsignedShort(){this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.srcFormat=r.TextureFormat.DEPTH_COMPONENT,this.internalFormat=r.TextureFormat.DEPTH_COMPONENT,this.dataType=r.TextureDataType.UNSIGNED_SHORT,this.w=!1,this.u=!0,this.mipmapEnabled=!1}toDepthAndStencil(){this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.srcFormat=r.TextureFormat.DEPTH_STENCIL,this.internalFormat=r.TextureFormat.DEPTH_STENCIL,this.dataType=r.TextureDataType.UNSIGNED_INT_24_8_WEBGL,this.w=!1,this.mipmapEnabled=!1,this.u=!0}uploadData(t){let e=t.getRC();e.texImage2D(this.t,0,r.TextureFormat.ToGL(e,this.internalFormat),this.o,this.p,0,r.TextureFormat.ToGL(e,this.srcFormat),r.TextureDataType.ToGL(e,this.dataType),null)}toString(){return"[DepthTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},acfe:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ca6c")),a=i(s("8a0a")),n=i(s("3b73")),l=i(s("81ce")),h=i(s("fc07"));class o{constructor(){this.b=-1,this.adaptationShaderVersion=!0,this.preCompileInfo=null,this.D_i="",this.D_j="",this.Aw="",this.Ax=0,this.D_k=null,this.D_l=!1,this.D_m=null,this.A5=null,this.Az=null,this.A6=new Map,this.D_n=!1,this.D_o=0,this.Dp=0,this.D_p=1,this.D_q=null,this.dataUniformEnabled=!1,this.b=o.F_0++}getVSCodeStr(){return this.D_i}getFSCodeStr(){return this.D_j}getLayoutBit(){return this.D_o}getMid(){return this.Dp}getFragOutputTotal(){return this.D_p}parseCode(t,e){o.G6.reset(),o.G6.parseVShaderCode(t),o.G6.parseFShaderCode(e),this.D_p=o.G6.fragOutputTotal,this.D_k=o.G6.uniforms}initialize(t,e,s){this.Aw=t,this.adaptationShaderVersion&&null==this.preCompileInfo&&n.default.IsWebGL1()&&(e=l.default.Es3VtxShaderToES2(e),s=l.default.Es3FragShaderToES2(s)),this.preCompileInfo,this.parseCode(e,s);let i=o.G6.attributes,h=0,m=i.length,_=null;this.D_m=[],this.A5=[],this.D_o=0;let u=0;while(h<m){if(_=i[h],null!=_)switch(this.D_m.push(_.name),this.A5.push(_.typeSize),u+=1,a.default.GetVBufTypeByNS(_.name)){case a.default.VBUF_VS:this.D_o|=r.default.BIT_ONE_0;break;case a.default.VBUF_UVS:this.D_o|=r.default.BIT_ONE_1;break;case a.default.VBUF_NVS:this.D_o|=r.default.BIT_ONE_2;break;case a.default.VBUF_CVS:this.D_o|=r.default.BIT_ONE_3;break;case a.default.VBUF_TVS:this.D_o|=r.default.BIT_ONE_4;break;case a.default.VBUF_VS2:this.D_o|=r.default.BIT_ONE_5;break;case a.default.VBUF_UVS2:this.D_o|=r.default.BIT_ONE_6;break;case a.default.VBUF_NVS2:this.D_o|=r.default.BIT_ONE_7;break;case a.default.VBUF_CVS2:this.D_o|=r.default.BIT_ONE_8;break;case a.default.VBUF_TVS2:this.D_o|=r.default.BIT_ONE_9;break;default:u-=1;break}++h}let d=(u<<11)+this.D_o;o.Gx.has(d)||(o.Gx.set(d,o.G3),o.G3++),this.Dp=o.Gx.get(d),this.Ax=o.G6.texTotal,this.D_l=this.Ax>0,this.D_l&&(this.D_q=o.G6.texUniformNameListStr.split(",")),this.D_n=this.Ax<this.D_k.length,this.D_i=e,this.D_j=s,this.Aw=t}getAttriSizeList(){return this.A5}getTexUniformNames(){return this.D_q}getUniforms(){return this.D_k}haveCommonUniform(){return this.D_n}getAttriNSList(){return this.D_m}getUid(){return this.b}getTexTotal(){return this.Ax}haveTexture(){return this.D_l}getLocationsTotal(){return this.Az.length}getUniformTypeNameByNS(t){let e=this.A6.get(t);return null!=e?e.typeName:""}getUniformTypeByNS(t){let e=this.A6.get(t);return null!=e?e.type:0}hasUniformByName(t){return this.A6.has(t)}getUniformLengthByNS(t){return this.A6.has(t)&&this.A6.get(t).arrLength,0}getUniqueShaderName(){return this.Aw}destroy(){this.Ax=0}}o.F_0=0,o.G6=new h.default,o.Gx=new Map,o.G3=1,e.default=o},af29:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("722e")),a=i(s("8333")),n=s("8d98"),l=i(s("cfaf")),h=i(s("3930")),o=i(s("baae")),m=i(s("29ef"));class _{constructor(t,e){this.D_r=new h.default,this.t_=null,this.l=null,this.AK=null,this.D_s=new h.default,this.A_q=null,this.Cu=!0,this.AN=-1,this.AO=-1,this.D_t=128,this.D_u=128,this.D_v=!0,this.D_w=!1,this.D_x=0,this.D_y=null,this.D_z=-1,this.D_0=-1,this.D_1=[],this.Dc=[null,null,null,null,null,null,null,null],this.D_2=null,this.D_3=0,this.Ah=!0,this.AY=1,this.AV=256,this.D_4=!0,this.D_5=!0,this.D_6=!1,this.D_7=!1,this.D_8=!1,this.D_9=!1,this.uns="FBOInstance",this.A_q=t,this.D_2=e,this.l=t.getRenderProxy(),this.t_=this.l.getRenderAdapter(),this.AK=t.getRendererContext()}getFBOUid(){return this.AN}setRProcessIDList(t){if(null!=t){if(t.length<1)throw Error("processIDlist.length < 1, but it must: processIDlist.length >= 1");this.D_1=t.slice(0)}}setRProcessList(t){if(t.length<1)throw Error("list.length < 1, but must: list.length >= 1");this.D_1=new Array(t.length);for(let e=0;e<t.length;++e)this.D_1[e]=t[e].getRPIndex()}getRProcessIDAt(t){return this.D_1[t]}getStage3D(){return this.l.getStage3D()}getCamera(){return null!=this.l?this.l.getCamera():null}lockViewport(){this.D_7=!0}unlockViewport(){this.D_7=!1}updateCamera(){null!=this.l&&this.l.updateCamera()}updateCameraDataFromCamera(t){null!=this.l&&this.l.updateCameraDataFromCamera(t)}useGlobalRenderState(t){this.AK.useGlobalRenderState(t)}useGlobalRenderStateByName(t){this.AK.useGlobalRenderStateByName(t)}setGlobalRenderState(t){this.D_z=t}setGlobalRenderStateByName(t){this.D_z=this.AK.getRenderStateByName(t)}lockRenderState(t=-1){this.D_z>=0||t>=0?this.AK.useGlobalRenderState(t<0?this.D_z:t):this.l.lockRenderState()}unlockRenderState(){this.l.unlockRenderState()}useGlobalRenderColorMask(t){this.AK.useGlobalRenderColorMask(t)}useGlobalRenderColorMaskByName(t){this.AK.useGlobalRenderColorMaskByName(t)}setGlobalRenderColorMask(t){this.D_0=t}setGlobalRenderColorMaskByName(t){this.D_0=this.AK.getRenderColorMaskByName(t)}lockColorMask(t=-1){this.D_0>=0||t>=0?this.AK.useGlobalRenderColorMask(t<0?this.D_0:t):this.l.lockRenderColorMask()}unlockRenderColorMask(){this.AK.useGlobalRenderColorMask(m.default.COLOR_MASK_ALL_TRUE),this.l.unlockRenderColorMask()}useGlobalMaterial(t,e=!1,s=!1){this.D_8=e,this.D_9=s,this.AK.useGlobalMaterial(t,this.D_8,s)}setGlobalMaterial(t,e=!1,s=!1){this.D_8=e,this.D_9=s,this.D_y!=t&&(null!=this.D_y&&this.D_y.__$detachThis(),null!=t&&t.__$attachThis()),this.D_y=t}lockMaterial(){null!=this.D_y?this.AK.useGlobalMaterial(this.D_y,this.D_8,this.D_9):this.AK.lockMaterial()}unlockMaterial(){this.AK.unlockMaterial()}updateGlobalMaterialUniform(){this.AK.updateMaterialUniform(this.D_y)}clearDepth(t=1){this.t_.clearFBODepthAt(this.AN,t)}synFBOSizeWithViewport(){this.Ah=!0}asynFBOSizeWithViewport(){this.Ah=!1}setFBOSizeFactorWithViewPort(t){this.AY=t}createViewportSizeFBOAt(t,e=!1,s=!1,i=0){this.AN<0&&(this.AN=t,this.AO=o.default.FRAMEBUFFER,this.D_t=this.t_.getViewportWidth(),this.D_u=this.t_.getViewportHeight(),this.D_v=e,this.D_w=s,this.D_x=i,this.t_.createFBOAt(t,this.AO,this.D_t,this.D_u,e,s,i))}createFBO(t,e,s=0){this.D_v=t,this.D_w=e,this.D_x=s,this.t_.createFBOAt(this.AN,this.AO,this.D_t,this.D_u,t,e,s)}createAutoSizeFBOAt(t,e=!1,s=!1,i=0){t>=0&&this.AN<0&&(this.AO=o.default.FRAMEBUFFER,this.D_t=512,this.D_u=512,this.AN=t,this.createFBO(e,s,i))}createFBOAt(t,e,s,i=!1,r=!1,a=0){t>=0&&this.AN<0&&(this.AO=o.default.FRAMEBUFFER,this.D_t=e,this.D_u=s,this.AN=t,this.D_t<1&&(this.D_t=this.t_.getRCanvasWidth()),this.D_u<1&&(this.D_u=this.t_.getRCanvasHeight()),this.createFBO(i,r,a))}createReadFBOAt(t,e,s,i=!1,r=!1,a=0){t>=0&&this.AN<0&&(this.AO=o.default.READ_FRAMEBUFFER,this.D_t=e,this.D_u=s,this.AN=t,this.D_t<1&&(this.D_t=this.t_.getRCanvasWidth()),this.D_u<1&&(this.D_u=this.t_.getRCanvasHeight()),this.createFBO(i,r,a))}createDrawFBOAt(t,e,s,i=!1,r=!1,a=0){t>=0&&this.AN<0&&(this.AO=o.default.DRAW_FRAMEBUFFER,this.D_t=e,this.D_u=s,this.AN=t,this.D_t<1&&(this.D_t=this.t_.getRCanvasWidth()),this.D_u<1&&(this.D_u=this.t_.getRCanvasHeight()),this.createFBO(i,r,a))}resizeFBO(t,e){this.D_t==t&&this.D_u==e||(this.D_t=t,this.D_u=e,this.t_.resizeFBOAt(this.AN,t,e))}getRTTAt(t){return this.Dc[t]}enableMipmapRTTAt(t){this.Dc[t].enableMipmap()}generateMipmapTextureAt(t){this.Dc[t].generateMipmap(this.l.Texture)}setRenderToTexture(t,e=0){return 0==e?this.D_3=1:this.D_3<e+1&&(this.D_3=e+1),this.Dc[e]=t,t}setRenderToRTTTextureAt(t,e=0){this.setRenderToTexture(this.D_2.getRTTTextureAt(t),e)}setRenderToFloatTextureAt(t,e=0){this.setRenderToTexture(this.D_2.getRTTFloatTextureAt(t),e)}setRenderToHalfFloatTexture(t,e=0){return null==t&&(t=new l.default(128,128),t.__$setRenderProxy(this.l),t.internalFormat=n.TextureFormat.RGBA16F,t.srcFormat=n.TextureFormat.RGBA,t.dataType=n.TextureDataType.FLOAT,t.minFilter=n.TextureConst.LINEAR,t.magFilter=n.TextureConst.LINEAR,t.__$setRenderProxy(this.l)),this.setRenderToTexture(t,e)}setRenderToRGBATexture(t,e=0){return null==t&&(t=this.createRGBATexture()),this.setRenderToTexture(t,e)}setRenderToDepthTextureAt(t,e=0){return this.setRenderToTexture(this.D_2.getDepthTextureAt(t),e)}createRGBATexture(){let t=new l.default(32,32);return t.internalFormat=n.TextureFormat.RGBA,t.srcFormat=n.TextureFormat.RGBA,t.dataType=n.TextureDataType.UNSIGNED_BYTE,t.minFilter=n.TextureConst.LINEAR,t.magFilter=n.TextureConst.LINEAR,t.__$setRenderProxy(this.l),t}setClearState(t,e,s=!1){this.D_4=t,this.D_5=e,this.D_6=s}setRenderToBackBuffer(){this.l.setClearColor(this.D_r),this.AK.setRenderToBackBuffer()}setClearDepth(t){this.AV=t}getClearDepth(){return this.t_.getClearDepth()}getViewportX(){return this.t_.getViewportX()}getViewportY(){return this.t_.getViewportY()}getViewportWidth(){return this.t_.getViewportWidth()}getViewportHeight(){return this.t_.getViewportHeight()}getFBOWidth(){return this.t_.getFBOWidthAt(this.AN)}getFBOHeight(){return this.t_.getFBOHeightAt(this.AN)}resetAttachmentMask(t){this.t_.resetFBOAttachmentMask(t)}setAttachmentMaskAt(t,e){this.t_.setFBOAttachmentMaskAt(t,e)}setClearRGBColor3f(t,e,s){this.D_s.setRGB3f(t,e,s)}setClearColorEnabled(t){this.D_4=t}setClearDepthEnabled(t){this.D_5=t}setClearStencilEnabled(t){this.D_6=t}setClearUint24Color(t,e=1){this.D_s.setRGBUint24(t),this.D_s.a=e}setClearRGBAColor4f(t,e,s,i){this.D_s.setRGBA4f(t,s,e,i)}blitFrom(t,e=a.default.COLOR_BUFFER_BIT,s=r.default.NEAREST,i=-1,n=0,l=null){this.AN>=0&&(this.t_.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.t_.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.t_.blitFBO(t.getFBOUid(),this.AN,e,s,i,n,l))}blitColorFrom(t,e=r.default.NEAREST,s=-1,i=0,n=null){this.AN>=0&&(this.t_.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.t_.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.t_.blitFBO(t.getFBOUid(),this.AN,a.default.COLOR_BUFFER_BIT,e,s,i,n))}blitDepthFrom(t,e=r.default.NEAREST,s=-1,i=0,n=null){this.AN>=0&&(this.t_.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.t_.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.t_.blitFBO(t.getFBOUid(),this.AN,a.default.COLOR_BUFFER_BIT|a.default.DEPTH_BUFFER_BIT,e,s,i,n))}blitColorAndDepthFrom(t,e=r.default.NEAREST,s=-1,i=0,n=null){this.AN>=0&&(this.t_.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.t_.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.t_.blitFBO(t.getFBOUid(),this.AN,a.default.COLOR_BUFFER_BIT|a.default.DEPTH_BUFFER_BIT,e,s,i,n))}blitStencilFrom(t,e=r.default.NEAREST,s=-1,i=0,n=null){this.AN>=0&&(this.t_.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.t_.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.t_.blitFBO(t.getFBOUid(),this.AN,a.default.STENCIL_BUFFER_BIT,e,s,i,n))}renderToTextureAt(t,e=0){this.t_.setRenderToTexture(this.Dc[t],this.D_v,this.D_w,e),this.t_.useFBO(this.D_4,this.D_5,this.D_6)}runBeginDo(){if(this.Cu){this.Cu=!1,this.l.getClearRGBAColor4f(this.D_r),this.D_7?this.t_.lockViewport():this.t_.unlockViewport(),this.t_.bindFBOAt(this.AN,this.AO),this.Ah?(this.t_.synFBOSizeWithViewport(),this.t_.setFBOSizeFactorWithViewPort(this.AY)):this.t_.asynFBOSizeWithViewport(),this.AV<128&&this.t_.setClearDepth(this.AV),this.l.setClearColor(this.D_s);let t=0;for(;t<this.D_3;++t)this.t_.setRenderToTexture(this.Dc[t],this.D_v,this.D_w,t);this.t_.useFBO(this.D_4,this.D_5,this.D_6),null!=this.D_y?this.AK.useGlobalMaterial(this.D_y,this.D_8,this.D_9):this.AK.unlockMaterial()}}run(t=!1,e=!1,s=!0,i=!0){if(t&&this.lockRenderState(),e&&!i&&this.lockMaterial(),this.AN>=0&&null!=this.D_1){i&&this.runBeginDo();for(let t=0,e=this.D_1.length;t<e;++t)this.A_q.runAt(this.D_1[t])}t&&this.unlockRenderState(),e&&this.unlockMaterial(),s&&this.runEnd()}runAt(t,e=!0){this.AN>=0&&null!=this.D_1&&(0==t&&e?this.runBeginDo():this.Cu=!0,this.A_q.runAt(this.D_1[t]))}drawEntity(t,e=!1,s=!0){this.Cu||this.A_q.drawEntity(t,e,s)}runBegin(){this.AN>=0&&null!=this.D_1&&(this.Cu=!0,this.runBeginDo())}runEnd(){this.l.setClearColor(this.D_r),this.Cu=!0,this.D_7&&this.t_.unlockViewport()}useCamera(t,e=!1){this.A_q.useCamera(t,e)}useMainCamera(){this.A_q.useMainCamera()}reset(){let t=0;for(;t<this.D_3;++t)this.Dc[t]=null;this.Cu=!1,this.AN=-1,this.D_3=0,this.D_1=[],null!=this.D_y&&(this.D_y.__$detachThis(),this.D_y=null)}clone(){let t=new _(this.A_q,this.D_2);t.AY=this.AY,t.D_s.copyFrom(this.D_s),t.AN=this.AN,t.AO=this.AO,t.AV=this.AV,t.D_3=this.D_3,t.D_v=this.D_v,t.D_w=this.D_w,t.Ah=this.Ah,t.D_t=this.D_t,t.D_u=this.D_u,t.D_x=this.D_x;let e=0;for(;e<this.D_3;++e)t.Dc[e]=t.Dc[e];if(null!=this.D_1){let s=this.D_1.length,i=new Array(s);for(e=0;e<s;++e)i[e]=this.D_1[e];t.setRProcessIDList(i)}return t}}e.default=_},af2e:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("f610")),n=i(s("35fa"));class l extends a.default{constructor(){super(),this.uScale=1,this.vScale=1,this.uvType=0,this.normalScale=1,this.normalEnabled=!1,this.tangentEnabled=!1}initializeXOYPlane(t,e=300,s=300,i=4,a=4){let n=new Array(i),l=new r.default(e/a,s/i,0);for(let h=0;h<i;++h){let e=new Array(a);for(let s=0;s<a;++s)e[a-s-1]=new r.default(t.x+s*l.x,t.y+h*l.y,t.z);n[h]=e}this.initialize(n)}initializeXOZPlane(t,e=300,s=300,i=4,a=4){let n=new Array(i),l=new r.default(e/a,0,s/i);for(let h=0;h<i;++h){let e=new Array(a);for(let s=0;s<a;++s)e[a-s-1]=new r.default(t.x+s*l.x,t.y,t.z+h*l.z);n[h]=e}this.initialize(n)}initializeYOZPlane(t,e=300,s=300,i=4,a=4){let n=new Array(i),l=new r.default(0,e/a,s/i);for(let h=0;h<i;++h){let e=new Array(a);for(let s=0;s<a;++s)e[a-s-1]=new r.default(t.x,t.y+s*l.y,t.z+h*l.z);n[h]=e}this.initialize(n)}initialize(t){let e=0,s=0,i=0;this.vtxTotal=t[0].length*t.length,this.B_o=new Float32Array(3*this.vtxTotal),this.B_U=new Float32Array(2*this.vtxTotal);let r=0,a=0,l=t[0].length,h=l-1,o=t,m=o.length,_=o[0],u=this.uScale,d=this.uScale,c=this.uvType;for(e=0;e<m;++e)for(_=o[e],i=e/(m-1),s=0;s<l;++s){c<1?(this.B_U[a++]=u*(s/h),this.B_U[a++]=d*i):(this.B_U[a++]=u*i,this.B_U[a++]=d*(s/h));let t=_[s];this.B_o[r++]=t.x,this.B_o[r++]=t.y,this.B_o[r++]=t.z}this.bounds.addXYZFloat32Arr(this.B_o),this.bounds.updateFast();let f=l,p=0,g=0;m-=1;let v=m*h*6;for(this.B_t=v<65535?new Uint16Array(v):new Uint32Array(v),r=0,e=0;e<m;++e)for(p=e*f,g=(e+1)*f,s=1;s<=h;++s)this.B_t[r++]=p+s,this.B_t[r++]=g+s-1,this.B_t[r++]=p+s-1,this.B_t[r++]=p+s,this.B_t[r++]=g+s,this.B_t[r++]=g+s-1;let x=this.B_t.length/3;if((this.normalEnabled||this.tangentEnabled)&&(this.B_p=new Float32Array(this.B_o.length),n.default.ClacTrisNormal(this.B_o,this.B_o.length,x,this.B_t,this.B_p),1!=this.normalScale))for(m=this.B_p.length,e=0;e<m;e+=3)this.B_p[e]*=this.normalScale,this.B_p[e+1]*=this.normalScale,this.B_p[e+2]*=this.normalScale;this.tangentEnabled&&(this.B_q=new Float32Array(this.B_o.length),this.B_r=new Float32Array(this.B_o.length),n.default.ClacTrisTangent(this.B_o,this.B_o.length,this.B_U,this.B_p,x,this.B_t,this.B_q,this.B_r)),this.vtCount=this.B_t.length,this.trisNumber=this.vtCount/3}}e.default=l},af68:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=i(s("7b0e"));class n{constructor(){this.DI=0,this.D_=[],this.DH=[],this.EA=[],this.EB=[],this.f_=[]}getFreeId(){return this.f_.length>0?this.f_.pop():-1}createNode(){let t=this.getFreeId();if(t>=0)return this.EB[t]=1,this.DH[t];{t=this.DI;let e=a.default.Create();return this.DH.push(e),this.EA.push(null),e.spaceId=t,this.EB.push(1),this.D_.push(t),this.EB.push(1),this.DI++,e}}restoreId(t){t>0&&1==this.EB[t]&&(this.f_.push(t),this.EB[t]=0,this.EA[t]=null)}addEntity(t){let e=this.createNode();return this.EA[e.spaceId]=t,e.entity=t,t.__$rseFlag=r.default.AddSpaceUid(t.__$rseFlag,e.spaceId),e}initialize(t){if(t>0)for(let e=0;e<t;e++){let t=this.createNode();this.EA[t.spaceId]=null}}getNodeByEntity(t){if(r.default.TestSpaceContains(t.__$rseFlag)){let e=r.default.GetSpaceUid(t.__$rseFlag);if(this.EA[e]==t)return this.DH[e]}return null}removeEntity(t){if(r.default.TestSpaceContains(t.__$rseFlag)){let e=r.default.GetSpaceUid(t.__$rseFlag);this.EA[e]==t&&(this.DH[e].entity=null,this.restoreId(e),t.__$rseFlag=r.default.RemoveSpaceUid(t.__$rseFlag))}}toString(){return"[EntityNodeQueue()]"}}e.default=n},b02c:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{constructor(t,e){this.b=-1,this.Dp=-1,this.Ax=0,this.EC=null,this.ED=null,this.AE=null,this.I=0,this.A_6=null,this.direct=!0,this.k=0,this.I=t,this.b=a.F_0++,this.Dp=e}__$setParam(t,e){this.I=t,this.Dp=e}getRCUid(){return this.I}getMid(){return this.Dp}getTexTotal(){return this.Ax}collectTexList(t,e,s){this.A_6=t;let i=0;if(this.direct)if(this.Ax<1&&e.length>0){let a,n=r.default.GetNearestCeilPow2(e.length);this.ED=new Uint16Array(n),this.EC=new Array(n),this.AE=e;while(i<s)a=e[i],a.__$attachThis(),a.__$$upload(t),this.ED[i]=a.getSampler(),this.EC[i]=this.A_6.getGpuBuffer(a.getResUid()),this.A_6.__$attachRes(a.getResUid()),i++;this.Ax=i}else this.Ax=0;else this.Ax=s;while(i<e.length)e[i++].__$attachThis()}run(){if(this.A_6.unlocked&&this.A_6.texMid!=this.Dp){this.A_6.texMid=this.Dp;let t=this.A_6.getRC(),e=t.TEXTURE0;if(this.direct)for(let s=0;s<this.Ax;++s)t.activeTexture(e++),t.bindTexture(this.ED[s],this.EC[s]);else{let s=this.AE;for(let i=0;i<this.Ax;++i)t.activeTexture(e++),s[i].__$$use(this.A_6)}}}getUid(){return this.b}__$attachThis(){++this.k}__$detachThis(){--this.k,this.k<1&&(this.k=0,a.Restore(this))}reset(){if(null!=this.AE)for(let t=0,e=this.AE.length;t<e;++t)this.AE[t].__$detachThis(),this.A_6.__$detachRes(this.AE[t].getResUid()),this.EC[t]=null;this.Ax=0,this.AE=null,this.A_6=null}toString(){return"TextureRenderObj(uid = "+this.b+", mid="+this.Dp+")"}static Create(t,e,s){let i=e.length;if(i>0&&s>0){if(i<s)throw Error("There are fewer textures than in the shader : (need "+s+",but only have "+i+") !!!");let r=31,n=0,l=!0;while(n<s)r=131*r+e[n].getUid(),e[n].isDirect()||(l=!1),++n;let h=a.G8[t.getRCUid()],o=null;return h.has(r)?o=h.get(r):(o=a.G7.length<1?new a(t.getRCUid(),r):a.G7.pop(),o.collectTexList(t,e,s),h.set(r,o)),o.__$setParam(t.getRCUid(),r),o.direct=l,o}return null}static Restore(t){t.getMid()>-1&&(a.G8[t.getRCUid()].delete(t.getMid()),t.__$setParam(0,0),a.G7.push(t),t.reset())}static GetByMid(t,e){return a.G8[t].get(e)}}a.F_0=0,a.G8=[new Map,new Map,new Map,new Map,new Map,new Map,new Map,new Map],a.G7=[],a.G9=!0,a.G_A=-1,e.TextureRenderObj=a;class n{constructor(t){this.A_6=null,this.A_6=t}run(){this.A_6.renderBegin()}getMid(){return 1}__$attachThis(){}__$detachThis(){}}e.EmptyTexRenderObj=n,e.default=a},b0ef:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.z=null,this.y=null,this.EE=-1,this.EF=-1,this.resized=!0}setDiv(t){this.y=t}createViewEle(t,e){null==this.y&&(this.y=document.getElementById("voxEngineDiv")),null==this.y&&(this.y=t.createElement("div"),this.y.style.width="400px",this.y.style.height="300px",document.body.appendChild(this.y)),this.y.style.display="bolck",this.y.style.position="absolute",""==this.y.style.left&&(this.y.style.left="0px",this.y.style.top="0px"),e&&(this.y.style.width="100%",this.y.style.height="100%"),null==this.z&&(this.z=document.createElement("canvas"),this.y.appendChild(this.z),this.z.width=800,this.z.height=600,this.z.style.display="bolck",this.z.style.left="0px",this.z.style.top="0px",this.z.style.position="absolute")}setDivStyleLeftAndTop(t,e){this.y.style.left=t+"px",this.y.style.top=e+"px"}setDivStyleSize(t,e){this.EE==t&&this.EF==e||(this.y.style.width=t+"px",this.y.style.height=e+"px",this.resized=!0)}getDiv(){return this.y}getCanvas(){return this.z}}e.default=i},b161:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("3806")),n=i(s("c51d")),l=i(s("c497")),h=i(s("af68")),o=i(s("a80a")),m=i(s("9c4d")),_=i(s("d958")),u=i(s("5d04")),d=i(s("a446")),c=i(s("c711")),f=i(s("955e")),p=i(s("765c")),g=i(s("af29")),v=i(s("d7e2")),x=i(s("70f2")),T=i(s("2139"));class E{constructor(){this.b=-1,this.t_=null,this.l=null,this.A_K=null,this.AK=null,this.A_q=null,this.Ch=new Uint8Array(128),this.Ci=0,this.Cj=null,this.Ck=new r.default,this.Cl=new r.default,this.Cm=null,this.Cn=!1,this.Co=null,this.Cp=!0,this.J=0,this.K=0,this.L=800,this.M=800,this.Cq=null,this.Cr=null,this.EG=null,this.EH=[],this.EI=0,this.Cu=-1,this.Cv=!0,this.EJ=!1,this.EK=-1,this.Ct=null,this.A_P=!0,this.runnableQueue=new m.default,this.textureBlock=new u.default,this.stage3D=null,this.Cx=[],this.Cy=0,this.EL=null,this.Cz=!0,this.C0=!0,this.C1=!0,this.C2=!0,this.b=E.F_0++}tickUpdate(){this.EK>-1&&clearTimeout(this.EK),this.EK=setTimeout(this.tickUpdate.bind(this),this.Ct.getTickUpdateTime()),this.textureBlock.run()}enable(){this.A_P=!0}disable(){this.A_P=!1}isEnabled(){return this.A_P}getUid(){return this.b}getDiv(){return this.l.getDiv()}getCanvas(){return this.l.getCanvas()}getRPONodeBuilder(){return null}getRenderProxy(){return this.l}setViewPort(t,e,s,i){null!=this.l&&(this.J=t,this.K=e,this.L=s,this.M=i,this.l.setViewPort(t,e,s,i))}setViewPortFromCamera(t){null!=this.l&&null!=t&&(this.J=t.getViewX(),this.K=t.getViewY(),this.L=t.getViewWidth(),this.M=t.getViewHeight(),this.l.setViewPort(this.J,this.K,this.L,this.M))}reseizeViewPort(){this.l.reseizeRCViewPort()}lockViewport(){this.t_.lockViewport()}unlockViewport(){this.t_.unlockViewport()}getRendererAdapter(){return this.t_}getRenderer(){return this.A_q}getRendererContext(){return this.AK}getStage3D(){return this.l.getStage3D()}getRendererStatus(){return this.A_q.getRendererStatus()}getViewWidth(){return this.l.getStage3D().viewWidth}getViewHeight(){return this.l.getStage3D().viewHeight}getCamera(){return this.l.getCamera()}asynFBOSizeWithViewport(){this.AK.asynFBOSizeWithViewport()}synFBOSizeWithViewport(){this.AK.synFBOSizeWithViewport()}cameraLock(){this.l.cameraLock()}cameraUnlock(){this.l.cameraUnlock()}getMouseXYWorldRay(t,e){this.l.getMouseXYWorldRay(t,e)}createCamera(){return new n.default}createFBOInstance(){return new g.default(this,this.textureBlock.getRTTStrore())}setClearUint24Color(t,e=1){this.l.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,s){this.l.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.l.setClearRGBAColor4f(t,e,s,i)}setClearColor(t){this.l.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.AK.setRenderToBackBuffer()}drawBackBufferToCanvas(t){let e=this.getCanvas();var s=t.getContext("2d");s.drawImage(e,0,0,t.width,t.height)}updateRenderBufferSize(){this.t_.updateRenderBufferSize()}setEvt3DController(t){null!=t&&(t.initialize(this.getStage3D(),this.getStage3D()),t.setRaySelector(this.Cj.getRaySelector())),this.Co=t}isRayPickSelected(){return null!=this.Co&&this.Co.isSelected()}enableMouseEvent(t=!0){null==this.Co&&(t?this.Cj.setRaySelector(new f.default):this.Cj.setRaySelector(new c.default),this.setEvt3DController(new p.default)),this.Cp=!0}disableMouseEvent(){this.Cp=!1}getEvt3DController(){return this.Co}getSpace(){return this.Cj}getDevicePixelRatio(){return this.t_.getDevicePixelRatio()}createSubScene(){if(null!=this.A_q){let t=new x.default(this,this.A_q,this.Cn);this.EH.push(t),this.EI++;let e=t;return e.textureBlock=this.textureBlock,t}return null}addEventListener(t,e,s,i=!0,r=!1){this.stage3D.addEventListener(t,e,s,i,r)}removeEventListener(t,e,s){this.stage3D.removeEventListener(t,e,s)}setAccessor(t){this.Cm=t}initialize(t=null,e=3){if(null==this.A_q){null==t&&(t=new l.default),this.Ct=t;let s=this;s.stage3D=new a.default(this.getUid(),document),e<1&&(e=1),e>8&&(e=8),this.Cn=t.evtFlowEnabled,this.A_q=new _.default,this.A_q.__$setStage3D(this.stage3D),T.default.Allocate(t.getMatrix4AllocateSize());let i=new n.default;this.A_q.initialize(t,i),this.Ch[0]=0,this.Ci++;let r=null;for(;e>=0;)r=this.A_q.appendProcess(t.batchEnabled,t.processFixedState),this.Ch[this.Ci]=r.getRPIndex(),this.Ci++,--e;this.AK=this.A_q.getRendererContext(),this.l=this.AK.getRenderProxy(),this.t_=this.l.getRenderAdapter();let h=this.l.getStage3D();if(this.L=h.stageWidth,this.M=h.stageHeight,this.A_K=this.A_q.getDataBuilder().getRenderShader(),this.textureBlock.setRenderer(this.A_q),this.EG=new v.default(this.l),null==this.Cj){let t=new d.default;t.initialize(this.A_q,this.l.getCamera()),this.Cj=t}this.tickUpdate()}}setRendererProcessParam(t,e,s){this.A_q.setRendererProcessParam(this.Ch[t],e,s)}appendARendererProcess(t=!0,e=!1){let s=this.A_q.appendProcess(t,e);this.Ch[this.Ci]=s.getRPIndex(),this.Ci++}getRenderProcessAt(t){return this.A_q.getProcessAt(this.Ch[t])}addContainer(t,e=0){if(e<0&&(e=0),null!=t&&t.__$wuid<0&&t.__$contId<1){let s=0;for(;s<this.Cy;++s)if(this.Cx[s]==t)return;s>=this.Cy&&(t.__$wuid=this.b,t.wprocuid=e,t.__$setRenderer(this),this.Cx.push(t),this.Cy++)}}removeContainer(t){if(null!=t&&t.__$wuid==this.b&&t.getRenderer()==this.A_q){let e=0;for(;e<this.Cy;++e)if(this.Cx[e]==t){t.__$wuid=-1,t.wprocuid=-1,t.__$setRenderer(null),this.Cx.splice(e,1),--this.Cy;break}}}setAutoRunningEnabled(t){this.Cv=t}setAutoRenderingSort(t){this.EJ=t}setProcessSortEnabledAt(t,e,s=null){if(this.A_q.setProcessSortEnabledAt(t,e),e){let e=this.A_q.getProcessAt(t);s=null!=s?s:this.EG,null!=e&&e.setSorter(s)}}setProcessSortEnabled(t,e,s=null){this.A_q.setProcessSortEnabled(t,e),e&&null!=t&&!t.hasSorter()&&(s=null!=s?s:this.EG,t.setSorter(s))}moveEntityTo(t,e){this.A_q.moveEntityToProcessAt(t,this.Ch[e])}drawEntity(t,e=!1,s=!0){this.A_q.drawEntity(t,e,s)}addEntity(t,e=0,s=!0){if(null!=t&&t.__$testSpaceEnabled())if(t.isPolyhedral())if(t.hasMesh())this.A_q.addEntity(t,this.Ch[e],s),null!=this.Cj&&this.Cj.addEntity(t);else{null==this.Cq&&(this.Cq=new o.default,this.Cr=new h.default);let s=this.Cr.addEntity(t);s.rstatus=e,this.Cq.addNode(s)}else this.A_q.addEntity(t,this.Ch[e],s),null!=this.Cj&&this.Cj.addEntity(t)}removeEntity(t){if(null!=t){let e=null;if(null!=this.Cq){let e=this.Cr.getNodeByEntity(t);null!=e&&(this.Cq.removeNode(e),this.Cr.removeEntity(t))}null==e&&(this.A_q.removeEntity(t),null!=this.Cj&&this.Cj.removeEntity(t))}}updateMaterialUniformToCurrentShd(t){this.A_q.updateMaterialUniformToCurrentShd(t)}showInfoAt(t){this.A_q.showInfoAt(t)}getRenderUnitsTotal(){return this.A_q.getRenderUnitsTotal()}useCamera(t,e=!1){this.EL=t,e&&(this.l.setRCViewPort(t.getViewX(),t.getViewY(),t.getViewWidth(),t.getViewHeight(),!0),this.l.reseizeRCViewPort()),t.update(),this.AK.resetUniform(),this.l.updateCameraDataFromCamera(t)}useMainCamera(){this.EL=null;let t=this.l.getCamera();this.l.setRCViewPort(t.getViewX(),t.getViewY(),t.getViewWidth(),t.getViewHeight(),!0),this.l.reseizeRCViewPort(),this.l.updateCamera(),this.AK.resetUniform(),this.l.updateCameraDataFromCamera(this.l.getCamera())}updateCameraDataFromCamera(t){this.l.updateCameraDataFromCamera(t)}resetState(){this.AK.resetState()}resetUniform(){this.AK.resetUniform()}enableSynViewAndStage(){this.l.enableSynViewAndStage()}renderBegin(t=!0){if(null==this.EL){if(this.t_.unlockViewport(),this.l.isAutoSynViewAndStage()){let t=this.l.testViewPortChanged(this.J,this.K,this.L,this.M);this.J=this.l.getViewX(),this.K=this.l.getViewY(),this.L=this.l.getViewWidth(),this.M=this.l.getViewHeight(),t&&(this.l.setRCViewPort(this.J,this.K,this.L,this.M,!0),this.l.reseizeRCViewPort())}else this.l.setViewPort(this.J,this.K,this.L,this.M);this.l.updateCamera(),this.l.updateCameraDataFromCamera(this.l.getCamera())}this.A_K.renderBegin(),t&&this.AK.renderBegin(null==this.EL),this.EL=null,null!=this.Cm&&this.Cm.renderBegin(this)}runBegin(t=!0,e=!0){t&&this.Cv&&(this.Cu>=0&&this.runEnd(),this.Cu=0);let s=this.EL,i=null==s;this.renderBegin(e),null!=this.Cj&&(this.Cj.setCamera(i?this.l.getCamera():s),this.Cj.runBegin())}renderContextBegin(){this.AK.renderBegin()}setRayTestEanbled(t){this.C2=t}runMouseTest(t,e){let s=-1;if(null!=this.Co&&this.Cp){if(this.C1&&this.Co.getEvtType()>0){let t=this.Cj.getRaySelector();if(null!=t){this.C2?this.mouseRayTest():t.clear();let e=t.getSelectedNodesTotal();if(e>1){let s=0,i=t.getSelectedNodes(),r=null;for(;s<e;++s)r=i[s],r.entity.isPolyhedral()}}this.C1=!1}s=this.Co.run(t,e)}return this.Cz=!1,s}update(t=!0,e=!0){if(this.stage3D.enterFrame(),t&&this.Cv&&(0!=this.Cu&&this.runBegin(),this.Cu=1),this.Cz=!0,this.C0=!0,this.C1=!0,null!=this.Cq){let t=this.Cq.getBegin();if(null!=t){let e,s,i;while(null!=t)t.entity.hasMesh()?(e=t,t=t.next,s=e.entity,i=e.rstatus,this.Cq.removeNode(e),this.Cr.removeEntity(e.entity),this.addEntity(s,i)):t=t.next}}let s=0;for(;s<this.Cy;++s)this.Cx[s].update();this.A_q.update(),null!=this.Cj&&(this.Cj.update(),this.C0&&(null!=this.Co||this.EJ||null!=this.Cj.getRaySelector())&&this.Cj.run()),this.EJ&&this.A_q.updateAllProcess(),this.Cz&&!this.Cn&&(e?this.runMouseTest(1,0):null!=this.Co&&this.Co.mouseOutEventTarget())}cullingTest(){null!=this.Cj&&this.Cj.run(),this.C0=!1}mouseRayTest(){null!=this.Cj&&(this.l.getMouseXYWorldRay(this.Cl,this.Ck),this.Cj.rayTest(this.Cl,this.Ck))}run(t=!0){if(this.A_P){if(t&&this.Cv&&(1!=this.Cu&&this.update(),this.Cu=2),this.runnableQueue.run(),this.EI>0)for(let t=0;t<this.Ci;++t)this.A_q.runAt(this.Ch[t]);else this.A_q.run();t&&this.runEnd()}}runAt(t){this.A_P&&this.A_q.runAt(this.Ch[t])}runEnd(){null!=this.Co&&this.Co.runEnd(),this.AK.runEnd(),null!=this.Cj&&this.Cj.runEnd(),this.Cv&&(this.Cu=-1),null!=this.Cm&&this.Cm.renderEnd(this)}renderFlush(){null!=this.l&&this.l.flush()}updateCamera(){null!=this.l&&this.l.updateCamera()}toString(){return"[RendererScene(uid = "+this.b+")]"}}E.F_0=0,e.default=E},b30a:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("644c")),n=i(s("20ef"));class l{constructor(t,e,s){this.EM=new Map,this.EN=[],this.EO=0,this.EP=[],this.EQ=!0,this.ER=!1,this.ES=-1,this.ET=null,this.D_p=1,this.I=-1,this.Au=null,this.EU=null,this.t_=null,this.EV=null,this.A_k=null,this.EW=null,this.drawFlag=-1,this.__$globalUniform=null,this.I=t,this.t_=s,this.Au=e}createResByParams3(t,e,s,i){return!1}getRC(){return this.Au}getGPUProgram(){return this.EU}getRCUid(){return this.I}useTransUniform(t){this.EW!=t&&(this.EW=t,t.use(this))}useUniform(t){this.A_k!=t&&(this.A_k=t,t.use(this))}updateUniform(t){null!=t&&t.use(this)}create(t){let e=t.getUniqueShaderName();if(this.EM.has(e))return this.EM.get(e);let s=new n.default(this.EO);return s.setShdData(t),this.EN[s.getUid()]=s,this.EP[s.getUid()]=null,++this.EO,this.EM.set(e,s),r.default.SHADERCODE_TRACE_ENABLED,s}findShdProgramByUid(t){return this.EN[t]}findShdProgram(t){return this.EM.has(t)?this.EM.get(t):null}findShdProgramByShdData(t){return null!=t&&this.EM.has(t.getUniqueShaderName())?this.EM.get(t.getUniqueShaderName()):null}unlock(){this.EQ=!0,this.__$globalUniform=null}isUnLocked(){return this.EQ}lock(){this.EQ=!1}textureUnlock(){this.ER=!0}isTextureUnLocked(){return this.ER}textureLock(){this.ER=!1}setSharedUniformByShd(t,e){this.EP[t.getUid()]=e}getSharedUniformByShd(t){return this.EP[t.getUid()]}getCurrFragOutputTotal(){return this.D_p}hasResUid(t){return null!=this.EN[t]}bindToGpu(t){if(this.EQ&&t>-1&&t<this.EO)if(this.ES!=t){this.ES=t;let e=this.EN[t];this.D_p=e.getFragOutputTotal(),this.D_p,this.getActiveAttachmentTotal(),this.EU=e.getGPUProgram(),this.Au.useProgram(this.EU),e.useTexLocation();let s=this.EP[e.getUid()];this.EV=s;while(null!=s)s.use(this),s=s.next;this.ET=e}else if(null==this.EV&&null!=this.ET){let t=this.EP[this.ET.getUid()];this.EV=t;while(null!=t)t.use(this),t=t.next}}getGpuBuffer(t){return null}getCurrentShd(){return this.ET}getCurrentShdUid(){return this.ES}resetUniform(){this.A_k=null,this.EW=null,this.EV=null}renderBegin(){this.D_p=1,this.ES=-1,this.ET=null,this.drawFlag=-1}update(){}destroy(){this.Au=null,this.t_=null}useUniformToCurrentShd(t){this.A_k!=t&&(this.A_k,t.useByShd(this,this.ET))}useUniform2ToCurrentShd(t,e){this.A_k!=t&&(this.A_k,t.useByShd(this,this.ET)),this.EW!=e&&(this.EW,e.useByShd(this,this.ET))}useUniformMat4(t,e){this.Au.uniformMatrix4fv(t,!1,e)}useUniformV2(t,e,s,i,r){switch(e){case a.default.SHADER_MAT4:r<1?this.Au.uniformMatrix4fv(t,!1,s):this.Au.uniformMatrix4fv(t,!1,s,r,16*i);break;case a.default.SHADER_MAT3:this.Au.uniformMatrix3fv(t,!1,s,0,9*i);break;case a.default.SHADER_VEC4FV:this.Au.uniform4fv(t,s,r,4*i);break;case a.default.SHADER_VEC3FV:this.Au.uniform3fv(t,s,r,3*i);break;case a.default.SHADER_VEC4:this.Au.uniform4f(t,s[0],s[1],s[2],s[3]);break;case a.default.SHADER_VEC3:this.Au.uniform3f(t,s[0],s[1],s[2]);break;case a.default.SHADER_VEC2:this.Au.uniform2f(t,s[0],s[1]);break;default:break}}useUniformV1(t,e,s,i){switch(e){case a.default.SHADER_MAT4:this.Au.uniformMatrix4fv(t,!1,s);break;case a.default.SHADER_MAT3:this.Au.uniformMatrix3fv(t,!1,s);break;case a.default.SHADER_VEC4FV:this.Au.uniform4fv(t,s,4*i);break;case a.default.SHADER_VEC3FV:this.Au.uniform3fv(t,s,3*i);break;case a.default.SHADER_VEC4:this.Au.uniform4f(t,s[0],s[1],s[2],s[3]);break;case a.default.SHADER_VEC3:this.Au.uniform3f(t,s[0],s[1],s[2]);break;case a.default.SHADER_VEC2:this.Au.uniform2f(t,s[0],s[1]);break;default:break}}getActiveAttachmentTotal(){return this.t_.getActiveAttachmentTotal()}}e.default=l},b3bd:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uns="",this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,s=e.length;for(let i=0;i<s;++i)if(t==e[i])return this.dataList[i]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let s=this.uniformNameList,i=s.length;for(let r=0;r<i;++r)if(t==s[r]){this.dataList[r]=e;break}}}copyDataFromProbe(t){this.types=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]);this.uniformSize=t.uniformsTotal}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.calcModels=null}}e.default=i},b409:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("b3bd")),a=i(s("0fc4")),n=s("839a");e.SpecularMode=n.SpecularMode;const l=s("319d");class h extends a.default{constructor(){super(),this.EX=null,this.EY=1,this.EZ=null,this.Ea=null,this.Eb=1,this.Ec=1,this.colorEnabled=!0,this.normalEnabled=!0,this.diffuseMap=null,this.diffuseMap2=null,this.normalMap=null,this.parallaxMap=null,this.aoMap=null,this.specularMap=null,this.specularMode=n.SpecularMode.Default,this.shadowReceiveEnabled=!1,this.lightEnabled=!0,this.fogEnabled=!1,this.vertColorEnabled=!1,this.envAmbientLightEnabled=!1,this.diffuseMap2Matrix=null,this.vertUniform=null,null==h.G_B&&(h.G_B=new l.AdvancedShaderCodeBuffer)}clone(){let t=new h;return t.initializeByCodeBuf(!1),t.copyFrom(this),t}copyFrom(t){this.z_=t.z_,this.colorEnabled=t.colorEnabled,this.lightEnabled=t.lightEnabled,this.shadowReceiveEnabled=t.shadowReceiveEnabled,this.fogEnabled=t.fogEnabled,this.normalEnabled=t.normalEnabled,this.vertColorEnabled=t.vertColorEnabled,this.envAmbientLightEnabled=t.envAmbientLightEnabled,this.vertUniform=t.vertUniform,this.diffuseMap2Matrix=t.diffuseMap2Matrix,null==this.diffuseMap&&(this.diffuseMap=t.diffuseMap),null==this.diffuseMap2&&(this.diffuseMap=t.diffuseMap2),null==this.normalMap&&(this.normalMap=t.normalMap),null==this.parallaxMap&&(this.parallaxMap=t.parallaxMap),null==this.aoMap&&(this.aoMap=t.aoMap),null==this.specularMap&&(this.specularMap=t.specularMap),this.specularMode=t.specularMode,this.Ea=t.Ea.slice();let e=2;null!=this.parallaxMap&&(this.EX=this.Ea.subarray(4*e,4*(e+1)),e+=1),this.lightEnabled&&(this.EZ=this.Ea.subarray(4*e)),this.Ec=t.Ec,this.EY=t.EY,this.Eb=t.Eb,this.AA=t.AA}buildTextureList(){let t=h.G_B;t.setIRenderTextureList([]),t.addDiffuseMap(this.diffuseMap),t.addDiffuseMap2(this.diffuseMap2),t.addNormalMap(this.normalMap),t.addParallaxMap(this.parallaxMap,this.EY),t.addAOMap(this.aoMap),t.addSpecularMap(this.specularMap);let e=t.getIRenderTextureList();return null!=this.vertUniform&&this.vertUniform.getTextures(t.getShaderCodeBuilder(),e),t.getTexturesFromPipeline(e),e}initializeLocalData(){if(null!=this.vertUniform&&this.vertUniform.initialize(),null==this.Ea){this.Eb=2,null!=this.parallaxMap&&(this.Eb+=1),this.lightEnabled&&(this.Eb+=3),this.Ea=new Float32Array(4*this.Eb),this.Ea.set([1,1,1,1,0,0,0,0]);let t=2;null!=this.parallaxMap&&(this.EX=this.Ea.subarray(4*t,4*(t+1)),this.EX.set([1,10,2,.1]),this.EY=t,t+=1),this.lightEnabled&&(this.Ec=t,this.EZ=this.Ea.subarray(4*t),this.EZ.set([.5,.5,.5,32,.7,.3,.3,.7,.01,.01,.01,0]))}}buildBuf(){null==this.Ea&&this.initializeLocalData();let t=h.G_B;t.lightEnabled=this.lightEnabled,t.shadowReceiveEnabled=this.shadowReceiveEnabled,t.fogEnabled=this.fogEnabled,t.envAmbientLightEnabled=this.envAmbientLightEnabled,t.buildPipelineParams(),t.colorEnabled=this.colorEnabled,t.vertColorEnabled=this.vertColorEnabled,t.lightParamsIndex=this.Ec,t.normalEnabled=this.normalEnabled,t.vertUniform=this.vertUniform,t.diffuseMap2Matrix=null!=this.diffuseMap2Matrix,t.fragLocalParamsTotal=this.Eb,t.buildFlag=""==this.AA;let e=this.buildTextureList();super.setTextureList(e),t.buildFlag=!1}getCodeBuf(){return h.G_B}setSpecularColor(t){null!=this.EZ&&(this.EZ[0]=t.r,this.EZ[1]=t.g,this.EZ[2]=t.b)}setSpecularIntensity(t){null!=this.EZ&&(this.EZ[3]=t)}setLightBlendFactor(t,e){null!=this.EZ&&(this.EZ[4]=t,this.EZ[5]=e)}setBlendFactor(t,e){null!=this.EZ&&(this.EZ[6]=t,this.EZ[7]=e)}setAmbientFactor(t,e,s){null!=this.EZ&&(this.EZ[8]=t,this.EZ[9]=e,this.EZ[10]=s)}setParallaxParams(t=1,e=10,s=2,i=.1){null!=this.EX&&(this.EX[0]=t,this.EX[1]=e,this.EX[2]=s,this.EX[3]=i)}setRGB3f(t,e,s){this.Ea[0]=t,this.Ea[1]=e,this.Ea[2]=s}setColor(t,e=null){null!=t&&(this.Ea[0]=t.r,this.Ea[1]=t.g,this.Ea[2]=t.b,this.Ea[3]=t.a),null!=e&&(this.Ea[4]=e.r,this.Ea[5]=e.g,this.Ea[6]=e.b,this.Ea[7]=e.a)}setColorAlpha(t){this.Ea[3]=t}createSelfUniformData(){let t=new r.default;return t.uniformNameList=["u_fragLocalParams"],t.dataList=[this.Ea],null!=this.vertUniform&&this.vertUniform.buildShaderUniformData(t),null!=this.diffuseMap2Matrix&&(t.uniformNameList.push("u_map2ViewMat"),t.dataList.push(this.diffuseMap2Matrix.getLocalFS32())),t}destroy(){super.destroy(),this.Ea=null,this.vertUniform=null,this.diffuseMap2Matrix=null,this.diffuseMap=null,this.diffuseMap2=null,this.normalMap=null,this.parallaxMap=null,this.aoMap=null,this.specularMap=null}}h.G_B=null,e.default=h,e.LambertLightMaterial=h},b498:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("18c7")),a=i(s("ab73")),n=i(s("7279")),l=i(s("3077")),h=s("5216"),o=s("c70f"),m=s("d846"),_=s("a9f4");class u{constructor(t=0){this.C_3=new o.GlobalVSMShadowUniformParam,this.C_4=null,this.C_5=null,this.Ed=null,this.A_l=null,this.Ee=null,this.Ef=null,this.Eg=-1,this.C_6=!1,this.C_7=0,this.C_7=t}setShadowMap(t){this.Ef=t}resetPipe(){}getTextures(t,e,s){return null!=this.Ef?(null==e&&(e=[]),e.push(this.Ef),t.uniform.addShadowMap(_.ShadowMode.VSM),e):null}useShaderPipe(t,e){null!=this.C_4&&(t.addDefine("VOX_USE_SHADOW","1"),t.addVarying("vec4","v_shadowPos"),this.C_3.use(t),t.addShaderObject(m.VSMShaderCode))}getPipeTypes(){return[h.MaterialPipeType.VSM_SHADOW]}getPipeKey(t){switch(t){case h.MaterialPipeType.VSM_SHADOW:return"["+t+"]";default:break}return""}initialize(){null==this.C_4&&(this.Ed=new r.default,this.Ee=new r.default,this.Ee.identity(),this.Ee.setScaleXYZ(.5,.5,.5),this.Ee.setTranslationXYZ(.5,.5,.5),this.A_l=new Float32Array([-5e-4,0,4,.8,512,512,.1,0,1,1,1,0]),this.C_4=new l.default,this.C_4.bindSlotAt(this.C_7),this.C_4.addMat4Data(this.Ed.getLocalFS32(),1),this.C_4.addVec4Data(this.A_l,a.default.ShadowVSMParams.arrayLength),this.C_5=this.C_3.createGlobalUinform(this.C_4),this.C_4.update())}getGlobalUinform(){return this.C_5.clone()}getGlobalUinformAt(t){let e=new n.default;return e.copyDataFromProbeAt(t,this.C_4),e}updateShadowCamera(t){this.Eg!=t.version&&(this.Eg=t.version,this.Ed.copyFrom(t.getVPMatrix()),this.Ed.append(this.Ee),this.setDirec(t.getNV()),this.C_6=!0)}setShadowParam(t,e,s){this.A_l[0]=t,this.A_l[1]=e,this.A_l[2]=s,this.C_6=!0}setShadowIntensity(t){this.A_l[3]=t,this.C_6=!0}setColorIntensity(t){this.A_l[6]=t,this.C_6=!0}setShadowRadius(t){this.A_l[2]=t,this.C_6=!0}setShadowBias(t){this.A_l[0]=t,this.C_6=!0}setShadowSize(t,e){this.A_l[4]=t,this.A_l[5]=e,this.C_6=!0}setDirec(t){this.A_l[8]=-t.x,this.A_l[9]=-t.y,this.A_l[10]=-t.z,this.C_6=!0}update(){this.C_6&&null!=this.C_4&&(this.C_6=!1,this.C_4.update())}destroy(){this.Ef=null}}e.default=u},b4ea:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=s("0714"),n=s("e753"),l=i(s("77cf")),h=i(s("e439")),o=i(s("6e01")),m=i(s("f63b")),_=s("8d98"),u=s("f3a2");e.ShaderCodeUUID=u.ShaderCodeUUID;const d=s("c052");e.ShaderCodeConfigure=d.ShaderCodeConfigure,e.ShaderCodeType=d.ShaderCodeType,e.IShaderLibConfigure=d.IShaderLibConfigure,e.IShaderLibListener=d.IShaderLibListener;class c{constructor(){this.pointLightsTotal=1,this.directionLightsTotal=1,this.spotLightsTotal=0,this.vsmFboIndex=0,this.vsmEnabled=!0,this.loadAllShaderCode=!1,this.shaderCodeBinary=!1,this.lambertMaterialEnabled=!0,this.pbrMaterialEnabled=!0,this.buildBinaryFile=!1}}e.MaterialContextParam=c;class f{constructor(){this.Eh=!0,this.Ei=null,this.A=null,this.lightModule=new n.LightModule,this.envData=new l.default,this.vsmModule=null,this.pipeline=null}addShaderLibListener(t){null!=f.ShaderLib&&f.ShaderLib.setListener(t)}getTextureLoader(){return this.Ei}isTextureLoadedAll(){return this.Ei.isLoadedAll()}getTextureByUrl(t,e=!0,s=!0){let i=null,r=t.slice(t.lastIndexOf(".")+1);switch(r=r.toLocaleLowerCase(),r){case"jpeg":case"jpg":case"png":case"gif":i=this.Ei.getImageTexByUrl(t),i.mipmapEnabled=s,e&&i.setWrap(_.TextureConst.WRAP_REPEAT);break;default:break}return i}createShaderLibConfig(){return{shaderCodeConfigures:[]}}initialize(t,e=null,s=null){if(this.Eh){this.Eh=!1,this.A=t,this.Ei=new m.default(this.A.textureBlock);let i=this;null==e&&(e=new c),this.D_G=e,f.ShaderLib.initialize(s,e.shaderCodeBinary),e.loadAllShaderCode&&f.ShaderLib.addAllShaderCodeObject(),e.pointLightsTotal=o.default.Clamp(e.pointLightsTotal,0,256),e.directionLightsTotal=o.default.Clamp(e.directionLightsTotal,0,256),e.spotLightsTotal=o.default.Clamp(e.spotLightsTotal,0,256);for(let t=0;t<e.pointLightsTotal;++t)this.lightModule.appendPointLight();for(let t=0;t<e.directionLightsTotal;++t)this.lightModule.appendDirectionLight();for(let t=0;t<e.spotLightsTotal;++t)this.lightModule.appendSpotLight();if(this.lightModule.update(),i.envData=new l.default,this.envData.initialize(),this.envData.setFogColorRGB3f(0,.8,.1),e.vsmEnabled&&(i.vsmModule=new h.default(e.vsmFboIndex),this.vsmModule.setCameraPosition(new r.default(1,800,1)),this.vsmModule.setCameraNear(10),this.vsmModule.setCameraFar(3e3),this.vsmModule.setMapSize(512,512),this.vsmModule.setCameraViewSize(4e3,4e3),this.vsmModule.setShadowRadius(2),this.vsmModule.setShadowBias(-5e-4),this.vsmModule.initialize(t,[0],3e3),this.vsmModule.setShadowIntensity(.8),this.vsmModule.setColorIntensity(.3)),i.pipeline=this.createPipeline(),this.initEnd(e),!e.loadAllShaderCode){let t=f.ShaderLib.getListener();null!=t&&t.shaderLibLoadComplete(0,0)}}}initEnd(t){}addShaderCodeObject(t,e){f.ShaderLib.addShaderCodeObject(t,e)}addPipeline(t){null!=t&&t!=this.pipeline&&(t.addPipe(this.lightModule),t.addPipe(this.envData),null!=this.vsmModule&&t.addPipe(this.vsmModule.getVSMData()))}createPipeline(){let t=new a.MaterialPipeline(f.ShaderLib);return t.addPipe(this.lightModule),t.addPipe(this.envData),null!=this.vsmModule&&t.addPipe(this.vsmModule.getVSMData()),t}run(){null!=this.vsmModule&&this.D_G.vsmEnabled&&this.vsmModule.run()}destroy(){this.A=null}}f.ShaderLib=new d.ShaderLib,e.MaterialContext=f},b88e:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("749c");document.title="Vox APP";let r=new i.DemoPBRTexViewer,a=r;if(void 0!=a.runBegin){function n(){function t(e){a.runBegin(),a.run(),a.runEnd(),window.requestAnimationFrame(t)}a.initialize(),window.requestAnimationFrame(t)}n()}else{function l(){function t(e){r.run(),window.requestAnimationFrame(t)}r.initialize(),window.requestAnimationFrame(t)}l()}},baae:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.FRAMEBUFFER=71,i.DRAW_FRAMEBUFFER=72,i.READ_FRAMEBUFFER=73,e.default=i},badb:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("1710")),a=i(s("ee5a"));class n{constructor(){this.Ej=null,this.Ek=18,this.uuid="",this.data=null,this.Ek=r.default.GetMouseEvtTypeValuesTotal(),this.Ej=new Array(this.Ek)}getClassType(){return r.default.EventClassType}destroy(){for(let t=0;t<this.Ek;++t)null!=this.Ej[t]&&this.Ej[t].destroy()}dispatchEvt(t){if(null!=t){""!=this.uuid&&(t.uuid=this.uuid),null!=this.data&&(t.data=this.data);let e=t.type-r.default.GetMouseEvtTypeValueBase();if(e>=0&&e<r.default.GetMouseEvtTypeValuesTotal()&&null!=this.Ej[e])return this.Ej[e].dispatch(t)}return 0}passTestEvt(t){if(null!=t){let e=t.type-r.default.GetMouseEvtTypeValueBase();if(e>=0&&e<r.default.GetMouseEvtTypeValuesTotal())return this.Ej[e].passTestEvt(t)}return 0}passTestPhase(t){let e=r.default.GetMouseEvtTypeValuesTotal();for(let s=0;s<e;++s)if(null!=this.Ej[s]&&1==this.Ej[s].passTestPhase(t))return 1;return 0}addEventListener(t,e,s,i=!0,n=!1){if(null!=s&&null!=e){let l=t-r.default.GetMouseEvtTypeValueBase();if(l>=0&&l<r.default.GetMouseEvtTypeValuesTotal()){let t=0;i!=n&&(t=i?1:2),null!=this.Ej[l]||(this.Ej[l]=new a.default),this.Ej[l].addListener(e,s,t)}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=t-r.default.GetMouseEvtTypeValueBase();i>=0&&i<r.default.GetMouseEvtTypeValuesTotal()&&null!=this.Ej[i]&&this.Ej[i].removeListener(e,s)}}}e.default=n},bbf4:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.CAMERA_VISIBLE_ENABLE=0,i.CAMERA_VISIBLE_DISABLE=1,e.default=i},bcac:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(){this.A_N=null,this.A_O=null,this.q_=0,this.r_=0,this.A_P=!1,this.El=0,this.Em=100,this.autoRotationEnabled=!1,this.autoRotationSpeed=.2,this.rotationAttenuationEnabled=!1,this.rotationSpeed=.2}initialize(t,e){null==this.A_N&&(this.A_N=t,this.A_O=e)}attach(){this.q_=this.A_N.mouseX,this.r_=this.A_N.mouseY,this.A_P=!0,this.Em=100}detach(){this.A_P=!1}runWithYAxis(){if(this.A_P){let t=this.q_-this.A_N.mouseX,e=this.r_-this.A_N.mouseY,s=Math.abs(t),i=Math.abs(e);s>i?(this.El=t*this.rotationSpeed,s>.5&&this.A_O.swingHorizontalWithAxis(this.El,r.default.Y_AXIS)):(this.El=0,i>.5&&this.A_O.swingVertical(-e*this.rotationSpeed)),this.q_=this.A_N.mouseX,this.r_=this.A_N.mouseY}else this.autoRotationEnabled&&(this.Em<0?this.A_O.swingHorizontalWithAxis(this.autoRotationSpeed,r.default.Y_AXIS):this.Em--)}runWithZAxis(){if(this.A_P){let t=this.q_-this.A_N.mouseX,e=this.r_-this.A_N.mouseY,s=Math.abs(t),i=Math.abs(e);s>i?s>.5&&this.A_O.swingHorizontalWithAxis(.2*t,r.default.Z_AXIS):i>.5&&this.A_O.swingVertical(-.2*e),this.q_=this.A_N.mouseX,this.r_=this.A_N.mouseY}else this.autoRotationEnabled&&(this.Em<0?this.A_O.swingHorizontalWithAxis(this.autoRotationSpeed,r.default.Z_AXIS):this.Em--)}}e.CameraDragSwinger=a},bd6f:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("29ef")),a=i(s("402a")),n=i(s("f63e")),l=i(s("a254")),h=i(s("76b0")),o=i(s("3930"));class m extends a.default{constructor(t=null){super(t),this.En=0,this.Eo=0,this.Ep=0,this.Eq=0,this.Er=0,this.Es=!1,this.color0=new o.default,this.color1=new o.default,this.color2=new o.default,this.color3=new o.default,this.C_2=!0,this.offsetU=0,this.offsetV=0,this.uScale=1,this.vScale=1,this.normalEnabled=!1,this.wireframe=!1,this.uvs=null,this.flipVerticalUV=!1,this.vertColorEnabled=!1,this.premultiplyAlpha=!1}setPolyhedral(t){this.C_2=t;let e=this.getMesh();null!=e&&e.setPolyhedral(t)}setScreenAlignEnable(t){this.Es=t}createMaterial(t){if(null==this.getMaterial())if(this.Es){let e=new l.default;e.setTextureList(t),this.setMaterial(e)}else{let e=new n.default;e.normalEnabled=this.normalEnabled,e.vertColorEnabled=this.vertColorEnabled,e.premultiplyAlpha=this.premultiplyAlpha,e.setTextureList(t),this.setMaterial(e)}else null!=t&&this.getMaterial().getTextureTotal()<1&&this.getMaterial().setTextureList(t)}showDoubleFace(t=!1,e=!0){t?e?this.setRenderState(r.default.NONE_CULLFACE_NORMAL_ALWAYS_STATE):this.setRenderState(r.default.BACK_NORMAL_ALWAYS_STATE):e?this.setRenderState(r.default.NONE_CULLFACE_NORMAL_STATE):this.setRenderState(r.default.NORMAL_STATE)}toTransparentBlend(t=!1,e=!1){t?e?this.setRenderState(r.default.NONE_TRANSPARENT_ALWAYS_STATE):this.setRenderState(r.default.BACK_TRANSPARENT_ALWAYS_STATE):e?this.setRenderState(r.default.NONE_TRANSPARENT_STATE):this.setRenderState(r.default.BACK_TRANSPARENT_STATE)}toBrightnessBlend(t=!1,e=!1){t?e?this.setRenderState(r.default.NONE_ADD_ALWAYS_STATE):this.setRenderState(r.default.BACK_ADD_ALWAYS_STATE):e?this.setRenderState(r.default.NONE_ADD_BLENDSORT_STATE):this.setRenderState(r.default.BACK_ADD_BLENDSORT_STATE)}initializeFixScreen(t=null){this.initializeXOY(-1,-1,2,2,t)}initializeXOY(t,e,s,i,r=null){this.En=t,this.Eo=e,this.Ep=s,this.Eq=i,this.Er=0,this.createMaterial(r),this.activeDisplay()}initializeXOYSquare(t,e=null){this.En=-.5*t,this.Eo=-.5*t,this.Ep=t,this.Eq=t,this.Er=0,this.createMaterial(e),this.activeDisplay()}initializeXOZ(t,e,s,i,r=null){this.Er=1,this.En=t,this.Eo=e,this.Ep=s,this.Eq=i,this.createMaterial(r),this.activeDisplay()}initializeYOZ(t,e,s,i,r=null){this.Er=2,this.En=t,this.Eo=e,this.Ep=s,this.Eq=i,this.createMaterial(r),this.activeDisplay()}initializeXOZSquare(t,e=null){this.Er=1,this.En=-.5*t,this.Eo=-.5*t,this.Ep=t,this.Eq=t,this.createMaterial(e),this.activeDisplay()}__activeMesh(t){if(null==this.getMesh()){let e=new h.default;e.color0.copyFrom(this.color0),e.color1.copyFrom(this.color1),e.color2.copyFrom(this.color2),e.color3.copyFrom(this.color3),e.setPolyhedral(this.C_2),e.setUVS(this.uvs),this.uvs=null,e.uScale=this.uScale,e.vScale=this.vScale,e.offsetU=this.offsetU,e.offsetV=this.offsetV,e.wireframe=this.wireframe,e.flipVerticalUV=this.flipVerticalUV,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.axisFlag=this.Er,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.En,this.Eo,this.Ep,this.Eq),this.setMesh(e)}}setUVS(t){let e=this.getMesh();null!=e&&e.setUVS(t)}reinitializeMesh(){let t=this.getMesh();null!=t&&t.reinitialize()}toString(){return"[Plane3DEntity]"}}e.default=m},c052:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("f3a2"),r=s("cc55"),a=s("69ed");e.ShaderCodeType=a.ShaderCodeType;const n=s("28a9");e.ShaderCodeConfigure=n.ShaderCodeConfigure;const l=s("a221");e.IShaderLibConfigure=l.IShaderLibConfigure;const h=s("ca2f");class o{constructor(){this.Et=new Map,this.Eu=[]}addConfigureWithUUID(t,e){""==t||this.Et.has(t)||(this.Et.set(t,e),this.Eu.push(t))}getConfigureWithUUID(t){return this.Et.get(t)}getUUIDList(){return this.Eu}getUUIDListLength(){return this.Eu.length}}class m{constructor(t){this.Ev=0,this.Ew=new r.ShaderCodeObject,this.Ex=null,this.Ex=t}decodeUint8Arr(t){return new TextDecoder("utf-8").decode(t)}encodeUint8Arr(t){return(new TextEncoder).encode(t)}loadedShdCode(t,e,s){if(this.Ev++,this.Ex.buildBinaryFile&&!this.Ex.binary){let s=this.encodeUint8Arr(t);for(let t=0;t<s.length;++t)s[t]=222-s[t];m.G_C.downloadBinFile(s,e+"","bin")}switch(e){case a.ShaderCodeType.VertHead:this.Ew.vert_head=t;break;case a.ShaderCodeType.VertBody:this.Ew.vert_body=t;break;case a.ShaderCodeType.FragHead:this.Ew.frag_head=t;break;case a.ShaderCodeType.FragBody:this.Ew.frag_body=t;break;default:break}this.Ev==this.Ex.types.length&&(s(this.Ex.uuid,this.Ew),this.Ew=null,this.Ex=null)}async loadBinCode(t,e,s){const i=new FileReader;i.onload=t=>{let r=new Uint8Array(i.result);for(let e=0;e<r.length;++e)r[e]=222-r[e];this.loadedShdCode(this.decodeUint8Arr(r),e,s)};const r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="blob",r.onload=t=>{r.status<=206&&i.readAsArrayBuffer(r.response)},r.onerror=t=>{},r.send()}loadTextCode(t,e,s){let i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=()=>{i.status<=206&&this.loadedShdCode(i.responseText,e,s)},i.onerror=t=>{},i.send()}loadCode(t,e,s){this.Ex.binary?this.loadBinCode(t,e,s):this.loadTextCode(t,e,s)}load(t){if(this.Ev=0,null==this.Ex.urls){let e=this.Ex.binary?".bin":".glsl";for(let s=0;s<this.Ex.types.length;++s){let i="static/shader/glsl/"+this.Ex.uuid+"/"+this.Ex.types[s]+e;this.loadCode(i,this.Ex.types[s],t)}}else for(let e=0;e<this.Ex.urls.length;++e){let s=this.Ex.urls[e];this.loadCode(s,this.Ex.types[e],t)}}}m.G_C=new h.FileIO;class _{constructor(){this.Ev=0,this.Ey=0,this.Ez=new Map,this.E0=new Map,this.E1=null,this.E2=null}setListener(t){this.E2=t}getListener(){return this.E2}initialize(t=null,e=!1){if(null==this.E1){let s;this.E1=new o;let r=null;if(null!=t&&(r=t.shaderCodeConfigures),null!=r)for(let t=0;t<r.length;++t)s=r[t],null!=s&&this.E1.addConfigureWithUUID(s.uuid,s);else s=new n.ShaderCodeConfigure,s.uuid=i.ShaderCodeUUID.PBR,s.types=[a.ShaderCodeType.VertHead,a.ShaderCodeType.VertBody,a.ShaderCodeType.FragHead,a.ShaderCodeType.FragBody],s.binary=e,this.E1.addConfigureWithUUID(s.uuid,s)}}addAllShaderCodeObject(){if(this.E1.getUUIDListLength()>0){let t=this.E1.getUUIDList();for(let e=0;e<t.length;++e)this.addShaderCodeObjectWithUUID(t[e])}else null!=this.E2&&this.E2.shaderLibLoadComplete(0,0)}addShaderCodeObjectWithUUID(t){if(!this.E0.has(t)&&!this.Ez.has(t)){this.Ev++;let e=new m(this.E1.getConfigureWithUUID(t));e.load((t,e)=>{this.E0.set(t,e),this.Ey++,null!=this.E2&&this.E2.shaderLibLoadComplete(this.Ev,this.Ey)})}}addShaderCodeObject(t,e){null==e||e.uuid!=""+t||this.E0.has(t)||this.E0.set(t,e)}getShaderCodeObjectWithUUID(t){let e=null;return this.E0.has(t)&&(e=this.E0.get(t)),e}}e.ShaderLib=_},c120:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(){this.entity=null,this.lpv=new r.default,this.wpv=new r.default,this.dis=0,this.flag=0}}e.default=a},c164:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}}i.BasePredefined="\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n",e.MathShaderCode=i;class r{constructor(){}}r.BasePredefined="\nvec4 localPosition = vec4(0.0,0.0,0.0,1.0);\nvec4 worldPosition = vec4(0.0,0.0,0.0,1.0);\n// view space position\nvec4 viewPosition = vec4(0.0,0.0,0.0,1.0);\nvec3 worldNormal = vec3(0.0, 0.0, 1.0);\n",r.FragPredefined="\n",r.FragDefined="\n",r.VertPredefined="\n// origin world position\nvec4 oWorldPosition = vec4(0.0,0.0,0.0,1.0);\n",r.VertDefined="\n",e.ShaderCode=r},c497:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(t=null){this.E3=8192,this.E4=null,this.E5={depth:!0,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:!1,preserveDrawingBuffer:!0,powerPreference:"high-performance"},this.E6=20,this.E7=!1,this.E8=!1,this.autoSyncRenderBufferAndWindowSize=!0,this.maxWebGLVersion=2,this.cameraPerspectiveEnabled=!0,this.evtFlowEnabled=!1,this.camProjParam=new r.default(45,10,5e3),this.camPosition=new r.default(2e3,2e3,2e3),this.camLookAtPos=new r.default(0,0,0),this.camUpDirect=new r.default(0,1,0),this.batchEnabled=!0,this.processFixedState=!1,this.E4=t,this.autoSyncRenderBufferAndWindowSize=null==t}setTickUpdateTime(t){t=Math.round(t),this.E6=t>5?t:5}getTickUpdateTime(){return this.E6}setPolygonOffsetEanbled(t){this.E7=t}getPolygonOffsetEanbled(){return this.E7}setDitherEanbled(t){this.E8=t}getDitherEanbled(){return this.E8}getDiv(){return this.E4}getRenderContextAttri(){return this.E5}setAttriDepth(t){this.E5.depth=t}setAttriStencil(t){this.E5.stencil=t}setAttriAlpha(t){this.E5.alpha=t}setAttriPremultipliedAlpha(t){this.E5.premultipliedAlpha=t}setAttriAntialias(t){this.E5.antialias=t}setAttripreserveDrawingBuffer(t){this.E5.preserveDrawingBuffer=t}setAttriHightPowerPreference(t){this.E5.powerPreference=t?"high-performance":"default"}setMatrix4AllocateSize(t){t<1024&&(t=1024),this.E3=t}getMatrix4AllocateSize(){return this.E3}setCamProject(t,e,s){if(e>=s)throw Error("Error Camera cear > far !!!");this.camProjParam.setTo(t,e,s)}setCamPosition(t,e,s){this.camPosition.setTo(t,e,s)}setCamLookAtPos(t,e,s){this.camLookAtPos.setTo(t,e,s)}setCamUpDirect(t,e,s){this.camUpDirect.setTo(t,e,s)}}e.default=a},c4ab:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("35fa")),a=i(s("8a0a")),n=i(s("e7d2")),l=i(s("fecb")),h=i(s("cb29")),o=s("4b10"),m=s("eec2");class _ extends h.default{constructor(t=a.default.VTX_STATIC_DRAW){super(t),this.B_o=null,this.B_U=null,this.B_p=null,this.E9=null,this.moduleScale=1,this.baseParsering=!1}getVS(){return this.B_o}getUVS(){return this.B_U}getNVS(){return this.B_p}initialize(t,e=!1){if(this.baseParsering)this.E9=new o.ObjStrDataParser,this.E9.parseStrData(t,this.moduleScale,e),this.B_o=new Float32Array(this.E9.getVS()),this.isVBufEnabledAt(a.default.VBUF_UVS_INDEX)&&(this.B_U=new Float32Array(this.E9.getUVS())),this.isVBufEnabledAt(a.default.VBUF_NVS_INDEX)&&(this.B_p=new Float32Array(this.E9.getNVS())),this.B_t=new Uint16Array(this.E9.getIVS());else{let s=new m.ObjDataParser,i=s.Parse(t),r=i.length,n=0;for(let t=0;t<r;++t)n+=i[t].geometry.vertices.length;let l=n/3,h=2*l;this.B_o=new Float32Array(n);let o=0;for(let t=0;t<r;++t)this.B_o.set(i[t].geometry.vertices,o),o+=i[t].geometry.vertices.length;if(this.isVBufEnabledAt(a.default.VBUF_UVS_INDEX)){this.B_U=new Float32Array(h),o=0;for(let t=0;t<r;++t)this.B_U.set(i[t].geometry.uvs,o),o+=i[t].geometry.uvs.length}if(this.isVBufEnabledAt(a.default.VBUF_NVS_INDEX)){this.B_p=new Float32Array(n),o=0;for(let t=0;t<r;++t)this.B_p.set(i[t].geometry.normals,o),o+=i[t].geometry.normals.length}this.B_t=l>65535?new Uint32Array(l):new Uint16Array(l);for(let t=0;t<l;++t)this.B_t[t]=t;if(e){let t,e,s,i=this.B_o;for(let r=0;r<l;++r)t=i[o],e=i[o+1],s=i[o+2],i[o]=e,i[o+1]=s,i[o+2]=t,o+=3}}if(this.bounds=new l.default,this.bounds.addXYZFloat32Arr(this.B_o),this.bounds.update(),this.vtxTotal=this.B_o.length/3,n.default.Reset(),n.default.AddFloat32Data(this.B_o,3),this.isVBufEnabledAt(a.default.VBUF_UVS_INDEX)&&n.default.AddFloat32Data(this.B_U,2),this.isVBufEnabledAt(a.default.VBUF_NVS_INDEX)&&n.default.AddFloat32Data(this.B_p,3),this.isVBufEnabledAt(a.default.VBUF_TVS_INDEX)){let t=this.B_t.length/3,e=new Float32Array(this.B_o.length),s=new Float32Array(this.B_o.length);r.default.ClacTrisTangent(this.B_o,this.B_o.length,this.B_U,this.B_p,t,this.B_t,e,s),n.default.AddFloat32Data(e,3),n.default.AddFloat32Data(s,3)}this.updateWireframeIvs(),n.default.vbWholeDataEnabled=this.vbWholeDataEnabled,null==this.B_u?(this.B_u=n.default.CreateBySaveData(this.getBufDataUsage()),this.B_u.setUintIVSData(this.B_t)):(this.forceUpdateIVS&&this.B_u.setUintIVSData(this.B_t),n.default.UpdateBufData(this.B_u)),this.vtCount=this.B_t.length,this.trisNumber=this.vtCount/3,this.buildEnd()}testRay(t,e,s,i){let r=l.default.IntersectionRL2(e,t,this.bounds,s);return r?1:-1}toString(){return"ObjData3DMesh()"}__$destroy(){this.isResFree()&&(this.bounds=null,this.B_o=null,this.B_U=null,this.B_p=null,super.__$destroy())}}e.default=_},c51d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("18c7")),l=i(s("e214")),h=i(s("fecb"));class o{constructor(){this.version=0,this.matUProbe=null,this.ufrustumProbe=null,this.uniformEnabled=!1,this.name="Camera",this.E_A=new a.default,this.E_B=new a.default,this.E_C=new a.default,this.E_D=new a.default,this.E_E=!0,this.E_F=new n.default,this.E_G=new n.default,this.E_H=new n.default,this.E_I=new n.default,this.E_J=new n.default,this.E_K=new n.default,this.E_L=new a.default,this.E_M=new a.default,this.E_N=new a.default,this.E_O=new a.default,this.E_P=new a.default,this.E_Q=1,this.E_R=1,this.J=0,this.K=0,this.L=800,this.M=600,this.E_S=400,this.E_T=300,this.E_U=0,this.E_V=1,this.E_W=.1,this.E_X=1e3,this.Bj=0,this.E_Y=0,this.E_Z=0,this.Bh=0,this.Cs=!1,this.E_a=!1,this.E_b=!0,this.C_T=new a.default(0,0,0),this.E_c=1,this.E_d=!0,this.E_e=!0,this.E_f=new a.default,this.E_g=new a.default,this.E_h=new a.default,this.E_i=new a.default,this.E_j=new a.default,this.E_k=0,this.E_l=new a.default,this.E_m=null,this.E_n=!1,this.E_o=new h.default,this.E_p=null,this.E_q=.5,this.E_r=.5,this.E_s=new a.default,this.E_t=new a.default,this.E_u=new a.default,this.E_v=[new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,null,null,null],this.E_w=[new l.default,new l.default,new l.default,new l.default,new l.default,new l.default],this.E_x=[new a.default,new a.default,new a.default,new a.default,new a.default,new a.default],this.E_y=[0,0,0,0,0,0],this.E_z=null}lock(){this.E_e=!1}unlock(){this.E_e=!0}lookAtLH(t,e,s){this.E_e&&(this.E_L.copyFrom(t),this.E_M.copyFrom(e),this.E_N.copyFrom(s),this.E_P.x=this.E_M.x-this.E_L.x,this.E_P.y=this.E_M.y-this.E_L.y,this.E_P.z=this.E_M.z-this.E_L.z,this.E_E=!1,this.E_O.copyFrom(this.E_P),this.E_O.normalize(),this.E_D.copyFrom(s),this.E_D.normalize(),a.default.Cross(this.E_P,this.E_N,this.E_C),this.E_C.normalize(),this.E_d=!0)}lookAtRH(t,e,s){this.E_e&&(this.E_L.copyFrom(t),this.E_M.copyFrom(e),this.E_P.x=this.E_M.x-this.E_L.x,this.E_P.y=this.E_M.y-this.E_L.y,this.E_P.z=this.E_M.z-this.E_L.z,this.E_E=!0,this.E_O.copyFrom(this.E_P),this.E_O.normalize(),a.default.Cross(this.E_P,s,this.E_C),a.default.Cross(this.E_C,this.E_P,this.E_D),this.E_D.normalize(),this.E_C.normalize(),this.E_N.copyFrom(this.E_D),this.E_d=!0)}getLookAtLHToCamera(t){t.lookAtLH(this.E_L,this.E_M,this.E_N)}getLookAtRHToCamera(t){t.lookAtRH(this.E_L,this.E_M,this.E_N)}perspectiveLH(t,e,s,i){this.E_e&&(this.E_a=!1,this.E_V=e,this.E_U=t,this.E_W=s,this.E_X=i,this.E_K.perspectiveLH(t,e,s,i),this.E_c=Math.tan(.5*t),this.Cs=!0,this.E_b=!1,this.E_d=!0)}perspectiveRH(t,e,s,i){this.E_e&&(this.E_V=e,this.E_U=t,this.E_W=s,this.E_X=i,this.E_K.perspectiveRH(t,e,s,i),this.E_c=Math.tan(.5*t),this.E_a=!1,this.Cs=!0,this.E_b=!0,this.E_d=!0)}perspectiveRH2(t,e,s,i,r){this.E_e&&(this.E_V=e/s,this.E_U=t,this.E_W=i,this.E_X=r,this.E_K.perspectiveRH2(t,e,s,i,r),this.E_c=Math.tan(.5*t),this.Cs=!0,this.E_a=!0,this.E_b=!0,this.E_d=!0)}getAspect(){return this.E_V}getViewFieldZoom(){return this.E_c}orthoRH(t,e,s,i,r,a){this.E_e&&(this.E_W=t,this.E_X=e,this.Bj=s,this.E_Y=i,this.E_Z=r,this.Bh=a,this.E_K.orthoRH(s,i,r,a,t,e),this.Cs=!1,this.E_b=!0,this.E_d=!0)}orthoLH(t,e,s,i,r,a){this.E_e&&(this.E_W=t,this.E_X=e,this.Bj=s,this.E_Y=i,this.E_Z=r,this.Bh=a,this.E_K.orthoLH(s,i,r,a,t,e),this.Cs=!1,this.E_b=!1,this.E_d=!0)}isPerspectiveEnabled(){return this.Cs}isRightHandEnabled(){return this.E_b}setViewXY(t,e){this.E_e&&(this.J=t,this.K=e)}setViewSize(t,e){this.E_e&&(t==this.L&&e==this.M||(this.L=t,this.M=e,this.E_S=.5*t,this.E_T=.5*e,this.Cs?this.E_a?this.E_b&&this.perspectiveRH2(this.E_U,t,e,this.E_W,this.E_X):this.E_b?this.perspectiveRH(this.E_U,t/e,this.E_W,this.E_X):this.perspectiveLH(this.E_U,t/e,this.E_W,this.E_X):this.orthoRH(this.E_W,this.E_X,-.5*e,.5*e,-.5*t,.5*t)))}getViewX(){return this.J}getViewY(){return this.K}getViewWidth(){return this.L}getViewHeight(){return this.M}translation(t){this.E_e&&(this.E_L.copyFrom(t),this.E_M.x=t.x+this.E_P.x,this.E_M.y=t.y+this.E_P.y,this.E_M.z=t.z+this.E_P.z,this.E_d=!0)}translationXYZ(t,e,s){this.E_A.setXYZ(t,e,s),this.E_e&&a.default.DistanceSquared(this.E_L,this.E_A)>1e-5&&(this.E_L.setTo(t,e,s),this.E_M.x=t+this.E_P.x,this.E_M.y=e+this.E_P.y,this.E_M.z=s+this.E_P.z,this.E_d=!0)}forward(t){this.E_e&&(this.E_L.x+=this.E_O.x*t,this.E_L.y+=this.E_O.y*t,this.E_L.z+=this.E_O.z*t,this.E_M.x=this.E_L.x+this.E_P.x,this.E_M.y=this.E_L.y+this.E_P.y,this.E_M.z=this.E_L.z+this.E_P.z,this.E_d=!0)}slideViewOffsetXY(t,e){if(this.E_e){this.E_A.setXYZ(t,e,0),this.E_p.transformVectorSelf(this.E_A),t=this.E_A.x-this.E_L.x,e=this.E_A.y-this.E_L.y;let s=this.E_A.z-this.E_L.z;this.E_L.x+=t,this.E_L.y+=e,this.E_L.z+=s,this.E_M.x+=t,this.E_M.y+=e,this.E_M.z+=s,this.E_d=!0}}forwardFixPos(t,e){this.E_e&&(this.E_L.x=e.x+this.E_O.x*t,this.E_L.y=e.y+this.E_O.y*t,this.E_L.z=e.z+this.E_O.z*t,this.E_M.x=this.E_L.x+this.E_P.x,this.E_M.y=this.E_L.y+this.E_P.y,this.E_M.z=this.E_L.z+this.E_P.z,this.E_d=!0)}swingHorizontalWithAxis(t,e){this.E_e&&(this.E_J.identity(),null!=e?this.E_J.appendRotation(t*r.default.MATH_PI_OVER_180,e):this.E_J.appendRotation(t*r.default.MATH_PI_OVER_180,a.default.Y_AXIS),this.E_P.x=this.E_L.x-this.E_M.x,this.E_P.y=this.E_L.y-this.E_M.y,this.E_P.z=this.E_L.z-this.E_M.z,this.E_J.transformVectorSelf(this.E_P),this.E_L.x=this.E_P.x+this.E_M.x,this.E_L.y=this.E_P.y+this.E_M.y,this.E_L.z=this.E_P.z+this.E_M.z,this.E_P.x=this.E_M.x-this.E_L.x,this.E_P.y=this.E_M.y-this.E_L.y,this.E_P.z=this.E_M.z-this.E_L.z,this.E_E=!0,this.E_O.copyFrom(this.E_P),this.E_O.normalize(),this.E_J.transformVectorSelf(this.E_C),this.E_C.normalize(),a.default.Cross(this.E_C,this.E_P,this.E_N),this.E_N.normalize(),this.E_d=!0)}swingHorizontal(t){this.E_e&&(this.E_J.identity(),this.E_J.appendRotation(t*r.default.MATH_PI_OVER_180,this.E_N),this.E_P.x=this.E_L.x-this.E_M.x,this.E_P.y=this.E_L.y-this.E_M.y,this.E_P.z=this.E_L.z-this.E_M.z,this.E_J.transformVectorSelf(this.E_P),this.E_L.x=this.E_P.x+this.E_M.x,this.E_L.y=this.E_P.y+this.E_M.y,this.E_L.z=this.E_P.z+this.E_M.z,this.E_P.x=this.E_M.x-this.E_L.x,this.E_P.y=this.E_M.y-this.E_L.y,this.E_P.z=this.E_M.z-this.E_L.z,this.E_E=!0,this.E_O.copyFrom(this.E_P),this.E_O.normalize(),a.default.Cross(this.E_P,this.E_N,this.E_C),this.E_C.normalize(),this.E_d=!0)}swingVertical(t){this.E_e&&(this.E_J.identity(),this.E_J.appendRotation(t*r.default.MATH_PI_OVER_180,this.E_C),this.E_P.x=this.E_L.x-this.E_M.x,this.E_P.y=this.E_L.y-this.E_M.y,this.E_P.z=this.E_L.z-this.E_M.z,this.E_J.transformVectorSelf(this.E_P),this.E_L.x=this.E_P.x+this.E_M.x,this.E_L.y=this.E_P.y+this.E_M.y,this.E_L.z=this.E_P.z+this.E_M.z,this.E_P.x=this.E_M.x-this.E_L.x,this.E_P.y=this.E_M.y-this.E_L.y,this.E_P.z=this.E_M.z-this.E_L.z,this.E_E=!0,this.E_O.copyFrom(this.E_P),this.E_O.normalize(),a.default.Cross(this.E_C,this.E_P,this.E_N),this.E_N.normalize(),this.E_D.copyFrom(this.E_N),this.E_d=!0)}setPosition(t){if(this.E_e){a.default.Cross(this.E_P,this.E_N,this.E_A);let e=this.E_A.dot(this.E_D);this.E_B.copyFrom(this.E_D),this.E_B.scaleBy(e),this.E_A.subtractBy(this.E_B),this.E_L.copyFrom(t),this.E_P.x=this.E_M.x-this.E_L.x,this.E_P.y=this.E_M.y-this.E_L.y,this.E_P.z=this.E_M.z-this.E_L.z,this.E_O.copyFrom(this.E_P),this.E_O.normalize(),a.default.Cross(this.E_A,this.E_P,this.E_N),this.E_N.normalize(),this.E_d=!0}}setPositionXYZ(t,e,s){if(this.E_e){a.default.Cross(this.E_P,this.E_N,this.E_A);var i=this.E_A.dot(this.E_D);this.E_B.copyFrom(this.E_D),this.E_B.scaleBy(i),this.E_A.subtractBy(this.E_B),this.E_L.setTo(t,e,s),this.E_P.x=this.E_M.x-this.E_L.x,this.E_P.y=this.E_M.y-this.E_L.y,this.E_P.z=this.E_M.z-this.E_L.z,this.E_O.copyFrom(this.E_P),this.E_O.normalize(),a.default.Cross(this.E_A,this.E_P,this.E_N),this.E_N.normalize(),this.E_d=!0}}setLookPosXYZFixUp(t,e,s){this.E_e&&(this.E_M.setTo(t,e,s),this.E_P.x=this.E_M.x-this.E_L.x,this.E_P.y=this.E_M.y-this.E_L.y,this.E_P.z=this.E_M.z-this.E_L.z,this.E_E=!0,this.E_O.copyFrom(this.E_P),this.E_O.normalize(),a.default.Cross(this.E_P,this.E_N,this.E_C),this.E_C.normalize(),this.E_d=!0)}setPositionXYZFixUp(t,e,s){this.E_e&&(this.E_L.setTo(t,e,s),this.E_P.x=this.E_M.x-this.E_L.x,this.E_P.y=this.E_M.y-this.E_L.y,this.E_P.z=this.E_M.z-this.E_L.z,this.E_E=!0,this.E_O.copyFrom(this.E_P),this.E_O.normalize(),a.default.Cross(this.E_P,this.E_N,this.E_C),this.E_C.normalize(),this.E_d=!0)}setPositionFixUp(t){this.E_e&&(this.E_L.copyFrom(t),this.E_P.x=this.E_M.x-this.E_L.x,this.E_P.y=this.E_M.y-this.E_L.y,this.E_P.z=this.E_M.z-this.E_L.z,this.E_E=!0,this.E_O.copyFrom(this.E_P),this.E_O.normalize(),a.default.Cross(this.E_P,this.E_N,this.E_C),this.E_C.normalize(),this.E_d=!0)}copyFrom(t){let e=t.getPosition();this.E_L.copyFrom(e),e=t.getLookAtPosition(),this.E_M.copyFrom(e),this.setZNear(t.getZNear()),this.setZFar(t.getZFar()),this.setNearPlaneWidth(t.getNearPlaneWidth()),this.setNearPlaneHeight(t.getNearPlaneHeight()),this.setPerspectiveEnabled(t.getPerspectiveEnabled()),this.E_H.copyFrom(t.getViewInvMatrix())}getNV(){return this.E_f.copyFrom(this.E_O),this.E_f}getUV(){return this.E_g.copyFrom(this.E_N),this.E_g}getRV(){return this.E_h.copyFrom(this.E_C),this.E_h}getPosition(){return this.E_i.copyFrom(this.E_L),this.E_i}getLookAtPosition(){return this.E_j.copyFrom(this.E_M),this.E_j}setLookAtPosition(t){this.E_e&&(this.E_M.copyFrom(t),this.E_P.x=this.E_M.x-this.E_L.x,this.E_P.y=this.E_M.y-this.E_L.y,this.E_P.z=this.E_M.z-this.E_L.z,this.E_O.copyFrom(this.E_P),this.E_O.normalize(),this.E_d=!0)}setLookAtXYZ(t,e,s){this.E_e&&(this.E_M.setTo(t,e,s),this.E_P.x=this.E_M.x-this.E_L.x,this.E_P.y=this.E_M.y-this.E_L.y,this.E_P.z=this.E_M.z-this.E_L.z,this.E_O.copyFrom(this.E_P),this.E_O.normalize(),this.E_d=!0)}getPerspectiveEnabled(){return this.Cs}setPerspectiveEnabled(t){this.Cs=t}appendRotationByAxis(t,e,s=null){this.E_e&&(this.E_k=t,this.E_d=!0,this.E_l.copyFrom(e),this.E_m=s,this.E_n=!0)}setRotationX(t){this.C_T.x=t,this.E_d=!0,this.E_n=!1}getRotationX(){return this.C_T.x}setRotationY(t){this.C_T.y=t,this.E_d=!0,this.E_n=!1}getRotationY(){return this.C_T.y}setRotationZ(t){this.C_T.z=t,this.E_d=!0,this.E_n=!1}getRotationZ(){return this.C_T.z}setRotationXYZ(t,e,s){this.E_e&&(this.C_T.setXYZ(t,e,s),this.E_d=!0,this.E_n=!1)}screenXYToViewXYZ(t,e,s){t-=this.J,e-=this.K,this.Cs&&(t=this.E_Q*(t-this.E_S)/this.E_S,e=this.E_R*(this.E_T-e)/this.E_T),s.setTo(t,e,-this.E_W)}screenXYToWorldXYZ(t,e,s){t-=this.J,e-=this.K,this.Cs&&(t=.5*this.E_Q*(t-this.E_S)/this.E_S,e=.5*this.E_R*(this.E_T-e)/this.E_T),s.setTo(t,e,-this.E_W),s.w=1,this.E_H.transformVectorSelf(s)}getWorldPickingRayByScreenXY(t,e,s,i){t-=this.J,e-=this.K,this.Cs?(t=.5*this.E_Q*(t-this.E_S)/this.E_S,e=.5*this.E_R*(e-this.E_T)/this.E_T,s.setTo(t,e,-this.E_W),s.w=1,this.E_H.transformVectorSelf(s),i.copyFrom(s),i.subtractBy(this.E_L),i.normalize()):(t-=this.E_S,e-=this.E_T,s.setTo(t,e,-this.E_W),s.w=1,this.E_H.transformVectorSelf(s),i.copyFrom(this.E_O))}calcScreenNormalizeXYByWorldPos(t,e){e.copyFrom(t),this.E_I.transformVectorSelf(e),e.x/=e.w,e.y/=e.w}worldPosToScreen(t){this.E_G.transformVector3Self(t),this.E_K.transformVectorSelf(t),t.x/=t.w,t.y/=t.w,t.x*=this.E_S,t.y*=this.E_T,t.x+=this.J,t.y+=this.K}calcViewRectByWorldSphere(t,e,s){this.E_G.transformVector3Self(t),e*=1.15,s.x=t.x-e,s.y=t.y-e,s.z=t.z,t.x+=e,t.y+=e,this.E_K.transformPerspV4Self(s),this.E_K.transformPerspV4Self(t),t.z=1/t.w,s.z=t.x*t.z,s.w=t.y*t.z,s.z*=this.E_S,s.w*=this.E_T,s.x*=t.z,s.y*=t.z,s.x*=this.E_S,s.y*=this.E_T,s.z=s.z-s.x,s.w=s.w-s.y,s.x+=this.J,s.y+=this.K}calcScreenRectByWorldSphere(t,e,s){this.E_G.transformVector3Self(t),e*=1.15,s.x=t.x-e,s.y=t.y-e,t.x+=e,t.y+=e,this.E_K.transformPerspV4Self(s),this.E_K.transformPerspV4Self(t),t.z=1/t.w,s.z=t.x*t.z,s.w=t.y*t.z,s.x*=t.z,s.y*=t.z,s.z=s.z-s.x,s.w=s.w-s.y}getInvertViewMatrix(){return this.E_p}getZNear(){return this.E_W}setZNear(t){this.E_W=t}getZFar(){return this.E_X}setZFar(t){this.E_X=t}getNearPlaneWidth(){return this.E_Q}setNearPlaneWidth(t){this.E_Q=t}getNearPlaneHeight(){return this.E_R}setNearPlaneHeight(t){this.E_R=t}getFov(){return this.E_U}__calcTestParam(){null==this.E_p&&(this.E_p=new n.default),this.E_p.copyFrom(this.E_G),this.E_p.invert();let t=null,e=this.E_T,s=this.E_S,i=this.E_T,r=this.E_S;if(this.Cs){let t=Math.tan(.5*this.E_U);e=this.E_W*t,s=e*this.E_V,i=this.E_X*t,r=i*this.E_V}this.E_q=s,this.E_r=e,this.E_s.setTo(0,0,-this.E_W),this.E_t.setTo(0,0,-this.E_X),this.E_p.transformVectorSelf(this.E_s),this.E_p.transformVectorSelf(this.E_t),this.E_u.x=this.E_t.x-this.E_s.x,this.E_u.y=this.E_t.y-this.E_s.y,this.E_u.z=this.E_t.z-this.E_s.z,this.E_u.normalize(),t=this.E_w[0],t.nv.copyFrom(this.E_u),t.distance=t.nv.dot(this.E_t),t.position.copyFrom(this.E_t),t=this.E_w[1],t.nv.copyFrom(this.E_w[0].nv),t.distance=t.nv.dot(this.E_s),t.position.copyFrom(this.E_s),this.E_v[8]=this.E_s,this.E_v[9]=this.E_t,this.E_v[11]=this.E_u,this.E_v[0].setTo(-r,-i,-this.E_X),this.E_v[1].setTo(r,-i,-this.E_X),this.E_v[2].setTo(r,i,-this.E_X),this.E_v[3].setTo(-r,i,-this.E_X),this.E_v[4].setTo(-s,-e,-this.E_W),this.E_v[5].setTo(s,-e,-this.E_W),this.E_v[6].setTo(s,e,-this.E_W),this.E_v[7].setTo(-s,e,-this.E_W),this.E_p.transformVectorSelf(this.E_v[0]),this.E_p.transformVectorSelf(this.E_v[1]),this.E_p.transformVectorSelf(this.E_v[2]),this.E_p.transformVectorSelf(this.E_v[3]),this.E_p.transformVectorSelf(this.E_v[4]),this.E_p.transformVectorSelf(this.E_v[5]),this.E_p.transformVectorSelf(this.E_v[6]),this.E_p.transformVectorSelf(this.E_v[7]),this.E_o.max.setTo(-9999999,-9999999,-9999999),this.E_o.min.setTo(9999999,9999999,9999999);for(let a=0;a<8;++a)this.E_o.addPosition(this.E_v[a]);this.E_o.updateFast();let l=this.E_v[0],h=this.E_v[4];this.E_A.x=l.x-h.x,this.E_A.y=l.y-h.y,this.E_A.z=l.z-h.z,l=this.E_v[1],h=this.E_v[5],this.E_B.x=l.x-h.x,this.E_B.y=l.y-h.y,this.E_B.z=l.z-h.z,t=this.E_w[3],a.default.Cross(this.E_B,this.E_A,t.nv),t.nv.normalize(),t.distance=t.nv.dot(l),t.position.copyFrom(l),l=this.E_v[3],h=this.E_v[7],this.E_A.x=l.x-h.x,this.E_A.y=l.y-h.y,this.E_A.z=l.z-h.z,l=this.E_v[2],h=this.E_v[6],this.E_B.x=l.x-h.x,this.E_B.y=l.y-h.y,this.E_B.z=l.z-h.z,t=this.E_w[2],a.default.Cross(this.E_B,this.E_A,t.nv),t.nv.normalize(),t.distance=t.nv.dot(l),t.position.copyFrom(l),l=this.E_v[0],h=this.E_v[4],this.E_A.x=l.x-h.x,this.E_A.y=l.y-h.y,this.E_A.z=l.z-h.z,l=this.E_v[3],h=this.E_v[7],this.E_B.x=l.x-h.x,this.E_B.y=l.y-h.y,this.E_B.z=l.z-h.z,t=this.E_w[4],a.default.Cross(this.E_A,this.E_B,t.nv),t.nv.normalize(),t.distance=t.nv.dot(l),t.position.copyFrom(l),l=this.E_v[1],h=this.E_v[5],this.E_A.x=l.x-h.x,this.E_A.y=l.y-h.y,this.E_A.z=l.z-h.z,l=this.E_v[2],h=this.E_v[6],this.E_B.x=l.x-h.x,this.E_B.y=l.y-h.y,this.E_B.z=l.z-h.z,t=this.E_w[5],a.default.Cross(this.E_A,this.E_B,t.nv),t.nv.normalize(),t.distance=t.nv.dot(l),t.position.copyFrom(l),this.E_x[0].copyFrom(this.E_w[0].nv),this.E_x[1].copyFrom(this.E_w[1].nv),this.E_x[1].scaleBy(-1),this.E_x[2].copyFrom(this.E_w[2].nv),this.E_x[3].copyFrom(this.E_w[3].nv),this.E_x[3].scaleBy(-1),this.E_x[4].copyFrom(this.E_w[4].nv),this.E_x[4].scaleBy(-1),this.E_x[5].copyFrom(this.E_w[5].nv),this.E_y[0]=this.E_w[0].distance,this.E_y[1]=-this.E_w[1].distance,this.E_y[2]=this.E_w[2].distance,this.E_y[3]=-this.E_w[3].distance,this.E_y[4]=-this.E_w[4].distance,this.E_y[5]=this.E_w[5].distance}getWordFrustumWAABB(){return this.E_o}getWordFrustumWAABBCenter(){return this.E_o.center}getWordFrustumVtxArr(){return this.E_v}getWordFrustumPlaneArr(){return this.E_w}visiTestSphere2(t,e){let s=this.E_x[0].dot(t)-this.E_y[0]-e>r.default.MATH_MIN_POSITIVE;return!s&&(s=this.E_x[1].dot(t)-this.E_y[1]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.E_x[2].dot(t)-this.E_y[2]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.E_x[3].dot(t)-this.E_y[3]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.E_x[4].dot(t)-this.E_y[4]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.E_x[5].dot(t)-this.E_y[5]-e>r.default.MATH_MIN_POSITIVE,!s)))))}visiTestSphere3(t,e,s){let i=this.E_x[0].dot(t)-this.E_y[0]+s-e>r.default.MATH_MIN_POSITIVE;return!i&&(i=this.E_x[1].dot(t)-this.E_y[1]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.E_x[2].dot(t)-this.E_y[2]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.E_x[3].dot(t)-this.E_y[3]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.E_x[4].dot(t)-this.E_y[4]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.E_x[5].dot(t)-this.E_y[5]-e>r.default.MATH_MIN_POSITIVE,!i)))))}visiTestPosition(t){let e=this.E_x[0].dot(t)-this.E_y[0]>r.default.MATH_MIN_POSITIVE;return!e&&(e=this.E_x[1].dot(t)-this.E_y[1]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.E_x[2].dot(t)-this.E_y[2]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.E_x[3].dot(t)-this.E_y[3]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.E_x[4].dot(t)-this.E_y[4]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.E_x[5].dot(t)-this.E_y[5]>r.default.MATH_MIN_POSITIVE,!e)))))}visiTestPlane(t,e){let s=t.dot(this.E_w[0].position)-e,i=s*(t.dot(this.E_w[1].position)-e);return i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.E_w[2].position)-e),i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.E_w[3].position)-e),i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.E_w[4].position)-e),i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.E_w[5].position)-e),i<r.default.MATH_MIN_POSITIVE))))}visiTestSphere(t,e){let s=this.E_o.sphereIntersect(t,e);if(s){let s=this.E_w[0].intersectSphere(t,e),i=this.E_w[1].intersectSphere(t,e);return!(s*i>=0&&!this.E_w[0].intersectBoo&&!this.E_w[1].intersectBoo)&&(s=this.E_w[2].intersectSphere(t,e),i=this.E_w[3].intersectSphere(t,e),!(s*i>=0&&!this.E_w[2].intersectBoo&&!this.E_w[3].intersectBoo)&&(s=this.E_w[4].intersectSphere(t,e),i=this.E_w[5].intersectSphere(t,e),!(s*i>=0&&!this.E_w[4].intersectBoo&&!this.E_w[5].intersectBoo)))}return!1}visiTestAABB(t){let e=t.center,s=t.radius,i=this.E_o.sphereIntersect(e,s);if(i){let t=this.E_w[0].intersectSphere(e,s),i=this.E_w[1].intersectSphere(e,s);return!(t*i>=0&&!this.E_w[0].intersectBoo&&!this.E_w[1].intersectBoo)&&(t=this.E_w[2].intersectSphere(e,s),i=this.E_w[3].intersectSphere(e,s),!(t*i>=0&&!this.E_w[2].intersectBoo&&!this.E_w[3].intersectBoo)&&(t=this.E_w[4].intersectSphere(e,s),i=this.E_w[5].intersectSphere(e,s),!(t*i>=0&&!this.E_w[4].intersectBoo&&!this.E_w[5].intersectBoo)))}return!1}setViewMatrix(t){this.E_z=t,this.E_d=!0}update(){this.E_d&&(this.version++,this.E_d=!1,null==this.E_z?(this.E_n?this.E_F.appendRotationPivot(this.E_k*r.default.MATH_PI_OVER_180,this.E_l,this.E_m):(this.E_F.identity(),this.E_F.appendRotationEulerAngle(this.C_T.x*r.default.MATH_PI_OVER_180,this.C_T.y*r.default.MATH_PI_OVER_180,this.C_T.z*r.default.MATH_PI_OVER_180)),this.E_E?this.E_G.lookAtRH(this.E_L,this.E_M,this.E_N):this.E_G.lookAtLH(this.E_L,this.E_M,this.E_N),this.E_G.append(this.E_F)):this.E_G.copyFrom(this.E_z),this.E_a?(this.E_Q=this.E_W*Math.tan(.5*this.E_U)*2,this.E_R=this.E_Q/this.E_V):(this.E_R=this.E_W*Math.tan(.5*this.E_U)*2,this.E_Q=this.E_V*this.E_R),this.E_H.copyFrom(this.E_G),this.E_H.invert(),this.E_I.identity(),this.E_I.copyFrom(this.E_G),this.E_I.append(this.E_K),this.__calcTestParam(),this.updateUniformData())}updateCamMatToUProbe(t){t.isEnabled()&&(t.update(),t.getFS32At(0).set(this.E_G.getLocalFS32(),0),t.getFS32At(1).set(this.E_K.getLocalFS32(),0))}updateUniformData(){this.uniformEnabled&&(this.updateCamMatToUProbe(this.matUProbe),this.ufrustumProbe.setVec4DataAt(0,this.E_W,this.E_X,this.E_q,this.E_r),this.ufrustumProbe.update(),this.ucameraPosProbe.setVec4DataAt(0,this.E_L.x,this.E_L.y,this.E_L.z,1),this.ucameraPosProbe.update())}destroy(){}lookRHEnabled(){return this.E_E}lookLHEnabled(){return!this.E_E}getVPMatrix(){return this.E_I}getViewMatrix(){return this.E_G}getViewInvMatrix(){return this.E_H}getProjectMatrix(){return this.E_K}}e.default=o},c62b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("e08e"),a=s("7c63"),n=i(s("29ef"));class l{constructor(){this.uid=-1,this.value=-1,this.__$rpuid=-1,this.__$rprouid=-1,this.shader=null,this.pos=null,this.bounds=null,this.ibufType=0,this.ibufStep=2,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.drawOffset=0,this.partTotal=0,this.partGroup=null,this.trisNumber=0,this.visible=!0,this.drawEnabled=!0,this.drawMode=0,this.renderState=0,this.rcolorMask=0,this.drawFlag=0,this.vro=null,this.transUniform=null,this.uniform=null,this.shdUid=-1,this.vtxUid=-1,this.tro=null,this.texMid=-1,this.ubo=null,this.polygonOffset=null}testDrawFlag(){this.shader.drawFlag!=this.drawFlag&&(this.shader.drawFlag=this.drawFlag,a.RenderStateObject.UseRenderState(this.renderState),a.RenderColorMask.UseRenderState(this.rcolorMask))}getUid(){return this.uid}getRPOUid(){return this.__$rpuid}getRPROUid(){return this.__$rprouid}getShaderUid(){return this.shdUid}setIvsParam(t,e){this.ivsIndex=t,this.ivsCount=e,this.drawOffset=t*this.ibufStep,this.drawEnabled=this.visible&&this.ivsCount>0}setVisible(t){this.visible=t,this.drawEnabled=t&&this.ivsCount>0}setDrawFlag(t,e){this.renderState=t,this.rcolorMask=e,this.drawFlag=(e<<10)+t}drawThis(t){++n.default.DrawCallTimes,n.default.DrawTrisNumber+=this.trisNumber;let e=this.indicesRes.getVTCount();switch(this.ivsCount<=e&&(e=this.ivsCount),null!=this.polygonOffset?t.setPolygonOffset(this.polygonOffset[0],this.polygonOffset[1]):t.resetPolygonOffset(),this.drawMode){case r.RenderDrawMode.ELEMENTS_TRIANGLES:t.RContext.drawElements(t.TRIANGLES,e,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_LINES:t.RContext.drawElements(t.LINES,e,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:t.RContext.drawElements(t.TRIANGLE_STRIP,e,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:t.RContext.drawElementsInstanced(t.TRIANGLES,e,this.ibufType,this.drawOffset,this.insCount);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:t.RContext.drawElements(t.TRIANGLE_FAN,e,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ARRAYS_LINES:t.RContext.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case r.RenderDrawMode.ARRAYS_LINE_STRIP:t.RContext.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}drawPart(t){++n.default.DrawCallTimes,n.default.DrawTrisNumber+=this.trisNumber;let e=this.indicesRes.getVTCount();this.ivsCount<=e&&(e=this.ivsCount),null!=this.polygonOffset?t.setPolygonOffset(this.polygonOffset[0],this.polygonOffset[1]):t.resetPolygonOffset();let s=0,i=t.RContext;switch(this.drawMode){case r.RenderDrawMode.ELEMENTS_TRIANGLES:for(;s<this.partTotal;)i.drawElements(t.TRIANGLES,this.partGroup[s++],this.ibufType,this.partGroup[s++]);break;case r.RenderDrawMode.ELEMENTS_LINES:for(;s<this.partTotal;)i.drawElements(t.LINES,this.partGroup[s++],this.ibufType,this.partGroup[s++]);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:i.drawElements(t.TRIANGLE_STRIP,this.ivsCount,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:i.drawElementsInstanced(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset,this.insCount);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:i.drawElements(t.TRIANGLE_FAN,this.ivsCount,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ARRAYS_LINES:i.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case r.RenderDrawMode.ARRAYS_LINE_STRIP:i.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}run2(t){null!=this.ubo&&this.ubo.run(t),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}run(t){null!=this.ubo&&this.ubo.run(t),this.vro.run(),this.tro.run(),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}runLockMaterial2(t){this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(null==t?this.uniform:t,this.transUniform)}runLockMaterial(){this.vro.run(),this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(this.uniform,this.transUniform)}reset(){this.indicesRes=null,this.polygonOffset=null,this.vro.__$detachThis(),this.vro=null,this.tro.__$detachThis(),this.tro=null,this.texMid=-1,this.__$rprouid=-1,this.ubo=null,this.shdUid=-1,this.vtxUid=-1,this.uniform=null,this.transUniform=null,this.partGroup=null,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.partTotal=0,this.drawMode=0,this.drawFlag=0,this.renderState=0,this.rcolorMask=0,this.drawEnabled=!0,this.shader=null,this.bounds=null,this.pos=null}destroy(){this.reset()}toString(){return"[RPOUnit(uid = "+this.uid+")]"}}e.default=l},c70f:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279"));class n{constructor(){}geNames(){return[]}createGlobalUinform(t){let e=new a.default;return e.uniformNameList=this.geNames(),e.copyDataFromProbe(t),t.update(),e}}class l extends n{constructor(){super()}geNames(){return[r.default.EnvLightParams.name]}use(t,e=1){t.addFragUniformParam(r.default.EnvLightParams)}}e.GlobalEnvLightUniformParam=l;class h extends n{constructor(){super()}geNames(){return[r.default.ShadowMatrix.name,r.default.ShadowVSMParams.name]}use(t,e=1){t.addFragUniformParam(r.default.ShadowVSMParams),t.addVertUniformParam(r.default.ShadowMatrix)}}e.GlobalVSMShadowUniformParam=h;class o extends n{constructor(){super()}geNames(){return[r.default.GlobalLight.positionName,r.default.GlobalLight.colorName]}use(t,e=1,s=1){t.uniform.useCameraPosition(!1,!0),t.addFragUniform(r.default.GlobalLight.type,r.default.GlobalLight.positionName,e),t.addFragUniform(r.default.GlobalLight.type,r.default.GlobalLight.colorName,s)}}e.GlobalLightUniformParam=o},c711:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("fecb")),l=i(s("c120"));class h{constructor(){this.A_q=null,this.A_O=null,this.Dw=null,this.Dx=null,this.Dy=new Uint8Array(256),this.Dz=null,this.D0=null,this.D1=0,this.D2=0,this.D3=new a.default,this.D4=new a.default,this.B_3=null,this.B_4=null,this.D5=new Uint8Array(4),this.D6=new a.default,this.D7=new a.default,this.D8=[null,null],this.D9=!1}setRenderer(t){this.A_q=t}setRayTestMode(t){this.D2=t}setRay(t,e){this.B_3=t,this.B_4=e}getRay(t,e){t.copyFrom(this.B_3),e.copyFrom(this.B_4)}setCamera(t){this.A_O=t}setCullingNodeHead(t){if(this.Dw=t,null==this.Dz){this.Dz=[];let t=0;for(;t<256;++t)this.Dz.push(new l.default)}}getSelectedNode(){return this.D0}getSelectedNodes(){return this.Dz}getSelectedNodesTotal(){return this.D1}sorting(t,e){let s=this.Dz;this.Dx=s[t];while(t<e){while(t<e&&s[e].dis>=this.Dx.dis)--e;s[t]=s[e];while(t<e&&s[t].dis<=this.Dx.dis)++t;s[e]=s[t]}return s[t]=this.Dx,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}run(){let t=this.Dw;if(null!=t){let e=0,s=this.B_4,i=this.B_3,l=this.D7,h=null,o=0;Math.abs(s.x)>r.default.MATH_MIN_POSITIVE?this.D6.x=1/s.x:this.D6.x=r.default.MATH_MAX_POSITIVE,Math.abs(s.y)>r.default.MATH_MIN_POSITIVE?this.D6.y=1/s.y:this.D6.y=r.default.MATH_MAX_POSITIVE,Math.abs(s.z)>r.default.MATH_MIN_POSITIVE?this.D6.z=1/s.z:this.D6.z=r.default.MATH_MAX_POSITIVE,this.D6.x<0?this.D5[0]=1:this.D5[0]=0,this.D6.y<0?this.D5[1]=1:this.D5[1]=0,this.D6.z<0?this.D5[2]=1:this.D5[2]=0;while(null!=t)t.drawEnabled&&t.entity.mouseEnabled&&(l.x=t.bounds.center.x-i.x,l.y=t.bounds.center.y-i.y,l.z=t.bounds.center.z-i.z,e=l.dot(s),l.x-=e*s.x,l.y-=e*s.y,l.z-=e*s.z,l.getLengthSquared()<=t.bounds.radius2&&t.rayTestState<1&&(this.D8[0]=t.bounds.min,this.D8[1]=t.bounds.max,n.default.IntersectionRL3(this.D8,this.D5,this.D6,s,i,l)&&(h=this.Dz[o],h.entity=t.entity,h.dis=this.D6.w,h.wpv.copyFrom(l),++o))),t=t.next;this.D0=null;let m=0;if(o>0){let t=this.D3,e=this.D4,n=null,h=0,_=0,u=null,d=null;if(o>1){let c=!this.D9;for(m=0;m<o;++m)d=this.Dz[m],d.dis=r.default.MATH_MAX_POSITIVE,d.flag=0,n=this.Dz[m].entity,n.isPolyhedral()?c?(u=n.getInvMatrix(),u.transformOutVector3(i,t),u.deltaTransformOutVector(s,e),e.normalize(),h=n.testRay(t,e,l,!0)):h=0:(u=n.getInvMatrix(),u.transformOutVector3(i,t),u.deltaTransformOutVector(s,e),e.normalize(),h=n.testRay(t,e,l,!0)),h>0?(d.flag=h,d.lpv.copyFrom(l),n.getMatrix().transformOutVector3(l,d.wpv),d.dis=a.default.Distance(d.wpv,i),this.Dy[_]=m,++_):h<0&&(this.Dy[_]=m,++_);for(this.snsort(0,o-1),m=0;m<o;++m)if(this.Dz[m].flag>0){this.D0=this.Dz[m];break}}else d=this.Dz[0],d.dis=r.default.MATH_MAX_POSITIVE,n=this.Dz[0].entity,u=n.getInvMatrix(),u.transformOutVector3(i,t),u.deltaTransformOutVector(s,e),e.normalize(),h=n.testRay(t,e,l,!0),h>0?(d.lpv.copyFrom(l),n.getMatrix().transformOutVector3(l,d.wpv),d.dis=a.default.Distance(d.wpv,i),this.D0=d):h<0&&(this.D0=d)}for(m=o;m<this.D1;++m)this.D0!=this.Dz[m]&&(this.Dz[m].entity=null);this.D1=o}}clear(){this.D0=null}}e.default=h},ca2f:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}downloadBinFile(t,e,s="vrd"){var i,r;i=function(t,e,s){var i,a;i=new Blob([t],{type:s}),a=window.URL.createObjectURL(i),r(a,e),setTimeout((function(){return window.URL.revokeObjectURL(a)}),1e3)},r=function(t,e){var s;s=document.createElement("a"),s.href=t,s.download=e,document.body.appendChild(s),s.style="display: none",s.click(),s.remove()},i(t,e+"."+s,"application/octet-stream")}}e.FileIO=i},ca6c:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static PushThreeBitValueToInt(t,e){return(t<<3)+e}static PopThreeBitValueFromInt(t){return i.value=7&t,t>>3}static ContainsBit(t,e){return(e&t)>0}static RemoveBit(t,e){return~e&t}static AddBit(t,e){return e|t}static AssembleFromIntArray(t){let e=0,s=0,i=t.length;for(;e<i;++e)t[e]>0&&(s|=1<<e);return s}}i.BIT_ZERO=0,i.BIT_ONE_0=1,i.BIT_ONE_1=2,i.BIT_ONE_2=4,i.BIT_ONE_3=8,i.BIT_ONE_4=16,i.BIT_ONE_5=32,i.BIT_ONE_6=64,i.BIT_ONE_7=128,i.BIT_ONE_8=256,i.BIT_ONE_9=512,i.BIT_ONE_10=1024,i.BIT_ONE_11=2048,i.value=0,e.default=i},cb29:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=s("8a0a"),n=i(s("e7d2")),l=s("e08e");class h{constructor(t=r.default.VTX_STATIC_DRAW){this.E_0=0,this.D_o=0,this.E_1=null,this.B_u=null,this.B_t=null,this.E_2=null,this.E_3=null,this.E_4=null,this.forceUpdateIVS=!1,this.wireframe=!1,this.bounds=null,this.normalType=a.VtxNormalType.GOURAND,this.normalScale=1,this.vtxTotal=0,this.trisNumber=0,this.drawMode=l.RenderDrawMode.ELEMENTS_TRIANGLES,this.vtCount=0,this.vbWholeDataEnabled=!1,this.drawInsBeginIndex=0,this.drawInsStride=0,this.drawInsTotal=0,this.k=0,this.E_0=t}updateWireframeIvs(){if(this.drawMode=l.RenderDrawMode.ELEMENTS_TRIANGLES,this.wireframe&&null!==this.B_t){let t,e,s,i,r=this.B_t,a=2*r.length;t=a<65535?new Uint16Array(a):new Uint32Array(a);let n=0;for(let l=0,h=r.length;l<h;l+=3)e=r[l+0],s=r[l+1],i=r[l+2],t[n]=e,t[n+1]=s,t[n+2]=s,t[n+3]=i,t[n+4]=i,t[n+5]=e,n+=6;this.drawMode=l.RenderDrawMode.ELEMENTS_LINES}}buildEnd(){this.E_2=n.default.BufDataList,this.E_3=n.default.BufDataStepList,this.E_4=n.default.BufStatusList}setTransformMatrix(t){this.E_1=t}getTransformMatrix(){return this.E_1}isPolyhedral(){return!0}setPolyhedral(t){}testRay(t,e,s,i){return-1}rebuild(){if(null==this.B_u&&null!=this.E_2){n.default.Reset();let t=0,e=this.E_2.length;for(;t<e;++t)n.default.AddFloat32Data(this.E_2[t],this.E_3[t],this.E_4[t]);this.B_u=n.default.CreateBySaveData(this.getBufDataUsage()),null!=this.B_t&&(this.B_u.setUintIVSData(this.B_t),this.vtCount=this.B_t.length)}}__$attachVBuf(){return null==this.B_u&&this.rebuild(),n.default.__$$AttachAt(this.B_u.getUid()),this.B_u}__$detachVBuf(t){if(this.B_u!=t)throw Error("Fatal Error!");n.default.__$$DetachAt(this.B_u.getUid())}isGeomDynamic(){return this.E_0}getBufDataUsage(){return this.E_0}getVS(){return null}getUVS(){return null}getNVS(){return null}getCVS(){return null}getIVS(){return this.B_t}setBufSortFormat(t){this.D_o=t}getBufSortFormat(){return this.D_o}isVBufEnabledAt(t){return(t&this.D_o)>0}__$attachThis(){++this.k}__$detachThis(){1==this.k?(--this.k,this.__$dispose()):--this.k,this.k<1&&(this.k=0)}getAttachCount(){return this.k}__$dispose(){this.getAttachCount()<1&&null!=this.B_u&&(n.default.__$$DetachAt(this.B_u.getUid()),this.B_u=null)}isEnabled(){return null!=this.B_u}isResFree(){return this.getAttachCount()<1&&null==this.B_u}__$destroy(){this.isResFree()&&(this.B_t=null,this.E_2=null,this.E_3=null,this.E_4=null,this.trisNumber=0,this.E_1=null)}toString(){return"[MeshBase()]"}}e.default=h},cc48:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["NONE"]=0]="NONE",t[t["CAMERA"]=1]="CAMERA",t[t["POV"]=2]="POV",t[t["INNER_POV_PASS"]=3]="INNER_POV_PASS",t[t["CAMERA_AND_POV"]=4]="CAMERA_AND_POV"}(i||(i={})),e.SpaceCullingMask=i},cc55:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.vert="",this.vert_head="",this.vert_body="",this.frag="",this.frag_head="",this.frag_body="",this.uuid=""}}e.ShaderCodeObject=i},ccdf:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("cfaf")),n=i(s("acaa")),l=i(s("85b6")),h=i(s("3b73"));class o{constructor(t){this.l=null,this.E_5=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.E_6=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.E_7=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.E_8=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.l=t}getRenderProxy(){return this.l}createWrapperTex(t,e,s=!1){let i=new l.default(t,e,s);return i}createRTTTex2D(t,e,s=!1){let i=new a.default(t,e,s);return i}createDepthTex2D(t,e,s=!1){let i=new n.default(t,e,s);return i}getCubeRTTTextureAt(t){return null!=this.E_6[t]?(this.E_6[t].__$setRenderProxy(this.l),this.E_6[t]):(this.E_6[t]=this.createRTTTex2D(32,32),this.E_6[t].toCubeTexture(),this.E_6[t].name="sys_cube_rttTex_"+t,this.E_6[t].minFilter=r.TextureConst.LINEAR,this.E_6[t].magFilter=r.TextureConst.LINEAR,this.E_6[t].__$setRenderProxy(this.l),this.E_6[t])}createCubeRTTTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.E_6[t]?(this.E_6[t].__$setRenderProxy(this.l),this.E_6[t]):(this.E_6[t]=this.createRTTTex2D(e,s),this.E_6[t].toCubeTexture(),this.E_6[t].name="sys_cube_rttTex_"+t,this.E_6[t].minFilter=r.TextureConst.LINEAR,this.E_6[t].magFilter=r.TextureConst.LINEAR,this.E_6[t].__$setRenderProxy(this.l),this.E_6[t])}getRTTTextureAt(t){return null!=this.E_5[t]?(this.E_5[t].__$setRenderProxy(this.l),this.E_5[t]):(this.E_5[t]=this.createRTTTex2D(32,32),this.E_5[t].to2DTexture(),this.E_5[t].name="sys_rttTex_"+t,this.E_5[t].minFilter=r.TextureConst.LINEAR,this.E_5[t].magFilter=r.TextureConst.LINEAR,this.E_5[t].__$setRenderProxy(this.l),this.E_5[t])}createRTTTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.E_5[t]?(this.E_5[t].__$setRenderProxy(this.l),this.E_5[t]):(this.E_5[t]=this.createRTTTex2D(e,s),this.E_5[t].to2DTexture(),this.E_5[t].name="sys_rttTex_"+t,this.E_5[t].minFilter=r.TextureConst.LINEAR,this.E_5[t].magFilter=r.TextureConst.LINEAR,this.E_5[t].__$setRenderProxy(this.l),this.E_5[t])}getDepthTextureAt(t){return null!=this.E_8[t]?(this.E_8[t].__$setRenderProxy(this.l),this.E_8[t]):(this.E_8[t]=this.createDepthTex2D(64,64),this.E_8[t].to2DTexture(),this.E_8[t].name="sys_depthTex_"+t,this.E_8[t].minFilter=r.TextureConst.NEAREST,this.E_8[t].magFilter=r.TextureConst.NEAREST,this.E_8[t].__$setRenderProxy(this.l),this.E_8[t])}createDepthTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.E_8[t]?(this.E_8[t].__$setRenderProxy(this.l),this.E_8[t]):(this.E_8[t]=this.createDepthTex2D(e,s),this.E_8[t].to2DTexture(),this.E_8[t].name="sys_depthTex_"+t,this.E_8[t].__$setRenderProxy(this.l),this.E_8[t])}getRTTFloatTextureAt(t){if(null!=this.E_7[t])return this.E_7[t].__$setRenderProxy(this.l),this.E_7[t];let e=this.createRTTTex2D(64,64);return e.to2DTexture(),this.E_7[t]=e,this.E_7[t].name="sys_rttFloatTex_"+t,e.internalFormat=r.TextureFormat.RGBA16F,e.srcFormat=r.TextureFormat.RGBA,e.dataType=r.TextureDataType.FLOAT,e.minFilter=r.TextureConst.NEAREST,e.magFilter=r.TextureConst.NEAREST,h.default.IsWebGL1()&&(e.dataType=r.TextureDataType.HALF_FLOAT_OES),this.E_7[t].__$setRenderProxy(this.l),e}createRTTFloatTextureAt(t,e,s){if(e=e>1?e:1,s=s>1?s:1,null!=this.E_7[t])return this.E_7[t].__$setRenderProxy(this.l),this.E_7[t];let i=this.createRTTTex2D(e,s);return i.to2DTexture(),this.E_7[t]=i,this.E_7[t].name="sys_rttFloatTex_"+t,i.internalFormat=r.TextureFormat.RGBA16F,i.srcFormat=r.TextureFormat.RGBA,i.dataType=r.TextureDataType.FLOAT,i.minFilter=r.TextureConst.NEAREST,i.magFilter=r.TextureConst.NEAREST,h.default.IsWebGL1()&&(i.dataType=r.TextureDataType.HALF_FLOAT_OES),this.E_7[t].__$setRenderProxy(this.l),i}}e.RTTTextureStore=o,e.default=o},cf91:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("faa5")),a=i(s("b3bd")),n=i(s("0fc4")),l=i(s("6e01")),h=i(s("1ea6")),o=s("f3a2");class m extends r.default{constructor(){super(),this.decorator=null,this.texturesTotal=0,this.vertUniform=null}initialize(t){t=this.texturesTotal>0,super.initialize(t),this.adaptationShaderVersion=!1}buildShader(){null!=this.vertUniform&&this.vertUniform.use(this.A_j),this.decorator.buildShader()}getShaderCodeObjectUUID(){return o.ShaderCodeUUID.PBR}getUniqueShaderName(){return null!=this.vertUniform?this.decorator.getUniqueShaderName()+this.vertUniform.getUniqueNSKeyString():this.decorator.getUniqueShaderName()}toString(){return"[PBRShaderBuffer()]"}static GetInstance(){return m.F_2}}m.F_2=new m;class _ extends n.default{constructor(){super(),this.E_9=128,this.E_=128,this.FA=new Float32Array([0,0,1,.02,1,.1,1,1,.1,.1,.1,1,1,1,1,.07]),this.Ea=null,this.EX=null,this.FB=new Float32Array([0,0,-1,1,1,.3,0,0]),this.decorator=null,this.vertUniform=null}buildBuf(){let t=m.GetInstance(),e=this.decorator;t.lightEnabled=e.lightEnabled,t.shadowReceiveEnabled=e.shadowReceiveEnabled,t.fogEnabled=e.fogEnabled,t.glossinessEnabeld=e.glossinessEnabeld,t.buildPipelineParams(),t.decorator=e,t.vertUniform=this.vertUniform,t.decorator.codeBuilder=t.getShaderCodeBuilder(),null==this.Ea&&this.initializeLocalData();let s=e.createTextureList();null!=this.vertUniform&&this.vertUniform.getTextures(t.getShaderCodeBuilder(),s),t.getTexturesFromPipeline(s),super.setTextureList(s),t.texturesTotal=s.length}getCodeBuf(){return m.GetInstance()}initializeLocalData(){null!=this.vertUniform&&this.vertUniform.initialize();let t=this.decorator;t.fragLocalParamsTotal=2,t.parallaxParamIndex=2,null!=t.parallaxMap&&(t.fragLocalParamsTotal+=1),this.Ea=new Float32Array(4*t.fragLocalParamsTotal),this.Ea.set([0,0,0,1,.2,.2,.2,0],0),null!=t.parallaxMap&&(this.EX=this.Ea.subarray(4*t.parallaxParamIndex,4*(t.parallaxParamIndex+1)),this.EX.set([1,10,2,.1]))}copyFrom(t){this.setMaterialPipeline(t.z_),null==this.decorator&&(this.decorator=new h.default),this.decorator.copyFrom(t.decorator),this.vertUniform=t.vertUniform,null==this.FA||this.FA.length!=t.FA.length?this.FA=t.FA.slice():this.FA.set(t.FA),null==this.Ea||this.Ea.length!=t.Ea.length?this.Ea=t.Ea.slice():this.Ea.set(t.Ea),null==this.FB||this.FB.length!=t.FB.length?this.FB=t.FB.slice():this.FB.set(t.FB)}setTextureList(t){}clone(){let t=new _;return t.copyFrom(this),t}seNormalMapIntensity(t){t=Math.min(Math.max(t,0),1),this.Ea[4]=t}setPixelNormalNoiseIntensity(t){t=Math.min(Math.max(t,0),2),this.FA[3]=t}getPixelNormalNoiseIntensity(){return this.FA[3]}setMirrorViewNV(t){this.FB[0]=t.x,this.FB[1]=t.y,this.FB[2]=t.z}setMirrorPlaneNV(t){}setMirrorMapLodLevel(t){this.FB[3]=t}setMirrorIntensity(t){this.FB[4]=Math.min(Math.max(t,.01),2)}setMirrorMixFactor(t){this.FB[5]=Math.min(Math.max(t,.01),2)}setEnvMapLodMipMapLevel(t,e=0){t=Math.min(Math.max(t,0),14),e=Math.min(Math.max(e,-7),12),this.FA[15]=.01*Math.round(t)+e}setEnvMapLodMipMapLevelWithSize(t,e,s=0){this.E_9=t,this.E_=e,s=Math.min(Math.max(s,-7),12),this.FA[15]=.01*l.default.GetMaxMipMapLevel(t,e)+s}setScatterIntensity(t){this.FA[11]=Math.min(Math.max(t,.01),512)}getScatterIntensity(){return this.FA[11]}setToneMapingExposure(t){this.FA[4]=Math.min(Math.max(t,.1),128)}getToneMapingExposure(){return this.FA[4]}setReflectionIntensity(t){this.FA[5]=Math.min(Math.max(t,.001),1)}getReflectionIntensity(){return this.FA[5]}setSurfaceIntensity(t){this.FA[6]=Math.min(Math.max(t,.001),32)}getSurfaceIntensity(){return this.FA[6]}setSideIntensity(t){this.FA[7]=Math.min(Math.max(t,.001),32)}getSideIntensity(){return this.FA[7]}setEnvSpecularColorFactor(t,e,s){this.FA[12]=t,this.FA[13]=e,this.FA[14]=s}getEnvSpecularColorFactor(t){t.r=this.FA[12],t.g=this.FA[13],t.b=this.FA[14]}setAmbientFactor(t,e,s){this.FA[8]=t,this.FA[9]=e,this.FA[10]=s}getAmbientFactor(t){t.r=this.FA[8],t.g=this.FA[9],t.b=this.FA[10]}setMetallic(t){this.FA[0]=Math.min(Math.max(t,.05),1)}getMetallic(){return this.FA[0]}setRoughness(t){this.FA[1]=Math.min(Math.max(t,.05),1)}getRoughness(){return this.FA[1]}setAO(t){this.FA[2]=t}getAO(){return this.FA[2]}setF0(t,e,s){this.Ea[0]=t,this.Ea[1]=e,this.Ea[2]=s}getF0(t){t.r=this.Ea[0],t.g=this.Ea[1],t.b=this.Ea[2]}setAlbedoColor(t,e,s){this.Ea[4]=t,this.Ea[5]=e,this.Ea[6]=s}getAlbedoColor(t){t.r=this.Ea[4],t.g=this.Ea[5],t.b=this.Ea[6]}setParallaxParams(t=1,e=10,s=2,i=.1){null!=this.EX&&(this.EX[0]=t,this.EX[1]=e,this.EX[2]=s,this.EX[3]=i)}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_pbrParams","u_fragLocalParams","u_mirrorParams"],t.dataList=[this.FA,this.Ea,this.FB],null!=this.vertUniform&&this.vertUniform.buildShaderUniformData(t),t}destroy(){this.vertUniform=null,this.FA=null,this.Ea=null,this.FB=null,super.destroy()}}e.default=_},cfaf:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class n extends a.default{constructor(t,e,s=!1){super(t,e,s),this.v=r.TextureProxyType.RTT,this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST}to2DTexture(){this.s=r.TextureTarget.TEXTURE_2D}enableMipmap(){this.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,this.magFilter=r.TextureConst.LINEAR,this.mipmapEnabled=!0}disableMipmap(){this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.mipmapEnabled=!1}toCubeTexture(){this.s=r.TextureTarget.TEXTURE_CUBE}setSize(t,e){this.o=t,this.p=e}uploadFromFbo(t,e,s){let i=t.getRC(),a=this.mipmapEnabled;this.mipmapEnabled=!1,t.hasResUid(this.getResUid())?this.getBufWidth()==e&&this.getBufHeight()==s||(t.bindToGpu(this.getResUid()),this.bindTexture(i,e,s),this.o=e,this.p=s,this.__$buildParam(i)):(this.t=r.TextureTarget.GetValue(i,this.s),this.createTexBuf(t),t.bindToGpu(this.getResUid()),this.bindTexture(i,e,s),this.u=!0,this.o=e,this.p=s,this.__$buildParam(i)),this.mipmapEnabled=a}bindTexture(t,e,s){let i=r.TextureFormat.ToGL(t,this.internalFormat),a=r.TextureFormat.ToGL(t,this.srcFormat),n=r.TextureDataType.ToGL(t,this.dataType);switch(this.s){case r.TextureTarget.TEXTURE_2D:t.texImage2D(t.TEXTURE_2D,0,i,e,s,0,a,n,null);break;case r.TextureTarget.TEXTURE_CUBE:for(let r=0;r<6;++r)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,i,e,s,0,a,n,null);break;case r.TextureTarget.TEXTURE_SHADOW_2D:t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT16,e,s,0,t.DEPTH_COMPONENT,t.FLOAT,null);break;default:break}}toString(){return"[RTTTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},d1a0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{static PlaneCalcIntersectSphere(t,e,s,i){a.IntersectBoo=!1,a.IntersectSatus=0,e=t.dot(s)-e,e>r.default.MATH_MIN_POSITIVE?(a.IntersectBoo=e<=i,a.IntersectSatus=1):e<r.default.MATH_MAX_NEGATIVE&&(a.IntersectBoo=-e<=i,a.IntersectSatus=-1)}static CalcPVCloseV(t,e,s,i){let r=e-s.dot(t);i.setTo(r*t.x,r*t.y,r*t.z),i.addBy(s)}static CalcPVCloseV2(t,e,s,i){let r=e-s.dot(t);i.setTo(r*t.x,r*t.y,r*t.z),i.addBy(s)}static IntersectionSLV2(t,e,s,i,a){let n=t.dot(i);if(n>r.default.MATH_MIN_POSITIVE||n<r.default.MATH_MAX_NEGATIVE){let r=t.dot(s)-e;return a.x=1e5*i.x+s.x,a.y=1e5*i.y+s.y,a.z=1e5*i.z+s.z,n=t.dot(a)-e,n=r/(r-n),a.subtractBy(s),a.scaleBy(n),a.addBy(s),1}return n=t.dot(s)-e,n<=r.default.MATH_MIN_POSITIVE||n>=r.default.MATH_MAX_NEGATIVE?(a.copyFrom(s),2):0}}a.IntersectBoo=!1,a.IntersectSatus=0,e.default=a},d314:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class n extends a.default{constructor(t,e){super(t,e,!1),this.B_v=null,this.s=r.TextureTarget.TEXTURE_CUBE,this.v=r.TextureProxyType.ImageCube,this.internalFormat=r.TextureFormat.RGBA,this.srcFormat=r.TextureFormat.RGBA,this.dataType=r.TextureDataType.UNSIGNED_BYTE,this.mipmapEnabled=!0}setDataFromImageToFaceAt(t,e,s=0){null!=e&&(null==this.B_v&&(this.B_v=[null,null,null,null,null,null]),e.width>0&&e.height>0&&(0==t&&(this.o=e.width,this.p=e.height,this.n=s),this.B_v[t]={imgData:e,miplevel:s},this.u=null!=this.B_v[t]))}uploadData(t){let e=t.getRC(),s=null;for(let i=0;i<6;++i)s=this.B_v[i],e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,this.n,r.TextureFormat.ToGL(e,this.internalFormat),r.TextureFormat.ToGL(e,this.srcFormat),r.TextureDataType.ToGL(e,this.dataType),s.imgData)}toString(){return"[ImageCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.B_v)for(let t=0;t<6;++t)null!=this.B_v[t]&&(this.B_v[t].imgData=null);super.__$destroy()}}}e.default=n},d53d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uns="",this.program=null,this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataSizeList=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,s=e.length;for(let i=0;i<s;++i)if(t==e[i])return this.dataList[i]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let s=this.uniformNameList,i=s.length;for(let r=0;r<i;++r)if(t==s[r]){this.dataList[r]=e;break}}}copyDataFromProbe(t){this.types=[],this.dataSizeList=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]),this.dataSizeList.push(t.dataSizeList[e]);this.uniformSize=t.uniformsTotal}useByLocation(t,e,s,i){}useByShd(t,e){}use(t){}updateData(){}destroy(){}}e.ShaderUniform=i;class r extends i{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV1(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e])}useByLocation(t,e,s,i){t.useUniformV1(s,e,this.dataList[i],this.dataSizeList[i])}useByShd(t,e){let s=0;for(;s<this.uniformSize;++s)t.useUniformV1(e.getUniformLocationByNS(this.uniformNameList[s]),this.types[s],this.dataList[s],this.dataSizeList[s])}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let s=0;s<t;++s)e=this.calcModels[s],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null}}e.ShaderUniformV1=r;class a extends i{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV2(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e],0)}useByLocation(t,e,s,i){t.useUniformV2(s,e,this.dataList[i],this.dataSizeList[i],0)}useByShd(t,e){let s=0;for(;s<this.uniformSize;++s)t.useUniformV2(e.getUniformLocationByNS(this.uniformNameList[s]),this.types[s],this.dataList[s],this.dataSizeList[s],0)}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let s=0;s<t;++s)e=this.calcModels[s],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null,this.program=null}}e.ShaderUniformV2=a;class n extends i{constructor(){super()}use(t){t.useUniformMat4(this.locations[0],this.dataList[0])}useByLocation(t,e,s,i){t.useUniformMat4(s,this.dataList[0])}useByShd(t,e){t.useUniformMat4(e.getUniformLocationByNS(this.uniformNameList[0]),this.dataList[0])}destroy(){this.dataList[0]=null,this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null}}e.ShaderMat4Uniform=n,e.default=i},d63d:function(t,e,s){"use strict";s.r(e),s.d(e,"LambertLightShaderCode",(function(){return l}));var i="worldNormal.xyz = v_worldNormal;\r\nworldPosition.xyz = v_worldPosition;\r\nvec3 N = worldNormal.xyz;\r\nvec4 color = u_fragLocalParams[0];\r\n\r\ncolor.xyz += u_fragLocalParams[1].xyz;\r\n#ifdef VOX_USE_VTX_COLOR\r\n    color.xyz *= v_cv.xyz;\r\n#endif\r\n\r\nvec3 ao = vec3(1.0);\r\nvec2 texUV = v_uv.xy;\r\n#ifdef VOX_LIGHT_LOCAL_PARAMS_INDEX\r\n    vec4 param;\r\n    vec3 viewDir = normalize(u_cameraPosition.xyz - worldPosition.xyz);\r\n    #ifdef VOX_PARALLAX_MAP\r\n        #ifdef VOX_NORMAL_MAP\r\n            mat3 btnMat3 = getBTNMat3(v_uv, worldPosition.xyz, worldNormal.xyz);\r\n            vec3 tbnViewDir = btnMat3 * viewDir;\r\n            \r\n            //default value: vec4(1.0,10.0,2.0,0.1)\r\n            param = u_fragLocalParams[ VOX_PARALLAX_PARAMS_INDEX ];\r\n            texUV = parallaxOccRayMarchDepth(VOX_PARALLAX_MAP, v_uv, -tbnViewDir, param);\r\n            #ifdef VOX_NORMAL_MAP\r\n                N = btnMat3 * normalize(getNormalFromMap(VOX_NORMAL_MAP, texUV));\r\n            #endif\r\n        #endif\r\n    #else\r\n        #ifdef VOX_NORMAL_MAP\r\n            N = normalize(getNormalFromMap(VOX_NORMAL_MAP, texUV, worldNormal.xyz));\r\n        #endif\r\n    #endif\r\n\r\n    calcDiffuse( color, texUV.xy );\r\n\r\n    #ifdef VOX_AO_MAP\r\n        ao = VOX_Texture2D(VOX_AO_MAP, texUV).yyy;\r\n    #endif\r\n\r\n    int lightParamIndex = VOX_LIGHT_LOCAL_PARAMS_INDEX;\r\n    param = u_fragLocalParams[ VOX_LIGHT_LOCAL_PARAMS_INDEX ];\r\n    \r\n    LambertLight light;\r\n    light.normal = N;\r\n    light.viewDirec = viewDir;\r\n    light.diffuse = color.xyz;\r\n    light.specular = param.xyz;\r\n\r\n    light.specularPower = param.w;\r\n    param = u_fragLocalParams[ VOX_LIGHT_LOCAL_PARAMS_INDEX + 1 ];\r\n    light.param = param;\r\n    vec4 param4;\r\n    #ifdef VOX_SPECULAR_MAP\r\n        param4 = VOX_Texture2D(VOX_SPECULAR_MAP, texUV);\r\n        #if VOX_SPECULAR_MODE == 2\r\n            light.specular *= color.xyz;\r\n        #elif VOX_SPECULAR_MODE == 3\r\n            light.specular *= param4.xyz;\r\n        #endif\r\n        light.specularPower = max(1.0, light.specularPower * param4.z);\r\n    #endif\r\n    vec3 destColor = getLambertLightColor(light);\r\n\r\n    #ifdef VOX_ENV_AMBIENT_LIGHT_LIGHT_MAP\r\n        param4 = u_envLightParams[4];\r\n        param4.xyz = color.xyz * VOX_Texture2D(VOX_ENV_AMBIENT_LIGHT_LIGHT_MAP, (param4.xy + worldPosition.xz) / param4.zw).xyz;\r\n        destColor.xyz += param4.xyz * u_envLightParams[0].xyz * ao;\r\n    #endif\r\n    color.xyz = color.xyz * param.z + param.w * destColor;\r\n#else\r\n\r\n    calcDiffuse( color, texUV.xy );\r\n\r\n    #ifdef VOX_AO_MAP\r\n        ao = VOX_Texture2D(VOX_AO_MAP, texUV).yyy;\r\n    #endif\r\n#endif\r\n\r\ncolor.xyz *= ao;\r\ncolor.xyz += u_fragLocalParams[ VOX_LIGHT_LOCAL_PARAMS_INDEX + 2 ].xyz * ao;\r\n\r\nFragColor0 = color;\r\n//[x: displacement, y: ao, z: specular, w: occ]",r="void calcDiffuse(inout vec4 color, vec2 uv) {\r\n    #ifdef VOX_DIFFUSE_MAP\r\n        color *= VOX_Texture2D(VOX_DIFFUSE_MAP, uv);\r\n    #endif\r\n    #ifdef VOX_DIFFUSE_MAP2\r\n        #ifdef VOX_USE_DIFFUSEMAP2_MAT\r\n            vec4 srcColor = VOX_Texture2D( VOX_DIFFUSE_MAP2, v_map2Pos.xy / v_map2Pos.ww );\r\n        #else\r\n            vec4 srcColor = VOX_Texture2D( VOX_DIFFUSE_MAP2, uv );\r\n        #endif\r\n        color = color * vec4(1.0 - srcColor.w) + srcColor * srcColor.wwww;\r\n        \r\n    #endif\r\n}\r\n#ifdef VOX_NORMAL_MAP\r\nvec3 getNormalFromMap(sampler2D texSampler, vec2 texUV, vec3 nv)\r\n{\r\n    vec3 tangentNormal = VOX_Texture2D(texSampler, texUV).xyz * 2.0 - 1.0;\r\n\r\n    vec3 Q1  = dFdx(worldPosition.xyz);\r\n    vec3 Q2  = dFdy(worldPosition.xyz);\r\n    vec2 st1 = dFdx(texUV);\r\n    vec2 st2 = dFdy(texUV);\r\n\r\n    vec3 N   = normalize(nv);\r\n    vec3 T  = normalize(Q1*st2.t - Q2*st1.t);\r\n    vec3 B  = normalize(cross(T, N));\r\n\r\n    mat3 TBN = mat3(T, B, N);\r\n\r\n    return TBN * tangentNormal;\r\n}\r\nvec3 getNormalFromMap(in sampler2D texSampler, in vec2 texUV)\r\n{\r\n    return VOX_Texture2D(texSampler, texUV).xyz * 2.0 - 1.0;\r\n}\r\n#endif\r\n#ifdef VOX_PARALLAX_MAP\r\nmat3 getBTNMat3(in vec2 texUV, in vec3 pos, in vec3 nv)\r\n{\r\n    vec3 Q1  = dFdx(pos);\r\n    vec3 Q2  = dFdy(pos);\r\n    vec2 st1 = dFdx(texUV);\r\n    vec2 st2 = dFdy(texUV);\r\n\r\n    vec3 N  = normalize(nv);\r\n    vec3 T  = normalize(Q1*st2.t - Q2*st1.t);    \r\n    vec3 B  = -normalize(cross(N, T));\r\n    return mat3(T, B, N);\r\n}\r\n//const vec4 occParam = vec4(1.0,10.0,2.0,0.1);\r\nvec2 parallaxOccRayMarchDepth(sampler2D texSampler, vec2 puvs, vec3 viewDir,vec4 occParam)\r\n{\r\n    float depthValue = 1.0 - VOX_Texture2D(texSampler, puvs).r;\r\n    float numLayers = mix(occParam.x, occParam.y, max(dot(vec3(0.0, 0.0, 1.0), viewDir),0.0));\r\n    float layerHeight = occParam.z / numLayers;\r\n    vec2 tuv = (viewDir.xy * occParam.w) / numLayers;  \r\n    float ph = 0.0;\r\n    #ifndef VOX_GLSL_ES2\r\n        while(ph < depthValue)\r\n        {\r\n            puvs -= tuv;\r\n            depthValue = 1.0 - VOX_Texture2D(texSampler, puvs).r;\r\n            ph += layerHeight;\r\n        }\r\n    #else\r\n        for(int i = 0; i < 10; i++) {\r\n            if(ph < depthValue)\r\n            {\r\n                puvs -= tuv;\r\n                depthValue = 1.0 - VOX_Texture2D(texSampler, puvs).r;\r\n                ph += layerHeight;\r\n            }\r\n            else {\r\n                break;\r\n            }\r\n        }\r\n    #endif\r\n    tuv += puvs;\r\n    depthValue -= ph;\r\n    ph = 1.0 - VOX_Texture2D(texSampler, tuv).r - ph + layerHeight;\r\n    float weight = depthValue / (depthValue - ph);\r\n    //return puvs * (1.0 - weight) + tuv * weight;\r\n    return mix(puvs, tuv, weight);\r\n}\r\n#endif\r\n#ifdef VOX_LIGHTS_TOTAL\r\n#if VOX_LIGHTS_TOTAL > 0\r\n\r\nstruct LambertLight {\r\n    // surface normal\r\n\tvec3 normal;\r\n    // diffuse color\r\n\tvec3 diffuse;\r\n    // specular color\r\n\tvec3 specular;\r\n    // view direction\r\n    vec3 viewDirec;\r\n    // light direction per pixel\r\n    vec3 direc;\r\n    // light color\r\n    vec3 color;\r\n    vec4 param;\r\n    float specularPower;\r\n};\r\nvec3 calcLambertLight(in LambertLight light) {\r\n\r\n    float nDotL = max(dot(light.normal, light.direc), 0.0);\r\n\tvec3 baseColor = nDotL * light.diffuse * light.color;\r\n\tvec3 viewDir = normalize(light.direc + light.viewDirec);\r\n\tvec3 specularColor = light.color * light.specular * nDotL * pow(max(dot(light.normal, viewDir), 0.0), light.specularPower);\r\n    vec2 param = light.param.xy;\r\n\treturn (baseColor * param.x + param.y * specularColor);\r\n}\r\n\r\n#endif\r\nvec3 getLambertLightColor(in LambertLight light) {\r\n    #if VOX_LIGHTS_TOTAL > 0\r\n        vec4 color4;\r\n        vec4 param4;\r\n        vec3 destColor = vec3(0.0);\r\n        // point light process\r\n        #if VOX_POINT_LIGHTS_TOTAL > 0\r\n            for(int i = 0; i < VOX_POINT_LIGHTS_TOTAL; ++i)\r\n            {\r\n                param4 = u_lightPositions[i];\r\n                color4 = u_lightColors[i];\r\n                light.color = color4.xyz;\r\n                // calculate per-light radiance\r\n                light.direc = (param4.xyz - worldPosition.xyz);\r\n                float distance = length(light.direc);\r\n                float attenuation = 1.0 / (1.0 + param4.w * distance + color4.w * distance * distance);\r\n                light.direc = normalize(light.direc);\r\n                light.color *= attenuation;\r\n                destColor += calcLambertLight( light );// * attenuation;\r\n            }\r\n        #endif\r\n        // direction light process\r\n        #if VOX_DIRECTION_LIGHTS_TOTAL > 0\r\n            for(int i = VOX_POINT_LIGHTS_TOTAL; i < (VOX_POINT_LIGHTS_TOTAL + VOX_DIRECTION_LIGHTS_TOTAL); ++i) \r\n            {\r\n                light.direc = normalize(-u_lightPositions[i].xyz);\r\n                light.color = u_lightColors[i].xyz;\r\n                destColor += calcLambertLight( light );\r\n            }\r\n        #endif\r\n        // spot light process\r\n        #if VOX_SPOT_LIGHTS_TOTAL > 0\r\n            \r\n            for(int i = (VOX_POINT_LIGHTS_TOTAL + VOX_DIRECTION_LIGHTS_TOTAL); i < VOX_LIGHTS_TOTAL; ++i) \r\n            {\r\n                param4 = u_lightPositions[i];\r\n                color4 = u_lightColors[i];\r\n                //light.color = color4.xyz;\r\n                light.direc = param4.xyz - worldPosition.xyz;\r\n\r\n                float factor = length( light.direc );\r\n                float attenuation = 1.0 / (1.0 + param4.w * factor + color4.w * factor * factor);\r\n                light.color = color4.xyz * attenuation;\r\n                \r\n                param4 = u_lightPositions[i + VOX_SPOT_LIGHTS_TOTAL];\r\n                param4.xyz = normalize( param4.xyz );\r\n                light.direc = normalize( light.direc );\r\n                float ft = abs(param4.w) + 0.001;\r\n                factor = (1.0 - max(dot(-param4.xyz, light.direc), 0.0));\r\n                factor = min(1.0 - (factor / ft), 1.0);\r\n                //factor = max(factor, 0.0001);\r\n                \r\n                destColor += calcLambertLight( light ) * factor;\r\n            }\r\n        #endif\r\n        return destColor;\r\n    #else\r\n        return srcColor.xyz;\r\n    #endif\r\n}\r\n#endif",a="    initLocalVtx();\r\n\r\n    worldPosition = u_objMat * localPosition;\r\n    viewPosition = u_viewMat * worldPosition;\r\n    gl_Position = u_projMat * viewPosition;\r\n    \r\n    #ifdef VOX_DISPLACEMENT_MAP\r\n        oWorldPosition = (u_objMat * vec4(a_vs.xyz, 1.0));\r\n    #else\r\n        oWorldPosition = worldPosition;\r\n    #endif\r\n    v_worldPosition.xyz = oWorldPosition.xyz;\r\n\r\n    #ifdef VOX_USE_DIFFUSEMAP2_MAT\r\n        v_map2Pos = u_map2ViewMat * oWorldPosition;\r\n    #endif\r\n\r\n    #ifdef VOX_USE_NORMAL\r\n        v_worldNormal.xyz = normalize(a_nvs.xyz * inverse(mat3(u_objMat)));\r\n    #endif\r\n    #ifdef VOX_USE_VTX_COLOR\r\n        v_cv.xyz = a_cvs.xyz;\r\n    #endif",n="\r\n#ifdef VOX_DISPLACEMENT_MAP\r\nvoid displaceLocalVtx(in vec2 param) {\r\n    float dispFactor = VOX_Texture2D(VOX_DISPLACEMENT_MAP, v_uv.xy).x;\r\n    localPosition.xyz += normalize( a_nvs.xyz ) * vec3( dispFactor * param.x + param.y );\r\n}\r\n#endif\r\n\r\nvoid initLocalVtx() {\r\n    localPosition = vec4(a_vs.xyz, 1.0);\r\n    \r\n    int paramIndex = 0;\r\n    // vertex transform calculation\r\n    #ifdef VOX_VTX_CURVE_MOVE_PARAM_INDEX\r\n        vec4 params = u_vertLocalParams[VOX_VTX_CURVE_MOVE_PARAM_INDEX];\r\n        float index = abs(mod((a_vs.w + params[1]),params[2]));\r\n        index *= params[0];\r\n        vec2 puv = vec2(fract(index), floor(index) * params[0]);\r\n        localPosition.xyz += VOX_Texture2D(VTX_CURVE_MOVE_MAP, puv).xyz;\r\n    #endif\r\n        \r\n    #ifdef VOX_VTX_TRANSFORM_PARAM_INDEX\r\n        paramIndex = VOX_VTX_TRANSFORM_PARAM_INDEX;\r\n        v_uv = a_uvs.xy * u_vertLocalParams[paramIndex].xy + u_vertLocalParams[paramIndex].zw;\r\n    #elif VOX_USE_2D_MAP\r\n        v_uv = a_uvs.xy;\r\n    #endif\r\n\r\n    #ifdef VOX_DISPLACEMENT_MAP\r\n        displaceLocalVtx( u_vertLocalParams[VOX_DISPLACEMENT_PARAMS_INDEX].xy );\r\n    #endif\r\n    \r\n}";const l={vert:"",vert_head:n,vert_body:a,frag:"",frag_head:r,frag_body:i,uuid:"lambert"}},d7e2:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(t){this.Au=null,this.Au=t}sortRODisplay(t,e){let s=this.Au.getCamera().getPosition();for(let i=0;i<e;++i)t[i].value=-r.default.DistanceSquared(t[i].bounds.center,s);return 0}}e.default=a},d846:function(t,e,s){"use strict";s.r(e),s.d(e,"VSMShaderCode",(function(){return a}));var i="vec4 pack2HalfToRGBA( vec2 v ) {\r\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\r\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\r\n}\r\nvec2 unpackRGBATo2Half( vec4 v ) {\r\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\r\n}\r\n\r\nvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\r\n\r\n    return unpackRGBATo2Half( VOX_Texture2D( shadow, uv ) );\r\n\r\n}\r\n#ifdef VOX_USE_SHADOW\r\nfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ) {\r\n\r\n    float occlusion = 1.0;\r\n\r\n    vec2 distribution = texture2DDistribution( shadow, uv );\r\n\r\n    float hard_shadow = step( compare , distribution.x ); // Hard Shadow\r\n\r\n    if (hard_shadow != 1.0 ) {\r\n\r\n        float distance = compare - distribution.x ;\r\n        float variance = max( 0.0, distribution.y * distribution.y );\r\n        float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\r\n        softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\r\n        occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\r\n\r\n    }\r\n    return occlusion;\r\n\r\n}\r\nfloat getVSMShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\r\n\r\n    //float shadow = 1.0;\r\n    \r\n    shadowCoord.xyz /= shadowCoord.w;\r\n    shadowCoord.z += shadowBias;\r\n    \r\n    // if ( something && something ) breaks ATI OpenGL shader compiler\r\n    // if ( all( something, something ) ) using this instead\r\n\r\n    bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\r\n    bool inFrustum = all( inFrustumVec );\r\n\r\n    bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\r\n\r\n    bool frustumTest = all( frustumTestVec );\r\n\r\n    return frustumTest ? VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z ) : 1.0;\r\n    // if ( frustumTest ) {\r\n    //     shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\r\n    // }\r\n    // return shadow;\r\n}\r\nfloat getVSMShadowFactor(in vec4 shadowPos) {\r\n    \r\n    float shadow = getVSMShadow( VOX_VSM_SHADOW_MAP, u_vsmParams[1].xy, u_vsmParams[0].x, u_vsmParams[0].z, shadowPos );\r\n    float shadowIntensity = 1.0 - u_vsmParams[0].w;\r\n    shadow = clamp(shadow, 0.0, 1.0) * (1.0 - shadowIntensity) + shadowIntensity;\r\n    float f = clamp(dot(worldNormal,u_vsmParams[2].xyz),0.001,1.0);\r\n    shadow = f > 0.0001 ? min(shadow,clamp(f, shadowIntensity,1.0)) : shadowIntensity;\r\n    f = u_vsmParams[1].z;\r\n    return shadow * (1.0 - f) + f;\r\n}\r\nvoid useVSMShadow(inout vec4 color) {\r\n    \r\n    float factor = getVSMShadowFactor(v_shadowPos);\r\n    color.xyz *= vec3(factor);\r\n}\r\n#endif";let r="\nvoid calcShadowPos(in vec4 wpos) {\n    v_shadowPos = u_shadowMat * wpos;\n}\n";const a={vert:"",vert_head:r,vert_body:"\n#ifdef VOX_USE_SHADOW\n    // if use real worldPosition , it maybe make shadow calculation error.\n    calcShadowPos( oWorldPosition );\n#endif\n",frag:"",frag_head:i,frag_body:"\n#ifdef VOX_USE_SHADOW\nuseVSMShadow( FragColor0 );\n#endif\n"}},d958:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=i(s("36cb")),n=i(s("c497")),l=i(s("3c81")),h=i(s("1e15")),o=i(s("0e01")),m=s("eca0"),_=i(s("442e")),u=i(s("1264"));class d{constructor(){this.___$$$$$$$Author="VilyLei(vily313@126.com)",this.b=-1,this.FC=null,this.FD=[],this.FE=0,this.FF=[],this.FG=0,this.l=null,this.t_=null,this.Aj=null,this.FH=null,this.BE=!0,this.FI=!0,this.Ai=new m.RPOUnitBuilder,this.BC=new _.default,this.Ak=new l.default,this.A_4=null,this.A_N=null,this.FJ=null,this.b=d.F_0++,this.FH=new o.default(this.b)}__$setStage3D(t){null!=t&&null==this.A_N&&(this.A_N=t)}getUid(){return this.b}getRCUid(){return this.b}getRPONodeBuilder(){return this.BC}getDataBuilder(){return this.Aj}getRendererContext(){return this.FH}getRenderProxy(){return null!=this.l||(this.l=this.FH.getRenderProxy()),this.l}getStage3D(){return this.l.getStage3D()}getViewX(){return this.t_.getViewportX()}getViewY(){return this.t_.getViewportY()}getViewWidth(){return this.t_.getViewportWidth()}getViewHeight(){return this.t_.getViewportHeight()}getCamera(){return this.FH.getCamera()}createCamera(){return null}useCamera(t,e=!1){}useMainCamera(){}updateCamera(){null!=this.l&&this.l.updateCamera()}initialize(t=null,e=null){null==this.Aj&&null!=e&&(null==t&&(t=new n.default),this.BE=t.batchEnabled,this.FI=t.processFixedState,this.l=this.FH.getRenderProxy(),this.Aj=new a.default,this.A_4=new h.default,this.FH.setCameraParam(t.camProjParam.x,t.camProjParam.y,t.camProjParam.z),this.FH.initialize(t,e,this.A_N,this.Aj,this.A_4),this.t_=this.l.getRenderAdapter(),this.b=this.l.getUid(),this.Aj.initialize(this.l,this.Ai,this.Ak,this.A_4),this.FH.initManager(this.Aj),this.FC=new u.default(this.b,this.Aj,this.Ai,this.Ak),this.FJ=this.createSeparatedProcess(),this.appendProcess(this.BE,this.FI))}getRendererStatus(){return this.FC.version}update(){this.l.Texture.update(),this.l.Vertex.update(),this.FC.update()}updateAllProcess(){for(let t=0;t<this.FE;++t)this.FD[t].update()}updateProcessAt(t){t>-1&&t<this.FE&&this.FD[t].update()}setEntityManaListener(t){this.FC.setListener(t)}addEntity(t,e=0,s=!0){null!=t&&t.__$testRendererEnabled()&&e>-1&&e<this.FE&&this.FC.addEntity(t,this.FD[e].getUid(),s)}addEntityToProcess(t,e,s=!0){null!=e&&null!=t&&t.__$testRendererEnabled()&&e.getRCUid()==this.b&&this.FC.addEntity(t,e.getUid(),s)}moveEntityToProcessAt(t,e){if(null!=t&&t.getRendererUid()==this.b&&t.isInRendererProcess()&&e>-1&&e<this.FE){let s=t.getDisplay().__$$runit.getRPROUid(),i=this.Ak.getNodeByUid(s),a=this.FD[e];i!=a&&(i.removeDispUnit(t.getDisplay()),t.__$rseFlag=a.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),a.addDisp(t.getDisplay()))}}moveEntityToProcess(t,e){if(null!=e&&null!=t&&t.getRendererUid()==this.b&&t.isInRendererProcess()){let s=t.getDisplay().__$$runit.getRPROUid(),i=this.Ak.getNodeByUid(s);if(i!=e){let s=e;i.removeDispUnit(t.getDisplay()),t.__$rseFlag=e.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),s.addDisp(t.getDisplay())}}}removeEntity(t){null!=t&&t.getRendererUid()==this.b&&(this.FC.removeEntity(t),t.__$setRenderProxy(null))}removeEntityFromProcess(t,e){null!=e&&e.getRCUid()==this.b&&null!=t&&t.getRendererUid()==this.b&&(e.removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}removeEntityByProcessIndex(t,e){e>=0&&e<this.FE&&null!=t&&t.getRendererUid()==this.b&&(this.FD[e].removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}setProcessSortEnabledAt(t,e){t>=0&&t<this.FE&&this.FD[t].setSortEnabled(e)}setProcessSortEnabled(t,e){if(null!=t&&t.getRCUid()==this.b){let s=t;s.setSortEnabled(e)}}getRenderProcessAt(t){return this.FD[t]}appendProcess(t=!0,e=!1){this.Ak.setCreateParams(this.Aj.getRenderShader(),this.BC,this.Ai,this.l.Vertex,t,e);let s=this.Ak.create();return this.FD.push(s),s.setRendererParam(this.l,this.FE),++this.FE,s}createSeparatedProcess(t=!0,e=!1){this.Ak.setCreateParams(this.Aj.getRenderShader(),this.BC,this.Ai,this.l.Vertex,t,e);let s=this.Ak.create();return this.FF.push(s),s.setRendererParam(this.l,this.FG),s}setRendererProcessParam(t,e,s){t>-1&&t<this.FE&&this.FD[t].setRenderParam(e,s)}getProcessAt(t){return t>-1&&t<this.FE?this.FD[t]:null}showInfoAt(t){t>-1&&t<this.FE&&this.FD[t].showInfo()}getProcessesTotal(){return this.FE}updateMaterialUniformToCurrentShd(t){this.Aj.getRenderShader().useUniformToCurrentShd(t.__$uniform)}drawEntityByLockMaterial(t,e=!1,s=!0){null!=t&&t.getVisible()&&t.getRendererUid()==this.b&&!this.l.isContextLost()&&this.FJ.drawLockMaterialByDisp(t.getDisplay(),e,s)}drawEntity(t,e=!1,s=!0){null!=t&&t.getVisible()&&!this.l.isContextLost()&&(t.getRendererUid()==this.b?this.FJ.drawDisp(t.getDisplay(),e,s):t.__$testRendererEnabled()&&this.FC.addEntity(t,this.FJ.getUid(),!1))}runAt(t){this.l.isContextLost()||this.FD[t].run()}runProcess(t){t.getRCUid()!=this.b||this.l.isContextLost()||t.run()}runFromIndexTo(t){if(!this.l.isContextLost())for(let e=t;e<this.FE;++e)this.FD[e].run()}run(){if(this.FC.isHaveEntity()&&!this.l.isContextLost())for(let t=0;t<this.FE;++t)this.FD[t].run()}getRenderUnitsTotal(){let t=0;for(let e=0;e<this.FE;++e)t+=this.FD[e].getUnitsTotal();return t}renderflush(){this.l.flush()}toString(){return"[RendererInstance(uid = "+this.b+")]"}}d.F_0=0,e.RendererInstance=d,e.default=d},da6a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){if(this.AH=null,this.FK=null,this.FL=0,this.FM=new Map,this.C_X=new Map,this.FN=0,this.FO=[],null!=i.Gh)throw Error("This Class is a singleton class!!!");i.Gh=null}static GetInstance(){return null!=i.Gh||(i.Gh=new i),i.Gh}getFreeUid(){if(this.FO.length>0)return this.FO.pop();let t=this.FN++;return t}__$$addTexture(t){null==t||this.FM.has(t.getUid())||(this.FM.set(t.getUid(),t),this.FL++)}getTextureByUid(t){return this.FM.get(t)}hasTextureByUid(t){return this.FM.has(t)}removeTextureByUid(t){if(this.FM.has(t)){let e=this.FM.get(t);if(e.getAttachCount()<1)return this.C_X.has(t)&&this.C_X.delete(t),e.__$destroy(),e.__$$removeFromSlot(),this.FM.delete(t),this.FO.push(t),this.FL--,e}return null}getTextureTotal(){return this.FL}setRenderProxy(t){this.AH=t.Texture}setBufferUpdater(t){this.FK=t}getFreeResUidMap(){return this.C_X}isGpuEnabledByResUid(t){return this.AH.hasResUid(t)}addRenderBuffer(t,e){null!=this.FK&&this.FK.__$addBuf(t,e)}addFreeUid(t){this.C_X.set(t,0)}removeFreeUid(t){this.C_X.has(t)&&this.C_X.delete(t)}}i.Gh=null,e.default=i},da82:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("f444")),a=i(s("a46e")),n=i(s("8e17")),l=i(s("53ea"));class h{constructor(){this.A=null,this.stageDragCtrl=new r.default,this.cameraZoomController=new a.default,this.zoomLookAtPosition=null,this.zoomMinDistance=30,this.viewRay=new l.default,this.cameraCtrlEnabled=!0}initialize(t){null==this.A&&(this.A=t,this.viewRay.bindCameraAndStage(t.getCamera(),t.getStage3D()),this.viewRay.setPlaneParam(new n.default(0,1,0),0),t.enableMouseEvent(!0),this.stageDragCtrl.initialize(t.getStage3D(),t.getCamera()),this.cameraZoomController.bindCamera(t.getCamera()),this.cameraZoomController.initialize(t.getStage3D()),this.cameraZoomController.setLookAtCtrlEnabled(!1))}run(){this.cameraCtrlEnabled&&(this.cameraZoomController.run(this.zoomLookAtPosition,this.zoomMinDistance),this.stageDragCtrl.runWithYAxis())}}e.UserInteraction=h},dc2b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("e08e"),a=i(s("29ef"));class n{constructor(){this.b=0,this.FP=null,this.FQ=null,this.name="RODisplay",this.visible=!0,this.ivsIndex=0,this.ivsCount=0,this.trisNumber=0,this.insCount=0,this.drawMode=r.RenderDrawMode.ELEMENTS_TRIANGLES,this.vbuf=null,this.renderState=a.default.NORMAL_STATE,this.rcolorMask=a.default.COLOR_MASK_ALL_TRUE,this.mouseEnabled=!1,this.FR=null,this.FS=null,this.__$ruid=-1,this.__$rpuid=-1,this.__$$rsign=r.DisplayRenderSign.NOT_IN_RENDERER,this.__$$runit=null,this.b=n.F_0++}getPartGroup(){return this.FR}createPartGroup(t){t<1&&(t=1),this.FR=new Uint16Array(2*t)}setDrawPartAt(t,e,s){t*=2,this.FR[t]=s,this.FR[++t]=e}getUid(){return this.b}setTransform(t){this.FS=t,this.FQ=t.getLocalFS32()}getTransform(){return this.FS}getMatrixFS32(){return this.FQ}enableDrawInstanced(t,e){this.drawMode=r.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES,this.ivsIndex=t,this.insCount=e}disableDrawInstanced(){this.drawMode=r.RenderDrawMode.ELEMENTS_TRIANGLES}getMaterial(){return this.FP}setMaterial(t){null!=this.FP&&this.FP!=t&&(this.FP.__$detachThis(),null!=t&&t.__$attachThis()),this.FP=t}copyFrom(t){this.vbuf=t.vbuf,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.setMaterial(t.getMaterial())}toString(){return"RODisplay(name="+this.name+",uid="+this.getUid()+", __$ruid="+this.__$ruid+")"}destroy(){null!=this.FP&&(this.FP.__$detachThis(),this.FP.destroy(),this.FP=null),this.FQ=null,this.vbuf=null,this.__$ruid=-1,this.__$rpuid=-1,this.__$$rsign=r.DisplayRenderSign.NOT_IN_RENDERER,this.ivsIndex=0,this.ivsCount=0,this.FR=null,this.__$$runit=null}static GetFreeId(){return n.f_.length>0?n.f_.pop():-1}static GetByUid(t){return n.g_[t]}static IsEnabledByUid(t){return n.h_[t]==n.S_FLAG_BUSY}static Create(){let t=null,e=n.GetFreeId();return e>=0?(t=n.g_[e],n.h_[e]=n.S_FLAG_BUSY):(t=new n,n.g_.push(t),n.h_.push(n.S_FLAG_BUSY),n.i_++),t}static Restore(t){if(null!=t&&n.h_[t.getUid()]==n.S_FLAG_BUSY){let e=t.getUid();n.f_.push(e),n.h_[e]=n.S_FLAG_FREE,t.destroy()}}}n.F_0=0,n.S_FLAG_BUSY=1,n.S_FLAG_FREE=0,n.h_=[],n.i_=0,n.g_=[],n.f_=[],e.default=n},de9d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("722e")),a=i(s("8333")),n=i(s("6e01")),l=i(s("8e17")),h=s("7c63"),o=i(s("090c")),m=i(s("1216")),_=i(s("56c5")),u=i(s("030e")),d=i(s("74c3")),c=i(s("984e")),f=i(s("29ef")),p=i(s("3077"));class g{constructor(t){this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.RState=null,this.Vertex=null,this.Texture=null,this.VtxBufUpdater=null,this.MaterialUpdater=null,this.adapter=null,this.b=0,this.FT=null,this.t_=null,this.FU=new o.default,this.Au=null,this.Cs=!0,this.J=0,this.K=0,this.L=800,this.M=600,this.v_=.1,this.w_=5e3,this.x_=45,this.L_=2,this.FV=2,this.A_O=null,this.FW=!1,this.FX=!0,this.FY=!0,this.b=t}getRC(){return this.Au}getUid(){return this.b}getRCUid(){return this.b}isAutoSynViewAndStage(){return this.FX}enableSynViewAndStage(){this.FX=!0}lockViewport(){this.t_.lockViewport()}unlockViewport(){this.t_.unlockViewport()}getDiv(){return this.t_.getDiv()}getCanvas(){return this.t_.getCanvas()}cameraLock(){this.A_O.lock()}cameraUnlock(){this.A_O.unlock()}getCamera(){return this.A_O}updateCamera(){return this.A_O.update()}createCameraUBO(t){}updateCameraDataFromCamera(t){null!=t&&(this.FW||t!=this.A_O)&&(this.FW=t!=this.A_O,t.updateCamMatToUProbe(this.A_O.matUProbe),null!=this.FT&&(this.FT.setSubDataArrAt(0,t.matUProbe.getFS32At(0)),this.FT.setSubDataArrAt(16,t.matUProbe.getFS32At(1))))}useCameraData(){null!=this.FT&&this.FT.run()}getActiveAttachmentTotal(){return this.t_.getActiveAttachmentTotal()}drawInstanced(t,e,s){2==this.FV?this.Au.drawElementsInstanced(this.TRIANGLES,t,this.UNSIGNED_SHORT,e,s):u.default.ANGLE_instanced_arrays.drawElementsInstancedANGLE(this.TRIANGLES,t,e,s)}createUBOBufferByBytesCount(t){let e=this.Au.createBuffer();return this.Au.bindBuffer(this.Au.UNIFORM_BUFFER,e),this.Au.bufferData(this.Au.UNIFORM_BUFFER,t,this.Au.DYNAMIC_DRAW),e}createUBOBufferByDataArray(t){let e=this.Au.createBuffer();return this.Au.bindBuffer(this.Au.UNIFORM_BUFFER,e),this.Au.bufferData(this.Au.UNIFORM_BUFFER,t,this.Au.DYNAMIC_DRAW),e}bindUBOBuffer(t){this.Au.bindBuffer(this.Au.UNIFORM_BUFFER,t)}deleteUBOBuffer(t){this.Au.deleteBuffer(t)}bufferDataUBOBuffer(t){this.Au.bufferData(this.Au.UNIFORM_BUFFER,t,this.Au.STATIC_DRAW)}bindBufferBaseUBOBuffer(t,e){this.Au.bindBufferBase(this.Au.UNIFORM_BUFFER,t,e)}setWebGLMaxVersion(t){1!=t&&2!=t||(this.L_=t)}getContext(){return this.FU}getStage3D(){return this.FU.getStage()}getRenderAdapter(){return this.t_}getRenderContext(){return this.t_.getRenderContext()}setCameraParam(t,e,s){this.x_=t,this.v_=e,this.w_=s}getMouseXYWorldRay(t,e){let s=this.FU.getStage();this.A_O.getWorldPickingRayByScreenXY(s.mouseX,s.mouseY,t,e)}testViewPortChanged(t,e,s,i){return this.J!=t||this.K!=e||this.L!=s||this.M!=i}testRCViewPortChanged(t,e,s,i){return this.FU.testViewPortChanged(t,e,s,i)}getViewX(){return this.J}getViewY(){return this.K}getViewWidth(){return this.L}getViewHeight(){return this.M}setViewPort(t,e,s,i){this.FX=!1,this.J=t,this.K=e,this.L=s,this.M=i;let r=this.FU.getStage();null!=r&&(r.setViewPort(s,e,s,i),null!=this.A_O&&(this.A_O.setViewXY(this.J,this.K),this.A_O.setViewSize(this.L,this.M))),this.FU.setViewport(this.J,this.K,this.L,this.M)}setRCViewPort(t,e,s,i,r=!1){this.FX=r,this.FU.setViewport(t,e,s,i)}reseizeRCViewPort(){this.t_.unlockViewport(),this.t_.reseizeViewPort()}resizeCallback(){this.FX&&(this.J=0,this.K=0,this.L=this.FU.getRCanvasWidth(),this.M=this.FU.getRCanvasHeight(),this.createMainCamera(),this.FU.setViewport(this.J,this.K,this.L,this.M),this.A_O.setViewXY(this.J,this.K),this.A_O.setViewSize(this.L,this.M))}createMainCamera(){this.FY&&(this.FY=!1,this.A_O.uniformEnabled=!0,this.Cs?this.A_O.perspectiveRH(n.default.DegreeToRadian(this.x_),this.L/this.M,this.v_,this.w_):this.A_O.orthoRH(this.v_,this.w_,-.5*this.M,.5*this.M,-.5*this.L,.5*this.L),this.A_O.setViewXY(this.J,this.K),this.A_O.setViewSize(this.L,this.M))}readPixels(t,e,s,i,r,a,n){this.t_.readPixels(t,e,s,i,r,a,n)}getGLVersion(){return this.FV}initialize(t,e,s,i,n,h){if(null!=this.Au)return;this.A_O=e,null==e.matUProbe&&(e.matUProbe=new p.default,e.matUProbe.bindSlotAt(this.b),e.matUProbe.addMat4Data(new Float32Array(16),1),e.matUProbe.addMat4Data(new Float32Array(16),1)),null==e.ufrustumProbe&&(e.ufrustumProbe=new p.default,e.ufrustumProbe.bindSlotAt(this.b),e.ufrustumProbe.addVec4Data(new Float32Array([e.getZNear(),e.getZFar(),.5*e.getNearPlaneWidth(),.5*e.getNearPlaneHeight()]),1)),null==e.ucameraPosProbe&&(e.ucameraPosProbe=new p.default,e.ucameraPosProbe.bindSlotAt(this.b),e.ucameraPosProbe.addVec4Data(new Float32Array([500,500,500,1]),1));let o=t.camPosition,g=t.camLookAtPos,v=t.camUpDirect;null==o&&(o=new l.default(500,500,500)),null==g&&(g=new l.default(0,0,0)),null==v&&(v=new l.default(0,1,0)),this.Cs=t.cameraPerspectiveEnabled,this.FU.autoSyncRenderBufferAndWindowSize=t.autoSyncRenderBufferAndWindowSize,this.FU.setResizeCallback(this,this.resizeCallback),this.FU.setWebGLMaxVersion(this.L_),this.FU.initialize(this.b,s,t.getDiv(),t.getRenderContextAttri()),this.FV=this.FU.getWebGLVersion(),this.Au=this.FU.getRC(),f.default.Initialize(),f.default.Rstate.setRenderContext(this.FU);let x=this,T=this.Au,E=new d.default(this.b,T,h),y=new c.default(this.b,T);if(this.A_5=E,x.Vertex=E,x.Texture=y,x.MaterialUpdater=i,x.VtxBufUpdater=n,this.L=this.FU.getViewportWidth(),this.M=this.FU.getViewportHeight(),this.t_=new m.default(this.b,y),this.t_.initialize(this.FU,t,f.default.Rstate),x.adapter=this.t_,this.FX){let t=this.FU.getStage();null!=t&&(this.L=t.stageWidth,this.M=t.stageHeight)}this.createMainCamera(),this.FU.setViewport(this.J,this.K,this.L,this.M),this.A_O.lookAtRH(o,g,v),this.A_O.update(),this.t_.bgColor.setRGB3f(0,0,0),x.RGBA=T.RGBA,x.UNSIGNED_BYTE=T.UNSIGNED_BYTE,x.TRIANGLE_STRIP=T.TRIANGLE_STRIP,x.TRIANGLE_FAN=T.TRIANGLE_FAN,x.TRIANGLES=T.TRIANGLES,x.LINES=this.Au.LINES,x.LINE_STRIP=T.LINE_STRIP,x.UNSIGNED_SHORT=T.UNSIGNED_SHORT,x.UNSIGNED_INT=T.UNSIGNED_INT,x.COLOR=T.COLOR,x.DEPTH=T.DEPTH,x.STENCIL=T.STENCIL,x.DEPTH_STENCIL=T.DEPTH_STENCIL,this.FV>1?(x.MIN=T.MIN,x.MAX=T.MAX):(x.MIN=u.default.EXT_blend_minmax.MIN_EXT,x.MAX=u.default.EXT_blend_minmax.MAX_EXT);let S=r.default;S.NEAREST=T.NEAREST,S.LINEAR=T.LINEAR,S.LINEAR_MIPMAP_LINEAR=T.LINEAR_MIPMAP_LINEAR,S.NEAREST_MIPMAP_NEAREST=T.NEAREST_MIPMAP_NEAREST,S.LINEAR_MIPMAP_NEAREST=T.LINEAR_MIPMAP_NEAREST,S.NEAREST_MIPMAP_LINEAR=T.NEAREST_MIPMAP_LINEAR;let b=a.default;b.COLOR_BUFFER_BIT=T.COLOR_BUFFER_BIT,b.DEPTH_BUFFER_BIT=T.DEPTH_BUFFER_BIT,b.STENCIL_BUFFER_BIT=T.STENCIL_BUFFER_BIT,_.default.SetRenderer(this.FU),x.RState=f.default.Rstate,x.RContext=this.Au}flush(){this.Au.flush()}setClearRGBColor3f(t,e,s){this.t_.bgColor.setRGB3f(t,e,s)}setClearColor(t){this.t_.bgColor.copyFrom(t)}setClearUint24Color(t,e){this.t_.bgColor.setRGBUint24(t),this.t_.bgColor.a=e}setClearRGBAColor4f(t,e,s,i){this.t_.bgColor.setRGBA4f(t,e,s,i)}getClearRGBAColor4f(t){t.copyFrom(this.t_.bgColor)}getViewportWidth(){return this.t_.getViewportWidth()}getViewportHeight(){return this.t_.getViewportHeight()}setRenderToBackBuffer(){this.t_.setRenderToBackBuffer()}clearBackBuffer(){this.t_.clear()}renderBegin(){this.A_O.update(),this.t_.renderBegin()}renderEnd(){}useRenderStateByName(t){h.RenderStateObject.UseRenderStateByName(t)}setScissorEnabled(t){this.FU.setScissorEnabled(t)}setScissorRect(t,e,s,i){this.FU.setScissorRect(t,e,s,i)}useRenderColorMask(t){h.RenderColorMask.UseRenderState(t)}unlockRenderColorMask(){h.RenderColorMask.Unlock()}lockRenderColorMask(){h.RenderColorMask.Lock()}useRenderState(t){h.RenderStateObject.UseRenderState(t)}unlockRenderState(){h.RenderStateObject.Unlock()}lockRenderState(){h.RenderStateObject.Lock()}setVtxUpdateTimesTotal(t){this.A_5.setVtxUpdateTimesTotal(t)}setFrontFaceFlipped(t){this.t_.setFrontFaceFlipped(t)}enabledPolygonOffset(){this.t_.enabledPolygonOffset()}disabledPolygonOffset(){this.t_.disabledPolygonOffset()}setPolygonOffset(t,e=0){this.t_.setPolygonOffset(t,e)}resetPolygonOffset(){this.t_.resetPolygonOffset()}loseContext(){this.t_.loseContext()}isContextLost(){return this.t_.isContextLost()}setViewProbeValue(t,e,s,i){this.t_.setViewProbeValue(t,e,s,i)}toString(){return"[Object RenderProxy()]"}}e.default=g},debe:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("3221");class r extends i.UniformComp{constructor(){super(),this.FZ=null,this.Fa=null,this.Fb=null,this.Fc=-1,this.Fd=-1,this.Fe=-1,this.uvTransformEnabled=!1,this.curveMoveMap=null,this.displacementMap=null}initialize(){if(null==this.A_l){this.A_f="";let t=0;if(this.uvTransformEnabled&&(this.Fc=t,t++,this.A_f+="UV"),null!=this.curveMoveMap&&(this.Fd=t,t++,this.A_f+="CM"),null!=this.displacementMap&&(this.Fe=t,t++,this.A_f+="DC"),t>0){this.A_l=new Float32Array(4*t);let e=this.Fc;e>=0&&(this.FZ=this.A_l.subarray(4*e,4*(e+1)),this.FZ.set([1,1,0,0])),e=this.Fd,e>=0&&(this.Fa=this.A_l.subarray(4*e,4*(e+1))),e=this.Fe,e>=0&&(this.Fb=this.A_l.subarray(4*e,4*(e+1)),this.Fb.set([10,0,0,0]))}}}use(t){this.getParamsTotal()>0&&(t.addVertUniform("vec4","u_vertLocalParams",this.getParamsTotal()),this.Fd>=0&&t.addVertLayout("vec4","a_vs"),this.Fc>=0&&t.addDefine("VOX_VTX_TRANSFORM_PARAM_INDEX",""+this.Fc))}reset(){}destroy(){}getTextures(t,e=null){return this.getParamsTotal()>0?(null==e&&(e=[]),this.Fd>=0&&(e.push(this.curveMoveMap),t.uniform.add2DMap("VTX_CURVE_MOVE_MAP",!1,!1,!0),t.addDefine("VOX_VTX_CURVE_MOVE_PARAM_INDEX",""+this.Fd)),this.Fe>=0&&(e.push(this.displacementMap),t.uniform.addDisplacementMap(this.Fe)),e):null}setCurveMoveParam(t,e){null!=this.Fa&&(this.Fa[0]=1/t,this.Fa[2]=e)}setCurveMoveDistance(t){null!=this.Fa&&(this.Fa[1]=t)}setUVScale(t,e){null!=this.FZ&&(this.FZ[0]=t,this.FZ[1]=e)}getUVScale(t){null!=this.FZ&&(t.x=this.FZ[0],t.y=this.FZ[1])}setUVTranslation(t,e){null!=this.FZ&&(this.FZ[2]=t,this.FZ[3]=e)}setDisplacementParams(t,e){null!=this.Fb&&(this.Fb[0]=t,this.Fb[1]=e)}clone(){let t=new r;return t.uvTransformEnabled=this.uvTransformEnabled,t.displacementMap=this.displacementMap,t.curveMoveMap=this.curveMoveMap,t}buildShaderUniformData(t){this.getParamsTotal()>0&&(t.uniformNameList.push("u_vertLocalParams"),t.dataList.push(this.getParams()))}}e.VertUniformComp=r},df25:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("68aa")),n=i(s("0851"));class l extends n.default{constructor(t,e,s=!1){super(t,e,s),this.B_7=null,this.Ff=null,this.CF=0,this.CD=null,this.CE=null,this.minFilter=r.TextureConst.LINEAR}setDataFromBytes(t,e=0,s=-1,i=-1,r=0,n=0,l=!1){if(null!=t&&s>0&&i>0){e<0&&(e=0),e>15&&(e=15),e>=this.CF&&(this.CF=e+1),this.u=!0;let h=this.CD;null!=h?this.CD.miplevel!=e&&(null==this.CE&&(this.CE=[this.CD,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),h=this.CE[e],null==h&&(h=a.default.Create(),h.miplevel=e,l=!0,this.CE[e]=h)):(this.CD=h=a.default.Create(),h.miplevel=e,l=!0),h.data==t&&h.offsetx==r&&h.offsety==n||(0==e&&(this.o=s,this.p=i,this.B_7=t),h.data=t,h.status=0,(h.width<s||h.height<i||l)&&(h.width=s,h.height=i,h.status=1),h.offsetx=r,h.offsety=n),this.version++}}uploadData(t){null!=this.CD&&this.dataUploadToGpu(t.getRC(),this.CD,this.CE,!0)}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())){let e=t.getRC(),s=null!=this.Ff?this.Ff.length:0;if(this.__$updateToGpuBegin(t),s>0){let t=0,i=null,n=r.TextureFormat.ToGL(e,this.internalFormat),l=r.TextureFormat.ToGL(e,this.srcFormat),h=r.TextureDataType.ToGL(e,this.dataType);for(;t<s;++t)i=this.Ff.pop(),i.updateToGpu(e,this.t,n,l,h,!1),a.default.Restore(i)}null!=this.CD&&(this.dataUploadToGpu(e,this.CD,this.CE),this.__$buildParam(e),this.w=!0),this.__$updateToGpuEnd(e)}}setPartDataFromeBytes(t,e,s,i,r,n=0){null==this.Ff&&(this.Ff=[]);let l=a.default.Create();l.data=t,l.status=0,l.miplevel=n,l.offsetx=e,l.offsety=s,l.width=i,l.height=r,this.Ff.push(l),this.version++}getPixels(t,e,s,i,a){if(null!=this.B_7&&null!=a){let n=this.unpackAlignment,l=s*i*n;if(a.length==l){let h=e,o=t,m=h+i,_=o+s,u=0;switch(this.srcFormat){case r.TextureFormat.ALPHA:for(;h<m;++h)for(o=t;o<_;++o)l=h*this.o+o,a[u]=this.B_7[l],u++;break;case r.TextureFormat.RGBA:for(;h<m;++h)for(o=t;o<_;++o)l=(h*this.o+o)*n,a[u]=this.B_7[l],a[u+1]=this.B_7[l+1],a[u+2]=this.B_7[l+2],a[u+3]=this.B_7[l+3],u++;break;case r.TextureFormat.RGB:for(;h<m;++h)for(o=t;o<_;++o)l=(h*this.o+o)*n,a[u]=this.B_7[l],a[u+1]=this.B_7[l+1],a[u+2]=this.B_7[l+2],u++;break;default:break}}}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.CE){for(let t=0;t<this.CF;++t)a.default.Restore(this.CE[t]);this.CF=0,this.CE=null,this.CD=null}null!=this.CD&&(a.default.Restore(this.CD),this.CD=null),this.B_7=null,super.__$destroy()}}toString(){return"[RawDataTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=l},df9d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.b=-1,this.A_E=null,this.A_F=null,this.Fg=new Map,this.Fh=new Map,this.Fi=1,this.Fj=0,this.Fk=[],this.Fl=[],this.Fm=[],this.Fn=[],this.Fo=0,this.Fp=[],this.Fq=[],this.Fr=[],this.AE=[],this.AF=0,this.b=i.F_0++}getFreeVtxId(){return this.Fm.length>0?this.Fm.pop():-1}getVtxIndex(){let t=-1,e=this.getFreeVtxId();return e>=0?(t=e,this.Fn[e]=0,this.Fk[e]=this.Fi):(t=this.Fo,this.Fn.push(0),this.Fl.push(this.Fj),this.Fk.push(this.Fi),this.Fo++),t}restoreVtxIndex(t){this.Fk[t]==this.Fi&&(this.Fm.push(t),this.Fk[t]=this.Fj,this.Fn[t]=0)}attachVtxAt(t){++this.Fn[t]}detachVtxAt(t){this.Fn[t]>0&&(--this.Fn[t],this.Fn[t]<1&&this.restoreVtxIndex(t))}getVtxTotalAt(t){return this.Fn[t]}getFreeTexId(){return this.Fr.length>0?this.Fr.pop():-1}getTexIndex(){let t=-1,e=this.getFreeTexId();return e>=0?(t=e,this.AE[e]=0,this.Fp[e]=this.Fi):(t=this.AF,this.AE.push(0),this.Fq.push(this.Fj),this.Fp.push(this.Fi),this.AF++),t}restoreTexIndex(t){this.Fp[t]==this.Fi&&(this.Fr.push(t),this.Fp[t]=this.Fj,this.AE[t]=0)}attachTexAt(t){++this.AE[t]}detachTexAt(t){this.AE[t]>0&&(--this.AE[t],this.AE[t]<1&&this.restoreTexIndex(t))}getTexTotalAt(t){return this.AE[t]}destroy(){this.clear()}clear(){this.A_E=this.A_F=null,this.Fg=new Map,this.Fh=new Map,this.Fk=[],this.Fl=[],this.Fn=[],this.Fm=[],this.Fo=0,this.Fp=[],this.Fq=[],this.AE=[],this.Fr=[],this.AF=0}getBegin(){return this.A_E}containsNode(t){let e=this.Fg.get(t.vtxUid);if(null!=e){let s=131*(31+e.rvroI);return s*=s+e.texMid,t.rtokey==s}return!1}addNodeAndSort(t){let e=this.Fg.get(t.vtxUid);if(null==e){this.Fg.set(t.vtxUid,t),t.rvroI=this.getVtxIndex(),this.attachVtxAt(t.rvroI);let e=131*(31+t.rvroI);e*=e+t.texMid,t.rtokey=e,t.rtroI=this.getTexIndex(),this.Fh.set(e,t.rtroI),this.attachTexAt(t.rtroI)}else{t.rvroI=e.rvroI,this.attachVtxAt(t.rvroI);let s=131*(31+t.rvroI);if(s*=s+t.texMid,this.Fh.has(s)?t.rtroI=this.Fh.get(s):(t.rtroI=this.getTexIndex(),this.Fh.set(s,t.rtroI)),t.rtokey=s,this.attachTexAt(t.rtroI),e!=this.A_F)if(e.texMid==t.texMid)e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;else while(null!=e){if(e.vtxUid!=t.vtxUid){e=e.prev,e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.texMid==t.texMid){e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.next==this.A_F){this.A_F.vtxUid!=t.vtxUid?(e.next.prev=t,t.next=e.next,t.prev=e,e.next=t):e=null;break}e=e.next}else e=null}null==e&&(null==this.A_E?this.A_F=this.A_E=t:null!=this.A_F.prev?(this.A_F.next=t,t.prev=this.A_F,this.A_F=t):(this.A_E.next=t,t.prev=this.A_F,this.A_F=t),this.A_F.next=null)}showInfo(){let t=this.getBegin();if(null!=t){let e="",s="",i="";while(null!=t)e+=t.vtxUid+",",s+=t.texMid+",",i+=t.ivsCount+",",t=t.next}}removeNodeAndSort(t){let e=this.Fg.get(t.vtxUid);e!=t?e=null:(this.Fg.set(t.vtxUid,null),null!=t.next&&t.next.vtxUid==t.vtxUid?this.Fg.set(t.vtxUid,t.next):null!=t.prev&&t.prev.vtxUid==t.vtxUid?this.Fg.set(t.vtxUid,t.prev):this.Fg.delete(t.vtxUid)),t==this.A_E?t==this.A_F?this.A_E=this.A_F=null:(this.A_E=t.next,this.A_E.prev=null):t==this.A_F?(this.A_F=t.prev,this.A_F.next=null):(t.next.prev=t.prev,t.prev.next=t.next),this.detachVtxAt(t.rvroI),this.detachTexAt(t.rtroI),t.prev=null,t.next=null}addNode(t){null==this.A_E?this.A_F=this.A_E=t:null!=this.A_F.prev?(this.A_F.next=t,t.prev=this.A_F,this.A_F=t):(this.A_E.next=t,t.prev=this.A_F,this.A_F=t),this.A_F.next=null}removeNode(t){t==this.A_E?t==this.A_F?this.A_E=this.A_F=null:(this.A_E=t.next,this.A_E.prev=null):t==this.A_F?(this.A_F=t.prev,this.A_F.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}i.F_0=0,e.default=i},e08e:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.ELEMENTS_TRIANGLES=1,i.ELEMENTS_TRIANGLE_STRIP=2,i.ELEMENTS_TRIANGLE_FAN=3,i.ELEMENTS_INSTANCED_TRIANGLES=4,i.ARRAYS_LINES=5,i.ARRAYS_LINE_STRIP=6,i.ARRAYS_POINTS=7,i.ELEMENTS_LINES=8,i.DISABLE=0,e.RenderDrawMode=i;class r{}r.NORMAL=1,r.OPAQUE=1,r.TRANSPARENT=2,r.ALPHA_ADD=3,r.ADD=4,r.ADD_LINEAR=5,r.INVERSE_ALPHA=6,r.BLAZE=7,r.OVERLAY=8,r.OVERLAY2=8,r.DISABLE=0,e.RenderBlendMode=r;class a{}a.NEVER=1,a.LESS=1,a.EQUAL=1,a.GREATER=1,a.NOTEQUAL=1,a.GEQUAL=1,a.ALWAYS=1,e.GLStencilFunc=a;class n{}n.KEEP=1,n.ZERO=1,n.REPLACE=1,n.INCR=1,n.INCR_WRAP=1,n.DECR=1,n.DECR_WRAP=1,n.INVERT=1,e.GLStencilOp=n;class l{}l.ZERO=1,l.ONE=1,l.SRC_COLOR=1,l.DST_COLOR=1,l.SRC_ALPHA=1,l.DST_ALPHA=1,l.ONE_MINUS_SRC_ALPHA=1,e.GLBlendMode=l;class h{}h.FUNC_ADD=1,h.FUNC_SUBTRACT=1,h.FUNC_REVERSE_SUBTRACT=1,h.MIN_EXT=1,h.MAX_EXT=1,h.MIN=1,h.MAX=1,e.GLBlendEquation=h;class o{}o.BACK=1,o.FRONT=2,o.FRONT_AND_BACK=3,o.NONE=0,o.DISABLE=0,e.CullFaceMode=o;class m{}m.NEVER=1,m.ALWAYS=2,m.SKY=3,m.TRUE_LESS_EQUAL=3,m.OPAQUE=4,m.TRUE_LESS=4,m.OPAQUE_OVERHEAD=5,m.FALSE_EQUAL=5,m.FALSE_LESS=6,m.BLEND=6,m.BLEND_SORT=6,m.TRANSPARENT_SORT=6,m.TRUE_LEQUAL=7,m.WIRE_FRAME=7,m.FALSE_LEQUAL=8,m.DECALS=8,m.NEXT_LAYER=11,m.WIRE_FRAME_NEXT=12,m.TRUE_EQUAL=13,m.TRUE_GREATER=14,m.TRUE_GEQUAL=15,m.DISABLE=0,e.DepthTestMode=m;class _{}_.SCENE_RO_FILTER_BEGIN=1<<19,_.SCENE_RO_FILTER_FINISH=2<<19,_.SCENE_RO_ERASE=0,e.RenderConst=_,function(t){t[t["NOT_IN_RENDERER"]=-1]="NOT_IN_RENDERER",t[t["GO_TO_RENDERER"]=1]="GO_TO_RENDERER",t[t["LIVE_IN_RENDERER"]=2]="LIVE_IN_RENDERER"}(e.DisplayRenderSign||(e.DisplayRenderSign={}))},e214:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("f48d")),l=i(s("81c4"));class h extends n.default{constructor(){super(...arguments),this.nv=new a.default(0,1,0),this.distance=0,this.intersectBoo=!1}intersectStraightLinePos(t,e){let s=this.nv.dot(t.tv);if(s>r.default.MATH_MIN_POSITIVE||s<r.default.MATH_MAX_NEGATIVE){let i=this.nv.dot(t.position)-this.distance;return e.x=1e5*t.tv.x+t.position.x,e.y=1e5*t.tv.y+t.position.y,e.z=1e5*t.tv.z+t.position.z,s=this.nv.dot(e)-this.distance,s=i/(i-s),e.subtractBy(t.position),e.scaleBy(s),e.addBy(t.position),1}return s=this.nv.dot(t.position)-this.distance,s<=r.default.MATH_MIN_POSITIVE||s>=r.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),2):0}intersectStraightLinePos2(t,e,s){let i=this.nv.dot(e);if(i>r.default.MATH_MIN_POSITIVE||i<r.default.MATH_MAX_NEGATIVE){let r=this.nv.dot(t)-this.distance;return s.x=1e5*e.x+t.x,s.y=1e5*e.y+t.y,s.z=1e5*e.z+t.z,i=this.nv.dot(s)-this.distance,i=r/(r-i),s.subtractBy(t),s.scaleBy(i),s.addBy(t),1}return i=this.nv.dot(t)-this.distance,i<=r.default.MATH_MIN_POSITIVE||i>=r.default.MATH_MAX_NEGATIVE?(s.copyFrom(t),2):0}intersectRadialLinePos(t,e){let s=this.nv.dot(t.position)-this.distance;if(s>r.default.MATH_MIN_POSITIVE){let s=this.nv.dot(t.tv);if(s<0)return this.intersectStraightLinePos2(t.position,t.tv,e)}else{if(!(s<r.default.MATH_MAX_NEGATIVE)){let s=this.nv.dot(t.tv);return s>r.default.MATH_MIN_POSITIVE||s<r.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),1):(e.copyFrom(t.position),2)}{let s=this.nv.dot(t.tv);if(s>0)return this.intersectStraightLinePos2(t.position,t.tv,e)}}return-1}intersectRadialLinePos2(t,e,s){let i=this.nv.dot(t)-this.distance;if(i>r.default.MATH_MIN_POSITIVE){let i=this.nv.dot(e);if(i<0)return this.intersectStraightLinePos2(t,e,s)}else{if(!(i<r.default.MATH_MAX_NEGATIVE)){let i=this.nv.dot(e);return i>r.default.MATH_MIN_POSITIVE||i<r.default.MATH_MAX_NEGATIVE?(s.copyFrom(t),1):(s.copyFrom(t),2)}{let i=this.nv.dot(e);if(i>0)return this.intersectStraightLinePos2(t,e,s)}}return-1}containsPoint(t){let e=this.nv.dot(t)-this.distance;return e>r.default.MATH_MIN_POSITIVE?1:e<r.default.MATH_MAX_NEGATIVE?-1:0}intersectSphere(t,e){this.intersectBoo=!1;let s=this.nv.dot(t)-this.distance;return s>r.default.MATH_MIN_POSITIVE?(this.intersectBoo=s<=e,1):s<r.default.MATH_MAX_NEGATIVE?(this.intersectBoo=-s<=e,-1):0}intersectAABB(t,e){this.intersectBoo=!1;let s=n.default.__tV0;s.setXYZ(e.x,t.y,e.z);let i=this.containsPoint(s);return s.setXYZ(e.x,t.y,t.z),i+=this.containsPoint(s),s.setXYZ(t.x,t.y,t.z),i+=this.containsPoint(s),s.setXYZ(t.x,t.y,e.z),i+=this.containsPoint(s),s.setXYZ(e.x,e.y,e.z),i+=this.containsPoint(s),s.setXYZ(e.x,e.y,t.z),i+=this.containsPoint(s),s.setXYZ(t.x,e.y,t.z),i+=this.containsPoint(s),s.setXYZ(t.x,e.y,e.z),i+=this.containsPoint(s),this.intersectBoo=i<8,i<-7?-1:i>7?1:0}intersectSphNegSpace(t,e){this.intersectBoo=Math.abs(this.nv.dot(t)-this.distance)<e}update(){this.nv.normalize()}updateFast(){this.nv.normalize()}static PlaneIntersectSphere(t,e,s,i){h.IntersectBoo=!1,h.IntersectSatus=0,e=t.dot(s)-e,e>r.default.MATH_MIN_POSITIVE?(h.IntersectBoo=e<=i,h.IntersectSatus=1):e<r.default.MATH_MAX_NEGATIVE&&(h.IntersectBoo=-e<=i,h.IntersectSatus=-1)}static CalcPVCloseV(t,e,s){let i=t.distance-e.dot(t.nv);s.setTo(i*t.nv.x,i*t.nv.y,i*t.nv.z),s.addBy(e)}static CalcPVCloseV2(t,e,s,i){let r=e-s.dot(t);i.setTo(r*t.x,r*t.y,r*t.z),i.addBy(s)}static IntersectionSLV2(t,e,s,i,a){let n=t.dot(i);if(n>r.default.MATH_MIN_POSITIVE||n<r.default.MATH_MAX_NEGATIVE){let r=t.dot(s)-e;return a.x=1e5*i.x+s.x,a.y=1e5*i.y+s.y,a.z=1e5*i.z+s.z,n=t.dot(a)-e,n=r/(r-n),a.subtractBy(s),a.scaleBy(n),a.addBy(s),1}return n=t.dot(s)-e,n<=r.default.MATH_MIN_POSITIVE||n>=r.default.MATH_MAX_NEGATIVE?(a.copyFrom(s),2):0}toString(){return"Plane(position="+this.position.toString()+", nv="+this.nv.toString()+")"}}h.IntersectBoo=!1,h.IntersectSatus=0;class o extends h{constructor(){super(...arguments),this.v0=new a.default(100,0,0),this.v1=new a.default(0,0,-100),this.v2=new a.default(0,0,0),this.ls01=new l.default,this.ls12=new l.default,this.ls20=new l.default,this.radiusSquared=100}getRandomPosition(t){let e=this.ls01.length*Math.random();t.x=this.ls01.position.x+e*this.ls01.tv.x,t.y=this.ls01.position.y+e*this.ls01.tv.y,t.z=this.ls01.position.z+e*this.ls01.tv.z,e=this.ls12.length*Math.random(),t.x+=this.ls12.position.x+e*this.ls12.tv.x,t.y+=this.ls12.position.y+e*this.ls12.tv.y,t.z+=this.ls12.position.z+e*this.ls12.tv.z,e=this.ls20.length*Math.random(),t.x+=this.ls20.position.x+e*this.ls20.tv.x,t.y+=this.ls20.position.y+e*this.ls20.tv.y,t.z+=this.ls20.position.z+e*this.ls20.tv.z,t.x*=.33333,t.y*=.33333,t.z*=.33333}triIntersectStraightLinePos(t,e){let s=this.intersectStraightLinePos(t,e);return 1==s&&(s=this.triContainsPoint(e),s>0)?1:-1}triIntersectRadialLinePos(t,e){let s=this.intersectRadialLinePos(t,e);return 1==s&&(s=this.triContainsPoint(e),s>0)?1:-1}triIntersectStraightLinePos2(t,e,s){let i=this.intersectStraightLinePos2(t,e,s);return 1==i&&(i=this.triContainsPoint(s),i>0)?1:-1}triIntersectRadialLinePos2(t,e,s){let i=this.intersectStraightLinePos2(t,e,s);return 1==i&&(i=this.triContainsPoint(s),i>0)?1:-1}triContainsPoint(t){let e=this.nv.dot(t)-this.distance;return e>r.default.MATH_MIN_POSITIVE||e<r.default.MATH_MAX_NEGATIVE?-1:(n.default.__tV0.x=t.x-this.v0.x,n.default.__tV0.y=t.y-this.v0.y,n.default.__tV0.z=t.z-this.v0.z,a.default.Cross(this.ls01.tv,n.default.__tV0,n.default.__tV1),this.nv.dot(n.default.__tV1)<0?-1:(n.default.__tV0.x=t.x-this.v1.x,n.default.__tV0.y=t.y-this.v1.y,n.default.__tV0.z=t.z-this.v1.z,a.default.Cross(this.ls12.tv,n.default.__tV0,n.default.__tV1),this.nv.dot(n.default.__tV1)<0?-1:(n.default.__tV0.x=t.x-this.v2.x,n.default.__tV0.y=t.y-this.v2.y,n.default.__tV0.z=t.z-this.v2.z,a.default.Cross(this.ls20.tv,n.default.__tV0,n.default.__tV1),this.nv.dot(n.default.__tV1)<0?-1:1)))}update(){let t=1/3;this.position.x=t*(this.v0.x+this.v1.x+this.v2.x),this.position.y=t*(this.v0.y+this.v1.y+this.v2.y),this.position.z=t*(this.v0.z+this.v1.z+this.v2.z),this.nv.x=this.position.x-this.v0.x,this.nv.y=this.position.y-this.v0.y,this.nv.z=this.position.z-this.v0.z,this.radiusSquared=this.nv.getLengthSquared(),this.ls01.position.copyFrom(this.v0),this.ls01.anotherPosition.copyFrom(this.v1),this.ls12.position.copyFrom(this.v1),this.ls12.anotherPosition.copyFrom(this.v2),this.ls20.position.copyFrom(this.v2),this.ls20.anotherPosition.copyFrom(this.v0),this.ls01.update(),this.ls12.update(),this.ls20.update(),a.default.Cross(this.ls01.tv,this.ls12.tv,this.nv),this.nv.normalize(),this.distance=this.nv.dot(this.v0)}updateFast(){this.update()}}e.Triangle=o,e.default=h},e439:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("bd6f")),n=i(s("c51d")),l=i(s("9bb7")),h=i(s("e8e6")),o=i(s("b498")),m=i(s("29ef")),_=i(s("829f"));class u{constructor(t){this.A=null,this.Fs=null,this.Ft=null,this.Fu=null,this.Fv=null,this.Fw=null,this.Fx=null,this.Fy=null,this.E_L=new r.default(600,800,-600),this.Fz=-5e-4,this.F0=2,this.F1=.8,this.F2=.1,this.F3=128,this.F4=128,this.AT=1300,this.AU=1300,this.F5=.01,this.F6=3e3,this.F7=null,this.F8=null,this.AN=0,this.F9=null,this.F_A=-1,this.F_B=-1,this.F_C=!1,this.F_D=-1,this.F_E=120,this.force=!0,this.AN=t}initialize(t,e,s=120,i=!1){null==this.A&&(this.A=t,this.F_E=s,this.F9=e.slice(0),this.initConfig(e,!1))}setMapSize(t,e){this.F3=t,this.F4=e}setCameraPosition(t){this.E_L.copyFrom(t)}setCameraNear(t){this.F5=t}setCameraFar(t){this.F6=t}setCameraViewSize(t,e){this.AT=t,this.AU=e}setShadowRadius(t){this.F0=t}setShadowBias(t){this.Fz=t}setShadowIntensity(t){this.F1=t,null!=this.Fs&&this.Fs.setShadowIntensity(this.F1)}setColorIntensity(t){this.F2=t,null!=this.Fs&&this.Fs.setColorIntensity(this.F2)}getShadowMap(){return null!=this.Fy?this.Fy.getDstTexture():this.F7}getVSMData(){return this.Fs}getCamera(){return this.Ft}setRendererProcessIDList(t){null!=this.Fu&&(this.F9=t.slice(0),this.Fu.setRProcessIDList(t))}initConfig(t,e=!1){let s;this.Fs=new o.default,this.Fs.initialize(),this.Fs.setShadowIntensity(this.F1),this.Fu=this.A.createFBOInstance(),this.Fu.asynFBOSizeWithViewport(),this.Fu.setClearRGBAColor4f(1,1,1,1),this.Fu.createFBOAt(this.AN,this.F3,this.F4,!0,!1),this.F7=this.Fu.setRenderToRGBATexture(null,0),this.Fu.setRProcessIDList(t),this.Fu.setGlobalRenderState(m.default.NORMAL_STATE),this.Fu.setGlobalMaterial(new l.default),this.Fv=this.A.createFBOInstance(),this.Fv.asynFBOSizeWithViewport(),this.Fv.setClearRGBAColor4f(1,1,1,1),this.Fv.createFBOAt(this.AN,this.F3,this.F4,!0,!1),this.F8=this.Fv.setRenderToRGBATexture(null,0),s=new h.default(!1),s.setShadowRadius(this.F0);let i=new a.default;i.setMaterial(s),i.initializeXOY(-1,-1,2,2,[this.F7]),this.Fw=i,s=new h.default(!0),s.setShadowRadius(this.F0);let r=new a.default;r.copyMeshFrom(i),r.setMaterial(s),r.initializeXOY(-1,-1,2,2,[this.F8]),this.Fx=r,this.F_C=e,e&&(this.Fy=new _.default(this.A.getRenderer()),this.Fy.setBlurCount(2),this.Fy.setSyncViewSizeEnabled(!1),this.Fy.setFBOSize(this.F3,this.F4),this.Fy.setBlurDensity(1),this.Fy.bindDrawEntity(this.Fw),this.Fy.setBackbufferVisible(!1)),this.Ft=new n.default,this.Fs.setShadowMap(this.getShadowMap()),this.updateData()}updateData(){if(null!=this.Ft){let t=this.AT,e=this.AU;this.Ft.lookAtRH(this.E_L,r.default.ZERO,r.default.Z_AXIS),this.Ft.orthoRH(this.F5,this.F6,-.5*e,.5*e,-.5*t,.5*t),this.Ft.setViewXY(0,0),this.Ft.setViewSize(t,e),this.Ft.update()}null!=this.Fs&&(this.Fu.resizeFBO(this.F3,this.F4),this.Fv.resizeFBO(this.F3,this.F4),this.F_C&&this.Fy.setFBOSize(this.F3,this.F4),this.Fs.updateShadowCamera(this.Ft),this.Fs.setShadowRadius(this.F0),this.Fs.setShadowBias(this.Fz),this.Fs.setShadowSize(this.F3,this.F4),this.Fs.update())}upate(){this.F_E=32,this.F_D=this.Ft.version,this.updateData()}getRendererProcessStatus(){let t=31;for(let e=0;e<this.F9.length;++e)t+=t*this.A.getRenderProcessAt(e).getStatus();return t}run(){this.Ft.version!=this.F_D&&(this.F_D=this.Ft.version,this.Fs.updateShadowCamera(this.Ft),this.Fs.update());let t=this.force;if(t)this.buildShadow();else{if(this.F_A!=this.A.getRendererStatus()){let e=this.getRendererProcessStatus();this.F_B!=e&&(this.F_B=e,t=!0),this.F_A=this.A.getRendererStatus()}this.F_E>0&&(this.F_E%15==0&&(t=!0),this.F_E--),t&&this.buildShadow()}this.force=!1}buildShadow(){this.Fu.useCamera(this.Ft),this.Fu.run(!0,!0),this.Fu.useMainCamera(),this.Fv.setRenderToRGBATexture(this.F8,0),this.Fv.runBegin(),this.Fv.drawEntity(this.Fw),this.Fv.runEnd(),this.Fv.setRenderToRGBATexture(this.F7,0),this.Fv.runBegin(),this.Fv.drawEntity(this.Fx),this.Fv.runEnd(),null!=this.Fy&&this.Fy.run(),this.Fv.setRenderToBackBuffer()}}e.ShadowVSMModule=u,e.default=u},e753:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("3077")),n=s("5216"),l=s("c70f"),h=i(s("6e01")),o=s("8602"),m=s("6a30"),_=s("f043");class u{constructor(t=0){this.b=-1,this.C_3=new l.GlobalLightUniformParam,this.C_4=null,this.C_5=null,this.C_7=0,this.F_F=null,this.F_G=null,this.F_H=0,this.F_I=0,this.F_J=null,this.F_K=null,this.F_L=null,this.C_7=t,this.b=u.F_0++}getUid(){return this.b}getPointLightsTotal(){return null!=this.F_J?this.F_J.length:0}getDirecLightsTotal(){return null!=this.F_K?this.F_K.length:0}getSpotLightsTotal(){return null!=this.F_L?this.F_L.length:0}getPointLightAt(t){return null!=this.F_J&&t>=0&&t<this.F_J.length?this.F_J[t]:null}getDirectionLightAt(t){return null!=this.F_K&&t>=0&&t<this.F_K.length?this.F_K[t]:null}getSpotLightAt(t){return null!=this.F_L&&t>=0&&t<this.F_L.length?this.F_L[t]:null}appendPointLight(){null==this.F_J&&(this.F_J=[]);let t=new o.PointLight;return this.F_J.push(t),this.F_I++,t}appendDirectionLight(){null==this.F_K&&(this.F_K=[]);let t=new m.DirectionLight;return this.F_K.push(t),this.F_I++,t}appendSpotLight(){null==this.F_L&&(this.F_L=[]);let t=new _.SpotLight;return this.F_L.push(t),this.F_I++,t}updatePointLightData(){if(null!=this.F_J){let t,e=this.F_F,s=this.F_G,i=0;for(let r=0;r<this.F_J.length;++r)t=this.F_J[r],i=4*r,e[i]=t.position.x,e[i+1]=t.position.y,e[i+2]=t.position.z,e[i+3]=t.attenuationFactor1,s[i]=t.color.r,s[i+1]=t.color.g,s[i+2]=t.color.b,s[i+3]=t.attenuationFactor2}}updateDirecLighttData(){if(null!=this.F_K){let t,e=this.F_F,s=this.F_G,i=0,r=null!=this.F_J?this.F_J.length:0;r*=4;for(let a=0;a<this.F_K.length;++a)t=this.F_K[a],i=r+4*a,e[i]=t.direction.x,e[i+1]=t.direction.y,e[i+2]=t.direction.z,e[i+3]=t.attenuationFactor1,s[i]=t.color.r,s[i+1]=t.color.g,s[i+2]=t.color.b,s[i+3]=t.attenuationFactor2}}updateSpotLighttData(){if(null!=this.F_L){let t,e=this.F_F,s=this.F_G,i=0,r=null!=this.F_J?this.F_J.length:0;r+=null!=this.F_K?this.F_K.length:0,r*=4;for(let a=0;a<this.F_L.length;++a)t=this.F_L[a],i=r+4*a,e[i]=t.position.x,e[i+1]=t.position.y,e[i+2]=t.position.z,e[i+3]=t.attenuationFactor1,s[i]=t.color.r,s[i+1]=t.color.g,s[i+2]=t.color.b,s[i+3]=t.attenuationFactor2;r+=4*this.F_L.length;for(let a=0;a<this.F_L.length;++a){t=this.F_L[a];let s=90-h.default.Clamp(t.angleDegree,0,90);s=Math.cos(h.default.DegreeToRadian(s)),i=r+4*a,e[i]=t.direction.x,e[i+1]=t.direction.y,e[i+2]=t.direction.z,e[i+3]=s}}}buildData(){if(null==this.C_4){let t=this.F_I,e=this.F_I,s=4*t;this.F_H=this.F_I,null==this.F_L||(s+=4*this.F_L.length,this.F_H+=this.F_L.length),null==this.F_F&&(this.F_F=new Float32Array(s)),null==this.F_G&&(this.F_G=new Float32Array(4*e)),this.C_4=new a.default,this.C_4.bindSlotAt(this.C_7),this.C_4.addVec4Data(this.F_F,this.F_H),this.C_4.addVec4Data(this.F_G,e),this.C_5=this.C_3.createGlobalUinform(this.C_4)}this.updatePointLightData(),this.updateDirecLighttData(),this.updateSpotLighttData()}update(){this.buildData(),this.C_4.update()}showInfo(){}resetPipe(){}getTextures(t,e,s){return null}useShaderPipe(t,e){if(null!=this.C_4){t.normalEnabled=!0;let e=this.getPointLightsTotal()+this.getDirecLightsTotal()+this.getSpotLightsTotal();e>0?(t.addDefine("VOX_LIGHTS_TOTAL",""+e),this.getPointLightsTotal()>0?t.addDefine("VOX_POINT_LIGHTS_TOTAL",""+this.getPointLightsTotal()):t.addDefine("VOX_POINT_LIGHTS_TOTAL","0"),this.getDirecLightsTotal()>0?t.addDefine("VOX_DIRECTION_LIGHTS_TOTAL",""+this.getDirecLightsTotal()):t.addDefine("VOX_DIRECTION_LIGHTS_TOTAL","0"),this.getSpotLightsTotal()>0?t.addDefine("VOX_SPOT_LIGHTS_TOTAL",""+this.getSpotLightsTotal()):t.addDefine("VOX_SPOT_LIGHTS_TOTAL","0")):t.addDefine("VOX_LIGHTS_TOTAL","0"),this.C_3.use(t,this.F_H,this.F_I)}}getPipeTypes(){return[n.MaterialPipeType.GLOBAL_LIGHT]}getPipeKey(t){switch(t){case n.MaterialPipeType.GLOBAL_LIGHT:let e="";if(this.getPointLightsTotal()>0&&(e=""+this.getPointLightsTotal()),this.getDirecLightsTotal()>0&&(e+=""+this.getDirecLightsTotal()),this.getSpotLightsTotal()>0&&(e+=""+this.getSpotLightsTotal()),""!=e)return"["+t+":"+e+"]";break;default:break}return""}useUniforms(t){null!=this.C_4&&(t.addFragUniform(r.default.GlobalLight.type,r.default.GlobalLight.positionName,this.F_H),t.addFragUniform(r.default.GlobalLight.type,r.default.GlobalLight.colorName,this.F_I))}getGlobalUinform(){return this.C_5.clone()}}u.F_0=0,e.LightModule=u},e7ce:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("faa5")),a=i(s("b3bd")),n=i(s("0fc4"));class l extends r.default{constructor(){super(),this.j_=""}initialize(t){this.j_="PixelPickIndexShd"}getFragShaderCode(){let t="#version 300 es\nprecision highp float;\nuniform vec4 u_param;\nin vec3 v_viewPos;\n//in float v_length;\nlayout(location = 0) out vec4 FragColor0;\nvoid main()\n{\nvec4 p = vec4(length(v_viewPos.xyz));\np.x = floor(p.x)/256.0;\np.y = floor(fract(p.x) * 256.0)/255.0;\np.x = floor(p.x) / 255.0;\np.z = fract(p.z);\nFragColor0 = vec4(p.xyz,u_param.w);\n}\n";return t}getVertShaderCode(){let t="#version 300 es\nprecision highp float;\nlayout(location = 0) in vec3 a_vs;\nuniform mat4 u_objMat;\nuniform mat4 u_viewMat;\nuniform mat4 u_projMat;\nout vec3 v_viewPos;\n//out float v_length;\nvoid main(){\nmat4 viewMat4 = u_viewMat * u_objMat;\nvec4 viewPos = viewMat4 * vec4(a_vs, 1.0);\nv_viewPos = viewPos.xyz;\n//v_length = length(viewPos.xyz);\ngl_Position = u_projMat * viewPos;\n}\n";return t}getUniqueShaderName(){return this.j_}toString(){return"[PixelPickIndexShaderBuffer()]"}static GetInstance(){return l.F_2}}l.F_2=new l,e.PixelPickIndexShaderBuffer=l;class h extends n.default{constructor(){super(),this.Bk=new Float32Array([1,1,1,1]),this.F_M=1/255}getCodeBuf(){return l.GetInstance()}setIndex(t){this.Bk[3]=t*this.F_M}getIndex(){return this.Bk[3]/this.F_M}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_param"],t.dataList=[this.Bk],t}}e.default=h},e7d2:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("710f")),n=i(s("f0f0")),l=i(s("7a04")),h=s("e08e");class o{constructor(t=r.default.VTX_STATIC_DRAW){this.b=0,this.F_N=null,this.B_t=null,this.E_0=0,this.F_O=2,this.layoutBit=0,this.vertexVer=0,this.indicesVer=0,this.version=0,this.drawMode=h.RenderDrawMode.ELEMENTS_TRIANGLES,this.bufData=null,this.b=o.F_0++,this.E_0=t}setVtxBuf(t){t!=this&&(this.F_N=t,null!=t&&(t.layoutBit=this.layoutBit))}getUid(){return this.b}getType(){return this.F_N.getType()}getIBufStep(){return this.F_O}getBufDataUsage(){return this.E_0}setBufDataUsage(t){this.E_0=t}getBuffersTotal(){return this.F_N.getBuffersTotal()}getAttribsTotal(){return this.F_N.getAttribsTotal()}getF32DataAt(t){return this.F_N.getF32DataAt(t)}getIvsData(){return this.B_t}setF32DataAt(t,e,s,i){this.F_N.setF32DataAt(t,e,s,i),this.vertexVer++}setUintIVSData(t,e=r.default.VTX_STATIC_DRAW){if(t instanceof Uint16Array)this.F_O=2;else{if(!(t instanceof Uint32Array))return;this.F_O=4}this.B_t=t,null!=t&&this.indicesVer++}setData4fAt(t,e,s,i,r,a){null!=this.F_N&&(this.F_N.setData4fAt(t,e,s,i,r,a),this.vertexVer++)}setData3fAt(t,e,s,i,r){null!=this.F_N&&(this.F_N.setData3fAt(t,e,s,i,r),this.vertexVer++)}setData2fAt(t,e,s,i){null!=this.F_N&&(this.F_N.setData2fAt(t,e,s,i),this.vertexVer++)}destroy(){}__$destroy(){this.F_N.destroy(),this.F_N.getType()<1?o.G_D.push(this.F_N):o.G_E.push(this.F_N),this.F_N=null,this.B_t=null,this.bufData=null}toString(){return"ROVertexBuffer(uid = "+this.b+")"}static GetFreeId(){return o.Gy.length>0?o.Gy.pop():-1}static GetVtxByUid(t){return o.Gz[t]}static Create(t=r.default.VTX_STATIC_DRAW){let e=null,s=o.GetFreeId();return s>=0?(e=o.Gz[s],e.setBufDataUsage(t),o.G0[s]=o.S_FLAG_BUSY):(e=new o(t),o.Gz.push(e),o.G0.push(o.S_FLAG_BUSY),o.G1++),e.vertexVer=0,e.indicesVer=0,e.version++,o.G_F.__$attachAt(e.getUid()),e}static __$Restore(t){if(null!=t&&o.G0[t.getUid()]==o.S_FLAG_BUSY){let e=t.getUid();o.Gy.push(e),o.G0[e]=o.S_FLAG_FREE,t.__$destroy()}}static __$$AttachAt(t){o.G_F.__$attachAt(t)}static __$$DetachAt(t){o.G_F.__$detachAt(t)}static Reset(){o.BufDataList=[],o.G_G=0,o.BufStatusList=[],o.BufDataStepList=[],o.vtxFS32=null,o.vbWholeDataEnabled=!1,o.dynBufSegEnabled=!1,o.useBufByIndexEnabled=!1}static AddFloat32Data(t,e,s=r.default.VTX_STATIC_DRAW){o.BufDataList.push(t),o.BufDataStepList.push(e),o.BufStatusList.push(s),o.G_G+=e}static CreateBySaveData(t=r.default.VTX_STATIC_DRAW,e=0){let s=0,i=0,a=0,l=o.BufDataStepList.length,h=[];for(;s<l;s++)h.push(a),a+=o.BufDataStepList[s];let m=o.BufDataList[0].length/o.BufDataStepList[0],_=new Float32Array(a*m),u=0,d=0,c=null,f=null;for(s=0;s<m;++s)for(i=s*a,u=0;u<l;++u)d=o.BufDataStepList[u],c=o.BufDataList[u],f=c.subarray(s*d,(s+1)*d),_.set(f,i),i+=d;let p=o.Create(t);if(p.layoutBit=e,o.G_D.length>0){let t=o.G_D.pop();p.setVtxBuf(t)}else p.setVtxBuf(new n.default(p.getBufDataUsage()));return p.setF32DataAt(0,_,a,h),p}static CreateVtxCombinedBuf(t,e,s=r.default.VTX_STATIC_DRAW,i=0){let a=0,l=0,h=e.length,m=[];for(;a<h;a++)m.push(l),l+=e[a];let _=o.Create(s);if(_.layoutBit=i,o.G_D.length>0){let t=o.G_D.pop();_.setVtxBuf(t)}else _.setVtxBuf(new n.default(_.getBufDataUsage()));return _.setF32DataAt(0,t,l,m),_}static UpdateBufData(t){let e=0,s=0,i=0,r=o.BufDataStepList.length,a=o.BufDataList[0].length/o.BufDataStepList[0],n=t.getF32DataAt(0),l=o.G_G*a!=n.length,h=null;if(l)for(h=[],n=new Float32Array(o.G_G*a);e<r;e++)h.push(i),i+=o.BufDataStepList[e];else i=o.G_G;let m=0,_=0,u=null,d=null;for(e=0;e<a;++e)for(s=e*i,m=0;m<r;++m)_=o.BufDataStepList[m],u=o.BufDataList[m],d=u.subarray(e*_,(e+1)*_),n.set(d,s),s+=_;l?t.setF32DataAt(0,n,i,h):t.setF32DataAt(0,n,i,null)}static CreateByBufDataSeparate(t,e=r.default.VTX_STATIC_DRAW,s=0){let i=0,a=0,n=t.getAttributesTotal(),h=new Array(n);h.fill(0);let m=o.Create(e);if(m.layoutBit=s,o.G_E.length>0){let t=o.G_E.pop();m.setVtxBuf(t)}else m.setVtxBuf(new l.default);for(i=0;i<n;i++)m.setF32DataAt(i,t.getAttributeDataAt(i,0),a,h);return m.setUintIVSData(t.getIndexDataAt(0)),m.bufData=t,m}static CreateBySaveDataSeparate(t=r.default.VTX_STATIC_DRAW){let e=0,s=0,i=o.BufDataStepList.length,a=new Array(i);a.fill(0);let n=o.Create(t);if(o.G_E.length>0){let t=o.G_E.pop();n.setVtxBuf(t)}else n.setVtxBuf(new l.default);for(e=0;e<i;e++)n.setF32DataAt(e,o.BufDataList[e],s,a);return n}static GetVtxAttachCountAt(t){return o.G_F.getAttachCountAt(t)}static GetVtxAttachAllCount(){return o.G_F.getAttachAllCount()}static ClearTest(){if(--o.G_H,o.G_H<1){o.G_H=128;let t=o.G_F;if(t.__$getRemovedListLen()>0){let e=t.__$getRemovedList(),s=e.length,i=0,r=0,a=null,n=32;for(s=s>n?n:s;i<s;++i)r=e.shift(),t.getAttachCountAt(r)<1&&(a=o.GetVtxByUid(r),o.__$Restore(a))}}}}o.F_0=0,o.G_D=[],o.G_E=[],o.S_FLAG_BUSY=1,o.S_FLAG_FREE=0,o.G0=[],o.G1=0,o.Gz=[],o.Gy=[],o.G_F=new a.default,o.G_G=0,o.BufDataList=null,o.BufDataStepList=null,o.BufStatusList=null,o.vtxDataFS32=null,o.vbWholeDataEnabled=!1,o.dynBufSegEnabled=!1,o.useBufByIndexEnabled=!1,o.vtxFS32=null,o.G_H=128,e.default=o},e87b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279"));class n{create(t,e){let s=null,i=r.default.ViewportParam;return e.hasUniformByName(i.name)&&(s=new a.default,s.uns=i.name,s.uniformNameList=[i.name],s.copyDataFromProbe(t.getRenderAdapter().uViewProbe)),s}getIDNS(){return"ViewParamUniformBuilder"}}e.default=n},e8e6:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("faa5")),a=i(s("b3bd")),n=i(s("0fc4"));class l extends r.default{constructor(){super(),this.j_="",this.Bf=!1,this.horizonal=!0}initialize(t){this.j_="OccBlurShd",this.Bf=t,t&&(this.j_+="_tex")}buildThisCode(){let t=this.A_j;this.horizonal&&t.addDefine("HORIZONAL_PASS"),t.addDefine("SAMPLE_RATE","0.25"),t.addDefine("HALF_SAMPLE_RATE","0.125"),t.addTextureSample2D("",!1),t.uniform.useViewPort(!1,!0),t.addFragUniform("vec4","u_param")}getFragShaderCode(){this.buildThisCode();let t=this.A_j;return t.addFragMainCode("\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n    vec4 r = vec4( fract( v * PackFactors ), v );\n    r.yzw -= r.xyz * ShiftRight8; // tidy overflow\n    return r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n    return dot( v, UnpackFactors );\n}\n\nvec4 pack2HalfToRGBA( vec2 v ) {\n    vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n    return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n    return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nvoid main() {\n\n    float mean = 0.0;\n    float squared_mean = 0.0;\n    \n    vec2 resolution = u_viewParam.zw;\n    \n    float radius = u_param[3];\n    // This seems totally useless but it's a crazy work around for a Adreno compiler bug\n    float depth = unpackRGBAToDepth( VOX_Texture2D( u_sampler0, ( gl_FragCoord.xy ) / resolution ) );\n\n    for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\n        #ifdef HORIZONAL_PASS\n\n            vec2 distribution = unpackRGBATo2Half( VOX_Texture2D( u_sampler0, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n            mean += distribution.x;\n            squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\n        #else\n\n            float depth = unpackRGBAToDepth( VOX_Texture2D( u_sampler0, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n            mean += depth;\n            squared_mean += depth * depth;\n\n        #endif\n\n    }\n\n    mean = mean * HALF_SAMPLE_RATE;\n    squared_mean = squared_mean * HALF_SAMPLE_RATE;\n\n    float std_dev = sqrt( squared_mean - mean * mean );\n\n    FragColor0 = pack2HalfToRGBA( vec2( mean, std_dev ) );\n\n}\n"),this.A_j.buildFragCode()}getVertShaderCode(){let t=this.A_j;return t.addVertMainCode("\nvoid main() {\n    gl_Position =  vec4(a_vs,1.0);\n}\n"),this.A_j.buildVertCode()}getUniqueShaderName(){return this.j_+(this.horizonal?"_h":"_v")}toString(){return"[OccBlurShaderBuffer()]"}static GetInstance(){return null!=l.F_2||(l.F_2=new l),l.F_2}}l.F_2=null;class h extends n.default{constructor(t){super(),this.F_P=!0,this.D_G=new Float32Array([1,1,1,4]),this.F_P=t}getCodeBuf(){let t=l.GetInstance();return t.horizonal=this.F_P,t}setShadowRadius(t){this.D_G[3]=t}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_param"],t.dataList=[this.D_G],t}}e.default=h},e943:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("32fa"));class a{constructor(){this.Ap=null,this.A_q=null,this.F_Q=null}initialize(t){null==this.A_q&&(this.A_q=t,this.Ap=this.A_q.createSeparatedProcess(),this.F_Q=new r.default,this.F_Q.initialize(this.A_q,this.Ap))}getFPS(){return this.F_Q.getFPS()}run(t=!1){null!=this.A_q&&(this.F_Q.run(t),this.A_q.runProcess(this.Ap))}toString(){return"[ProfileInstance]"}}e.default=a},eaee:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class n extends a.default{constructor(t,e){super(t,e,!1),this.B_v=null,this.s=r.TextureTarget.TEXTURE_CUBE,this.v=r.TextureProxyType.FloatCube,this.internalFormat=r.TextureFormat.RGBA16F,this.dataType=r.TextureDataType.FLOAT,this.mipmapEnabled=!0}toRGBFormat(){this.unpackAlignment=1,this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB16F,this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.mipmapEnabled=!1}toRGBFormatFloat32F(){this.unpackAlignment=1,this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB32F,this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.mipmapEnabled=!1}toRGBAFormat(){this.unpackAlignment=4,this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA16F}toRGBAFormatFloat32F(){this.unpackAlignment=4,this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA32F}toRGBAFormatHalfFloat(){this.unpackAlignment=1,this.srcFormat=r.TextureFormat.RGBA,this.dataType=r.TextureDataType.HALF_FLOAT,this.internalFormat=r.TextureFormat.RGBA16F}setDataFromBytesToFaceAt(t,e,s,i,r=0){if(null==this.B_v&&(this.B_v=[null,null,null,null,null,null]),s>0&&i>0){0==t&&r<1&&(this.o=s,this.p=i,this.n=r),null==this.B_v[t]&&(this.B_v[t]=new Array(16));let a=this.B_v[t];a[r]={width:s,height:i,imgData:e,miplevel:r},this.u=null!=a[r].imgData}}uploadData(t){let e,s,i=t.getRC(),a=null,n=this.getWidth(),l=this.getHeight();for(let h=0;h<6;++h){let t=this.B_v[h];if(this.mipmapEnabled&&this.w)a=t[0],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,r.TextureFormat.ToGL(i,this.internalFormat),n,l,0,r.TextureFormat.ToGL(i,this.srcFormat),r.TextureDataType.ToGL(i,this.dataType),a.imgData);else{e=n,s=l;let o=0;for(;e>0||s>0;)null!=t[o]&&(a=t[o],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+h,o,r.TextureFormat.ToGL(i,this.internalFormat),e,s,0,r.TextureFormat.ToGL(i,this.srcFormat),r.TextureDataType.ToGL(i,this.dataType),a.imgData)),e>0&&(e>>=1),s>0&&(s>>=1),++o}}this.version=0}toString(){return"[FloatCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.B_v)for(let t=0;t<6;++t)null!=this.B_v[t]&&(this.B_v[t].imgData=null);super.__$destroy()}}}e.default=n},eca0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("c62b"));class n{constructor(){this.idsFlag=0,this.count=0,this.rprocessUid=-1}reset(){this.idsFlag=0}}n.RenerProcessMaxTotal=16,e.RCRPObj=n;class l extends r.default{constructor(){super(...arguments),this.F_R=[]}createNode(){let t=new n;return t.reset(),this.F_R.push(t),new a.default}restoreUid(t){this.F_R[t].reset()}testRPNodeExists(t,e){return(this.F_R[t].idsFlag&1<<e)>0}testRPNodeNotExists(t,e){return(this.F_R[t].idsFlag&1<<e)<1}setRPNodeParam(t,e,s){let i=this.F_R[t],r=1<<e;return s>-1?(i.idsFlag&r)<1&&(++i.count,i.rprocessUid=e,i.idsFlag=i.idsFlag|r):(i.idsFlag&r)>0&&(--i.count,i.idsFlag=i.idsFlag&~r),i.count}getRCRPObj(t){return this.F_R[t]}}e.RPOUnitBuilder=l},ee5a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.type=0,this.F_S=[],this.F_T=[],this.F_U=[]}addListener(t,e,s){let i=this.F_T.length-1;for(;i>=0;--i)if(t===this.F_T[i])break;i<0&&(this.F_T.push(t),this.F_S.push(e),this.F_U.push(s))}removeListener(t,e){let s=this.F_T.length-1;for(;s>=0;--s)if(t===this.F_T[s]){this.F_T.splice(s,1),this.F_S.splice(s,1),this.F_U.splice(s,1);break}}dispatch(t){let e=0,s=this.F_T.length;for(let i=0;i<s;++i)(this.F_U[i]<1||t.phase==this.F_U[i])&&(this.F_S[i].call(this.F_T[i],t),e=1);return e}passTestEvt(t){let e=this.F_T.length;for(let s=0;s<e;++s)if(this.F_U[s]<1||t.phase==this.F_U[s])return 1;return 0}passTestPhase(t){let e=this.F_T.length;for(let s=0;s<e;++s)if(this.F_U[s]<1||t==this.F_U[s])return 1;return 0}destroy(){this.F_T=[],this.F_S=[],this.F_U=[]}}e.default=i},eec2:function(t,e,s){"use strict";function i(){var t=/^[og]\s*(.+)?/,e=/^mtllib /,s=/^usemtl /,i=/^usemap /;function r(){var t={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);var s=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(t,e){var s=this._finalize(!1);s&&(s.inherited||s.groupCount<=0)&&this.materials.splice(s.index,1);var i={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==s?s.smooth:this.smooth,groupStart:void 0!==s?s.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var e={index:"number"===typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){var e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(var s=this.materials.length-1;s>=0;s--)this.materials[s].groupCount<=0&&this.materials.splice(s,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},s&&s.name&&"function"===typeof s.clone){var i=s.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){var s=parseInt(t,10);return 3*(s>=0?s-1:s+e/3)},parseNormalIndex:function(t,e){var s=parseInt(t,10);return 3*(s>=0?s-1:s+e/3)},parseUVIndex:function(t,e){var s=parseInt(t,10);return 2*(s>=0?s-1:s+e/2)},addVertex:function(t,e,s){var i=this.vertices,r=this.object.geometry.vertices;r.push(i[t+0],i[t+1],i[t+2]),r.push(i[e+0],i[e+1],i[e+2]),r.push(i[s+0],i[s+1],i[s+2])},addVertexPoint:function(t){var e=this.vertices,s=this.object.geometry.vertices;s.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){var e=this.vertices,s=this.object.geometry.vertices;s.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,s){var i=this.normals,r=this.object.geometry.normals;r.push(i[t+0],i[t+1],i[t+2]),r.push(i[e+0],i[e+1],i[e+2]),r.push(i[s+0],i[s+1],i[s+2])},addColor:function(t,e,s){var i=this.colors,r=this.object.geometry.colors;r.push(i[t+0],i[t+1],i[t+2]),r.push(i[e+0],i[e+1],i[e+2]),r.push(i[s+0],i[s+1],i[s+2])},addUV:function(t,e,s){var i=this.uvs,r=this.object.geometry.uvs;r.push(i[t+0],i[t+1]),r.push(i[e+0],i[e+1]),r.push(i[s+0],i[s+1])},addUVLine:function(t){var e=this.uvs,s=this.object.geometry.uvs;s.push(e[t+0],e[t+1])},addFace:function(t,e,s,i,r,a,n,l,h){var o=this.vertices.length,m=this.parseVertexIndex(t,o),_=this.parseVertexIndex(e,o),u=this.parseVertexIndex(s,o);if(this.addVertex(m,_,u),this.colors.length>0&&this.addColor(m,_,u),void 0!==i&&""!==i){var d=this.uvs.length;m=this.parseUVIndex(i,d),_=this.parseUVIndex(r,d),u=this.parseUVIndex(a,d),this.addUV(m,_,u)}if(void 0!==n&&""!==n){var c=this.normals.length;m=this.parseNormalIndex(n,c),_=n===l?m:this.parseNormalIndex(l,c),u=n===h?m:this.parseNormalIndex(h,c),this.addNormal(m,_,u)}},addPointGeometry:function(t){this.object.geometry.type="Points";for(var e=this.vertices.length,s=0,i=t.length;s<i;s++)this.addVertexPoint(this.parseVertexIndex(t[s],e))},addLineGeometry:function(t,e){this.object.geometry.type="Line";for(var s=this.vertices.length,i=this.uvs.length,r=0,a=t.length;r<a;r++)this.addVertexLine(this.parseVertexIndex(t[r],s));var n=0;for(a=e.length;n<a;n++)this.addUVLine(this.parseUVIndex(e[n],i))}};return t.startObject("",!1),t}this.Parse=function(a){var n=new r;-1!==a.indexOf("\r\n")&&(a=a.replace(/\r\n/g,"\n")),-1!==a.indexOf("\\\n")&&(a=a.replace(/\\\n/g,""));for(var l=a.split("\n"),h="",o="",m=0,_=[],u="function"===typeof"".trimLeft,d=0,c=l.length;d<c;d++)if(h=l[d],h=u?h.trimLeft():h.trim(),m=h.length,0!==m&&(o=h.charAt(0),"#"!==o))if("v"===o){var f=h.split(/\s+/);switch(f[0]){case"v":n.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),f.length>=7&&n.colors.push(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6]));break;case"vn":n.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":n.uvs.push(parseFloat(f[1]),parseFloat(f[2]));break}}else if("f"===o){for(var p=h.substr(1).trim(),g=p.split(/\s+/),v=[],x=0,T=g.length;x<T;x++){var E=g[x];if(E.length>0){var y=E.split("/");v.push(y)}}var S=v[0];for(x=1,T=v.length-1;x<T;x++){var b=v[x],M=v[x+1];n.addFace(S[0],b[0],M[0],S[1],b[1],M[1],S[2],b[2],M[2])}}else if("l"===o){var A=h.substring(1).trim().split(" "),L=[],R=[];if(-1===h.indexOf("/"))L=A;else for(var P=0,D=A.length;P<D;P++){var F=A[P].split("/");""!==F[0]&&L.push(F[0]),""!==F[1]&&R.push(F[1])}n.addLineGeometry(L,R)}else if("p"===o){p=h.substr(1).trim();var w=p.split(" ");n.addPointGeometry(w)}else if(null!==(_=t.exec(h))){var B=(" "+_[0].substr(1).trim()).substr(1);n.startObject(B)}else if(s.test(h))n.object.startMaterial(h.substring(7).trim(),n.materialLibraries);else if(e.test(h))n.materialLibraries.push(h.substring(7).trim());else if(i.test(h));else if("s"===o){if(_=h.split(" "),_.length>1){var C=_[1].trim().toLowerCase();n.object.smooth="0"!==C&&"off"!==C}else n.object.smooth=!0;var N=n.object.currentMaterial();N&&(N.smooth=n.object.smooth)}else if("\0"===h)continue;return n.finalize(),n.objects}}s.r(e),s.d(e,"ObjDataParser",(function(){return i}))},efce:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("e7d2")),a=i(s("8a0a")),n=i(s("fecb")),l=i(s("cb29")),h=i(s("725b"));class o extends l.default{constructor(t=a.default.VTX_DYNAMIC_DRAW){super(t),this.B_o=null,this.B_U=null,this.B_1=0,this.B_2=0,this.F_V=0,this.A_U="",this.flipVerticalUV=!1,this.vtxUVEnabled=!0,this.vertColorEnabled=!1,this.alignFactorX=.5,this.alignFactorY=.5,this.fontSystem=null}getWidth(){return this.B_1}getHeight(){return this.B_2}createStrData(t){this.A_U=t;let e=t.length;this.F_V=e;let s=!1,i=this.fontSystem;if(null==i&&(i=h.default.GetInstance()),e>0){i.createCharsTexFromStr(t),this.B_1=-1,this.B_2=0;let a=o.G_K,l=0,h=0,m=0,_=0,u=0;s=null!=this.B_o&&8*e>this.B_o.length;let d=i.getCharTable();if(s){let s=o.G_I;for(s.set(o.G_J,0),this.B_t=new Uint16Array(6*e),this.B_U=new Float32Array(8*e),this.B_o=new Float32Array(8*e);l<e;++l)this.B_t.set(s,6*l),s[0]+=4,s[1]+=4,s[2]+=4,s[3]+=4,s[4]+=4,s[5]+=4,d.getUV8AndSizeFromChar(t.charAt(l),this.B_U,a,8*l),this.B_2<a[1]&&(this.B_2=a[1]),this.B_o[8*l]=a[0],this.B_1+=a[0]}else for(null==this.B_o&&(this.B_U=new Float32Array(8*e),this.B_o=new Float32Array(8*e));l<e;++l)d.getUV8AndSizeFromChar(t.charAt(l),this.B_U,a,8*l),this.B_2<a[1]&&(this.B_2=a[1]),this.B_o[8*l]=a[0],this.B_1+=a[0];let c=1;this.B_1+=e*c,_=-this.alignFactorX*this.B_1,u=-this.alignFactorY*this.B_2,m=u+this.B_2,null==this.bounds&&(this.bounds=new n.default),this.bounds.min.setXYZ(_,u,0),this.bounds.max.setXYZ(_+this.B_1,m,0);let f=0;for(l=0;l<e;++l)h=_+this.B_o[f],this.B_o[f]=_,this.B_o[f+1]=u,this.B_o[f+2]=h,this.B_o[f+3]=u,this.B_o[f+4]=h,this.B_o[f+5]=m,this.B_o[f+6]=_,this.B_o[f+7]=m,_=h+c,f+=8;r.default.Reset(),r.default.AddFloat32Data(this.B_o,2),r.default.AddFloat32Data(this.B_U,2)}s&&this.B_u.setUintIVSData(this.B_t),this.vtCount=6*e,this.vtxTotal=4*e,this.trisNumber=2*e}initialize(t){let e=t.length,s=o.G_I;s.set(o.G_J,0),null==this.B_t&&(this.B_t=new Uint16Array(6*e));for(let i=0;i<e;++i)this.B_t.set(s,6*i),s[0]+=4,s[1]+=4,s[2]+=4,s[3]+=4,s[4]+=4,s[5]+=4;this.createStrData(t),r.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.B_u=r.default.CreateBySaveData(this.getBufDataUsage()),this.B_u.setUintIVSData(this.B_t),this.buildEnd()}updateCharStr(t){null!=this.B_u&&this.A_U!=t&&(this.createStrData(t),this.buildEnd(),r.default.UpdateBufData(this.B_u))}__$destroy(){this.isResFree()&&(this.bounds=null,this.B_o=null,this.B_U=null,super.__$destroy()),this.fontSystem=null}}o.G_J=new Uint8Array([0,1,2,0,2,3]),o.G_I=new Uint8Array([0,1,2,0,2,3]),o.G_K=[0,0],e.default=o},f043:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("3930"));class n{constructor(){this.position=new r.default(0,100,0),this.direction=new r.default(0,-1,0,0),this.color=new a.default(1,1,1,1),this.angleDegree=30,this.attenuationFactor1=1e-4,this.attenuationFactor2=5e-4}}e.SpotLight=n},f044:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static CreateNewID(){return i.__s_uid++}}i.__s_uid=0,e.default=i},f0f0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("f044"));class a{constructor(t){this.b=-1,this.B_w=0,this.layoutBit=0,this.Bb=null,this.F_W=null,this.F_X=0,this.b=r.default.CreateNewID()}getUid(){return this.b}getType(){return 0}getBuffersTotal(){return 1}getAttribsTotal(){return this.Bb.length}getF32DataAt(t){return this.F_W}setF32DataAt(t,e,s,i){null!=i&&(this.Bb=i),this.F_X=s,this.F_W=e}setData4fAt(t,e,s,i,r,a){t=this.F_X*t+this.Bb[e],this.F_W[t++]=s,this.F_W[t++]=i,this.F_W[t++]=r,this.F_W[t++]=a}setData3fAt(t,e,s,i,r){t=this.F_X*t+this.Bb[e],this.F_W[t++]=s,this.F_W[t++]=i,this.F_W[t++]=r}setData2fAt(t,e,s,i){t=this.F_X*t+this.Bb[e],this.F_W[t++]=s,this.F_W[t++]=i}destroy(){this.Bb=null,this.F_W=null}toString(){return"VtxCombinedBuf(uid = "+this.b+")"}}e.default=a},f208:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.info=""}}e.default=i},f3a2:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["None"]="",t["Default"]="pbr",t["Lambert"]="lambert",t["PBR"]="pbr"}(i||(i={})),e.ShaderCodeUUID=i},f444:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("1710")),a=s("bcac"),n=s("278e");class l{constructor(){this.A_N=null,this.F_Y=new a.CameraDragSwinger,this.F_Z=new n.CameraDragSlide,this.F_a=!0}initialize(t,e){null==this.A_N&&(this.A_N=t,this.F_Y.initialize(t,e),this.F_Z.initialize(t,e),t.addEventListener(r.default.MOUSE_BG_DOWN,this,this.mouseDownListener,!0,!1),t.addEventListener(r.default.MOUSE_UP,this,this.mouseUpListener,!1,!0))}setSlideSpeed(t){this.F_Z.slideSpeed=t}enableSwing(){this.F_a=!0}enableSlide(){this.F_a=!1}mouseDownListener(t){this.F_Y.attach(),this.F_Z.attach()}mouseUpListener(t){this.F_Y.detach(),this.F_Z.detach()}detach(){this.F_Y.detach(),this.F_Z.detach()}runWithYAxis(){this.F_a?this.F_Y.runWithYAxis():this.F_Z.run()}runWithZAxis(){this.F_a?this.F_Y.runWithZAxis():this.F_Z.run()}}e.default=l},f48d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(){this.id=-1,this.position=new r.default}update(){}updateFast(){}}a.__tV0=new r.default,a.__tV1=new r.default,a.__tV2=new r.default,e.AbsGeomBase=a,e.default=a},f610:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("fecb"));class a{constructor(){this.B_o=null,this.B_U=null,this.B_p=null,this.B_q=null,this.B_r=null,this.B_e=null,this.B_t=null,this.bounds=new r.default,this.vtxTotal=0,this.trisNumber=0,this.vtCount=0}clone(){let t=new a;return t.copyFrom(this),t}copyFrom(t){let e=new a;null!=t.B_o&&(null!=this.B_o?this.B_o.set(t.B_o):this.B_o=t.B_o.slice(0)),null!=t.B_U&&(null!=this.B_U?this.B_U.set(t.B_U):this.B_U=t.B_U.slice(0)),null!=t.B_p&&(null!=this.B_p?this.B_p.set(t.B_p):this.B_p=t.B_p.slice(0)),null!=t.B_q&&(null!=this.B_q?this.B_q.set(t.B_q):this.B_q=t.B_q.slice(0)),null!=t.B_r&&(null!=this.B_r?this.B_r.set(t.B_r):this.B_r=t.B_r.slice(0)),null!=t.B_e&&(null!=this.B_e?this.B_e.set(t.B_e):this.B_e=t.B_e.slice(0)),null!=t.B_t&&(null!=this.B_t?this.B_t.set(t.B_t):this.B_t=t.B_t.slice(0)),e.vtxTotal=this.vtxTotal,e.trisNumber=this.trisNumber,e.vtCount=this.vtCount,e.bounds.copyFrom(this.bounds)}getVS(){return this.B_o}getUVS(){return this.B_U}getNVS(){return this.B_p}getTVS(){return this.B_q}getBTVS(){return this.B_r}getCVS(){return this.B_e}getIVS(){return this.B_t}reset(){this.B_o=null,this.B_U=null,this.B_p=null,this.B_q=null,this.B_r=null,this.B_t=null,this.vtxTotal=0,this.trisNumber=0,this.vtCount=0}toString(){return"GeometryBase()"}}e.default=a},f63b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=s("8d98"),n=i(s("3b73"));function l(t,e,s){var i=document.createElement("canvas");i.width=e,i.height=s,i.style.backgroundColor="transparent",i.style.display="block",i.style.left="0px",i.style.top="0px",i.style.position="absolute";let r=i.getContext("2d");return r.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height),{canvas:i,ctx2d:r}}function h(t,e,s){var i=document.createElement("canvas");i.width=e,i.height=s,i.style.backgroundColor="transparent",i.style.display="block",i.style.left="0px",i.style.top="0px",i.style.position="absolute";let r=i.getContext("2d");return r.globalCompositeOperation="destination-atop",r.fillStyle="rgba(255, 255, 255, 1.0)",r.rect(0,0,i.width,i.height),r.fill(),r.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height),{canvas:i,ctx2d:r}}class o{constructor(t,e){this.F_b="",this.F_c=null,this.C=!1,this.F_d=0,this.texture=null,this.bytesTex=null,this.powerOf2Fix=!1,this.offsetTex=null,this.premultipliedAlpha=!0,this.F_b=t,this.F_d=e}startLoad(){if(null==this.F_c){let t=this;this.F_c=new Image,this.F_c.onload=function(e){t.C=!0,t.buildTex()},this.F_c.addEventListener("error",e=>{t.F_b}),this.F_c.crossOrigin="",this.F_c.src=this.F_b}}buildTex(){let t=this.F_c;if(null!=t&&this.C){let e=this.texture,s=this.offsetTex,i=this.bytesTex,a=null,o=r.default.IsPowerOf2(t.width)&&r.default.IsPowerOf2(t.height),m=this.powerOf2Fix;if(n.default.IsWebGL1()&&(m=!0),!o&&m){let o=r.default.CalcCeilPowerOfTwo(t.width),m=r.default.CalcCeilPowerOfTwo(t.height);o>n.default.MAX_TEXTURE_SIZE&&(o=n.default.MAX_TEXTURE_SIZE),m>n.default.MAX_TEXTURE_SIZE&&(o=n.default.MAX_TEXTURE_SIZE);let _=l(t,o,m),u=this.F_d;if(null!=e&&(e.setDataFromImage(_.canvas,u),e.name=this.F_c.src,null!=s&&(_=h(t,o,m),s.setDataFromImage(_.canvas,u))),null!=i)if(this.premultipliedAlpha)a=_.ctx2d.getImageData(0,0,_.canvas.width,_.canvas.height),i.setDataFromBytes(a.data,u,_.canvas.width,_.canvas.height),i.name=this.F_c.src;else{a=_.ctx2d.getImageData(0,0,_.canvas.width,_.canvas.height);let e=a.data,s=h(t,o,m);a=s.ctx2d.getImageData(0,0,s.canvas.width,s.canvas.height);let r=a.data,n=0,l=0,d=0;for(;n<m;++n)for(l=0;l<o;++l)e[d]+=255-r[d],e[d+1]+=255-r[d+1],e[d+2]+=255-r[d+2],d+=4;i.setDataFromBytes(e,u,_.canvas.width,_.canvas.height),i.name=this.F_c.src}}else if(null!=e)this.powerOf2Fix,e.setDataFromImage(t,this.F_d),e.name=this.F_c.src;else if(null!=i){let e=r.default.CalcNearestCeilPow2(t.width),s=r.default.CalcNearestCeilPow2(t.height);e>2048&&(e=2048),s>2048&&(e=2048);let n=l(t,e,s),h=this.F_d;a=n.ctx2d.getImageData(0,0,n.canvas.width,n.canvas.height),i.setDataFromBytes(a.data,h,n.canvas.width,n.canvas.height),i.name=this.F_c.src}this.C=!0}}getURL(){return this.F_b}getImage(){return this.F_c}isLoaded(){return this.C}destroy(){this.C=!1,this.F_b="",this.texture=null,this.F_c.src="",this.F_c=null}}class m{constructor(t){this.F_e=null,this.F_f=[],this.Ey=0,this.C=!1,this.AE=[],this.F_g=[],this.F_e=t;var e=this;let s=0,i=null;for(;s<6;++s)i=new Image,i.onload=function(t){if(e.Ey++,e.Ey>=6){let t=0;for(t=0;t<6;++t)e.AE[0].setDataFromImageToFaceAt(t,e.F_f[t],e.F_g[0]);e.AE[0].name=e.F_f.src}},i.crossOrigin="",i.src=e.F_e[s],e.F_f.push(i)}addTex(t,e){this.AE.push(t),this.F_g.push(e)}getURLAt(t){return this.F_e[0]}getTexAt(t){return this.AE[t]}isLoaded(){return this.C}destroy(){}}class _{constructor(t){this.F_h=new Map,this.C_W=new Map,this.F_i=[],this.F_j=[],this.F_k=[],this.F_l=5,this.F_m=17,this.F_n=17,this.F_o=512,this.F_p=512,this.F_q=null,this.Cu=0,this.F_q=t,null!=t&&t.addTexLoader(this)}getTexByUrl(t,e=!0,s=!0,i=!1){let r=this.getImageTexByUrl(t,0,!1,i);return r.mipmapEnabled=s,e&&r.setWrap(a.TextureConst.WRAP_REPEAT),r}getBytesNoPremultipliedAlphaTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.C_W.get(t);if(null==s){s=new o(t,e),s.premultipliedAlpha=!1,this.C_W.set(t,s);let i=this.F_q.createBytesTex(1,1);return i.name=t,s.bytesTex=i,this.F_j.push(s),i}return s.bytesTex.isDestroyed()&&(s.bytesTex=this.F_q.createBytesTex(1,1)),s.bytesTex}getBytesTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.C_W.get(t);if(null==s){s=new o(t,e),this.C_W.set(t,s);let i=this.F_q.createBytesTex(1,1);return i.name=t,s.bytesTex=i,this.F_j.push(s),i}return s.bytesTex.isDestroyed()&&(s.bytesTex=this.F_q.createBytesTex(1,1)),s.bytesTex}getImageOffsetTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.C_W.get(t);return null!=s?s.offsetTex:null}getImageTexByUrl(t,e=0,s=!1,i=!1){if(""==t)return null;e<0&&(e=0);let r=this.C_W.get(t);if(null==r){r=new o(t,e),r.powerOf2Fix=i,s&&(r.offsetTex=this.F_q.createImageTex2D(1,1)),this.C_W.set(t,r);let a=this.F_q.createImageTex2D(1,1);return a.name=t,r.texture=a,this.F_j.push(r),a}return r.texture.isDestroyed()&&(r.texture=this.F_q.createImageTex2D(1,1)),r.texture}getCubeTexAndLoadImg(t,e,s=0){if(""==t||null==e||e.length<6)return null;s<0&&(s=0);let i=this.F_h.get(t);if(null==i){i=new m(e),this.F_h.set(t,i);let r=this.F_q.createImageCubeTex(8,8);return i.addTex(r,s),r}return i.getTexAt(0)}setRunFlag(t){this.Cu=t}getRunFlag(){return this.Cu}isRunning(){return!0}isStopped(){return!1}run(){let t=0,e=null;if(--this.F_m,this.F_m<1){this.F_m=this.F_n;let s=this.F_k.length;if(s>0)for(;t<s;++t)this.F_k[t].isLoaded()&&(this.F_i.push(this.F_k[t]),this.F_k.splice(t,1),--t,--s);let i=this.F_j.length;if(i>0&&s<this.F_l)for(t=s;t<this.F_l;++t){if(!(this.F_j.length>0))break;e=this.F_j.pop(),this.F_k.push(e),e.startLoad()}}if(--this.F_o,this.F_o<1){this.F_o=this.F_p;let s=null,i=this.F_i.length;for(t=0;t<i;++t)e=this.F_i[t],s=null!=e.texture?e.texture:e.bytesTex,s.isDestroyed()&&(this.C_W.delete(e.getURL()),this.F_i.splice(t,1),e.destroy(),--t,--i)}}getWaitTotal(){return this.F_j.length}isLoadedAll(){return this.F_j.length<1}}e.default=_},f63e:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("b3bd")),a=i(s("0fc4")),n=i(s("faa5"));class l extends n.default{constructor(){super(),this.j_="",this.normalEnabled=!1}initialize(t){super.initialize(t),this.j_="VOX_Default3DShd",this.F_t&&(this.j_+="_tex"),this.vertColorEnabled&&(this.j_+="_vtxColor"),this.premultiplyAlpha&&(this.j_+="_preMulAlpha"),this.adaptationShaderVersion=!1}buildShader(){let t=this.A_j;t.addVertLayout("vec3","a_vs"),t.addFragUniform("vec4","u_color"),t.useVertSpaceMats(!0,!0,!0),this.F_t&&(this.A_k.addDiffuseMap(),t.addVertLayout("vec2","a_uvs"),t.addVarying("vec2","v_uv")),this.normalEnabled&&(t.addVertLayout("vec3","a_nvs"),t.addVarying("vec3","v_nv")),this.vertColorEnabled&&(t.addVertLayout("vec3","a_cvs"),t.addVarying("vec3","v_cv")),t.addFragOutput("vec4","FragColor0"),t.addFragMainCode("\n    FragColor0 = vec4(1.0);\n    #ifdef VOX_USE_2D_MAP\n        //  FragColor0 *= VOX_Texture2D(VOX_DIFFUSE_MAP, vec2(v_uv[0],v_uv[1]));\n        FragColor0 *= VOX_Texture2D(VOX_DIFFUSE_MAP, v_uv.xy);\n    #endif\n    #ifdef VOX_USE_VTX_COLOR\n        FragColor0.xyz *= v_cv.xyz;\n    #endif\n    #ifdef VOX_PREMULTIPLY_ALPHA\n        FragColor0.rgb *= u_color.xyz;\n        FragColor0.a *= u_color.w;\n        FragColor0.rgb *= u_color.aaa;\n    #else\n        FragColor0 *= u_color;\n    #endif\n    #ifdef VOX_USE_NORMAL\n        FragColor0.xyz *= abs(v_nv.xyz);\n    #endif\n"),t.addVertMainCode("\n    localPosition = vec4(a_vs.xyz,1.0);\n    worldPosition = u_objMat * localPosition;\n    oWorldPosition = worldPosition;\n    viewPosition = u_viewMat * worldPosition;\n    gl_Position = u_projMat * viewPosition;\n\n    #ifdef VOX_USE_2D_MAP\n        v_uv = a_uvs.xy;\n    #endif\n    #ifdef VOX_USE_NORMAL\n        v_nv = a_nvs.xyz;\n    #endif\n    #ifdef VOX_USE_VTX_COLOR\n        v_cv = a_cvs.xyz;\n    #endif\n")}getUniqueShaderName(){return this.j_}}class h extends a.default{constructor(){super(),this.F_r=new Float32Array([1,1,1,1]),this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.normalEnabled=!1,null==h.G_L&&(h.G_L=new l)}buildBuf(){let t=h.G_L;t.getShaderCodeBuilder().normalEnabled=this.normalEnabled,t.vertColorEnabled=this.vertColorEnabled,t.premultiplyAlpha=this.premultiplyAlpha,t.normalEnabled=this.normalEnabled}getCodeBuf(){return h.G_L}setRGB3f(t,e,s){this.F_r[0]=t,this.F_r[1]=e,this.F_r[2]=s}getRGB3f(t){let e=this.F_r;t.setRGB3f(e[0],e[1],e[2])}setRGBA4f(t,e,s,i){this.F_r[0]=t,this.F_r[1]=e,this.F_r[2]=s,this.F_r[3]=i}getRGBA4f(t){let e=this.F_r;t.setRGBA4f(e[0],e[1],e[2],e[3])}setAlpha(t){this.F_r[3]=t}createSelfUniformData(){let t=new r.default;return t.uniformNameList=["u_color"],t.dataList=[this.F_r],t}}h.G_L=null,e.default=h},f928:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("df25"));class n extends a.default{constructor(t,e,s=!1){super(t,e,s),this.v=r.TextureProxyType.Float,this.minFilter=r.TextureConst.LINEAR,this.internalFormat=r.TextureFormat.RGBA16F,this.dataType=r.TextureDataType.FLOAT,this.unpackAlignment=4}toAlphaFormat(){this.srcFormat=r.TextureFormat.ALPHA,this.internalFormat=r.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=r.TextureFormat.RED,this.internalFormat=r.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB16F,this.unpackAlignment=1}toRGBAFormat(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4}toRGBAFloatFormat(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA16F,this.unpackAlignment=4}setDataFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,n=!1){super.setDataFromBytes(t,e,s,i,r,a,n)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[FloatTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},fa60:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("919c"));class a extends r.default{constructor(){super(),this.vao=null,this.b=a.F_0++}run(){this.Au.testVROUid(this.b)&&(this.Au.bindVertexArray(this.vao),(this.Au.testRIOUid(this.BV)||r.default.G3!=this.Dp)&&(r.default.G3=this.Dp,this.Au.bindEleBuf(this.ibuf)))}__$destroy(){r.default.Gx.delete(this.Dp),this.Dp=0,this.BV=-1,this.ibuf=null,this.vao=null,this.Au=null}restoreThis(){null!=this.vao&&this.Au.deleteVertexArray(this.vao),a.Restore(this)}toString(){return"VaoVertexRenderObj(uid = "+this.b+", type="+this.Dp+")"}static HasMid(t){return r.default.Gx.has(t)}static GetByMid(t){return r.default.Gx.get(t)}static GetFreeId(){return a.Gy.length>0?a.Gy.pop():-1}static Create(t,e,s){let i=null,n=a.GetFreeId();return n>=0?(i=a.Gz[n],a.G0[n]=a.S_FLAG_BUSY,i.setMidAndBufUid(e,s)):(i=new a,i.setMidAndBufUid(e,s),a.Gz.push(i),a.G0.push(a.S_FLAG_BUSY),a.G1++),i.setRC(t),r.default.Gx.set(e,i),i}static Restore(t){if(null!=t&&t.k<1&&a.G0[t.getUid()]==a.S_FLAG_BUSY){let e=t.getUid();a.Gy.push(e),a.G0[e]=a.S_FLAG_FREE,t.__$destroy()}}}a.F_0=0,a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.G0=[],a.G1=0,a.Gz=[],a.Gy=[],e.default=a},faa5:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("f3a2"),a=i(s("4a54")),n=s("5216"),l=s("3113");class h{constructor(){this.A_j=null,this.F_s=null,this.AE=null,this.F_t=!0,this.pipeline=null,this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.shadowReceiveEnabled=!1,this.lightEnabled=!1,this.fogEnabled=!1,this.envAmbientLightEnabled=!1,this.brightnessOverlayEnabeld=!1,this.glossinessEnabeld=!0,this.pipeTypes=null,this.keysString="",this.adaptationShaderVersion=!0,null==h.G_N&&(h.G_M=new l.ShaderCodeUniform,h.G_N=new a.default(h.G_M),h.G_M.__$setCodeBuilder(h.G_N))}reset(){this.A_j=h.G_N,this.A_k=h.G_M,this.F_u=this.A_k,this.A_j.reset(),this.AE=null,this.pipeTypes=null,this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.shadowReceiveEnabled=!1,this.lightEnabled=!1,this.fogEnabled=!1,this.envAmbientLightEnabled=!1,this.brightnessOverlayEnabeld=!1,this.glossinessEnabeld=!0,this.keysString=""}clear(){this.A_j=null}setShaderCodeObject(t){this.F_s=t}getShaderCodeObject(){return this.F_s}getShaderCodeObjectUUID(){return r.ShaderCodeUUID.None}getShaderCodeBuilder(){return h.G_N}static GetPreCompileInfo(){return h.G_N.getPreCompileInfo()}initialize(t){null!=h.__$s_csBuf&&h.__$s_csBuf!=this&&h.__$s_csBuf.initialize(t),this.F_t=t,this.bufInitWithPipeline()}buildDefine(){this.premultiplyAlpha&&(this.A_j.addDefine("VOX_PREMULTIPLY_ALPHA"),this.keysString+="A"),this.vertColorEnabled&&(this.A_j.addDefine("VOX_USE_VTX_COLOR"),this.keysString+="UVC"),this.brightnessOverlayEnabeld&&(this.A_j.addDefine("VOX_USE_BRIGHTNESS_OVERLAY_COLOR"),this.keysString+="UBOC"),this.glossinessEnabeld&&(this.A_j.addDefine("VOX_USE_GLOSSINESS"),this.keysString+="UG")}buildPipelineParams(){null!=this.pipeline&&null==this.pipeTypes&&(this.pipeTypes=[],this.lightEnabled&&this.pipeTypes.push(n.MaterialPipeType.GLOBAL_LIGHT),this.shadowReceiveEnabled&&this.pipeTypes.push(n.MaterialPipeType.VSM_SHADOW),this.fogEnabled&&this.pipeTypes.push(n.MaterialPipeType.FOG_EXP2),this.envAmbientLightEnabled&&this.pipeTypes.push(n.MaterialPipeType.ENV_AMBIENT_LIGHT))}getTexturesFromPipeline(t){null!=this.pipeline&&this.pipeline.getTextures(this.A_j,t,this.pipeTypes)}bufInitWithPipeline(){null!=this.pipeline&&(this.buildPipelineParams(),this.pipeline.buildSharedUniforms(this.pipeTypes),this.pipeline.createKeys(this.pipeTypes),this.keysString+=this.pipeline.getKeysString())}isTexEanbled(){return this.F_t}setIRenderTextureList(t){this.AE=t}getIRenderTextureList(){return this.AE}buildShader(){}getFragShaderCode(){return h.__$s_csBuf!=this?h.__$s_csBuf.getFragShaderCode():this.A_j.buildFragCode()}getVertShaderCode(){return h.__$s_csBuf!=this?h.__$s_csBuf.getVertShaderCode():this.A_j.buildVertCode()}getUniqueShaderName(){if(h.__$s_csBuf!=this)return h.__$s_csBuf.getUniqueShaderName()}toString(){return"[ShaderCodeBuffer()]"}static UseShaderBuffer(t){null!=h.__$s_csBuf&&h.__$s_csBuf.clear(),h.__$s_csBuf=t}}h.__$s_csBuf=null,e.default=h},fae3:function(t,e,s){"use strict";s.r(e);s("1eb2");var i=s("b88e");for(var r in i)["default"].indexOf(r)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(r)},fc07:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("2e8a")),n=i(s("78e9"));class l{constructor(){this.F_v=new Map,this.attriNSList=null,this.attriSizeList=null,this.uniformNameListStr="",this.texUniformNameListStr="",this.attributes=[null,null,null,null,null,null,null,null,null,null,null,null],this.uniforms=null,this.texTotal=0,this.fragOutputTotal=0}reset(){this.attriNSList=null,this.uniformNameListStr="",this.texUniformNameListStr="";let t=0;for(;t<12;++t)this.attributes[t]=null;this.uniforms=null,this.F_v.clear(),this.texTotal=0}parseVShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let s="\n",i=t.indexOf(s),r=0,l=[],h="",o="",m=new RegExp(" ","g");while(i>=0)h=t.slice(r,i),h.length>0&&(o=h.replace(m,""),0!=o.indexOf("//")&&l.push(h)),r=i+1,i=t.indexOf(s,r);h=t.slice(r,t.length),h.length>0&&(o=h.replace(m,""),0!=o.indexOf("//")&&l.push(h));let _="uniform ",u=l.length,d=null;for(i=0;i<12;++i)this.attributes[i]=null;this.attriNSList=[],this.attriSizeList=[];let c=null;null==this.uniforms&&(this.uniforms=[]),i=0;let f=!1,p=!1;while(i<u)h=l[i],f=h.indexOf("layout")>=0,p=h.indexOf("attribute ")>=0,f&&h.indexOf("location")>0||p?(d=new a.default,d.layoutEnabled=f,d.parseCode(h),this.attributes[d.attriType]=d,this.attriNSList.push(d.name),this.attriSizeList.push(d.typeSize)):h.indexOf(_)>=0&&(c=new n.default,c.parseCode(h)&&(this.uniforms.push(c),this.uniformNameListStr+=c.name+",",c.isTex&&!this.F_v.has(c.name)&&(this.F_v.set(c.name,1),this.texUniformNameListStr+=c.name+",",this.texTotal++))),++i}parseFShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let s="\n",i=t.indexOf(s),a=0,l=[],h="",o="",m=new RegExp(" ","g");while(i>=0)h=t.slice(a,i),h.length>0&&(o=h.replace(m,""),0!=o.indexOf("//")&&l.push(h)),a=i+1,i=t.indexOf(s,a);h=t.slice(a,t.length),h.length>0&&(o=o.replace(m,""),0!=o.indexOf("//")&&l.push(h));let _="uniform ",u=l.length,d=null;null==this.uniforms&&(this.uniforms=[]),i=0;while(i<u)h=l[i],h.indexOf(_)>=0&&this.uniformNameListStr.indexOf(_)<0&&(d=new n.default,d.parseCode(h)&&(this.uniforms.push(d),this.uniformNameListStr+=d.name+",",d.isTex&&!this.F_v.has(d.name)&&(this.F_v.set(d.name,1),this.texUniformNameListStr+=d.name+",",this.texTotal++))),++i;let c="layout";r.default.IsWebGL1()&&(c="gl_FragData"),i=t.indexOf(c),this.fragOutputTotal=0;while(i>0)this.fragOutputTotal++,i=t.indexOf(c,i+2);this.fragOutputTotal<1&&(this.fragOutputTotal=1)}}e.default=l},fe7f:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("df25"));class n extends a.default{constructor(t,e,s=!1){super(t,e,s),this.v=r.TextureProxyType.Bytes}toAlphaFormat(){this.srcFormat=r.TextureFormat.ALPHA,this.internalFormat=r.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=r.TextureFormat.RED,this.internalFormat=r.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB,this.unpackAlignment=3}toRGBAFormat(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4}setDataFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,n=!1){super.setDataFromBytes(t,e,s,i,r,a,n)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[BytesTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},fecb:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17"));class n{constructor(){this.min=new a.default(r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE),this.max=new a.default(r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE),this.version=-1,this.radius=50,this.radius2=2500,this.center=new a.default(0,0,0),this.F_w=100,this.B_1=100,this.B_2=100,this.F_x=50,this.F_y=50,this.F_z=50,this.E_A=new a.default}getLong(){return this.F_w}getWidth(){return this.B_1}getHeight(){return this.B_2}reset(){this.min.setXYZ(r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE),this.max.setXYZ(r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE)}equals(t){return this.min.equalsXYZ(t.min)&&this.max.equalsXYZ(t.max)}setVolume(t,e,s){this.B_1=t,this.B_2=e,this.F_w=s,this.F_x=.5*this.F_w,this.F_y=.5*this.B_1,this.F_z=.5*this.B_2,this.max.x=this.center.x+this.F_y,this.max.y=this.center.y+this.F_z,this.max.z=this.center.z+this.F_x,this.min.x=this.center.x-this.F_y,this.min.y=this.center.y-this.F_z,this.min.z=this.center.z-this.F_x,this.radius2=this.F_y*this.F_y+this.F_z*this.F_z+this.F_x*this.F_x,this.radius=Math.sqrt(this.radius2)}union(t){this.addPosition(t.min),this.addPosition(t.max)}addPosition(t){this.min.x>t.x&&(this.min.x=t.x),this.min.y>t.y&&(this.min.y=t.y),this.min.z>t.z&&(this.min.z=t.z),this.max.x<t.x&&(this.max.x=t.x),this.max.y<t.y&&(this.max.y=t.y),this.max.z<t.z&&(this.max.z=t.z)}addXYZ(t,e,s){this.min.x>t&&(this.min.x=t),this.min.y>e&&(this.min.y=e),this.min.z>s&&(this.min.z=s),this.max.x<t&&(this.max.x=t),this.max.y<e&&(this.max.y=e),this.max.z<s&&(this.max.z=s)}addXYZFloat32Arr(t,e=3){let s=t.length,i=0,r=0,a=0;for(let n=0;n<s;)i=t[n],r=t[n+1],a=t[n+2],n+=e,this.min.x>i&&(this.min.x=i),this.min.y>r&&(this.min.y=r),this.min.z>a&&(this.min.z=a),this.max.x<i&&(this.max.x=i),this.max.y<r&&(this.max.y=r),this.max.z<a&&(this.max.z=a)}addXYZFloat32AndIndicesArr(t,e){let s,i=e.length,r=0,a=0,n=0;for(let l=0;l<i;l++)s=3*l,r=t[s++],a=t[s++],n=t[s],this.min.x>r&&(this.min.x=r),this.min.y>a&&(this.min.y=a),this.min.z>n&&(this.min.z=n),this.max.x<r&&(this.max.x=r),this.max.y<a&&(this.max.y=a),this.max.z<n&&(this.max.z=n)}getClosePosition(t,e,s=0){e.copyFrom(t),e.x<this.min.x?e.x=this.min.x+s:e.x>this.max.x&&(e.x=this.max.x-s),e.y<this.min.y?e.y=this.min.y+s:e.y>this.max.y&&(e.y=this.max.y-s),e.z<this.min.z?e.z=this.min.z+s:e.z>this.max.z&&(e.z=this.max.z-s)}containsV(t){return!(t.x<this.max.x||t.x>this.max.x)&&(!(t.y<this.max.y||t.y>this.max.y)&&!(t.z<this.max.z||t.z>this.max.z))}containsXY(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.y||e>this.max.y)}containsXZ(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.z||e>this.max.z)}containsYZ(t,e){return!(t<this.min.y||t>this.max.y)&&!(e<this.min.z||e>this.max.z)}update(){this.B_1=this.max.x,this.min.x>this.max.x&&(this.max.x=this.min.x,this.min.x=this.B_1),this.B_1=this.max.x-this.min.x,this.B_2=this.max.y,this.min.y>this.max.y&&(this.max.y=this.min.y,this.min.y=this.B_2),this.B_2=this.max.y-this.min.y,this.F_w=this.max.z,this.min.z>this.max.z&&(this.max.z=this.min.z,this.min.z=this.F_w),this.F_w=this.max.z-this.min.z,this.center.x=.5*this.B_1,this.center.y=.5*this.B_2,this.center.z=.5*this.F_w,this.F_x=this.center.z,this.F_y=this.center.x,this.F_z=this.center.y,this.radius2=this.F_y*this.F_y+this.F_z*this.F_z+this.F_x*this.F_x,this.radius=Math.sqrt(this.radius2),this.center.x+=this.min.x,this.center.y+=this.min.y,this.center.z+=this.min.z,++this.version}updateVolume(){this.B_1=this.max.x-this.min.x,this.B_2=this.max.y-this.min.y,this.F_w=this.max.z-this.min.z,this.F_x=.5*this.F_w,this.F_y=.5*this.B_1,this.F_z=.5*this.B_2,++this.version}copyFrom(t){this.radius=t.radius,this.radius2=t.radius2,this.min.copyFrom(t.min),this.max.copyFrom(t.max),this.center.copyFrom(t.center),this.updateVolume()}updateFast(){this.B_1=this.max.x-this.min.x,this.B_2=this.max.y-this.min.y,this.F_w=this.max.z-this.min.z,this.center.x=.5*this.B_1,this.center.y=.5*this.B_2,this.center.z=.5*this.F_w,this.F_x=this.center.z,this.F_y=this.center.x,this.F_z=this.center.y,this.radius2=this.F_y*this.F_y+this.F_z*this.F_z+this.F_x*this.F_x,this.radius=Math.sqrt(this.radius2),this.center.x+=this.min.x,this.center.y+=this.min.y,this.center.z+=this.min.z,++this.version}toString(){return"[AABB(min->"+this.min+",size("+this.B_1+","+this.B_2+","+this.F_w+"))]"}sphereIntersect(t,e){this.E_A.x=this.center.x-t.x,this.E_A.y=this.center.y-t.y,this.E_A.z=this.center.z-t.z;let s=this.E_A.getLengthSquared();return s<this.radius2||(e+=this.radius,e*=e,e>=s)}intersectRL(t,e){let s=0,i=(this.min.x-e.x)/t.x,r=(this.max.x-e.x)/t.x;i>r&&(s=r,r=i,i=s);let a=(this.min.y-e.y)/t.y,n=(this.max.y-e.y)/t.y;if(a>n&&(s=n,n=a,a=s),i>n||a>r)return!1;a>i&&(i=a),n<r&&(r=n);let l=(this.min.z-e.z)/t.z,h=(this.max.z-e.z)/t.z;return l>h&&(s=h,h=l,l=s),!(i>h||l>r)&&(l>i&&(i=l),h<r&&(r=h),!0)}static IntersectionRL3(t,e,s,i,r,a){return s.w=(t[e[0]].x-r.x)*s.x,i.w=(t[1-e[0]].x-r.x)*s.x,a.x=(t[e[1]].y-r.y)*s.y,a.y=(t[1-e[1]].y-r.y)*s.y,!(s.w>a.y||a.x>i.w)&&(a.x>s.w&&(s.w=a.x),a.y<i.w&&(i.w=a.y),a.x=(t[e[2]].z-r.z)*s.z,a.y=(t[1-e[2]].z-r.z)*s.z,!(s.w>a.y||a.x>i.w)&&(a.x>s.w&&(s.w=a.x),a.y<i.w&&(i.w=a.y),a.copyFrom(i),a.scaleBy(s.w),a.addBy(r),i.w=1,!0))}static IntersectionRL1(t,e,s,i){let r=0,a=(s.min.x-e.x)/t.x,n=(s.max.x-e.x)/t.x;a>n&&(r=n,n=a,a=r);let l=(s.min.y-e.y)/t.y,h=(s.max.y-e.y)/t.y;if(l>h&&(r=h,h=l,l=r),a>h||l>n)return!1;l>a&&(a=l),h<n&&(n=h);let o=(s.min.z-e.z)/t.z,m=(s.max.z-e.z)/t.z;return o>m&&(r=m,m=o,o=r),!(a>m||o>n)&&(o>a&&(a=o),m<n&&(n=m),i.copyFrom(t),i.scaleBy(a),i.addBy(e),!0)}static IntersectionRL2(t,e,s,i){i.x=s.center.x-e.x,i.y=s.center.y-e.y,i.z=s.center.z-e.z;let r=i.dot(t);if(i.x-=r*t.x,i.y-=r*t.y,i.z-=r*t.z,i.getLengthSquared()>s.radius2)return!1;if(s.containsV(e))return i.copyFrom(e),!0;if(e.x<s.min.x){if(t.x>0&&(r=(s.min.x-e.x)/t.x,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsYZ(i.y,i.z)))return!0}else if(e.x>s.max.x&&t.x<0&&(r=(s.max.x-e.x)/t.x,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsYZ(i.y,i.z)))return!0;if(e.y<s.min.y){if(t.y>0&&(r=(s.min.y-e.y)/t.y,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXZ(i.x,i.z)))return!0}else if(e.y>s.max.y&&t.y<0&&(r=s.max.y,r=(s.max.y-e.y)/t.y,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXZ(i.x,i.z)))return!0;if(e.z<s.min.z){if(t.z>0&&(r=(s.min.z-e.z)/t.z,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXY(i.x,i.y)))return!0}else if(e.z>s.max.z&&t.z<0&&(r=(s.max.z-e.z)/t.z,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXY(i.x,i.y)))return!0;return!1}}n.___pnV=new a.default,e.default=n}})}));