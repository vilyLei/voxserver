(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["VoxWebGPU"]=e():t["VoxWebGPU"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(r,s,function(e){return t[e]}.bind(null,s));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="fae3")}({"005f":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t){this.mUid=r.sUid++,this.mCloned=!1,this.mSubUfs=[],this.index=-1,this.layoutName="",this.groupIndex=-1,this.mCtx=t,this.mWGC=t.getWGCtx()}getUid(){return this.mUid}setValue(t,e=0){const i=this.versions[e];i.ver!=t.version&&(i.ver=t.version,this.mWGC.buffer.updateUniformBuffer(this.buffers[e],t.data,this.ivs[e],t.byteOffset))}isEnabled(){return null!=this.buffers}__$$updateSubUniforms(){const t=this.mSubUfs;if(t&&this.buffers)for(let e=0,i=t.length;e<i;e++)this.copySelfTo(t[e])}copySelfTo(t){t.index=this.index,t.layoutName=this.layoutName,t.buffers=this.buffers,t.bindGroup=this.bindGroup,t.groupIndex=this.groupIndex,t.versions=this.versions.slice(0)}clone(){const t=new r(this.mCtx);return t.index=this.index,t.layoutName=this.layoutName,t.buffers=this.buffers,t.bindGroup=this.bindGroup,t.groupIndex=this.groupIndex,t.mCloned=!0,this.mSubUfs.push(t),t}cloneMany(t){const e=new Array(t);for(let i=0;i<t;++i)e[i]=this.clone();return e}destroy(){this.mCtx&&(this.mSubUfs=[],this.uvfs=null,this.mCloned?(this.index=-1,this.groupIndex=-1,this.buffers=null,this.bindGroup=null):this.mCtx.removeUniform(this),this.mCtx=null)}__$$destroy(){this.groupIndex=-1,this.index=-1,this.mWGC=null,this.buffers=null}}r.sUid=0,e.WGRUniform=r},"0069":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("1eee"),n=r(i("a229"));class a extends s.PrimitiveEntity{constructor(t){super(t)}getGeometryData(t){t||(t={});let e=50;void 0!==t.cubeSize&&(e=Math.abs(.5*t.cubeSize));const i=[-e,-e,-e],r=[e,e,e];return(new n.default).initialize(i,r)}}e.CubeEntity=a},"0142":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("3e2f");e.WGRPassParam=r.WGRPassParam,e.WGRendererPassImpl=r.WGRendererPassImpl;const s=i("8e9d"),n=i("1d61"),a=i("37b8");class o{constructor(t,e=!0){this.mDrawing=!0,this.name="",this.passColors=[new s.WGRPColorAttachment],this.separate=!1,this.enabled=!0,this.mDrawing=e,t&&this.initialize(t)}isDrawing(){return this.mDrawing}get depthTexture(){return this.mDepthTexture}initialize(t){this.mWGCtx=t}getPassParams(){return this.mParam}build(t){this.mDrawing&&(t.multisampleEnabled=t.sampleCount&&t.sampleCount>1,this.mParam=t,this.prevPass?(this.mDepthTexture=this.prevPass.mDepthTexture,this.colorView=this.prevPass.colorView):this.createRenderPassTexture(t))}updateColorAttachmentView(t,e,i=!1){if(!t.view&&(i||t.setParam(e),!t.view)){let i=a.texDescriptorFilter(e.texture);if(i){const r=i.rttTexture;if(r){const s=this.mWGCtx;if(void 0===r.texture){const e=s.texture.createColorRTTTexture({format:i.format});r.texture=e,r.textureView=e.createView(),t.textureFormat=e.format,t.view=r.textureView,t.view.label=i.uuid}else t.view=r.textureView;t.texture=e.texture}}}}createRenderPassTexture(t){const e=this.mWGCtx;let i=this.separate,r=1;const a=!0===t.multisampleEnabled;t.multisampleEnabled=a,a&&(r=t.sampleCount);let o=[e.canvasWidth,e.canvasHeight],l=this.passColors,u=l[0];if(i){let i=t.colorAttachments;if(this.mColorAttachments=i,i&&i.length>0){for(let t=1;t<i.length;++t)l.push(new s.WGRPColorAttachment);for(let t=0;t<i.length;++t);this.clearColor.setColor(l[0].clearValue)}else{const t=e.texture.createRTTTexture({size:o,sampleCount:r,format:e.presentationFormat,usage:GPUTextureUsage.RENDER_ATTACHMENT});this.colorView=t.createView(),u.view=this.colorView,u.viewTexture=t}}else if(a){const t=e.texture.createRTTTexture({size:o,sampleCount:r,format:e.presentationFormat,usage:GPUTextureUsage.RENDER_ATTACHMENT});this.colorView=t.createView(),u.view=this.colorView,u.viewTexture=t}if(!1!==t.depthTestEnabled||t.depthStencilAttachment){let i=t.depthStencilAttachment,s=this.passDepthStencil;if(s||(s=(new n.WGRPDepthStencilAttachment).setParam(i)),this.passDepthStencil=s,!s.view){o=[e.canvasWidth,e.canvasHeight];let i="depth24plus";void 0!==t.depthFormat&&(i=t.depthFormat);const n={size:o,sampleCount:r,format:i,usage:GPUTextureUsage.RENDER_ATTACHMENT},a=e.texture.createRTTTexture(n);this.mDepthTexture=a,s.view=a.createView(),s.viewTexture=a}}}runBegin(){const t=this.mWGCtx,e=this.prevPass;if(e&&(this.enabled=this.enabled&&e.enabled),this.enabled&&t.enabled){const i=t.device,r=this.mParam;this.commandEncoder=i.createCommandEncoder();const s=this.commandEncoder;if(this.mDrawing){let i=this.passColors;const a=i[0];let o=this.passDepthStencil;const l=r.multisampleEnabled;if(e){const t=e.passColors[0],i=e.passDepthStencil;a.loadOp="load",l?(a.view=t.view,a.resolveTarget=t.resolveTarget):a.view=t.view,i&&(o||(o=new n.WGRPDepthStencilAttachment,o.depthLoadOp="load",this.passDepthStencil=o),o=this.passDepthStencil,o.view=i.view)}else if(1==i.length&&i[0].clearValue.copyFrom(this.clearColor),this.separate){const t=this.mColorAttachments;if(void 0!==t)for(let e=0;e<i.length;++e){const r=i[e],s=r.param,n=t[e];r.view&&s===n&&r.texture===n.texture||void 0!==n.texture&&(r.view=null,this.updateColorAttachmentView(r,n,s===n),e<1&&s!==n&&this.clearColor.setColor(r.clearValue))}}else l?a.resolveTarget=a.resolveTargetTexture?a.resolveTarget:t.createCurrentView():a.view=a.viewTexture?a.view:t.createCurrentView();let u,h=this.passColors;u=o?{colorAttachments:h,depthStencilAttachment:o}:{colorAttachments:h},this.passEncoder=s.beginRenderPass(u)}else this.compPassEncoder=s.beginComputePass()}}runEnd(){const t=this.mWGCtx;return this.enabled&&t.enabled?(this.mDrawing?this.passEncoder.end():this.compPassEncoder.end(),this.commandEncoder.finish()):null}destroy(){this.mColorAttachments=null}}e.WGRendererPass=o},"0444":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(4) var<uniform> albedo: vec4f;\r\n@group(0) @binding(5) var<uniform> arm: vec4f;\r\n\r\nconst PI = 3.141592653589793;\r\nconst PI2 = 6.283185307179586;\r\nconst PI_HALF = 1.5707963267948966;\r\nconst RECIPROCAL_PI = 0.3183098861837907;\r\nconst RECIPROCAL_PI2 = 0.15915494309189535;\r\nconst EPSILON = 1e-6;\r\n\r\nfn approximationSRGBToLinear(srgbColor: vec3<f32>) -> vec3<f32> {\r\n    return pow(srgbColor, vec3<f32>(2.2));\r\n}\r\nfn approximationLinearToSRCB(linearColor: vec3<f32>) -> vec3<f32> {\r\n    return pow(linearColor, vec3(1.0/2.2));\r\n}\r\n\r\nfn accurateSRGBToLinear(srgbColor: vec3<f32>) -> vec3<f32> {\r\n    let linearRGBLo = srgbColor / 12.92;\r\n    let linearRGBHi = pow((srgbColor + vec3(0.055)) / vec3(1.055), vec3(2.4));\r\n\tif( all( srgbColor <= vec3(0.04045) ) ) {\r\n\t\treturn linearRGBLo;\r\n\t}\r\n    return linearRGBHi;\r\n}\r\nfn accurateLinearToSRGB(linearColor: vec3<f32>) -> vec3<f32> {\r\n    let srgbLo = linearColor * 12.92;\r\n    let srgbHi = (pow(abs(linearColor), vec3(1.0 / 2.4)) * 1.055) - 0.055;\r\n    if(all(linearColor <= vec3(0.0031308))) {\r\n\t\treturn srgbLo;\r\n\t}\r\n    return srgbHi;\r\n}\r\n\r\n// Trowbridge-Reitz(Generalized-Trowbridge-Reitz,GTR)\r\nfn DistributionGTR1(NdotH: f32, roughness: f32) -> f32 {\r\n    if (roughness >= 1.0) {\r\n\t\treturn 1.0/PI;\r\n\t}\r\n    let a2 = roughness * roughness;\r\n    let t = 1.0 + (a2 - 1.0)*NdotH*NdotH;\r\n    return (a2 - 1.0) / (PI * log(a2) *t);\r\n}\r\nfn DistributionGTR2(NdotH: f32, roughness: f32) -> f32 {\r\n    let a2 = roughness * roughness;\r\n    let t = 1.0 + (a2 - 1.0) * NdotH * NdotH;\r\n    return a2 / (PI * t * t);\r\n}\r\n\r\n\r\nfn DistributionGGX(N: vec3<f32>, H: vec3<f32>, roughness: f32) -> f32 {\r\n    let a = roughness*roughness;\r\n    let a2 = a*a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH*NdotH;\r\n\r\n    let nom   = a2;\r\n    var denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    denom = PI * denom * denom;\r\n\r\n    return nom / max(denom, 0.0000001); // prevent divide by zero for roughness=0.0 and NdotH=1.0\r\n}\r\n\r\n\r\nfn GeometryImplicit(NdotV: f32, NdotL: f32) -> f32 {\r\n    return NdotL * NdotV;\r\n}\r\n\r\n// ----------------------------------------------------------------------------\r\nfn GeometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r*r) / 8.0;\r\n\r\n    let nom   = NdotV;\r\n    let denom = NdotV * (1.0 - k) + k;\r\n\r\n    return nom / denom;\r\n}\r\n// ----------------------------------------------------------------------------\r\nfn GeometrySmith(N: vec3<f32>, V: vec3<f32>, L: vec3<f32>, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    let ggx2 = GeometrySchlickGGX(NdotV, roughness);\r\n    let ggx1 = GeometrySchlickGGX(NdotL, roughness);\r\n\r\n    return ggx1 * ggx2;\r\n}\r\n\r\n// @param cosTheta is clamp(dot(H, V), 0.0, 1.0)\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3<f32>) -> vec3<f32> {\r\n    return F0 + (1.0 - F0) * pow(max(1.0 - cosTheta, 0.0), 5.0);\r\n}\r\nfn fresnelSchlick2(specularColor: vec3<f32>, L: vec3<f32>, H: vec3<f32>) -> vec3<f32> {\r\n   return specularColor + (1.0 - specularColor) * pow(1.0 - saturate(dot(L, H)), 5.0);\r\n}\r\n//fresnelSchlick2(specularColor, L, H) * ((SpecularPower + 2) / 8 ) * pow(saturate(dot(N, H)), SpecularPower) * dotNL;\r\n\r\nconst OneOnLN2_x6 = 8.656171;// == 1/ln(2) * 6 (6 is SpecularPower of 5 + 1)\r\n// dot -> dot(N,V) or\r\nfn fresnelSchlick3(specularColor: vec3<f32>, dot: f32, glossiness: f32) -> vec3<f32> {\r\n\treturn specularColor + (max(vec3(glossiness), specularColor) - specularColor) * exp2(-OneOnLN2_x6 * dot);\r\n}\r\nfn fresnelSchlickWithRoughness(specularColor: vec3<f32>, L: vec3<f32>, N: vec3<f32>, gloss: f32) -> vec3<f32> {\r\n   return specularColor + (max(vec3(gloss), specularColor) - specularColor) * pow(1.0 - saturate(dot(L, N)), 5.0);\r\n}\r\n\r\nconst A = 2.51f;\r\nconst B = 0.03f;\r\nconst C = 2.43f;\r\nconst D = 0.59f;\r\nconst E = 0.14f;\r\nfn ACESToneMapping(color: vec3<f32>, adapted_lum: f32) -> vec3<f32> {\r\n\r\n\tlet c = color * adapted_lum;\r\n\treturn (c * (A * c + B)) / (c * (C * c + D) + E);\r\n}\r\n\r\n//color = color / (color + vec3(1.0));\r\nfn reinhard(v: vec3<f32>) -> vec3<f32> {\r\n    return v / (vec3<f32>(1.0) + v);\r\n}\r\nfn reinhard_extended(v: vec3<f32>, max_white: f32) -> vec3<f32> {\r\n    let numerator = v * (1.0f + (v / vec3(max_white * max_white)));\r\n    return numerator / (1.0f + v);\r\n}\r\nfn luminance(v: vec3<f32>) -> f32 {\r\n    return dot(v, vec3<f32>(0.2126f, 0.7152f, 0.0722f));\r\n}\r\n\r\nfn change_luminance(c_in: vec3<f32>, l_out: f32) -> vec3<f32> {\r\n    let l_in = luminance(c_in);\r\n    return c_in * (l_out / l_in);\r\n}\r\nfn reinhard_extended_luminance(v: vec3<f32>, max_white_l: f32) -> vec3<f32> {\r\n    let l_old = luminance(v);\r\n    let numerator = l_old * (1.0f + (l_old / (max_white_l * max_white_l)));\r\n    let l_new = numerator / (1.0f + l_old);\r\n    return change_luminance(v, l_new);\r\n}\r\nfn ReinhardToneMapping( color: vec3<f32>, toneMappingExposure: f32 ) -> vec3<f32> {\r\n\r\n\tlet c = color * toneMappingExposure;\r\n\treturn saturate( c / ( vec3( 1.0 ) + c ) );\r\n\r\n}\r\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\r\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\r\nconst highp_a = 12.9898;\r\nconst highp_b = 78.233;\r\nconst highp_c = 43758.5453;\r\nfn rand( uv: vec2<f32> ) -> f32 {\r\n\tlet dt = dot( uv.xy, vec2<f32>( highp_a, highp_b ) );\r\n\tlet sn = modf( dt / PI ).fract;\r\n\treturn fract(sin(sn) * highp_c);\r\n}\r\n// // based on https://www.shadertoy.com/view/MslGR8\r\nfn dithering( color: vec3<f32>, fragCoord: vec2<f32> ) -> vec3<f32> {\r\n    //Calculate grid position\r\n    let grid_position = rand( fragCoord );\r\n\r\n    //Shift the individual colors differently, thus making it even harder to see the dithering pattern\r\n    var dither_shift_RGB = vec3<f32>( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\r\n\r\n    //modify shift acording to grid position.\r\n    dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\r\n\r\n    //shift the color by dither_shift\r\n    return color + dither_shift_RGB;\r\n}\r\n\r\nconst dis = 600.0;\r\nconst disY = 400.0;\r\nconst u_lightPositions = array<vec3<f32>, 4>(\r\n\tvec3<f32>(-dis, disY, dis),\r\n\tvec3<f32>(dis, disY, dis),\r\n\tvec3<f32>(-dis, disY, -dis),\r\n\tvec3<f32>(dis, disY, -dis)\r\n);\r\nconst colorValue = 300.0;\r\nconst u_lightColors = array<vec3<f32>, 4>(\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n);\r\n\r\nfn calcPBRColor3(Normal: vec3<f32>, WorldPos: vec3<f32>, camPos: vec3<f32>) -> vec3<f32> {\r\n\r\n\tvar color = vec3<f32>(0.0);\r\n\r\n    var ao = arm.x;\r\n    var roughness = arm.y;\r\n    var metallic = arm.z;\r\n\r\n\tvar N = normalize(Normal);\r\n    var V = normalize(camPos.xyz - WorldPos);\r\n    var dotNV = clamp(dot(N, V), 0.0, 1.0);\r\n\r\n    // calculate reflectance at normal incidence; if dia-electric (like plastic) use F0\r\n    // of 0.04 and if it's a metal, use the albedo color as F0 (metallic workflow)\r\n    var F0 = vec3(0.04);\r\n    F0 = mix(F0, albedo.xyz, metallic);\r\n\r\n    // reflectance equation\r\n    var Lo = vec3(0.0);\r\n\r\n\tfor (var i: i32 = 0; i < 4; i++) {\r\n\t\t// calculate per-light radiance\r\n        let L = normalize(u_lightPositions[i].xyz - WorldPos);\r\n        let H = normalize(V + L);\r\n        let distance = length(u_lightPositions[i].xyz - WorldPos);\r\n\r\n        let attenuation = 1.0 / (1.0 + 0.001 * distance + 0.0003 * distance * distance);\r\n        let radiance = u_lightColors[i].xyz * attenuation;\r\n\r\n        // Cook-Torrance BRDF\r\n        let NDF = DistributionGGX(N, H, roughness);\r\n        let G   = GeometrySmith(N, V, L, roughness);\r\n        //vec3 F    = fresnelSchlick(clamp(dot(H, V), 0.0, 1.0), F0);\r\n        let F    = fresnelSchlick3(F0,clamp(dot(H, V), 0.0, 1.0), 0.9);\r\n        //vec3 F    = fresnelSchlick3(F0,dotNV, 0.9);\r\n\r\n        let nominator    = NDF * G * F;\r\n        let denominator = 4.0 * max(dot(N, V), 0.0) * max(dot(N, L), 0.0);\r\n        let specular = nominator / max(denominator, 0.001); // prevent divide by zero for NdotV=0.0 or NdotL=0.0\r\n\r\n        // kS is equal to Fresnel\r\n        let kS = F;\r\n        // for energy conservation, the diffuse and specular light can't\r\n        // be above 1.0 (unless the surface emits light); to preserve this\r\n        // relationship the diffuse component (kD) should equal 1.0 - kS.\r\n        var kD = vec3<f32>(1.0) - kS;\r\n        // multiply kD by the inverse metalness such that only non-metals\r\n        // have diffuse lighting, or a linear blend if partly metal (pure metals\r\n        // have no diffuse light).\r\n        kD *= 1.0 - metallic;\r\n\r\n        // scale light by NdotL\r\n        let NdotL = max(dot(N, L), 0.0);\r\n\r\n        // add to outgoing radiance Lo\r\n        // note that we already multiplied the BRDF by the Fresnel (kS) so we won't multiply by kS again\r\n        Lo += (kD * albedo.xyz / PI + specular) * radiance * NdotL;\r\n\t}\r\n\t// ambient lighting (note that the next IBL tutorial will replace\r\n    // this ambient lighting with environment lighting).\r\n    let ambient = vec3<f32>(0.03) * albedo.xyz * ao;\r\n\r\n    color = ambient + Lo;\r\n    // HDR tonemapping\r\n    color = reinhard( color );\r\n    // gamma correct\r\n    color = pow(color, vec3<f32>(1.0/2.2));\r\n\treturn color;\r\n}\r\n\r\n@fragment\r\nfn main(\r\n  @location(0) pos: vec4<f32>,\r\n  @location(1) uv: vec2<f32>,\r\n  @location(2) normal: vec3<f32>,\r\n  @location(3) camPos: vec3<f32>\r\n) -> @location(0) vec4<f32> {\r\n  var color4 = vec4(calcPBRColor3(normal, pos.xyz, camPos), 1.0);\r\n  return color4;\r\n}"},"0540":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("3e40")),n=r(i("348f")),a=i("79d0");class o extends n.default{constructor(){super(),this.offsetU=0,this.offsetV=0,this.uScale=1,this.vScale=1,this.flipY=!1,this.axisType=0,this.mvs=null,this.muvs=null,this.mnvs=null}getVS(){return this.mvs}getUVS(){return this.muvs}setUVS(t){null!=t&&8==t.length&&(null==this.muvs?this.muvs=t.slice(0):this.muvs.set(t))}getNVS(){return this.mnvs}initialize(t,e,i,r){if(this.mvs)return;let n=t,a=e,o=t+i,l=e+r,u=0;switch(this.mivs=new Uint16Array([0,1,2,0,2,3]),this.axisType){case 0:this.mvs=new Float32Array([n,a,u,o,a,u,o,l,u,n,l,u]);break;case 1:this.mvs=new Float32Array([o,u,a,n,u,a,n,u,l,o,u,l]);break;case 2:this.mvs=new Float32Array([u,n,a,u,o,a,u,o,l,u,n,l]);break;default:break}switch(this.bounds||(this.bounds=new s.default),this.bounds.addFloat32Arr(this.mvs),this.bounds.updateFast(),this.muvs||(this.flipY?this.muvs=new Float32Array([this.offsetU+0*this.uScale,this.offsetV+1*this.vScale,this.offsetU+1*this.uScale,this.offsetV+1*this.vScale,this.offsetU+1*this.uScale,this.offsetV+0*this.vScale,this.offsetU+0*this.uScale,this.offsetV+0*this.vScale]):this.muvs=new Float32Array([this.offsetU+0*this.uScale,this.offsetV+0*this.vScale,this.offsetU+1*this.uScale,this.offsetV+0*this.vScale,this.offsetU+1*this.uScale,this.offsetV+1*this.vScale,this.offsetU+0*this.uScale,this.offsetV+1*this.vScale])),this.axisType){case 0:this.mnvs=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]);break;case 1:this.mnvs=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0]);break;case 2:this.mnvs=new Float32Array([1,0,0,1,0,0,1,0,0,1,0,0]);break;default:break}this.vtxTotal=4,this.trisNumber=2,this.vtCount=this.mivs.length}testRay(t,e,i,r){if(this.mPolyhedral)return-1;if(r){let r=a.AABBCalc.IntersectionRL2(e,t,this.bounds,i);return r?1:-1}return-1}__$destroy(){this.mivs&&(this.bounds=null,this.mvs=null,this.muvs=null,this.mnvs=null,super.__$destroy())}}e.default=o},"07b0":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(3) var<uniform> color: vec4f;\r\n@fragment\r\nfn main(\r\n  @location(0) vertColor: vec4<f32>\r\n) -> @location(0) vec4<f32> {\r\n  var color4 = vertColor * color;\r\n  return color4;\r\n}"},"0884":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},"0a09":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=i("4ad2"),a=i("d463"),o=i("f083"),l=i("943f"),u=i("213f"),h=r(i("d36d")),c=r(i("d3d0")),d=r(i("5dcd")),m=r(i("d9d5")),f=r(i("8637")),p=r(i("8b6a")),v=r(i("0db1")),g=i("5118"),b={diffuse:{uuid:"rtt0",rttTexture:{}}},y={diffuse:{uuid:"rtt1",rttTexture:{}}},_=[b,y],x={texture:b,clearValue:[],loadOp:"clear",storeOp:"store"},w=[x],S={diffuse:{uuid:"colorRTT",rttTexture:{}}},M={diffuse:{uuid:"floatRTT",rttTexture:{},format:"rgba16float"}};class P extends o.WGRPassNodeGraph{constructor(){super()}run(){let t=this.passes[0];const e=this.blurEntity;let i=e.materials;for(let r=0;r<11;++r){const e=r%2,s=(r+1)%2;t.colorAttachments[0].clearEnabled=r<1,this.srcEntity.visible=r<1,this.blurEntity.visible=r>0,x.texture=_[e],i[e].visible=!1,i[s].visible=!0,t.render()}}}class T{constructor(){this.mRscene=new n.RendererScene,this.mGraph=new P,this.uniformValues=[{data:new Float32Array([512,512,3,0])}],this.mouseDown=t=>{}}initialize(){let t=!0,e=!1,i={multisampleEnabled:t,depthTestEnabled:e};this.mRscene.initialize({rpassparam:i,camera:{eye:[260,260,260]}}),this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(s.default.MOUSE_DOWN,this.mouseDown),(new u.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}createMaterial(t,e,i){let r={vert:{code:h.default,uuid:"vert"},frag:{code:i>0?d.default:c.default,uuid:"frag"}};t+="-"+i;let s={depthWriteEnabled:!1};const n=new l.WGMaterial({shadinguuid:t,shaderSrc:r,pipelineDefParam:s});return n.uniformValues=this.uniformValues,n.addTextures(e),n}applyBlurPass(t,e){let i=this.mRscene;const r=this.mGraph;x.clearValue=t;let s=i.createRenderPass({separate:!0,colorAttachments:w});r.passes=[s];let n=[this.createMaterial("shd-00",[b],0),this.createMaterial("shd-01",[y],1)],o=new a.FixScreenPlaneEntity({extent:[-1,-1,2,2],flipY:!0,textures:[S]});o.uuid="src-entity",s.addEntity(o),r.srcEntity=o,i.setPassNodeGraph(r);let l=new a.FixScreenPlaneEntity({extent:e,flipY:!0,materials:n});l.materials[0].visible=!1,l.uuid="blur-entity",s.addEntity(l),r.blurEntity=l;let u={vert:{code:h.default,uuid:"vert"},frag:{code:v.default,uuid:"depthBlur"}},c=[S,b,M];e=[-.8,-.8,1.6,1.6],l=new a.FixScreenPlaneEntity({extent:e,flipY:!1,shaderSrc:u,textures:c,shadinguuid:"blurRenderingResult"}),i.addEntity(l)}applyMRTPass(t){let e=this.mRscene;const i={texture:S,clearValue:[.15,.15,.15,1]},r={texture:M,clearValue:[.2,.25,.2,1]},s=[i,r];let n=e.createRenderPass({separate:!0,colorAttachments:s}),o={vert:{code:m.default,uuid:"vertMRT"},frag:{code:f.default,uuid:"fragMRT"}},l=new g.TorusEntity({shaderSrc:o,radius:150});l.setAlbedo([.7,.02,.1]),n.addEntity(l),o={vert:{code:h.default,uuid:"vert"},frag:{code:p.default,uuid:"readNromal"}},t=[-.95,-.95,.6,.6];let u=new a.FixScreenPlaneEntity({extent:t,shaderSrc:o,textures:[M],shadinguuid:"readDepth"});e.addEntity(u),t=[-.33,-.95,.6,.6],u=new a.FixScreenPlaneEntity({extent:t,textures:[S]}),e.addEntity(u),t=[.3,-.95,.6,.6],u=new a.FixScreenPlaneEntity({extent:t,textures:[b]}),e.addEntity(u)}initScene(){this.applyBlurPass([0,0,.03,1],[-1,-1,2,2]),this.applyMRTPass([-1,-1,2,2])}run(){this.mRscene.run()}}e.DepthBlur=T},"0bc4":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(3) var<storage> param: vec4f;\r\n@group(0) @binding(4) var mySampler: sampler;\r\n@group(0) @binding(5) var myTexture: texture_2d<f32>;\r\n\r\n@fragment\r\nfn main(\r\n  @location(0) fragUV: vec2<f32>,\r\n  @location(1) fragPosition: vec4<f32>\r\n) -> @location(0) vec4<f32> {\r\n\r\n  var color4 = textureSample(myTexture, mySampler, fragUV) * fragPosition * param;\r\n  color4 = vec4(color4.xyz, 1.0);\r\n  return color4;\r\n}\r\n"},"0c34":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("2fc9");class s{constructor(){this.specularEnv={uuid:"SpecularEnvBrnTexture",dataTexture:{datas:[],width:128,height:128},viewDimension:"cube",format:"rgba8unorm",generateMipmaps:!1}}set datas(t){this.specularEnv.dataTexture.datas=t}set width(t){this.specularEnv.dataTexture.width=t}set height(t){this.specularEnv.dataTexture.width=t}load(t){return(new r.HttpFileLoader).load(t,(t,e)=>{this.parse(t)}),this}parse(t){let e,i=new Uint16Array(t),r=new Uint8Array(t),s=0,n=i[4],a=i[5],o=i[6],l=0,u=r.subarray(32),h=[],c=this.specularEnv.dataTexture;c.width=n,c.height=a;let d=n,m=a;for(let f=0;f<o;f++){for(let t=0;t<6;t++)l=d*d*4,e=u.subarray(s,s+l),h.push(e),s+=l;d>>=1,m>>=1}c.datas=h}}e.SpecularEnvBrnTexture=s},"0d53":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(3) var<uniform> albedo: vec4f;\r\n@group(0) @binding(4) var<uniform> arm: vec4f;\r\n\r\nconst PI = 3.141592653589793;\r\nconst PI2 = 6.283185307179586;\r\nconst PI_HALF = 1.5707963267948966;\r\nconst RECIPROCAL_PI = 0.3183098861837907;\r\nconst RECIPROCAL_PI2 = 0.15915494309189535;\r\nconst EPSILON = 1e-6;\r\n\r\nfn approximationSRGBToLinear(srgbColor: vec3<f32>) -> vec3<f32> {\r\n    return pow(srgbColor, vec3<f32>(2.2));\r\n}\r\nfn approximationLinearToSRCB(linearColor: vec3<f32>) -> vec3<f32> {\r\n    return pow(linearColor, vec3(1.0/2.2));\r\n}\r\n\r\nfn accurateSRGBToLinear(srgbColor: vec3<f32>) -> vec3<f32> {\r\n    let linearRGBLo = srgbColor / 12.92;\r\n    let linearRGBHi = pow((srgbColor + vec3(0.055)) / vec3(1.055), vec3(2.4));\r\n\tif( all( srgbColor <= vec3(0.04045) ) ) {\r\n\t\treturn linearRGBLo;\r\n\t}\r\n    return linearRGBHi;\r\n}\r\nfn accurateLinearToSRGB(linearColor: vec3<f32>) -> vec3<f32> {\r\n    let srgbLo = linearColor * 12.92;\r\n    let srgbHi = (pow(abs(linearColor), vec3(1.0 / 2.4)) * 1.055) - 0.055;\r\n    if(all(linearColor <= vec3(0.0031308))) {\r\n\t\treturn srgbLo;\r\n\t}\r\n    return srgbHi;\r\n}\r\n\r\n// Trowbridge-Reitz(Generalized-Trowbridge-Reitz,GTR)\r\nfn DistributionGTR1(NdotH: f32, roughness: f32) -> f32 {\r\n    if (roughness >= 1.0) {\r\n\t\treturn 1.0/PI;\r\n\t}\r\n    let a2 = roughness * roughness;\r\n    let t = 1.0 + (a2 - 1.0)*NdotH*NdotH;\r\n    return (a2 - 1.0) / (PI * log(a2) *t);\r\n}\r\nfn DistributionGTR2(NdotH: f32, roughness: f32) -> f32 {\r\n    let a2 = roughness * roughness;\r\n    let t = 1.0 + (a2 - 1.0) * NdotH * NdotH;\r\n    return a2 / (PI * t * t);\r\n}\r\n\r\n\r\nfn DistributionGGX(N: vec3<f32>, H: vec3<f32>, roughness: f32) -> f32 {\r\n    let a = roughness*roughness;\r\n    let a2 = a*a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH*NdotH;\r\n\r\n    let nom   = a2;\r\n    var denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    denom = PI * denom * denom;\r\n\r\n    return nom / max(denom, 0.0000001); // prevent divide by zero for roughness=0.0 and NdotH=1.0\r\n}\r\n\r\n\r\nfn GeometryImplicit(NdotV: f32, NdotL: f32) -> f32 {\r\n    return NdotL * NdotV;\r\n}\r\n\r\n// ----------------------------------------------------------------------------\r\nfn GeometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r*r) / 8.0;\r\n\r\n    let nom   = NdotV;\r\n    let denom = NdotV * (1.0 - k) + k;\r\n\r\n    return nom / denom;\r\n}\r\n// ----------------------------------------------------------------------------\r\nfn GeometrySmith(N: vec3<f32>, V: vec3<f32>, L: vec3<f32>, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    let ggx2 = GeometrySchlickGGX(NdotV, roughness);\r\n    let ggx1 = GeometrySchlickGGX(NdotL, roughness);\r\n\r\n    return ggx1 * ggx2;\r\n}\r\n\r\n// @param cosTheta is clamp(dot(H, V), 0.0, 1.0)\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3<f32>) -> vec3<f32> {\r\n    return F0 + (1.0 - F0) * pow(max(1.0 - cosTheta, 0.0), 5.0);\r\n}\r\nfn fresnelSchlick2(specularColor: vec3<f32>, L: vec3<f32>, H: vec3<f32>) -> vec3<f32> {\r\n   return specularColor + (1.0 - specularColor) * pow(1.0 - saturate(dot(L, H)), 5.0);\r\n}\r\n//fresnelSchlick2(specularColor, L, H) * ((SpecularPower + 2) / 8 ) * pow(saturate(dot(N, H)), SpecularPower) * dotNL;\r\n\r\nconst OneOnLN2_x6 = 8.656171;// == 1/ln(2) * 6 (6 is SpecularPower of 5 + 1)\r\n// dot -> dot(N,V) or\r\nfn fresnelSchlick3(specularColor: vec3<f32>, dot: f32, glossiness: f32) -> vec3<f32> {\r\n\treturn specularColor + (max(vec3(glossiness), specularColor) - specularColor) * exp2(-OneOnLN2_x6 * dot);\r\n}\r\nfn fresnelSchlickWithRoughness(specularColor: vec3<f32>, L: vec3<f32>, N: vec3<f32>, gloss: f32) -> vec3<f32> {\r\n   return specularColor + (max(vec3(gloss), specularColor) - specularColor) * pow(1.0 - saturate(dot(L, N)), 5.0);\r\n}\r\n\r\nconst A = 2.51f;\r\nconst B = 0.03f;\r\nconst C = 2.43f;\r\nconst D = 0.59f;\r\nconst E = 0.14f;\r\nfn ACESToneMapping(color: vec3<f32>, adapted_lum: f32) -> vec3<f32> {\r\n\r\n\tlet c = color * adapted_lum;\r\n\treturn (c * (A * c + B)) / (c * (C * c + D) + E);\r\n}\r\n\r\n//color = color / (color + vec3(1.0));\r\nfn reinhard(v: vec3<f32>) -> vec3<f32> {\r\n    return v / (vec3<f32>(1.0) + v);\r\n}\r\nfn reinhard_extended(v: vec3<f32>, max_white: f32) -> vec3<f32> {\r\n    let numerator = v * (1.0f + (v / vec3(max_white * max_white)));\r\n    return numerator / (1.0f + v);\r\n}\r\nfn luminance(v: vec3<f32>) -> f32 {\r\n    return dot(v, vec3<f32>(0.2126f, 0.7152f, 0.0722f));\r\n}\r\n\r\nfn change_luminance(c_in: vec3<f32>, l_out: f32) -> vec3<f32> {\r\n    let l_in = luminance(c_in);\r\n    return c_in * (l_out / l_in);\r\n}\r\nfn reinhard_extended_luminance(v: vec3<f32>, max_white_l: f32) -> vec3<f32> {\r\n    let l_old = luminance(v);\r\n    let numerator = l_old * (1.0f + (l_old / (max_white_l * max_white_l)));\r\n    let l_new = numerator / (1.0f + l_old);\r\n    return change_luminance(v, l_new);\r\n}\r\nfn ReinhardToneMapping( color: vec3<f32>, toneMappingExposure: f32 ) -> vec3<f32> {\r\n\r\n\tlet c = color * toneMappingExposure;\r\n\treturn saturate( c / ( vec3( 1.0 ) + c ) );\r\n\r\n}\r\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\r\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\r\nconst highp_a = 12.9898;\r\nconst highp_b = 78.233;\r\nconst highp_c = 43758.5453;\r\nfn rand( uv: vec2<f32> ) -> f32 {\r\n\tlet dt = dot( uv.xy, vec2<f32>( highp_a, highp_b ) );\r\n\tlet sn = modf( dt / PI ).fract;\r\n\treturn fract(sin(sn) * highp_c);\r\n}\r\n// // based on https://www.shadertoy.com/view/MslGR8\r\nfn dithering( color: vec3<f32>, fragCoord: vec2<f32> ) -> vec3<f32> {\r\n    //Calculate grid position\r\n    let grid_position = rand( fragCoord );\r\n\r\n    //Shift the individual colors differently, thus making it even harder to see the dithering pattern\r\n    var dither_shift_RGB = vec3<f32>( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\r\n\r\n    //modify shift acording to grid position.\r\n    dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\r\n\r\n    //shift the color by dither_shift\r\n    return color + dither_shift_RGB;\r\n}\r\n\r\nconst dis = 1500.0;\r\nconst disY = 600.0;\r\nconst lightPositions = array<vec3<f32>, 4>(\r\n\tvec3<f32>(-dis, disY, dis),\r\n\tvec3<f32>(dis, disY, dis),\r\n\tvec3<f32>(-dis, disY, -dis),\r\n\tvec3<f32>(dis, disY, -dis)\r\n);\r\nconst colorValue = 700.0;\r\nconst lightColors = array<vec3<f32>, 4>(\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n);\r\n\r\nfn calcPBRColor3(Normal: vec3<f32>, WorldPos: vec3<f32>, camPos: vec3<f32>) -> vec3<f32> {\r\n\r\n\tvar color = vec3<f32>(0.0);\r\n\r\n    var ao = arm.x;\r\n    var roughness = arm.y;\r\n    var metallic = arm.z;\r\n\r\n\tvar N = normalize(Normal);\r\n    var V = normalize(camPos.xyz - WorldPos);\r\n    var dotNV = clamp(dot(N, V), 0.0, 1.0);\r\n\r\n    // calculate reflectance at normal incidence; if dia-electric (like plastic) use F0\r\n    // of 0.04 and if it's a metal, use the albedo color as F0 (metallic workflow)\r\n    var F0 = vec3(0.04);\r\n    F0 = mix(F0, albedo.xyz, metallic);\r\n\r\n    // reflectance equation\r\n    var Lo = vec3(0.0);\r\n\r\n\tfor (var i: i32 = 0; i < 4; i++) {\r\n\t\t// calculate per-light radiance\r\n        let L = normalize(lightPositions[i].xyz - WorldPos);\r\n        let H = normalize(V + L);\r\n        let distance = length(lightPositions[i].xyz - WorldPos);\r\n\r\n        let attenuation = 1.0 / (1.0 + 0.001 * distance + 0.0003 * distance * distance);\r\n        let radiance = lightColors[i].xyz * attenuation;\r\n\r\n        // Cook-Torrance BRDF\r\n        let NDF = DistributionGGX(N, H, roughness);\r\n        let G   = GeometrySmith(N, V, L, roughness);\r\n        //vec3 F    = fresnelSchlick(clamp(dot(H, V), 0.0, 1.0), F0);\r\n        let F    = fresnelSchlick3(F0,clamp(dot(H, V), 0.0, 1.0), 0.9);\r\n        //vec3 F    = fresnelSchlick3(F0,dotNV, 0.9);\r\n\r\n        let nominator    = NDF * G * F;\r\n        let denominator = 4.0 * max(dot(N, V), 0.0) * max(dot(N, L), 0.0);\r\n        let specular = nominator / max(denominator, 0.001); // prevent divide by zero for NdotV=0.0 or NdotL=0.0\r\n\r\n        // kS is equal to Fresnel\r\n        let kS = F;\r\n        // for energy conservation, the diffuse and specular light can't\r\n        // be above 1.0 (unless the surface emits light); to preserve this\r\n        // relationship the diffuse component (kD) should equal 1.0 - kS.\r\n        var kD = vec3<f32>(1.0) - kS;\r\n        // multiply kD by the inverse metalness such that only non-metals\r\n        // have diffuse lighting, or a linear blend if partly metal (pure metals\r\n        // have no diffuse light).\r\n        kD *= 1.0 - metallic;\r\n\r\n        // scale light by NdotL\r\n        let NdotL = max(dot(N, L), 0.0);\r\n\r\n        // add to outgoing radiance Lo\r\n        // note that we already multiplied the BRDF by the Fresnel (kS) so we won't multiply by kS again\r\n        Lo += (kD * albedo.xyz / PI + specular) * radiance * NdotL;\r\n\t}\r\n\t// ambient lighting (note that the next IBL tutorial will replace\r\n    // this ambient lighting with environment lighting).\r\n    let ambient = vec3<f32>(0.03) * albedo.xyz * ao;\r\n\r\n    color = ambient + Lo;\r\n    // HDR tonemapping\r\n    color = reinhard( color );\r\n    // gamma correct\r\n    color = pow(color, vec3<f32>(1.0/2.2));\r\n\treturn color;\r\n}\r\n\r\n@fragment\r\nfn main(\r\n  @location(0) pos: vec4<f32>,\r\n  @location(1) uv: vec2<f32>,\r\n  @location(2) normal: vec3<f32>,\r\n  @location(3) camPos: vec3<f32>\r\n) -> @location(0) vec4<f32> {\r\n  var color4 = vec4(calcPBRColor3(normal, pos.xyz, camPos), 1.0);\r\n  return color4;\r\n}"},"0d77":function(t,e,i){"use strict";i.r(e),e["default"]="const PI = 3.141592653589793;\r\nconst PI2 = 6.283185307179586;\r\nconst PI_HALF = 1.5707963267948966;\r\nconst RECIPROCAL_PI = 0.3183098861837907;\r\nconst RECIPROCAL_PI2 = 0.15915494309189535;\r\nconst EPSILON = 1e-6;\r\n\r\nfn approximationSRGBToLinear(srgbColor: vec3<f32>) -> vec3<f32> {\r\n    return pow(srgbColor, vec3<f32>(2.2));\r\n}\r\nfn approximationLinearToSRCB(linearColor: vec3<f32>) -> vec3<f32> {\r\n    return pow(linearColor, vec3(1.0/2.2));\r\n}\r\n\r\nfn accurateSRGBToLinear(srgbColor: vec3<f32>) -> vec3<f32> {\r\n    let linearRGBLo = srgbColor / 12.92;\r\n    let linearRGBHi = pow((srgbColor + vec3(0.055)) / vec3(1.055), vec3(2.4));\r\n\tif( all( srgbColor <= vec3(0.04045) ) ) {\r\n\t\treturn linearRGBLo;\r\n\t}\r\n    return linearRGBHi;\r\n}\r\nfn accurateLinearToSRGB(linearColor: vec3<f32>) -> vec3<f32> {\r\n    let srgbLo = linearColor * 12.92;\r\n    let srgbHi = (pow(abs(linearColor), vec3(1.0 / 2.4)) * 1.055) - 0.055;\r\n    if(all(linearColor <= vec3(0.0031308))) {\r\n\t\treturn srgbLo;\r\n\t}\r\n    return srgbHi;\r\n}\r\n\r\n// Trowbridge-Reitz(Generalized-Trowbridge-Reitz,GTR)\r\nfn DistributionGTR1(NdotH: f32, roughness: f32) -> f32 {\r\n    if (roughness >= 1.0) {\r\n\t\treturn 1.0/PI;\r\n\t}\r\n    let a2 = roughness * roughness;\r\n    let t = 1.0 + (a2 - 1.0)*NdotH*NdotH;\r\n    return (a2 - 1.0) / (PI * log(a2) *t);\r\n}\r\nfn DistributionGTR2(NdotH: f32, roughness: f32) -> f32 {\r\n    let a2 = roughness * roughness;\r\n    let t = 1.0 + (a2 - 1.0) * NdotH * NdotH;\r\n    return a2 / (PI * t * t);\r\n}\r\n\r\n\r\nfn DistributionGGX(N: vec3<f32>, H: vec3<f32>, roughness: f32) -> f32 {\r\n    let a = roughness*roughness;\r\n    let a2 = a*a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH*NdotH;\r\n\r\n    let nom   = a2;\r\n    var denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    denom = PI * denom * denom;\r\n\r\n    return nom / max(denom, 0.0000001); // prevent divide by zero for roughness=0.0 and NdotH=1.0\r\n}\r\n\r\n\r\nfn GeometryImplicit(NdotV: f32, NdotL: f32) -> f32 {\r\n    return NdotL * NdotV;\r\n}\r\n\r\n// ----------------------------------------------------------------------------\r\nfn GeometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r*r) / 8.0;\r\n\r\n    let nom   = NdotV;\r\n    let denom = NdotV * (1.0 - k) + k;\r\n\r\n    return nom / denom;\r\n}\r\n// ----------------------------------------------------------------------------\r\nfn GeometrySmith(N: vec3<f32>, V: vec3<f32>, L: vec3<f32>, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    let ggx2 = GeometrySchlickGGX(NdotV, roughness);\r\n    let ggx1 = GeometrySchlickGGX(NdotL, roughness);\r\n\r\n    return ggx1 * ggx2;\r\n}\r\n\r\n// @param cosTheta is clamp(dot(H, V), 0.0, 1.0)\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3<f32>) -> vec3<f32> {\r\n    return F0 + (1.0 - F0) * pow(max(1.0 - cosTheta, 0.0), 5.0);\r\n}\r\nfn fresnelSchlick2(specularColor: vec3<f32>, L: vec3<f32>, H: vec3<f32>) -> vec3<f32> {\r\n   return specularColor + (1.0 - specularColor) * pow(1.0 - saturate(dot(L, H)), 5.0);\r\n}\r\n//fresnelSchlick2(specularColor, L, H) * ((SpecularPower + 2) / 8 ) * pow(saturate(dot(N, H)), SpecularPower) * dotNL;\r\n\r\nconst OneOnLN2_x6 = 8.656171;// == 1/ln(2) * 6 (6 is SpecularPower of 5 + 1)\r\n// dot -> dot(N,V) or\r\nfn fresnelSchlick3(specularColor: vec3<f32>, dot: f32, glossiness: f32) -> vec3<f32> {\r\n\treturn specularColor + (max(vec3(glossiness), specularColor) - specularColor) * exp2(-OneOnLN2_x6 * dot);\r\n}\r\nfn fresnelSchlickWithRoughness(specularColor: vec3<f32>, L: vec3<f32>, N: vec3<f32>, gloss: f32) -> vec3<f32> {\r\n   return specularColor + (max(vec3(gloss), specularColor) - specularColor) * pow(1.0 - saturate(dot(L, N)), 5.0);\r\n}\r\n\r\nconst A = 2.51f;\r\nconst B = 0.03f;\r\nconst C = 2.43f;\r\nconst D = 0.59f;\r\nconst E = 0.14f;\r\nfn ACESToneMapping(color: vec3<f32>, adapted_lum: f32) -> vec3<f32> {\r\n\r\n\tlet c = color * adapted_lum;\r\n\treturn (c * (A * c + B)) / (c * (C * c + D) + E);\r\n}\r\n\r\n//color = color / (color + vec3(1.0));\r\nfn reinhard(v: vec3<f32>) -> vec3<f32> {\r\n    return v / (vec3<f32>(1.0) + v);\r\n}\r\nfn reinhard_extended(v: vec3<f32>, max_white: f32) -> vec3<f32> {\r\n    let numerator = v * (1.0f + (v / vec3(max_white * max_white)));\r\n    return numerator / (1.0f + v);\r\n}\r\nfn luminance(v: vec3<f32>) -> f32 {\r\n    return dot(v, vec3<f32>(0.2126f, 0.7152f, 0.0722f));\r\n}\r\n\r\nfn change_luminance(c_in: vec3<f32>, l_out: f32) -> vec3<f32> {\r\n    let l_in = luminance(c_in);\r\n    return c_in * (l_out / l_in);\r\n}\r\nfn reinhard_extended_luminance(v: vec3<f32>, max_white_l: f32) -> vec3<f32> {\r\n    let l_old = luminance(v);\r\n    let numerator = l_old * (1.0f + (l_old / (max_white_l * max_white_l)));\r\n    let l_new = numerator / (1.0f + l_old);\r\n    return change_luminance(v, l_new);\r\n}\r\nfn ReinhardToneMapping( color: vec3<f32>, toneMappingExposure: f32 ) -> vec3<f32> {\r\n\r\n\tlet c = color * toneMappingExposure;\r\n\treturn saturate( c / ( vec3( 1.0 ) + c ) );\r\n\r\n}\r\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\r\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\r\nconst highp_a = 12.9898;\r\nconst highp_b = 78.233;\r\nconst highp_c = 43758.5453;\r\nfn rand( uv: vec2<f32> ) -> f32 {\r\n\tlet dt = dot( uv.xy, vec2<f32>( highp_a, highp_b ) );\r\n\tlet sn = modf( dt / PI ).fract;\r\n\treturn fract(sin(sn) * highp_c);\r\n}\r\n// // based on https://www.shadertoy.com/view/MslGR8\r\nfn dithering( color: vec3<f32>, fragCoord: vec2<f32> ) -> vec3<f32> {\r\n    //Calculate grid position\r\n    let grid_position = rand( fragCoord );\r\n\r\n    //Shift the individual colors differently, thus making it even harder to see the dithering pattern\r\n    var dither_shift_RGB = vec3<f32>( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\r\n\r\n    //modify shift acording to grid position.\r\n    dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\r\n\r\n    //shift the color by dither_shift\r\n    return color + dither_shift_RGB;\r\n}\r\n\r\nconst dis = 700.0;\r\nconst disZ = 400.0;\r\nconst u_lightPositions = array<vec3<f32>, 4>(\r\n\tvec3<f32>(-dis, dis, disZ),\r\n\tvec3<f32>(dis, dis, disZ),\r\n\tvec3<f32>(-dis, -dis, disZ),\r\n\tvec3<f32>(dis, -dis, disZ)\r\n);\r\nconst colorValue = 300.0;\r\nconst u_lightColors = array<vec3<f32>, 4>(\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n);\r\n\r\nfn calcPBRColor3(Normal: vec3<f32>, WorldPos: vec3<f32>, camPos: vec3<f32>, albedo: vec3<f32>, param: vec3<f32>) -> vec3<f32> {\r\n\r\n\tvar color = vec3<f32>(0.0);\r\n\r\n    var ao = param.x;\r\n    var roughness = param.y;\r\n    var metallic = param.z;\r\n\r\n\tvar N = normalize(Normal);\r\n    var V = normalize(camPos.xyz - WorldPos);\r\n    var dotNV = clamp(dot(N, V), 0.0, 1.0);\r\n\r\n    // calculate reflectance at normal incidence; if dia-electric (like plastic) use F0\r\n    // of 0.04 and if it's a metal, use the albedo color as F0 (metallic workflow)\r\n    var F0 = vec3(0.04);\r\n    F0 = mix(F0, albedo.xyz, metallic);\r\n\r\n    // reflectance equation\r\n    var Lo = vec3(0.0);\r\n\r\n\tfor (var i: i32 = 0; i < 4; i++) {\r\n\t\t// calculate per-light radiance\r\n        let L = normalize(u_lightPositions[i].xyz - WorldPos);\r\n        let H = normalize(V + L);\r\n        let distance = length(u_lightPositions[i].xyz - WorldPos);\r\n\r\n        let attenuation = 1.0 / (1.0 + 0.001 * distance + 0.0003 * distance * distance);\r\n        let radiance = u_lightColors[i].xyz * attenuation;\r\n\r\n        // Cook-Torrance BRDF\r\n        let NDF = DistributionGGX(N, H, roughness);\r\n        let G   = GeometrySmith(N, V, L, roughness);\r\n        //vec3 F    = fresnelSchlick(clamp(dot(H, V), 0.0, 1.0), F0);\r\n        let F    = fresnelSchlick3(F0,clamp(dot(H, V), 0.0, 1.0), 0.9);\r\n        //vec3 F    = fresnelSchlick3(F0,dotNV, 0.9);\r\n\r\n        let nominator    = NDF * G * F;\r\n        let denominator = 4.0 * max(dot(N, V), 0.0) * max(dot(N, L), 0.0);\r\n        let specular = nominator / max(denominator, 0.001); // prevent divide by zero for NdotV=0.0 or NdotL=0.0\r\n\r\n        // kS is equal to Fresnel\r\n        let kS = F;\r\n        // for energy conservation, the diffuse and specular light can't\r\n        // be above 1.0 (unless the surface emits light); to preserve this\r\n        // relationship the diffuse component (kD) should equal 1.0 - kS.\r\n        var kD = vec3<f32>(1.0) - kS;\r\n        // multiply kD by the inverse metalness such that only non-metals\r\n        // have diffuse lighting, or a linear blend if partly metal (pure metals\r\n        // have no diffuse light).\r\n        kD *= 1.0 - metallic;\r\n\r\n        // scale light by NdotL\r\n        let NdotL = max(dot(N, L), 0.0);\r\n\r\n        // add to outgoing radiance Lo\r\n        // note that we already multiplied the BRDF by the Fresnel (kS) so we won't multiply by kS again\r\n        Lo += (kD * albedo.xyz / PI + specular) * radiance * NdotL;\r\n\t}\r\n\t// ambient lighting (note that the next IBL tutorial will replace\r\n    // this ambient lighting with environment lighting).\r\n    let ambient = vec3<f32>(0.03) * albedo.xyz * ao;\r\n\r\n    color = ambient + Lo;\r\n    // HDR tonemapping\r\n    color = reinhard( color );\r\n    // gamma correct\r\n    color = pow(color, vec3<f32>(1.0/2.2));\r\n\treturn color;\r\n}\r\n\r\n@fragment\r\nfn fragMain(\r\n  @location(0) pos: vec4<f32>,\r\n  @location(1) uv: vec2<f32>,\r\n  @location(2) normal: vec3<f32>,\r\n  @location(3) camPos: vec3<f32>,\r\n  @location(4) albedo: vec3<f32>,\r\n  @location(5) param: vec3<f32>,\r\n) -> @location(0) vec4<f32> {\r\n  let color3 = calcPBRColor3(normal, pos.xyz, camPos, albedo, param);\r\n  var color4 = vec4(color3, 1.0);\r\n  return color4;\r\n}\r\n"},"0db1":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> param: vec4f;\r\n@group(0) @binding(1) var colorSampler0: sampler;\r\n@group(0) @binding(2) var colorTexture0: texture_2d<f32>;\r\n@group(0) @binding(3) var blurSampler1: sampler;\r\n@group(0) @binding(4) var blurTexture1: texture_2d<f32>;\r\n@group(0) @binding(5) var vposSampler1: sampler;\r\n@group(0) @binding(6) var vposTexture1: texture_2d<f32>;\r\n\r\nfn reinhard(v: vec3<f32>) -> vec3<f32> {\r\n    return v / (vec3<f32>(1.0) + v);\r\n}\r\nfn calcColor(uv: vec2f) -> vec4f {\r\n\r\n    var color = textureSample(colorTexture0, colorSampler0, uv) * param;\r\n    var blurColor = textureSample(blurTexture1, blurSampler1, uv);\r\n    var vpos = textureSample(vposTexture1, vposSampler1, uv);\r\n\tvar f = clamp((length(vpos.xyz) - 300.0)/200.0, 0.0, 1.0);\r\n\tf = 1.0 - f * f;\r\n\t// f = f * f;\r\n\tvar result = vec4f(color.xyz * (1.0 - f) + f * blurColor.xyz, 1.0);\r\n\r\n    return result;\r\n}\r\n\r\n@fragment\r\nfn main(\r\n\t@location(0) uv: vec2f\r\n\t) -> @location(0) vec4f {\r\n\tvar color4 = calcColor( uv );\r\n    return color4;\r\n}\r\n"},"0dcf":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> objMat : mat4x4<f32>;\r\n@group(0) @binding(1) var<uniform> viewMat : mat4x4<f32>;\r\n@group(0) @binding(2) var<uniform> projMat : mat4x4<f32>;\r\n\r\nstruct VertexOutput {\r\n  @builtin(position) Position : vec4<f32>,\r\n  @location(0) pos: vec4<f32>,\r\n  @location(1) uv : vec2<f32>,\r\n  @location(2) normal : vec3<f32>,\r\n  @location(3) camPos : vec3<f32>\r\n}\r\n\r\nfn m44ToM33(m: mat4x4<f32>) -> mat3x3<f32> {\r\n\treturn mat3x3(m[0].xyz, m[1].xyz, m[2].xyz);\r\n}\r\nfn inverseM33(m: mat3x3<f32>)-> mat3x3<f32> {\r\n    let a00 = m[0][0]; let a01 = m[0][1]; let a02 = m[0][2];\r\n    let a10 = m[1][0]; let a11 = m[1][1]; let a12 = m[1][2];\r\n    let a20 = m[2][0]; let a21 = m[2][1]; let a22 = m[2][2];\r\n    let b01 = a22 * a11 - a12 * a21;\r\n    let b11 = -a22 * a10 + a12 * a20;\r\n    let b21 = a21 * a10 - a11 * a20;\r\n    let det = a00 * b01 + a01 * b11 + a02 * b21;\r\n    return mat3x3<f32>(\r\n\t\tvec3<f32>(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11)) / det,\r\n                vec3<f32>(b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10)) / det,\r\n                vec3<f32>(b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det);\r\n}\r\nfn inverseM44(m: mat4x4<f32>)-> mat4x4<f32> {\r\n    let a00 = m[0][0]; let a01 = m[0][1]; let a02 = m[0][2]; let a03 = m[0][3];\r\n    let a10 = m[1][0]; let a11 = m[1][1]; let a12 = m[1][2]; let a13 = m[1][3];\r\n    let a20 = m[2][0]; let a21 = m[2][1]; let a22 = m[2][2]; let a23 = m[2][3];\r\n    let a30 = m[3][0]; let a31 = m[3][1]; let a32 = m[3][2]; let a33 = m[3][3];\r\n    let b00 = a00 * a11 - a01 * a10;\r\n    let b01 = a00 * a12 - a02 * a10;\r\n    let b02 = a00 * a13 - a03 * a10;\r\n    let b03 = a01 * a12 - a02 * a11;\r\n    let b04 = a01 * a13 - a03 * a11;\r\n    let b05 = a02 * a13 - a03 * a12;\r\n    let b06 = a20 * a31 - a21 * a30;\r\n    let b07 = a20 * a32 - a22 * a30;\r\n    let b08 = a20 * a33 - a23 * a30;\r\n    let b09 = a21 * a32 - a22 * a31;\r\n    let b10 = a21 * a33 - a23 * a31;\r\n    let b11 = a22 * a33 - a23 * a32;\r\n    let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\treturn mat4x4<f32>(\r\n\t\tvec4<f32>(a11 * b11 - a12 * b10 + a13 * b09,\r\n\t\ta02 * b10 - a01 * b11 - a03 * b09,\r\n\t\ta31 * b05 - a32 * b04 + a33 * b03,\r\n\t\ta22 * b04 - a21 * b05 - a23 * b03) / det,\r\n\t\t\tvec4<f32>(a12 * b08 - a10 * b11 - a13 * b07,\r\n\t\ta00 * b11 - a02 * b08 + a03 * b07,\r\n\t\ta32 * b02 - a30 * b05 - a33 * b01,\r\n\t\ta20 * b05 - a22 * b02 + a23 * b01) / det,\r\n\t\tvec4<f32>(a10 * b10 - a11 * b08 + a13 * b06,\r\n\t\ta01 * b08 - a00 * b10 - a03 * b06,\r\n\t\ta30 * b04 - a31 * b02 + a33 * b00,\r\n\t\ta21 * b02 - a20 * b04 - a23 * b00) / det,\r\n\t\tvec4<f32>(a11 * b07 - a10 * b09 - a12 * b06,\r\n\t\ta00 * b09 - a01 * b07 + a02 * b06,\r\n\t\ta31 * b01 - a30 * b03 - a32 * b00,\r\n\t\ta20 * b03 - a21 * b01 + a22 * b00) / det);\r\n}\r\n@vertex\r\nfn main(\r\n  @location(0) position : vec3<f32>,\r\n  @location(1) uv : vec2<f32>,\r\n  @location(2) normal : vec3<f32>\r\n) -> VertexOutput {\r\n  let wpos = objMat * vec4(position.xyz, 1.0);\r\n  var output : VertexOutput;\r\n  output.Position = projMat * viewMat * wpos;\r\n  output.uv = uv;\r\n\r\n  let invMat33 = inverseM33( m44ToM33( objMat ) );\r\n  output.normal = normalize( normal * invMat33 );\r\n  output.camPos = (inverseM44(viewMat) * vec4<f32>(0.0,0.0,0.0, 1.0)).xyz;\r\n  output.pos = wpos;\r\n  return output;\r\n}\r\n"},"0f15":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(3) var mySampler: sampler;\r\n@group(0) @binding(4) var myTexture: texture_cube<f32>;\r\nconst hdrBrnDecodeVec4 = vec4f(255.0, 2.55, 0.0255, 0.000255);\r\nfn rgbaToHdrBrn(color: vec4f) -> f32 {\r\n    return dot(hdrBrnDecodeVec4, color);\r\n}\r\n\r\n@fragment\r\nfn main(\r\n  @location(0) fragPosition: vec4<f32>\r\n) -> @location(0) vec4<f32> {\r\n  // Our camera and the skybox cube are both centered at (0, 0, 0)\r\n  // so we can use the cube geomtry position to get viewing vector to sample the cube texture.\r\n  // The magnitude of the vector doesn't matter.\r\n  var cubemapVec = fragPosition.xyz - vec3(0.5);\r\n//   var c4 = textureSample(myTexture, mySampler, cubemapVec);\r\n  var c4 = textureSampleLevel(myTexture, mySampler, cubemapVec, 2.0);\r\n  let v3 = vec3( rgbaToHdrBrn(c4) );\r\n  c4 = vec4(v3, 1.0);\r\n  return c4;\r\n//   return textureSample(myTexture, mySampler, cubemapVec);\r\n}\r\n"},"0f9f":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){this.ls=[],this.funcs=[]}add(t,e){let i=0,r=this.ls;for(;i<this.ls.length;++i)if(t==r[i])break;i>=this.ls.length&&(r.push(t),this.funcs.push(e))}remove(t){let e=this.ls;for(let i=0;i<this.ls.length;++i)if(t==e[i]){e.splice(i,1),this.funcs.splice(i,1);break}}run(t){for(let e=0;e<this.ls.length;++e)this.funcs[e](t)}}class s{constructor(){this.evts=null}init(){if(null==this.evts){this.evts=[];for(let t=0;t<2;++t)this.evts.push(new r)}var t=null,e=null;document&&(t=document,e=window,t.onmouseup=t=>{this.evts[1].run(t)}),e&&(e.onresize=t=>{this.evts[0].run(t)})}addWindowResizeEvt(t,e){this.evts[0].add(t,e)}removeWindowResizeEvt(t){this.evts[0].remove(t)}addDocMouUpEvt(t,e){this.evts[1].add(t,e)}removeDocMouUpEvt(t){this.evts[1].remove(t)}}class n{constructor(){this.m_singleDown=!1,this.m_mouseX=0,this.m_mouseY=0,this.m_mouseClickTime=0,this.sysEvt=null,this.dpr=1,this.m_canvas=null,this.sysEvt=n.s_sevt,this.sysEvt.init()}initMobile(t,e,i){var r=null;try{document&&(r=document)}catch(s){}if(r){let t=this;e.addEventListener("touchstart",t=>{let e=t.targetTouches,r=0,s=0;if(e.length<2)r=0|this.dpr*t.targetTouches[0].pageX,s=0|this.dpr*t.targetTouches[0].pageY,i.mouseX=r,i.mouseY=i.stageHeight-s,i.mouseViewX=r,i.mouseViewY=s,this.m_singleDown=!0,this.m_mouseX=i.mouseX,this.m_mouseY=i.mouseY,this.m_mouseClickTime=Date.now(),i.mouseDown(1);else{let n=[];for(let i=0;i<e.length;++i)r=0|this.dpr*t.targetTouches[i].pageX,s=0|this.dpr*t.targetTouches[i].pageY,n.push({x:r,y:s});i.mouseMultiDown(n),this.m_singleDown=!1}t.preventDefault(),t.stopPropagation()},!1),e.addEventListener("touchend",t=>{this.m_singleDown=!1;let e=t.targetTouches,r=0,s=0;if(e.length<1)i.mouseUp(1),this.m_mouseClickTime=Date.now()-this.m_mouseClickTime,Math.abs(this.m_mouseX-i.mouseX)<2&&Math.abs(this.m_mouseY-i.mouseY)<2&&this.m_mouseClickTime<900&&(this.m_mouseX=i.mouseX,this.m_mouseY=i.mouseY,i.mouseClick());else{let n=[];for(let i=0;i<e.length;++i)r=0|this.dpr*t.targetTouches[i].pageX,s=0|this.dpr*t.targetTouches[i].pageY,n.push({x:r,y:s});i.mouseMultiUp(n)}t.preventDefault()},!1),e.addEventListener("touchcancel",e=>{t.m_singleDown=!1;e.targetTouches;i.mouseCancel(),e.preventDefault()},!1),e.addEventListener("touchmove",t=>{t.preventDefault();let e=t.targetTouches,r=0,s=0;if(this.m_singleDown&&(r=0|this.dpr*e[0].pageX,s=0|this.dpr*e[0].pageY,i.mouseViewX=r,i.mouseViewY=s,i.mouseX=r,i.mouseY=i.stageHeight-s,i.mouseMove()),e.length>1){let n=[];for(let i=0;i<e.length;++i)r=0|this.dpr*t.targetTouches[i].pageX,s=0|this.dpr*t.targetTouches[i].pageY,n.push({x:r,y:s});i.mouseMultiMove(n)}},{passive:!1},!1)}}initialize(t,e,i){let r=!1;r||this.initPC(t,e,i),this.initMobile(t,e,i)}initPC(t,e,i){var r=null;if(null!=this.m_canvas){let t=this.m_canvas;t.onmousewheel=null,t.onmousedown=null,t.onmouseup=null,t.onmousemove=null,t.onclick=null,t.canvas=null}try{void 0!=document&&(r=document)}catch(s){}if(null!=r){if(this.m_canvas=t,void 0==t.onmousewheel&&void 0!=t.addEventListener){let e=function(t){t.wheelDeltaY=-t.detail,i.mouseWheel(t)};t.addEventListener("DOMMouseScroll",e,!1)}t.onmousewheel=t=>{t.preventDefault(),t.stopPropagation(),i.mouseWheel(t)},t.onmousedown=t=>{let r=e.getBoundingClientRect(),s=0|this.dpr*(t.clientX-r.left),n=0|this.dpr*(t.clientY-r.top);i.mouseX=s,i.mouseY=i.stageHeight-n,i.mouseViewX=s,i.mouseViewY=n,this.m_mouseX=i.mouseX,this.m_mouseY=i.mouseY,this.m_mouseClickTime=Date.now(),0==t.button?i.mouseDown(1):1==t.button?i.mouseMiddleDown():2==t.button&&i.mouseRightDown(1)},t.onmouseup=t=>{let r=e.getBoundingClientRect(),s=0|this.dpr*(t.clientX-r.left),n=0|this.dpr*(t.clientY-r.top);i.mouseX=s,i.mouseY=i.stageHeight-n,0==t.button?i.mouseUp(1):1==t.button?i.mouseMiddleUp():2==t.button&&i.mouseRightUp(1)};let r=t=>{0==t.button?i.mouseWindowUp(1):1==t.button||2==t.button&&i.mouseWindowRightUp(1)};this.sysEvt.addDocMouUpEvt(this,r),t.onmousemove=t=>{let r=e.getBoundingClientRect(),s=0|this.dpr*(t.clientX-r.left),n=0|this.dpr*(t.clientY-r.top);i.mouseX=s,i.mouseY=i.stageHeight-n,i.mouseViewX=s,i.mouseViewY=n,i.mouseMove()},t.onclick=t=>{let r=e.getBoundingClientRect(),s=0|this.dpr*(t.clientX-r.left),n=0|this.dpr*(t.clientY-r.top);i.mouseX=s,i.mouseY=i.stageHeight-n,i.mouseViewX=s,i.mouseViewY=n,this.m_mouseClickTime=Date.now()-this.m_mouseClickTime,Math.abs(this.m_mouseX-i.mouseX)<2&&Math.abs(this.m_mouseY-i.mouseY)<2&&this.m_mouseClickTime<900&&(this.m_mouseX=i.mouseX,this.m_mouseY=i.mouseY,0==t.button?i.mouseClick():2==t.button&&i.mouseRightClick())},t.ondblclick=t=>{let r=e.getBoundingClientRect(),s=0|this.dpr*(t.clientX-r.left),n=0|this.dpr*(t.clientY-r.top);i.mouseX=s,i.mouseY=i.stageHeight-n,i.mouseViewX=s,i.mouseViewY=n,0==t.button?i.mouseDoubleClick():t.button}}}}n.s_sevt=new s,e.default=n},"163b":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("b876");e.CoGeomDataType=r.CoGeomDataType,e.CoDataFormat=r.CoDataFormat;const s=i("5476");class n{constructor(){this.m_loadedCall=null,this.m_loadedAllCall=null,this.m_loadTotal=0,this.m_loadedTotal=0,this.verTool=null}setListener(t,e){this.m_loadedCall=t,this.m_loadedAllCall=e}load(t,e=""){if(n.s_coapp.verTool=this.verTool,null!=t&&t.length>0){n.s_coapp.initialize(null,!0);let i=t.slice(0);n.s_coapp.deferredInit(()=>{for(let t=0;t<i.length;++t)this.loadModel(i[t],e)})}}loadWithType(t,e){if(n.s_coapp.verTool=this.verTool,null!=t&&t.length>0){n.s_coapp.initialize(null,!0);let i=t.slice(0);n.s_coapp.deferredInit(()=>{for(let t=0;t<i.length;++t)this.loadModel(i[t],e[t])})}}reset(){this.m_loadedTotal=0,this.m_loadTotal=0}loadModel(t,e=""){let i=e;if(""==e){let e=t.lastIndexOf(".")+1,r=t.lastIndexOf("?");i=r<0?t.slice(e):t.slice(e,r)}i=i.toLocaleLowerCase();let s=r.CoDataFormat.Undefined;switch(i){case"obj":s=r.CoDataFormat.OBJ;break;case"fbx":s=r.CoDataFormat.FBX;break;case"drc":s=r.CoDataFormat.Draco;break;case"ctm":s=r.CoDataFormat.CTM;break;default:break}s!=r.CoDataFormat.Undefined&&this.loadGeomModel(t,s)}loadGeomModel(t,e){let i=n.s_coapp;if(null!=i){let s=i.getCPUDataByUrlAndCallback(t,e,(t,i)=>{e!=r.CoDataFormat.FBX&&(this.loadedModels(t.data.models,t.data.transforms,e,t.url),this.m_loadTotal++,this.loadedModelFromUnit(t,i))},!0);e==r.CoDataFormat.FBX&&(s.data.modelReceiver=(t,i,r,n)=>{0==r&&this.m_loadTotal++,this.loadedModels(t,i,e,s.url),this.loadedModelFromUnit(s,0,r+1==n)})}}loadedModels(t,e,i,r){null!=this.m_loadedCall&&this.m_loadedCall(t,e,i,r)}loadedModelFromUnit(t,e=0,i=!0){if(i&&this.m_loadedTotal++,this.m_loadedTotal>=this.m_loadTotal){let e=this.m_loadedTotal;this.reset(),this.m_loadedAllCall(e,t.url)}}destroy(){this.m_loadedCall=null}}n.s_coapp=new s.CoDataModule,e.CoGeomModelLoader=n},1934:function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> color: vec4f;\r\n@group(0) @binding(1) var sampler0: sampler;\r\n@group(0) @binding(2) var texture0: texture_2d<f32>;\r\n\r\n@fragment\r\nfn main(\r\n\t@location(0) uv: vec2f\r\n\t) -> @location(0) vec4f {\r\n\tvar color4 = textureSample(texture0, sampler0, uv) * color;\r\n    return color4;\r\n}\r\n"},"19e8":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("b1fa")),n=r(i("bcc5")),a=r(i("3cf9")),o=r(i("e315"));class l extends o.default{constructor(t,e){super(t),this.m_resize_listener=[],this.m_enterFrame_listener=[],this.m_keyEvt=new n.default,this.m_keyDown_listener=[],this.m_keyUp_listener=[],this.m_enterFrameEvt=new s.default,l.s_document||(l.s_document=e,e.onkeydown=function(t){a.default.KeyDown(t)},e.onkeyup=function(t){a.default.KeyUp(t)}),a.default.AddEventListener(n.default.KEY_DOWN,this,this.keyDown),a.default.AddEventListener(n.default.KEY_UP,this,this.keyUp)}enterFrame(){this.m_enterFrameEvt.type=s.default.ENTER_FRAME;const t=this.m_enterFrame_listener;let e=t.length;for(var i=0;i<e;++i)t[i](this.m_enterFrameEvt)}setViewPort(t,e,i,r){this.m_autoSynViewAndStageSize=!1,this.m_viewX=t,this.m_viewY=e,i==this.m_viewW&&r==this.m_viewH||(this.m_viewW=i,this.m_viewH=r,this.updateViewUData())}updateViewUData(){this.m_preStageWidth=this.m_viewW,this.m_preStageHeight=this.m_viewH}update(){this.m_preStageWidth!=this.stageWidth||this.m_preStageHeight!=this.stageHeight?(this.m_autoSynViewAndStageSize&&(this.m_viewW=this.stageWidth,this.m_viewH=this.stageHeight,this.updateViewUData()),this.m_stW=this.stageWidth,this.m_stH=this.stageHeight,this.stageHalfWidth=.5*this.m_stW,this.stageHalfHeight=.5*this.m_stH,this.m_baseEvt.target=this,this.m_baseEvt.type=s.default.RESIZE,this.m_baseEvt.phase=1,this.sendResizeEvt(this.m_baseEvt)):(this.stageWidth=this.m_stW,this.stageHeight=this.m_stH,this.stageHalfWidth=.5*this.m_stW,this.stageHalfHeight=.5*this.m_stH)}keyDown(t){this.m_keyEvt.phase=1,this.m_keyEvt.type=n.default.KEY_DOWN,this.m_keyEvt.altKey=t.altKey,this.m_keyEvt.ctrlKey=t.ctrlKey,this.m_keyEvt.shiftKey=t.shiftKey,this.m_keyEvt.repeat=t.repeat,this.m_keyEvt.key=t.key,this.m_keyEvt.keyCode=t.keyCode,this.m_keyEvt.location=t.location;let e=this.m_keyDown_listener.length;for(var i=0;i<e;++i)this.m_keyDown_listener[i](this.m_keyEvt)}keyUp(t){this.m_keyEvt.phase=1,this.m_keyEvt.type=n.default.KEY_UP,this.m_keyEvt.altKey=t.altKey,this.m_keyEvt.ctrlKey=t.ctrlKey,this.m_keyEvt.shiftKey=t.shiftKey,this.m_keyEvt.repeat=t.repeat,this.m_keyEvt.key=t.key,this.m_keyEvt.keyCode=t.keyCode,this.m_keyEvt.location=t.location,this.m_keyEvt.target=this;let e=this.m_keyUp_listener.length;for(var i=0;i<e;++i)this.m_keyUp_listener[i](this.m_keyEvt)}sendResizeEvt(t){let e=this.m_resize_listener.length;for(var i=0;i<e;++i)this.m_resize_listener[i](t)}addEventListener(t,e,i=!0,r=!0){if(e)switch(t){case s.default.RESIZE:this.addTarget(this.m_resize_listener,e);break;case s.default.ENTER_FRAME:this.addTarget(this.m_enterFrame_listener,e);break;case n.default.KEY_DOWN:this.addTarget(this.m_keyDown_listener,e);break;case n.default.KEY_UP:this.addTarget(this.m_keyUp_listener,e);break;default:this.m_dp.addEventListener(t,e,i,r);break}}removeEventListener(t,e){if(e)switch(t){case s.default.RESIZE:this.removeTarget(this.m_resize_listener,e);break;case s.default.ENTER_FRAME:this.removeTarget(this.m_enterFrame_listener,e);break;case n.default.KEY_DOWN:this.removeTarget(this.m_keyDown_listener,e);break;case n.default.KEY_UP:this.removeTarget(this.m_keyUp_listener,e);break;default:this.m_dp.removeEventListener(t,e);break}}}l.s_document=null,e.default=l},"19f9":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("58c4");e.WGTextureDataDescriptor=r.WGTextureDataDescriptor;const s=i("943f");class n extends s.WGMaterial{constructor(t){if(super(t),t){const e=t.workcounts;e&&this.setWorkcounts(e[0],e.length>1?e[1]:0,e.length>2?e[2]:0)}}setWorkcounts(t,e,i){this.workcounts||(this.workcounts=new Uint16Array([1,1,0,0]));const r=this.workcounts;return r[0]=t,r[1]=void 0!==e?e:0,r[2]=void 0!==i?i:0,this}}e.WGCompMaterial=n},"1a9d":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(3) var mySampler: sampler;\r\n@group(0) @binding(4) var myTexture: texture_cube<f32>;\r\n\r\n@fragment\r\nfn main(\r\n  @location(0) fragPosition: vec4<f32>\r\n) -> @location(0) vec4<f32> {\r\n  // Our camera and the skybox cube are both centered at (0, 0, 0)\r\n  // so we can use the cube geomtry position to get viewing vector to sample the cube texture.\r\n  // The magnitude of the vector doesn't matter.\r\n  var cubemapVec = fragPosition.xyz - vec3(0.5);\r\n  return textureSample(myTexture, mySampler, cubemapVec);\r\n}\r\n"},"1d61":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("fe0b");class s{constructor(){this.depthClearValue=1,this.depthLoadOp="clear",this.depthStoreOp="store"}setParam(t){return t&&r.copyFromObjectValueWithKey(t,this),this}}e.WGRPDepthStencilAttachment=s},"1eb2":function(t,e,i){"use strict";if("undefined"!==typeof window){var r=window.document.currentScript,s=i("8875");r=s(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:s});var n=r&&r.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(i.p=n[1])}},"1ee1":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("2c77")),n=r(i("af80")),a=i("648f"),o=[new n.default,new n.default,new n.default,new n.default,new n.default,new n.default,new n.default,new n.default];function l(t){const e=o;let i=t.length<8?t.length:8;for(let s=0;s<i;++s)e[s].setXYZ(0,0,0).setVector3(t[s]);let r=[e[0],e[1],e[1],e[2],e[2],e[3],e[3],e[0],e[0],e[4],e[1],e[5],e[2],e[6],e[3],e[7],e[4],e[5],e[5],e[6],e[6],e[7],e[7],e[4]];return r}function u(t,e=1){let i=t.extent.clone().scaleBy(e),r=t.center,s=t.axes[0].clone().scaleBy(i.x),n=t.axes[1].clone().scaleBy(i.y),a=t.axes[2].clone().scaleBy(i.z),o=s.clone().scaleBy(-1),l=n.clone().scaleBy(-1),u=a.clone().scaleBy(-1),h=s.clone().addBy(n).addBy(a).addBy(r),c=s.clone().addBy(n).addBy(u).addBy(r),d=o.clone().addBy(n).addBy(u).addBy(r),m=o.clone().addBy(n).addBy(a).addBy(r),f=s.clone().addBy(l).addBy(a).addBy(r),p=s.clone().addBy(l).addBy(u).addBy(r),v=o.clone().addBy(l).addBy(u).addBy(r),g=o.clone().addBy(l).addBy(a).addBy(r),b=[h,c,d,m,f,p,v,g];return b}function h(t){if(t.obb){let e=void 0!==t.obbFrameScale?t.obbFrameScale:1;t.vertices8=u(t.obb,e)}if(t.vertices8)return void(t.linePositions=l(t.vertices8));let e=new n.default,i=new n.default,r=!0;if(void 0!==t.bounds){const s=t.bounds;e.setVector3(s.min),i.setVector3(s.max),r=!1}void 0!==t.minPos&&(e.setVector3(t.minPos),r=!1),void 0!==t.maxPos&&(i.setVector3(t.maxPos),r=!1),r&&(e.setXYZ(-50,-50,-50),i.setXYZ(50,50,50));let s=[new n.default(e.x,e.y,e.z),new n.default(e.x,e.y,i.z),new n.default(e.x,e.y,e.z),new n.default(i.x,e.y,e.z),new n.default(e.x,e.y,i.z),new n.default(i.x,e.y,i.z),new n.default(i.x,e.y,e.z),new n.default(i.x,e.y,i.z),new n.default(e.x,e.y,e.z),new n.default(e.x,i.y,e.z),new n.default(e.x,e.y,i.z),new n.default(e.x,i.y,i.z),new n.default(i.x,e.y,e.z),new n.default(i.x,i.y,e.z),new n.default(i.x,e.y,i.z),new n.default(i.x,i.y,i.z),new n.default(e.x,i.y,e.z),new n.default(e.x,i.y,i.z),new n.default(e.x,i.y,e.z),new n.default(i.x,i.y,e.z),new n.default(e.x,i.y,i.z),new n.default(i.x,i.y,i.z),new n.default(i.x,i.y,e.z),new n.default(i.x,i.y,i.z)];t.linePositions=s}function c(t){let e=new s.default,i=t.linePositions.length;t.lineColors=new Array(i);let r=t.frameColors,n=Math.min(Math.floor(i/2),r.length);for(let s=0;s<n;++s){const i=2*s;r[s]?(t.lineColors[i]=r[s],t.lineColors[i+1]=r[s]):(t.lineColors[i]=e,t.lineColors[i+1]=e)}for(let s=2*n;s<i;++s)t.lineColors[s]=e}class d extends a.Line3DEntity{constructor(t){t||(t={}),t.dashedData=!0,t.linePositions||h(t),!t.lineColors&&t.frameColors&&c(t),super(t),t.frameColor&&(this.color=t.frameColor)}}e.BoundsFrameEntity=d},"1eee":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("551f"),n=i("943f"),a=i("7650"),o=r(i("2c77")),l=r(i("d9d5")),u=r(i("0d53")),h=r(i("4ccd")),c=i("746a"),d=r(i("cc97"));class m extends s.Entity3D{constructor(t){super(t),this.mColor=new o.default,this.mArms=new d.default,t||(t={}),!1!==t.building&&(this.createGeometry(t),this.createMaterial(t)),this.mDescParam=t}clone(t){t?t.geometry||(t.geometry=this.geometry):(t=this.mDescParam,t.materials=this.materials,t.geometry=this.geometry);let e=new m(t);return e.arm=this.arm,e.color=this.color,e}setColor(t){return this.setAlbedo(t)}set color(t){this.setColor(t)}get color(){return this.mColor}setAlbedo(t){return this.albedoV&&t&&(this.mColor.setColor(t).toArray4(this.albedoV.data),this.albedoV.version++),this}set albedo(t){this.setAlbedo(t)}get albedo(){return this.mColor}setARM(t){return this.arm=t,this}set arm(t){const e=this.mArms;e.setArms(t),this.armV&&(e.toArray3(this.armV.data),this.armV.version++)}get arm(){return this.mArms}getGeometryData(t){return null}createGeometry(t){if(t&&t.geometry)this.geometry=t.geometry;else{const e=this.getGeometryData(t);if(e){const t=(new c.WGGeometry).addAttribute({position:e.getVS()}).addAttribute({uv:e.getUVS()}).addAttribute({normal:e.getNVS()}).setIndices(e.getIVS());t.bounds=e.bounds,t.drawMode=e.drawMode,t.geometryData=e,this.geometry=t}}}createMaterial(t){if(t||(t={}),t.materials)this.materials=t.materials;else{const e=t.textures,i=e?e.length:0;t.uniformValues||(this.albedoV=s.getUniformValueFromParam("albedo",t,new a.WGRUniformValue({data:new Float32Array([.5,.5,.5,1]),shdVarName:"albedo"})),this.armV=s.getUniformValueFromParam("arm",t,new a.WGRUniformValue({data:new Float32Array([1,.1,.1,1]),shdVarName:"arm"})));let r=t.shaderSrc?t.shaderSrc:{vertShaderSrc:{code:l.default,uuid:"primitiveVertShdCode"},fragShaderSrc:{code:i>0?h.default:u.default,uuid:i>0?"primitiveTexFragShdCode":"primitiveFragShdCode"}},o=t.depthWriteEnabled;o=!1!==o;let c=t.faceCullMode;c=c||"back";let d=t.blendModes;d=d||["solid"];let m={depthWriteEnabled:o,faceCullMode:c,blendModes:d};const f=new n.WGMaterial({shadinguuid:void 0!==t.shadinguuid?t.shadinguuid:"PrimitiveEntity-material-tex"+i,shaderSrc:r,pipelineDefParam:m});f.addTextures(e),void 0!==t.instanceCount&&(f.instanceCount=t.instanceCount),f.uniformValues=t.uniformValues,f.uniformValues||(f.uniformValues=[this.albedoV,this.armV],this.albedoV=f.uniformValues[0],this.armV=f.uniformValues[1]),this.materials=[f]}const e=this.materials;if(void 0!==t.doubleFace){let i=!0===t.doubleFace;for(let t=0;t<e.length;++t)void 0===e[t].doubleFace&&i&&(e[t].doubleFace=i,e[t].shadinguuid+="-dface")}if(void 0!==t.wireframe){let i=!0===t.wireframe;for(let t=0;t<e.length;++t)void 0===e[t].wireframe&&i&&(e[t].wireframe=i,e[t].shadinguuid+="-wframe")}t.albedo&&(this.albedo=t.albedo),t.arm&&(this.arm=t.arm),n.checkMaterialRPasses(this.materials,t.rpasses)}destroy(){this.albedoV=null,this.armV=null,super.destroy()}}e.PrimitiveEntity=m},"20e0":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=i("4ad2"),a=i("213f"),o=i("648f"),l=r(i("af80")),u=r(i("2c77"));class h{constructor(){this.mRscene=new n.RendererScene,this.mouseDown=t=>{}}initialize(){this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(s.default.MOUSE_DOWN,this.mouseDown),(new a.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}initScene(){const t=this.mRscene;let e=[new l.default,new l.default(-100),new l.default(-150,-180),new l.default(-150,-180,-100)],i=new o.Line3DEntity({linePositions:e});i.setColor([1,0,0]),t.addEntity(i),e=[new l.default,new l.default(100),new l.default(150,180),new l.default(150,180,100)];let r=[new u.default(1),new u.default(0,1),new u.default(0,0,1),new u.default(1,0,1)],s=new o.Line3DEntity({linePositions:e,lineColors:r});t.addEntity(s)}run(){this.mRscene.run()}}e.LineEntityTest=h},"213f":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("949a")),n=r(i("9b05")),a=r(i("b1fa"));class o{constructor(){this.m_rscene=null,this.m_autoRun=!1,this.m_axisType=0,this.drager=new s.default,this.zoomer=new n.default,this.zoomMinDistance=30,this.cameraCtrlEnabled=!0}initialize(t,e=0,i=!0,r=!1){if(null==this.m_rscene){this.m_rscene=t,t.enableMouseEvent(!0);const r=this.drager,s=this.zoomer;r.buttonType=e,r.bgEventEnabled=i,r.initialize(t.getStage3D(),t.getCamera()),s.bindCamera(t.getCamera()),s.initialize(t.getStage3D()),s.setLookAtCtrlEnabled(!1)}return this.setAutoRunning(r),this}enableSwing(){this.drager.enableSwing()}isEnabledSwing(){return this.isEnabledSwing()}enableSlide(){this.drager.enableSlide()}setSyncLookAtEnabled(t){return this.zoomer.syncLookAt=t,this}setLookAtPosition(t){return this.zoomer.setLookAtPosition(t),this}setAutoRunning(t,e=0){this.m_axisType=e,this.m_autoRun=t;const i=a.default.ENTER_FRAME;return t?(this.setSyncLookAtEnabled(!0),this.m_rscene.addEventListener(i,this.autoRun.bind(this))):this.m_rscene.removeEventListener(i,this.autoRun.bind(this)),this}autoRun(t){if(this.cameraCtrlEnabled)switch(this.zoomer.setLookAtPosition(null),this.zoomer.run(this.zoomMinDistance),this.m_axisType){case 0:this.drager.runWithYAxis();break;case 1:this.drager.runWithZAxis();break;default:this.drager.runWithYAxis();break}}run(){this.cameraCtrlEnabled&&!this.m_autoRun&&(this.zoomer.run(this.zoomMinDistance),this.drager.runWithYAxis())}destroy(){null!=this.m_rscene&&(this.setAutoRunning(!1),this.m_rscene=null)}}e.MouseInteraction=o},"222c":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("626c"));class n{constructor(){this.flag=0,this.rf=0,this.__$rever=0}set __$rendering(t){this.rf=t?s.default.addBit(this.rf,s.default.ONE_0):s.default.removeBit(this.rf,s.default.ONE_0)}get __$rendering(){return s.default.containsBit(this.rf,s.default.ONE_0)}set __$inRenderer(t){this.rf=t?s.default.addBit(this.rf,s.default.ONE_1):s.default.removeBit(this.rf,s.default.ONE_1)}get __$inRenderer(){return s.default.containsBit(this.rf,s.default.ONE_1)}isDrawable(){return this.flag<1}set renderable(t){this.flag=t?s.default.removeBit(this.flag,s.default.ONE_2):s.default.addBit(this.flag,s.default.ONE_2)}get renderable(){return!s.default.containsBit(this.flag,s.default.ONE_2)}set camVisible(t){this.flag=t?s.default.removeBit(this.flag,s.default.ONE_1):s.default.addBit(this.flag,s.default.ONE_1)}get camVisible(){return!s.default.containsBit(this.flag,s.default.ONE_1)}set visible(t){this.flag=t?s.default.removeBit(this.flag,s.default.ONE_0):s.default.addBit(this.flag,s.default.ONE_0)}get visible(){return!s.default.containsBit(this.flag,s.default.ONE_0)}}e.WGRUnitState=n},2258:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{get rcommands(){if(this.node)return this.node.rcommands}get colorAttachments(){if(this.node)return this.node.colorAttachments}addEntity(t){return this.node&&this.node.addEntity(t),this}setColorAttachmentClearEnabledAt(t,e=0){return this.node&&this.node.setColorAttachmentClearEnabledAt(t,e),this}render(){if(this.node){this.node.render();const t=this.cmdWrapper;t&&(t.rcommands=t.rcommands.concat(this.node.rcommands))}}}e.WGRPassWrapper=r},"245e":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=i("4ad2"),a=i("213f"),o=r(i("2c77")),l=i("9849"),u=i("5009"),h=i("76e3"),c=i("0069"),d=i("5118"),m=i("7e70"),f=i("97f2"),p=i("603e");class v{constructor(){this.mRscene=new n.RendererScene,this.mouseDown=t=>{}}initialize(){this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(s.default.MOUSE_DOWN,this.mouseDown),(new a.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}initScene(){const t=this.mRscene;let e=new p.AxisEntity;t.addEntity(e);let i=[new l.SphereEntity,new u.BoxEntity,new h.CylinderEntity({alignYRatio:0}),new c.CubeEntity({cubeSize:130}),new d.TorusEntity({radius:110,axisType:1}),new m.PlaneEntity({axisType:1,extent:[-80,-80,160,160],doubleFace:!0}),new f.ConeEntity({alignYRatio:0})],r=i;i=[];for(let n=0,a=r.length;n<a;++n){const t=Math.round(888*Math.random())%r.length;r[t];i.push(r[t]),r.splice(t,1)}let s=350;for(let n=0;n<i.length;++n){let e=2*Math.PI*n/i.length,r=i[n].setAlbedo((new o.default).randomRGB(1.5,.1)).setARM([1.1,.95*Math.random()+.05,.9*Math.random()+.1]);r.transform.setPosition([s*Math.cos(e),0,s*Math.sin(e)]),t.addEntity(r)}}run(){this.mRscene.run()}}e.PrimitiveEntityTest=v},"24fe":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("af80"));function n(t,e){let i=t;i||(i={});let r=i.eye?(new s.default).toZero().setVector3(i.eye):new s.default(1100,1100,1100),n=i.up?(new s.default).toZero().setVector3(i.up):new s.default(0,1,0),a=i.origin?(new s.default).toZero().setVector3(i.origin):new s.default;void 0===i.fovDegree&&(i.fovDegree=45),void 0===i.near&&(i.near=.1),void 0===i.far&&(i.far=8e3),void 0===i.viewWidth&&(i.viewWidth=512),void 0===i.viewHeight&&(i.viewHeight=512),void 0===i.viewX&&(i.viewX=0),void 0===i.viewY&&(i.viewY=0),i.perspective=!1!==i.perspective&&0!==Number(i.perspective);const o=i.viewWidth,l=i.viewHeight;return i.perspective?e.perspectiveRH(Math.PI*i.fovDegree/180,o/l,i.near,i.far):(e.inversePerspectiveZ=!0,e.orthoRH(i.near,i.far,-.5*l,.5*l,-.5*o,.5*o)),e.lookAtRH(r,a,n),e.setViewXY(i.viewX,i.viewY),e.setViewSize(o,l),e.update(),e}e.initializeCamera=n},"25ba":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(3) var<uniform> param: vec4f;\r\n@group(0) @binding(4) var mySampler0: sampler;\r\n@group(0) @binding(5) var myTexture0: texture_2d<f32>;\r\n@group(0) @binding(6) var mySampler1: sampler;\r\n@group(0) @binding(7) var myTexture1: texture_2d<f32>;\r\n\r\n@fragment\r\nfn main(\r\n    @location(0) fragUV: vec2<f32>,\r\n    @location(1) fragPosition: vec4<f32>\r\n) -> @location(0) vec4<f32> {\r\n\r\n    var color0: vec4<f32>;\r\n    var color1: vec4<f32>;\r\n    color0 = textureSample(myTexture0, mySampler0, fragUV) * fragPosition;\r\n    color1 = textureSample(myTexture1, mySampler1, fragUV) * fragPosition;\r\n    return color0 * (vec4<f32>(1.0) - param) + color1 * param;\r\n}\r\n"},"27e9":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("f3f6")),a=r(i("0bc4")),o=i("943f"),l=i("746a"),u=i("551f"),h=r(i("af80")),c=r(i("c69e")),d=i("4ad2"),m=i("213f"),f=i("a3fd"),p=r(i("2c77"));class v{constructor(){this.mRscene=new d.RendererScene,this.geomData=new s.GeomDataBuilder,this.mouseDown=t=>{},this.mContainers=[],this.mRotValue=0}initialize(){this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(c.default.MOUSE_DOWN,this.mouseDown),(new m.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}createMaterial(t,e,i,r=["solid"],s="back"){i=i||new p.default;let n={depthWriteEnabled:!0,faceCullMode:s,blendModes:[]};n.blendModes=r;const a=e?e.length:0,l=new o.WGMaterial({shadinguuid:"base-material-tex"+a,shaderSrc:t,pipelineDefParam:n});let u={storage:{data:new Float32Array([i.r,i.g,i.b,1])}};return l.uniformValues=[u],l.addTextures(e),l}createGeom(t,e=!1){const i=(new l.WGGeometry).addAttribute({position:t.vs}).addAttribute({uv:t.uvs}).setIndices(t.ivs);return e&&i.addAttribute({normal:t.nvs}),i}createCircle(t,e,i,r,s,n){this.mRscene;n=n||new h.default;let a=new f.Entity3DContainer;a.setPosition(n);for(let o=0;o<e;++o){const n=o/e,l=2*Math.PI*n,h=t*Math.cos(l),c=t*Math.sin(l);let d=new u.Entity3D;d.materials=r,d.geometry=s,d.transform.setXYZ(h,c,0),d.transform.setRotationZ(360*n),d.transform.setScaleAll(i),a.addChild(d)}return a}initScene(){const t=this.mRscene,e=this.createGeom(this.geomData.createCube(80)),i={vertShaderSrc:{code:n.default,uuid:"vertShdCode"},fragShaderSrc:{code:a.default,uuid:"fragShdCode"}},r={diffuse:{url:"static/assets/box.jpg"}};let s=[this.createMaterial(i,[r],new p.default(1,0,0))],o=[this.createMaterial(i,[r],new p.default(0,1,0))],l=[this.createMaterial(i,[r],new p.default(1,0,1))];const u=this.createCircle(100,10,.5,s,e),h=this.createCircle(180,15,.5,o,e),c=this.createCircle(260,25,.5,l,e);let d=new f.Entity3DContainer;d.addChild(u),d.addChild(h),d.addChild(c),t.addEntity(d),this.mContainers.push(u,h,c,d)}run(){this.mRotValue+=.5;const t=this.mContainers;t[0].setRotationZ(1.2*this.mRotValue),t[1].setRotationZ(.4*this.mRotValue+15),t[2].setRotationZ(.2*this.mRotValue+30),t[3].setRotationY(.2*this.mRotValue),t[3].update(),this.mRscene.run()}}e.REntity3DContainerTest=v},"2b0e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("b3f5"),s=i("fe0b"),n=i("37f2");class a{constructor(t){this.mipmapGenerator=new r.GPUMipmapGenerator,t&&this.initialize(t)}initialize(t){!this.mWGCtx&&t&&(this.mWGCtx=t,this.mipmapGenerator.initialize(t.device))}createFloatRTTTexture(t){return t||(t={}),t.format||(t.format="rgba16float"),this.createRTTTexture(t)}createColorRTTTexture(t){return t||(t={}),t.format||(t.format="bgra8unorm"),this.createRTTTexture(t)}createDepthRTTTexture(t){return t||(t={}),t.format||(t.format="depth24plus"),this.createRTTTexture(t)}createRTTTexture(t){t||(t={});const e=this.mWGCtx;return void 0===t.size&&(t.size=[e.canvasWidth,e.canvasHeight]),t.format||(t.format=e.presentationFormat),void 0===t.usage&&(t.usage=GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING),this.createTexture(t)}async createTex2DByUrl(t,e=!0,i=!1,r="rgba8unorm"){const s=await fetch(t);let n;try{n=await createImageBitmap(await s.blob())}catch(o){return null}const a=this.createTex2DByImage(n,e,i,r,t);return a.url=t,a}createTexture(t){const e=this.mWGCtx.device;let i=e.createTexture(t);return i.uid=a.sUid++,i}checkTexDesc(t,e){return void 0===t.usage&&(t.usage=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST),t.mipLevelCount<1&&(t.mipLevelCount=1),e=e&&t.mipLevelCount>1,e&&(t.usage=t.usage|GPUTextureUsage.RENDER_ATTACHMENT),e}createTex2DByImage(t,e=!0,i=!1,s="rgba8unorm",n){const a=this.mWGCtx.device,o=this.mipmapGenerator;let l=e?r.calculateMipLevels(t.width,t.height):1;const u={dimension:"2d",size:{width:t.width,height:t.height,depthOrArrayLayers:1},format:s,mipLevelCount:l};e=this.checkTexDesc(u,e);let h=this.createTexture(u);return a.queue.copyExternalImageToTexture({source:t,flipY:i},{texture:h},[t.width,t.height]),e&&(h=o.generateMipmap(h,u)),h}async createTexCubeByUrls(t,e=!0,i=!1,r="rgba8unorm"){const s=t.map(async t=>{const e=await fetch(t);return createImageBitmap(await e.blob())}),n=await Promise.all(s),a=this.createTexCubeByImages(n,e,i,"rgba8unorm");return a.url=t[0],a}createTexCubeByImages(t,e=!0,i=!1,s="rgba8unorm",n){let a=t[0];const o=this.mWGCtx.queue;let l=e?r.calculateMipLevels(a.width,a.height):1;const u={dimension:"2d",size:{width:a.width,height:a.height,depthOrArrayLayers:6},format:s,mipLevelCount:l};e=this.checkTexDesc(u,e);let h=this.createTexture(u);for(let r=0;r<t.length;++r)a=t[r],o.copyExternalImageToTexture({source:a,flipY:i},{texture:h,origin:[0,0,r]},[a.width,a.height]);return e&&(h=this.mipmapGenerator.generateMipmap(h,u)),h}createDataTexture(t,e,i,r,s=!1){switch(r||(r={}),r.format||(r.format="rgba8unorm"),r.format){case"rgba16float":return this.create64BitsTexture(t,e,i,r,s);case"bgra8unorm":case"rgba8unorm":case"rgb9e5ufloat":return this.create32BitsTexture(t,e,i,r,s);default:break}throw Error("Illegal operation !!!")}create32BitsTexture(t,e,i,s,a=!1){a=!0===a,s||(s={}),s.format||(s.format="rgba8unorm");let o,l=this.mWGCtx,u=new Array(t.length);switch(s||(s={}),s.usage||(s.usage=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST),s.size||(s.size=[e,i]),s.format){case"rgb9e5ufloat":a=!1;for(let e=0;e<t.length;++e){let i=t[e],r=i.length/3,s=0,a=new Int32Array(r);for(let t=0;t<r;++t)a[t]=n.packRGB9E5UFloat(i[s],i[s+1],i[s+2]),s+=3;u[e]=a}break;default:for(let e=0;e<t.length;++e){let i=t[e];void 0!==i.byteLength&&1==i.BYTES_PER_ELEMENT||(i=new Uint8Array(t[e])),u[e]=i}break}if(s.mipLevelCount=a||u.length>1?r.calculateMipLevels(e,i):1,a=this.checkTexDesc(s,a),"cube"===s.viewDimension){s.size={width:e,height:i,depthOrArrayLayers:6},o=l.device.createTexture(s);let t=0;for(let r=0;r<s.mipLevelCount;r++){let s=4*e,n=i;for(let a=0;a<6;a++)l.device.queue.writeTexture({texture:o,mipLevel:r,origin:[0,0,a]},u[t++],{bytesPerRow:s,rowsPerImage:n},{width:e,height:i});e>>=1,i>>=1}}else{let t=i;o=l.device.createTexture(s);for(let r=0;r<u.length;++r){let s=4*e;l.device.queue.writeTexture({texture:o,mipLevel:r,origin:[0,0]},u[r],{bytesPerRow:s,rowsPerImage:t},{width:e,height:i}),e>>=1,i>>=1}}return a&&(o=this.mipmapGenerator.generateMipmap(o,s)),o}create64BitsTexture(t,e,i,n,a=!1){a=!0===a,n.format||(n.format="rgba16float");let o,l=this.mWGCtx,u=new Array(t.length);switch(n.format){case"rgba16float":for(let e=0;e<t.length;e++){let i=t[e],r=new Uint16Array(i.length);for(let t=0;t<i.length;++t)r[t]=s.toFloat16(i[t]);u[e]=r}break;default:break}if(n||(n={}),n.size||(n.size=[e,i]),n.mipLevelCount=a?r.calculateMipLevels(e,i):1,a=this.checkTexDesc(n,a),"cube"===n.viewDimension){n.size={width:e,height:i,depthOrArrayLayers:6},o=l.device.createTexture(n);let t=0;for(let r=0;r<n.mipLevelCount;r++){let s=8*e,n=i;for(let a=0;a<6;a++)l.device.queue.writeTexture({texture:o,mipLevel:r,origin:[0,0,a]},u[t++],{bytesPerRow:s,rowsPerImage:n},{width:e,height:i});e>>=1,i>>=1}}else{o=l.device.createTexture(n);for(let t=0;t<u.length;t++){let r=8*e;l.device.queue.writeTexture({texture:o,mipLevel:t},u[t],{bytesPerRow:r,rowsPerImage:i},{width:e,height:i}),e>>=1,i>>=1}}return a&&(o=this.mipmapGenerator.generateMipmap(o,n)),o}}a.sUid=0,e.WebGPUTextureContext=a},"2b4f":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=i("4ad2"),a=i("213f"),o=i("d463"),l=i("2fc9"),u=r(i("d36d")),h=r(i("afaf")),c=r(i("4ca8")),d=r(i("1a9d")),m=r(i("0f15")),f=i("943f"),p=i("fa6e"),v=i("551f"),g=i("746a"),b=i("6cb1"),y=i("0c34");class _{constructor(){this.mRscene=new n.RendererScene,this.geomData=new p.GeomDataBuilder,this.mouseDown=t=>{}}initialize(){let t=()=>{this.initBrnTexEnvMap(),this.initEvent()};this.mRscene.initialize({callback:t})}initBrnTexEnvMap(){let t={vert:{code:c.default,uuid:"vert"},frag:{code:m.default,uuid:"brnCubeFrag"}},e="static/bytes/spb.bin",i=(new y.SpecularEnvBrnTexture).load(e);const r=this.createMaterial(t,i);this.createCubeMapEntity([r])}initEvent(){const t=this.mRscene;t.addEventListener(s.default.MOUSE_DOWN,this.mouseDown),(new a.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}initAssets(){let t=!0,e="static/bytes/spb.bin";(new l.HttpFileLoader).load(e,(e,i)=>{this.buildFloatTex(t,e),this.initializeImgCubeMap()})}buildFloatTex(t,e){this.parseMultiHdrBrn(e)}parseMultiHdrBrn(t){let e,i=new Uint16Array(t),r=new Uint8Array(t),s=0,n=i[4],a=i[5],l=i[6],c=0,d=r.subarray(32),m=[],f=0,p=n,v=a;for(let o=0;o<l;o++){for(let t=0;t<6;t++)c=p*p*4,t==f&&(e=d.subarray(s,s+c),m.push(e)),s+=c;p>>=1,v>>=1}let g=this.mRscene,y=(g.getWGCtx().texture,new b.SpecularBrnTexture(m,n,a)),_={vert:{code:u.default,uuid:"vert"},frag:{code:h.default,uuid:"br4BytesFrag"}},x=new o.FixScreenPlaneEntity({shadinguuid:"texMultiBrnM",shaderSrc:_,extent:[0,0,.8,.8],textures:[y]});x.color=[1,1,1,4],g.addEntity(x)}parseCubeHdrBrn(t){let e,i=new Uint16Array(t),r=new Uint8Array(t),s=0,n=i[4],a=i[5],o=i[6],l=0,u=r.subarray(32),h=[],d=n,f=a;for(let c=0;c<o;c++){for(let t=0;t<6;t++)l=d*d*4,e=u.subarray(s,s+l),h.push(e),s+=l;d>>=1,f>>=1}let p=this.mRscene,v=(p.getWGCtx().texture,{diffuse:{uuid:"cubeTexBrn",dataTexture:{datas:h,width:n,height:a},viewDimension:"cube",format:"rgba8unorm",generateMipmaps:!1}}),g={vert:{code:c.default,uuid:"vert"},frag:{code:m.default,uuid:"brnCubeFrag"}};const b=this.createMaterial(g,v);this.createCubeMapEntity([b])}initializeImgCubeMap(){c.default,d.default}createMaterial(t,e){const i=1,r=new f.WGMaterial({shadinguuid:"cube-base-material-tex"+i,shaderSrc:t}).addTextures([e]);return r}createCubeMapEntity(t){let e=this.mRscene;const i=this.geomData.createCube(200),r=(new g.WGGeometry).addAttribute({position:i.vs}).setIndices(i.ivs),s=new v.Entity3D({materials:t,geometry:r});return e.addEntity(s),s}applyRGBA8Tex(){let t=this.mRscene,e=256,i=256,r=4,s=new Uint8Array(e*i*r),n=0;for(let o=0;o<i;++o)for(let t=0;t<e;++t)n=4*(e*o+t),s[n]=t/e*255|0,s[n+1]=255*(.5+.5*Math.sin(10*(1-t/e)))|0,s[n+2]=255*(1-o*t/(e*i))|0,s[n+3]=255;let a={diffuse:{uuid:"texRGBA8Tex",dataTexture:{data:s,width:e,height:i},format:"rgba8unorm",generateMipmaps:!1}},l=new o.FixScreenPlaneEntity({shadinguuid:"texRGBA8",extent:[-.3,-.3,.8,.8],textures:[a]});t.addEntity(l)}initScene(){}run(){this.mRscene.run()}}e.Set32BitsTexMipmapData=_},"2c77":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=1e-5;function s(t,e,i){return(1-i)*t+i*e}function n(t,e){return(t%e+e)%e}function a(t,e,i){return Math.max(Math.min(t,i),e)}function o(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function l(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function u(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}function h(t){let e=Math.floor(255*t);return e>0?e<15?"0"+e.toString(16):""+e.toString(16):"00"}class c{constructor(t=1,e=1,i=1,r=1){this.h=0,this.s=0,this.l=0,this.v=0,this.c=0,this.m=0,this.y=0,this.k=0,this.r=t,this.g=e,this.b=i,this.a=r}clone(){return new c(this.r,this.g,this.b,this.a)}setColor(t){let e=t;if(e){const t=this,i=e;if(void 0!==i.length){const e=i.length;e>0&&(t.r=i[0]),e>1&&(t.g=i[1]),e>2&&(t.b=i[2]),e>3&&(t.a=i[3])}else{const i=e;void 0!==i.r&&(t.r=i.r),void 0!==i.g&&(t.g=i.g),void 0!==i.b&&(t.b=i.b),void 0!==i.a&&(t.a=i.a)}}return this}toBlack(t=0){return this.r=this.g=this.b=t,this}toWhite(t=1){return this.r=this.g=this.b=t,this}gammaCorrect(){const t=1/2.2;return this.r=Math.pow(this.r,t),this.g=Math.pow(this.g,t),this.b=Math.pow(this.b,t),this}fromArray4(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this.a=t[e+3],this}toArray4(t,e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t[e+3]=this.a,this}getArray4(){let t=new Array(4);return this.toArray4(t),t}getArray3(){let t=new Array(3);return this.toArray3(t),t}fromArray3(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray3(t,e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,this}fromBytesArray3(t,e=0){return this.setRGB3Bytes(t[e],t[e+1],t[e+2]),this}toBytesArray3(t,e=0){return t[e]=Math.round(255*this.r),t[e+1]=Math.round(255*this.g),t[e+2]=Math.round(255*this.b),this}setRGB3f(t,e,i){return this.r=t,this.g=e,this.b=i,this}setRGB3Bytes(t,e,i){const r=1/255;return this.r=t*r,this.g=e*r,this.b=i*r,this}setRGBUint24(t){const e=255;return this.r=(t>>16&e)/255,this.g=(t>>8&e)/255,this.b=(t&e)/255,this}getRGBUint24(){return(Math.round(255*this.r)<<16)+(Math.round(255*this.g)<<8)+Math.round(255*this.b)}clamp(){return this.r>1?this.r=1:this.r<0&&(this.r=0),this.g>1?this.g=1:this.g<0&&(this.g=0),this.b>1?this.b=1:this.b<0&&(this.b=0),this}ceil(){let t=Math.max(Math.max(this.r,this.g),this.b);return t=1/(t+1e-6),t<1&&(t=1),this.scaleBy(t)}setARGBUint32(t){const e=255;return this.r=(t>>16&e)/255,this.g=(t>>8&e)/255,this.b=(t&e)/255,this.a=(t>>24&e)/255,this}getARGBUint32(){return(Math.round(255*this.a)<<24)+(Math.round(255*this.r)<<16)+(Math.round(255*this.g)<<8)+Math.round(255*this.b)}setRGBA4f(t,e,i,r){return this.r=t,this.g=e,this.b=i,this.a=r,this}setAlpha(t){return this.a=t,this}setContrast(t){const e=259*(t+255)/(255*(259-t)),i=255*this.r,r=255*this.g,s=255*this.b;return this.r=a(e*(i-128)+128,0,255)/255,this.g=a(e*(r-128)+128,0,255)/255,this.b=a(e*(s-128)+128,0,255)/255,this}toGray(){return this.r*=.2126,this.g*=.7152,this.b*=.0722,this}setHSL(t,e,i){if(t=n(t,1),e=a(e,0,1),i=a(i,0,1),0===e)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+e):i+e-i*e,s=2*i-r;this.r=o(s,r,t+1/3),this.g=o(s,r,t),this.b=o(s,r,t-1/3)}return this}getHSL(t=null){t||(t=new c);const e=this.r,i=this.g,r=this.b,s=Math.max(e,i,r),n=Math.min(e,i,r);let a,o;const l=(n+s)/2;if(n===s)a=0,o=0;else{const t=s-n;switch(o=l<=.5?t/(s+n):t/(2-s-n),s){case e:a=(i-r)/t+(i<r?6:0);break;case i:a=(r-e)/t+2;break;case r:a=(e-i)/t+4;break}a/=6}return t.h=a,t.s=o,t.l=l,t}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){const i=c.sC0,r=c.aC1;this.getHSL(i),t.getHSL(r);const n=s(i.h,r.h,e),a=s(i.s,r.s,e),o=s(i.l,r.l,e);return this.setHSL(n,a,o),this}copyFrom(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}copyFromRGB(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}scaleBy(t){return this.r*=t,this.g*=t,this.b*=t,this}inverseRGB(){return this.r=1-this.r,this.g=1-this.g,this.b=1-this.b,this}randomRGB(t=1,e=0){return this.r=Math.random()*t+e,this.g=Math.random()*t+e,this.b=Math.random()*t+e,this}rotate(){return this.setColor([this.g,this.b,this.r])}normalizeRandom(t=1,e=0){this.r=Math.random(),this.g=Math.random(),this.b=Math.random();let i=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);return i>r&&(this.r=t*this.r/i,this.g=t*this.g/i,this.b=t*this.b/i),this.r+=e,this.g+=e,this.b+=e,this}normalize(t){void 0==t&&(t=1);let e=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);return e>r&&(this.r=t*this.r/e,this.g=t*this.g/e,this.b=t*this.b/e),this}rgbSizeTo(t){let e=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);return e=t/e,this.r*=e,this.g*=e,this.b*=e,this}copySRGBToLinear(t){return this.r=l(t.r),this.g=l(t.g),this.b=l(t.b),this}copyLinearToSRGB(t){return this.r=u(t.r),this.g=u(t.g),this.b=u(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this)}convertLinearToSRGB(){return this.copyLinearToSRGB(this)}getCSSDecRGBAColor(){let t=Math.floor(255*this.r),e=Math.floor(255*this.g),i=Math.floor(255*this.b),r=this.a;return"rgba("+t+","+e+","+i+","+r+")"}getCSSHeXRGBColor(t="#"){let e=t;return e+=h(this.r),e+=h(this.g),e+=h(this.b),e}}c.sC0=new c,c.aC1=new c,e.default=c},"2c8d":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> param: vec4f;\r\n@group(0) @binding(1) var sampler0: sampler;\r\n@group(0) @binding(2) var texture0: texture_2d<f32>;\r\n\r\nfn reinhard(v: vec3<f32>) -> vec3<f32> {\r\n    return v / (vec3<f32>(1.0) + v);\r\n}\r\nfn calcColor(uv: vec2f) -> vec4f {\r\n\r\n    var result = textureSample(texture0, sampler0, uv) * param;\r\n\tresult = vec4f(result.xyz, 1.0);\r\n\r\n    return result;\r\n}\r\n\r\n@fragment\r\nfn main(\r\n\t@location(0) uv: vec2f\r\n\t) -> @location(0) vec4f {\r\n\tvar color4 = calcColor( uv );\r\n    return color4;\r\n}\r\n"},"2d03":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("4ad2"),n=i("d463"),a=r(i("d36d")),o=r(i("74d8")),l=r(i("cb24")),u={diffuse:{uuid:"rtt0",rttTexture:{},format:"rgba16float"}};class h{constructor(){this.mRscene=new s.RendererScene}initialize(){let t=!0,e=!1,i={multisampleEnabled:t,depthTestEnabled:e};this.mRscene.initialize({rpassparam:i}),this.initScene()}applyRTTPass(t){let e=this.mRscene,i={vert:{code:a.default,uuid:"vert"},frag:{code:o.default,uuid:"calcFrag"}};const r={texture:u,clearValue:[.1,.1,.1,1]},s=[r];let h=e.createRenderPass({separate:!0,colorAttachments:s});const c={diffuse:{url:"static/assets/huluwa.jpg",flipY:!0}};let d=new n.FixScreenPlaneEntity({extent:[-1,-1,2,2],textures:[c],shaderSrc:i,shadinguuid:"floatRTT"});h.addEntity(d),i={vert:{code:a.default,uuid:"vert"},frag:{code:l.default,uuid:"readFrag"}},t=[-.8,-.8,1.6,1.6];let m=new n.FixScreenPlaneEntity({extent:t,flipY:!0,textures:[u],shaderSrc:i,shadinguuid:"calcColor"});e.addEntity(m),t=[-.95,-.95,.6,.6],m=new n.FixScreenPlaneEntity({extent:t,flipY:!1,textures:[c]}),e.addEntity(m)}initScene(){this.applyRTTPass([-1,-1,2,2])}run(){this.mRscene.run()}}e.FloatRTT=h},"2d6d":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("626c")),n=i("dfa8"),a=i("b512");e.WGRBufferData=a.WGRBufferData,e.WGRBufferValueParam=a.WGRBufferValueParam;const o=i("dc4d");class l extends n.WGRBufferView{constructor(t){super(),a.applyParamToBufferData(this,t),this.upate()}toShared(){return this.shared=!0,this}toVisibleAll(){return this.visibility.toVisibleAll(),this}toVisibleVertComp(){return this.visibility.toVisibleVertComp(),this}toVisibleComp(){return this.visibility.toVisibleComp(),this}toBufferForStorage(){return this.visibility.toBufferForStorage(),this}toBufferForReadOnlyStorage(){return this.visibility.toBufferForReadOnlyStorage(),this}toUniform(){return this.usage=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,this}toStorage(){this.usage=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}toVertex(){this.usage=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}isUniform(){return s.default.containsBit(this.usage,GPUBufferUsage.UNIFORM)}isStorage(){return s.default.containsBit(this.usage,GPUBufferUsage.STORAGE)}isVertex(){return s.default.containsBit(this.usage,GPUBufferUsage.VERTEX)}upate(){this.version++}clone(t){const e=new l({data:t});return e.name=this.name,e.byteOffset=this.byteOffset,e.arrayStride=this.arrayStride,e.usage=this.usage,e}destroy(){this.data=null,this.bufData=null,this.shared=null,this.visibility=null,this.buffer&&(this.buffer=null)}}let u;function h(t,e){switch(t){case"vert":case"vertex":return e|GPUShaderStage.VERTEX;case"frag":case"fragment":return e|GPUShaderStage.FRAGMENT;case"comp":case"compute":return e|GPUShaderStage.COMPUTE;default:break}return e}function c(t,e,i){let r=void 0!==t.visibility?t.visibility:"vert_frag",s=r.split("_"),n=0;u||(u=new l({data:new Float32Array(4)}));let a=u.visibility;for(let l=0;l<s.length;++l){if("all"===s[l]){a.toVisibleAll(),n=a.visibility;break}n|=h(s[l],n)}if(s.length<1&&(a.toVisibleVertFrag(),n=a.visibility),n<1)throw"Illegal operation !!!";e.visibility=n;let o=void 0!==t.access?t.access:"";switch(i){case"uniform":e.toBufferForUniform();break;case"storage":"read_write"===o?e.toBufferForStorage():e.toBufferForReadOnlyStorage();break;default:break}}function d(t){if(!t)return t;u||(u=new l({data:new Float32Array(4)}));const e=u;let i=t,r=i.visibility,s=i.layout;if(t.storage){i=t.storage,e.toStorage(),i.usage=e.usage;let n=!i.visibility;if(n&&(i.visibility=new o.WGRBufferVisibility),r=i.visibility,s||(s=i.layout),n&&void 0!==s)c(s,r,"storage");else{let t=r.buffer;(!t||t.type.indexOf("storage")<0)&&(r.toBufferForReadOnlyStorage(),t=r.buffer)}}if(t.vertex&&(i=t.vertex,e.toVertex(),i.usage=e.usage),void 0===i.usage||t.uniform){t.uniform&&(i=t.uniform),e.toUniform(),i.usage=e.usage;let n=!i.visibility;if(n&&(i.visibility=new o.WGRBufferVisibility),r=i.visibility,s||(s=i.layout),n&&void 0!==s)c(s,r,"uniform");else{let t=r.buffer;(!t||t.type.indexOf("uniform")<1)&&(r.toBufferForUniform(),t=r.buffer)}}return void 0===i.byteOffset&&(i.byteOffset=0),void 0===i.version&&(i.version=-1),i}function m(t){let e=t instanceof l;return e||(t=d(t),t.shared=!0===t.shared,a.applyParamToBufferData(t,t),t.byteLength=t.data.byteLength),t}e.WGRBufferValue=l,e.checkBufferData=m},"2fc9":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){this.crossOrigin="anonymous"}setCrossOrigin(t){this.crossOrigin=t}loadText(t,e,i=null,r=null,s="text",n=""){return this.load(t,e,i,r,s,n)}loadJson(t,e,i=null,r=null,s="json",n=""){return this.load(t,e,i,r,s,n)}load(t,e,i=null,r=null,s="blob",n=""){if(null==e)throw Error("onload == null !!!");const a=new FileReader;a.onload=i=>{e&&e(a.result,t)};const o=new XMLHttpRequest;return o.open("GET",t,!0),""!=n&&o.setRequestHeader("Range",n),o.responseType=s,o.onload=i=>{if(o.status<=206)switch(s){case"arraybuffer":case"blob":a.readAsArrayBuffer(o.response);break;case"json":e&&e(o.response,t);break;case"text":e&&e(o.response,t);break;default:e&&e(o.response,t);break}else r&&r(o.status,t)},null!=i&&(o.onprogress=e=>{let r=0;if(e.total>0||e.lengthComputable)r=Math.min(1,e.loaded/e.total);else{let t=parseInt(o.getResponseHeader("content-length"));t>0&&(t*=4,r=Math.min(1,e.loaded/t))}i(r,t)}),null!=r&&(o.onerror=e=>{r(o.status,t)}),o.send(null),this}}e.HttpFileLoader=r},3247:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{static getDomain(t){var e=/http:\/\/([^\/]+)/i;let i=t.match(e);return null!=i&&i.length>0?i[0]:""}static getHostUrl(t,e="/"){let i=location.href,s=r.getDomain(i),n=s.split(":");return i=n[0]+":"+n[1],t?i+":"+t+"/":s+e}static isEnabled(){let t=window.location.href;return t.indexOf(".artvily.com")>0}static filterUrl(t){if(t.indexOf("blob:")<0){let e=window.location.href;e.indexOf(".artvily.")>0&&(e="http://www.artvily.com:9090/",t=e+t)}return t}static getFileName(t,e=!1,i=!1){if(t.indexOf("blob:")<0||i){let i=t.lastIndexOf("/");if(i<0)return"";let r=t.lastIndexOf(".",t.length);if(r<0)return"";if(i+2<r){let s=t.slice(i+1,r);return e?s.toLocaleLowerCase():s}}return""}static getFileNameAndSuffixName(t,e=!1,i=!1){if(t.indexOf("blob:")<0||i){let i=t.lastIndexOf("/"),r=t.lastIndexOf(".",t.length);if(r<0)return"";let s=t.slice(i+1);return e?s.toLocaleLowerCase():s}return""}static getFileSuffixName(t,e=!1,i=!1){if(t.indexOf("blob:")<0||i){let i=t.lastIndexOf(".",t.length);if(i<0)return"";let r=t.slice(i+1);return e?r.toLocaleLowerCase():r}return""}}e.default=r},"32d5":function(t,e,i){"use strict";i.r(e),e["default"]="struct VertexInput {\r\n\t@location(0) pos: vec3f,\r\n\t@builtin(instance_index) instance: u32,\r\n};\r\n\r\nstruct VertexOutput {\r\n\t@builtin(position) pos: vec4f,\r\n\t@location(0) cell: vec2f,\r\n};\r\n@group(0) @binding(0) var<uniform> grid: vec2f;\r\n@group(0) @binding(1) var<storage> cellState: array<u32>;\r\n@vertex\r\nfn vertMain(input: VertexInput) -> VertexOutput {\r\n    let i = f32(input.instance);\r\n    let cell = vec2f(i % grid.x, floor(i / grid.x));\r\n    let cellOffset = cell / grid * 2.0;\r\n\r\n    var state = f32(cellState[input.instance]);\r\n    let gridPos = (input.pos.xy * state + 1.0) / grid - 1.0 + cellOffset;\r\n\r\n    var output: VertexOutput;\r\n    output.pos = vec4f(gridPos, 0.0, 1.0);\r\n    output.cell = cell;\r\n    return output;\r\n}\r\n\r\n@fragment\r\nfn fragMain(input: VertexOutput) -> @location(0) vec4f {\r\n    let c = input.cell / grid;\r\n    return vec4f(c, 1.0 - c.x, 1.0);\r\n}"},3341:function(t,e,i){"use strict";var r;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["r8unorm"]=0]="r8unorm",t[t["r8snorm"]=1]="r8snorm",t[t["r8uint"]=2]="r8uint",t[t["r8sint"]=3]="r8sint",t[t["r16uint"]=4]="r16uint",t[t["r16sint"]=5]="r16sint",t[t["r16float"]=6]="r16float",t[t["rg8unorm"]=7]="rg8unorm",t[t["rg8snorm"]=8]="rg8snorm",t[t["rg8uint"]=9]="rg8uint",t[t["rg8sint"]=10]="rg8sint",t[t["r32uint"]=11]="r32uint",t[t["r32sint"]=12]="r32sint",t[t["r32float"]=13]="r32float",t[t["rg16uint"]=14]="rg16uint",t[t["rg16sint"]=15]="rg16sint",t[t["rg16float"]=16]="rg16float",t[t["rgba8unorm"]=17]="rgba8unorm",t[t["rgba8unorm-srgb"]=18]="rgba8unorm-srgb",t[t["rgba8snorm"]=19]="rgba8snorm",t[t["rgba8uint"]=20]="rgba8uint",t[t["rgba8sint"]=21]="rgba8sint",t[t["bgra8unorm"]=22]="bgra8unorm",t[t["bgra8unorm-srgb"]=23]="bgra8unorm-srgb",t[t["rgb9e5ufloat"]=24]="rgb9e5ufloat",t[t["rgb10a2uint"]=25]="rgb10a2uint",t[t["rgb10a2unorm"]=26]="rgb10a2unorm",t[t["rg11b10ufloat"]=27]="rg11b10ufloat",t[t["rg32uint"]=28]="rg32uint",t[t["rg32sint"]=29]="rg32sint",t[t["rg32float"]=30]="rg32float",t[t["rgba16uint"]=31]="rgba16uint",t[t["rgba16sint"]=32]="rgba16sint",t[t["rgba16float"]=33]="rgba16float",t[t["rgba32uint"]=34]="rgba32uint",t[t["rgba32sint"]=35]="rgba32sint",t[t["rgba32float"]=36]="rgba32float",t[t["stencil8"]=37]="stencil8",t[t["depth16unorm"]=38]="depth16unorm",t[t["depth24plus"]=39]="depth24plus",t[t["depth24plus-stencil8"]=40]="depth24plus-stencil8",t[t["depth32float"]=41]="depth32float",t[t["depth32float-stencil8"]=42]="depth32float-stencil8",t[t["bc1-rgba-unorm"]=43]="bc1-rgba-unorm",t[t["bc1-rgba-unorm-srgb"]=44]="bc1-rgba-unorm-srgb",t[t["bc2-rgba-unorm"]=45]="bc2-rgba-unorm",t[t["bc2-rgba-unorm-srgb"]=46]="bc2-rgba-unorm-srgb",t[t["bc3-rgba-unorm"]=47]="bc3-rgba-unorm",t[t["bc3-rgba-unorm-srgb"]=48]="bc3-rgba-unorm-srgb",t[t["bc4-r-unorm"]=49]="bc4-r-unorm",t[t["bc4-r-snorm"]=50]="bc4-r-snorm",t[t["bc5-rg-unorm"]=51]="bc5-rg-unorm",t[t["bc5-rg-snorm"]=52]="bc5-rg-snorm",t[t["bc6h-rgb-ufloat"]=53]="bc6h-rgb-ufloat",t[t["bc6h-rgb-float"]=54]="bc6h-rgb-float",t[t["bc7-rgba-unorm"]=55]="bc7-rgba-unorm",t[t["bc7-rgba-unorm-srgb"]=56]="bc7-rgba-unorm-srgb",t[t["etc2-rgb8unorm"]=57]="etc2-rgb8unorm",t[t["etc2-rgb8unorm-srgb"]=58]="etc2-rgb8unorm-srgb",t[t["etc2-rgb8a1unorm"]=59]="etc2-rgb8a1unorm",t[t["etc2-rgb8a1unorm-srgb"]=60]="etc2-rgb8a1unorm-srgb",t[t["etc2-rgba8unorm"]=61]="etc2-rgba8unorm",t[t["etc2-rgba8unorm-srgb"]=62]="etc2-rgba8unorm-srgb",t[t["eac-r11unorm"]=63]="eac-r11unorm",t[t["eac-r11snorm"]=64]="eac-r11snorm",t[t["eac-rg11unorm"]=65]="eac-rg11unorm",t[t["eac-rg11snorm"]=66]="eac-rg11snorm",t[t["astc-4x4-unorm"]=67]="astc-4x4-unorm",t[t["astc-4x4-unorm-srgb"]=68]="astc-4x4-unorm-srgb",t[t["astc-5x4-unorm"]=69]="astc-5x4-unorm",t[t["astc-5x4-unorm-srgb"]=70]="astc-5x4-unorm-srgb",t[t["astc-5x5-unorm"]=71]="astc-5x5-unorm",t[t["astc-5x5-unorm-srgb"]=72]="astc-5x5-unorm-srgb",t[t["astc-6x5-unorm"]=73]="astc-6x5-unorm",t[t["astc-6x5-unorm-srgb"]=74]="astc-6x5-unorm-srgb",t[t["astc-6x6-unorm"]=75]="astc-6x6-unorm",t[t["astc-6x6-unorm-srgb"]=76]="astc-6x6-unorm-srgb",t[t["astc-8x5-unorm"]=77]="astc-8x5-unorm",t[t["astc-8x5-unorm-srgb"]=78]="astc-8x5-unorm-srgb",t[t["astc-8x6-unorm"]=79]="astc-8x6-unorm",t[t["astc-8x6-unorm-srgb"]=80]="astc-8x6-unorm-srgb",t[t["astc-8x8-unorm"]=81]="astc-8x8-unorm",t[t["astc-8x8-unorm-srgb"]=82]="astc-8x8-unorm-srgb",t[t["astc-10x5-unorm"]=83]="astc-10x5-unorm",t[t["astc-10x5-unorm-srgb"]=84]="astc-10x5-unorm-srgb",t[t["astc-10x6-unorm"]=85]="astc-10x6-unorm",t[t["astc-10x6-unorm-srgb"]=86]="astc-10x6-unorm-srgb",t[t["astc-10x8-unorm"]=87]="astc-10x8-unorm",t[t["astc-10x8-unorm-srgb"]=88]="astc-10x8-unorm-srgb",t[t["astc-10x10-unorm"]=89]="astc-10x10-unorm",t[t["astc-10x10-unorm-srgb"]=90]="astc-10x10-unorm-srgb",t[t["astc-12x10-unorm"]=91]="astc-12x10-unorm",t[t["astc-12x10-unorm-srgb"]=92]="astc-12x10-unorm-srgb",t[t["astc-12x12-unorm"]=93]="astc-12x12-unorm",t[t["astc-12x12-unorm-srgb"]=94]="astc-12x12-unorm-srgb"}(r||(r={})),e.GPUTextureFormat=r;const s=r;function n(t,e=!0){const i=s.hasOwnProperty(t);return i}e.checkGPUTextureFormat=n},"348f":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("af1b");class s{constructor(){this.mPolyhedral=!0,this.forceUpdateIVS=!1,this.shape=!0,this.normalType=0,this.normalScale=1,this.vtxTotal=0,this.trisNumber=0,this.vtCount=0,this.drawMode=r.WGRDrawMode.TRIANGLES}setTransformMatrix(t){this.mTransMatrix=t}getTransformMatrix(){return this.mTransMatrix}isPolyhedral(){return this.mPolyhedral}setPolyhedral(t){this.mPolyhedral=t}testRay(t,e,i,r){return-1}getVSStride(){return 3}getUVSStride(){return 2}getNVSStride(){return 3}getVS(){return null}getUVS(){return null}getNVS(){return null}getCVS(){return null}getIVS(){return this.mivs}setBufSortFormat(t){}__$destroy(){this.mivs&&(this.mivs=null,this.trisNumber=0,this.mTransMatrix=null)}}e.default=s},3590:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("005f"),s=i("374c");e.BufDataParamType=s.BufDataParamType;const n=i("9069");e.WGRUniformParam=n.WGRUniformParam;const a=i("5151"),o=i("dc4d"),l=i("dfa8");class u{constructor(){this.map=new Map}}e.SharedUniformObj=u;class h{constructor(){this.mUid=h.sUid++,this.mList=[],this.mBuildTotal=0,this.mBufObj=new n.WGRUniformBufObj,this.mFreeIds=[],this.ready=!1,this.layoutAuto=!0}getFreeIndex(){return this.mFreeIds.length>0?this.mFreeIds.pop():-1}getWGCtx(){return this.mBindGCtx.getWGCtx()}initialize(t){this.mBindGCtx=t}isEnabled(){return this.mBuildTotal>0}getBindGroupLayout(t){const e=this.mList,i=e[0],r=[];if(i.bufDataParams){const t=i.bufDataParams;for(let e=0;e<t.length;++e){const i=t[e];i.visibility.binding=r.length,i.visibility.buffer||i.visibility.toBufferForUniform(),r.push(i.visibility)}}if(i.texParams){const e=i.texParams;for(let i=0;i<e.length;++i){const s=e[i];let n=(new o.WGRBufferVisibility).toSamplerFiltering();n.binding=r.length,r.push(n),n=(new o.WGRBufferVisibility).toTextureFloat(s.texView.dimension),n.texture.multisampled=!0===t,n.binding=r.length,r.push(n)}}if(r.length<1)return;const s={label:"(BindGroupLayout)WGRUniformCtxInstance"+this.mUid,entries:r};return this.mBindGroupLayout=this.mBindGCtx.createBindGroupLayout(s),this.mBindGroupLayout}runBegin(){const t=this.mList;if(this.ready&&this.mBuildTotal<t.length&&(this.mBuildTotal=t.length,t.length>0)){this.mBindGroupDesc=null,this.mBufDataDescs=null;const e=t[0];e.uniformAppend||e.bufObj||(e.bufObj=new n.WGRUniformBufObj);const i=e.uniformAppend?this.mBufObj:e.bufObj;e.bufObj=i;const r=i.oldBufs;if(r)for(let t=0;t<r.length;++t)r[t].destroy();if(i.buffers=[],i.oldBufs=[],e.uniformAppend){for(let i=1;i<t.length;++i)t[i].bufObj=e.bufObj;this.buildBufs(e)}else{this.buildBufs(e);for(let e=1;e<t.length;++e){let i=t[e].bufObj;if(i){const t=i.oldBufs;if(t)for(let e=0;e<t.length;++e)t[e].destroy()}else i=t[e].bufObj=new n.WGRUniformBufObj;i.buffers=[],i.oldBufs=[],this.buildBufs(t[e])}}for(let s=0;s<t.length;++s)this.createUniformWithWP(t[s],s,!0)}}buildBufs(t){if(t.bufDataParams){const e=t.bufObj,i=this.mList,r=this.mBindGCtx.getWGCtx(),s=a.WGHBufferStore.getStore(r),n=t.uniformAppend,o=t.bufDataParams;for(let t=0;t<o.length;++t){const r=o[t];r.visibility.binding=t;const a=new Array(r.shared||!n?1:i.length),u={sizes:a,usage:r.usage,arrayStride:r.arrayStride},h=r.ufvalue;let c=h.buffer;const d=h.bufData;if(!c&&d&&(c=d.buffer),!c){let e=void 0!==d&&!0===d.shared;if(h.shared||e){let r=e&&void 0!==d.uid?d.uid:-1,n=h.shared?h.uid:r;if(s.hasWithUid(n))c=s.getBufWithUid(n);else{if(s.hasWithUid(r)?c=s.getBufWithUid(r):(u.sizes[0]=i[0].bufDataParams[t].size,c=this.mBindGCtx.createUniformsBuffer(u)),n<0||e&&!s.hasWithUid(r)){const t=(new l.WGRBufferView).setParam(d);t.buffer=c,h.bufData=t,d.uid=t.uid,s.addWithUid(t.uid,t)}h.shared&&(h.buffer=c,d&&void 0===d.uid&&(d.uid=h.uid),s.addWithUid(h.uid,h))}c.shared=!0}else if(n){for(let e=0;e<i.length;++e)u.sizes[e]=i[e].bufDataParams[t].size;c=this.mBindGCtx.createUniformsBuffer(u)}else u.sizes[0]=i[t].bufDataParams[t].size,c=this.mBindGCtx.createUniformsBuffer(u)}r.shared||d&&!0===d.shared||e.oldBufs.push(c),d&&!d.buffer&&(d.buffer=c),e.buffers.push(c)}}}createVers(t){const e=t.bufDataParams,i=this.shdUniform.map;let r=new Array(e.length);for(let s=0;s<e.length;++s){const t=e[s].ufvalue;if(!0===t.shared){const e=t.uid;i.has(e)||i.set(e,{vid:t.uid,ver:-9,shared:!0,shdVarName:t.shdVarName}),r[s]=i.get(e)}else r[s]={vid:t.uid,ver:-9,shared:!1,shdVarName:t.shdVarName}}return r}createUvfs(t){const e=t.bufDataParams;let i=new Array(e.length);for(let r=0;r<e.length;++r)i[r]=e[r].ufvalue;return i}createUniformWithWP(t,e,i=!1){const r=t.uniform;if(r&&(!r.bindGroup||i)){r.buffers=t.bufObj.buffers.slice(0),r.versions=this.createVers(t),r.uvfs=this.createUvfs(t);let i=new Array(r.uvfs.length);for(let e=0;e<i.length;++e)i[e]=r.uvfs[e].shared||!t.uniformAppend?0:r.index;r.ivs=i;const s=t.bufDataParams;if(s){let i=this.mBindGroupDesc,n=this.mBufDataDescs;if(!i||!t.uniformAppend){if(!n||!t.uniformAppend){n=new Array(s.length);for(let t=0;t<s.length;++t){const i=s[t];n[t]={index:e,buffer:r.buffers[t],bufferSize:i.size,shared:i.shared}}this.mBufDataDescs=n}if(t.uniformAppend)for(let t=0;t<n.length;++t)n[t].index=e;const a=this.layoutAuto?null:this.mBindGroupLayout;i=this.mBindGCtx.createBindGroupDesc(t.groupIndex,n,t.texParams,0,a),this.mBindGroupDesc=i}this.mBindGCtx.bindGroupDescUpdate(i,n,t.texParams,e,t.uniformAppend),r.bindGroup=this.mBindGCtx.createBindGroupWithDesc(i)}else r.bindGroup=this.mBindGCtx.createBindGroup(t.groupIndex,null,t.texParams);r.__$$updateSubUniforms()}}runEnd(){}createUniform(t,e,i,s,a){if(!(i&&i.length||s&&s.length))throw Error("Illegal operation !!!");const o=this.getFreeIndex(),l=new r.WGRUniform(this);let u;if(l.layoutName=t,l.groupIndex=e,o>=0?(u=this.mList[o],l.index=o):(u=new n.WGRUniformWrapper,l.index=this.mList.length,this.mList.push(u)),u.uniformAppend=!1!==a,u.texParams=s,u.bufDataParams=i,u.uniform=l,u.enabled=!0,o>=0)if(u.uniformAppend){const t=u.uniformAppend?this.mBufObj:u.bufObj;u.bufObj=t,this.createUniformWithWP(u,o)}else this.mBuildTotal=0;return l}updateUniformTextureView(t,e){if(t&&t.index>=0&&this.mList[t.index]){const i=this.mList[t.index],r=i.uniform;r&&(r.bindGroup=this.mBindGCtx.createBindGroup(i.groupIndex,i.bufDataDescs,e))}}removeUniform(t){if(t&&t.index>=0&&this.mList[t.index]){const e=this.mList[t.index];e.enabled&&(this.mFreeIds.push(t.index),e.uniform=null,e.bufObj=null,e.texParams=null,e.enabled=!1,t.__$$destroy())}}destroy(){if(this.mBindGCtx){this.shdUniform=null,this.mBufObj&&(this.mBufObj.destroy(),this.mBufObj=null),this.mBindGCtx=null;let t=this.mList;for(let e=0;e<t.length;++e)this.mList[e]&&this.removeUniform(this.mList[e].uniform)}}}h.sUid=0,e.WGRUniformCtxInstance=h},3645:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("4ad2"),n=i("d463"),a=i("f083"),o=i("943f"),l=r(i("d36d")),u=r(i("d3d0")),h=r(i("5dcd")),c={diffuse:{uuid:"rtt0",rttTexture:{}}},d={diffuse:{uuid:"rtt1",rttTexture:{}}},m=[c,d],f={texture:c,clearValue:[],loadOp:"clear",storeOp:"store"},p=[f];class v extends a.WGRPassNodeGraph{constructor(){super()}run(){let t=this.passes[0];const e=this.srcEntity,i=this.blurEntity;let r=i.materials;for(let s=0;s<9;++s){const n=s%2,a=(s+1)%2;e.visible=s<1,i.visible=!e.visible,t.colorAttachments[0].clearEnabled=s<1,f.texture=m[n],r[n].visible=!1,r[a].visible=!r[n].visible,t.render()}}}class g{constructor(){this.mRscene=new s.RendererScene,this.mGraph=new v,this.mBlurDensity=2,this.uniformValues=[{data:new Float32Array([512,512,this.mBlurDensity,0])}]}initialize(){const t=!0,e=!1,i={multisampleEnabled:t,depthTestEnabled:e};this.mRscene.initialize({rpassparam:i}),this.initScene()}createMaterial(t,e,i){let r={vert:{code:l.default,uuid:"vert"},frag:{code:i>0?h.default:u.default,uuid:"frag"}};t+="-"+i;let s={depthWriteEnabled:!1};const n=new o.WGMaterial({shadinguuid:t,shaderSrc:r,pipelineDefParam:s});return n.uniformValues=this.uniformValues,n.addTextures(e),n}applyBlurPass(t,e){let i=this.mRscene;const r=this.mGraph;f.clearValue=t;let s=i.createRenderPass({separate:!0,colorAttachments:p});r.passes=[s];const a={diffuse:{url:"static/assets/huluwa.jpg",flipY:!0}};let o=[this.createMaterial("shd-00",[c],0),this.createMaterial("shd-01",[d],1)],l=new n.FixScreenPlaneEntity({extent:[-1,-1,2,2],textures:[a]});s.addEntity(l),r.srcEntity=l,i.setPassNodeGraph(r);let u=new n.FixScreenPlaneEntity({extent:e,flipY:!0,materials:o});u.materials[0].visible=!1,u.uuid="blur-entity",s.addEntity(u),r.blurEntity=u,e=[-.8,-.8,1.6,1.6],u=new n.FixScreenPlaneEntity({extent:e,flipY:!0,textures:[c]}),u.uuid="blur-big-img",i.addEntity(u),e=[-.95,-.95,.6,.6],u=new n.FixScreenPlaneEntity({extent:e,flipY:!1,textures:[a]}),i.addEntity(u)}initScene(){this.applyBlurPass([.1,.1,.1,1],[-1,-1,2,2])}run(){this.mRscene.run()}}e.PingpongBlur=g},"36ce":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("c812"),s=i("374c");e.BufDataParamType=s.BufDataParamType,e.VtxPipelinDescParam=s.VtxPipelinDescParam;const n=i("70bd"),a=i("b2fd");e.WGRUniformParam=a.WGRUniformParam;const o=i("8a88"),l=i("af1b");class u{constructor(t){this.mUid=u.sUid++,this.mInit=!0,this.mShader=new n.WGRPipelineShader,this.bindGroupCtx=new o.WGRBindGroupContext,this.type="render",this.pipeline=new r.GPURenderPipelineEmpty,this.shadinguuid="",this.name="PipelineContext",this.uniformCtx=new a.WGRUniformContext(!1),t&&this.initialize(t)}init(){if(this.mInit){this.mInit=!1;const t=this.mWGCtx,e=this.mPipelineParams;if(e){let i;if(this.mShader.build(e,this.rpass),this.uniformCtx.isLayoutAuto())i=t.device.createPipelineLayout({label:e.label,bindGroupLayouts:[]});else{const r=this.uniformCtx.getBindGroupLayout(e.multisampleEnabled),s=r?[r]:[];i=t.device.createPipelineLayout({label:e.label,bindGroupLayouts:s})}if(this.bindGroupCtx.rpass=this.rpass,e.compShaderSrc){const r={label:this.shadinguuid+"-comp-pl-"+this.mUid,layout:i,compute:e.compute};this.comppipeline=t.device.createComputePipeline(r),this.type="compute",this.bindGroupCtx.comppipeline=this.comppipeline}else e.layout=i,e.label=this.shadinguuid+"-pl-"+this.mUid,this.pipeline=t.device.createRenderPipeline(e),this.bindGroupCtx.pipeline=this.pipeline}}}destroy(){this.mWGCtx&&(this.mWGCtx=null)}runBegin(){this.init(),this.uniformCtx.runBegin()}runEnd(){this.uniformCtx.runEnd()}initialize(t){t&&!this.mWGCtx&&(this.mWGCtx=t,this.queue=t.queue,this.bindGroupCtx.initialize(t),this.uniformCtx.initialize(this.bindGroupCtx),this.mShader.initialize(t))}getWGCtx(){return this.mWGCtx}createRenderingPipeline(t,e,i){this.mWGCtx;if(e){let r=0;for(let i=0;i<e.length;++i){const s=e[i].vertex;t.addVertexBufferLayout({arrayStride:s.arrayStride,attributes:[],stepMode:"vertex"});const n=s.params;for(let e=0;e<n.length;++e){const s=n[e];t.addVertexBufferAttribute({shaderLocation:r++,offset:s.offset,format:s.format},i)}}if(i){const e=t.primitive;if(e&&i.vertex)switch(i.vertex.drawMode){case l.WGRDrawMode.LINES:e.topology="line-list";break;default:break}}}return this.createRenderPipeline(t)}createRenderPipeline(t){const e=this.mWGCtx;return t.buildDeferred?this.mPipelineParams=t:this.mShader.build(t,this.rpass),this.mPipelineParams||(this.pipeline=e.device.createRenderPipeline(t)),this.pipeline}createRenderPipelineWithBuf(t,e){if(t.compShaderSrc)return this.createRenderPipeline(t);if(e){const i=e.vertex,r=i?this.createRenderPipelineVtxParams(i.buffers,i.attributeIndicesArray):[{}];return this.createRenderingPipeline(t,r,e)}return this.createRenderingPipeline(t,[{}])}createRenderPipelineVtxParam(t,e){const i={vertex:{arrayStride:t.arrayStride,params:[]}},r=i.vertex.params,s=e;for(let n=0;n<e.length;++n)r.push({offset:t.vectorOffsets[s[n]],format:t.vectorFormats[s[n]]});return i}createRenderPipelineVtxParams(t,e){const i=new Array(e.length);for(let r=0;r<e.length;++r)i[r]=this.createRenderPipelineVtxParam(t[r],e[r]);return i}}u.sUid=0,e.WGRPipelineContext=u},"374c":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},"37b8":function(t,e,i){"use strict";function r(t){if(!t)return t;let e=t;return t.diffuse&&(e=t.diffuse,e.shdVarName="diffuse"),t.color&&(e=t.color,e.shdVarName="color"),t.albedo&&(e=t.albedo,e.shdVarName="albedo"),t.normal&&(e=t.normal,e.shdVarName="normal"),t.ao&&(e=t.ao,e.shdVarName="ao"),t.metallic&&(e=t.metallic,e.shdVarName="metallic"),t.roughness&&(e=t.roughness,e.shdVarName="roughness"),t.specularEnv&&(e=t.specularEnv,e.shdVarName="specularEnv"),t.arm&&(e=t.arm,e.shdVarName="arm"),t.parallax&&(e=t.parallax,e.shdVarName="parallax"),t.displacement&&(e=t.displacement,e.shdVarName="displacement"),t.specular&&(e=t.specular,e.shdVarName="specular"),e}Object.defineProperty(e,"__esModule",{value:!0}),e.texDescriptorFilter=r},"37f2":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("660c"),s=i("89ff");function n(t,e,i){const n=9,a=31,o=15,l=((1<<n)-1)/(1<<n)*2**(a-o),u=s.clamp(t,{min:0,max:l}),h=s.clamp(e,{min:0,max:l}),c=s.clamp(i,{min:0,max:l}),d=Math.max(u,h,c),m=Math.max(-o-1,Math.floor(Math.log2(d)))+1+o,f=Math.floor(d/2**(m-o-n)+.5),p=f===1<<n?m+1:m,v=1/2**(p-o-n),g=Math.floor(u*v+.5),b=Math.floor(h*v+.5),y=Math.floor(c*v+.5);return r.assert(g>=0&&g<=511),r.assert(b>=0&&b<=511),r.assert(y>=0&&y<=511),r.assert(p>=0&&p<=31),(p<<27|y<<18|b<<9|g)>>>0}e.packRGB9E5UFloat=n},"381c":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=i("4ad2"),a=i("213f"),o=i("d463");class l{constructor(){this.mRscene=new n.RendererScene,this.mouseDown=t=>{}}initialize(){this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(s.default.MOUSE_DOWN,this.mouseDown),(new a.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}initScene(){const t=this.mRscene,e={diffuse:{url:"static/assets/default.jpg",flipY:!0}};let i=(new o.FixScreenPlaneEntity).setColor([.2,.5,.7]);t.addEntity(i),i=new o.FixScreenPlaneEntity({extent:[-.8,.1,.5,.5]}).setColor([.2,.8,.3]),t.addEntity(i),i=new o.FixScreenPlaneEntity({extent:[-.8,-.8,.8,.8],textures:[e]}),i.setColor([.1,.3,.9]),t.addEntity(i)}run(){this.mRscene.run()}}e.FixScreenPlaneTest=l},3850:function(t,e,i){"use strict";function r(t,e){if(e){const t=this.materials;let i=Math.min(e.length,t.length);for(let r=0;r<i;++r){const i=t[r].rpass;i&&i.rpass.node||(t[r].rpass=e[r])}}}Object.defineProperty(e,"__esModule",{value:!0}),e.checkMaterialRPasses=r},"395b":function(t,e,i){"use strict";i.r(e),e["default"]="\r\n@group(0) @binding(0) var<uniform> objMat : mat4x4<f32>;\r\n@group(0) @binding(1) var<uniform> viewMat : mat4x4<f32>;\r\n@group(0) @binding(2) var<uniform> projMat : mat4x4<f32>;\r\n\r\nstruct VertexOutput {\r\n  @builtin(position) Position : vec4<f32>,\r\n  @location(0) pos: vec4<f32>,\r\n  @location(1) uv : vec2<f32>,\r\n  @location(2) normal : vec3<f32>\r\n}\r\n\r\nfn inverseM33(m: mat3x3<f32>)-> mat3x3<f32> {\r\n    let a00 = m[0][0]; let a01 = m[0][1]; let a02 = m[0][2];\r\n    let a10 = m[1][0]; let a11 = m[1][1]; let a12 = m[1][2];\r\n    let a20 = m[2][0]; let a21 = m[2][1]; let a22 = m[2][2];\r\n    let b01 = a22 * a11 - a12 * a21;\r\n    let b11 = -a22 * a10 + a12 * a20;\r\n    let b21 = a21 * a10 - a11 * a20;\r\n    let det = a00 * b01 + a01 * b11 + a02 * b21;\r\n    return mat3x3<f32>(\r\n\t\tvec3<f32>(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11)) / det,\r\n                vec3<f32>(b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10)) / det,\r\n                vec3<f32>(b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det);\r\n}\r\nfn m44ToM33(m: mat4x4<f32>) -> mat3x3<f32> {\r\n\treturn mat3x3(m[0].xyz, m[1].xyz, m[2].xyz);\r\n}\r\n\r\nfn inverseM44(m: mat4x4<f32>)-> mat4x4<f32> {\r\n    let a00 = m[0][0]; let a01 = m[0][1]; let a02 = m[0][2]; let a03 = m[0][3];\r\n    let a10 = m[1][0]; let a11 = m[1][1]; let a12 = m[1][2]; let a13 = m[1][3];\r\n    let a20 = m[2][0]; let a21 = m[2][1]; let a22 = m[2][2]; let a23 = m[2][3];\r\n    let a30 = m[3][0]; let a31 = m[3][1]; let a32 = m[3][2]; let a33 = m[3][3];\r\n    let b00 = a00 * a11 - a01 * a10;\r\n    let b01 = a00 * a12 - a02 * a10;\r\n    let b02 = a00 * a13 - a03 * a10;\r\n    let b03 = a01 * a12 - a02 * a11;\r\n    let b04 = a01 * a13 - a03 * a11;\r\n    let b05 = a02 * a13 - a03 * a12;\r\n    let b06 = a20 * a31 - a21 * a30;\r\n    let b07 = a20 * a32 - a22 * a30;\r\n    let b08 = a20 * a33 - a23 * a30;\r\n    let b09 = a21 * a32 - a22 * a31;\r\n    let b10 = a21 * a33 - a23 * a31;\r\n    let b11 = a22 * a33 - a23 * a32;\r\n    let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\treturn mat4x4<f32>(\r\n\t\tvec4<f32>(a11 * b11 - a12 * b10 + a13 * b09,\r\n\t\ta02 * b10 - a01 * b11 - a03 * b09,\r\n\t\ta31 * b05 - a32 * b04 + a33 * b03,\r\n\t\ta22 * b04 - a21 * b05 - a23 * b03) / det,\r\n\t\t\tvec4<f32>(a12 * b08 - a10 * b11 - a13 * b07,\r\n\t\ta00 * b11 - a02 * b08 + a03 * b07,\r\n\t\ta32 * b02 - a30 * b05 - a33 * b01,\r\n\t\ta20 * b05 - a22 * b02 + a23 * b01) / det,\r\n\t\tvec4<f32>(a10 * b10 - a11 * b08 + a13 * b06,\r\n\t\ta01 * b08 - a00 * b10 - a03 * b06,\r\n\t\ta30 * b04 - a31 * b02 + a33 * b00,\r\n\t\ta21 * b02 - a20 * b04 - a23 * b00) / det,\r\n\t\tvec4<f32>(a11 * b07 - a10 * b09 - a12 * b06,\r\n\t\ta00 * b09 - a01 * b07 + a02 * b06,\r\n\t\ta31 * b01 - a30 * b03 - a32 * b00,\r\n\t\ta20 * b03 - a21 * b01 + a22 * b00) / det);\r\n}\r\n@vertex\r\nfn main(\r\n  @location(0) position : vec3<f32>,\r\n  @location(1) uv : vec2<f32>,\r\n  @location(2) normal : vec3<f32>\r\n) -> VertexOutput {\r\n  var output : VertexOutput;\r\n  output.Position = projMat * viewMat * objMat * vec4(position.xyz, 1.0);\r\n  output.uv = uv;\r\n\r\n  let invMat33 = inverseM33( m44ToM33( objMat ) );\r\n  output.normal = normalize( normal * invMat33 );\r\n\r\n  var pv: vec4<f32>;\r\n  pv = vec4<f32>(position, 1.0);\r\n  output.pos = pv;\r\n  return output;\r\n}\r\n"},3963:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("a5b0")),n=r(i("0f9f"));class a{constructor(){this.mSysEvt=new n.default,this.mDiv=null,this.mCanvas=null,this.m_offcanvas=null,this.mStage=null,this.m_dpr=1,this.m_viewEle=new s.default,this.m_resizeFlag=!0}getDiv(){return this.mDiv}getCanvas(){return this.m_offcanvas?this.m_offcanvas:this.mCanvas}setDivStyleLeftAndTop(t,e){this.m_viewEle.setDivStyleLeftAndTop(t,e)}setDivStyleSize(t,e){this.m_viewEle.setDivStyleSize(t,e)}initialize(t){this.mStage=t.stage,this.mDiv=t.div,this.m_viewEle.setDiv(t.div),this.setCanvas(t.canvas)}setCanvas(t){let e=this.mCanvas;this.m_viewEle.setCanvas(t);let i=this.m_viewEle.getCanvas();return e!=i&&(this.m_offcanvas=null,this.mCanvas=i,this.initEvt()),e!=i}initEvt(){this.mSysEvt.initialize(this.mCanvas,this.mDiv,this.mStage)}getStage(){return this.mStage}getStageWidth(){return this.mStage.stageWidth}getStageHeight(){return this.mStage.stageHeight}}e.RAdapterContext=a},"3cf9":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("bcc5"));class n{static KeyDown(t){for(var e=n.m_down_listener.length,i=0;i<e;++i)n.m_down_listener[i].call(n.m_down_ers[i],t)}static KeyUp(t){let e=n.m_up_listener.length;for(let i=0;i<e;++i)n.m_up_listener[i].call(n.m_up_ers[i],t)}static AddEventListener(t,e,i){if(null!=i){let r=0;switch(t){case s.default.KEY_DOWN:for(r=n.m_down_listener.length-1;r>=0;--r)if(i===n.m_down_listener[r])break;r<0&&(n.m_down_ers.push(e),n.m_down_listener.push(i));break;case s.default.KEY_UP:for(r=n.m_up_listener.length-1;r>=0;--r)if(i===n.m_up_listener[r])break;r<0&&(n.m_up_ers.push(e),n.m_up_listener.push(i));break;default:break}}}static RemoveEventListener(t,e){if(null!=e){let i;switch(t){case s.default.KEY_DOWN:for(i=n.m_down_listener.length-1;i>=0;--i)if(e===n.m_down_listener[i]){n.m_down_ers.splice(i,1),n.m_down_listener.splice(i,1);break}break;case s.default.KEY_UP:for(i=n.m_up_listener.length-1;i>=0;--i)if(e===n.m_up_listener[i]){n.m_up_ers.splice(i,1),n.m_up_listener.splice(i,1);break}break;default:break}}}}n.SHIFT=16,n.CTRL=17,n.ALT=18,n.ESC=27,n.A=65,n.B=66,n.C=67,n.D=68,n.E=69,n.F=70,n.G=71,n.H=72,n.I=73,n.J=74,n.K=75,n.L=76,n.M=77,n.N=78,n.O=79,n.P=80,n.Q=81,n.R=82,n.S=83,n.T=84,n.U=85,n.V=86,n.W=87,n.X=88,n.Y=89,n.Z=90,n.m_down_ers=[],n.m_down_listener=[],n.m_up_ers=[],n.m_up_listener=[],e.default=n},"3e26":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("af80")),n=r(i("c3d6")),a=r(i("3e40")),o=r(i("348f")),l=i("af1b"),u=r(i("2c77"));new s.default,new u.default;class h extends o.default{constructor(){super(),this.mLSTotal=0,this.dashedData=!1,this.lineRadius=2,this.mPolyhedral=!1,this.drawMode=l.WGRDrawMode.LINES}getVS(){return this.mvs}getUVS(){return this.muvs}getCVS(){return this.mcvs}getIVS(){return this.mivs}initialize(t,e){const i=new s.default,r=new u.default;let n=0;if(this.dashedData){this.mvs=new Float32Array(3*t.length);for(let e=0;e<t.length;++e)t[e]&&i.setVector3(t[e]).toArray3(this.mvs,3*n++)}else{this.mvs=new Float32Array(t.length>2?3*(2*(t.length-2)+2):3*t.length);for(let e=0;e<t.length;++e)t[e]&&(i.setVector3(t[e]).toArray3(this.mvs,3*n++),e>0&&e<t.length-1&&i.setVector3(t[e]).toArray3(this.mvs,3*n++))}if(e)if(n=0,this.dashedData){this.mcvs=new Float32Array(3*e.length);for(let t=0;t<e.length;++t)e[t]&&r.setColor(e[t]).toArray3(this.mcvs,3*n++)}else{this.mcvs=new Float32Array(e.length>2?3*(2*(e.length-2)+2):3*e.length);for(let t=0;t<e.length;++t)e[t]&&(r.setColor(e[t]).toArray3(this.mcvs,3*n++),t>0&&t<e.length-1&&r.setColor(e[t]).toArray3(this.mcvs,3*n++))}this.bounds||(this.bounds=new a.default),this.bounds.addFloat32Arr(this.mvs),this.bounds.updateFast(),this.trisNumber=0,this.vtCount=Math.floor(this.mvs.length/3),this.mLSTotal=Math.floor(this.vtCount/2)}__$destroy(){this.mivs&&(this.bounds=null,this.mvs=null,this.muvs=null,this.mcvs=null,super.__$destroy())}testRay(t,e,i,r){const s=h;let a=0;const o=this.mvs;let l=0;const u=this.lineRadius,c=s.sPv0,d=s.sPv1;for(let h=0;h<this.mLSTotal;++h){if(c.setXYZ(o[a],o[a+1],o[a+2]),d.setXYZ(o[a+3],o[a+4],o[a+5]),l=n.default.IntersectionLS(t,e,c,d,i,u),l>0)return 1;a+=6}return 0}}h.sPv0=new s.default,h.sPv1=new s.default,e.default=h},"3e2f":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},"3e40":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("ec7b")),n=r(i("af80"));class a{constructor(){this.m_long=100,this.m_width=100,this.m_height=100,this.m_halfLong=50,this.m_halfWidth=50,this.m_halfHeight=50,this.m_tempV=new n.default,this.version=-1,this.radius=50,this.radius2=2500,this.min=new n.default,this.max=new n.default,this.center=new n.default,this.reset()}getLong(){return this.m_long}getWidth(){return this.m_width}getHeight(){return this.m_height}reset(){const t=this.min,e=this.max;t.x=t.y=t.z=s.default.MATH_MAX_POSITIVE,e.x=e.y=e.z=s.default.MATH_MIN_NEGATIVE}equals(t){return this.min.equalsXYZ(t.min)&&this.max.equalsXYZ(t.max)}setVolume(t,e,i){this.m_width=t,this.m_height=e,this.m_long=i,this.m_halfLong=.5*this.m_long,this.m_halfWidth=.5*this.m_width,this.m_halfHeight=.5*this.m_height,this.max.x=this.center.x+this.m_halfWidth,this.max.y=this.center.y+this.m_halfHeight,this.max.z=this.center.z+this.m_halfLong,this.min.x=this.center.x-this.m_halfWidth,this.min.y=this.center.y-this.m_halfHeight,this.min.z=this.center.z-this.m_halfLong,this.radius2=this.m_halfWidth*this.m_halfWidth+this.m_halfHeight*this.m_halfHeight+this.m_halfLong*this.m_halfLong,this.radius=Math.sqrt(this.radius2)}union(t){return this.addPosition(t.min),this.addPosition(t.max),this}addPosition(t){return this.addXYZ(t.x,t.y,t.z),this}addXYZ(t,e,i){const r=this.min,s=this.max;r.x>t&&(r.x=t),s.x<t&&(s.x=t),r.y>e&&(r.y=e),s.y<e&&(s.y=e),r.z>i&&(r.z=i),s.z<i&&(s.z=i)}addFloat32Arr(t,e=3){let i=t.length;if(e>=3)for(let r=0;r<i;)this.addXYZ(t[r],t[r+1],t[r+2]),r+=e;if(2==e)for(let r=0;r<i;)this.addXYZ(t[r],t[r+1],0),r+=e}addFloat32AndIndices(t,e,i=3){let r,s=e.length;if(i>=3)for(let n=0;n<s;n++)r=e[n]*i,this.addXYZ(t[r++],t[r++],t[r]);else if(2==i)for(let n=0;n<s;n++)r=e[n]*i,this.addXYZ(t[r++],t[r],0)}getClosePosition(t,e,i=0){const r=this.min,s=this.max;e.copyFrom(t),e.x<r.x?e.x=r.x+i:e.x>s.x&&(e.x=s.x-i),e.y<r.y?e.y=r.y+i:e.y>s.y&&(e.y=s.y-i),e.z<r.z?e.z=r.z+i:e.z>s.z&&(e.z=s.z-i)}containsV(t){return!(t.x<this.min.x||t.x>this.max.x)&&(!(t.y<this.min.y||t.y>this.max.y)&&!(t.z<this.min.z||t.z>this.max.z))}containsXY(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.y||e>this.max.y)}containsXZ(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.z||e>this.max.z)}containsYZ(t,e){return!(t<this.min.y||t>this.max.y)&&!(e<this.min.z||e>this.max.z)}copyFrom(t){return this.radius=t.radius,this.radius2=t.radius2,this.min.copyFrom(t.min),this.max.copyFrom(t.max),this.center.copyFrom(t.center),this.updateVolume(),this.version=t.version,this}expand(t){return this.min.subtractBy(t),this.max.addBy(t),this}updateVolume(){return this.m_width=this.max.x-this.min.x,this.m_height=this.max.y-this.min.y,this.m_long=this.max.z-this.min.z,this.m_halfLong=.5*this.m_long,this.m_halfWidth=.5*this.m_width,this.m_halfHeight=.5*this.m_height,++this.version,this}updateThis(){this.center.x=.5*this.m_width,this.center.y=.5*this.m_height,this.center.z=.5*this.m_long,this.m_halfLong=this.center.z,this.m_halfWidth=this.center.x,this.m_halfHeight=this.center.y,this.radius2=this.m_halfWidth*this.m_halfWidth+this.m_halfHeight*this.m_halfHeight+this.m_halfLong*this.m_halfLong,this.radius=Math.sqrt(this.radius2),this.center.addBy(this.min),++this.version}update(){this.m_width=this.max.x,this.min.x>this.max.x&&(this.max.x=this.min.x,this.min.x=this.m_width),this.m_width=this.max.x-this.min.x,this.m_height=this.max.y,this.min.y>this.max.y&&(this.max.y=this.min.y,this.min.y=this.m_height),this.m_height=this.max.y-this.min.y,this.m_long=this.max.z,this.min.z>this.max.z&&(this.max.z=this.min.z,this.min.z=this.m_long),this.m_long=this.max.z-this.min.z,this.updateThis()}updateFast(){this.m_width=this.max.x-this.min.x,this.m_height=this.max.y-this.min.y,this.m_long=this.max.z-this.min.z,this.updateThis()}toString(){return"[AABB(min->"+this.min+",size("+this.m_width+","+this.m_height+","+this.m_long+"))]"}sphereIntersect(t,e){this.m_tempV.x=this.center.x-t.x,this.m_tempV.y=this.center.y-t.y,this.m_tempV.z=this.center.z-t.z;let i=this.m_tempV.getLengthSquared();return i<this.radius2||(e+=this.radius,e*=e,e>=i)}}e.default=a},"3f99":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(3) var mySampler: sampler;\r\n@group(0) @binding(4) var myTexture: texture_2d<f32>;\r\n\r\n@fragment\r\nfn main(\r\n  @location(0) fragUV: vec2<f32>,\r\n  @location(1) fragPosition: vec4<f32>\r\n) -> @location(0) vec4<f32> {\r\n  return textureSample(myTexture, mySampler, fragUV) * fragPosition;\r\n}\r\n"},"406a":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);e.IdentityMat4Data=r},4145:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("222c");class s{constructor(){this.blockid=-1,this.entityid=-1,this.rstate=new r.WGRUnitState}}e.WGREntityNode=s},4173:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("4ad2"),s=i("213f"),n=i("d463"),a=i("f083"),o={diffuse:{uuid:"rtt0",rttTexture:{}}},l={diffuse:{uuid:"rtt1",rttTexture:{}}},u={texture:o,clearValue:[],loadOp:"clear",storeOp:"store"},h={texture:l,clearValue:[]},c=[u];class d extends a.WGRPassNodeGraph{constructor(){super(),this.mTimes=0}runBegin(){super.runBegin()}run(){if(this.mTimes++,50==this.mTimes){const t=!0;t?(h.clearValue=[.2,.5,.2],c[0]=h):c[0].texture=l}let t=this.passes[0];for(let e=0;e<1;++e)t.colorAttachments[0].clearEnabled=e<1,t.render()}}class m{constructor(){this.mRscene=new r.RendererScene,this.mGraph=new d}initialize(){let t=!0,e=!1,i={multisampleEnabled:t,depthTestEnabled:e};this.mRscene.initialize({rpassparam:i}),this.initEvent(),this.initScene()}applyRTTPass(t,e=[.4,.3,.5,.5]){let i=this.mRscene;const r=this.mGraph;u.clearValue=t,h.clearValue=t;let s=i.renderer.appendRenderPass({separate:!0,colorAttachments:c});const a={diffuse:{url:"static/assets/huluwa.jpg",flipY:!0}};let d=new n.FixScreenPlaneEntity({extent:[-.8,-.8,1.6,1.6],textures:[a]});s.addEntity(d),r.passes=[s],i.setPassNodeGraph(r);let m=new n.FixScreenPlaneEntity({extent:e,flipY:!0,textures:[o]});i.addEntity(m),e=[-.9,-.9,1.2,1.2],m=new n.FixScreenPlaneEntity({extent:e,flipY:!0,textures:[l]}),i.addEntity(m)}initEvent(){const t=this.mRscene;(new s.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}initScene(){this.applyRTTPass([.1,.1,.1,1],[-.8,-.8,1.6,1.6])}run(){this.mRscene.run()}}e.ColorAttachmentReplace=m},4255:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("e38f")),n=r(i("3e40")),a=r(i("348f")),o=r(i("98bb"));class l extends a.default{constructor(){super(),this.mvs=null,this.muvs=null,this.mnvs=null,this.inverseUV=!1,this.uScale=1,this.vScale=1}getVS(){return this.mvs}getUVS(){return this.muvs}getNVS(){return this.mnvs}getIVS(){return this.mivs}initialize(t,e,i,r,a=1,l=-.5){if(this.vtxTotal<1){if(t<.01)return;i<2&&(i=2),r=3;let u=Math.abs(t),h=Math.abs(e),c=i,d=r,m=1,f=0,p=0,v=0,g=0,b=0,y=l*h;this.bounds=new n.default,this.bounds.min.setXYZ(-t,y,-t),this.bounds.max.setXYZ(t,y+h,t),this.bounds.updateFast();let _=new o.default;_.y=y;let x=[],w=[];w.push([]);let S=w[0];for(_.u=.5,_.v=.5,_.nx=0,_.ny=-1,_.nz=0,S.push(_.cloneVertex()),x.push(S[0]);m<d;++m){_.y=y+h*(m-1),w.push([]);let t=w[m];for(f=0;f<c;++f)v=2*Math.PI*f/c,++p,g=Math.sin(v),b=Math.cos(v),_.x=g*u,_.z=b*u,_.index=p,g*=.495,b*=.495,_.u=.5+g,_.v=.5+b,m<2?(_.nx=0,_.ny=-1,_.nz=0):(_.nx=0,_.ny=1,_.nz=0),t.push(_.cloneVertex()),x.push(t[f]);t.push(t[0])}++p,_.index=p,_.x=0,_.y=y+h,_.z=0,_.u=.5,_.v=.5,_.nx=0,_.ny=1,_.nz=0,w.push([]);let M=w[3];M.push(_.cloneVertex()),x.push(M[0]);let P=1/u;for(m=0;m<2;++m){let t=w[m+1];w.push([]);let e=w[w.length-1];for(f=0;f<=c;++f)++p,_.copyFrom(t[f]),_.index=p,a<1?(_.v=m<1?0:this.vScale,_.u=this.uScale*(f/c)):(_.u=m<1?0:this.uScale,_.v=this.vScale*(f/c)),_.ny=0,_.nx=_.x*P,_.nz=_.z*P,e.push(_.cloneVertex()),x.push(e[f])}let T=null,E=[];m=1;let C=null,R=null;for(;m<=d;++m)for(C=w[m-1],R=w[m],f=1;f<=c;++f)1==m?(E.push(C[0].index),E.push(R[f].index),E.push(R[f-1].index)):m==d&&(E.push(C[f].index),E.push(R[0].index),E.push(C[f-1].index));for(C=w[w.length-2],R=w[w.length-1],f=1;f<=c;++f)E.push(C[f].index),E.push(R[f-1].index),E.push(C[f-1].index),E.push(C[f].index),E.push(R[f].index),E.push(R[f-1].index);for(this.vtxTotal=x.length,this.mvs=new Float32Array(3*this.vtxTotal),m=0,f=0;f<this.vtxTotal;++f)T=x[f],this.mvs[m]=T.x,this.mvs[m+1]=T.y,this.mvs[m+2]=T.z,m+=3;for(null!=this.mTransMatrix&&(this.mTransMatrix.transformVectorsSelf(this.mvs,this.mvs.length),this.bounds.addFloat32Arr(this.mvs),this.bounds.updateFast()),this.mivs=new Uint16Array(E),this.vtCount=this.mivs.length,this.trisNumber=this.vtCount/3,this.muvs=new Float32Array(2*this.vtxTotal),m=0,f=0;f<this.vtxTotal;++f)T=x[f],this.muvs[m]=T.u,this.muvs[m+1]=T.v,m+=2;if(this.mnvs=new Float32Array(3*this.vtxTotal),null!=this.mTransMatrix)s.default.ClacTrisNormal(this.mvs,this.mvs.length,this.trisNumber,this.mivs,this.mnvs);else for(m=0,f=0;f<this.vtxTotal;++f)T=x[f],this.mnvs[m]=T.nx,this.mnvs[m+1]=T.ny,this.mnvs[m+2]=T.nz,m+=3;this.vtCount=this.mivs.length,this.trisNumber=this.vtCount/3}}__$destroy(){this.mivs&&(this.bounds=null,this.mvs=null,this.muvs=null,this.mnvs=null,super.__$destroy())}}e.default=l},"425a":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("213f"),s=i("56f9"),n=i("2fc9");class a{constructor(){this.mScene=new s.DataDrivenRScene}initialize(){let t="static/assets/scene/sceneData01.json";(new n.HttpFileLoader).loadJson(t,(t,e)=>{this.initScene(t)})}initScene(t){this.mScene.initialize(t),this.initEvent()}initEvent(){const t=this.mScene;(new r.MouseInteraction).initialize(t.rscene,0,!1).setAutoRunning(!0)}run(){this.mScene.run()}}e.DataDrivenTest=a},"46a3":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("4ad2"),s=i("d463");class n{constructor(){this.mRscene=new r.RendererScene}initialize(){this.applyRTT(),this.initScene()}applyRTT(){let t=this.mRscene,e={uuid:"rtt0",rttTexture:{}},i=[{texture:e,clearValue:{r:.1,g:.9,b:.1,a:1},loadOp:"clear",storeOp:"store"}],r=t.createRTTPass({colorAttachments:i});const n={diffuse:{url:"static/assets/default.jpg",flipY:!0}};let a=[-.5,-.5,.8,.8],o=new s.FixScreenPlaneEntity({extent:a,textures:[n]}).setColor([1,0,0]);r.addEntity(o),a=[.3,.3,.6,.6];let l=new s.FixScreenPlaneEntity({extent:a,flipY:!0,textures:[{diffuse:e}]});t.addEntity(l)}initScene(){const t=this.mRscene,e={diffuse:{url:"static/assets/default.jpg",flipY:!0}};let i=[-.9,0,.5,.5],r=new s.FixScreenPlaneEntity({extent:i}).setColor([.2,.5,.7]);t.addEntity(r),i=[-.8,-.8,.8,.8],r=new s.FixScreenPlaneEntity({extent:i,textures:[e]}).setColor([.1,.3,.9]),t.addEntity(r)}run(){this.mRscene.run()}}e.RTTTest=n},4942:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("3e40")),n=r(i("7a70")),a=r(i("ec7b")),o=r(i("af80")),l=a.default.MATH_MIN_POSITIVE,u=a.default.MATH_MAX_NEGATIVE;class h{constructor(){this.mTempV=new o.default,this.mTempV1=new o.default,this.mFpns=[new o.default,new o.default,new o.default,new o.default,new o.default,new o.default],this.mFpds=[0,0,0,0,0,0],this.near=.1,this.far=5e3,this.aspect=1,this.fov=.25*Math.PI,this.perspective=!0,this.viewWidth=800,this.viewHeight=600,this.viewHalfWidth=400,this.viewHalfHeight=300,this.bounds=new s.default,this.nearHalfWidth=.5,this.nearHalfHeight=.5,this.nearWidth=1,this.nearHeight=1,this.worldDirec=new o.default,this.nearWorldCenter=new o.default,this.farWorldCenter=new o.default,this.vertices=[new o.default,new o.default,new o.default,new o.default,new o.default,new o.default,new o.default,new o.default],this.planes=[new n.default,new n.default,new n.default,new n.default,new n.default,new n.default]}setParam(t,e,i,r){this.fov=t,this.near=e,this.far=i,this.aspect=r}setViewSize(t,e){this.viewWidth=t,this.viewHeight=e,this.viewHalfWidth=.5*t,this.viewHalfHeight=.5*e}update(t){this.calcParam(t)}visiTestNearPlaneWithSphere(t,e){const i=this.mFpns,r=i[1].dot(t)-this.mFpds[1];return r-e>l?0:r+e<u?1:2}visiTestSphere2(t,e){const i=this.mFpns;let r=i[0].dot(t)-this.mFpds[0]-e>l;return!r&&(r=i[1].dot(t)-this.mFpds[1]-e>l,!r&&(r=i[2].dot(t)-this.mFpds[2]-e>l,!r&&(r=i[3].dot(t)-this.mFpds[3]-e>l,!r&&(r=i[4].dot(t)-this.mFpds[4]-e>l,!r&&(r=i[5].dot(t)-this.mFpds[5]-e>l,!r)))))}visiTestSphere3(t,e,i){const r=this.mFpns;let s=r[0].dot(t)-this.mFpds[0]+i-e>l;return!s&&(s=r[1].dot(t)-this.mFpds[1]-e>l,!s&&(s=r[2].dot(t)-this.mFpds[2]-e>l,!s&&(s=r[3].dot(t)-this.mFpds[3]-e>l,!s&&(s=r[4].dot(t)-this.mFpds[4]-e>l,!s&&(s=r[5].dot(t)-this.mFpds[5]-e>l,!s)))))}visiTestPosition(t){const e=this.mFpns;let i=e[0].dot(t)-this.mFpds[0]>l;return!i&&(i=e[1].dot(t)-this.mFpds[1]>l,!i&&(i=e[2].dot(t)-this.mFpds[2]>l,!i&&(i=e[3].dot(t)-this.mFpds[3]>l,!i&&(i=e[4].dot(t)-this.mFpds[4]>l,!i&&(i=e[5].dot(t)-this.mFpds[5]>l,!i)))))}visiTestPlane(t,e){const i=this.planes;let r=t.dot(i[0].position)-e,s=r*(t.dot(i[1].position)-e);return s<l||(s=r*(t.dot(i[2].position)-e),s<l||(s=r*(t.dot(i[3].position)-e),s<l||(s=r*(t.dot(i[4].position)-e),s<l||(s=r*(t.dot(i[5].position)-e),s<l))))}visiTestSphere(t,e){const i=this.planes;let r=this.bounds.sphereIntersect(t,e);if(r){let r=i[0].intersectSphere(t,e),s=i[1].intersectSphere(t,e);return!(r*s>=0&&!i[0].intersectBoo&&!i[1].intersectBoo)&&(r=i[2].intersectSphere(t,e),s=i[3].intersectSphere(t,e),!(r*s>=0&&!i[2].intersectBoo&&!i[3].intersectBoo)&&(r=i[4].intersectSphere(t,e),s=i[5].intersectSphere(t,e),!(r*s>=0&&!i[4].intersectBoo&&!i[5].intersectBoo)))}return!1}visiTestAABB(t){let e=t.center,i=t.radius,r=this.bounds.sphereIntersect(e,i);const s=this.planes;if(r){let t=s[0].intersectSphere(e,i),r=s[1].intersectSphere(e,i);return!(t*r>=0&&!s[0].intersectBoo&&!s[1].intersectBoo)&&(t=s[2].intersectSphere(e,i),r=s[3].intersectSphere(e,i),!(t*r>=0&&!s[2].intersectBoo&&!s[3].intersectBoo)&&(t=s[4].intersectSphere(e,i),r=s[5].intersectSphere(e,i),!(t*r>=0&&!s[4].intersectBoo&&!s[5].intersectBoo)))}return!1}calcParam(t){let e,i=this.viewHalfHeight,r=this.viewHalfWidth,s=i,n=r;if(this.perspective){const t=Math.tan(.5*this.fov);i=this.near*t,r=i*this.aspect,s=this.far*t,n=s*this.aspect}const a=this.vertices,l=this.planes;this.nearHalfWidth=r,this.nearHalfHeight=i,this.nearWidth=2*r,this.nearHeight=2*i,this.nearWorldCenter.setXYZ(0,0,-this.near),this.farWorldCenter.setXYZ(0,0,-this.far),t.transformVectorSelf(this.nearWorldCenter),t.transformVectorSelf(this.farWorldCenter);const u=this.worldDirec.subVecsTo(this.farWorldCenter,this.nearWorldCenter);u.normalize(),e=l[0],e.nv.copyFrom(u),e.distance=e.nv.dot(this.farWorldCenter),e.position.copyFrom(this.farWorldCenter),e=l[1],e.nv.copyFrom(l[0].nv),e.distance=e.nv.dot(this.nearWorldCenter),e.position.copyFrom(this.nearWorldCenter),a[0].setXYZ(-n,-s,-this.far),a[1].setXYZ(n,-s,-this.far),a[2].setXYZ(n,s,-this.far),a[3].setXYZ(-n,s,-this.far),a[4].setXYZ(-r,-i,-this.near),a[5].setXYZ(r,-i,-this.near),a[6].setXYZ(r,i,-this.near),a[7].setXYZ(-r,i,-this.near);const h=t;h.transformVectorSelf(a[0]),h.transformVectorSelf(a[1]),h.transformVectorSelf(a[2]),h.transformVectorSelf(a[3]),h.transformVectorSelf(a[4]),h.transformVectorSelf(a[5]),h.transformVectorSelf(a[6]),h.transformVectorSelf(a[7]),this.bounds.reset();for(let o=0;o<8;++o)this.bounds.addPosition(a[o]);this.bounds.updateFast();const c=o.default.Cross;this.mTempV.subVecsTo(a[0],a[4]);let d=a[1];this.mTempV1.subVecsTo(a[1],a[5]),e=l[3],c(this.mTempV1,this.mTempV,e.nv),e.nv.normalize(),e.distance=e.nv.dot(d),e.position.copyFrom(d),this.mTempV.subVecsTo(a[3],a[7]),d=a[2],this.mTempV1.subVecsTo(a[2],a[6]),e=l[2],c(this.mTempV1,this.mTempV,e.nv),e.nv.normalize(),e.distance=e.nv.dot(d),e.position.copyFrom(d),this.mTempV.subVecsTo(a[0],a[4]),d=a[3],this.mTempV1.subVecsTo(a[3],a[7]),e=l[4],c(this.mTempV,this.mTempV1,e.nv),e.nv.normalize(),e.distance=e.nv.dot(d),e.position.copyFrom(d),this.mTempV.subVecsTo(a[1],a[5]),d=a[2],this.mTempV1.subVecsTo(a[2],a[6]),e=l[5],c(this.mTempV,this.mTempV1,e.nv),e.nv.normalize(),e.distance=e.nv.dot(d),e.position.copyFrom(d);const m=this.mFpns;m[0].copyFrom(l[0].nv),m[1].copyFrom(l[1].nv),m[1].scaleBy(-1),m[2].copyFrom(l[2].nv),m[3].copyFrom(l[3].nv),m[3].scaleBy(-1),m[4].copyFrom(l[4].nv),m[4].scaleBy(-1),m[5].copyFrom(l[5].nv);const f=this.mFpds;f[0]=l[0].distance,f[1]=-l[1].distance,f[2]=l[2].distance,f[3]=-l[3].distance,f[4]=-l[4].distance,f[5]=l[5].distance}}e.Frustum=h},"4a64":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("af80"));class n{constructor(){this.position=new s.default,this.scale=new s.default(1,1,1),this.rotation=new s.default,this.rotationSpdv=new s.default(.1,1)}initialize(t=1e3){let e=.5*t;const i=this.position;i.setXYZ(Math.random()*t-e,Math.random()*t-e,Math.random()*t-e)}run(){const t=this.entity;if(t){const e=t.transform;e.setPosition(this.position),e.setScale(this.scale),e.setRotation(this.rotation),this.rotationSpdv&&this.rotation.addBy(this.rotationSpdv),t.update()}}}e.TransObject=n},"4ad2":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("68f4")),n=i("3963"),a=r(i("19e8")),o=i("f5fb"),l=i("cae9");class u{constructor(t=0){this.mUid=0,this.mInit=!0,this.mContainers=[],this.enabled=!0,this.mUid=t+u.sUid++}get renderer(){return this.mRenderer}get uid(){return this.mUid}initialize(t){if(this.mInit){this.mInit=!1;const e=new l.WGRenderer;t=o.checkConfig(t),t&&t.camera&&!1===t.camera.enabled||e.camera||(e.camera=new s.default),this.mStage=new a.default(this.uid,document),this.racontext=new n.RAdapterContext,this.racontext.initialize({stage:this.mStage,canvas:t.canvas,div:t.div}),e.initialize(t),this.mRenderer=e,this.camera=e.camera}}setPassNodeGraph(t,e=0){this.initialize(),this.mRenderer.setPassNodeGraph(t,e)}createRTTPass(t,e=0){return this.initialize(),t||(t={}),t.separate=!0,this.renderer.appendRenderPass(t,e)}createRenderPass(t,e=0){return this.initialize(),this.renderer.appendRenderPass(t,e)}getWGCtx(){return this.renderer.getWGCtx()}getStage3D(){return this.racontext.getStage()}getCamera(){return this.camera}enableMouseEvent(t=!0){}addContainer(t,e=0){if(!t.isContainer())throw Error("illegal operation !!!");if(this.initialize(),t.__$wuid<0&&t.__$contId<1){let i=0;for(;i<this.mContainers.length;++i)if(this.mContainers[i]==t)break;i>=this.mContainers.length&&(t.__$wuid=this.mUid,t.__$wprocuid=e,t.__$setRenderer(this),this.mContainers.push(t),t.update())}}addEntity(t,e=0){return t&&(this.initialize(),t.isContainer()?this.addContainer(t,e):this.mRenderer.addEntity(t,e)),this}removeEntity(t){t.isContainer()||this.mRenderer.removeEntity(t)}addEventListener(t,e,i=!0,r=!0){this.initialize();const s=this.racontext.getStage();s.addEventListener(t,e,i,r)}removeEventListener(t,e){const i=this.racontext.getStage();i.removeEventListener(t,e)}run(t=!0){const e=this.mRenderer;if(this.enabled&&e&&e.isEnabled()){this.camera.update();const i=this.racontext.getStage();i.enterFrame(),e.run(t)}}destroy(){}}u.sUid=0,e.RendererScene=u},"4c75":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> color: vec4f;\r\n@group(0) @binding(1) var sampler0: sampler;\r\n@group(0) @binding(2) var texture0: texture_2d<f32>;\r\n\r\n@fragment\r\nfn main(\r\n\t@location(0) uv: vec2f\r\n\t) -> @location(0) vec4f {\r\n\tvar color4 = vec4f(textureSample(texture0, sampler0, uv).xyz, 1.0) * color;\r\n    return color4;\r\n}\r\n"},"4ca8":function(t,e,i){"use strict";i.r(e),e["default"]="\r\n@group(0) @binding(0) var<uniform> objMat : mat4x4<f32>;\r\n@group(0) @binding(1) var<uniform> viewMat : mat4x4<f32>;\r\n@group(0) @binding(2) var<uniform> projMat : mat4x4<f32>;\r\n\r\nstruct VertexOutput {\r\n  @builtin(position) Position : vec4<f32>,\r\n  @location(0) fragPosition: vec4<f32>,\r\n}\r\nfn invertedColor( color : vec4<f32>) -> vec4<f32> {\r\n   return vec4( 1.0 - color.rgb, color.a );\r\n}\r\n@vertex\r\nfn main(\r\n  @location(0) position : vec3<f32>\r\n) -> VertexOutput {\r\n  var output : VertexOutput;\r\n  output.Position = projMat * viewMat * objMat * vec4(position.xyz, 1.0);\r\n  var pv: vec4<f32>;\r\n  pv = 0.5 * (vec4<f32>(normalize(position.xyz) * 2.0, 1.0) + vec4<f32>(1.0, 1.0, 1.0, 1.0));\r\n  output.fragPosition = pv;\r\n  return output;\r\n}\r\n"},"4ccd":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> color: vec4f;\r\n@group(0) @binding(1) var sampler0: sampler;\r\n@group(0) @binding(2) var texture0: texture_2d<f32>;\r\n\r\n@fragment\r\nfn main(\r\n\t@location(0) uv: vec2f\r\n\t) -> @location(0) vec4f {\r\n\tvar color4 = textureSample(texture0, sampler0, uv) * color;\r\n    return color4;\r\n}\r\n"},"4dc1":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("4ad2"),n=r(i("c69e")),a=i("213f"),o=r(i("f73a")),l=i("7650"),u=i("e44f"),h=i("19f9"),c=i("943f"),d=r(i("af80")),m=i("9849"),f=r(i("e58d")),p=256,v=8,g=`\n@group(0) @binding(0) var<uniform> grid: vec2f;\n\n@group(0) @binding(1) var<storage> cellStateIn: array<u32>;\n@group(0) @binding(2) var<storage, read_write> cellStateOut: array<u32>;\n@group(0) @binding(3) var<storage, read_write> lifeState: array<f32>;\n\nfn cellIndex(cell: vec2u) -> u32 {\n\treturn (cell.y % u32(grid.y)) * u32(grid.x) +\n\t\t   (cell.x % u32(grid.x));\n}\n\nfn cellActive(x: u32, y: u32) -> u32 {\n\treturn cellStateIn[cellIndex(vec2(x, y))];\n}\n\n@compute @workgroup_size(${v}, ${v})\nfn compMain(@builtin(global_invocation_id) cell: vec3u) {\n\t// Determine how many active neighbors this cell has.\n\tlet activeNeighbors = cellActive(cell.x+1, \t\tcell.y+1) +\n\t\t\t\t\t\t\tcellActive(cell.x+1, \tcell.y) +\n\t\t\t\t\t\t\tcellActive(cell.x+1, \tcell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x, \t\tcell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, \tcell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, \tcell.y) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, \tcell.y+1) +\n\t\t\t\t\t\t\tcellActive(cell.x, \t\tcell.y+1);\n\n\tlet i = cellIndex(cell.xy);\n\n\t// Conway's game of life rules:\n\tswitch activeNeighbors {\n\t\tcase 2: { // Active cells with 2 neighbors stay active.\n\t\t\tcellStateOut[i] = cellStateIn[i];\n\t\t\tif(cellStateOut[i] > 0) {\n\t\t\t\tlifeState[i] += 0.5;\n\t\t\t} else {\n\t\t\t\tlifeState[i] -= 0.5;\n\t\t\t}\n\t\t}\n\t\tcase 3: { // Cells with 3 neighbors become or stay active.\n\t\t\tcellStateOut[i] = 1;\n\t\t\tlifeState[i] += 0.5;\n\t\t}\n\t\tdefault: { // Cells with < 2 or > 3 neighbors become inactive.\n\t\t\tcellStateOut[i] = 0;\n\t\t\tlifeState[i] = 0.01;\n\t\t}\n\t}\n\tif(lifeState[i] < 0.01) { lifeState[i] = 0.01; }\n}`;class b{constructor(){this.mRscene=new s.RendererScene,this.mFlag=6,this.mouseDown=t=>{this.mFlag=1},this.mStep=0,this.mFrameDelay=3}initialize(){this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(n.default.MOUSE_DOWN,this.mouseDown),new f.default(this.mRscene,!0),(new a.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}createUniformValues(){const t=new Float32Array([p,p]),e=new Uint32Array(p*p);for(let l=0;l<e.length;l++)e[l]=Math.random()>.6?1:0;const i=new Uint32Array(p*p);for(let l=0;l<i.length;l++)i[l]=l%2;const r=new Float32Array(p*p);for(let l=0;l<r.length;l++)r[l]=.01;const s=new Float32Array(p*p*4);let n=new d.default(40,1,40),a=(new d.default).copyFrom(n);a.scaleBy(p),a.scaleBy(-.5);let o=0;for(let l=0;l<p;l++)for(let t=0;t<p;t++){let e=new d.default(t*n.x,0,l*n.z).addBy(a);s[o]=e.x,s[o+1]=e.y,s[o+2]=e.z,o+=4}let h=!0,c={data:e,shared:h},m={data:i,shared:h},f={data:r,shared:h},v={data:s,shared:h};const g=new l.WGRUniformValue({data:t,stride:2,shared:h,shdVarName:"v0"}).toVisibleAll(),b=new u.WGRStorageValue({bufData:c,stride:1,shared:h,shdVarName:"va1"}).toVisibleVertComp(),y=new u.WGRStorageValue({bufData:m,stride:1,shared:h,shdVarName:"vb1"}).toVisibleVertComp(),_=new u.WGRStorageValue({bufData:f,stride:1,shared:h,shdVarName:"vc1"}).toVisibleAll(),x=new u.WGRStorageValue({bufData:v,stride:3,shared:h,shdVarName:"v4"}).toVisibleVertComp(),w=new u.WGRStorageValue({bufData:c,stride:1,shared:h,shdVarName:"compva1"}).toVisibleVertComp(),S=new u.WGRStorageValue({bufData:m,stride:1,shared:h,shdVarName:"compva2"}).toVisibleComp();S.toBufferForStorage();const M=new u.WGRStorageValue({bufData:m,stride:1,shared:h,shdVarName:"compvb1"}).toVisibleVertComp(),P=new u.WGRStorageValue({bufData:c,stride:1,shared:h,shdVarName:"compvb2"}).toVisibleComp();P.toBufferForStorage();const T=new u.WGRStorageValue({bufData:f,stride:1,shared:h,shdVarName:"compv3"}).toVisibleComp();return T.toBufferForStorage(),[{ufvs0:[g,b,_,x],ufvs1:[g,y,_,x]},{ufvs0:[g,w,S,T],ufvs1:[g,M,P,T]}]}createMaterial(t,e,i,r){return new c.WGMaterial({shadinguuid:i,shaderSrc:t,instanceCount:r,uniformValues:e})}createCompMaterial(t,e,i,r=2){return new h.WGCompMaterial({shadinguuid:i,shaderSrc:t,uniformValues:e}).setWorkcounts(r,r)}initScene(){const t=this.mRscene,e=this.createUniformValues(),i=p*p,r=Math.ceil(p/v);let s={code:o.default,uuid:"shader-gameOfLife"},n={code:g,uuid:"shader-computing"};const a=[this.createMaterial(s,e[0].ufvs0,"rshd0",i),this.createMaterial(s,e[0].ufvs1,"rshd1",i),this.createCompMaterial(n,e[1].ufvs1,"compshd0",r),this.createCompMaterial(n,e[1].ufvs0,"compshd1",r)];let l=new m.SphereEntity({transufvShared:!0,radius:20,longitudeNumSegments:10,latitudeNumSegments:10,materials:a});t.addEntity(l),this.mEntity=l}run(){let t=this.mEntity.isRendering();const e=this.mEntity.materials;if(t){for(let t=0;t<e.length;t++)e[t].visible=(this.mStep%2+t)%2==0;this.mFrameDelay>0?(this.mFrameDelay--,t=!1):(this.mFrameDelay=3,this.mStep++)}t||(e[2].visible=!1,e[3].visible=!1),this.mRscene.run()}}e.GameOfLifeSphere=b},"4e74":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c6d1"));class n{static GetMatTotal(){return n.s_mtotal}static GetFS32Arr(){return n.s_mfs32Arr}static SetFS32Arr(t){n.s_mfs32Arr=t;let e=n.s_mtotal,i=n.s_matList;for(let r=0;r<e;++r)i[r].setF32Arr(t)}static GetFreeId(){return n.m_freeIdList.length>0?n.m_freeIdList.pop():-1}static Allocate(t){if(t<1024&&(t=1024),n.s_mtotal<1){n.s_mtotal=t,n.s_mfs32Arr=new Float32Array(16*t);let e=0,i=new s.default(n.s_mfs32Arr,16*e),r=i.getUid();for(n.s_baseUid=r,n.s_maxUid=r+t;e<r;++e)n.s_matList.push(null),n.s_matFlagList.push(n.s_FLAG_FREE);for(n.s_matList.push(i),n.s_matFlagList.push(n.s_FLAG_FREE),n.m_freeIdList.push(i.getUid()),e=1;e<t;++e)i=new s.default(n.s_mfs32Arr,16*e),n.s_matList.push(i),n.s_matFlagList.push(n.s_FLAG_FREE),n.m_freeIdList.push(i.getUid())}}static GetMatrix(){let t=null,e=n.GetFreeId()-n.s_baseUid;return e>=0?(t=n.s_matList[e],t.identity(),n.s_matFlagList[e]=n.s_FLAG_BUSY):t=new s.default,t}static RetrieveMatrix(t){if(null!=t){let e=t.getUid();e>=n.s_baseUid&&e<n.s_maxUid&&n.s_matFlagList[e-n.s_baseUid]==n.s_FLAG_BUSY&&(n.m_freeIdList.push(e),n.s_matFlagList[e-n.s_baseUid]=n.s_FLAG_FREE)}}}n.s_FLAG_BUSY=1,n.s_FLAG_FREE=0,n.s_matList=[],n.s_matFlagList=[],n.m_freeIdList=[],n.s_mfs32Arr=null,n.s_baseUid=0,n.s_maxUid=0,n.s_mtotal=0,e.default=n},5009:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("1eee"),n=r(i("a229"));class a extends s.PrimitiveEntity{constructor(t){super(t)}getGeometryData(t){return t||(t={}),void 0===t.minPos&&(t.minPos=[-50,-50,-50]),void 0===t.maxPos&&(t.maxPos=[50,50,50]),(new n.default).initialize(t.minPos,t.maxPos)}}e.BoxEntity=a},5118:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("1eee"),n=r(i("bd36"));class a extends s.PrimitiveEntity{constructor(t){super(t)}getGeometryData(t){t||(t={}),void 0===t.radius&&(t.radius=100),void 0===t.axisRadius&&(t.axisRadius=30),void 0===t.longitudeNumSegments&&(t.longitudeNumSegments=10),void 0===t.latitudeNumSegments&&(t.latitudeNumSegments=20),void 0===t.axisType&&(t.axisType=0);let e=new n.default;return e.axisType=t.axisType,e.initialize(t.radius,t.axisRadius,t.longitudeNumSegments,t.latitudeNumSegments),e}}e.TorusEntity=a},5150:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=i("4ad2"),a=i("213f"),o=r(i("2c77")),l=i("9849"),u=i("5009"),h=i("76e3"),c=i("0069"),d=i("5118"),m=i("7e70"),f=i("97f2"),p=i("603e");class v{constructor(){this.mRscene=new n.RendererScene,this.mouseDown=t=>{}}initialize(){this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(s.default.MOUSE_DOWN,this.mouseDown),(new a.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}initScene(){const t=this.mRscene;let e=new p.AxisEntity;t.addEntity(e);let i=[new l.SphereEntity,new u.BoxEntity,new h.CylinderEntity({alignYRatio:0}),new c.CubeEntity({cubeSize:130}),new d.TorusEntity({radius:110,axisType:1}),new m.PlaneEntity({axisType:1,extent:[-80,-80,160,160],doubleFace:!0}),new f.ConeEntity({alignYRatio:0})],r=i;i=[];for(let n=0,a=r.length;n<a;++n){const t=Math.round(888*Math.random())%r.length;i.push(r[t]),r.splice(t,1)}let s=300;for(let n=0;n<i.length;++n){let e=2*Math.PI*n/i.length,r=i[n].setAlbedo((new o.default).randomRGB(1.5,.1));r.arm=[1.1,.95*Math.random()+.05,.9*Math.random()+.1],r.transform.setPosition([s*Math.cos(e),0,s*Math.sin(e)]),t.addEntity(r)}s+=230;for(let n=0;n<i.length;++n){let e=2*Math.PI*n/i.length+.5,r=i[n].clone({geometry:i[n].geometry,doubleFace:!0,wireframe:!0});r.transform.setPosition([s*Math.cos(e),0,s*Math.sin(e)]),t.addEntity(r)}}run(){this.mRscene.run()}}e.WireframeEntityTest=v},5151:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){this.mBufMap=new Map}addWithUid(t,e){if(e){const i=this.mBufMap;i.has(t)||i.set(t,e)}}removeWithUid(t){const e=this.mBufMap;e.has(t)&&e.delete(t)}getWithUid(t){return this.mBufMap.get(t)}getBufWithUid(t){return this.mBufMap.has(t)?this.mBufMap.get(t).buffer:null}hasWithUid(t){const e=this.mBufMap;return e.has(t)}}class s{static getStore(t){const e=t.uid,i=s.sStores;return i[e]||(i[e]=new r),i[e]}}s.sStores=new Array(1024),e.WGHBufferStore=s},5326:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("4ca8")),a=r(i("1a9d")),o=i("943f"),l=i("746a"),u=i("551f"),h=i("cae9"),c=i("58c4");class d{constructor(){this.geomData=new s.GeomDataBuilder,this.renderer=new h.WGRenderer}initialize(){const t=this.createMaterial();this.createEntity([t])}createMaterial(){let t=["static/assets/hw_morning/morning_ft.jpg","static/assets/hw_morning/morning_bk.jpg","static/assets/hw_morning/morning_up.jpg","static/assets/hw_morning/morning_dn.jpg","static/assets/hw_morning/morning_rt.jpg","static/assets/hw_morning/morning_lf.jpg"],e=[new c.WGImageCubeTextureData(t)];const i={vert:{code:n.default,uuid:"vertShdCode"},frag:{code:a.default,uuid:"fragShdCode"}},r=e?e.length:0,s=new o.WGMaterial({shadinguuid:"base-material-tex"+r,shaderSrc:i}).addTextureWithDatas(e);return s}createEntity(t){const e=this.renderer,i=this.geomData.createCube(200),r=(new l.WGGeometry).addAttribute({position:i.vs}).setIndices(i.ivs),s=new u.Entity3D({materials:t,geometry:r});return e.addEntity(s),s}run(){this.renderer.run()}}e.ImgCubeMap=d},"541b":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("3e40"));class n{constructor(){this.mvs=null,this.muvs=null,this.mnvs=null,this.mivs=null,this.bounds=new s.default,this.vtxTotal=0,this.trisNumber=0,this.vtCount=0,this.axisType=0}clone(){let t=new n;return t.copyFrom(this),t}copyFrom(t){let e=new n;null!=t.mvs&&(null!=this.mvs?this.mvs.set(t.mvs):this.mvs=t.mvs.slice(0)),null!=t.muvs&&(null!=this.muvs?this.muvs.set(t.muvs):this.muvs=t.muvs.slice(0)),null!=t.mnvs&&(null!=this.mnvs?this.mnvs.set(t.mnvs):this.mnvs=t.mnvs.slice(0)),null!=t.mivs&&(null!=this.mivs?this.mivs.set(t.mivs):this.mivs=t.mivs.slice(0)),e.vtxTotal=this.vtxTotal,e.trisNumber=this.trisNumber,e.vtCount=this.vtCount,e.bounds.copyFrom(this.bounds)}getCenterAt(t,e){}transformAt(t,e){}getVSSegAt(t){return null}getVS(){return this.mvs}getUVS(){return this.muvs}getNVS(){return this.mnvs}getIVS(){return this.mivs}reset(){this.mvs=null,this.muvs=null,this.mnvs=null,this.mivs=null,this.vtxTotal=0,this.trisNumber=0,this.vtCount=0}}e.default=n},5469:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("0dcf")),a=r(i("90af")),o=i("943f"),l=i("746a"),u=i("551f"),h=i("e44f"),c=r(i("c69e")),d=i("4ad2"),m=i("213f"),f=r(i("2c77")),p=r(i("af80"));class v{constructor(){this.mRscene=new d.RendererScene,this.geomData=new s.GeomDataBuilder,this.mouseDown=t=>{}}initialize(){this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(c.default.MOUSE_DOWN,this.mouseDown),(new m.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}createMaterial(t,e,i){e=e||new f.default;let r={depthWriteEnabled:!0,blendModes:[]};const s=new o.WGMaterial({shadinguuid:"simple-pbr-materialx",shaderSrc:t,pipelineDefParam:r});let n=new h.WGRStorageValue({data:new Float32Array([e.r,e.g,e.b,1])}),a=new h.WGRStorageValue({data:new Float32Array([i[0],i[1],i[2],1])});return s.uniformValues=[n,a],s}createGeom(t,e=!1){const i=(new l.WGGeometry).addAttribute({position:t.vs}).addAttribute({uv:t.uvs}).setIndices(t.ivs);return e&&i.addAttribute({normal:t.nvs}),i}initScene(){const t=this.mRscene,e=this.createGeom(this.geomData.createSphere(50),!0),i={vert:{code:n.default,uuid:"vertShdCode"},frag:{code:a.default,uuid:"fragShdCode"}};let r=7;const s=new p.default(150,150,150),o=(new p.default).copyFrom(s).scaleBy(-.5*(r-1));for(let n=0;n<r;++n)for(let a=0;a<r;++a){let l=[1.5,n/r*.95+.05,a/r*.95+.05],h=this.createMaterial(i,new f.default(.5,0,0),l),c=new u.Entity3D({materials:[h],geometry:e});c.transform.setPosition((new p.default).setXYZ(n*s.x,a*s.y,s.z).addBy(o)),t.addEntity(c)}}run(){this.mRscene.run()}}e.SimplePBRTest=v},5476:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("b876"),s=i("852d");class n{constructor(){this.m_init=!0,this.m_sysIniting=!0,this.m_initInsFlag=!0,this.verTool=null,this.m_initCalls=[]}initialize(t=null,e=!1){if(this.m_init){this.m_init=!1,this.m_sysInitCallback=t,this.m_deferredInit=e;let i=[{url:"static/cospace/core/coapp/CoSpaceApp.umd.js",name:r.CoModuleNS.coSpaceApp,type:r.CoModuleFileType.JS},{url:"static/cospace/core/code/ThreadCore.umd.js",name:r.CoModuleNS.threadCore,type:r.CoModuleFileType.JS},{url:"static/cospace/modules/ctm/ModuleCTMGeomParser.umd.js",name:r.CoModuleNS.ctmParser,type:r.CoModuleFileType.JS},{url:"static/cospace/modules/obj/ModuleOBJGeomParser.umd.js",name:r.CoModuleNS.objParser,type:r.CoModuleFileType.JS},{url:"static/cospace/modules/png/ModulePNGParser.umd.js",name:r.CoModuleNS.pngParser,type:r.CoModuleFileType.JS},{url:"static/cospace/modules/fbxFast/ModuleFBXGeomFastParser.umd.js",name:r.CoModuleNS.fbxFastParser,type:r.CoModuleFileType.JS},{url:"static/cospace/modules/draco/ModuleDracoGeomParser.umd.js",name:r.CoModuleNS.dracoParser,type:r.CoModuleFileType.JS,params:["static/cospace/modules/dracoLib/"]}];this.m_modules=i;let n={nodes:[{uniqueName:"dracoGeomParser",path:"static/cospace/modules/draco/ModuleDracoGeomParser.umd.js"},{uniqueName:"dracoWasmWrapper",path:"static/cospace/modules/dracoLib/w2.js"},{uniqueName:"ctmGeomParser",path:"static/cospace/modules/ctm/ModuleCTMGeomParser.umd.js"}],maps:[{uniqueName:"dracoGeomParser",includes:[1]}]};this.m_dependencyGraphObj=n;let a=new s.CoModuleLoader(1,null,this.verTool);this.verTool&&(a.forceFiltering=this.verTool.forceFiltering);let o=a.getUrlChecker();if(o){for(let e=0;e<i.length;++e)i[e].url=o(i[e].url);let t=n.nodes;for(let e=0;e<t.length;++e)t[e].path=o(t[e].path)}e||this.loadSys()}}loadSys(){this.m_sysIniting&&(new s.CoModuleLoader(1,()=>{this.initCoSpaceSys()}).load(this.m_modules[0].url),this.m_sysIniting=!1)}getCPUDataByUrlAndCallback(t,e,i,r){if(null!=this.coappIns){let s=this.coappIns.getCPUDataByUrlAndCallback(t,e,i,r);if(this.m_deferredInit&&this.m_initInsFlag){this.m_initInsFlag=!1;let t=this.m_modules;this.coappIns.initialize(3,t[1].url,!0)}return s}return null}deferredInit(t){null==this.coappIns?(this.m_initCalls.push(t),this.loadSys()):null!=t&&t()}initCoSpaceSys(){if(null==this.coappIns&&"undefined"!==typeof CoSpaceApp){let t=CoSpaceApp.createInstance(),e=this.m_modules,i=JSON.stringify(this.m_dependencyGraphObj);t.setThreadDependencyGraphJsonString(i),t.setTaskModuleParams(e),this.m_deferredInit||t.initialize(3,e[1].url,!0);let r=this;r.coappIns=t;for(let s=0;s<this.m_initCalls.length;++s)null!=this.m_initCalls[s]&&this.m_initCalls[s]();this.m_initCalls=[]}null!=this.m_sysInitCallback&&this.m_sysInitCallback(),this.m_sysInitCallback=null}destroy(){}}e.CoDataModule=n,e.default=n},"551f":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("9711")),n=r(i("c433")),a=r(i("3e40")),o=i("222c"),l=r(i("af80")),u=i("793b");e.TransformParam=u.TransformParam,e.getUniformValueFromParam=u.getUniformValueFromParam,e.Entity3DParam=u.Entity3DParam;class h{constructor(t){this.mUid=h.sUid++,this.mTransVer=-1,this.__$rseFlag=s.default.DEFAULT,this.__$bids=[],this.cameraViewing=!0,this.rstate=new o.WGRUnitState,this.mouseEnabled=!1,t||(t={}),!1!==t.building&&this.init(t),this.mDescParam=t}init(t){this.cameraViewing=!1!==t.cameraViewing;let e,i=!t||void 0===t.transformEnabled||!0===t.transformEnabled;if(t&&(e=t.transform,i=i||void 0!==this.transform),i)if(e){const t=e;if(void 0!==t.byteLength&&(this.transform=n.default.Create({fs32:t})),!this.transform){const t=e;void 0!==t.identity&&(this.transform=n.default.Create({matrix:t}))}if(!this.transform){const t=e;void 0!==t.getMatrixFS32&&(this.transform=t)}if(!this.transform){const t=e;t.scale&&t.rotation&&t.position&&t.matrix||(this.transform=n.default.Create({transform:t}))}}else this.transform=n.default.Create();this.initBounds(i),t&&(!0===t.transufvShared&&(this.transform.uniformv.shared=!0),void 0!==t.materials&&(this.materials=t.materials),void 0!==t.geometry&&(this.geometry=t.geometry),this.update())}initBounds(t){this.mGBs=new a.default,this.mLBs=new a.default,this.mLBs.version=-137}__$testSpaceEnabled(){return s.default.TestSpaceEnabled2(this.__$rseFlag)}__$testContainerEnabled(){return s.default.TestContainerEnabled(this.__$rseFlag)}__$testRendererEnabled(){return s.default.TestRendererEnabled(this.__$rseFlag)}getRendererUid(){return s.default.GetRendererUid(this.__$rseFlag)}get uid(){return this.mUid}isREnabled(){const t=this.materials;if(!t)return!1;for(let i=0;i<t.length;++i)if(!t[i].isREnabled())return!1;let e=this.geometry;return!(!e||!e.isREnabled())}updateBounds(){const t=this.transform,e=this.mLBs;if(t&&e){const t=this.geometry;if(t){const i=t.bounds;if(e.version!=i.version){e.reset();const i=t.geometryData;let r=i.getIVS();const s=0,n=i.vtCount;e.addFloat32AndIndices(i.getVS(),r.subarray(s,s+n),i.getVSStride()),e.update(),this.update()}}}}updateLocalBoundsVS(t){let e=t.min,i=t.max;this.mLBoundsVS||(this.mLBoundsVS=new Float32Array(24));const r=this.mLBoundsVS;r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=i.x,r[4]=e.y,r[5]=e.z,r[6]=e.x,r[7]=e.y,r[8]=i.z,r[9]=i.x,r[10]=e.y,r[11]=i.z,r[12]=e.x,r[13]=i.y,r[14]=e.z,r[15]=i.x,r[16]=i.y,r[17]=e.z,r[18]=e.x,r[19]=i.y,r[20]=i.z,r[21]=i.x,r[22]=i.y,r[23]=i.z}updateGlobalBounds(){const t=this.transform,e=this.geometry.bounds,i=this.mLBs;if(t&&i&&e){const r=this.mGBs,s=h;if(t.isDirty()||this.mTransVer!=t.version||i.version!=e.version){this.mTransVer=t.version,i.version=e.version,t.update();const n=t.getMatrix();i.version==e.version&&this.mLBoundsVS||this.updateLocalBoundsVS(i);let a=this.mLBoundsVS,o=s.sBoundsOutVS;n.transformVectors(a,24,o),r.reset(),r.addFloat32Arr(o),r.update()}else{s.sPrePos.setXYZ(0,0,0),s.sPos.setXYZ(0,0,0);let e=t.getMatrix(!1);e.transformVector3Self(s.sPrePos),t.update(),e=t.getMatrix(!1),e.transformVector3Self(s.sPos),s.sPos.subtractBy(s.sPrePos),r.min.addBy(s.sPos),r.max.addBy(s.sPos),r.center.addBy(s.sPos),++r.version}}}update(){const t=this.geometry;if(t){const e=this.mLBs;e&&t.bounds&&e.version!=t.bounds.version&&e.copyFrom(t.bounds),this.updateGlobalBounds()}return this.transform&&this.transform.update(),this}destroy(){this.mDescParam&&(this.mDescParam=null)}isRenderFree(){return!this.rstate.__$inRenderer}isInRenderer(){return this.rstate.__$inRenderer}isRendering(){return this.rstate.__$rendering}get globalBounds(){return this.mGBs}get localBounds(){return this.mLBs}get globalBoundsVer(){return this.mGBs?this.mGBs.version:-1}localToGlobal(t){return this}globalToLocal(t){return null}getREType(){return 11}isContainer(){return!1}isFree(){return this.__$rseFlag==s.default.DEFAULT}set visible(t){this.rstate.visible=t}get visible(){return this.rstate.visible}setVisible(t){return this.rstate.visible=t,this}isVisible(){return this.rstate.visible}getTransform(){return this.transform}getInvMatrix(){return this.transform.getInvMatrix()}getMatrix(){return this.transform.getMatrix()}hasParent(){return!!this.mParent}__$getParent(){return this.mParent}__$setParent(t){this.mParent=t}testRay(t,e,i,r){return-1}hasGeometry(){return!!this.geometry}isPolyhedral(){return!0}}h.sUid=0,h.sBoundsOutVS=new Float32Array(24),h.sPos=new l.default,h.sPrePos=new l.default,e.Entity3D=h},"560a":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t,e=null,i=null){this.m_uid=r.s_uid++,this.m_urlChecker=null,this.m_oneTimes=!0,this.m_loaderMap=null,this.m_callback=e,this.m_times=t,this.m_urlChecker=i}setUrlChecker(t=null){return this.m_urlChecker=t,this}getUrlChecker(){return this.m_urlChecker}getUid(){return this.m_uid}setCallback(t){return this.m_callback=t,this}addLoader(t){if(null!=t&&t!=this)if(this.isFinished())t.use();else{null==this.m_loaderMap&&(this.m_loaderMap=new Map);let e=this.m_loaderMap;e.has(t.getUid())||e.set(t.getUid(),t)}return this}isFinished(){return 0==this.m_times}useOnce(){this.m_oneTimes&&(this.m_oneTimes=!1,this.use())}use(){if(this.m_times>0&&(this.m_times--,this.isFinished()&&null!=this.m_callback&&(this.m_callback(),this.m_callback=null,null!=this.m_loaderMap))){for(let[t,e]of this.m_loaderMap)e.use();this.m_loaderMap=null}}hasModuleByUrl(t){return r.loadedMap.has(t)}load(t){if(""==t)return this;null!=this.m_urlChecker&&(t=this.m_urlChecker(t));let e=r.loadedMap;if(e.has(t))return void this.use();let i=r.loadingMap;if(!i.has(t))return i.set(t,[this]),this.loadData(t),this;{let e=i.get(t);for(let t=0;t<e.length;++t)if(e[t]==this)return;e.push(this)}}loadData(t){let e=new XMLHttpRequest;e.open("GET",t,!0),e.onerror=function(t){},e.onload=e=>{this.loadedUrl(t)},e.send(null)}loadedData(t,e){}loadedUrl(t){let e=r.loadedMap,i=r.loadingMap;e.set(t,1);let s=i.get(t);for(let r=0;r<s.length;++r)s[r].use();i.delete(t)}getDataByUrl(t){return null}clearAllData(){}destroy(){this.m_urlChecker=null}}r.s_uid=0,r.loadedMap=new Map,r.loadingMap=new Map,e.PackedLoader=r},5648:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("222c");class s{}const n=new s,a=new r.WGRUnitState,o=new Uint16Array([1,1,0,0]);class l{constructor(){this.rf=!0,this.pst=a,this.st=a,this.__$rever=0,this.enabled=!0,this.workcounts=o}getRF(){return this.enabled&&this.st.isDrawable()}runBegin(){const t=this.rp.compPassEncoder,e=this.material;let i=this.enabled&&this.rp.enabled&&this.st.isDrawable();if(i=i&&e.visible,i){const e=this.pipelinectx.comppipeline;if(e){const r=n;r.rc!=t&&(r.pipeline=null,r.rc=t,r.unfsuuid=""),r.pipeline!=e&&(r.pipeline=e,t.setPipeline(e));const s=this.uniforms;if(s)for(let e=0,n=s.length;e<n;e++){const r=s[e];if(r.isEnabled()){t.setBindGroup(r.groupIndex,r.bindGroup);for(let t=0,e=r.uvfs.length;t<e;t++)r.setValue(r.uvfs[t],t)}else i=!1}}else i=!1}this.rf=i}run(){if(this.rf){const t=this.rp.compPassEncoder,e=this.workcounts;e[1]>0&&e[2]>0?t.dispatchWorkgroups(e[0],e[1],e[2]):e[1]>0?t.dispatchWorkgroups(e[0],e[1]):t.dispatchWorkgroups(e[0])}}destroy(){if(this.pipelinectx){const t=this.pipelinectx.uniformCtx;t.removeUniforms(this.uniforms),this.pipelinectx=null,this.material=null,this.rp=null,this.pst=null,this.st=null,this.workcounts=null}}}e.WGRCompUnit=l},"56f9":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("4ad2"),s=i("c4ad");class n{constructor(t=0){this.mBuilder=new s.DataDrivenEntityBuilder,this.mScene=new r.RendererScene(t)}get rscene(){return this.mScene}initialize(t){t||(t={});const e=t.renderer;this.mScene.initialize(e||{});const i=t.entities;if(i&&void 0!==i.length)for(let r=0;r<i.length;++r)this.addObject(i[r])}addObject(t,e){let i=this.mBuilder.createEntity(t);this.mScene.addEntity(i,e)}addEntity(t,e=0){return this.mScene.addEntity(t,e),this}removeEntity(t){this.mScene.removeEntity(t)}addEventListener(t,e,i=!0,r=!0){this.mScene.addEventListener(t,e,i,r)}removeEventListener(t,e){this.mScene.removeEventListener(t,e)}run(t=!0){this.mScene.run(t)}destroy(){}}e.DataDrivenRScene=n},"58c4":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("37b8");e.texDescriptorFilter=r.texDescriptorFilter,e.WGTextureDataDescriptor=r.WGTextureDataDescriptor;class s{constructor(){this.generateMipmaps=!0,this.flipY=!1,this.format="rgba8unorm",this.dimension="2d",this.viewDimension="2d"}setDescripter(t){return t.generateMipmaps&&(this.generateMipmaps=t.generateMipmaps),t.flipY&&(this.flipY=t.flipY),t.format&&(this.format=t.format),t.dimension&&(this.dimension=t.dimension),t.viewDimension&&(this.viewDimension=t.viewDimension),this.mDesc=t,this}build(t){return this.mTex}destroy(){}}e.WGTextureData=s;class n extends s{constructor(){super()}build(t){if(this.mImgs&&!this.mTex){switch(this.viewDimension){case"cube":this.mTex=t.texture.createTexCubeByImages(this.mImgs,this.generateMipmaps,this.flipY,this.format,this.mUrl),this.uid=this.mTex.uid,this.mDesc&&(this.mDesc.uid=this.mTex.uid);break;case"2d":this.mTex=t.texture.createTex2DByImage(this.mImgs[0],this.generateMipmaps,this.flipY,this.format,this.mUrl),this.uid=this.mTex.uid,this.mDesc&&(this.mDesc.uid=this.mTex.uid);break;default:break}this.mTex.url=this.mUrl}return this.mTex}}e.WGImageTextureData=n;class a extends s{constructor(){super()}setDescripter(t){return super.setDescripter(t),this.mTexData=t.rttTexture,this}build(t){const e=this.mTexData;return e&&!this.mTex&&e.texture&&(this.mTex=e.texture,this.uid=this.mTex.uid,this.mDesc&&(this.mDesc.uid=this.mTex.uid)),this.mTex}}e.WGRTTTextureData=a;class o extends s{constructor(){super()}setDescripter(t){return super.setDescripter(t),this.mTexData=t.dataTexture,this}build(t){const e=this.mDesc,i=this.mTexData;return i&&e&&(this.mTex||(i.texture?(this.mTex=i.texture,this.uid=this.mTex.uid,this.mDesc&&(this.mDesc.uid=this.mTex.uid)):i.data?(this.mTex=t.texture.createDataTexture([i.data],i.width,i.height,{format:e.format},e.generateMipmaps),this.uid=this.mTex.uid,this.mDesc&&(this.mDesc.uid=this.mTex.uid)):i.datas&&i.datas.length>0&&(this.mTex=t.texture.createDataTexture(i.datas,i.width,i.height,{format:e.format,viewDimension:this.viewDimension},e.generateMipmaps),this.uid=this.mTex.uid,this.mDesc&&(this.mDesc.uid=this.mTex.uid)))),this.mTex}}class l extends n{constructor(t){super(),t&&""!==t&&this.initByURL(t)}setImage(t){return this.mImgs=[t],this}setDescripter(t){if(super.setDescripter(t),"2d"!==this.dimension)throw Error("Illegal Operation !!!");return t.url?this.initByURL(t.url):t.urls&&this.initByURL(t.urls[0]),t.images?this.setImage(t.images[0]):t.image&&this.setImage(t.image),this}initByURL(t){return this.mUrl=t,fetch(t).then(t=>{try{t.blob().then(t=>{createImageBitmap(t).then(t=>{this.mImgs=[t]})})}catch(e){return null}}),this}}e.WGImage2DTextureData=l;class u extends n{constructor(t){super(),t&&t.length>=6&&""!==t[0]&&this.initCubeMapURLs(t)}setImages(t){return this.mImgs=t,this}setDescripter(t){if(super.setDescripter(t),"cube"!==this.viewDimension)throw Error("Illegal Operation !!!");return t.urls&&this.initCubeMapURLs(t.urls),t.images&&this.setImages(t.images),this}async createCubeMapImgsByUrls(t){const e=t.map(async t=>{const e=await fetch(t);return createImageBitmap(await e.blob())}),i=await Promise.all(e);return i}initCubeMapURLs(t){return this.viewDimension="cube",this.mUrl=t[0],this.createCubeMapImgsByUrls(t).then(t=>{this.mImgs=t}),this}}e.WGImageCubeTextureData=u;class h{constructor(){this.name="WGTexture",this.shdVarName="",this.generateMipmaps=!0,this.flipY=!0,this.dimension="2d",this.viewDimension="2d"}}e.WGTexture=h;class c{constructor(){this.name="WGTexture",this.shdVarName=""}}class d{constructor(t){this.bindGroupIndex=0;const e=t.texture;this.texture=new h;const i=this.texture;for(var r in e)i[r]=e[r];if(this.texture.data){let t=this.texture.data;t.generateMipmaps&&(i.generateMipmaps=t.generateMipmaps),t.flipY&&(i.flipY=t.flipY),t.dimension&&(i.dimension=t.dimension),t.viewDimension&&(i.viewDimension=t.viewDimension),t.format&&(i.format=t.format)}const s=t.sampler;if(s){this.sampler=new c;const t=this.sampler;for(var r in s)t[r]=s[r]}}destroy(){}}e.WGTextureWrapper=d;const m=new Map;function f(t){let e;const i=r.texDescriptorFilter(t);let s=i.viewDimension?i.viewDimension:"2d";const n=m;let h="";if(void 0!==i.url?h=i.url:void 0!==i.urls&&(h=i.urls[0]),""===h&&void 0!==i.uuid&&(h=i.uuid),""!==h&&n.has(h))return n.get(h);switch(s){case"2d":e=i.rttTexture?(new a).setDescripter(i):i.dataTexture?(new o).setDescripter(i):(new l).setDescripter(i);break;case"cube":e=i.dataTexture?(new o).setDescripter(i):(new u).setDescripter(i);break;default:throw Error("Illegal Operation !!!")}return e&&""!==h&&n.set(h,e),e}e.createDataWithDescriptor=f},"5b33":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("9e6d"),s=i("8895"),n=i("e943"),a=i("b2e4");e.DemoParam=a.DemoParam;class o{constructor(){this.mPrevBtn=new s.ButtonDivItem,this.mNextBtn=new s.ButtonDivItem,this.mTagGroup=new n.DemoTagGroup}initEvent(){window.onkeydown=t=>{switch(t.key){case"ArrowLeft":case"ArrowUp":case"PageUp":this.toPrevDemo();break;case"ArrowDown":case"ArrowRight":case"PageDown":this.toNextDemo();break;default:break}}}toPrevDemo(){this.mana.downIndex(),window.location.reload()}toNextDemo(){this.mana.upIndex(),window.location.reload()}initialize(t){this.initDemoNameBar(t);let e=this.initTagGroupDiv(t);this.initEvent(),this.mTagGroup.mana=this.mana,this.mTagGroup.initialize(e,t),document.body.style.background="#333333"}initDemoNameBar(t){let e=r.createDiv(0,513,512,37);document.body.appendChild(e),e.innerHTML=t.name+"("+(t.index+1)+"/"+t.demoNames.length+")";let i=e.style;i.textAlign="center",i.backgroundColor="#403b54",i.color="#eeeeee",i.fontSize="25px"}initRightInfoNameBar(t){let e=this.mPrevBtn,i=r.createDiv(513,513,255,37);document.body.appendChild(i),e.setDeselectColors([36026,38105,46324]),e.initialize(i,"Prev Demo","prevDemo"),e.setTextSize("25px"),e.setTextColor(16777215),e.setTextAlign("center"),e.onmouseup=()=>{this.toPrevDemo()},e=this.mNextBtn,i=r.createDiv(770,513,255,37),document.body.appendChild(i),e.setDeselectColors([36026,38105,46324]),e.initialize(i,"Next Demo","nextDemo"),e.setTextSize("25px"),e.setTextColor(16777215),e.setTextAlign("center"),e.onmouseup=()=>{this.toNextDemo()}}initTagGroupDiv(t){let e=r.createDiv(513,0,512,512);document.body.appendChild(e);let i=e.style;return i.backgroundColor="#272637",this.initRightInfoNameBar(t),e}}e.UISystem=o},"5bd3":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=i("4ad2"),a=i("213f"),o=i("d463"),l=r(i("32d5")),u=i("7650"),h=i("e44f"),c=i("dca8"),d=64,m=8,f=`\n@group(0) @binding(0) var<uniform> grid: vec2f;\n\n@group(0) @binding(1) var<storage> cellStateIn: array<u32>;\n@group(0) @binding(2) var<storage, read_write> cellStateOut: array<u32>;\n\nfn cellIndex(cell: vec2u) -> u32 {\n\treturn (cell.y % u32(grid.y)) * u32(grid.x) +\n\t\t   (cell.x % u32(grid.x));\n}\n\nfn cellActive(x: u32, y: u32) -> u32 {\n\treturn cellStateIn[cellIndex(vec2(x, y))];\n}\n\n@compute @workgroup_size(${m}, ${m})\nfn compMain(@builtin(global_invocation_id) cell: vec3u) {\n\t// Determine how many active neighbors this cell has.\n\tlet activeNeighbors = cellActive(cell.x+1, cell.y+1) +\n\t\t\t\t\t\t\tcellActive(cell.x+1, cell.y) +\n\t\t\t\t\t\t\tcellActive(cell.x+1, cell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x, cell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, cell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, cell.y) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, cell.y+1) +\n\t\t\t\t\t\t\tcellActive(cell.x, cell.y+1);\n\n\tlet i = cellIndex(cell.xy);\n\n\t// Conway's game of life rules:\n\tswitch activeNeighbors {\n\t\tcase 2: { // Active cells with 2 neighbors stay active.\n\t\t\tcellStateOut[i] = cellStateIn[i];\n\t\t}\n\t\tcase 3: { // Cells with 3 neighbors become or stay active.\n\t\t\tcellStateOut[i] = 1;\n\t\t}\n\t\tdefault: { // Cells with < 2 or > 3 neighbors become inactive.\n\t\t\tcellStateOut[i] = 0;\n\t\t}\n\t}\n}`;class p{constructor(){this.mRscene=new n.RendererScene,this.mFlag=6,this.mouseDown=t=>{this.mFlag=1},this.mNodes=[],this.mStep=0,this.mFrameDelay=3}initialize(){this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(s.default.MOUSE_DOWN,this.mouseDown),(new a.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}createUniformValues(){const t=new Float32Array([d,d]),e=new Uint32Array(d*d);for(let u=0;u<e.length;u++)e[u]=Math.random()>.6?1:0;const i=new Uint32Array(d*d);for(let u=0;u<i.length;u++)i[u]=u%2;let r=!0,s={data:e},n={data:i};const a=new u.WGRUniformValue({data:t,stride:2,shared:r});a.toVisibleAll();const o=new h.WGRStorageValue({bufData:s,stride:1,shared:r}).toVisibleVertComp(),l=new h.WGRStorageValue({bufData:n,stride:1,shared:r}).toVisibleVertComp(),c=new h.WGRStorageValue({bufData:s,stride:1,shared:r}).toVisibleVertComp(),m=new h.WGRStorageValue({bufData:n,stride:1,shared:r}).toVisibleComp();m.toBufferForStorage();const f=new h.WGRStorageValue({bufData:n,stride:1,shared:r}).toVisibleVertComp(),p=new h.WGRStorageValue({bufData:s,stride:1,shared:r}).toVisibleComp();p.toBufferForStorage();let v=[{ufvs0:[a,o],ufvs1:[a,l]},{ufvs0:[a,c,m],ufvs1:[a,f,p]}];return v}initScene(){const t=this.mRscene;let e=this.createUniformValues(),i={code:l.default,uuid:"shader-gameOfLife"},r=d*d,s=e[0].ufvs0,n=new o.FixScreenPlaneEntity({x:-.8,y:-.8,width:1.6,height:1.6,shadinguuid:"rshd0",shaderSrc:i,uniformValues:s,instanceCount:r});t.addEntity(n),this.mNodes=[{rendEntity:n,compEntity:null}],n.visible=!1;const a=this.mNodes[0].rendEntity.geometry;s=e[0].ufvs1,n=new o.FixScreenPlaneEntity({shadinguuid:"rshd1",shaderSrc:i,uniformValues:s,instanceCount:r,geometry:a}),t.addEntity(n),this.mNodes.push({rendEntity:n,compEntity:null}),i={code:f,uuid:"shader-computing"};const u=Math.ceil(d/m);s=e[1].ufvs1;let h=new c.ComputeEntity({shadinguuid:"compshd0",shaderSrc:i,uniformValues:s}).setWorkcounts(u,u);t.addEntity(h),h.visible=!1,this.mNodes[0].compEntity=h,s=e[1].ufvs0,h=new c.ComputeEntity({shadinguuid:"compshd1",shaderSrc:i,uniformValues:s}).setWorkcounts(u,u),t.addEntity(h),this.mNodes[1].compEntity=h}run(){let t=this.mNodes[0].compEntity.isRendering();if(t){if(this.mFrameDelay>0)return void this.mFrameDelay--;this.mFrameDelay=3;const t=this.mNodes;for(let e=0;e<t.length;e++){const i=t[e],r=(this.mStep%2+e)%2==0;i.rendEntity.visible=r,i.compEntity.visible=r}this.mStep++}this.mRscene.run(t)}run2(){if(this.mRscene.renderer.isEnabled()){if(this.mFrameDelay>0)return void this.mFrameDelay--;this.mFrameDelay=3;const t=this.mNodes;for(let i=0;i<t.length;i++){const e=t[i];e.rendEntity.visible=!1,e.compEntity.visible=!1}let e=this.mStep%2;t[e].rendEntity.visible=!0,t[e].compEntity.visible=!0,this.mStep++,this.mRscene.run()}}}e.GameOfLifeTest=p},"5dcd":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> param: vec4f;\r\n@group(0) @binding(1) var sampler0: sampler;\r\n@group(0) @binding(2) var texture0: texture_2d<f32>;\r\n\r\nconst weight = array<f32, 5>(0.227027, 0.1945946, 0.1216216, 0.054054, 0.016216);\r\nfn calcBlurColor(uv: vec2f) -> vec4f {\r\n    var dv = vec2f(0.0, param.z) / param.xy;\r\n    let dy = dv.y;\r\n\r\n    var result = textureSample(texture0, sampler0, uv) * weight[0];\r\n\tfor (var i: i32 = 1; i < 5; i++)  {\r\n        dv.y = dy * f32(i);\r\n        result += textureSample(texture0, sampler0, uv + dv) * weight[i];\r\n        result += textureSample(texture0, sampler0, uv - dv) * weight[i];\r\n    }\r\n    return result;\r\n}\r\n\r\n@fragment\r\nfn main(\r\n\t@location(0) uv: vec2f\r\n\t) -> @location(0) vec4f {\r\n\tvar color4 = calcBlurColor( uv );\r\n    return color4;\r\n}\r\n"},"5df3":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("af80"));class n{constructor(){this.m_stage3D=null,this.m_camera=null,this.m_mouseX=0,this.m_mouseY=0,this.m_enabled=!1,this.m_rotationSpeed=0,this.m_aotuRotationDelay=100,this.autoRotationEnabled=!1,this.autoRotationSpeed=.2,this.rotationAttenuationEnabled=!1,this.rotationSpeed=.2}initialize(t,e){null==this.m_stage3D&&(this.m_stage3D=t,this.m_camera=e)}attach(){this.m_mouseX=this.m_stage3D.mouseX,this.m_mouseY=this.m_stage3D.mouseY,this.m_enabled=!0,this.m_aotuRotationDelay=100}detach(){this.m_enabled=!1}runWithYAxis(){this.runWithAxis(s.default.Y_AXIS)}runWithZAxis(){this.runWithAxis(s.default.Z_AXIS)}run(t,e){if(this.m_enabled){let i=this.m_mouseX-this.m_stage3D.mouseX,r=this.m_mouseY-this.m_stage3D.mouseY,s=Math.abs(i),n=Math.abs(r);s>n?s>.5&&(e<1?this.m_camera.swingHorizontalWithAxis(.2*i,t):this.m_camera.swingHorizontal(.2*i)):n>.5&&this.m_camera.swingVertical(-.2*r),this.m_mouseX=this.m_stage3D.mouseX,this.m_mouseY=this.m_stage3D.mouseY}else this.autoRotationEnabled&&(this.m_aotuRotationDelay<0?e<1?this.m_camera.swingHorizontalWithAxis(this.autoRotationSpeed,t):this.m_camera.swingHorizontal(this.autoRotationSpeed):this.m_aotuRotationDelay--)}runWithAxis(t){this.run(t,0)}runWithCameraAxis(){this.run(null,1)}}e.CamDragSwinger=n},"5fd4":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("4ad2"),n=i("d463"),a=r(i("7917")),o=i("7650"),l=i("e44f"),u=i("19f9"),h=i("943f"),c=64,d=8,m=`\n@group(0) @binding(0) var<uniform> grid: vec2f;\n\n@group(0) @binding(1) var<storage> cellStateIn: array<u32>;\n@group(0) @binding(2) var<storage, read_write> cellStateOut: array<u32>;\n@group(0) @binding(3) var<storage, read_write> lifeState: array<f32>;\n\nfn cellIndex(cell: vec2u) -> u32 {\n\treturn (cell.y % u32(grid.y)) * u32(grid.x) +\n\t\t   (cell.x % u32(grid.x));\n}\n\nfn cellActive(x: u32, y: u32) -> u32 {\n\treturn cellStateIn[cellIndex(vec2(x, y))];\n}\n\n@compute @workgroup_size(${d}, ${d})\nfn compMain(@builtin(global_invocation_id) cell: vec3u) {\n\t// Determine how many active neighbors this cell has.\n\tlet activeNeighbors = cellActive(cell.x+1, \t\tcell.y+1) +\n\t\t\t\t\t\t\tcellActive(cell.x+1, \tcell.y) +\n\t\t\t\t\t\t\tcellActive(cell.x+1, \tcell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x, \t\tcell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, \tcell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, \tcell.y) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, \tcell.y+1) +\n\t\t\t\t\t\t\tcellActive(cell.x, \t\tcell.y+1);\n\n\tlet i = cellIndex(cell.xy);\n\n\t// Conway's game of life rules:\n\tswitch activeNeighbors {\n\t\tcase 2: { // Active cells with 2 neighbors stay active.\n\t\t\tcellStateOut[i] = cellStateIn[i];\n\t\t\tif(cellStateOut[i] > 0) {\n\t\t\t\tlifeState[i] += 0.5;\n\t\t\t} else {\n\t\t\t\tlifeState[i] -= 0.5;\n\t\t\t}\n\t\t}\n\t\tcase 3: { // Cells with 3 neighbors become or stay active.\n\t\t\tcellStateOut[i] = 1;\n\t\t\tlifeState[i] += 0.5;\n\t\t}\n\t\tdefault: { // Cells with < 2 or > 3 neighbors become inactive.\n\t\t\tcellStateOut[i] = 0;\n\t\t\tlifeState[i] = 0.01;\n\t\t}\n\t}\n\tif(lifeState[i] < 0.01) { lifeState[i] = 0.01; }\n}`;class f{constructor(){this.mRscene=new s.RendererScene,this.mStep=0,this.mFrameDelay=3}initialize(){this.initScene()}createUniformValues(){const t=new Float32Array([c,c]),e=new Uint32Array(c*c);for(let o=0;o<e.length;o++)e[o]=Math.random()>.8?1:0;const i=new Uint32Array(c*c);for(let o=0;o<i.length;o++)i[o]=o%2;const r=new Float32Array(c*c);for(let o=0;o<r.length;o++)r[o]=.01;let s=!0,n={data:e,shared:s},a={data:i,shared:s},u={data:r,shared:s};const h=new o.WGRUniformValue({data:t,stride:2,shared:s});h.toVisibleAll();const d=new l.WGRStorageValue({bufData:n,stride:1,shared:s}).toVisibleVertComp(),m=new l.WGRStorageValue({bufData:a,stride:1,shared:s}).toVisibleVertComp(),f=new l.WGRStorageValue({bufData:u,stride:1,shared:s}).toVisibleAll(),p=new l.WGRStorageValue({bufData:n,stride:1,shared:s}).toVisibleVertComp(),v=new l.WGRStorageValue({bufData:a,stride:1,shared:s}).toVisibleComp();v.toBufferForStorage();const g=new l.WGRStorageValue({bufData:a,stride:1,shared:s}).toVisibleVertComp(),b=new l.WGRStorageValue({bufData:n,stride:1,shared:s}).toVisibleComp();b.toBufferForStorage();const y=new l.WGRStorageValue({bufData:u,stride:1,shared:s}).toVisibleComp();return y.toBufferForStorage(),[{ufvs0:[h,d,f],ufvs1:[h,m,f]},{ufvs0:[h,p,v,y],ufvs1:[h,g,b,y]}]}createMaterial(t,e,i,r){return new h.WGMaterial({shadinguuid:i,shaderSrc:t,instanceCount:r,uniformValues:e})}createCompMaterial(t,e,i,r=2){return new u.WGCompMaterial({shadinguuid:i,shaderSrc:t,uniformValues:e}).setWorkcounts(r,r)}initScene(){const t=this.mRscene,e=this.createUniformValues(),i=c*c,r=Math.ceil(c/d);let s={code:a.default,uuid:"shader-gameOfLife"},o={code:m,uuid:"shader-computing"};const l=[this.createMaterial(s,e[0].ufvs0,"rshd0",i),this.createMaterial(s,e[0].ufvs1,"rshd1",i),this.createCompMaterial(o,e[1].ufvs1,"compshd0",r),this.createCompMaterial(o,e[1].ufvs0,"compshd1",r)];let u=new n.FixScreenPlaneEntity({extent:[-.8,-.8,1.6,1.6],materials:l});t.addEntity(u),this.mEntity=u}run(){let t=this.mEntity.isRendering();if(t){if(this.mFrameDelay>0)return void this.mFrameDelay--;this.mFrameDelay=3;const t=this.mEntity.materials;for(let e=0;e<t.length;e++)t[e].visible=(this.mStep%2+e)%2==0;this.mStep++}this.mRscene.run(t)}}e.GameOfLifePretty=f},"601e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("943f"),s=i("746a"),n=i("f22d"),a=i("cae9"),o="\nstruct VSOut {\n    @builtin(position) Position: vec4f,\n    @location(0) color: vec3f,\n};\n\n@vertex\nfn main(@location(0) inPos: vec3f,\n        @location(1) inColor: vec3f) -> VSOut {\n    var vsOut: VSOut;\n    vsOut.Position = vec4(inPos, 1.0);\n    vsOut.color = inColor;\n    return vsOut;\n}\n",l="\n@fragment\nfn main(@location(0) inColor: vec3f) -> @location(0) vec4f {\n    return vec4f(inColor, 1.0);\n}\n",u=new Float32Array([-1,-1,0,1,-1,0,0,1,0]),h=new Float32Array([1,0,0,0,1,0,0,0,1]);class c{constructor(){this.renderer=new a.WGRenderer}initialize(){const t=this.renderer;t.initialize({camera:{enabled:!1}});const e={vert:{code:o},frag:{code:l}},i=[new r.WGMaterial({shadinguuid:"shapeMaterial",shaderSrc:e})],a=(new s.WGGeometry).addAttributes([{position:u},{color:h}]);t.addEntity(new n.FixScreenEntity({geometry:a,materials:i}))}run(){this.renderer.run()}}e.VertColorTriangle=c},"603e":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("2c77")),n=r(i("af80")),a=i("648f");function o(t){let e=void 0!==t.axisLength?t.axisLength:200,i=t.xAxisLength,r=t.yAxisLength,s=t.zAxisLength;i=void 0!==i?i:e,r=void 0!==r?r:e,s=void 0!==s?s:e;let a=new n.default,o=new n.default(i),l=new n.default(0,r),u=new n.default(0,0,s),h=[a,o,a,l,a,u];t.linePositions=h}function l(t){let e=new s.default(1,0,0),i=t.xAxisColor?e.toWhite().setColor(t.xAxisColor):e;e=new s.default(0,1,0);let r=t.yAxisColor?e.toWhite().setColor(t.yAxisColor):e;e=new s.default(0,0,1);let n=t.zAxisColor?e.toWhite().setColor(t.zAxisColor):e,a=[i,i,r,r,n,n];t.lineColors=a}class u extends a.Line3DEntity{constructor(t){t||(t={}),t.dashedData=!0,t.linePositions||o(t),t.lineColors||l(t),super(t)}}e.AxisEntity=u},6065:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("f3f6")),a=r(i("d0b3")),o=i("943f"),l=i("746a"),u=i("551f"),h=i("cae9"),c=i("58c4");class d{constructor(){this.geomData=new s.GeomDataBuilder,this.renderer=new h.WGRenderer}initialize(){const t={vert:{code:n.default,uuid:"vertShdCode"},frag:{code:a.default,uuid:"fragShdCode"}},e=[new c.WGImage2DTextureData("static/assets/box.jpg"),new c.WGImage2DTextureData("static/assets/default.jpg")],i=this.createMaterial(t,e);this.createEntity([i])}createMaterial(t,e){const i=e?e.length:0,r=new o.WGMaterial({shadinguuid:"base-material-tex"+i,shaderSrc:t});return r.addTextureWithDatas(e),r}createEntity(t){const e=this.renderer,i=this.geomData.createCube(200),r=(new l.WGGeometry).addAttribute({position:i.vs}).addAttribute({uv:i.uvs}).setIndices(i.ivs),s=new u.Entity3D({geometry:r,materials:t});return e.addEntity(s),s}run(){this.renderer.run()}}e.MultiTexturedCube=d},"611e":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> color: vec4f;\r\n@fragment\r\nfn main(\r\n\t@location(0) uv: vec2f\r\n\t) -> @location(0) vec4f {\r\n    return vec4f(color.xyz, color.w);\r\n}\r\n"},6130:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("0884");e.WGWaitEntityNode=r.WGWaitEntityNode;class s{constructor(){this.mNodes=[],this.mEnabled=!1}receiveNode(t){t.block.addEntityToBlock(t.entity,t.node),t.entity=null,t.node=null,t.builder=null,t.block=null}addEntity(t){this.mNodes.push(t)}update(){if(this.mEnabled){const t=this.mNodes;for(let e=0;e<t.length;++e){const i=t[e],r=i.entity;if(i.rever==i.node.rstate.__$rever){if(!r.isREnabled()){const t=r.materials;if(t)for(let e=0;e<t.length;++e)this.updateMaterial(t[e]);if(!1!==i.syncSort)break}r.isREnabled()&&(t.splice(e,1),--e,this.receiveNode(i))}else t.splice(e,1),--e}}}updateMaterial(t){if(!t.isREnabled()){const e=this.wgctx,i=t.textures;for(let t=0;t<i.length;++t){const r=i[t];r.texture&&r.texture.data&&!r.texture.texture&&(r.texture.texture=r.texture.data.build(e))}}}updateToTarget(){this.mEnabled=!0}}e.WGEntityNodeMana=s},"626c":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{static pushThreeBitValueToInt(t,e){return(t<<3)+e}static popThreeBitValueFromInt(t){return r.value=7&t,t>>3}static containsBit(t,e){return(e&t)>0}static removeBit(t,e){return~e&t}static addBit(t,e){return e|t}static assembleFromIntArray(t){let e=0,i=t.length;for(let r=0;r<i;++r)t[r]>0&&(e|=1<<r);return e}}r.ZERO=0,r.ONE_0=1,r.ONE_1=2,r.ONE_2=4,r.ONE_3=8,r.ONE_4=16,r.ONE_5=32,r.ONE_6=64,r.ONE_7=128,r.ONE_8=256,r.ONE_9=512,r.ONE_10=1024,r.ONE_11=2048,r.value=0,e.default=r},"63d8":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("b720"),s=i("842f"),n=i("5648"),a=i("bf93"),o=i("af1b");class l{constructor(){}createPrimitive(t){const e=new r.WGRPrimitive;return e.ibuf=t.indexBuffer,e.vbufs=t.vertexBuffers,void 0!==t.indexCount&&(e.indexCount=t.indexCount),void 0!==t.vertexCount&&(e.vertexCount=t.vertexCount),void 0!==t.drawMode&&(e.drawMode=t.drawMode),e}testShaderSrc(t){if(t){if(void 0!==t.code&&!t.shaderSrc){const e={code:t.code,uuid:t.uuid};""!=a.findShaderEntryPoint("@compute",t.code)?t.compShaderSrc=t.compShaderSrc?t.compShaderSrc:e:t.shaderSrc=t.shaderSrc?t.shaderSrc:e}t.vert&&(t.vertShaderSrc=t.vert),t.frag&&(t.fragShaderSrc=t.frag),t.comp&&(t.compShaderSrc=t.comp)}}checkMaterial(t,e){if(!t.shaderSrc.compShaderSrc){const i=t.pipelineVtxParam;if(e&&i){const t=i.vertex;t.buffers=e.vbufs,t.drawMode=e.drawMode}const r=t.pipelineDefParam;void 0!==t.doubleFace&&(r.faceCullMode=!0===t.doubleFace?"none":r.faceCullMode)}}createRPass(t,e,i,r=0,a=0){const l=t.materials[r];let u,h=l.getRCtx();if(i){const t=e.getWGCtx(),r=i.primitive,s=i.gpuvbufs,n=s[0].vectorCount,a=i.indexBuffer;if(!0===l.wireframe){if(u=r.wireframe,!u){a.toWirframe();const e=a?a.gpuwibuf?a.gpuwibuf:t.buffer.createIndexBuffer(a.wireframeData):null;e&&(a.gpuwibuf=e);const i=e?e.elementCount:0;u=this.createPrimitive({vertexBuffers:s,indexBuffer:e,indexCount:i,vertexCount:n,drawMode:o.WGRDrawMode.LINES}),r.wireframe=u}}else if(u=r.default,!u){const e=a?a.gpuibuf?a.gpuibuf:t.buffer.createIndexBuffer(a.data):null;e&&(a.gpuibuf=e);const o=e?e.elementCount:0;u=this.createPrimitive({vertexBuffers:s,indexBuffer:e,indexCount:o,vertexCount:n,drawMode:i.drawMode}),r.default=u}}if(!e.hasMaterial(l)){if(!h&&(this.testShaderSrc(l.shaderSrc),!l.pipelineVtxParam&&u)){l.pipelineVtxParam={vertex:{attributeIndicesArray:[]}};const t=[];for(let e=0;e<u.vbufs.length;++e)t.push([0]);l.pipelineVtxParam.vertex.attributeIndicesArray=t}this.checkMaterial(l,u);const t=e.getPassNodeWithMaterial(l);h=t.createRenderPipelineCtxWithMaterial(l),l.initialize(h)}const c=l.shaderSrc.compShaderSrc;let d;if(c){let e=t,i=new n.WGRCompUnit,r=l;e.workcounts&&(i.workcounts=e.workcounts),r&&r.workcounts&&(i.workcounts=r.workcounts),i.workcounts||(i.workcounts=new Uint16Array([1,1,0,0])),i.rp=h.rpass,d=i}else{let t=new s.WGRUnit;t.geometry=u,t.rp=h.rpass,d=t}d.pipelinectx=h;const m=h.uniformCtx;let f=[];const p=e.camera;c||(t.transform&&f.push(t.transform.uniformv),t.cameraViewing&&(f.push(p.viewUniformV),f.push(p.projUniformV))),l.uniformValues&&(f=f.concat(l.uniformValues));let v,g=0,b=l.textures;if(!c&&b&&b.length>0){v=new Array(b.length);for(let t=0;t<b.length;t++){const e=b[t].texture;let i=b[t].texture.viewDimension;e.view||(e.view=e.texture.createView({dimension:i})),e.view.dimension=i,v[t]={texView:e.view}}}return(f&&f.length>0||v&&v.length>0)&&(d.uniforms=m.createUniformsWithValues([{layoutName:l.shadinguuid,groupIndex:g,values:f,texParams:v}],l.uniformAppend)),d.material=l,d.etuuid=t.uuid+"-[block("+a+"), material("+l.shadinguuid+")]",d}createRUnit(t,e,i,r=0){const n=e.getWGCtx(),a=t.geometry;let o,l;if(t.geometry&&(o=a.primitive,!o)){const t=a.attributes,e=a.gpuvbufs,i=e||new Array(t.length);if(!e){for(let e=0;e<t.length;++e){const r=t[e];i[e]=n.buffer.createVertexBuffer(r.data,r.bufferOffset,r.strides)}a.gpuvbufs=i}o={},a.primitive=o}const u=t.materials;if(u.length>1){const i=new Array(u.length);for(let s=0;s<u.length;++s)i[s]=this.createRPass(t,e,a,s,r);l=new s.WGRUnit,l.passes=i}else l=this.createRPass(t,e,a);return l.bounds=t.globalBounds,l.st=t.rstate,l.st.__$rendering=!0,l.pst=i.rstate,l.__$rever=l.pst.__$rever,l}}e.WGRObjBuilder=l},"648f":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("746a"),n=r(i("3e26")),a=r(i("2c77")),o=i("943f"),l=r(i("af80")),u=i("7650"),h=i("551f"),c=r(i("a7ea")),d=r(i("9fa7")),m=r(i("964e")),f=r(i("07b0"));class p extends h.Entity3D{constructor(t){super(t),this.mHaveCVS=!1,this.mColor=new a.default,t||(t={}),!1!==t.building&&(this.createGeometry(t),this.createMaterial(t)),this.mDescParam=t,t.lineColor&&(this.color=t.lineColor)}clone(t){t?t.geometry||(t.geometry=this.geometry):(t=this.mDescParam,t.materials=this.materials,t.geometry=this.geometry);let e=new p(t);return e.color=this.color,e}setColor(t){return t&&this.mColorV&&(this.mColor.setColor(t).toArray4(this.mColorV.data),this.mColorV.version++),this}set color(t){this.setColor(t)}get color(){return this.mColor}getGeometryData(t){void 0===t.linePositions&&(t.linePositions=[new l.default,new l.default(100)]);let e=new n.default;return e.dashedData=!0===t.dashedData,e.initialize(t.linePositions,t.lineColors),e}createGeometry(t){if(t&&t.geometry)this.geometry=t.geometry;else{const e=this.getGeometryData(t);if(e){const t=(new s.WGGeometry).addAttribute({position:e.getVS()});e.getCVS()&&(this.mHaveCVS=!0,t.addAttribute({color:e.getCVS()})),t.drawMode=e.drawMode,t.bounds=e.bounds,t.geometryData=e,this.geometry=t}}}createMaterial(t){if(t.materials)this.materials=t.materials;else{t.uniformValues||(this.mColorV=h.getUniformValueFromParam("color",t,new u.WGRUniformValue({data:new Float32Array([1,1,1,1]),shdVarName:"color"})));const e=this.mHaveCVS;let i=e?"color-":"";const r=t.shaderSrc?t.shaderSrc:{vertShaderSrc:{code:this.mHaveCVS?d.default:c.default,uuid:i+"line3DEntityVertShdCode"},fragShaderSrc:{code:this.mHaveCVS?f.default:m.default,uuid:i+"line3DEntityFragShdCode"}};let s=t.depthWriteEnabled;s=!1!==s;let n=t.faceCullMode;n=n||"back";let a=t.blendModes;a=a||["solid"];let l={depthWriteEnabled:s,faceCullMode:n,blendModes:a},p=void 0!==t.shadinguuid?t.shadinguuid:i+"line3DEntity-material";const v=new o.WGMaterial({shadinguuid:p,shaderSrc:r,pipelineDefParam:l});void 0!==t.instanceCount&&(v.instanceCount=t.instanceCount),v.uniformValues=t.uniformValues?t.uniformValues:[this.mColorV],v.uniformValues&&v.uniformValues.length>0&&(this.mColorV=v.uniformValues[0]),this.materials=[v]}o.checkMaterialRPasses(this.materials,t.rpasses)}}function v(t,e,i,r,s,n,a=0,o=0){void 0===s&&(s=50),r<.001&&(r=.001),s<3&&(s=3),n||(n=new l.default);let u=new Array(s+1),h=new Array(3),c=0,d=o,m=d>0?d:2*Math.PI,f=[n.x,n.y,n.z],p=0;for(;p<s;++p)d=a+m*p/s,h[t]=f[t]+r*Math.cos(d),h[e]=f[e]+r*Math.sin(d),h[i]=f[i],u[p]=(new l.default).setVector3(h),c+=3;return u[p]=u[0],u}function g(t,e,i,r=0,s=0){let n=v(0,1,2,t,e,i,r,s);return new p({linePositions:n})}function b(t,e,i,r=0,s=0){let n=v(0,2,1,t,e,i,r,s);return new p({linePositions:n})}function y(t,e,i,r=0,s=0){let n=v(1,2,0,t,e,i,r,s);return new p({linePositions:n})}e.Line3DEntity=p,e.createLineCircleXOY=g,e.createLineCircleXOZ=b,e.createLineCircleYOZ=y},6524:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){this.m_stage3D=null,this.m_camera=null,this.m_mouseX=0,this.m_mouseY=0,this.m_enabled=!1,this.slideSpeed=2}initialize(t,e){null==this.m_stage3D&&(this.m_stage3D=t,this.m_camera=e)}attach(){this.m_mouseX=this.m_stage3D.mouseX,this.m_mouseY=this.m_stage3D.mouseY,this.m_enabled=!0}detach(){this.m_enabled=!1}run(){if(this.m_enabled){let t=(this.m_mouseX-this.m_stage3D.mouseX)*this.slideSpeed,e=(this.m_mouseY-this.m_stage3D.mouseY)*this.slideSpeed;this.m_camera.slideViewOffsetXY(t,e),this.m_mouseX=this.m_stage3D.mouseX,this.m_mouseY=this.m_stage3D.mouseY}}}e.CamDragSlider=r},"660c":function(t,e,i){"use strict";function r(t,e){if(!t)throw new Error(e&&("string"===typeof e?e:e()))}Object.defineProperty(e,"__esModule",{value:!0}),e.assert=r},6729:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("f3f6")),a=r(i("e958")),o=i("943f"),l=i("746a"),u=i("551f"),h=i("cae9"),c=i("58c4"),d=i("e44f"),m=i("7650");class f{constructor(){this.geomData=new s.GeomDataBuilder,this.renderer=new h.WGRenderer,this.mRotY=0}initialize(){new d.WGRStorageValue({data:new Float32Array(16)}),new m.WGRUniformValue({data:new Float32Array(16)});const t={vert:{code:n.default,uuid:"vertShdCode"},frag:{code:a.default,uuid:"fragShdCode"}};let e=this.createMaterial(t,[new c.WGImage2DTextureData("static/assets/box.jpg")],["solid"],"back");this.mEntity=this.createEntity([e])}createMaterial(t,e,i=[],r="back"){let s={depthWriteEnabled:!0,faceCullMode:r,blendModes:[]};s.blendModes=i;const n=e?e.length:0,a=new o.WGMaterial({shadinguuid:"base-material-tex"+n,shaderSrc:t,pipelineDefParam:s});let l={data:new Float32Array([1,0,0,1]),shdVarName:"param"};return a.uniformValues=[l],a.addTextureWithDatas(e),a}createEntity(t){const e=this.renderer,i=this.geomData.createSphere(150,30,30),r=(new l.WGGeometry).addAttribute({shdVarName:"position",data:i.vs,strides:[3]}).addAttribute({shdVarName:"uv",data:i.uvs,strides:[2]}).setIndexBuffer({name:"geomIndex",data:i.ivs}),s=new u.Entity3D;return s.materials=t,s.geometry=r,e.addEntity(s),s}run(){this.mRotY+=.5,this.mEntity.transform.setRotationXYZ(0,this.mRotY,this.mRotY+.5),this.mEntity.update(),this.renderer.run()}}e.UniformTest=f},"68f4":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("ec7b")),n=r(i("af80")),a=r(i("c6d1")),o=i("7650"),l=i("24fe"),u=i("4942");class h{constructor(t){this.mTempV=new n.default,this.mTempV1=new n.default,this.mInitRV=new n.default,this.mInitUp=new n.default,this.mMatrix=new a.default,this.mViewMat=new a.default,this.mViewInvMat=new a.default,this.mVPMat=new a.default,this.mTempMat=new a.default,this.mProjMat=new a.default,this.mCamPos=new n.default,this.mLookAtPos=new n.default,this.mUp=new n.default,this.mLookDirectNV=new n.default,this.mLookAtDirec=new n.default,this.mLookRHand=!0,this.mNearPlaneW=1,this.mNearPlaneH=1,this.mViewX=0,this.mViewY=0,this.mViewW=800,this.mViewH=600,this.mViewHalfW=400,this.mViewHalfH=300,this.mFovRadian=0,this.mAspect=1,this.mZNear=.1,this.mZFar=1e3,this.mB=0,this.mT=0,this.mL=0,this.mR=0,this.mPerspective=!1,this.mProject2Enabled=!1,this.mRightHandEnabled=!0,this.mRotV=new n.default,this.mViewFieldZoom=1,this.mChanged=!0,this.mUnlock=!0,this.version=0,this.name="Camera",this.frustum=new u.Frustum,this.inversePerspectiveZ=!1,this.m_tempNV=new n.default,this.m_tempUPV=new n.default,this.m_tempRV=new n.default,this.m_tempCamPos=new n.default,this.m_tempLookAtPos=new n.default,this.m_rotDegree=0,this.m_rotAxis=new n.default,this.m_rotPivotPoint=null,this.m_axisRotEnabled=!1,this.mViewMatrix=null,this.viewUniformV=new o.WGRUniformValue({data:this.mViewMat.getLocalFS32(),shared:!0,shdVarName:"viewMat"}),this.projUniformV=new o.WGRUniformValue({data:this.mProjMat.getLocalFS32(),shared:!0,shdVarName:"projMat"}),t&&this.initialize(t)}initialize(t){l.initializeCamera(t,this)}lock(){this.mUnlock=!1}unlock(){this.mUnlock=!0}lookAtLH(t,e,i){this.mUnlock&&(this.mCamPos.copyFrom(t),this.mLookAtPos.copyFrom(e),this.mUp.copyFrom(i),this.mLookAtDirec.subVecsTo(this.mLookAtPos,this.mCamPos),this.mLookRHand=!1,this.mLookDirectNV.copyFrom(this.mLookAtDirec),this.mLookDirectNV.normalize(),this.mInitUp.copyFrom(i),this.mInitUp.normalize(),n.default.Cross(this.mLookAtDirec,this.mUp,this.mInitRV),this.mInitRV.normalize(),this.mChanged=!0)}lookAtRH(t,e,i){this.mUnlock&&(this.mCamPos.copyFrom(t),this.mLookAtPos.copyFrom(e),this.mLookAtDirec.subVecsTo(this.mLookAtPos,this.mCamPos),this.mLookRHand=!0,this.mLookDirectNV.copyFrom(this.mLookAtDirec),this.mLookDirectNV.normalize(),n.default.Cross(this.mLookAtDirec,i,this.mInitRV),n.default.Cross(this.mInitRV,this.mLookAtDirec,this.mInitUp),this.mInitUp.normalize(),this.mInitRV.normalize(),this.mUp.copyFrom(this.mInitUp),this.mChanged=!0)}getLookAtLHToCamera(t){t.lookAtLH(this.mCamPos,this.mLookAtPos,this.mUp)}getLookAtRHToCamera(t){t.lookAtRH(this.mCamPos,this.mLookAtPos,this.mUp)}perspectiveLH(t,e,i,r){this.mUnlock&&(this.mProject2Enabled=!1,this.mAspect=e,this.mFovRadian=t,this.mZNear=i,this.mZFar=r,this.mProjMat.perspectiveLH(t,e,i,r),this.mViewFieldZoom=Math.tan(.5*t),this.mPerspective=!0,this.mRightHandEnabled=!1,this.mChanged=!0)}perspectiveRH(t,e,i,r){this.mUnlock&&(this.mAspect=e,this.mFovRadian=t,this.mZNear=i,this.mZFar=r,this.mProjMat.perspectiveRH(t,e,i,r),this.mViewFieldZoom=Math.tan(.5*t),this.mProject2Enabled=!1,this.mPerspective=!0,this.mRightHandEnabled=!0,this.mChanged=!0)}perspectiveRH2(t,e,i,r,s){this.mUnlock&&(this.mAspect=e/i,this.mFovRadian=t,this.mZNear=r,this.mZFar=s,this.mProjMat.perspectiveRH2(t,e,i,r,s),this.mViewFieldZoom=Math.tan(.5*t),this.mPerspective=!0,this.mProject2Enabled=!0,this.mRightHandEnabled=!0,this.mChanged=!0)}get aspect(){return this.mAspect}get viewFieldZoom(){return this.mViewFieldZoom}orthoRH(t,e,i,r,s,n){this.mUnlock&&(this.mZNear=t,this.mZFar=e,this.mB=i,this.mT=r,this.mL=s,this.mR=n,this.mProjMat.orthoRH(i,r,s,n,t,e,this.inversePerspectiveZ?-1:1),this.mPerspective=!1,this.mRightHandEnabled=!0,this.mChanged=!0)}orthoLH(t,e,i,r,s,n){this.mUnlock&&(this.mZNear=t,this.mZFar=e,this.mB=i,this.mT=r,this.mL=s,this.mR=n,this.mProjMat.orthoLH(i,r,s,n,t,e,this.inversePerspectiveZ?-1:1),this.mPerspective=!1,this.mRightHandEnabled=!1,this.mChanged=!0)}setViewXY(t,e){this.mUnlock&&(this.mViewX=t,this.mViewY=e)}setViewSize(t,e){this.mUnlock&&(t==this.mViewW&&e==this.mViewH||(this.mViewW=t,this.mViewH=e,this.mViewHalfW=.5*t,this.mViewHalfH=.5*e,this.frustum.setViewSize(t,e),this.mPerspective?this.mProject2Enabled?this.mRightHandEnabled&&this.perspectiveRH2(this.mFovRadian,t,e,this.mZNear,this.mZFar):this.mRightHandEnabled?this.perspectiveRH(this.mFovRadian,t/e,this.mZNear,this.mZFar):this.perspectiveLH(this.mFovRadian,t/e,this.mZNear,this.mZFar):this.orthoRH(this.mZNear,this.mZFar,-.5*e,.5*e,-.5*t,.5*t)))}get rightHand(){return this.mRightHandEnabled}get viewX(){return this.mViewX}get viewY(){return this.mViewY}get viewWidth(){return this.mViewW}get viewHeight(){return this.mViewH}translation(t){this.mUnlock&&(this.mCamPos.copyFrom(t),this.mLookAtPos.addVecsTo(t,this.mLookAtDirec),this.mChanged=!0)}translationXYZ(t,e,i){this.mTempV.setXYZ(t,e,i),this.mUnlock&&n.default.DistanceSquared(this.mCamPos,this.mTempV)>1e-5&&(this.mCamPos.setXYZ(t,e,i),this.mLookAtPos.x=t+this.mLookAtDirec.x,this.mLookAtPos.y=e+this.mLookAtDirec.y,this.mLookAtPos.z=i+this.mLookAtDirec.z,this.mChanged=!0)}forward(t){this.mUnlock&&(this.mCamPos.x+=this.mLookDirectNV.x*t,this.mCamPos.y+=this.mLookDirectNV.y*t,this.mCamPos.z+=this.mLookDirectNV.z*t,this.mLookAtPos.addVecsTo(this.mCamPos,this.mLookAtDirec),this.mChanged=!0)}slideViewOffsetXY(t,e){if(this.mUnlock){this.mTempV.setXYZ(t,e,0),this.mInvViewMat.transformVectorSelf(this.mTempV),t=this.mTempV.x-this.mCamPos.x,e=this.mTempV.y-this.mCamPos.y;let i=this.mTempV.z-this.mCamPos.z;this.mCamPos.x+=t,this.mCamPos.y+=e,this.mCamPos.z+=i,this.mLookAtPos.x+=t,this.mLookAtPos.y+=e,this.mLookAtPos.z+=i,this.mChanged=!0}}forwardFixPos(t,e){this.mUnlock&&(this.mCamPos.copyFrom(this.mLookDirectNV).scaleBy(t).addBy(e),this.mLookAtPos.addVecsTo(this.mCamPos,this.mLookAtDirec),this.mChanged=!0)}swingHorizontalWithAxis(t,e){this.mUnlock&&(this.mTempMat.identity(),null!=e?this.mTempMat.appendRotation(t*s.default.MATH_PI_OVER_180,e):this.mTempMat.appendRotation(t*s.default.MATH_PI_OVER_180,n.default.Y_AXIS),this.mLookAtDirec.subVecsTo(this.mCamPos,this.mLookAtPos),this.mTempMat.transformVectorSelf(this.mLookAtDirec),this.mCamPos.addVecsTo(this.mLookAtDirec,this.mLookAtPos),this.mLookAtDirec.subVecsTo(this.mLookAtPos,this.mCamPos),this.mLookRHand=!0,this.mLookDirectNV.copyFrom(this.mLookAtDirec),this.mLookDirectNV.normalize(),this.mTempMat.transformVectorSelf(this.mInitRV),this.mInitRV.normalize(),n.default.Cross(this.mInitRV,this.mLookAtDirec,this.mUp),this.mUp.normalize(),this.mChanged=!0)}swingHorizontal(t){this.mUnlock&&(this.mTempMat.identity(),this.mTempMat.appendRotation(t*s.default.MATH_PI_OVER_180,this.mUp),this.mLookAtDirec.subVecsTo(this.mCamPos,this.mLookAtPos),this.mTempMat.transformVectorSelf(this.mLookAtDirec),this.mCamPos.addVecsTo(this.mLookAtDirec,this.mLookAtPos),this.mLookAtDirec.subVecsTo(this.mLookAtPos,this.mCamPos),this.mLookRHand=!0,this.mLookDirectNV.copyFrom(this.mLookAtDirec),this.mLookDirectNV.normalize(),n.default.Cross(this.mLookAtDirec,this.mUp,this.mInitRV),this.mInitRV.normalize(),this.mChanged=!0)}swingVertical(t){this.mUnlock&&(this.mTempMat.identity(),this.mTempMat.appendRotation(s.default.ToRadian(t),this.mInitRV),this.mLookAtDirec.subVecsTo(this.mCamPos,this.mLookAtPos),this.mTempMat.transformVectorSelf(this.mLookAtDirec),this.mCamPos.addVecsTo(this.mLookAtDirec,this.mLookAtPos),this.mLookAtDirec.subVecsTo(this.mLookAtPos,this.mCamPos),this.mLookRHand=!0,this.mLookDirectNV.copyFrom(this.mLookAtDirec),this.mLookDirectNV.normalize(),n.default.Cross(this.mInitRV,this.mLookAtDirec,this.mUp),this.mUp.normalize(),this.mInitUp.copyFrom(this.mUp),this.mChanged=!0)}get position(){return this.m_tempCamPos.copyFrom(this.mCamPos),this.m_tempCamPos}set position(t){if(this.mUnlock){n.default.Cross(this.mLookAtDirec,this.mUp,this.mTempV);let e=this.mTempV.dot(this.mInitUp);this.mTempV1.copyFrom(this.mInitUp),this.mTempV1.scaleBy(e),this.mTempV.subtractBy(this.mTempV1),this.mCamPos.copyFrom(t),this.mLookAtDirec.subVecsTo(this.mLookAtPos,this.mCamPos),this.mLookDirectNV.copyFrom(this.mLookAtDirec),this.mLookDirectNV.normalize(),n.default.Cross(this.mTempV,this.mLookAtDirec,this.mUp),this.mUp.normalize(),this.mChanged=!0}}setPositionXYZ(t,e,i){if(this.mUnlock){n.default.Cross(this.mLookAtDirec,this.mUp,this.mTempV);var r=this.mTempV.dot(this.mInitUp);this.mTempV1.copyFrom(this.mInitUp),this.mTempV1.scaleBy(r),this.mTempV.subtractBy(this.mTempV1),this.mCamPos.setXYZ(t,e,i),this.mLookAtDirec.subVecsTo(this.mLookAtPos,this.mCamPos),this.mLookDirectNV.copyFrom(this.mLookAtDirec),this.mLookDirectNV.normalize(),n.default.Cross(this.mTempV,this.mLookAtDirec,this.mUp),this.mUp.normalize(),this.mChanged=!0}}setLookPosXYZFixUp(t,e,i){this.mUnlock&&(this.mLookAtPos.setXYZ(t,e,i),this.mLookAtDirec.subVecsTo(this.mLookAtPos,this.mCamPos),this.mLookRHand=!0,this.mLookDirectNV.copyFrom(this.mLookAtDirec),this.mLookDirectNV.normalize(),n.default.Cross(this.mLookAtDirec,this.mUp,this.mInitRV),this.mInitRV.normalize(),this.mChanged=!0)}setPositionXYZFixUp(t,e,i){this.mUnlock&&(this.mCamPos.setXYZ(t,e,i),this.mLookAtDirec.subVecsTo(this.mLookAtPos,this.mCamPos),this.mLookRHand=!0,this.mLookDirectNV.copyFrom(this.mLookAtDirec),this.mLookDirectNV.normalize(),n.default.Cross(this.mLookAtDirec,this.mUp,this.mInitRV),this.mInitRV.normalize(),this.mChanged=!0)}setPositionFixUp(t){this.mUnlock&&(this.mCamPos.copyFrom(t),this.mLookAtDirec.subVecsTo(this.mLookAtPos,this.mCamPos),this.mLookRHand=!0,this.mLookDirectNV.copyFrom(this.mLookAtDirec),this.mLookDirectNV.normalize(),n.default.Cross(this.mLookAtDirec,this.mUp,this.mInitRV),this.mInitRV.normalize(),this.mChanged=!0)}copyFrom(t){let e=t.position;this.mCamPos.copyFrom(e),e=t.lookPosition,this.mLookAtPos.copyFrom(e),this.near=t.near,this.far=t.far,this.nearPlaneWidth=t.nearPlaneWidth,this.nearPlaneHeight=t.nearPlaneHeight,this.perspective=t.perspective,this.mViewInvMat.copyFrom(t.viewInvertMatrix)}get nv(){return this.m_tempNV.copyFrom(this.mLookDirectNV),this.m_tempNV}get uv(){return this.m_tempUPV.copyFrom(this.mUp),this.m_tempUPV}get rv(){return this.m_tempRV.copyFrom(this.mInitRV),this.m_tempRV}get lookPosition(){return this.m_tempLookAtPos.copyFrom(this.mLookAtPos),this.m_tempLookAtPos}setLookAtPosition(t){this.mUnlock&&(this.mLookAtPos.copyFrom(t),this.mLookAtDirec.subVecsTo(this.mLookAtPos,this.mCamPos),this.mLookDirectNV.copyFrom(this.mLookAtDirec),this.mLookDirectNV.normalize(),this.mChanged=!0)}setLookAtXYZ(t,e,i){this.mUnlock&&(this.mLookAtPos.setXYZ(t,e,i),this.mLookAtDirec.subVecsTo(this.mLookAtPos,this.mCamPos),this.mLookDirectNV.copyFrom(this.mLookAtDirec),this.mLookDirectNV.normalize(),this.mChanged=!0)}get perspective(){return this.mPerspective}set perspective(t){this.mPerspective=t}appendRotationByAxis(t,e,i=null){this.mUnlock&&(this.m_rotDegree=t,this.mChanged=!0,this.m_rotAxis.copyFrom(e),this.m_rotPivotPoint=i,this.m_axisRotEnabled=!0)}setRotationX(t){this.mRotV.x=t,this.mChanged=!0,this.m_axisRotEnabled=!1}getRotationX(){return this.mRotV.x}setRotationY(t){this.mRotV.y=t,this.mChanged=!0,this.m_axisRotEnabled=!1}getRotationY(){return this.mRotV.y}setRotationZ(t){this.mRotV.z=t,this.mChanged=!0,this.m_axisRotEnabled=!1}getRotationZ(){return this.mRotV.z}setRotationXYZ(t,e,i){this.mUnlock&&(this.mRotV.setXYZ(t,e,i),this.mChanged=!0,this.m_axisRotEnabled=!1)}screenXYToViewXYZ(t,e,i){t-=this.mViewX,e-=this.mViewY,this.mPerspective&&(t=this.mNearPlaneW*(t-this.mViewHalfW)/this.mViewHalfW,e=this.mNearPlaneH*(this.mViewHalfH-e)/this.mViewHalfH),i.setXYZ(t,e,-this.mZNear)}screenXYToWorldXYZ(t,e,i){t-=this.mViewX,e-=this.mViewY,this.mPerspective&&(t=.5*this.mNearPlaneW*(t-this.mViewHalfW)/this.mViewHalfW,e=.5*this.mNearPlaneH*(this.mViewHalfH-e)/this.mViewHalfH),i.setXYZ(t,e,-this.mZNear),i.w=1,this.mViewInvMat.transformVectorSelf(i)}getWorldPickingRayByScreenXY(t,e,i,r){t-=this.mViewX,e-=this.mViewY,this.mPerspective?(t=.5*this.mNearPlaneW*(t-this.mViewHalfW)/this.mViewHalfW,e=.5*this.mNearPlaneH*(e-this.mViewHalfH)/this.mViewHalfH,i.setXYZ(t,e,-this.mZNear),i.w=1,this.mViewInvMat.transformVectorSelf(i),r.copyFrom(i),r.subtractBy(this.mCamPos),r.normalize()):(t-=this.mViewHalfW,e-=this.mViewHalfH,i.setXYZ(t,e,-this.mZNear),i.w=1,this.mViewInvMat.transformVectorSelf(i),r.copyFrom(this.mLookDirectNV))}calcScreenNormalizeXYByWorldPos(t,e){e.copyFrom(t),this.mVPMat.transformVectorSelf(e),e.x/=e.w,e.y/=e.w}worldPosToScreen(t){this.mViewMat.transformVector3Self(t),this.mProjMat.transformVectorSelf(t),t.x/=t.w,t.y/=t.w,t.x*=this.mViewHalfW,t.y*=this.mViewHalfH,t.x+=this.mViewX,t.y+=this.mViewY}calcViewRectByWorldSphere(t,e,i){this.mViewMat.transformVector3Self(t),e*=1.15,i.x=t.x-e,i.y=t.y-e,i.z=t.z,t.x+=e,t.y+=e,this.mProjMat.transformPerspV4Self(i),this.mProjMat.transformPerspV4Self(t),t.z=1/t.w,i.z=t.x*t.z,i.w=t.y*t.z,i.z*=this.mViewHalfW,i.w*=this.mViewHalfH,i.x*=t.z,i.y*=t.z,i.x*=this.mViewHalfW,i.y*=this.mViewHalfH,i.z=i.z-i.x,i.w=i.w-i.y,i.x+=this.mViewX,i.y+=this.mViewY}calcScreenRectByWorldSphere(t,e,i){this.mViewMat.transformVector3Self(t),e*=1.15,i.x=t.x-e,i.y=t.y-e,t.x+=e,t.y+=e,this.mProjMat.transformPerspV4Self(i),this.mProjMat.transformPerspV4Self(t),t.z=1/t.w,i.z=t.x*t.z,i.w=t.y*t.z,i.x*=t.z,i.y*=t.z,i.z=i.z-i.x,i.w=i.w-i.y}getInvertViewMatrix(){return this.mInvViewMat}get near(){return this.mZNear}set near(t){this.mZNear=t}get far(){return this.mZFar}set far(t){this.mZFar=t}get nearPlaneWidth(){return this.mNearPlaneW}set nearPlaneWidth(t){this.mNearPlaneW=t}get nearPlaneHeight(){return this.mNearPlaneH}set nearPlaneHeight(t){this.mNearPlaneH=t}get fov(){return this.mFovRadian}calcParam(){this.mInvViewMat||(this.mInvViewMat=new a.default),this.mInvViewMat.copyFrom(this.mViewMat),this.mInvViewMat.invert();const t=this.frustum;t.perspective=this.mPerspective,t.setParam(this.mFovRadian,this.mZNear,this.mZFar,this.mAspect),t.update(this.mInvViewMat)}setViewMatrix(t){this.mViewMatrix=t,this.mChanged=!0}update(){this.mChanged&&(this.version++,this.mChanged=!1,this.mViewMatrix?this.mViewMat.copyFrom(this.mViewMatrix):(this.m_axisRotEnabled?this.mMatrix.appendRotationPivot(this.m_rotDegree*s.default.MATH_PI_OVER_180,this.m_rotAxis,this.m_rotPivotPoint):(this.mMatrix.identity(),this.mMatrix.appendRotationEulerAngle(this.mRotV.x*s.default.MATH_PI_OVER_180,this.mRotV.y*s.default.MATH_PI_OVER_180,this.mRotV.z*s.default.MATH_PI_OVER_180)),this.mLookRHand?this.mViewMat.lookAtRH(this.mCamPos,this.mLookAtPos,this.mUp):this.mViewMat.lookAtLH(this.mCamPos,this.mLookAtPos,this.mUp),this.mViewMat.append(this.mMatrix)),this.mProject2Enabled?(this.mNearPlaneW=this.mZNear*Math.tan(.5*this.mFovRadian)*2,this.mNearPlaneH=this.mNearPlaneW/this.mAspect):(this.mNearPlaneH=this.mZNear*Math.tan(.5*this.mFovRadian)*2,this.mNearPlaneW=this.mAspect*this.mNearPlaneH),this.mViewInvMat.copyFrom(this.mViewMat),this.mViewInvMat.invert(),this.mVPMat.identity(),this.mVPMat.copyFrom(this.mViewMat),this.mVPMat.append(this.mProjMat),this.calcParam(),this.updateUniformData())}updateUniformData(){this.viewUniformV.upate(),this.projUniformV.upate()}destroy(){}get lookRightHand(){return this.mLookRHand}get lookLeftHand(){return!this.mLookRHand}get viewProjMatrix(){return this.mVPMat}get viewMatrix(){return this.mViewMat}get viewInvertMatrix(){return this.mViewInvMat}get projectMatrix(){return this.mProjMat}}e.default=h},"6aa1":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("852d");e.CoModuleVersion=r.CoModuleVersion;const s=i("163b");e.CoGeomDataType=s.CoGeomDataType;class n{constructor(t){this.m_map=new Map,this.m_total=0,this.m_loadedTotal=0,this.types=null,this.models=[],this.transforms=[],this.init(t)}init(t){this.urls=t,this.m_total=t.length;for(let e=0;e<this.m_total;++e)this.m_map.set(t[e],0)}testWithUrl(t){let e=!1;if(this.m_map.has(t)&&this.m_map.get(t)<1&&(this.m_map.set(t,1),this.m_loadedTotal++,e=this.m_loadedTotal>=this.m_total,e)){let t=this.callback;t(this.models,this.transforms),this.callback=null}return e}}class a{constructor(){this.m_modelLoader=new s.CoGeomModelLoader,this.m_team=null,this.m_teams=[],this.m_enabled=!0,this.verTool=null,this.initialize()}initialize(){this.m_modelLoader.setListener((t,e,i,r)=>{if(null!=this.m_team)for(let s=0;s<t.length;++s)null!=t[s]&&(t[s].url=r,null!=t[s].vertices&&(e?this.m_team.transforms.push(e[s]):this.m_team.transforms.push(null),this.m_team.models.push(t[s])))},(t,e)=>{let i=this.m_team.testWithUrl(e);i&&(this.m_enabled=!0,this.loadNext())})}loadNext(){if(this.m_enabled&&this.m_teams.length>0){let t=this.m_teams.shift();this.m_team=t,this.m_enabled=!1,t.types?this.m_modelLoader.loadWithType(t.urls,t.types):this.m_modelLoader.load(t.urls)}}load(t,e){this.m_modelLoader.verTool=this.verTool;let i=new n(t);i.callback=e,this.m_teams.push(i),this.loadNext()}loadWithTypes(t,e,i){this.m_modelLoader.verTool=this.verTool;let r=new n(t);r.types=e,r.callback=i,this.m_teams.push(r),this.loadNext()}}e.CoModelTeamLoader=a},"6b10":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("3341"),s=i("b3f5");e.calculateMipLevels=s.calculateMipLevels;const n=i("2b0e"),a=i("bc85");class o{constructor(){this.mUid=o.sUid++,this.presentationFormat="bgra8unorm",this.enabled=!1,this.mipmapGenerator=new s.GPUMipmapGenerator,this.texture=new n.WebGPUTextureContext,this.buffer=new a.WebGPUBufferContext}checkGPUTextureFormat(t,e=!0){return r.checkGPUTextureFormat(t,e)}get uid(){return this.mUid}get canvasWidth(){return this.canvas.width}get canvasHeight(){return this.canvas.height}async initialize(t,e,i){const s=this;s.canvas=t;const n=navigator.gpu;if(!n)throw new Error("WebGPU is not supported on this browser.");{s.gpu=n,i||(i={});const a=await n.requestAdapter();if(!a)throw new Error("No appropriate GPUAdapter found.");{s.gpuAdapter=a,void 0===i.requiredFeatures&&(i.requiredFeatures=[]);const o=await a.requestDevice(i);if(!o)throw new Error("No appropriate GPUDevice found.");{this.mipmapGenerator.initialize(o),s.device=o,s.queue=o.queue;let i=n.getPreferredCanvasFormat();s.canvasFormat=i,s.context=t.getContext("webgpu");const a=this.context,l=i;r.checkGPUTextureFormat(l)||(i="bgra8unorm"),e&&(e.device=o,e.format?i=e.format:e.format=i),s.presentationFormat=e.format,a.configure(e||{device:o,format:i,alphaMode:"premultiplied"}),s.texture.initialize(this),s.buffer.initialize(this),s.enabled=!0}}}}getPreferredCanvasFormat(){return this.gpu.getPreferredCanvasFormat()}createCurrentView(){return this.context.getCurrentTexture().createView()}}o.sUid=0,e.WebGPUContext=o},"6bbe":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("f3f6")),a=r(i("3f99")),o=i("943f"),l=i("746a"),u=i("551f"),h=i("cae9"),c=i("58c4");class d{constructor(){this.geomData=new s.GeomDataBuilder,this.renderer=new h.WGRenderer,this.mRotY=0}initialize(){const t={vert:{code:n.default},frag:{code:a.default}},e=[new c.WGImage2DTextureData("static/assets/blueTransparent.png")];let i=this.createMaterial(t,e,["transparent"],"front"),r=this.createMaterial(t,e,["transparent"],"back");this.mEntity=this.createEntity([i,r])}createMaterial(t,e,i=[],r="back"){let s={depthWriteEnabled:!0,faceCullMode:r,blendModes:[]};s.blendModes=i;const n=e?e.length:0,a=new o.WGMaterial({shadinguuid:"base-material-tex"+n+r,shaderSrc:t,pipelineDefParam:s});return a.addTextureWithDatas(e),a}createEntity(t){const e=this.renderer,i=this.geomData.createSphere(150,30,30),r=(new l.WGGeometry).addAttribute({position:i.vs}).addAttribute({uv:i.uvs}).setIndices(i.ivs),s=new u.Entity3D({geometry:r,materials:t});return e.addEntity(s),s}run(){this.mRotY+=.5,this.mEntity.transform.setRotationXYZ(0,this.mRotY,this.mRotY+.5),this.mEntity.update(),this.renderer.run()}}e.MultiMaterialPass=d},"6cb1":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t,e,i){this.specular={uuid:"SpecularBrnTexture",dataTexture:{datas:[],width:128,height:128},viewDimension:"2d",format:"rgba8unorm",generateMipmaps:!1};let r=this.specular.dataTexture;r.datas=t,r.width=e,r.height=i}set data(t){this.specular.dataTexture.data=t}set datas(t){this.specular.dataTexture.datas=t}set width(t){this.specular.dataTexture.width=t}set height(t){this.specular.dataTexture.width=t}}e.SpecularBrnTexture=r},"6d7a":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("af80")),n=i("648f");function a(t,e,i=10){i<1&&(i=1);let r=(new s.default).setVector3(t),n=(new s.default).setVector3(e),a=1,o=(new s.default).subVecsTo(n,r);o.z<.1?a=0:o.x<.1&&(a=2),o.scaleBy(1/i);let l=i+1,u=r.clone(),h=n.clone(),c=n.clone(),d=new Array(2*l),m=0;if(1==a)for(let s=0;s<l;++s)u.x=r.x+o.x*s,u.z=r.z,h.copyFrom(u),h.z=n.z,d[m++]=u.clone(),d[m++]=h.clone(),c.copyFrom(u),u.x=h.z,u.z=h.x,h.x=c.z,h.z=c.x,d[m++]=u.clone(),d[m++]=h.clone();else if(2==a)for(let s=0;s<l;++s)u.y=r.y+o.y*s,u.z=r.z,h.copyFrom(u),h.z=n.z,d[m++]=u.clone(),d[m++]=h.clone(),c.copyFrom(u),u.y=h.z,u.z=h.y,h.y=c.z,h.z=c.y,d[m++]=u.clone(),d[m++]=h.clone();else for(let s=0;s<l;++s)u.x=r.x+o.x*s,u.y=r.y,h.copyFrom(u),h.y=n.y,d[m++]=u.clone(),d[m++]=h.clone(),c.copyFrom(u),u.x=h.y,u.y=h.x,h.x=c.y,h.y=c.x,d[m++]=u.clone(),d[m++]=h.clone();return d}function o(t){void 0===t.minPos&&(t.minPos=[-600,0,-600]),void 0===t.maxPos&&(t.maxPos=[600,0,600]),void 0===t.stepsTotal&&(t.stepsTotal=20),t.linePositions=a(t.minPos,t.maxPos,t.stepsTotal)}function l(t){}class u extends n.Line3DEntity{constructor(t){t||(t={}),t.dashedData=!0,t.linePositions||o(t),t.lineColors||l(t),super(t)}}e.RectLineGridEntity=u},"70bd":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("e2cf");class s{constructor(t){this.mShdModuleMap=new Map,t&&this.initialize(t)}initialize(t){t&&!this.mWGCtx&&(this.mWGCtx=t)}createShaderModule(t,e){if(e){const i=this.mWGCtx.device;if(e.uuid&&""!==e.uuid){const r=e.uuid+"-"+t,s=this.mShdModuleMap;if(s.has(r))return s.get(r);const n=i.createShaderModule({label:r,code:e.code});return s.set(r,n),n}const r=i.createShaderModule({code:e.code});return r}return null}build(t,e){let i=t.shaderSrc?this.createShaderModule("Shader",t.shaderSrc):null,s=t.vertShaderSrc?this.createShaderModule("VertShader",t.vertShaderSrc):i,n=t.fragShaderSrc?this.createShaderModule("FragShader",t.fragShaderSrc):i,a=t.compShaderSrc?this.createShaderModule("CompShader",t.compShaderSrc):i,o="";const l=t.vertex;let u=t.shaderSrc?t.shaderSrc:t.vertShaderSrc;u?(o=void 0!==u.vertEntryPoint?u.vertEntryPoint:r.findShaderEntryPoint("@vertex",u.code),""!==o&&(l.module=s,l.entryPoint=o)):t.vertex=null;let h=t.fragment;u=t.shaderSrc?t.shaderSrc:t.fragShaderSrc,u?(o=void 0!==u.fragEntryPoint?u.fragEntryPoint:r.findShaderEntryPoint("@fragment",u.code),""!==o&&(h||(h=t.fragment=r.createFragmentState()),h.module=n,h.entryPoint=o),this.checkFrag(h,e)):t.fragment=null,u=t.compShaderSrc,u&&a?(u=t.compShaderSrc,t.compute=r.createComputeState(a),void 0!==u.compEntryPoint?t.compute.entryPoint=u.compEntryPoint:u.compEntryPoint=t.compute.entryPoint=r.findShaderEntryPoint("@compute",u.code)):a&&(u=t.shaderSrc,o=r.findShaderEntryPoint("@compute",u.code),""!=o&&(t.compute=r.createComputeState(a),t.compute.entryPoint=o))}checkFrag(t,e){if(t){let i=e.passColors,r=t.targets;for(let t=0;t<i.length;++t)r.length>t?r[t].format=i[t].textureFormat:r.push({format:i[t].textureFormat})}}}e.WGRPipelineShader=s},"71f1":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("6aa1");e.CoGeomDataType=r.CoGeomDataType;const s=new r.CoModelTeamLoader;e.modelLoader=s},"73c4":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("4ad2"),n=r(i("c69e")),a=i("213f"),o=r(i("bd7e")),l=r(i("0d77")),u=i("7650"),h=i("e44f"),c=i("19f9"),d=i("943f"),m=r(i("af80")),f=r(i("e58d")),p=i("76e3"),v=256,g=8,b=`\n@group(0) @binding(0) var<uniform> grid: vec2f;\n\n@group(0) @binding(1) var<storage> cellStateIn: array<u32>;\n@group(0) @binding(2) var<storage, read_write> cellStateOut: array<u32>;\n@group(0) @binding(3) var<storage, read_write> lifeState: array<f32>;\n\nfn cellIndex(cell: vec2u) -> u32 {\n\treturn (cell.y % u32(grid.y)) * u32(grid.x) +\n\t\t   (cell.x % u32(grid.x));\n}\n\nfn cellActive(x: u32, y: u32) -> u32 {\n\treturn cellStateIn[cellIndex(vec2(x, y))];\n}\n\n@compute @workgroup_size(${g}, ${g})\nfn compMain(@builtin(global_invocation_id) cell: vec3u) {\n\t// Determine how many active neighbors this cell has.\n\tlet activeNeighbors = cellActive(cell.x+1, \t\tcell.y+1) +\n\t\t\t\t\t\t\tcellActive(cell.x+1, \tcell.y) +\n\t\t\t\t\t\t\tcellActive(cell.x+1, \tcell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x, \t\tcell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, \tcell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, \tcell.y) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, \tcell.y+1) +\n\t\t\t\t\t\t\tcellActive(cell.x, \t\tcell.y+1);\n\n\tlet i = cellIndex(cell.xy);\n\n\t// Conway's game of life rules:\n\tswitch activeNeighbors {\n\t\tcase 2: { // Active cells with 2 neighbors stay active.\n\t\t\tcellStateOut[i] = cellStateIn[i];\n\t\t\tif(cellStateOut[i] > 0) {\n\t\t\t\tlifeState[i] += 0.05;\n\t\t\t} else {\n\t\t\t\tlifeState[i] -= 0.05;\n\t\t\t}\n\t\t}\n\t\tcase 3: { // Cells with 3 neighbors become or stay active.\n\t\t\tcellStateOut[i] = 1;\n\t\t\tlifeState[i] += 0.1;\n\t\t}\n\t\tdefault: { // Cells with < 2 or > 3 neighbors become inactive.\n\t\t\tcellStateOut[i] = 0;\n\t\t\tlifeState[i] -= 0.05;\n\t\t}\n\t}\n\tif(lifeState[i] < 0.01) { lifeState[i] = 0.01; }\n}`;class y{constructor(){this.mRscene=new s.RendererScene,this.mFlag=6,this.mouseDown=t=>{this.mFlag=1},this.mStep=0,this.mFrameDelay=3}initialize(){this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(n.default.MOUSE_DOWN,this.mouseDown),new f.default(this.mRscene,!0),(new a.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}createUniformValues(){const t=new Float32Array([v,v]),e=new Uint32Array(v*v);for(let u=0;u<e.length;u++)e[u]=Math.random()>.6?1:0;const i=new Uint32Array(v*v);for(let u=0;u<i.length;u++)i[u]=u%2;const r=new Float32Array(v*v);for(let u=0;u<r.length;u++)r[u]=.01;const s=new Float32Array(v*v*4);let n=new m.default(40,1,40),a=(new m.default).copyFrom(n);a.scaleBy(v),a.scaleBy(-.5);let o=0;for(let u=0;u<v;u++)for(let t=0;t<v;t++){let e=new m.default(t*n.x,0,u*n.z).addBy(a);s[o]=e.x,s[o+1]=e.y,s[o+2]=e.z,o+=4}let l=!0,c={data:e,shared:l},d={data:i,shared:l},f={data:r,shared:l},p={data:s,shared:l};const g=new u.WGRUniformValue({data:t,stride:2,shared:l,shdVarName:"v0"}).toVisibleAll(),b=new h.WGRStorageValue({bufData:c,stride:1,shared:l,shdVarName:"va1"}).toVisibleVertComp(),y=new h.WGRStorageValue({bufData:d,stride:1,shared:l,shdVarName:"vb1"}).toVisibleVertComp(),_=new h.WGRStorageValue({bufData:f,stride:1,shared:l,shdVarName:"vc1"}).toVisibleAll(),x=new h.WGRStorageValue({bufData:p,stride:3,shared:l,shdVarName:"v4"}).toVisibleVertComp(),w=new h.WGRStorageValue({bufData:c,stride:1,shared:l,shdVarName:"compva1"}).toVisibleVertComp(),S=new h.WGRStorageValue({bufData:d,stride:1,shared:l,shdVarName:"compva2"}).toVisibleComp();S.toBufferForStorage();const M=new h.WGRStorageValue({bufData:d,stride:1,shared:l,shdVarName:"compvb1"}).toVisibleVertComp(),P=new h.WGRStorageValue({bufData:c,stride:1,shared:l,shdVarName:"compvb2"}).toVisibleComp();P.toBufferForStorage();const T=new h.WGRStorageValue({bufData:f,stride:1,shared:l,shdVarName:"compv3"}).toVisibleComp();return T.toBufferForStorage(),[{ufvs0:[g,b,_,x],ufvs1:[g,y,_,x]},{ufvs0:[g,w,S,T],ufvs1:[g,M,P,T]}]}createMaterial(t,e,i){return new d.WGMaterial({shadinguuid:"rendering",shaderSrc:t,instanceCount:i,uniformValues:e,uniformAppend:!1})}createCompMaterial(t,e,i=2){return new c.WGCompMaterial({shadinguuid:"computing",shaderSrc:t,uniformValues:e,uniformAppend:!1}).setWorkcounts(i,i)}initScene(){const t=this.mRscene,e=this.createUniformValues(),i=v*v,r=Math.ceil(v/g);let s={vertShaderSrc:{code:o.default,uuid:"vert-gameOfLife"},fragShaderSrc:{code:l.default,uuid:"frag-gameOfLife"}},n={compShaderSrc:{code:b,uuid:"shader-computing"}};const a=[this.createMaterial(s,e[0].ufvs0,i),this.createMaterial(s,e[0].ufvs1,i),this.createCompMaterial(n,e[1].ufvs1,r),this.createCompMaterial(n,e[1].ufvs0,r)];let u=new p.CylinderEntity({radius:20,height:38,longitudeNumSegments:10,latitudeNumSegments:10,alignYRatio:0,materials:a});t.addEntity(u),this.mEntity=u}run(){let t=this.mEntity.isRendering();const e=this.mEntity.materials;if(t){for(let t=0;t<e.length;t++)e[t].visible=(this.mStep%2+t)%2==0;this.mFrameDelay>0?(this.mFrameDelay--,t=!1):(this.mFrameDelay=3,this.mStep++)}t||(e[2].visible=!1,e[3].visible=!1),this.mRscene.run()}}e.GameOfLifeSpherePBR=y},"746a":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("af1b"),s=i("fe0b");class n{constructor(){this.shdVarName="",this.bindIndex=0,this.strides=[3],this.bufferOffset=0}}e.WGGeomAttributeBlock=n;class a{constructor(t){this.name="",this.name=t.name,this.data=t.data}createWireframeIvs(t){if(t){const e=2*t.length,i=s.createIndexArrayWithSize(e);let r,n,a,o=0;for(let s=0,l=t.length;s<l;s+=3)r=t[s+0],n=t[s+1],a=t[s+2],i[o]=r,i[o+1]=n,i[o+2]=n,i[o+3]=a,i[o+4]=a,i[o+5]=r,o+=6;return i}return t}toWirframe(){this.wireframeData||(this.wireframeData=this.createWireframeIvs(this.data))}}e.WGGeomIndexBuffer=a;class o{constructor(){this.name="WGGeometry",this.descParam={vertex:{buffers:[],attributeIndicesArray:[]}},this.drawMode=r.WGRDrawMode.TRIANGLES}setIndexBuffer(t){return this.indexBuffer=new a(t),this}setIndices(t){return this.indexBuffer=new a({data:t}),this}filterParam(t,e,i){t[e]&&(t.data=t[e],t.shdVarName||(t.shdVarName=e),t.strides||(t.strides=i),t[e]=void 0)}addAttribute(t){if(t){this.filterParam(t,"position",[3]),this.filterParam(t,"uv",[2]),this.filterParam(t,"uv2",[2]),this.filterParam(t,"normal",[3]),this.filterParam(t,"color",[3]);const i=new n,r=i;for(var e in t)r[e]=t[e];this.attributes?this.attributes.push(i):this.attributes=[i]}return this}addAttributes(t){if(t)for(let e=0;e<t.length;++e)this.addAttribute(t[e]);return this}isREnabled(){let t=!0;const e=this.attributes;if(e)for(let i=0;i<e.length;++i)if(!e[i].data){t=!1;break}return t}destroy(){}}e.WGGeometry=o},"74d8":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> param: vec4f;\r\n@group(0) @binding(1) var sampler0: sampler;\r\n@group(0) @binding(2) var texture0: texture_2d<f32>;\r\n\r\nfn calcColor(uv: vec2f) -> vec4f {\r\n    var result = textureSample(texture0, sampler0, uv) * param;\r\n\tresult = vec4f(result.xyz * result.x/0.2, 1.0);\r\n\t// result = vec4f(result.xyz * 3.0, 1.0);\r\n    return result;\r\n}\r\n\r\n@fragment\r\nfn main(\r\n\t@location(0) uv: vec2f\r\n\t) -> @location(0) vec4f {\r\n\tvar color4 = calcColor( uv );\r\n    return color4;\r\n}\r\n"},"751c":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> objMat : mat4x4<f32>;\r\n@group(0) @binding(1) var<uniform> viewMat : mat4x4<f32>;\r\n@group(0) @binding(2) var<uniform> projMat : mat4x4<f32>;\r\n@group(0) @binding(3) var<storage> positions: array<vec4<f32>>;\r\n\r\nstruct VertexOutput {\r\n  @builtin(position) Position : vec4<f32>,\r\n  @location(0) wordPos: vec4<f32>,\r\n  @location(1) uv : vec2<f32>,\r\n  @location(2) normal : vec3<f32>,\r\n  @location(3) camPos : vec3<f32>\r\n}\r\n\r\n@vertex\r\nfn main(\r\n@builtin(instance_index) insIdx : u32,\r\n  @location(0) position : vec3<f32>,\r\n  @location(1) uv : vec2<f32>,\r\n  @location(2) normal : vec3<f32>\r\n) -> VertexOutput {\r\n\r\n  var wpos = objMat * vec4(position.xyz, 1.0);\r\n  wpos = vec4(wpos.xyz + positions[insIdx].xyz, wpos.w);\r\n  var output : VertexOutput;\r\n  output.Position = projMat * viewMat * wpos;\r\n  output.uv = uv;\r\n\r\n  let invMat33 = inverseM33( m44ToM33( objMat ) );\r\n  output.normal = normalize( normal * invMat33 );\r\n  output.camPos = (inverseM44(viewMat) * vec4<f32>(0.0,0.0,0.0, 1.0)).xyz;\r\n  output.wordPos = wpos;\r\n  return output;\r\n}\r\n\r\nfn inverseM33(m: mat3x3<f32>)-> mat3x3<f32> {\r\n    let a00 = m[0][0]; let a01 = m[0][1]; let a02 = m[0][2];\r\n    let a10 = m[1][0]; let a11 = m[1][1]; let a12 = m[1][2];\r\n    let a20 = m[2][0]; let a21 = m[2][1]; let a22 = m[2][2];\r\n    let b01 = a22 * a11 - a12 * a21;\r\n    let b11 = -a22 * a10 + a12 * a20;\r\n    let b21 = a21 * a10 - a11 * a20;\r\n    let det = a00 * b01 + a01 * b11 + a02 * b21;\r\n    return mat3x3<f32>(\r\n\t\tvec3<f32>(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11)) / det,\r\n                vec3<f32>(b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10)) / det,\r\n                vec3<f32>(b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det);\r\n}\r\nfn m44ToM33(m: mat4x4<f32>) -> mat3x3<f32> {\r\n\treturn mat3x3(m[0].xyz, m[1].xyz, m[2].xyz);\r\n}\r\n\r\nfn inverseM44(m: mat4x4<f32>)-> mat4x4<f32> {\r\n    let a00 = m[0][0]; let a01 = m[0][1]; let a02 = m[0][2]; let a03 = m[0][3];\r\n    let a10 = m[1][0]; let a11 = m[1][1]; let a12 = m[1][2]; let a13 = m[1][3];\r\n    let a20 = m[2][0]; let a21 = m[2][1]; let a22 = m[2][2]; let a23 = m[2][3];\r\n    let a30 = m[3][0]; let a31 = m[3][1]; let a32 = m[3][2]; let a33 = m[3][3];\r\n    let b00 = a00 * a11 - a01 * a10;\r\n    let b01 = a00 * a12 - a02 * a10;\r\n    let b02 = a00 * a13 - a03 * a10;\r\n    let b03 = a01 * a12 - a02 * a11;\r\n    let b04 = a01 * a13 - a03 * a11;\r\n    let b05 = a02 * a13 - a03 * a12;\r\n    let b06 = a20 * a31 - a21 * a30;\r\n    let b07 = a20 * a32 - a22 * a30;\r\n    let b08 = a20 * a33 - a23 * a30;\r\n    let b09 = a21 * a32 - a22 * a31;\r\n    let b10 = a21 * a33 - a23 * a31;\r\n    let b11 = a22 * a33 - a23 * a32;\r\n    let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\treturn mat4x4<f32>(\r\n\t\tvec4<f32>(a11 * b11 - a12 * b10 + a13 * b09,\r\n\t\ta02 * b10 - a01 * b11 - a03 * b09,\r\n\t\ta31 * b05 - a32 * b04 + a33 * b03,\r\n\t\ta22 * b04 - a21 * b05 - a23 * b03) / det,\r\n\t\t\tvec4<f32>(a12 * b08 - a10 * b11 - a13 * b07,\r\n\t\ta00 * b11 - a02 * b08 + a03 * b07,\r\n\t\ta32 * b02 - a30 * b05 - a33 * b01,\r\n\t\ta20 * b05 - a22 * b02 + a23 * b01) / det,\r\n\t\tvec4<f32>(a10 * b10 - a11 * b08 + a13 * b06,\r\n\t\ta01 * b08 - a00 * b10 - a03 * b06,\r\n\t\ta30 * b04 - a31 * b02 + a33 * b00,\r\n\t\ta21 * b02 - a20 * b04 - a23 * b00) / det,\r\n\t\tvec4<f32>(a11 * b07 - a10 * b09 - a12 * b06,\r\n\t\ta00 * b09 - a01 * b07 + a02 * b06,\r\n\t\ta31 * b01 - a30 * b03 - a32 * b00,\r\n\t\ta20 * b03 - a21 * b01 + a22 * b00) / det);\r\n}"},7650:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("2d6d"),s=i("dc4d");class n extends r.WGRBufferValue{constructor(t){super(t),this.visibility||(this.visibility=new s.WGRBufferVisibility),this.toUniform()}}e.WGRUniformValue=n},"76e3":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("1eee"),n=r(i("4255"));class a extends s.PrimitiveEntity{constructor(t){super(t)}getGeometryData(t){t||(t={}),void 0===t.radius&&(t.radius=100),void 0===t.height&&(t.height=300),void 0===t.longitudeNumSegments&&(t.longitudeNumSegments=20),void 0===t.latitudeNumSegments&&(t.latitudeNumSegments=20),void 0===t.uvType&&(t.uvType=1),void 0===t.alignYRatio&&(t.alignYRatio=-.5);let e=new n.default;return e.initialize(t.radius,t.height,t.longitudeNumSegments,t.latitudeNumSegments,t.uvType,t.alignYRatio),e}}e.CylinderEntity=a},7751:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("0142"),n=i("bf93"),a=i("36ce"),o=r(i("2c77")),l=i("d5c3");class u{constructor(t,e=!0){this.mUid=u.sUid++,this.mDrawing=!0,this.mPassBuilded=!1,this.clearColor=new o.default(0,0,0,1),this.name="",this.pipelineCtxs=[],this.pctxMap=new Map,this.enabled=!0,this.mode=0,this.separate=!1,this.mRBParam=t,this.camera=t.camera,this.mDrawing=e,this.rpass=new s.WGRendererPass(null,e),this.rpass.clearColor=this.clearColor}setColorAttachmentClearEnabledAt(t,e=0){if(this.mPassBuilded){const i=this.rpass.passColors[e];i&&(i.loadOp=t?"clear":"load")}}isDrawing(){return this.mDrawing}get uid(){return this.mUid}getWGCtx(){return this.mWGCtx}destroy(){this.rpass&&(this.mRBParam=null,this.prevNode=null)}getPassNodeWithMaterial(t){const e=this.builder;return e?e.getPassNodeWithMaterial(t):this}initialize(t,e){this.param=e||this.param,this.param||(this.param={}),!this.mWGCtx&&t&&t.enabled&&(this.mWGCtx=t,this.prevNode&&(this.rpass.prevPass=this.prevNode.rpass),this.rpass.initialize(t),this.checkRPassParam(this.param),this.rpass.build(this.param),this.mPassBuilded=!0,this.colorAttachments=this.rpass.passColors)}hasMaterial(t){return!!this.unitBlock&&this.unitBlock.hasMaterial(t)}addEntity(t){if(t){this.unitBlock||(this.unitBlock=l.WGRenderUnitBlock.createBlock());const e=this.unitBlock;e.rbParam=this.mRBParam,e.builder=this,this.unitBlock.addEntity(t)}}checkRPassParam(t){void 0!==t.sampleCount&&t.sampleCount>1?t.multisampleEnabled=!0:!0===t.multisampleEnabled?t.sampleCount=4:t.multisampleEnabled=!1,void 0==t.depthFormat&&(t.depthFormat="depth24plus")}createRenderPipelineCtxWithMaterial(t){const e=t.shadinguuid&&""!==t.shadinguuid,i=this.pctxMap;if(e&&i.has(t.shadinguuid))return i.get(t.shadinguuid);const r=this.createRenderPipelineCtx(t.shaderSrc,t.pipelineVtxParam,t.pipelineDefParam);return e&&(r.shadinguuid=t.shadinguuid,i.set(t.shadinguuid,r)),r}createRenderPipelineCtx(t,e,i){const r=i;let s=!r||!1!==r.depthStencilEnabled;const a=new n.WGRPipelineCtxParams({shaderSrc:t.shaderSrc,vertShaderSrc:t.vertShaderSrc,fragShaderSrc:t.fragShaderSrc,compShaderSrc:t.compShaderSrc,depthStencilEnabled:s});return r&&(r.blendModes&&a.setBlendModes(r.blendModes),r.depthStencil?a.setDepthStencil(r.depthStencil):a.setDepthWriteEnabled(!0===r.depthWriteEnabled),a.setPrimitiveState(r.primitiveState?r.primitiveState:{cullMode:r.faceCullMode})),this.createRenderPipeline(a,e)}createRenderPipeline(t,e){const i=new a.WGRPipelineContext(this.mWGCtx);if(this.pipelineCtxs.push(i),this.mDrawing){this.rpass.depthTexture?t.setDepthStencilFormat(this.rpass.depthTexture.format):(t.depthStencilEnabled=!1,t.depthStencil=void 0);const e=this.rpass.getPassParams();e.multisampleEnabled&&(t.multisample?t.multisample.count=e.sampleCount:t.multisample={count:e.sampleCount},t.sampleCount=e.sampleCount)}return i.createRenderPipelineWithBuf(t,e),i.rpass=this.rpass,i}runBegin(){if(this.colorAttachments=this.rpass.passColors,this.rpass.enabled=this.enabled,this.rcommands=[],this.rpass.runBegin(),this.enabled)for(let t=0;t<this.pipelineCtxs.length;)this.pipelineCtxs[t++].runBegin()}runEnd(){if(this.enabled)for(let e=0;e<this.pipelineCtxs.length;)this.pipelineCtxs[e++].runEnd();let t=this.rpass.runEnd();t&&(this.rcommands=[t])}run(){if(this.enabled){const t=this.unitBlock;t&&t.run()}}render(){this.enabled&&(this.runBegin(),this.run(),this.runEnd())}}u.sUid=0,e.WGRenderPassNode=u},7917:function(t,e,i){"use strict";i.r(e),e["default"]="struct VertexInput {\r\n\t@location(0) pos: vec3f,\r\n  \t@location(1) uv : vec2f,\r\n\t@builtin(instance_index) instance: u32\r\n};\r\n\r\nstruct VertexOutput {\r\n\t@builtin(position) pos: vec4f,\r\n\t@location(0) cell: vec2f,\r\n\t@location(1) uv: vec2f,\r\n\t@location(2) instance: f32,\r\n};\r\n@group(0) @binding(0) var<uniform> grid: vec2f;\r\n@group(0) @binding(1) var<storage> cellState: array<u32>;\r\n@group(0) @binding(2) var<storage> lifeState: array<f32>;\r\n@vertex\r\nfn vertMain(input: VertexInput) -> VertexOutput {\r\n    let i = f32(input.instance);\r\n    let cell = vec2f(i % grid.x, floor(i / grid.x));\r\n    let cellOffset = cell / grid * 2.0;\r\n\r\n    var state = f32(cellState[input.instance]);\r\n    let gridPos = (input.pos.xy * state + 1.0) / grid - 1.0 + cellOffset;\r\n\r\n    var output: VertexOutput;\r\n    output.pos = vec4f(gridPos, 0.0, 1.0);\r\n    output.cell = cell;\r\n    output.uv = input.uv;\r\n    output.instance = i;\r\n    return output;\r\n}\r\n\r\n@fragment\r\nfn fragMain(input: VertexOutput) -> @location(0) vec4f {\r\n    let c = input.cell / grid;\r\n\tvar dis = length(input.uv - vec2<f32>(0.5, 0.5));\r\n\tdis = min(dis/0.15, 1.0);\r\n\tlet i = u32(input.instance);\r\n\tvar f = clamp((lifeState[i])/100.0, 0.0005, 1.0);\r\n\tdis = (1.0 - pow(dis, 100.0)) * (1.0 - f) + f;\r\n\tvar c3 = vec3f(c, (1.0 - c.x) * (1.0 - f) + f) * dis;\r\n    return vec4f(c3, 1.0);\r\n}"},"793b":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("e594");function s(t,e,i){const r=e.uniformValues;if(e.uniformValues)for(let s=0;s<r.length;++s)if(r[s].shdVarName==t)return r[s];return i}e.TransformParam=r.TransformParam,e.getUniformValueFromParam=s},"79d0":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{IntersectRL(t,e,i){let r=0,s=(i.min.x-e.x)/t.x,n=(i.max.x-e.x)/t.x;s>n&&(r=n,n=s,s=r);let a=(i.min.y-e.y)/t.y,o=(i.max.y-e.y)/t.y;if(a>o&&(r=o,o=a,a=r),s>o||a>n)return!1;a>s&&(s=a),o<n&&(n=o);let l=(i.min.z-e.z)/t.z,u=(i.max.z-e.z)/t.z;return l>u&&(r=u,u=l,l=r),!(s>u||l>n)&&(l>s&&(s=l),u<n&&(n=u),!0)}static IntersectionRL3(t,e,i,r,s,n){return i.w=(t[e[0]].x-s.x)*i.x,r.w=(t[1-e[0]].x-s.x)*i.x,n.x=(t[e[1]].y-s.y)*i.y,n.y=(t[1-e[1]].y-s.y)*i.y,!(i.w>n.y||n.x>r.w)&&(n.x>i.w&&(i.w=n.x),n.y<r.w&&(r.w=n.y),n.x=(t[e[2]].z-s.z)*i.z,n.y=(t[1-e[2]].z-s.z)*i.z,!(i.w>n.y||n.x>r.w)&&(n.x>i.w&&(i.w=n.x),n.y<r.w&&(r.w=n.y),n.copyFrom(r),n.scaleBy(i.w),n.addBy(s),r.w=1,!0))}static IntersectionRL1(t,e,i,r){let s=0,n=(i.min.x-e.x)/t.x,a=(i.max.x-e.x)/t.x;n>a&&(s=a,a=n,n=s);let o=(i.min.y-e.y)/t.y,l=(i.max.y-e.y)/t.y;if(o>l&&(s=l,l=o,o=s),n>l||o>a)return!1;o>n&&(n=o),l<a&&(a=l);let u=(i.min.z-e.z)/t.z,h=(i.max.z-e.z)/t.z;return u>h&&(s=h,h=u,u=s),!(n>h||u>a)&&(u>n&&(n=u),h<a&&(a=h),r.copyFrom(t),r.scaleBy(n),r.addBy(e),!0)}static IntersectionRL2(t,e,i,r){r.x=i.center.x-e.x,r.y=i.center.y-e.y,r.z=i.center.z-e.z;let s=r.dot(t);if(r.x-=s*t.x,r.y-=s*t.y,r.z-=s*t.z,r.getLengthSquared()>i.radius2)return!1;if(i.containsV(e))return r.copyFrom(e),!0;if(e.x<i.min.x){if(t.x>0&&(s=(i.min.x-e.x)/t.x,r.copyFrom(t),r.scaleBy(s),r.addBy(e),i.containsYZ(r.y,r.z)))return!0}else if(e.x>i.max.x&&t.x<0&&(s=(i.max.x-e.x)/t.x,r.copyFrom(t),r.scaleBy(s),r.addBy(e),i.containsYZ(r.y,r.z)))return!0;if(e.y<i.min.y){if(t.y>0&&(s=(i.min.y-e.y)/t.y,r.copyFrom(t),r.scaleBy(s),r.addBy(e),i.containsXZ(r.x,r.z)))return!0}else if(e.y>i.max.y&&t.y<0&&(s=i.max.y,s=(i.max.y-e.y)/t.y,r.copyFrom(t),r.scaleBy(s),r.addBy(e),i.containsXZ(r.x,r.z)))return!0;if(e.z<i.min.z){if(t.z>0&&(s=(i.min.z-e.z)/t.z,r.copyFrom(t),r.scaleBy(s),r.addBy(e),i.containsXY(r.x,r.y)))return!0}else if(e.z>i.max.z&&t.z<0&&(s=(i.max.z-e.z)/t.z,r.copyFrom(t),r.scaleBy(s),r.addBy(e),i.containsXY(r.x,r.y)))return!0;return!1}}e.AABBCalc=r},"7a70":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("ec7b")),n=r(i("af80")),a=r(i("9e08"));class o extends a.default{constructor(){super(...arguments),this.nv=new n.default(0,1,0),this.distance=0,this.intersectBoo=!1}intersectStraightLinePos(t,e){let i=this.nv.dot(t.tv);if(i>s.default.MATH_MIN_POSITIVE||i<s.default.MATH_MAX_NEGATIVE){let r=this.nv.dot(t.position)-this.distance;return e.x=1e5*t.tv.x+t.position.x,e.y=1e5*t.tv.y+t.position.y,e.z=1e5*t.tv.z+t.position.z,i=this.nv.dot(e)-this.distance,i=r/(r-i),e.subtractBy(t.position),e.scaleBy(i),e.addBy(t.position),1}return i=this.nv.dot(t.position)-this.distance,i<=s.default.MATH_MIN_POSITIVE||i>=s.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),2):0}intersectStraightLinePos2(t,e,i){let r=this.nv.dot(e);if(r>s.default.MATH_MIN_POSITIVE||r<s.default.MATH_MAX_NEGATIVE){let s=this.nv.dot(t)-this.distance;return i.x=1e5*e.x+t.x,i.y=1e5*e.y+t.y,i.z=1e5*e.z+t.z,r=this.nv.dot(i)-this.distance,r=s/(s-r),i.subtractBy(t),i.scaleBy(r),i.addBy(t),1}return r=this.nv.dot(t)-this.distance,r<=s.default.MATH_MIN_POSITIVE||r>=s.default.MATH_MAX_NEGATIVE?(i.copyFrom(t),2):0}intersectRadialLinePos(t,e){let i=this.nv.dot(t.position)-this.distance;if(i>s.default.MATH_MIN_POSITIVE){let i=this.nv.dot(t.tv);if(i<0)return this.intersectStraightLinePos2(t.position,t.tv,e)}else{if(!(i<s.default.MATH_MAX_NEGATIVE)){let i=this.nv.dot(t.tv);return i>s.default.MATH_MIN_POSITIVE||i<s.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),1):(e.copyFrom(t.position),2)}{let i=this.nv.dot(t.tv);if(i>0)return this.intersectStraightLinePos2(t.position,t.tv,e)}}return-1}intersectRadialLinePos2(t,e,i){let r=this.nv.dot(t)-this.distance;if(r>s.default.MATH_MIN_POSITIVE){let r=this.nv.dot(e);if(r<0)return this.intersectStraightLinePos2(t,e,i)}else{if(!(r<s.default.MATH_MAX_NEGATIVE)){let r=this.nv.dot(e);return r>s.default.MATH_MIN_POSITIVE||r<s.default.MATH_MAX_NEGATIVE?(i.copyFrom(t),1):(i.copyFrom(t),2)}{let r=this.nv.dot(e);if(r>0)return this.intersectStraightLinePos2(t,e,i)}}return-1}containsPoint(t){let e=this.nv.dot(t)-this.distance;return e>s.default.MATH_MIN_POSITIVE?1:e<s.default.MATH_MAX_NEGATIVE?-1:0}intersectSphere(t,e){this.intersectBoo=!1;let i=this.nv.dot(t)-this.distance;return i>s.default.MATH_MIN_POSITIVE?(this.intersectBoo=i<=e,1):i<s.default.MATH_MAX_NEGATIVE?(this.intersectBoo=-i<=e,-1):0}intersectAABB(t,e){this.intersectBoo=!1;let i=a.default.__tV0;i.setXYZ(e.x,t.y,e.z);let r=this.containsPoint(i);return i.setXYZ(e.x,t.y,t.z),r+=this.containsPoint(i),i.setXYZ(t.x,t.y,t.z),r+=this.containsPoint(i),i.setXYZ(t.x,t.y,e.z),r+=this.containsPoint(i),i.setXYZ(e.x,e.y,e.z),r+=this.containsPoint(i),i.setXYZ(e.x,e.y,t.z),r+=this.containsPoint(i),i.setXYZ(t.x,e.y,t.z),r+=this.containsPoint(i),i.setXYZ(t.x,e.y,e.z),r+=this.containsPoint(i),this.intersectBoo=r<8,r<-7?-1:r>7?1:0}intersectSphNegSpace(t,e){this.intersectBoo=Math.abs(this.nv.dot(t)-this.distance)<e}update(){this.nv.normalize()}updateFast(){this.nv.normalize()}static PlaneIntersectSphere(t,e,i,r){o.IntersectBoo=!1,o.IntersectSatus=0,e=t.dot(i)-e,e>s.default.MATH_MIN_POSITIVE?(o.IntersectBoo=e<=r,o.IntersectSatus=1):e<s.default.MATH_MAX_NEGATIVE&&(o.IntersectBoo=-e<=r,o.IntersectSatus=-1)}static CalcPVCloseV(t,e,i){let r=t.distance-e.dot(t.nv);i.setXYZ(r*t.nv.x,r*t.nv.y,r*t.nv.z),i.addBy(e)}static CalcPVCloseV2(t,e,i,r){let s=e-i.dot(t);r.setXYZ(s*t.x,s*t.y,s*t.z),r.addBy(i)}static IntersectionSLV2(t,e,i,r,n){let a=t.dot(r);if(a>s.default.MATH_MIN_POSITIVE||a<s.default.MATH_MAX_NEGATIVE){let s=t.dot(i)-e;return n.x=1e5*r.x+i.x,n.y=1e5*r.y+i.y,n.z=1e5*r.z+i.z,a=t.dot(n)-e,a=s/(s-a),n.subtractBy(i),n.scaleBy(a),n.addBy(i),1}return a=t.dot(i)-e,a<=s.default.MATH_MIN_POSITIVE||a>=s.default.MATH_MAX_NEGATIVE?(n.copyFrom(i),2):0}toString(){return"Plane(position="+this.position.toString()+", nv="+this.nv.toString()+")"}}o.IntersectBoo=!1,o.IntersectSatus=0,e.default=o},"7b86":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=i("4ad2"),a=i("213f"),o=r(i("2c77")),l=i("d463");class u{constructor(){this.mRscene=new n.RendererScene,this.mFlag=6,this.mouseDown=t=>{this.mFlag=1}}initialize(){this.mRscene;this.mRscene.initialize({rpassparam:{multisampleEnabled:!0,depthTestEnabled:!1}}),this.initEvent(),this.applyRTT(),this.initScene()}applyRTT(){let t=this.mRscene,e={diffuse:{uuid:"rtt0",rttTexture:{}}},i=[{texture:e,clearValue:{r:.1,g:.5,b:.1,a:1},loadOp:"clear",storeOp:"store"}],r=t.renderer.appendRenderPass({separate:!0,colorAttachments:i});const s={diffuse:{url:"static/assets/default.jpg",flipY:!0}};let n=-.5,a=-.5,u=.8,h=.8,c=new l.FixScreenPlaneEntity({x:n,y:a,width:u,height:h,textures:[s]});c.setColor(new o.default(1,.3,.9)),c.uuid="rtt-entity",r.node.addEntity(c),n=.3,a=.3,u=.6,h=.6;let d=new l.FixScreenPlaneEntity({x:n,y:a,width:u,flipY:!0,height:h,textures:[e]});d.setColor(new o.default(1,.3,.9)),d.uuid="apply-rtt-entity",t.addEntity(d)}initEvent(){const t=this.mRscene;t.addEventListener(s.default.MOUSE_DOWN,this.mouseDown),(new a.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}initScene(){const t=this.mRscene,e={diffuse:{url:"static/assets/default.jpg",flipY:!0}};let i=-.9,r=0,s=.5,n=.5,a=new l.FixScreenPlaneEntity({x:i,y:r,width:s,height:n});a.setColor(new o.default(.2,.5,.7)),a.uuid="color-entity",t.addEntity(a),i=-.8,r=-.8,s=.8,n=.8,a=new l.FixScreenPlaneEntity({x:i,y:r,width:s,height:n,textures:[e]}),a.setColor(new o.default(.1,.3,.9)),t.addEntity(a)}run(){this.mRscene.run()}}e.RTTFixScreenTest=u},"7ce1":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(3) var mySampler: sampler;\r\n@group(0) @binding(4) var myTexture: texture_2d<f32>;\r\n\r\n@fragment\r\nfn main(\r\n  @location(0) fragUV: vec2<f32>,\r\n  @location(1) fragPosition: vec4<f32>\r\n) -> @location(0) vec4<f32> {\r\n  return textureSample(myTexture, mySampler, fragUV) * fragPosition;\r\n}\r\n"},"7e70":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("1eee"),n=r(i("0540")),a=r(i("f937")),o=new a.default;class l extends s.PrimitiveEntity{constructor(t){super(t)}getGeometryData(t){let e=new n.default;if(e.axisType=void 0===t.axisType?0:t.axisType,void 0!==t.extent){const i=o;i.setExtent(t.extent),e.initialize(i.x,i.y,i.width,i.height)}else e.initialize(void 0===t.x?-50:t.x,void 0===t.y?-50:t.y,void 0===t.width?100:t.width,void 0===t.height?100:t.height);return e}}e.PlaneEntity=l},"81d0":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("f3f6")),a=r(i("0bc4")),o=i("943f"),l=i("746a"),u=i("551f"),h=i("e44f"),c=r(i("c69e")),d=i("4ad2"),m=i("213f"),f=r(i("2c77")),p=r(i("af80"));class v{constructor(){this.mEntitices=[],this.mRscene=new d.RendererScene,this.geomData=new s.GeomDataBuilder,this.mRenderingFlag=6,this.mouseDown=t=>{const e=this.mRscene;let i=!1;if(i){let t=this.mEntitices[0];if(t.isInRenderer())e.removeEntity(t);else{let i=t.materials[0].uniformValues[0].data;i.set([Math.random()+.2,Math.random()+.2,Math.random()+.2,1]),e.addEntity(t)}}else{const t=this.createGeom(this.geomData.createSphere(50)),i={vert:{code:n.default,uuid:"vertShdCode"},frag:{code:a.default,uuid:"fragShdCode"}},r={diffuse:{url:"static/assets/default.jpg"}};let s=[this.createMaterial(i,[r],new f.default(1.5*Math.random(),1.5*Math.random(),1.5*Math.random()))],o=new u.Entity3D({materials:s,geometry:t});o.transform.setPosition(new p.default(130*this.mEntitices.length-500,0,0)),this.mEntitices.push(o),e.addEntity(o)}}}initialize(){this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(c.default.MOUSE_DOWN,this.mouseDown),(new m.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}createMaterial(t,e,i,r=["solid"],s="back"){i=i||new f.default;let n={depthWriteEnabled:!0,faceCullMode:s,blendModes:[]};n.blendModes=r;const a=e?e.length:0,l=new o.WGMaterial({shadinguuid:"base-material-tex"+a,shaderSrc:t,pipelineDefParam:n});let u=new h.WGRStorageValue({data:new Float32Array([i.r,i.g,i.b,1])});return l.uniformValues=[u],l.addTextures(e),l}createGeom(t,e=!1){const i=(new l.WGGeometry).addAttribute({position:t.vs}).addAttribute({uv:t.uvs}).setIndices(t.ivs);return e&&i.addAttribute({normal:t.nvs}),i}initScene(){const t=this.mRscene,e=this.createGeom(this.geomData.createCube(80)),i={vert:{code:n.default,uuid:"vertShdCode"},frag:{code:a.default,uuid:"fragShdCode"}},r={diffuse:{url:"static/assets/box.jpg"}};let s=[this.createMaterial(i,[r],new f.default(1.5*Math.random(),1.5*Math.random(),1.5*Math.random()))];for(let n=0;n<1;++n){let i=new u.Entity3D({materials:s,geometry:e});i.transform.setPosition(new p.default(130*n-500,0,0)),this.mEntitices.push(i),t.addEntity(i)}this.mEntitices[0]}run(){this.mRscene.run()}}e.RSceneEntityManagement=v},"821b":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(3) var<uniform> param: vec4f;\r\n@group(0) @binding(4) var sampler0: sampler;\r\n@group(0) @binding(5) var texture0: texture_2d<f32>;\r\n\r\nstruct FragOutput {\r\n  @location(0) color: vec4<f32>,\r\n  @location(1) albedo: vec4<f32>,\r\n  @location(2) normal: vec4<f32>\r\n}\r\nfn calcColor(uv: vec2f) -> vec4f {\r\n    var result = textureSample(texture0, sampler0, uv) * param;\r\n    return result;\r\n}\r\n\r\n@fragment\r\nfn main(\r\n\t@location(0) uv: vec2f,\r\n\t@location(1) normal: vec3f\r\n\t) -> FragOutput {\r\n\r\n\tlet c4 = calcColor( uv );\r\n\tvar output: FragOutput;\r\n\toutput.color = vec4f( c4.xyz * 0.5 + normal * c4.xyz, 1.0);\r\n\toutput.albedo = c4;\r\n\toutput.normal = vec4f(normal, 1.0);\r\n\r\n\treturn output;\r\n}\r\n"},8286:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=i("4ad2"),a=i("213f"),o=i("6aa1"),l=i("746a"),u=i("1eee"),h=r(i("751c")),c=r(i("0444")),d=i("7650"),m=i("e44f"),f=r(i("af80"));class p{constructor(){this.mRscene=new n.RendererScene,this.mTeamLoader=new o.CoModelTeamLoader,this.mouseDown=t=>{}}initialize(){this.initEvent(),this.initModels()}initEvent(){const t=this.mRscene;t.addEventListener(s.default.MOUSE_DOWN,this.mouseDown),(new a.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}createGeometry(t,e=!1){const i=(new l.WGGeometry).addAttribute({position:t.vertices}).addAttribute({uv:t.uvsList[0]}).setIndices(t.indices);return e&&i.addAttribute({normal:t.normals}),i}initModels(){let t="static/assets/fbx/mat_ball.fbx",e=this.mTeamLoader;e.load([t],(t,e)=>{for(let i=0;i<t.length;++i)this.createEntity(t[i])})}createEntity(t){let e=4,i=e*e*e;const r=4,s=new Float32Array(r*i),n=new f.default(150,150,150),a=(new f.default).copyFrom(n).scaleBy(-.5*(e-1));let o=0;for(let u=0;u<e;++u)for(let t=0;t<e;++t)for(let i=0;i<e;++i){const e=(new f.default).setXYZ(u*n.x,t*n.y,i*n.z).addBy(a),l=o*r;s[l]=e.x,s[l+1]=e.y,s[l+2]=e.z,s[l+3]=1,o++}let l=new m.WGRStorageValue({stride:r,data:s,shdVarName:"positions"}),p=new d.WGRUniformValue({data:new Float32Array([1,.01,.05,1]),shdVarName:"albedo"}),v=new d.WGRUniformValue({data:new Float32Array([1,.1,.1,1]),shdVarName:"arm"}),g=[l,p,v],b={vert:{code:h.default,uuid:"vert-primitive-ins"},frag:{code:c.default,uuid:"frag-primitive-ins"}};const y=this.mRscene,_=this.createGeometry(t,!0);let x=new u.PrimitiveEntity({geometry:_,shaderSrc:b,uniformValues:g,instanceCount:i});y.addEntity(x)}run(){this.mRscene.run()}}e.DrawInstanceTest=p},"842f":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("222c");class s{}const n=new s,a=new r.WGRUnitState;class o{constructor(){this.rf=!0,this.pst=a,this.st=a,this.__$rever=0,this.enabled=!0}getRF(){return this.enabled&&this.st.isDrawable()}runBegin(){const t=this.rp.passEncoder,e=this.material;let i=this.enabled&&this.rp.enabled&&this.st.isDrawable();if(i=i&&e.visible&&e.instanceCount>0,i){const r=this.geometry,s=this.pipelinectx.pipeline;if(r&&s){const a=n;a.rc!=t&&(a.pipeline=null,a.ibuf=null,a.gt=null,a.rc=t,a.unfsuuid=""),a.gt!=r&&(a.gt=r,r.run(t)),a.pipeline!=s&&(a.pipeline=s,t.setPipeline(s)),r.instanceCount=e.instanceCount;const o=this.uniforms;if(o)for(let e=0,r=o.length;e<r;e++){const r=o[e];if(r.isEnabled()){t.setBindGroup(r.groupIndex,r.bindGroup);for(let t=0,e=r.uvfs.length;t<e;t++)r.setValue(r.uvfs[t],t)}else i=!1}}else i=!1}this.rf=i}run(){if(this.rf){const t=this.rp.passEncoder,e=this.geometry;if(e.ibuf){const i=n;i.ibuf!=e.ibuf&&(i.ibuf=e.ibuf,t.setIndexBuffer(e.ibuf,e.ibuf.dataFormat)),t.drawIndexed(e.indexCount,e.instanceCount)}else t.draw(e.vertexCount,e.instanceCount)}}destroy(){if(this.pipelinectx){const t=this.pipelinectx.uniformCtx;t.removeUniforms(this.uniforms),this.pipelinectx=null,this.material=null,this.rp=null,this.pst=null,this.st=null}}}e.WGRUnit=o},"852d":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("3247")),n=i("fa7f");class a{constructor(t){if(this.m_infoObj=null,this.m_verMap=new Map,this.forceFiltering=!1,null!=t){this.m_infoObj=t;const e=this.m_infoObj,i=this.m_verMap;let r=e.items;for(let t=0;t<r.length;++t){const e=r[t];if(i.set(e.name,e),e.type&&"dir"==e.type){let t=e.items;for(let e=0;e<t.length;++e){const r=t[e];i.set(r.name,r)}}}}}filterUrl(t){let e=t.indexOf("/dracoLib/")>0;if(e){let e=s.default.getFileNameAndSuffixName(t,!0);if(this.m_verMap.has(e)){let i=this.m_verMap.get(e);t+="?ver="+i.ver}}else{let e=s.default.getFileName(t,!0);if(this.m_verMap.has(e)){let i=this.m_verMap.get(e);t+="?ver="+i.ver}}return t}}function o(t,e){let i=t.lastIndexOf("/"),r=t.indexOf(".",i),s=t.slice(i,r);return t.indexOf(".umd.")>0?(s=s.toLocaleLowerCase(),t=e+t.slice(0,i)+s+".js"):t=e+t,t}e.CoModuleVersion=a;class l extends n.ModuleLoader{constructor(t,e=null,i=null){super(t,e,null),this.forceFiltering=!1;let r=t=>{if(t.indexOf(".artvily.")>0)return t;let e=window.location.href;return t=t.trim(),e.indexOf(".artvily.")>0||this.forceFiltering?(l.urlHostFilterEnabled&&(e=this.forceFiltering?s.default.getHostUrl("9090"):"http://www.artvily.com:9090/"),t=o(t,e),i&&(t=i.filterUrl(t)),t):(l.forceReleaseEnabled&&(t=o(t,"")),i&&(t=i.filterUrl(t)),t)};this.setUrlChecker(r)}}l.urlHostFilterEnabled=!0,l.forceReleaseEnabled=!1,e.CoModuleLoader=l},"85fd":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("f3f6")),a=r(i("0bc4")),o=i("943f"),l=i("746a"),u=i("551f"),h=i("e44f"),c=r(i("c69e")),d=i("4ad2"),m=i("213f"),f=r(i("2c77")),p=r(i("af80"));class v{constructor(){this.mRscene=new d.RendererScene,this.geomData=new s.GeomDataBuilder,this.mIndex=0,this.mouseDown=t=>{let e=this.mRPass1.node;e.enabled=!e.enabled}}initialize(){this.mRscene.initialize({rpassparam:{multisampleEnabled:!0,depthTestEnabled:!0},camera:{eye:new p.default(600,600,0)}}),this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(c.default.MOUSE_DOWN,this.mouseDown),(new m.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}createMaterial(t,e,i,r=["solid"],s="back"){let n={depthWriteEnabled:!0,faceCullMode:s,blendModes:[]};n.blendModes=r;const a=e?e.length:0,l=new o.WGMaterial({shadinguuid:"base-material-tex"+a,shaderSrc:t,pipelineDefParam:n});let u=new h.WGRStorageValue({data:new Float32Array((new f.default).setColor(i).getArray4())});return l.uniformValues=[u],l.addTextures(e),l}createGeom(t,e=!1){const i=(new l.WGGeometry).addAttribute({position:t.vs}).addAttribute({uv:t.uvs}).setIndices(t.ivs);return e&&i.addAttribute({normal:t.nvs}),i}testAddEntityToBlock(){const t={vert:{code:n.default,uuid:"vertShdCode"},frag:{code:a.default,uuid:"fragShdCode"}},e=this.createGeom(this.geomData.createSphere(50)),i={diffuse:{url:"static/assets/box.jpg"}};let r=[this.createMaterial(t,[i],[1,0,1])],s=new u.Entity3D;s.materials=r,s.geometry=e,s.transform.setXYZ(0,0,180+110*this.mIndex),this.mRBlock.addEntity(s),this.mIndex++}testAddEntityToPassNode(){const t={vertShaderSrc:{code:n.default,uuid:"vertShdCode"},fragShaderSrc:{code:a.default,uuid:"fragShdCode"}},e=this.createGeom(this.geomData.createSphere(50)),i={diffuse:{url:"static/assets/box.jpg"}};let r=[this.createMaterial(t,[i],[1,0,1])],s=new u.Entity3D;s.materials=r,s.geometry=e,s.transform.setXYZ(0,0,-(180+110*this.mIndex)),this.mRPass0.node.addEntity(s),this.mIndex++}initScene(){const t=this.mRscene;this.mRBlock=t.renderer.getRPBlockAt(0);const e=this.createGeom(this.geomData.createCube(80)),i={vert:{code:n.default,uuid:"vertShdCode"},frag:{code:a.default,uuid:"fragShdCode"}},r={diffuse:{url:"static/assets/box.jpg"}};let s=[this.createMaterial(i,[r],[1,0,0])],o=[this.createMaterial(i,[r],[0,1,0])];this.mRPass0=t.renderer.getRPBlockAt(0).getRenderPassAt(0),this.mRPass1=t.renderer.appendRenderPass(),o[0].rpass={rpass:this.mRPass1};let l=new u.Entity3D({geometry:e,materials:s});t.addEntity(l),l=new u.Entity3D({geometry:e,materials:o}),l.transform.setXYZ(200,0,0),t.addEntity(l)}run(){this.mRscene.run()}}e.MultiGPUPassTest=v},8637:function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(3) var<uniform> albedo: vec4f;\r\n@group(0) @binding(4) var<uniform> arm: vec4f;\r\n\r\nconst PI = 3.141592653589793;\r\nconst PI2 = 6.283185307179586;\r\nconst PI_HALF = 1.5707963267948966;\r\nconst RECIPROCAL_PI = 0.3183098861837907;\r\nconst RECIPROCAL_PI2 = 0.15915494309189535;\r\nconst EPSILON = 1e-6;\r\n\r\nfn approximationSRGBToLinear(srgbColor: vec3<f32>) -> vec3<f32> {\r\n    return pow(srgbColor, vec3<f32>(2.2));\r\n}\r\nfn approximationLinearToSRCB(linearColor: vec3<f32>) -> vec3<f32> {\r\n    return pow(linearColor, vec3(1.0/2.2));\r\n}\r\n\r\nfn accurateSRGBToLinear(srgbColor: vec3<f32>) -> vec3<f32> {\r\n    let linearRGBLo = srgbColor / 12.92;\r\n    let linearRGBHi = pow((srgbColor + vec3(0.055)) / vec3(1.055), vec3(2.4));\r\n\tif( all( srgbColor <= vec3(0.04045) ) ) {\r\n\t\treturn linearRGBLo;\r\n\t}\r\n    return linearRGBHi;\r\n}\r\nfn accurateLinearToSRGB(linearColor: vec3<f32>) -> vec3<f32> {\r\n    let srgbLo = linearColor * 12.92;\r\n    let srgbHi = (pow(abs(linearColor), vec3(1.0 / 2.4)) * 1.055) - 0.055;\r\n    if(all(linearColor <= vec3(0.0031308))) {\r\n\t\treturn srgbLo;\r\n\t}\r\n    return srgbHi;\r\n}\r\n\r\n// Trowbridge-Reitz(Generalized-Trowbridge-Reitz,GTR)\r\nfn DistributionGTR1(NdotH: f32, roughness: f32) -> f32 {\r\n    if (roughness >= 1.0) {\r\n\t\treturn 1.0/PI;\r\n\t}\r\n    let a2 = roughness * roughness;\r\n    let t = 1.0 + (a2 - 1.0)*NdotH*NdotH;\r\n    return (a2 - 1.0) / (PI * log(a2) *t);\r\n}\r\nfn DistributionGTR2(NdotH: f32, roughness: f32) -> f32 {\r\n    let a2 = roughness * roughness;\r\n    let t = 1.0 + (a2 - 1.0) * NdotH * NdotH;\r\n    return a2 / (PI * t * t);\r\n}\r\n\r\n\r\nfn DistributionGGX(N: vec3<f32>, H: vec3<f32>, roughness: f32) -> f32 {\r\n    let a = roughness*roughness;\r\n    let a2 = a*a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH*NdotH;\r\n\r\n    let nom   = a2;\r\n    var denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    denom = PI * denom * denom;\r\n\r\n    return nom / max(denom, 0.0000001); // prevent divide by zero for roughness=0.0 and NdotH=1.0\r\n}\r\n\r\n\r\nfn GeometryImplicit(NdotV: f32, NdotL: f32) -> f32 {\r\n    return NdotL * NdotV;\r\n}\r\n\r\n// ----------------------------------------------------------------------------\r\nfn GeometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r*r) / 8.0;\r\n\r\n    let nom   = NdotV;\r\n    let denom = NdotV * (1.0 - k) + k;\r\n\r\n    return nom / denom;\r\n}\r\n// ----------------------------------------------------------------------------\r\nfn GeometrySmith(N: vec3<f32>, V: vec3<f32>, L: vec3<f32>, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    let ggx2 = GeometrySchlickGGX(NdotV, roughness);\r\n    let ggx1 = GeometrySchlickGGX(NdotL, roughness);\r\n\r\n    return ggx1 * ggx2;\r\n}\r\n\r\n// @param cosTheta is clamp(dot(H, V), 0.0, 1.0)\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3<f32>) -> vec3<f32> {\r\n    return F0 + (1.0 - F0) * pow(max(1.0 - cosTheta, 0.0), 5.0);\r\n}\r\nfn fresnelSchlick2(specularColor: vec3<f32>, L: vec3<f32>, H: vec3<f32>) -> vec3<f32> {\r\n   return specularColor + (1.0 - specularColor) * pow(1.0 - saturate(dot(L, H)), 5.0);\r\n}\r\n//fresnelSchlick2(specularColor, L, H) * ((SpecularPower + 2) / 8 ) * pow(saturate(dot(N, H)), SpecularPower) * dotNL;\r\n\r\nconst OneOnLN2_x6 = 8.656171;// == 1/ln(2) * 6 (6 is SpecularPower of 5 + 1)\r\n// dot -> dot(N,V) or\r\nfn fresnelSchlick3(specularColor: vec3<f32>, dot: f32, glossiness: f32) -> vec3<f32> {\r\n\treturn specularColor + (max(vec3(glossiness), specularColor) - specularColor) * exp2(-OneOnLN2_x6 * dot);\r\n}\r\nfn fresnelSchlickWithRoughness(specularColor: vec3<f32>, L: vec3<f32>, N: vec3<f32>, gloss: f32) -> vec3<f32> {\r\n   return specularColor + (max(vec3(gloss), specularColor) - specularColor) * pow(1.0 - saturate(dot(L, N)), 5.0);\r\n}\r\n\r\nconst A = 2.51f;\r\nconst B = 0.03f;\r\nconst C = 2.43f;\r\nconst D = 0.59f;\r\nconst E = 0.14f;\r\nfn ACESToneMapping(color: vec3<f32>, adapted_lum: f32) -> vec3<f32> {\r\n\r\n\tlet c = color * adapted_lum;\r\n\treturn (c * (A * c + B)) / (c * (C * c + D) + E);\r\n}\r\n\r\n//color = color / (color + vec3(1.0));\r\nfn reinhard(v: vec3<f32>) -> vec3<f32> {\r\n    return v / (vec3<f32>(1.0) + v);\r\n}\r\nfn reinhard_extended(v: vec3<f32>, max_white: f32) -> vec3<f32> {\r\n    let numerator = v * (1.0f + (v / vec3(max_white * max_white)));\r\n    return numerator / (1.0f + v);\r\n}\r\nfn luminance(v: vec3<f32>) -> f32 {\r\n    return dot(v, vec3<f32>(0.2126f, 0.7152f, 0.0722f));\r\n}\r\n\r\nfn change_luminance(c_in: vec3<f32>, l_out: f32) -> vec3<f32> {\r\n    let l_in = luminance(c_in);\r\n    return c_in * (l_out / l_in);\r\n}\r\nfn reinhard_extended_luminance(v: vec3<f32>, max_white_l: f32) -> vec3<f32> {\r\n    let l_old = luminance(v);\r\n    let numerator = l_old * (1.0f + (l_old / (max_white_l * max_white_l)));\r\n    let l_new = numerator / (1.0f + l_old);\r\n    return change_luminance(v, l_new);\r\n}\r\nfn ReinhardToneMapping( color: vec3<f32>, toneMappingExposure: f32 ) -> vec3<f32> {\r\n\r\n\tlet c = color * toneMappingExposure;\r\n\treturn saturate( c / ( vec3( 1.0 ) + c ) );\r\n\r\n}\r\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\r\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\r\nconst highp_a = 12.9898;\r\nconst highp_b = 78.233;\r\nconst highp_c = 43758.5453;\r\nfn rand( uv: vec2<f32> ) -> f32 {\r\n\tlet dt = dot( uv.xy, vec2<f32>( highp_a, highp_b ) );\r\n\tlet sn = modf( dt / PI ).fract;\r\n\treturn fract(sin(sn) * highp_c);\r\n}\r\n// // based on https://www.shadertoy.com/view/MslGR8\r\nfn dithering( color: vec3<f32>, fragCoord: vec2<f32> ) -> vec3<f32> {\r\n    //Calculate grid position\r\n    let grid_position = rand( fragCoord );\r\n\r\n    //Shift the individual colors differently, thus making it even harder to see the dithering pattern\r\n    var dither_shift_RGB = vec3<f32>( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\r\n\r\n    //modify shift acording to grid position.\r\n    dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\r\n\r\n    //shift the color by dither_shift\r\n    return color + dither_shift_RGB;\r\n}\r\n\r\nconst dis = 600.0;\r\nconst disY = 400.0;\r\nconst lightPositions = array<vec3<f32>, 4>(\r\n\tvec3<f32>(-dis, disY, dis),\r\n\tvec3<f32>(dis, disY, dis),\r\n\tvec3<f32>(-dis, disY, -dis),\r\n\tvec3<f32>(dis, disY, -dis)\r\n);\r\nconst colorValue = 300.0;\r\nconst lightColors = array<vec3<f32>, 4>(\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n);\r\n\r\nfn calcPBRColor3(Normal: vec3<f32>, WorldPos: vec3<f32>, camPos: vec3<f32>) -> vec3<f32> {\r\n\r\n\tvar color = vec3<f32>(0.0);\r\n\r\n    var ao = arm.x;\r\n    var roughness = arm.y;\r\n    var metallic = arm.z;\r\n\r\n\tvar N = normalize(Normal);\r\n    var V = normalize(camPos.xyz - WorldPos);\r\n    var dotNV = clamp(dot(N, V), 0.0, 1.0);\r\n\r\n    // calculate reflectance at normal incidence; if dia-electric (like plastic) use F0\r\n    // of 0.04 and if it's a metal, use the albedo color as F0 (metallic workflow)\r\n    var F0 = vec3(0.04);\r\n    F0 = mix(F0, albedo.xyz, metallic);\r\n\r\n    // reflectance equation\r\n    var Lo = vec3(0.0);\r\n\r\n\tfor (var i: i32 = 0; i < 4; i++) {\r\n\t\t// calculate per-light radiance\r\n        let L = normalize(lightPositions[i].xyz - WorldPos);\r\n        let H = normalize(V + L);\r\n        let distance = length(lightPositions[i].xyz - WorldPos);\r\n\r\n        let attenuation = 1.0 / (1.0 + 0.001 * distance + 0.0003 * distance * distance);\r\n        let radiance = lightColors[i].xyz * attenuation;\r\n\r\n        // Cook-Torrance BRDF\r\n        let NDF = DistributionGGX(N, H, roughness);\r\n        let G   = GeometrySmith(N, V, L, roughness);\r\n        //vec3 F    = fresnelSchlick(clamp(dot(H, V), 0.0, 1.0), F0);\r\n        let F    = fresnelSchlick3(F0,clamp(dot(H, V), 0.0, 1.0), 0.9);\r\n        //vec3 F    = fresnelSchlick3(F0,dotNV, 0.9);\r\n\r\n        let nominator    = NDF * G * F;\r\n        let denominator = 4.0 * max(dot(N, V), 0.0) * max(dot(N, L), 0.0);\r\n        let specular = nominator / max(denominator, 0.001); // prevent divide by zero for NdotV=0.0 or NdotL=0.0\r\n\r\n        // kS is equal to Fresnel\r\n        let kS = F;\r\n        // for energy conservation, the diffuse and specular light can't\r\n        // be above 1.0 (unless the surface emits light); to preserve this\r\n        // relationship the diffuse component (kD) should equal 1.0 - kS.\r\n        var kD = vec3<f32>(1.0) - kS;\r\n        // multiply kD by the inverse metalness such that only non-metals\r\n        // have diffuse lighting, or a linear blend if partly metal (pure metals\r\n        // have no diffuse light).\r\n        kD *= 1.0 - metallic;\r\n\r\n        // scale light by NdotL\r\n        let NdotL = max(dot(N, L), 0.0);\r\n\r\n        // add to outgoing radiance Lo\r\n        // note that we already multiplied the BRDF by the Fresnel (kS) so we won't multiply by kS again\r\n        Lo += (kD * albedo.xyz / PI + specular) * radiance * NdotL;\r\n\t}\r\n\t// ambient lighting (note that the next IBL tutorial will replace\r\n    // this ambient lighting with environment lighting).\r\n    let ambient = vec3<f32>(0.03) * albedo.xyz * ao;\r\n\r\n    color = ambient + Lo;\r\n    // HDR tonemapping\r\n    color = reinhard( color );\r\n    // gamma correct\r\n    color = pow(color, vec3<f32>(1.0/2.2));\r\n\treturn color;\r\n}\r\nstruct FragOutput {\r\n  @location(0) color: vec4<f32>,\r\n  @location(1) vpos: vec4<f32>\r\n}\r\n\r\n@fragment\r\nfn main(\r\n  @location(0) pos: vec4<f32>,\r\n  @location(1) uv: vec2<f32>,\r\n  @location(2) normal: vec3<f32>,\r\n  @location(3) camPos: vec3<f32>\r\n) -> FragOutput {\r\n  var output: FragOutput;\r\n  output.color = vec4(calcPBRColor3(normal, pos.xyz, camPos), 1.0);\r\n  output.vpos = vec4f(camPos.xyz - pos.xyz, 1.0);\r\n  return output;\r\n}"},8777:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("4ad2"),s=i("213f"),n=i("d463"),a=i("f083");class o extends a.WGRPassNodeGraph{constructor(){super()}runBegin(){super.runBegin()}run(){let t=this.passes[0];for(let e=0;e<16;++e)t.colorAttachments[0].clearEnabled=e<1,t.render()}}class l{constructor(){this.mRscene=new r.RendererScene}initialize(){let t=!0,e=!1,i={multisampleEnabled:t,depthTestEnabled:e};this.mRscene.initialize({rpassparam:i}),this.initEvent(),this.initScene()}applyNewRPass(t,e,i,r=[.4,.3,.5,.5]){let s=this.mRscene,a={diffuse:{uuid:t,rttTexture:{}}},l=[{texture:a,clearValue:i,loadOp:"clear",storeOp:"store"}],u=s.renderer.appendRenderPass({separate:!0,colorAttachments:l});for(let n=0;n<e.length;++n)u.addEntity(e[n]);let h=new o;h.passes=[u],s.setPassNodeGraph(h);let c=new n.FixScreenPlaneEntity({extent:r,flipY:!0,textures:[a]});s.addEntity(c)}initEvent(){const t=this.mRscene;(new s.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}initScene(){const t=this.mRscene;let e;const i={diffuse:{url:"static/assets/guangyun_40.png",flipY:!0}};let r=["add"],s=[];e=new n.FixScreenPlaneEntity({extent:[-.8,-.8,.8,.8],textures:[i],blendModes:r}),e.setColor([.9,.3,.9]),t.addEntity(e),s.push(e),this.applyNewRPass("rtt0",s,[.2,.2,.2,1],[-.2,.1,.8,.8])}run(){this.mRscene.run()}}e.PassNodeGraphTest=l},"87b6":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> color: vec4f;\r\n@group(0) @binding(1) var<storage> params: array<vec4<f32>>;\r\n\r\nfn calcColor3(vtxUV: vec2f) -> vec3f{\r\n\r\n\tlet stSize = params[1].zw;\r\n\tlet time = params[2].x;\r\n    let fragCoord = vtxUV * stSize;\r\n\r\n\tlet color1 = vec3f(1.7, 0.25, 0.5);\r\n\tlet color2 = vec3f(0.5, 0.7, 0.25);\r\n\tlet color3 = vec3f(0.25, 0.5, 0.7);\r\n\tlet point1 = stSize * 0.5 + vec2f(sin(time*2.0) * 10.0, cos(time*2.0) * 50.0) * (vtxUV - 0.5) * 4.0;\r\n\tlet point2 = stSize * 0.5 + vec2f(sin(time) * 75.0, cos(time)*50.0);\r\n\tlet point3 = stSize * 0.5 + vec2f(sin(time) * 25.0, sin(time*2.0)*50.0)*2.0;\r\n\t\r\n\tlet dist1 = fragCoord - point1;\r\n\tlet intensity1 = pow(32.0/(0.01+length(dist1)), 2.0);\r\n\t\r\n\tlet dist2 = fragCoord - point2;\r\n\tlet intensity2 = pow(3.0/(0.01+length(dist2)), 2.0);\r\n\t\r\n\tlet dist3 = fragCoord - point3;\r\n\tlet intensity3 = pow(80.0/(0.01+length(dist3)), 1.0);\r\n\t\r\n\treturn vec3f((color1*intensity1 + color2*intensity2 + color3*intensity3)*modf(fragCoord.y/2.0).fract);\r\n}\r\n\r\n@fragment\r\nfn main(\r\n\t@location(0) uv: vec2f\r\n\t) -> @location(0) vec4f {\r\n\t//let c3 = calcColor3(fract(uv/0.5));\r\n\tlet c3 = calcColor3( uv );\r\n\tlet c4 = vec4f(c3.xyz * color.xyz, color.w);\r\n\treturn c4;\r\n}\r\n"},"87f6":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},8875:function(t,e,i){var r,s,n;(function(i,a){s=[],r=a,n="function"===typeof r?r.apply(e,s):r,void 0===n||(t.exports=n)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(m){var i,r,s,n=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,a=/@([^@]*):(\d+):(\d+)\s*$/gi,o=n.exec(m.stack)||a.exec(m.stack),l=o&&o[1]||!1,u=o&&o[2]||!1,h=document.location.href.replace(document.location.hash,""),c=document.getElementsByTagName("script");l===h&&(i=document.documentElement.outerHTML,r=new RegExp("(?:[^\\n]+?\\n){0,"+(u-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),s=i.replace(r,"$1").trim());for(var d=0;d<c.length;d++){if("interactive"===c[d].readyState)return c[d];if(c[d].src===l)return c[d];if(l===h&&c[d].innerHTML&&c[d].innerHTML.trim()===s)return c[d]}return null}}return t}))},8890:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("f3f6")),a=r(i("7ce1")),o=i("943f"),l=i("746a"),u=i("551f"),h=i("cae9"),c=i("58c4");class d{constructor(){this.geomData=new s.GeomDataBuilder,this.renderer=new h.WGRenderer}initialize(){const t={vertShaderSrc:{code:n.default,uuid:"vertShdCode"},fragShaderSrc:{code:a.default,uuid:"fragShdCode"}},e=this.createMaterial(t,[new c.WGImage2DTextureData("static/assets/box.jpg")]);this.createEntity([e])}createMaterial(t,e){let i={faceCullMode:"back"};const r=e?e.length:0,s=new o.WGMaterial({shadinguuid:"base-material-tex"+r,shaderSrc:t,pipelineDefParam:i});return s.addTextureWithDatas(e),s}createEntity(t){const e=this.renderer,i=this.geomData.createCube(200),r=(new l.WGGeometry).addAttribute({shdVarName:"position",data:i.vs,strides:[3]}).addAttribute({shdVarName:"uv",data:i.uvs,strides:[2]}).setIndexBuffer({name:"geomIndex",data:i.ivs}),s=new u.Entity3D;return s.materials=t,s.geometry=r,e.addEntity(s),s}run(){this.renderer.run()}}e.ImgTexturedCube=d},8895:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("992e");class s extends r.HTMLViewerLayer{constructor(){super(),this.mBtnName="",this.mBtnIdns="",this.mSelected=!1,this.mSelectColors=[12442081,11457759,8635607],this.mDeselectColors=[8039642,4887509,3898293],this.group=null,this.onmousedown=null,this.onmouseup=null}initialize(t,e,i){let r=t.style;r.cursor="pointer",r.userSelect="none",this.setViewer(t),this.mBtnName=e,this.mBtnIdns=i,t.innerHTML=e,this.initEvent(t),this.applyColorAt(0)}toRoundedRectangleStyle(t=null){t||(t=this.getStyle()),t.borderRadius="10px",t.outline="none",t.boxShadow="0 0 0 5px #7aacda"}setSelectColors(t){this.mSelectColors=t}setDeselectColors(t){this.mDeselectColors=t}getName(){return this.mBtnName}getIdns(){return this.mBtnIdns}applyColorAt(t){let e=this.mSelected?this.mSelectColors:this.mDeselectColors;this.setBackgroundColor(e[t])}initEvent(t){t.onmouseover=t=>{this.applyColorAt(1)},t.onmouseout=t=>{this.applyColorAt(0)},t.onmouseup=t=>{this.select(),this.applyColorAt(1),this.onmouseup&&(t.buttonTarget=this,t.button_idns=this.mBtnIdns,this.onmouseup(t))},t.onmousedown=t=>{this.applyColorAt(2),this.onmousedown&&(t.buttonTarget=this,t.button_idns=this.mBtnIdns,this.onmousedown(t))}}isSelected(){return this.mSelected}select(){if(null!=this.group){let t=this.group,e=t.length;for(let i=0;i<e;++i)if(t[i].isSelected()){t[i].deselect();break}this.mSelected=!0,this.applyColorAt(0)}}deselect(){null!=this.group&&(this.mSelected=!1,this.applyColorAt(0))}}e.ButtonDivItem=s},"89ff":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("660c");function s(t,{min:e,max:i}){return r.assert(i>=e),Math.min(Math.max(t,e),i)}e.clamp=s},"8a88":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("c812"),s=i("374c");e.BufDataParamType=s.BufDataParamType,e.VtxPipelinDescParam=s.VtxPipelinDescParam;const n=i("b2fd");e.WGRUniformParam=n.WGRUniformParam;class a{constructor(t){this.mUid=a.sUid++,this.mBGLayouts=new Array(8),this.pipeline=new r.GPURenderPipelineEmpty,this.type="render",t&&this.initialize(t)}getUid(){return this.mUid}destroy(){this.mWGCtx&&(this.mWGCtx=null)}initialize(t){t&&!this.mWGCtx&&(this.mWGCtx=t,this.queue=t.queue)}getWGCtx(){return this.mWGCtx}createUniformBufferWithParam(t,e,i=!1){const r={size:t,usage:e,mappedAtCreation:i},s=this.mWGCtx.device.createBuffer(r);return s}createUniformsBuffer(t,e=0,i=!0,r=!1){if(t&&t.sizes.length>0){let r=t.sizes.length,s=e,n=s,a=new Array(r);if(i)for(let e=0;e<r;++e)s=s<=256?s:s%256,s=s>0?256-s:0,n+=s,s=t.sizes[e],a[e]={index:n,size:s},n+=s;else for(let e=0;e<r;++e)s=t.sizes[e],a[e]={index:n,size:s},n+=s;const o={size:n,usage:t.usage,arrayStride:t.arrayStride},l=this.mWGCtx.buffer.createBuffer(o);return l.segs=a,l.arrayStride=t.arrayStride,l}return null}createBindGroupLayout(t){const e=this.mWGCtx.device;return e.createBindGroupLayout(t)}bindGroupDescUpdate(t,e,i,r=0,s){let n=0,a=t.entries,o=!1===s;if(e){const t=e;for(let e=0;e<t.length;++e){const i=t[e];if(!(i.buffer&&i.bufferSize>0))throw Error("Illegal operaiton !!!");{const t=a[e].resource;void 0!==t.offset&&(t.offset=t.shared||o?0:256*r,t.buffer=i.buffer,t.size=i.bufferSize),n++}}}if(i&&i.length>0)for(let l=0;l<i.length;++l){const t=i[l];if(t.texView){let e=a[n++];t.sampler&&e.resource!==t.sampler&&(e.resource=t.sampler),e=a[n++],e.resource!==t.texView&&(e.resource=t.texView)}}}createBindGroupDesc(t,e,i,r=0,s){const n=this.mWGCtx.device;s||this.mBGLayouts[t]||(this.pipeline?this.mBGLayouts[t]=this.pipeline.getBindGroupLayout(t):this.mBGLayouts[t]=this.comppipeline.getBindGroupLayout(t));let a={layout:s||this.mBGLayouts[t],entries:[]},o=0;if(e){const t=e;for(let e=0;e<t.length;++e){const i=t[e];if(i.buffer&&i.bufferSize>0){const t=i.shared?0:256*i.index,e={binding:r+o++,resource:{offset:t,buffer:i.buffer,size:i.bufferSize,shared:i.shared}};a.entries.push(e)}}}if(i&&i.length>0){const t=n.createSampler({magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"});for(let e=0;e<i.length;++e){const s=i[e];if(s.texView){const e={binding:r+o++,resource:s.sampler?s.sampler:t},i={binding:r+o++,resource:s.texView};a.entries.push(e,i)}}}if(a.entries.length<1)throw Error("Illegal operation !!!");return a}createBindGroupObj(t){const e=this.mWGCtx.device;if(t.entries.length<1)throw Error("Illegal operation !!!");const i=e.createBindGroup(t);return i.uid=a.sBindGroupUid++,i}createBindGroupWithDesc(t){return this.createBindGroupObj(t)}createBindGroup(t,e,i,r=0,s){const n=this.createBindGroupDesc(t,e,i,r,s);return this.createBindGroupObj(n)}}a.sUid=0,a.sBindGroupUid=0,e.WGRBindGroupContext=a},"8b6a":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> param: vec4f;\r\n@group(0) @binding(1) var sampler0: sampler;\r\n@group(0) @binding(2) var texture0: texture_2d<f32>;\r\n\r\nfn reinhard(v: vec3<f32>) -> vec3<f32> {\r\n    return v / (vec3<f32>(1.0) + v);\r\n}\r\nfn calcColor(uv: vec2f) -> vec4f {\r\n\r\n    var vpos = textureSample(texture0, sampler0, uv) * param;\r\n\tvar f = clamp((length(vpos.xyz) - 300.0)/200.0, 0.0, 1.0);\r\n\tf = f * f;\r\n\tvpos = vec4f(vec3(f), 1.0);\r\n\r\n    return vpos;\r\n}\r\n\r\n@fragment\r\nfn main(\r\n\t@location(0) uv: vec2f\r\n\t) -> @location(0) vec4f {\r\n\tvar color4 = calcColor( uv );\r\n    return color4;\r\n}\r\n"},"8bc3":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("f3f6")),a=r(i("0bc4")),o=i("943f"),l=i("746a"),u=i("551f"),h=i("cae9"),c=i("58c4"),d=i("e44f"),m=i("7650");class f{constructor(){this.geomData=new s.GeomDataBuilder,this.renderer=new h.WGRenderer,this.mRotY=0}initialize(){new d.WGRStorageValue({data:new Float32Array(16)}),new m.WGRUniformValue({data:new Float32Array(16)});const t={vert:{code:n.default,uuid:"vertShdCode"},frag:{code:a.default,uuid:"fragShdCode"}};let e=this.createMaterial(t,[new c.WGImage2DTextureData("static/assets/box.jpg")],["solid"],"back");this.mEntity=this.createEntity([e])}createMaterial(t,e,i=[],r="back"){let s={depthWriteEnabled:!0,faceCullMode:r,blendModes:[]};s.blendModes=i;const n=e?e.length:0,a=new o.WGMaterial({shadinguuid:"base-material-tex"+n,shaderSrc:t,pipelineDefParam:s});let l={storage:{data:new Float32Array([1,0,0,1]),shdVarName:"param"}};return a.uniformValues=[l],a.addTextureWithDatas(e),a}createEntity(t){const e=this.renderer,i=this.geomData.createSphere(150,30,30),r=(new l.WGGeometry).addAttribute({shdVarName:"position",data:i.vs,strides:[3]}).addAttribute({shdVarName:"uv",data:i.uvs,strides:[2]}).setIndexBuffer({name:"geomIndex",data:i.ivs}),s=new u.Entity3D;return s.materials=t,s.geometry=r,e.addEntity(s),s}run(){this.mRotY+=.5,this.mEntity.transform.setRotationXYZ(0,this.mRotY,this.mRotY+.5),this.mEntity.update(),this.renderer.run()}}e.StorageTest=f},"8e9d":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("2c77")),n=i("fe0b");class a{constructor(){this.clearValue=new s.default,this.loadOp="clear",this.storeOp="store",this.textureFormat="bgra8unorm"}set clearEnabled(t){this.loadOp=t?"clear":"load"}get clearEnabled(){return"clear"===this.loadOp}setParam(t){if(t){this.param=t;let e=this.clearValue;n.copyFromObjectValueWithKey(t,this),e.setColor(this.clearValue),this.clearValue=e,this.texture=t.texture}return this}linkToPrev(t,e){e?(this.view=t.view,this.resolveTarget=t.resolveTarget):this.view=t.view}}e.WGRPColorAttachment=a},9069:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("374c");e.BufDataParamType=r.BufDataParamType;class s{constructor(){this.usage=0,this.groupIndex=0,this.enabled=!0,this.uniformAppend=!0}}e.WGRUniformWrapper=s;class n{constructor(){this.uniformAppend=!0}destroy(){if(this.oldBufs)for(let t=0;t<this.oldBufs.length;++t)this.oldBufs[t].destroy(),this.oldBufs[t]=null;this.oldBufs=null,this.buffers=null}}e.WGRUniformBufObj=n},"90af":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(3) var<storage> albedo: vec4f;\r\n@group(0) @binding(4) var<storage> param: vec4f;\r\n\r\nconst PI = 3.141592653589793;\r\nconst PI2 = 6.283185307179586;\r\nconst PI_HALF = 1.5707963267948966;\r\nconst RECIPROCAL_PI = 0.3183098861837907;\r\nconst RECIPROCAL_PI2 = 0.15915494309189535;\r\nconst EPSILON = 1e-6;\r\n\r\nfn approximationSRGBToLinear(srgbColor: vec3<f32>) -> vec3<f32> {\r\n    return pow(srgbColor, vec3<f32>(2.2));\r\n}\r\nfn approximationLinearToSRCB(linearColor: vec3<f32>) -> vec3<f32> {\r\n    return pow(linearColor, vec3(1.0/2.2));\r\n}\r\n\r\nfn accurateSRGBToLinear(srgbColor: vec3<f32>) -> vec3<f32> {\r\n    let linearRGBLo = srgbColor / 12.92;\r\n    let linearRGBHi = pow((srgbColor + vec3(0.055)) / vec3(1.055), vec3(2.4));\r\n\tif( all( srgbColor <= vec3(0.04045) ) ) {\r\n\t\treturn linearRGBLo;\r\n\t}\r\n    return linearRGBHi;\r\n}\r\nfn accurateLinearToSRGB(linearColor: vec3<f32>) -> vec3<f32> {\r\n    let srgbLo = linearColor * 12.92;\r\n    let srgbHi = (pow(abs(linearColor), vec3(1.0 / 2.4)) * 1.055) - 0.055;\r\n    if(all(linearColor <= vec3(0.0031308))) {\r\n\t\treturn srgbLo;\r\n\t}\r\n    return srgbHi;\r\n}\r\n\r\n// Trowbridge-Reitz(Generalized-Trowbridge-Reitz,GTR)\r\nfn DistributionGTR1(NdotH: f32, roughness: f32) -> f32 {\r\n    if (roughness >= 1.0) {\r\n\t\treturn 1.0/PI;\r\n\t}\r\n    let a2 = roughness * roughness;\r\n    let t = 1.0 + (a2 - 1.0)*NdotH*NdotH;\r\n    return (a2 - 1.0) / (PI * log(a2) *t);\r\n}\r\nfn DistributionGTR2(NdotH: f32, roughness: f32) -> f32 {\r\n    let a2 = roughness * roughness;\r\n    let t = 1.0 + (a2 - 1.0) * NdotH * NdotH;\r\n    return a2 / (PI * t * t);\r\n}\r\n\r\n\r\nfn DistributionGGX(N: vec3<f32>, H: vec3<f32>, roughness: f32) -> f32 {\r\n    let a = roughness*roughness;\r\n    let a2 = a*a;\r\n    let NdotH = max(dot(N, H), 0.0);\r\n    let NdotH2 = NdotH*NdotH;\r\n\r\n    let nom   = a2;\r\n    var denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    denom = PI * denom * denom;\r\n\r\n    return nom / max(denom, 0.0000001); // prevent divide by zero for roughness=0.0 and NdotH=1.0\r\n}\r\n\r\n\r\nfn GeometryImplicit(NdotV: f32, NdotL: f32) -> f32 {\r\n    return NdotL * NdotV;\r\n}\r\n\r\n// ----------------------------------------------------------------------------\r\nfn GeometrySchlickGGX(NdotV: f32, roughness: f32) -> f32 {\r\n    let r = (roughness + 1.0);\r\n    let k = (r*r) / 8.0;\r\n\r\n    let nom   = NdotV;\r\n    let denom = NdotV * (1.0 - k) + k;\r\n\r\n    return nom / denom;\r\n}\r\n// ----------------------------------------------------------------------------\r\nfn GeometrySmith(N: vec3<f32>, V: vec3<f32>, L: vec3<f32>, roughness: f32) -> f32 {\r\n    let NdotV = max(dot(N, V), 0.0);\r\n    let NdotL = max(dot(N, L), 0.0);\r\n    let ggx2 = GeometrySchlickGGX(NdotV, roughness);\r\n    let ggx1 = GeometrySchlickGGX(NdotL, roughness);\r\n\r\n    return ggx1 * ggx2;\r\n}\r\n\r\n// @param cosTheta is clamp(dot(H, V), 0.0, 1.0)\r\nfn fresnelSchlick(cosTheta: f32, F0: vec3<f32>) -> vec3<f32> {\r\n    return F0 + (1.0 - F0) * pow(max(1.0 - cosTheta, 0.0), 5.0);\r\n}\r\nfn fresnelSchlick2(specularColor: vec3<f32>, L: vec3<f32>, H: vec3<f32>) -> vec3<f32> {\r\n   return specularColor + (1.0 - specularColor) * pow(1.0 - saturate(dot(L, H)), 5.0);\r\n}\r\n//fresnelSchlick2(specularColor, L, H) * ((SpecularPower + 2) / 8 ) * pow(saturate(dot(N, H)), SpecularPower) * dotNL;\r\n\r\nconst OneOnLN2_x6 = 8.656171;// == 1/ln(2) * 6 (6 is SpecularPower of 5 + 1)\r\n// dot -> dot(N,V) or\r\nfn fresnelSchlick3(specularColor: vec3<f32>, dot: f32, glossiness: f32) -> vec3<f32> {\r\n\treturn specularColor + (max(vec3(glossiness), specularColor) - specularColor) * exp2(-OneOnLN2_x6 * dot);\r\n}\r\nfn fresnelSchlickWithRoughness(specularColor: vec3<f32>, L: vec3<f32>, N: vec3<f32>, gloss: f32) -> vec3<f32> {\r\n   return specularColor + (max(vec3(gloss), specularColor) - specularColor) * pow(1.0 - saturate(dot(L, N)), 5.0);\r\n}\r\n\r\nconst A = 2.51f;\r\nconst B = 0.03f;\r\nconst C = 2.43f;\r\nconst D = 0.59f;\r\nconst E = 0.14f;\r\nfn ACESToneMapping(color: vec3<f32>, adapted_lum: f32) -> vec3<f32> {\r\n\r\n\tlet c = color * adapted_lum;\r\n\treturn (c * (A * c + B)) / (c * (C * c + D) + E);\r\n}\r\n\r\n//color = color / (color + vec3(1.0));\r\nfn reinhard(v: vec3<f32>) -> vec3<f32> {\r\n    return v / (vec3<f32>(1.0) + v);\r\n}\r\nfn reinhard_extended(v: vec3<f32>, max_white: f32) -> vec3<f32> {\r\n    let numerator = v * (1.0f + (v / vec3(max_white * max_white)));\r\n    return numerator / (1.0f + v);\r\n}\r\nfn luminance(v: vec3<f32>) -> f32 {\r\n    return dot(v, vec3<f32>(0.2126f, 0.7152f, 0.0722f));\r\n}\r\n\r\nfn change_luminance(c_in: vec3<f32>, l_out: f32) -> vec3<f32> {\r\n    let l_in = luminance(c_in);\r\n    return c_in * (l_out / l_in);\r\n}\r\nfn reinhard_extended_luminance(v: vec3<f32>, max_white_l: f32) -> vec3<f32> {\r\n    let l_old = luminance(v);\r\n    let numerator = l_old * (1.0f + (l_old / (max_white_l * max_white_l)));\r\n    let l_new = numerator / (1.0f + l_old);\r\n    return change_luminance(v, l_new);\r\n}\r\nfn ReinhardToneMapping( color: vec3<f32>, toneMappingExposure: f32 ) -> vec3<f32> {\r\n\r\n\tlet c = color * toneMappingExposure;\r\n\treturn saturate( c / ( vec3( 1.0 ) + c ) );\r\n\r\n}\r\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\r\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\r\nconst highp_a = 12.9898;\r\nconst highp_b = 78.233;\r\nconst highp_c = 43758.5453;\r\nfn rand( uv: vec2<f32> ) -> f32 {\r\n\tlet dt = dot( uv.xy, vec2<f32>( highp_a, highp_b ) );\r\n\tlet sn = modf( dt / PI ).fract;\r\n\treturn fract(sin(sn) * highp_c);\r\n}\r\n// // based on https://www.shadertoy.com/view/MslGR8\r\nfn dithering( color: vec3<f32>, fragCoord: vec2<f32> ) -> vec3<f32> {\r\n    //Calculate grid position\r\n    let grid_position = rand( fragCoord );\r\n\r\n    //Shift the individual colors differently, thus making it even harder to see the dithering pattern\r\n    var dither_shift_RGB = vec3<f32>( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\r\n\r\n    //modify shift acording to grid position.\r\n    dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\r\n\r\n    //shift the color by dither_shift\r\n    return color + dither_shift_RGB;\r\n}\r\n\r\nconst dis = 700.0;\r\nconst disZ = 400.0;\r\nconst u_lightPositions = array<vec3<f32>, 4>(\r\n\tvec3<f32>(-dis, dis, disZ),\r\n\tvec3<f32>(dis, dis, disZ),\r\n\tvec3<f32>(-dis, -dis, disZ),\r\n\tvec3<f32>(dis, -dis, disZ)\r\n);\r\nconst colorValue = 300.0;\r\nconst u_lightColors = array<vec3<f32>, 4>(\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n\tvec3<f32>(colorValue, colorValue, colorValue),\r\n);\r\n\r\nfn calcPBRColor3(Normal: vec3<f32>, WorldPos: vec3<f32>, camPos: vec3<f32>) -> vec3<f32> {\r\n\r\n\tvar color = vec3<f32>(0.0);\r\n\r\n    var ao = param.x;\r\n    var roughness = param.y;\r\n    var metallic = param.z;\r\n\r\n\tvar N = normalize(Normal);\r\n    var V = normalize(camPos.xyz - WorldPos);\r\n    var dotNV = clamp(dot(N, V), 0.0, 1.0);\r\n\r\n    // calculate reflectance at normal incidence; if dia-electric (like plastic) use F0\r\n    // of 0.04 and if it's a metal, use the albedo color as F0 (metallic workflow)\r\n    var F0 = vec3(0.04);\r\n    F0 = mix(F0, albedo.xyz, metallic);\r\n\r\n    // reflectance equation\r\n    var Lo = vec3(0.0);\r\n    \r\n\tfor (var i: i32 = 0; i < 4; i++) {\r\n\t\t// calculate per-light radiance\r\n        let L = normalize(u_lightPositions[i].xyz - WorldPos);\r\n        let H = normalize(V + L);\r\n        let distance = length(u_lightPositions[i].xyz - WorldPos);\r\n\r\n        let attenuation = 1.0 / (1.0 + 0.001 * distance + 0.0003 * distance * distance);\r\n        let radiance = u_lightColors[i].xyz * attenuation;\r\n\r\n        // Cook-Torrance BRDF\r\n        let NDF = DistributionGGX(N, H, roughness);\r\n        let G   = GeometrySmith(N, V, L, roughness);\r\n        //vec3 F    = fresnelSchlick(clamp(dot(H, V), 0.0, 1.0), F0);\r\n        let F    = fresnelSchlick3(F0,clamp(dot(H, V), 0.0, 1.0), 0.9);\r\n        //vec3 F    = fresnelSchlick3(F0,dotNV, 0.9);\r\n\r\n        let nominator    = NDF * G * F;\r\n        let denominator = 4.0 * max(dot(N, V), 0.0) * max(dot(N, L), 0.0);\r\n        let specular = nominator / max(denominator, 0.001); // prevent divide by zero for NdotV=0.0 or NdotL=0.0\r\n\r\n        // kS is equal to Fresnel\r\n        let kS = F;\r\n        // for energy conservation, the diffuse and specular light can't\r\n        // be above 1.0 (unless the surface emits light); to preserve this\r\n        // relationship the diffuse component (kD) should equal 1.0 - kS.\r\n        var kD = vec3<f32>(1.0) - kS;\r\n        // multiply kD by the inverse metalness such that only non-metals\r\n        // have diffuse lighting, or a linear blend if partly metal (pure metals\r\n        // have no diffuse light).\r\n        kD *= 1.0 - metallic;\r\n\r\n        // scale light by NdotL\r\n        let NdotL = max(dot(N, L), 0.0);\r\n\r\n        // add to outgoing radiance Lo\r\n        // note that we already multiplied the BRDF by the Fresnel (kS) so we won't multiply by kS again\r\n        Lo += (kD * albedo.xyz / PI + specular) * radiance * NdotL;\r\n\t}\r\n\t// ambient lighting (note that the next IBL tutorial will replace\r\n    // this ambient lighting with environment lighting).\r\n    let ambient = vec3<f32>(0.03) * albedo.xyz * ao;\r\n\r\n    color = ambient + Lo;\r\n    // HDR tonemapping\r\n    color = reinhard( color );\r\n    // gamma correct\r\n    color = pow(color, vec3<f32>(1.0/2.2));\r\n\treturn color;\r\n}\r\n\r\n@fragment\r\nfn main(\r\n  @location(0) pos: vec4<f32>,\r\n  @location(1) uv: vec2<f32>,\r\n  @location(2) normal: vec3<f32>,\r\n  @location(3) camPos: vec3<f32>\r\n) -> @location(0) vec4<f32> {\r\n  var color4 = vec4(calcPBRColor3(normal, pos.xyz, camPos), 1.0);\r\n  return color4;\r\n}\r\n"},9243:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("af80")),n=r(i("c3d6")),a=r(i("3e40")),o=r(i("98bb")),l=r(i("348f")),u=i("fe0b");class h extends l.default{constructor(){super(),this.mLongitudeNumSegments=10,this.mLatitudeNumSegments=10,this.mRadius=50,this.inverseUV=!1,this.uvScale=1,this.mode=0}getVS(){return this.mvs}getUVS(){return this.muvs}getNVS(){return this.mnvs}getIVS(){return this.mivs}initialize(t,e,i,r){if(this.vtxTotal<1){t<1e-4&&(t=1e-4),this.bounds=new a.default,e<2&&(e=2),i<2&&(i=2),this.mRadius=Math.abs(t),this.mLongitudeNumSegments=e,this.mLatitudeNumSegments=i,(this.mLatitudeNumSegments+1)%2==0&&(this.mLatitudeNumSegments+=1),(this.mLongitudeNumSegments=this.mLatitudeNumSegments)&&(this.mLongitudeNumSegments+=1);let s=1,n=0,l=0,h=0,c=0,d=0,m=0,f=new o.default(0,-this.mRadius,0,l),p=[],v=[];v.push([]);let g=v[0],b=this.inverseUV?1:.5;f.u=f.v=b,f.nx=0,f.ny=-1,f.nz=0;let y=f.cloneVertex();for(n=0;n<=this.mLongitudeNumSegments;++n)g.push(y);p.push(y);let _=0,x=0,w=1/this.mRadius;for(s=1;s<this.mLatitudeNumSegments;++s){c=Math.PI*s/this.mLatitudeNumSegments,d=Math.sin(c),m=Math.cos(c),f.y=-this.mRadius*m,_=this.mRadius*d,x=this.inverseUV?Math.abs(c/Math.PI-.5):.5-Math.abs(c/Math.PI-.5),x*=this.uvScale,v.push([]);let t=v[s];for(n=0;n<this.mLongitudeNumSegments;++n)h=2*Math.PI*n/this.mLongitudeNumSegments,++l,d=Math.sin(h),m=Math.cos(h),f.x=d*_,f.z=m*_,f.index=l,f.u=.5+d*x,f.v=.5+m*x,f.nx=f.x*w,f.ny=f.y*w,f.nz=f.z*w,t.push(f.cloneVertex()),p.push(t[n]);t.push(t[0])}++l,f.index=l,f.x=0,f.y=this.mRadius,f.z=0,f.u=f.v=b,f.nx=0,f.ny=1,f.nz=0,v.push([]);let S=v[this.mLatitudeNumSegments],M=f.cloneVertex();for(n=0;n<=this.mLongitudeNumSegments;++n)S.push(M);p.push(M);let P=null,T=[],E=null,C=null,R=this.mLatitudeNumSegments;if(1==this.mode){let e=R/2+1;for(s=e;s<=R;++s)for(E=v[s-1],C=v[s],n=1;n<=this.mLongitudeNumSegments;++n)T.push(E[n].index),T.push(C[n-1].index),T.push(E[n-1].index),T.push(E[n].index),T.push(C[n].index),T.push(C[n-1].index);this.bounds.min.setXYZ(-t,0,-t),this.bounds.max.setXYZ(t,t,t)}else if(-1==this.mode){let e=R/2+1;for(s=1;s<e;++s)for(E=v[s-1],C=v[s],n=1;n<=this.mLongitudeNumSegments;++n)T.push(E[n].index),T.push(C[n-1].index),T.push(E[n-1].index),T.push(E[n].index),T.push(C[n].index),T.push(C[n-1].index);this.bounds.min.setXYZ(-t,-t,-t),this.bounds.max.setXYZ(t,0,t)}else if(2==this.mode){let e=R/2+1,i=e-1,r=v[i].slice(),a=r.length-1;for(s=0;s<a;++s)f=r[s].cloneVertex(),++l,f.index=l,r[s]=f,p.push(f);r[r.length-1]=r[0];let o=[];for(s=0;s<e;++s)o.push(v[s]);o[o.length-1]=r;let u=v,g=[];for(s=e-1;s<=R;++s)g.push(v[s]);for(s=1;s<e;++s){c=Math.PI*s/this.mLatitudeNumSegments,d=Math.sin(c),m=Math.cos(c),x=this.inverseUV?Math.abs(c/Math.PI-.5):.5-Math.abs(c/Math.PI-.5),x*=this.uvScale;const t=o[s];for(n=0;n<this.mLongitudeNumSegments;++n)f=t[n],h=2*Math.PI*n/this.mLongitudeNumSegments,f.u=.25+Math.sin(h)*x*.5,f.v=.5+Math.cos(h)*x}for(f=o[0][0],f.u=.25,f.v=.5,s=e-1;s<R;++s){c=Math.PI*s/this.mLatitudeNumSegments,d=Math.sin(c),m=Math.cos(c),x=this.inverseUV?Math.abs(c/Math.PI-.5):.5-Math.abs(c/Math.PI-.5),x*=this.uvScale;const t=u[s];for(n=0;n<this.mLongitudeNumSegments;++n)f=t[n],h=2*Math.PI*n/this.mLongitudeNumSegments,f.u=.75+Math.sin(h)*x*.5,f.v=.5+Math.cos(h)*x}for(f=u[u.length-1][0],f.u=.75,f.v=.5,s=1;s<e;++s)for(E=o[s-1],C=o[s],n=1;n<=this.mLongitudeNumSegments;++n)T.push(E[n].index),T.push(C[n-1].index),T.push(E[n-1].index),T.push(E[n].index),T.push(C[n].index),T.push(C[n-1].index);for(s=e;s<=R;++s)for(E=u[s-1],C=u[s],n=1;n<=this.mLongitudeNumSegments;++n)T.push(E[n].index),T.push(C[n-1].index),T.push(E[n-1].index),T.push(E[n].index),T.push(C[n].index),T.push(C[n-1].index);this.bounds.min.setXYZ(-t,-t,-t),this.bounds.max.setXYZ(t,t,t)}else{for(s=1;s<=R;++s)for(E=v[s-1],C=v[s],n=1;n<=this.mLongitudeNumSegments;++n)T.push(E[n].index),T.push(C[n-1].index),T.push(E[n-1].index),T.push(E[n].index),T.push(C[n].index),T.push(C[n-1].index);this.bounds.min.setXYZ(-t,-t,-t),this.bounds.max.setXYZ(t,t,t)}for(this.bounds.updateFast(),this.vtxTotal=p.length,r?(this.mivs=u.createIndexArrayWithSize(2*T.length),this.mivs.set(T,0),T.reverse(),this.mivs.set(T,T.length)):this.mivs=u.createIndexArray(T),this.mvs=new Float32Array(3*this.vtxTotal),s=0,n=0;n<this.vtxTotal;++n)P=p[n],this.mvs[s++]=P.x,this.mvs[s++]=P.y,this.mvs[s++]=P.z;for(this.muvs=new Float32Array(2*this.vtxTotal),s=0,n=0;n<this.vtxTotal;++n)P=p[n],this.muvs[s]=P.u,this.muvs[s+1]=P.v,s+=2;for(this.mnvs=new Float32Array(3*this.vtxTotal),s=0,n=0;n<this.vtxTotal;++n)P=p[n],this.mnvs[s]=P.nx,this.mnvs[s+1]=P.ny,this.mnvs[s+2]=P.nz,s+=3;this.vtCount=this.mivs.length,this.trisNumber=this.vtCount/3}}__$destroy(){this.mivs&&(this.bounds=null,this.mvs=null,this.muvs=null,this.mnvs=null,super.__$destroy())}testRay(t,e,i,r){return n.default.IntersectioNearSphere2(t,e,s.default.ZERO,this.mRadius,i)}}e.default=h},9290:function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(3) var<storage> param: vec4f;\r\n@group(0) @binding(4) var sampler0: sampler;\r\n@group(0) @binding(5) var texture0: texture_2d<f32>;\r\n\r\nconst lightDirec = vec3<f32>(0.3,0.6,0.9);\r\n\r\n@fragment\r\nfn main(\r\n  @location(0) pos: vec4<f32>,\r\n  @location(1) uv: vec2<f32>,\r\n  @location(2) normal: vec3<f32>\r\n) -> @location(0) vec4<f32> {\r\n\r\n  let nDotL = max(dot(normal, lightDirec), 0.0);\r\n  var color4 = textureSample(texture0, sampler0, uv) * param;\r\n  color4 = vec4(color4.xyz * (vec3<f32>(1.0 - param.w) + vec3<f32>((param.w) * nDotL) * param.xyz), color4.w);\r\n  return color4;\r\n}\r\n"},9355:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("4ad2"),n=i("d463"),a=i("2fc9"),o=i("fe0b"),l=r(i("d36d")),u=r(i("4c75"));class h{constructor(){this.mRscene=new s.RendererScene}initialize(){let t=()=>{this.initScene(),this.initAssets()};this.mRscene.initialize({callback:t})}initAssets(){let t=!0,e="static/bytes/spe.mdf";t&&(e="static/bytes/spb.bin"),(new a.HttpFileLoader).load(e,(e,i)=>{this.buildFloatTex(t,e)})}buildFloatTex(t,e){t||this.parseFloat(e)}parseFloat(t){let e,i=0,r=128,s=128,n=3,a=new Float32Array(t),l=o.calculateMipLevels(r,s);for(let o=0;o<l;o++){for(let t=0;t<6;t++){const t=r*s*n;e=a.subarray(i,i+t),i+=t}r>>=1,s>>=1}}applyRGBAFloat16Tex(){let t=this.mRscene,e=256,i=256,r=4,s=new Float32Array(e*i*r),a=1,o=0;for(let n=0;n<i;++n)for(let t=0;t<e;++t)o=(e*n+t)*r,s[o]=a*(t/e),s[o+1]=a*(.5+.5*Math.sin(10*(1-t/e))),s[o+2]=a*(1-n*t/(e*i)),s[o+3]=1*a;const l={diffuse:{uuid:"tex0",dataTexture:{data:s,width:e,height:i},format:"rgba16float",generateMipmaps:!0}};let u=new n.FixScreenPlaneEntity({extent:[-.8,-.8,.6,.6],textures:[l]});t.addEntity(u)}applyRGB9E5UFloatTex(){let t=this.mRscene,e=8,i=8,r=3,s=new Float32Array(e*i*r),a=1,o=0;for(let n=0;n<i;++n)for(let t=0;t<e;++t)o=(e*n+t)*r,s[o]=a*(t/e),s[o+1]=a*(.5+.5*Math.sin(10*(1-t/e))),s[o+2]=a*(1-n*t/(e*i));const h={diffuse:{uuid:"texreb9e5u",dataTexture:{data:s,width:e,height:i},format:"rgb9e5ufloat",generateMipmaps:!0}};let c={vert:{code:l.default,uuid:"vert"},frag:{code:u.default,uuid:"frag"}},d=new n.FixScreenPlaneEntity({shadinguuid:"texreb9e5uM",shaderSrc:c,extent:[-.3,-.3,.6,.6],textures:[h]});t.addEntity(d)}applyRGBA8Tex(){let t=this.mRscene,e=256,i=256,r=4,s=new Uint8Array(e*i*r),a=0;for(let n=0;n<i;++n)for(let t=0;t<e;++t)a=4*(e*n+t),s[a]=t/e*255|0,s[a+1]=255*(.5+.5*Math.sin(10*(1-t/e)))|0,s[a+2]=255*(1-n*t/(e*i))|0,s[a+3]=255;let o={diffuse:{uuid:"texRGBA8Tex",dataTexture:{data:s,width:e,height:i},format:"rgba8unorm",generateMipmaps:!1}},l=new n.FixScreenPlaneEntity({shadinguuid:"texRGBA8",extent:[.2,.2,.6,.6],textures:[o]});t.addEntity(l)}initScene(){this.applyRGBAFloat16Tex(),this.applyRGB9E5UFloatTex(),this.applyRGBA8Tex()}run(){this.mRscene.run()}}e.FloatTextureTest=h},"943f":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("58c4");e.WGTextureDataDescriptor=r.WGTextureDataDescriptor;const s=i("bf93");e.WGRShderSrcType=s.WGRShderSrcType;const n=i("3850");e.checkMaterialRPasses=n.checkMaterialRPasses;class a{constructor(t){this.mUid=a.sUid++,this.mREnabled=!1,this.shadinguuid="default-material",this.rpass={rpass:{index:0}},this.instanceCount=1,this.visible=!0,this.setDescriptor(t)}get uid(){return this.mUid}addTextureWithDatas(t,e){if(t)if(e)for(let i=0;i<t.length;++i)this.addTextureWithData(t[i],e[i]);else for(let i=0;i<t.length;++i)this.addTextureWithData(t[i]);return this}addTextureWithData(t,e=""){""===e&&(e="texture"+(this.textures?this.textures.length:0)),this.addTextureWithParam({texture:{data:t,shdVarName:e}})}addTextureWithParam(t){this.textures?this.textures.push(new r.WGTextureWrapper(t)):this.textures=[new r.WGTextureWrapper(t)]}addTextureWithParams(t){for(let e=0;e<t.length;++e)this.addTextureWithParam(t[e])}addTexture(t){const e=r.createDataWithDescriptor(t);return this.addTextureWithData(e,t.shdVarName),this}addTextures(t){if(t)for(let e=0;e<t.length;++e)this.addTexture(t[e]);return this}isREnabled(){if(this.mREnabled)return this.mREnabled;const t=this.textures;if(t)for(let e=0;e<t.length;++e){const i=t[e];if(!i.texture||!i.texture.texture)return!1}return this.mREnabled=!0,this.mREnabled}getRCtx(){return this.mRCtx}setDescriptor(t){const e=t;e&&(e.shadinguuid&&(this.shadinguuid=e.shadinguuid),e.shaderSrc&&(this.shaderSrc=e.shaderSrc),e.pipelineVtxParam&&(this.pipelineVtxParam=e.pipelineVtxParam),e.pipelineDefParam&&(this.pipelineDefParam=e.pipelineDefParam),e.rpass&&(this.rpass=e.rpass),void 0!==e.uniformAppend&&(this.uniformAppend=e.uniformAppend),e.uniformValues&&(this.uniformValues=e.uniformValues),void 0!==e.instanceCount&&(this.instanceCount=e.instanceCount))}initialize(t){if(!this.mRCtx){if(!t)throw Error("pipelineCtx is undefined.");this.mRCtx=t}}copyfrom(t){return this}destroy(){this.mRCtx&&(this.mRCtx=null)}}a.sUid=0,e.WGMaterial=a},"949a":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("5df3"),n=i("6524"),a=r(i("c69e"));class o{constructor(){this.m_stage3D=null,this.m_dragSwinger=new s.CamDragSwinger,this.m_dragSlider=new n.CamDragSlider,this.m_swing=!0,this.buttonType=0,this.bgEventEnabled=!0}initialize(t,e){if(null==this.m_stage3D){this.m_stage3D=t,this.m_dragSwinger.initialize(t,e),this.m_dragSlider.initialize(t,e);const i=a.default;let r=i.MOUSE_DOWN;this.bgEventEnabled&&(r=i.MOUSE_BG_DOWN);let s=i.MOUSE_UP;1==this.buttonType?(r=this.bgEventEnabled?i.MOUSE_BG_MIDDLE_DOWN:i.MOUSE_MIDDLE_DOWN,s=i.MOUSE_MIDDLE_UP):2==this.buttonType&&(r=this.bgEventEnabled?i.MOUSE_BG_RIGHT_DOWN:i.MOUSE_RIGHT_DOWN,s=i.MOUSE_RIGHT_UP,document.oncontextmenu=function(t){t.preventDefault()}),t.addEventListener(r,this.mouseDownListener.bind(this),!0,!1),t.addEventListener(s,this.mouseUpListener.bind(this),!0,!0)}}setSlideSpeed(t){this.m_dragSlider.slideSpeed=t}enableSwing(){this.m_swing=!0}isEnabledSwing(){return this.m_swing}enableSlide(){this.m_swing=!1}mouseDownListener(t){this.attach()}mouseUpListener(t){this.detach()}attach(){this.m_dragSwinger.attach(),this.m_dragSlider.attach()}detach(){this.m_dragSwinger.detach(),this.m_dragSlider.detach()}runWithYAxis(){this.m_swing?this.m_dragSwinger.runWithYAxis():this.m_dragSlider.run()}runWithZAxis(){this.m_swing?this.m_dragSwinger.runWithZAxis():this.m_dragSlider.run()}}e.default=o},"964e":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(3) var<uniform> color: vec4f;\r\n\r\n@fragment\r\nfn main() -> @location(0) vec4<f32> {\r\n  var color4 = color;\r\n  return color4;\r\n}"},9711:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{static AddContainerFlag(t){return 2147483648|t}static RemoveContainerFlag(t){return-2147483649&t}static AddSpaceUid(t,e){return-1048576&t|e}static RemoveSpaceUid(t){return-1048576&t}static GetSpaceUid(t){return 1048575&t}static AddRendererUid(t,e){return-133169153&t|e<<20}static RemoveRendererUid(t){return 133169152|t}static GetRendererUid(t){return t=(133169152&t)>>20,t<127?t:-1}static TestRendererUid(t){return t=(133169152&t)>>20,t<127}static AddSortEnabled(t){return 1073741824|t}static RemoveSortEnabled(t){return-1073741825&t}static TestSortEnabled(t){return 1073741824==(1073741824&t)}static AddRendererLoad(t){return 805306368|t}static RemoveRendererLoad(t){return-805306369&t}static TestSpaceContains(t){return(1048575&t)>0}static TestSpaceEnabled(t){return(1048575&t)<1}static TestSpaceEnabled2(t){return(1048575&t)<1&&2147483648!=(2147483648&t)}static TestContainerEnabled(t){return 133169152==(133169152&t)&&2147483648!=(2147483648&t)}static TestRendererEnabled(t){return 133169152==(938475520&t)&&2147483648!=(2147483648&t)}}r.DEFAULT=133169152,r.CONTAINER_FLAG=2147483648,r.CONTAINER_NOT_FLAG=-2147483649,r.SPACE_FLAG=1048575,r.SPACE_NOT_FLAG=-1048576,r.RENDERER_UID_FLAG=133169152,r.RENDERER_UID_NOT_FLAG=-133169153,r.RENDERER_UID_INVALID=127,r.SORT_FLAG=1073741824,r.SORT_NOT_FLAG=-1073741825,r.RENDERER_LOAD_FLAG=805306368,r.RENDERER_LOAD_NOT_FLAG=-805306369,r.RENDERER_ADN_LOAD_FLAG=938475520,e.default=r},"97f2":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("1eee"),n=r(i("ebca"));class a extends s.PrimitiveEntity{constructor(t){super(t)}getGeometryData(t){t||(t={}),void 0===t.radius&&(t.radius=100),void 0===t.height&&(t.height=200),void 0===t.longitudeNumSegments&&(t.longitudeNumSegments=20),void 0===t.alignYRatio&&(t.alignYRatio=-.5);let e=new n.default;return e.initialize(t.radius,t.height,t.longitudeNumSegments,t.alignYRatio),e}}e.ConeEntity=a},9849:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("1eee"),n=r(i("9243"));class a extends s.PrimitiveEntity{constructor(t){super(t)}getGeometryData(t){t||(t={}),void 0===t.radius&&(t.radius=100),void 0===t.longitudeNumSegments&&(t.longitudeNumSegments=20),void 0===t.latitudeNumSegments&&(t.latitudeNumSegments=20);let e=new n.default;return e.initialize(t.radius,t.longitudeNumSegments,t.latitudeNumSegments,!1),e}}e.SphereEntity=a},"98bb":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t=0,e=0,i=0,r=0){this.x=0,this.y=0,this.z=0,this.u=0,this.v=1,this.nx=0,this.ny=0,this.nz=0,this.index=0,this.f=0,this.x=t,this.y=e,this.z=i,this.index=r}cloneVertex(){let t=new r(this.x,this.y,this.z,this.index);return t.nx=this.nx,t.ny=this.ny,t.nz=this.nz,t.u=this.u,t.v=this.v,t.f=this.f,t}copyFrom(t){this.x=t.x,this.y=t.y,this.z=t.z,this.u=t.u,this.v=t.v,this.nx=t.nx,this.ny=t.ny,this.nz=t.nz,this.index=t.index,this.f=t.f}}e.default=r},"992e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("c58a");class s{constructor(t=null){this.unit="px",this.m_viewer=t,t&&(this.mStyle=t.style)}getDiv(){return this.m_viewer}getStyle(){return this.m_viewer.style}setViewer(t){this.m_viewer=t,t&&(this.mStyle=t.style)}setInnerHTML(t){this.m_viewer.innerHTML=t}clearInnerHTML(){this.m_viewer.innerHTML=""}setDisplayMode(t="block"){""!=t&&(this.mStyle.display=t)}setPositionMode(t="relative"){""!=t&&(this.mStyle.position=t)}setTextSize(t){this.mStyle.fontSize=t}setTextAlign(t){this.mStyle.textAlign=t}contentAlignToCenter(){let t=this.mStyle;t.textAlign="center",t.alignItems="center",t.justifyContent="center"}layoutToCenter(t=0,e=0){let i=this.m_viewer.getBoundingClientRect(),r=this.m_viewer.parentElement.getBoundingClientRect(),s=.5*(r.width-i.width)+t,n=.5*(r.height-i.height)+e;this.setXY(s,n)}setXY(t,e){this.mStyle.left=t+this.unit,this.mStyle.top=e+this.unit}setX(t){this.mStyle.left=t+this.unit}setY(t){this.mStyle.top=t+this.unit}setSize(t,e){t>0&&e>0&&(this.mStyle.width=t+this.unit,this.mStyle.height=e+this.unit)}setWidth(t){t>0&&(this.mStyle.width=t+this.unit)}setHeight(t){t>0&&(this.mStyle.height=t+this.unit)}uint24ToHtmlColor(t){let e=t.toString(16),i=6-e.length;for(let r=0;r<i;++r)e="0"+e;return e="#"+e,e}setTextColor(t,e=1){this.mStyle.color=this.uint24ToHtmlColor(t)}setBackgroundColor(t,e=1){this.mStyle.backgroundColor=this.uint24ToHtmlColor(t)}setVisible(t){r.DivTool.setVisible(this.m_viewer,t)}isVisible(){return r.DivTool.isVisible(this.m_viewer)}show(){this.setVisible(!0)}hide(){this.setVisible(!1)}clearDivAllEles(){r.DivTool.clearDivAllEles(this.m_viewer)}getRect(){return this.m_viewer.getBoundingClientRect()}}e.HTMLViewerLayer=s},"993b":function(t,e,i){"use strict";i.r(e),e["default"]="@fragment\r\nfn main(\r\n  @location(0) fragPosition: vec4<f32>\r\n) -> @location(0) vec4<f32> {\r\n  return fragPosition;\r\n}"},"9b05":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=r(i("af80"));class a{constructor(){this.m_camera=null,this.m_touchZoomBoo=!1,this.m_preDis=0,this.m_touchZoomSpd=2,this.m_slideSpd=1,this.m_mouseWheelZoomSpd=6,this.m_fowardDis=0,this.m_initBoo=!0,this.m_lookAtCtrlEnabled=!0,this.m_flagDrag=0,this.m_flagZoom=0,this.m_windowsEnvFlag=!0,this.syncLookAt=!1,this.m_flagType=2,this.m_windowsEnvFlag=!0}setMobileZoomSpeed(t){this.m_touchZoomSpd=t}seSlideSpeed(t){this.m_slideSpd=t}setMouseWheelZoomSpd(t){this.m_mouseWheelZoomSpd=t}bindCamera(t){this.m_camera=t}createVec3(){return new n.default}initialize(t){this.m_initBoo&&(this.m_initBoo=!1,this.m_tempa=this.createVec3(),this.m_tempb=this.createVec3(),this.m_preva=this.createVec3(),this.m_prevb=this.createVec3(),this.m_va=this.createVec3(),this.m_vb=this.createVec3(),this.m_lookAt=this.createVec3(),this.m_lookAtPos=this.createVec3(),t.addEventListener(s.default.MOUSE_WHEEL,this.mouseWheelListener.bind(this),!0,!0),t.addEventListener(s.default.MOUSE_MULTI_MOVE,this.mouseMultiMoveListener.bind(this),!0,!0),t.addEventListener(s.default.MOUSE_MULTI_UP,this.mouseMultiUpListener.bind(this),!0,!0))}setLookAtCtrlEnabled(t){this.m_lookAtCtrlEnabled=t}mouseWheelListener(t){t.wheelDeltaY>0?this.m_fowardDis+=this.m_mouseWheelZoomSpd:this.m_fowardDis-=this.m_mouseWheelZoomSpd}mouseMultiMoveListener(t){this.setTouchPosArray(t.posArray)}mouseMultiUpListener(t){this.setTouchPosArray(t.posArray)}resetState(){this.m_flagDrag=0,this.m_flagZoom=0,this.m_flagType=0}setTouchPosArray(t){if(null!=t&&t.length>1){let e=0;if(this.m_va.setXYZ(t[0].x,t[0].y,0),this.m_vb.setXYZ(t[1].x,t[1].y,0),this.m_touchZoomBoo){e=n.default.Distance(this.m_va,this.m_vb),this.m_flagType<1?(this.m_tempa.copyFrom(this.m_va),this.m_tempb.copyFrom(this.m_vb),this.m_tempa.subVecsTo(this.m_va,this.m_preva),this.m_tempb.subVecsTo(this.m_vb,this.m_prevb),this.m_tempa.normalize(),this.m_tempb.normalize(),this.m_tempa.dot(this.m_tempb)>.9?this.m_flagDrag++:this.m_flagZoom++,(this.m_flagDrag>3||this.m_flagZoom>3)&&(this.m_flagType=this.m_flagDrag>this.m_flagZoom?1:2)):this.m_tempa.subVecsTo(this.m_va,this.m_preva);let t=Math.abs(this.m_preDis-e);t>.1&&(this.m_fowardDis=(e-this.m_preDis)*this.m_touchZoomSpd,this.m_preDis=e)}else this.m_touchZoomBoo=!0,this.m_preDis=n.default.Distance(this.m_va,this.m_vb),this.resetState()}else this.resetState(),this.m_touchZoomBoo=!1;this.m_preva.copyFrom(this.m_va),this.m_prevb.copyFrom(this.m_vb)}setLookAtPosition(t){if(this.syncLookAt){null==t&&(t=this.m_lookAt);let e=n.default.DistanceSquared,i=this.m_camera.lookPosition;(e(t,this.m_lookAtPos)>1e-4||e(i,t)>1e-4)&&(this.m_camera.setLookAtPosition(t),this.m_lookAtPos.copyFrom(t))}}run(t){let e=this.m_lookAtCtrlEnabled;if(null!=this.m_camera)if(2==this.m_flagType){if(Math.abs(this.m_fowardDis)>.001){let i=n.default.Distance(this.m_camera.position,this.m_camera.lookPosition),r=this.m_fowardDis;if(this.m_fowardDis>0&&(i>t?(r=i-t,r>this.m_fowardDis&&(r=this.m_fowardDis)):r=0),Math.abs(r)>.1){this.m_camera.forward(r);let t=this.m_lookAtPos;e&&this.m_camera.setLookPosXYZFixUp(t.x,t.y,t.z)}this.m_windowsEnvFlag?this.m_fowardDis*=.95:this.m_fowardDis=0}}else 1==this.m_flagType&&this.m_camera.slideViewOffsetXY(-this.m_tempa.x*this.m_slideSpd,this.m_tempa.y*this.m_slideSpd)}}e.default=a},"9b48":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("f3f6")),a=r(i("25ba")),o=i("943f"),l=i("746a"),u=i("551f"),h=i("cae9"),c=i("58c4"),d=r(i("af80")),m=i("e44f"),f=i("7650");class p extends f.WGRUniformValue{constructor(){super({data:new Float32Array([1,1,1,1])})}setFactors(t,e,i){const r=this.data;r[0]=t,r[1]=e,r[2]=i,this.upate()}}class v{constructor(){this.mMixValue=new p,this.geomData=new s.GeomDataBuilder,this.renderer=new h.WGRenderer,this.mRotY=0,this.mTime=0}initialize(){new m.WGRStorageValue({data:new Float32Array(16)}),new f.WGRUniformValue({data:new Float32Array(16)});const t={vertShaderSrc:{code:n.default,uuid:"vertShdCode"},fragShaderSrc:{code:a.default,uuid:"fragShdCode"}};let e=[new c.WGImage2DTextureData("static/assets/box.jpg"),new c.WGImage2DTextureData("static/assets/default.jpg")],i=this.createMaterial(t,e,["solid"],"back");this.mEntity=this.createEntity([i])}createMaterial(t,e,i=[],r="back"){let s={depthWriteEnabled:!0,faceCullMode:r,blendModes:[]};s.blendModes=i;const n=e?e.length:0,a=new o.WGMaterial({shadinguuid:"base-material-tex"+n,shaderSrc:t,pipelineDefParam:s});return a.uniformValues=[this.mMixValue],a.addTextureWithDatas(e),a}createEntity(t,e){const i=this.renderer,r=this.geomData.createSphere(150,30,30),s=(new l.WGGeometry).addAttribute({shdVarName:"position",data:r.vs,strides:[3]}).addAttribute({shdVarName:"uv",data:r.uvs,strides:[2]}).setIndexBuffer({name:"geomIndex",data:r.ivs}),n=new u.Entity3D;return n.materials=t,n.geometry=s,n.transform.setPosition(e||new d.default),i.addEntity(n),n}run(){this.mTime+=.02,this.mMixValue.setFactors(Math.abs(Math.cos(.2*this.mTime)),.5*Math.cos(this.mTime)+.5,.5*Math.sin(this.mTime+2)+.5),this.mRotY+=.5,this.mEntity.transform.setRotationXYZ(0,this.mRotY,this.mRotY+.5),this.mEntity.update(),this.renderer.run()}}e.MultiUniformTest=v},"9e08":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("af80"));class n{constructor(){this.id=-1,this.position=new s.default}update(){}updateFast(){}}n.__tV0=new s.default,n.__tV1=new s.default,n.__tV2=new s.default,e.AbsGeomBase=n,e.default=n},"9e6d":function(t,e,i){"use strict";function r(t,e,i,r){let s=document.createElement("div"),n=s.style;return n.width=i+"px",n.height=r+"px",n.display="bolck",n.left=t+"px",n.top=e+"px",n.position="absolute",n.display="bolck",n.position="absolute",s}Object.defineProperty(e,"__esModule",{value:!0}),e.createDiv=r},"9f80":function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("395b")),a=r(i("9290")),o=i("943f"),l=i("746a"),u=i("551f"),h=i("58c4"),c=r(i("af80")),d=i("e44f"),m=r(i("c69e")),f=i("4ad2"),p=i("213f"),v=i("4a64"),g=r(i("2c77"));class b{constructor(){this.mObjs=[],this.mRscene=new f.RendererScene,this.geomData=new s.GeomDataBuilder,this.mouseDown=t=>{}}initialize(){this.initEvent();const t={vert:{code:n.default,uuid:"vertShdCode"},frag:{code:a.default,uuid:"fragShdCode"}};let e=this.createGeom(this.geomData.createCube(100),!0),i=[new h.WGImage2DTextureData("static/assets/white.jpg")],r=4;const s=new c.default(150,150,150),o=(new c.default).copyFrom(s).scaleBy(-.5*(r-1));for(let n=0;n<r;++n)for(let a=0;a<r;++a)for(let l=0;l<r;++l){let r=this.createMaterial(t,i,(new g.default).randomRGB(1,.2)),u=.2*Math.random()+.3;const h=this.createEntity(e,[r]),c=new v.TransObject;c.entity=h,c.scale.setXYZ(u,u,u),c.rotationSpdv.setXYZ(Math.random()-.5,Math.random()-.5,Math.random()-.5),c.position.setXYZ(n*s.x,a*s.y,l*s.z).addBy(o),this.mObjs.push(c)}}initEvent(){const t=this.mRscene;t.addEventListener(m.default.MOUSE_DOWN,this.mouseDown),(new p.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}createMaterial(t,e,i,r=["solid"],s="back"){let n={depthWriteEnabled:!0,faceCullMode:s,blendModes:[]};i||(i=new g.default(1,1,1)),n.blendModes=r;const a=e?e.length:0,l=new o.WGMaterial({shadinguuid:"base-material-tex"+a,shaderSrc:t,pipelineDefParam:n});let u=new d.WGRStorageValue({data:new Float32Array([i.r,i.g,i.b,.9])});return l.uniformValues=[u],l.addTextureWithDatas(e),l}createGeom(t,e=!1){const i=(new l.WGGeometry).addAttribute({position:t.vs}).addAttribute({uv:t.uvs}).setIndices(t.ivs);return e&&i.addAttribute({normal:t.nvs}),i}createEntity(t,e){const i=this.mRscene,r=new u.Entity3D({geometry:t,materials:e});return i.addEntity(r),r}run(){for(let t=0;t<this.mObjs.length;++t)this.mObjs[t].run();this.mRscene.run()}}e.SimpleLightTest=b},"9fa7":function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> objMat : mat4x4<f32>;\r\n@group(0) @binding(1) var<uniform> viewMat : mat4x4<f32>;\r\n@group(0) @binding(2) var<uniform> projMat : mat4x4<f32>;\r\n\r\nstruct VertexOutput {\r\n  @builtin(position) Position : vec4<f32>,\r\n  @location(0) vertColor : vec4<f32>\r\n}\r\n@vertex\r\nfn main(\r\n  @location(0) position : vec3<f32>,\r\n  @location(1) color : vec3<f32>,\r\n) -> VertexOutput {\r\n\r\n  let wpos = objMat * vec4(position.xyz, 1.0);\r\n  var output : VertexOutput;\r\n  output.Position = projMat * viewMat * wpos;\r\n  output.vertColor = vec4f(color.xyz, 1.0);\r\n  return output;\r\n}"},a059:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("4ad2"),s=i("213f"),n=i("d463");class a{constructor(){this.mRscene=new r.RendererScene}initialize(){this.mRscene.initialize({rpassparam:{multisampleEnabled:!0,depthTestEnabled:!1}}),this.initEvent(),this.initScene()}applyNewRPass(t,e,i,r=[.4,.3,.5,.5]){let s=this.mRscene,a={diffuse:{uuid:t,rttTexture:{}}},o=[{texture:a,clearValue:i,loadOp:"clear",storeOp:"store"}],l=s.renderer.appendRenderPass({separate:!0,colorAttachments:o});for(let n=0;n<e.length;++n)l.addEntity(e[n]);let u=new n.FixScreenPlaneEntity({extent:r,flipY:!0,textures:[a]});u.setColor([.7,.5,.5]),u.uuid="apply-rtt-entity",s.addEntity(u)}initEvent(){const t=this.mRscene;(new s.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}initScene(){const t=this.mRscene;let e;const i={diffuse:{url:"static/assets/default.jpg",flipY:!0}};let r=[];e=new n.FixScreenPlaneEntity({extent:[-.8,-.8,.8,.8],textures:[i]}),e.setColor([.9,.3,.9]),e.uuid="pl-0",t.addEntity(e),r.push(e),e=new n.FixScreenPlaneEntity({extent:[-.2,-.2,.4,.4],textures:[i]}),e.setColor([.2,.9,.9]),e.uuid="pl-1",t.addEntity(e),r.push(e),this.applyNewRPass("rtt0",r,[.1,.5,.9,1]),this.applyNewRPass("rtt1",r,[.3,.5,.1,1],[-.2,.3,.5,.5]),this.applyNewRPass("rtt2",r,[.3,.5,.7,1],[-.8,.3,.5,.5])}run(){this.mRscene.run()}}e.AddEntityIntoMultiRPasses=a},a229:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("ec7b")),n=r(i("af80")),a=r(i("3e40")),o=r(i("348f")),l=i("79d0"),u=i("af1b");class h extends o.default{constructor(){super(),this.mList=new Array(8),this.mvs=null,this.muvs=null,this.mnvs=null,this.normalType=u.WGRNormalType.FLAT,this.flipVerticalUV=!1,this.uvPartsNumber=0,this.minV=new n.default,this.maxV=new n.default,this.uScale=1,this.vScale=1}getVS(){return this.mvs}getUVS(){return this.muvs}getNVS(){return this.mnvs}setPositionAt(t,e){if(t>=0&&t<8&&null!=this.mvs){let i=this.mList[t];i[0]=e.x,i[1]=e.y,i[2]=e.z}}getPositionAt(t,e){if(t>=0&&t<8&&null!=this.mvs){let i=this.mList[t];e.x=i[0],e.y=i[1],e.z=i[2]}}setEdgeAt(t,e,i){if(t>=0&&t<8&&null!=this.mvs){let r=this.mList[t];t++,3==t?t=0:7==t&&(t=4);let s=this.mList[t];r[0]=e.x,r[1]=e.y,r[2]=e.z,s[0]=i.x,s[1]=i.y,s[2]=i.z}}getEdgeAt(t,e,i){if(t>=0&&t<8&&null!=this.mvs){let r=this.mList[t];t++,3==t?t=0:7==t&&(t=4);let s=this.mList[t];e.x=r[0],e.y=r[1],e.z=r[2],i.x=s[0],i.y=s[1],i.z=s[2]}}setFaceAt(t,e,i,r,s){if(t>=0&&t<8&&null!=this.mvs){t*=4;let n,a,o=[e,i,r,s],l=h.sFacePosIds,u=this.mList;for(let e=t+4,i=0;t<e;++t)n=u[l[t]],a=o[i++],n[0]=a.x,n[1]=a.y,n[2]=a.z}}getFaceAt(t,e,i,r,s){if(t>=0&&t<8&&null!=this.mvs){t*=4;let n,a,o=[e,i,r,s],l=h.sFacePosIds,u=this.mList;for(let e=t+4,i=0;t<e;++t)n=u[l[t]],a=o[i++],a.x=n[0],a.y=n[1],a.z=n[2]}}getFaceCenterAt(t,e){if(t>=0&&t<8&&null!=this.mvs){t*=4;let i,r=h.sFacePosIds,s=this.mList;e.setXYZ(0,0,0);for(let n=t+4;t<n;++t)i=s[r[t]],e.x+=i[0],e.y+=i[1],e.z+=i[2];e.scaleBy(.33333)}}transformFaceAt(t,e){if(t>=0&&t<8&&null!=this.mvs){t*=4;let i=h.sFacePosIds,r=this.mList;for(let s=t+4;t<s;++t)e.transformVectorsSelf(r[i[t]],3)}}initializeWithYFace(t,e,i,r){let s=t,n=e,a=.5*(s.y+n.y);this.mList[0]=[n.x,a,n.z],this.mList[1]=[n.x,a,s.z],this.mList[2]=[s.x,a,s.z],this.mList[3]=[s.x,a,n.z],s=i,n=r;let o=.5*(s.y+n.y);this.mList[4]=[n.x,o,n.z],this.mList[5]=[n.x,o,s.z],this.mList[6]=[s.x,o,s.z],this.mList[7]=[s.x,o,n.z],this.initData()}initialize(t,e){const i=this.minV,r=this.maxV;return i.setXYZ(0,0,0).setVector3(t),r.setXYZ(0,0,0).setVector3(e),this.mList[0]=[r.x,i.y,r.z],this.mList[1]=[r.x,i.y,i.z],this.mList[2]=[i.x,i.y,i.z],this.mList[3]=[i.x,i.y,r.z],this.mList[4]=[r.x,r.y,r.z],this.mList[5]=[r.x,r.y,i.z],this.mList[6]=[i.x,r.y,i.z],this.mList[7]=[i.x,r.y,r.z],this.initData(),this}scaleUVFaceAt(t,e,i,r,s){if(null!=this.muvs&&t>=0&&t<6){let n=8*t,a=n+8,o=this.muvs;for(;n<a;n+=2)o[n]=e+o[n]*r,o[n+1]=i+o[n+1]*s}}reinitialize(){this.initData()}initData(){this.vtxTotal=24;let t=0,e=0,i=0,r=null==this.mivs;if(r){this.mvs=new Float32Array(72),this.mivs=new Uint16Array(36);let r=[3,2,3,3,2,2];for(t=0;t<6;++t)3==r[t]?(this.mivs[i]=e+3,this.mivs[i+1]=e+2,this.mivs[i+2]=e+1,this.mivs[i+3]=e+3,this.mivs[i+4]=e+1,this.mivs[i+5]=e):(this.mivs[i]=e+2,this.mivs[i+1]=e+3,this.mivs[i+2]=e,this.mivs[i+3]=e+2,this.mivs[i+4]=e,this.mivs[i+5]=e+1),i+=6,e+=4}let n,o=h.sFacePosIds,l=this.mList,c=this.mvs;for(e=0,t=0;t<this.vtxTotal;++t)n=l[o[t]],c.set(n,e),e+=3;this.bounds?this.bounds.reset():this.bounds=new a.default,null!=this.mTransMatrix?(this.mTransMatrix.transformVectorsSelf(this.mvs,this.mvs.length),this.bounds.addFloat32Arr(this.mvs)):this.bounds.addFloat32Arr(this.mvs),this.bounds.updateFast();let d=6;null==this.muvs&&(this.muvs=new Float32Array(48),this.initUVData(2*this.vtxTotal),4==this.uvPartsNumber?(this.scaleUVFaceAt(0,.5,.5,.5,.5),this.scaleUVFaceAt(1,0,0,.5,.5),this.scaleUVFaceAt(2,.5,0,.5,.5),this.scaleUVFaceAt(3,0,.5,.5,.5),this.scaleUVFaceAt(4,.5,0,.5,.5),this.scaleUVFaceAt(5,0,.5,.5,.5)):6==this.uvPartsNumber&&(this.scaleUVFaceAt(0,0,0,.25,.5),this.scaleUVFaceAt(1,.25,0,.25,.5),this.scaleUVFaceAt(2,.5,0,.25,.5),this.scaleUVFaceAt(3,.75,0,.25,.5),this.scaleUVFaceAt(4,0,.5,.25,.5),this.scaleUVFaceAt(5,.25,.5,.25,.5)));{this.mnvs=new Float32Array(72),i=0;let e=0,r=0,n=0;if(this.normalType==u.WGRNormalType.FLAT)while(i<d){switch(e=0,r=0,n=0,i){case 0:r=-1;break;case 1:r=1;break;case 2:e=1;break;case 3:n=-1;break;case 4:e=-1;break;case 5:n=1;break;default:break}t=12*i,e*=this.normalScale,r*=this.normalScale,n*=this.normalScale,this.mnvs[t]=e,this.mnvs[t+1]=r,this.mnvs[t+2]=n,this.mnvs[t+3]=e,this.mnvs[t+4]=r,this.mnvs[t+5]=n,this.mnvs[t+6]=e,this.mnvs[t+7]=r,this.mnvs[t+8]=n,this.mnvs[t+9]=e,this.mnvs[t+10]=r,this.mnvs[t+11]=n,++i}else{let a=this.bounds.center,o=0;while(i<this.vtxTotal)t=3*i,e=this.mvs[t]-a.x,r=this.mvs[t+1]-a.y,n=this.mvs[t+2]-a.z,o=Math.sqrt(e*e+r*r+n*n),o>s.default.MATH_MIN_POSITIVE&&(this.mnvs[t]=e/o,this.mnvs[t+1]=r/o,this.mnvs[t+2]=n/o),++i}}this.vtCount=this.mivs.length,this.trisNumber=12}setFaceUVSAt(t,e,i=0){if(null!=this.muvs)if(i<1)this.muvs.set(e,8*t);else{t*=8,i<0&&(i=0);for(let r=0;r<4;++r)this.muvs[t++]=e[2*i],this.muvs[t++]=e[2*i+1],i++,i%=4}}initUVData(t){let e=this.uScale,i=this.vScale,r=0;if(this.flipVerticalUV)while(r<t)this.muvs[r]=1*e,this.muvs[r+1]=1*i,this.muvs[r+2]=0*e,this.muvs[r+3]=1*i,this.muvs[r+4]=0*e,this.muvs[r+5]=0*i,this.muvs[r+6]=1*e,this.muvs[r+7]=0*i,r+=8;else while(r<t)this.muvs[r]=0*e,this.muvs[r+1]=0*i,this.muvs[r+2]=1*e,this.muvs[r+3]=0*i,this.muvs[r+4]=1*e,this.muvs[r+5]=1*i,this.muvs[r+6]=0*e,this.muvs[r+7]=1*i,r+=8}testRay(t,e,i,r){let s=l.AABBCalc.IntersectionRL2(e,t,this.bounds,i);return s?1:-1}__$destroy(){this.mivs&&(this.bounds=null,this.mvs=null,this.muvs=null,this.mnvs=null,super.__$destroy())}}h.sFacePosIds=[0,1,2,3,4,5,6,7,4,5,1,0,5,6,2,1,7,6,2,3,4,7,3,0],e.default=h},a3a5:function(t,e,i){"use strict";i.r(e),e["default"]="@fragment\r\nfn main(\r\n  @location(0) fragUV: vec2<f32>,\r\n  @location(1) fragPosition: vec4<f32>\r\n) -> @location(0) vec4<f32> {\r\n  return fragPosition;\r\n}"},a3fd:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("ec7b")),n=r(i("9711")),a=r(i("af80")),o=r(i("3e40")),l=r(i("4e74"));class u{constructor(t=!0,e=!1,i=!1){this.mUid=u.sUid++,this.mSpaceEnabled=!1,this.mRenderingFlow=!1,this.mTransformStatus=0,this.mRotateBoo=!1,this.mInvMatEnabled=!1,this.mInvLocMatEnabled=!1,this.mOMatEnabled=!1,this.mPos=new a.default,this.mVisible=!0,this.mParentVisible=!0,this.mGlobalBounds=null,this.mGboundsStatus=-1,this.__$renderer=null,this.m_entities=[],this.m_entitiesTotal=0,this.m_children=[],this.m_childrenTotal=0,this.m_ebvers=null,this.m_cbvers=null,this.m_$updateBounds=!0,this.__$rseFlag=n.default.DEFAULT,this.__$wuid=-1,this.__$wprocuid=-1,this.__$weid=-1,this.__$contId=0,this.mouseEnabled=!1,this.mRendering=!0,this.m_rx=0,this.m_ry=0,this.m_rz=0,this.m_sx=1,this.m_sy=1,this.m_sz=1,this.m_localMat=l.default.GetMatrix(),this.m_invLocalMat=null,this.m_omat=null,this.m_invOmat=null,this.m_parentMat=null,t&&this.createBounds(),this.mSpaceEnabled=e,this.mRenderingFlow=i}__$setRenderer(t){let e=0;if(this.__$renderer){if(!t)for(;e<this.m_entitiesTotal;++e)this.__$renderer.removeEntity(this.m_entities[e]);this.__$renderer=t}else if(this.__$renderer=t,t)for(;e<this.m_entitiesTotal;++e){const t=this.m_entities[e];t.__$rseFlag=n.default.RemoveContainerFlag(t.__$rseFlag),this.__$renderer.addEntity(t,this.__$wprocuid,!1),t.__$rseFlag=n.default.AddContainerFlag(t.__$rseFlag)}for(e=0;e<this.m_childrenTotal;++e)this.m_children[e].__$wprocuid=this.__$wprocuid,this.m_children[e].__$setRenderer(t)}__$setParent(t){t!=this&&t!=this.__$parent&&(this.m_$updateBounds=!0,this.__$parent=t,null!=t?(this.__$wprocuid=t.__$wprocuid,this.mParentVisible=t.__$getParentVisible()&&t.getVisible(),this.__$setRenderer(t.__$renderer)):this.__$setRenderer(null),this.__$setParentMatrix(t))}isInRenderer(){return this.__$wprocuid>=0}hasParent(){return!!this.__$parent}getRenderer(){return this.__$renderer}getParent(){return this.__$parent}getTransform(){return null}isSpaceEnabled(){return this.mSpaceEnabled}isRendering(){return this.mRendering}__$setRendering(t){this.mRendering=t}createBounds(){null==this.mGlobalBounds&&(this.mGlobalBounds=new o.default,this.m_ebvers=[],this.m_cbvers=[])}isDrawEnabled(){return!0}get globalBounds(){return this.mGlobalBounds}get localBounds(){return null}get globalBoundsVer(){return null!=this.mGlobalBounds?this.mGlobalBounds.version:-1}getEntities(){return this.m_entities}getChildren(){return this.m_children}addChild(t){if(null!=t){if(t.getREType()<12)return void this.addEntity(t);let e=t;if(e.__$wuid<0&&e.__$contId<1){let t=0;for(;t<this.m_childrenTotal;++t)if(this.m_children[t]==e)return;if(t>=this.m_childrenTotal){let t=!1,i=this;while(i)i.isSpaceEnabled()&&(t=!0),i=i.getParent();if(t!=e.isSpaceEnabled())throw Error("flag != child.isSpaceEnabled(), illegal operation !!!");null!=this.m_cbvers&&this.m_cbvers.push(-1),e.__$contId=1,e.__$wprocuid=this.__$wprocuid,e.__$setParent(this),this.m_children.push(e),this.m_childrenTotal++}}}}removeChild(t){if(null!=t){if(t.getREType()<12)return void this.removeEntity(t);let e=t;if(e.getParent()==this)for(let t=0;t<this.m_childrenTotal;++t)if(this.m_children[t]==e){e.__$contId=0,e.__$wprocuid=-1,e.__$setParent(null),this.m_children.splice(t,1),null!=this.m_cbvers&&this.m_cbvers.slice(t,1),--this.m_childrenTotal;break}}}removeChildByUid(t){if(t>-1)for(let e=0;e<this.m_childrenTotal;++e)if(this.m_children[e].uid==t){this.m_children[e].__$contId=0,this.m_children.splice(e,1),null!=this.m_cbvers&&this.m_cbvers.slice(e,1),--this.m_childrenTotal;break}}getChildAt(t){return t>=0&&t<this.m_childrenTotal?this.m_children[t]:null}getChildByUid(t){if(t>-1)for(let e=0;e<this.m_entitiesTotal;++e)if(this.m_entities[e].uid==t)return this.m_entities[e];return null}getChildrenTotal(){return this.m_childrenTotal}addEntity(t){if(null!=t){if(t.getREType()>=12)return void this.addChild(t);let e=t;if(e.__$testContainerEnabled()){let t=0;for(;t<this.m_entitiesTotal;++t)if(this.m_entities[t]==e)return;t>=this.m_entitiesTotal&&(this.m_entities.push(e),this.m_entitiesTotal++,null!=this.m_ebvers&&this.m_ebvers.push(-1),e.getTransform().setParentMatrix(this.getMatrix()),e.__$setParent(this),this.__$renderer&&(e.__$rseFlag=n.default.RemoveContainerFlag(e.__$rseFlag),this.__$renderer.addEntity(this.m_entities[t],this.__$wprocuid,!1)),e.__$rseFlag=n.default.AddContainerFlag(e.__$rseFlag),e.update())}}}removeEntity(t){if(null!=t){if(t.getREType()>=12)return void this.removeChild(t);let e=t;if(e.__$getParent()==this)for(let t=0;t<this.m_entitiesTotal;++t)if(this.m_entities[t]==e){e.__$rseFlag=n.default.RemoveContainerFlag(e.__$rseFlag),this.m_entities[t].__$setParent(null),this.m_entities.splice(t,1),null!=this.m_ebvers&&this.m_ebvers.slice(t,1),--this.m_entitiesTotal,null!=this.__$renderer&&this.__$renderer.removeEntity(e);break}}}removeEntityByUid(t){if(t>-1)for(let e=0;e<this.m_entitiesTotal;++e)if(this.m_entities[e].uid==t){this.m_entities[e].__$setParent(null),null!=this.__$renderer&&this.__$renderer.removeEntity(this.m_entities[e]),this.m_entities.splice(e,1),null!=this.m_ebvers&&this.m_ebvers.slice(e,1),--this.m_entitiesTotal;break}}getEntityAt(t){return t>=0&&t<this.m_entitiesTotal?this.m_entities[t]:null}getAllEntities(){let t=null;null!=this.m_entities&&(t=this.m_entities.slice(0));for(let e=0;e<this.m_children.length;++e){let i=this.m_children[e].getAllEntities();null!=i&&(t=t.concat(i))}return t}getEntityByUid(t){if(t>-1)for(let e=0;e<this.m_entitiesTotal;++e)if(this.m_entities[e].uid==t)return this.m_entities[e];return null}getEntitiesTotal(){return this.m_entitiesTotal}__$getParentVisible(){return this.mParentVisible}__$updateVisible(){null!=this.__$parent&&(this.mParentVisible=this.__$parent.__$getParentVisible()&&this.__$parent.getVisible());let t=0;this.mVisible&&this.mParentVisible;for(t=0;t<this.m_childrenTotal;++t)this.m_children[t].__$updateVisible()}setVisible(t){return this.mVisible=t,this.__$updateVisible(),this}getVisible(){return this.mVisible}isVisible(){return this.mVisible}set visible(t){this.mVisible=t}get visible(){return this.mVisible}getREType(){return this.mRenderingFlow?20:12}isContainer(){return!0}isFree(){return this.__$rseFlag==n.default.DEFAULT}get uid(){return this.mUid}getX(){return this.mPos.x}getY(){return this.mPos.y}getZ(){return this.mPos.z}setX(t){this.mPos.x=t,this.mTransformStatus|=1}setY(t){this.mPos.y=t,this.mTransformStatus|=1}setZ(t){this.mPos.z=t,this.mTransformStatus|=1}setXYZ(t,e,i){return this.mPos.x=t,this.mPos.y=e,this.mPos.z=i,this.mTransformStatus|=1,this}offsetPosition(t){this.mPos.x+=t.x,this.mPos.y+=t.y,this.mPos.z+=t.z,this.mTransformStatus|=1}setPosition(t){return this.mPos.x=t.x,this.mPos.y=t.y,this.mPos.z=t.z,this.mTransformStatus|=1,this}getPosition(t){return t||(t=new a.default),t.copyFrom(this.mPos),t}getRotationX(){return this.m_rx}getRotationY(){return this.m_ry}getRotationZ(){return this.m_rz}setRotationX(t){this.m_rx=t,this.mTransformStatus|=2,this.mRotateBoo=!0}setRotationY(t){this.m_ry=t,this.mTransformStatus|=2,this.mRotateBoo=!0}setRotationZ(t){this.m_rz=t,this.mTransformStatus|=2,this.mRotateBoo=!0}getRotation(t){return t||(t=new a.default),t.setXYZ(this.m_rx,this.m_ry,this.m_rz),t}setRotation(t){return this.m_rx=t.x,this.mTransformStatus|=2,this.mRotateBoo=!0,this.m_ry=t.y,this.m_rz=t.z,this}setRotationXYZ(t,e,i){return this.m_rx=t,this.m_ry=e,this.m_rz=i,this.mTransformStatus|=2,this.mRotateBoo=!0,this}getScaleX(){return this.m_sx}getScaleY(){return this.m_sy}getScaleZ(){return this.m_sz}setScaleX(t){this.m_sx=t,this.mTransformStatus|=2}setScaleY(t){this.m_sy=t,this.mTransformStatus|=2}setScaleZ(t){this.m_sz=t,this.mTransformStatus|=2}setScaleXYZ(t,e,i){return this.m_sx=t,this.m_sy=e,this.m_sz=i,this.mTransformStatus|=2,this}getScale(t){return t||(t=new a.default),t.setXYZ(this.m_sx,this.m_sy,this.m_sz),t}setScale(t){this.setScaleXYZ(t.x,t.y,t.z)}setScaleXY(t,e){this.setScaleXYZ(t,e,this.m_sz)}setScaleAll(t){this.setScaleXYZ(t,t,t)}localToParent(t){this.m_localMat.transformVectorSelf(t)}parentToLocal(t){null!=this.m_invLocalMat?this.mInvLocMatEnabled&&(this.mInvLocMatEnabled=!1,this.m_invLocalMat.copyFrom(this.m_localMat)):(this.m_localMat=l.default.GetMatrix(),this.mInvLocMatEnabled=!1),this.m_invLocalMat.transformVectorSelf(t)}localToGlobal(t){return this.getMatrix().transformVectorSelf(t),this}globalToLocal(t){return this.getInvMatrix().transformVectorSelf(t),this}getInvMatrix(){return this.m_invOmat?this.mInvMatEnabled&&(this.m_invOmat.copyFrom(this.getMatrix()),this.m_invOmat.invert(),this.mInvMatEnabled=!1):(this.m_invOmat=l.default.GetMatrix(),this.m_invOmat.copyFrom(this.getMatrix()),this.m_invOmat.invert()),this.mInvMatEnabled=!1,this.m_invOmat}getLocalMatrix(){return this.m_localMat}getMatrix(){return null!=this.m_parentMat?(this.mOMatEnabled&&(this.m_omat.copyFrom(this.m_localMat),this.m_omat.append(this.m_parentMat),this.mOMatEnabled=!1),this.m_omat):(this.mOMatEnabled=!1,this.m_localMat)}__$setParentMatrix(t){this.m_parentMat=t.getMatrix(),null!=this.m_parentMat&&null==this.m_omat&&(this.m_omat=l.default.GetMatrix()),this.mTransformStatus|=2;let e=0;for(;e<this.m_childrenTotal;++e)this.m_children[e].__$setParentMatrix(this)}__$updateBoundsDo(){let t=0;if(this.m_$updateBounds){if(this.m_$updateBounds=!1,this.mGlobalBounds){this.mGlobalBounds.reset();let e=null;for(;t<this.m_entitiesTotal;++t)e=this.m_entities[t].globalBounds,null!=e&&this.mGlobalBounds.union(e),this.m_ebvers[t],this.m_entities[t].globalBoundsVer;for(t=0;t<this.m_childrenTotal;++t)this.m_children[t].__$updateBoundsDo(),e=this.m_children[t].globalBounds,null!=e&&this.mGlobalBounds.union(e),this.m_cbvers[t],this.m_children[t].globalBoundsVer;this.mGlobalBounds.update()}}else for(t=0;t<this.m_childrenTotal;++t)this.m_children[t].__$updateBoundsDo()}__$updateBounds(){this.m_$updateBounds=!0}updateBounds(){const t=this.mGlobalBounds;if(t&&this.mGboundsStatus>0){let e=0;if(this.mGboundsStatus<2)for(;e<this.m_childrenTotal;++e)this.m_children[e].updateBounds();t.reset(),e=0;let i=null;for(;e<this.m_entitiesTotal;++e)i=this.m_entities[e].globalBounds,null!=i&&t.union(i),this.m_ebvers[e]=this.m_entities[e].globalBoundsVer;for(e=0;e<this.m_childrenTotal;++e)i=this.m_children[e].globalBounds,null!=i&&t.union(i),this.m_cbvers[e]=this.m_children[e].globalBoundsVer;if(t.update(),null!=this.__$parent){let t=this.__$parent;while(null!=t)t.__$updateBounds(),t=t.getParent()}this.mGboundsStatus=-1}}update(){const t=this.m_localMat;if(t){if(this.mTransformStatus>0){t.identity(),this.mRotateBoo?(t.setScaleXYZ(this.m_sx,this.m_sy,this.m_sz),t.setRotationEulerAngle(this.m_rx*s.default.MATH_PI_OVER_180,this.m_ry*s.default.MATH_PI_OVER_180,this.m_rz*s.default.MATH_PI_OVER_180),t.setTranslation(this.mPos)):(t.setScaleXYZ(this.m_sx,this.m_sy,this.m_sz),t.setTranslation(this.mPos)),this.mInvMatEnabled=!0,this.mOMatEnabled=!0,this.mInvLocMatEnabled=!0,this.mTransformStatus=0;let e=0;for(;e<this.m_entitiesTotal;++e)this.m_entities[e].getTransform().setParentMatrix(this.getMatrix()),this.m_entities[e].update();for(e=0;e<this.m_childrenTotal;++e)this.m_children[e].__$setParentMatrix(this),this.m_children[e].update();this.mGboundsStatus=1}else{this.mGboundsStatus=-1;let t=0;if(this.m_entitiesTotal>0)for(;t<this.m_entitiesTotal;++t)this.m_entities[t].update(),this.m_ebvers[t]!=this.m_entities[t].globalBoundsVer&&(this.mGboundsStatus=2);if(this.m_childrenTotal>0)for(t=0;t<this.m_childrenTotal;++t)this.m_children[t].update(),this.m_cbvers[t]!=this.m_children[t].globalBoundsVer&&(this.mGboundsStatus=2)}this.updateBounds(),this.__$updateBoundsDo()}return this}destroy(){this.__$wuid<0&&this.isFree()&&(null!=this.m_omat&&this.m_omat!=this.m_localMat&&l.default.RetrieveMatrix(this.m_omat),null!=this.m_invOmat&&l.default.RetrieveMatrix(this.m_invOmat),null!=this.m_localMat&&l.default.RetrieveMatrix(this.m_localMat),null!=this.m_invLocalMat&&l.default.RetrieveMatrix(this.m_invLocalMat),this.m_localMat=null,this.m_invLocalMat=null,this.m_invOmat=null,this.m_parentMat=null,this.m_omat=null)}}u.sUid=0,e.Entity3DContainer=u},a5b0:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){this.m_canvas=null,this.m_div=null,this.m_divW=-1,this.m_divH=-1,this.resized=!0}setDiv(t){this.m_div=t}getCSSHEXRGB(t,e,i){let r="#",s=Math.floor(255*t);return r+=s<15?"0"+s.toString(16):""+s.toString(16),s=Math.floor(255*e),r+=s<15?"0"+s.toString(16):""+s.toString(16),s=Math.floor(255*i),r+=s<15?"0"+s.toString(16):""+s.toString(16),r}createViewEle(t,e,i,r,s,n){null==this.m_div&&(this.m_div=document.getElementById("voxEngineDiv")),null==this.m_div&&(this.m_div=t.createElement("div"),s&&document.body.appendChild(this.m_div));const a=this.m_div.style;a.display="bolck",a.position="absolute",""==a.left&&(a.left="0px",a.top="0px"),e?(a.width="100%",a.height="100%"):(this.m_div.style.width=i+"px",this.m_div.style.height=r+"px"),null==this.m_canvas&&(this.m_canvas=document.createElement("canvas"),this.m_div.appendChild(this.m_canvas),n?(this.m_canvas.width=i,this.m_canvas.height=r):(this.m_canvas.width=800,this.m_canvas.height=600),this.m_canvas.style.display="bolck",this.m_canvas.style.left="0px",this.m_canvas.style.top="0px",this.m_canvas.style.position="absolute")}setDivStyleLeftAndTop(t,e){this.m_div.style.left=t+"px",this.m_div.style.top=e+"px"}setDivStyleSize(t,e){this.m_divW==t&&this.m_divH==e||(this.m_div.style.width=t+"px",this.m_div.style.height=e+"px",this.resized=!0)}getDiv(){return this.m_div}getCanvas(){return this.m_canvas}setCanvas(t){t&&this.m_canvas!=t&&(this.m_canvas&&this.m_div.removeChild(this.m_canvas),this.m_canvas=t,this.m_div.appendChild(this.m_canvas))}}e.default=r},a6bd:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=i("4ad2"),a=i("213f"),o=r(i("af80")),l=i("603e"),u=i("1ee1"),h=i("9849"),c=r(i("68f4")),d=i("5009"),m=r(i("c7cf")),f=i("6d7a"),p=i("5118"),v=i("648f"),g=r(i("2c77"));class b{constructor(){this.mRscene=new n.RendererScene,this.mouseDown=t=>{}}initialize(){document.oncontextmenu=function(t){t.preventDefault()},this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(s.default.MOUSE_DOWN,this.mouseDown),(new a.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}testOBB(){const t=this.mRscene;let e=new d.BoxEntity;e.setColor([.8,.2,.6]),e.transform.setRotationXYZ(70,150,0),e.transform.setXYZ(100,100,500),t.addEntity(e);let i=new m.default;i.fromAABB(e.localBounds,e.transform.getMatrix());let r=new u.BoundsFrameEntity({obb:i,obbFrameScale:1.01});r.setColor([.1,.8,.7]),t.addEntity(r)}testFrustumFrame(){const t=new c.default({eye:new o.default(500,500,-300),near:50,far:200}),e=this.mRscene;let i=[[1,0,1],[0,1,1],[1,0,1],[0,1,1]],r=new u.BoundsFrameEntity({vertices8:t.frustum.vertices,frameColors:i});e.addEntity(r)}createCurve(){const t=this.mRscene;let e=100,i=new Array(e),r=new Array(e);for(let a=0;a<e;++a){const t=Math.sin(20*a/e);i[a]=[350,100*t+100,10*a-300],r[a]=[.5*t+.5,1-(.5*t+.5),1]}let s=new v.Line3DEntity({linePositions:i,lineColors:r});t.addEntity(s);let n=v.createLineCircleXOZ(100);n.transform.setY(100),n.color=[.1,.5,1],t.addEntity(n)}initScene(){const t=this.mRscene;let e=(new g.default).toBlack().setColor([1]),i=new h.SphereEntity;i.transform.setXYZ(-200,200,-300),t.addEntity(i),i.color=e,this.createCurve();let r=new f.RectLineGridEntity;r.color=[.2,.3,.1],t.addEntity(r);let s=new l.AxisEntity({axisLength:300});s.transform.setY(1.5),t.addEntity(s),this.testOBB(),this.testFrustumFrame();let n=new u.BoundsFrameEntity({bounds:i.globalBounds});t.addEntity(n);let a=new p.TorusEntity;a.color=[.1,.8,.3],a.transform.setXYZ(-300,200,300),a.transform.setRotationXYZ(60,130,70),t.addEntity(a),n=new u.BoundsFrameEntity({bounds:a.globalBounds}),t.addEntity(n);let o=new m.default;o.fromAABB(a.localBounds,a.transform.getMatrix()),n=new u.BoundsFrameEntity({obb:o,obbFrameScale:1.01}),n.color=[.6,.8,.3],t.addEntity(n),n=new u.BoundsFrameEntity({minPos:[200,200,400],maxPos:[300,300,450]}),n.color=[1,.2,.6],t.addEntity(n)}run(){this.mRscene.run()}}e.LineObjectTest=b},a6ef:function(t,e,i){"use strict";function r(t){let e=document.cookie+"",i=e.indexOf(t+"=");if(i>=0){let t=e.indexOf(";",i+1);t<0&&(t=e.length);let r=e.slice(i,t);return r=r.split("=")[1],r}return""}function s(t,e){let i=t+"="+e+";";document.cookie=i}Object.defineProperty(e,"__esModule",{value:!0}),e.getCookieByName=r,e.setCookieByName=s;class n{constructor(t){this.mKeyName="unit_test-index",this.mUnitIndex=-1,this.mdDemoNames=t}downIndex(){this.mUnitIndex--,this.mUnitIndex<0&&(this.mUnitIndex+=this.mdDemoNames.length),this.setIndex()}upIndex(){this.mUnitIndex++,this.mUnitIndex>=this.mdDemoNames.length&&(this.mUnitIndex-=this.mdDemoNames.length),this.setIndex()}gotoIndex(t){this.mUnitIndex=t,this.setIndex()}getIndex(){if(this.mUnitIndex>=0)return this.mUnitIndex;let t=r(this.mKeyName),e=0;return t.length>0&&(e=parseInt(t)),this.mUnitIndex=e,this.mUnitIndex}setIndex(){s(this.mKeyName,this.mUnitIndex+"")}}e.UnitsTestMana=n},a7a5:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=i("4ad2"),a=i("213f"),o=i("746a"),l=i("1eee"),u=r(i("2c77")),h=i("71f1");class c{constructor(){this.mRscene=new n.RendererScene,this.mTeamLoader=h.modelLoader,this.mouseDown=t=>{}}initialize(){this.initEvent(),this.initModels()}initEvent(){const t=this.mRscene;t.addEventListener(s.default.MOUSE_DOWN,this.mouseDown),(new a.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}createGeometry(t,e=!1){const i=(new o.WGGeometry).addAttribute({position:t.vertices}).addAttribute({uv:t.uvsList[0]}).setIndices(t.indices);return e&&i.addAttribute({normal:t.normals}),i}initModels(){let t="static/assets/fbx/mat_ball.fbx",e=this.mTeamLoader;e.load([t],(t,e)=>{for(let i=0;i<t.length;++i)this.createEntity(t[i])})}createEntity(t){const e=this.mRscene,i=this.createGeometry(t,!0);let r=new l.PrimitiveEntity({geometry:i}).setAlbedo((new u.default).randomRGB(1.5,.1)).setARM([1.1,.95*Math.random()+.05,.9*Math.random()+.1]);e.addEntity(r)}run(){this.mRscene.run()}}e.ModelLoadTest=c},a7ea:function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> objMat : mat4x4<f32>;\r\n@group(0) @binding(1) var<uniform> viewMat : mat4x4<f32>;\r\n@group(0) @binding(2) var<uniform> projMat : mat4x4<f32>;\r\n\r\nstruct VertexOutput {\r\n  @builtin(position) Position : vec4<f32>\r\n}\r\n@vertex\r\nfn main(\r\n  @location(0) position : vec3<f32>\r\n) -> VertexOutput {\r\n\r\n  let wpos = objMat * vec4(position.xyz, 1.0);\r\n  var output : VertexOutput;\r\n  output.Position = projMat * viewMat * wpos;\r\n  return output;\r\n}"},ab24:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("4ad2"),s=i("d463");class n{constructor(){this.mRscene=new r.RendererScene}initialize(){this.initScene()}applyRGBAFloat16Tex(){let t=this.mRscene,e=256,i=256,r=4,n=new Float32Array(e*i*r),a=10,o=0;for(let s=0;s<i;++s)for(let t=0;t<e;++t)o=(e*s+t)*r,n[o]=a*(t/e),n[o+1]=a*(.5+.5*Math.sin(10*(1-t/e))),n[o+2]=a*(1-s*t/(e*i)),n[o+3]=1*a;const l={diffuse:{uuid:"tex0",dataTexture:{data:n,width:e,height:i},format:"rgba16float",generateMipmaps:!0}};let u=new s.FixScreenPlaneEntity({extent:[-.8,-.8,.8,.8],textures:[l]});u.color=[.1,.1,.1,.1],t.addEntity(u)}applyRGBA8Tex(){let t=this.mRscene,e=256,i=256,r=4,n=new Uint8Array(e*i*r),a=0;for(let s=0;s<i;++s)for(let t=0;t<e;++t)a=4*(e*s+t),n[a]=t/e*255|0,n[a+1]=255*(.5+.5*Math.sin(10*(1-t/e)))|0,n[a+2]=255*(1-s*t/(e*i))|0,n[a+3]=255;let o={diffuse:{uuid:"tex1",dataTexture:{data:n,width:e,height:i},format:"rgba8unorm",generateMipmaps:!0}},l=new s.FixScreenPlaneEntity({extent:[0,0,.8,.8],textures:[o]});t.addEntity(l)}initScene(){this.applyRGBAFloat16Tex(),this.applyRGBA8Tex()}run(){this.mRscene.run()}}e.DataTextureTest=n},ae81:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=i("4ad2"),a=i("213f"),o=i("dca8"),l=i("19f9"),u=32,h=8,c=`\n\t\t\t@group(0) @binding(0) var<uniform> grid: vec2f;\n\t\t\t@group(0) @binding(1) var<storage> cellStateIn: array<u32>;\n\t\t\t@group(0) @binding(2) var<storage, read_write> cellStateOut: array<u32>;\n\n\t\t\tfn cellIndex(cell: vec2u) -> u32 {\n\t\t\t\treturn cell.y * u32(grid.x) + cell.x;\n\t\t\t}\n\n\t\t\t@compute @workgroup_size(${h}, ${h})\n\t\t\tfn compMain(@builtin(global_invocation_id) cell: vec3u) {\n\t\t\t\tif (cellStateIn[cellIndex(cell.xy)] == 1) {\n\t\t\t\t\tcellStateOut[cellIndex(cell.xy)] = 0;\n\t\t\t\t} else {\n\t\t\t\t\tcellStateOut[cellIndex(cell.xy)] = 1;\n\t\t\t\t}\n\t\t\t}`,d=`\n\t\t\t@group(0) @binding(0) var<uniform> grid: vec2f;\n\t\t\t@group(0) @binding(1) var<storage> cellStateIn: array<u32>;\n\t\t\t@group(0) @binding(2) var<storage, read_write> cellStateOut: array<u32>;\n\n\t\t\tfn cellIndex(cell: vec2u) -> u32 {\n\t\t\t\treturn cell.y * u32(grid.x) + cell.x;\n\t\t\t}\n\n\t\t\t@compute @workgroup_size(${h}, ${h})\n\t\t\tfn compMain(@builtin(global_invocation_id) cell: vec3u) {\n\t\t\t\tif (cellStateIn[cellIndex(cell.xy)]%5 == 0) {\n\t\t\t\t\tcellStateOut[cellIndex(cell.xy)] = 0;\n\t\t\t\t} else {\n\t\t\t\t\tcellStateOut[cellIndex(cell.xy)] = 1;\n\t\t\t\t}\n\t\t\t}`;class m{constructor(){this.mRscene=new n.RendererScene,this.mouseDown=t=>{}}initialize(){this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(s.default.MOUSE_DOWN,this.mouseDown),(new a.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}createUniformValues(){const t=new Float32Array([u,u]),e=new Uint32Array(u*u);for(let a=0;a<e.length;a+=3)e[a]=1;const i=new Uint32Array(u*u);for(let a=0;a<i.length;a++)i[a]=a%2;const r={data:t,stride:2,layout:{visibility:"all"}},s={storage:{data:e,stride:1,layout:{visibility:"vert_comp"}}},n={storage:{data:i,stride:1,layout:{visibility:"comp",access:"read_write"}}};return[r,s,n]}createMaterial(t,e,i){const r=[4,4];return new l.WGCompMaterial({shadinguuid:e,shaderSrc:t,uniformValues:i,workcounts:r})}initScene(){const t=this.mRscene,e=this.createUniformValues();let i={code:c,uuid:"computing-0"},r={code:d,uuid:"computing-1"},s=[this.createMaterial(i,"comp-1",e),this.createMaterial(r,"comp-2",e)];t.addEntity(new o.ComputeEntity({materials:s}))}run(){this.mRscene.run()}}e.ComputeMaterialTest=m},af1b:function(t,e,i){"use strict";var r,s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["DISABLE"]=0]="DISABLE",t[t["TRIANGLES"]=1]="TRIANGLES",t[t["LINE_STRIP"]=2]="LINE_STRIP",t[t["POINTS"]=3]="POINTS",t[t["LINES"]=4]="LINES"}(r||(r={})),e.WGRDrawMode=r,function(t){t[t["FLAT"]=0]="FLAT",t[t["GOURAND"]=1]="GOURAND"}(s||(s={})),e.WGRNormalType=s},af80:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=180/Math.PI,s=1e-7;class n{constructor(t=0,e=0,i=0,r=1){this.x=0,this.y=0,this.z=0,this.w=0,this.x=t,this.y=e,this.z=i,this.w=r}clone(){return new n(this.x,this.y,this.z,this.w)}toZero(){return this.setXYZW(0,0,0,0)}toOne(){return this.setXYZW(1,1,1,1)}setVector3(t){let e=t;if(e){const t=this,i=e;if(void 0!==i.length){const e=i.length;e>0&&(t.x=i[0]),e>1&&(t.y=i[1]),e>2&&(t.z=i[2]),e>3&&(t.w=i[3])}else{const i=e;void 0!==i.x&&(t.x=i.x),void 0!==i.y&&(t.y=i.y),void 0!==i.z&&(t.z=i.z),void 0!==i.w&&(t.w=i.w)}}return this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this}setXYZW(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this}setXYZ(t,e,i){return this.x=t,this.y=e,this.z=i,this}fromArray3(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray3(t,e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,this}fromArray4(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray4(t,e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}multBy(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>s&&(this.x/=t,this.y/=t,this.z/=t),this}normalizeTo(t){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);e>s?(t.x=this.x/e,t.y=this.y/e,t.z=this.z/e):(t.x=this.x,t.y=this.y,t.z=this.z)}scaleVector(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}scaleBy(t){return this.x*=t,this.y*=t,this.z*=t,this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}equalsXYZ(t){return Math.abs(this.x-t.x)<s&&Math.abs(this.y-t.y)<s&&Math.abs(this.z-t.z)<s}equalsAll(t){return Math.abs(this.x-t.x)<s&&Math.abs(this.y-t.y)<s&&Math.abs(this.z-t.z)<s&&Math.abs(this.w-t.w)<s}project(){let t=1/this.w;this.x*=t,this.y*=t,this.z*=t}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getLengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}addBy(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}subtractBy(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subtract(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z)}crossProduct(t){return new n(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}crossBy(t){let e=this.y*t.z-this.z*t.y,i=this.z*t.x-this.x*t.z,r=this.x*t.y-this.y*t.x;return this.x=e,this.y=i,this.z=r,this}reflectBy(t){let e=2*(this.x*t.x+this.y*t.y+this.z*t.z);return this.x=this.x-e*t.x,this.y=this.y-e*t.y,this.z=this.z-e*t.z,this}scaleVecTo(t,e){return this.x=t.x*e,this.y=t.y*e,this.z=t.z*e,this}subVecsTo(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}addVecsTo(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}crossVecsTo(t,e){return this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x,this}toString(){return"Vector3("+this.x+this.y+this.z+")"}static Cross(t,e,i){i.x=t.y*e.z-t.z*e.y,i.y=t.z*e.x-t.x*e.z,i.z=t.x*e.y-t.y*e.x}static CrossSubtract(t,e,i,r,s){a.x=e.x-t.x,a.y=e.y-t.y,a.z=e.z-t.z,o.x=r.x-i.x,o.y=r.y-i.y,o.z=r.z-i.z,t=a,i=o,s.x=t.y*i.z-t.z*i.y,s.y=t.z*i.x-t.x*i.z,s.z=t.x*i.y-t.y*i.x}static Subtract(t,e,i){i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z}static DistanceSquared(t,e){return a.x=t.x-e.x,a.y=t.y-e.y,a.z=t.z-e.z,a.getLengthSquared()}static DistanceXYZ(t,e,i,r,s,n){return a.x=t-r,a.y=e-s,a.z=i-n,a.getLength()}static Distance(t,e){return a.x=t.x-e.x,a.y=t.y-e.y,a.z=t.z-e.z,a.getLength()}static AngleBetween(t,e){return t.normalizeTo(a),e.normalizeTo(o),Math.acos(a.dot(o))*r}static RadianBetween(t,e){return t.normalizeTo(a),e.normalizeTo(o),Math.acos(a.dot(o))}static RadianBetween2(t,e){let i=t.getLengthSquared(),r=e.getLengthSquared();return a.subVecsTo(t,e),Math.acos((i+r-a.getLengthSquared())/(2*Math.sqrt(i)*Math.sqrt(r)))}static Reflect(t,e,i){let r=2*(t.x*e.x+t.y*e.y+t.z*e.z);i.x=t.x-r*e.x,i.y=t.y-r*e.y,i.z=t.z-r*e.z}static VerticalCCWOnXOY(t){const e=t.x;t.x=-t.y,t.y=e}static VerticalCWOnXOY(t){const e=t.y;t.y=-t.x,t.x=e}}n.X_AXIS=new n(1,0,0),n.Y_AXIS=new n(0,1,0),n.Z_AXIS=new n(0,0,1),n.ZERO=new n(0,0,0),n.ONE=new n(1,1,1),e.default=n;const a=new n,o=new n},afaf:function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> color: vec4f;\r\n@group(0) @binding(1) var sampler0: sampler;\r\n@group(0) @binding(2) var texture0: texture_2d<f32>;\r\nconst hdrBrnDecodeVec4 = vec4f(255.0, 2.55, 0.0255, 0.000255);\r\nfn rgbaToHdrBrn(color: vec4f) -> f32 {\r\n    return dot(hdrBrnDecodeVec4, color);\r\n}\r\n@fragment\r\nfn main(\r\n\t@location(0) uv: vec2f\r\n\t) -> @location(0) vec4f {\r\n\t// var color4 = vec4f(textureSample(texture0, sampler0, uv).xyz, 1.0) * color;\r\n\t// let brn3 = vec3f(rgbaToHdrBrn(textureSample(texture0, sampler0, uv)));\r\n\tlet brn3 = vec3f(rgbaToHdrBrn(textureSampleLevel(texture0, sampler0, uv, color.w)));\r\n\tvar color4 = vec4f(brn3, 1.0) * vec4f(color.xyz,1.0);\r\n    return color4;\r\n}\r\n"},b1fa:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){this.uuid="",this.phase=0,this.type=r.RESIZE,this.target=null,this.currentTarget=null,this.data=null,this.__$preventBoo=!1}getClassType(){return r.EventClassType}preventDefault(){this.__$preventBoo=!0}reset(){this.__$preventBoo=!1}toString(){return"[EventBase]"}}r.EventClassType=1001,r.RESIZE=3001,r.ENTER_FRAME=3002,e.default=r},b2e4:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},b2fd:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("374c");e.BufDataParamType=r.BufDataParamType;const s=i("9069");e.WGRUniformParam=s.WGRUniformParam;const n=i("3590"),a=i("2d6d"),o=i("dfa8");class l{constructor(t){this.mMap=new Map,this.mInsList=[],this.mLayoutAuto=!0,this.mLayoutAuto=t}isLayoutAuto(){return this.mLayoutAuto}getWGCtx(){return this.mBindGCtx.getWGCtx()}getUCtx(t,e=!0){let i=null;const r=this.mMap;return r.has(t)?i=r.get(t):e&&(i=new n.WGRUniformCtxInstance,i.layoutAuto=this.mLayoutAuto,i.shdUniform=l.shdUniform,i.initialize(this.mBindGCtx),r.set(t,i),this.mUCtxIns=i),i}initialize(t){!this.mBindGCtx&&t&&(this.mBindGCtx=t)}getBindGroupLayout(t){return this.mUCtxIns?this.mUCtxIns.getBindGroupLayout(t):null}runBegin(){const t=this.mInsList;for(let e=0;e<t.length;)t[e].runBegin(),t[e].isEnabled()?(t[e].ready=!1,t.splice(e,1)):e++}runEnd(){}createUniformsWithValues(t,e){let i=[];for(let r=0;r<t.length;++r){const s=t[r];i.push(this.createUniformWithValues(s.layoutName,s.groupIndex,s.values,s.texParams,e))}return i}createUniformWithValues(t,e,i,r,s){if(this.mBindGCtx){const n=this.getUCtx(t);n.ready||(this.mInsList.push(n),n.ready=!0);const l=[];for(let t=0;t<i.length;++t){let e=i[t];e=a.checkBufferData(e),(void 0==e.uid||e.uid<0)&&(e.uid=o.createNewWRGBufferViewUid());const r=e.uid,s=e.arrayStride,n=e.visibility.clone();let u={arrayStride:s,size:e.byteLength,usage:e.usage,shared:e.shared,vuid:r,visibility:n,ufvalue:e};l.push(u)}return n.createUniform(t,e,l,r,s)}throw Error("Illegal operation !!!")}createUniform(t,e,i,r,s){if(this.mBindGCtx){const n=this.getUCtx(t);return this.mInsList.push(n),n.createUniform(t,e,i,r,s)}return null}removeUniforms(t){if(t&&this.mBindGCtx)for(let e=0;e<t.length;++e)this.removeUniform(t[e])}removeUniform(t){if(this.mBindGCtx&&void 0!==t.layoutName){const e=this.mMap;if(e.has(t.layoutName)){const i=e.get(t.layoutName);i.removeUniform(t)}}}destroy(){if(this.mBindGCtx){for(var[t,e]of this.mMap)e.destroy();this.mBindGCtx=null}}}l.shdUniform=new n.SharedUniformObj,e.WGRUniformContext=l},b3f5:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("fe0b");e.calculateMipLevels=r.calculateMipLevels;class s{constructor(t){this.pipelines={},this.initialize(t)}initialize(t){t&&!this.device&&(this.device=t,this.sampler=t.createSampler({minFilter:"linear"}))}getMipmapPipeline(t){let e=this.pipelines[t];return e||(this.mipmapShaderModule||(this.mipmapShaderModule=this.device.createShaderModule({label:"Mipmap Generator",code:"\n            var<private> pos : array<vec2<f32>, 3> = array<vec2<f32>, 3>(\n              vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 3.0), vec2<f32>(3.0, -1.0));\n\n            struct VertexOutput {\n              @builtin(position) position : vec4<f32>,\n              @location(0) texCoord : vec2<f32>,\n            };\n\n            @vertex\n            fn vertexMain(@builtin(vertex_index) vertexIndex : u32) -> VertexOutput {\n              var output : VertexOutput;\n              output.texCoord = pos[vertexIndex] * vec2<f32>(0.5, -0.5) + vec2<f32>(0.5);\n              output.position = vec4<f32>(pos[vertexIndex], 0.0, 1.0);\n              return output;\n            }\n\n            @group(0) @binding(0) var imgSampler : sampler;\n            @group(0) @binding(1) var img : texture_2d<f32>;\n\n            @fragment\n            fn fragmentMain(@location(0) texCoord : vec2<f32>) -> @location(0) vec4<f32> {\n              return textureSample(img, imgSampler, texCoord);\n            }\n          "}),this.bindGroupLayout=this.device.createBindGroupLayout({label:"Mipmap Generator",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{}}]}),this.pipelineLayout=this.device.createPipelineLayout({label:"Mipmap Generator",bindGroupLayouts:[this.bindGroupLayout]})),e=this.device.createRenderPipeline({layout:this.pipelineLayout,vertex:{module:this.mipmapShaderModule,entryPoint:"vertexMain"},fragment:{module:this.mipmapShaderModule,entryPoint:"fragmentMain",targets:[{format:t}]}}),this.pipelines[t]=e),e}generateMipmap(t,e){const i=this.getMipmapPipeline(e.format);if("3d"==e.dimension||"1d"==e.dimension)throw new Error("Generating mipmaps for non-2d textures is currently unsupported!");let r=e.size;const s=e.size;if(void 0!==s.length){const t=s.length;r={depthOrArrayLayers:1},t>=0&&(r.width=s[0],t>=1&&(r.height=s[1],t>=2&&(r.depthOrArrayLayers=s[2])))}let n=t;const a=r.depthOrArrayLayers||1,o=e.usage&GPUTextureUsage.RENDER_ATTACHMENT;if(!o){const t={size:{width:Math.max(1,r.width>>>1),height:Math.max(1,r.height>>>1),depthOrArrayLayers:a},format:e.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT,mipLevelCount:e.mipLevelCount-1};n=this.device.createTexture(t)}const l=this.device.createCommandEncoder({});for(let u=0;u<a;++u){let r=t.createView({baseMipLevel:0,mipLevelCount:1,dimension:"2d",baseArrayLayer:u,arrayLayerCount:1}),s=o?1:0;for(let t=1;t<e.mipLevelCount;++t){const t=n.createView({baseMipLevel:s++,mipLevelCount:1,dimension:"2d",baseArrayLayer:u,arrayLayerCount:1}),e=l.beginRenderPass({colorAttachments:[{view:t,loadOp:"clear",storeOp:"store"}]}),a=this.device.createBindGroup({layout:this.bindGroupLayout,entries:[{binding:0,resource:this.sampler},{binding:1,resource:r}]});e.setPipeline(i),e.setBindGroup(0,a),e.draw(3,1,0,0),e.end(),r=t}}if(!o){const i={width:Math.max(1,r.width>>>1),height:Math.max(1,r.height>>>1),depthOrArrayLayers:a};for(let r=1;r<e.mipLevelCount;++r)l.copyTextureToTexture({texture:n,mipLevel:r-1},{texture:t,mipLevel:r},i),i.width=Math.max(1,i.width>>>1),i.height=Math.max(1,i.height>>>1)}return this.device.queue.submit([l.finish()]),o||n.destroy(),t}}e.GPUMipmapGenerator=s},b512:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("87f6");e.WGRBufferLayout=r.WGRBufferLayout,e.WGRBufferData=r.WGRBufferData;const s=i("dc4d");function n(t,e){void 0!==e.uuid&&(t.uuid=e.uuid);let i=e.data;if(t.data=i,e.bufData){const r=e.bufData;t.bufData=r,i=r.data,t.data=i}if(void 0===t.shared&&(t.shared=!1),t!==e&&(void 0!==e.usage&&(t.usage=e.usage),void 0!==e.shared&&(t.shared=e.shared),void 0!==e.stride&&(t.stride=e.stride),void 0!==e.shdVarName&&(t.shdVarName=e.shdVarName),void 0!==e.arrayStride&&(t.arrayStride=e.arrayStride)),void 0===t.arrayStride&&(t.arrayStride=1),t.arrayStride<2){const e=i.BYTES_PER_ELEMENT;void 0!==t.stride&&void 0!==e?t.arrayStride=e*t.stride:i&&i.byteLength<=64&&(t.arrayStride=i.byteLength)}t.visibility||(t.visibility=new s.WGRBufferVisibility)}e.applyParamToBufferData=n},b6ed:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});window;const r=i("b8ec");let s=new r.UnitsTest;s.initialize()},b720:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("af1b");class s{constructor(){this.indexCount=0,this.layoutUid=0,this.instanceCount=1,this.vertexCount=0,this.drawMode=r.WGRDrawMode.TRIANGLES}run(t){const e=this.vbufs;if(e)for(let i=0,r=e.length;i<r;++i)t.setVertexBuffer(i,e[i])}update(){this.ibuf?this.indexCount=this.indexCount>0?this.indexCount:this.ibuf.elementCount:this.vertexCount=this.vertexCount>0?this.vertexCount:this.vbufs[0].vectorCount}clone(){const t=new s;return t.layoutUid=this.layoutUid,t.vbufs=this.vbufs,t.ibuf=this.ibuf,t.indexCount=this.indexCount,t.instanceCount=this.instanceCount,t.vertexCount=this.vertexCount,t}}e.WGRPrimitive=s},b876:function(t,e,i){"use strict";var r,s,n;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["ctmParser"]="ctmGeomParser",t["objParser"]="objGeomParser",t["dracoParser"]="dracoGeomParser",t["pngParser"]="pngParser",t["fbxFastParser"]="fbxFastParser",t["threadCore"]="threadCore",t["coSpaceApp"]="coSpaceApp"}(r||(r={})),e.CoModuleNS=r,function(t){t["Undefined"]="undefined-format",t["CTM"]="ctm",t["Draco"]="draco",t["OBJ"]="obj",t["FBX"]="fbx",t["GLB"]="glb",t["Jpg"]="jpg",t["Png"]="png",t["Gif"]="gif"}(s||(s={})),e.CoDataFormat=s,function(t){t["JS"]="js-text",t["Binasy"]="binary"}(n||(n={})),e.CoModuleFileType=n},b8ec:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("601e"),s=i("fd5e"),n=i("ede0"),a=i("ed04"),o=i("8890"),l=i("5326"),u=i("6065"),h=i("cc22"),c=i("6bbe"),d=i("9b48"),m=i("6729"),f=i("8bc3"),p=i("c14c"),v=i("9f80"),g=i("27e9"),b=i("e0de"),y=i("81d0"),_=i("5469"),x=i("381c"),w=i("245e"),S=i("f78a"),M=i("a7a5"),P=i("8286"),T=i("e8b6"),E=i("5bd3"),C=i("ae81"),R=i("d95d"),V=i("5fd4"),D=i("4dc1"),F=i("73c4"),A=i("c862"),G=i("85fd"),L=i("7b86"),z=i("46a3"),B=i("a059"),N=i("8777"),I=i("4173"),O=i("3645"),U=i("2d03"),k=i("ee65"),W=i("0a09"),H=i("20e0"),Y=i("a6bd"),j=i("5150"),X=i("d493"),Z=i("fba9"),$=i("425a"),q=i("ab24"),K=i("9355"),J=i("2b4f"),Q=i("a6ef"),tt=i("5b33"),et=["VertColorTriangle","VertColorCube","VertEntityTest","DefaultEntityTest","ImgTexturedCube","ImgCubeMap","MultiTexturedCube","BlendTest","MultiMaterialPass","MultiUniformTest","UniformTest","StorageTest","RSceneTest","SimpleLightTest","REntity3DContainerTest","Entity3DVisibilityTest","RSceneEntityManagement","SimplePBRTest","FixScreenPlaneTest","PrimitiveEntityTest","ScreenPostEffect","ModelLoadTest","DrawInstanceTest","ComputeEntityTest","GameOfLifeTest","ComputeMaterialTest","GameOfLifeMultiMaterialPass","GameOfLifePretty","GameOfLifeSphere","GameOfLifeSpherePBR","GameOfLife3DPBR","MultiGPUPassTest","RTTFixScreenTest","RTTTest","AddEntityIntoMultiRPasses","PassNodeGraphTest","ColorAttachmentReplace","PingpongBlur","FloatRTT","MRT","DepthBlur","LineEntityTest","LineObjectTest","WireframeEntityTest","EntityCloneTest","ModelEntityTest","DataDrivenTest","DataTextureTest","FloatTextureTest","Set32BitsTexMipmapData"];function it(t){function e(i){t.run(),window.requestAnimationFrame(e)}t.initialize(),window.requestAnimationFrame(e)}class rt{constructor(){this.mMana=new Q.UnitsTestMana(et),this.mUISys=new tt.UISystem}initialize(){let t=window.location.href,e=t.indexOf("?"),i="";if(e>0){t=t.slice(e+1);let r=t.split("&");if(r&&r.length>0)for(let t=0;t<r.length;++t){const e=r[t];if(e){const t=e.split("=");2==t.length&&"webgpudemounit"==t[0]&&(i=t[1].toLocaleLowerCase())}}}let Q=this.mMana.getIndex(),tt="MRT";if(i.length>0){let t=new Array(et.length);for(let i=0;i<t.length;++i)t[i]=et[i].toLocaleLowerCase();let e=t.indexOf(i);e>=0&&(Q=e)}tt=et[Q];let rt={name:tt,index:Q,demoNames:et};switch(this.mUISys.mana=this.mMana,this.mUISys.initialize(rt),tt){case"VertColorTriangle":it(new r.VertColorTriangle);break;case"VertColorCube":it(new s.VertColorCube);break;case"VertEntityTest":it(new n.VertEntityTest);break;case"DefaultEntityTest":it(new a.DefaultEntityTest);break;case"ImgTexturedCube":it(new o.ImgTexturedCube);break;case"ImgCubeMap":it(new l.ImgCubeMap);break;case"MultiTexturedCube":it(new u.MultiTexturedCube);break;case"BlendTest":it(new h.BlendTest);break;case"BlendTest":it(new h.BlendTest);break;case"MultiMaterialPass":it(new c.MultiMaterialPass);break;case"MultiUniformTest":it(new d.MultiUniformTest);break;case"UniformTest":it(new m.UniformTest);break;case"StorageTest":it(new f.StorageTest);break;case"RSceneTest":it(new p.RSceneTest);break;case"SimpleLightTest":it(new v.SimpleLightTest);break;case"REntity3DContainerTest":it(new g.REntity3DContainerTest);break;case"Entity3DVisibilityTest":it(new b.Entity3DVisibilityTest);break;case"RSceneEntityManagement":it(new y.RSceneEntityManagement);break;case"SimplePBRTest":it(new _.SimplePBRTest);break;case"FixScreenPlaneTest":it(new x.FixScreenPlaneTest);break;case"PrimitiveEntityTest":it(new w.PrimitiveEntityTest);break;case"ScreenPostEffect":it(new S.ScreenPostEffect);break;case"ModelLoadTest":it(new M.ModelLoadTest);break;case"DrawInstanceTest":it(new P.DrawInstanceTest);break;case"ComputeEntityTest":it(new T.ComputeEntityTest);break;case"GameOfLifeTest":it(new E.GameOfLifeTest);break;case"ComputeMaterialTest":it(new C.ComputeMaterialTest);break;case"GameOfLifeMultiMaterialPass":it(new R.GameOfLifeMultiMaterialPass);break;case"GameOfLifePretty":it(new V.GameOfLifePretty);break;case"GameOfLifeSphere":it(new D.GameOfLifeSphere);break;case"GameOfLifeSpherePBR":it(new F.GameOfLifeSpherePBR);break;case"GameOfLife3DPBR":it(new A.GameOfLife3DPBR);break;case"MultiGPUPassTest":it(new G.MultiGPUPassTest);break;case"RTTFixScreenTest":it(new L.RTTFixScreenTest);break;case"RTTTest":it(new z.RTTTest);break;case"AddEntityIntoMultiRPasses":it(new B.AddEntityIntoMultiRPasses);break;case"PassNodeGraphTest":it(new N.PassNodeGraphTest);break;case"ColorAttachmentReplace":it(new I.ColorAttachmentReplace);break;case"PingpongBlur":it(new O.PingpongBlur);break;case"FloatRTT":it(new U.FloatRTT);break;case"MRT":it(new k.MRT);break;case"DepthBlur":it(new W.DepthBlur);break;case"LineEntityTest":it(new H.LineEntityTest);break;case"LineObjectTest":it(new Y.LineObjectTest);break;case"WireframeEntityTest":it(new j.WireframeEntityTest);break;case"EntityCloneTest":it(new X.EntityCloneTest);break;case"ModelEntityTest":it(new Z.ModelEntityTest);break;case"DataDrivenTest":it(new $.DataDrivenTest);break;case"DataTextureTest":it(new q.DataTextureTest);break;case"FloatTextureTest":it(new K.FloatTextureTest);break;case"Set32BitsTexMipmapData":it(new J.Set32BitsTexMipmapData);break;default:break}}}e.UnitsTest=rt},bc85:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t){t&&this.initialize(t)}initialize(t){!this.mWGCtx&&t&&(this.mWGCtx=t,this.queue=t.queue)}createIndices(t){return t.length<=65536?new Uint16Array(t):new Uint32Array(t)}createIndicesWithSize(t){return t<=65536?new Uint16Array(t):new Uint32Array(t)}createIndexBuffer(t,e=0,i=!0){return this.createVtxBuffer(t,e,GPUBufferUsage.INDEX,i)}createVertexBuffer(t,e=0,i,r=!0){return this.createVtxBuffer(t,e,GPUBufferUsage.VERTEX,r,i)}createVtxBuffer(t,e=0,i=GPUBufferUsage.VERTEX,s=!0,n){let a=t.byteLength%4;a=t.byteLength+(a>0?4-a:0);const o=this.createBuffer({size:a,usage:i,mappedAtCreation:s});let l=1;if(t instanceof Float32Array)o.dataFormat="float32",l=4;else if(t instanceof Uint32Array)o.dataFormat="uint32",l=4;else if(t instanceof Uint16Array)o.dataFormat="uint16",l=2;else if(t instanceof Int32Array)o.dataFormat="int32",l=4;else if(t instanceof Int16Array)o.dataFormat="int16",l=2;else if(t instanceof Int8Array)o.dataFormat="int8";else{if(!(t instanceof Uint8Array))throw Error("Illegal data type, need: Float32Array | Uint32Array | Uint16Array  | Int32Array | Int16Array | Uint8Array | Int8Array");o.dataFormat="uint8"}if(s){const i=o.getMappedRange();t instanceof Float32Array?new Float32Array(i).set(t,e):t instanceof Uint32Array?new Uint32Array(i).set(t,e):t instanceof Uint16Array?new Uint16Array(i).set(t,e):t instanceof Int32Array?new Int32Array(i).set(t,e):t instanceof Int16Array?new Int16Array(i).set(t,e):t instanceof Int8Array?new Int8Array(i).set(t,e):t instanceof Uint8Array&&new Uint8Array(i).set(t,e),o.unmap()}if(o.elementCount=t.length,n&&n.length>0){let t=0;const e=new Array(n.length),i=new Array(n.length);for(let r=0;r<i.length;++r)e[r]=t,t+=n[r]*l,i[r]=o.dataFormat+"x"+n[r];o.vectorOffsets=e,o.vectorFormats=i,o.arrayStride=t,o.vectorLengths=n.slice(),o.vectorCount=o.elementCount/n[0]}return o.enabled=!0,o.shared=!1,o.uid=r.sVtxUid++,o}createBuffer(t){const e=this.mWGCtx.device.createBuffer(t);return e.uid=r.sVtxUid++,e}updateUniformBuffer(t,e,i,r=0){this.queue.writeBuffer(t,t.segs[i].index+r,e.buffer,e.byteOffset,e.byteLength)}}r.sVtxUid=0,e.WebGPUBufferContext=r},bcc5:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("b1fa"));class n extends s.default{constructor(){super(),this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.repeat=!1,this.key="",this.keyCode=0,this.location=0}getClassType(){return n.EventClassType}}n.EventClassType=1003,n.KEY_DOWN=6001,n.KEY_UP=6002,e.default=n},bd36:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("348f")),n=r(i("f522")),a=r(i("af80")),o=r(i("c6d1"));class l extends s.default{constructor(){super(),this.mvs=null,this.muvs=null,this.mnvs=null,this.m_cvs=null,this.m_boundsChanged=!1,this.geometry=new n.default,this.uScale=1,this.vScale=1,this.axisType=0}getCircleCenterAt(t,e){this.geometry.getCenterAt(t,e),this.m_boundsChanged=!0}transformCircleAt(t,e){this.geometry.transformAt(t,e),this.m_boundsChanged=!0}getVS(){return this.mvs}getUVS(){return this.muvs}getNVS(){return this.mnvs}getCVS(){return this.m_cvs}getIVS(){return this.mivs}initialize(t,e,i,r,s=1,n=-.5){if(null==this.mvs){let l=this.geometry;switch(this.axisType){case 1:l.axisType=2;break;case 2:l.axisType=0;break;default:l.axisType=1;break}l.initialize(e,0,i,r,s,n);let u=!0,h=l.getVS(),c=l.getUVS(),d=l.getIVS();u&&(this.mnvs=new Float32Array(h.length));let m=this.mnvs,f=2*Math.PI,p=0,v=new a.default,g=new a.default,b=new o.default;for(let e=0;e<=r;++e){switch(b.identity(),p=f*e/r,this.axisType){case 1:v.x=Math.cos(p)*t,v.z=Math.sin(p)*t,b.rotationY(-p);break;case 2:v.y=Math.cos(p)*t,v.x=Math.sin(p)*t,b.rotationZ(-p);break;default:v.z=Math.cos(p)*t,v.y=Math.sin(p)*t,b.rotationX(-p);break}if(b.setTranslation(v),l.transformAt(e,b),u){let t=v,i=l.getRangeAt(e),r=h.subarray(i[0],i[1]),s=m.subarray(i[0],i[1]),n=r.length/3,a=0;for(let e=0;e<n;++e)a=3*e,g.setXYZ(r[a],r[a+1],r[a+2]),g.subtractBy(t),g.normalize(),s[a]=g.x,s[a+1]=g.y,s[a+2]=g.z}}this.mvs=h,this.muvs=c,this.mivs=d,this.bounds=this.geometry.bounds,this.bounds.reset(),this.bounds.addFloat32Arr(this.mvs),this.bounds.update(),this.vtCount=this.geometry.vtCount,this.trisNumber=this.geometry.trisNumber,this.vtxTotal=this.mvs.length/3}this.initializeBuf(!0)}reinitialize(){null!=this.mvs&&this.initializeBuf(!1)}initializeBuf(t){null!=this.mTransMatrix&&(this.m_boundsChanged=!0,this.mTransMatrix.transformVectorsSelf(this.mvs,this.mvs.length)),this.m_boundsChanged&&(this.bounds.reset(),this.bounds.addFloat32Arr(this.mvs),this.bounds.updateFast()),this.m_boundsChanged=!1}__$destroy(){this.mivs&&(this.bounds=null,this.mvs=null,this.muvs=null,this.mnvs=null,this.m_cvs=null,super.__$destroy())}}e.default=l},bd7e:function(t,e,i){"use strict";i.r(e),e["default"]="\r\n@group(0) @binding(0) var<uniform> objMat : mat4x4<f32>;\r\n@group(0) @binding(1) var<uniform> viewMat : mat4x4<f32>;\r\n@group(0) @binding(2) var<uniform> projMat : mat4x4<f32>;\r\n\r\n@group(0) @binding(3) var<uniform> grid: vec2f;\r\n@group(0) @binding(4) var<storage> cellState: array<u32>;\r\n@group(0) @binding(5) var<storage> lifeState: array<f32>;\r\n@group(0) @binding(6) var<storage> wpositions: array<vec4f>;\r\n\r\nstruct VertexInput {\r\n\t@location(0) pos: vec3f,\r\n  \t@location(1) uv : vec2f,\r\n  \t@location(2) normal : vec3f,\r\n\t@builtin(instance_index) instance: u32\r\n};\r\n\r\nstruct VertexOutput {\r\n\t@builtin(position) position: vec4f,\r\n\t@location(0) pos : vec4<f32>,\r\n\t@location(1) uv: vec2f,\r\n\t@location(2) normal : vec3<f32>,\r\n\t@location(3) camPos : vec3<f32>,\r\n\t@location(4) albedo : vec3<f32>,\r\n\t@location(5) param : vec3<f32>,\r\n};\r\n\r\nfn m44ToM33(m: mat4x4<f32>) -> mat3x3<f32> {\r\n\treturn mat3x3(m[0].xyz, m[1].xyz, m[2].xyz);\r\n}\r\nfn inverseM33(m: mat3x3<f32>)-> mat3x3<f32> {\r\n    let a00 = m[0][0]; let a01 = m[0][1]; let a02 = m[0][2];\r\n    let a10 = m[1][0]; let a11 = m[1][1]; let a12 = m[1][2];\r\n    let a20 = m[2][0]; let a21 = m[2][1]; let a22 = m[2][2];\r\n    let b01 = a22 * a11 - a12 * a21;\r\n    let b11 = -a22 * a10 + a12 * a20;\r\n    let b21 = a21 * a10 - a11 * a20;\r\n    let det = a00 * b01 + a01 * b11 + a02 * b21;\r\n    return mat3x3<f32>(\r\n\t\tvec3<f32>(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11)) / det,\r\n                vec3<f32>(b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10)) / det,\r\n                vec3<f32>(b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det);\r\n}\r\nfn inverseM44(m: mat4x4<f32>)-> mat4x4<f32> {\r\n    let a00 = m[0][0]; let a01 = m[0][1]; let a02 = m[0][2]; let a03 = m[0][3];\r\n    let a10 = m[1][0]; let a11 = m[1][1]; let a12 = m[1][2]; let a13 = m[1][3];\r\n    let a20 = m[2][0]; let a21 = m[2][1]; let a22 = m[2][2]; let a23 = m[2][3];\r\n    let a30 = m[3][0]; let a31 = m[3][1]; let a32 = m[3][2]; let a33 = m[3][3];\r\n    let b00 = a00 * a11 - a01 * a10;\r\n    let b01 = a00 * a12 - a02 * a10;\r\n    let b02 = a00 * a13 - a03 * a10;\r\n    let b03 = a01 * a12 - a02 * a11;\r\n    let b04 = a01 * a13 - a03 * a11;\r\n    let b05 = a02 * a13 - a03 * a12;\r\n    let b06 = a20 * a31 - a21 * a30;\r\n    let b07 = a20 * a32 - a22 * a30;\r\n    let b08 = a20 * a33 - a23 * a30;\r\n    let b09 = a21 * a32 - a22 * a31;\r\n    let b10 = a21 * a33 - a23 * a31;\r\n    let b11 = a22 * a33 - a23 * a32;\r\n    let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\treturn mat4x4<f32>(\r\n\t\tvec4<f32>(a11 * b11 - a12 * b10 + a13 * b09,\r\n\t\ta02 * b10 - a01 * b11 - a03 * b09,\r\n\t\ta31 * b05 - a32 * b04 + a33 * b03,\r\n\t\ta22 * b04 - a21 * b05 - a23 * b03) / det,\r\n\t\t\tvec4<f32>(a12 * b08 - a10 * b11 - a13 * b07,\r\n\t\ta00 * b11 - a02 * b08 + a03 * b07,\r\n\t\ta32 * b02 - a30 * b05 - a33 * b01,\r\n\t\ta20 * b05 - a22 * b02 + a23 * b01) / det,\r\n\t\tvec4<f32>(a10 * b10 - a11 * b08 + a13 * b06,\r\n\t\ta01 * b08 - a00 * b10 - a03 * b06,\r\n\t\ta30 * b04 - a31 * b02 + a33 * b00,\r\n\t\ta21 * b02 - a20 * b04 - a23 * b00) / det,\r\n\t\tvec4<f32>(a11 * b07 - a10 * b09 - a12 * b06,\r\n\t\ta00 * b09 - a01 * b07 + a02 * b06,\r\n\t\ta31 * b01 - a30 * b03 - a32 * b00,\r\n\t\ta20 * b03 - a21 * b01 + a22 * b00) / det);\r\n}\r\n\r\n@vertex\r\nfn vertMain(input: VertexInput) -> VertexOutput {\r\n\r\n    var state = f32(cellState[input.instance]);\r\n    var output: VertexOutput;\r\n\tlet f = clamp((lifeState[ input.instance ])/100.0, 0.0005, 1.0);\r\n\tvar scale = 0.5;\r\n\tif(state < 1.0) {\r\n\t\tscale = 0.1;\r\n\t}\r\n\tvar scaleY = 5.0;\r\n\tif(state < 1.0) {\r\n\t\tscaleY = 1.0;\r\n\t}\r\n    var wpos = objMat * vec4f(input.pos.xyz * vec3f(f * 0.5 + scale, f * scaleY + scale , f * 0.5 + scale), 1.0);\r\n\twpos = vec4f(wpos.xyz + wpositions[ input.instance ].xyz, wpos.w);\r\n\r\n  \tlet invMat33 = inverseM33( m44ToM33( objMat ) );\r\n\toutput.normal = normalize( input.normal * invMat33 );\r\n  \toutput.camPos = (inverseM44(viewMat) * vec4<f32>(0.0,0.0,0.0, 1.0)).xyz;\r\n  \toutput.pos = wpos;\r\n\r\n    let i = f32(input.instance);\r\n    let cell = vec2f(i % grid.x, floor(i / grid.x));\r\n\r\n\r\n\r\n    var projPos = projMat * viewMat * wpos;\r\n\t// if(state < 1.0) {\r\n\t// \tprojPos = vec4f(projPos.xyz, -1);\r\n\t// }\r\n    output.position = projPos;\r\n\r\n    output.uv = input.uv;\r\n\r\n\tlet c = cell / grid;\r\n\tvar dis = length(input.uv - vec2<f32>(0.5, 0.5));\r\n\tdis = min(dis/0.51, 1.0);\r\n\tdis = (1.0 - pow(dis, 50.0)) * (1.0 - f) + f;\r\n\tvar c3 = vec3f(c, (1.0 - c.x) * (1.0 - f) + f) * dis;\r\n    output.albedo = c3 * 2.0;\r\n\toutput.param = vec3f(1.1, 0.6 - (f* 0.6) + 0.1, 0.5 + (f* 0.5));\r\n    return output;\r\n}"},bd91:function(t,e,i){"use strict";var r;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["XYZ"]=0]="XYZ",t[t["YZX"]=1]="YZX",t[t["ZXY"]=2]="ZXY",t[t["XZY"]=3]="XZY",t[t["YXZ"]=4]="YXZ",t[t["ZYX"]=5]="ZYX"}(r||(r={})),e.EulerOrder=r},bf93:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("e2cf");e.findShaderEntryPoint=r.findShaderEntryPoint,e.WGRShadeSrcParam=r.WGRShadeSrcParam,e.WGRShderSrcType=r.WGRShderSrcType;class s{constructor(t){if(this.buildDeferred=!0,this.sampleCount=1,this.multisampleEnabled=!1,this.depthStencilEnabled=!1,this.fragmentEnabled=!0,this.layout="auto",this.vertex={module:null,entryPoint:"main",buffers:[]},t){const i=this;for(var e in t)i[e]=t[e];this.depthStencilEnabled=!!this.depthStencil||this.depthStencilEnabled,this.depthStencilEnabled&&!this.depthStencil&&(this.depthStencil={depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"}),this.fragmentEnabled&&(this.fragment=r.createFragmentState()),this.primitive={frontFace:"ccw",topology:"triangle-list",cullMode:"back"},this.multisampleEnabled&&(this.multisample={count:this.sampleCount})}}setDepthStencilParam(t){this.depthStencilEnabled&&(this.depthStencil=t)}setDepthStencil(t){if(t){this.depthStencil||(this.depthStencil=t);const i=t,r=this.depthStencil;for(var e in i)r[e]=i[e]}}setDepthWriteEnabled(t){this.depthStencilEnabled=t,this.depthStencil&&(this.depthStencil.depthWriteEnabled=t),t&&(this.depthStencil||(this.depthStencil={depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"}))}setDepthStencilFormat(t){this.depthStencil&&(this.depthStencil.format=t)}setPrimitiveState(t){if(t){switch(this.primitive||(this.primitive=t),t.cullMode){case"back":case"front":case"none":this.primitive.cullMode=t.cullMode;break}switch(t.frontFace){case"cw":case"ccw":this.primitive.frontFace=t.frontFace;break}switch(t.topology){case"triangle-strip":case"triangle-list":case"point-list":case"line-list":case"line-strip":this.primitive.topology=t.topology;break}}}setBlendModes(t){for(let e=0;e<t.length;++e)this.setBlendMode(t[e],e)}setBlendMode(t,e=0){let i={srcFactor:"one",dstFactor:"zero"},r={srcFactor:"one",dstFactor:"zero"};switch(t){case"transparent":i={srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},r={srcFactor:"zero",dstFactor:"one"};break;case"add":i={srcFactor:"src-alpha",dstFactor:"one"},r={srcFactor:"zero",dstFactor:"one"};break;case"alpha_add":i={srcFactor:"one",dstFactor:"one-minus-src-alpha"},r={srcFactor:"one",dstFactor:"one-minus-src-alpha"};break;default:break}this.setBlendParam(i,r,e)}setBlendParam(t,e,i=0){if(this.fragmentEnabled){const r=this.fragment,s=r.targets[i];s.blend?(t&&(s.blend.color=t),e&&(s.blend.alpha=e)):s.blend={color:t,alpha:e}}}addFragmentColorTarget(t){if(this.fragmentEnabled&&t){const e=this.fragment;e.targets.push(t)}}setFragmentColorTarget(t,e=0){if(this.fragmentEnabled&&t){const i=this.fragment;i.targets[e]=t}}setVertexBufferArrayStrideAt(t,e=0){const i=this.vertex;i.buffers.length<1&&this.addVertexBufferLayout({arrayStride:0,attributes:[],stepMode:"vertex"}),i.buffers[e].arrayStride=t}addVertexBufferAttribute(t,e=0){const i=this.vertex;i.buffers.length<1&&this.addVertexBufferLayout({arrayStride:0,attributes:[],stepMode:"vertex"});let r=i.buffers[e].attributes;r.push(t)}addVertexBufferLayout(t){const e=this.vertex;e.buffers.push(t)}}e.WGRPipelineCtxParams=s},c14c:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("f3f6")),a=r(i("0bc4")),o=i("943f"),l=i("746a"),u=i("551f"),h=i("58c4"),c=r(i("af80")),d=i("e44f"),m=r(i("c69e")),f=i("4ad2"),p=i("213f");class v{constructor(){this.mRscene=new f.RendererScene,this.geomData=new s.GeomDataBuilder,this.mouseDown=t=>{}}initialize(){this.initEvent();const t={vertShaderSrc:{code:n.default,uuid:"vertShdCode"},fragShaderSrc:{code:a.default,uuid:"fragShdCode"}},e=[this.createMaterial(t,[new h.WGImage2DTextureData("static/assets/box.jpg")],["solid"],"back"),this.createMaterial(t,[new h.WGImage2DTextureData("static/assets/brickwall_big512.jpg")],["solid"],"back"),this.createMaterial(t,[new h.WGImage2DTextureData("static/assets/metal_02.jpg")],["solid"],"back")];this.createEntities(e,new c.default(0,200,0))}initEvent(){const t=this.mRscene;t.addEventListener(m.default.MOUSE_DOWN,this.mouseDown),(new p.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}createMaterial(t,e,i=[],r="back"){let s={depthWriteEnabled:!0,faceCullMode:r,blendModes:[]};s.blendModes=i;const n=e?e.length:0,a=new o.WGMaterial({shadinguuid:"base-material-tex"+n,shaderSrc:t,pipelineDefParam:s});let l=new d.WGRStorageValue({data:new Float32Array([1,1,1,1])});return a.uniformValues=[l],a.addTextureWithDatas(e),a}createGeom(t){const e=(new l.WGGeometry).addAttribute({shdVarName:"position",data:t.vs,strides:[3]}).addAttribute({shdVarName:"uv",data:t.uvs,strides:[2]}).setIndexBuffer({name:"geomIndex",data:t.ivs});return e}createEntities(t,e){const i=this.mRscene;e=e||new c.default;let r=this.createGeom(this.geomData.createSphere(30,30,30)),s=this.createGeom(this.geomData.createCube(100)),n=this.createGeom(this.geomData.createTorus(100));const a=new u.Entity3D;a.materials=[t[0]],a.geometry=s,a.transform.setPosition(new c.default(0,-150,0).addBy(e)),a.transform.setScaleXYZ(8,.1,8),i.addEntity(a);for(let o=0;o<6;++o){const r=new u.Entity3D;r.materials=[t[1]],r.geometry=n,r.transform.setPosition(new c.default(80*o-200,0,0).addBy(e)),i.addEntity(r)}for(let o=0;o<12;++o){const s=new u.Entity3D;s.materials=[t[2]],s.geometry=r,s.transform.setPosition(new c.default(80*o-400,0,0).addBy(e)),i.addEntity(s)}}run(){this.mRscene.run()}}e.RSceneTest=v},c29f:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("71f1"),s=i("746a"),n=i("1eee");class a extends n.PrimitiveEntity{constructor(t){let e=void 0!==t.modelUrl&&void 0===t.geometry;e&&(t.building=!1),super(t),e&&this.initModel()}createModelGeometry(t){const e=(new s.WGGeometry).addAttribute({position:t.vertices}).addAttribute({uv:t.uvsList[0]}).addAttribute({normal:t.normals}).setIndices(t.indices);return e}initModel(){let t=this.mDescParam.modelUrl;r.modelLoader.load([t],(t,e)=>{let i=t.length;for(let r=0;r<i;++r){this.geometry=this.createModelGeometry(t[r]),this.mDescParam.building=!0,this.init(this.mDescParam),this.createMaterial(this.mDescParam);break}})}}e.ModelEntity=a},c3d6:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("ec7b")),n=r(i("af80")),a=r(i("9e08"));class o extends a.default{constructor(){super(...arguments),this.tv=new n.default(1,0,0)}update(){this.tv.normalize()}updateFast(){this.tv.normalize()}static IntersectionTri(t,e,i,r,s,n){return 0}static IntersectionLS(t,e,i,r,s,l=1){let u=o.__tAv;if(u.copyFrom(r),u.subtractBy(i),u.normalize(),n.default.Cross(e,u,s),s.normalize(),u.w=s.dot(t)-s.dot(r),Math.abs(u.w)<=l){s.crossBy(e),s.normalize(),s.w=s.dot(t),u.w=(s.w-s.dot(i))/u.dot(s),s.copyFrom(u),s.scaleBy(u.w),s.addBy(i),u.copyFrom(s),u.subtractBy(i);let n=a.default.__tV1;if(n.copyFrom(s),n.subtractBy(r),u.dot(n)<=0)return 1}return 0}static IntersectioNearSphere2(t,e,i,r,n){let a=o.__tAv;if(a.x=i.x-t.x,a.y=i.y-t.y,a.z=i.z-t.z,a.w=a.dot(e),r*=r,a.w>s.default.MATH_MIN_POSITIVE){if(n.copyFrom(e),n.scaleBy(a.w),n.subtractBy(a),a.x=n.getLengthSquared(),a.x<=r)return a.w-=Math.sqrt(r-a.x),n.copyFrom(e),n.scaleBy(a.w),n.addBy(t),n.w=1,1}else if(a.getLengthSquared()<=r&&(n.copyFrom(e),n.scaleBy(a.w),n.subtractBy(a),a.x=n.getLengthSquared(),a.x<=r))return a.w+=Math.sqrt(r-a.x),n.copyFrom(e),n.scaleBy(a.w),n.addBy(t),n.w=1,1;return 0}static IntersectioNearSphere(t,e,i,r,n){let a=o.__tAv;if(a.x=i.x-t.x,a.y=i.y-t.y,a.z=i.z-t.z,a.w=a.dot(e),a.w>s.default.MATH_MIN_POSITIVE){if(n.x=a.x-a.w*e.x,n.y=a.y-a.w*e.y,n.z=a.z-a.w*e.z,n.x=n.getLengthSquared(),n.w=r*r,n.x<=n.w)return n.x=a.getLengthSquared(),n.z=n.w-n.x,a.normalize(),n.y=a.dot(e)*Math.sqrt(n.x),a.w=.5*(-n.y+Math.sqrt(n.y*n.y+4*n.z)),n.copyFrom(e),n.scaleBy(a.w),n.addBy(t),n.w=1,1}else if(n.x=a.getLengthSquared(),n.w=r*r,n.x<=n.w)return n.z=n.w-n.x,a.normalize(),n.y=a.dot(e)*Math.sqrt(n.x),a.w=.5*(-n.y+Math.sqrt(n.y*n.y+4*n.z)),n.copyFrom(e),n.scaleBy(a.w),n.addBy(t),n.w=1,1;return 0}static IntersectSphere(t,e,i,r){let n=o.__tAv;return n.x=i.x-t.x,n.y=i.y-t.y,n.z=i.z-t.z,n.w=n.dot(e),n.w<s.default.MATH_MIN_POSITIVE||(n.x-=n.w*e.x,n.y-=n.w*e.y,n.z-=n.w*e.z),n.getLengthSquared()<=r*r}}o.__tAv=new n.default,e.default=o},c433:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("ec7b")),n=r(i("4e74")),a=i("7650"),o=i("406a"),l=r(i("af80")),u=new l.default;class h{constructor(t){this.mUid=h.sUid++,this.mFS32=null,this.mInvMat=!1,this.mRot=!1,this.mDt=0,this.version=-1,this.__$transUpdate=0,this.updatedStatus=h.POSITION,this.updateStatus=h.TRANSFORM,this.mToParentMatFlag=!0,this.mDt=t?1:0,this.mFS32=t||new Float32Array(16)}set transform(t){t&&(this.setScale(t.scale),this.setRotation(t.rotation),this.setPosition(t.position),t.matrix&&16==t.matrix.length&&this.mFS32.set(t.matrix))}get transform(){return{scale:this.getScale(),rotation:this.getRotation(),position:this.getPosition()}}get uid(){return this.mUid}get fs32Data(){return this.mFS32}rebuildFS32Data(){this.mDt>0&&(this.mDt=0,this.mFS32=new Float32Array(16))}getRotationFlag(){return this.mRot}getX(){return this.mFS32[12]}getY(){return this.mFS32[13]}getZ(){return this.mFS32[14]}setX(t){return this.updateStatus|=1,this.updatedStatus|=1,this.mFS32[12]=t,this.updateTo(),this}setY(t){return this.updateStatus|=1,this.updatedStatus|=1,this.mFS32[13]=t,this.updateTo(),this}setZ(t){return this.updateStatus|=1,this.updatedStatus|=1,this.mFS32[14]=t,this.updateTo(),this}setXYZ(t,e,i){return this.mFS32[12]=t,this.mFS32[13]=e,this.mFS32[14]=i,this.updateStatus|=1,this.updatedStatus|=1,this.updateTo(),this}offsetPosition(t){return u.setXYZ(0,0,0).setVector3(t),this.mFS32[12]+=u.x,this.mFS32[13]+=u.y,this.mFS32[14]+=u.z,this.updateStatus|=1,this.updatedStatus|=1,this.updateTo(),this}setPosition(t){return u.setXYZ(0,0,0).setVector3(t),this.mFS32[12]=u.x,this.mFS32[13]=u.y,this.mFS32[14]=u.z,this.updateStatus|=1,this.updatedStatus|=1,this.updateTo(),this}getPosition(t){return t||(t=new l.default),t.x=this.mFS32[12],t.y=this.mFS32[13],t.z=this.mFS32[14],t}copyPositionFrom(t){return t&&(this.mFS32[12]=t.mFS32[12],this.mFS32[13]=t.mFS32[13],this.mFS32[14]=t.mFS32[14],this.updateStatus|=h.POSITION,this.updatedStatus|=h.POSITION,this.updateTo()),this}getRotationX(){return this.mFS32[1]}getRotationY(){return this.mFS32[6]}getRotationZ(){return this.mFS32[9]}setRotationX(t){return this.mFS32[1]=t,this.mRot=!0,this.updateStatus|=h.ROTATION,this.updatedStatus|=h.ROTATION,this.updateTo(),this}setRotationY(t){return this.mFS32[6]=t,this.mRot=!0,this.updateStatus|=h.ROTATION,this.updatedStatus|=h.ROTATION,this.updateTo(),this}setRotationZ(t){return this.mFS32[9]=t,this.mRot=!0,this.updateStatus|=h.ROTATION,this.updatedStatus|=h.ROTATION,this.updateTo(),this}setRotationXYZ(t,e,i){return this.mFS32[1]=t,this.mFS32[6]=e,this.mFS32[9]=i,this.updateStatus|=h.ROTATION,this.updatedStatus|=h.ROTATION,this.mRot=!0,this.updateTo(),this}setRotation(t){return u.setXYZ(0,0,0).setVector3(t),this.setRotationXYZ(u.x,u.y,u.z),this}getRotation(t){return t||(t=new l.default),t.x=this.mFS32[1],t.y=this.mFS32[6],t.z=this.mFS32[9],t}getScaleX(){return this.mFS32[0]}getScaleY(){return this.mFS32[5]}getScaleZ(){return this.mFS32[10]}setScaleX(t){return this.mFS32[0]=t,this.updateStatus|=h.SCALE,this.updatedStatus|=h.SCALE,this}setScaleY(t){return this.mFS32[5]=t,this.updateStatus|=h.SCALE,this.updatedStatus|=h.SCALE,this}setScaleZ(t){return this.mFS32[10]=t,this.updateStatus|=h.SCALE,this.updatedStatus|=h.SCALE,this}setScaleXYZ(t,e,i){return this.mFS32[0]=t,this.mFS32[5]=e,this.mFS32[10]=i,this.updateStatus|=h.SCALE,this.updatedStatus|=h.SCALE,this.updateTo(),this}setScale(t){return u.setXYZ(1,1,1).setVector3(t),this.setScaleXYZ(u.x,u.y,u.z),this}getScale(t){return t||(t=new l.default),t.x=this.mFS32[0],t.y=this.mFS32[5],t.z=this.mFS32[10],t}setScaleAll(t){return this.mFS32[0]=t,this.mFS32[5]=t,this.mFS32[10]=t,this.updateStatus|=h.SCALE,this.updatedStatus|=h.SCALE,this.updateTo(),this}localToGlobal(t){this.getMatrix().transformVectorSelf(t)}globalToLocal(t){this.getInvMatrix().transformVectorSelf(t)}getInvMatrix(){return this.mInvOmat?this.mInvMat&&(this.mInvOmat.copyFrom(this.mOMat),this.mInvOmat.invert()):(this.mInvOmat=n.default.GetMatrix(),this.mInvOmat.copyFrom(this.mOMat),this.mInvOmat.invert()),this.mInvMat=!1,this.mInvOmat}getLocalMatrix(){return this.updateStatus>0&&this.update(),this.mLocalMat}getMatrix(t=!0){return this.updateStatus>0&&t&&this.update(),this.mOMat}getToParentMatrix(){return this.mToParentMat?this.mToParentMat:this.mOMat}setParentMatrix(t){return this.mParentMat=t,this.mInvMat=!0,this.mParentMat&&(this.mLocalMat==this.mOMat?(this.updateStatus=h.TRANSFORM,this.updatedStatus=this.updateStatus,this.mLocalMat=n.default.GetMatrix()):(this.updateStatus|=h.PARENT_MAT,this.updatedStatus=this.updateStatus),this.updateTo()),this}getParentMatrix(){return this.mParentMat}updateMatrixData(t){return t&&(this.updateStatus=h.NONE,this.mInvMat=!0,this.mOMat.copyFrom(t),this.updateTo()),this}__$setMatrix(t){null!=t&&(this.updateStatus=h.NONE,this.mInvMat=!0,this.mLocalMat==this.mOMat&&(this.mLocalMat=t),this.mOMat&&n.default.RetrieveMatrix(this.mOMat),this.mOMat=t,this.updateTo())}destroy(){this.mInvOmat&&n.default.RetrieveMatrix(this.mInvOmat),this.mLocalMat&&n.default.RetrieveMatrix(this.mLocalMat),this.mOMat&&this.mOMat!=this.mLocalMat&&n.default.RetrieveMatrix(this.mOMat),this.mInvOmat=null,this.mLocalMat=null,this.mOMat=null,this.mParentMat=null,this.updateStatus=h.TRANSFORM,this.mFS32=null}copyFrom(t){this.mFS32.set(t.mFS32,0),this.updatedStatus|=1,this.updateStatus|=h.TRANSFORM,this.mRot=t.mRot,this.updateTo()}forceUpdate(){this.updateStatus|=h.TRANSFORM,this.update()}updateTo(){}isDirty(){return this.updateStatus!=h.NONE}update(){let t=this.updateStatus;if(t>0){if(this.mInvMat=!0,t|=this.updatedStatus,(t&h.TRANSFORM)>0){const e=s.default.MATH_PI_OVER_180;this.mLocalMat.getLocalFS32().set(this.mFS32,0),this.mRot&&this.mLocalMat.setRotationEulerAngle(this.mFS32[1]*e,this.mFS32[6]*e,this.mFS32[9]*e),this.mParentMat&&(t|=h.PARENT_MAT)}this.mOMat!=this.mLocalMat&&this.mOMat.copyFrom(this.mLocalMat),(t&h.PARENT_MAT)==h.PARENT_MAT&&(this.mToParentMat||(this.mToParentMat=n.default.GetMatrix()),this.mToParentMat.copyFrom(this.mOMat),this.mToParentMatFlag=!0,this.mOMat.append(this.mParentMat)),t=h.NONE,this.version++,this.uniformv.upate()}this.updateStatus=t,this.__$transUpdate=0}getMatrixFS32(){return this.getMatrix().getLocalFS32()}static GetFreeId(){return h.sFreeIds.length>0?h.sFreeIds.pop():-1}static Create(t){let e;t=t||{};const i=t.fs32?-1:h.GetFreeId();if(i>=0?(e=h.sUList[i],h.sFlags[i]=h.sFBUSY,e.rebuildFS32Data()):(e=new h(t.fs32),h.sUList.push(e),h.sFlags.push(h.sFBUSY)),t.matrix?e.mOMat=t.matrix:e.mOMat=n.default.GetMatrix(),e.mLocalMat=e.mOMat,!t.fs32){const t=o.IdentityMat4Data;e.mFS32?e.mFS32.set(t,0):e.mFS32=t.slice(0)}return e.uniformv=new a.WGRUniformValue({data:e.mOMat.getLocalFS32(),shdVarName:"objMat"}),t.transform&&(e.transform=t.transform),e}static Restore(t){if(t&&h.sFlags[t.uid]==h.sFBUSY){const e=t.uid;h.sFreeIds.push(e),h.sFlags[e]=h.sFFREE,t.destroy()}}}h.sUid=0,h.NONE=0,h.POSITION=1,h.ROTATION=2,h.SCALE=4,h.TRANSFORM=7,h.PARENT_MAT=8,h.sFBUSY=1,h.sFFREE=0,h.sFlags=[],h.sUList=[],h.sFreeIds=[],e.default=h},c4ad:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("603e"),s=i("1ee1"),n=i("5009"),a=i("97f2"),o=i("0069"),l=i("76e3"),u=i("648f"),h=i("c29f"),c=i("7e70"),d=i("6d7a"),m=i("9849"),f=i("5118"),p=["axis","line","rectLineGrid","boundsFrame","plane","box","cube","sphere","cylinder","cone","torus","model","container"];function v(t){if(!t)return t;let e=t;for(let i=0;i<p.length;++i)if(e=t[p[i]],e){e.entityType=p[i];break}return e||(e=t),e}function g(t){let e;if(t){let i=t.entity;switch(t.entityType){case"axis":void 0!==i.size&&(i.axisLength=i.size),i.size=void 0,e=new r.AxisEntity(t.entity);break;case"line":e=new u.Line3DEntity(t.entity);break;case"rectLineGrid":e=new d.RectLineGridEntity(t.entity);break;case"boundsFrame":e=new s.BoundsFrameEntity(t.entity);break;case"plane":e=new c.PlaneEntity(t.entity);break;case"box":i=t.entity,void 0!==i.size&&(i.cubeSize=i.size),i.size=void 0,e=new n.BoxEntity(t.entity);break;case"cube":e=new o.CubeEntity(t.entity);break;case"sphere":e=new m.SphereEntity(t.entity);break;case"cylinder":e=new l.CylinderEntity(t.entity);break;case"cone":e=new a.ConeEntity(t.entity);break;case"torus":e=new f.TorusEntity(t.entity);break;case"model":i=t.entity,void 0!==i.url&&(i.modelUrl=i.url),i.url=void 0,e=new h.ModelEntity(t.entity);break;case"container":break;default:break}e&&(t.uid=e.uid)}return e}class b{constructor(){}createEntity(t){let e;if(!t)throw Error("Illegal Operation !!!");{let i=t,r=v(i);e=g(r)}return e}}e.DataDrivenEntityBuilder=b},c58a:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{static hArrangementDivs(t){if(t.length>0){let e=t[0].parentElement;if(e){let i=e.getBoundingClientRect(),r=0;for(let e=0;e<t.length;++e){const i=t[e].getBoundingClientRect();r+=i.width}let s=i.width-r,n=.5*s;s/=t.length+1,s<=0?s=0:n=.5*(i.width-r-s*(t.length-1));for(let e=0;e<t.length;++e){let i=t[e];const r=i.getBoundingClientRect();i.style.left=Math.round(n)+"px",n+=r.width+s}}}}static createDiv(t,e,i="",r="",s=!1){const n=document.createElement("div");let a=n.style;return t>0&&e>0&&(a.width=t+"px",a.height=e+"px"),a.display="block",""!=i&&(a.display=i),a.position="relative",""!=r&&(a.position=r),s&&(a.alignItems="center",a.justifyContent="center"),n}static createDivT1(t,e,i,r,s="",n="",a=!0){const o=document.createElement("div");let l=o.style;return l.left=t+"px",l.top=e+"px",i>0&&r>0&&(l.width=i+"px",l.height=r+"px"),l.display="block",""!=s&&(l.display=s),l.position="relative",""!=n&&(l.position=n),a&&(l.alignItems="center",l.justifyContent="center"),o}static clearDivAllEles(t){t.replaceChildren()}static setVisible(t,e){let i=t.style;i.visibility=e?"visible":"hidden"}static isVisible(t){return"visible"==t.style.visibility}static setTextColor(t,e){t.style.color="#"+e.toString(16)}}e.DivTool=r},c69e:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("af80")),n=r(i("b1fa"));class a extends n.default{constructor(){super(),this.lpos=new s.default,this.wpos=new s.default,this.raytv=new s.default(1,0,0),this.raypv=new s.default(0,0,0),this.mouseX=0,this.mouseY=0,this.mouseViewX=0,this.mouseViewY=0,this.posArray=null,this.wheelDeltaY=0}static GetMouseEvtTypeValueBase(){return 5001}static GetMouseEvtTypeValuesTotal(){return 24}getClassType(){return a.EventClassType}}a.EventClassType=1002,a.MOUSE_DOWN=5001,a.MOUSE_UP=5002,a.MOUSE_RIGHT_UP=5003,a.MOUSE_RIGHT_DOWN=5004,a.MOUSE_MOVE=5005,a.MOUSE_WHEEL=5006,a.MOUSE_OVER=5007,a.MOUSE_OUT=5008,a.MOUSE_CLICK=5009,a.MOUSE_RIGHT_CLICK=5010,a.MOUSE_DOUBLE_CLICK=5011,a.MOUSE_CANCEL=5012,a.MOUSE_MULTI_DOWN=5013,a.MOUSE_MULTI_UP=5014,a.MOUSE_MULTI_MOVE=5015,a.MOUSE_BG_DOWN=5016,a.MOUSE_BG_UP=5017,a.MOUSE_BG_CLICK=5018,a.MOUSE_MIDDLE_DOWN=5019,a.MOUSE_MIDDLE_UP=5020,a.MOUSE_BG_RIGHT_DOWN=5021,a.MOUSE_BG_RIGHT_UP=5022,a.MOUSE_BG_MIDDLE_DOWN=5023,a.MOUSE_BG_MIDDLE_UP=5024,e.default=a},c6d1:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("ec7b")),n=r(i("af80")),a=i("bd91"),o=r(i("cbb4")),l=i("406a");class u{constructor(t,e=0){this.mUid=-1,this.mIndex=0,this.mIndex=e,t?(this.mUid=u.sUid++,this.mFS32=t,this.mLocalFS32=this.mFS32.subarray(e,e+16)):(this.mUid=u.sIsolatedUid++,this.mFS32=new Float32Array(16),this.mFS32.set(l.IdentityMat4Data,0),this.mLocalFS32=this.mFS32)}fromArray(t,e=0){const i=this.mLocalFS32;for(let r=0;r<16;r++)i[r]=t[r+e];return this}setData(t){return 16==t.length&&this.mLocalFS32.set(t),this}getCapacity(){return 16}GetMaxUid(){return u.sUid}getUid(){return this.mUid}getLocalFS32(){return this.mLocalFS32}getFS32(){return this.mFS32}getFSIndex(){return this.mIndex}identity(){this.mLocalFS32.set(l.IdentityMat4Data,0)}determinant(){let t=this.mLocalFS32;return(t[0]*t[5]-t[4]*t[1])*(t[10]*t[15]-t[14]*t[11])-(t[0]*t[9]-t[8]*t[1])*(t[6]*t[15]-t[14]*t[7])+(t[0]*t[13]-t[12]*t[1])*(t[6]*t[11]-t[10]*t[7])+(t[4]*t[9]-t[8]*t[5])*(t[2]*t[15]-t[14]*t[3])-(t[4]*t[13]-t[12]*t[5])*(t[2]*t[11]-t[10]*t[3])+(t[8]*t[13]-t[12]*t[9])*(t[2]*t[7]-t[6]*t[3])}multiplyMatrices(t,e){const i=t.getLocalFS32(),r=e.getLocalFS32(),s=this.getLocalFS32(),n=i[0],a=i[4],o=i[8],l=i[12],u=i[1],h=i[5],c=i[9],d=i[13],m=i[2],f=i[6],p=i[10],v=i[14],g=i[3],b=i[7],y=i[11],_=i[15],x=r[0],w=r[4],S=r[8],M=r[12],P=r[1],T=r[5],E=r[9],C=r[13],R=r[2],V=r[6],D=r[10],F=r[14],A=r[3],G=r[7],L=r[11],z=r[15];return s[0]=n*x+a*P+o*R+l*A,s[4]=n*w+a*T+o*V+l*G,s[8]=n*S+a*E+o*D+l*L,s[12]=n*M+a*C+o*F+l*z,s[1]=u*x+h*P+c*R+d*A,s[5]=u*w+h*T+c*V+d*G,s[9]=u*S+h*E+c*D+d*L,s[13]=u*M+h*C+c*F+d*z,s[2]=m*x+f*P+p*R+v*A,s[6]=m*w+f*T+p*V+v*G,s[10]=m*S+f*E+p*D+v*L,s[14]=m*M+f*C+p*F+v*z,s[3]=g*x+b*P+y*R+_*A,s[7]=g*w+b*T+y*V+_*G,s[11]=g*S+b*E+y*D+_*L,s[15]=g*M+b*C+y*F+_*z,this}multiply(t,e=null){return null!=t&&null!=e?this.multiplyMatrices(t,e):null!=t?this.multiplyMatrices(this,t):this}premultiply(t){return t!=this&&null!=t?this.multiplyMatrices(t,this):this}append(t){let e=t.getLocalFS32(),i=this.mLocalFS32,r=i[0],s=i[4],n=i[8],a=i[12],o=i[1],l=i[5],u=i[9],h=i[13],c=i[2],d=i[6],m=i[10],f=i[14],p=i[3],v=i[7],g=i[11],b=i[15],y=e[0],_=e[4],x=e[8],w=e[12],S=e[1],M=e[5],P=e[9],T=e[13],E=e[2],C=e[6],R=e[10],V=e[14],D=e[3],F=e[7],A=e[11],G=e[15];i[0]=r*y+o*_+c*x+p*w,i[1]=r*S+o*M+c*P+p*T,i[2]=r*E+o*C+c*R+p*V,i[3]=r*D+o*F+c*A+p*G,i[4]=s*y+l*_+d*x+v*w,i[5]=s*S+l*M+d*P+v*T,i[6]=s*E+l*C+d*R+v*V,i[7]=s*D+l*F+d*A+v*G,i[8]=n*y+u*_+m*x+g*w,i[9]=n*S+u*M+m*P+g*T,i[10]=n*E+u*C+m*R+g*V,i[11]=n*D+u*F+m*A+g*G,i[12]=a*y+h*_+f*x+b*w,i[13]=a*S+h*M+f*P+b*T,i[14]=a*E+h*C+f*R+b*V,i[15]=a*D+h*F+f*A+b*G}append3x3(t){let e=t.getLocalFS32(),i=this.mLocalFS32,r=i[0],s=i[4],n=i[8],a=i[1],o=i[5],l=i[9],u=i[2],h=i[6],c=i[10],d=e[0],m=e[4],f=e[8],p=e[1],v=e[5],g=e[9],b=e[2],y=e[6],_=e[10];i[0]=r*d+a*m+u*f,i[1]=r*p+a*v+u*g,i[2]=r*b+a*y+u*_,i[4]=s*d+o*m+h*f,i[5]=s*p+o*v+h*g,i[6]=s*b+o*y+h*_,i[8]=n*d+l*m+c*f,i[9]=n*p+l*v+c*g,i[10]=n*b+l*y+c*_}appendRotationPivot(t,e,i=null){null==i&&(i=n.default.Z_AXIS),u.sTMat4.identity(),u.sTMat4.getAxisRotation(e.x,e.y,e.z,t),u.sTMat4.appendTranslationXYZ(i.x,i.y,i.z),this.append(u.sTMat4)}appendRotation(t,e){u.sTMat4.identity(),u.sTMat4.getAxisRotation(e.x,e.y,e.z,t),this.append(u.sTMat4)}appendRotationX(t){u.sTMat4.rotationX(t),this.append3x3(u.sTMat4)}appendRotationY(t){u.sTMat4.rotationY(t),this.append3x3(u.sTMat4)}appendRotationZ(t){u.sTMat4.rotationZ(t),this.append3x3(u.sTMat4)}appendRotationEulerAngle(t,e,i){u.sTMat4.rotationY(e),this.append3x3(u.sTMat4),u.sTMat4.rotationX(t),this.append3x3(u.sTMat4),u.sTMat4.rotationZ(i),this.append3x3(u.sTMat4)}setScale(t){let e=this.mLocalFS32;return e[0]=t.x,e[5]=t.y,e[10]=t.z,this}setScaleXYZ(t,e,i){let r=this.mLocalFS32;r[0]=t,r[5]=e,r[10]=i}getScale(t){let e=this.mLocalFS32;t.x=e[0],t.y=e[5],t.z=e[10]}setRotationEulerAngle(t,e,i){let r=this.mLocalFS32,s=Math.cos(t),n=Math.sin(t),a=Math.cos(e),o=Math.sin(e),l=Math.cos(i),u=Math.sin(i),h=l*o,c=u*o,d=a*r[0],m=n*r[5],f=s*r[5],p=s*r[10],v=n*r[10];r[1]=u*d,r[2]=-o*r[0],r[0]=l*d,r[4]=h*m-u*f,r[8]=h*p+u*v,r[5]=c*m+l*f,r[9]=c*p-l*v,r[6]=a*m,r[10]=a*p}setRotationEulerAngle2(t,e,i,r,s,n){let a=this.mLocalFS32,o=s*r,l=n*r,u=i*a[0],h=e*a[5],c=t*a[5],d=t*a[10],m=e*a[10];a[1]=n*u,a[2]=-r*a[0],a[0]=s*u,a[4]=o*h-n*c,a[8]=o*d+n*m,a[5]=l*h+s*c,a[9]=l*d-s*m,a[6]=i*h,a[10]=i*d}compose(t,e,i){const r=this.mLocalFS32,s=e.x,n=e.y,a=e.z,o=e.w,l=s+s,u=n+n,h=a+a,c=s*l,d=s*u,m=s*h,f=n*u,p=n*h,v=a*h,g=o*l,b=o*u,y=o*h,_=i.x,x=i.y,w=i.z;return r[0]=(1-(f+v))*_,r[1]=(d+y)*_,r[2]=(m-b)*_,r[3]=0,r[4]=(d-y)*x,r[5]=(1-(c+v))*x,r[6]=(p+g)*x,r[7]=0,r[8]=(m+b)*w,r[9]=(p-g)*w,r[10]=(1-(c+f))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}makeRotationFromQuaternion(t){return this.compose(n.default.ZERO,t,n.default.ONE)}makeRotationFromEuler(t){const e=this.mLocalFS32,i=t.x,r=t.y,s=t.z,n=Math.cos(i),o=Math.sin(i),l=Math.cos(r),u=Math.sin(r),h=Math.cos(s),c=Math.sin(s);if(t.order===a.EulerOrder.XYZ){const t=n*h,i=n*c,r=o*h,s=o*c;e[0]=l*h,e[4]=-l*c,e[8]=u,e[1]=i+r*u,e[5]=t-s*u,e[9]=-o*l,e[2]=s-t*u,e[6]=r+i*u,e[10]=n*l}else if(t.order===a.EulerOrder.YXZ){const t=l*h,i=l*c,r=u*h,s=u*c;e[0]=t+s*o,e[4]=r*o-i,e[8]=n*u,e[1]=n*c,e[5]=n*h,e[9]=-o,e[2]=i*o-r,e[6]=s+t*o,e[10]=n*l}else if(t.order===a.EulerOrder.ZXY){const t=l*h,i=l*c,r=u*h,s=u*c;e[0]=t-s*o,e[4]=-n*c,e[8]=r+i*o,e[1]=i+r*o,e[5]=n*h,e[9]=s-t*o,e[2]=-n*u,e[6]=o,e[10]=n*l}else if(t.order===a.EulerOrder.ZYX){const t=n*h,i=n*c,r=o*h,s=o*c;e[0]=l*h,e[4]=r*u-i,e[8]=t*u+s,e[1]=l*c,e[5]=s*u+t,e[9]=i*u-r,e[2]=-u,e[6]=o*l,e[10]=n*l}else if(t.order===a.EulerOrder.YZX){const t=n*l,i=n*u,r=o*l,s=o*u;e[0]=l*h,e[4]=s-t*c,e[8]=r*c+i,e[1]=c,e[5]=n*h,e[9]=-o*h,e[2]=-u*h,e[6]=i*c+r,e[10]=t-s*c}else if(t.order===a.EulerOrder.XZY){const t=n*l,i=n*u,r=o*l,s=o*u;e[0]=l*h,e[4]=-c,e[8]=u*h,e[1]=t*c+s,e[5]=n*h,e[9]=i*c-r,e[2]=r*c-i,e[6]=o*h,e[10]=s*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}extractRotation(t){const e=this.mLocalFS32,i=t.getLocalFS32(),r=u.sV3;t.copyColumnTo(0,r);const s=1/r.getLength();t.copyColumnTo(1,r);const n=1/r.getLength();t.copyColumnTo(2,r);const a=1/r.getLength();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*n,e[5]=i[5]*n,e[6]=i[6]*n,e[7]=0,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}copyTranslation(t){const e=this.mLocalFS32,i=t.getLocalFS32();return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setTranslationXYZ(t,e,i){this.mLocalFS32[12]=t,this.mLocalFS32[13]=e,this.mLocalFS32[14]=i}setTranslation(t){this.mLocalFS32[12]=t.x,this.mLocalFS32[13]=t.y,this.mLocalFS32[14]=t.z}appendScaleXYZ(t,e,i){const r=this.mLocalFS32;r[0]*=t,r[1]*=t,r[2]*=t,r[3]*=t,r[4]*=e,r[5]*=e,r[6]*=e,r[7]*=e,r[8]*=i,r[9]*=i,r[10]*=i,r[11]*=i}appendScaleXY(t,e){const i=this.mLocalFS32;i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=e,i[5]*=e,i[6]*=e,i[7]*=e}appendTranslationXYZ(t,e,i){this.mLocalFS32[12]+=t,this.mLocalFS32[13]+=e,this.mLocalFS32[14]+=i}appendTranslation(t){this.mLocalFS32[12]+=t.x,this.mLocalFS32[13]+=t.y,this.mLocalFS32[14]+=t.z}copyColumnFrom(t,e){const i=this.mLocalFS32;switch(t){case 0:i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w;break;case 1:i[4]=e.x,i[5]=e.y,i[6]=e.z,i[7]=e.w;break;case 2:i[8]=e.x,i[9]=e.y,i[10]=e.z,i[11]=e.w;break;case 3:i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=e.w;break;default:break}}copyColumnTo(t,e){const i=this.mLocalFS32;t<<=2,e.x=i[t],e.y=i[1+t],e.z=i[2+t],e.w=i[3+t]}setF32ArrAndIndex(t,e=0){null!=t&&e>=0&&(this.mFS32=t,this.mIndex=e,this.mLocalFS32=this.mFS32.subarray(e,e+16))}setF32ArrIndex(t=0){t>=0&&(this.mIndex=t,this.mLocalFS32=this.mFS32.subarray(t,t+16))}setF32Arr(t){null!=t&&(this.mFS32=t)}copyFromF32Arr(t,e=0){let i=0;for(let r=e+16;e<r;e++)this.mLocalFS32[i]=t[e],++i}copyToF32Arr(t,e=0){t.set(this.mLocalFS32,e)}copy(t){return this.mLocalFS32.set(t.getLocalFS32(),0),this}copyFrom(t){this.mLocalFS32.set(t.getLocalFS32(),0)}copyTo(t){t.getLocalFS32().set(this.getLocalFS32(),0)}copyRawDataFrom(t,e=16,i=0,r=!1){r&&this.transpose(),e-=i;let s=0;while(s<e)this.mFS32[this.mIndex+s]=t[s+i],++s;r&&this.transpose()}copyRawDataTo(t,e=16,i=0,r=!1){r&&this.transpose();let s=0;while(s<e)t[s+i]=this.mFS32[this.mIndex+s],++s;r&&this.transpose()}copyRowFrom(t,e){const i=this.mLocalFS32;switch(t){case 0:i[0]=e.x,i[4]=e.y,i[8]=e.z,i[12]=e.w;break;case 1:i[1]=e.x,i[5]=e.y,i[9]=e.z,i[13]=e.w;break;case 2:i[2]=e.x,i[6]=e.y,i[10]=e.z,i[14]=e.w;break;case 3:i[3]=e.x,i[7]=e.y,i[11]=e.z,i[15]=e.w;break;default:break}}copyRowTo(t,e){const i=this.mLocalFS32;e.x=i[t],e.y=i[4+t],e.z=i[8+t],e.w=i[12+t]}decompose(t=o.default.EULER_ANGLES){let e=[],i=u.sTMat4,r=i.getLocalFS32();i.copyFrom(this);let a=new n.default(r[12],r[13],r[14]),l=new n.default;l.x=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]),l.y=Math.sqrt(r[4]*r[4]+r[5]*r[5]+r[6]*r[6]),l.z=Math.sqrt(r[8]*r[8]+r[9]*r[9]+r[10]*r[10]),r[0]*(r[5]*r[10]-r[6]*r[9])-r[1]*(r[4]*r[10]-r[6]*r[8])+r[2]*(r[4]*r[9]-r[5]*r[8])<0&&(l.z=-l.z),r[0]/=l.x,r[1]/=l.x,r[2]/=l.x,r[4]/=l.y,r[5]/=l.y,r[6]/=l.y,r[8]/=l.z,r[9]/=l.z,r[10]/=l.z;let h=new n.default;switch(t){case o.default.AXIS_ANGLE:{h.w=s.default.SafeACos((r[0]+r[5]+r[10]-1)/2);let t=Math.sqrt((r[6]-r[9])*(r[6]-r[9])+(r[8]-r[2])*(r[8]-r[2])+(r[1]-r[4])*(r[1]-r[4]));t>s.default.MATH_MIN_POSITIVE?(h.x=(r[6]-r[9])/t,h.y=(r[8]-r[2])/t,h.z=(r[1]-r[4])/t):h.x=h.y=h.z=0}break;case o.default.QUATERNION:{let t=r[0]+r[5]+r[10];t>0?(h.w=Math.sqrt(1+t)/2,h.x=(r[6]-r[9])/(4*h.w),h.y=(r[8]-r[2])/(4*h.w),h.z=(r[1]-r[4])/(4*h.w)):r[0]>r[5]&&r[0]>r[10]?(h.x=Math.sqrt(1+r[0]-r[5]-r[10])/2,h.w=(r[6]-r[9])/(4*h.x),h.y=(r[1]+r[4])/(4*h.x),h.z=(r[8]+r[2])/(4*h.x)):r[5]>r[10]?(h.y=Math.sqrt(1+r[5]-r[0]-r[10])/2,h.x=(r[1]+r[4])/(4*h.y),h.w=(r[8]-r[2])/(4*h.y),h.z=(r[6]+r[9])/(4*h.y)):(h.z=Math.sqrt(1+r[10]-r[0]-r[5])/2,h.x=(r[8]+r[2])/(4*h.z),h.y=(r[6]+r[9])/(4*h.z),h.w=(r[1]-r[4])/(4*h.z))}break;case o.default.EULER_ANGLES:h.y=Math.asin(-r[2]),1!=r[2]&&-1!=r[2]?(h.x=Math.atan2(r[6],r[10]),h.z=Math.atan2(r[1],r[0])):(h.z=0,h.x=Math.atan2(r[4],r[5]));break;default:break}return e.push(a),e.push(h),e.push(l),i=null,e}invert(){let t=this.determinant(),e=Math.abs(t)>s.default.MATH_MIN_POSITIVE;if(e){let e=this.mLocalFS32;t=1/t;let i=e[0],r=e[4],s=e[8],n=e[12],a=e[1],o=e[5],l=e[9],u=e[13],h=e[2],c=e[6],d=e[10],m=e[14],f=e[3],p=e[7],v=e[11],g=e[15];e[0]=t*(o*(d*g-m*v)-l*(c*g-m*p)+u*(c*v-d*p)),e[1]=-t*(a*(d*g-m*v)-l*(h*g-m*f)+u*(h*v-d*f)),e[2]=t*(a*(c*g-m*p)-o*(h*g-m*f)+u*(h*p-c*f)),e[3]=-t*(a*(c*v-d*p)-o*(h*v-d*f)+l*(h*p-c*f)),e[4]=-t*(r*(d*g-m*v)-s*(c*g-m*p)+n*(c*v-d*p)),e[5]=t*(i*(d*g-m*v)-s*(h*g-m*f)+n*(h*v-d*f)),e[6]=-t*(i*(c*g-m*p)-r*(h*g-m*f)+n*(h*p-c*f)),e[7]=t*(i*(c*v-d*p)-r*(h*v-d*f)+s*(h*p-c*f)),e[8]=t*(r*(l*g-u*v)-s*(o*g-u*p)+n*(o*v-l*p)),e[9]=-t*(i*(l*g-u*v)-s*(a*g-u*f)+n*(a*v-l*f)),e[10]=t*(i*(o*g-u*p)-r*(a*g-u*f)+n*(a*p-o*f)),e[11]=-t*(i*(o*v-l*p)-r*(a*v-l*f)+s*(a*p-o*f)),e[12]=-t*(r*(l*m-u*d)-s*(o*m-u*c)+n*(o*d-l*c)),e[13]=t*(i*(l*m-u*d)-s*(a*m-u*h)+n*(a*d-l*h)),e[14]=-t*(i*(o*m-u*c)-r*(a*m-u*h)+n*(a*c-o*h)),e[15]=t*(i*(o*d-l*c)-r*(a*d-l*h)+s*(a*c-o*h))}return e}invertThis(){return this.invert(),this}pointAt(t,e,i){null==e&&(e=new n.default(0,0,-1)),null==i&&(i=new n.default(0,-1,0));let r=e.subtract(t),a=i.clone();r.normalize(),a.normalize();let o=r.clone().scaleBy(a.dot(r));a.subtractBy(o),a.getLength()>s.default.MATH_MIN_POSITIVE?a.normalize():0!=r.x?a.setXYZ(-r.y,r.x,0):a.setXYZ(1,0,0);let l=a.crossProduct(r);l.normalize();let u=this.mLocalFS32;u[0]=l.x,u[4]=l.y,u[8]=l.z,u[12]=0,u[1]=a.x,u[5]=a.y,u[9]=a.z,u[13]=0,u[2]=r.x,u[6]=r.y,u[10]=r.z,u[14]=0,u[3]=t.x,u[7]=t.y,u[11]=t.z,u[15]=1}prepend(t){let e=t.getLocalFS32(),i=this.mLocalFS32,r=e[0],s=e[4],n=e[8],a=e[12],o=e[1],l=e[5],u=e[9],h=e[13],c=e[2],d=e[6],m=e[10],f=e[14],p=e[3],v=e[7],g=e[11],b=e[15],y=i[0],_=i[4],x=i[8],w=i[12],S=i[1],M=i[5],P=i[9],T=i[13],E=i[2],C=i[6],R=i[10],V=i[14],D=i[3],F=i[7],A=i[11],G=i[15];i[0]=r*y+o*_+c*x+p*w,i[1]=r*S+o*M+c*P+p*T,i[2]=r*E+o*C+c*R+p*V,i[3]=r*D+o*F+c*A+p*G,i[4]=s*y+l*_+d*x+v*w,i[5]=s*S+l*M+d*P+v*T,i[6]=s*E+l*C+d*R+v*V,i[7]=s*D+l*F+d*A+v*G,i[8]=n*y+u*_+m*x+g*w,i[9]=n*S+u*M+m*P+g*T,i[10]=n*E+u*C+m*R+g*V,i[11]=n*D+u*F+m*A+g*G,i[12]=a*y+h*_+f*x+b*w,i[13]=a*S+h*M+f*P+b*T,i[14]=a*E+h*C+f*R+b*V,i[15]=a*D+h*F+f*A+b*G}prepend3x3(t){let e=t.getLocalFS32(),i=this.mLocalFS32,r=e[0],s=e[4],n=e[8],a=e[1],o=e[5],l=e[9],u=e[2],h=e[6],c=e[10],d=i[0],m=i[4],f=i[8],p=i[1],v=i[5],g=i[9],b=i[2],y=i[6],_=i[10];i[0]=r*d+a*m+u*f,i[1]=r*p+a*v+u*g,i[2]=r*b+a*y+u*_,i[4]=s*d+o*m+h*f,i[5]=s*p+o*v+h*g,i[6]=s*b+o*y+h*_,i[8]=n*d+l*m+c*f,i[9]=n*p+l*v+c*g,i[10]=n*b+l*y+c*_}prependRotationPivot(t,e,i){u.sTMat4.identity(),u.sTMat4.getAxisRotation(e.x,e.y,e.z,t),u.sTMat4.appendTranslationXYZ(i.x,i.y,i.z),this.prepend(u.sTMat4)}prependRotation(t,e){u.sTMat4.identity(),u.sTMat4.getAxisRotation(e.x,e.y,e.z,t),this.prepend(u.sTMat4)}prependRotationX(t){u.sTMat4.rotationX(t),this.prepend3x3(u.sTMat4)}prependRotationY(t){u.sTMat4.rotationY(t),this.prepend3x3(u.sTMat4)}prependRotationZ(t){u.sTMat4.rotationZ(t),this.prepend3x3(u.sTMat4)}prependRotationEulerAngle(t,e,i){u.sTMat4.rotationY(e),this.prepend3x3(u.sTMat4),u.sTMat4.rotationX(t),this.prepend3x3(u.sTMat4),u.sTMat4.rotationZ(i),this.prepend3x3(u.sTMat4)}prependScale(t,e,i){const r=this.mLocalFS32;r[0]*=t,r[1]*=e,r[2]*=i,r[4]*=t,r[5]*=e,r[6]*=i,r[8]*=t,r[9]*=e,r[10]*=i,r[12]*=t,r[13]*=e,r[14]*=i}prependScaleXY(t,e){const i=this.mLocalFS32;i[0]*=t,i[1]*=e,i[4]*=t,i[5]*=e,i[8]*=t,i[9]*=e,i[12]*=t,i[13]*=e}prependTranslationXYZ(t,e,i){u.sTMat4.identity(),this.prepend(u.sTMat4)}prependTranslation(t){u.sTMat4.identity(),this.prepend(u.sTMat4)}recompose(t,e){if(t.length<3||0==t[2].x||0==t[2].y||0==t[2].z)return!1;this.identity();let i=u.sTMat4.getFS32();i[0]=i[1]=i[2]=t[2].x,i[4]=i[5]=i[6]=t[2].y,i[8]=i[9]=i[10]=t[2].z;let r=this.mLocalFS32;switch(e){case o.default.EULER_ANGLES:{let e=Math.cos(t[1].x),s=Math.cos(t[1].y),n=Math.cos(t[1].z),a=Math.sin(t[1].x),o=Math.sin(t[1].y),l=Math.sin(t[1].z);r[0]=s*n*i[0],r[1]=s*l*i[1],r[2]=-o*i[2],r[3]=0,r[4]=(a*o*n-e*l)*i[4],r[5]=(a*o*l+e*n)*i[5],r[6]=a*s*i[6],r[7]=0,r[8]=(e*o*n+a*l)*i[8],r[9]=(e*o*l-a*n)*i[9],r[10]=e*s*i[10],r[11]=0,r[12]=t[0].x,r[13]=t[0].y,r[14]=t[0].z,r[15]=1}break;default:{let s=t[1].x,n=t[1].y,a=t[1].z,l=t[1].w;if(e==o.default.AXIS_ANGLE){let t=.5*l;s*=Math.sin(t),n*=Math.sin(t),a*=Math.sin(t),l=Math.cos(t)}r[0]=(1-2*n*n-2*a*a)*i[0],r[1]=(2*s*n+2*l*a)*i[1],r[2]=(2*s*a-2*l*n)*i[2],r[3]=0,r[4]=(2*s*n-2*l*a)*i[4],r[5]=(1-2*s*s-2*a*a)*i[5],r[6]=(2*n*a+2*l*s)*i[6],r[7]=0,r[8]=(2*s*a+2*l*n)*i[8],r[9]=(2*n*a-2*l*s)*i[9],r[10]=(1-2*s*s-2*n*n)*i[10],r[11]=0,r[12]=t[0].x,r[13]=t[0].y,r[14]=t[0].z,r[15]=1}break}return 0==t[2].x&&(this.mLocalFS32[0]=0),0==t[2].y&&(this.mLocalFS32[5]=0),0==t[2].z&&(this.mLocalFS32[10]=0),i=null,!0}setThreeAxes(t,e,i){let r=this.mLocalFS32;r[0]=t.x,r[1]=t.y,r[2]=t.z,r[4]=e.x,r[5]=e.y,r[6]=e.z,r[8]=i.x,r[9]=i.y,r[10]=i.z}deltaTransformVector(t){let e=t.x,i=t.y,r=t.z;return new n.default(e*this.mLocalFS32[0]+i*this.mLocalFS32[4]+r*this.mLocalFS32[8],e*this.mLocalFS32[1]+i*this.mLocalFS32[5]+r*this.mLocalFS32[9],e*this.mLocalFS32[2]+i*this.mLocalFS32[6]+r*this.mLocalFS32[10],0)}deltaTransformVectorSelf(t){let e=this.mLocalFS32,i=t.x,r=t.y,s=t.z;t.x=i*e[0]+r*e[4]+s*e[8],t.y=i*e[1]+r*e[5]+s*e[9],t.z=i*e[2]+r*e[6]+s*e[10]}deltaTransformOutVector(t,e){let i=this.mLocalFS32;e.x=t.x*i[0]+t.y*i[4]+t.z*i[8],e.y=t.x*i[1]+t.y*i[5]+t.z*i[9],e.z=t.x*i[2]+t.y*i[6]+t.z*i[10]}transformVector(t){let e=this.mLocalFS32,i=t.x,r=t.y,s=t.z;return new n.default(i*e[0]+r*e[4]+s*e[8]+e[12],i*e[1]+r*e[5]+s*e[9]+e[13],i*e[2]+r*e[6]+s*e[10]+e[14],i*e[3]+r*e[7]+s*e[11]+e[15])}transformOutVector(t,e){let i=t.x,r=t.y,s=t.z,n=this.mLocalFS32;e.setXYZW(i*n[0]+r*n[4]+s*n[8]+n[12],i*n[1]+r*n[5]+s*n[9]+n[13],i*n[2]+r*n[6]+s*n[10]+n[14],i*n[3]+r*n[7]+s*n[11]+n[15])}transformOutVector3(t,e){let i=this.mLocalFS32;e.x=t.x*i[0]+t.y*i[4]+t.z*i[8]+i[12],e.y=t.x*i[1]+t.y*i[5]+t.z*i[9]+i[13],e.z=t.x*i[2]+t.y*i[6]+t.z*i[10]+i[14]}transformVector3Self(t){let e=t.x,i=t.y,r=t.z,s=this.mLocalFS32;t.x=e*s[0]+i*s[4]+r*s[8]+s[12],t.y=e*s[1]+i*s[5]+r*s[9]+s[13],t.z=e*s[2]+i*s[6]+r*s[10]+s[14]}transformVectorSelf(t){let e=t.x,i=t.y,r=t.z,s=this.mLocalFS32;t.setXYZW(e*s[0]+i*s[4]+r*s[8]+s[12],e*s[1]+i*s[5]+r*s[9]+s[13],e*s[2]+i*s[6]+r*s[10]+s[14],e*s[3]+i*s[7]+r*s[11]+s[15])}transformVectors(t,e,i){let r,s,n,a=0,o=this.mLocalFS32;e-=3;while(a<=e)r=t[a],s=t[a+1],n=t[a+2],i[a]=r*o[0]+s*o[4]+n*o[8]+o[12],i[a+1]=r*o[1]+s*o[5]+n*o[9]+o[13],i[a+2]=r*o[2]+s*o[6]+n*o[10]+o[14],a+=3}transformVectorsSelf(t,e){let i,r,s,n=0,a=this.mLocalFS32;e-=3;while(n<=e)i=t[n],r=t[n+1],s=t[n+2],t[n]=i*a[0]+r*a[4]+s*a[8]+a[12],t[n+1]=i*a[1]+r*a[5]+s*a[9]+a[13],t[n+2]=i*a[2]+r*a[6]+s*a[10]+a[14],n+=3}transformVectorsRangeSelf(t,e,i){let r,s,n,a=e,o=this.mLocalFS32;i-=3;while(a<=i)r=t[a],s=t[a+1],n=t[a+2],t[a]=r*o[0]+s*o[4]+n*o[8]+o[12],t[a+1]=r*o[1]+s*o[5]+n*o[9]+o[13],t[a+2]=r*o[2]+s*o[6]+n*o[10]+o[14],a+=3}transpose(){u.sTMat4.copyFrom(this);let t=u.sTMat4.getFS32(),e=this.mLocalFS32;e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11]}interpolateTo(t,e){let i=t.getFS32(),r=t.getFSIndex(),s=0,n=this.mIndex;while(s<16)this.mFS32[n]+=(i[r+s]-this.mFS32[n])*e,++n,++s}getAxisRotation(t,e,i,r){r=-r;let s=this.mLocalFS32,n=Math.sin(r),a=Math.cos(r),o=1-a;s[0]=a+t*t*o,s[5]=a+e*e*o,s[10]=a+i*i*o;let l=t*e*o,u=i*n;s[4]=l+u,s[1]=l-u,l=t*i*o,u=e*n,s[8]=l-u,s[2]=l+u,l=e*i*o,u=t*n,s[9]=l+u,s[6]=l-u}rotationX(t){let e=Math.sin(t),i=Math.cos(t);this.mLocalFS32[0]=1,this.mLocalFS32[1]=0,this.mLocalFS32[2]=0,this.mLocalFS32[4]=0,this.mLocalFS32[5]=i,this.mLocalFS32[6]=e,this.mLocalFS32[8]=0,this.mLocalFS32[9]=-e,this.mLocalFS32[10]=i}rotationY(t){let e=Math.sin(t),i=Math.cos(t);this.mLocalFS32[0]=i,this.mLocalFS32[1]=0,this.mLocalFS32[2]=-e,this.mLocalFS32[4]=0,this.mLocalFS32[5]=1,this.mLocalFS32[6]=0,this.mLocalFS32[8]=e,this.mLocalFS32[9]=0,this.mLocalFS32[10]=i}rotationZ(t){let e=Math.sin(t),i=Math.cos(t);this.mLocalFS32[0]=i,this.mLocalFS32[1]=e,this.mLocalFS32[2]=0,this.mLocalFS32[4]=-e,this.mLocalFS32[5]=i,this.mLocalFS32[6]=0,this.mLocalFS32[8]=0,this.mLocalFS32[9]=0,this.mLocalFS32[10]=1}toString(){let t="\n"+this.mLocalFS32[0]+","+this.mLocalFS32[1]+","+this.mLocalFS32[2]+","+this.mLocalFS32[3]+"\n";return t+=this.mLocalFS32[4]+","+this.mLocalFS32[5]+","+this.mLocalFS32[6]+","+this.mLocalFS32[7]+"\n",t+=this.mLocalFS32[8]+","+this.mLocalFS32[9]+","+this.mLocalFS32[10]+","+this.mLocalFS32[11]+"\n",t+=this.mLocalFS32[12]+","+this.mLocalFS32[13]+","+this.mLocalFS32[14]+","+this.mLocalFS32[15]+"\n",t}transformPerspV4Self(t){const e=this.mLocalFS32;t.w=t.z,t.x*=e[0],t.y*=e[5],t.z*=e[10],t.z+=e[14],t.w*=e[11],t.w+=e[15]}clone(){let t=new u;return t.copyFrom(this),t}perspectiveRH(t,e,i,r,s=1){const n=this.mLocalFS32;let a=Math.tan(.5*t);this.identity(),n[0]=1/(e*a),n[5]=1/a,n[10]=-s*(r+i)/(r-i),n[11]=-1,n[14]=2*r*i*-s/(r-i)}perspectiveRH2(t,e,i,r,s){let n=e/Math.tan(.5*t),a=n/e,o=n/i,l=-s/(s-r),u=-r*l;this.identity();const h=this.mLocalFS32;h[0]=a,h[5]=o,h[10]=l,h[11]=-1,h[14]=u}orthoRH(t,e,i,r,s,n,a=1){this.identity();const o=this.mLocalFS32;o[0]=2/(r-i),o[5]=2/(e-t),o[10]=2*-a/(n-s),o[12]=-(r+i)/(r-i),o[13]=-(e+t)/(e-t),o[14]=-a*(n+s)/(n-s),o[15]=1}perspectiveLH(t,e,i,r,s=1){let n=Math.tan(.5*t);this.identity();const a=this.mLocalFS32;a[0]=1/(e*n),a[5]=1/n,a[10]=s*(r+i)/(r-i),a[11]=1,a[14]=s*(2*r*i)/(r-i)}orthoLH(t,e,i,r,s,n,a=1){this.identity();const o=this.mLocalFS32;o[0]=2/(r-i),o[5]=2/(e-t),o[10]=2*a/(n-s),o[12]=-(r+i)/(r-i),o[13]=-(e+t)/(e-t),o[14]=-a*(n+s)/(n-s),o[15]=1}lookAtRH(t,e,i){this.identity();let r=e.subtract(t);r.normalize();let s=r.crossProduct(i);s.normalize();let n=s.crossProduct(r);s.w=-s.dot(t),n.w=-n.dot(t),r.w=r.dot(t),r.negate(),this.copyRowFrom(0,s),this.copyRowFrom(1,n),this.copyRowFrom(2,r)}lookAtLH(t,e,i){this.identity();let r=e.subtract(t);r.normalize();let s=r.crossProduct(i);s.normalize();let n=s.crossProduct(r);s.w=-s.dot(t),n.w=-n.dot(t),r.w=-r.dot(t),this.copyRowFrom(0,s),this.copyRowFrom(1,n),this.copyRowFrom(2,r)}destroy(){this.mLocalFS32=null,this.mFS32=null,this.mIndex=-1}}u.sV3=new n.default,u.sUid=0,u.sIsolatedUid=327679,u.sTMat4=new u,e.default=u},c7cf:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("af80")),n=r(i("ec7b"));let a=[new Float32Array(3),new Float32Array(3),new Float32Array(3)],o=[new Float32Array(3),new Float32Array(3),new Float32Array(3)];class l{constructor(){this.mPv=new s.default,this.mPv1=new s.default,this.axes=[new s.default,new s.default,new s.default],this.extents=new Float32Array(3),this.extent=new s.default,this.center=new s.default,this.version=-1,this.radius=50,this.mts=[0,0,0]}reset(){}equals(t){if(t!=this&&t){if(!this.center.equalsXYZ(t.center))return!1;if(!this.extent.equalsXYZ(t.extent))return!1;for(let e=0;e<3;++e)if(!this.axes[e].equalsXYZ(t.axes[e]))return!1;return!0}return!1}update(){this.version++;for(let e=0;e<3;++e)this.axes[e].normalize();let t=this.extent;this.radius=t.getLength(),this.extents.set([t.x,t.y,t.z])}getSize(t){return t||(t=new s.default),t.copyFrom(this.extent).scaleBy(2)}fromAABB(t,e=null){const i=this.axes;i[0].setXYZ(1,0,0),i[1].setXYZ(0,1,0),i[2].setXYZ(0,0,1);const r=this.extent;if(e){e.deltaTransformVectorSelf(i[0]),e.deltaTransformVectorSelf(i[1]),e.deltaTransformVectorSelf(i[2]),i[0].normalize(),i[1].normalize(),i[2].normalize();const s=this.center.copyFrom(t.center),n=this.mPv.copyFrom(t.max);e.transformVector3Self(s),e.transformVector3Self(n),n.subVecsTo(n,s),r.setXYZ(i[0].dot(n),i[1].dot(n),i[2].dot(n))}else this.center.copyFrom(t.center),r.setXYZ(.5*t.getWidth(),.5*t.getHeight(),.5*t.getLong());const s=this.extent;this.extents.set([s.x,s.y,s.z]),this.radius=s.getLength(),this.version++}getClosePosition(t,e=null){const i=this.extent,r=this.axes,a=this.mPv.subVecsTo(t,this.center);e||(e=new s.default),e.copyFrom(this.center);const o=n.default.Clamp,l=this.mPv1,u=o(a.dot(l.copyFrom(r[0])),-i.x,i.x);e.add(l.scaleBy(u));const h=o(a.dot(l.copyFrom(r[1])),-i.y,i.y);e.add(l.scaleBy(h));const c=o(a.dot(l.copyFrom(r[2])),-i.z,i.z);return e.add(l.scaleBy(c)),e}intersectAABB(t,e=null){const i=l.sOBB;return i.fromAABB(t,e),this.intersect(i)}intersectSphere(t,e){const i=this.mPv1;return this.getClosePosition(t,i),i.subtractBy(t).getLengthSquared()<=e*e}containsV(t){const e=this.mPv.subVecsTo(t,this.center),i=this.axes,r=Math.abs,s=this.extent;return r(e.dot(i[0]))<=s.x&&r(e.dot(i[1]))<=s.y&&r(e.dot(i[2]))<=s.z}intersectPlane(t,e){const i=this.extent,r=this.axes,s=i.x*Math.abs(t.dot(r[0]))+i.y*Math.abs(t.dot(r[1]))+i.z*Math.abs(t.dot(r[2])),n=t.dot(this.center)-e;return Math.abs(n)<=s}intersect(t,e=null,i=1e-6){e||(e=t,t=this);const r=Math.abs,s=this.mPv.subVecsTo(e.center,t.center);if(s.getLength()-(t.radius+e.radius)>i)return!1;let n=o,l=a;for(let a=0;a<3;++a)for(let i=0;i<3;++i)l[a][i]=t.axes[a].dot(e.axes[i]);const u=this.mts;u[0]=s.dot(t.axes[0]),u[1]=s.dot(t.axes[1]),u[2]=s.dot(t.axes[2]);for(let a=0;a<3;++a)for(let t=0;t<3;++t)n[a][t]=r(l[a][t])+i;const h=t.extents,c=e.extents;let d=0,m=0;for(let a=0;a<3;++a)if(d=h[a],m=c[0]*n[a][0]+c[1]*n[a][1]+c[2]*n[a][2],r(u[a])>d+m)return!1;for(let a=0;a<3;++a)if(d=h[0]*n[0][a]+h[1]*n[1][a]+h[2]*n[2][a],m=c[a],r(u[0]*l[0][a]+u[1]*l[1][a]+u[2]*l[2][a])>d+m)return!1;return d=h[1]*n[2][0]+h[2]*n[1][0],m=c[1]*n[0][2]+c[2]*n[0][1],!(r(u[2]*l[1][0]-u[1]*l[2][0])>d+m)&&(d=h[1]*n[2][1]+h[2]*n[1][1],m=c[0]*n[0][2]+c[2]*n[0][0],!(r(u[2]*l[1][1]-u[1]*l[2][1])>d+m)&&(d=h[1]*n[2][2]+h[2]*n[1][2],m=c[0]*n[0][1]+c[1]*n[0][0],!(r(u[2]*l[1][2]-u[1]*l[2][2])>d+m)&&(d=h[0]*n[2][0]+h[2]*n[0][0],m=c[1]*n[1][2]+c[2]*n[1][1],!(r(u[0]*l[2][0]-u[2]*l[0][0])>d+m)&&(d=h[0]*n[2][1]+h[2]*n[0][1],m=c[0]*n[1][2]+c[2]*n[1][0],!(r(u[0]*l[2][1]-u[2]*l[0][1])>d+m)&&(d=h[0]*n[2][2]+h[2]*n[0][2],m=c[0]*n[1][1]+c[1]*n[1][0],!(r(u[0]*l[2][2]-u[2]*l[0][2])>d+m)&&(d=h[0]*n[1][0]+h[1]*n[0][0],m=c[1]*n[2][2]+c[2]*n[2][1],!(r(u[1]*l[0][0]-u[0]*l[1][0])>d+m)&&(d=h[0]*n[1][1]+h[1]*n[0][1],m=c[0]*n[2][2]+c[2]*n[2][0],!(r(u[1]*l[0][1]-u[0]*l[1][1])>d+m)&&(d=h[0]*n[1][2]+h[1]*n[0][2],m=c[0]*n[2][1]+c[1]*n[2][0],!(r(u[1]*l[0][2]-u[0]*l[1][2])>d+m)))))))))}}l.sOBB=new l,e.default=l},c812:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{getBindGroupLayout(t){throw Error("illegal operations !!!")}}e.GPURenderPipelineEmpty=r},c862:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("4ad2"),n=r(i("c69e")),a=i("213f"),o=r(i("bd7e")),l=r(i("0d77")),u=i("19f9"),h=i("943f"),c=r(i("af80")),d=r(i("e58d")),m=i("76e3"),f=256,p=8,v=`\n@group(0) @binding(0) var<uniform> grid: vec2f;\n\n@group(0) @binding(1) var<storage> cellStateIn: array<u32>;\n@group(0) @binding(2) var<storage, read_write> cellStateOut: array<u32>;\n@group(0) @binding(3) var<storage, read_write> lifeState: array<f32>;\n\nfn cellIndex(cell: vec2u) -> u32 {\n\treturn (cell.y % u32(grid.y)) * u32(grid.x) +\n\t\t   (cell.x % u32(grid.x));\n}\n\nfn cellActive(x: u32, y: u32) -> u32 {\n\treturn cellStateIn[cellIndex(vec2(x, y))];\n}\n\n@compute @workgroup_size(${p}, ${p})\nfn compMain(@builtin(global_invocation_id) cell: vec3u) {\n\t// Determine how many active neighbors this cell has.\n\tlet activeNeighbors = cellActive(cell.x+1, \t\tcell.y+1) +\n\t\t\t\t\t\t\tcellActive(cell.x+1, \tcell.y) +\n\t\t\t\t\t\t\tcellActive(cell.x+1, \tcell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x, \t\tcell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, \tcell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, \tcell.y) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, \tcell.y+1) +\n\t\t\t\t\t\t\tcellActive(cell.x, \t\tcell.y+1);\n\n\tlet i = cellIndex(cell.xy);\n\n\t// Conway's game of life rules:\n\tswitch activeNeighbors {\n\t\tcase 2: { // Active cells with 2 neighbors stay active.\n\t\t\tcellStateOut[i] = cellStateIn[i];\n\t\t\tif(cellStateOut[i] > 0) {\n\t\t\t\tlifeState[i] += 0.05;\n\t\t\t} else {\n\t\t\t\tlifeState[i] -= 0.05;\n\t\t\t}\n\t\t}\n\t\tcase 3: { // Cells with 3 neighbors become or stay active.\n\t\t\tcellStateOut[i] = 1;\n\t\t\tlifeState[i] += 0.1;\n\t\t}\n\t\tdefault: { // Cells with < 2 or > 3 neighbors become inactive.\n\t\t\tcellStateOut[i] = 0;\n\t\t\tlifeState[i] -= 0.05;\n\t\t}\n\t}\n\tlifeState[i] = max(lifeState[i], 0.01);\n}`;class g{constructor(){this.mRscene=new s.RendererScene,this.mouseDown=t=>{},this.mStep=0,this.mFrameDelay=3}initialize(){this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(n.default.MOUSE_DOWN,this.mouseDown),new d.default(this.mRscene,!0),(new a.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}createUniformValues(){const t=new Float32Array([f,f]),e=new Uint32Array(f*f);for(let c=0;c<e.length;c++)e[c]=Math.random()>.6?1:0;const i=new Uint32Array(f*f);for(let c=0;c<i.length;c++)i[c]=c%2;const r=new Float32Array(f*f);for(let c=0;c<r.length;c++)r[c]=.01;const s=new Float32Array(f*f*4);let n=new c.default(40,1,40),a=(new c.default).copyFrom(n);a.scaleBy(f),a.scaleBy(-.5);let o=0;for(let P=0;P<f;P++)for(let t=0;t<f;t++){let e=new c.default(t*n.x,0,P*n.z).addBy(a);s[o]=e.x,s[o+1]=e.y,s[o+2]=e.z,o+=4}let l=!0,u={data:e,shared:l},h={data:i,shared:l},d={data:r,shared:l},m={data:s,shared:l};const p={data:t,stride:2,shared:l,layout:{visibility:"all"}},v={storage:{bufData:u,stride:1,shared:l},layout:{visibility:"vert_comp"}},g={storage:{bufData:h,stride:1,shared:l},layout:{visibility:"vert_comp"}},b={storage:{bufData:d,stride:1,shared:l,layout:{visibility:"all"}}},y={storage:{bufData:m,stride:3,shared:l,layout:{visibility:"vert_comp"}}},_={storage:{bufData:u,stride:1,shared:l,layout:{visibility:"vert_comp"}}},x={storage:{bufData:h,stride:1,shared:l,layout:{visibility:"comp"}}},w={storage:{bufData:h,stride:1,shared:l,layout:{visibility:"vert_comp"}}},S={storage:{bufData:u,stride:1,shared:l,layout:{visibility:"comp",access:"read_write"}}},M={storage:{bufData:d,stride:1,shared:l,layout:{visibility:"comp",access:"read_write"}}};return[{ufvs0:[p,v,b,y],ufvs1:[p,g,b,y]},{ufvs0:[p,_,x,M],ufvs1:[p,w,S,M]}]}createMaterial(t){const e=f*f;let i={vert:{code:o.default,uuid:"vert-gameOfLife"},frag:{code:l.default,uuid:"frag-gameOfLife"}};return new h.WGMaterial({shadinguuid:"rendering",shaderSrc:i,instanceCount:e,uniformValues:t,uniformAppend:!1})}createCompMaterial(t){const e=Math.ceil(f/p);let i={code:v,uuid:"shader-computing"};return new u.WGCompMaterial({shadinguuid:"computing",shaderSrc:i,uniformValues:t,uniformAppend:!1,workcounts:[e,e]})}initScene(){const t=this.mRscene,e=this.createUniformValues(),i=[this.createMaterial(e[0].ufvs0),this.createMaterial(e[0].ufvs1),this.createCompMaterial(e[1].ufvs1),this.createCompMaterial(e[1].ufvs0)];let r=new m.CylinderEntity({radius:20,height:38,longitudeNumSegments:10,latitudeNumSegments:10,alignYRatio:0,materials:i});t.addEntity(r),this.mEntity=r}run(){let t=this.mEntity.isRendering();const e=this.mEntity.materials;if(t){for(let t=0;t<e.length;t++)e[t].visible=(this.mStep%2+t)%2==0;this.mFrameDelay>0?(this.mFrameDelay--,t=!1):(this.mFrameDelay=3,this.mStep++)}t||(e[2].visible=!1,e[3].visible=!1),this.mRscene.run()}}e.GameOfLife3DPBR=g},cae9:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("68f4")),n=i("6b10"),a=i("63d8"),o=i("ddc9");e.WGRPipelineContextDefParam=o.WGRPipelineContextDefParam;const l=i("6130"),u=i("f5fb");e.WGRendererConfig=u.WGRendererConfig;const h=i("d5c3");class c{constructor(t){this.___$$$$$$$Author="VilyLei(vily313@126.com)",this.mUid=c.sUid++,this.mInit=!0,this.mRPBlocks=[],this.mROBuilder=new a.WGRObjBuilder,this.mEntityMana=new l.WGEntityNodeMana,this.enabled=!0,t&&this.initialize(t)}initCamera(t,e){let i=this.mConfig.camera;if(i||(i={}),!1!==i.enabled){let r=this;this.camera||(r.camera=new s.default),i.viewWidth=t,i.viewHeight=e,this.camera.initialize(i)}}get uid(){return 0}getWGCtx(){return this.mWGCtx}getStage3D(){return this.stage}getCamera(){return this.camera}getDiv(){return this.mDiv}getCanvas(){return this.mWGCtx.canvas}initialize(t){if(this.mInit&&!this.mWGCtx){this.mInit=!1;let e=t?t.ctx:null;if(e){this.mDiv=t.div,this.mWGCtx=e;const i=e.canvas;this.mROBuilder.wgctx=e,this.initCamera(i.width,i.height)}else t=u.checkConfig(t),this.mDiv=t.div,e=new n.WebGPUContext,e.initialize(t.canvas,t.gpuCanvasCfg).then(()=>{this.init(),t&&t.callback&&t.callback("renderer-init"),this.mROBuilder.wgctx=e;const i=this.mEntityMana;i.wgctx=e,i.roBuilder=this.mROBuilder,this.mEntityMana.updateToTarget()}),this.mWGCtx=e;this.mConfig=t}}intDefaultBlock(){if(this.mRPBlocks.length<1){let t=this.mConfig.rpassparam;t||(t={sampleCount:4,multisampleEnabled:!0,depthFormat:"depth24plus"}),this.createRenderBlock(t)}}init(){const t=this.mWGCtx,e=this.mWGCtx.canvas;this.initCamera(e.width,e.height);const i=this.mRPBlocks;for(let r=0;r<i.length;++r)i[r].initialize(t)}addEntity(t,e=0){const i=this.mRPBlocks;if(i.length<1&&(this.initialize(),this.intDefaultBlock()),e<0||e>=i.length)throw Error("Illegal operation !!!");const r=i[e];r.addEntity(t)}removeEntity(t){if(t&&t.isInRenderer()){const e=t.__$bids;if(e){let i=new Array(e.length);for(let t=0;t<e.length;++t)i[t]=h.WGRenderUnitBlock.getBlockAt(e[t]);t.__$bids=[];for(let r=0;r<e.length;++r)i[r].removeEntity(t)}const i=t.rstate;i.__$rever++,i.__$inRenderer=!1,i.__$rendering=!1}}setPassNodeGraph(t,e=0){this.intDefaultBlock();const i=this.mRPBlocks.length;if(!(e>=0&&e<i))throw Error("Illegal operations !!!");this.mRPBlocks[e].setPassNodeGraph(t)}appendRenderPass(t,e=0){this.initialize(),this.intDefaultBlock();const i=this.mRPBlocks.length;if(e>=0&&e<i)return this.mRPBlocks[e].appendRendererPass(t);throw Error("Illegal operations !!!")}createRenderPass(t,e=0){return this.appendRenderPass(t,e)}getRPBlockAt(t){return this.initialize(),this.intDefaultBlock(),this.mRPBlocks[t]}createRenderBlock(t){let e={entityMana:this.mEntityMana,roBuilder:this.mROBuilder,camera:this.camera};const i=new o.WGRenderPassBlock(this.mUid,e,this.mWGCtx,t);return i.unitBlock=h.WGRenderUnitBlock.createBlock(),this.mRPBlocks.push(i),i}isEnabled(){return this.enabled&&this.mWGCtx&&this.mWGCtx.enabled}run(t=!0){if(this.enabled){const e=this.mWGCtx;if(e&&e.enabled&&(this.mEntityMana.update(),t)){const t=this.mRPBlocks;if(t.length>0){const i=t[0];i.runBegin(),i.run(),i.runEnd();const r=i.rcommands;e.queue.submit(r)}}}}destroy(){const t=this.mWGCtx;t&&t.enabled}}c.sUid=0,e.WGRenderer=c},cb24:function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> param: vec4f;\r\n@group(0) @binding(1) var sampler0: sampler;\r\n@group(0) @binding(2) var texture0: texture_2d<f32>;\r\n\r\nfn reinhard(v: vec3<f32>) -> vec3<f32> {\r\n    return v / (vec3<f32>(1.0) + v);\r\n}\r\nfn calcColor(uv: vec2f) -> vec4f {\r\n\r\n    var result = textureSample(texture0, sampler0, uv) * param;\r\n\tresult = vec4f(reinhard( result.xyz ), 1.0);\r\n\t// gamma correct\r\n\tresult = vec4f(pow(result.xyz, vec3<f32>(1.0/2.2)), 1.0);\r\n\r\n    return result;\r\n}\r\n\r\n@fragment\r\nfn main(\r\n\t@location(0) uv: vec2f\r\n\t) -> @location(0) vec4f {\r\n\tvar color4 = calcColor( uv );\r\n    return color4;\r\n}\r\n"},cbb4:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{}r.AXIS_ANGLE=0,r.QUATERNION=1,r.EULER_ANGLES=2,e.default=r},cc22:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("f3f6")),a=r(i("3f99")),o=i("943f"),l=i("746a"),u=i("551f"),h=i("cae9"),c=i("58c4"),d=r(i("af80"));class m{constructor(){this.geomData=new s.GeomDataBuilder,this.renderer=new h.WGRenderer}initialize(){const t={vert:{code:n.default,uuid:"vertShdCode"},frag:{code:a.default,uuid:"fragShdCode"}};let e=[this.createMaterial(t,[new c.WGImage2DTextureData("static/assets/box.jpg")]),this.createMaterial(t,[new c.WGImage2DTextureData("static/assets/default.jpg")],["add"]),this.createMaterial(t,[new c.WGImage2DTextureData("static/assets/xulie_08_61.png")],["alpha_add"]),this.createMaterial(t,[new c.WGImage2DTextureData("static/assets/blueTransparent.png")],["add"])];for(let i=0;i<e.length;++i)this.createEntity([e[i]],new d.default(0,0,50*i-50),"et-"+i)}createMaterial(t,e,i=["solid"]){let r={faceCullMode:"back",blendModes:[]};r.blendModes=i;const s=e?e.length:0,n=new o.WGMaterial({shadinguuid:"base-material-tex"+s+i.toString(),shaderSrc:t,pipelineDefParam:r});return n.addTextureWithDatas(e),n}createEntity(t,e,i){const r=this.renderer,s=this.geomData.createSquare(600),n=(new l.WGGeometry).addAttribute({position:s.vs}).addAttribute({uv:s.uvs,strides:[2]}).setIndices(s.ivs),a=new u.Entity3D({geometry:n,materials:t});return a.uuid=i,a.transform.setPosition(e),r.addEntity(a),a}run(){this.renderer.run()}}e.BlendTest=m},cc97:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t=1,e=0,i=1,r=1){this.a=t,this.r=e,this.m=i,this.s=r}clone(){return new r(this.a,this.r,this.m,this.s)}setArms(t){let e=t;if(e){const t=this,i=e;if(void 0!==i.length){const e=i.length;e>0&&(t.a=i[0]),e>1&&(t.r=i[1]),e>2&&(t.m=i[2]),e>3&&(t.s=i[3])}else{const i=e;void 0!==i.a&&(t.s=i.a),void 0!==i.r&&(t.r=i.r),void 0!==i.m&&(t.m=i.m),void 0!==i.s&&(t.s=i.s)}}return this}fromArray4(t,e=0){return this.a=t[e],this.r=t[e+1],this.m=t[e+2],this.s=t[e+3],this}toArray4(t,e=0){return t[e]=this.a,t[e+1]=this.r,t[e+2]=this.m,t[e+3]=this.s,this}getArray4(){let t=new Array(4);return this.toArray4(t),t}getArray3(){let t=new Array(3);return this.toArray3(t),t}fromArray3(t,e=0){return this.a=t[e],this.r=t[e+1],this.m=t[e+2],this}toArray3(t,e=0){return t[e]=this.a,t[e+1]=this.r,t[e+2]=this.m,this}setARM3f(t,e,i){return this.a=t,this.r=e,this.m=i,this}setARM4f(t,e,i,r){return this.a=t,this.r=e,this.m=i,this.s=r,this}copyFrom(t){return this.a=t.a,this.r=t.r,this.m=t.m,this.s=t.s,this}copyFromARM(t){return this.a=t.a,this.r=t.r,this.m=t.m,this}}e.default=r},d0b3:function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(3) var mySampler0: sampler;\r\n@group(0) @binding(4) var myTexture0: texture_2d<f32>;\r\n@group(0) @binding(5) var mySampler1: sampler;\r\n@group(0) @binding(6) var myTexture1: texture_2d<f32>;\r\n\r\n@fragment\r\nfn main(\r\n    @location(0) fragUV: vec2<f32>,\r\n    @location(1) fragPosition: vec4<f32>\r\n) -> @location(0) vec4<f32> {\r\n    let factor: f32 = 0.5;\r\n    var color0: vec4<f32>;\r\n    var color1: vec4<f32>;\r\n    color0 = textureSample(myTexture0, mySampler0, fragUV) * fragPosition;\r\n    color1 = textureSample(myTexture1, mySampler1, fragUV) * fragPosition;\r\n    return color0 * vec4<f32>(1.0 - factor) + color1 * vec4<f32>(factor);\r\n}\r\n"},d36d:function(t,e,i){"use strict";i.r(e),e["default"]="struct VSOut {\r\n    @builtin(position) Position: vec4f,\r\n    @location(0) uv: vec2f,\r\n};\r\n\r\n@vertex\r\nfn main(@location(0) position: vec3f,\r\n        @location(1) uv: vec2f) -> VSOut {\r\n    var vsOut: VSOut;\r\n    vsOut.Position = vec4(position, 1.0);\r\n    vsOut.uv = uv;\r\n    return vsOut;\r\n}\r\n"},d3d0:function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> param: vec4f;\r\n@group(0) @binding(1) var sampler0: sampler;\r\n@group(0) @binding(2) var texture0: texture_2d<f32>;\r\n\r\nconst weight = array<f32, 5>(0.227027, 0.1945946, 0.1216216, 0.054054, 0.016216);\r\nfn calcBlurColor(uv: vec2f) -> vec4f {\r\n    var dv = vec2f(param.z, 0.0) / param.xy;\r\n    let dx = dv.x;\r\n\r\n    var result = textureSample(texture0, sampler0, uv) * weight[0];\r\n\tfor (var i: i32 = 1; i < 5; i++)  {\r\n        dv.x = dx * f32(i);\r\n        result += textureSample(texture0, sampler0, uv + dv) * weight[i];\r\n        result += textureSample(texture0, sampler0, uv - dv) * weight[i];\r\n    }\r\n    return result;\r\n}\r\n\r\n@fragment\r\nfn main(\r\n\t@location(0) uv: vec2f\r\n\t) -> @location(0) vec4f {\r\n\tvar color4 = calcBlurColor( uv );\r\n    return color4;\r\n}\r\n"},d463:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("f22d"),n=r(i("0540")),a=i("746a"),o=i("943f"),l=i("7650"),u=r(i("2c77")),h=r(i("d36d")),c=r(i("611e")),d=r(i("1934")),m=r(i("f937"));class f extends s.FixScreenEntity{constructor(t){super(t),this.mColor=new u.default,this.mExtent=new m.default,t||(t={}),!1!==t.building&&(this.createGeometry(t),this.createMaterial(t))}setColor(t){return t&&this.mColorV&&(this.mColor.setColor(t).toArray4(this.mColorV.data),this.mColorV.version++),this}set color(t){this.setColor(t)}get color(){return this.mColor}createGeometry(t){if(t.geometry)this.geometry=t.geometry;else{let e=new n.default;if(e.axisType=0,e.flipY=!0===t.flipY,void 0!==t.extent){const i=this.mExtent;i.setExtent(t.extent),e.initialize(i.x,i.y,i.width,i.height)}else e.initialize(void 0===t.x?-1:t.x,void 0===t.y?-1:t.y,void 0===t.width?2:t.width,void 0===t.height?2:t.height);this.geometry=(new a.WGGeometry).addAttribute({position:e.getVS()}).addAttribute({uv:e.getUVS()}).setIndices(e.getIVS())}}createMaterial(t){if(t.materials)this.materials=t.materials;else{t.uniformValues||(this.mColorV=s.getUniformValueFromParam("color",t,new l.WGRUniformValue({data:new Float32Array([1,1,1,1]),shdVarName:"color"})));const e=t.textures,i=e?e.length:0;let r=i>0?"fragTex":"frag";const n=t.shaderSrc?t.shaderSrc:{vertShaderSrc:{code:h.default,uuid:"fixScreenPlaneVertShdCode"},fragShaderSrc:{code:i>0?d.default:c.default,uuid:"fixScreenPlaneShdCode"+r}};let a=t.depthWriteEnabled;a=void 0!==a&&a;let u=t.faceCullMode;u=u||"back";let m=t.blendModes;m=m||["solid"];let f={depthWriteEnabled:a,faceCullMode:u,blendModes:m},p=void 0!==t.shadinguuid?t.shadinguuid:"FixScreenPlaneEntity-material-tex"+i;const v=new o.WGMaterial({shadinguuid:p,shaderSrc:n,pipelineDefParam:f});v.addTextures(e),void 0!==t.instanceCount&&(v.instanceCount=t.instanceCount),v.uniformValues=t.uniformValues?t.uniformValues:[this.mColorV],v.uniformValues&&v.uniformValues.length>0&&(this.mColorV=v.uniformValues[0]),this.materials=[v]}o.checkMaterialRPasses(this.materials,t.rpasses)}destroy(){super.destroy()}}e.FixScreenPlaneEntity=f},d493:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=i("4ad2"),a=i("213f"),o=r(i("2c77")),l=i("9849"),u=i("5009"),h=i("76e3"),c=i("0069"),d=i("5118"),m=i("7e70"),f=i("97f2"),p=i("603e");class v{constructor(){this.mRscene=new n.RendererScene,this.mouseDown=t=>{}}initialize(){this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(s.default.MOUSE_DOWN,this.mouseDown),(new a.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}initScene(){const t=this.mRscene;let e=new p.AxisEntity;t.addEntity(e),e=e.clone(),e.transform.setScaleAll(.3).setXYZ(50,0,50),t.addEntity(e);let i=[new l.SphereEntity,new u.BoxEntity,new h.CylinderEntity({alignYRatio:0}),new c.CubeEntity({cubeSize:130}),new d.TorusEntity({radius:110,axisType:1}),new m.PlaneEntity({axisType:1,extent:[-80,-80,160,160],doubleFace:!0}),new f.ConeEntity({alignYRatio:0})],r=i;i=[];for(let n=0,a=r.length;n<a;++n){const t=Math.round(888*Math.random())%r.length;i.push(r[t]),r.splice(t,1)}let s=300;for(let n=0;n<i.length;++n){let e=2*Math.PI*n/i.length,r=i[n].setAlbedo((new o.default).randomRGB(1.5,.1));r.arm=[1.1,.95*Math.random()+.05,.9*Math.random()+.1],r.transform.setPosition([s*Math.cos(e),0,s*Math.sin(e)]),t.addEntity(r)}s+=200;for(let n=0;n<i.length;++n){let e=2*Math.PI*n/i.length+.4,r=i[n].clone({doubleFace:!0,wireframe:!0});r.transform.setPosition([s*Math.cos(e),0,s*Math.sin(e)]).setScaleAll(.7),t.addEntity(r)}}run(){this.mRscene.run()}}e.EntityCloneTest=v},d5c3:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("4145"),s={uid:0,blocks:[]};class n{constructor(){this.mUid=s.uid++,this.mUnits=[],this.mENodeMap=new Map,this.mMaterialMap=new Map}static createBlock(){const t=new n;return s.blocks.push(t),t}static getBlockAt(t){return s.blocks[t]}get uid(){return this.mUid}hasMaterial(t){if(void 0!==t.uid){const e=this.mMaterialMap;if(e.has(t.uid))return!0;e.set(t.uid,t)}return!1}addEntityToBlock(t,e){t.update(),e.rstate.__$rever++;const i=this.rbParam.roBuilder.createRUnit(t,this.builder,e,this.uid);i.etuuid=t.uuid+"-[block("+this.uid+")]",this.addRUnit(i)}addEntity(t){if(t){const e=this.mENodeMap,i=t.uid;if(!e.has(i)){let s=new r.WGREntityNode;s.entity=t,s.entityid=i,s.blockid=this.uid,t.__$bids.push(s.blockid),e.set(i,s),t.rstate.__$inRenderer=!0,t.update();const n=this.rbParam.roBuilder.wgctx;let a=!0;n&&n.enabled&&t.isREnabled()&&(a=!1,this.addEntityToBlock(t,s)),a&&this.rbParam.entityMana.addEntity({entity:t,rever:s.rstate.__$rever,builder:this.builder,node:s,block:this})}}}removeEntity(t){if(t){const e=this.mENodeMap,i=t.uid;if(e.has(i)){const t=e.get(i);t.rstate.__$rever++,e.delete(i);const r=t.entity,s=r.__$bids;if(s){const t=this.uid;for(let e=0;e<s.length;++e)if(s[e]==t){s.splice(e,1);break}}t.entity=null}}}addRUnit(t){t&&this.mUnits.push(t)}run(){const t=this.mUnits;let e=t.length;for(let i=0;i<e;){const r=t[i];if(r.__$rever==r.pst.__$rever){if(r.getRF())if(r.passes){const t=r.passes;for(let e=0,i=t.length;e<i;++e)t[e].runBegin(),t[e].run()}else r.runBegin(),r.run();i++}else r.destroy(),t.splice(i,1),e--}}destroy(){const t=this.mUnits;if(t){let e=t.length;for(let i=0;i<e;++i){const e=t[i];e.destroy()}}}}e.WGRenderUnitBlock=n},d95d:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("4ad2"),n=i("d463"),a=r(i("32d5")),o=i("19f9"),l=i("943f"),u=64,h=8,c=`\n@group(0) @binding(0) var<uniform> grid: vec2f;\n\n@group(0) @binding(1) var<storage> cellStateIn: array<u32>;\n@group(0) @binding(2) var<storage, read_write> cellStateOut: array<u32>;\n\nfn cellIndex(cell: vec2u) -> u32 {\n\treturn (cell.y % u32(grid.y)) * u32(grid.x) +\n\t\t   (cell.x % u32(grid.x));\n}\n\nfn cellActive(x: u32, y: u32) -> u32 {\n\treturn cellStateIn[cellIndex(vec2(x, y))];\n}\n\n@compute @workgroup_size(${h}, ${h})\nfn compMain(@builtin(global_invocation_id) cell: vec3u) {\n\t// Determine how many active neighbors this cell has.\n\tlet activeNeighbors = cellActive(cell.x+1, \t\tcell.y+1) +\n\t\t\t\t\t\t\tcellActive(cell.x+1, \tcell.y) +\n\t\t\t\t\t\t\tcellActive(cell.x+1, \tcell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x, \t\tcell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, \tcell.y-1) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, \tcell.y) +\n\t\t\t\t\t\t\tcellActive(cell.x-1, \tcell.y+1) +\n\t\t\t\t\t\t\tcellActive(cell.x, \t\tcell.y+1);\n\n\tlet i = cellIndex(cell.xy);\n\n\t// Conway's game of life rules:\n\tswitch activeNeighbors {\n\t\tcase 2: { // Active cells with 2 neighbors stay active.\n\t\t\tcellStateOut[i] = cellStateIn[i];\n\t\t}\n\t\tcase 3: { // Cells with 3 neighbors become or stay active.\n\t\t\tcellStateOut[i] = 1;\n\t\t}\n\t\tdefault: { // Cells with < 2 or > 3 neighbors become inactive.\n\t\t\tcellStateOut[i] = 0;\n\t\t}\n\t}\n}`;class d{constructor(){this.mRscene=new s.RendererScene,this.mStep=0,this.mFrameDelay=3}initialize(){this.initScene()}createUniformValues(){const t=new Float32Array([u,u]),e=new Uint32Array(u*u);for(let u=0;u<e.length;u++)e[u]=Math.random()>.6?1:0;const i=new Uint32Array(u*u);for(let u=0;u<i.length;u++)i[u]=u%2;let r=!0,s={data:e,shared:r},n={data:i,shared:r};const a={data:t,stride:2,shared:r,layout:{visibility:"all"}},o={storage:{bufData:s,stride:1,shared:r},layout:{visibility:"vert_comp"}},l={storage:{bufData:n,stride:1,shared:r},layout:{visibility:"vert_comp"}},h={storage:{bufData:s,stride:1,shared:r},layout:{visibility:"vert_comp"}},c={storage:{bufData:n,stride:1,shared:r},layout:{visibility:"comp",access:"read_write"}},d={storage:{bufData:n,stride:1,shared:r},layout:{visibility:"vert_comp"}},m={storage:{bufData:s,stride:1,shared:r,layout:{visibility:"comp",access:"read_write"}}};return[{ufvs0:[a,o],ufvs1:[a,l]},{ufvs0:[a,h,c],ufvs1:[a,d,m]}]}createMaterial(t,e,i,r){return new l.WGMaterial({shadinguuid:i,shaderSrc:t,instanceCount:r,uniformValues:e})}createCompMaterial(t,e,i,r=2){return new o.WGCompMaterial({shadinguuid:i,shaderSrc:t,uniformValues:e}).setWorkcounts(r,r)}initScene(){const t=this.mRscene,e=this.createUniformValues(),i=u*u,r=Math.ceil(u/h);let s={code:a.default,uuid:"shader-shading"},o={code:c,uuid:"shader-computing"};const l=[this.createMaterial(s,e[0].ufvs0,"rshd0",i),this.createMaterial(s,e[0].ufvs1,"rshd1",i),this.createCompMaterial(o,e[1].ufvs1,"compshd0",r),this.createCompMaterial(o,e[1].ufvs0,"compshd1",r)];let d=new n.FixScreenPlaneEntity({extent:[-.8,-.8,1.6,1.6],materials:l});t.addEntity(d),this.mEntity=d}run(){let t=this.mEntity.isRendering();if(t){if(this.mFrameDelay>0)return void this.mFrameDelay--;this.mFrameDelay=3;const t=this.mEntity.materials;for(let e=0;e<t.length;e++)t[e].visible=(this.mStep%2+e)%2==0;this.mStep++}this.mRscene.run(t)}}e.GameOfLifeMultiMaterialPass=d},d9d5:function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> objMat : mat4x4<f32>;\r\n@group(0) @binding(1) var<uniform> viewMat : mat4x4<f32>;\r\n@group(0) @binding(2) var<uniform> projMat : mat4x4<f32>;\r\n\r\nstruct VertexOutput {\r\n  @builtin(position) Position : vec4<f32>,\r\n  @location(0) wordPos: vec4<f32>,\r\n  @location(1) uv : vec2<f32>,\r\n  @location(2) normal : vec3<f32>,\r\n  @location(3) camPos : vec3<f32>\r\n}\r\n\r\n@vertex\r\nfn main(\r\n  @location(0) position : vec3<f32>,\r\n  @location(1) uv : vec2<f32>,\r\n  @location(2) normal : vec3<f32>\r\n) -> VertexOutput {\r\n\r\n  let wpos = objMat * vec4(position.xyz, 1.0);\r\n  var output : VertexOutput;\r\n  output.Position = projMat * viewMat * wpos;\r\n  output.uv = uv;\r\n\r\n  let invMat33 = inverseM33( m44ToM33( objMat ) );\r\n  output.normal = normalize( normal * invMat33 );\r\n  output.camPos = (inverseM44(viewMat) * vec4<f32>(0.0,0.0,0.0, 1.0)).xyz;\r\n  output.wordPos = wpos;\r\n  return output;\r\n}\r\n\r\nfn inverseM33(m: mat3x3<f32>)-> mat3x3<f32> {\r\n    let a00 = m[0][0]; let a01 = m[0][1]; let a02 = m[0][2];\r\n    let a10 = m[1][0]; let a11 = m[1][1]; let a12 = m[1][2];\r\n    let a20 = m[2][0]; let a21 = m[2][1]; let a22 = m[2][2];\r\n    let b01 = a22 * a11 - a12 * a21;\r\n    let b11 = -a22 * a10 + a12 * a20;\r\n    let b21 = a21 * a10 - a11 * a20;\r\n    let det = a00 * b01 + a01 * b11 + a02 * b21;\r\n    return mat3x3<f32>(\r\n\t\tvec3<f32>(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11)) / det,\r\n                vec3<f32>(b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10)) / det,\r\n                vec3<f32>(b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det);\r\n}\r\nfn m44ToM33(m: mat4x4<f32>) -> mat3x3<f32> {\r\n\treturn mat3x3(m[0].xyz, m[1].xyz, m[2].xyz);\r\n}\r\n\r\nfn inverseM44(m: mat4x4<f32>)-> mat4x4<f32> {\r\n    let a00 = m[0][0]; let a01 = m[0][1]; let a02 = m[0][2]; let a03 = m[0][3];\r\n    let a10 = m[1][0]; let a11 = m[1][1]; let a12 = m[1][2]; let a13 = m[1][3];\r\n    let a20 = m[2][0]; let a21 = m[2][1]; let a22 = m[2][2]; let a23 = m[2][3];\r\n    let a30 = m[3][0]; let a31 = m[3][1]; let a32 = m[3][2]; let a33 = m[3][3];\r\n    let b00 = a00 * a11 - a01 * a10;\r\n    let b01 = a00 * a12 - a02 * a10;\r\n    let b02 = a00 * a13 - a03 * a10;\r\n    let b03 = a01 * a12 - a02 * a11;\r\n    let b04 = a01 * a13 - a03 * a11;\r\n    let b05 = a02 * a13 - a03 * a12;\r\n    let b06 = a20 * a31 - a21 * a30;\r\n    let b07 = a20 * a32 - a22 * a30;\r\n    let b08 = a20 * a33 - a23 * a30;\r\n    let b09 = a21 * a32 - a22 * a31;\r\n    let b10 = a21 * a33 - a23 * a31;\r\n    let b11 = a22 * a33 - a23 * a32;\r\n    let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\treturn mat4x4<f32>(\r\n\t\tvec4<f32>(a11 * b11 - a12 * b10 + a13 * b09,\r\n\t\ta02 * b10 - a01 * b11 - a03 * b09,\r\n\t\ta31 * b05 - a32 * b04 + a33 * b03,\r\n\t\ta22 * b04 - a21 * b05 - a23 * b03) / det,\r\n\t\t\tvec4<f32>(a12 * b08 - a10 * b11 - a13 * b07,\r\n\t\ta00 * b11 - a02 * b08 + a03 * b07,\r\n\t\ta32 * b02 - a30 * b05 - a33 * b01,\r\n\t\ta20 * b05 - a22 * b02 + a23 * b01) / det,\r\n\t\tvec4<f32>(a10 * b10 - a11 * b08 + a13 * b06,\r\n\t\ta01 * b08 - a00 * b10 - a03 * b06,\r\n\t\ta30 * b04 - a31 * b02 + a33 * b00,\r\n\t\ta21 * b02 - a20 * b04 - a23 * b00) / det,\r\n\t\tvec4<f32>(a11 * b07 - a10 * b09 - a12 * b06,\r\n\t\ta00 * b09 - a01 * b07 + a02 * b06,\r\n\t\ta31 * b01 - a30 * b03 - a32 * b00,\r\n\t\ta20 * b03 - a21 * b01 + a22 * b00) / det);\r\n}"},dc4d:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("fe0b");class s{constructor(){this.binding=0,this.visibility=GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX}toVisibleAll(){return this.visibility=GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX|GPUShaderStage.COMPUTE,this}toVisibleVertFrag(){return this.visibility=GPUShaderStage.FRAGMENT|GPUShaderStage.VERTEX,this}toVisibleVert(){return this.visibility=GPUShaderStage.VERTEX,this}toVisibleVertComp(){return this.visibility=GPUShaderStage.VERTEX|GPUShaderStage.COMPUTE,this}toVisibleFragComp(){return this.visibility=GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE,this}toVisibleFrag(){return this.visibility=GPUShaderStage.FRAGMENT,this}toVisibleComp(){return this.visibility=GPUShaderStage.COMPUTE,this}toBufferForUniform(){return this.buffer={type:"uniform",hasDynamicOffset:!1,minBindingSize:0},this}toBufferForStorage(){return this.buffer={type:"storage"},this}toBufferForReadOnlyStorage(){return this.buffer={type:"read-only-storage"},this}toSamplerFiltering(){return this.sampler={type:"filtering"},this}toTextureFloat(t){return t=t||"2d",this.texture={sampleType:"float",viewDimension:t},this}clone(){const t=new s;return t.label=this.label,t.visibility=this.visibility,this.buffer&&(t.buffer={},r.copyFromObjectValueWithKey(this.buffer,t.buffer)),this.sampler&&(t.sampler={},r.copyFromObjectValueWithKey(this.sampler,t.sampler)),this.texture&&(t.texture={},r.copyFromObjectValueWithKey(this.texture,t.texture)),t}}e.WGRBufferVisibility=s},dca8:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("19f9"),s=i("551f");e.Entity3DParam=s.Entity3DParam,e.getUniformValueFromParam=s.getUniformValueFromParam;class n extends s.Entity3D{constructor(t){t=t||{transformEnabled:!1},t.transformEnabled=!1,super(t),this.cameraViewing=!1;const e=t.workcounts;e&&this.setWorkcounts(e[0],e.length>1?e[1]:0,e.length>2?e[2]:0),this.createMaterial(t)}setWorkcounts(t,e,i){this.workcounts||(this.workcounts=new Uint16Array([1,1,0,0]));const r=this.workcounts;return r[0]=t,r[1]=void 0!==e?e:0,r[2]=void 0!==i?i:0,this}createMaterial(t){if(t||(t={}),t.materials)this.materials=t.materials;else{const e=t.shaderSrc,i=new r.WGCompMaterial({shadinguuid:void 0!==t.shadinguuid?t.shadinguuid:"ComputeEntity-material",shaderSrc:e});void 0!==t.instanceCount&&(i.instanceCount=t.instanceCount),i.uniformValues=t.uniformValues,this.materials=[i]}}isREnabled(){return!0}update(){return this}}e.ComputeEntity=n},ddc9:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("0142");e.WGRPassParam=r.WGRPassParam;const s=i("bf93");e.WGRPipelineContextDefParam=s.WGRPipelineContextDefParam;const n=i("2258"),a=i("7751"),o=i("d5c3");class l{constructor(t,e,i,r){this.mRendererUid=0,this.mCompPassNodes=[],this.mRPassNodes=[],this.mRSeparatePassNodes=[],this.mPassNodes=[],this.mPNodeFlags=[],this.enabled=!0,this.mRendererUid=t,this.mRBParam=e,this.camera=e.camera,this.mrPassParam=r,this.initialize(i,r)}getWGCtx(){return this.mWGCtx}initialize(t,e){if(this.mrPassParam=e||this.mrPassParam,t){if(e=this.mrPassParam,!this.mWGCtx&&t&&t.enabled){this.mWGCtx=t;for(let e=0;e<this.mPassNodes.length;++e)this.mPassNodes[e].initialize(t)}if(0==this.mPassNodes.length&&e){const i=new a.WGRenderPassNode(this.mRBParam);i.builder=this,i.initialize(t,e),this.mPassNodes.push(i),this.mPNodeFlags.push(1),this.mRPassNodes.push(i)}}}hasMaterial(t){return!!this.unitBlock&&this.unitBlock.hasMaterial(t)}addEntity(t){if(t){this.unitBlock||(this.unitBlock=o.WGRenderUnitBlock.createBlock());const e=this.unitBlock;e.rbParam=this.mRBParam,e.builder=this,e.addEntity(t)}}getRenderPassAt(t){const e=this.mRPassNodes,i=e.length;return t<0?t=0:t>=i&&(t=i),{index:t,node:e[t]}}getComptePassAt(t){const e=this.mCompPassNodes,i=e.length;return t<0?t=0:t>=i&&(t=i),{index:t,node:e[t]}}appendRendererPass(t){t||(t={});const e=t&&!0===t.computeEnabled;let i=-1;const r=new a.WGRenderPassNode(this.mRBParam,!e);if(r.camera=this.camera,e)r.builder=this,r.name="newcomppassnode-"+this.mPassNodes.length,r.initialize(this.mWGCtx,t),this.mCompPassNodes.push(r),i=this.mCompPassNodes.length-1;else{let e;r.name="newpassnode-"+this.mPassNodes.length;let s,n=t.prevPass;if(n&&void 0!==n.node){e=n.node,s=e.param,t.multisampleEnabled=s.multisampleEnabled,t.depthFormat=s.depthFormat,r.builder=this,r.prevNode=e,r.initialize(this.mWGCtx,t||e.param);const a=r.rpass;a.name="newpass_type01",a.passColors[0].loadOp="load",a.passDepthStencil.depthLoadOp="load",this.mRPassNodes.push(r),i=this.mRPassNodes.length-1}else if(!0!==t.separate){e=this.mRPassNodes[this.mRPassNodes.length-1],s=e.param,t.multisampleEnabled=s.multisampleEnabled,t.depthFormat=s.depthFormat,r.prevNode=e,r.initialize(this.mWGCtx,t||e.param);const n=r.rpass;n.name="newpass_type02",this.mRPassNodes.push(r),i=this.mRPassNodes.length-1}else{const s=r.rpass;s.name="newpass_type03(separate)",r.separate=s.separate=!0,r.initialize(this.mWGCtx,t||e.param),this.mRSeparatePassNodes.push(r),i=-1}}this.mPassNodes.push(r),this.mPNodeFlags.push(1);const s=new n.WGRPassWrapper;return s.index=i,s.node=r,s}getPassNode(t){const e=this.mRPassNodes;let i=e[e.length-1];if(t){if(t.node)return i;void 0!==t.index&&t.index>=0&&t.index<e.length&&(i=e[t.index])}return i}getPassNodeWithMaterial(t){let e=this.getPassNode(t.rpass?t.rpass.rpass:null);return t.shaderSrc.compShaderSrc&&(this.mCompPassNodes.length<1&&this.appendRendererPass({computeEnabled:!0}),e=this.mCompPassNodes[this.mCompPassNodes.length-1]),e}createRenderPipelineCtxWithMaterial(t){throw Error("Illegal operation !!!")}createRenderPipelineCtx(t,e,i,r){const s=this.getPassNode(r);return s.createRenderPipelineCtx(t,e,i)}createRenderPipeline(t,e,i){const r=this.getPassNode(i);return r.createRenderPipeline(t,e)}setPassNodeGraph(t){if(this.mGraph=t,t){let e=t.passes;for(let t=0;t<e.length;++t){const i=e[t].node;i.mode=1}}}runBegin(){if(this.rcommands=[],this.enabled){const t=this.mGraph;t&&t.runBegin();const e=this.mPassNodes;for(let i=0;i<e.length;++i)e[i].mode<1&&e[i].runBegin()}}runEnd(){if(this.enabled){const t=this.mGraph;t&&(this.rcommands=this.rcommands.concat(t.cmdWrapper.rcommands));const e=this.mPassNodes;for(let i=0;i<e.length;++i){const t=e[i];t.mode<1&&(t.runEnd(),this.rcommands=this.rcommands.concat(t.rcommands))}}}run(){if(this.enabled){const t=this.mGraph;t&&t.run();const e=this.mPassNodes;for(let i=0;i<e.length;++i)e[i].mode<1&&e[i].run();this.unitBlock&&this.unitBlock.run()}}destroy(){this.mWGCtx&&(this.mWGCtx=null,this.mRPassNodes=[],this.mCompPassNodes=[],this.mPassNodes=[],this.mRBParam=null)}}e.WGRenderPassBlock=l},df0d:function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(0) var<uniform> objMat : mat4x4<f32>;\r\n@group(0) @binding(1) var<uniform> viewMat : mat4x4<f32>;\r\n@group(0) @binding(2) var<uniform> projMat : mat4x4<f32>;\r\n\r\nstruct VertOutput {\r\n\t@builtin(position) Position : vec4<f32>,\r\n\t@location(0) uv : vec2<f32>,\r\n\t@location(1) normal : vec3<f32>\r\n}\r\n@vertex\r\nfn main(\r\n\t@location(0) position : vec3<f32>,\r\n\t@location(1) uv : vec2<f32>,\r\n\t@location(2) normal : vec3<f32>\r\n\t) ->VertOutput {\r\n\t\tlet wpos = objMat * vec4(position.xyz, 1.0);\r\n\t\tvar output : VertOutput;\r\n\t\toutput.Position = projMat * viewMat * wpos;\r\n\t\toutput.uv = uv;\r\n\t\toutput.normal = normal;\r\n    return output;\r\n}\r\n"},dfa8:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r={uid:0};function s(){return r.uid++}e.createNewWRGBufferViewUid=s;class n{constructor(){this.mUid=s(),this.arrayStride=1,this.usage=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,this.byteOffset=0,this.version=-1}get byteLength(){return this.data.byteLength}get uid(){return this.mUid}setParam(t){return t&&(t.data&&(this.data=t.data),t.buffer&&(this.buffer=t.buffer),void 0!==t.mappedAtCreation&&(this.mappedAtCreation=t.mappedAtCreation),void 0!==t.shared&&(this.shared=t.shared)),this}}e.WGRBufferView=n},e0de:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("f3f6")),a=r(i("0bc4")),o=i("943f"),l=i("746a"),u=i("551f"),h=i("e44f"),c=r(i("c69e")),d=i("4ad2"),m=i("213f"),f=r(i("2c77"));class p{constructor(){this.mRscene=new d.RendererScene,this.mEntities=[],this.geomData=new s.GeomDataBuilder,this.mouseDown=t=>{let e=this.mEntities[0];e.rstate.visible=!e.rstate.visible},this.mRotValue=0}initialize(){this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(c.default.MOUSE_DOWN,this.mouseDown),(new m.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}createMaterial(t,e,i,r=["solid"],s="back"){i=i||new f.default;let n={depthWriteEnabled:!0,faceCullMode:s,blendModes:[]};n.blendModes=r;const a=e?e.length:0,l=new o.WGMaterial({shadinguuid:"base-material-tex"+a,shaderSrc:t,pipelineDefParam:n});let u=new h.WGRStorageValue({data:new Float32Array([i.r,i.g,i.b,1])});return l.uniformValues=[u],l.addTextures(e),l}createGeom(t,e=!1){const i=(new l.WGGeometry).addAttribute({position:t.vs}).addAttribute({uv:t.uvs}).setIndices(t.ivs);return e&&i.addAttribute({normal:t.nvs}),i}initScene(){const t=this.mRscene,e=this.createGeom(this.geomData.createCube(80)),i={vert:{code:n.default,uuid:"vertShdCode"},frag:{code:a.default,uuid:"fragShdCode"}};let r=[this.createMaterial(i,[{diffuse:{url:"static/assets/box.jpg"}}],new f.default(1))],s=[this.createMaterial(i,[{diffuse:{url:"static/assets/default.jpg"}}],new f.default(0,1))],o=new u.Entity3D({geometry:e,materials:r});t.addEntity(o),this.mEntities.push(o),o=new u.Entity3D({geometry:e,materials:s}),o.transform.setXYZ(200,0,0),t.addEntity(o),this.mEntities.push(o)}run(){this.mRotValue+=.5,this.mRscene.run()}}e.Entity3DVisibilityTest=p},e2cf:function(t,e,i){"use strict";function r(t,e){let i=e.indexOf(t);if(i<0)return"";i=e.indexOf("fn",i+t.length)+2;let r=e.indexOf("(",i);return e.slice(i,r).trim()}function s(t,e){const i={module:t,entryPoint:"main",targets:[{format:"bgra8unorm"}]};return void 0!==e&&e.length>0&&(i.targets=e),i}function n(t){const e={module:t,entryPoint:"main"};return e}Object.defineProperty(e,"__esModule",{value:!0}),e.findShaderEntryPoint=r,e.createFragmentState=s,e.createComputeState=n},e315:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("b1fa")),n=r(i("c69e")),a=r(i("f5ff"));class o{constructor(t){this.m_rcuid=0,this.m_viewX=0,this.m_viewY=0,this.m_viewW=1,this.m_viewH=1,this.m_stW=800,this.m_stH=600,this.m_dp=new a.default,this.m_autoSynViewAndStageSize=!0,this.m_preStageWidth=0,this.m_preStageHeight=0,this.m_mouseEvt=new n.default,this.m_baseEvt=new s.default,this.pixelRatio=1,this.stageX=0,this.stageY=0,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.m_rcuid=t}getRCUid(){return this.m_rcuid}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.m_viewX}getViewY(){return this.m_viewY}getViewWidth(){return this.m_viewW}getViewHeight(){return this.m_viewH}dispatchMouseEvt(t,e=null){const i=this.m_mouseEvt;i.mouseX=this.mouseX,i.mouseY=this.mouseY,i.target=null==e?this:e,i.phase=t,this.m_dp.dispatchEvt(this.m_mouseEvt)}mouseDown(t=1){this.m_mouseEvt.type=n.default.MOUSE_DOWN,this.dispatchMouseEvt(t)}mouseUp(t=1){this.m_mouseEvt.type=n.default.MOUSE_UP,this.dispatchMouseEvt(t)}mouseClick(){this.m_mouseEvt.type=n.default.MOUSE_CLICK,this.dispatchMouseEvt(1)}mouseDoubleClick(){this.m_mouseEvt.type=n.default.MOUSE_DOUBLE_CLICK,this.dispatchMouseEvt(1)}mouseRightDown(t=1){this.m_mouseEvt.type=n.default.MOUSE_RIGHT_DOWN,this.dispatchMouseEvt(t)}mouseRightUp(t=1){this.m_mouseEvt.type=n.default.MOUSE_RIGHT_UP,this.dispatchMouseEvt(t)}mouseMiddleDown(t=1){this.m_mouseEvt.type=n.default.MOUSE_MIDDLE_DOWN,this.dispatchMouseEvt(t)}mouseMiddleUp(t=1){this.m_mouseEvt.type=n.default.MOUSE_MIDDLE_UP,this.dispatchMouseEvt(t)}mouseBgDown(){this.m_mouseEvt.type=n.default.MOUSE_BG_DOWN,this.dispatchMouseEvt(1)}mouseBgUp(){this.m_mouseEvt.type=n.default.MOUSE_BG_UP,this.dispatchMouseEvt(1)}mouseBgClick(){this.m_mouseEvt.type=n.default.MOUSE_BG_CLICK,this.dispatchMouseEvt(1)}mouseBgRightDown(){this.m_mouseEvt.type=n.default.MOUSE_BG_RIGHT_DOWN,this.dispatchMouseEvt(1)}mouseBgRightUp(){this.m_mouseEvt.type=n.default.MOUSE_BG_RIGHT_UP,this.dispatchMouseEvt(1)}mouseBgMiddleDown(){this.m_mouseEvt.type=n.default.MOUSE_BG_MIDDLE_DOWN,this.dispatchMouseEvt(1)}mouseBgMiddleUp(){this.m_mouseEvt.type=n.default.MOUSE_BG_MIDDLE_UP,this.dispatchMouseEvt(1)}mouseRightClick(){this.m_mouseEvt.type=n.default.MOUSE_RIGHT_CLICK,this.dispatchMouseEvt(1)}mouseMove(){this.m_mouseEvt.type=n.default.MOUSE_MOVE,this.dispatchMouseEvt(1)}mouseWheel(t){this.m_mouseEvt.type=n.default.MOUSE_WHEEL,this.m_mouseEvt.wheelDeltaY=t.wheelDeltaY,this.dispatchMouseEvt(1)}mouseCancel(){this.m_mouseEvt.type=n.default.MOUSE_CANCEL,this.dispatchMouseEvt(1)}mouseMultiDown(t){this.m_mouseEvt.type=n.default.MOUSE_MULTI_DOWN,this.m_mouseEvt.posArray=t,this.dispatchMouseEvt(1)}mouseMultiUp(t){this.m_mouseEvt.type=n.default.MOUSE_MULTI_UP,this.m_mouseEvt.posArray=t,this.dispatchMouseEvt(1)}mouseMultiMove(t){this.m_mouseEvt.type=n.default.MOUSE_MULTI_MOVE,this.m_mouseEvt.posArray=t,this.dispatchMouseEvt(1)}mouseWindowUp(t=1){}mouseWindowRightUp(t=1){}addTarget(t,e){let i=0;for(i=t.length-1;i>=0;--i)if(e===t[i])break;i<0&&t.push(e)}removeTarget(t,e){for(let i=t.length-1;i>=0;--i)if(e===t[i]){t.splice(i,1);break}}}e.default=o},e38f:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("af80"));class n{static ClacTriNormal(t,e,i,r){let a=n;s.default.Subtract(e,t,a.s_temp_vb),s.default.Subtract(i,e,a.s_temp_vc),s.default.Cross(a.s_temp_vb,a.s_temp_vc,r),r.normalize()}static ClacTriNormalByVS(t,e,i){let r=n,s=9*e;r.s_temp_va.setXYZ(t[s],t[s+1],t[s+2]),i.setXYZ(t[s+3],t[s+4],t[s+5]),r.s_temp_vc.setXYZ(t[s+6],t[s+7],t[s+8]),i.subtractBy(r.s_temp_va),r.s_temp_vc.subtractBy(r.s_temp_va),i.crossBy(r.s_temp_vc),i.normalize()}static ClacTriNormalByIVS(t,e,i,r){let s=n,a=3*e,o=3*i[a];s.s_temp_va.setXYZ(t[o],t[o+1],t[o+2]),o=3*i[a+1],r.setXYZ(t[o],t[o+1],t[o+2]),o=3*i[a+2],s.s_temp_vc.setXYZ(t[o],t[o+1],t[o+2]),r.subtractBy(s.s_temp_va),s.s_temp_vc.subtractBy(s.s_temp_va),r.crossBy(s.s_temp_vc),r.normalize()}static ClacTrisNormal(t,e,i,r,a){let o=n,l=new s.default,u=0,h=0,c=0;for(c=0;c<e;++c)a[c]=0;for(c=0;c<i;++c)o.ClacTriNormalByIVS(t,c,r,l),u=3*c,h=3*r[u],a[h]+=l.x,a[h+1]+=l.y,a[h+2]+=l.z,h=3*r[u+1],a[h]+=l.x,a[h+1]+=l.y,a[h+2]+=l.z,h=3*r[u+2],a[h]+=l.x,a[h+1]+=l.y,a[h+2]+=l.z;for(c=0;c<e;c+=3)o.s_temp_va.setXYZ(a[c],a[c+1],a[c+2]),o.s_temp_va.normalize(),a[c]=o.s_temp_va.x,a[c+1]=o.s_temp_va.y,a[c+2]=o.s_temp_va.z}static ClacTriTangent(t,e,i,r,s,a,o){let l=n,u=3*r,h=3*s[u];l.s_temp_va.setXYZ(i[h],i[h+1],i[h+2]),l.s_temp_va.setXYZ(t[h],t[h+1],t[h+2]),h=3*s[u+1],l.s_temp_vb.setXYZ(t[h],t[h+1],t[h+2]),h=3*s[u+2],l.s_temp_vc.setXYZ(t[h],t[h+1],t[h+2]),h=2*s[u],l.s_temp_vd.setXYZ(e[h],e[h+1],0),h=2*s[u+1],l.s_temp_ve.setXYZ(e[h],e[h+1],0),h=2*s[u+2],l.s_temp_vf.setXYZ(e[h],e[h+1],0),l.s_temp_vb.subtractBy(l.s_temp_va),l.s_temp_vc.subtractBy(l.s_temp_va),l.s_temp_ve.subtractBy(l.s_temp_vd),l.s_temp_vf.subtractBy(l.s_temp_vd);let c=1/(l.s_temp_ve.x*l.s_temp_vf.y-l.s_temp_ve.y*l.s_temp_vf.x);a.copyFrom(l.s_temp_vb),a.scaleBy(l.s_temp_vf.y),l.s_temp_va.copyFrom(l.s_temp_vc),l.s_temp_va.scaleBy(l.s_temp_ve.y),a.subtractBy(l.s_temp_va),a.scaleBy(c),a.normalize(),o.copyFrom(l.s_temp_vc),o.scaleBy(l.s_temp_ve.x),l.s_temp_va.copyFrom(l.s_temp_vb),l.s_temp_va.scaleBy(l.s_temp_vf.x),o.subtractBy(l.s_temp_va),o.scaleBy(c),o.normalize()}static ClacTrisTangent(t,e,i,r,a,o,l,u){let h=n,c=new s.default,d=new s.default,m=0,f=0,p=0;for(p=0;p<e;++p)l[p]=0,u[p]=0;for(p=0;p<a;++p)h.ClacTriTangent(t,i,r,p,o,c,d),m=3*p,f=3*o[m],l[f]=c.x,l[f+1]=c.y,l[f+2]=c.z,u[f]=d.x,u[f+1]=d.y,u[f+2]=d.z,f=3*o[m+1],l[f]=c.x,l[f+1]=c.y,l[f+2]=c.z,u[f]=d.x,u[f+1]=d.y,u[f+2]=d.z,f=3*o[m+2],l[f]=c.x,l[f+1]=c.y,l[f+2]=c.z,u[f]=d.x,u[f+1]=d.y,u[f+2]=d.z;for(p=0;p<e;p+=3)h.s_temp_vd.setXYZ(l[p],l[p+1],l[p+2]),h.s_temp_vd.normalize(),h.s_temp_vb.setXYZ(u[p],u[p+1],u[p+2]),h.s_temp_vb.normalize(),h.s_temp_vc.setXYZ(r[p],r[p+1],r[p+2]),h.s_temp_va.copyFrom(h.s_temp_vc),h.s_temp_vc.scaleBy(h.s_temp_vc.dot(h.s_temp_vd)),h.s_temp_vd.subtractBy(h.s_temp_vc),h.s_temp_vd.normalize(),h.s_temp_vc.setXYZ(r[p],r[p+1],r[p+2]),h.s_temp_vc.scaleBy(h.s_temp_vb.dot(h.s_temp_vc)),h.s_temp_vb.subtractBy(h.s_temp_vc),h.s_temp_vb.normalize(),h.s_temp_va.crossBy(h.s_temp_vd),h.s_temp_va.dot(h.s_temp_vb)<0&&h.s_temp_vd.scaleBy(-1),l[p]=h.s_temp_vd.x,l[p+1]=h.s_temp_vd.y,l[p+2]=h.s_temp_vd.z,h.s_temp_vb.setXYZ(r[p],r[p+1],r[p+2]),h.s_temp_vb.crossBy(h.s_temp_vd),h.s_temp_vb.normalize(),u[p]=h.s_temp_vb.x,u[p+1]=h.s_temp_vb.y,u[p+2]=h.s_temp_vb.z}}n.s_temp_va=new s.default,n.s_temp_vb=new s.default,n.s_temp_vc=new s.default,n.s_temp_vd=new s.default,n.s_temp_ve=new s.default,n.s_temp_vf=new s.default,n.s_temp_vg=new s.default,e.default=n},e44f:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("7650");class s extends r.WGRUniformValue{constructor(t){super(t),this.toStorage(),this.visibility.toBufferForReadOnlyStorage()}clone(t){const e=new r.WGRUniformValue({data:t});return e.name=this.name,e.byteOffset=this.byteOffset,e.arrayStride=this.arrayStride,e.usage=this.usage,e}}e.WGRStorageValue=s},e537:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("b1fa"));class n{constructor(){this.type=0,this.m_listeners=[],this.m_phases=[]}createEvent(t=null,e=null){let i=new s.default;return i.type=this.type,i.target=t,i.currentTarget=e,i}addListener(t,e=0){let i=this.m_listeners.length-1;for(;i>=0;--i)if(t===this.m_listeners[i])break;i<0&&(this.m_listeners.push(t),this.m_phases.push(e))}removeListener(t){let e=this.m_listeners.length-1;for(;e>=0;--e)if(t===this.m_listeners[e]){this.m_listeners.splice(e,1),this.m_phases.splice(e,1);break}}dispatch(t){let e=0,i=this.m_listeners.length;for(let r=0;r<i;++r)(this.m_phases[r]<1||t.phase==this.m_phases[r])&&(this.m_listeners[r](t),e=1);return e}passTestEvt(t){let e=this.m_listeners.length;for(let i=0;i<e;++i)if(this.m_phases[i]<1||t.phase==this.m_phases[i])return 1;return 0}passTestPhase(t){let e=this.m_listeners.length;for(let i=0;i<e;++i)if(this.m_phases[i]<1||t==this.m_phases[i])return 1;return 0}destroy(){this.m_listeners=[],this.m_phases=[]}}e.default=n},e58d:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("b1fa"));class n{constructor(t=null,e=!1){this.m_lastTime=0,this.m_fps=60,this.m_canvas2D=null,this.m_ctx2D=null,this.m_delayTime=10,this.m_preWidth=128,this.m_width=128,this.m_height=70,this.m_auto=!1,this.m_dcBoo=!1,this.m_dtBoo=!1,this.delayTime=40,this.statusInfo="",this.statusEnbled=!0,this.enterFrame=t=>{this.updateDo(!1)},this.m_timeoutId=-1,null!=t&&this.initialize(t,e)}setParams(t,e=!1){return this.m_dcBoo=t,this.m_dtBoo=e,this}initialize(t=null,e=!1){if(null==this.m_canvas2D){this.m_rsc=t,this.m_auto=e;var i=null;try{void 0!=document&&(i=document)}catch(r){}if(null!=i){this.m_preWidth=window.innerWidth;let t=this.m_preWidth-20;this.createCanvas(t)}t&&this.m_auto&&(this.m_rsc.addEventListener(s.default.ENTER_FRAME,this.enterFrame),this.autoUpdate())}}autoUpdate(){this.m_timeoutId>-1&&clearTimeout(this.m_timeoutId),this.m_timeoutId=setTimeout(this.autoUpdate.bind(this),50),this.renderDo()}createCanvas(t){null==this.m_canvas2D&&(this.m_canvas2D=document.createElement("canvas"),document.body.appendChild(this.m_canvas2D),this.m_canvas2D.style.display="bolck",this.m_canvas2D.style.left="0px",this.m_canvas2D.style.top="0px",this.m_canvas2D.style.position="absolute",this.m_canvas2D.style.backgroundColor="transparent",this.m_canvas2D.style.pointerEvents="none",this.m_canvas2D.height=this.m_height),t=t<10?10:t,this.m_canvas2D.width=t,this.m_ctx2D=this.m_canvas2D.getContext("2d"),this.m_ctx2D.font="50px Verdana",this.m_ctx2D.fillStyle="red",this.m_ctx2D.textAlign="left",this.m_width=this.m_canvas2D.width}getFPS(){return this.m_fps}getFPSStr(){return this.m_fps>60?"FPS: 60":this.m_fps<10?"FPS: 0"+this.m_fps:"FPS: "+this.m_fps}renderDo(){if(this.m_preWidth!=window.innerWidth){this.m_preWidth=window.innerWidth;let t=this.m_preWidth-20;this.createCanvas(t)}if(this.statusEnbled){this.m_ctx2D.clearRect(0,0,this.m_width,this.m_height);let t="";this.m_rsc&&""!=this.statusInfo&&(""!=t?t+="/"+this.statusInfo:t=this.statusInfo),this.m_ctx2D.fillText(this.getFPSStr()+t,5,50)}}updateDo(t=!0){if(this.m_delayTime>0)--this.m_delayTime,this.m_lastTime=Date.now();else{if(null!=this.m_ctx2D){let e=Date.now();this.m_lastTime>0&&(this.m_lastTime=e-this.m_lastTime,this.m_lastTime<1&&(this.m_lastTime=1),this.m_fps=Math.round(1e3/this.m_lastTime),t&&this.render()),this.m_lastTime=e}this.m_delayTime=this.delayTime}}render(){this.m_auto||this.renderDo()}update(t=!0){this.m_auto||this.updateDo(t)}}e.default=n},e594:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},e8b6:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=i("4ad2"),a=i("213f"),o=i("dca8"),l=i("dc4d"),u=32,h=8,c=`\n\t\t\t@group(0) @binding(0) var<uniform> grid: vec2f;\n\t\t\t@group(0) @binding(1) var<storage> cellStateIn: array<u32>;\n\t\t\t@group(0) @binding(2) var<storage, read_write> cellStateOut: array<u32>;\n\n\t\t\tfn cellIndex(cell: vec2u) -> u32 {\n\t\t\t\treturn cell.y * u32(grid.x) + cell.x;\n\t\t\t}\n\n\t\t\t@compute @workgroup_size(${h}, ${h})\n\t\t\tfn compMain(@builtin(global_invocation_id) cell: vec3u) {\n\t\t\t\tif (cellStateIn[cellIndex(cell.xy)] == 1) {\n\t\t\t\t\tcellStateOut[cellIndex(cell.xy)] = 0;\n\t\t\t\t} else {\n\t\t\t\t\tcellStateOut[cellIndex(cell.xy)] = 1;\n\t\t\t\t}\n\t\t\t}`;class d{constructor(){this.mRscene=new n.RendererScene,this.mouseDown=t=>{}}initialize(){this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(s.default.MOUSE_DOWN,this.mouseDown),(new a.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}createUniformValues(){const t=new Float32Array([u,u]),e=new Uint32Array(u*u);for(let o=0;o<e.length;o+=3)e[o]=1;const i=new Uint32Array(u*u);for(let o=0;o<i.length;o++)i[o]=o%2;let r=(new l.WGRBufferVisibility).toVisibleAll();const s={data:t,stride:2,visibility:r};r=(new l.WGRBufferVisibility).toVisibleVertComp();const n={storage:{data:e,stride:1,visibility:r}};r=(new l.WGRBufferVisibility).toVisibleComp().toBufferForStorage();const a={storage:{data:i,stride:1,visibility:r}};return[s,n,a]}initScene(){const t=this.mRscene;let e={code:c,uuid:"shader-computing"},i=this.createUniformValues(),r=new o.ComputeEntity({shaderSrc:e,uniformValues:i});t.addEntity(r)}run(){this.mRscene.run()}}e.ComputeEntityTest=d},e943:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("8895"),n=i("9e6d"),a=r(i("2c77"));class o{constructor(){}initialize(t,e){this.createTags(t,e)}createTags(t,e){let i=12,r=e.demoNames,s=10,n=10,a=r.length,o={x:0,y:10,width:0,height:0};for(let l=0;l<a;++l){let e=r[l];o=this.getTextSize(e,i+4);let a=s+o.x+o.width+10;a>512&&(n+=o.height+10,s=10),o.x=s,o.y=n,o.height-=4,this.createTag(t,l,i+"px",e,o),s=o.x+o.width+10}}createTag(t,e,i,r,o){let l=new a.default;l.randomRGB(.5,.2);let u=new s.ButtonDivItem,h=n.createDiv(o.x,o.y,o.width,o.height);t.appendChild(h),u.setDeselectColors([l.clone().scaleBy(.7).getRGBUint24(),l.clone().scaleBy(.8).getRGBUint24(),l.clone().getRGBUint24()]),u.initialize(h,r,r),u.setTextSize(i);let c=(new a.default).randomRGB(1,.4).clamp().ceil().clamp();u.setTextColor(c.getRGBUint24()),u.setTextAlign("center"),u.onmouseup=()=>{this.mana.gotoIndex(e),window.location.reload()}}getTextSize(t,e=20,i=0){if(null==t||""==t||e<8)return null;let r=e+4,s=e+6;t.length>1&&(r=e*t.length);let n=document.createElement("canvas");n.width=r,n.height=s,n.style.backgroundColor="transparent";let a=n.getContext("2d");a.font=e-4+"px Verdana",a.textBaseline="top";var o=a.measureText(t);let l=o.width;return(t.length>1||i>0)&&(r=Math.round(l+8),i>0&&r<i&&(r=i),n.width=r,a=n.getContext("2d"),a.font=e-4+"px Verdana",a.textBaseline="top"),{x:0,y:0,width:r,height:s}}}e.DemoTagGroup=o},e958:function(t,e,i){"use strict";i.r(e),e["default"]="@group(0) @binding(3) var<uniform> param: vec4f;\r\n@group(0) @binding(4) var mySampler: sampler;\r\n@group(0) @binding(5) var myTexture: texture_2d<f32>;\r\n\r\n@fragment\r\nfn main(\r\n  @location(0) fragUV: vec2<f32>,\r\n  @location(1) fragPosition: vec4<f32>\r\n) -> @location(0) vec4<f32> {\r\n\r\n  var color4 = textureSample(myTexture, mySampler, fragUV) * fragPosition * param;\r\n  color4 = vec4(color4.xyz, 1.0);\r\n  return color4;\r\n}\r\n"},ebca:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("e38f")),n=r(i("3e40")),a=r(i("348f")),o=r(i("98bb")),l=r(i("af80")),u=i("af1b");class h extends a.default{constructor(){super(),this.normalType=u.WGRNormalType.GOURAND}getVS(){return this.mvs}getUVS(){return this.muvs}getNVS(){return this.mnvs}getIVS(){return this.mivs}initialize(t,e,i,r=-.5){if(this.vtxTotal<1){t<.01&&(t=.01),i<2&&(i=2);let a=2,u=1,h=0,c=0,d=0,m=0,f=0;t=Math.abs(t),e=Math.abs(e);let p=r*e,v=new o.default(0,p,0,c);this.bounds=new n.default,this.bounds.min.setXYZ(-t,p,-t),this.bounds.max.setXYZ(t,p+e,t),this.bounds.updateFast();let g=[],b=[];b.push([]);let y=b[0];for(v.f=0,v.u=.5,v.v=.5,v.nx=0,v.ny=-1,v.nz=0,h=0;h<1;++h)v.index=c,++c,y.push(v.cloneVertex()),g.push(y[h]);f=p;let _=.499,x=new l.default(0,p+e,0),w=new l.default(0,p+e,0),S=new l.default(0,p+e,0);for(;u<a;++u){d=Math.PI*u/a,v.y=f,b.push([]);let e=b[u];for(h=0;h<i;++h)d=2*Math.PI*h/i,m=Math.sin(d),f=Math.cos(d),v.x=m*t,v.z=f*t,v.index=c,++c,m*=_,f*=_,v.u=.5+m,v.v=.5+f,v.f=0,w.copyFrom(x),S.setXYZ(v.x,v.y,v.z),S.subtractBy(w),S.normalize(),w.setXYZ(v.x,0,v.z),w.normalize(),w.addBy(S),w.normalize(),v.nx=w.x,v.ny=w.y,v.nz=w.z,e.push(v.cloneVertex()),g.push(e[h]);e.push(e[0])}b.push([]);let M=b[b.length-1],P=b[b.length-2];for(h=0;h<i;++h){let t=P[h].cloneVertex();t.f=1,M.push(t),M[h].index=c,++c,g.push(M[h]),t=P[h],t.nx=0,t.ny=-1,t.nz=0}M.push(M[0]),v.f=0,v.x=0,v.y=p+e,v.z=0,v.u=.5,v.v=.5,v.nx=0,v.ny=1,v.nz=0,b.push([]);let T,E=b[b.length-1];for(h=0;h<i;++h)v.index=c,++c,E.push(v.cloneVertex()),g.push(E[h]);E.push(E[0]);let C=[];for(u=1,a+=1;u<=a;++u){let t=b[u-1],e=b[u];for(h=1;h<=i;++h)1==u?(C.push(t[0].index),C.push(e[h].index),C.push(e[h-1].index)):u==a&&(C.push(t[h].index),C.push(e[h].index),C.push(t[h-1].index))}for(this.vtxTotal=g.length,this.mvs=new Float32Array(3*this.vtxTotal),u=0,h=0;h<this.vtxTotal;++h)T=g[h],this.mvs[u]=T.x,this.mvs[u+1]=T.y,this.mvs[u+2]=T.z,u+=3;for(null!=this.mTransMatrix&&(this.mTransMatrix.transformVectorsSelf(this.mvs,this.mvs.length),this.bounds.addFloat32Arr(this.mvs),this.bounds.updateFast()),this.mivs=new Uint16Array(C),this.muvs=new Float32Array(2*this.vtxTotal),u=0,h=0;h<this.vtxTotal;++h)T=g[h],this.muvs[u]=T.u,this.muvs[u+1]=T.v,u+=2;{this.mnvs=new Float32Array(3*this.vtxTotal);let t=this.mivs.length/3;if(0==this.normalType)s.default.ClacTrisNormal(this.mvs,this.mvs.length,t,this.mivs,this.mnvs);else for(u=0,h=0;h<this.vtxTotal;++h)T=g[h],this.mnvs[u]=T.nx,this.mnvs[u+1]=T.ny,this.mnvs[u+2]=T.nz,u+=3}this.vtCount=this.mivs.length,this.trisNumber=this.vtCount/3}}__$destroy(){this.mivs&&(this.bounds=null,this.mvs=null,this.muvs=null,this.mnvs=null,super.__$destroy())}}e.default=h},ec7b:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{static EuclideanModulo(t,e){return(t%e+e)%e}static Clamp(t,e,i){return Math.max(Math.min(t,i),e)}static IsPowerOf2(t){return 0==(t&t-1)}static CalcCeilPowerOfTwo(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}static CalcNearestCeilPow2(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}static CalcFloorCeilPow2(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}static DegreeToRadian(t){return r.MATH_PI_OVER_180*t}static Log2(t){return Math.log(t)/Math.LN2}static GetMaxMipMapLevel(t,e){return Math.round(r.Log2(Math.max(t,e))+1)}static ToDegree(t){return t*r.MATH_180_OVER_PI}static ToRadian(t){return t*r.MATH_PI_OVER_180}static SafeACos(t){return t<=-1?r.MATH_PI:t>=1?0:Math.acos(t)}static GetNearestCeilPow2(t){let e=1;while(e<t)e<<=1;return e}static GetMinRadian(t,e){return e%=r.MATH_2PI,t%=r.MATH_2PI,e<t?(e=r.MATH_2PI-t+e,e>r.MATH_PI?e-r.MATH_2PI:e):e>t?(t=r.MATH_2PI-e+t,t>r.MATH_PI?r.MATH_2PI-t:-t):0}static GetMinDegree(t,e){let i=0;return e>=270&&t<90?i=(e-(t+360))%180:e<=90&&t>=270?i=(e+360-t)%180:(i=e-t,i>180?(i-=360,i%=360):i<-180&&(i+=360,i%=360)),i}static GetDegreeByXY(t,e){if(Math.abs(t)<1e-5)return e>=0?270:90;let i=180*Math.atan(e/t)/Math.PI;return t>=0?i:180+i}static GetRadianByXY(t,e){if(Math.abs(t)<r.MATH_MIN_POSITIVE)return e>=0?r.MATH_1PER2PI:r.MATH_3PER2PI;let i=Math.atan(e/t);return t>=0?i:r.MATH_PI+i}static GetRadianByCos(t,e,i){var s=Math.acos(t);return e>=0?s:r.MATH_PI+s}}r.MATH_MIN_POSITIVE=1e-5,r.MATH_MAX_NEGATIVE=-1e-5,r.MATH_MAX_POSITIVE=268435454,r.MATH_MIN_NEGATIVE=-268435454,r.MATH_1_OVER_255=1/255,r.MATH_PI=Math.PI,r.MATH_2PI=2*r.MATH_PI,r.MATH_3PER2PI=1.5*r.MATH_PI,r.MATH_1PER2PI=.5*r.MATH_PI,r.MATH_1_OVER_PI=1/r.MATH_PI,r.MATH_1_OVER_360=1/360,r.MATH_1_OVER_180=1/180,r.MATH_180_OVER_PI=180/r.MATH_PI,r.MATH_PI_OVER_180=r.MATH_PI/180,r.MATH_LN2=.6931471805599453,e.default=r},ed04:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("f3f6")),a=r(i("7ce1")),o=i("943f"),l=i("746a"),u=i("551f"),h=i("cae9"),c=i("58c4"),d=r(i("af80"));class m{constructor(){this.geomData=new s.GeomDataBuilder,this.renderer=new h.WGRenderer,this.mRotY=0}initialize(){const t={vertShaderSrc:{code:n.default,uuid:"vertShdCode"},fragShaderSrc:{code:a.default,uuid:"fragShdCode"}};let e=this.createMaterial(t,[new c.WGImage2DTextureData("static/assets/box.jpg")],["solid"],"back");this.mEntity=this.createEntity([e])}createMaterial(t,e,i=[],r="back"){let s={depthWriteEnabled:!0,faceCullMode:r,blendModes:[]};s.blendModes=i;const n=e?e.length:0,a=new o.WGMaterial({shadinguuid:"base-material-tex"+n,shaderSrc:t,pipelineDefParam:s});return a.addTextureWithDatas(e),a}createEntity(t,e){const i=this.renderer,r=this.geomData.createSphere(150,30,30),s=(new l.WGGeometry).addAttribute({shdVarName:"position",data:r.vs,strides:[3]}).addAttribute({shdVarName:"uv",data:r.uvs,strides:[2]}).setIndexBuffer({name:"geomIndex",data:r.ivs}),n=new u.Entity3D;return n.materials=t,n.geometry=s,n.transform.setPosition(e||new d.default),i.addEntity(n),n}run(){this.mRotY+=.5,this.mEntity.transform.setRotationXYZ(0,this.mRotY,this.mRotY+.5),this.mEntity.update(),this.renderer.run()}}e.DefaultEntityTest=m},ede0:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("f537")),a=r(i("a3a5")),o=i("943f"),l=i("746a"),u=i("551f"),h=i("cae9");class c{constructor(){this.geomData=new s.GeomDataBuilder,this.renderer=new h.WGRenderer,this.mRotY=0}initialize(){const t={vert:{code:n.default,uuid:"vertShdCode"},frag:{code:a.default,uuid:"fragShdCode"}},e=this.createMaterial(t);this.mEntity=this.createEntity([e])}createMaterial(t,e,i=[],r="back"){let s={depthWriteEnabled:!0,faceCullMode:r,blendModes:[]};s.blendModes=i;const n=e?e.length:0,a=new o.WGMaterial({shadinguuid:"base-material-tex"+n,shaderSrc:t,pipelineDefParam:s});return a.addTextureWithDatas(e),a}createEntity(t){const e=this.renderer,i=this.geomData.createSphere(150,30,30),r=(new l.WGGeometry).addAttribute({shdVarName:"position",data:i.vs,strides:[3]}).addAttribute({shdVarName:"uv",data:i.uvs,strides:[2]}).setIndexBuffer({name:"geomIndex",data:i.ivs}),s=new u.Entity3D({geometry:r,materials:t});return e.addEntity(s),s}run(){this.mRotY+=.5,this.mEntity.transform.setRotationXYZ(0,this.mRotY,this.mRotY+.5),this.mEntity.update(),this.renderer.run()}}e.VertEntityTest=c},ee65:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=i("4ad2"),a=i("d463"),o=i("213f"),l=r(i("d36d")),u=r(i("df0d")),h=r(i("821b")),c=r(i("2c8d")),d=i("5118"),m={diffuse:{uuid:"colorRTT",rttTexture:{}}},f={diffuse:{uuid:"albedoRTT",rttTexture:{}}},p={diffuse:{uuid:"floatRTT",rttTexture:{},format:"rgba16float"}};class v{constructor(){this.mRscene=new n.RendererScene,this.mFlag=6,this.mouseDown=t=>{this.mFlag=1}}initialize(){let t=!0,e=!0,i={multisampleEnabled:t,depthTestEnabled:e};this.mRscene.initialize({rpassparam:i}),this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(s.default.MOUSE_DOWN,this.mouseDown),(new o.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}applyMRTPass(t){let e=this.mRscene;const i={texture:m,clearValue:[.15,.15,.15,1]},r={texture:f,clearValue:[.15,.25,.25,1]},s={texture:p,clearValue:[.2,.25,.2,1]},n=[i,r,s];let o=e.createRenderPass({separate:!0,colorAttachments:n});const v={diffuse:{url:"static/assets/huluwa.jpg",flipY:!0}};let g={vert:{code:u.default,uuid:"vertMRT"},frag:{code:h.default,uuid:"fragMRT"}},b=[{data:new Float32Array([1,1,1,1])}],y=new d.TorusEntity({shaderSrc:g,textures:[v],uniformValues:b});o.addEntity(y),t=[-.8,-.8,1.6,1.6];let _=new a.FixScreenPlaneEntity({extent:t,textures:[m]});e.addEntity(_),g={vert:{code:l.default,uuid:"vert"},frag:{code:c.default,uuid:"readNromal"}},t=[-.7,-.95,.6,.6],_=new a.FixScreenPlaneEntity({extent:t,textures:[p],shaderSrc:g,shadinguuid:"readNromal"}),e.addEntity(_),t=[.1,-.95,.6,.6],_=new a.FixScreenPlaneEntity({extent:t,textures:[f]}),e.addEntity(_)}initScene(){this.applyMRTPass([-1,-1,2,2])}run(){this.mRscene.run()}}e.MRT=v},f083:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){this.passes=null,this.cmdWrapper={rcommands:[]}}runBegin(){this.cmdWrapper.rcommands=[];const t=this.passes;if(null!=t)for(let e=0;e<t.length;++e)t[e].cmdWrapper=this.cmdWrapper}run(){}}e.WGRPassNodeGraph=r},f22d:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("551f");e.Entity3DParam=r.Entity3DParam,e.getUniformValueFromParam=r.getUniformValueFromParam;class s extends r.Entity3D{constructor(t){t=t||{transformEnabled:!1},t.transformEnabled=!1,super(t),this.cameraViewing=!1}update(){return this}}e.FixScreenEntity=s},f3f6:function(t,e,i){"use strict";i.r(e),e["default"]="\n@group(0) @binding(0) var<uniform> objMat : mat4x4<f32>;\n@group(0) @binding(1) var<uniform> viewMat : mat4x4<f32>;\n@group(0) @binding(2) var<uniform> projMat : mat4x4<f32>;\n\nstruct VertexOutput {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) fragUV : vec2<f32>,\n  @location(1) fragPosition: vec4<f32>,\n}\nfn invertedColor( color : vec4<f32>) -> vec4<f32> {\n   return vec4( 1.0 - color.rgb, color.a );\n}\n@vertex\nfn main(\n  @location(0) position : vec3<f32>,\n  @location(1) uv : vec2<f32>\n) -> VertexOutput {\n  var output : VertexOutput;\n  output.Position = projMat * viewMat * objMat * vec4(position.xyz, 1.0);\n  output.fragUV = uv;\n  var pv: vec4<f32>;\n  pv = 0.5 * (vec4<f32>(normalize(position.xyz) * 2.0, 1.0) + vec4<f32>(1.0, 1.0, 1.0, 1.0));\n  output.fragPosition = pv;\n  return output;\n}\n"},f522:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("af80")),n=r(i("541b"));class a extends n.default{constructor(){super(),this.m_longitudeNum=0,this.m_latitudeNum=0,this.uScale=1,this.vScale=1}clone(){let t=new a;return t.m_longitudeNum=this.m_longitudeNum,t.m_latitudeNum=this.m_latitudeNum,t.uScale=this.uScale,t.vScale=this.vScale,t.copyFrom(this),t}getCenterAt(t,e){if(t>=0&&t<=this.m_latitudeNum&&null!=this.mvs){e.setXYZ(0,0,0);let i=this.mvs,r=(t+1)*(this.m_longitudeNum+1)*3;for(t=t*(this.m_longitudeNum+1)*3,r-=3;t<r;t+=3)e.x+=i[t],e.y+=i[t+1],e.z+=i[t+2];e.scaleBy(1/this.m_longitudeNum)}}transformAt(t,e){if(t>=0&&t<=this.m_latitudeNum){const i=this.m_longitudeNum+1;let r=this.mvs,s=(t+1)*i*3;t=t*i*3,e.transformVectorsRangeSelf(r,t,s)}}getRangeAt(t,e=3){if(t>=0&&t<=this.m_latitudeNum){let i=(t+1)*(this.m_longitudeNum+1)*e;return t=t*(this.m_longitudeNum+1)*e,[t,i]}return[-1,-1]}getVSSegAt(t){if(t>=0&&t<=this.m_latitudeNum){const e=this.m_longitudeNum+1;let i=this.mvs,r=(t+1)*e*3;return t=t*e*3,i.subarray(t,r)}return null}initialize(t,e,i,r,n=1,a=-.5){let o=0,l=0;t<.01&&(t=.01),i<2&&(i=2),r<1&&(r=1),this.m_longitudeNum=i,this.m_latitudeNum=r;let u=Math.abs(t),h=Math.abs(e),c=0,d=0,m=0,f=a*h;this.bounds.min.setXYZ(-t,f,-t),this.bounds.max.setXYZ(t,f+h,t),this.bounds.updateFast();let p,v=new s.default,g=[],b=2*Math.PI;for(o=0;o<1;++o){for(l=0;l<i;++l)c=b*l/i,d=Math.sin(c),m=Math.cos(c),v.x=d*u,v.z=m*u,p=new s.default(v.x,v.y,v.z,1),g.push(p);g.push(g[0])}this.vtxTotal=(i+1)*(r+1),this.mvs=new Float32Array(3*this.vtxTotal),this.muvs=new Float32Array(2*this.vtxTotal);let y=r,_=0,x=0;for(o=0;o<=y;++o)for(d=o/y,m=f+h*d,l=0;l<=i;++l){n<1?(this.muvs[x++]=this.uScale*(l/i),this.muvs[x++]=this.uScale*d):(this.muvs[x++]=this.uScale*d,this.muvs[x++]=this.uScale*(l/i));const t=g[l];switch(this.axisType){case 1:this.mvs[_++]=t.x,this.mvs[_++]=m,this.mvs[_++]=t.z;break;case 2:this.mvs[_++]=t.z,this.mvs[_++]=t.x,this.mvs[_++]=m;break;default:this.mvs[_++]=m,this.mvs[_++]=t.z,this.mvs[_++]=t.x;break}}let w=i+1,S=0,M=0;const P=y*i*6;for(this.mivs=P<=56635?new Uint16Array(P):new Uint32Array(P),_=0,o=0;o<y;++o)for(S=o*w,M=(o+1)*w,l=1;l<=i;++l)this.mivs[_++]=S+l,this.mivs[_++]=M+l-1,this.mivs[_++]=S+l-1,this.mivs[_++]=S+l,this.mivs[_++]=M+l,this.mivs[_++]=M+l-1;this.vtCount=this.mivs.length,this.trisNumber=this.vtCount/3}}e.default=a},f537:function(t,e,i){"use strict";i.r(e),e["default"]="\r\n@group(0) @binding(0) var<uniform> objMat : mat4x4<f32>;\r\n@group(0) @binding(1) var<uniform> viewMat : mat4x4<f32>;\r\n@group(0) @binding(2) var<uniform> projMat : mat4x4<f32>;\r\n\r\nstruct VertexOutput {\r\n  @builtin(position) Position : vec4<f32>,\r\n  @location(0) fragUV : vec2<f32>,\r\n  @location(1) fragPosition: vec4<f32>,\r\n}\r\nfn invertedColor( color : vec4<f32>) -> vec4<f32> {\r\n   return vec4( 1.0 - color.rgb, color.a );\r\n}\r\n@vertex\r\nfn main(\r\n  @location(0) position : vec3<f32>,\r\n  @location(1) uv : vec2<f32>\r\n) -> VertexOutput {\r\n  var output : VertexOutput;\r\n  output.Position = projMat * viewMat * objMat * vec4(position.xyz, 1.0);\r\n  output.fragUV = uv;\r\n  var pv: vec4<f32>;\r\n  pv = 0.5 * (vec4<f32>(normalize(position.xyz) * 2.0, 1.0) + vec4<f32>(1.0, 1.0, 1.0, 1.0));\r\n  output.fragPosition = pv;\r\n  return output;\r\n}\r\n"},f5fb:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("ddc9");e.WGRPipelineContextDefParam=r.WGRPipelineContextDefParam;class s{constructor(){this.blockIndex=0}}function n(t){let e,i,r={alphaMode:"premultiplied"};t?(e=t.canvas,i=t.div,t.gpuCanvasCfg&&(r=t.gpuCanvasCfg)):t={canvas:null};let s=512,n=512;if(!i){i=document.createElement("div"),document.body.appendChild(i);const t=i.style;t.display="bolck",t.position="absolute",""==t.left&&(t.left="0px",t.top="0px"),i.style.width=s+"px",i.style.height=n+"px"}return e||(e=document.createElement("canvas"),e.width=s,e.height=n,i.appendChild(e)),t.canvas=e,t.div=i,t.gpuCanvasCfg=r,t}e.RPassInfoParam=s,e.checkConfig=n},f5ff:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=r(i("e537"));class a{constructor(){this.m_evtNodes=null,this.m_evtNodesLen=24,this.uuid="",this.data=null,this.currentTarget=null,this.enabled=!0,this.m_evtNodesLen=s.default.GetMouseEvtTypeValuesTotal(),this.m_evtNodes=new Array(this.m_evtNodesLen)}getClassType(){return s.default.EventClassType}destroy(){for(let t=0;t<this.m_evtNodesLen;++t)null!=this.m_evtNodes[t]&&this.m_evtNodes[t].destroy();this.data=null,this.currentTarget=null}dispatchEvt(t){if(this.enabled&&null!=t){""!=this.uuid&&(t.uuid=this.uuid),null!=this.data&&(t.data=this.data),null!=this.currentTarget&&(t.currentTarget=this.currentTarget);let e=t.type-s.default.GetMouseEvtTypeValueBase();if(e>=0&&e<s.default.GetMouseEvtTypeValuesTotal()&&null!=this.m_evtNodes[e])return this.m_evtNodes[e].dispatch(t)}return 0}passTestEvt(t){if(null!=t){let e=t.type-s.default.GetMouseEvtTypeValueBase();if(e>=0&&e<s.default.GetMouseEvtTypeValuesTotal())return this.m_evtNodes[e].passTestEvt(t)}return 0}passTestPhase(t){let e=s.default.GetMouseEvtTypeValuesTotal();for(let i=0;i<e;++i)if(null!=this.m_evtNodes[i]&&1==this.m_evtNodes[i].passTestPhase(t))return 1;return 0}addEventListener(t,e,i=!0,r=!1){if(e){let a=t-s.default.GetMouseEvtTypeValueBase();if(a>=0&&a<s.default.GetMouseEvtTypeValuesTotal()){let t=0;i!=r&&(t=i?1:2),null!=this.m_evtNodes[a]||(this.m_evtNodes[a]=new n.default),this.m_evtNodes[a].addListener(e,t)}}}removeEventListener(t,e){if(e){let i=t-s.default.GetMouseEvtTypeValueBase();i>=0&&i<s.default.GetMouseEvtTypeValuesTotal()&&null!=this.m_evtNodes[i]&&this.m_evtNodes[i].removeListener(e)}}}e.default=a},f73a:function(t,e,i){"use strict";i.r(e),e["default"]="\r\n@group(0) @binding(0) var<uniform> objMat : mat4x4<f32>;\r\n@group(0) @binding(1) var<uniform> viewMat : mat4x4<f32>;\r\n@group(0) @binding(2) var<uniform> projMat : mat4x4<f32>;\r\n\r\n@group(0) @binding(3) var<uniform> grid: vec2f;\r\n@group(0) @binding(4) var<storage> cellState: array<u32>;\r\n@group(0) @binding(5) var<storage> lifeState: array<f32>;\r\n@group(0) @binding(6) var<storage> wpositions: array<vec4f>;\r\n\r\nstruct VertexInput {\r\n\t@location(0) pos: vec3f,\r\n  \t@location(1) uv : vec2f,\r\n\t@builtin(instance_index) instance: u32\r\n};\r\n\r\nstruct VertexOutput {\r\n\t@builtin(position) pos: vec4f,\r\n\t@location(0) cell: vec2f,\r\n\t@location(1) uv: vec2f,\r\n\t@location(2) factor: f32,\r\n};\r\nconst scales = array<f32, 2>(0.1, 0.5);\r\n@vertex\r\nfn vertMain(input: VertexInput) -> VertexOutput {\r\n\r\n\tlet i = input.instance;\r\n    // var state = f32(cellState[i]);\r\n\r\n\tlet f = clamp((lifeState[ input.instance ])/100.0, 0.0005, 1.0);\r\n\tvar baseScale = scales[ cellState[i] ];\r\n\r\n\r\n    var wpos = objMat * vec4f(input.pos.xyz * (f * 0.5 + baseScale), 1.0);\r\n\twpos = vec4f(wpos.xyz + wpositions[ input.instance ].xyz, wpos.w);\r\n\r\n    let fi = f32(i);\r\n    let cell = vec2f(fi % grid.x, floor(fi / grid.x));\r\n\r\n\r\n    var output: VertexOutput;\r\n\r\n    var projPos = projMat * viewMat * wpos;\r\n\t// if(state < 1.0) {\r\n\t// \tprojPos = vec4f(projPos.xyz, -1.0);\r\n\t// }\r\n    output.pos = projPos;\r\n\r\n    output.cell = cell;\r\n    output.uv = input.uv;\r\n\r\n    output.factor = f;\r\n    return output;\r\n}\r\n\r\n@fragment\r\nfn fragMain(input: VertexOutput) -> @location(0) vec4f {\r\n    let c = input.cell / grid;\r\n\tvar dis = length(input.uv - vec2<f32>(0.5, 0.5));\r\n\tdis = min(dis/0.51, 1.0);\r\n\tlet f = input.factor;\r\n\tdis = (1.0 - pow(dis, 50.0)) * (1.0 - f) + f;\r\n\tvar c3 = vec3f(c, (1.0 - c.x) * (1.0 - f) + f) * dis;\r\n    return vec4f(c3, 1.0);\r\n}"},f78a:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("4ad2"),n=i("d463"),a=r(i("d36d")),o=r(i("87b6"));class l{constructor(){this.mRscene=new s.RendererScene,this.mColorV={data:new Float32Array([1,.1,.2,1])},this.mParamsV={storage:{data:new Float32Array(12),stride:4,version:0}},this.mTime=0}initialize(){this.initScene()}initScene(){const t=this.mRscene,e=this.mParamsV.storage.data;e.set([1,1,1,1]),e.set([.5,.5,512,512],4);let i={vert:{code:a.default,uuid:"vert"},frag:{code:o.default,uuid:"frag"}},r=[this.mColorV,this.mParamsV],s=new n.FixScreenPlaneEntity({shaderSrc:i,uniformValues:r});t.addEntity(s)}run(){let t=this.mParamsV.storage.data;t[8]+=.01,t[4]=.5*Math.cos(this.mTime)+.5,this.mTime+=.01,this.mParamsV.storage.version++,this.mRscene.run()}}e.ScreenPostEffect=l},f937:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t){this.x=0,this.y=0,this.width=100,this.height=100,this.setExtent(t)}clone(){return new r(this)}setXYWH(t,e,i,r){return this.x=t,this.y=e,this.width=i,this.height=r,this}setExtent(t){let e=t;if(e){const t=this,i=e;if(void 0!==i.length){const e=i.length;e>0&&(t.x=i[0]),e>1&&(t.y=i[1]),e>2&&(t.height=i[2]),e>3&&(t.width=i[3])}else{const i=e;void 0!==i.x&&(t.x=i.x),void 0!==i.y&&(t.y=i.y),void 0!==i.width&&(t.width=i.width),void 0!==i.height&&(t.height=i.height)}}return this}fromArray4(t,e=0){return this.x=t[e],this.y=t[e+1],this.width=t[e+2],this.height=t[e+3],this}toArray4(t,e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.width,t[e+3]=this.height,this}getArray4(){let t=new Array(4);return this.toArray4(t),t}getArray3(){let t=new Array(3);return this.toArray3(t),t}fromArray3(t,e=0){return this.x=t[e],this.y=t[e+1],this.width=t[e+2],this}toArray3(t,e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.width,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}scaleBy(t){return this.x*=t,this.y*=t,this.width*=t,this.height*=t,this}update(){}}e.default=r},fa6e:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("af80")),n=r(i("a229")),a=r(i("0540")),o=r(i("9243")),l=r(i("4255")),u=r(i("bd36"));class h{constructor(t){t&&this.initialize(t)}initialize(t){this.mWGCtx=t}createTorus(t,e=20,i=20,r=20){let s,n,a=new u.default;a.setBufSortFormat(268435455),a.initialize(t,e,i,r);let o=a.getVS(),l=a.getUVS(),h=a.getNVS(),c=a.getIVS(),d=o.length/3,m=this.mWGCtx?this.mWGCtx.buffer.createVertexBuffer(o,0,[3]):null,f=this.mWGCtx?this.mWGCtx.buffer.createVertexBuffer(l,0,[l.length/d]):null;s=[m,f],n=this.mWGCtx?this.mWGCtx.buffer.createIndexBuffer(c):null;const p={vertex:{buffers:s,attributeIndicesArray:[[0],[0]]}};return{ivs:c,vs:o,uvs:l,nvs:h,vbufs:s,ibuf:n,vtxDescParam:p,bounds:a.bounds}}createCylinder(t,e=200,i=20,r=20){let s,n,a=new l.default;a.setBufSortFormat(268435455),a.initialize(t,e,i,r);let o=a.getVS(),u=a.getUVS(),h=a.getNVS(),c=a.getIVS(),d=o.length/3,m=this.mWGCtx?this.mWGCtx.buffer.createVertexBuffer(o,0,[3]):null,f=this.mWGCtx?this.mWGCtx.buffer.createVertexBuffer(u,0,[u.length/d]):null;s=[m,f],n=this.mWGCtx?this.mWGCtx.buffer.createIndexBuffer(c):null;const p={vertex:{buffers:s,attributeIndicesArray:[[0],[0]]}};return{ivs:c,vs:o,uvs:u,nvs:h,vbufs:s,ibuf:n,vtxDescParam:p,bounds:a.bounds}}createSphere(t,e=20,i=20){let r,s,n=new o.default;n.setBufSortFormat(268435455),n.initialize(t,e,i,!1);let a=n.getVS(),l=n.getUVS(),u=n.getNVS(),h=n.getIVS(),c=a.length/3,d=this.mWGCtx?this.mWGCtx.buffer.createVertexBuffer(a,0,[3]):null,m=this.mWGCtx?this.mWGCtx.buffer.createVertexBuffer(l,0,[l.length/c]):null;r=[d,m],s=this.mWGCtx?this.mWGCtx.buffer.createIndexBuffer(h):null;const f={vertex:{buffers:r,attributeIndicesArray:[[0],[0]]}};return{ivs:h,vs:a,uvs:l,nvs:u,vbufs:r,ibuf:s,vtxDescParam:f,bounds:n.bounds}}createCube(t){t*=.5;let e=new s.default(-t,-t,-t),i=e.clone().scaleBy(-1);return this.createBox(e,i)}createBox(t,e){let i,r,s=new n.default;s.setBufSortFormat(268435455),s.initialize(t,e);let a=s.getVS(),o=s.getUVS(),l=s.getNVS(),u=s.getIVS(),h=a.length/3,c=this.mWGCtx?this.mWGCtx.buffer.createVertexBuffer(a,0,[3]):null,d=this.mWGCtx?this.mWGCtx.buffer.createVertexBuffer(o,0,[o.length/h]):null;i=[c,d],r=this.mWGCtx?this.mWGCtx.buffer.createIndexBuffer(u):null;const m={vertex:{buffers:i,attributeIndicesArray:[[0],[0]]}};return{ivs:u,vs:a,uvs:o,nvs:l,vbufs:i,ibuf:r,vtxDescParam:m,bounds:s.bounds}}createSquare(t,e=0){return this.createRect(-.5*t,-.5*t,t,t,e)}createRect(t,e,i,r,s=0){let n,o,l=new a.default;l.axisType=s,l.setBufSortFormat(268435455),l.initialize(t,e,i,r);let u=l.getVS(),h=l.getUVS(),c=l.getNVS(),d=l.getIVS(),m=this.mWGCtx?this.mWGCtx.buffer.createVertexBuffer(u,0,[3]):null,f=this.mWGCtx?this.mWGCtx.buffer.createVertexBuffer(h,0,[2]):null;n=[m,f],o=this.mWGCtx?this.mWGCtx.buffer.createIndexBuffer(d):null;const p={vertex:{buffers:n,attributeIndicesArray:[[0],[0]]}};return{ivs:d,vs:u,uvs:h,nvs:c,vbufs:n,ibuf:o,vtxDescParam:p,bounds:l.bounds}}}e.GeomDataBuilder=h},fa7f:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=i("560a");class s extends r.PackedLoader{constructor(t,e=null,i=null){super(t,e,i)}loadData(t){let e=new XMLHttpRequest;e.open("GET",t,!0),e.onerror=function(t){},e.onload=i=>{this.loadedData(e.response,t),this.loadedUrl(t)},e.send(null)}loadedData(t,e){let i=document.createElement("script");i.onerror=t=>{},i.type="text/javascript";try{i.innerHTML=t,document.head.appendChild(i)}catch(r){throw r}}}e.ModuleLoader=s},fae3:function(t,e,i){"use strict";i.r(e);i("1eb2");var r=i("b6ed");for(var s in r)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return r[t]}))}(s)},fba9:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(i("c69e")),n=i("4ad2"),a=i("213f"),o=(r(i("2c77")),i("9849"),i("5009"),i("76e3"),i("0069"),i("5118"),i("7e70"),i("97f2"),i("603e")),l=i("c29f");class u{constructor(){this.mRscene=new n.RendererScene,this.mouseDown=t=>{}}initialize(){this.initEvent(),this.initScene()}initEvent(){const t=this.mRscene;t.addEventListener(s.default.MOUSE_DOWN,this.mouseDown),(new a.MouseInteraction).initialize(t,0,!1).setAutoRunning(!0)}initScene(){const t=this.mRscene;let e=new o.AxisEntity;t.addEntity(e);let i="static/assets/obj/monkey.obj",r=new l.ModelEntity({modelUrl:i,transform:{scale:[100,100,100],position:[0,0,200]}});t.addEntity(r)}run(){this.mRscene.run()}}e.ModelEntityTest=u},fd5e:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=i("fa6e"),n=r(i("4ca8")),a=r(i("993b")),o=i("943f"),l=i("746a"),u=i("551f"),h=i("cae9");class c{constructor(){this.geomData=new s.GeomDataBuilder,this.renderer=new h.WGRenderer}initialize(){const t=this.renderer,e=this.geomData.createCube(200),i={vert:{code:n.default},frag:{code:a.default}},r=[new o.WGMaterial({shadinguuid:"shapeMaterial",shaderSrc:i})],s=(new l.WGGeometry).addAttribute({position:e.vs}).setIndices(e.ivs);t.addEntity(new u.Entity3D({geometry:s,materials:r}))}run(){this.renderer.run()}}e.VertColorCube=c},fe0b:function(t,e,i){"use strict";function r(t,e){for(var i in t)void 0!=t[i]&&(e[i]=t[i])}function s(t){return t>65536?new Uint32Array(t):new Uint16Array(t)}function n(t){return t.length>65536?new Uint32Array(t):new Uint16Array(t)}function a(t,e){return Math.floor(Math.log2(Math.max(t,e)))+1}Object.defineProperty(e,"__esModule",{value:!0}),e.copyFromObjectValueWithKey=r,e.createIndexArrayWithSize=s,e.createIndexArray=n,e.calculateMipLevels=a;const o=function(){const t=new Float32Array(1),e=new Int32Array(t.buffer);return function(i){t[0]=i;let r=e[0],s=r>>16&32768,n=r>>12&2047,a=r>>23&255;return a<103?s:a>142?(s|=31744,s|=(255==a?0:1)&&8388607&r,s):a<113?(n|=2048,s|=(n>>114-a)+(n>>113-a&1),s):(s|=a-112<<10|n>>1,s+=1&n,s)}}();e.toFloat16=o}})}));