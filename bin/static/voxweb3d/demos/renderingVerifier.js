(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["CoSpace"]=e():t["CoSpace"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s="fae3")}({"0063":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static decodeText(t){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,r=t.length;i<r;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(s){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}static resolveURL(t,e){return"string"!==typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}e.LoaderUtils=i},"0236":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("a996")),a=i(s("1710")),n=i(s("7045")),h=i(s("badb"));class l{constructor(t,e){this.m_rcuid=0,this.pixelRatio=1,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.m_viewX=0,this.m_viewY=0,this.m_viewW=1,this.m_viewH=1,this.m_mouseEvtDispatcher=new h.default,this.m_resize_listener=[],this.m_resize_ers=[],this.m_enterFrame_listener=[],this.m_enterFrame_ers=[],this.m_keyDown_listener=[],this.m_keyDown_ers=[],this.m_keyUp_listener=[],this.m_keyUp_ers=[],this.m_preStageWidth=0,this.m_preStageHeight=0,this.m_mouseEvt=new a.default,this.m_autoSynViewAndStageSize=!0,this.uProbe=null,this.m_enterFrameEvt=new r.default,this.m_rcuid=t}getRCUid(){return this.m_rcuid}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.m_viewX}getViewY(){return this.m_viewY}getViewWidth(){return this.m_viewW}getViewHeight(){return this.m_viewH}setViewPort(t,e,s,i){this.m_autoSynViewAndStageSize=!1,this.m_viewX=t,this.m_viewY=e,s==this.m_viewW&&i==this.m_viewH||(this.m_viewW=s,this.m_viewH=i,this.updateViewUData())}updateViewUData(){this.uProbe.setVec4Data(2/(this.m_viewW*this.pixelRatio),2/(this.m_viewH*this.pixelRatio),this.m_viewW*this.pixelRatio,this.m_viewH*this.pixelRatio),this.uProbe.update(),this.m_preStageWidth=this.m_viewW,this.m_preStageHeight=this.m_viewH}update(){this.m_preStageWidth==this.stageWidth&&this.m_preStageHeight==this.stageHeight||(this.m_autoSynViewAndStageSize&&(this.m_viewW=this.stageWidth,this.m_viewH=this.stageHeight,this.updateViewUData()),this.stageHalfWidth=.5*this.stageWidth,this.stageHalfHeight=.5*this.stageHeight)}mouseDown(t=1){this.m_mouseEvt.type=a.default.MOUSE_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseUp(t=1){this.m_mouseEvt.phase=1,this.m_mouseEvt.type=a.default.MOUSE_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseClick(){this.m_mouseEvt.type=a.default.MOUSE_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseDoubleClick(){this.m_mouseEvt.type=a.default.MOUSE_DOUBLE_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightDown(t=1){this.m_mouseEvt.type=a.default.MOUSE_RIGHT_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightUp(t=1){this.m_mouseEvt.type=a.default.MOUSE_RIGHT_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseBgDown(){this.m_mouseEvt.type=a.default.MOUSE_BG_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseBgUp(){this.m_mouseEvt.type=a.default.MOUSE_BG_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseBgClick(){this.m_mouseEvt.type=a.default.MOUSE_BG_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightClick(){this.m_mouseEvt.type=a.default.MOUSE_RIGHT_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMove(){this.m_mouseEvt.type=a.default.MOUSE_MOVE,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseWheel(t){this.m_mouseEvt.type=a.default.MOUSE_WHEEL,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.wheelDeltaY=t.wheelDeltaY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseCancel(){this.m_mouseEvt.type=a.default.MOUSE_CANCEL,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiDown(t){this.m_mouseEvt.type=a.default.MOUSE_MULTI_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiUp(t){this.m_mouseEvt.type=a.default.MOUSE_MULTI_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiMove(t){this.m_mouseEvt.type=a.default.MOUSE_MULTI_MOVE,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseWindowUp(t=1){}mouseWindowRightUp(t=1){}enterFrame(){this.m_enterFrameEvt.type=r.default.ENTER_FRAME;let t=this.m_enterFrame_listener.length;for(var e=0;e<t;++e)this.m_enterFrame_listener[e].call(this.m_enterFrame_ers[e],this.m_enterFrameEvt)}addEventListener(t,e,s,i=!0,a=!0){if(null!=s&&null!=e){let h=0;switch(t){case r.default.RESIZE:break;case r.default.ENTER_FRAME:for(h=this.m_enterFrame_listener.length-1;h>=0;--h)if(e===this.m_enterFrame_ers[h])break;h<0&&(this.m_enterFrame_ers.push(e),this.m_enterFrame_listener.push(s));break;case n.default.KEY_DOWN:break;case n.default.KEY_UP:break;default:this.m_mouseEvtDispatcher.addEventListener(t,e,s,i,a);break}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=0;switch(t){case r.default.RESIZE:for(i=this.m_resize_listener.length-1;i>=0;--i)if(e===this.m_resize_ers[i]){this.m_resize_ers.splice(i,1),this.m_resize_listener.splice(i,1);break}break;case r.default.ENTER_FRAME:for(i=this.m_enterFrame_listener.length-1;i>=0;--i)if(e===this.m_enterFrame_ers[i]){this.m_enterFrame_ers.splice(i,1),this.m_enterFrame_listener.splice(i,1);break}break;case n.default.KEY_DOWN:for(i=this.m_keyDown_listener.length-1;i>=0;--i)if(e===this.m_keyDown_ers[i]){this.m_keyDown_ers.splice(i,1),this.m_keyDown_listener.splice(i,1);break}break;case n.default.KEY_UP:for(i=this.m_keyUp_listener.length-1;i>=0;--i)if(e===this.m_keyUp_ers[i]){this.m_keyUp_ers.splice(i,1),this.m_keyUp_listener.splice(i,1);break}break;default:this.m_mouseEvtDispatcher.removeEventListener(t,e,s);break}}}}e.default=l},"026b":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("0795"),r=s("f689"),a=s("f689"),n=s("937b"),h=s("9259"),l=s("8b17");class o{constructor(){this.m_loader=new i.FileLoader,this.m_parseOnLoad=null,this.m_parseIndex=0,this.m_url="",this.m_tidGeom=-1,this.m_tidBin=-1}load(t,e,s=null,i=null){this.m_loader.load(t,(t,s)=>{let i=new Map,r=this.parseGeometry(t,s);for(let[e,a]of r)i.set(e,a.toGeometryModel());null!=e&&e(i,s)},s,(t,e)=>{null!=i&&i(t,e)})}parseGeometry(t,e){let s;if(a.isFbxFormatBinary(t))this.m_binParser=new n.BufferBinaryParser,s=this.m_binParser.parse(t);else{const e=r.convertArrayBufferToString(t);if(!r.isFbxFormatASCII(e))throw new Error("FBXBufferLoader: Unknown format.");if(r.getFbxVersion(e)<7e3)throw new Error("FBXBufferLoader: FBX version not supported, FileVersion: "+r.getFbxVersion(e));s=(new h.TextParser).parse(e)}return this.m_fbxTreeBufParser=new l.FBXTreeBufferParser,this.m_fbxTreeBufParser.parse(s,this.m_binParser.getReader())}loadBySteps(t,e,s=null,i=null){null==this.m_fbxTreeBufParser&&this.m_loader.load(t,(t,s)=>{this.m_parseOnLoad=e,this.m_parseIndex=0,this.m_url=s,this.parseGeometryBySteps(t,s)},s,(t,e)=>{null!=i&&i(t,e)})}updateGeomParse(){let t=50;if(this.m_tidGeom>-1&&clearTimeout(this.m_tidGeom),null!=this.m_fbxTreeBufParser&&this.m_fbxTreeBufParser.isParsing()){this.m_fbxTreeBufParser.getGeomBufId();let e=this.m_fbxTreeBufParser.parseGeomBufNext();this.m_parseIndex++;let s=this.m_fbxTreeBufParser.getParseTotal(),i=this.m_parseOnLoad;this.m_parseIndex<this.m_fbxTreeBufParser.getParseTotal()?this.m_tidGeom=setTimeout(this.updateGeomParse.bind(this),t):(this.m_parseOnLoad=null,this.m_fbxTreeBufParser=null),i(e.toGeometryModel(),e,this.m_parseIndex-1,s,this.m_url)}}startupParseGeom(){this.m_tidGeom=setTimeout(this.updateGeomParse.bind(this),30)}parseModelAt(t){}updateBinParse(){this.m_tidBin>-1&&clearTimeout(this.m_tidBin);let t=20;null!=this.m_binParser&&(this.m_binParser.parseNext(),this.m_binParser.isParsing()?this.m_tidBin=setTimeout(this.updateBinParse.bind(this),t):(this.m_fbxTreeBufParser=new l.FBXTreeBufferParser,this.m_fbxTreeBufParser.parseBegin(this.m_binParser.getFBXTree(),this.m_binParser.getReader()),null!=this.m_fbxTreeBufParser&&this.startupParseGeom(),this.m_binParser=null))}parseGeometryBySteps(t,e){let s;if(a.isFbxFormatBinary(t))this.m_binParser=new n.BufferBinaryParser,this.m_binParser.parseBegin(t),this.m_tidBin=setTimeout(this.updateBinParse.bind(this),18);else{const e=r.convertArrayBufferToString(t);if(!r.isFbxFormatASCII(e))throw new Error("FBXBufferLoader: Unknown format.");if(r.getFbxVersion(e)<7e3)throw new Error("FBXBufferLoader: FBX version not supported, FileVersion: "+r.getFbxVersion(e));s=(new h.TextParser).parse(e),this.m_fbxTreeBufParser=new l.FBXTreeBufferParser,this.m_fbxTreeBufParser.parseBegin(s,null)}}}e.FBXBufferLoader=o},"030e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Initialize(t,e){let s=this;1==t?(s.OES_standard_derivatives=e.getExtension("OES_standard_derivatives"),s.OES_standard_derivatives,s.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),s.EXT_shader_texture_lod,s.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),s.WEBGL_draw_buffers,s.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),s.OES_vertex_array_object,s.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),s.ANGLE_instanced_arrays,s.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),s.EXT_color_buffer_float,s.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),s.EXT_color_buffer_half_float,s.OES_texture_half_float=e.getExtension("OES_texture_half_float"),s.OES_texture_half_float,s.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),s.OES_texture_half_float_linear,s.OES_texture_float=e.getExtension("OES_texture_float"),s.OES_texture_float,s.OES_element_index_uint=e.getExtension("OES_element_index_uint"),s.OES_element_index_uint,s.EXT_blend_minmax=e.getExtension("EXT_blend_minmax"),s.EXT_blend_minmax):(s.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),s.EXT_shader_texture_lod,s.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),s.EXT_color_buffer_half_float,s.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),s.OES_texture_half_float_linear,s.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),s.EXT_color_buffer_float),s.OES_texture_float_linear=e.getExtension("OES_texture_float_linear"),s.OES_texture_float_linear,s.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),s.WEBGL_depth_texture,s.WEBGL_debug_renderer_info=e.getExtension("WEBGL_debug_renderer_info"),s.WEBGL_debug_renderer_info}}i.OES_standard_derivatives=null,i.EXT_shader_texture_lod=null,i.WEBGL_draw_buffers=null,i.OES_vertex_array_object=null,i.ANGLE_instanced_arrays=null,i.EXT_color_buffer_float=null,i.EXT_color_buffer_half_float=null,i.OES_texture_float_linear=null,i.OES_texture_half_float_linear=null,i.OES_texture_half_float=null,i.OES_texture_float=null,i.OES_element_index_uint=null,i.EXT_blend_minmax=null,i.WEBGL_depth_texture=null,i.WEBGL_debug_renderer_info=null,e.default=i},"0644":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("2139"));class h{constructor(){this.m_matrix=n.default.GetMatrix(),this.m_position=new a.default,this.m_direction=new a.default,this.m_angle=0,this.m_updateEnabled=!1,this.m_camera=null}destroy(){this.m_camera=null}bindCamera(t){this.m_camera=t,null!=t&&(this.m_direction.copyFrom(this.m_camera.getPosition()),this.m_direction.subtractBy(this.m_camera.getLookAtPosition()))}update(){null!=this.m_camera&&this.m_updateEnabled&&(this.m_updateEnabled=!1)}rotationOffsetAngleWorldY(t){this.m_angle=t,this.m_updateEnabled=!0,this.m_direction.copyFrom(this.m_camera.getPosition()),this.m_direction.subtractBy(this.m_camera.getLookAtPosition()),this.m_matrix.identity(),this.m_matrix.appendRotationY(this.m_angle*r.default.MATH_PI_OVER_180),this.m_position.copyFrom(this.m_direction),this.m_matrix.transformVectorSelf(this.m_position),this.m_position.addBy(this.m_camera.getLookAtPosition()),this.m_camera.lookAtRH(this.m_position,this.m_camera.getLookAtPosition(),a.default.Y_AXIS)}rotationOffsetAngleWordX(t){this.m_angle=t,this.m_updateEnabled=!0,this.m_direction.copyFrom(this.m_camera.getPosition()),this.m_direction.subtractBy(this.m_camera.getLookAtPosition()),this.m_matrix.identity(),this.m_matrix.appendRotationX(this.m_angle*r.default.MATH_PI_OVER_180),this.m_position.copyFrom(this.m_direction),this.m_matrix.transformVectorSelf(this.m_position),this.m_position.addBy(this.m_camera.getLookAtPosition()),this.m_camera.lookAtRH(this.m_position,this.m_camera.getLookAtPosition(),a.default.X_AXIS)}rotationOffsetAngleWordZ(t){this.m_angle=t,this.m_updateEnabled=!0,this.m_direction.copyFrom(this.m_camera.getPosition()),this.m_direction.subtractBy(this.m_camera.getLookAtPosition()),this.m_matrix.identity(),this.m_matrix.appendRotationZ(this.m_angle*r.default.MATH_PI_OVER_180),this.m_position.copyFrom(this.m_direction),this.m_matrix.transformVectorSelf(this.m_position),this.m_position.addBy(this.m_camera.getLookAtPosition()),this.m_camera.lookAtRH(this.m_position,this.m_camera.getLookAtPosition(),a.default.Z_AXIS)}}e.default=h},"070b":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,s,r){this.m_uid=-1,this.m_rBoo=!0,this.m_gBoo=!0,this.m_bBoo=!0,this.m_aBoo=!0,this.m_uid=i.s_uid++,this.m_rBoo=t,this.m_gBoo=e,this.m_bBoo=s,this.m_aBoo=r}getUid(){return this.m_uid}getR(){return this.m_rBoo}getG(){return this.m_gBoo}getB(){return this.m_bBoo}getA(){return this.m_aBoo}use(){i.s_state!=this.m_uid&&(i.Rstate.setColorMask(this.m_rBoo,this.m_gBoo,this.m_bBoo,this.m_aBoo),i.s_state=this.m_uid)}static Create(t,e,s,r,a){if(i.s_stsNameMap.has(t)){let e=i.s_stsNameMap.get(t);return e.getUid()}let n=(e?64:32)|(s?16:8)|(r?4:2)|(a?1:0);if(i.s_stsMap.has(n)){let t=i.s_stsMap.get(n);n=t.getUid()}else{let h=new i(e,s,r,a);n=h.getUid(),i.s_stsMap.set(n,h),i.s_stsNameMap.set(t,h),i.s_states.push(h),++i.s_statesLen}return n}static GetColorMaskByName(t){if(i.s_stsNameMap.has(t)){let e=i.s_stsNameMap.get(t);return e.getUid()}return-1}static UseRenderState(t){i.s_unlocked&&i.Rstate.roColorMask!=t&&t>-1&&t<i.s_statesLen&&i.s_states[t].use()}static UseColorMaskByName(t){let e=i.GetColorMaskByName(t);i.s_unlocked&&i.Rstate.roColorMask!=e&&e>-1&&e<i.s_statesLen&&i.s_states[e].use()}static Lock(){i.s_unlocked=!1}static Unlock(){i.s_unlocked=!0}static Reset(){i.s_state=-1}}i.s_uid=0,i.s_state=-1,i.s_states=[],i.s_statesLen=1,i.s_stsMap=new Map,i.s_stsNameMap=new Map,i.s_unlocked=!0,i.ALL_TRUE_COLOR_MASK=0,i.ALL_FALSE_COLOR_MASK=1,i.Rstate=null,e.RenderColorMask=i},"0795":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.crossOrigin="anonymous"}setCrossOrigin(t){this.crossOrigin=t}async load(t,e,s=null,i=null,r="blob",a=""){if(null==e)throw Error("onload == null !!!");const n=new FileReader;n.onload=s=>{null!=e&&e(n.result,t)};const h=new XMLHttpRequest;h.open("GET",t,!0),""!=a&&h.setRequestHeader("Range",a),h.responseType=r,h.onload=e=>{h.status<=206?n.readAsArrayBuffer(h.response):null!=i&&i(h.status,t)},null!=s&&(h.onprogress=e=>{s(e,t)}),null!=i&&(h.onerror=e=>{i(h.status,t)}),h.send(null)}}e.FileLoader=i},"0817":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("a401");class r{constructor(t,e,s=i.ModuleFileType.JS){this.url=t,this.name=e,this.type=s}}e.TaskCodeModuleParam=r},"0851":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=i(s("8d98")),n=i(s("ffc0")),h=i(s("1f61")),l=i(s("5deb")),o=i(s("6e01")),_=i(s("da6a"));class m{constructor(t,e,s=!1){this.m_uid=-1,this.m_attachCount=0,this.m_renderProxy=null,this.m_slot=null,this.m_miplevel=-1,this.m_texWidth=128,this.m_texHeight=128,this.m_texBufW=128,this.m_texBufH=128,this.m_texTarget=l.default.TEXTURE_2D,this.m_sampler=-1,this.m_haveRData=!1,this.m_type=r.TextureProxyType.Default,this.m_generateMipmap=!0,this.name="TextureProxy",this.internalFormat=n.default.RGBA,this.srcFormat=n.default.RGBA,this.dataType=h.default.UNSIGNED_BYTE,this.wrap_s=a.default.WRAP_CLAMP_TO_EDGE,this.wrap_t=a.default.WRAP_CLAMP_TO_EDGE,this.wrap_r=a.default.WRAP_CLAMP_TO_EDGE,this.mipmapEnabled=!1,this.flipY=!1,this.premultiplyAlpha=!1,this.unpackAlignment=4,this.minFilter=a.default.LINEAR_MIPMAP_LINEAR,this.magFilter=a.default.LINEAR,this.version=0,this.m_slot=_.default.GetInstance(),this.m_uid=this.m_slot.getFreeUid(),t<1&&(t=128),e<1&&(e=128),s?(this.m_texWidth=o.default.CalcNearestCeilPow2(t),this.m_texHeight=o.default.CalcNearestCeilPow2(e)):(this.m_texWidth=t,this.m_texHeight=e),this.m_slot.__$$addTexture(this)}__$$use(t){t.bindToGpu(this.getResUid())}__$setRenderProxy(t){null!=this.m_slot||(this.m_slot=_.default.GetInstance(),this.m_uid=this.m_slot.getFreeUid(),this.m_slot.__$$addTexture(this)),this.m_renderProxy=t}__$attachThis(){-1==this.m_attachCount&&(this.m_slot.removeFreeUid(this.getUid()),this.m_attachCount=0),++this.m_attachCount}__$detachThis(){this.m_attachCount>0&&(--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=-1,this.m_slot.addFreeUid(this.getUid())))}getAttachCount(){return this.m_attachCount}isDirect(){return!0}getType(){return this.m_type}getResUid(){return this.m_uid}getUid(){return this.m_uid}setWrap(t){this.wrap_s=this.wrap_t=this.wrap_r=t}isGpuEnabled(){return null!=this.m_renderProxy&&this.m_renderProxy.Texture.hasResUid(this.getResUid())}getSampler(){return this.m_sampler}getTargetType(){return this.m_texTarget}getBufWidth(){return this.m_texBufW}getBufHeight(){return this.m_texBufH}getWidth(){return this.m_texWidth}getHeight(){return this.m_texHeight}isDataEnough(){return this.m_haveRData}uploadFromFbo(t,e,s){throw Error("Illegal operation !!!")}__$buildParam(t){this.m_texBufW=this.m_texWidth,this.m_texBufH=this.m_texHeight,t.texParameteri(this.m_sampler,t.TEXTURE_WRAP_S,a.default.GetConst(t,this.wrap_s)),t.texParameteri(this.m_sampler,t.TEXTURE_WRAP_T,a.default.GetConst(t,this.wrap_t)),t.texParameteri(this.m_sampler,t.TEXTURE_MIN_FILTER,a.default.GetConst(t,this.minFilter)),t.texParameteri(this.m_sampler,t.TEXTURE_MAG_FILTER,a.default.GetConst(t,this.magFilter)),this.m_texTarget==l.default.TEXTURE_3D&&(t.texParameteri(this.m_sampler,t.TEXTURE_WRAP_R,a.default.GetConst(t,this.wrap_r)),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_BASE_LEVEL,0),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MAX_LEVEL,Math.log2(this.m_texWidth))),this.mipmapEnabled&&this.m_generateMipmap&&t.generateMipmap(this.m_sampler)}enableMipmap(){}disableMipmap(){}generateMipmap(t){if(this.mipmapEnabled&&this.m_generateMipmap){let e=t.getRC();t.bindToGpu(this.getResUid()),this.__$buildParam(e)}}uploadData(t){}__$updateToGpu(t){}updateDataToGpu(t=null,e=!0){null!=t&&(this.m_renderProxy=t),null!=this.m_renderProxy&&this.m_renderProxy.MaterialUpdater.updateTextureData(this,e)}createTexBuf(t){return!t.hasResUid(this.getResUid())&&(this.m_sampler=l.default.GetValue(t.getRC(),this.m_texTarget),t.createResByParams3(this.getResUid(),this.getWidth(),this.getHeight(),this.m_sampler),!0)}__$$upload(t){if(this.m_haveRData&&null!=this.m_slot){let e=this.createTexBuf(t);e&&(this.__$updateToGpuBegin(t),this.uploadData(t),this.__$buildParam(t.getRC()),this.m_generateMipmap=!0)}}dataUploadToGpu(t,e,s,i=!1){this.version=0;let r=n.default.ToGL(t,this.internalFormat),a=n.default.ToGL(t,this.srcFormat),l=h.default.ToGL(t,this.dataType),o=e;if(null==s)(o.status>-1||i)&&o.updateToGpu(t,this.m_sampler,r,a,l,i);else{let e=s;for(let s=0,n=e.length;s<n;++s)o=e[s],null!=o&&(o.status>-1||i)&&o.updateToGpu(t,this.m_sampler,r,a,l,i);this.m_generateMipmap=!1}}__$updateToGpuBegin(t){let e=t.getRC();t.bindToGpu(this.getResUid()),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,this.unpackAlignment)}__$updateToGpuEnd(t){}isDestroyed(){return this.m_attachCount<-1}__$destroy(){this.getAttachCount()<1&&(this.m_attachCount=-2,this.m_haveRData=!1,this.m_texWidth=1,this.m_texHeight=1,this.m_renderProxy=null)}__$$removeFromSlot(){null!=this.m_slot&&-2==this.getAttachCount()&&(this.m_slot=null,this.m_renderProxy=null,this.m_uid=-1)}toString(){return"[TextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.TextureProxy=m,e.default=m},"0890":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("1710")),a=s("bcac");class n{constructor(){this.m_stage3D=null,this.m_dragSwinger=new a.CameraDragSwinger,this.m_enabled=!0}setAutoRotationEnabled(t){this.m_dragSwinger.autoRotationEnabled=t}initialize(t,e,s=!0){null==this.m_stage3D&&(this.m_stage3D=t,this.m_dragSwinger.initialize(t,e),s?t.addEventListener(r.default.MOUSE_BG_DOWN,this,this.mouseDownListener,!0,!1):t.addEventListener(r.default.MOUSE_DOWN,this,this.mouseDownListener,!0,!1),t.addEventListener(r.default.MOUSE_UP,this,this.mouseUpListener,!0,!0))}mouseDownListener(t){this.m_enabled&&this.m_dragSwinger.attach()}mouseUpListener(t){this.m_dragSwinger.detach()}setEnabled(t){this.m_enabled=t}detach(){this.m_dragSwinger.detach()}runWithYAxis(){this.m_dragSwinger.runWithYAxis()}runWithZAxis(){this.m_dragSwinger.runWithZAxis()}runWithCameraAxis(){this.m_dragSwinger.runWithCameraAxis()}}e.default=n},"08aa":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.demoName="",this.threadsTotal=3,this.demoType="",this.hostUrl="",this.m_urls=null}initialize(){let t=window.location.href,e=t.indexOf("?");if(e>0){this.hostUrl=t.slice(0,e);let s=t.slice(e+1);if(this.initParam(s),""!=this.demoType)switch(this.demoType){case"fbx":this.iniFBXDemo();break;case"ctm":this.initCTMDemo();break;default:break}}}getUrls(){return this.m_urls}initParam(t){if(t.indexOf("&")>0){let e=t.split("&");for(let t=0;t<e.length;++t){const s=e[t].split("=");switch(s[0]){case"rvdemo":this.demoName=s[1];break;case"thrn":let t=parseInt(s[1]);isNaN(t)&&(t=1),t<1?t=1:t>3&&(t=3),this.threadsTotal=t;break;case"demoType":this.demoType=s[1];break;default:break}}}}iniFBXDemo(){let t="static/private/fbx/"+this.demoName+".fbx";this.m_urls=[t]}initCTMDemo(){let t=this.demoName,e="static/private/ctm/",s=[];for(let i=0;i<=26;++i)s.push(e+t+"/"+t+"_"+i+".ctm");this.m_urls=s}}e.VerifierParam=i},"090c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("030e")),a=i(s("3b73")),n=i(s("b0ef")),h=i(s("0c85")),l=s("e08e"),o=i(s("e2fe"));class _{constructor(){this.m_mouseEvtDisplather=new h.default,this.m_div=null,this.m_canvas=null,this.m_scissorEnabled=!1,this.m_depthTestEnabled=!0,this.m_stencilTestEnabled=!0,this.m_offcanvas=null,this.m_gl=null,this.m_stage=null,this.m_viewPortRect=new o.default(0,0,800,600),this.m_maxWebGLVersion=2,this.m_webGLVersion=2,this.m_devicePixelRatio=1,this.m_viewEle=new n.default,this.autoSyncRenderBufferAndWindowSize=!0,this.offscreenRenderEnabled=!1,this.m_WEBGL_lose_context=null,this.m_displayWidth=0,this.m_displayHeight=0,this.m_rcanvasWidth=0,this.m_rcanvasHeight=0,this.m_resizeCallback=null,this.m_resizeCallbackTarget=null}contextrestoredHandler(t){}contextlostHandler(t){}setWebGLMaxVersion(t){1!=t&&2!=t||(this.m_maxWebGLVersion=t)}getWebGLVersion(){return this.m_webGLVersion}getDiv(){return this.m_div}setDivStyleLeftAndTop(t,e){this.m_viewEle.setDivStyleLeftAndTop(t,e)}setDivStyleSize(t,e){this.m_viewEle.setDivStyleSize(t,e)}getCanvas(){return this.m_canvas}isDepthTestEnabled(){return this.m_depthTestEnabled}isStencilTestEnabled(){return this.m_stencilTestEnabled}initialize(t,e,s,i=null){this.m_stage=e;var n=null,h=null;try{void 0!=document&&(n=document,h=window)}catch(_){}if(null!=n){this.m_viewEle.setDiv(s),this.m_viewEle.createViewEle(n,this.autoSyncRenderBufferAndWindowSize),this.m_div=s=this.m_viewEle.getDiv();let _=this.m_canvas=this.m_viewEle.getCanvas();this.m_devicePixelRatio=window.devicePixelRatio,this.m_mouseEvtDisplather.dpr=this.m_devicePixelRatio;let m=i;null==i?m={depth:this.m_depthTestEnabled,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:this.m_stencilTestEnabled,preserveDrawingBuffer:!0,powerPreference:"default"}:(this.m_depthTestEnabled=m.depth,this.m_stencilTestEnabled=m.stencil);let u=null;if(this.offscreenRenderEnabled&&(u=_.transferControlToOffscreen()),this.m_offcanvas=u,2==this.m_maxWebGLVersion&&(this.m_gl=null==u?_.getContext("webgl2",m):u.getContext("webgl2",m),null!=this.m_gl&&(this.m_webGLVersion=2)),null==this.m_gl&&(this.m_gl=null==u?_.getContext("webgl",m)||_.getContext("experimental-webgl",m):u.getContext("webgl",m)||u.getContext("experimental-webgl",m),null!=this.m_gl&&(this.m_webGLVersion=1)),!this.m_gl)throw this.m_webGLVersion=-1,alert("Unable to initialize WebGL. Your browser or machine may not support it."),Error("WebGL initialization failure.");let d=this.m_gl;d.rcuid=t;let c=l.GLStencilFunc;c.NEVER=d.NEVER,c.LESS=d.LESS,c.EQUAL=d.EQUAL,c.GREATER=d.GREATER,c.NOTEQUAL=d.NOTEQUAL,c.GEQUAL=d.GEQUAL,c.ALWAYS=d.ALWAYS;let f=l.GLStencilOp;f.KEEP=d.KEEP,f.ZERO=d.ZERO,f.REPLACE=d.REPLACE,f.INCR=d.INCR,f.INCR_WRAP=d.INCR_WRAP,f.DECR=d.DECR,f.DECR_WRAP=d.DECR_WRAP,f.INVERT=d.INVERT;let p=l.GLBlendMode;p.ZERO=d.ZERO,p.ONE=d.ONE,p.SRC_COLOR=d.SRC_COLOR,p.DST_COLOR=d.DST_COLOR,p.SRC_ALPHA=d.SRC_ALPHA,p.DST_ALPHA=d.DST_ALPHA,p.ONE_MINUS_SRC_ALPHA=d.ONE_MINUS_SRC_ALPHA;let g=l.GLBlendEquation;g.FUNC_ADD=d.FUNC_ADD,g.FUNC_SUBTRACT=d.FUNC_SUBTRACT,g.FUNC_REVERSE_SUBTRACT=d.FUNC_REVERSE_SUBTRACT,g.MIN_EXT=d.MIN_EXT,g.MAX_EXT=d.MAX_EXT,g.MIN=d.MIN,g.MAX=d.MAX;let T=l.CullFaceMode;T.BACK=d.BACK,T.FRONT=d.FRONT,T.FRONT_AND_BACK=d.FRONT_AND_BACK;let y=a.default;y.MAX_TEXTURE_SIZE=this.m_gl.getParameter(this.m_gl.MAX_TEXTURE_SIZE),y.MAX_RENDERBUFFER_SIZE=this.m_gl.getParameter(this.m_gl.MAX_RENDERBUFFER_SIZE);let E=this.m_gl.getParameter(this.m_gl.MAX_VIEWPORT_DIMS);y.MAX_VIEWPORT_WIDTH=E[0],y.MAX_VIEWPORT_HEIGHT=E[1],r.default.Initialize(this.m_webGLVersion,this.m_gl),a.default.Initialize([this.m_webGLVersion]),null!=e&&this.m_mouseEvtDisplather.initialize(_,s,e);let x=r.default.WEBGL_debug_renderer_info;if(null!=x){let t=this.m_gl.getParameter(x.UNMASKED_VENDOR_WEBGL),e=this.m_gl.getParameter(x.UNMASKED_RENDERER_WEBGL);y.GPU_VENDOR=t,y.GPU_RENDERER=e,a.default.IsWinExternalVideoCard()}var o=this;h.onresize=function(t){o.autoSyncRenderBufferAndWindowSize&&o.updateRenderBufferSize()},_.addEventListener("webglcontextrestored",this.contextrestoredHandler,!1),_.addEventListener("webglcontextlost",this.contextlostHandler,!1),this.updateRenderBufferSize()}}loseContext(){null==this.m_WEBGL_lose_context&&(this.m_WEBGL_lose_context=this.m_gl.getExtension("WEBGL_lose_context")),null==this.m_WEBGL_lose_context&&this.m_WEBGL_lose_context.loseContext()}isContextLost(){return this.m_gl.isContextLost()}getRC(){return this.m_gl}setScissorEnabled(t){t?this.m_scissorEnabled||(this.m_scissorEnabled=!0,this.m_gl.enable(this.m_gl.SCISSOR_TEST)):this.m_scissorEnabled&&(this.m_scissorEnabled=!1,this.m_gl.disable(this.m_gl.SCISSOR_TEST))}setScissorRect(t,e,s,i){this.m_gl.scissor(t,e,s,i)}setResizeCallback(t,e){this.m_resizeCallbackTarget=t,this.m_resizeCallback=e}getDevicePixelRatio(){return this.m_devicePixelRatio}resizeBufferSize(t,e){t=Math.floor(t),e=Math.floor(e);let s=window.devicePixelRatio,i=Math.abs(s-this.m_devicePixelRatio)>.02;this.m_devicePixelRatio=s,this.m_mouseEvtDisplather.dpr=s,a.default.SetDevicePixelRatio(this.m_devicePixelRatio),(this.m_displayWidth!=t||this.m_displayHeight!=e||i)&&(this.m_displayWidth=t,this.m_displayHeight=e,this.m_rcanvasWidth=Math.floor(t*s),this.m_rcanvasHeight=Math.floor(e*s),null==this.m_offcanvas?(this.m_canvas.width=this.m_rcanvasWidth,this.m_canvas.height=this.m_rcanvasHeight):(this.m_offcanvas.width=this.m_rcanvasWidth,this.m_offcanvas.height=this.m_rcanvasHeight),this.m_canvas.style.width=this.m_displayWidth+"px",this.m_canvas.style.height=this.m_displayHeight+"px",null!=this.m_stage&&(this.m_stage.stageWidth=this.m_rcanvasWidth,this.m_stage.stageHeight=this.m_rcanvasHeight,this.m_stage.viewWidth=this.m_displayWidth,this.m_stage.viewHeight=this.m_displayHeight,this.m_stage.pixelRatio=s,this.m_stage.update()),null!=this.m_resizeCallback&&this.m_resizeCallback.call(this.m_resizeCallbackTarget))}getStage(){return this.m_stage}getStageWidth(){return this.m_stage.stageWidth}getStageHeight(){return this.m_stage.stageHeight}getDisplayWidth(){return this.m_displayWidth}getDisplayHeight(){return this.m_displayHeight}setViewport(t,e,s,i){this.m_viewPortRect.setTo(t,e,s,i)}setViewportSize(t,e){this.m_viewPortRect.setSize(t,e)}testViewPortChanged(t,e,s,i){return this.m_viewPortRect.testEqualWithParams(t,e,s,i)}getViewportX(){return this.m_viewPortRect.x}getViewportY(){return this.m_viewPortRect.y}getViewportWidth(){return this.m_viewPortRect.width}getViewportHeight(){return this.m_viewPortRect.height}getViewPortSize(){return this.m_viewPortRect}getFBOWidth(){return this.m_viewPortRect.width<a.default.MAX_RENDERBUFFER_SIZE?this.m_viewPortRect.width:a.default.MAX_RENDERBUFFER_SIZE}getFBOHeight(){return this.m_viewPortRect.height<a.default.MAX_RENDERBUFFER_SIZE?this.m_viewPortRect.height:a.default.MAX_RENDERBUFFER_SIZE}getRCanvasWidth(){return this.m_rcanvasWidth}getRCanvasHeight(){return this.m_rcanvasHeight}updateRenderBufferSize(){let t=this.m_div.getBoundingClientRect();this.resizeBufferSize(t.width,t.height)}}e.default=_},"0929":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("2139")),n=i(s("9156"));class h{constructor(){this.m_uid=0,this.m_fs32=new Float32Array(16),this.m_invMatEnabled=!1,this.m_rotFlag=!1,this.updatedStatus=h.UPDATE_POSITION,this.updateStatus=h.UPDATE_TRANSFORM,this.m_omat=null,this.m_localMat=null,this.m_parentMat=null,this.m_toParentMat=null,this.m_toParentMatFlag=!0,this.m_invOmat=null,this.m_uid=h.s_uid++}getUid(){return this.m_uid}getRotationFlag(){return this.m_rotFlag}getX(){return this.m_fs32[12]}getY(){return this.m_fs32[13]}getZ(){return this.m_fs32[14]}setX(t){this.updateStatus|=1,this.updatedStatus|=1,this.m_fs32[12]=t}setY(t){this.updateStatus|=1,this.updatedStatus|=1,this.m_fs32[13]=t}setZ(t){this.updateStatus|=1,this.updatedStatus|=1,this.m_fs32[14]=t}setXYZ(t,e,s){this.m_fs32[12]=t,this.m_fs32[13]=e,this.m_fs32[14]=s,this.updateStatus|=1,this.updatedStatus|=1}offsetPosition(t){this.m_fs32[12]+=t.x,this.m_fs32[13]+=t.y,this.m_fs32[14]+=t.z,this.updateStatus|=1,this.updatedStatus|=1}setPosition(t){this.m_fs32[12]=t.x,this.m_fs32[13]=t.y,this.m_fs32[14]=t.z,this.updateStatus|=1,this.updatedStatus|=1}getPosition(t){t.x=this.m_fs32[12],t.y=this.m_fs32[13],t.z=this.m_fs32[14]}copyPositionFrom(t){null!=t&&(this.m_fs32[12]=t.m_fs32[12],this.m_fs32[13]=t.m_fs32[13],this.m_fs32[14]=t.m_fs32[14],this.updateStatus|=h.UPDATE_POSITION,this.updatedStatus|=h.UPDATE_POSITION)}getRotationX(){return this.m_fs32[1]}getRotationY(){return this.m_fs32[6]}getRotationZ(){return this.m_fs32[9]}setRotationX(t){this.m_fs32[1]=t,this.m_rotFlag=!0,this.updateStatus|=h.UPDATE_ROTATION,this.updatedStatus|=h.UPDATE_ROTATION}setRotationY(t){this.m_fs32[6]=t,this.m_rotFlag=!0,this.updateStatus|=h.UPDATE_ROTATION,this.updatedStatus|=h.UPDATE_ROTATION}setRotationZ(t){this.m_fs32[9]=t,this.m_rotFlag=!0,this.updateStatus|=h.UPDATE_ROTATION,this.updatedStatus|=h.UPDATE_ROTATION}setRotationXYZ(t,e,s){this.m_fs32[1]=t,this.m_fs32[6]=e,this.m_fs32[9]=s,this.updateStatus|=h.UPDATE_ROTATION,this.updatedStatus|=h.UPDATE_ROTATION,this.m_rotFlag=!0}getScaleX(){return this.m_fs32[0]}getScaleY(){return this.m_fs32[5]}getScaleZ(){return this.m_fs32[10]}setScaleX(t){this.m_fs32[0]=t,this.updateStatus|=h.UPDATE_SCALE,this.updatedStatus|=h.UPDATE_SCALE}setScaleY(t){this.m_fs32[5]=t,this.updateStatus|=h.UPDATE_SCALE,this.updatedStatus|=h.UPDATE_SCALE}setScaleZ(t){this.m_fs32[10]=t,this.updateStatus|=h.UPDATE_SCALE,this.updatedStatus|=h.UPDATE_SCALE}setScaleXYZ(t,e,s){this.m_fs32[0]=t,this.m_fs32[5]=e,this.m_fs32[10]=s,this.updateStatus|=h.UPDATE_SCALE,this.updatedStatus|=h.UPDATE_SCALE}setScale(t){this.m_fs32[0]=t,this.m_fs32[5]=t,this.m_fs32[10]=t,this.updateStatus|=h.UPDATE_SCALE,this.updatedStatus|=h.UPDATE_SCALE}getRotationXYZ(t){t.x=this.m_fs32[1],t.y=this.m_fs32[6],t.z=this.m_fs32[9]}getScaleXYZ(t){t.x=this.m_fs32[0],t.y=this.m_fs32[5],t.z=this.m_fs32[10]}localToGlobal(t){this.getMatrix().transformVectorSelf(t)}globalToLocal(t){this.getInvMatrix().transformVectorSelf(t)}getInvMatrix(){return null!=this.m_invOmat?this.m_invMatEnabled&&(this.m_invOmat.copyFrom(this.m_omat),this.m_invOmat.invert()):(this.m_invOmat=a.default.GetMatrix(),this.m_invOmat.copyFrom(this.m_omat),this.m_invOmat.invert()),this.m_invMatEnabled=!1,this.m_invOmat}getLocalMatrix(){return this.updateStatus>0&&this.update(),this.m_localMat}getMatrix(t=!0){return this.updateStatus>0&&t&&this.update(),this.m_omat}getToParentMatrix(){return null!=this.m_toParentMat?this.m_toParentMat:this.m_omat}setParentMatrix(t){this.m_parentMat=t,this.m_invMatEnabled=!0,null!=this.m_parentMat&&(this.m_localMat==this.m_omat?(this.updateStatus=h.UPDATE_TRANSFORM,this.updatedStatus=this.updateStatus,this.m_localMat=a.default.GetMatrix()):(this.updateStatus|=h.UPDATE_PARENT_MAT,this.updatedStatus=this.updateStatus))}getParentMatrix(){return this.m_parentMat}updateMatrixData(t){null!=t&&(this.updateStatus=h.UPDATE_NONE,this.m_invMatEnabled=!0,this.m_omat.copyFrom(t))}__$setMatrix(t){null!=t&&(this.updateStatus=h.UPDATE_NONE,this.m_invMatEnabled=!0,this.m_localMat==this.m_omat&&(this.m_localMat=t),null!=this.m_omat&&(n.default.RemoveTransUniform(this.m_omat),a.default.RetrieveMatrix(this.m_omat)),this.m_omat=t)}destroy(){null!=this.m_invOmat&&a.default.RetrieveMatrix(this.m_invOmat),null!=this.m_localMat&&(this.m_omat==this.m_localMat&&n.default.RemoveTransUniform(this.m_omat),a.default.RetrieveMatrix(this.m_localMat)),null!=this.m_omat&&this.m_omat!=this.m_localMat&&(n.default.RemoveTransUniform(this.m_omat),a.default.RetrieveMatrix(this.m_omat)),this.m_invOmat=null,this.m_localMat=null,this.m_omat=null,this.m_parentMat=null,this.updateStatus=h.UPDATE_TRANSFORM}copyFrom(t){this.m_fs32.set(t.m_fs32,0),this.updatedStatus|=1,this.updateStatus|=h.UPDATE_TRANSFORM,this.m_rotFlag=t.m_rotFlag}update(){this.updateStatus>0&&(this.m_invMatEnabled=!0,this.updateStatus=this.updateStatus|this.updatedStatus,(this.updateStatus&h.UPDATE_TRANSFORM)>0&&(this.m_localMat.getLocalFS32().set(this.m_fs32,0),this.m_rotFlag&&this.m_localMat.setRotationEulerAngle(this.m_fs32[1]*r.default.MATH_PI_OVER_180,this.m_fs32[6]*r.default.MATH_PI_OVER_180,this.m_fs32[9]*r.default.MATH_PI_OVER_180),null!=this.m_parentMat&&(this.updateStatus=this.updateStatus|h.UPDATE_PARENT_MAT)),this.m_omat!=this.m_localMat&&this.m_omat.copyFrom(this.m_localMat),(this.updateStatus&h.UPDATE_PARENT_MAT)==h.UPDATE_PARENT_MAT&&(null!=this.m_toParentMat||(this.m_toParentMat=a.default.GetMatrix()),this.m_toParentMat.copyFrom(this.m_omat),this.m_toParentMatFlag=!0,this.m_omat.append(this.m_parentMat)),this.updateStatus=h.UPDATE_NONE)}getMatrixFS32(){return this.getMatrix().getLocalFS32()}toString(){return"[ROTransform(uid = "+this.m_uid+")]"}static GetFreeId(){return h.m_freeIdList.length>0?h.m_freeIdList.pop():-1}static Create(t=null){let e=null,s=h.GetFreeId();return s>=0?(e=h.m_unitList[s],h.m_unitFlagList[s]=h.s_FLAG_BUSY):(e=new h,h.m_unitList.push(e),h.m_unitFlagList.push(h.s_FLAG_BUSY),h.m_unitListLen++),e.m_omat=null==t?a.default.GetMatrix():t,e.m_localMat=e.m_omat,e.m_fs32.set(h.s_initData,0),e}static Restore(t){if(null!=t&&h.m_unitFlagList[t.getUid()]==h.s_FLAG_BUSY){let e=t.getUid();h.m_freeIdList.push(e),h.m_unitFlagList[e]=h.s_FLAG_FREE,t.destroy()}}}h.s_uid=0,h.s_initData=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),h.UPDATE_NONE=0,h.UPDATE_POSITION=1,h.UPDATE_ROTATION=2,h.UPDATE_SCALE=4,h.UPDATE_TRANSFORM=7,h.UPDATE_PARENT_MAT=8,h.s_FLAG_BUSY=1,h.s_FLAG_FREE=0,h.m_unitFlagList=[],h.m_unitListLen=0,h.m_unitList=[],h.m_freeIdList=[],e.default=h},"0c85":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73"));class a{constructor(){this.m_singleDown=!1,this.m_mouseX=0,this.m_mouseY=0,this.m_mouseClickTime=0,this.dpr=1}initMobile(t,e,s){var i=null;try{void 0!=document&&(i=document)}catch(a){}if(null!=i){let t=this;if(e.addEventListener("touchstart",t=>{let e=t.targetTouches,i=0,r=0;if(e.length<2)i=0|this.dpr*t.targetTouches[0].pageX,r=0|this.dpr*t.targetTouches[0].pageY,s.mouseX=i,s.mouseY=s.stageHeight-r,s.mouseViewX=i,s.mouseViewY=r,this.m_singleDown=!0,this.m_mouseX=s.mouseX,this.m_mouseY=s.mouseY,this.m_mouseClickTime=Date.now(),s.mouseDown(1);else{let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiDown(a),this.m_singleDown=!1}t.preventDefault(),t.stopPropagation()},!1),e.addEventListener("touchend",t=>{this.m_singleDown=!1;let e=t.targetTouches,i=0,r=0;if(e.length<1)s.mouseUp(1),this.m_mouseClickTime=Date.now()-this.m_mouseClickTime,Math.abs(this.m_mouseX-s.mouseX)<3&&Math.abs(this.m_mouseY-s.mouseY)<3&&this.m_mouseClickTime<900&&(this.m_mouseX=s.mouseX,this.m_mouseY=s.mouseY,s.mouseClick());else{let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiUp(a)}t.preventDefault()},!1),e.addEventListener("touchcancel",e=>{t.m_singleDown=!1;e.targetTouches;s.mouseCancel(),e.preventDefault()},!1),e.addEventListener("touchmove",t=>{t.preventDefault();let e=t.targetTouches,i=0,r=0;if(this.m_singleDown&&(i=0|this.dpr*e[0].pageX,r=0|this.dpr*e[0].pageY,s.mouseViewX=i,s.mouseViewY=r,s.mouseX=i,s.mouseY=s.stageHeight-r,s.mouseMove()),e.length>1){let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiMove(a)}},{passive:!1},!1),r.default.IsIpadOS()){let t=document.createElement("meta");t.name="viewport",t.content="width=device-width,initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no",document.getElementsByTagName("head")[0].appendChild(t)}}}initialize(t,e,s){r.default.IsMobileWeb()||r.default.IsIpadOS()||this.initPC(t,e,s),this.initMobile(t,e,s)}initPC(t,e,s){var i=null;try{void 0!=document&&(i=document)}catch(r){}if(null!=i){if(void 0==t.onmousewheel&&void 0!=t.addEventListener){let e=function(t){t.wheelDeltaY=-t.detail,s.mouseWheel(t)};t.addEventListener("DOMMouseScroll",e,!1)}t.onmousewheel=t=>{t.preventDefault(),t.stopPropagation(),s.mouseWheel(t)},t.onmousedown=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,this.m_mouseX=s.mouseX,this.m_mouseY=s.mouseY,this.m_mouseClickTime=Date.now(),0==t.button?s.mouseDown(1):2==t.button&&s.mouseRightDown(1)},t.onmouseup=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,0==t.button?s.mouseUp(1):2==t.button&&s.mouseRightUp(1)},document.onmouseup=t=>{0==t.button?s.mouseWindowUp(1):2==t.button&&s.mouseWindowRightUp(1)},t.onmousemove=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,s.mouseMove()},t.onclick=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,this.m_mouseClickTime=Date.now()-this.m_mouseClickTime,Math.abs(this.m_mouseX-s.mouseX)<3&&Math.abs(this.m_mouseY-s.mouseY)<3&&this.m_mouseClickTime<900&&(this.m_mouseX=s.mouseX,this.m_mouseY=s.mouseY,0==t.button?s.mouseClick():2==t.button&&s.mouseRightClick())},t.ondblclick=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,0==t.button?s.mouseDoubleClick():t.button}}}}e.default=a},"0e01":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("baae")),a=i(s("29ef")),n=i(s("7499")),h=s("de9d");class l{constructor(){this.camera=null,this.stage=null,this.builder=null,this.vtxBuilder=null,this.uniformContext=null,this.shaderProgramBuilder=null}}e.RendererInstanceContextParam=l;class o{constructor(t){this.m_adapter=null,this.m_renderProxy=null,this.m_materialProxy=null,this.m_cameraNear=.1,this.m_cameraFar=5e3,this.m_cameraFov=45,this.m_rcuid=0,this.m_rcuid=t,this.m_renderProxy=new h.RenderProxy(t)}getRCUid(){return this.m_rcuid}getDiv(){return this.m_adapter.getDiv()}getCanvas(){return this.m_adapter.getCanvas()}getRenderAdapter(){return this.m_adapter}getRenderMaterialProxy(){return this.m_materialProxy}getRenderProxy(){return this.m_renderProxy}getTextureResTotal(){return this.m_renderProxy.Texture.getTextureResTotal()}getTextureAttachTotal(){return this.m_renderProxy.Texture.getAttachTotal()}getDevicePixelRatio(){return this.m_adapter.getDevicePixelRatio()}getStage3D(){return this.m_renderProxy.getStage3D()}getCamera(){return null!=this.m_renderProxy?this.m_renderProxy.getCamera():null}cameraLock(){this.m_renderProxy.cameraLock()}cameraUnlock(){this.m_renderProxy.cameraUnlock()}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}updateCameraDataFromCamera(t){null!=this.m_renderProxy&&this.m_renderProxy.updateCameraDataFromCamera(t)}lockRenderColorMask(){null!=this.m_renderProxy&&this.m_renderProxy.lockRenderColorMask()}unlockRendererColorMask(){null!=this.m_renderProxy&&this.m_renderProxy.unlockRenderState()}useGlobalRenderColorMask(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderColorMask(),this.m_renderProxy.useRenderColorMask(t),this.m_renderProxy.lockRenderColorMask())}useGlobalRenderColorMaskByName(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderColorMask(),this.m_renderProxy.useRenderColorMask(a.default.GetRenderColorMaskByName(t)),this.m_renderProxy.lockRenderColorMask())}getRenderColorMaskByName(t){return a.default.GetRenderColorMaskByName(t)}lockRenderState(){null!=this.m_renderProxy&&this.m_renderProxy.lockRenderState()}unlockRenderState(){null!=this.m_renderProxy&&this.m_renderProxy.unlockRenderState()}useGlobalRenderState(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderState(),this.m_renderProxy.useRenderState(t),this.m_renderProxy.lockRenderState())}useGlobalRenderStateByName(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderState(),this.m_renderProxy.useRenderState(a.default.GetRenderStateByName(t)),this.m_renderProxy.lockRenderState())}getRenderStateByName(t){return a.default.GetRenderStateByName(t)}lockMaterial(){null!=this.m_materialProxy&&this.m_materialProxy.lockMaterial()}unlockMaterial(){null!=this.m_materialProxy&&this.m_materialProxy.unlockMaterial()}isUnlockMaterial(){return this.m_materialProxy.isUnlockMatrial()}useGlobalMaterial(t,e=!1,s=!1){null!=this.m_materialProxy&&(this.m_materialProxy.unlockMaterial(),e?this.m_materialProxy.unlockTexture():this.m_materialProxy.lockTexture(),this.m_materialProxy.useGlobalMaterial(t,s),this.m_materialProxy.lockMaterial())}updateMaterialUniform(t){this.m_materialProxy.updateMaterialUniform(t)}clearBackBuffer(){this.m_renderProxy.clearBackBuffer()}setScissorRect(t,e,s,i){this.m_adapter.setScissorRect(t,e,s,i)}setScissorEnabled(t){this.m_adapter.setScissorEnabled(t)}setViewPort(t,e,s,i){this.m_renderProxy.setViewPort(t,e,s,i)}synFBOSizeWithViewport(){this.m_adapter.synFBOSizeWithViewport()}asynFBOSizeWithViewport(){this.m_adapter.asynFBOSizeWithViewport()}setFBOSizeFactorWithViewPort(t){this.m_adapter.setFBOSizeFactorWithViewPort(t)}createFBOAt(t,e,s,i,r=!1,a=!1,n=0){this.m_adapter.createFBOAt(t,e,s,i,r,a,n)}bindFBOAt(t,e){this.m_adapter.bindFBOAt(t,e)}setRenderToTexture(t,e=!1,s=!1,i=0){this.m_adapter.setRenderToTexture(t,e,s,i)}useFBO(t=!1,e=!1,s=!1){this.m_adapter.useFBO(t,e,s)}resetFBOAttachmentMask(t){this.m_adapter.resetFBOAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){this.m_adapter.setFBOAttachmentMaskAt(t,e)}setRenderToBackBuffer(){null!=this.m_adapter&&(this.m_adapter.setRenderToBackBuffer(r.default.FRAMEBUFFER),this.m_materialProxy.renderBegin())}lockViewport(){this.m_adapter.lockViewport()}unlockViewport(){this.m_adapter.unlockViewport()}setClearDepth(t){this.m_adapter.setClearDepth(t)}getClearDepth(){return this.m_adapter.getClearDepth()}getViewportX(){return this.m_adapter.getViewportX()}getViewportY(){return this.m_adapter.getViewportY()}getViewportWidth(){return this.m_adapter.getViewportWidth()}getViewportHeight(){return this.m_adapter.getViewportHeight()}setContextViewSize(t,e){this.m_adapter.setContextViewSize(t,e)}setCameraParam(t,e,s){this.m_cameraFov=t,this.m_cameraNear=e,this.m_cameraFar=s,null!=this.m_renderProxy&&this.m_renderProxy.setCameraParam(t,e,s)}initialize(t,e,s){if(null==this.m_adapter){this.m_renderProxy.setCameraParam(this.m_cameraFov,this.m_cameraNear,this.m_cameraFar),this.m_renderProxy.setWebGLMaxVersion(t.maxWebGLVersion);let i=new h.RenderProxyParam;i.uniformContext=s.uniformContext,i.vtxBufUpdater=s.builder,i.materialUpdater=s.builder,i.vtxBuilder=s.vtxBuilder,this.m_renderProxy.initialize(t,e,s.stage,i),this.m_rcuid=this.m_renderProxy.getRCUid(),s.vtxBuilder.initialize(this.m_rcuid,this.m_renderProxy.getRC(),this.m_renderProxy.getGLVersion()),this.m_adapter=this.m_renderProxy.getRenderAdapter(),this.m_adapter.bgColor.setRGBA4f(0,0,0,1);let r=this.m_renderProxy.getContext();r.setViewport(0,0,r.getRCanvasWidth(),r.getRCanvasHeight())}}initManager(t){null==this.m_materialProxy&&(this.m_materialProxy=new n.default,this.m_materialProxy.setDispBuilder(t))}setClearRGBColor3f(t,e,s){this.m_renderProxy.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.m_renderProxy.setClearRGBAColor4f(t,e,s,i)}getClearRGBAColor4f(t){t.copyFrom(this.m_adapter.bgColor)}updateRenderBufferSize(){this.m_adapter.updateRenderBufferSize()}vertexRenderBegin(){this.m_renderProxy.Vertex.renderBegin()}renderBegin(t=!0){null!=this.m_adapter&&(this.m_adapter.unlockViewport(),this.m_adapter.setClearDepth(1),this.m_renderProxy.Vertex.renderBegin(),this.m_materialProxy.renderBegin(),this.m_adapter.update(),this.m_adapter.setClearMaskClearAll(),this.m_adapter.renderBegin(),a.default.ResetInfo(),a.default.Reset(this.m_renderProxy.getRenderContext()),t&&(this.m_renderProxy.useCameraData(),this.m_renderProxy.updateCameraDataFromCamera(this.m_renderProxy.getCamera())))}resetState(){a.default.ResetState(),this.m_materialProxy.renderBegin()}resetmaterial(){this.m_materialProxy.renderBegin()}resetUniform(){this.m_materialProxy.resetUniform()}runEnd(){}}e.RendererInstanceContext=o,e.default=o},"0fc4":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("9666")),a=i(s("faa5"));class n{constructor(){this.m_shduns="",this.m_shdData=null,this.m_polygonOffset=null,this.m_sharedUniforms=null,this.m_shaderUniformData=null,this.m_pipeLine=null,this.m_uniqueShaderName="",this.__$troMid=-1,this.__$uniform=null,this.pipeTypes=null,this.m_texList=null,this.m_texListLen=0,this.m_texDataEnabled=!1,this.m_attachCount=0}setPolygonOffset(t,e=0){null==this.m_polygonOffset?this.m_polygonOffset=[t,e]:(this.m_polygonOffset[0]=t,this.m_polygonOffset[1]=e)}getPolygonOffset(){return this.m_polygonOffset}setDepthOffset(t){}setMaterialPipeline(t){this.m_pipeLine=t}getMaterialPipeline(){return this.m_pipeLine}getShdUniqueName(){return this.m_shduns}getCodeBuf(){throw Error("Illgel operation !!!")}hasShaderData(){return null!=this.m_shdData&&(!this.m_shdData.haveTexture()||this.texDataEnabled())}initializeByRenderer(t=!1){this.initializeByCodeBuf(t)}initializeByCodeBuf(t=!1){if(t=t||this.getTextureTotal()>0,null==this.m_shdData){let e=this.getCodeBuf();if(null!=e){let s;e.reset(),e.pipeline=this.m_pipeLine,e.pipeTypes=this.pipeTypes,null!=e.pipeline&&e.pipeline.reset(),this.buildBuf();let i=this.m_uniqueShaderName;if(""!=i&&(s=r.default.FindData(i),this.m_shduns=i),null==s?(t=t||this.getTextureTotal()>0,e.initialize(t),i=e.getUniqueShaderName()+e.keysString+e.getShaderCodeBuilder().getUniqueNSKeyString(),this.m_shduns=i,this.__$initShd(this.m_shduns),s=r.default.FindData(i),this.m_uniqueShaderName=this.m_shduns):(t=t||this.getTextureTotal()>0,e.initialize(t)),null==s){e.buildShader(),e.buildDefine(),null!=e.pipeline&&(null!=e.getShaderCodeObject()?e.pipeline.addShaderCode(e.getShaderCodeObject(),!1):e.pipeline.addShaderCodeWithUUID(e.getShaderCodeObjectUUID(),!1),e.pipeline.build(e.getShaderCodeBuilder()));let t=e.getFragShaderCode(),n=e.getVertShaderCode();s=r.default.CreateShdData(i,n,t,e.adaptationShaderVersion,a.default.GetPreCompileInfo())}null!=this.m_pipeLine&&(this.m_sharedUniforms=this.m_pipeLine.getSharedUniforms()),this.m_shdData=s}}}buildBuf(){}__$initShd(t){}getShaderData(){return this.m_shdData}setTextureList(t){if(this.m_texList!=t){this.m_texDataEnabled=!1,this.m_texListLen=null!=t?t.length:0;let e=0;if(null!=this.m_texList)for(;e<this.m_texList.length;++e)this.m_texList[e].__$detachThis();if(this.m_texDataEnabled=!0,this.m_texList=t,null!=this.m_texList){let t=31;for(e=0;e<this.m_texList.length;++e)t=131*t+this.m_texList[e].getUid(),this.m_texList[e].__$attachThis(),this.m_texList[e].isDataEnough()||(this.m_texDataEnabled=!1);this.__$troMid=t}}}setTextureAt(t,e){if(t>=0&&null!=e){let s=this.m_texList,i=s.length;if(null!=s&&s[t]!=e&&t<i&&i>0){s=s.slice(0),s[t].__$detachThis(),s[t]=e,this.m_texDataEnabled=e.isDataEnough(),e.__$attachThis();let r=31;for(let t=0;t<i;++t)r=131*r+s[t].getUid();this.__$troMid=r,this.m_texList=s}}}getTextureList(){return this.m_texList}getTextureAt(t){return this.m_texList[t]}getTextureTotal(){return this.m_texListLen}getShdTexTotal(){return null!=this.m_shdData?this.m_shdData.getTexTotal():0}texDataEnabled(){if(null!=this.m_texList){if(this.m_texDataEnabled)return!0;let t=!0,e=this.m_texList;for(let s=0;s<this.m_texListLen;++s)if(!e[s].isDataEnough()){t=!1;break}return this.m_texDataEnabled=t,t}return null!=this.m_shdData&&this.m_shdData.getTexTotal(),!1}createSharedUniforms(){return this.m_sharedUniforms}createSharedUniformsData(){return null}createSelfUniformData(){return this.m_shaderUniformData}updateSelfData(t){}hasTexture(){return this.m_shdData.haveTexture()}getBufSortFormat(){return null!=this.m_shdData?this.m_shdData.getLayoutBit():0}getBufTypeList(){return null!=this.m_shdData?this.m_shdData.getLocationTypes():null}getBufSizeList(){return null!=this.m_shdData?this.m_shdData.getAttriSizeList():null}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}getAttachCount(){return this.m_attachCount}destroy(){if(this.m_sharedUniforms=null,this.m_shaderUniformData=null,this.pipeTypes=null,this.getAttachCount()<1){if(null!=this.m_texList)for(let t=0;t<this.m_texList.length;++t)this.m_texList[t].__$detachThis();this.m_shdData=null,this.m_texList=null,this.m_texDataEnabled=!1,this.__$troMid=0,null!=this.__$uniform&&(this.__$uniform.destroy(),this.__$uniform=null)}}toString(){return"[MaterialBase()]"}}e.default=n},1173:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}initialize(){}destroy(){}}e.CoSystem=i},"11e6":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static AddContainerFlag(t){return 2147483648|t}static RemoveContainerFlag(t){return-2147483649&t}static AddSpaceUid(t,e){return-1048576&t|e}static RemoveSpaceUid(t){return-1048576&t}static GetSpaceUid(t){return 1048575&t}static AddRendererUid(t,e){return-133169153&t|e<<20}static RemoveRendererUid(t){return 133169152|t}static GetRendererUid(t){return t=(133169152&t)>>20,t<127?t:-1}static TestRendererUid(t){return t=(133169152&t)>>20,t<127}static AddSortEnabled(t){return 1073741824|t}static RemoveSortEnabled(t){return-1073741825&t}static TestSortEnabled(t){return 1073741824==(1073741824&t)}static AddRendererLoad(t){return 805306368|t}static RemoveRendererLoad(t){return-805306369&t}static TestSpaceContains(t){return(1048575&t)>0}static TestSpaceEnabled(t){return(1048575&t)<1}static TestSpaceEnabled2(t){return(1048575&t)<1&&2147483648!=(2147483648&t)}static TestContainerEnabled(t){return 133169152==(133169152&t)&&2147483648!=(2147483648&t)}static TestRendererEnabled(t){return 133169152==(938475520&t)&&2147483648!=(2147483648&t)}}i.DEFAULT=133169152,i.CONTAINER_FLAG=2147483648,i.CONTAINER_NOT_FLAG=-2147483649,i.SPACE_FLAG=1048575,i.SPACE_NOT_FLAG=-1048576,i.RENDERER_UID_FLAG=133169152,i.RENDERER_UID_NOT_FLAG=-133169153,i.RENDERER_UID_INVALID=127,i.SORT_FLAG=1073741824,i.SORT_NOT_FLAG=-1073741825,i.RENDERER_LOAD_FLAG=805306368,i.RENDERER_LOAD_NOT_FLAG=-805306369,i.RENDERER_ADN_LOAD_FLAG=938475520,e.default=i},1216:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3930")),a=i(s("baae")),n=i(s("722e")),h=i(s("8333")),l=i(s("6d49")),o=s("e08e"),_=i(s("ffc0")),m=i(s("1f61")),u=s("070b"),d=s("a5ba"),c=i(s("29ef")),f=i(s("e2fe"));class p{constructor(t,e){this.m_rcuid=0,this.m_texResource=null,this.m_gl=null,this.m_fontFaceFlipped=!1,this.m_colorMask={mr:!0,mg:!0,mb:!0,ma:!0},this.m_rcontext=null,this.m_clearMask=0,this.m_fboBuf=null,this.m_fboIndex=0,this.m_fboType=a.default.FRAMEBUFFER,this.m_fboBufList=[null,null,null,null,null,null,null,null],this.m_fboClearBoo=!0,this.m_fboViewportRectBoo=!1,this.m_polygonOffsetFlag=!1,this.m_polygonOffset=!1,this.m_clearDepth=1,this.m_preDepth=0,this.m_viewPortRect=new f.default(0,0,800,600),this.m_fboViewportRect=new f.default(0,0,800,600),this.m_fboSizeFactor=1,this.m_clearStencil=0,this.m_fboBiltRectData=new Uint16Array(8),this.m_fboViewportRectData=new Uint16Array(4),this.m_activeAttachmentTotal=1,this.m_scissorEnabled=!1,this.m_rState=null,this.m_webglVer=2,this.bgColor=new r.default,this.uViewProbe=null,this.m_devPRatio=1,this.m_viewportUnlock=!0,this.m_synFBOSizeWithViewport=!1,this.m_texResource=e,this.m_rcuid=t}initialize(t,e,s,i){if(null==this.m_rcontext&&(this.m_webglVer=t.getWebGLVersion(),this.m_rState=s,this.m_rcontext=t,this.m_gl=t.getRC(),this.m_gl.disable(this.m_gl.SCISSOR_TEST),t.isDepthTestEnabled()?this.m_gl.enable(this.m_gl.DEPTH_TEST):this.m_gl.disable(this.m_gl.DEPTH_TEST),t.isStencilTestEnabled()?this.m_gl.enable(this.m_gl.STENCIL_TEST):this.m_gl.disable(this.m_gl.STENCIL_TEST),e.getPolygonOffsetEanbled()?this.enabledPolygonOffset():this.disabledPolygonOffset(),this.m_gl.enable(this.m_gl.CULL_FACE),this.m_gl.cullFace(this.m_gl.BACK),this.m_gl.enable(this.m_gl.BLEND),e.getDitherEanbled()?this.m_gl.enable(this.m_gl.DITHER):this.m_gl.disable(this.m_gl.DITHER),this.m_gl.frontFace(this.m_gl.CCW),this.m_clearMask=this.m_gl.COLOR_BUFFER_BIT|this.m_gl.DEPTH_BUFFER_BIT|this.m_gl.STENCIL_BUFFER_BIT,null==this.uViewProbe)){let t=this.m_viewPortRect,e=this;e.uViewProbe=i,this.uViewProbe.setVec4DataWithArr4([t.x,t.y,t.width,t.height])}}setFrontFaceFlipped(t){this.m_fontFaceFlipped!=t&&(t?this.m_gl.frontFace(this.m_gl.CW):this.m_gl.frontFace(this.m_gl.CCW),this.m_fontFaceFlipped=t)}enabledPolygonOffset(){this.m_polygonOffset||(this.m_polygonOffset=!0,this.m_gl.enable(this.m_gl.POLYGON_OFFSET_FILL))}disabledPolygonOffset(){this.m_polygonOffset&&(this.m_polygonOffset=!1,this.m_gl.disable(this.m_gl.POLYGON_OFFSET_FILL))}setPolygonOffset(t,e=0){this.m_gl.polygonOffset(t,e),this.m_polygonOffsetFlag=!0}resetPolygonOffset(){this.m_polygonOffsetFlag&&(this.m_gl.polygonOffset(0,0),this.m_polygonOffsetFlag=!1)}getDiv(){return this.m_rcontext.getDiv()}getCanvas(){return this.m_rcontext.getCanvas()}setClearDepth(t){this.m_clearDepth=t}getClearDepth(){return this.m_clearDepth}setContextViewSize(t,e){this.m_rcontext.autoSyncRenderBufferAndWindowSize=!1,this.m_rcontext.resizeBufferSize(t,e)}getViewportX(){return this.m_rcontext.getViewportX()}getViewportY(){return this.m_rcontext.getViewportY()}getViewportWidth(){return this.m_rcontext.getViewportWidth()}getViewportHeight(){return this.m_rcontext.getViewportHeight()}getFBOFitWidth(){return this.m_rcontext.getFBOWidth()}getFBOFitHeight(){return this.m_rcontext.getFBOHeight()}getRCanvasWidth(){return this.m_rcontext.getRCanvasWidth()}getRCanvasHeight(){return this.m_rcontext.getRCanvasHeight()}setColorMask(t,e,s,i){this.m_colorMask.mr=t,this.m_colorMask.mg=e,this.m_colorMask.mb=s,this.m_colorMask.ma=i}setClearMaskClearAll(){this.m_clearMask=this.m_gl.COLOR_BUFFER_BIT|this.m_gl.DEPTH_BUFFER_BIT|this.m_gl.STENCIL_BUFFER_BIT}setClearMaskClearOnlyColor(){this.m_clearMask=this.m_gl.COLOR_BUFFER_BIT}setClearMaskClearOnlyDepthAndStencil(){this.m_clearMask=this.m_gl.DEPTH_BUFFER_BIT|this.m_gl.STENCIL_BUFFER_BIT}setScissorRect(t,e,s,i){this.m_scissorEnabled&&this.m_gl.scissor(t,e,s,i)}setScissorEnabled(t){t?this.m_scissorEnabled||(this.m_scissorEnabled=!0,this.m_gl.enable(this.m_gl.SCISSOR_TEST)):this.m_scissorEnabled&&(this.m_scissorEnabled=!1,this.m_gl.disable(this.m_gl.SCISSOR_TEST))}clearDepth(t=1){this.m_clearDepth=t,this.m_preDepth!==this.m_clearDepth&&(this.m_preDepth=this.m_clearDepth,this.m_gl.clearDepth(this.m_clearDepth)),this.m_gl.clear(this.m_gl.DEPTH_BUFFER_BIT)}clearColor(t){this.m_gl.clearColor(t.r,t.g,t.b,t.a),this.m_gl.clear(this.m_gl.COLOR_BUFFER_BIT)}clear(){this.m_preDepth!==this.m_clearDepth&&(this.m_preDepth=this.m_clearDepth,this.m_gl.clearDepth(this.m_clearDepth)),this.m_rcontext.isStencilTestEnabled()&&this.m_gl.clearStencil(this.m_clearStencil),this.m_gl.clearColor(this.bgColor.r,this.bgColor.g,this.bgColor.b,this.bgColor.a),this.m_gl.clear(this.m_clearMask)}reset(){this.m_rState.setCullFaceMode(o.CullFaceMode.BACK),this.m_rState.setDepthTestMode(o.DepthTestMode.OPAQUE),c.default.Reset(this.m_gl)}getRenderContext(){return this.m_rcontext}renderBegin(){null!=this.m_rcontext&&(this.m_fboSizeFactor=1,this.reseizeViewPort(),d.RenderStateObject.Unlock(),d.RenderStateObject.UseRenderState(c.default.NORMAL_STATE),u.RenderColorMask.Unlock(),u.RenderColorMask.UseRenderState(u.RenderColorMask.ALL_TRUE_COLOR_MASK),this.clear())}updateViewPort(){let t=this.m_viewPortRect;this.uViewProbe.setVec4Data(t.x,t.y,t.width,t.height),this.uViewProbe.update(),this.m_gl.viewport(t.x,t.y,t.width,t.height)}checkViewPort(t){let e=this.m_viewPortRect,s=this.m_rcontext.getDevicePixelRatio(),i=e.testEqual(t);i=i||Math.abs(this.m_devPRatio-s)>.01,i&&(this.m_devPRatio=s,e.copyFrom(t),this.updateViewPort())}reseizeViewPort(){this.m_viewportUnlock&&this.checkViewPort(this.m_rcontext.getViewPortSize())}reseizeFBOViewPort(){this.m_viewportUnlock&&this.checkViewPort(this.m_fboViewportRect)}setViewProbeValue(t,e,s,i){this.uViewProbe.setVec4Data(t,e,s,i),this.uViewProbe.update()}lockViewport(){this.m_viewportUnlock=!1}unlockViewport(){this.m_viewportUnlock=!0}renderEnd(){}update(){}updateRenderBufferSize(){this.m_rcontext.updateRenderBufferSize()}destroy(){this.m_rcontext=null,this.m_rState=null}getDevicePixelRatio(){return this.m_rcontext.getDevicePixelRatio()}loseContext(){this.m_rcontext.loseContext()}isContextLost(){return this.m_rcontext.isContextLost()}readPixels(t,e,s,i,r,a,n){this.m_gl.readPixels(t,e,s,i,_.default.ToGL(this.m_gl,r),m.default.ToGL(this.m_gl,a),n)}setFBOViewportRect(t,e,s,i){this.m_fboViewportRectData[0]=t,this.m_fboViewportRectData[1]=e,this.m_fboViewportRectData[2]=s,this.m_fboViewportRectData[3]=i,this.m_fboViewportRectBoo=!0}createFBOAt(t,e,s,i,r=!1,a=!1,n=0){null==this.m_fboBufList[t]&&(t>7&&(t=7),this.m_fboType=e,this.m_fboBuf=new l.default(this.m_rcuid,this.m_texResource,this.m_fboType),this.m_fboBuf.multisampleEnabled=n>0,this.m_fboBuf.multisampleLevel=n,this.m_fboBuf.writeDepthEnabled=r,this.m_fboBuf.writeStencilEnabled=a,this.m_fboBuf.initialize(this.m_gl,s,i),this.m_fboBufList[t]=this.m_fboBuf,this.m_fboBuf.sizeFixed=!0)}resizeFBOAt(t,e,s){t>7?t=7:t<0&&(t=0),null!=this.m_fboBufList[t]&&this.m_fboBufList[t].resize(e,s)}getFBOWidthAt(t){return null!=this.m_fboBufList[t]?this.m_fboBufList[t].getWidth():0}getFBOHeightAt(t){return null!=this.m_fboBufList[t]?this.m_fboBufList[t].getHeight():0}synFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!0}asynFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!1}setFBOSizeFactorWithViewPort(t){this.m_fboSizeFactor=t}bindFBOAt(t,e){if(t>7?t=7:t<0&&(t=0),this.m_fboBuf=this.m_fboBufList[t],null==this.m_fboBuf)throw Error("Fatal Error!!! this.m_fboBuf == null.");this.m_fboIndex=t,this.m_fboType=e,this.m_fboBuf.bind(e),this.m_fboClearBoo=!0}clearFBODepthAt(t,e=1){let s=this.m_fboBufList[t];null!=s&&s.clearOnlyDepth(e)}resetFBOAttachmentMask(t){null!=this.m_fboBuf&&this.m_fboBuf.resetAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){null!=this.m_fboBuf&&this.m_fboBuf.setAttachmentMaskAt(t,e)}getFBOAttachmentTotal(){return null!=this.m_fboBuf?this.m_fboBuf.getAttachmentTotal():0}setRenderToTexture(t,e=!1,s=!1,i=0){(i<0||i>=8)&&(i=0),null==t&&0==i?this.setRenderToBackBuffer(a.default.FRAMEBUFFER):(0==i&&(null!=this.m_fboBuf&&(this.m_synFBOSizeWithViewport?this.m_fboBuf.initialize(this.m_gl,Math.floor(this.m_rcontext.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rcontext.getFBOHeight()*this.m_fboSizeFactor)):this.m_fboViewportRectBoo?this.m_fboBuf.initialize(this.m_gl,this.m_fboViewportRectData[2],this.m_fboViewportRectData[3]):this.m_fboBuf.sizeFixed||this.m_fboBuf.initialize(this.m_gl,t.getWidth(),t.getHeight())),this.m_fboIndex>=0&&null==this.m_fboBuf&&(this.m_fboBuf=new l.default(this.m_rcuid,this.m_texResource,this.m_fboType),this.m_fboBufList[this.m_fboIndex]=this.m_fboBuf,this.m_fboBuf.writeDepthEnabled=e,this.m_fboBuf.writeStencilEnabled=s,this.m_synFBOSizeWithViewport?this.m_fboBuf.initialize(this.m_gl,Math.floor(this.m_rcontext.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rcontext.getFBOHeight()*this.m_fboSizeFactor)):this.m_fboViewportRectBoo?this.m_fboBuf.initialize(this.m_gl,this.m_fboViewportRectData[2],this.m_fboViewportRectData[3]):this.m_fboBuf.initialize(this.m_gl,t.getWidth(),t.getHeight()))),null!=this.m_fboBuf&&this.m_fboBuf.renderToTexAt(this.m_gl,t,i),this.m_fboClearBoo=!0)}getActiveAttachmentTotal(){return this.m_activeAttachmentTotal}getAttachmentTotal(){return this.m_activeAttachmentTotal}useFBO(t=!1,e=!1,s=!1){if(null!=this.m_fboBuf&&this.m_fboClearBoo){this.m_fboClearBoo=!1,this.m_fboBuf.use(this.m_gl),this.m_activeAttachmentTotal=this.m_fboBuf.getActiveAttachmentTotal(),t&&this.m_fboBuf.clearOnlyColor(this.bgColor),this.m_fboBuf.writeDepthEnabled?this.m_fboBuf.writeStencilEnabled?e&&s?this.m_fboBuf.clearOnlyDepthAndStencil(this.m_clearDepth,4294967295):e?this.m_fboBuf.clearOnlyDepth(this.m_clearDepth):s&&this.m_fboBuf.clearOnlyStencil(255):e&&this.m_fboBuf.clearOnlyDepth(this.m_clearDepth):s&&this.m_fboBuf.writeStencilEnabled&&this.m_fboBuf.clearOnlyStencil(255),1==this.m_webglVer&&this.m_gl.clear(this.m_clearMask);let i=this.m_viewPortRect;this.m_fboBiltRectData[4]=this.m_fboBiltRectData[0]=i.x,this.m_fboBiltRectData[5]=this.m_fboBiltRectData[1]=i.y,this.m_fboBiltRectData[6]=this.m_fboBiltRectData[2]=i.getRight(),this.m_fboBiltRectData[7]=this.m_fboBiltRectData[3]=i.getTop(),this.m_fboViewportRectBoo?(this.m_fboViewportRectBoo=!1,this.m_fboViewportRect.setTo(this.m_fboViewportRectData[0],this.m_fboViewportRectData[1],this.m_fboViewportRectData[2],this.m_fboViewportRectData[3]),this.reseizeFBOViewPort()):(this.m_synFBOSizeWithViewport?this.m_fboViewportRect.setTo(0,0,Math.floor(this.m_rcontext.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rcontext.getFBOHeight()*this.m_fboSizeFactor)):(this.m_fboBuf.isSizeChanged()&&this.m_fboBuf.initialize(this.m_gl,this.m_fboBuf.getWidth(),this.m_fboBuf.getHeight()),this.m_fboViewportRect.setTo(0,0,this.m_fboBuf.getWidth(),this.m_fboBuf.getHeight())),this.reseizeFBOViewPort())}}setRenderToBackBuffer(t=a.default.FRAMEBUFFER){this.m_activeAttachmentTotal=1,l.default.BindToBackbuffer(this.m_gl,t),this.reseizeViewPort()}bindFBOToDraw(){null!=this.m_fboBuf&&this.m_fboBuf.bind(a.default.DRAW_FRAMEBUFFER)}bindFBOToWrite(){null!=this.m_fboBuf&&this.m_fboBuf.bind(a.default.READ_FRAMEBUFFER)}setBlitFboSrcRect(t,e,s,i){this.m_fboBiltRectData[0]=t,this.m_fboBiltRectData[1]=e,this.m_fboBiltRectData[2]=t+s,this.m_fboBiltRectData[3]=e+i}setBlitFboDstRect(t,e,s,i){this.m_fboBiltRectData[4]=t,this.m_fboBiltRectData[5]=e,this.m_fboBiltRectData[6]=t+s,this.m_fboBiltRectData[7]=e+i}blitFBO(t=0,e=0,s=h.default.COLOR_BUFFER_BIT,i=n.default.NEAREST,r=0,o=0,_=null){t>7&&(t=7),e>7&&(e=7),t>=0&&null!=this.m_fboBufList[t]?this.m_fboBufList[t].bind(a.default.READ_FRAMEBUFFER):l.default.BindToBackbuffer(this.m_gl,a.default.READ_FRAMEBUFFER),e>=0&&null!=this.m_fboBufList[e]?this.m_fboBufList[e].bind(a.default.DRAW_FRAMEBUFFER):l.default.BindToBackbuffer(this.m_gl,a.default.DRAW_FRAMEBUFFER),r>0&&(o<0&&(o=0),null==_&&(_=[0,0,0,1]),this.m_gl.clearBufferfv(r,o,_));let m=this.m_fboBiltRectData;this.m_gl.blitFramebuffer(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],s,i)}}e.default=p},1264:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=s("e08e"),n=s("eca0");class h{constructor(t,e,s,i){this.m_rpoUnitBuilder=null,this.m_dataBuilder=null,this.m_processBuider=null,this.m_waitList=[],this.m_processUidList=[],this.m_rendererUid=-1,this.m_existencetotal=0,this.m_rprocess=null,this.m_entityManaListener=null,this.version=0,this.m_rendererUid=t,this.m_dataBuilder=e,this.m_rpoUnitBuilder=s,this.m_processBuider=i}setListener(t){this.m_entityManaListener=t}isEmpty(){return this.m_existencetotal<1}isHaveEntity(){return this.m_existencetotal>0}removeEntity(t){this.m_existencetotal--;let e=t.getDisplay();if(null!=e&&null!=e.__$$runit){let t=e.__$ruid,s=this.m_rpoUnitBuilder.getRCRPObj(t);if(null!=s){if(s.count>0)if(s.count<2)s.rprocessUid>-1&&(this.m_rprocess=this.m_processBuider.getNodeByUid(s.rprocessUid),this.m_rprocess.removeDisp(e),s.rprocessUid=-1);else{let t=n.RCRPObj.RenerProcessMaxTotal;for(let i=0;i<t;++i)(s.idsFlag&1<<i)>0&&(this.m_rprocess=this.m_processBuider.getNodeByUid(i),this.m_rprocess.removeDisp(e))}}else this.m_rprocess=this.m_processBuider.getNodeByUid(e.__$$runit.getRPROUid()),this.m_rprocess.removeDisp(e);0==s.count&&(e.__$$rsign,a.DisplayRenderSign.LIVE_IN_RENDERER,e.__$$rsign=a.DisplayRenderSign.NOT_IN_RENDERER,this.m_rpoUnitBuilder.restoreByUid(t)),this.version++}t.__$rseFlag=r.default.RemoveRendererUid(t.__$rseFlag),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.RemoveSortEnabled(t.__$rseFlag),null!=this.m_entityManaListener&&this.m_entityManaListener.removeFromRenderer(t,this.m_rendererUid,-1)}addEntity(t,e,s=!1){if(null!=t){let i=t.getDisplay();if(null!=i){if(i.__$$rsign==a.DisplayRenderSign.LIVE_IN_RENDERER&&!this.m_rpoUnitBuilder.testRPNodeNotExists(i.__$ruid,e))return;this.m_rprocess=this.m_processBuider.getNodeByUid(e),t.__$rseFlag=this.m_rprocess.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),s?(i.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(i.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid),this.m_waitList.push(t),this.m_processUidList.push(e)):this.testValidData(t)?this.ensureAdd(t,i,e):(i.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(i.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),this.m_waitList.push(t),this.m_processUidList.push(e))}else t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid)}return!1}testValidData(t){if(null!=t.getMaterial()&&t.hasMesh()){if(t.getMaterial().hasShaderData())return!0;null!=t.getMaterial().getCodeBuf()&&t.activeDisplay()}return!1}ensureAdd(t,e,s){t.update(),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$setRenderProxy(this.m_dataBuilder.getRenderProxy()),this.m_existencetotal++,e.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(e.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),this.m_rprocess=this.m_processBuider.getNodeByUid(s),(e.__$ruid>-1||this.m_dataBuilder.buildGpuDisp(e))&&this.m_rprocess.addDisp(e),null!=this.m_entityManaListener&&this.m_entityManaListener.addToRenderer(t,this.m_rendererUid,s),null!=t.getGlobalBounds()&&(e.__$$runit.bounds=t.getGlobalBounds(),e.__$$runit.pos=e.__$$runit.bounds.center),this.version++}updateWaitList(){let t=this.m_waitList.length,e=null,s=null;for(let i=0;i<t;++i)if(e=this.m_waitList[i],(r.default.RENDERER_LOAD_FLAG&e.__$rseFlag)==r.default.RENDERER_LOAD_FLAG){if(this.testValidData(e)){if(s=e.getDisplay(),s.__$$rsign==a.DisplayRenderSign.LIVE_IN_RENDERER&&!this.m_rpoUnitBuilder.testRPNodeNotExists(s.__$ruid,this.m_processUidList[i])){this.m_waitList.splice(i,1),this.m_processUidList.splice(i,1),--t,--i;continue}this.ensureAdd(e,s,this.m_processUidList[i]),this.m_waitList.splice(i,1),this.m_processUidList.splice(i,1),--t,--i}}else s=e.getDisplay(),null!=s&&s.__$$rsign==a.DisplayRenderSign.GO_TO_RENDERER&&(s.__$$rsign=a.DisplayRenderSign.NOT_IN_RENDERER),e.__$rseFlag=r.default.RemoveRendererLoad(e.__$rseFlag),e.__$rseFlag=r.default.RemoveRendererUid(e.__$rseFlag),e.__$rseFlag=r.default.RemoveSortEnabled(e.__$rseFlag),this.m_waitList.splice(i,1),this.m_processUidList.splice(i,1),--t,--i,null!=this.m_entityManaListener&&this.m_entityManaListener.removeFromRenderer(e,this.m_rendererUid,-1)}update(){this.m_waitList.length>0&&this.updateWaitList(),this.m_dataBuilder.update()}}e.default=h},1280:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("f689"),r=s("8310"),a=s("5ab6"),n=s("c758");class h{constructor(){this.m_parseTotal=0,this.m_reader=null,this.m_bufPpt=new n.BufPropertyParser,this.m_egd=new a.ElementGeomData}setReader(t){this.m_reader=t}parseGeomBuf(t,e,s,i=!0){const r=new Map;if("Geometry"in e.Objects){const i=e.Objects.Geometry;let a=0,n=[],h=[];this.m_idLst=n,this.m_nodeIDList=h;for(const t in i)n.push(parseInt(t)),h.push(t);for(let l=0;l<n.length;++l){a=n[l];const o=s.get(a),_=this.parseGeometryBuffer(o,i[h[l]],t,e);r.set(a,_)}}return r}parseGeomBufBegin(t,e,s){if("Geometry"in e.Objects){this.m_deformers=t,this.m_fbxTree=e,this.m_connections=s,this.m_idLst=[],this.m_nodeIDList=[];const i=e.Objects.Geometry;for(const t in i)this.m_idLst.push(parseInt(t)),this.m_nodeIDList.push(t);this.m_parseTotal=this.m_idLst.length}}getGeomBufId(){return this.isParsing()?this.m_idLst[this.m_idLst.length-1]:-1}parseGeomBufNext(){if(this.isParsing()){const t=this.m_fbxTree.Objects.Geometry;let e=this.m_idLst.pop(),s=this.m_nodeIDList.pop();const i=this.m_connections.get(e);let r=this.parseGeometryBuffer(i,t[s],this.m_deformers,this.m_fbxTree);return null!=r&&(r.ID=s,r.id=e),this.isParsing()||(this.m_reader=null),r}return null}parseGeomBufAt(t){if(t>=0&&t<this.m_idLst.length&&this.isParsing()){const e=this.m_fbxTree.Objects.Geometry;let s=this.m_idLst[t],i=this.m_nodeIDList[t];const r=this.m_connections.get(s);let a=this.parseGeometryBuffer(r,e[i],this.m_deformers,this.m_fbxTree);return null!=a&&(a.ID=i,a.id=s),this.isParsing()||(this.m_reader=null),a}return null}isParsing(){return null!=this.m_idLst&&this.m_idLst.length>0}getParseTotal(){return this.m_parseTotal}parseGeometryBuffer(t,e,s,i){switch(e.attrType){case"Mesh":return this.parseMeshGeometryBuffer(t,e,s,i);case"NurbsCurve":return this.parseNurbsGeometry(e)}}parseMeshGeometryBuffer(t,e,s,i){const r=this.parseGeoNode(e),a=this.getBufObj(r);return a}parseGeoNode(t){const e={};if(e.vertexPositions=void 0!==t.Vertices?t.Vertices.a:[],e.vertexIndices=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],t.LayerElementNormal&&(e.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){e.uv=[];let s=0;while(t.LayerElementUV[s])t.LayerElementUV[s].UV&&e.uv.push(this.parseUVs(t.LayerElementUV[s])),s++}return e.weightTable={},e}parseData(t){return this.m_bufPpt.parseDirec(this.m_reader,t)}getBufObj(t){let e=0,s=0,a=new Array(36),n=new Array(36),h=new Array(36),l=null,o=[],_=[],m=t.uv,u=5==t.vertexPositions.length;if(u)return t.vertexIndices=this.parseData(t.vertexIndices),t.vertexPositions=this.parseData(t.vertexPositions),t.normal.buffer=this.parseData(t.normal.buffer),t.normal.indices=this.parseData(t.normal.indices),null!=m&&m.length>0&&(m[0].buffer=this.parseData(m[0].buffer)),this.m_egd.createBufObject(t);const d=new r.FBXBufferObject;d.isEntity=!0;let c=t.vertexIndices,f=t.vertexIndices.length,p=Date.now(),g=0,T=0;for(let i=0;i<f;++i)s++,c[i]<0&&(T+=s-2,s=0);let y=9*T;d.vertex=new Float32Array(y),d.normal=new Float32Array(y);let E=d.uvs,x=0,v=null;if(t.uv){x=t.uv.length,v=t.uv,l=[];for(let t=0;t<x;++t)l.push(new Array(36)),E[t]=new Float32Array(6*T);d.uvs=E}Date.now();s=0;for(let r=0;r<f;++r){let m=!1,u=c[r];u<0&&(u^=-1,m=!0);let f=3*s;const p=3*u;if(a[f]=p,a[f+1]=p+1,a[f+2]=p+2,t.normal){const s=i.getData(r,e,u,t.normal);n[f]=s[0],n[f+1]=s[1],n[f+2]=s[2]}if(null!=v){f=2*s;for(let t=0;t<x;++t){const s=i.getData(r,e,u,v[t]);l[t][f]=s[0],l[t][f+1]=s[1]}}s++,m&&(this.genFace(d,t,a,g,n,h,l,o,_,s),e++,s=0)}Date.now();return d}genFace(t,e,s,i,r,a,n,h,l,o){let _=e.vertexPositions,m=t.vertex,u=t.normal,d=t.uvs,c=t.i3,f=t.i2,p=null!=e.normal,g=null!=e.uv;for(let T=2;T<o;T++){if(m[c]=_[s[0]],m[c+1]=_[s[1]],m[c+2]=_[s[2]],m[c+3]=_[s[3*(T-1)]],m[c+4]=_[s[3*(T-1)+1]],m[c+5]=_[s[3*(T-1)+2]],m[c+6]=_[s[3*T]],m[c+7]=_[s[3*T+1]],m[c+8]=_[s[3*T+2]],p&&(u[c]=r[0],u[c+1]=r[1],u[c+2]=r[2],u[c+3]=r[3*(T-1)],u[c+4]=r[3*(T-1)+1],u[c+5]=r[3*(T-1)+2],u[c+6]=r[3*T],u[c+7]=r[3*T+1],u[c+8]=r[3*T+2]),g){const t=e.uv;for(let e=0,s=t.length;e<s;e++){const t=n[e],s=d[e];s[f]=t[0],s[f+1]=t[1],s[f+2]=t[2*(T-1)],s[f+3]=t[2*(T-1)+1],s[f+4]=t[2*T],s[f+5]=t[2*T+1]}}c+=9,f+=6}t.i3=c,t.i2=f}parseNormals(t){const e=t.MappingInformationType,s=t.ReferenceInformationType,i=t.Normals.a;let r=[];return"IndexToDirect"===s&&("NormalIndex"in t?r=t.NormalIndex.a:"NormalsIndex"in t&&(r=t.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:e,referenceType:s}}parseUVs(t){const e=t.MappingInformationType,s=t.ReferenceInformationType,i=t.UV.a;let r=[];return"IndexToDirect"===s&&(r=t.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:e,referenceType:s}}parseVertexColors(t){const e=t.MappingInformationType,s=t.ReferenceInformationType,i=t.Colors.a;let r=[];return"IndexToDirect"===s&&(r=t.ColorIndex.a),{dataSize:4,buffer:i,indices:r,mappingType:e,referenceType:s}}parseMaterialIndices(t){const e=t.MappingInformationType,s=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:s};const i=t.Materials.a,r=[];for(let a=0;a<i.length;++a)r.push(a);return{dataSize:1,buffer:i,indices:r,mappingType:e,referenceType:s}}parseNurbsGeometry(t){return null}}e.GeometryBufferParser=h},1710:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("a996"));class n extends a.default{constructor(){super(),this.lpos=new r.default,this.wpos=new r.default,this.raytv=new r.default(1,0,0),this.raypv=new r.default(0,0,0),this.mouseX=0,this.mouseY=0,this.mouseViewX=0,this.mouseViewY=0,this.posArray=null,this.wheelDeltaY=0}static GetMouseEvtTypeValueBase(){return 5001}static GetMouseEvtTypeValuesTotal(){return 18}getClassType(){return n.EventClassType}toString(){return"[MouseEvent]"}}n.EventClassType=1002,n.MOUSE_DOWN=5001,n.MOUSE_UP=5002,n.MOUSE_RIGHT_UP=5003,n.MOUSE_RIGHT_DOWN=5004,n.MOUSE_MOVE=5005,n.MOUSE_WHEEL=5006,n.MOUSE_OVER=5007,n.MOUSE_OUT=5008,n.MOUSE_CLICK=5009,n.MOUSE_RIGHT_CLICK=5010,n.MOUSE_DOUBLE_CLICK=5011,n.MOUSE_CANCEL=5012,n.MOUSE_MULTI_DOWN=5013,n.MOUSE_MULTI_UP=5014,n.MOUSE_MULTI_MOVE=5015,n.MOUSE_BG_DOWN=5016,n.MOUSE_BG_UP=5017,n.MOUSE_BG_CLICK=5018,e.default=n},"18c7":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("abdb"));class h{constructor(t=null,e=0){this.m_uid=-1,this.m_index=0,this.m_fs32=null,this.m_localFS32=null,this.m_index=e,null!=t?(this.m_uid=h.s_uid++,this.m_fs32=t,this.m_localFS32=this.m_fs32.subarray(e,e+16)):(this.m_uid=h.s_isolatedUid++,this.m_fs32=new Float32Array(16),this.m_fs32.set(h.s_InitData,0),this.m_localFS32=this.m_fs32)}setData(t){16==t.length&&this.m_localFS32.set(t)}getCapacity(){return 16}GetMaxUid(){return h.s_uid}getUid(){return this.m_uid}getLocalFS32(){return this.m_localFS32}getFS32(){return this.m_fs32}getFSIndex(){return this.m_index}identity(){this.m_localFS32.set(h.s_InitData,0)}determinant(){let t=this.m_localFS32;return(t[0]*t[5]-t[4]*t[1])*(t[10]*t[15]-t[14]*t[11])-(t[0]*t[9]-t[8]*t[1])*(t[6]*t[15]-t[14]*t[7])+(t[0]*t[13]-t[12]*t[1])*(t[6]*t[11]-t[10]*t[7])+(t[4]*t[9]-t[8]*t[5])*(t[2]*t[15]-t[14]*t[3])-(t[4]*t[13]-t[12]*t[5])*(t[2]*t[11]-t[10]*t[3])+(t[8]*t[13]-t[12]*t[9])*(t[2]*t[7]-t[6]*t[3])}multiplyMatrices(t,e){const s=t.m_localFS32,i=e.m_localFS32,r=this.m_localFS32,a=s[0],n=s[4],h=s[8],l=s[12],o=s[1],_=s[5],m=s[9],u=s[13],d=s[2],c=s[6],f=s[10],p=s[14],g=s[3],T=s[7],y=s[11],E=s[15],x=i[0],v=i[4],S=i[8],b=i[12],A=i[1],R=i[5],M=i[9],D=i[13],L=i[2],P=i[6],B=i[10],F=i[14],w=i[3],C=i[7],N=i[11],U=i[15];return r[0]=a*x+n*A+h*L+l*w,r[4]=a*v+n*R+h*P+l*C,r[8]=a*S+n*M+h*B+l*N,r[12]=a*b+n*D+h*F+l*U,r[1]=o*x+_*A+m*L+u*w,r[5]=o*v+_*R+m*P+u*C,r[9]=o*S+_*M+m*B+u*N,r[13]=o*b+_*D+m*F+u*U,r[2]=d*x+c*A+f*L+p*w,r[6]=d*v+c*R+f*P+p*C,r[10]=d*S+c*M+f*B+p*N,r[14]=d*b+c*D+f*F+p*U,r[3]=g*x+T*A+y*L+E*w,r[7]=g*v+T*R+y*P+E*C,r[11]=g*S+T*M+y*B+E*N,r[15]=g*b+T*D+y*F+E*U,this}multiply(t,e=null){return null!=t&&null!=e?this.multiplyMatrices(t,e):null!=t?this.multiplyMatrices(this,t):this}premultiply(t){return t!=this&&null!=t?this.multiplyMatrices(t,this):this}append(t){let e=t.getLocalFS32(),s=this.m_localFS32,i=s[0],r=s[4],a=s[8],n=s[12],h=s[1],l=s[5],o=s[9],_=s[13],m=s[2],u=s[6],d=s[10],c=s[14],f=s[3],p=s[7],g=s[11],T=s[15],y=e[0],E=e[4],x=e[8],v=e[12],S=e[1],b=e[5],A=e[9],R=e[13],M=e[2],D=e[6],L=e[10],P=e[14],B=e[3],F=e[7],w=e[11],C=e[15];s[0]=i*y+h*E+m*x+f*v,s[1]=i*S+h*b+m*A+f*R,s[2]=i*M+h*D+m*L+f*P,s[3]=i*B+h*F+m*w+f*C,s[4]=r*y+l*E+u*x+p*v,s[5]=r*S+l*b+u*A+p*R,s[6]=r*M+l*D+u*L+p*P,s[7]=r*B+l*F+u*w+p*C,s[8]=a*y+o*E+d*x+g*v,s[9]=a*S+o*b+d*A+g*R,s[10]=a*M+o*D+d*L+g*P,s[11]=a*B+o*F+d*w+g*C,s[12]=n*y+_*E+c*x+T*v,s[13]=n*S+_*b+c*A+T*R,s[14]=n*M+_*D+c*L+T*P,s[15]=n*B+_*F+c*w+T*C}append3x3(t){let e=t.getLocalFS32(),s=this.m_localFS32,i=s[0],r=s[4],a=s[8],n=s[1],h=s[5],l=s[9],o=s[2],_=s[6],m=s[10],u=e[0],d=e[4],c=e[8],f=e[1],p=e[5],g=e[9],T=e[2],y=e[6],E=e[10];s[0]=i*u+n*d+o*c,s[1]=i*f+n*p+o*g,s[2]=i*T+n*y+o*E,s[4]=r*u+h*d+_*c,s[5]=r*f+h*p+_*g,s[6]=r*T+h*y+_*E,s[8]=a*u+l*d+m*c,s[9]=a*f+l*p+m*g,s[10]=a*T+l*y+m*E}appendRotationPivot(t,e,s=null){null==s&&(s=a.default.Z_AXIS),h.s_tMat4.identity(),h.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),h.s_tMat4.appendTranslationXYZ(s.x,s.y,s.z),this.append(h.s_tMat4)}appendRotation(t,e){h.s_tMat4.identity(),h.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),this.append(h.s_tMat4)}appendRotationX(t){h.s_tMat4.rotationX(t),this.append3x3(h.s_tMat4)}appendRotationY(t){h.s_tMat4.rotationY(t),this.append3x3(h.s_tMat4)}appendRotationZ(t){h.s_tMat4.rotationZ(t),this.append3x3(h.s_tMat4)}appendRotationEulerAngle(t,e,s){h.s_tMat4.rotationY(e),this.append3x3(h.s_tMat4),h.s_tMat4.rotationX(t),this.append3x3(h.s_tMat4),h.s_tMat4.rotationZ(s),this.append3x3(h.s_tMat4)}setScale(t){let e=this.m_localFS32;return e[0]=t.x,e[5]=t.y,e[10]=t.z,this}setScaleXYZ(t,e,s){let i=this.m_localFS32;i[0]=t,i[5]=e,i[10]=s}getScale(t){let e=this.m_localFS32;t.x=e[0],t.y=e[5],t.z=e[10]}setRotationEulerAngle(t,e,s){let i=this.m_localFS32,r=Math.cos(t),a=Math.sin(t),n=Math.cos(e),h=Math.sin(e),l=Math.cos(s),o=Math.sin(s),_=l*h,m=o*h,u=n*i[0],d=a*i[5],c=r*i[5],f=r*i[10],p=a*i[10];i[1]=o*u,i[2]=-h*i[0],i[0]=l*u,i[4]=_*d-o*c,i[8]=_*f+o*p,i[5]=m*d+l*c,i[9]=m*f-l*p,i[6]=n*d,i[10]=n*f}setRotationEulerAngle2(t,e,s,i,r,a){let n=this.m_localFS32,h=r*i,l=a*i,o=s*n[0],_=e*n[5],m=t*n[5],u=t*n[10],d=e*n[10];n[1]=a*o,n[2]=-i*n[0],n[0]=r*o,n[4]=h*_-a*m,n[8]=h*u+a*d,n[5]=l*_+r*m,n[9]=l*u-r*d,n[6]=s*_,n[10]=s*u}compose(t,e,s){const i=this.m_localFS32,r=e.x,a=e.y,n=e.z,h=e.w,l=r+r,o=a+a,_=n+n,m=r*l,u=r*o,d=r*_,c=a*o,f=a*_,p=n*_,g=h*l,T=h*o,y=h*_,E=s.x,x=s.y,v=s.z;return i[0]=(1-(c+p))*E,i[1]=(u+y)*E,i[2]=(d-T)*E,i[3]=0,i[4]=(u-y)*x,i[5]=(1-(m+p))*x,i[6]=(f+g)*x,i[7]=0,i[8]=(d+T)*v,i[9]=(f-g)*v,i[10]=(1-(m+c))*v,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}makeRotationFromQuaternion(t){return this.compose(a.default.ZERO,t,a.default.ONE)}makeRotationFromEuler(t){!t||t.isEuler;const e=this.m_localFS32,s=t.x,i=t.y,r=t.z,a=Math.cos(s),n=Math.sin(s),h=Math.cos(i),l=Math.sin(i),o=Math.cos(r),_=Math.sin(r);if("XYZ"===t.order){const t=a*o,s=a*_,i=n*o,r=n*_;e[0]=h*o,e[4]=-h*_,e[8]=l,e[1]=s+i*l,e[5]=t-r*l,e[9]=-n*h,e[2]=r-t*l,e[6]=i+s*l,e[10]=a*h}else if("YXZ"===t.order){const t=h*o,s=h*_,i=l*o,r=l*_;e[0]=t+r*n,e[4]=i*n-s,e[8]=a*l,e[1]=a*_,e[5]=a*o,e[9]=-n,e[2]=s*n-i,e[6]=r+t*n,e[10]=a*h}else if("ZXY"===t.order){const t=h*o,s=h*_,i=l*o,r=l*_;e[0]=t-r*n,e[4]=-a*_,e[8]=i+s*n,e[1]=s+i*n,e[5]=a*o,e[9]=r-t*n,e[2]=-a*l,e[6]=n,e[10]=a*h}else if("ZYX"===t.order){const t=a*o,s=a*_,i=n*o,r=n*_;e[0]=h*o,e[4]=i*l-s,e[8]=t*l+r,e[1]=h*_,e[5]=r*l+t,e[9]=s*l-i,e[2]=-l,e[6]=n*h,e[10]=a*h}else if("YZX"===t.order){const t=a*h,s=a*l,i=n*h,r=n*l;e[0]=h*o,e[4]=r-t*_,e[8]=i*_+s,e[1]=_,e[5]=a*o,e[9]=-n*o,e[2]=-l*o,e[6]=s*_+i,e[10]=t-r*_}else if("XZY"===t.order){const t=a*h,s=a*l,i=n*h,r=n*l;e[0]=h*o,e[4]=-_,e[8]=l*o,e[1]=t*_+r,e[5]=a*o,e[9]=s*_-i,e[2]=i*_-s,e[6]=n*o,e[10]=r*_+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}extractRotation(t){const e=this.m_localFS32,s=t.getLocalFS32(),i=h.m_v3;t.copyColumnTo(0,i);const r=1/i.getLength();t.copyColumnTo(1,i);const a=1/i.getLength();t.copyColumnTo(2,i);const n=1/i.getLength();return e[0]=s[0]*r,e[1]=s[1]*r,e[2]=s[2]*r,e[3]=0,e[4]=s[4]*a,e[5]=s[5]*a,e[6]=s[6]*a,e[7]=0,e[8]=s[8]*n,e[9]=s[9]*n,e[10]=s[10]*n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}copyTranslation(t){const e=this.m_localFS32,s=t.getLocalFS32();return e[12]=s[12],e[13]=s[13],e[14]=s[14],this}setTranslationXYZ(t,e,s){this.m_localFS32[12]=t,this.m_localFS32[13]=e,this.m_localFS32[14]=s}setTranslation(t){this.m_localFS32[12]=t.x,this.m_localFS32[13]=t.y,this.m_localFS32[14]=t.z}appendScaleXYZ(t,e,s){let i=this.m_localFS32;i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=e,i[5]*=e,i[6]*=e,i[7]*=e,i[8]*=s,i[9]*=s,i[10]*=s,i[11]*=s}appendScaleXY(t,e){this.m_localFS32[0]*=t,this.m_localFS32[1]*=t,this.m_localFS32[2]*=t,this.m_localFS32[3]*=t,this.m_localFS32[4]*=e,this.m_localFS32[5]*=e,this.m_localFS32[6]*=e,this.m_localFS32[7]*=e}appendTranslationXYZ(t,e,s){this.m_localFS32[12]+=t,this.m_localFS32[13]+=e,this.m_localFS32[14]+=s}appendTranslation(t){this.m_localFS32[12]+=t.x,this.m_localFS32[13]+=t.y,this.m_localFS32[14]+=t.z}copyColumnFrom(t,e){switch(t){case 0:this.m_localFS32[0]=e.x,this.m_localFS32[1]=e.y,this.m_localFS32[2]=e.z,this.m_localFS32[3]=e.w;break;case 1:this.m_localFS32[4]=e.x,this.m_localFS32[5]=e.y,this.m_localFS32[6]=e.z,this.m_localFS32[7]=e.w;break;case 2:this.m_localFS32[8]=e.x,this.m_localFS32[9]=e.y,this.m_localFS32[10]=e.z,this.m_localFS32[11]=e.w;break;case 3:this.m_localFS32[12]=e.x,this.m_localFS32[13]=e.y,this.m_localFS32[14]=e.z,this.m_localFS32[15]=e.w;break;default:break}}copyColumnTo(t,e){t<<=2,e.x=this.m_localFS32[t],e.y=this.m_localFS32[1+t],e.z=this.m_localFS32[2+t],e.w=this.m_localFS32[3+t]}setF32ArrAndIndex(t,e=0){null!=t&&e>=0&&(this.m_fs32=t,this.m_index=e,this.m_localFS32=this.m_fs32.subarray(e,e+16))}setF32ArrIndex(t=0){t>=0&&(this.m_index=t,this.m_localFS32=this.m_fs32.subarray(t,t+16))}setF32Arr(t){null!=t&&(this.m_fs32=t)}copyFromF32Arr(t,e=0){let s=0;for(let i=e+16;e<i;e++)this.m_localFS32[s]=t[e],++s}copyToF32Arr(t,e=0){t.set(this.m_localFS32,e)}copy(t){return this.m_localFS32.set(t.m_localFS32,0),this}copyFrom(t){this.m_localFS32.set(t.m_localFS32,0)}copyTo(t){t.m_localFS32.set(this.m_localFS32,0)}copyRawDataFrom(t,e=16,s=0,i=!1){i&&this.transpose(),e-=s;let r=0;while(r<e)this.m_fs32[this.m_index+r]=t[r+s],++r;i&&this.transpose()}copyRawDataTo(t,e=16,s=0,i=!1){i&&this.transpose();let r=0;while(r<e)t[r+s]=this.m_fs32[this.m_index+r],++r;i&&this.transpose()}copyRowFrom(t,e){switch(t){case 0:this.m_localFS32[0]=e.x,this.m_localFS32[4]=e.y,this.m_localFS32[8]=e.z,this.m_localFS32[12]=e.w;break;case 1:this.m_localFS32[1]=e.x,this.m_localFS32[5]=e.y,this.m_localFS32[9]=e.z,this.m_localFS32[13]=e.w;break;case 2:this.m_localFS32[2]=e.x,this.m_localFS32[6]=e.y,this.m_localFS32[10]=e.z,this.m_localFS32[14]=e.w;break;case 3:this.m_localFS32[3]=e.x,this.m_localFS32[7]=e.y,this.m_localFS32[11]=e.z,this.m_localFS32[15]=e.w;break;default:break}}copyRowTo(t,e){e.x=this.m_localFS32[t],e.y=this.m_localFS32[4+t],e.z=this.m_localFS32[8+t],e.w=this.m_localFS32[12+t]}decompose(t){let e=[],s=h.s_tMat4,i=s.getFS32();s.copyFrom(this);let l=new a.default(i[12],i[13],i[14]),o=new a.default;o.x=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),o.y=Math.sqrt(i[4]*i[4]+i[5]*i[5]+i[6]*i[6]),o.z=Math.sqrt(i[8]*i[8]+i[9]*i[9]+i[10]*i[10]),i[0]*(i[5]*i[10]-i[6]*i[9])-i[1]*(i[4]*i[10]-i[6]*i[8])+i[2]*(i[4]*i[9]-i[5]*i[8])<0&&(o.z=-o.z),i[0]/=o.x,i[1]/=o.x,i[2]/=o.x,i[4]/=o.y,i[5]/=o.y,i[6]/=o.y,i[8]/=o.z,i[9]/=o.z,i[10]/=o.z;let _=new a.default;switch(t){case n.default.AXIS_ANGLE:{_.w=r.default.SafeACos((i[0]+i[5]+i[10]-1)/2);let t=Math.sqrt((i[6]-i[9])*(i[6]-i[9])+(i[8]-i[2])*(i[8]-i[2])+(i[1]-i[4])*(i[1]-i[4]));t>r.default.MATH_MIN_POSITIVE?(_.x=(i[6]-i[9])/t,_.y=(i[8]-i[2])/t,_.z=(i[1]-i[4])/t):_.x=_.y=_.z=0}break;case n.default.QUATERNION:{let t=i[0]+i[5]+i[10];t>0?(_.w=Math.sqrt(1+t)/2,_.x=(i[6]-i[9])/(4*_.w),_.y=(i[8]-i[2])/(4*_.w),_.z=(i[1]-i[4])/(4*_.w)):i[0]>i[5]&&i[0]>i[10]?(_.x=Math.sqrt(1+i[0]-i[5]-i[10])/2,_.w=(i[6]-i[9])/(4*_.x),_.y=(i[1]+i[4])/(4*_.x),_.z=(i[8]+i[2])/(4*_.x)):i[5]>i[10]?(_.y=Math.sqrt(1+i[5]-i[0]-i[10])/2,_.x=(i[1]+i[4])/(4*_.y),_.w=(i[8]-i[2])/(4*_.y),_.z=(i[6]+i[9])/(4*_.y)):(_.z=Math.sqrt(1+i[10]-i[0]-i[5])/2,_.x=(i[8]+i[2])/(4*_.z),_.y=(i[6]+i[9])/(4*_.z),_.w=(i[1]-i[4])/(4*_.z))}break;case n.default.EULER_ANGLES:_.y=Math.asin(-i[2]),1!=i[2]&&-1!=i[2]?(_.x=Math.atan2(i[6],i[10]),_.z=Math.atan2(i[1],i[0])):(_.z=0,_.x=Math.atan2(i[4],i[5]));break;default:break}return e.push(l),e.push(_),e.push(o),s=null,e}invert(){let t=this.determinant(),e=Math.abs(t)>r.default.MATH_MIN_POSITIVE;if(e){let e=this.m_localFS32;t=1/t;let s=e[0],i=e[4],r=e[8],a=e[12],n=e[1],h=e[5],l=e[9],o=e[13],_=e[2],m=e[6],u=e[10],d=e[14],c=e[3],f=e[7],p=e[11],g=e[15];e[0]=t*(h*(u*g-d*p)-l*(m*g-d*f)+o*(m*p-u*f)),e[1]=-t*(n*(u*g-d*p)-l*(_*g-d*c)+o*(_*p-u*c)),e[2]=t*(n*(m*g-d*f)-h*(_*g-d*c)+o*(_*f-m*c)),e[3]=-t*(n*(m*p-u*f)-h*(_*p-u*c)+l*(_*f-m*c)),e[4]=-t*(i*(u*g-d*p)-r*(m*g-d*f)+a*(m*p-u*f)),e[5]=t*(s*(u*g-d*p)-r*(_*g-d*c)+a*(_*p-u*c)),e[6]=-t*(s*(m*g-d*f)-i*(_*g-d*c)+a*(_*f-m*c)),e[7]=t*(s*(m*p-u*f)-i*(_*p-u*c)+r*(_*f-m*c)),e[8]=t*(i*(l*g-o*p)-r*(h*g-o*f)+a*(h*p-l*f)),e[9]=-t*(s*(l*g-o*p)-r*(n*g-o*c)+a*(n*p-l*c)),e[10]=t*(s*(h*g-o*f)-i*(n*g-o*c)+a*(n*f-h*c)),e[11]=-t*(s*(h*p-l*f)-i*(n*p-l*c)+r*(n*f-h*c)),e[12]=-t*(i*(l*d-o*u)-r*(h*d-o*m)+a*(h*u-l*m)),e[13]=t*(s*(l*d-o*u)-r*(n*d-o*_)+a*(n*u-l*_)),e[14]=-t*(s*(h*d-o*m)-i*(n*d-o*_)+a*(n*m-h*_)),e[15]=t*(s*(h*u-l*m)-i*(n*u-l*_)+r*(n*m-h*_))}return e}invertThis(){return this.invert(),this}pointAt(t,e,s){null!=e&&void 0!=e||(e=new a.default(0,0,-1)),null!=s&&void 0!=s||(s=new a.default(0,-1,0));let i=e.subtract(t),n=new a.default(s.x,s.y,s.z);i.normalize(),n.normalize();let h=new a.default(i.x,i.y,i.z);h.scaleBy(n.dot(i)),n.subtractBy(h),n.getLength()>r.default.MATH_MIN_POSITIVE?n.normalize():0!=i.x?n.setTo(-i.y,i.x,0):n.setTo(1,0,0);let l=n.crossProduct(i);l.normalize();let o=this.m_localFS32;o[0]=l.x,o[4]=l.y,o[8]=l.z,o[12]=0,o[1]=n.x,o[5]=n.y,o[9]=n.z,o[13]=0,o[2]=i.x,o[6]=i.y,o[10]=i.z,o[14]=0,o[3]=t.x,o[7]=t.y,o[11]=t.z,o[15]=1}prepend(t){let e=t.getLocalFS32(),s=this.m_localFS32,i=e[0],r=e[4],a=e[8],n=e[12],h=e[1],l=e[5],o=e[9],_=e[13],m=e[2],u=e[6],d=e[10],c=e[14],f=e[3],p=e[7],g=e[11],T=e[15],y=s[0],E=s[4],x=s[8],v=s[12],S=s[1],b=s[5],A=s[9],R=s[13],M=s[2],D=s[6],L=s[10],P=s[14],B=s[3],F=s[7],w=s[11],C=s[15];s[0]=i*y+h*E+m*x+f*v,s[1]=i*S+h*b+m*A+f*R,s[2]=i*M+h*D+m*L+f*P,s[3]=i*B+h*F+m*w+f*C,s[4]=r*y+l*E+u*x+p*v,s[5]=r*S+l*b+u*A+p*R,s[6]=r*M+l*D+u*L+p*P,s[7]=r*B+l*F+u*w+p*C,s[8]=a*y+o*E+d*x+g*v,s[9]=a*S+o*b+d*A+g*R,s[10]=a*M+o*D+d*L+g*P,s[11]=a*B+o*F+d*w+g*C,s[12]=n*y+_*E+c*x+T*v,s[13]=n*S+_*b+c*A+T*R,s[14]=n*M+_*D+c*L+T*P,s[15]=n*B+_*F+c*w+T*C}prepend3x3(t){let e=t.getLocalFS32(),s=this.m_localFS32,i=e[0],r=e[4],a=e[8],n=e[1],h=e[5],l=e[9],o=e[2],_=e[6],m=e[10],u=s[0],d=s[4],c=s[8],f=s[1],p=s[5],g=s[9],T=s[2],y=s[6],E=s[10];s[0]=i*u+n*d+o*c,s[1]=i*f+n*p+o*g,s[2]=i*T+n*y+o*E,s[4]=r*u+h*d+_*c,s[5]=r*f+h*p+_*g,s[6]=r*T+h*y+_*E,s[8]=a*u+l*d+m*c,s[9]=a*f+l*p+m*g,s[10]=a*T+l*y+m*E}prependRotationPivot(t,e,s){h.s_tMat4.identity(),h.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),h.s_tMat4.appendTranslationXYZ(s.x,s.y,s.z),this.prepend(h.s_tMat4)}prependRotation(t,e){h.s_tMat4.identity(),h.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),this.prepend(h.s_tMat4)}prependRotationX(t){h.s_tMat4.rotationX(t),this.prepend3x3(h.s_tMat4)}prependRotationY(t){h.s_tMat4.rotationY(t),this.prepend3x3(h.s_tMat4)}prependRotationZ(t){h.s_tMat4.rotationZ(t),this.prepend3x3(h.s_tMat4)}prependRotationEulerAngle(t,e,s){h.s_tMat4.rotationY(e),this.prepend3x3(h.s_tMat4),h.s_tMat4.rotationX(t),this.prepend3x3(h.s_tMat4),h.s_tMat4.rotationZ(s),this.prepend3x3(h.s_tMat4)}prependScale(t,e,s){let i=this.m_localFS32;i[0]*=t,i[1]*=e,i[2]*=s,i[4]*=t,i[5]*=e,i[6]*=s,i[8]*=t,i[9]*=e,i[10]*=s,i[12]*=t,i[13]*=e,i[14]*=s}prependScaleXY(t,e){this.m_localFS32[0]*=t,this.m_localFS32[1]*=e,this.m_localFS32[4]*=t,this.m_localFS32[5]*=e,this.m_localFS32[8]*=t,this.m_localFS32[9]*=e,this.m_localFS32[12]*=t,this.m_localFS32[13]*=e}prependTranslationXYZ(t,e,s){h.s_tMat4.identity(),this.prepend(h.s_tMat4)}prependTranslation(t){h.s_tMat4.identity(),this.prepend(h.s_tMat4)}recompose(t,e){if(t.length<3||0==t[2].x||0==t[2].y||0==t[2].z)return!1;this.identity();let s=h.s_tMat4.getFS32();s[0]=s[1]=s[2]=t[2].x,s[4]=s[5]=s[6]=t[2].y,s[8]=s[9]=s[10]=t[2].z;let i=this.m_localFS32;switch(e){case n.default.EULER_ANGLES:{let e=Math.cos(t[1].x),r=Math.cos(t[1].y),a=Math.cos(t[1].z),n=Math.sin(t[1].x),h=Math.sin(t[1].y),l=Math.sin(t[1].z);i[0]=r*a*s[0],i[1]=r*l*s[1],i[2]=-h*s[2],i[3]=0,i[4]=(n*h*a-e*l)*s[4],i[5]=(n*h*l+e*a)*s[5],i[6]=n*r*s[6],i[7]=0,i[8]=(e*h*a+n*l)*s[8],i[9]=(e*h*l-n*a)*s[9],i[10]=e*r*s[10],i[11]=0,i[12]=t[0].x,i[13]=t[0].y,i[14]=t[0].z,i[15]=1}break;default:{let r=t[1].x,a=t[1].y,h=t[1].z,l=t[1].w;if(e==n.default.AXIS_ANGLE){let t=.5*l;r*=Math.sin(t),a*=Math.sin(t),h*=Math.sin(t),l=Math.cos(t)}i[0]=(1-2*a*a-2*h*h)*s[0],i[1]=(2*r*a+2*l*h)*s[1],i[2]=(2*r*h-2*l*a)*s[2],i[3]=0,i[4]=(2*r*a-2*l*h)*s[4],i[5]=(1-2*r*r-2*h*h)*s[5],i[6]=(2*a*h+2*l*r)*s[6],i[7]=0,i[8]=(2*r*h+2*l*a)*s[8],i[9]=(2*a*h-2*l*r)*s[9],i[10]=(1-2*r*r-2*a*a)*s[10],i[11]=0,i[12]=t[0].x,i[13]=t[0].y,i[14]=t[0].z,i[15]=1}break}return 0==t[2].x&&(this.m_localFS32[0]=0),0==t[2].y&&(this.m_localFS32[5]=0),0==t[2].z&&(this.m_localFS32[10]=0),s=null,!0}setThreeAxes(t,e,s){let i=this.m_localFS32;i[0]=t.x,i[1]=t.y,i[2]=t.z,i[4]=e.x,i[5]=e.y,i[6]=e.z,i[8]=s.x,i[9]=s.y,i[10]=s.z}deltaTransformVector(t){let e=t.x,s=t.y,i=t.z;return new a.default(e*this.m_localFS32[0]+s*this.m_localFS32[4]+i*this.m_localFS32[8],e*this.m_localFS32[1]+s*this.m_localFS32[5]+i*this.m_localFS32[9],e*this.m_localFS32[2]+s*this.m_localFS32[6]+i*this.m_localFS32[10],0)}deltaTransformVectorSelf(t){let e=this.m_localFS32,s=t.x,i=t.y,r=t.z;t.x=s*e[0]+i*e[4]+r*e[8],t.y=s*e[1]+i*e[5]+r*e[9],t.z=s*e[2]+i*e[6]+r*e[10]}deltaTransformOutVector(t,e){let s=this.m_localFS32;e.x=t.x*s[0]+t.y*s[4]+t.z*s[8],e.y=t.x*s[1]+t.y*s[5]+t.z*s[9],e.z=t.x*s[2]+t.y*s[6]+t.z*s[10]}transformVector(t){let e=this.m_localFS32,s=t.x,i=t.y,r=t.z;return new a.default(s*e[0]+i*e[4]+r*e[8]+e[12],s*e[1]+i*e[5]+r*e[9]+e[13],s*e[2]+i*e[6]+r*e[10]+e[14],s*e[3]+i*e[7]+r*e[11]+e[15])}transformOutVector(t,e){let s=t.x,i=t.y,r=t.z,a=this.m_localFS32;e.setTo(s*a[0]+i*a[4]+r*a[8]+a[12],s*a[1]+i*a[5]+r*a[9]+a[13],s*a[2]+i*a[6]+r*a[10]+a[14],s*a[3]+i*a[7]+r*a[11]+a[15])}transformOutVector3(t,e){let s=this.m_localFS32;e.x=t.x*s[0]+t.y*s[4]+t.z*s[8]+s[12],e.y=t.x*s[1]+t.y*s[5]+t.z*s[9]+s[13],e.z=t.x*s[2]+t.y*s[6]+t.z*s[10]+s[14]}transformVector3Self(t){let e=t.x,s=t.y,i=t.z,r=this.m_localFS32;t.x=e*r[0]+s*r[4]+i*r[8]+r[12],t.y=e*r[1]+s*r[5]+i*r[9]+r[13],t.z=e*r[2]+s*r[6]+i*r[10]+r[14]}transformVectorSelf(t){let e=t.x,s=t.y,i=t.z,r=this.m_localFS32;t.setTo(e*r[0]+s*r[4]+i*r[8]+r[12],e*r[1]+s*r[5]+i*r[9]+r[13],e*r[2]+s*r[6]+i*r[10]+r[14],e*r[3]+s*r[7]+i*r[11]+r[15])}transformVectors(t,e,s){let i,r,a,n=0,h=this.m_localFS32;e-=3;while(n<=e)i=t[n],r=t[n+1],a=t[n+2],s[n]=i*h[0]+r*h[4]+a*h[8]+h[12],s[n+1]=i*h[1]+r*h[5]+a*h[9]+h[13],s[n+2]=i*h[2]+r*h[6]+a*h[10]+h[14],n+=3}transformVectorsSelf(t,e){let s,i,r,a=0,n=this.m_localFS32;e-=3;while(a<=e)s=t[a],i=t[a+1],r=t[a+2],t[a]=s*n[0]+i*n[4]+r*n[8]+n[12],t[a+1]=s*n[1]+i*n[5]+r*n[9]+n[13],t[a+2]=s*n[2]+i*n[6]+r*n[10]+n[14],a+=3}transformVectorsRangeSelf(t,e,s){let i,r,a,n=e,h=this.m_localFS32;s-=3;while(n<=s)i=t[n],r=t[n+1],a=t[n+2],t[n]=i*h[0]+r*h[4]+a*h[8]+h[12],t[n+1]=i*h[1]+r*h[5]+a*h[9]+h[13],t[n+2]=i*h[2]+r*h[6]+a*h[10]+h[14],n+=3}transpose(){h.s_tMat4.copyFrom(this);let t=h.s_tMat4.getFS32(),e=this.m_localFS32;e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11]}interpolateTo(t,e){let s=t.getFS32(),i=t.getFSIndex(),r=0,a=this.m_index;while(r<16)this.m_fs32[a]+=(s[i+r]-this.m_fs32[a])*e,++a,++r}getAxisRotation(t,e,s,i){i=-i;let r=this.m_localFS32,a=Math.sin(i),n=Math.cos(i),h=1-n;r[0]=n+t*t*h,r[5]=n+e*e*h,r[10]=n+s*s*h;let l=t*e*h,o=s*a;r[4]=l+o,r[1]=l-o,l=t*s*h,o=e*a,r[8]=l-o,r[2]=l+o,l=e*s*h,o=t*a,r[9]=l+o,r[6]=l-o}rotationX(t){let e=Math.sin(t),s=Math.cos(t);this.m_localFS32[0]=1,this.m_localFS32[1]=0,this.m_localFS32[2]=0,this.m_localFS32[4]=0,this.m_localFS32[5]=s,this.m_localFS32[6]=e,this.m_localFS32[8]=0,this.m_localFS32[9]=-e,this.m_localFS32[10]=s}rotationY(t){let e=Math.sin(t),s=Math.cos(t);this.m_localFS32[0]=s,this.m_localFS32[1]=0,this.m_localFS32[2]=-e,this.m_localFS32[4]=0,this.m_localFS32[5]=1,this.m_localFS32[6]=0,this.m_localFS32[8]=e,this.m_localFS32[9]=0,this.m_localFS32[10]=s}rotationZ(t){let e=Math.sin(t),s=Math.cos(t);this.m_localFS32[0]=s,this.m_localFS32[1]=e,this.m_localFS32[2]=0,this.m_localFS32[4]=-e,this.m_localFS32[5]=s,this.m_localFS32[6]=0,this.m_localFS32[8]=0,this.m_localFS32[9]=0,this.m_localFS32[10]=1}toString(){let t="\n"+this.m_localFS32[0]+","+this.m_localFS32[1]+","+this.m_localFS32[2]+","+this.m_localFS32[3]+"\n";return t+=this.m_localFS32[4]+","+this.m_localFS32[5]+","+this.m_localFS32[6]+","+this.m_localFS32[7]+"\n",t+=this.m_localFS32[8]+","+this.m_localFS32[9]+","+this.m_localFS32[10]+","+this.m_localFS32[11]+"\n",t+=this.m_localFS32[12]+","+this.m_localFS32[13]+","+this.m_localFS32[14]+","+this.m_localFS32[15]+"\n",t}transformPerspV4Self(t){t.w=t.z,t.x*=this.m_localFS32[0],t.y*=this.m_localFS32[5],t.z*=this.m_localFS32[10],t.z+=this.m_localFS32[14],t.w*=this.m_localFS32[11],t.w+=this.m_localFS32[15]}clone(){let t=new h;return t.copyFrom(this),t}perspectiveRH(t,e,s,i){let r=Math.tan(.5*t);this.identity(),this.m_localFS32[0]=1/(e*r),this.m_localFS32[5]=1/r,this.m_localFS32[10]=-(i+s)/(i-s),this.m_localFS32[11]=-1,this.m_localFS32[14]=-2*i*s/(i-s)}perspectiveRH2(t,e,s,i,r){let a=e/Math.tan(.5*t),n=a/e,h=a/s,l=-r/(r-i),o=-i*l;this.identity(),this.m_localFS32[0]=n,this.m_localFS32[5]=h,this.m_localFS32[10]=l,this.m_localFS32[11]=-1,this.m_localFS32[14]=o}orthoRH(t,e,s,i,r,a){this.identity(),this.m_localFS32[0]=2/(i-s),this.m_localFS32[5]=2/(e-t),this.m_localFS32[10]=-2/(a-r),this.m_localFS32[12]=-(i+s)/(i-s),this.m_localFS32[13]=-(e+t)/(e-t),this.m_localFS32[14]=-(a+r)/(a-r),this.m_localFS32[15]=1}perspectiveLH(t,e,s,i){let r=Math.tan(.5*t);this.identity(),this.m_localFS32[0]=1/(e*r),this.m_localFS32[5]=1/r,this.m_localFS32[10]=(i+s)/(i-s),this.m_localFS32[11]=1,this.m_localFS32[14]=2*i*s/(i-s)}orthoLH(t,e,s,i,r,a){this.identity(),this.m_localFS32[0]=2/(i-s),this.m_localFS32[5]=2/(e-t),this.m_localFS32[10]=2/(a-r),this.m_localFS32[12]=-(i+s)/(i-s),this.m_localFS32[13]=-(e+t)/(e-t),this.m_localFS32[14]=-(a+r)/(a-r),this.m_localFS32[15]=1}lookAtRH(t,e,s){this.identity();let i=e.subtract(t);i.normalize();let r=i.crossProduct(s);r.normalize();let a=r.crossProduct(i);r.w=-r.dot(t),a.w=-a.dot(t),i.w=i.dot(t),i.negate(),this.copyRowFrom(0,r),this.copyRowFrom(1,a),this.copyRowFrom(2,i)}lookAtLH(t,e,s){this.identity();let i=e.subtract(t);i.normalize();let r=i.crossProduct(s);r.normalize();let a=r.crossProduct(i);r.w=-r.dot(t),a.w=-a.dot(t),i.w=-i.dot(t),this.copyRowFrom(0,r),this.copyRowFrom(1,a),this.copyRowFrom(2,i)}destroy(){this.m_localFS32=null,this.m_fs32=null,this.m_index=-1}}h.s_InitData=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),h.m_v3=new a.default,h.s_uid=0,h.s_isolatedUid=327679,h.s_tMat4=new h,e.default=h},"1e15":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("030e"));class n{constructor(){this.m_rcuid=0,this.m_glVer=2,this.m_rc=null,this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.vroUid=0,this.rioUid=0}getRC(){return this.m_rc}getRCUid(){return this.m_rcuid}createBuf(){return this.m_rc.createBuffer()}deleteBuf(t){this.m_rc.deleteBuffer(t)}bindArrBuf(t){this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,t)}bindEleBuf(t){this.m_rc.bindBuffer(this.m_rc.ELEMENT_ARRAY_BUFFER,t)}arrBufSubData(t,e){this.m_rc.bufferSubData(this.m_rc.ARRAY_BUFFER,e,t)}arrBufData(t,e){this.m_rc.bufferData(this.m_rc.ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}eleBufSubData(t,e){this.m_rc.bufferSubData(this.m_rc.ELEMENT_ARRAY_BUFFER,e,t)}eleBufData(t,e){this.m_rc.bufferData(this.m_rc.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}arrBufDataMem(t,e){this.m_rc.bufferData(this.m_rc.ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}eleBufDataMem(t,e){this.m_rc.bufferData(this.m_rc.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}useVtxAttribsPtrTypeFloat(t,e,s,i,r,a){this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,e);for(let n=0;n<i;++n)t.vertexAttribPointerTypeFloat(s[n],a,r[n])}useVtxAttribsPtrTypeFloatMulti(t,e,s,i,r,a){for(let n=0;n<i;++n)this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,e[n]),t.vertexAttribPointerTypeFloat(s[n],a,r[n])}createVertexArray(){let t=null;return t=2==this.m_glVer?this.m_rc.createVertexArray():a.default.OES_vertex_array_object.createVertexArrayOES(),t}bindVertexArray(t){return 2==this.m_glVer?this.m_rc.bindVertexArray(t):a.default.OES_vertex_array_object.bindVertexArrayOES(t),t}deleteVertexArray(t){2==this.m_glVer?this.m_rc.deleteVertexArray(t):a.default.OES_vertex_array_object.deleteVertexArrayOES(t)}testVROUid(t){return this.vroUid!=t&&(this.vroUid=t,!0)}testRIOUid(t){return this.rioUid!=t&&(this.rioUid=t,!0)}initialize(t,e,s){this.m_rc=e,this.m_rcuid=t,this.m_glVer=s;let i=this;i.RGBA=e.RGBA,i.UNSIGNED_BYTE=e.UNSIGNED_BYTE,i.TRIANGLE_STRIP=e.TRIANGLE_STRIP,i.TRIANGLE_FAN=e.TRIANGLE_FAN,i.TRIANGLES=e.TRIANGLES,i.LINES=this.m_rc.LINES,i.LINE_STRIP=e.LINE_STRIP,i.UNSIGNED_SHORT=e.UNSIGNED_SHORT,i.UNSIGNED_INT=e.UNSIGNED_INT,i.COLOR=e.COLOR,i.DEPTH=e.DEPTH,i.STENCIL=e.STENCIL,i.DEPTH_STENCIL=e.DEPTH_STENCIL,this.m_glVer>1?(i.MIN=e.MIN,i.MAX=e.MAX):(i.MIN=a.default.EXT_blend_minmax.MIN_EXT,i.MAX=a.default.EXT_blend_minmax.MAX_EXT),i.RContext=e}renderBegin(){this.vroUid=-2,this.rioUid=-3}}e.default=n},"1e86":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.DATA_PARSE=3501,i.DATA_QUEUE_PARSE=3502,i.THREAD_INIT=3601,i.INIT_COMMON_MODULE=3621,i.THREAD_ACQUIRE_DATA=3631,i.THREAD_TRANSMIT_DATA=3632,i.INIT_TASK=3701,i.INIT_PARAM=3801,e.ThreadCMD=i},"1eb2":function(t,e,s){"use strict";if("undefined"!==typeof window){var i=window.document.currentScript,r=s("8875");i=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var a=i&&i.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(s.p=a[1])}},"1f61":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("030e"));class a{static ToGL(t,e){switch(e){case a.UNSIGNED_BYTE:return t.UNSIGNED_BYTE;case a.BYTE:return t.BYTE;case a.FLOAT:return t.FLOAT;case a.HALF_FLOAT:return t.HALF_FLOAT;case a.HALF_FLOAT_OES:return null!=r.default.OES_texture_half_float?r.default.OES_texture_half_float.HALF_FLOAT_OES:t.FLOAT;case a.UNSIGNED_SHORT:return t.UNSIGNED_SHORT;case a.UNSIGNED_INT:return t.UNSIGNED_INT;case a.UNSIGNED_SHORT_5_6_5:return t.UNSIGNED_SHORT_5_6_5;case a.UNSIGNED_SHORT_4_4_4_4:return t.UNSIGNED_SHORT_4_4_4_4;case a.UNSIGNED_SHORT_5_5_5_1:return t.UNSIGNED_SHORT_5_5_5_1;case a.UNSIGNED_INT_24_8_WEBGL:return r.default.WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL;default:break}return t.UNSIGNED_BYTE}}a.UNSIGNED_BYTE=1108,a.UNSIGNED_SHORT=1109,a.UNSIGNED_INT=1110,a.BYTE=1111,a.FLOAT=1211,a.HALF_FLOAT=1212,a.HALF_FLOAT_OES=1213,a.UNSIGNED_SHORT_5_6_5=1214,a.UNSIGNED_SHORT_4_4_4_4=1215,a.UNSIGNED_SHORT_5_5_5_1=1216,a.UNSIGNED_INT_24_8_WEBGL=1217,e.default=a},"1f9e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.PARSE="CTM_PARSE",i.LOAD_AND_PARSE="CTM_LOAD_AND_PARSE",e.CTMTaskCMD=i},2033:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("698b");class r{constructor(){this.dataPhaseFlag=i.DataPhaseFlag.PHASE_NONE,this.dataUnitUUID=0,this.listUUID=0}receiveDataUnit(t,e){}}e.DataReceiverBase=r},"20ef":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("8a0a"));class n{constructor(t){this.m_shdData=null,this.m_uid=-1,this.m_program=null,this.m_rcuid=-1,this.m_gl=null,this.m_shdUniqueName="",this.m_texTotal=0,this.m_aLocations=null,this.m_aLocationTypes=null,this.m_aLocationSizes=null,this.m_uLocations=null,this.m_texLocations=null,this.m_attribLIndexList=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.m_attribTypeSizeList=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.m_attriSizeList=null,this.m_uniformDict=new Map,this.m_uLocationDict=new Map,this.m_vertShader=null,this.m_fragShader=null,this.dataUniformEnabled=!1,this.m_attrid=0,this.m_attridIndex=0,this.m_uLc=null,this.m_uIndex=0,this.m_uid=t}setShdData(t){this.m_shdData=t,this.m_shdUniqueName=t.getUniqueShaderName()}getUid(){return this.m_uid}getTexTotal(){return this.m_shdData.getTexTotal()}useTexLocation(){for(let t=0;t<this.m_texTotal;t++)this.m_gl.uniform1i(this.m_texLocations[t],t)}haveTexture(){return this.m_shdData.haveTexture()}createLocations(){let t=0,e=0,s=this.m_shdData.getAttriNSList();if(null!=s&&s.length>0&&null==this.m_aLocations){this.dataUniformEnabled=!1;let i=this.m_shdData.getAttriSizeList();this.m_aLocations=[],this.m_aLocationTypes=[],this.m_aLocationSizes=[],e=s.length;let n=0,h=0;while(t<e)h=this.m_gl.getAttribLocation(this.m_program,s[t]),this.m_aLocations.push(h),n=a.default.GetVBufAttributeTypeByNS(s[t]),this.m_aLocationTypes.push(n),this.m_aLocationSizes.push(i[t]),this.m_attribLIndexList[n]=h,this.m_attribTypeSizeList[n]=i[t],this.dataUniformEnabled=!0,++t;for(this.m_attriSizeList=[],t=0;t<this.m_attribTypeSizeList.length;++t)this.m_attribTypeSizeList[t]>0&&this.m_attriSizeList.push(this.m_attribTypeSizeList[t]);r.default.SHADERCODE_TRACE_ENABLED}if(this.m_shdData.haveCommonUniform()&&null==this.m_uLocations){let s=this.m_shdData.getUniforms();this.m_uLocations=[],e=s.length,t=0;let i=null,a="";while(t<e)s[t].isTex||(a=s[t].name,i=this.m_gl.getUniformLocation(this.m_program,a),r.default.SHADERCODE_TRACE_ENABLED,null!=i?(i.uniformName=a,i.uniqueName=this.m_shdUniqueName,s[t].location=i,this.m_uniformDict.set(a,s[t]),this.m_uLocationDict.set(a,i),this.m_uLocations.push(i),this.dataUniformEnabled=!0):r.default.SHADERCODE_TRACE_ENABLED),++t}if(this.m_texTotal=this.m_shdData.getTexTotal(),this.m_texTotal>0){this.m_texLocations=new Array(this.m_texTotal);let e=this.m_shdData.getTexUniformNames();for(t=0;t<this.m_texTotal;++t)e[t]="u_sampler"+t,this.m_texLocations[t]=this.m_gl.getUniformLocation(this.m_program,e[t])}}getLayoutBit(){return this.m_shdData.getLayoutBit()}getMid(){return this.m_shdData.getMid()}getFragOutputTotal(){return this.m_shdData.getFragOutputTotal()}getLocationsTotal(){return this.m_aLocationTypes.length}getLocationTypeByIndex(t){return this.m_aLocationTypes[t]}getLocationSizeByIndex(t){return this.m_aLocationSizes[t]}testVertexAttribPointerOffset(t){let e=!1;if(null!=t&&null!=this.m_attriSizeList&&t.length>=this.m_attriSizeList.length){let s=0,i=0;for(;i<this.m_attriSizeList.length;++i){if(s!=t[i])break;s+=4*this.m_attriSizeList[i]}e=i>=this.m_attriSizeList.length}if(!e)throw Error("Shader program vertx attributes layout can not match float attribute vertex data !!!");return e}vertexAttribPointerType(t,e,s,i,r,a){this.m_attrid=this.m_attribLIndexList[t],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,this.m_attribTypeSizeList[t],s,i,r,a))}vertexAttribPointerTypeFloat(t,e,s){this.m_attrid=this.m_attribLIndexList[t],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,this.m_attribTypeSizeList[t],this.m_gl.FLOAT,!1,e,s))}testVertexAttribPointerType(t){return this.m_attribLIndexList[t]>-1}getVertexAttribByTpye(t){return this.m_attribLIndexList[t]}vertexAttribPointerAt(t,e,s,i,r,a){this.m_attridIndex=t,this.m_attrid=this.m_aLocations[t],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,e,s,i,r,a))}vertexAttribPointerNext(t,e,s,i,r){this.m_attrid=this.m_aLocations[this.m_attridIndex],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,t,e,s,i,r)),this.m_attridIndex++}vertexAttribPointerFirst(t,e,s,i,r){this.m_attridIndex=1,this.m_attrid=this.m_aLocations[0],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,t,e,s,i,r))}getUniformLocationAt(t){return this.m_uIndex=t+1,this.m_uLocations[t]}getUniformLocationNext(){return this.m_uLc=this.m_uLocations[this.m_uIndex++],this.m_uLc}getUniformLocationFirst(){return this.m_uIndex=1,this.m_uLocations[0]}getUniformLocationByNS(t){return this.m_uLocationDict.get(t)}getUniformTypeNameByNS(t){return this.m_uniformDict.has(t)?this.m_uniformDict.get(t).typeName:""}getUniformTypeByNS(t){return this.m_uniformDict.has(t)?this.m_uniformDict.get(t).type:0}hasUniformByName(t){return this.m_uniformDict.has(t)}getUniformLengthByNS(t){return this.m_uniformDict.has(t)?this.m_uniformDict.get(t).arrLength:0}initShdProgram(){let t,e=this.m_gl,s=this.m_shdData.getVSCodeStr(),i=this.m_shdData.getFSCodeStr();null==this.m_shdData.preCompileInfo&&r.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(s.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),s=s.replace(t," highp ")),s.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),s=s.replace(t," highp "))),r.default.SHADERCODE_TRACE_ENABLED;let a=this.loadShader(e.VERTEX_SHADER,s);null==this.m_shdData.preCompileInfo&&r.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(i.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),i=i.replace(t," highp ")),i.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),i=i.replace(t," highp "))),r.default.SHADERCODE_TRACE_ENABLED;let n=this.loadShader(e.FRAGMENT_SHADER,i),h=e.createProgram();return e.attachShader(h,n),e.attachShader(h,a),e.linkProgram(h),e.getProgramParameter(h,e.LINK_STATUS)?(this.m_vertShader=a,this.m_fragShader=n,e.detachShader(h,a),e.detachShader(h,n),e.deleteShader(a),e.deleteShader(n),h):(r.default.SHADERCODE_TRACE_ENABLED,null)}loadShader(t,e){let s=this.m_gl.createShader(t);return this.m_gl.shaderSource(s,e),this.m_gl.compileShader(s),this.m_gl.getShaderParameter(s,this.m_gl.COMPILE_STATUS)?s:(r.default.SHADERCODE_TRACE_ENABLED,this.m_gl.deleteShader(s),null)}getUniqueShaderName(){return this.m_shdUniqueName}enabled(){return null!=this.m_program}upload(t,e){null==this.m_program&&(this.m_rcuid=e,this.m_gl=t,this.m_program=this.initShdProgram(),this.m_program.uniqueName=this.m_shdUniqueName,null!=this.m_program&&this.createLocations())}getRCUid(){return this.m_rcuid}uniformBlockBinding(t,e){this.m_gl.uniformBlockBinding(this.m_program,this.m_gl.getUniformBlockIndex(this.m_program,t),e)}toString(){return"[ShdProgram(uniqueName = "+this.m_shdUniqueName+")]"}getGPUProgram(){return this.m_program}destroy(){this.m_aLocations=null,this.m_attriSizeList=null,this.m_texTotal>0&&(this.m_texLocations.fill(null),this.m_texTotal=0),null!=this.m_program&&(this.m_gl.deleteShader(this.m_vertShader),this.m_gl.deleteShader(this.m_fragShader),this.m_vertShader=null,this.m_fragShader=null,this.m_gl.deleteProgram(this.m_program),this.m_program=null),this.m_gl=null,this.m_shdData=null}}e.default=n},2139:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("18c7"));class a{static GetMatTotal(){return a.s_mtotal}static GetFS32Arr(){return a.s_mfs32Arr}static SetFS32Arr(t){a.s_mfs32Arr=t;let e=a.s_mtotal,s=a.s_matList;for(let i=0;i<e;++i)s[i].setF32Arr(t)}static GetFreeId(){return a.m_freeIdList.length>0?a.m_freeIdList.pop():-1}static Allocate(t){if(t<1024&&(t=1024),a.s_mtotal<1){a.s_mtotal=t,a.s_mfs32Arr=new Float32Array(16*t);let e=0,s=new r.default(a.s_mfs32Arr,16*e),i=s.getUid();for(a.s_baseUid=i,a.s_maxUid=i+t;e<i;++e)a.s_matList.push(null),a.s_matFlagList.push(a.s_FLAG_FREE);for(a.s_matList.push(s),a.s_matFlagList.push(a.s_FLAG_FREE),a.m_freeIdList.push(s.getUid()),e=1;e<t;++e)s=new r.default(a.s_mfs32Arr,16*e),a.s_matList.push(s),a.s_matFlagList.push(a.s_FLAG_FREE),a.m_freeIdList.push(s.getUid())}}static GetMatrix(){let t=null,e=a.GetFreeId()-a.s_baseUid;return e>=0?(t=a.s_matList[e],t.identity(),a.s_matFlagList[e]=a.s_FLAG_BUSY):t=new r.default,t}static RetrieveMatrix(t){if(null!=t){let e=t.getUid();e>=a.s_baseUid&&e<a.s_maxUid&&a.s_matFlagList[e-a.s_baseUid]==a.s_FLAG_BUSY&&(a.m_freeIdList.push(e),a.s_matFlagList[e-a.s_baseUid]=a.s_FLAG_FREE)}}}a.s_FLAG_BUSY=1,a.s_FLAG_FREE=0,a.s_matList=[],a.s_matFlagList=[],a.m_freeIdList=[],a.s_mfs32Arr=null,a.s_baseUid=0,a.s_maxUid=0,a.s_mtotal=0,e.default=a},2356:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.taskclass=-1,this.srcuid=-1,this.dataIndex=-1,this.streams=null,this.sendStatus=-1,this.wfst=0}buildThis(t){}reset(){}static GetFreeId(){return i.m_freeIdList.length>0?i.m_freeIdList.pop():-1}static Create(){let t=null,e=i.GetFreeId();return e>=0?(t=i.m_unitList[e],t.dataIndex=e,i.m_unitFlagList[e]=i.s_FLAG_BUSY):(t=new i,i.m_unitList.push(t),i.m_unitFlagList.push(i.s_FLAG_BUSY),t.dataIndex=i.m_unitListLen,i.m_unitListLen++),t}static Contains(t){if(null!=t){let e=t.dataIndex;if(e>=0&&e<i.m_unitListLen)return i.m_unitList[e]==t}return!1}static Restore(t){if(i.Contains(t)){let e=t.dataIndex;i.m_unitFlagList[e]==i.s_FLAG_BUSY&&(i.m_freeIdList.push(e),i.m_unitFlagList[e]=i.s_FLAG_FREE,t.sendStatus=-1,t.reset())}}static RestoreByUid(t){t>=0&&i.m_unitFlagList[t]==i.s_FLAG_BUSY&&(i.m_freeIdList.push(t),i.m_unitFlagList[t]=i.s_FLAG_FREE,i.m_unitList[t].reset())}}i.s_FLAG_BUSY=1,i.s_FLAG_FREE=0,i.m_unitFlagList=[],i.m_unitListLen=0,i.m_unitList=[],i.m_freeIdList=[],e.ThreadSendData=i},2560:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73"));class a{create(t,e){let s=t.getCamera();return e.hasUniformByName(r.default.CameraViewMatUNS)&&e.hasUniformByName(r.default.CameraProjectiveMatUNS)?t.uniformContext.createShaderGlobalUniformFromProbe(s.matUProbe,"u_viewAndProjMat",[r.default.CameraViewMatUNS,r.default.CameraProjectiveMatUNS]):e.hasUniformByName(r.default.CameraViewMatUNS)?t.uniformContext.createShaderGlobalUniformFromProbeAt(s.matUProbe,"u_viewMat",[r.default.CameraViewMatUNS],0):e.hasUniformByName(r.default.CameraProjectiveMatUNS)?t.uniformContext.createShaderGlobalUniformFromProbeAt(s.matUProbe,"u_projMat",[r.default.CameraProjectiveMatUNS],1):null}getIDNS(){return"CameraUniformBuilder"}}e.default=a},"264c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.m_begin=null,this.m_end=null,this.m_next=null,this.m_node=null,this.m_nodes=[],this.m_nodesTotal=0,this.m_shader=null,this.m_renderTotal=0,this.m_sorter=null,this.sortEnabled=!0,this.m_shader=t}setSorter(t){this.m_sorter=t}showInfo(){let t="",e=this.m_begin;while(null!=e)t+=e.unit.value+",",e=e.next}clear(){if(null!=this.m_shader){this.m_nodes.length>0&&(this.m_nodes=[]);let t=this.m_begin,e=null;while(null!=t)e=t,t=t.next,e.prev=null,e.next=null;this.m_begin=this.m_end=null,this.m_nodesTotal=0,this.m_renderTotal=0,this.sortEnabled=!0,this.m_shader=null}this.m_sorter=null}update(){this.sortEnabled&&this.sort()}run(t){this.m_shader.resetUniform();let e=null,s=this.m_nodes;for(let i=0;i<this.m_renderTotal;++i)e=s[i],this.m_shader.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t)}runLockMaterial(t){this.m_shader.resetUniform();let e=null,s=this.m_nodes;for(let i=0;i<this.m_renderTotal;++i)e=s[i],this.m_shader.bindToGpu(e.shdUid),e.vro.run(),e.runLockMaterial2(null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}sort(){if(this.m_nodesTotal>0){let t=this.m_begin;this.m_nodes.length<this.m_nodesTotal&&(this.m_nodes=new Array(Math.round(1.1*this.m_nodesTotal)+1));let e=0;while(null!=t)t.drawEnabled&&t.unit.drawEnabled&&(this.m_nodes[e]=t.unit,++e),t=t.next;this.m_renderTotal=e;let s=0;null!=this.m_sorter&&(s=this.m_sorter.sortRODisplay(this.m_nodes,e)),s<1&&this.snsort(0,e-1)}}sorting(t,e){let s=this.m_nodes;this.m_node=s[t];let i=this.m_node.value;while(t<e){while(t<e&&s[e].value>=i)--e;s[t]=s[e];while(t<e&&s[t].value<=i)++t;s[e]=s[t]}return s[t]=this.m_node,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}getNodesTotal(){return this.m_nodesTotal}getBegin(){return this.m_next=this.m_begin,this.m_begin}getNext(){return null!=this.m_next&&(this.m_next=this.m_next.next),this.m_next}isEmpty(){return this.m_nodesTotal<1}addNode(t){null==t.prev&&null==t.next&&(null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null,this.m_nodesTotal++)}removeNode(t){null==t.prev&&null==t.next&&t!=this.m_begin||(t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null,this.m_nodesTotal--)}}e.default=i},"265e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.__$ruid=-1,this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.prev=null,this.next=null,this.unit=null,this.vro=null,this.tro=null,this.rvroI=-1,this.rtroI=-1}setValue(t){this.unit.value=t}isVsible(){return null==this.unit||this.unit.drawEnabled}updateData(){let t=this.unit;this.drawMode=t.drawMode,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,this.vtxUid=t.vtxUid,this.vro=t.vro,this.shdUid=t.shdUid,this.texMid=t.texMid,this.tro=t.tro}reset(){this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.unit=null,this.vro=null,this.tro=null,this.prev=null,this.next=null}toString(){return"[Object RPONode(uid = "+this.uid+", index = "+this.index+", shdUid = "+this.shdUid+", vtxUid = "+this.vtxUid+")]"}}e.default=i},2931:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("9cc2");class r{constructor(){this.m_receivers=[],this.m_flag=!0}addReceiver(t){this.m_receivers.push(t)}removeReceiver(t){let e=this.m_receivers;for(let s=0,i=e.length;s<i;++s)if(t==e[s]){e.splice(s,1);break}}testUnit(){if(this.m_flag){if(this.unit.isCpuPhase()){let t=this.m_receivers;for(let e=0,s=t.length;e<s;++e){const s=t[e];s.dataUnitUUID>0&&s.listUUID>0&&s.receiveDataUnit(this.unit,1)}return this.m_flag=!1,!0}return!1}return!0}destroy(t,e){let s=this.m_receivers;for(let i=0,r=s.length;i<r;++i){const e=s[i];t.removeItem(e)}e.delete(this.uuid),this.uuid=0,this.m_receivers=null}}class a{constructor(){this.m_nodeMap=new Map,this.m_nodes=[],this.m_receiverPool=new i.ListPool,this.m_receiversTotal=0}testUnit(t){if(null!=t){let e=this.m_nodeMap.get(t.getUUID());if(null!=e)return e.testUnit()}return!1}addReceiver(t,e){if(null!=e&&this.m_receiverPool.hasnotItem(t)){let s;this.m_nodeMap.has(e.getUUID())?s=this.m_nodeMap.get(e.getUUID()):(s=new r,s.unit=e,s.uuid=e.getUUID(),this.m_nodes.push(s),this.m_nodeMap.set(e.getUUID(),s)),t.dataUnitUUID=e.getUUID();let i=t.listUUID;if(this.m_receiverPool.addItem(t),i==t.listUUID)throw"ReceiverSchedule::addReceiver() is the illegal operation !!!(listUUID("+i+"), receiver.listUUID("+t.listUUID+"))";s.addReceiver(t),this.m_receiversTotal++}}removeReceiver(t){if(t.dataUnitUUID>0&&t.listUUID>0&&this.m_receiverPool.hasItem(t)){let e=this.m_nodeMap.get(t.dataUnitUUID);e.removeReceiver(t),this.m_receiverPool.removeItem(t),this.m_receiversTotal--}t.dataUnitUUID=0,t.listUUID=0}getReceiversTotal(){return this.m_receiversTotal}run(){if(this.m_receiversTotal>0){let t,e,s=this.m_nodes;for(let i=0,r=s.length;i<r;++i)e=s[i],t=e.testUnit(),t&&(this.m_receiversTotal--,s.splice(i,1),e.destroy(this.m_receiverPool,this.m_nodeMap),i--,r--)}}destroy(){}}e.ReceiverSchedule=a},"29ef":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("070b"),r=s("a5ba"),a=s("e08e");class n{static Initialize(t,e){if(n.s_initBoo){n.s_initBoo=!1;let s=n;s.Rstate=t,s.VRO=e,i.RenderColorMask.Rstate=t,r.RenderStateObject.Rstate=t,s.COLOR_MASK_ALL_TRUE=i.RenderColorMask.Create("all_true",!0,!0,!0,!0),s.COLOR_MASK_ALL_FALSE=i.RenderColorMask.Create("all_false",!1,!1,!1,!1),s.COLOR_MASK_RED_TRUE=i.RenderColorMask.Create("red_true",!0,!1,!1,!1),s.COLOR_MASK_GREEN_TRUE=i.RenderColorMask.Create("green_true",!1,!0,!1,!1),s.COLOR_MASK_BLUE_TRUE=i.RenderColorMask.Create("blue_true",!1,!1,!0,!1),s.COLOR_MASK_ALPHA_TRUE=i.RenderColorMask.Create("alpha_true",!1,!1,!1,!0),s.COLOR_MASK_RED_FALSE=i.RenderColorMask.Create("red_false",!1,!0,!0,!0),s.COLOR_MASK_GREEN_FALSE=i.RenderColorMask.Create("green_false",!0,!1,!0,!0),s.COLOR_MASK_BLUE_FALSE=i.RenderColorMask.Create("blue_false",!0,!0,!1,!0),s.COLOR_MASK_ALPHA_FALSE=i.RenderColorMask.Create("alpha_false",!0,!0,!0,!1);let h=r.RenderStateObject,l=a.RenderBlendMode;l.NORMAL=h.CreateBlendMode("NORMAL",a.GLBlendMode.ONE,a.GLBlendMode.ZERO,a.GLBlendEquation.FUNC_ADD),l.OPAQUE=h.CreateBlendMode("OPAQUE",a.GLBlendMode.ONE,a.GLBlendMode.ZERO,a.GLBlendEquation.FUNC_ADD),l.TRANSPARENT=h.CreateBlendMode("TRANSPARENT",a.GLBlendMode.SRC_ALPHA,a.GLBlendMode.ONE_MINUS_SRC_ALPHA,a.GLBlendEquation.FUNC_ADD),l.ALPHA_ADD=h.CreateBlendMode("ALPHA_ADD",a.GLBlendMode.ONE,a.GLBlendMode.ONE_MINUS_SRC_ALPHA,a.GLBlendEquation.FUNC_ADD),l.ADD=h.CreateBlendMode("ADD",a.GLBlendMode.SRC_ALPHA,a.GLBlendMode.ONE,a.GLBlendEquation.FUNC_ADD),l.ADD_LINEAR=h.CreateBlendMode("ADD_LINEAR",a.GLBlendMode.ONE,a.GLBlendMode.ONE,a.GLBlendEquation.FUNC_ADD),l.INVERSE_ALPHA=h.CreateBlendMode("INVERSE_ALPHA",a.GLBlendMode.ONE,a.GLBlendMode.SRC_ALPHA,a.GLBlendEquation.FUNC_ADD),l.BLAZE=h.CreateBlendMode("BLAZE",a.GLBlendMode.SRC_COLOR,a.GLBlendMode.ONE,a.GLBlendEquation.FUNC_ADD),l.OVERLAY=h.CreateBlendMode("OVERLAY",a.GLBlendMode.DST_COLOR,a.GLBlendMode.DST_ALPHA,a.GLBlendEquation.FUNC_ADD),l.OVERLAY2=h.CreateBlendMode("OVERLAY2",a.GLBlendMode.DST_COLOR,a.GLBlendMode.SRC_ALPHA,a.GLBlendEquation.FUNC_ADD),s.NORMAL_STATE=h.Create("normal",a.CullFaceMode.BACK,a.RenderBlendMode.NORMAL,a.DepthTestMode.OPAQUE),s.BACK_CULLFACE_NORMAL_STATE=s.NORMAL_STATE,s.FRONT_CULLFACE_NORMAL_STATE=h.Create("front_normal",a.CullFaceMode.FRONT,a.RenderBlendMode.NORMAL,a.DepthTestMode.OPAQUE),s.NONE_CULLFACE_NORMAL_STATE=h.Create("none_normal",a.CullFaceMode.NONE,a.RenderBlendMode.NORMAL,a.DepthTestMode.OPAQUE),s.ALL_CULLFACE_NORMAL_STATE=h.Create("all_cull_normal",a.CullFaceMode.FRONT_AND_BACK,a.RenderBlendMode.NORMAL,a.DepthTestMode.OPAQUE),s.BACK_NORMAL_ALWAYS_STATE=h.Create("back_normal_always",a.CullFaceMode.BACK,a.RenderBlendMode.NORMAL,a.DepthTestMode.ALWAYS),s.BACK_TRANSPARENT_STATE=h.Create("back_transparent",a.CullFaceMode.BACK,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.TRANSPARENT_SORT),s.BACK_TRANSPARENT_ALWAYS_STATE=h.Create("back_transparent_always",a.CullFaceMode.BACK,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.ALWAYS),s.NONE_TRANSPARENT_STATE=h.Create("none_transparent",a.CullFaceMode.NONE,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.TRANSPARENT_SORT),s.NONE_TRANSPARENT_ALWAYS_STATE=h.Create("none_transparent_always",a.CullFaceMode.NONE,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.ALWAYS),s.FRONT_CULLFACE_GREATER_STATE=h.Create("front_greater",a.CullFaceMode.FRONT,a.RenderBlendMode.NORMAL,a.DepthTestMode.TRUE_GREATER),s.BACK_ADD_BLENDSORT_STATE=h.Create("back_add_blendSort",a.CullFaceMode.BACK,a.RenderBlendMode.ADD,a.DepthTestMode.TRANSPARENT_SORT),s.BACK_ADD_ALWAYS_STATE=h.Create("back_add_always",a.CullFaceMode.BACK,a.RenderBlendMode.ADD,a.DepthTestMode.ALWAYS),s.BACK_ALPHA_ADD_ALWAYS_STATE=h.Create("back_alpha_add_always",a.CullFaceMode.BACK,a.RenderBlendMode.ALPHA_ADD,a.DepthTestMode.ALWAYS),s.NONE_ADD_ALWAYS_STATE=h.Create("none_add_always",a.CullFaceMode.NONE,a.RenderBlendMode.ADD,a.DepthTestMode.ALWAYS),s.NONE_ADD_BLENDSORT_STATE=h.Create("none_add_blendSort",a.CullFaceMode.NONE,a.RenderBlendMode.ADD,a.DepthTestMode.TRANSPARENT_SORT),s.NONE_ALPHA_ADD_ALWAYS_STATE=h.Create("none_alpha_add_always",a.CullFaceMode.NONE,a.RenderBlendMode.ALPHA_ADD,a.DepthTestMode.ALWAYS),s.FRONT_ADD_ALWAYS_STATE=h.Create("front_add_always",a.CullFaceMode.FRONT,a.RenderBlendMode.ADD,a.DepthTestMode.ALWAYS),s.FRONT_TRANSPARENT_STATE=h.Create("front_transparent",a.CullFaceMode.FRONT,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.TRANSPARENT_SORT),s.FRONT_TRANSPARENT_ALWAYS_STATE=h.Create("front_transparent_always",a.CullFaceMode.FRONT,a.RenderBlendMode.TRANSPARENT,a.DepthTestMode.ALWAYS),s.NONE_CULLFACE_NORMAL_ALWAYS_STATE=h.Create("none_normal_always",a.CullFaceMode.NONE,a.RenderBlendMode.NORMAL,a.DepthTestMode.ALWAYS),s.BACK_ALPHA_ADD_BLENDSORT_STATE=h.Create("back_alpha_add_blendSort",a.CullFaceMode.BACK,a.RenderBlendMode.ALPHA_ADD,a.DepthTestMode.TRANSPARENT_SORT)}}static CreateBlendMode(t,e,s,i=0){return r.RenderStateObject.CreateBlendMode(t,e,s,i)}static CreateBlendModeSeparate(t,e,s,i=0,a=0,n=0){return r.RenderStateObject.CreateBlendModeSeparate(t,e,s,i,a,n)}static CreateRenderState(t,e,s,i){return r.RenderStateObject.Create(t,e,s,i)}static CreateRenderColorMask(t,e,s,r,a){return i.RenderColorMask.Create(t,e,s,r,a)}static GetRenderStateByName(t){return r.RenderStateObject.GetRenderStateByName(t)}static GetRenderColorMaskByName(t){return i.RenderColorMask.GetColorMaskByName(t)}static UnlockBlendMode(){r.RenderStateObject.UnlockBlendMode()}static LockBlendMode(t){r.RenderStateObject.LockBlendMode(t)}static UnlockDepthTestMode(){r.RenderStateObject.UnlockDepthTestMode()}static LockDepthTestMode(t){r.RenderStateObject.LockDepthTestMode(t)}static ResetState(){i.RenderColorMask.Reset(),r.RenderStateObject.Reset(),n.Rstate.reset(),n.VRO.__$resetVRO()}static Reset(t){i.RenderColorMask.Reset(),r.RenderStateObject.Reset(),n.Rstate.setRenderContext(t),n.Rstate.reset()}static ResetInfo(){n.DrawCallTimes=0,n.DrawTrisNumber=0,n.POVNumber=0}static SetDepthTestEnable(t){n.Rstate.setDepthTestEnable(t)}static SetBlendEnable(t){n.Rstate.setBlendEnable(t)}}n.s_initBoo=!0,n.VRO=null,n.Rstate=null,n.DrawCallTimes=0,n.DrawTrisNumber=0,n.POVNumber=0,n.COLOR_MASK_ALL_TRUE=0,n.COLOR_MASK_ALL_FALSE=1,n.COLOR_MASK_RED_TRUE=2,n.COLOR_MASK_GREEN_TRUE=3,n.COLOR_MASK_BLUE_TRUE=4,n.COLOR_MASK_ALPHA_TRUE=5,n.COLOR_MASK_RED_FALSE=6,n.COLOR_MASK_GREEN_FALSE=7,n.COLOR_MASK_BLUE_FALSE=8,n.COLOR_MASK_ALPHA_FALSE=9,n.NORMAL_STATE=0,n.BACK_CULLFACE_NORMAL_STATE=0,n.FRONT_CULLFACE_NORMAL_STATE=1,n.NONE_CULLFACE_NORMAL_STATE=2,n.ALL_CULLFACE_NORMAL_STATE=3,n.BACK_NORMAL_ALWAYS_STATE=4,n.BACK_TRANSPARENT_STATE=5,n.BACK_TRANSPARENT_ALWAYS_STATE=6,n.NONE_TRANSPARENT_STATE=7,n.NONE_TRANSPARENT_ALWAYS_STATE=8,n.FRONT_CULLFACE_GREATER_STATE=9,n.BACK_ADD_BLENDSORT_STATE=10,n.BACK_ADD_ALWAYS_STATE=11,n.BACK_ALPHA_ADD_ALWAYS_STATE=12,n.NONE_ADD_ALWAYS_STATE=13,n.NONE_ADD_BLENDSORT_STATE=14,n.NONE_ALPHA_ADD_ALWAYS_STATE=15,n.FRONT_ADD_ALWAYS_STATE=16,n.FRONT_TRANSPARENT_STATE=17,n.FRONT_TRANSPARENT_ALWAYS_STATE=18,n.NONE_CULLFACE_NORMAL_ALWAYS_STATE=19,n.BACK_ALPHA_ADD_BLENDSORT_STATE=20,e.default=n},"2a59":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("74ee"),r=s("7de1"),a=s("8eb0"),n=s("aeff"),h=s("73f9"),l=s("31e1");class o extends r.ResourceSchedule{constructor(){super()}createDataUnit(t,e,s=!1){n.DataUnitLock.lockStatus=207;let r=new n.GeometryDataUnit;switch(r.lossTime=Date.now(),r.immediate=s,r.data=new n.GeometryDataContainer,r.data.dataFormat=e,r.data.dataFormat){case i.DataFormat.CTM:this.m_ctmListener.addUrlToTask(t);break;case i.DataFormat.OBJ:this.m_objListener.addUrlToTask(t);break;case i.DataFormat.Draco:break;default:break}return r}initTask(t,e,s,i){for(let r=0;r<i.length;++r){const n=i[r];switch(n.name){case a.ModuleNS.objParser:this.m_objListener=new l.OBJParserListerner(t,e,n,s);break;case a.ModuleNS.ctmParser:this.m_ctmListener=new h.CTMParserListerner(t,e,n,s);break;default:break}}}destroy(){super.destroy()}}e.GeometryResourceSchedule=o},"2be1":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_nodesTotal=0,this.m_nodes=[],this.m_flags=[],this.m_freeIdList=[]}createNode(){return null}restoreUid(t){}getFreeId(){return this.m_freeIdList.length>0?this.m_freeIdList.pop():-1}getNodeByUid(t){return this.m_nodes[t]}create(){let t=null,e=this.getFreeId();return e>=0?(t=this.m_nodes[e],t.uid=e,this.m_flags[e]=i.S_BUSY):(t=this.createNode(),this.m_nodes.push(t),this.m_flags.push(i.S_BUSY),t.uid=this.m_nodesTotal,this.m_nodesTotal++),t}restore(t){return null!=t&&t.uid>=0&&this.m_flags[t.uid]==i.S_BUSY&&(this.restoreUid(t.uid),this.m_freeIdList.push(t.uid),this.m_flags[t.uid]=i.S_FREE,t.reset(),!0)}restoreByUid(t){return t>=0&&t<this.m_nodesTotal&&this.m_flags[t]==i.S_BUSY&&(this.restoreUid(t),this.m_freeIdList.push(t),this.m_flags[t]=i.S_FREE,this.m_nodes[t].reset(),!0)}}i.S_BUSY=1,i.S_FREE=0,e.default=i},"2e8a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("644c"));class n{constructor(){this.type=-1,this.attriType=-1,this.typeSize=3,this.typeName="",this.name="",this.layoutEnabled=!0}parseCode(t){const e=";",s=" ";t=t.replace(/^\s*|\s*$/g,"");let i=t.indexOf(e);i>0&&(t=t.slice(0,i));let n=t.split(s);this.typeName=n[n.length-2],this.name=n[n.length-1],this.type=a.default.GetTypeByTypeNS(this.typeName),this.typeSize=parseInt(this.typeName.slice(this.typeName.length-1)),this.attriType=r.default.GetVBufAttributeTypeByNS(this.name)}}e.default=n},3024:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3077"));class a extends r.default{constructor(t,e){super(t),this.m_datafs=null,this.m_vec4Total=1,e<1&&(e=1),this.m_vec4Total=e,this.m_datafs=new Float32Array(4*e),this.addVec4Data(this.m_datafs,this.m_vec4Total)}destroy(){super.destroy(),this.m_datafs=null}}e.default=a},3077:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("644c"));class a{constructor(t){this.m_uid=a.s_uid++,this.m_slot=null,this.m_fsList=null,this.m_fsIndex=0,this.m_slotBeginIndex=-1,this.rst=-1,this.uniformsTotal=0,this.uniformNames=null,this.uniformTypes=null,this.dataSizeList=null,this.bindSlot(t)}bindSlot(t){this.rst>=0&&this.reset(),null==this.m_fsList&&(this.m_fsList=[],this.uniformTypes=[],this.dataSizeList=[]),this.m_slot=t,this.rst=1,this.m_slotBeginIndex=t.index,this.m_fsIndex=t.index}getUid(){return this.m_uid}getSlotBeginIndex(){return this.m_slotBeginIndex}getRCUid(){return this.m_slot.getRCUid()}getFS32At(t){return this.m_fsList[t]}setFS32At(t,e){this.m_fsList[e]=t}setVec4DataAt(t,e,s,i,r){let a=this.m_fsList[t];a[0]=e,a[1]=s,a[2]=i,a[3]=r}setVec4Data(t,e,s,i){let r=this.m_fsList[0];r[0]=t,r[1]=e,r[2]=s,r[3]=i}setVec4DataAtWithArr4(t,e){this.m_fsList[t].set(e,0)}setVec4DataWithArr4(t){this.m_fsList[0].set(t,0)}addVec4Data(t,e){t.length,this.m_fsList.push(t),this.uniformTypes.push(r.default.SHADER_VEC4),this.dataSizeList.push(e),this.m_slot.dataList[this.m_fsIndex]=t,this.m_fsIndex++,this.uniformsTotal++,this.m_slot.index++}addMat4Data(t,e){this.m_fsList.push(t),this.uniformTypes.push(r.default.SHADER_MAT4),this.dataSizeList.push(e),this.m_slot.dataList[this.m_fsIndex]=t,this.m_fsIndex++,this.uniformsTotal++,this.m_slot.index++}isEnabled(){return this.rst>=0}update(){if(this.rst++,this.uniformsTotal<2)this.m_slot.flagList[this.m_slotBeginIndex]=this.rst;else for(let t=this.m_slotBeginIndex;t<=this.m_fsIndex;++t)this.m_slot.flagList[t]=this.rst}reset(){this.rst=-1,this.m_slotBeginIndex=-1,this.uniformsTotal=0,this.m_fsIndex=0,null!=this.m_fsList&&(this.m_fsList=null,this.uniformTypes=null,this.dataSizeList=null),this.m_slot=null}destroy(){this.reset()}}a.s_uid=0,e.default=a},3113:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("839a"),a=s("a9f4"),n=i(s("ab73"));class h{constructor(){this.m_codeBuilder=null,this.m_uniqueNSKeyString="",this.m_uniqueNSKeys=new Uint16Array(128),this.m_uniqueNSKeysTotal=16,this.m_uniqueNSKeyFlag=!1}__$setCodeBuilder(t){this.m_codeBuilder=t}getUniqueNSKeyID(){if(this.m_uniqueNSKeyFlag){let t=31;for(let e=0;e<this.m_uniqueNSKeysTotal;++e)t=131*t+this.m_uniqueNSKeys[e];return t}return 0}getUniqueNSKeyString(){if(this.m_uniqueNSKeyFlag){this.m_uniqueNSKeyString="["+this.m_uniqueNSKeys[0];for(let t=1;t<this.m_uniqueNSKeysTotal;++t)this.m_uniqueNSKeyString+=""+this.m_uniqueNSKeys[t];return this.m_uniqueNSKeyString+="]",this.m_uniqueNSKeyString}return""}reset(){if(this.m_uniqueNSKeyFlag){for(let t=0;t<this.m_uniqueNSKeysTotal;++t)this.m_uniqueNSKeys[t]=0;this.m_uniqueNSKeyFlag=!1}}useCameraPosition(t=!1,e=!0){t&&this.m_codeBuilder.addVertUniformParam(n.default.CameraPosParam),e&&this.m_codeBuilder.addFragUniformParam(n.default.CameraPosParam)}useViewPort(t=!1,e=!0){t&&this.m_codeBuilder.addVertUniformParam(n.default.ViewportParam),e&&this.m_codeBuilder.addFragUniformParam(n.default.ViewportParam)}useFrustum(t=!1,e=!0){t&&this.m_codeBuilder.addVertUniformParam(n.default.FrustumParam),e&&this.m_codeBuilder.addFragUniformParam(n.default.FrustumParam)}useStage(t,e){t&&this.m_codeBuilder.addVertUniformParam(n.default.StageParam),e&&this.m_codeBuilder.addFragUniformParam(n.default.StageParam)}addDiffuseMap(){this.m_codeBuilder.addTextureSample2D("VOX_DIFFUSE_MAP",!0,!0,!1),this.m_uniqueNSKeys[0]=1,this.m_uniqueNSKeyFlag=!0}addNormalMap(){this.m_codeBuilder.addTextureSample2D("VOX_NORMAL_MAP",!0,!0,!1),this.m_codeBuilder.normalMapEnabled=!0,this.m_uniqueNSKeys[1]=1,this.m_uniqueNSKeyFlag=!0}addParallaxMap(t){this.m_codeBuilder.addTextureSample2D("VOX_PARALLAX_MAP",!0,!0,!1),t>=0?(this.m_codeBuilder.addDefine("VOX_PARALLAX_PARAMS_INDEX",""+t),this.m_uniqueNSKeys[2]=1+(t<<1)):this.m_uniqueNSKeys[2]=1,this.m_uniqueNSKeyFlag=!0}addDisplacementMap(t){this.m_codeBuilder.addTextureSample2D("VOX_DISPLACEMENT_MAP",!0,!1,!0),t>=0?(this.m_codeBuilder.addDefine("VOX_DISPLACEMENT_PARAMS_INDEX",""+t),this.m_uniqueNSKeys[3]=1+(t<<1)):this.m_uniqueNSKeys[3]=1,this.m_uniqueNSKeyFlag=!0}addSpecularMap(t=r.SpecularMode.Default){this.m_codeBuilder.addTextureSample2D("VOX_SPECULAR_MAP",!0,!0,!1),this.m_codeBuilder.addDefine("VOX_SPECULAR_MODE",""+t),this.m_uniqueNSKeys[5]=1+(t<<1),this.m_uniqueNSKeyFlag=!0}addShadowMap(t=a.ShadowMode.VSM){this.m_codeBuilder.addTextureSample2D("VOX_VSM_SHADOW_MAP",!1,!0,!1),this.m_uniqueNSKeys[6]=1+(t<<1),this.m_uniqueNSKeyFlag=!0}addFogColorMap(){this.m_codeBuilder.addTextureSample2D("VOX_FOG_COLOR_MAP",!0,!0,!1),this.m_uniqueNSKeys[7]=1,this.m_uniqueNSKeyFlag=!0}addSpecularEnvMap(t=!0){t?this.m_codeBuilder.addTextureSampleCube("VOX_ENV_MAP",!0,!1):this.m_codeBuilder.addTextureSample2D("VOX_ENV_MAP",!0,!0,!1),this.m_uniqueNSKeys[8]=1,this.m_uniqueNSKeyFlag=!0}addAOMap(){this.m_codeBuilder.addTextureSample2D("VOX_AO_MAP",!0,!0,!1),this.m_uniqueNSKeys[4]=1,this.m_uniqueNSKeyFlag=!0}addRoughnessMap(){this.m_codeBuilder.addTextureSample2D("VOX_ROUGHNESS_MAP",!0,!0,!1),this.m_uniqueNSKeys[9]=1,this.m_uniqueNSKeyFlag=!0}addMetalnessMap(){this.m_codeBuilder.addTextureSample2D("VOX_METALNESS_MAP",!0,!0,!1),this.m_uniqueNSKeys[10]=1,this.m_uniqueNSKeyFlag=!0}addARMMap(){this.m_codeBuilder.addTextureSample2D("VOX_ARM_MAP",!0,!0,!1),this.m_uniqueNSKeys[11]=1,this.m_uniqueNSKeyFlag=!0}add2DMap(t="",e=!0,s=!0,i=!1){this.m_codeBuilder.addTextureSample2D(t,e,s,i)}addCubeMap(t="",e=!0,s=!1){this.m_codeBuilder.addTextureSampleCube(t,e,s)}add3DMap(t="",e=!0,s=!1){this.m_codeBuilder.addTextureSample3D(t,e,s)}}e.ShaderCodeUniform=h},"31e1":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("0795"),a=s("aeff"),n=s("ceac"),h=i(s("3bda"));class l{constructor(t,e,s,i){this.m_parseTask=null,this.m_moduleUrl=s.url,this.m_unitPool=t,this.m_threadSchedule=e,this.m_receiverSchedule=i}addUrlToTask(t){if(!this.m_unitPool.hasUnitByUrl(t)){if(null==this.m_parseTask){let t=new n.OBJParseTask(this.m_moduleUrl);this.m_threadSchedule.bindTask(t),t.setListener(this),this.m_parseTask=t}(new r.FileLoader).load(t,(t,e)=>{h.default.ShowLogOnce("OBJ..."),this.m_parseTask.addBinaryData(t,e)},(t,e)=>{let s=Math.round(100*t.loaded/t.total);h.default.ShowLogOnce("obj file loading "+s+"%")},(t,e)=>{})}}objParseFinish(t,e){if(this.m_unitPool.hasUnitByUrl(e)){let s=this.m_unitPool.getUnitByUrl(e);null!=s&&(s.lossTime=Date.now()-s.lossTime,s.data.dataFormat=a.DataFormat.OBJ,s.data.models=t,a.DataUnitLock.lockStatus=209,s.toCpuPhase(),s.immediate&&this.m_receiverSchedule.testUnit(s))}}destroy(){null!=this.m_parseTask&&(this.m_parseTask.destroy(),this.m_parseTask=null),this.m_unitPool=null,this.m_threadSchedule=null,this.m_receiverSchedule=null}}e.OBJParserListerner=l},"32cc":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("b3bd")),a=i(s("faa5")),n=i(s("0fc4"));class h extends a.default{constructor(){super(),this.m_uniqueName="",this.dynColorEnabled=!1}initialize(t){super.initialize(t),this.m_uniqueName="Line3DShd",this.dynColorEnabled&&(this.m_uniqueName+="_dynColor")}buildShader(){this.m_coder.addVertLayout("vec3","a_vs"),this.dynColorEnabled?(this.m_coder.addDefine("DYNAMIC_COLOR"),this.m_coder.addFragUniform("vec4","u_color")):(this.m_coder.addVertLayout("vec3","a_cvs"),this.m_coder.addVarying("vec3","v_color")),this.m_coder.addFragOutputHighp("vec4","FragColor0"),this.m_coder.addFragMainCode("\n    #ifndef DYNAMIC_COLOR\n        FragColor0 = vec4(v_color, 1.0);\n    #else\n        FragColor0 = u_color;\n    #endif\n"),this.m_coder.addVertMainCode("\n    viewPosition = u_viewMat * u_objMat * vec4(a_vs,1.0);\n    vec4 pv = u_projMat * viewPosition;\n    // pixels move offset, and no perspective error.\n    //  pv.xy = (pv.xy/pv.w - vec2(0.5)) * pv.w;\n    #ifndef DYNAMIC_COLOR\n        v_color = a_cvs;\n    #endif\n    gl_Position = pv;\n            ")}getUniqueShaderName(){return this.m_uniqueName}toString(){return"[Line3DShaderBuffer()]"}static GetInstance(){return null!=h.s_instance||(h.s_instance=new h),h.s_instance}}h.s_instance=null;class l extends n.default{constructor(t=!1){if(super(),this.m_dynColorEnabled=!1,this.m_colorArray=null,this.m_dynColorEnabled=t,t&&(this.m_colorArray=new Float32Array([1,1,1,1]),this.m_dynColorEnabled)){let t=new r.default;t.uniformNameList=["u_color"],t.dataList=[this.m_colorArray],this.m_shaderUniformData=t}}getCodeBuf(){return h.GetInstance().dynColorEnabled=this.m_dynColorEnabled,h.GetInstance()}setRGB3f(t,e,s){null!=this.m_colorArray&&(this.m_colorArray[0]=t,this.m_colorArray[1]=e,this.m_colorArray[2]=s)}}e.default=l},"32fa":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("29ef")),a=i(s("725b")),n=i(s("617e")),h=i(s("3b73"));class l{constructor(){this.m_fps=60,this.m_lastTime=0,this.m_times=60,this.m_dealytime=0}getFPS(){return this.m_fps}getFPSStr(){return this.m_fps>60?"60":this.m_fps<10?"0"+this.m_fps:""+this.m_fps}updateFPS(){let t=Date.now();this.m_lastTime>0&&(--this.m_times,this.m_times<1&&(this.m_fps=Math.round(6e4/this.m_dealytime),this.m_dealytime=0,this.m_times=60),this.m_dealytime+=t-this.m_lastTime),this.m_lastTime=t}}class o{constructor(){this.m_rprocess=null,this.m_renderer=null,this.m_fpsInfo=new l,this.m_textFPSNS=null,this.m_textFPS=null,this.m_fps=60,this.m_drawCallNS=null,this.m_drawCall=null,this.m_drawCalls=0,this.m_drawTrisNS=null,this.m_drawTri=null,this.m_drawTris=0,this.m_povNS=null,this.m_pov=null,this.m_povNumber=0}initialize(t,e){if(null==this.m_renderer){let s=18;a.default.GetInstance().isEnabled()||(a.default.GetInstance().setRenderProxy(t.getRenderProxy()),a.default.GetInstance().initialize("fontTex",s,512,512,!1,!1)),this.m_renderer=t,this.m_rprocess=e;let i=a.default.GetInstance().getFontSize()+2,r=2,l=100;h.default.IsMobileWeb()&&(l*=a.default.GetInstance().getFontSize()/s);let o=l-10,_=null;_=new n.default,_.initialize("FPS:"),_.setXY(o-_.getWidth(),r),this.m_renderer.addEntityToProcess(_,this.m_rprocess),this.m_textFPSNS=_;let m=_.getWidth();_=new n.default,_.__$setRenderProxy(t.getRenderProxy()),_.initialize("60"),_.setXY(l,2),this.m_renderer.addEntityToProcess(_,this.m_rprocess),this.m_textFPS=_,r+=i,_=new n.default,_.initialize("DrawCall:"),_.setXY(o-_.getWidth(),r),this.m_renderer.addEntityToProcess(_,this.m_rprocess),this.m_drawCallNS=_,m=_.getWidth(),_=new n.default,_.__$setRenderProxy(t.getRenderProxy()),_.initialize("00"),_.setXY(l,r),this.m_renderer.addEntityToProcess(_,this.m_rprocess),this.m_drawCall=_,r+=i,_=new n.default,_.initialize("DrawTris:"),_.setXY(o-_.getWidth(),r),this.m_renderer.addEntityToProcess(_,this.m_rprocess),this.m_drawTrisNS=_,m=_.getWidth(),_=new n.default,_.__$setRenderProxy(t.getRenderProxy()),_.initialize("00"),_.setXY(l,r),this.m_renderer.addEntityToProcess(_,this.m_rprocess),this.m_drawTri=_,r+=i,_=new n.default,_.initialize("POV:"),_.setXY(o-_.getWidth(),r),this.m_renderer.addEntityToProcess(_,this.m_rprocess),this.m_povNS=_,m=_.getWidth(),_=new n.default,_.__$setRenderProxy(t.getRenderProxy()),_.initialize("00"),_.setXY(l,r),this.m_renderer.addEntityToProcess(_,this.m_rprocess),this.m_pov=_}}getFPS(){return this.m_fpsInfo.getFPS()}run(t){if(this.m_fpsInfo.updateFPS(),this.m_fps!=this.m_fpsInfo.getFPS()&&(this.m_fps=this.m_fpsInfo.getFPS(),this.m_textFPS.setText(this.m_fpsInfo.getFPSStr()),this.m_textFPS.updateMeshToGpu(),this.m_textFPS.update()),this.m_drawCalls!=r.default.DrawCallTimes){let t=r.default.DrawCallTimes+"";this.m_drawCalls=r.default.DrawCallTimes,this.m_drawCall.setText(t),this.m_drawCall.updateMeshToGpu(),this.m_drawCall.update()}if(this.m_drawTris!=r.default.DrawTrisNumber){let t=r.default.DrawTrisNumber+"";this.m_drawTris=r.default.DrawTrisNumber,this.m_drawTri.setText(t),this.m_drawTri.updateMeshToGpu(),this.m_drawTri.update()}if(this.m_povNumber!=r.default.POVNumber){let t=r.default.POVNumber+"";this.m_povNumber=r.default.POVNumber,this.m_pov.setText(t),this.m_pov.updateMeshToGpu(),this.m_pov.update()}t&&this.m_renderer.getRenderProxy().setViewPort(0,0,this.m_renderer.getViewWidth(),this.m_renderer.getViewHeight())}toString(){return"[RendererStatus]"}}e.default=o},"35fa":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{static ClacTriNormal(t,e,s,i){let n=a;r.default.Subtract(e,t,n.s_temp_vb),r.default.Subtract(s,e,n.s_temp_vc),r.default.Cross(n.s_temp_vb,n.s_temp_vc,i),i.normalize()}static ClacTriNormalByVS(t,e,s){let i=a,r=9*e;i.s_temp_va.setTo(t[r],t[r+1],t[r+2]),s.setTo(t[r+3],t[r+4],t[r+5]),i.s_temp_vc.setTo(t[r+6],t[r+7],t[r+8]),s.subtractBy(i.s_temp_va),i.s_temp_vc.subtractBy(i.s_temp_va),s.crossBy(i.s_temp_vc),s.normalize()}static ClacTriNormalByIVS(t,e,s,i){let r=a,n=3*e,h=3*s[n];r.s_temp_va.setTo(t[h],t[h+1],t[h+2]),h=3*s[n+1],i.setTo(t[h],t[h+1],t[h+2]),h=3*s[n+2],r.s_temp_vc.setTo(t[h],t[h+1],t[h+2]),i.subtractBy(r.s_temp_va),r.s_temp_vc.subtractBy(r.s_temp_va),i.crossBy(r.s_temp_vc),i.normalize()}static ClacTrisNormal(t,e,s,i,n){let h=a,l=new r.default,o=0,_=0,m=0;for(m=0;m<e;++m)n[m]=0;for(m=0;m<s;++m)h.ClacTriNormalByIVS(t,m,i,l),o=3*m,_=3*i[o],n[_]+=l.x,n[_+1]+=l.y,n[_+2]+=l.z,_=3*i[o+1],n[_]+=l.x,n[_+1]+=l.y,n[_+2]+=l.z,_=3*i[o+2],n[_]+=l.x,n[_+1]+=l.y,n[_+2]+=l.z;for(m=0;m<e;m+=3)h.s_temp_va.setTo(n[m],n[m+1],n[m+2]),h.s_temp_va.normalize(),n[m]=h.s_temp_va.x,n[m+1]=h.s_temp_va.y,n[m+2]=h.s_temp_va.z}static ClacTriTangent(t,e,s,i,r,n,h){let l=a,o=3*i,_=3*r[o];l.s_temp_va.setTo(s[_],s[_+1],s[_+2]),l.s_temp_va.setTo(t[_],t[_+1],t[_+2]),_=3*r[o+1],l.s_temp_vb.setTo(t[_],t[_+1],t[_+2]),_=3*r[o+2],l.s_temp_vc.setTo(t[_],t[_+1],t[_+2]),_=2*r[o],l.s_temp_vd.setTo(e[_],e[_+1],0),_=2*r[o+1],l.s_temp_ve.setTo(e[_],e[_+1],0),_=2*r[o+2],l.s_temp_vf.setTo(e[_],e[_+1],0),l.s_temp_vb.subtractBy(l.s_temp_va),l.s_temp_vc.subtractBy(l.s_temp_va),l.s_temp_ve.subtractBy(l.s_temp_vd),l.s_temp_vf.subtractBy(l.s_temp_vd);let m=1/(l.s_temp_ve.x*l.s_temp_vf.y-l.s_temp_ve.y*l.s_temp_vf.x);n.copyFrom(l.s_temp_vb),n.scaleBy(l.s_temp_vf.y),l.s_temp_va.copyFrom(l.s_temp_vc),l.s_temp_va.scaleBy(l.s_temp_ve.y),n.subtractBy(l.s_temp_va),n.scaleBy(m),n.normalize(),h.copyFrom(l.s_temp_vc),h.scaleBy(l.s_temp_ve.x),l.s_temp_va.copyFrom(l.s_temp_vb),l.s_temp_va.scaleBy(l.s_temp_vf.x),h.subtractBy(l.s_temp_va),h.scaleBy(m),h.normalize()}static ClacTrisTangent(t,e,s,i,n,h,l,o){let _=a,m=new r.default,u=new r.default,d=0,c=0,f=0;for(f=0;f<e;++f)l[f]=0,o[f]=0;for(f=0;f<n;++f)_.ClacTriTangent(t,s,i,f,h,m,u),d=3*f,c=3*h[d],l[c]=m.x,l[c+1]=m.y,l[c+2]=m.z,o[c]=u.x,o[c+1]=u.y,o[c+2]=u.z,c=3*h[d+1],l[c]=m.x,l[c+1]=m.y,l[c+2]=m.z,o[c]=u.x,o[c+1]=u.y,o[c+2]=u.z,c=3*h[d+2],l[c]=m.x,l[c+1]=m.y,l[c+2]=m.z,o[c]=u.x,o[c+1]=u.y,o[c+2]=u.z;for(f=0;f<e;f+=3)_.s_temp_vd.setTo(l[f],l[f+1],l[f+2]),_.s_temp_vd.normalize(),_.s_temp_vb.setTo(o[f],o[f+1],o[f+2]),_.s_temp_vb.normalize(),_.s_temp_vc.setTo(i[f],i[f+1],i[f+2]),_.s_temp_va.copyFrom(_.s_temp_vc),_.s_temp_vc.scaleBy(_.s_temp_vc.dot(_.s_temp_vd)),_.s_temp_vd.subtractBy(_.s_temp_vc),_.s_temp_vd.normalize(),_.s_temp_vc.setTo(i[f],i[f+1],i[f+2]),_.s_temp_vc.scaleBy(_.s_temp_vb.dot(_.s_temp_vc)),_.s_temp_vb.subtractBy(_.s_temp_vc),_.s_temp_vb.normalize(),_.s_temp_va.crossBy(_.s_temp_vd),_.s_temp_va.dot(_.s_temp_vb)<0&&_.s_temp_vd.scaleBy(-1),l[f]=_.s_temp_vd.x,l[f+1]=_.s_temp_vd.y,l[f+2]=_.s_temp_vd.z,_.s_temp_vb.setTo(i[f],i[f+1],i[f+2]),_.s_temp_vb.crossBy(_.s_temp_vd),_.s_temp_vb.normalize(),o[f]=_.s_temp_vb.x,o[f+1]=_.s_temp_vb.y,o[f+2]=_.s_temp_vb.z}}a.s_temp_va=new r.default,a.s_temp_vb=new r.default,a.s_temp_vc=new r.default,a.s_temp_vd=new r.default,a.s_temp_ve=new r.default,a.s_temp_vf=new r.default,a.s_temp_vg=new r.default,e.default=a},"36cb":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("e08e"),a=i(s("ab73")),n=s("b02c"),h=i(s("4f27")),l=i(s("b30a")),o=i(s("9156")),_=s("670e");class m{constructor(t){this.m_emptyTRO=null,this.m_shader=null,this.m_rpoUnitBuilder=null,this.m_processBuider=null,this.m_roVtxBuild=null,this.m_rc=null,this.m_vtxRes=null,this.m_texRes=null,this.m_deferredVbufs=[],this.m_deferredTROs=[],this.m_deferredTextures=[],this.m_haveDeferredUpdate=!1,this.m_shdpBuilder=null,this.m_shdpBuilder=t}initialize(t,e,s,i){null==this.m_shader&&(this.m_rc=t,this.m_vtxRes=t.Vertex,this.m_texRes=t.Texture,this.m_shader=new l.default(t.getRCUid(),t.getRC(),t.getRenderAdapter(),this.m_shdpBuilder),this.m_rpoUnitBuilder=e,this.m_processBuider=s,this.m_roVtxBuild=i,this.m_emptyTRO=new n.EmptyTexRenderObj(this.m_texRes),this.m_shdUniformTool=new h.default,this.m_shdUniformTool.initialize())}getRenderProxy(){return this.m_rc}getRenderShader(){return this.m_shader}getTextureResource(){return this.m_texRes}updateTextureData(t,e){this.m_texRes.hasResUid(t.getResUid())&&(e?(this.m_deferredTextures.push(t),this.m_haveDeferredUpdate=!0):t.__$updateToGpu(this.m_texRes))}updateDispTRO(t,e){t.__$ruid>-1&&(e?(this.m_deferredTROs.push(t),this.m_haveDeferredUpdate=!0):this.updateTextureTRO(t))}createTRO(t,e){if(null!=t){for(let e=0;e<t.length;++e)null!=t[e]&&t[e].__$setRenderProxy(this.m_rc);return n.TextureRenderObj.Create(this.m_texRes,t,e)}return null}updateTextureTRO(t){if(null!=t.__$$runit){let e=t.getMaterial();if(null!=e){let s=this.m_texRes,i=t.__$$runit,r=n.TextureRenderObj.GetByMid(s.getRCUid(),e.__$troMid);if(null!=i.tro&&(null==r||i.tro.getMid()!=r.getMid())){let t=this.m_shdpBuilder.findShdProgramByShdData(e.getShaderData());null!=t&&(t.getTexTotal()>0?(null==r&&(r=this.createTRO(e.getTextureList(),t.getTexTotal())),i.tro!=r&&(null!=i.tro&&i.tro.__$detachThis(),i.tro=r,r.__$attachThis(),i.texMid=i.tro.getMid(),this.m_processBuider.rejoinRunitForTro(i),e.__$troMid=i.tro.getMid())):i.tro!=this.m_emptyTRO&&(null!=i.tro&&i.tro.__$detachThis(),i.tro=this.m_emptyTRO,i.texMid=i.tro.getMid(),this.m_processBuider.rejoinRunitForTro(i),e.__$troMid=i.texMid))}}}}updateDispMaterial(t,e){let s=null;if(e.__$ruid>=0){let i=this.m_rc,r=e.getMaterial();if(null!=r){if(null==r.getShaderData()){let t=r.getTextureList(),e=null!=t&&null!=t&&t.length>0;r.initializeByCodeBuf(e)}s=this.m_shdpBuilder.create(r.getShaderData()),s.upload(i.RContext,i.getUid()),t.shdUid=s.getUid();let n=null;if(s.getTexTotal()>0?(n=this.createTRO(r.getTextureList(),s.getTexTotal()),t.tro!=n&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=n,n.__$attachThis(),t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.m_processBuider.rejoinRunitForTro(t),r.__$troMid=t.tro.getMid())):t.tro!=this.m_emptyTRO&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=this.m_emptyTRO,t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.m_processBuider.rejoinRunitForTro(t),r.__$troMid=t.texMid),null==this.m_shader.getSharedUniformByShd(s)){let t=this.createsharedMList(r,s);if(null!=t)for(let e=0;e<t.length;++e)t[e].program=s.getGPUProgram();this.m_shader.setSharedUniformByShd(s,this.m_shdUniformTool.buildShared(t,i,s))}let h=s.hasUniformByName(a.default.LocalTransformMatUNS);null==r.__$uniform&&(r.__$uniform=this.m_shdUniformTool.buildLocalFromData(r.createSelfUniformData(),s)),h&&null!=e.getTransform()&&(t.transUniform=o.default.GetTransUniform(e.getTransform())),null==t.transUniform?(t.transUniform=this.m_shdUniformTool.buildLocalFromTransformV(h?e.getMatrixFS32():null,s),o.default.SetTransUniform(e.getTransform(),t.transUniform)):t.transUniform=this.m_shdUniformTool.updateLocalFromTransformV(t.transUniform,h?e.getMatrixFS32():null,s),t.polygonOffset=r.getPolygonOffset(),t.uniform=r.__$uniform}}return s}updateVtxDataToGpuByUid(t,e){this.m_vtxRes.updateDataToGpu(t,e)}updateDispVbuf(t,e){if(t.__$ruid>-1)if(e)this.m_deferredVbufs.push(t),this.m_haveDeferredUpdate=!0;else{let e=t.__$$runit;if(null!=e&&e.vtxUid!=t.vbuf.getUid()){let s=e.vtxUid,i=this.m_vtxRes;i.hasResUid(s)&&i.__$detachRes(s),e.vro.__$detachThis(),this.buildVtxRes(t,e,this.m_shdpBuilder.findShdProgramByUid(e.shdUid)),e.__$rprouid>=0&&this.m_processBuider.rejoinRunitForVro(e)}}}buildVtxRes(t,e,s){if(null!=t.vbuf){let i=this.m_vtxRes;e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,e.visible=t.visible,e.setVisible(t.visible),e.drawMode=t.drawMode,e.renderState=t.renderState,e.rcolorMask=t.rcolorMask,e.trisNumber=t.trisNumber;let r,a=t.vbuf.getUid(),n=!0;i.hasResUid(a)?(r=i.getVertexRes(a),n=r.version!=t.vbuf.version,n&&(i.destroyRes(a),r.rcuid=i.getRCUid(),r.resUid=a)):(r=new _.GpuVtxObject,r.rcuid=i.getRCUid(),r.resUid=a,i.addVertexRes(r)),n&&(r.indices.ibufStep=t.vbuf.getIBufStep(),r.indices.initialize(this.m_roVtxBuild,t.vbuf),r.vertex.initialize(this.m_roVtxBuild,s,t.vbuf),r.version=t.vbuf.version),i.__$attachRes(a),e.vro=r.createVRO(this.m_roVtxBuild,s,!0),e.indicesRes=e.vro.indicesRes,e.vro.__$attachThis(),e.vtxUid=t.vbuf.getUid(),e.ibufStep=e.vro.ibufStep,e.ibufType=4!=e.ibufStep?this.m_rc.UNSIGNED_SHORT:this.m_rc.UNSIGNED_INT}}buildGpuDisp(t){if(t.__$ruid<0&&null!=t.getMaterial()){t.__$$rsign=r.DisplayRenderSign.LIVE_IN_RENDERER;let e=this.m_rpoUnitBuilder.create();if(t.__$ruid=e.uid,t.__$$runit=e,null!=t.getPartGroup()){e.partGroup=t.getPartGroup().slice(0),e.partTotal=e.partGroup.length;let s=e.partGroup;for(let t=0,i=e.partTotal;t<i;)t++,s[t++]*=e.ibufStep}return e.setDrawFlag(t.renderState,t.rcolorMask),this.buildVtxRes(t,e,this.updateDispMaterial(e,t)),!0}return!1}update(){if(this.m_haveDeferredUpdate){this.m_haveDeferredUpdate=!1;let t=this.m_deferredVbufs.length,e=0;if(t>0){for(;e<t;++e)this.updateDispVbuf(this.m_deferredVbufs[e],!1);this.m_deferredVbufs=[]}if(t=this.m_deferredTROs.length,t>0){for(e=0;e<t;++e)this.updateTextureTRO(this.m_deferredTROs[e]);this.m_deferredTROs=[]}if(t=this.m_deferredTextures.length,t>0){for(e=0;e<t;++e)this.m_deferredTextures[e].__$updateToGpu(this.m_texRes);this.m_deferredTextures=[]}}}createsharedMList(t,e){let s=t.createSharedUniforms();if(null==s){let i=t.createSharedUniformsData();if(null!=i&&i.length>0){s=[];for(let t=0;t<i.length;++t)if(null!=i[t]){let r=this.m_shdUniformTool.buildLocalFromData(i[t],e);s.push(r)}s.length<1&&(s=null)}}return s}updateGlobalMaterial(t,e=!1){if(null!=t){let s=this.m_rc,i=null,r=null,a=null,n=!1;null==t.getShaderData()?(a=t.getTextureList(),n=null!=a&&a.length>0,t.initializeByCodeBuf(n)):a=t.getTextureList(),r=this.m_shdpBuilder.create(t.getShaderData()),r.upload(s.RContext,s.getUid());let h=r.getTexTotal();if(h>0&&(i=this.createTRO(a,h)),null==this.m_shader.getSharedUniformByShd(r)){let e=this.createsharedMList(t,r);if(null!=e)for(let t=0;t<e.length;++t)e[t].program=r.getGPUProgram();this.m_shader.setSharedUniformByShd(r,this.m_shdUniformTool.buildShared(e,s,r))}null==t.__$uniform&&(t.__$uniform=this.m_shdUniformTool.buildLocalFromData(t.createSelfUniformData(),r)),this.m_shader.__$globalUniform=t.__$uniform,this.m_shader.bindToGpu(r.getUid()),e&&null!=t.__$uniform&&this.m_shader.useUniform(t.__$uniform),null!=i&&i.run()}}reset(){this.m_deferredVbufs=[],this.m_deferredTROs=[]}}e.default=m},3806:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("a996")),a=i(s("1710")),n=i(s("7045")),h=i(s("9260")),l=i(s("badb"));class o{constructor(t,e){this.m_rcuid=0,this.uProbe=null,this.pixelRatio=1,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.m_viewX=0,this.m_viewY=0,this.m_viewW=1,this.m_viewH=1,this.m_mouseEvtDispatcher=new l.default,this.m_resize_listener=[],this.m_resize_ers=[],this.m_enterFrame_listener=[],this.m_enterFrame_ers=[],this.m_keyEvt=new n.default,this.m_keyDown_listener=[],this.m_keyDown_ers=[],this.m_keyUp_listener=[],this.m_keyUp_ers=[],this.m_preStageWidth=0,this.m_preStageHeight=0,this.m_mouseEvt=new a.default,this.m_baseEvt=new r.default,this.m_autoSynViewAndStageSize=!0,this.m_enterFrameEvt=new r.default,this.m_rcuid=t,null==o.s_document&&(o.s_document=e,e.onkeydown=function(t){h.default.KeyDown(t)},e.onkeyup=function(t){h.default.KeyUp(t)}),h.default.AddEventListener(n.default.KEY_DOWN,this,this.keyDown),h.default.AddEventListener(n.default.KEY_UP,this,this.keyUp)}getRCUid(){return this.m_rcuid}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.m_viewX}getViewY(){return this.m_viewY}getViewWidth(){return this.m_viewW}getViewHeight(){return this.m_viewH}setViewPort(t,e,s,i){this.m_autoSynViewAndStageSize=!1,this.m_viewX=t,this.m_viewY=e,s==this.m_viewW&&i==this.m_viewH||(this.m_viewW=s,this.m_viewH=i,this.updateViewUData())}updateViewUData(){this.uProbe.setVec4Data(2/this.stageWidth,2/this.stageHeight,this.stageWidth,this.stageHeight),this.uProbe.update(),this.m_preStageWidth=this.m_viewW,this.m_preStageHeight=this.m_viewH}update(){this.m_preStageWidth==this.stageWidth&&this.m_preStageHeight==this.stageHeight||(this.m_autoSynViewAndStageSize&&(this.m_viewW=this.stageWidth,this.m_viewH=this.stageHeight,this.updateViewUData()),this.stageHalfWidth=.5*this.stageWidth,this.stageHalfHeight=.5*this.stageHeight,this.m_baseEvt.target=this,this.m_baseEvt.type=r.default.RESIZE,this.m_baseEvt.phase=1,this.sendResizeEvt(this.m_baseEvt))}keyDown(t){this.m_keyEvt.phase=1,this.m_keyEvt.type=n.default.KEY_DOWN,this.m_keyEvt.altKey=t.altKey,this.m_keyEvt.ctrlKey=t.ctrlKey,this.m_keyEvt.shiftKey=t.shiftKey,this.m_keyEvt.repeat=t.repeat,this.m_keyEvt.key=t.key,this.m_keyEvt.keyCode=t.keyCode,this.m_keyEvt.location=t.location;let e=this.m_keyDown_listener.length;for(var s=0;s<e;++s)this.m_keyDown_listener[s].call(this.m_keyDown_ers[s],this.m_keyEvt)}keyUp(t){this.m_keyEvt.phase=1,this.m_keyEvt.type=n.default.KEY_UP,this.m_keyEvt.altKey=t.altKey,this.m_keyEvt.ctrlKey=t.ctrlKey,this.m_keyEvt.shiftKey=t.shiftKey,this.m_keyEvt.repeat=t.repeat,this.m_keyEvt.key=t.key,this.m_keyEvt.keyCode=t.keyCode,this.m_keyEvt.location=t.location,this.m_keyEvt.target=this;let e=this.m_keyUp_listener.length;for(var s=0;s<e;++s)this.m_keyUp_listener[s].call(this.m_keyUp_ers[s],this.m_keyEvt)}sendResizeEvt(t){let e=this.m_resize_listener.length;for(var s=0;s<e;++s)this.m_resize_listener[s].call(this.m_resize_ers[s],t)}mouseDown(t=1){this.m_mouseEvt.type=a.default.MOUSE_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseUp(t=1){this.m_mouseEvt.phase=1,this.m_mouseEvt.type=a.default.MOUSE_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseClick(){this.m_mouseEvt.type=a.default.MOUSE_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseDoubleClick(){this.m_mouseEvt.type=a.default.MOUSE_DOUBLE_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightDown(t=1){this.m_mouseEvt.type=a.default.MOUSE_RIGHT_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightUp(t=1){this.m_mouseEvt.type=a.default.MOUSE_RIGHT_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseBgDown(){this.m_mouseEvt.type=a.default.MOUSE_BG_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseBgUp(){this.m_mouseEvt.type=a.default.MOUSE_BG_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseBgClick(){this.m_mouseEvt.type=a.default.MOUSE_BG_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightClick(){this.m_mouseEvt.type=a.default.MOUSE_RIGHT_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMove(){this.m_mouseEvt.type=a.default.MOUSE_MOVE,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseWheel(t){this.m_mouseEvt.type=a.default.MOUSE_WHEEL,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.wheelDeltaY=t.wheelDeltaY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseCancel(){this.m_mouseEvt.type=a.default.MOUSE_CANCEL,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiDown(t){this.m_mouseEvt.type=a.default.MOUSE_MULTI_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiUp(t){this.m_mouseEvt.type=a.default.MOUSE_MULTI_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiMove(t){this.m_mouseEvt.type=a.default.MOUSE_MULTI_MOVE,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseWindowUp(t=1){}mouseWindowRightUp(t=1){}enterFrame(){this.m_enterFrameEvt.type=r.default.ENTER_FRAME;let t=this.m_enterFrame_listener.length;for(var e=0;e<t;++e)this.m_enterFrame_listener[e].call(this.m_enterFrame_ers[e],this.m_enterFrameEvt)}addEventListener(t,e,s,i=!0,a=!0){if(null!=s&&null!=e){let h=0;switch(t){case r.default.RESIZE:for(h=this.m_resize_listener.length-1;h>=0;--h)if(e===this.m_resize_ers[h])break;h<0&&(this.m_resize_ers.push(e),this.m_resize_listener.push(s));break;case r.default.ENTER_FRAME:for(h=this.m_enterFrame_listener.length-1;h>=0;--h)if(e===this.m_enterFrame_ers[h])break;h<0&&(this.m_enterFrame_ers.push(e),this.m_enterFrame_listener.push(s));break;case n.default.KEY_DOWN:for(h=this.m_keyDown_listener.length-1;h>=0;--h)if(e===this.m_keyDown_ers[h])break;h<0&&(this.m_keyDown_ers.push(e),this.m_keyDown_listener.push(s));break;case n.default.KEY_UP:for(h=this.m_keyUp_listener.length-1;h>=0;--h)if(e===this.m_keyUp_ers[h])break;h<0&&(this.m_keyUp_ers.push(e),this.m_keyUp_listener.push(s));break;default:this.m_mouseEvtDispatcher.addEventListener(t,e,s,i,a);break}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=0;switch(t){case r.default.RESIZE:for(i=this.m_resize_listener.length-1;i>=0;--i)if(e===this.m_resize_ers[i]){this.m_resize_ers.splice(i,1),this.m_resize_listener.splice(i,1);break}break;case r.default.ENTER_FRAME:for(i=this.m_enterFrame_listener.length-1;i>=0;--i)if(e===this.m_enterFrame_ers[i]){this.m_enterFrame_ers.splice(i,1),this.m_enterFrame_listener.splice(i,1);break}break;case n.default.KEY_DOWN:for(i=this.m_keyDown_listener.length-1;i>=0;--i)if(e===this.m_keyDown_ers[i]){this.m_keyDown_ers.splice(i,1),this.m_keyDown_listener.splice(i,1);break}break;case n.default.KEY_UP:for(i=this.m_keyUp_listener.length-1;i>=0;--i)if(e===this.m_keyUp_ers[i]){this.m_keyUp_ers.splice(i,1),this.m_keyUp_listener.splice(i,1);break}break;default:this.m_mouseEvtDispatcher.removeEventListener(t,e,s);break}}}}o.s_document=null,e.default=o},3844:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},"38de":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("f48d"));class h extends n.default{constructor(){super(...arguments),this.tv=new a.default(1,0,0)}update(){this.tv.normalize()}updateFast(){this.tv.normalize()}static IntersectionTri(t,e,s,i,r,a){return 0}static IntersectionLS(t,e,s,i,r,l=1){let o=h.__tAv;if(o.copyFrom(i),o.subtractBy(s),o.normalize(),a.default.Cross(e,o,r),r.normalize(),o.w=r.dot(t)-r.dot(i),Math.abs(o.w)<=l){r.crossBy(e),r.normalize(),r.w=r.dot(t),o.w=(r.w-r.dot(s))/o.dot(r),r.copyFrom(o),r.scaleBy(o.w),r.addBy(s),o.copyFrom(r),o.subtractBy(s);let a=n.default.__tV1;if(a.copyFrom(r),a.subtractBy(i),o.dot(a)<=0)return 1}return 0}static IntersectioNearSphere2(t,e,s,i,a){let n=h.__tAv;if(n.x=s.x-t.x,n.y=s.y-t.y,n.z=s.z-t.z,n.w=n.dot(e),i*=i,n.w>r.default.MATH_MIN_POSITIVE){if(a.copyFrom(e),a.scaleBy(n.w),a.subtractBy(n),n.x=a.getLengthSquared(),n.x<=i)return n.w-=Math.sqrt(i-n.x),a.copyFrom(e),a.scaleBy(n.w),a.addBy(t),a.w=1,1}else if(n.getLengthSquared()<=i&&(a.copyFrom(e),a.scaleBy(n.w),a.subtractBy(n),n.x=a.getLengthSquared(),n.x<=i))return n.w+=Math.sqrt(i-n.x),a.copyFrom(e),a.scaleBy(n.w),a.addBy(t),a.w=1,1;return 0}static IntersectioNearSphere(t,e,s,i,a){let n=h.__tAv;if(n.x=s.x-t.x,n.y=s.y-t.y,n.z=s.z-t.z,n.w=n.dot(e),n.w>r.default.MATH_MIN_POSITIVE){if(a.x=n.x-n.w*e.x,a.y=n.y-n.w*e.y,a.z=n.z-n.w*e.z,a.x=a.getLengthSquared(),a.w=i*i,a.x<=a.w)return a.x=n.getLengthSquared(),a.z=a.w-a.x,n.normalize(),a.y=n.dot(e)*Math.sqrt(a.x),n.w=.5*(-a.y+Math.sqrt(a.y*a.y+4*a.z)),a.copyFrom(e),a.scaleBy(n.w),a.addBy(t),a.w=1,1}else if(a.x=n.getLengthSquared(),a.w=i*i,a.x<=a.w)return a.z=a.w-a.x,n.normalize(),a.y=n.dot(e)*Math.sqrt(a.x),n.w=.5*(-a.y+Math.sqrt(a.y*a.y+4*a.z)),a.copyFrom(e),a.scaleBy(n.w),a.addBy(t),a.w=1,1;return 0}static IntersectSphere(t,e,s,i){let a=h.__tAv;return a.x=s.x-t.x,a.y=s.y-t.y,a.z=s.z-t.z,a.w=a.dot(e),a.w<r.default.MATH_MIN_POSITIVE||(a.x-=a.w*e.x,a.y-=a.w*e.y,a.z-=a.w*e.z),a.getLengthSquared()<=i*i}}h.__tAv=new a.default,e.default=h},3930:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{constructor(t=1,e=1,s=1,i=1){this.r=1,this.g=1,this.b=1,this.a=1,this.r=t,this.g=e,this.b=s,this.a=i}setRGB3Bytes(t,e,s){this.r=t/255,this.g=e/255,this.b=s/255}setRGB3f(t,e,s){this.r=t,this.g=e,this.b=s}setRGBUint24(t){this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255}getRGBUint24(){return(Math.round(255*this.r)<<16)+(Math.round(255*this.g)<<8)+Math.round(255*this.b)}setRGBA4f(t,e,s,i){this.r=t,this.g=e,this.b=s,this.a=i}copyFrom(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}copyFromRGB(t){this.r=t.r,this.g=t.g,this.b=t.b}scaleBy(t){this.r*=t,this.g*=t,this.b*=t}inverseRGB(){this.r=1-this.r,this.g=1-this.g,this.b=1-this.b}randomRGB(t=1,e=0){this.r=Math.random()*t,this.g=Math.random()*t,this.b=Math.random()*t,this.r+=e,this.g+=e,this.b+=e}normalizeRandom(t=1,e=0){this.r=Math.random(),this.g=Math.random(),this.b=Math.random();let s=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);s>r.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/s,this.g=t*this.g/s,this.b=t*this.b/s),this.r+=e,this.g+=e,this.b+=e}normalize(t){void 0==t&&(t=1);let e=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);e>r.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/e,this.g=t*this.g/e,this.b=t*this.b/e)}getCSSDecRGBAColor(){let t=Math.floor(255*this.r),e=Math.floor(255*this.g),s=Math.floor(255*this.b),i=this.a;return"rgba("+t+","+e+","+s+","+i+")"}getCSSHeXRGBColor(){let t="#",e=Math.floor(255*this.r);return t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.g),t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.b),t+=e<15?"0"+e.toString(16):""+e.toString(16),t}toString(){return"[Color4(r="+this.r+", g="+this.g+",b="+this.b+",a="+this.a+")]"}}e.default=a},"3a1d":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("fce7"),r=s("7566"),a=s("2356"),n=s("7ebf"),h=s("c917"),l=s("d2d9"),o=s("42a2"),_=s("85f5");class m{constructor(){this.m_initBoo=!0,this.m_teDelay=1e3,this.m_teTime=0,this.m_maxThreadsTotal=0,this.m_thrSupportFlag=-1,this.m_codeBlob=null,this.m_commonModuleUrls=[],this.m_threads=[],this.m_threadsTotal=0,this.m_threadEnabled=!0,this.m_thrIdexSDList=[],this.m_thrIndexList=[],this.m_codeStrList=[],this.m_dataPool=new r.ThrDataPool,this.m_graphJsonStr="",this.m_autoSendData=!1,this.m_currNewThr=null;let t=i.ThreadConfigure.MAX_TASKS_TOTAL;this.m_taskPool=new o.ThreadTaskPool(t),this.m_descList=new Array(t),this.m_descList.fill(null),this.m_tdrManager=new _.TDRManager(t),this.m_teTime=Date.now()}setParams(t,e=1e3){this.m_autoSendData=t,this.m_teDelay=e}hasRouterByTaskClass(t){return this.m_tdrManager.hasRouterByTaskClass(t)}setTaskDataRouter(t){this.m_tdrManager.setRouter(t)}bindTask(t,e=-1){if(null!=t){let s=t.attach(this.m_taskPool);if(s){let s=null;if(e>=0&&e<this.m_maxThreadsTotal){for(;;){if(!(e>=this.m_threadsTotal))break;this.createThread()}s=this.m_threads[e].localDataPool}t.setDataPool(this.m_dataPool,s);let i=t.dependency;null!=i&&(i.isJSFile()?this.initTaskByURL(i.threadCodeFileURL,t.getTaskClass()):i.isDependency()?this.initTaskByDependency(i.dependencyUniqueName,t.getTaskClass(),i.moduleName):i.isCodeString()&&this.initTaskByCodeStr(i.threadCodeString,t.getTaskClass(),i.moduleName))}}}sendDataToThreadAt(t,e){if(t>=0&&t<this.m_maxThreadsTotal){if(t>=this.m_threadsTotal)for(;;){if(!(t>=this.m_threadsTotal))break;this.createThread()}null!=e&&e.sendStatus<0&&(this.m_threads[t].isFree()?(e.sendStatus=0,this.m_threads[t].sendDataTo(e)):this.m_threads[t].localDataPool.addData(e))}else this.m_thrIdexSDList.push(e),this.m_thrIndexList.push(t)}hasTaskData(){return this.m_dataPool.isEnabled()}getThrDataPool(){return this.m_dataPool}run(){let t=!1;if(this.getThreadEnabled()){this.m_tdrManager.run();let e=0;if(this.m_dataPool.isEnabled())for(let t=0;t<this.m_threadsTotal;++t)this.m_threads[t].isFree()?this.m_dataPool.sendDataTo(this.m_threads[t]):this.m_dataPool.isEnabled()&&e++;else for(let t=0;t<this.m_threadsTotal;++t)this.m_threads[t].sendPoolDataToThread()||this.m_threads[t].hasDataToThread()&&e++;if(e+=this.m_dataPool.isEnabled()?1:0,e>0)this.createThread();else{e=0;for(let t=0;t<this.m_threadsTotal;++t)this.m_threads[t].isFree()&&e++;t=e>=this.m_threadsTotal,t||(this.m_teTime=Date.now())}}if(t&&this.m_threadsTotal>0){let t=Date.now()-this.m_teTime;if(t>this.m_teDelay){this.m_teTime=Date.now();let t=this.m_threads[this.m_threadsTotal-1];t.isFree()&&(this.m_threads.pop(),this.m_threadsTotal--,t.destroy())}}}createThread(){if(null!=this.m_currNewThr&&(this.m_currNewThr.isEnabled()||this.m_currNewThr.isDestroyed())&&(this.m_currNewThr=null),null==this.m_currNewThr&&this.m_threadsTotal<this.m_maxThreadsTotal){let t=new n.ThreadBase(this.m_tdrManager,this.m_taskPool,this.m_graphJsonStr);this.m_currNewThr=t,t.autoSendData=this.m_autoSendData,t.globalDataPool=this.m_dataPool,t.initialize(this.m_codeBlob),this.m_threads.push(t),this.m_threadsTotal++,this.m_tdrManager.setThreads(this.m_threads);for(let i=0,r=this.m_descList.length;i<r;++i)t.initModuleByTaskDescriptor(this.m_descList[i]);t.initModules(this.m_commonModuleUrls);for(let i=0;i<this.m_codeStrList.length;++i)t.initModuleByCodeString(this.m_codeStrList[i]);this.m_threadsTotal>=this.m_maxThreadsTotal&&(this.m_commonModuleUrls=[],this.m_codeStrList=[]);let e=this.m_thrIdexSDList.slice(0),s=this.m_thrIndexList.slice(0);this.m_thrIdexSDList=[],this.m_thrIndexList=[];for(let i=0;i<e.length;++i)this.sendDataToThreadAt(s[i],e[i])}}addDataWithParam(t,e=null,s=null){let i=a.ThreadSendData.Create();i.taskCmd=t,i.streams=e,i.descriptor=s,this.addData(i)}addData(t){null!=t&&t.srcuid>=0&&this.m_dataPool.addData(t)}getAFreeThread(){for(let t=0;t<this.m_threadsTotal;++t)if(this.m_threads[t].isFree())return this.m_threads[t];return null}getThreadsTotal(){return this.m_threadsTotal}getMaxThreadsTotal(){return this.m_maxThreadsTotal}setThreadEnabled(t){this.m_thrSupportFlag>0&&(this.m_thrSupportFlag=t?2:1),this.m_threadEnabled=t}getThreadEnabled(){return this.m_threadEnabled}isSupported(){if(this.m_thrSupportFlag>0)return 2==this.m_thrSupportFlag;let t="undefined"!==typeof Worker&&"undefined"!==typeof Blob;return this.m_thrSupportFlag=t?2:1,this.m_threadEnabled=t,t}initTaskByURL(t,e,s=""){if(""!=t&&e>=0&&e<this.m_descList.length){let i=this.m_descList[e];null==i&&(i=new h.TaskDescriptor(e,l.ThreadCodeSrcType.JS_FILE_CODE,t,s),this.m_descList[e]=i,this.initModuleByTaskDescriptor(i))}}initTaskByDependency(t,e,s=""){if(""!=t&&e>=0&&e<this.m_descList.length){let i=this.m_descList[e];null==i&&(i=new h.TaskDescriptor(e,l.ThreadCodeSrcType.DEPENDENCY,t,s),this.m_descList[e]=i,this.initModuleByTaskDescriptor(i))}}initTaskByCodeStr(t,e,s){if(""!=t&&e>=0&&e<this.m_descList.length){let i=this.m_descList[e];null==i&&(i=new h.TaskDescriptor(e,l.ThreadCodeSrcType.STRING_CODE,t,s),this.m_descList[e]=i,this.initModuleByTaskDescriptor(i))}}initModuleByTaskDescriptor(t){for(let e=0;e<this.m_threadsTotal;++e)this.m_threads[e].initModuleByTaskDescriptor(t)}initModules(t){if(null!=t&&t.length>0){for(let e=0;e<t.length;++e){if(""==t[e])throw Error("moduleUrls["+e+'] == ""');this.m_commonModuleUrls.push(t[e])}for(let e=0;e<this.m_threadsTotal;++e)this.m_threads[e].initModules(t)}}initModuleByCodeString(t){if(t.length>8){this.m_threadsTotal<this.m_maxThreadsTotal&&this.m_codeStrList.push(t);for(let e=0;e<this.m_threadsTotal;++e)this.m_threads[e].initModuleByCodeString(t)}}destroy(){if(null!=this.m_tdrManager){for(let t=0;t<this.m_threadsTotal;++t)this.m_threads[t].destroy();this.m_threads=[],this.m_tdrManager.destroy(),this.m_tdrManager=null,this.m_threadsTotal=0}}setDependencyGraphJsonString(t){this.m_graphJsonStr=t}initialize(t,e,s=""){if(this.m_initBoo){if(this.getThreadEnabled()&&this.isSupported()){if(""==e)throw Error('coreCodeUrl == "" !!!');e=this.getUrl(e);let i=new XMLHttpRequest;i.open("GET",e,!0),i.onload=()=>{if(i.status<=206){let e=""==s?new Blob([i.responseText]):new Blob([s+i.responseText]);this.initThread(t,e)}},i.onerror=t=>{},i.send(null)}this.m_initBoo=!1}}initThread(t,e){t<1&&(t=1),this.m_codeBlob=e,this.m_maxThreadsTotal=t}getUrl(t){let e=t.indexOf("http://");if(e<0&&(e=t.indexOf("https://")),e>=0)return t;let s=window.location.href,i=s.slice(0,s.lastIndexOf("/")+1);return t=i+t,t}}e.ThreadSchedule=m},"3b73":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetWebBodyColor(t="white"){const e=document.body;e.style.background=t}static SetLanguage(t){i.s_language=t}static GetLanguage(){return""!=i.s_language||(i.s_language=navigator.language),i.s_language}static SetThreadEnabled(t){i.s_threadEnabled=t}static GetThreadEnabled(){return i.s_threadEnabled}static GetDebugEnabled(){return i.s_debugEnabled}static SetDebugEnabled(t){i.s_debugEnabled=t}static SetDevicePixelRatio(t){i.s_devicePixelRatio=t}static GetDevicePixelRatio(){return i.s_devicePixelRatio}static Initialize(t){i.s_inited&&(i.s_inited=!1,i.s_WEBGL_VER=t[0],i.TestMobileWeb(),i.s_language=navigator.language+"")}static IsWindowsPCOS(){return!(i.IsSafariWeb()||i.IsMobileWeb())}static IsWinExternalVideoCard(){if(i.s_winExternalVideoCardFlag>0)return 2==i.s_winExternalVideoCardFlag;let t=i.IsSafariWeb()||i.IsMobileWeb();return t||(t=i.GPU_RENDERER.indexOf("Intel(R)")<0),i.s_winExternalVideoCardFlag=t?2:1,2==i.s_winExternalVideoCardFlag}static TestSafariWeb(){return/Safari/.test(navigator.userAgent)&&/Mac OS/.test(navigator.userAgent)}static IsWebGL1(){return 1==i.s_WEBGL_VER}static IsWebGL2(){return 2==i.s_WEBGL_VER}static IsMobileWeb(){return i.s_mobileFlag>0?2==i.s_mobileFlag:i.TestMobileWeb()}static IsSafariWeb(){return i.s_safariFlag>0||(i.s_safariFlag=i.TestSafariWeb()?2:1),2==i.s_safariFlag}static IsIOS(){if(i.s_IOS_Flag>0)return 2==i.s_IOS_Flag;let t=!1;return t=!!/iPad|iPhone|iPod/.test(navigator.platform)||void 0!=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),i.s_IOS_Flag=t?2:1,t}static IsIpadOS(){if(i.s_IPad_Flag>0)return 2==i.s_IPad_Flag;let t=navigator.maxTouchPoints>0&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform);return!t&&/iPod|iPad|iPadPro|iPodPro/i.test(navigator.userAgent)&&(t=!0),i.s_IPad_Flag=t?2:1,t}static IsAndroidOS(){if(i.s_Android_Flag>0)return 2==i.s_Android_Flag;let t=i.TestMobileWeb();return t=!(!t||!/Android|Linux/i.test(navigator.userAgent)),i.s_Android_Flag=t?2:1,t}static TestMobileWeb(){return i.s_mobileFlag>0?2==i.s_mobileFlag:/mobile/.test(location.href)?(i.s_mobileFlag=2,2==i.s_mobileFlag):/Android/i.test(navigator.userAgent)?/Mobile/i.test(navigator.userAgent)?(i.s_mobileFlag=2,2==i.s_mobileFlag):(i.s_mobileFlag=1,2==i.s_mobileFlag):/webOS|iPhone|iPod|iPad|iPodPro|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(i.s_mobileFlag=2,2==i.s_mobileFlag):(i.s_mobileFlag=1,2==i.s_mobileFlag)}}i.s_inited=!0,i.s_WEBGL_VER=2,i.s_devicePixelRatio=1,i.s_mobileFlag=0,i.s_safariFlag=0,i.s_Android_Flag=0,i.s_IOS_Flag=0,i.s_IPad_Flag=0,i.s_winExternalVideoCardFlag=0,i.s_language="",i.s_debugEnabled=!0,i.GPU_VENDOR="unknown",i.GPU_RENDERER="unknown",i.MAX_TEXTURE_SIZE=4096,i.MAX_RENDERBUFFER_SIZE=4096,i.MAX_VIEWPORT_WIDTH=4096,i.MAX_VIEWPORT_HEIGHT=4096,i.SHOWLOG_ENABLED=!1,i.SHADERCODE_TRACE_ENABLED=!1,i.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,i.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,i.s_threadEnabled=!0,e.default=i},"3b80":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("d2d9");class r{constructor(){this.moduleName="",this.threadCodeString="",this.threadCodeFileURL="",this.dependencyUniqueName="",this.threadCodeSrcType=i.ThreadCodeSrcType.JS_FILE_CODE}isCodeString(){return this.threadCodeSrcType==i.ThreadCodeSrcType.STRING_CODE}isJSFile(){return this.threadCodeSrcType==i.ThreadCodeSrcType.JS_FILE_CODE}isDependency(){return this.threadCodeSrcType==i.ThreadCodeSrcType.DEPENDENCY}isCodeBlob(){return this.threadCodeSrcType==i.ThreadCodeSrcType.BLOB_CODE}clone(){let t=new r;return this.isCodeString()&&(t.threadCodeString=this.threadCodeString),this.isJSFile()&&(t.threadCodeFileURL=this.threadCodeFileURL),this.isDependency()&&(t.dependencyUniqueName=this.dependencyUniqueName),t.threadCodeSrcType=this.threadCodeSrcType,t}}e.TaskDependency=r;class a extends r{constructor(t){super(),this.threadCodeFileURL=t,this.threadCodeSrcType=i.ThreadCodeSrcType.JS_FILE_CODE}}e.TaskJSFileDependency=a;class n extends r{constructor(t){super(),this.dependencyUniqueName=t,this.threadCodeSrcType=i.ThreadCodeSrcType.DEPENDENCY}}e.TaskUniqueNameDependency=n;class h extends r{constructor(t,e){super(),this.threadCodeString=t,this.moduleName=e,this.threadCodeSrcType=i.ThreadCodeSrcType.STRING_CODE}}e.TaskCodeStringDependency=h},"3bda":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("a567");class r{static SetDebugEnabled(t){r.s_debugEanbled=t}static SetXY(t,e){r.s_leftX=t,r.s_topY=e}static SetTextBgColor(t){r.s_textBGColor=i.RGBColorUtil.uint24RGBToCSSHeXRGBColor(t),null!=r.s_infoDiv&&(r.s_infoDiv.style.backgroundColor=this.s_textBGColor)}static SetTextColor(t){r.s_textColor=i.RGBColorUtil.uint24RGBToCSSHeXRGBColor(t),null!=r.s_infoDiv&&(r.s_infoDiv.style.color=this.s_textColor)}static SetTextBgEnabled(t){if(this.s_textBgEnabled=t,null!=r.s_infoDiv){let t=r.s_infoDiv;r.s_textBgEnabled?t.style.backgroundColor=this.s_textBGColor:t.style.backgroundColor=""}}static ShowLog(t){r.s_debugEanbled&&(r.s_logStr.length>0?r.s_logStr+="<br/>"+t:r.s_logStr=t,r.UpdateDivText())}static GetLog(){return r.s_logStr}static ShowLogOnce(t){r.s_debugEanbled&&(r.s_logStr=t,r.UpdateDivText())}static ClearLog(t=""){r.s_debugEanbled&&(r.s_logStr=t,r.UpdateDivText())}static UpdateDivText(){if(r.s_debugEanbled)if(null!=r.s_infoDiv)r.s_infoDiv.innerHTML=r.s_logStr;else{let t=document.createElement("div");t.style.color="";let e=t;e.width=128,e.height=64,r.s_textBgEnabled?e.style.backgroundColor=this.s_textBGColor:e.style.backgroundColor="",e.style.color=this.s_textColor,e.style.left=r.s_leftX+"px",e.style.top=r.s_topY+"px",e.style.zIndex="9999",e.style.position="absolute",document.body.appendChild(e),r.s_infoDiv=e,e.innerHTML=r.s_logStr}}static ShowAtTop(){null!=r.s_infoDiv&&(r.s_infoDiv.parentElement.removeChild(r.s_infoDiv),document.body.appendChild(r.s_infoDiv))}}r.s_logStr="",r.s_infoDiv=null,r.s_debugEanbled=!1,r.s_textBGColor="#aa0033",r.s_textColor="#000000",r.s_textBgEnabled=!0,r.s_leftX=0,r.s_topY=128,e.default=r},"3c81":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("7696"));class n extends r.default{setCreateParams(t,e,s,i,r,a){this.m_shader=t,this.m_rpoNodeBuilder=e,this.m_rpoUnitBuilder=s,this.m_vtxResource=i,this.m_batchEnabled=r,this.m_fixedState=a}createNode(){return new a.default(this.m_shader,this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_vtxResource,this.m_batchEnabled,this.m_fixedState)}rejoinRunitForTro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForTro(t)}rejoinRunitForVro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForVro(t)}}e.default=n},"402a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=i(s("8e17")),n=i(s("fecb")),h=i(s("29ef")),l=i(s("0929")),o=s("cc48"),_=i(s("dc2b"));class m{constructor(t=null){this.m_uid=0,this.m_transfrom=null,this.m_eventDispatcher=null,this.m_visible=!0,this.m_drawEnabled=!0,this.m_rcolorMask=h.default.COLOR_MASK_ALL_TRUE,this.m_renderState=h.default.BACK_CULLFACE_NORMAL_STATE,this.m_display=null,this.m_mesh=null,this.m_localBounds=null,this.m_globalBounds=null,this.m_localBuondsVer=-1,this.m_parent=null,this.m_renderProxy=null,this.m_pipeLine=null,this.__$rseFlag=r.default.DEFAULT,this.name="DisplayEntity",this.spaceCullMask=o.SpaceCullingMask.CAMERA,this.drawEnabled=!1,this.mouseEnabled=!1,this.vbWholeDataEnabled=!0,this.pipeTypes=null,this.m_texChanged=!1,this.m_meshChanged=!1,this.m_lBoundsVS=null,this.m_transStatus=l.default.UPDATE_TRANSFORM,this.m_uid=m.s_uid++,this.m_transfrom=null==t?l.default.Create():t,this.createBounds()}createBounds(){this.m_globalBounds=new n.default}__$setRenderProxy(t){this.m_renderProxy=t}__$setParent(t){this.m_parent,this.m_parent=t}__$getParent(){return this.m_parent}__$testSpaceEnabled(){return r.default.TestSpaceEnabled2(this.__$rseFlag)}__$testContainerEnabled(){return r.default.TestContainerEnabled(this.__$rseFlag)}__$testRendererEnabled(){return r.default.TestRendererEnabled(this.__$rseFlag)}getRendererUid(){return r.default.GetRendererUid(this.__$rseFlag)}setMaterialPipeline(t){this.m_pipeLine=t}getMaterialPipeline(){return this.m_pipeLine}isFree(){return this.__$rseFlag==r.default.DEFAULT}dispatchEvt(t){return null!=this.m_eventDispatcher?this.m_eventDispatcher.dispatchEvt(t):0}getEvtDispatcher(t){return this.m_eventDispatcher}setEvtDispatcher(t){this.m_eventDispatcher=t}getGlobalBounds(){return this.m_globalBounds}getLocalBounds(){return this.m_mesh.bounds}getGlobalBoundsVer(){return null!=this.m_globalBounds?this.m_globalBounds.version:-1}__$setDrawEnabled(t){this.m_drawEnabled!=t&&(this.m_drawEnabled=t,null!=this.m_display&&(this.m_display.visible=this.m_visible&&t,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setVisible(this.m_display.visible)))}isDrawEnabled(){return this.m_drawEnabled}updateMeshToGpu(t=null,e=!0){null!=t&&(this.m_renderProxy=t),null!=this.m_renderProxy&&null!=this.m_display&&this.m_display.__$ruid>-1&&(this.m_meshChanged?(this.m_meshChanged=!1,this.m_renderProxy.VtxBufUpdater.updateDispVbuf(this.m_display,e)):this.m_renderProxy.VtxBufUpdater.updateVtxDataToGpuByUid(this.m_display.vbuf.getUid(),e))}updateMaterialToGpu(t=null,e=!0){null!=t&&(this.m_renderProxy=t),null!=this.m_renderProxy&&null!=this.m_display&&this.m_display.__$ruid>-1&&this.m_texChanged&&(this.m_texChanged=!1,this.m_renderProxy.MaterialUpdater.updateDispTRO(this.m_display,e))}setTextureList(t){if(null!=this.m_display&&this.m_display.__$ruid>-1){let e=this.m_display.getMaterial();null!=e&&(e.setTextureList(t),this.m_texChanged=!0)}}setTextureAt(t,e){if(null!=this.m_display&&this.m_display.__$ruid>-1){let s=this.m_display.getMaterial();null!=s&&(s.setTextureAt(t,e),this.m_texChanged=!0)}}setSortValue(t){null!=this.m_display&&null!=this.m_display.__$$runit&&(this.m_display.__$$runit.value=t)}setVisible(t){this.m_visible!=t&&(this.m_visible=t,null!=this.m_display&&(this.m_display.visible=t&&this.m_drawEnabled,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setVisible(this.m_display.visible)))}getVisible(){return this.m_visible}getTransform(){return this.m_transfrom}copyPositionFrom(t){null!=t&&this.m_transfrom.copyPositionFrom(t.getTransform())}copyMeshFrom(t){null!=t&&this.setMesh(t.getMesh())}copyMaterialFrom(t){null!=t&&this.setMaterial(t.getMaterial())}copyTransformFrom(t){let e=t;null!=e&&this.m_transfrom.copyFrom(e.m_transfrom)}initDisplay(t){this.m_display.vbuf=t.__$attachVBuf(),this.m_display.ivsIndex=0,this.m_display.ivsCount=t.vtCount,this.m_display.drawMode=t.drawMode,this.m_display.trisNumber=t.trisNumber,this.m_display.visible=this.m_visible&&this.m_drawEnabled}setMesh(t){null==this.m_mesh?null!=t&&(t.isEnabled()||t.rebuild(),t.isEnabled()&&(this.m_mesh=t,t.__$attachThis(),null==this.m_display&&this.createDisplay(),null!=this.m_display&&(this.m_display.setTransform(this.m_transfrom.getMatrix()),this.initDisplay(t)),null==this.m_localBounds?this.m_localBounds=t.bounds:this.m_localBounds.copyFrom(t.bounds),this.updateMesh())):null!=this.m_display&&this.m_display.__$ruid>-1&&this.m_mesh!=t&&null!=t&&(this.m_transfrom.updatedStatus|=2,this.m_mesh.__$detachVBuf(this.m_display.vbuf),this.m_mesh.__$detachThis(),t.__$attachThis(),this.m_mesh=t,this.initDisplay(t),this.updateMesh(),this.m_meshChanged=!0)}updateMesh(){}getIvsIndex(){return this.m_display.ivsIndex}getIvsCount(){return this.m_display.ivsCount}setIvsParam(t,e,s=!1){if(null!=this.m_display&&(this.m_display.ivsIndex=t,this.m_display.ivsCount=e,this.m_display.__$ruid>-1&&(this.m_display.__$$runit.trisNumber=Math.floor((e-t)/3),this.m_display.__$$runit.setIvsParam(t,e),this.m_display.__$$runit.drawMode=this.m_mesh.drawMode,s&&this.isPolyhedral()))){this.m_localBounds==this.m_mesh.bounds&&(this.m_localBounds=new n.default,this.m_localBounds.copyFrom(this.m_mesh.bounds)),this.m_transStatus=l.default.UPDATE_TRANSFORM,this.m_localBounds.reset();let s=this.m_mesh.getIVS();this.m_localBounds.addXYZFloat32AndIndicesArr(this.m_mesh.getVS(),s.subarray(t,t+e)),this.m_localBounds.update()}}getMesh(){return this.m_mesh}hasMesh(){return null!=this.m_mesh}isPolyhedral(){return null==this.m_mesh||this.m_mesh.isPolyhedral()}testRay(t,e,s,i){return this.m_mesh.testRay(t,e,s,i)}setMaterial(t){null!=t&&(null==this.m_display&&(this.m_display=_.default.Create(),this.m_display.setTransform(this.m_transfrom.getMatrix()),this.m_display.visible=this.m_visible&&this.m_drawEnabled),this.m_display.getMaterial()!=t&&(r.default.RENDERER_UID_FLAG&this.__$rseFlag)==r.default.RENDERER_UID_FLAG&&this.m_display.__$ruid<0&&(this.m_display.renderState=this.m_renderState,this.m_display.rcolorMask=this.m_rcolorMask,this.m_display.setMaterial(t)))}getMaterial(){return null!=this.m_display?this.m_display.getMaterial():null}getDisplay(){return this.m_display}getInvMatrix(){return this.m_transfrom.getInvMatrix()}getMatrix(t=!0){return this.m_transfrom.getMatrix(t)}getToParentMatrix(){return this.m_transfrom.getToParentMatrix()}setRenderColorMask(t){this.m_rcolorMask=t,null!=this.m_display&&(this.m_display.rcolorMask=this.m_rcolorMask,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setDrawFlag(this.m_renderState,this.m_rcolorMask))}setRenderColorMaskByName(t){this.m_rcolorMask=h.default.GetRenderColorMaskByName(t),null!=this.m_display&&(this.m_display.rcolorMask=this.m_rcolorMask,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setDrawFlag(this.m_renderState,this.m_rcolorMask))}setRenderState(t){this.m_renderState=t,null!=this.m_display&&(this.m_display.renderState=this.m_renderState,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setDrawFlag(this.m_renderState,this.m_rcolorMask))}setRenderStateByName(t){this.m_renderState=h.default.GetRenderStateByName(t),null!=this.m_display&&(this.m_display.renderState=this.m_renderState,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setDrawFlag(this.m_renderState,this.m_rcolorMask))}createDisplay(){this.m_display=_.default.Create()}activeDisplay(){if(null!=this.m_display){let t=this.m_display.getMaterial();if(null!=t){if(null==t.getShaderData()&&null!=t.getCodeBuf()&&null==t.getShaderData()){let e=t.getTextureList(),s=null!=e&&e.length>0;null==t.getMaterialPipeline()&&null!=this.getMaterialPipeline()&&t.setMaterialPipeline(this.getMaterialPipeline()),null==t.pipeTypes&&(t.pipeTypes=this.pipeTypes),t.initializeByCodeBuf(s)}null==this.getMesh()&&(this.__activeMesh(t),this.m_display.name=this.name)}}}__activeMesh(t){}getUid(){return this.m_uid}setXYZ(t,e,s){this.m_transfrom.setXYZ(t,e,s)}offsetPosition(t){this.m_transfrom.offsetPosition(t)}setPosition(t){this.m_transfrom.setPosition(t)}getPosition(t){this.m_transfrom.getPosition(t)}setRotation3(t){this.m_transfrom.setRotationXYZ(t.x,t.y,t.z)}setRotationXYZ(t,e,s){this.m_transfrom.setRotationXYZ(t,e,s)}setScale3(t){this.m_transfrom.setScaleXYZ(t.x,t.y,t.z)}setScaleXYZ(t,e,s){this.m_transfrom.setScaleXYZ(t,e,s)}getRotationXYZ(t){this.m_transfrom.getRotationXYZ(t)}getScaleXYZ(t){this.m_transfrom.getScaleXYZ(t)}localToGlobal(t){null!=this.m_transfrom&&this.m_transfrom.localToGlobal(t)}globalToLocal(t){null!=this.m_transfrom&&this.m_transfrom.globalToLocal(t)}isInRenderer(){return(this.__$rseFlag&r.default.RENDERER_UID_FLAG)!=r.default.RENDERER_UID_FLAG}isInRendererProcess(){return null!=this.m_display&&this.m_display.__$ruid>-1}isRenderEnabled(){return this.drawEnabled&&this.m_visible&&null!=this.m_display&&this.m_display.__$ruid>-1}updateBounds(){if(null!=this.m_transfrom){if(this.m_transStatus=l.default.UPDATE_TRANSFORM,null!=this.m_mesh&&this.m_localBounds!=this.m_mesh.bounds){this.m_localBounds.reset();let t=this.m_mesh.getIVS();this.m_localBounds.addXYZFloat32AndIndicesArr(this.m_mesh.getVS(),t.subarray(this.m_display.ivsIndex,this.m_display.ivsIndex+this.m_display.ivsCount)),this.m_localBounds.update()}this.update()}}updateLocalBoundsVS(t){let e=t.min,s=t.max;null==this.m_lBoundsVS&&(this.m_lBoundsVS=new Float32Array(24));let i=this.m_lBoundsVS;i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=s.x,i[4]=e.y,i[5]=e.z,i[6]=e.x,i[7]=e.y,i[8]=s.z,i[9]=s.x,i[10]=e.y,i[11]=s.z,i[12]=e.x,i[13]=s.y,i[14]=e.z,i[15]=s.x,i[16]=s.y,i[17]=e.z,i[18]=e.x,i[19]=s.y,i[20]=s.z,i[21]=s.x,i[22]=s.y,i[23]=s.z}updateGlobalBounds(){let t=m,e=this.m_localBounds;if(this.m_transStatus>l.default.UPDATE_POSITION||this.m_localBuondsVer!=e.version){let s=this.m_transfrom.updateStatus;if(this.m_transfrom.update(),this.m_localBuondsVer!=e.version||s!=this.m_transfrom.updateStatus){this.m_localBuondsVer=e.version,this.updateLocalBoundsVS(e);let s=this.m_lBoundsVS,i=t.s_boundsOutVS;this.m_transfrom.getMatrix().transformVectors(s,24,i),this.m_globalBounds.reset(),this.m_globalBounds.addXYZFloat32Arr(i),this.m_globalBounds.update()}}else{t.s_prePos.setXYZ(0,0,0),t.s_pos.setXYZ(0,0,0);let e=this.m_transfrom.getMatrix(!1);e.transformVector3Self(t.s_prePos),this.m_transfrom.update(),e=this.m_transfrom.getMatrix(!1),e.transformVector3Self(t.s_pos),t.s_pos.subtractBy(t.s_prePos);let s=this.m_globalBounds;s.min.addBy(t.s_pos),s.max.addBy(t.s_pos),s.center.addBy(t.s_pos),++this.m_globalBounds.version}}update(){this.m_transfrom.updatedStatus>this.m_transStatus&&(this.m_transStatus=this.m_transfrom.updatedStatus),this.m_transStatus!=l.default.UPDATE_NONE&&(null!=this.m_mesh&&null!=this.m_globalBounds?this.updateGlobalBounds():this.m_transfrom.update(),this.m_transStatus=l.default.UPDATE_NONE,this.m_transfrom.updatedStatus=this.m_transStatus)}destroy(){null!=this.m_eventDispatcher&&(this.m_eventDispatcher.destroy(),this.m_eventDispatcher=null),null!=this.m_transfrom&&this.isFree()&&(null!=this.m_display&&(this.m_mesh.__$detachVBuf(this.m_display.vbuf),_.default.Restore(this.m_display),this.m_display=null),l.default.Restore(this.m_transfrom),this.m_transfrom=null,null!=this.m_mesh&&(this.m_mesh.__$detachThis(),this.m_mesh=null),this.__$setParent(null),this.m_visible=!0,this.m_drawEnabled=!0,this.m_renderProxy=null,this.__$rseFlag=r.default.DEFAULT),this.m_globalBounds=null,this.m_localBounds=null,this.m_pipeLine=null}toString(){return"DisplayEntity(name="+this.name+",uid = "+this.m_uid+", rseFlag = "+this.__$rseFlag+")"}}m.s_uid=0,m.s_boundsOutVS=new Float32Array(24),m.s_pos=new a.default,m.s_prePos=new a.default,e.default=m},"42a2":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.m_total=0,this.m_total=t,this.m_taskList=new Array(t),this.m_taskList[0]=null,this.m_freeList=new Array(t);for(let e=1,s=t;e<s;++e)this.m_freeList[e]=e}getTaskByUid(t){return t<this.m_total&&t>0?this.m_taskList[t]:null}attachTask(t){if(t.getUid()<1&&this.m_freeList.length>0){let e=this.m_freeList.pop();return this.m_taskList[e]=t,e}return-1}detachTask(t){t.getUid()>0&&null!=this.m_taskList[t.getUid()]&&(this.m_taskList[t.getUid()]=null,this.m_freeList.push(t.getUid()))}}e.ThreadTaskPool=i},"442e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("265e"));class n extends r.default{createNode(){return new a.default}}e.default=n},"45db":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8def")),a=i(s("fa60"));class n{constructor(){this.m_vtx=null,this.m_vtxUid=-1,this.m_gpuBufs=[],this.m_gpuBufsTotal=0,this.m_type=0,this.m_attribsTotal=0,this.m_wholeStride=0,this.m_typeList=null,this.m_offsetList=null,this.m_sizeList=null,this.m_vroList=[],this.m_vroListLen=0}updateToGpu(t){let e=this.m_gpuBufs.length;if(e>0){let s=this.m_vtx;if(this.version!=s.vertexVer){let i,r=s.getBufDataUsage(),a=this.m_sizeList;for(let n=0;n<e;++n)i=s.getF32DataAt(n),a[n]>=i.length?(t.bindArrBuf(this.m_gpuBufs[n]),t.arrBufSubData(i,0)):(t.bindArrBuf(this.m_gpuBufs[n]),t.arrBufData(i,r),a[n]=i.length);this.version=s.vertexVer}}}uploadCombined(t,e){let s=this.m_vtx,i=s.getF32DataAt(0);if(this.m_gpuBufs.push(t.createBuf()),t.bindArrBuf(this.m_gpuBufs[0]),t.arrBufData(i,s.getBufDataUsage()),this.m_gpuBufsTotal=1,this.m_sizeList=[i.length],null==this.m_typeList){this.m_wholeStride=0,this.m_typeList=new Array(this.m_attribsTotal),this.m_offsetList=new Array(this.m_attribsTotal);let t=s.getBufTypeList(),i=s.getBufSizeList();if(null!=t)for(let e=0;e<this.m_attribsTotal;++e)this.m_offsetList[e]=this.m_wholeStride,this.m_wholeStride+=4*i[e],this.m_typeList[e]=t[e];else for(let s=0;s<this.m_attribsTotal;++s)this.m_offsetList[s]=this.m_wholeStride,this.m_wholeStride+=4*e.getLocationSizeByIndex(s),this.m_typeList[s]=e.getLocationTypeByIndex(s)}}uploadSeparated(t,e){let s=this.m_vtx,i=0,r=null,a=s.getBufDataUsage();if(this.m_gpuBufsTotal=this.m_vtx.getBuffersTotal(),this.m_sizeList=new Array(this.m_attribsTotal),null==s.bufData)for(;i<this.m_attribsTotal;++i)r=t.createBuf(),this.m_gpuBufs.push(r),t.bindArrBuf(r),t.arrBufData(s.getF32DataAt(i),a),this.m_sizeList[i]=s.getF32DataAt(i).length;else{let e=null,n=0,h=0,l=0,o=0;for(;i<this.m_attribsTotal;++i){for(r=t.createBuf(),this.m_gpuBufs.push(r),t.bindArrBuf(r),t.arrBufDataMem(s.bufData.getAttributeDataTotalBytesAt(i),a),l=0,o=0,h=s.bufData.getAttributeDataTotalAt(i),n=0;n<h;++n)e=s.bufData.getAttributeDataAt(i,n),o+=e.length,t.arrBufSubData(e,l),l+=e.byteLength;this.m_sizeList[i]=o}}if(null==this.m_typeList){this.m_typeList=new Array(this.m_attribsTotal),this.m_offsetList=new Array(this.m_attribsTotal);let t=s.getBufTypeList(),i=s.getBufSizeList();if(null!=t)for(let e=0;e<this.m_attribsTotal;++e)this.m_offsetList[e]=this.m_wholeStride,this.m_wholeStride+=4*i[e],this.m_typeList[e]=t[e];else for(let s=0;s<this.m_attribsTotal;++s)this.m_offsetList[s]=this.m_wholeStride,this.m_wholeStride+=4*e.getLocationSizeByIndex(s),this.m_typeList[s]=e.getLocationTypeByIndex(s);this.m_wholeStride=0}}initialize(t,e,s){if(this.m_gpuBufs.length<1&&null!=s){this.version=s.vertexVer,this.m_vtx=s,this.m_vtxUid=s.getUid(),this.m_type=s.getType();let i=s.getBufTypeList();this.m_attribsTotal=null!=i?i.length:e.getLocationsTotal(),e.getLocationsTotal(),s.getAttribsTotal(),this.m_type<1?this.uploadCombined(t,e):this.uploadSeparated(t,e)}}getVROMid(t,e,s,i){let r=(131+t.getRCUid())*this.m_vtxUid;return s&&(r=131*r+1),r=131*r+e.getMid(),r=131*r+i,r}createVRO(t,e,s,i,n){let h=e.getLocationsTotal();if(this.m_attribsTotal*h>0&&h<=this.m_attribsTotal){let l=this.getVROMid(t,e,s,n),o=0,_=a.default.GetByMid(l);if(null!=_)return _;if(s){let s=a.default.Create(t,l,this.m_vtx.getUid());if(s.indicesRes=i,s.vao=t.createVertexArray(),t.bindVertexArray(s.vao),this.m_type<1)for(t.bindArrBuf(this.m_gpuBufs[0]),o=0;o<h;++o)e.vertexAttribPointerTypeFloat(this.m_typeList[o],this.m_wholeStride,this.m_offsetList[o]);else for(o=0;o<h;++o)t.bindArrBuf(this.m_gpuBufs[o]),e.vertexAttribPointerTypeFloat(this.m_typeList[o],0,0);_=s,s.ibuf=i.getGpuBuf(),t.bindVertexArray(null)}else{let s=r.default.Create(t,l,this.m_vtx.getUid());for(s.indicesRes=i,s.shdp=e,s.attribTypes=[],s.wholeOffsetList=[],s.wholeStride=this.m_wholeStride,this.m_type<1?s.vbuf=this.m_gpuBufs[0]:s.vbufs=this.m_gpuBufs,o=0;o<h;++o)e.testVertexAttribPointerType(this.m_typeList[o])&&(s.attribTypes.push(this.m_typeList[o]),s.wholeOffsetList.push(0));s.attribTypesLen=s.attribTypes.length,s.ibuf=i.getGpuBuf(),_=s}return this.m_vroList.push(_),++this.m_vroListLen,_}return null}destroy(t){if(this.m_gpuBufs.length>0){this.m_type=-1;let e=0,s=null;for(;e<this.m_vroListLen;++e)s=this.m_vroList.pop(),s.restoreThis(),this.m_vroList[e]=null;for(this.m_vroListLen=0,e=0;e<this.m_attribsTotal;++e)t.deleteBuf(this.m_gpuBufs[e]),this.m_gpuBufs[e]=null;this.m_attribsTotal=0,this.m_gpuBufs=[]}}}e.ROVertexRes=n},4835:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("faa5")),n=i(s("b3bd")),h=i(s("0fc4"));class l extends a.default{constructor(){super(),this.m_uniqueName="",this.m_hasTex=!1}initialize(t){this.m_uniqueName="Text2DShd",this.m_hasTex=t,t&&(this.m_uniqueName+="_tex")}getFragShaderCode(){let t="#version 300 es\nprecision mediump float;\nin vec4 v_color;\n";return this.m_hasTex&&(t+="uniform sampler2D u_sampler0;\nin vec2 v_texUV;\nlayout(location = 0) out vec4 FragColor;\n"),t+="void main()\n{\n",this.m_hasTex?t+="float pa = pow(texture(u_sampler0, v_texUV).a,0.8);\nFragColor = vec4(v_color.xyz, min(v_color.w * pa,1.0));\n":t+="FragColor = v_color;\n",t+="}\n",t}getVertShaderCode(){let t="#version 300 es\nprecision mediump float;\nlayout(location = 0) in vec2 a_vs;\nuniform vec4 u_stageParam;\nuniform vec4 u_params[3];\nout vec4 v_color;\n";return this.m_hasTex&&(t+="layout(location = 1) in vec2 a_uvs;\nout vec2 v_texUV;\n"),t+="void main()\n{\nvec4 pv4 = vec4(a_vs.xy,0.0,1.0);\npv4.xy *= u_params[1].xy;\nfloat cosv = cos(u_params[1].w);\nfloat sinv = sin(u_params[1].w);\npv4.xy = vec2(pv4.x * cosv - pv4.y * sinv, pv4.x * sinv + pv4.y * cosv);\npv4.xy += u_params[0].xy;\npv4.xy *= u_stageParam.xy;\npv4.xy += -1.0;\ngl_Position = pv4;\n",this.m_hasTex&&(t+="v_texUV = a_uvs.xy;\n"),t+="v_color = u_params[2];\n}\n",t}getUniqueShaderName(){return this.m_uniqueName}toString(){return"[Text2DShaderBuffer()]"}static GetInstance(){return null!=l.s_instance||(l.s_instance=new l),l.s_instance}}l.s_instance=null;class o extends h.default{constructor(){super(),this.m_rotation=0,this.m_r=0,this.m_g=0,this.m_b=0,this.m_brightness=1,this.m_paramArray=new Float32Array([0,0,0,0,1,1,0,0,1,1,1,1])}getCodeBuf(){return l.GetInstance()}setXY(t,e){this.m_paramArray[0]=t,this.m_paramArray[1]=e}setX(t){this.m_paramArray[0]=t}setY(t){this.m_paramArray[1]=t}getX(){return this.m_paramArray[0]}getY(){return this.m_paramArray[1]}setScale(t){this.m_paramArray[4]=t,this.m_paramArray[5]=t}setScaleXY(t,e){this.m_paramArray[4]=t,this.m_paramArray[5]=e}setScaleX(t){this.m_paramArray[4]=t}setScaleY(t){this.m_paramArray[5]=t}getScaleX(){return this.m_paramArray[4]}getScaleY(){return this.m_paramArray[5]}setRotation(t){this.m_rotation=t,this.m_paramArray[7]=r.default.MATH_PI_OVER_180*t}getRotation(){return this.m_rotation}setRGB3f(t,e,s){this.m_r=t,this.m_g=e,this.m_b=s,this.m_paramArray[8]=t*this.m_brightness,this.m_paramArray[9]=e*this.m_brightness,this.m_paramArray[10]=s*this.m_brightness}setRGBA4f(t,e,s,i){this.m_r=t,this.m_g=e,this.m_b=s,this.m_paramArray[8]=t*this.m_brightness,this.m_paramArray[9]=e*this.m_brightness,this.m_paramArray[10]=s*this.m_brightness,this.m_paramArray[11]=i}setAlpha(t){this.m_paramArray[11]=t}getAlpha(){return this.m_paramArray[6]}setBrightness(t){this.m_brightness=t,this.m_paramArray[4]=this.m_r*t,this.m_paramArray[5]=this.m_g*t,this.m_paramArray[6]=this.m_b*t}getBrightness(){return this.m_brightness}createSelfUniformData(){let t=new n.default;return t.uniformNameList=["u_params"],t.dataList=[this.m_paramArray],t}}e.default=o},"4a54":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("81ce")),n=i(s("f208")),h=s("c164");class l{constructor(t){this.m_versionDeclare="#version 300 es\n",this.m_preciousCode="precision mediump float;\n",this.m_fragExt=[],this.m_vertExt=[],this.m_defineNames=[],this.m_defineValues=[],this.m_vertLayoutNames=[],this.m_vertLayoutTypes=[],this.m_fragOutputPrecises=[],this.m_fragOutputNames=[],this.m_fragOutputTypes=[],this.m_vertUniformNames=[],this.m_vertUniformTypes=[],this.m_fragUniformNames=[],this.m_fragUniformTypes=[],this.m_varyingNames=[],this.m_varyingTypes=[],this.m_fragFunctionBlocks=[],this.m_vertFunctionBlocks=[],this.m_textureSampleTypes=[],this.m_texturePrecises=[],this.m_textureMacroNames=[],this.m_texturePrecise="",this.m_textureFlags=[],this.m_vertObjMat=!1,this.m_vertViewMat=!1,this.m_vertProjMat=!1,this.m_fragObjMat=!1,this.m_fragViewMat=!1,this.m_fragProjMat=!1,this.m_vertHeadCode="",this.m_vertMainCode="",this.m_fragHeadCode="",this.m_fragMainCode="",this.m_uniqueNSKeyString="",this.m_uniqueNSKeysTotal=10,this.m_use2DMap=!1,this.m_preCompileInfo=null,this.fragHeadCodeUnlock=!0,this.fragMainCodeUnlock=!0,this.vertHeadCodeUnlock=!0,this.vertMainCodeUnlock=!0,this.autoBuildHeadCodeEnabled=!0,this.mathDefineEanbled=!0,this.normalEnabled=!1,this.normalMapEnabled=!1,this.mapLodEnabled=!1,this.derivatives=!1,this.vertMatrixInverseEnabled=!1,this.vtxUVTransfromEnabled=!1,this.fragMatrixInverseEnabled=!1;let e=this;e.uniform=t}getUniqueNSKeyID(){throw Error("can not use this function !!!")}getUniqueNSKeyString(){let t=this.m_uniqueNSKeyString;return this.vtxUVTransfromEnabled&&(t+="VtxUVT"),this.normalEnabled&&(t+="Nor"),this.uniform.getUniqueNSKeyString()+t}reset(){this.m_vertObjMat=!0,this.m_vertViewMat=!0,this.m_vertProjMat=!0,this.m_fragObjMat=!1,this.m_fragViewMat=!1,this.m_fragProjMat=!1,this.fragHeadCodeUnlock=!0,this.fragMainCodeUnlock=!0,this.vertHeadCodeUnlock=!0,this.vertMainCodeUnlock=!0,this.autoBuildHeadCodeEnabled=!0,this.m_use2DMap=!1,this.m_vertHeadCode="",this.m_vertMainCode="",this.m_fragHeadCode="",this.m_fragMainCode="",this.m_uniqueNSKeyString="",this.m_vertExt=[],this.m_fragExt=[],this.m_vertLayoutNames=[],this.m_vertLayoutTypes=[],this.m_fragOutputPrecises=[],this.m_fragOutputNames=[],this.m_fragOutputTypes=[],this.m_varyingNames=[],this.m_varyingTypes=[],this.m_vertUniformNames=[],this.m_vertUniformTypes=[],this.m_fragUniformNames=[],this.m_fragUniformTypes=[],this.m_fragFunctionBlocks=[],this.m_vertFunctionBlocks=[],this.m_defineNames=[],this.m_defineValues=[],this.m_textureSampleTypes=[],this.m_texturePrecises=[],this.m_textureMacroNames=[],this.m_textureFlags=[],this.m_texturePrecise="",this.mathDefineEanbled=!0,this.normalEnabled=!1,this.normalMapEnabled=!1,this.mapLodEnabled=!1,this.vertMatrixInverseEnabled=!1,this.fragMatrixInverseEnabled=!1,this.vtxUVTransfromEnabled=!1,this.m_preCompileInfo=null,this.uniform.reset()}addUniqueNSKeyString(t){this.m_uniqueNSKeyString+=t}getPreCompileInfo(){let t=this.m_preCompileInfo;return this.m_preCompileInfo=null,t}useHighPrecious(){this.m_preciousCode="precision highp float;"}useMediumPrecious(){this.m_preciousCode="precision mediump float;"}useLowPrecious(){this.m_preciousCode="precision lowp float;"}addDefine(t,e="1"){return!this.m_defineNames.includes(t)&&(this.m_defineNames.push(t),this.m_defineValues.push(e),!0)}addVertLayout(t,e){this.m_vertLayoutNames.includes(e)||(this.m_vertLayoutNames.push(e),this.m_vertLayoutTypes.push(t))}addFragOutputHighp(t,e){this.m_fragOutputNames.includes(e)||(this.m_fragOutputPrecises.push("highp"),this.m_fragOutputNames.push(e),this.m_fragOutputTypes.push(t))}addFragOutput(t,e){this.m_fragOutputNames.includes(e)||(this.m_fragOutputPrecises.push(""),this.m_fragOutputNames.push(e),this.m_fragOutputTypes.push(t))}addVarying(t,e){this.m_varyingNames.includes(e)||(this.m_varyingNames.push(e),this.m_varyingTypes.push(t))}addVertUniform(t,e,s=0){this.m_vertUniformNames.includes(e)||(s>0?this.m_vertUniformNames.push(e+"["+s+"]"):this.m_vertUniformNames.push(e),this.m_vertUniformTypes.push(t))}addVertUniformParam(t){this.addVertUniform(t.type,t.name,t.arrayLength)}addFragUniform(t,e,s=0){this.m_fragUniformNames.includes(e)||(s>0?this.m_fragUniformNames.push(e+"["+s+"]"):this.m_fragUniformNames.push(e),this.m_fragUniformTypes.push(t))}addFragUniformParam(t){this.addFragUniform(t.type,t.name,t.arrayLength)}addVertAndFragUniform(t,e,s=0){this.addVertUniform(t,e,s),this.addFragUniform(t,e,s)}addFragFunction(t){this.m_fragFunctionBlocks.push(t)}addVertFunction(t){this.m_vertFunctionBlocks.push(t)}useTexturePreciseHighp(){this.m_texturePrecise="highp"}addTextureSample2D(t="",e=!0,s=!0,i=!1){if(""==t||!this.m_textureMacroNames.includes(t)){this.m_textureSampleTypes.push("sampler2D"),this.m_textureMacroNames.push(t),this.m_texturePrecises.push(this.m_texturePrecise);let r=0;s&&(r|=2),i&&(r|=4),this.m_textureFlags.push(r),this.m_texturePrecise="",e&&(this.m_use2DMap=!0)}}addTextureSampleCube(t="",e=!0,s=!1){if(""==t||!this.m_textureMacroNames.includes(t)){this.m_textureSampleTypes.push("samplerCube"),this.m_textureMacroNames.push(t),this.m_texturePrecises.push(this.m_texturePrecise);let i=0;e&&(i|=2),s&&(i|=4),this.m_textureFlags.push(i),this.m_texturePrecise=""}}addTextureSample3D(t="",e=!0,s=!1){if(""==t||!this.m_textureMacroNames.includes(t)){this.m_textureSampleTypes.push("sampler3D"),this.m_textureMacroNames.push(t),this.m_texturePrecises.push(this.m_texturePrecise);let i=0;e&&(i|=2),s&&(i|=4),this.m_textureFlags.push(i),this.m_texturePrecise=""}}isHaveTexture(){return this.m_textureSampleTypes.length>0}isHaveTexture2D(){return this.m_use2DMap}useVertSpaceMats(t=!0,e=!0,s=!0){this.m_vertObjMat=t,this.m_vertViewMat=e,this.m_vertProjMat=s}useFragSpaceMats(t=!0,e=!0,s=!0){this.m_fragObjMat=t,this.m_fragViewMat=e,this.m_fragProjMat=s}addVertExtend(t){this.m_vertExt.push(t)}addFragExtend(t){this.m_fragExt.push(t)}addVertHeadCode(t){""!=t&&(this.m_vertHeadCode+="\n"+t)}addVertMainCode(t){""!=t&&(this.m_vertMainCode+="\n"+t)}addFragHeadCode(t){""!=t&&(this.m_fragHeadCode+="\n"+t)}addFragMainCode(t){""!=t&&(this.m_fragMainCode+="\n"+t)}addShaderObject(t){this.fragHeadCodeUnlock&&this.addFragHeadCode(t.frag_head),this.fragMainCodeUnlock&&this.addFragMainCode(t.frag_body),this.vertHeadCodeUnlock&&this.addVertHeadCode(t.vert_head),this.vertMainCodeUnlock&&this.addVertMainCode(t.vert_body)}addShaderObjectHead(t){this.fragHeadCodeUnlock&&this.addFragHeadCode(t.frag_head),this.vertHeadCodeUnlock&&this.addVertMainCode(t.vert_head)}autoBuildHeadCode(){this.addVertLayout("vec3","a_vs"),(this.m_use2DMap||this.m_vertLayoutNames.includes("a_uvs"))&&(this.addVertLayout("vec2","a_uvs"),this.addVarying("vec2","v_uv")),(this.normalEnabled||this.normalMapEnabled||this.m_vertLayoutNames.includes("a_nvs"))&&(this.addVertLayout("vec3","a_nvs"),this.addVarying("vec3","v_worldNormal"),this.addVarying("vec3","v_worldPosition"),this.addDefine("VOX_USE_NORMAL"),this.vertMatrixInverseEnabled=!0);let t=["a_vs","a_uvs","a_nvs"],e=[],s=[];for(;t.length>0;){let i=this.m_vertLayoutNames.indexOf(t[0]);i>=0&&(e.push(this.m_vertLayoutNames[i]),s.push(this.m_vertLayoutTypes[i]),this.m_vertLayoutNames.splice(i,1),this.m_vertLayoutTypes.splice(i,1)),t.shift()}this.m_vertLayoutNames=e.concat(this.m_vertLayoutNames),this.m_vertLayoutTypes=s.concat(this.m_vertLayoutTypes),this.vtxUVTransfromEnabled&&this.addDefine("VOX_VTX_TRANSFORM_PARAM_INDEX","0")}buildFragCode(){this.autoBuildHeadCodeEnabled&&this.autoBuildHeadCode(),this.m_fragOutputNames.length<1&&this.addFragOutput("vec4","FragColor0");let t=0,e=0,s="";for((r.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED||r.default.IsMobileWeb())&&this.useHighPrecious(),r.default.IsWebGL2()&&(s+=this.m_versionDeclare),this.m_preCompileInfo=new n.default,this.m_preCompileInfo.info="\n//##COMPILE_INFO_BEGIN",this.m_preCompileInfo.info+="\n//##COMPILE_INFO_END",t=0,e=this.m_fragExt.length;t<e;t++)s+="\n"+this.m_fragExt[t];for(r.default.IsWebGL1()&&(this.m_fragOutputNames.length>1&&(s+="\n#extension GL_EXT_draw_buffers: require"),(this.normalMapEnabled||this.derivatives)&&(s+="\n#extension GL_OES_standard_derivatives : enable"),this.mapLodEnabled&&(s+="\n#extension GL_EXT_shader_texture_lod : enable")),r.default.IsMobileWeb()?s+="\nprecision highp float;":s+="\n"+this.m_preciousCode,r.default.IsWebGL2()?(s+="\n#define VOX_GLSL_ES3 1",s+="\n#define VOX_IN in",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureLod",s+="\n#define VOX_Texture2DLod textureLod"),s+="\n#define VOX_Texture2D texture",s+="\n#define VOX_TextureCube texture"):(s+="\n#define VOX_GLSL_ES2 1",s+="\n#define VOX_IN varying",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureCubeLodEXT",s+="\n#define VOX_Texture2DLod texture2DLodEXT"),s+="\n#define VOX_TextureCube textureCube",s+="\n#define VOX_Texture2D texture2D"),this.mathDefineEanbled&&(s+=h.MathShaderCode.BasePredefined),e=this.m_defineNames.length,t=0;t<e;t++)""!=this.m_defineValues[t]?s+="\n#define "+this.m_defineNames[t]+" "+this.m_defineValues[t]:s+="\n#define "+this.m_defineNames[t]+" 1";for(t=0,e=this.m_textureMacroNames.length;t<e;t++)""!=this.m_textureMacroNames[t]&&0!=(2&this.m_textureFlags[t])&&(s+="\n#define "+this.m_textureMacroNames[t]+" u_sampler"+t);for(this.m_use2DMap&&(s+="\n#define VOX_USE_2D_MAP 1"),t=0,e=this.m_textureSampleTypes.length;t<e;t++)0!=(2&this.m_textureFlags[t])&&(""==this.m_texturePrecises[t]?s+="\nuniform "+this.m_textureSampleTypes[t]+" u_sampler"+t+";":s+="\nuniform "+this.m_texturePrecises[t]+" "+this.m_textureSampleTypes[t]+" u_sampler"+t+";");for(t=0,e=this.m_fragUniformTypes.length;t<e;t++)s+="\nuniform "+this.m_fragUniformTypes[t]+" "+this.m_fragUniformNames[t]+";";if(this.m_fragObjMat&&(s+="\nuniform mat4 u_objMat;"),this.m_fragViewMat&&(s+="\nuniform mat4 u_viewMat;"),this.m_fragProjMat&&(s+="\nuniform mat4 u_projMat;"),e=this.m_varyingNames.length,r.default.IsWebGL2())for(t=0;t<e;t++)s+="\nin "+this.m_varyingTypes[t]+" "+this.m_varyingNames[t]+";";else for(t=0;t<e;t++)s+="\nvarying "+this.m_varyingTypes[t]+" "+this.m_varyingNames[t]+";";for(s+=h.ShaderCode.BasePredefined,this.fragMatrixInverseEnabled&&r.default.IsWebGL1()&&(this.addVertFunction(a.default.__glslInverseMat3),this.addVertFunction(a.default.__glslInverseMat4)),s+=this.m_fragHeadCode,t=0,e=this.m_fragFunctionBlocks.length;t<e;t++)s+="\n"+this.m_fragFunctionBlocks[t];if(t=0,e=this.m_fragOutputNames.length,r.default.IsWebGL2())for(;t<e;t++)""!=this.m_fragOutputPrecises[t]?s+="\nlayout(location = "+t+") out "+this.m_fragOutputPrecises[t]+" "+this.m_fragOutputTypes[t]+" "+this.m_fragOutputNames[t]+";":s+="\nlayout(location = "+t+") out "+this.m_fragOutputTypes[t]+" "+this.m_fragOutputNames[t]+";";else 1==e&&(s+="\n#define "+this.m_fragOutputNames[t]+" gl_FragColor");let i=!1,l=this.m_fragMainCode.indexOf("{");if(l>0){let t=this.m_fragMainCode.slice(0,l);i=t.indexOf(" main")>0,i||(i=this.m_fragMainCode.indexOf(" main")>0)}if(i?s+=this.m_fragMainCode:(s+="\nvoid main() {\n",s+=this.m_fragMainCode,s+="\n}\n"),e=this.m_fragOutputNames.length,r.default.IsWebGL1()&&e>1)for(t=0;t<e;t++){let e=new RegExp(this.m_fragOutputNames[t],"g");s=s.replace(e,"gl_FragData["+t+"]")}return s}buildVertCode(){let t=0,e=0,s="";for(r.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&this.useHighPrecious(),r.default.IsWebGL2()&&(s+=this.m_versionDeclare),t=0,e=this.m_vertExt.length;t<e;t++)s+="\n"+this.m_vertExt[t];for(r.default.IsMobileWeb()?s+="\nprecision highp float;":s+="\n"+this.m_preciousCode,r.default.IsWebGL2()?(s+="\n#define VOX_GLSL_ES3 1",s+="\n#define VOX_IN in",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureLod",s+="\n#define VOX_Texture2DLod textureLod"),s+="\n#define VOX_Texture2D texture",s+="\n#define VOX_TextureCube texture"):(s+="\n#define VOX_GLSL_ES2 1",s+="\n#define VOX_IN varying",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureCubeLodEXT",s+="\n#define VOX_Texture2DLod texture2DLodEXT"),s+="\n#define VOX_TextureCube textureCube",s+="\n#define VOX_Texture2D texture2D"),r.default.IsWebGL2()?s+="\n#define VOX_OUT out":s+="\n#define VOX_OUT varying",this.mathDefineEanbled&&(s+=h.MathShaderCode.BasePredefined),e=this.m_defineNames.length,t=0;t<e;t++)""!=this.m_defineValues[t]?s+="\n#define "+this.m_defineNames[t]+" "+this.m_defineValues[t]:s+="\n#define "+this.m_defineNames[t];for(t=0,e=this.m_textureMacroNames.length;t<e;t++)""!=this.m_textureMacroNames[t]&&0!=(4&this.m_textureFlags[t])&&(s+="\n#define "+this.m_textureMacroNames[t]+" u_sampler"+t);for(this.m_use2DMap&&(s+="\n#define VOX_USE_2D_MAP 1"),t=0,e=this.m_textureSampleTypes.length;t<e;t++)0!=(4&this.m_textureFlags[t])&&(""==this.m_texturePrecises[t]?s+="\nuniform "+this.m_textureSampleTypes[t]+" u_sampler"+t+";":s+="\nuniform "+this.m_texturePrecises[t]+" "+this.m_textureSampleTypes[t]+" u_sampler"+t+";");if(e=this.m_vertLayoutNames.length,r.default.IsWebGL2())for(t=0;t<e;t++)s+="\nlayout(location = "+t+") in "+this.m_vertLayoutTypes[t]+" "+this.m_vertLayoutNames[t]+";";else for(t=0;t<e;t++)s+="\nattribute "+this.m_vertLayoutTypes[t]+" "+this.m_vertLayoutNames[t]+";";for(e=this.m_vertUniformTypes.length,t=0;t<e;t++)s+="\nuniform "+this.m_vertUniformTypes[t]+" "+this.m_vertUniformNames[t]+";";if(this.m_vertObjMat&&(s+="\nuniform mat4 u_objMat;"),this.m_vertViewMat&&(s+="\nuniform mat4 u_viewMat;"),this.m_vertProjMat&&(s+="\nuniform mat4 u_projMat;"),e=this.m_varyingNames.length,r.default.IsWebGL2())for(t=0;t<e;t++)s+="\nout "+this.m_varyingTypes[t]+" "+this.m_varyingNames[t]+";";else for(t=0;t<e;t++)s+="\nvarying "+this.m_varyingTypes[t]+" "+this.m_varyingNames[t]+";";for(s+=h.ShaderCode.BasePredefined,s+=h.ShaderCode.VertPredefined,this.vertMatrixInverseEnabled&&r.default.IsWebGL1()&&(this.addVertFunction(a.default.__glslInverseMat3),this.addVertFunction(a.default.__glslInverseMat4)),s+=this.m_vertHeadCode,t=0,e=this.m_vertFunctionBlocks.length;t<e;t++)s+="\n"+this.m_vertFunctionBlocks[t];let i=!1,n=this.m_vertMainCode.indexOf("{");if(n>0){let t=this.m_vertMainCode.slice(0,n);i=t.indexOf(" main")>0,i||(i=this.m_vertMainCode.indexOf(" main")>0)}return i?s+=this.m_vertMainCode:(s+="\nvoid main() {\n",s+=this.m_vertMainCode,s+="\n}\n"),s}}e.default=l},"4aad":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("cbd5"),a=s("b627"),n=s("9468"),h=s("7b85"),l=i(s("b9b5")),o=s("7126"),_=s("08aa"),m=s("0817"),u=s("8eb0"),d=i(s("3bda"));class c{constructor(){this.m_cospace=new r.CoSpace,this.m_vfParam=new _.VerifierParam,this.m_rscene=null,this.m_waitSceneNodes=[],this.m_sceneNodes=[],this.m_dropController=new o.DropFileController}initialize(t){if(null==this.m_rscene){this.m_rscene=t;let e=new l.default;if(e.initialize(300),this.m_rscene.addEntity(e),this.m_vfParam.initialize(),(this.m_vfParam.hostUrl.indexOf(".artvily.")>0||""!=this.m_vfParam.demoType)&&this.m_vfParam.threadsTotal>0){let t=[new m.TaskCodeModuleParam("static/renderingVerifier/modules/ct1.js",u.ModuleNS.ctmParser),new m.TaskCodeModuleParam("static/renderingVerifier/modules/ob1.js",u.ModuleNS.objParser)];this.m_cospace.geometry.setTaskModuleUrls(t),this.m_cospace.initialize(this.m_vfParam.threadsTotal,"static/renderingVerifier/modules/th1.js",!0)}else{let t=[new m.TaskCodeModuleParam("static/cospace/modules/ctm/ModuleCTMGeomParser.umd.js",u.ModuleNS.ctmParser),new m.TaskCodeModuleParam("static/cospace/modules/obj/ModuleOBJGeomParser.umd.js",u.ModuleNS.objParser)];this.m_cospace.geometry.setTaskModuleUrls(t),this.m_cospace.initialize(3,"static/cospace/core/code/ThreadCore.umd.js",!0)}this.m_dropController.initialize(this.m_rscene.getCanvas(),this),d.default.ShowLogOnce("</br>(Google Chrome)</br>(ctm/obj/fbx)</br>ctm"),this.test()}}test(){}isDropEnabled(){return this.isFinish()}resetScene(){d.default.ShowLogOnce("..."),this.clear()}initFileLoad(t){let e=1;if(t.length>0){let s="",i=[];for(let e=0;e<t.length;e++){0==e&&(s=t[e].name);const r=window.URL.createObjectURL(t[e]);i.push(r)}""!=s?(s.toLocaleLowerCase(),s.indexOf(".ctm")>1?(this.resetScene(),this.addCTM(i)):s.indexOf(".fbx")>1?(this.resetScene(),this.addFBX(i)):s.indexOf(".obj")>1?(this.resetScene(),this.addOBJ(i)):e=31):e=31}else e=31;this.m_dropController.alertShow(e)}initTest(){if(""!=this.m_vfParam.demoType){let t=this.m_vfParam.getUrls();switch(this.m_vfParam.demoType){case"fbx":this.addFBX(t);break;case"ctm":this.addCTM(t);break;default:break}return}if(this.m_vfParam.hostUrl.indexOf(".artvily.")>0)return;let t="static/assets/fbx/test01.fbx";t="static/assets/fbx/box.fbx";let e=this.m_vfParam.hostUrl,s="static/private/ctm/",i=[];for(let r=0;r<=26;++r)i.push(s+"sh202/sh202_"+r+".ctm");i=[s+"errorNormal.ctm"],s=e+"static/private/obj/",i=[s+"base.obj"]}mouseDown(t){let e=this.m_sceneNodes;for(let s=0;s<e.length;++s)e[s].mouseDown(t)}addFBX(t){this.addNewNode(new a.FBXSceneNode,t)}addCTM(t){this.addNewNode(new n.CTMSceneNode,t)}addOBJ(t){this.addNewNode(new h.OBJSceneNode,t)}addNewNode(t,e){d.default.ShowLogOnce("..."),t.initialize(this.m_rscene,this.m_cospace),t.load(e),this.m_waitSceneNodes.push(t),this.m_sceneNodes.push(t)}showInfo(t){d.default.ShowLogOnce(t)}isFinish(){return 0==this.m_waitSceneNodes.length}clear(){if(this.isFinish()){let t=this.m_sceneNodes;for(let e=0;e<t.length;++e){const s=t[e];s.clear()}this.m_sceneNodes=[]}}run(){let t=this.m_waitSceneNodes;for(let e=0;e<t.length;++e){const s=t[e];s.run(),s.isFinish()&&(t.splice(e,1),e--)}}}e.VerifierScene=c},"4cf7":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("7918");class r{constructor(){this.m_imgTexList=[],this.m_bytesTexList=[],this.m_floatTexList=[],this.m_wrapperTexList=[]}addTexture(t){switch(t.getType()){case i.TextureProxyType.Image:this.m_imgTexList.push(t);break;case i.TextureProxyType.Bytes:this.m_bytesTexList.push(t);break;case i.TextureProxyType.Float:this.m_floatTexList.push(t);break;case i.TextureProxyType.Wrapper:this.m_wrapperTexList.push(t);break;default:break}}getTexture(t){switch(t){case i.TextureProxyType.Image:if(this.m_imgTexList.length>0)return this.m_imgTexList.pop();break;case i.TextureProxyType.Bytes:if(this.m_bytesTexList.length>0)return this.m_bytesTexList.pop();break;case i.TextureProxyType.Float:if(this.m_floatTexList.length>0)return this.m_floatTexList.pop();break;case i.TextureProxyType.Wrapper:if(this.m_wrapperTexList.length>0)return this.m_wrapperTexList.pop();break;default:break}return null}}e.TexturePool=r,e.default=r},"4efa":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("839a"),r=s("a9f4");class a{constructor(t){this.m_coderBuilder=null,this.m_uniform=null,this.m_texList=[],this.m_coderBuilder=t,this.m_uniform=t.uniform}getCodeBuilder(){return this.m_coderBuilder}reset(){this.m_texList=[]}getTextures(){return this.m_texList}getTexturesTotal(){return this.m_texList.length}addDiffuseMap(t){null!=t&&(this.m_uniform.addDiffuseMap(),this.m_texList.push(t))}addNormalMap(t){null!=t&&(this.m_uniform.addNormalMap(),this.m_texList.push(t))}addParallaxMap(t,e){null!=t&&(this.m_uniform.addParallaxMap(e),this.m_texList.push(t))}addDisplacementMap(t,e){null!=t&&(this.m_uniform.addDisplacementMap(e),this.m_texList.push(t))}addSpecularMap(t,e=i.SpecularMode.Default){null!=t&&(this.m_uniform.addSpecularMap(e),this.m_texList.push(t))}addShadowMap(t,e=r.ShadowMode.VSM){null!=t&&(this.m_uniform.addShadowMap(e),this.m_texList.push(t))}addSpecularEnvMap(t,e=!0){null!=t&&(this.m_uniform.addSpecularEnvMap(e),this.m_texList.push(t))}addAOMap(t){null!=t&&(this.m_uniform.addAOMap(),this.m_texList.push(t))}addRoughnessMap(t){null!=t&&(this.m_uniform.addRoughnessMap(),this.m_texList.push(t))}addMetalnessMap(t){null!=t&&(this.m_uniform.addMetalnessMap(),this.m_texList.push(t))}addARMMap(t){null!=t&&(this.m_uniform.addARMMap(),this.m_texList.push(t))}add2DMap(t,e="",s=!0,i=!0,r=!1){null!=t&&(this.m_uniform.add2DMap(e,s,i,r),this.m_texList.push(t))}addCubeMap(t,e="",s=!0,i=!1){null!=t&&(this.m_uniform.addCubeMap(e,s,i),this.m_texList.push(t))}add3DMap(t,e="",s=!0,i=!1){null!=t&&(this.m_uniform.add3DMap(e,s,i),this.m_texList.push(t))}}e.ShaderTextureBuilder=a},"4f27":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=s("d53d"),n=i(s("2560")),h=i(s("83d1")),l=i(s("a7ed")),o=i(s("857b")),_=i(s("e87b"));class m extends a.ShaderUniform{use(t){}useByLocation(t,e,s,i){}useByShd(t,e){}updateData(){}destroy(){}}m.EmptyUniform=new m;class u{constructor(){this.m_initFlag=!0,this.m_uniformDict=new Map,this.m_builders=[],this.m_buildersTot=0,this.m_emptyUniform=new a.ShaderUniform}appendUniformBuilder(t){this.m_uniformDict.has(t.getIDNS())||(this.m_builders.push(t),this.m_uniformDict.set(t.getIDNS(),t),this.m_buildersTot=this.m_builders.length)}initialize(){this.m_initFlag&&(this.m_initFlag=!1,this.appendUniformBuilder(new n.default),this.appendUniformBuilder(new l.default),this.appendUniformBuilder(new o.default),this.appendUniformBuilder(new h.default),this.appendUniformBuilder(new _.default))}addSharedUniformBuilder(t){null==t||this.m_uniformDict.has(t.getIDNS())||(this.m_builders.push(t),this.m_uniformDict.set(t.getIDNS(),t),++this.m_buildersTot)}removeSharedUniformBuilder(t){if(null!=t&&this.m_uniformDict.has(t.getIDNS())){for(let e=0;e<this.m_buildersTot;++e)if(t==this.m_builders[e]){this.m_builders.splice(e,1),--this.m_buildersTot;break}this.m_uniformDict.delete(t.getIDNS())}}removeSharedUniformBuilderByName(t){if(this.m_uniformDict.has(t)){let e=this.m_uniformDict.get(t);for(let t=0;t<this.m_buildersTot;++t)if(e==this.m_builders[t]){this.m_builders.splice(t,1),--this.m_buildersTot;break}this.m_uniformDict.delete(t)}}buildShared(t,e,s){let i,r=null,a=null,n=this.m_builders,h=0,l=this.m_buildersTot,o=null;for(;h<l;++h)o=n[h].create(e,s),null!=o&&(null!=a?a.next=o:null==r&&(r=o),a=o);if(null==t)i=r;else if(null!=r){for(let e=0;e<t.length;++e)a.next=t[e],a=a.next;i=r}if(null==i)i=m.EmptyUniform;else{let t=i,e=0;while(null!=t){if(null!=t.uniformNameList&&null==t.locations)for(t.types=[],t.locations=[],t.uniformSize=t.uniformNameList.length,e=0;e<t.uniformSize;++e)t.types.push(s.getUniformTypeByNS(t.uniformNameList[e])),t.locations.push(s.getUniformLocationByNS(t.uniformNameList[e]));t=t.next}}return i}buildLocalFromTransformV(t,e){if(null!=t){let s;return s=new a.ShaderMat4Uniform,s.uniformSize=0,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize+=1,s.uniformNameList.push("u_objMat"),s.types.push(e.getUniformTypeByNS("u_objMat")),s.locations.push(e.getUniformLocationByNS("u_objMat")),s.dataList.push(t),s.dataSizeList.push(1),s}return this.m_emptyUniform}updateLocalFromTransformV(t,e,s){if(null!=e){let i,r=t;return null==r?(r=new a.ShaderMat4Uniform,i=r,i.uniformSize=0,i.uniformNameList=[],i.types=[],i.locations=[],i.dataList=[],i.dataSizeList=[],i.uniformSize+=1,i.uniformNameList.push("u_objMat"),i.types.push(s.getUniformTypeByNS("u_objMat")),i.locations.push(s.getUniformLocationByNS("u_objMat")),i.dataList.push(e),i.dataSizeList.push(1)):(i=r,i.locations=[],i.locations.push(s.getUniformLocationByNS("u_objMat"))),i}return this.m_emptyUniform}buildLocalFromData(t,e){if(null!=t){let s;s=r.default.IsWebGL1()?new a.ShaderUniformV1:new a.ShaderUniformV2,s.uns=t.uns,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize=0;let i=t,n=0;while(null!=i){if(null!=i.uniformNameList&&null==i.locations)for(s.uniformSize+=i.uniformNameList.length,n=0;n<s.uniformSize;++n)s.uniformNameList.push(i.uniformNameList[n]),s.types.push(e.getUniformTypeByNS(i.uniformNameList[n])),s.locations.push(e.getUniformLocationByNS(i.uniformNameList[n])),s.dataList.push(i.dataList[n]),s.dataSizeList.push(e.getUniformLengthByNS(i.uniformNameList[n]));i=i.next}return s}return m.EmptyUniform}}e.default=u},"519e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("cb29")),n=i(s("e7d2")),h=i(s("fecb")),l=i(s("35fa"));class o extends a.default{constructor(t=r.default.VTX_STATIC_DRAW){super(t),this.m_initIVS=null,this.m_boundsChanged=!0,this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,this.m_tvs=null,this.m_btvs=null,this.m_boundsVersion=-2,this.vsStride=3,this.uvsStride=2,this.nvsStride=3,this.cvsStride=3}setVS(t){this.m_vs=t,this.m_boundsChanged=!0}getVS(){return this.m_vs}setUVS(t){this.m_uvs=t}getUVS(){return this.m_uvs}setNVS(t){this.m_nvs=t}getNVS(){return this.m_nvs}setTVS(t){this.m_tvs=t}getTVS(){return this.m_tvs}setBTVS(t){this.m_btvs=t}setCVS(t){this.m_cvs=t}getBTVS(){return this.m_btvs}setIVS(t){this.m_initIVS=t,this.m_ivs=t,this.m_boundsChanged=!0}initializeFromGeometry(t){this.m_vs=t.getVS(),this.m_uvs=t.getUVS(),this.m_nvs=t.getNVS(),this.m_tvs=t.getTVS(),this.m_btvs=t.getBTVS(),this.m_cvs=t.getCVS(),this.m_ivs=t.getIVS(),this.m_initIVS=this.m_ivs,this.m_boundsChanged=!0,this.initialize()}initialize(){null!=this.m_vs&&(null==this.bounds?(this.bounds=new h.default,this.bounds.addXYZFloat32Arr(this.m_vs),this.bounds.update(),this.m_boundsVersion=this.bounds.version):(this.m_boundsChanged||this.m_boundsVersion==this.bounds.version)&&(this.bounds.reset(),this.bounds.addXYZFloat32Arr(this.m_vs),this.bounds.update(),this.m_boundsVersion=this.bounds.version),this.m_boundsChanged=!1,this.m_ivs=this.m_initIVS,n.default.Reset(),n.default.AddFloat32Data(this.m_vs,this.vsStride),this.isVBufEnabledAt(r.default.VBUF_UVS_INDEX)&&n.default.AddFloat32Data(this.m_uvs,this.uvsStride),this.isVBufEnabledAt(r.default.VBUF_NVS_INDEX)&&(null==this.m_nvs&&(this.vtCount=this.m_ivs.length,this.trisNumber=this.vtCount/3,this.m_nvs=new Float32Array(this.m_vs.length),l.default.ClacTrisNormal(this.m_vs,this.m_vs.length,this.trisNumber,this.m_ivs,this.m_nvs)),n.default.AddFloat32Data(this.m_nvs,this.nvsStride)),this.isVBufEnabledAt(r.default.VBUF_CVS_INDEX)&&n.default.AddFloat32Data(this.m_cvs,this.cvsStride),this.isVBufEnabledAt(r.default.VBUF_TVS_INDEX)&&(n.default.AddFloat32Data(this.m_tvs,3),n.default.AddFloat32Data(this.m_btvs,3)),n.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.vtxTotal=this.m_vs.length/3,this.updateWireframeIvs(),this.vtCount=this.m_ivs.length,null!=this.m_vbuf?n.default.UpdateBufData(this.m_vbuf):(this.m_vbuf=n.default.CreateBySaveData(this.getBufDataUsage(),this.getBufSortFormat()),this.vbWholeDataEnabled?this.m_vbuf=n.default.CreateBySaveData(this.getBufDataUsage(),this.getBufSortFormat()):this.m_vbuf=n.default.CreateBySaveDataSeparate(this.getBufDataUsage())),this.m_vbuf.setUintIVSData(this.m_ivs),this.trisNumber=this.vtCount/3,this.buildEnd())}testRay(t,e,s,i){return-1}toString(){return"[DataMesh()]"}__$destroy(){this.isResFree()&&(this.bounds=null,this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,this.m_tvs=null,this.m_btvs=null,this.m_initIVS=null,super.__$destroy())}}e.default=o},5216:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["ENV_LIGHT_PARAM"]=0]="ENV_LIGHT_PARAM",t[t["ENV_AMBIENT_LIGHT"]=1]="ENV_AMBIENT_LIGHT",t[t["FOG"]=2]="FOG",t[t["FOG_EXP2"]=3]="FOG_EXP2",t[t["VSM_SHADOW"]=4]="VSM_SHADOW",t[t["GLOBAL_LIGHT"]=5]="GLOBAL_LIGHT"}(i||(i={})),e.MaterialPipeType=i},"52e0":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=i(s("ffc0")),n=i(s("1f61")),h=i(s("5deb")),l=i(s("0851"));class o extends l.default{constructor(t,e){super(t,e,!1),this.m_imgDataList=null,this.m_texTarget=h.default.TEXTURE_CUBE,this.mipmapEnabled=!0,this.m_type=r.TextureProxyType.BytesCube}toAlphaFormat(){this.srcFormat=a.default.ALPHA,this.internalFormat=a.default.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=a.default.RED,this.internalFormat=a.default.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=a.default.RGB,this.internalFormat=a.default.RGB,this.unpackAlignment=1}toRGBAFormat(){this.srcFormat=a.default.RGBA,this.internalFormat=a.default.RGBA,this.unpackAlignment=4}setDataFromBytesToFaceAt(t,e,s,i,r=0){if(null==this.m_imgDataList&&(this.m_imgDataList=[null,null,null,null,null,null]),s>0&&i>0){0==t&&r<1&&(this.m_texWidth=s,this.m_texHeight=i,this.m_miplevel=r),null==this.m_imgDataList[t]&&(this.m_imgDataList[t]=new Array(16));let a=this.m_imgDataList[t];a[r]={width:s,height:i,imgData:e,miplevel:r},this.m_haveRData=null!=a[r].imgData}}uploadData(t){let e,s,i=t.getRC(),r=null,h=this.getWidth(),l=this.getHeight();for(let o=0;o<6;++o){let t=this.m_imgDataList[o];if(this.mipmapEnabled&&this.m_generateMipmap)r=t[0],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,a.default.ToGL(i,this.internalFormat),h,l,0,a.default.ToGL(i,this.srcFormat),n.default.ToGL(i,this.dataType),r.imgData);else{e=h,s=l;let _=0;for(;e>0||s>0;)null!=t[_]&&(r=t[_],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+o,_,a.default.ToGL(i,this.internalFormat),e,s,0,a.default.ToGL(i,this.srcFormat),n.default.ToGL(i,this.dataType),r.imgData)),e>0&&(e>>=1),s>0&&(s>>=1),++_}}this.version=0}toString(){return"[BytesCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.m_imgDataList)for(let t=0;t<6;++t)null!=this.m_imgDataList[t]&&(this.m_imgDataList[t].imgData=null);super.__$destroy()}}}e.default=o},5326:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e=256){this.m_total=256,this.m_rcuid=0,this.index=0,this.dataList=null,this.flagList=null,this.m_rcuid=t,this.m_total=e,this.flagList=new Uint16Array(this.m_total),this.dataList=new Array(this.m_total);for(let s=0;s<this.m_total;++s)this.dataList[s]=null,this.flagList[s]=0}getRCUid(){return this.m_rcuid}}e.UniformDataSlot=i},"53d3":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("29ef"));class a{constructor(){this.NORMAL_STATE=0,this.BACK_CULLFACE_NORMAL_STATE=0,this.FRONT_CULLFACE_NORMAL_STATE=1,this.NONE_CULLFACE_NORMAL_STATE=2,this.ALL_CULLFACE_NORMAL_STATE=3,this.BACK_NORMAL_ALWAYS_STATE=4,this.BACK_TRANSPARENT_STATE=5,this.BACK_TRANSPARENT_ALWAYS_STATE=6,this.NONE_TRANSPARENT_STATE=7,this.NONE_TRANSPARENT_ALWAYS_STATE=8,this.FRONT_CULLFACE_GREATER_STATE=9,this.BACK_ADD_BLENDSORT_STATE=10,this.BACK_ADD_ALWAYS_STATE=11,this.BACK_ALPHA_ADD_ALWAYS_STATE=12,this.NONE_ADD_ALWAYS_STATE=13,this.NONE_ADD_BLENDSORT_STATE=14,this.NONE_ALPHA_ADD_ALWAYS_STATE=15,this.FRONT_ADD_ALWAYS_STATE=16,this.FRONT_TRANSPARENT_STATE=17,this.FRONT_TRANSPARENT_ALWAYS_STATE=18,this.NONE_CULLFACE_NORMAL_ALWAYS_STATE=19,this.BACK_ALPHA_ADD_BLENDSORT_STATE=20;let t=r.default,e=this;e.NORMAL_STATE=t.NORMAL_STATE,e.BACK_CULLFACE_NORMAL_STATE=t.BACK_CULLFACE_NORMAL_STATE,e.FRONT_CULLFACE_NORMAL_STATE=t.FRONT_CULLFACE_NORMAL_STATE,e.NONE_CULLFACE_NORMAL_STATE=t.NONE_CULLFACE_NORMAL_STATE,e.ALL_CULLFACE_NORMAL_STATE=t.ALL_CULLFACE_NORMAL_STATE,e.BACK_NORMAL_ALWAYS_STATE=t.BACK_NORMAL_ALWAYS_STATE,e.BACK_TRANSPARENT_STATE=t.BACK_TRANSPARENT_STATE,e.BACK_TRANSPARENT_ALWAYS_STATE=t.BACK_TRANSPARENT_ALWAYS_STATE,e.NONE_TRANSPARENT_STATE=t.NONE_TRANSPARENT_STATE,e.NONE_TRANSPARENT_ALWAYS_STATE=t.NONE_TRANSPARENT_ALWAYS_STATE,e.FRONT_CULLFACE_GREATER_STATE=t.FRONT_CULLFACE_GREATER_STATE,e.BACK_ADD_BLENDSORT_STATE=t.BACK_ADD_BLENDSORT_STATE,e.BACK_ADD_ALWAYS_STATE=t.BACK_ADD_ALWAYS_STATE,e.BACK_ALPHA_ADD_ALWAYS_STATE=t.BACK_ALPHA_ADD_ALWAYS_STATE,e.NONE_ADD_ALWAYS_STATE=t.NONE_ADD_ALWAYS_STATE,e.NONE_ADD_BLENDSORT_STATE=t.NONE_ADD_BLENDSORT_STATE,e.NONE_ALPHA_ADD_ALWAYS_STATE=t.NONE_ALPHA_ADD_ALWAYS_STATE,e.FRONT_ADD_ALWAYS_STATE=t.FRONT_ADD_ALWAYS_STATE,e.FRONT_TRANSPARENT_STATE=t.FRONT_TRANSPARENT_STATE,e.FRONT_TRANSPARENT_ALWAYS_STATE=t.FRONT_TRANSPARENT_ALWAYS_STATE,e.NONE_CULLFACE_NORMAL_ALWAYS_STATE=t.NONE_CULLFACE_NORMAL_ALWAYS_STATE,e.BACK_ALPHA_ADD_BLENDSORT_STATE=t.BACK_ALPHA_ADD_BLENDSORT_STATE}}e.RenderingState=a},"557f":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=i(s("ffc0")),n=i(s("5deb")),h=i(s("0851"));class l extends h.default{constructor(t,e,s=1,i=!1){super(t,e,i),this.m_bytes=null,this.m_tex3DDepth=1,this.internalFormat=a.default.R8,this.srcFormat=a.default.RED,this.m_tex3DDepth=s,this.m_texTarget=n.default.TEXTURE_3D,this.m_type=r.TextureProxyType.Texture3D,this.unpackAlignment=1}getDepth(){return this.m_tex3DDepth}uploadFromTypedArray(t,e=0){this.isGpuEnabled()||(this.m_bytes=t,this.m_miplevel=e,this.m_haveRData=!0)}uploadData(t){if(null!=this.m_bytes){let e=t.getRC();e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage3D(e.TEXTURE_3D,0,a.default.ToGL(e,this.internalFormat),this.m_texWidth,this.m_texHeight,this.m_tex3DDepth,0,a.default.ToGL(e,this.srcFormat),e.UNSIGNED_BYTE,this.m_bytes),e.pixelStorei(e.UNPACK_ALIGNMENT,4)}}__$destroy(){this.getAttachCount()<1&&(this.m_bytes=null,super.__$destroy())}toString(){return"[Texture3DProxy(width="+this.getWidth()+",height="+this.getHeight()+",depth="+this.getDepth()+")]"}}e.default=l},"56c5":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("030e"));class a{static SetRenderer(t){a.m_rc=t.getRC(),a.m_webGLVer=t.getWebGLVersion();let e=a;1==a.m_webGLVer&&null!=r.default.WEBGL_draw_buffers?e.COLOR_ATTACHMENT0=r.default.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL:e.COLOR_ATTACHMENT0=a.m_rc.COLOR_ATTACHMENT0}static DrawBuffers(t){2==a.m_webGLVer?a.m_rc.drawBuffers(t):null!=r.default.WEBGL_draw_buffers&&r.default.WEBGL_draw_buffers.drawBuffersWEBGL(t)}}a.m_rc=null,a.m_webGLVer=2,a.COLOR_ATTACHMENT0=0,e.default=a},"58fc":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},"5ab6":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8310");class r{constructor(){}calcVtxIVS(t){let e=t,s=0,i=t.length,r=0;for(let h=0;h<i;++h)if(s++,e[h]<0){if(4==s)r+=6;else if(3==s)r+=3;else for(let t=s-2;t>0;t--)r+=3;s=0}let a=r>65535?new Uint32Array(r):new Uint16Array(r),n=0;for(let h=0;h<i;++h)if(s++,e[h]<0){if(4==s)a[n]=h-3,a[n+1]=h-2,a[n+2]=h-1,a[n+3]=h,a[n+4]=h-3,a[n+5]=h-1,n+=6;else if(3==s)a[n]=h-2,a[n+1]=h-1,a[n+2]=h,n+=3;else for(let t=s-2;t>0;t--)a[n]=h,a[n+1]=h-t-1,a[n+2]=h-t,n+=3;s=0}return a}buildBufs(t,e,s,i){let r=3*e.length,a=null,n=this.calcVtxIVS(e),h=new Float32Array(r),l=e.length,o=0,_=0;if(i.length==h.length){a=new Float32Array(i);for(let t=0;t<l;++t)_=3*t,o=e[t],o<0&&(o=-1*o-1),o*=3,h[_]=s[o],h[_+1]=s[o+1],h[_+2]=s[o+2],_+=3}else{a=new Float32Array(r);for(let t=0;t<l;++t)_=3*t,o=e[t],o<0&&(o=-1*o-1),o*=3,h[_]=s[o],h[_+1]=s[o+1],h[_+2]=s[o+2],a[_]=i[o],a[_+1]=i[o+1],a[_+2]=i[o+2],_+=3}t.vertex=h,t.normal=a,t.indices=n}createBufObject(t){let e=new i.FBXBufferObject;this.buildBufs(e,t.vertexIndices,t.vertexPositions,t.normal.buffer);let s=2*e.vertex.length/3,r=new Float32Array(s);return e.isEntity=!0,e.uvs=[r],e}}e.ElementGeomData=r},"5d04":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=i(s("8d98")),n=i(s("ffc0")),h=i(s("1f61")),l=i(s("4cf7")),o=i(s("5e78")),_=i(s("fe7f")),m=i(s("9f3e")),u=i(s("f928")),d=i(s("eaee")),c=i(s("52e0")),f=i(s("d314")),p=i(s("557f")),g=i(s("da6a")),T=s("ccdf");class y{constructor(){this.m_texPool=new l.default,this.m_rttStore=null,this.m_renderProxy=null,this.m_texLoaders=[],this.m_clearDelay=128}addTexLoader(t){if(null!=t){let e=0,s=this.m_texLoaders.length;for(;e<s;++e)if(t==this.m_texLoaders[e])break;e>=s&&this.m_texLoaders.push(t)}}removeTexLoader(t){if(null!=t){let e=0,s=this.m_texLoaders.length;for(;e<s;++e)if(t==this.m_texLoaders[e]){this.m_texLoaders.slice(e,1);break}}}setRenderer(t){this.m_renderProxy=t,g.default.GetInstance().setRenderProxy(t),null==this.m_rttStore&&null!=t&&(this.m_rttStore=new T.RTTTextureStore(t))}getRTTStrore(){return this.m_rttStore}createWrapperTex(t,e,s=!1){return this.m_rttStore.createWrapperTex(t,e,s)}createRTTTex2D(t,e,s=!1){let i=this.m_rttStore.createRTTTex2D(t,e,s);return i.__$setRenderProxy(this.m_renderProxy),i}createImageTex2D(t,e,s=!1){let i=this.m_texPool.getTexture(r.TextureProxyType.Image);return null==i&&(i=new o.default(t,e,s)),i.__$setRenderProxy(this.m_renderProxy),i.mipmapEnabled=!0,i.setWrap(a.default.WRAP_REPEAT),i}createHalfFloatTex2D(t,e,s=!1){let i=this.m_texPool.getTexture(r.TextureProxyType.Float);return null==i&&(i=new u.default(t,e,s)),i.__$setRenderProxy(this.m_renderProxy),i.srcFormat=n.default.RGBA,i.dataType=h.default.HALF_FLOAT_OES,i}createFloatTex2D(t,e,s=!1){let i=this.m_texPool.getTexture(r.TextureProxyType.Float);return null==i&&(i=new u.default(t,e,s)),i.__$setRenderProxy(this.m_renderProxy),i}createUint16Tex2D(t,e,s=!1){return new m.default(t,e,s)}createFloatCubeTex(t,e,s=!1){return new d.default(t,e)}createBytesTex(t,e){let s=this.m_texPool.getTexture(r.TextureProxyType.Bytes);return null==s&&(s=new _.default(t,e)),s.__$setRenderProxy(this.m_renderProxy),s}createBytesCubeTex(t,e){let s=new c.default(t,e);return s.__$setRenderProxy(this.m_renderProxy),s}createImageCubeTex(t,e){let s=new f.default(t,e);return s.__$setRenderProxy(this.m_renderProxy),s}createTex3D(t,e,s=1){s<1&&(s=1);let i=new p.default(t,e,s);return i.__$setRenderProxy(this.m_renderProxy),i}createRGBATex2D(t,e,s){t=t>1?t:1,e=e>1?e:1;let i=t*e,r=this.createBytesTex(t,e),a=new Uint8Array(4*i),n=Math.round(255*s.r),h=Math.round(255*s.g),l=Math.round(255*s.b),o=Math.round(255*s.a),_=0,m=[n,h,l,o];for(let u=0;u<i;++u)a.set(m,_),_+=4;return r.setDataFromBytes(a,0,t,e,0,0,!1),r.__$setRenderProxy(this.m_renderProxy),r}createAlphaTex2D(t,e,s){t=t>1?t:1,e=e>1?e:1;let i=t*e,r=this.createBytesTex(t,e);r.toAlphaFormat();let a=new Uint8Array(i),n=Math.round(255*s);return a.fill(n,0,i),r.setDataFromBytes(a,0,t,e,0,0,!1),r.__$setRenderProxy(this.m_renderProxy),r}createAlphaTexBytes2D(t,e,s){let i=this.createBytesTex(t,e);return i.setDataFromBytes(s,0,t,e,0,0,!1),i.toAlphaFormat(),i.__$setRenderProxy(this.m_renderProxy),i}getCubeRTTTextureAt(t){return this.m_rttStore.getCubeRTTTextureAt(t)}createCubeRTTTextureAt(t,e,s){return this.m_rttStore.createCubeRTTTextureAt(t,e,s)}getRTTTextureAt(t){return this.m_rttStore.getRTTTextureAt(t)}createRTTTextureAt(t,e,s){return this.m_rttStore.createRTTTextureAt(t,e,s)}getDepthTextureAt(t){return this.m_rttStore.getDepthTextureAt(t)}createDepthTextureAt(t,e,s){return this.m_rttStore.createDepthTextureAt(t,e,s)}getRTTFloatTextureAt(t){return this.m_rttStore.getRTTFloatTextureAt(t)}createRTTFloatTextureAt(t,e,s){return this.m_rttStore.createRTTFloatTextureAt(t,e,s)}run(){let t=0,e=this.m_texLoaders.length;for(;t<e;++t)this.m_texLoaders[t].run();if(this.m_clearDelay<1){let t;this.m_clearDelay=128;let e=g.default.GetInstance().getFreeResUidMap(),s=32;for(const[i,r]of e){if(s<1)break;s--,r>2?(e.delete(i),t=g.default.GetInstance().removeTextureByUid(i),null!=t&&this.m_texPool.addTexture(t)):e.set(i,r+1)}}this.m_clearDelay--}}e.TextureBlock=y},"5deb":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static GetValue(t,e){switch(e){case i.TEXTURE_2D:return t.TEXTURE_2D;case i.TEXTURE_2D_ARRAY:return t.TEXTURE_2D_ARRAY;case i.TEXTURE_CUBE:return t.TEXTURE_CUBE_MAP;case i.TEXTURE_3D:return t.TEXTURE_3D;default:break}return t.TEXTURE_2D}}i.TEXTURE_2D=20,i.TEXTURE_2D_ARRAY=22,i.TEXTURE_SHADOW_2D=23,i.TEXTURE_CUBE=25,i.TEXTURE_3D=30,e.default=i},"5e78":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=i(s("8d98")),n=i(s("7181")),h=i(s("0851"));class l extends h.default{constructor(t,e,s=!1){super(t,e,s),this.m_texData=null,this.m_texDatas=null,this.m_texDatasLen=0,this.mipmapEnabled=!0,this.minFilter=a.default.LINEAR_MIPMAP_LINEAR,this.m_type=r.TextureProxyType.Image}getTexData(){return this.m_texData}setDataFromImage(t,e=0,s=0,i=0,r=!1){if(null!=t&&t.width>0&&t.height>0){this.m_haveRData=!0,e<0&&(e=0),e>15&&(e=15),e>=this.m_texDatasLen&&(this.m_texDatasLen=e+1);let a=this.m_texData;null!=a?this.m_texData.miplevel!=e?(null==this.m_texDatas&&(this.m_texDatas=[this.m_texData,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),a=this.m_texDatas[e],null==a&&(a=n.default.Create(),a.miplevel=e,r=!0,this.m_texDatas[e]=a)):this.isGpuEnabled()&&(a.status=0):(a=this.m_texData=n.default.Create(),a.miplevel=e,r=!0,this.m_texWidth=t.width,this.m_texHeight=t.height),a.data==t&&a.offsetx==s&&a.offsety==i||(0==e&&(this.m_texWidth=t.width,this.m_texHeight=t.height),a.data=t,a.status=0,(a.width<t.width||a.height<t.height||r)&&(a.width=t.width,a.height=t.height,a.status=1),a.offsetx=s,a.offsety=i),this.version++}}uploadData(t){null!=this.m_texData&&this.dataUploadToGpu(t.getRC(),this.m_texData,this.m_texDatas,!0),this.version=0}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())&&null!=this.m_texData){let e=t.getRC();this.__$updateToGpuBegin(t),this.dataUploadToGpu(e,this.m_texData,this.m_texDatas),this.__$buildParam(e),this.m_generateMipmap=!0}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.m_texDatas){for(let t=0;t<this.m_texDatasLen;++t)n.default.Restore(this.m_texDatas[t]);this.m_texDatasLen=0,this.m_texDatas=null,this.m_texData=null}null!=this.m_texData&&(n.default.Restore(this.m_texData),this.m_texData=null),super.__$destroy()}}toString(){return"[ImageTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=l},"5f3c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("df9d")),n=s("070b"),h=s("a5ba");class l{constructor(t){this.m_uid=-1,this.m_nodeLinker=new a.default,this.m_shader=null,this.index=-1,this.shdUid=-1,this.procuid=-1,this.batchEnabled=!0,this.fixedState=!0,this.runMode=0,this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null,this.m_shader=t,this.m_uid=l.s_uid++}showInfo(){this.m_nodeLinker.showInfo()}addNode(t){this.m_nodeLinker.addNodeAndSort(t)}rejoinNode(t){this.m_nodeLinker.containsNode(t)&&(this.m_nodeLinker.removeNodeAndSort(t),this.m_nodeLinker.addNodeAndSort(t))}removeNode(t){this.m_nodeLinker.removeNodeAndSort(t)}isEmpty(){return null==this.m_nodeLinker.getBegin()}run(t){switch(this.runMode){case 2:this.run2(t);break;case 1:this.run1(t);break;case 0:this.run0(t);break;default:break}}run0(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let s=null;while(null!=e)e.drawEnabled&&(s=e.unit,s.drawEnabled&&(s.run(t),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}run1(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let s=null,i=this.m_nodeLinker.getVtxTotalAt(e.rvroI),r=this.m_nodeLinker.getTexTotalAt(e.rtroI),a=i>0,n=r>0;while(null!=e)i<1&&(i=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=!0),i--,r<1&&(r=this.m_nodeLinker.getTexTotalAt(e.rtroI),n=!0),r--,e.drawEnabled&&(s=e.unit,s.drawEnabled&&(a&&(e.vro.run(),a=!1),n&&(e.tro.run(),n=!1),s.run2(t),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}run2(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let s=null;h.RenderStateObject.UseRenderState(e.unit.renderState),n.RenderColorMask.UseRenderState(e.unit.rcolorMask);let i=this.m_nodeLinker.getVtxTotalAt(e.rvroI),r=this.m_nodeLinker.getTexTotalAt(e.rtroI),a=i>0,l=r>0;while(null!=e)i<0&&(i=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=!0),i--,r<0&&(r=this.m_nodeLinker.getTexTotalAt(e.rtroI),l=!0),r--,e.drawEnabled&&(s=e.unit,s.drawEnabled&&(a&&(e.vro.run(),a=!1),l&&(e.tro.run(),l=!1),null!=s.ubo&&s.ubo.run(t),this.m_shader.useTransUniform(s.transUniform),this.m_shader.useUniform(s.uniform),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}runLockMaterial(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let s=this.m_shader.isTextureUnLocked();t.Texture.unlocked=s;let i=null;if(this.batchEnabled){let r=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=r>0;while(null!=e)r<1&&(r=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=!0),r--,i=e.unit,e.drawEnabled&&i.drawEnabled&&(a&&(e.vro.run(),a=!1),s&&e.tro.run(),i.runLockMaterial2(null),i.partTotal<1?i.drawThis(t):i.drawPart(t)),e=e.next}else while(null!=e)i=e.unit,e.drawEnabled&&i.drawEnabled&&(i.runLockMaterial(),s&&e.tro.run(),i.partTotal<1?i.drawThis(t):i.drawPart(t)),e=e.next;t.Texture.unlocked=!1}}drawUnit(t,e,s){e.drawEnabled&&(this.m_shader.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t))}drawLockMaterialByUnit(t,e,s,i,a){if(e.drawEnabled){if(a&&this.m_shader.resetUniform(),r.default.IsMobileWeb()){let t=this.vtxResource.getVROByResUid(s.vbuf.getUid(),this.m_shader.getCurrentShd(),!0);t.run()}else e.vro.run();e.runLockMaterial2(i?this.m_shader.__$globalUniform:null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}}reset(){let t=this.m_nodeLinker.getBegin(),e=null;if(null!=t){let s;while(null!=t)e=t,t=t.next,this.rpoUnitBuilder.setRPNodeParam(e.__$ruid,this.procuid,-1),e.reset(),s=e.unit,this.rpoNodeBuilder.restore(e)&&this.rpoUnitBuilder.restore(s)}this.index=-1,this.shdUid=-1,this.procuid=-1,this.m_nodeLinker.clear(),this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null}destroy(){this.reset()}getUid(){return this.m_uid}toString(){return"[RPOBlock(uid = "+this.m_uid+", index = "+this.index+", shdUid = "+this.shdUid+")]"}}l.s_uid=0,e.default=l},"60cd":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,s,i){this.status=0,this.taskclass=t,this.cmd=e,this.taskCmd=s,this.threadIndex=i}}e.TDRParam=i},"617e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("29ef")),a=i(s("402a")),n=i(s("4835")),h=i(s("efce")),l=i(s("725b")),o=s("cc48");class _ extends a.default{constructor(t=!0){super(),this.m_dynamicEnbaled=!0,this.m_currMaterial=null,this.m_currMesh=null,this.m_charsStr="",this.m_alignFactorX=.5,this.m_alignFactorY=.5,this.flipVerticalUV=!1,this.m_dynamicEnbaled=t}setAlignFactor(t,e){this.m_alignFactorX=t,this.m_alignFactorY=e,null!=this.m_currMesh&&this.m_currMesh.updateCharStr(this.m_charsStr)}alignLeftTop(){this.setAlignFactor(0,0)}alignCenter(){this.setAlignFactor(.5,.5)}alignLeftCenter(){this.setAlignFactor(0,.5)}setText(t){null!=this.m_currMesh&&(this.m_charsStr=t,this.m_currMesh.alignFactorX=this.m_alignFactorX,this.m_currMesh.alignFactorY=this.m_alignFactorY,this.m_currMesh.updateCharStr(t),this.update())}setRGBA4f(t,e,s,i){null!=this.m_currMaterial&&this.m_currMaterial.setRGBA4f(t,e,s,i)}setRGB3f(t,e,s){null!=this.m_currMaterial&&this.m_currMaterial.setRGB3f(t,e,s)}setAlpha(t){this.m_currMaterial.setAlpha(t)}getAlpha(){return this.m_currMaterial.getAlpha()}setBrightness(t){this.m_currMaterial.setBrightness(t)}getBrightness(){return this.m_currMaterial.getBrightness()}getWidth(){return this.m_currMesh.getWidth()*this.m_currMaterial.getScaleX()}getHeight(){return this.m_currMesh.getHeight()*this.m_currMaterial.getScaleY()}setXYZ(t,e,s){null!=this.m_currMaterial&&this.m_currMaterial.setXY(t,e)}setXY(t,e){null!=this.m_currMaterial&&this.m_currMaterial.setXY(t,e)}setX(t){null!=this.m_currMaterial&&this.m_currMaterial.setX(t)}setY(t){null!=this.m_currMaterial&&this.m_currMaterial.setY(t)}getX(){return null!=this.m_currMaterial?this.m_currMaterial.getX():0}getY(){return null!=this.m_currMaterial?this.m_currMaterial.getY():0}setScale(t){null!=this.m_currMaterial&&this.m_currMaterial.setScale(t)}getScaleX(){return this.m_currMaterial.getScaleX()}getScaleY(){return this.m_currMaterial.getScaleY()}setScaleX(t){this.m_currMaterial.setScaleX(t)}setScaleY(t){this.m_currMaterial.setScaleY(t)}setScaleXY(t,e){this.m_currMaterial.setScaleXY(t,e)}createMaterial(t){null==this.getMaterial()?(this.m_currMaterial=new n.default,this.m_currMaterial.setTextureList(t),this.setMaterial(this.m_currMaterial)):this.m_currMaterial.setTextureList(t)}initialize(t,e=null){this.m_charsStr=t,this.spaceCullMask=o.SpaceCullingMask.NONE,this.spaceCullMask=0,this.m_alignFactorX=0,this.m_alignFactorY=0,null==e?this.createMaterial([l.default.GetInstance().getTextureAt(0)]):this.createMaterial(e),this.activeDisplay(),this.setRenderState(r.default.BACK_TRANSPARENT_ALWAYS_STATE)}createBounds(){}__activeMesh(t){if(null==this.getMesh()){let e=new h.default;e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.alignFactorX=this.m_alignFactorX,e.alignFactorY=this.m_alignFactorY,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.m_charsStr),this.setMesh(e),this.m_currMesh=e}}update(){this.m_dynamicEnbaled&&this.m_mesh.isGeomDynamic()&&this.setIvsParam(0,this.m_mesh.vtCount),this.m_transfrom.update()}toString(){return"Text2DEntity(uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=_},"644c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}static GetTypeByTypeNS(t){switch(t){case"mat4":return i.SHADER_MAT4;case"mat3":return i.SHADER_MAT3;case"mat2":return i.SHADER_MAT2;case"float":return i.SHADER_FLOAT;case"int":return i.SHADER_INT;case"vec4":return i.SHADER_VEC4;case"vec3":return i.SHADER_VEC3;case"vec2":return i.SHADER_VEC2;case"vec4[]":return i.SHADER_VEC4FV;case"vec3[]":return i.SHADER_VEC3FV;case"vec2[]":return i.SHADER_VEC2FV;case"sampler2D":return i.SHADER_SAMPLER2D;case"sampler3D":return i.SHADER_SAMPLER3D;case"samplerCube":return i.SHADER_SAMPLERCUBE;default:break}return i.SHADER_UNDEFINED}static GetTypeNSByType(t){switch(t){case i.SHADER_MAT4:return"mat4";case i.SHADER_MAT3:return"mat3";case i.SHADER_MAT2:return"mat2";case i.SHADER_FLOAT:return"float";case i.SHADER_VEC4:return"vec4";case i.SHADER_VEC3:return"vec3";case i.SHADER_VEC2:return"vec2";case i.SHADER_SAMPLER2D:return"sampler2D";case i.SHADER_SAMPLER3D:return"sampler3D";case i.SHADER_SAMPLERCUBE:return"samplerCube";case i.SHADER_UNDEFINED:return"undefined";default:break}return""}}i.ATTRINS_VTX_VS="a_vs",i.ATTRINS_VTX_UVS="a_uvs",i.ATTRINS_VTX_NVS="a_nvs",i.ATTRINS_VTX_CVS="a_cvs",i.UNIFORMNS_OBJ_MAT_NS="u_objMat",i.UNIFORMNS_VIEW_MAT_NS="u_viewMat",i.UNIFORMNS_PROJ_MAT_NS="u_projMat",i.SHADER_UNDEFINED=3010,i.SHADER_VEC2=3011,i.SHADER_VEC3=3012,i.SHADER_VEC4=3013,i.SHADER_VEC2FV=3014,i.SHADER_VEC3FV=3015,i.SHADER_VEC4FV=3016,i.SHADER_MAT2=3017,i.SHADER_MAT3=3018,i.SHADER_MAT4=3019,i.SHADER_FLOAT=3020,i.SHADER_INT=3021,i.SHADER_MAT2FV=3022,i.SHADER_MAT3FV=3023,i.SHADER_MAT4FV=3024,i.SHADER_SAMPLER2D=3031,i.SHADER_SAMPLERCUBE=3032,i.SHADER_SAMPLER3D=3033,i.SHADER_PRECISION_LOWP=3101,i.SHADER_PRECISION_MEDIUMP=3111,i.SHADER_PRECISION_HIGHP=3121,i.UNIFORM_TEX_SAMPLER2D="sampler2D",i.UNIFORM_TEX_SAMPLERCUBE="samplerCube",i.UNIFORM_TEX_SAMPLER3D="sampler3D",i.UNIFORMNS_TEX_SAMPLER_0="u_sampler0",i.UNIFORMNS_TEX_SAMPLER_1="u_sampler1",i.UNIFORMNS_TEX_SAMPLER_2="u_sampler2",i.UNIFORMNS_TEX_SAMPLER_3="u_sampler3",i.UNIFORMNS_TEX_SAMPLER_4="u_sampler4",i.UNIFORMNS_TEX_SAMPLER_5="u_sampler5",i.UNIFORMNS_TEX_SAMPLER_6="u_sampler6",i.UNIFORMNS_TEX_SAMPLER_7="u_sampler7",i.UNIFORMNS_TEX_SAMPLER_LIST=[i.UNIFORMNS_TEX_SAMPLER_0,i.UNIFORMNS_TEX_SAMPLER_1,i.UNIFORMNS_TEX_SAMPLER_2,i.UNIFORMNS_TEX_SAMPLER_3,i.UNIFORMNS_TEX_SAMPLER_4,i.UNIFORMNS_TEX_SAMPLER_5,i.UNIFORMNS_TEX_SAMPLER_6,i.UNIFORMNS_TEX_SAMPLER_7],e.default=i},"670e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("45db"),r=s("8ae4");class a{constructor(){this.version=-1,this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.vertex=new i.ROVertexRes,this.indices=new r.ROIndicesRes,this.m_attachCount=0}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}getAttachCount(){return this.m_attachCount}createVRO(t,e,s){let i=this.vertex.createVRO(t,e,s,this.indices,this.indices.getUid());return i.ibufStep=this.indices.ibufStep,i}updateToGpu(t){this.indices.updateToGpu(t),this.vertex.updateToGpu(t)}destroy(t){this.getAttachCount()<1&&this.resUid>=0&&(this.vertex.destroy(t),this.indices.destroy(t),this.resUid=-1)}}e.GpuVtxObject=a},"68aa":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,s,i,r,a){1==this.status||a?t.texImage2D(e,this.miplevel,s,this.width,this.height,0,i,r,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,this.width,this.height,i,r,this.data),this.status=-1}static Create(){return i.s_list.length>0?i.s_list.pop():new i}static Restore(t){null!=t&&(t.data=null,i.s_list.push(t))}}i.s_list=[],e.default=i},"698b":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static clearAllPhase(t=0){return i.PHASE_NONE}static addNetPhase(t){return i.PHASE_NET|t}static addCpuPhase(t){return i.PHASE_CPU|t}static addGpuPhase(t){return i.PHASE_GPU|t}static removeNetPhase(t){return~i.PHASE_NET&t}static removeCpuPhase(t){return~i.PHASE_CPU&t}static removeGpuPhase(t){return~i.PHASE_GPU&t}static isNonePhase(t){return i.PHASE_NONE==t}static isNetPhase(t){return(i.PHASE_NET&t)==i.PHASE_NET}static isCpuPhase(t){return(i.PHASE_CPU&t)==i.PHASE_CPU}static isGpuPhase(t){return(i.PHASE_GPU&t)==i.PHASE_GPU}}i.PHASE_NONE=0,i.PHASE_NET=4,i.PHASE_CPU=8,i.PHASE_GPU=16,e.DataPhaseFlag=i},"6d49":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("baae")),n=i(s("ffc0")),h=i(s("5deb")),l=i(s("56c5"));class o{constructor(t,e,s){this.m_uid=-1,this.m_rcuid=0,this.m_COLOR_ATTACHMENT0=0,this.m_fbo=null,this.m_depthStencilRBO=null,this.m_depthRBO=null,this.m_colorRBO=null,this.m_width=512,this.m_height=512,this.m_bufferLType=0,this.m_gl=null,this.m_fboTarget=0,this.m_texTargetTypes=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.m_attachmentMaskList=[!0,!0,!0,!0,!0,!0,!0,!0],this.m_preAttachTotal=0,this.m_preAttachIndex=0,this.m_activeAttachmentTotal=0,this.m_attachmentIndex=0,this.m_clearDepthArr=new Float32Array(1),this.m_clearColorArr=new Float32Array(4),this.m_stencilValueArr=new Int16Array(4),this.m_fboSizeChanged=!1,this.textureLevel=0,this.sizeFixed=!1,this.writeDepthEnabled=!0,this.writeStencilEnabled=!1,this.multisampleEnabled=!1,this.multisampleLevel=0,this.m_preAttachments=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.m_preTragets=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.m_preFTIndex=0,this.m_haveDepthTex=!1,this.m_resizeW=2,this.m_resizeH=2,this.m_rcuid=t,this.m_texRes=e,this.m_bufferLType=s,this.m_uid=o.s_uid++}getUid(){return this.m_uid}resetAttachmentMask(t){let e=this.m_attachmentMaskList.length-1;while(e>=0)this.m_attachmentMaskList[e]=t,--e}setAttachmentMaskAt(t,e){this.m_attachmentMaskList[t]=e}getActiveAttachmentTotal(){return this.m_haveDepthTex?this.m_activeAttachmentTotal-1:this.m_activeAttachmentTotal}getAttachmentTotal(){return this.m_attachmentMaskList.length}bindToBackbuffer(t){switch(t){case a.default.DRAW_FRAMEBUFFER:this.m_gl.bindFramebuffer(this.m_gl.DRAW_FRAMEBUFFER,null);break;case a.default.READ_FRAMEBUFFER:this.m_gl.indFramebuffer(this.m_gl.READ_FRAMEBUFFER,null);break;default:this.m_gl.bindFramebuffer(this.m_gl.FRAMEBUFFER,null)}}bind(t){if(null!=this.m_fbo)switch(t){case a.default.DRAW_FRAMEBUFFER:this.m_gl.bindFramebuffer(this.m_gl.DRAW_FRAMEBUFFER,this.m_fbo);break;case a.default.READ_FRAMEBUFFER:this.m_gl.bindFramebuffer(this.m_gl.READ_FRAMEBUFFER,this.m_fbo);break;default:this.m_gl.bindFramebuffer(this.m_gl.FRAMEBUFFER,this.m_fbo)}}getFBO(){return this.m_fbo}getDepthStencilRBO(){return this.m_depthStencilRBO}getDepthRBO(){return this.m_depthRBO}getWidth(){return this.m_width}getHeight(){return this.m_height}getFramebufferType(){return this.m_bufferLType}renderToTexAt(t,e,s){let i=null!=e?e.internalFormat:-1;this.m_gl=t,0==s&&(this.m_preFTIndex=0,this.m_haveDepthTex=!1,this.m_gl.bindFramebuffer(this.m_fboTarget,this.m_fbo),i!=n.default.DEPTH_COMPONENT&&i!=n.default.DEPTH_STENCIL&&(this.m_activeAttachmentTotal=0,this.m_attachmentIndex=0));let r=-1,a=null;null!=e?(r=e.getTargetType(),a=this.m_texRes.getGpuBuffer(e.getResUid()),e.uploadFromFbo(this.m_texRes,this.m_width,this.m_height)):r=this.m_texTargetTypes[this.m_activeAttachmentTotal],this.framebufferTextureBind(t,r,i,a)}glFramebufferTex2D(t,e){let s=this.m_gl;s.framebufferTexture2D(this.m_fboTarget,t,s.TEXTURE_2D,e,0),this.m_preAttachments[this.m_preFTIndex]=t,this.m_preTragets[this.m_preFTIndex]=s.TEXTURE_2D,this.m_preFTIndex++}glFramebufferTexCube(t,e,s){let i=this.m_gl;i.framebufferTexture2D(this.m_fboTarget,t,i.TEXTURE_CUBE_MAP_POSITIVE_X+e,s,0),this.m_preAttachments[this.m_preFTIndex]=t,this.m_preTragets[this.m_preFTIndex]=i.TEXTURE_CUBE_MAP_POSITIVE_X+e,this.m_preFTIndex++}framebufferTexture2D(t,e,s,i){let r=-1;switch(s){case n.default.DEPTH_COMPONENT:this.m_haveDepthTex=!0,r=this.m_gl.DEPTH_ATTACHMENT;break;case n.default.DEPTH_STENCIL:this.m_haveDepthTex=!0,r=this.m_gl.DEPTH_STENCIL_ATTACHMENT;break;default:r=this.m_COLOR_ATTACHMENT0+this.m_attachmentIndex;break}r>0&&(this.m_attachmentMaskList[this.m_activeAttachmentTotal]?(this.glFramebufferTex2D(r,i),++this.m_attachmentIndex,this.m_texTargetTypes[this.m_activeAttachmentTotal]=null!=i?e:0):this.m_texTargetTypes[this.m_activeAttachmentTotal]=0,++this.m_activeAttachmentTotal)}framebufferTextureBind(t,e,s,i){switch(e){case h.default.TEXTURE_2D:this.framebufferTexture2D(t,e,s,i);break;case h.default.TEXTURE_CUBE:let r=0;for(let t=0;t<6;++t)this.m_attachmentMaskList[t]?(this.glFramebufferTexCube(this.m_COLOR_ATTACHMENT0+this.m_attachmentIndex,t,i),++this.m_attachmentIndex,this.m_texTargetTypes[this.m_activeAttachmentTotal+t]=null!=i?e:0,r++):this.m_texTargetTypes[this.m_activeAttachmentTotal+t]=0;r=r>0?r:6,this.m_activeAttachmentTotal+=r;break;case h.default.TEXTURE_SHADOW_2D:this.m_attachmentMaskList[this.m_activeAttachmentTotal]?(this.glFramebufferTex2D(this.m_gl.DEPTH_ATTACHMENT,i),this.m_texTargetTypes[this.m_activeAttachmentTotal]=null!=i?e:0):this.m_texTargetTypes[this.m_activeAttachmentTotal]=0,++this.m_activeAttachmentTotal;break;default:break}}reset(){this.m_preAttachTotal=-1,this.m_preAttachIndex=-1}use(t){if(this.m_gl=t,null!=this.m_fbo){if(this.m_activeAttachmentTotal>1){if(this.m_preAttachIndex!=this.m_attachmentIndex){let t=[],e=0;for(;e<this.m_attachmentIndex;++e)t.push(this.m_COLOR_ATTACHMENT0+e);if(this.m_preAttachIndex>this.m_attachmentIndex)for(;e<this.m_preAttachIndex;++e)this.m_gl.framebufferTexture2D(this.m_fboTarget,this.m_preAttachments[e],this.m_preTragets[e],null,0);l.default.DrawBuffers(t),this.m_preAttachIndex=this.m_attachmentIndex}}else if(this.m_preAttachIndex!=this.m_attachmentIndex){if(this.m_preAttachIndex>this.m_attachmentIndex)for(let e=1;e<this.m_preAttachIndex;++e)this.m_gl.framebufferTexture2D(this.m_fboTarget,this.m_preAttachments[e],this.m_preTragets[e],null,0);let t=[this.m_COLOR_ATTACHMENT0];l.default.DrawBuffers(t),this.m_preAttachIndex=this.m_attachmentIndex}this.m_preAttachTotal=this.m_activeAttachmentTotal}}clearOnlyColor(t){if(null!=this.m_fbo)if(r.default.IsWebGL2())if(this.m_clearColorArr[0]=t.r,this.m_clearColorArr[1]=t.g,this.m_clearColorArr[2]=t.b,this.m_clearColorArr[3]=t.a,this.m_preAttachTotal>1)for(let e=0;e<this.m_preAttachTotal;++e)this.m_gl.clearBufferfv(this.m_gl.COLOR,e,this.m_clearColorArr);else this.m_gl.clearBufferfv(this.m_gl.COLOR,0,this.m_clearColorArr);else this.m_gl.clearColor(t.r,t.g,t.b,t.a)}clearOnlyDepth(t=1){r.default.IsWebGL2()?(this.m_clearDepthArr[0]=t,this.m_gl.clearBufferfv(this.m_gl.DEPTH,0,this.m_clearDepthArr)):this.m_gl.clearDepth(t)}clearOnlyStencil(t){this.m_stencilValueArr[0]=t,this.m_gl.clearBufferuiv(this.m_gl.STENCIL,0,this.m_stencilValueArr)}clearOnlyDepthAndStencil(t,e){this.m_gl.clearBufferfi(this.m_gl.DEPTH_STENCIL,0,t,e)}invalidateFramebuffer(){}resize(t,e){this.m_resizeW==t&&this.m_resizeH==e||(this.m_fboSizeChanged=!0,this.m_resizeW=t,this.m_resizeH=e)}initialize(t,e,s){this.m_gl=t,this.m_COLOR_ATTACHMENT0=l.default.COLOR_ATTACHMENT0,this.m_fboSizeChanged&&(e=this.m_resizeW,s=this.m_resizeH),null==this.m_fbo?this.createNewFBO(t,e,s):this.m_width==e&&this.m_height==s||this.createNewFBO(t,e,s),this.m_fboSizeChanged=!1}isSizeChanged(){return this.m_fboSizeChanged}destroy(t){null!=this.m_fbo&&(null!=this.m_depthStencilRBO&&(t.deleteFramebuffer(this.m_depthStencilRBO),this.m_depthStencilRBO=null),null!=this.m_depthRBO&&(t.deleteFramebuffer(this.m_depthRBO),this.m_depthRBO=null),null!=this.m_colorRBO&&(t.deleteFramebuffer(this.m_colorRBO),this.m_colorRBO=null),t.deleteFramebuffer(this.m_fbo),this.m_fbo=null),this.m_gl=null,this.m_fboTarget=0,this.m_fboSizeChanged=!1}buildDepthStencilRBO(t,e,s){null==this.m_depthStencilRBO&&(this.m_depthStencilRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_STENCIL,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO))}buildDepthRBO(t,e,s){null==this.m_depthRBO&&(this.m_depthRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_COMPONENT24,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.m_depthRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthRBO),r.default.IsWebGL2()?t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT24,e,s):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.m_depthRBO))}buildStencilRBO(t,e,s){null==this.m_depthStencilRBO&&(null==this.m_depthStencilRBO&&(this.m_depthStencilRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.STENCIL_INDEX8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorage(t.RENDERBUFFER,t.STENCIL_INDEX8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO)))}buildColorRBO(t,e,s){this.multisampleEnabled&&(null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO))}createNewFBO(t,e,s){let i=null==this.m_fbo;switch(this.m_preAttachTotal=this.m_activeAttachmentTotal=0,this.m_preAttachIndex=this.m_attachmentIndex=0,this.m_width=e,this.m_height=s,this.m_resizeW=e,this.m_resizeH=s,i&&(this.m_fbo=t.createFramebuffer()),this.m_bufferLType){case a.default.DRAW_FRAMEBUFFER:this.m_fboTarget=t.DRAW_FRAMEBUFFER;break;case a.default.READ_FRAMEBUFFER:this.m_fboTarget=t.READ_FRAMEBUFFER;break;default:this.m_fboTarget=t.FRAMEBUFFER;break}if(t.bindFramebuffer(this.m_fboTarget,this.m_fbo),this.writeDepthEnabled?this.writeStencilEnabled?null==this.m_depthStencilRBO&&this.buildDepthStencilRBO(t,e,s):this.buildDepthRBO(t,e,s):this.writeStencilEnabled?this.buildStencilRBO(t,e,s):this.buildColorRBO(t,e,s),i){t.checkFramebufferStatus(this.m_fboTarget);t.FRAMEBUFFER_COMPLETE}o.BindToBackbuffer(t,this.m_bufferLType)}static BindToBackbuffer(t,e){switch(e){case a.default.DRAW_FRAMEBUFFER:t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null);break;case a.default.READ_FRAMEBUFFER:t.indFramebuffer(t.READ_FRAMEBUFFER,null);break;default:t.bindFramebuffer(t.FRAMEBUFFER,null);break}}}o.s_uid=0,e.default=o},"6e01":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Clamp(t,e,s){return Math.max(Math.min(t,s),e)}static IsPowerOf2(t){return 0==(t&t-1)}static CalcCeilPowerOfTwo(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}static CalcNearestCeilPow2(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}static CalcFloorCeilPow2(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}static DegreeToRadian(t){return i.MATH_PI_OVER_180*t}static Log2(t){return Math.log(t)/Math.LN2}static GetMaxMipMapLevel(t,e){return Math.round(i.Log2(Math.max(t,e))+1)}static SafeACos(t){return t<=-1?i.MATH_PI:t>=1?0:Math.acos(t)}static GetNearestCeilPow2(t){let e=1;while(e<t)e<<=1;return e}static GetMinRadian(t,e){return e%=i.MATH_2PI,t%=i.MATH_2PI,e<t?(e=i.MATH_2PI-t+e,e>i.MATH_PI?e-i.MATH_2PI:e):e>t?(t=i.MATH_2PI-e+t,t>i.MATH_PI?i.MATH_2PI-t:-t):0}static GetMinDegree(t,e){let s=0;return e>=270&&t<90?s=(e-(t+360))%180:e<=90&&t>=270?s=(e+360-t)%180:(s=e-t,s>180?(s-=360,s%=360):s<-180&&(s+=360,s%=360)),s}static GetDegreeByXY(t,e){if(Math.abs(t)<1e-5)return e>=0?270:90;let s=180*Math.atan(e/t)/Math.PI;return t>=0?s:180+s}static GetRadianByXY(t,e){if(Math.abs(t)<i.MATH_MIN_POSITIVE)return e>=0?i.MATH_1PER2PI:i.MATH_3PER2PI;let s=Math.atan(e/t);return t>=0?s:i.MATH_PI+s}static GetRadianByCos(t,e,s){var r=Math.acos(t);return e>=0?r:i.MATH_PI+r}}i.MATH_MIN_POSITIVE=1e-5,i.MATH_MAX_NEGATIVE=-1e-5,i.MATH_MAX_POSITIVE=268435454,i.MATH_MIN_NEGATIVE=-268435454,i.MATH_1_OVER_255=1/255,i.MATH_PI=Math.PI,i.MATH_2PI=2*i.MATH_PI,i.MATH_3PER2PI=1.5*i.MATH_PI,i.MATH_1PER2PI=.5*i.MATH_PI,i.MATH_1_OVER_PI=1/i.MATH_PI,i.MATH_1_OVER_360=1/360,i.MATH_1_OVER_180=1/180,i.MATH_180_OVER_PI=180/i.MATH_PI,i.MATH_PI_OVER_180=i.MATH_PI/180,i.MATH_LN2=.6931471805599453,e.default=i},7045:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.phase=0,this.type=i.KEY_DOWN,this.target=null,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.repeat=!1,this.key="",this.keyCode=0,this.location=0}getClassType(){return i.EventClassType}toString(){return"[KeyboardEvent]"}}i.EventClassType=1003,i.KEY_DOWN=6001,i.KEY_UP=6002,e.default=i},"70f2":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("0236")),h=i(s("c51d")),l=i(s("af68")),o=i(s("a80a")),_=i(s("a446")),m=i(s("c711")),u=i(s("955e")),d=i(s("765c")),c=i(s("af29")),f=i(s("18c7"));class p{constructor(t,e,s){this.m_uid=-1,this.m_adapter=null,this.m_renderProxy=null,this.m_rcontext=null,this.m_renderer=null,this.m_parent=null,this.m_processids=new Uint8Array(128),this.m_processidsLen=0,this.m_rspace=null,this.m_mouse_rltv=new a.default,this.m_mouse_rlpv=new a.default,this.m_accessor=null,this.m_evtFlowEnabled=!1,this.m_evt3DCtr=null,this.m_mouseEvtEnabled=!0,this.m_camera=null,this.m_viewX=0,this.m_viewY=0,this.m_viewW=800,this.m_viewH=800,this.m_nodeWaitLinker=null,this.m_nodeWaitQueue=null,this.m_perspectiveEnabled=!0,this.m_rparam=null,this.m_stage3D=null,this.m_shader=null,this.m_runFlag=-1,this.m_autoRunning=!0,this.m_currStage3D=null,this.m_enabled=!0,this.textureBlock=null,this.materialBlock=null,this.entityBlock=null,this.m_containers=[],this.m_containersTotal=0,this.m_mouseTestBoo=!0,this.m_cullingTestBoo=!0,this.m_rayTestFlag=!0,this.m_rayTestEnabled=!0,this.m_evtFlowEnabled=s,this.m_parent=t,this.m_renderer=e,this.m_shader=e.getDataBuilder().getRenderShader(),this.m_uid=1024+p.s_uid++}enable(){this.m_enabled=!0}disable(){this.m_enabled=!1}isEnabled(){return this.m_enabled}getUid(){return this.m_uid}getRPONodeBuilder(){return null}getRenderProxy(){return this.m_renderProxy}setViewPort(t,e,s,i){null!=this.m_renderProxy&&(this.m_viewX=t,this.m_viewY=e,this.m_viewW=s,this.m_viewH=i)}reseizeViewPort(){this.m_renderProxy.reseizeRCViewPort()}getRendererAdapter(){return this.m_adapter}getRenderer(){return this.m_renderer}getRendererContext(){return this.m_rcontext}getStage3D(){return this.m_renderProxy.getStage3D()}getCurrentStage3D(){return this.m_currStage3D}getViewWidth(){return this.m_renderProxy.getStage3D().viewWidth}getViewHeight(){return this.m_renderProxy.getStage3D().viewHeight}getCamera(){return this.m_camera}getRendererStatus(){return this.m_renderer.getRendererStatus()}getMouseXYWorldRay(t,e){this.m_camera.getWorldPickingRayByScreenXY(this.m_stage3D.mouseX,this.m_stage3D.mouseY,t,e)}createCamera(){return new h.default}createFBOInstance(){return new c.default(this,this.textureBlock.getRTTStrore())}createMatrix4(){return new f.default}setEvt3DController(t){null!=t&&(null==this.m_currStage3D&&(this.m_currStage3D=new n.default(this.m_renderProxy.getRCUid(),null),this.m_currStage3D.uProbe=this.m_renderProxy.uniformContext.createUniformVec4Probe(1)),t.initialize(this.getStage3D(),this.m_currStage3D),t.setRaySelector(this.m_rspace.getRaySelector())),this.m_evt3DCtr=t}isRayPickSelected(){return null!=this.m_evt3DCtr&&this.m_evt3DCtr.isSelected()}enableMouseEvent(t=!0){null==this.m_evt3DCtr&&(t?this.m_rspace.setRaySelector(new u.default):this.m_rspace.setRaySelector(new m.default),this.setEvt3DController(new d.default)),this.m_mouseEvtEnabled=!0}disableMouseEvent(){this.m_mouseEvtEnabled=!1}getEvt3DController(){return this.m_evt3DCtr}getSpace(){return this.m_rspace}getDevicePixelRatio(){return this.m_adapter.getDevicePixelRatio()}addEventListener(t,e,s,i=!0,r=!1){this.m_currStage3D.addEventListener(t,e,s,i,r)}removeEventListener(t,e,s){this.m_currStage3D.removeEventListener(t,e,s)}setAccessor(t){this.m_accessor=t}initialize(t,e=3,s=!0){if(null==this.m_renderProxy){e<1&&(e=1),e>8&&(e=8),this.m_rparam=t,this.m_perspectiveEnabled=t.cameraPerspectiveEnabled;let i=null;for(;e>=0;)i=this.m_renderer.appendProcess(t.batchEnabled,t.processFixedState),this.m_processids[this.m_processidsLen]=i.getRPIndex(),this.m_processidsLen++,--e;this.m_rcontext=this.m_renderer.getRendererContext(),this.m_renderProxy=this.m_rcontext.getRenderProxy(),this.m_adapter=this.m_renderProxy.getRenderAdapter(),this.m_stage3D=this.m_renderProxy.getStage3D(),this.m_viewX=this.m_stage3D.getViewX(),this.m_viewY=this.m_stage3D.getViewY(),this.m_viewW=this.m_stage3D.getViewWidth(),this.m_viewH=this.m_stage3D.getViewHeight(),s?this.createMainCamera():this.m_camera=this.m_renderProxy.getCamera(),null==this.m_rspace&&(this.m_rspace=new _.default,this.m_rspace.initialize(this.m_renderer,this.m_camera))}}createMainCamera(){this.m_camera=new h.default,this.m_camera.setViewXY(this.m_viewX,this.m_viewY),this.m_camera.setViewSize(this.m_viewW,this.m_viewH);let t=this.m_rparam.camProjParam;this.m_perspectiveEnabled?this.m_camera.perspectiveRH(r.default.DegreeToRadian(t.x),this.m_viewW/this.m_viewH,t.y,t.z):this.m_camera.orthoRH(t.y,t.z,-.5*this.m_viewH,.5*this.m_viewH,-.5*this.m_viewW,.5*this.m_viewW),this.m_camera.lookAtRH(this.m_rparam.camPosition,this.m_rparam.camLookAtPos,this.m_rparam.camUpDirect),this.m_camera.update()}cameraLock(){this.m_camera.lock()}cameraUnlock(){this.m_camera.unlock()}updateRenderBufferSize(){this.m_adapter.updateRenderBufferSize()}setRendererProcessParam(t,e,s){this.m_renderer.setRendererProcessParam(this.m_processids[t],e,s)}appendARendererProcess(t=!0,e=!1){let s=this.m_renderer.appendProcess(t,e);this.m_processids[this.m_processidsLen]=s.getRPIndex(),this.m_processidsLen++}getRenderProcessAt(t){return this.m_renderer.getProcessAt(this.m_processids[t])}addContainer(t,e=0){if(e<0&&(e=0),null!=t&&t.__$wuid<0&&t.__$contId<1){let s=0;for(;s<this.m_containersTotal;++s)if(this.m_containers[s]==t)return;s>=this.m_containersTotal&&(t.__$wuid=this.m_uid,t.wprocuid=e,t.__$setRenderer(this),this.m_containers.push(t),this.m_containersTotal++)}}removeContainer(t){if(null!=t&&t.__$wuid==this.m_uid&&t.getRenderer()==this.m_renderer){let e=0;for(;e<this.m_containersTotal;++e)if(this.m_containers[e]==t){t.__$wuid=-1,t.wprocuid=-1,t.__$setRenderer(null),this.m_containers.splice(e,1),--this.m_containersTotal;break}}}setAutoRunningEnabled(t){this.m_autoRunning=t}moveEntityTo(t,e){this.m_renderer.moveEntityToProcessAt(t,this.m_processids[e])}drawEntity(t,e=!1,s=!0){this.m_renderer.drawEntity(t,e,s)}addEntity(t,e=0,s=!0){if(null!=t&&t.__$testSpaceEnabled())if(t.isPolyhedral())if(t.hasMesh())this.m_renderer.addEntity(t,this.m_processids[e],s),null!=this.m_rspace&&this.m_rspace.addEntity(t);else{null==this.m_nodeWaitLinker&&(this.m_nodeWaitLinker=new o.default,this.m_nodeWaitQueue=new l.default);let s=this.m_nodeWaitQueue.addEntity(t);s.rstatus=e,this.m_nodeWaitLinker.addNode(s)}else this.m_renderer.addEntity(t,this.m_processids[e],s),null!=this.m_rspace&&this.m_rspace.addEntity(t)}removeEntity(t){if(null!=t){let e=null;if(null!=this.m_nodeWaitLinker){let e=this.m_nodeWaitQueue.getNodeByEntity(t);null!=e&&(this.m_nodeWaitLinker.removeNode(e),this.m_nodeWaitQueue.removeEntity(t))}null==e&&(this.m_renderer.removeEntity(t),null!=this.m_rspace&&this.m_rspace.removeEntity(t))}}updateMaterialUniformToCurrentShd(t){this.m_renderer.updateMaterialUniformToCurrentShd(t)}showInfoAt(t){this.m_renderer.showInfoAt(t)}updateCameraData(t){this.m_rcontext.updateCameraDataFromCamera(this.m_renderProxy.getCamera())}renderBegin(t=!1){t&&this.m_rcontext.renderBegin(),this.m_renderProxy.getCamera()!=this.m_camera&&(this.m_renderProxy.isAutoSynViewAndStage()&&(this.m_viewX=this.m_renderProxy.getViewX(),this.m_viewY=this.m_renderProxy.getViewY(),this.m_viewW=this.m_renderProxy.getViewWidth(),this.m_viewH=this.m_renderProxy.getViewHeight()),this.m_camera.setViewXY(this.m_viewX,this.m_viewY),this.m_camera.setViewSize(this.m_viewW,this.m_viewH),this.m_renderProxy.setRCViewPort(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH,this.m_renderProxy.isAutoSynViewAndStage()),this.m_renderProxy.reseizeRCViewPort()),this.m_camera.update(),this.m_rcontext.updateCameraDataFromCamera(this.m_camera),this.m_shader.renderBegin(),null!=this.m_accessor&&this.m_accessor.renderBegin(this)}runBegin(t=!0,e=!1){t&&this.m_autoRunning&&(this.m_runFlag>=0&&this.runEnd(),this.m_runFlag=0),this.renderBegin(e),null!=this.m_rspace&&(this.m_rspace.setCamera(this.m_camera),this.m_rspace.runBegin())}setRayTestEanbled(t){this.m_rayTestEnabled=t}runMouseTest(t,e){let s=-1;if(null!=this.m_evt3DCtr&&this.m_mouseEvtEnabled){if(this.m_rayTestFlag&&this.m_evt3DCtr.getEvtType()>0){let t=this.m_rspace.getRaySelector();if(null!=t){this.m_rayTestEnabled?this.mouseRayTest():t.clear();let e=t.getSelectedNodesTotal();if(e>1){let s=0,i=t.getSelectedNodes(),r=null;for(;s<e;++s)r=i[s],r.entity.isPolyhedral()}}this.m_rayTestFlag=!1}s=this.m_evt3DCtr.run(t,e)}return this.m_mouseTestBoo=!1,s}update(t=!0,e=!0){if(null!=this.m_currStage3D&&this.m_currStage3D.enterFrame(),t&&this.m_autoRunning&&(0!=this.m_runFlag&&this.runBegin(),this.m_runFlag=1),this.m_mouseTestBoo=!0,this.m_cullingTestBoo=!0,this.m_rayTestFlag=!0,null!=this.m_nodeWaitLinker){let t=this.m_nodeWaitLinker.getBegin();if(null!=t){let e,s,i;while(null!=t)t.entity.hasMesh()?(e=t,t=t.next,s=e.entity,i=e.rstatus,this.m_nodeWaitLinker.removeNode(e),this.m_nodeWaitQueue.removeEntity(e.entity),this.addEntity(s,i)):t=t.next}}let s=0;for(;s<this.m_containersTotal;++s)this.m_containers[s].update();null!=this.m_rspace&&this.m_rspace.update(),null!=this.m_rspace&&this.m_cullingTestBoo&&(null==this.m_evt3DCtr&&null==this.m_rspace.getRaySelector()||this.m_rspace.run()),this.m_mouseTestBoo&&!this.m_evtFlowEnabled&&(e?this.runMouseTest(1,0):null!=this.m_evt3DCtr&&this.m_evt3DCtr.mouseOutEventTarget())}cullingTest(){null!=this.m_rspace&&this.m_rspace.run(),this.m_cullingTestBoo=!1}mouseRayTest(){null!=this.m_rspace&&(this.getMouseXYWorldRay(this.m_mouse_rlpv,this.m_mouse_rltv),this.m_rspace.rayTest(this.m_mouse_rlpv,this.m_mouse_rltv))}run(t=!1){if(this.m_enabled){t&&this.m_autoRunning&&(1!=this.m_runFlag&&this.update(),this.m_runFlag=2);for(let t=0;t<this.m_processidsLen;++t)this.m_renderer.runAt(this.m_processids[t]);t&&this.runEnd()}}runAt(t){this.m_renderer.runAt(this.m_processids[t])}runEnd(){null!=this.m_evt3DCtr&&this.m_evt3DCtr.runEnd(),null!=this.m_rspace&&this.m_rspace.runEnd(),this.m_autoRunning&&(this.m_runFlag=-1),null!=this.m_accessor&&this.m_accessor.renderEnd(this)}useCamera(t,e=!1){this.m_parent.useCamera(t,e)}useMainCamera(){this.m_parent.useMainCamera()}updateCamera(){null!=this.m_camera&&this.m_camera.update()}setClearUint24Color(t,e=1){this.m_renderProxy.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,s){this.m_renderProxy.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.m_renderProxy.setClearRGBAColor4f(t,e,s,i)}setClearColor(t){this.m_renderProxy.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.m_renderProxy.setRenderToBackBuffer()}toString(){return"[RendererSubScene(uid = "+this.m_uid+")]"}}p.s_uid=0,e.default=p},"710f":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){if(this.m_useidList=[],this.m_removeidList=[],null!=i.s_ins)throw Error("ROVtxBufUidStore is a singleton class!!");i.s_ins=this}static GetInstance(){return i.s_ins}__$getRemovedListLen(){return this.m_removeidList.length}__$getRemovedList(){return this.m_removeidList}__$attachAt(t){if(t<this.m_useidList.length)++this.m_useidList[t];else{let e=this.m_useidList.length;for(;e<=t;++e)this.m_useidList.push(0);++this.m_useidList[t]}}__$detachAt(t){--this.m_useidList[t],this.m_useidList[t]<1&&(this.m_useidList[t]=0,this.m_removeidList.push(t))}getAttachCountAt(t){return t<this.m_useidList.length?this.m_useidList[t]:0}getAttachAllCount(){let t=0,e=0,s=this.m_useidList.length;for(;e<s;++e)this.m_useidList[e]>0&&(t+=this.m_useidList[e]);return t}}i.s_ins=null,e.default=i},7126:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_canvas=null,this.m_listener=null}initialize(t,e){null==this.m_canvas&&(this.m_canvas=t,this.m_listener=e,this.initDrop(this.m_canvas))}initDrop(t){t.addEventListener("dragenter",t=>{t.preventDefault(),t.stopPropagation()},!1),t.addEventListener("dragover",t=>{t.preventDefault(),t.stopPropagation()},!1),t.addEventListener("dragleave",t=>{t.preventDefault(),t.stopPropagation()},!1),t.addEventListener("drop",t=>{t.preventDefault(),t.stopPropagation(),this.receiveDropFile(t)},!1)}receiveDropFile(t){if(this.m_listener.isDropEnabled()){let e=t.dataTransfer,s=[],i=0,r=0;if(void 0!==e.items){let t=e.items;for(let e=0;e<t.length;e++){let a=t[e],n=a.webkitGetAsEntry();if(null!=n)if(n.isFile){let t=a.getAsFile();s.push(t),this.m_listener.initFileLoad(s),i=1}else if(n.isDirectory){let t=n.createReader();t.readEntries(t=>{i=t.length,i>0?t.forEach(t=>{t.isFile&&t.file(t=>{s.push(t),r++,i==r&&this.m_listener.initFileLoad(s)})}):this.alertShow(31)});break}if(i>0)break}}}}alertShow(t){switch(t){case 31:alert("");break;default:break}}}e.DropFileController=i},7181:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,s,i,r,a){1==this.status||a?t.texImage2D(e,this.miplevel,s,i,r,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,i,r,this.data),this.status=-1}static Create(){return i.s_list.length>0?i.s_list.pop():new i}static Restore(t){null!=t&&(t.data=null,i.s_list.push(t))}}i.s_list=[],e.default=i},"722e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.NEAREST=4001,i.LINEAR=4002,i.LINEAR_MIPMAP_LINEAR=4003,i.NEAREST_MIPMAP_NEAREST=4004,i.LINEAR_MIPMAP_NEAREST=4005,i.NEAREST_MIPMAP_LINEAR=4006,e.default=i},"725b":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8d98")),a=i(s("fe7f")),n=i(s("3b73"));class h{constructor(){this.width=4,this.height=4,this.x=0,this.y=0,this.uvs=new Float32Array(8)}toString(){return"FontTexCharGrid(x="+this.x+",y="+this.y+",width="+this.width+",height="+this.height+")"}}class l{constructor(){this.m_texWidth=512,this.m_texHeight=256,this.m_gridMp=new Map,this.layoutDataStr="",this.m_minX=0,this.m_minY=0,this.m_maxX=0,this.m_maxY=0}initialize(t,e){this.m_texWidth=t,this.m_texHeight=e}addCharsByRawData(t,e){let s=0,i=0,r=e.split(","),a=r.length/4;for(;s<a;++s)i=4*s,this.addUV8RawDataFromChar(t.charAt(s),parseInt(r[i]),parseInt(r[i+1]),parseInt(r[i+2]),parseInt(r[i+3]))}addUV8RawDataFromChar(t,e,s,i,r){if(null==this.m_gridMp.get(t)){let a=new h,n=a.uvs,l=this.m_texWidth,o=this.m_texHeight;this.m_minX=e/l,this.m_minY=s/o,this.m_maxX=(e+i)/l,this.m_maxY=(s+r)/o,n[0]=this.m_minX,n[1]=this.m_maxY,n[2]=this.m_maxX,n[3]=this.m_maxY,n[4]=this.m_maxX,n[5]=this.m_minY,n[6]=this.m_minX,n[7]=this.m_minY,a.x=e,a.y=s,a.width=i,a.height=r,this.m_gridMp.set(t,a)}}getGridByChar(t){return this.m_gridMp.get(t)}getUV8FromChar(t,e,s=0){let i=this.m_gridMp.get(t);null==i&&(i=this.m_gridMp.get("?")),e.set(i.uvs,s)}getVtxFromChar(t,e,s=0){let i=this.m_gridMp.get(t);null==i&&(i=this.m_gridMp.get("?"));let r=[0,0,0,i.width,0,0,i.width,i.height,0,0,i.height,0];e.set(r,s)}getUV8AndVtxFromChar(t,e,s,i=0,r=0){let a=this.m_gridMp.get(t);null==a&&(a=this.m_gridMp.get("?")),e.set(a.uvs,i);let n=[0,0,0,a.width,0,0,a.width,a.height,0,0,a.height,0];s.set(n,r)}getUV8AndSizeFromChar(t,e,s,i=0){let r=this.m_gridMp.get(t);null==r&&(r=this.m_gridMp.get("?")),e.set(r.uvs,i),s[0]=r.width,s[1]=r.height}getUV8AndOffsetXYVtxFromChar(t,e,s,i=0,r=0,a=0,n=0){let h=this.m_gridMp.get(t);null==h&&(h=this.m_gridMp.get("?")),e.set(h.uvs,a);let l=[i,r,0,i+h.width,r,0,i+h.width,r+h.height,0,i,r+h.height,0];s.set(l,n)}}e.FontTexCharTable=l;class o{constructor(){this.m_currPosX=0,this.m_currPosY=0,this.m_texText="",this.m_fontCharTable=null,this.pixMinPos={x:0,y:0},this.pixMaxPos={x:0,y:0},this.canvas=null,this.ctx2d=null,this.m_py=0,this.charTexWidth=0,this.px=0,this.py=0,this.ph=0,this.linedis=2,this.charHDis=1,this.tx=0,this.char="",this.meao=null}setFontCharTable(t){this.m_fontCharTable=t}textFilte(t){let e=t.length,s="",i="";for(let r=0;r<e;++r)i=t.charAt(r),this.m_texText.indexOf(i)<0&&s.indexOf(i)<0&&(s+=i);return s}crateTextUVData(t,e,s,i=18){this.m_texText+=t;let r=this.ctx2d;this.m_currPosY<2&&(this.m_currPosY=i),this.charTexWidth=0,r.textAlign="left",r.fillStyle="white",r.font=i+"px Arial";let a=t.length;this.pixMinPos.x=2e4,this.pixMinPos.y=2e4,this.pixMaxPos.x=-2e4,this.pixMaxPos.y=-2e4,this.ph=i+8;for(let n=0;n<a;n++)this.char=t.charAt(n),this.meao=r.measureText(this.char),this.charTexWidth=Math.floor(this.meao.width)+1,this.tx=this.m_currPosX+this.charTexWidth,this.tx<e?(r.fillText(this.char,this.m_currPosX,this.m_currPosY),this.m_py=this.m_currPosY-i,this.pixMinPos.x>this.m_currPosX&&(this.pixMinPos.x=this.m_currPosX),this.pixMinPos.y>this.m_py&&(this.pixMinPos.y=this.m_py),this.px=this.m_currPosX+this.charTexWidth,this.py=this.m_py+this.ph,this.pixMaxPos.x<this.px&&(this.pixMaxPos.x=this.px),this.pixMaxPos.y<this.py&&(this.pixMaxPos.y=this.py),this.m_fontCharTable.addUV8RawDataFromChar(this.char,this.m_currPosX,this.m_py+1,this.charTexWidth,this.ph),this.m_currPosX=this.tx+this.charHDis):(this.m_currPosX=0,this.m_currPosY+=this.ph+this.linedis,r.fillText(this.char,this.m_currPosX,this.m_currPosY),this.m_py=this.m_currPosY-i,this.pixMinPos.x>this.m_currPosX&&(this.pixMinPos.x=this.m_currPosX),this.pixMinPos.y>this.m_py&&(this.pixMinPos.y=this.m_py),this.px=this.m_currPosX+this.charTexWidth,this.py=this.m_py+this.ph,this.pixMaxPos.x<this.px&&(this.pixMaxPos.x=this.px),this.pixMaxPos.y<this.py&&(this.pixMaxPos.y=this.py),this.m_fontCharTable.addUV8RawDataFromChar(this.char,this.m_currPosX,this.m_py+1,this.charTexWidth,this.ph),this.m_currPosX+=this.charTexWidth)}}e.FontTexDataBuilder=o;class _{constructor(){this.m_texWidth=512,this.m_texHeight=256,this.m_canvas=null,this.m_ctx2D=null,this.m_texBase=null,this.m_fontSize=18,this.m_fontCharTable=new l,this.m_fontTexDataBuilder=new o,this.m_renderProxy=null,this.mobileEnabled=!0,this.m_preSW=0,this.m_preSH=0,this.m_areaBytes=null}setRenderProxy(t){null!=t&&(this.m_renderProxy=t,null!=this.m_texBase&&this.m_texBase.__$setRenderProxy(t))}isEnabled(){return null!=this.m_canvas}getFontSize(){return this.m_fontSize}initialize(t,e=10,s=512,i=512,h=!1,l=!1){if(this.mobileEnabled&&n.default.IsMobileWeb()&&(e*=2,s=i*=2),null==this.m_canvas){s<32&&(s=32),i<32&&(i=32),this.m_texWidth=s,this.m_texHeight=i,e<10&&(e=10),this.m_fontSize=e;var o=null;try{void 0!=document&&(o=document)}catch(_){}this.m_canvas=o.getElementById(t),null==this.m_canvas&&(this.m_canvas=document.createElement("canvas"),this.m_canvas.style.width="128px",this.m_canvas.style.height="128px",this.m_canvas.style.display="bolck",this.m_canvas.style.overflow="hidden",this.m_canvas.style.left="0px",this.m_canvas.style.top="0px",this.m_canvas.style.position="absolute",this.m_canvas.style.backgroundColor="transparent",this.m_canvas.style.pointerEvents="none"),this.m_canvas.width=s,this.m_canvas.height=i,h?(document.body.appendChild(this.m_canvas),this.m_canvas.style.visibility="visible"):this.m_canvas.style.visibility="hidden",this.m_ctx2D=this.m_canvas.getContext("2d"),this.m_fontTexDataBuilder.canvas=this.m_canvas,this.m_fontTexDataBuilder.ctx2d=this.m_ctx2D,this.m_fontTexDataBuilder.setFontCharTable(this.m_fontCharTable),this.m_fontCharTable.initialize(this.m_texWidth,this.m_texHeight),this.m_texBase=new a.default(this.m_texWidth,this.m_texHeight),this.m_texBase.__$setRenderProxy(this.m_renderProxy),this.m_texBase.toAlphaFormat(),this.m_texBase.mipmapEnabled=l,this.m_texBase.minFilter=r.default.LINEAR,this.m_texBase.magFilter=r.default.NEAREST,this.createInitTexAndChars()}}setStyleSize(t,e){null!=this.m_canvas&&(this.m_preSW==t&&this.m_preSH==e||(this.m_preSW=t,this.m_preSH=e,this.m_canvas.style.width=t+"px",this.m_canvas.style.height=e+"px"))}setCanvasVisible(t){this.m_canvas.style.visibility=t?"visible":"hidden"}getUV8FromChar(t,e,s=0){this.m_fontCharTable.getUV8FromChar(t,e,s)}getCharTable(){return this.m_fontCharTable}createCharsTexFromStr(t){if(t=this.m_fontTexDataBuilder.textFilte(t),t.length<1)return;let e=t;this.m_fontTexDataBuilder.crateTextUVData(e,this.m_texWidth,this.m_texHeight,this.m_fontSize);let s=0,i=0,r=0,a=0,n=0,h=this.m_fontTexDataBuilder.pixMaxPos.x-this.m_fontTexDataBuilder.pixMinPos.x,l=this.m_fontTexDataBuilder.pixMaxPos.y-this.m_fontTexDataBuilder.pixMinPos.y,o=this.m_ctx2D.getImageData(this.m_fontTexDataBuilder.pixMinPos.x,this.m_fontTexDataBuilder.pixMinPos.y,h,l),_=o.data,m=new Uint8Array(h*l),u=this.m_fontTexDataBuilder.pixMinPos.x,d=this.m_fontTexDataBuilder.pixMinPos.y;for(i=0;i<l;++i)for(r=0;r<h;++r)n=(i+d)*this.m_texWidth+(u+r),s=4*(i*h+r),this.m_areaBytes[n]=_[s+3],m[a]=this.m_areaBytes[n],a++;this.m_texBase.setPartDataFromeBytes(m,this.m_fontTexDataBuilder.pixMinPos.x,this.m_fontTexDataBuilder.pixMinPos.y,h,l),this.m_texBase.updateDataToGpu()}createInitTexAndChars(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890~`!@#$%^&*()_+-={}[]:\";\\|'<>,.?/\n ",e=t;this.m_fontTexDataBuilder.crateTextUVData(e,this.m_texWidth,this.m_texHeight,this.m_fontSize);let s=this.m_ctx2D.getImageData(0,0,this.m_texWidth,this.m_texHeight),i=s.data,r=0,a=0,n=0;this.m_areaBytes=new Uint8Array(this.m_texWidth*this.m_texHeight);let h=0;for(r=0;r<this.m_texHeight;++r)for(a=0;a<this.m_texWidth;++a)n=4*(r*this.m_texWidth+a),this.m_areaBytes[h]=i[n+3],h++;this.m_texBase.setDataFromBytes(this.m_areaBytes,0,this.m_texWidth,this.m_texHeight)}getTextureAt(t=0){return this.m_texBase}static GetInstance(){return null!=_.s_ins||(_.s_ins=new _),_.s_ins}}_.s_ins=null,e.default=_},7279:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("d53d"));class n extends a.default{constructor(t){super(),this.m_slot=null,this.m_slotFlags=null,this.m_slotDatas=null,this.slotId=0,this.slotIndex=0,this.uniformsTotal=0,this.locationIndexList=null,this.locations=null,this.rst=0,this.always=!1,this.m_slot=t,this.m_slotFlags=this.m_slot.flagList,this.m_slotDatas=this.m_slot.dataList}applyData(){}clone(){let t=new n(this.m_slot);return t.types=this.types.slice(0),t.uniformNameList=this.uniformNameList.slice(0),t.dataSizeList=this.dataSizeList.slice(0),t.slotIndex=this.slotIndex,t.uniformsTotal=this.uniformsTotal,t.slotId=this.slotId,t.always=this.always,t.rst=this.rst,t}copyDataFromProbe(t){this.types=t.uniformTypes.slice(0),this.dataSizeList=t.dataSizeList.slice(0),this.slotIndex=t.getSlotBeginIndex(),this.uniformsTotal=t.uniformsTotal,this.slotId=t.getRCUid()}copyDataFromProbeAt(t,e){null==this.types&&(this.types=[],this.dataSizeList=[]),this.slotIndex=e.getSlotBeginIndex()+t,this.uniformsTotal=1,this.slotId=e.getRCUid(),this.types[0]=e.uniformTypes[t],this.dataSizeList[0]=e.dataSizeList[t]}use(t){if(this.always||this.rst!=this.m_slotFlags[this.slotIndex]){this.rst=this.m_slotFlags[this.slotIndex];let e=0,s=this.m_slotDatas;if(r.default.IsWebGL1())for(;e<this.uniformsTotal;++e)t.useUniformV1(this.locations[e],this.types[e],s[this.slotIndex+e],this.dataSizeList[e]);else for(;e<this.uniformsTotal;++e)t.useUniformV2(this.locations[e],this.types[e],s[this.slotIndex+e],this.dataSizeList[e],0)}}destroy(){this.types=null,this.dataSizeList=null,this.slotIndex=-1,this.uniformsTotal=0,this.m_slot=null,this.m_slotFlags=null,this.m_slotDatas=null}}e.default=n},"73f9":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("0795"),a=s("aeff"),n=s("7dbf"),h=i(s("3bda"));class l{constructor(t,e,s,i){this.m_parseTask=null,this.m_moduleUrl=s.url,this.m_unitPool=t,this.m_threadSchedule=e,this.m_receiverSchedule=i}addUrlToTask(t){if(!this.m_unitPool.hasUnitByUrl(t)){if(null==this.m_parseTask){let t=new n.CTMParseTask(this.m_moduleUrl);this.m_threadSchedule.bindTask(t),t.setListener(this),this.m_parseTask=t}(new r.FileLoader).load(t,(t,e)=>{h.default.ShowLogOnce("CTM..."),this.m_parseTask.addBinaryData(new Uint8Array(t),e)},(t,e)=>{let s=Math.round(100*t.loaded/t.total);h.default.ShowLogOnce("ctm file loading "+s+"%")},(t,e)=>{})}}ctmParseFinish(t,e){if(this.m_unitPool.hasUnitByUrl(e)){let s=this.m_unitPool.getUnitByUrl(e);null!=s&&(s.lossTime=Date.now()-s.lossTime,s.data.models=[t],a.DataUnitLock.lockStatus=209,s.toCpuPhase(),s.immediate&&this.m_receiverSchedule.testUnit(s))}}destroy(){null!=this.m_parseTask&&(this.m_parseTask.destroy(),this.m_parseTask=null),this.m_unitPool=null,this.m_threadSchedule=null,this.m_receiverSchedule=null}}e.CTMParserListerner=l},7499:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_dispBuilder=null,this.m_shader=null,this.m_texRes=null}setDispBuilder(t){null==this.m_dispBuilder&&(this.m_dispBuilder=t,this.m_shader=t.getRenderShader(),this.m_texRes=t.getTextureResource())}unlockMaterial(){this.m_shader.unlock(),this.m_texRes.unlocked=!0}lockMaterial(){this.m_shader.lock(),this.m_texRes.unlocked=!1}isUnlockMatrial(){return this.m_texRes.unlocked}unlockTexture(){this.m_shader.textureUnlock()}lockTexture(){this.m_shader.textureLock()}renderBegin(){this.m_shader.renderBegin(),this.m_texRes.renderBegin()}resetUniform(){this.m_shader.resetUniform()}useGlobalMaterial(t,e=!1){null!=t&&this.m_dispBuilder.updateGlobalMaterial(t,e)}updateMaterialUniform(t){this.m_shader.updateUniform(t.__$uniform)}}e.default=i},"74c3":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,s){this.m_resMap=new Map,this.m_freeMap=new Map,this.m_updateIds=[],this.m_vtxResTotal=0,this.m_attachTotal=0,this.m_delay=128,this.m_haveDeferredUpdate=!1,this.m_vtxUpdateTotal=16,this.m_rcuid=0,this.m_gl=null,this.m_vtxBuilder=null,this.unlocked=!0,this.m_rcuid=t,this.m_gl=e,this.m_vtxBuilder=s}setVtxUpdateTimesTotal(t){this.m_vtxUpdateTotal=t>4?t:4}createResByParams3(t,e,s,i){return!1}getRCUid(){return this.m_rcuid}getRC(){return this.m_gl}hasResUid(t){return this.m_resMap.has(t)}bindToGpu(t){}getGpuBuffer(t){return null}renderBegin(){this.m_vtxBuilder.renderBegin()}getVertexResTotal(){return this.m_vtxResTotal}updateDataToGpu(t,e){e?(this.m_updateIds.push(t),this.m_haveDeferredUpdate=!0):this.m_resMap.has(t)&&this.m_resMap.get(t).updateToGpu(this.m_vtxBuilder)}addVertexRes(t){this.m_resMap.has(t.resUid)||(t.waitDelTimes=0,this.m_resMap.set(t.resUid,t),this.m_vtxResTotal++)}getVertexRes(t){return this.m_resMap.get(t)}destroyRes(t){this.m_resMap.has(t)&&this.m_resMap.get(t).destroy(this.m_vtxBuilder)}__$attachRes(t){if(this.m_resMap.has(t)){this.m_attachTotal++;let e=this.m_resMap.get(t);e.getAttachCount()<1&&this.m_freeMap.has(t)&&this.m_freeMap.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.m_resMap.has(t)&&this.m_resMap.has(t)){let e=this.m_resMap.get(t);e.getAttachCount()>0&&(this.m_attachTotal--,e.__$detachThis(),e.getAttachCount()<1&&this.m_freeMap.set(t,e))}}getVROByResUid(t,e,s){let i=this.m_resMap.get(t);return null!=i?i.createVRO(this.m_vtxBuilder,e,s):null}update(){if(this.m_haveDeferredUpdate){let t=this.m_updateIds.length;if(t>0){let e;t>this.m_vtxUpdateTotal&&(t=this.m_vtxUpdateTotal);for(let s=0;s<t;++s)e=this.m_updateIds.shift(),this.m_resMap.has(e)&&this.m_resMap.get(e).updateToGpu(this.m_vtxBuilder)}else this.m_haveDeferredUpdate=!1}if(this.m_delay--,this.m_delay<1){this.m_delay=128;for(const[t,e]of this.m_freeMap)e.waitDelTimes++,e.getAttachCount()<1?e.waitDelTimes>5&&(this.m_resMap.delete(e.resUid),this.m_freeMap.delete(e.resUid),e.destroy(this.m_vtxBuilder),this.m_vtxResTotal--):this.m_freeMap.delete(e.resUid)}}}e.ROVertexResource=i,e.default=i},"74ee":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("698b"),r=s("7a08");var a;e.DataFormat=r.DataFormat,function(t){t[t["Geometry"]=0]="Geometry",t[t["Texture"]=1]="Texture",t[t["Undefined"]=2]="Undefined"}(a||(a={})),e.DataClass=a;class n{}n.lockStatus=0,e.DataUnitLock=n;class h{constructor(){if(this.m_dataPhaseFlag=i.DataPhaseFlag.PHASE_NONE,this.immediate=!1,this.lossTime=0,207!==n.lockStatus)throw Error("illegal operation !!!");this.m_uuid=h.s_uuid++,n.lockStatus=0}getUUID(){return this.m_uuid}clone(){return null}test(){}isNetPhase(){return i.DataPhaseFlag.isCpuPhase(this.m_dataPhaseFlag)}isCpuPhase(){return i.DataPhaseFlag.isCpuPhase(this.m_dataPhaseFlag)}isGpuPhase(){return i.DataPhaseFlag.isGpuPhase(this.m_dataPhaseFlag)}clearAllPhase(){this.m_dataPhaseFlag=i.DataPhaseFlag.clearAllPhase(this.m_dataPhaseFlag)}toNetPhase(){if(208!==n.lockStatus)throw Error("illegal operation !!!");this.m_dataPhaseFlag=i.DataPhaseFlag.addNetPhase(this.m_dataPhaseFlag)}toCpuPhase(){if(209!==n.lockStatus)throw Error("illegal operation !!!");this.m_dataPhaseFlag=i.DataPhaseFlag.addCpuPhase(this.m_dataPhaseFlag)}toGpuPhase(){if(210!==n.lockStatus)throw Error("illegal operation !!!");this.m_dataPhaseFlag=i.DataPhaseFlag.addGpuPhase(this.m_dataPhaseFlag)}}h.s_uuid=0,e.DataUnit=h},7566:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_dataList=[],this.m_waitingDataList=[],this.m_dataTotal=0,this.m_dataHaveTotal=0,this.m_startupFlag=0}sendDataTo(t){if(this.m_dataTotal>0){let e=null,s=this.m_waitingDataList.length;if(s>0&&(e=this.m_waitingDataList[0],t.sendDataTo(e),1==e.sendStatus))return this.m_dataTotal--,s--,this.m_waitingDataList.shift(),!0;if(s=this.m_dataTotal-s,s>0){if(e=this.m_dataList.shift(),t.sendDataTo(e),1==e.sendStatus)return this.m_dataTotal--,!0;this.m_waitingDataList.push(e)}}return!1}addData(t){t.sendStatus<0&&(t.sendStatus=0,this.m_dataTotal++,this.m_dataHaveTotal++,this.m_startupFlag=1,this.m_dataList.push(t))}getDataTotal(){return this.m_dataTotal}isEnabled(){return this.m_dataTotal*this.m_startupFlag>0}isStartup(){return this.m_startupFlag>0}}e.ThrDataPool=i},7577:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("402a")),n=i(s("519e")),h=i(s("3bda")),l=s("dea9"),o=i(s("29ef")),_=s("fbd5");class m{constructor(){this.m_delay=2,this.m_vtxTotal=0,this.m_partsTotal=0,this.m_wait_entities=[],this.m_cospace=null,this.m_rscene=null,this.m_scaleV=new r.default(1,1,1),this.m_time=0,this.m_modelsTotal=0,this.m_showTotal=0,this.m_waitPartsTotal=-1,this.m_entities=[],this.m_transforms=[],this.m_transes=[],this.m_entityLayout=new _.EntityLayout,this.m_frameBox=null,this.m_lossTime=0,this.m_verticesTotal=0,this.m_errModelTotal=0,this.m_rotV=new r.default}initialize(t,e){null==this.m_rscene&&(this.m_rscene=t,this.m_cospace=e)}mouseDown(t){}load(t){h.default.ShowLogOnce("..."),this.m_time=Date.now()}showInfo(t){h.default.ShowLogOnce(t)}fitToCenter(){this.m_entityLayout.fixToPosition(this.m_transes,this.m_transforms,r.default.ZERO,300)}normalCorrectionTest(t){let e=15,s=t.vertices,i=t.indices,a=t.normals,n=i[e],h=i[e+1],l=i[e+2],o=new r.default,_=new r.default,m=new r.default;e=3*n,o.setXYZ(s[e],s[e+1],s[e+2]),e=3*h,_.setXYZ(s[e],s[e+1],s[e+2]),e=3*l,m.setXYZ(s[e],s[e+1],s[e+2]),o.subtractBy(_),m.subtractBy(_),m.scaleBy(-1),o.normalize(),m.normalize(),r.default.Cross(m,o,_);let u=new r.default,d=new r.default,c=new r.default;e=3*n,u.setXYZ(a[e],a[e+1],a[e+2]),e=3*h,d.setXYZ(a[e],a[e+1],a[e+2]),e=3*l,c.setXYZ(a[e],a[e+1],a[e+2]),u.normalize(),d.normalize(),c.normalize(),u.addBy(d),u.addBy(c),u.normalize();let f=o.dot(u)>0;return f}initEntity(t,e=null,s=0){if(null!=t){if(this.m_partsTotal++,null==t.vertices||t.vertices.length<3)return void this.m_errModelTotal++;this.m_verticesTotal+=t.vertices.length/3,this.m_lossTime=Date.now()-this.m_time,this.m_vtxTotal+=t.vertices.length;let s=new l.NormalViewerMaterial;s.initializeByCodeBuf();let i=new n.default;i.vbWholeDataEnabled=!1,i.setVS(t.vertices),i.setUVS(t.uvsList[0]),i.setNVS(t.normals),i.setIVS(t.indices),i.setVtxBufRenderData(s),i.initialize();let r=new a.default;r.setRenderState(o.default.NONE_CULLFACE_NORMAL_STATE),r.setMesh(i),r.setMaterial(s),r.setVisible(!1),this.m_transforms.push(e),this.m_transes.push(r),this.fitToCenter(),this.m_wait_entities.push(r),this.m_entities.push(r),this.m_rscene.addEntity(r),r.update()}}isFinish(){return this.m_modelsTotal>0&&this.m_showTotal+this.m_errModelTotal==this.m_modelsTotal}clear(){if(this.isFinish()){if(null!=this.m_frameBox&&(this.m_rscene.removeEntity(this.m_frameBox),this.m_frameBox=null),this.m_verticesTotal=0,this.m_transforms=[],this.m_transes=[],null!=this.m_entities){let t=this.m_entities;for(let e=0;e<t.length;++e)t[e].setVisible(!1);this.m_entities=null}this.m_rscene=null,this.m_cospace=null}}run(){if(!this.isFinish())if(this.m_delay<1){if(this.m_wait_entities.length>0){let t=this.m_wait_entities[this.m_wait_entities.length-1],e=Math.floor(t.getMesh().vtxTotal/2e4);e=Math.min(e,10),this.m_delay=e+1,t=this.m_wait_entities.pop(),t.setVisible(!0),this.m_entity=t,this.m_showTotal++;let s="initialize entity loss time: "+this.m_lossTime+"ms";s+="</br>: "+this.m_verticesTotal+"",s+="</br>: "+this.m_showTotal+"/"+this.m_modelsTotal+"",this.isFinish()&&(s+="</br>",this.m_errModelTotal>0&&(s+="</br>: "+this.m_errModelTotal+"")),h.default.ShowLogOnce(s)}}else this.m_delay>0&&this.m_delay--}}e.SceneNode=m},"765c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("1710"));class a{constructor(){this.m_uid=0,this.m_mainStage=null,this.m_currStage=null,this.m_raySelector=null,this.m_unlockBoo=!0,this.m_mouseEvt=new r.default,this.m_mouseOverEvt=new r.default,this.m_mouseOutEvt=new r.default,this.m_evtTypes=new Float32Array(64),this.m_evtXList=new Float32Array(64),this.m_evtYList=new Float32Array(64),this.m_evtWheelDeltaYs=new Float32Array(64),this.m_evtTotal=0,this.m_evtEntity=null,this.m_evtContainer=null,this.m_evtFlowPhase=-1,this.m_uid=a.s_uid++}initialize(t,e){null==this.m_mainStage&&(this.m_mainStage=t,this.m_currStage=e,t.addEventListener(r.default.MOUSE_DOWN,this,this.mouseDownListener,!0,!1),t.addEventListener(r.default.MOUSE_UP,this,this.mouseUpListener,!0,!1),t.addEventListener(r.default.MOUSE_CLICK,this,this.mouseClickListener,!0,!1),t.addEventListener(r.default.MOUSE_MOVE,this,this.mouseMoveListener,!0,!1),t.addEventListener(r.default.MOUSE_WHEEL,this,this.mouseWheeelListener,!0,!1))}setRaySelector(t){this.m_raySelector=t}mouseWheeelListener(t){null!=this.m_currStage&&(this.m_currStage.mouseX=this.m_mainStage.mouseX,this.m_currStage.mouseY=this.m_mainStage.mouseY),this.m_evtTypes[this.m_evtTotal]=t.type,this.m_evtXList[this.m_evtTotal]=t.mouseX,this.m_evtYList[this.m_evtTotal]=t.mouseY,this.m_evtWheelDeltaYs[this.m_evtTotal]=t.wheelDeltaY,this.m_mouseEvt.type=t.type,this.m_evtTotal++}mouseMoveListener(t){null!=this.m_currStage&&(this.m_currStage.mouseX=this.m_mainStage.mouseX,this.m_currStage.mouseY=this.m_mainStage.mouseY),this.m_evtTypes[this.m_evtTotal]=t.type,this.m_evtXList[this.m_evtTotal]=t.mouseX,this.m_evtYList[this.m_evtTotal]=t.mouseY,this.m_evtWheelDeltaYs[this.m_evtTotal]=0,this.m_mouseEvt.type=t.type,this.m_evtTotal++}mouseDownListener(t){null!=this.m_currStage&&(this.m_currStage.mouseX=this.m_mainStage.mouseX,this.m_currStage.mouseY=this.m_mainStage.mouseY),a.s_unlockMouseEvt&&(this.m_evtTypes[this.m_evtTotal]=t.type,this.m_evtXList[this.m_evtTotal]=t.mouseX,this.m_evtYList[this.m_evtTotal]=t.mouseY,this.m_evtWheelDeltaYs[this.m_evtTotal]=0,this.m_mouseEvt.type=t.type,this.m_evtTotal++)}mouseUpListener(t){null!=this.m_currStage&&(this.m_currStage.mouseX=this.m_mainStage.mouseX,this.m_currStage.mouseY=this.m_mainStage.mouseY),a.s_unlockMouseEvt&&(this.m_evtTypes[this.m_evtTotal]=t.type,this.m_evtXList[this.m_evtTotal]=t.mouseX,this.m_evtYList[this.m_evtTotal]=t.mouseY,this.m_evtWheelDeltaYs[this.m_evtTotal]=0,this.m_mouseEvt.type=t.type,this.m_evtTotal++)}mouseClickListener(t){null!=this.m_currStage&&(this.m_currStage.mouseX=this.m_mainStage.mouseX,this.m_currStage.mouseY=this.m_mainStage.mouseY),a.s_unlockMouseEvt&&(this.m_evtTypes[this.m_evtTotal]=t.type,this.m_evtXList[this.m_evtTotal]=t.mouseX,this.m_evtYList[this.m_evtTotal]=t.mouseY,this.m_evtWheelDeltaYs[this.m_evtTotal]=0,this.m_mouseEvt.type=t.type,this.m_evtTotal++)}mouseOutEventTarget(){if(null!=this.m_currStage&&(this.m_currStage.mouseX=this.m_mainStage.mouseX,this.m_currStage.mouseY=this.m_mainStage.mouseY),null!=this.m_evtEntity){let t=this.m_evtEntity.getEvtDispatcher(r.default.EventClassType);if(null!=t)return this.m_mouseOutEvt.phase=this.m_evtFlowPhase,this.m_mouseOutEvt.type=r.default.MOUSE_OUT,this.m_mouseOutEvt.mouseX=this.m_mouseEvt.mouseX,this.m_mouseOutEvt.mouseY=this.m_mouseEvt.mouseY,this.m_mouseOutEvt.target=this.m_evtEntity,this.m_raySelector.getRay(this.m_mouseOutEvt.raypv,this.m_mouseOutEvt.raytv),this.m_evtEntity=null,t.dispatchEvt(this.m_mouseOutEvt);this.m_evtEntity=null}return 0}run(t,e){let s=-1;if(this.m_unlockBoo){this.m_evtFlowPhase=t;let i=0;s=this.m_evtTotal>0?0:-1;let n,h,l,o=null;if(s>-1){if(this.m_currStage!=this.m_mainStage&&null!=this.m_currStage){for(a.s_unlockMouseEvt=!1,i=0;i<this.m_evtTotal;i++)switch(this.m_evtTypes[i]){case r.default.MOUSE_DOWN:this.m_currStage.mouseDown(1);break;case r.default.MOUSE_UP:this.m_currStage.mouseUp(1);break;case r.default.MOUSE_MOVE:this.m_currStage.mouseMove();break;default:break}a.s_unlockMouseEvt=!0}if(n=e<1?this.m_raySelector.getSelectedNode():null,null!=n){h=n.lpv,l=n.wpv;let e=n.entity;o=e.getEvtDispatcher(r.default.EventClassType);let i=e.__$getParent(),a=null!=i&&i.mouseEnabled;a||(s+=this.mouseOutContainer(t,null,null,null),this.m_evtContainer=null);let _=this.m_evtEntity;for(let m=0;m<this.m_evtTotal;m++)this.m_mouseEvt.type=this.m_evtTypes[m],this.m_mouseEvt.mouseX=this.m_evtXList[m],this.m_mouseEvt.mouseY=this.m_evtYList[m],this.m_mouseEvt.wheelDeltaY=this.m_evtWheelDeltaYs[m],this.m_mouseEvt.type>0&&null!=n&&null!=o&&(this.m_mouseEvt.target=e,this.m_mouseEvt.currentTarget=e,this.m_mouseEvt.phase=t,this.m_mouseEvt.lpos.copyFrom(h),this.m_mouseEvt.wpos.copyFrom(l),this.m_raySelector.getRay(this.m_mouseEvt.raypv,this.m_mouseEvt.raytv),s+=this.mouseOutEntity(t,e,h,l),this.m_evtEntity!=e&&(this.m_mouseOverEvt.phase=t,this.m_mouseOverEvt.type=r.default.MOUSE_OVER,this.m_mouseOverEvt.mouseX=this.m_mouseEvt.mouseX,this.m_mouseOverEvt.mouseY=this.m_mouseEvt.mouseY,this.m_mouseOverEvt.target=e,this.m_mouseOverEvt.currentTarget=e,this.m_mouseOverEvt.lpos.copyFrom(h),this.m_mouseOverEvt.wpos.copyFrom(l),this.m_raySelector.getRay(this.m_mouseOverEvt.raypv,this.m_mouseOverEvt.raytv),s+=o.dispatchEvt(this.m_mouseOverEvt)),s+=o.dispatchEvt(this.m_mouseEvt),this.m_evtEntity=e);if(a){null!=_&&null==_.__$getParent()&&(this.m_evtEntity=_,s+=this.mouseOutEntity(t,null,null,null),this.m_evtEntity=null);for(let a=0;a<this.m_evtTotal;a++)this.m_mouseEvt.type=this.m_evtTypes[a],this.m_mouseEvt.mouseX=this.m_evtXList[a],this.m_mouseEvt.mouseY=this.m_evtYList[a],this.m_mouseEvt.wheelDeltaY=this.m_evtWheelDeltaYs[a],this.m_mouseEvt.type>0&&null!=n&&(this.m_mouseEvt.target=i,this.m_mouseEvt.currentTarget=e,this.m_mouseEvt.phase=t,this.m_mouseEvt.lpos.copyFrom(h),this.m_mouseEvt.wpos.copyFrom(l),this.m_raySelector.getRay(this.m_mouseEvt.raypv,this.m_mouseEvt.raytv),s+=this.mouseOutContainer(t,i,h,l),this.m_evtContainer!=i&&(this.m_mouseOverEvt.phase=t,this.m_mouseOverEvt.type=r.default.MOUSE_OVER,this.m_mouseOverEvt.mouseX=this.m_mouseEvt.mouseX,this.m_mouseOverEvt.mouseY=this.m_mouseEvt.mouseY,this.m_mouseOverEvt.target=i,this.m_mouseOverEvt.currentTarget=e,this.m_mouseOverEvt.lpos.copyFrom(h),this.m_mouseOverEvt.wpos.copyFrom(l),this.m_raySelector.getRay(this.m_mouseOverEvt.raypv,this.m_mouseOverEvt.raytv),s+=i.dispatchEvt(this.m_mouseOverEvt)),s+=i.dispatchEvt(this.m_mouseEvt),this.m_evtContainer=i)}}else if(this.mouseOutEntity(t,null,null,null),this.mouseOutContainer(t,null,null,null),this.m_evtEntity=null,this.m_evtContainer=null,s+=this.mouseOutEventTarget(),null!=this.m_currStage)for(i=0;i<this.m_evtTotal;i++)switch(this.m_evtTypes[i]){case r.default.MOUSE_DOWN:this.m_currStage.mouseBgDown();break;case r.default.MOUSE_UP:this.m_currStage.mouseBgUp();break;case r.default.MOUSE_CLICK:this.m_currStage.mouseBgClick();break;default:break}if(null!=this.m_currStage){for(a.s_unlockMouseEvt=!1,i=0;i<this.m_evtTotal;i++)switch(this.m_evtTypes[i]){case r.default.MOUSE_DOWN:this.m_currStage.mouseDown(2);break;case r.default.MOUSE_UP:this.m_currStage.mouseUp(2);break;default:break}a.s_unlockMouseEvt=!0}}0==s&&null!=o&&(s=o.passTestPhase(t))}return s>0?1:0}mouseOutEntity(t,e,s,i){if(null!=this.m_evtEntity&&this.m_evtEntity!=e){let e=this.m_evtEntity.getEvtDispatcher(r.default.EventClassType);if(null!=e)return this.m_mouseOutEvt.phase=t,this.m_mouseOutEvt.type=r.default.MOUSE_OUT,this.m_mouseOutEvt.mouseX=this.m_mouseEvt.mouseX,this.m_mouseOutEvt.mouseY=this.m_mouseEvt.mouseY,this.m_mouseOutEvt.target=this.m_evtEntity,this.m_mouseOverEvt.currentTarget=this.m_evtEntity,null!=s&&this.m_mouseOutEvt.lpos.copyFrom(s),null!=i&&this.m_mouseOutEvt.wpos.copyFrom(i),this.m_raySelector.getRay(this.m_mouseOutEvt.raypv,this.m_mouseOutEvt.raytv),e.dispatchEvt(this.m_mouseOutEvt)}return 0}mouseOutContainer(t,e,s,i){return null!=this.m_evtContainer&&this.m_evtContainer!=e?(this.m_mouseOutEvt.phase=t,this.m_mouseOutEvt.type=r.default.MOUSE_OUT,this.m_mouseOutEvt.mouseX=this.m_mouseEvt.mouseX,this.m_mouseOutEvt.mouseY=this.m_mouseEvt.mouseY,this.m_mouseOutEvt.target=this.m_evtContainer,this.m_mouseOutEvt.currentTarget=null,null!=s&&this.m_mouseOutEvt.lpos.copyFrom(s),null!=i&&this.m_mouseOutEvt.wpos.copyFrom(i),this.m_raySelector.getRay(this.m_mouseOutEvt.raypv,this.m_mouseOutEvt.raytv),this.m_evtContainer.dispatchEvt(this.m_mouseOutEvt)):0}runEnd(){this.m_evtTotal=0,this.m_mouseEvt.type=0}reset(){this.m_evtTotal=0}getEvtType(){return this.m_mouseEvt.type}isSelected(){return null!=this.m_raySelector.getSelectedNode()}lock(){this.m_unlockBoo=!1}unlock(){this.m_unlockBoo=!0}isUnlock(){return this.m_unlockBoo}}a.s_unlockMouseEvt=!0,a.s_uid=0,e.default=a},7696:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("264c")),a=i(s("5f3c"));class n{constructor(t,e,s,i,r,a){this.m_rcuid=-1,this.m_rpIndex=-1,this.m_nodesLen=0,this.m_enabled=!0,this.m_blockList=[],this.m_blockListLen=0,this.m_blockFList=new Int8Array(n.s_max_shdTotal),this.m_blockFListLen=n.s_max_shdTotal,this.m_shader=null,this.m_rpoNodeBuilder=null,this.m_rpoUnitBuilder=null,this.m_vtxResource=null,this.m_fixBlock=null,this.m_sortBlock=null,this.m_sorter=null,this.m_batchEnabled=!0,this.m_fixedState=!0,this.m_sortEnabled=!1,this.m_version=0,this.uid=-1,this.m_shader=t,this.m_rpoNodeBuilder=e,this.m_rpoUnitBuilder=s,this.m_vtxResource=i,this.m_fixBlock=this.createBlock(),this.m_batchEnabled=r,this.m_fixedState=a;for(let n=0;n<this.m_blockFListLen;++n)this.m_blockFList[n]=-1}createBlock(){let t=new a.default(this.m_shader);return t.rpoNodeBuilder=this.m_rpoNodeBuilder,t.rpoUnitBuilder=this.m_rpoUnitBuilder,t.vtxResource=this.m_vtxResource,t}setRenderParam(t,e){this.m_blockListLen<1&&(this.m_batchEnabled=t,this.m_fixedState=e)}setRendererParam(t,e){this.m_rc=t,this.m_rcuid=t.getRCUid(),this.m_rpIndex=e}getUid(){return this.uid}getRCUid(){return this.m_rcuid}getRPIndex(){return this.m_rpIndex}hasSorter(){return null!=this.m_sorter}setSorter(t){this.m_sorter=t,null!=this.m_sortBlock&&this.m_sortBlock.setSorter(t)}setSortEnabled(t){this.m_nodesLen<1?this.m_sortEnabled=t:null!=this.m_sortBlock&&(this.m_sortBlock.sortEnabled=t)}getSortEnabled(){return this.m_sortEnabled}getUnitsTotal(){return this.m_nodesLen}addNodeToBlock(t){let e=null;if(t.shdUid>=n.s_max_shdTotal)throw Error("Shader uid >= "+n.s_max_shdTotal);this.m_blockFList[t.shdUid]<0?(e=this.createBlock(),e.batchEnabled=this.m_batchEnabled,e.fixedState=this.m_fixedState,e.batchEnabled?e.fixedState?e.runMode=2:e.runMode=1:e.runMode=0,e.shdUid=t.shdUid,e.index=this.m_blockListLen,e.procuid=this.m_rpIndex,this.m_blockList.push(e),this.m_blockFList[t.shdUid]=this.m_blockListLen,++this.m_blockListLen):e=this.m_blockList[this.m_blockFList[t.shdUid]],t.index=e.index,e.addNode(t)}rejoinRunitForTro(t){let e=this.m_rpoNodeBuilder.getNodeByUid(t.__$rpuid);null!=e&&(e.tro=t.tro,e.texMid=e.unit.texMid,this.m_blockList[e.index].rejoinNode(e))}rejoinRunitForVro(t){let e=this.m_rpoNodeBuilder.getNodeByUid(t.__$rpuid);null!=e&&(e.drawMode=t.drawMode,e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,e.vtxUid=t.vtxUid,e.vro=t.vro,this.m_blockList[e.index].rejoinNode(e),this.m_version++)}addDisp(t){if(null!=t&&null!=t.__$$runit&&t.__$$runit.getRPROUid()<0&&t.__$$runit.getRPROUid()!=this.uid){let e=this.m_rpoNodeBuilder.create();e.unit=this.m_rpoUnitBuilder.getNodeByUid(t.__$ruid),e.unit.shader=this.m_shader,e.unit.__$rprouid=this.uid,t.__$rpuid=e.uid,e.__$ruid=t.__$ruid,e.unit.__$rpuid=e.uid,e.updateData(),++this.m_nodesLen,this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.getUid(),e.uid),this.m_sortEnabled?(null!=this.m_sortBlock||(this.m_sortBlock=new r.default(this.m_shader),this.m_sortBlock.setSorter(this.m_sorter)),this.m_sortBlock.addNode(e)):this.addNodeToBlock(e),this.m_version++}}updateDispMateiral(t){if(null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),s=this.m_rpoNodeBuilder.getNodeByUid(e);s.shdUid=s.unit.shdUid,s.texMid=s.unit.texMid,s.tro=s.unit.tro;let i=this.m_blockList[s.index];i.removeNode(s),this.addNodeToBlock(s)}}removeDisp(t){if(null!=t&&null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),s=this.m_rpoNodeBuilder.getNodeByUid(e);if(null!=s){if(null==this.m_sortBlock){let t=this.m_blockList[s.index];t.removeNode(s)}else this.m_sortBlock.removeNode(s);this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.getUid(),-1),--this.m_nodesLen;let e=s.unit;this.m_rpoNodeBuilder.restore(s)&&this.m_rpoUnitBuilder.restore(e),this.m_vtxResource.__$detachRes(t.vbuf.getUid()),t.__$$runit=null,t.__$ruid=-1,this.m_version++}}}getStatus(){return this.m_version}removeDispUnit(t){if(null!=t&&t.__$ruid>-1){let e=t.__$$runit.getRPOUid(),s=this.m_rpoNodeBuilder.getNodeByUid(e);if(null!=s){if(null==this.m_sortBlock){let t=this.m_blockList[s.index];t.removeNode(s)}else this.m_sortBlock.removeNode(s);this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.m_rpIndex,-1),s.unit.__$rprouid=-1,--this.m_nodesLen,this.m_rpoNodeBuilder.restore(s)}}}update(){this.m_enabled&&this.m_nodesLen>0&&null!=this.m_sortBlock&&this.m_sortBlock.update()}run(){if(this.m_enabled&&this.m_nodesLen>0){let t=this.m_rc;if(null==this.m_sortBlock)if(this.m_shader.isUnLocked())for(let e=0;e<this.m_blockListLen;++e)this.m_blockList[e].run(t);else for(let e=0;e<this.m_blockListLen;++e)this.m_blockList[e].runLockMaterial(t);else this.m_shader.isUnLocked()?this.m_sortBlock.run(t):this.m_sortBlock.runLockMaterial(t)}}drawDisp(t,e=!1,s=!0){if(null!=t){let i=t.__$$runit;null!=i&&(this.m_shader.isUnLocked()?(s&&this.m_shader.resetUniform(),this.m_fixBlock.drawUnit(this.m_rc,i,t)):this.m_fixBlock.drawLockMaterialByUnit(this.m_rc,i,t,e,s))}}drawLockMaterialByDisp(t,e=!1,s=!0){if(null!=t){let i=t.__$$runit;null!=i&&this.m_fixBlock.drawLockMaterialByUnit(this.m_rc,i,t,e,s)}}reset(){this.m_sortEnabled=!1,this.m_nodesLen=0,this.uid=-1,this.m_rpIndex=-1,this.m_rcuid=-1,this.m_rpIndex=-1;let t=0;for(;t<this.m_blockListLen;++t)this.m_blockList[t].reset();this.m_blockListLen=0,this.m_blockList=[],this.m_rpoNodeBuilder=null,this.m_rpoUnitBuilder=null,this.m_vtxResource=null,this.m_rc=null,null!=this.m_sortBlock&&(this.m_sortBlock.clear(),this.m_sortBlock=null)}showInfo(){let t=0;for(;t<this.m_blockListLen;++t)this.m_blockList[t].showInfo()}destroy(){this.reset()}setEnabled(t){this.m_enabled=t}getEnabled(){return this.m_enabled}toString(){return"[RenderProcess(uid = "+this.m_rpIndex+")]"}}n.s_max_shdTotal=1024,e.default=n},"78e9":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("644c"));class a{constructor(){this.type=-1,this.typeName="",this.name="",this.isArray=!1,this.arrLength=0,this.isTex=!1,this.location=null}parseCode(t){const e=";";let s=t.indexOf(e);if(s<0)return!1;const i=" ";t=t.replace(/^\s*|\s*$/g,""),s>0&&(t=t.slice(0,s));let a=t.split(i);return this.typeName=a[a.length-2],this.name=a[a.length-1],s=this.name.indexOf("["),this.isArray=s>0,this.arrLength=0,this.isArray&&(this.arrLength=parseInt(this.name.slice(s+1,this.name.indexOf("]",s+1))),this.name=this.name.slice(0,s),this.typeName+="[]"),this.type=r.default.GetTypeByTypeNS(this.typeName),!(this.type<0)&&(this.isTex=this.type==r.default.SHADER_SAMPLER2D||this.type==r.default.SHADER_SAMPLERCUBE||this.type==r.default.SHADER_SAMPLER3D,!0)}}e.default=a},7918:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["Default"]=0]="Default",t[t["Depth"]=1]="Depth",t[t["Wrapper"]=2]="Wrapper",t[t["RTT"]=3]="RTT",t[t["Image"]=4]="Image",t[t["Float"]=5]="Float",t[t["Uint16"]=6]="Uint16",t[t["FloatCube"]=7]="FloatCube",t[t["Bytes"]=8]="Bytes",t[t["BytesCube"]=9]="BytesCube",t[t["ImageCube"]=10]="ImageCube",t[t["Texture3D"]=11]="Texture3D"}(i||(i={})),e.TextureProxyType=i},"7a04":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("f044"));class a{constructor(){this.m_uid=-1,this.m_total=0,this.layoutBit=0,this.m_fOffsetList=null,this.m_f32List=null,this.m_f32SizeList=null,this.m_f32ChangedList=null,this.m_f32Bufs=null,this.m_bufersTotal=0,this.m_uid=r.default.CreateNewID()}getUid(){return this.m_uid}getType(){return 1}getBuffersTotal(){return this.m_bufersTotal}getAttribsTotal(){return this.m_bufersTotal}getF32DataAt(t){return this.m_f32List[t]}setF32DataAt(t,e,s,i){this.m_bufersTotal=t<1?1:t+1,null==this.m_f32List&&(this.m_f32List=[null,null,null,null,null,null,null,null],this.m_f32ChangedList=[!1,!1,!1,!1,!1,!1,!1,!1],this.m_f32SizeList=[0,0,0,0,0,0,0,0]),this.m_f32List[t]=e,null!=this.m_f32Bufs&&null!=e&&(this.m_f32ChangedList[t]=!0),null!=i&&(this.m_fOffsetList=i),null!=e&&(this.m_f32SizeList[t]=e.length)}setData4fAt(t,e,s,i,r,a){t*=this.m_fOffsetList[e],this.m_f32List[e][t++]=s,this.m_f32List[e][t++]=i,this.m_f32List[e][t++]=r,this.m_f32List[e][t++]=a}setData3fAt(t,e,s,i,r){t*=this.m_fOffsetList[e],this.m_f32List[e][t++]=s,this.m_f32List[e][t++]=i,this.m_f32List[e][t++]=r}setData2fAt(t,e,s,i){t*=this.m_fOffsetList[e],this.m_f32List[e][t++]=s,this.m_f32List[e][t++]=i}destroy(){this.m_f32List=null,this.m_f32ChangedList=null,this.m_f32SizeList=null,this.m_f32List=null}toString(){return"VtxSeparatedBuf(uid = "+this.m_uid+")"}}e.default=a},"7a08":function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["CTM"]="ctm",t["Draco"]="draco",t["OBJ"]="obj",t["Jpg"]="jpg",t["Png"]="png"}(i||(i={})),e.DataFormat=i},"7b0e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("bbf4"));class a{constructor(){this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rayTestState=0,this.rpoNode=null,this.spaceId=-1,this.camVisiSt=0,this.camVisi=r.default.CAMERA_VISIBLE_ENABLE}reset(){this.rayTestState=0,this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rpoNode=null,this.spaceId=-1,this.camVisi=0}static GetFreeId(){return a.m_freeIdList.length>0?a.m_freeIdList.pop():-1}static GetByUid(t){return t>-1&&t<a.m_nodeListLen?a.m_nodeList[t]:null}static SetCamVisiByUid(t,e){a.m_nodeList[t].camVisi=e}static GetCamVisiByUid(t){return a.m_nodeList[t].camVisi}static Create(){let t=null,e=a.GetFreeId();return e>=0?(t=a.m_nodeList[e],t.uid=e,a.m_nodeFlagList[e]=a.s_FLAG_BUSY):(t=new a,a.m_nodeList.push(t),a.m_nodeFlagList.push(a.s_FLAG_BUSY),t.uid=a.m_nodeListLen,a.m_nodeListLen++),t}static Restore(t){null!=t&&t.uid>=0&&a.m_nodeFlagList[t.uid]==a.s_FLAG_BUSY&&(a.m_freeIdList.push(t.uid),a.m_nodeFlagList[t.uid]=a.s_FLAG_FREE,t.reset())}}a.s_FLAG_BUSY=1,a.s_FLAG_FREE=0,a.m_nodeListLen=0,a.m_nodeList=[],a.m_nodeFlagList=[],a.m_freeIdList=[],e.default=a},"7b85":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("7577"),r=s("74ee");class a extends i.SceneNode{constructor(){super()}load(t){null!=t&&(super.load(t),this.m_showTotal=0,t.length>0&&this.loadOBJByUrl(t[0]))}loadOBJByUrl(t){this.showInfo("obj..."),this.m_cospace.geometry.getCPUDataByUrlAndCallback(t,r.DataFormat.OBJ,(t,e)=>{let s=t.data.models;this.m_modelsTotal=s.length;let i=this.m_modelsTotal;for(let r=0;r<i;++r){const t=s[r];null!=t.vertices&&t.normals,this.initEntity(t)}this.m_waitPartsTotal=0},!0)}loadOBJByUrl2(t){}}e.OBJSceneNode=a},"7c63":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("e08e");class r{constructor(){this.stencilMask=-1}}class a{constructor(){this.m_units=new Array(128),this.m_unit=null,this.m_blendMode=i.RenderBlendMode.NORMAL,this.m_cullMode=i.CullFaceMode.NONE,this.m_depthTestType=i.DepthTestMode.DISABLE,this.m_cullDisabled=!0,this.m_context=null,this.m_gl=null,this.roColorMask=-11}reset(){this.roColorMask=-11}setRenderContext(t){this.m_context=t,this.m_gl=t.getRC();let e=this.m_gl.rcuid;this.m_unit=this.m_units[e],null==this.m_unit&&(this.m_unit=this.m_units[e]=new r)}setColorMask(t,e,s,i){this.m_gl.colorMask(t,e,s,i)}setStencilFunc(t,e,s){this.m_gl.stencilFunc(t,e,s)}setStencilMask(t){this.m_unit.stencilMask!=t&&t>=0&&(this.m_unit.stencilMask=t,this.m_gl.stencilMask(t))}setStencilOp(t,e,s){this.m_gl.stencilOp(t,e,s)}setDepthTestEnable(t){t?this.m_gl.enable(this.m_gl.DEPTH_TEST):this.m_gl.disable(this.m_gl.DEPTH_TEST)}setCullFaceEnable(t){t?this.m_gl.enable(this.m_gl.CULL_FACE):this.m_gl.disable(this.m_gl.CULL_FACE)}setBlendEnable(t){t?this.m_gl.enable(this.m_gl.BLEND):this.m_gl.disable(this.m_gl.BLEND)}setCullFaceMode(t){this.m_cullMode!=t&&(this.m_cullMode=t,t!=i.CullFaceMode.NONE?(this.m_cullDisabled&&(this.m_cullDisabled=!1,this.m_gl.enable(this.m_gl.CULL_FACE)),this.m_gl.cullFace(t)):this.m_cullDisabled||(this.m_cullDisabled=!0,this.m_gl.disable(this.m_gl.CULL_FACE)))}setBlendMode(t,e){this.m_blendMode!=t&&(this.m_blendMode=t,t>0?e[0]<1?(this.m_gl.blendEquation(this.m_gl.FUNC_ADD),this.m_gl.blendFunc(this.m_gl.ONE,this.m_gl.ZERO),this.m_gl.blendEquation(e[1]),this.m_gl.blendFunc(e[3],e[4])):(this.m_gl.blendEquationSeparate(e[1],e[2]),this.m_gl.blendFuncSeparate(e[3],e[4],e[5],e[6])):this.m_gl.disable(this.m_gl.BLEND))}setDepthTestMode(t){if(this.m_depthTestType!=t)switch(this.m_depthTestType=t,t){case i.DepthTestMode.ALWAYS:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.ALWAYS);break;case i.DepthTestMode.SKY:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.LEQUAL);break;case i.DepthTestMode.OPAQUE:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.LESS);break;case i.DepthTestMode.OPAQUE_OVERHEAD:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.EQUAL);break;case i.DepthTestMode.DECALS:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.LEQUAL);break;case i.DepthTestMode.BLEND:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.LESS);break;case i.DepthTestMode.WIRE_FRAME:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.LEQUAL);break;case i.DepthTestMode.NEXT_LAYER:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.ALWAYS);break;case i.DepthTestMode.TRUE_EQUAL:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.EQUAL);break;case i.DepthTestMode.TRUE_GREATER:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.GREATER);break;case i.DepthTestMode.TRUE_GEQUAL:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.GEQUAL);break;case i.DepthTestMode.WIRE_FRAME_NEXT:break;default:break}}}e.RODrawState=a},"7dbf":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("83a3"),r=s("3b80"),a=s("1f9e");class n extends i.ThreadTask{constructor(t){super(),this.m_listener=null,t.indexOf("/")>0?this.dependency=new r.TaskJSFileDependency(t):this.dependency=new r.TaskUniqueNameDependency(t)}setListener(t){this.m_listener=t}addBinaryData(t,e){null!=t&&this.addDataWithParam(a.CTMTaskCMD.PARSE,[t],{url:e})}addURL(t){""!=t&&this.addDataWithParam(a.CTMTaskCMD.LOAD_AND_PARSE,null,{url:t})}parseDone(t,e){if(null!=this.m_listener){let e=t.data;void 0==e.normals&&(e.normals=null),void 0==e.uvsList&&(e.uvsList=null),this.m_listener.ctmParseFinish(e,t.descriptor.url)}return!0}getTaskClass(){return 101}destroy(){super.destroy(),this.m_listener=null}}e.CTMParseTask=n},"7de1":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("a092"),r=s("2033");class a extends r.DataReceiverBase{constructor(){super(),a.s_total++}receiveDataUnit(t,e){let s=this.callback;this.callback=null,null!=s&&s(t,e)}}a.s_total=0;class n{constructor(){this.m_unitPool=new i.DataUnitPool,this.m_taskModules=null}createDataUnit(t,e,s=!1){return null}initTask(t,e,s,i){}setTaskModuleUrls(t){null!=t&&(this.m_taskModules=t.slice(0))}initialize(t,e,s=null){null==this.m_receiverSchedule&&null==this.m_threadSchedule&&(this.m_receiverSchedule=t,this.m_threadSchedule=e,this.initTask(this.m_unitPool,e,t,null!=this.m_taskModules?this.m_taskModules:s))}hasDataUnit(t){return this.m_unitPool.hasUnitByUrl(t)}getCPUDataByUrlAndCallback(t,e,s,i=!1){let r=this.m_unitPool.getUnitByUrl(t);if(null!=r&&null!=s&&r.isCpuPhase())return r.lossTime=0,s(r,1),r;if(null==r){let n=new a;n.callback=s,r=this.getCPUDataByUrl(t,e,n,i)}return r}getCPUDataByUrl(t,e,s=null,i=!1){let r=this.m_unitPool.getUnitByUrl(t);return null!=r&&null!=s&&r.isCpuPhase()?(r.lossTime=0,s.receiveDataUnit(r,1),r):(null==r&&(r=this.createDataUnit(t,e,i),r.lossTime=Date.now(),r.url=t,this.m_unitPool.addUnit(t,r)),this.m_receiverSchedule.addReceiver(s,r),r)}getGPUDataByUrlAndCallback(t,e,s,i=!1){return null}getGPUDataByUrl(t,e,s=null,i=!1){return null}getGPUDataByUUIDAndCallback(t,e){return null}getGPUDataByUUID(t,e=null){return null}destroy(){}}e.ResourceSchedule=n},"7ebf":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("1e86"),r=s("2356"),a=s("7566"),n=s("d2d9"),h=s("fce7"),l=s("60cd");class o{constructor(t,e,s=""){this.m_uid=-1,this.m_worker=null,this.m_taskItems=[],this.m_free=!1,this.m_enabled=!1,this.m_initBoo=!0,this.m_thrData=null,this.m_commonModuleMap=new Map,this.autoSendData=!1,this.localDataPool=new a.ThrDataPool,this.globalDataPool=null,this.unlock=!0,this.m_tdrManager=t,this.m_taskPool=e,this.m_graphJsonStr=s,this.m_uid=o.s_uid++,this.m_taskfs=new Array(h.ThreadConfigure.MAX_TASKS_TOTAL),this.m_taskfs.fill(-1)}getUid(){return this.m_uid}isEnabled(){return this.m_enabled}isFree(){return this.m_free&&this.unlock}hasDataToThread(){return this.localDataPool.isEnabled()||this.globalDataPool.isEnabled()}sendPoolDataToThread(){if(this.m_free){let t=this.localDataPool.isEnabled();return t&&(t=this.localDataPool.sendDataTo(this)),t||(t=this.globalDataPool.sendDataTo(this)),t}return!1}sendDataTo(t){if(this.m_free&&this.m_taskfs[t.taskclass]>0){t.buildThis(!0);let e={streams:null};if(e.descriptor=t.descriptor,e.taskCmd=t.taskCmd,e.taskclass=t.taskclass,e.srcuid=t.srcuid,e.dataIndex=t.dataIndex,e.wfst=t.wfst,e.streams=t.streams,e.cmd=i.ThreadCMD.DATA_PARSE,e.threadIndex=this.m_uid,null!=t.streams){let s=t.streams,i=new Array(s.length);for(let t=0;t<s.length;++t)s[t]instanceof ArrayBuffer?i[t]=s[t]:i[t]=s[t].buffer;this.m_worker.postMessage(e,i)}else this.m_worker.postMessage(e);t.sendStatus=1,t.streams=null,e.descriptor=null,e.streams=null,this.m_thrData=t,this.m_free=!1}else this.m_taskfs[t.taskclass]}initModuleByTaskDescriptor(t){if(null!=t){let e=t.taskclass;e>=0&&e<this.m_taskfs.length&&this.m_taskfs[e]<0&&(this.m_taskfs[e]=0,this.m_taskItems.push(t))}}initModules(t){let e=[];for(let s=0;s<t.length;++s)this.m_commonModuleMap.has(t[s])||(this.m_commonModuleMap.set(t[s],1),e.push(t[s]));e.length>0&&this.m_worker.postMessage({cmd:i.ThreadCMD.INIT_COMMON_MODULE,threadIndex:this.getUid(),modules:e,type:n.ThreadCodeSrcType.JS_FILE_CODE})}initModuleByCodeString(t){this.m_worker.postMessage({cmd:i.ThreadCMD.INIT_COMMON_MODULE,threadIndex:this.getUid(),src:t,type:n.ThreadCodeSrcType.STRING_CODE})}updateInitTask(){if(this.m_taskItems.length>0){this.m_free=!1,this.m_enabled=!1;let t=this.m_taskItems.pop();this.m_worker.postMessage({cmd:i.ThreadCMD.INIT_TASK,threadIndex:this.getUid(),param:t})}}receiveData(t){this.m_free=!0,this.autoSendData&&this.sendPoolDataToThread();let e=this.m_taskPool.getTaskByUid(t.srcuid),s=!0;null!=e&&(s=e.parseDone(t,0)),this.updateInitTask()}sendRouterDataTo(t){let e=t.param;null!=t&&t.isTransmission()&&e.threadIndex==this.m_uid&&(t.param=null,this.m_worker.postMessage({cmd:e.cmd,taskCmd:e.taskCmd,threadIndex:this.getUid(),taskclass:e.taskclass,data:t.getData()},t.getTransfers()))}terminate(){null!=this.m_worker&&(this.m_worker.terminate(),this.m_worker=null,this.m_free=!1,this.m_enabled=!1)}destroy(){null!=this.m_worker&&(this.terminate(),this.m_taskPool=null,this.m_tdrManager=null,this.m_graphJsonStr="",this.localDataPool=null,this.globalDataPool=null)}isDestroyed(){return null==this.m_taskPool}initialize(t){if(this.m_initBoo&&null!=t&&null==this.m_worker){this.m_initBoo=!1;let e=new Worker(URL.createObjectURL(t));this.m_worker=e,this.m_worker.onmessage=t=>{null!=this.m_thrData&&(r.ThreadSendData.Restore(this.m_thrData),this.m_thrData.sendStatus=-1,this.m_thrData=null);let s=t.data;switch(s.cmd){case i.ThreadCMD.DATA_PARSE:this.receiveData(s);break;case i.ThreadCMD.THREAD_INIT:e.postMessage({cmd:i.ThreadCMD.INIT_PARAM,threadIndex:this.getUid(),graphJsonStr:this.m_graphJsonStr,total:h.ThreadConfigure.MAX_TASKS_TOTAL});break;case i.ThreadCMD.INIT_TASK:if(this.m_taskfs[s.taskclass]<0)throw Error("sub worker taskclass and main worker logic taskClass are not equal !!!");this.m_taskfs[s.taskclass]=1,this.m_free=!0,this.m_enabled=!0,this.updateInitTask();break;case i.ThreadCMD.INIT_PARAM:this.m_free=!0,this.m_enabled=!0,this.updateInitTask();break;case i.ThreadCMD.THREAD_ACQUIRE_DATA:let t=new l.TDRParam(s.taskclass,s.cmd,s.taskCmd,this.getUid()),r=this.m_tdrManager.getRouterByTaskClass(s.taskclass);null!=r&&(r.acquireTrigger(),r.isDataEnabled()&&!r.isTransmission()?(r.param=t,this.sendRouterDataTo(r)):r=null),null==r&&this.m_tdrManager.waitRouterByParam(t);break;case i.ThreadCMD.THREAD_TRANSMIT_DATA:let a=this.m_tdrManager.getRouterByTaskClass(s.taskclass);null!=a&&(a.isDataEnabled(),a.setData(s.data));break;case i.ThreadCMD.INIT_COMMON_MODULE:break;default:break}}}}}o.s_uid=0,e.ThreadBase=o},8171:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.m_rstate=null,this.m_rstate=t}setDepthTestEnable(t){this.m_rstate.setDepthTestEnable(t)}setStencilFunc(t,e,s){this.m_rstate.setStencilFunc(t,e,s)}setStencilMask(t){this.m_rstate.setStencilMask(t)}setStencilOp(t,e,s){this.m_rstate.setStencilOp(t,e,s)}}e.Stencil=i},"81ce":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Es2VtxShderToES3(t){let e=t;const s="attribute",i="varying ";let r=e.indexOf(s),a=0;while(r>=0)e=e.slice(0,r)+"layout(location="+a+") in"+e.slice(r+9),r=e.indexOf(s),a++;let n=new RegExp(i,"g");return e=e.replace(n,"out "),"#version 300 es\n"+e}static Es2FragShderToES3(t){let e=t;const s="gl_FragColor",i="varying ";let r=e.indexOf(s),a=0,n="FragColorOut_"+a;r>=0&&(e=e.slice(0,r)+n+e.slice(r+12)),r=e.indexOf("void "),e=e.slice(0,r)+"out vec4 "+n+";\n"+e.slice(r);let h=new RegExp(i,"g");return e=e.replace(h,"in "),h=new RegExp(" texture2D","g"),e=e.replace(h," texture"),h=new RegExp(" textureCube","g"),e=e.replace(h," texture"),"#version 300 es\n"+e}static Es3VtxShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const s=/\blayout\b.+\bin\b/g;t=t.replace(s,"attribute");const r=/\bout\b/g;t=t.replace(r,"varying");const a=/\btexture\b/g;t=t.replace(a,"texture2D"),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version"));let n=0,h=0,l=t.indexOf("inverse(");l<0&&(l=t.indexOf("inverse ("));let o="",_=!1,m=!1;while(l>3){if(n=t.indexOf(")",l+2),o=t.slice(l+2,n),o.indexOf("mat3")>0)_=!0;else if(o=o.replace(/\s+/g,""),n=o.indexOf("("),o=o.slice(n+1),n=t.indexOf(o,1),h=t.lastIndexOf("mat",n),h>0)switch(o=t.slice(h,n),o=o.replace(/\s+/g,""),o){case"mat3":_=!0;break;case"mat4":m=!0;break}if(l=t.indexOf("inverse(",l+5),l<0&&(l=t.indexOf("inverse (",l+5)),_&&m)break}n=0,l=t.indexOf("transpose("),l<0&&(l=t.indexOf("transpose (")),o="";let u=!1,d=!1;while(l>3){if(n=t.indexOf(")",l+2),o=t.slice(l+2,n+1),o.indexOf("mat3")>0)u=!0;else if(o=o.replace(/\s+/g,""),n=o.indexOf("("),o=o.slice(n+1),n=t.indexOf(o,1),h=t.lastIndexOf("mat",n),h>0)switch(o=t.slice(h,n),o=o.replace(/\s+/g,""),o){case"mat3":u=!0;break;case"mat4":d=!0;break}if(l=t.indexOf("transpose(",l+5),l<0&&(l=t.indexOf("transpose (",l+5)),u&&d)break}return(_||m)&&(l=t.indexOf("void "),l>10&&(_&&m?t=t.slice(0,l)+i.__glslInverseMat3+i.__glslInverseMat4+t.slice(l):_?t=t.slice(0,l)+i.__glslInverseMat3+t.slice(l):m&&(t=t.slice(0,l)+i.__glslInverseMat4+t.slice(l)))),(u||d)&&(l=t.indexOf("void "),l>10&&(u&&d?t=t.slice(0,l)+i.__glslTransposeMat3+i.__glslTransposeMat4+t.slice(l):u?t=t.slice(0,l)+i.__glslTransposeMat3+t.slice(l):d&&(t=t.slice(0,l)+i.__glslTransposeMat4+t.slice(l)))),t}static Es3FragShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const s=new RegExp(" in ","g");t=t.replace(s,"_fref_");const i=/\bin\b/g;t=t.replace(i,"varying");const r=new RegExp("_fref_","g");t=t.replace(r," in ");const a=/\btexture\b/g;t=t.replace(a,"texture2D");const n=/" "/g;let h=t;const l=";",o="layout";let _=h.indexOf(o),m=0,u=0,d="",c="",f=0,p=null,g=[],T=[];while(_>=0)m=h.indexOf(l,_+1),d=h.slice(_+1,m),c=d.slice(d.lastIndexOf(" ")+1),f=d.indexOf(")"),_=d.lastIndexOf("=",f)+1,d=d.slice(_+1,f),f=parseInt(d.replace(n,"")),g.push(c),T.push(f),_=h.indexOf(o,m);let y=g.length;if(y>0)if(p=/layout/g,t=t.replace(p,"//layout"),y>1){_=0;while(_<y)p=new RegExp(g[_],"g"),t=t.replace(p,"gl_FragData["+T[_]+"]"),++_}else p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor");else _=h.indexOf("out "),_>0&&(m=h.indexOf(l,_+1),d=h.slice(_+1,m),c=d.slice(d.lastIndexOf(" ")+1),p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor"),p=/\bout\b/g,t=t.replace(p,"//out"));y>1&&(t="#extension GL_EXT_draw_buffers: require\n"+t),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version")),_=0;for(let E=0;E<16;++E){if(_=t.indexOf("samplerCube ",_),!(_>0))break;{m=t.indexOf(";",_),d=h.slice(_+12,m),c="";let e=d.split(" ");for(let t=0;t<16;++t)if(""!=e[t]){c=e[t];break}for(y=0;y<16;++y){if(m=t.indexOf(c,m+1),!(m>0))break;if(u=t.lastIndexOf("texture2D",m-1),u<0)break;d=t.slice(u,m),t=t.slice(0,u)+"textureCube("+t.slice(m),m+=2}}_+=4}return t}}i.__glslTransposeMat3="\n    mat3 transpose(mat3 m) {\n        return mat3(m[0][0],m[1][0],m[2][0],\n            m[0][1],m[1][1],m[2][1],\n            m[0][2],m[1][2],m[2][2]);\n    }\n    ",i.__glslTransposeMat4="\n    mat4 transpose(mat4 m) {\n        return mat4(m[0][0],m[1][0],m[2][0],m[3][0],\n            m[0][1],m[1][1],m[2][1],m[3][1],\n            m[0][2],m[1][2],m[2][2],m[3][2],\n            m[0][3],m[1][3],m[2][3],m[3][3]);\n    }\n    ",i.__glslInverseMat3="\n    mat3 inverse(mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];  \n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;  \n        float det = a00 * b01 + a01 * b11 + a02 * b21;  \n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n    ",i.__glslInverseMat4="\n    mat4 inverse(mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n        }\n    ",e.default=i},8310:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.id=-1,this.ID="",this.userData={},this.parent=null,this.i3=0,this.i2=0,this.uvs=[],this.normal=null,this.vertex=null,this.indices=null,this.colors=null,this.materialIndex=[],this.vertexWeights=[],this.weightsIndices=[],this.isEntity=!1,this.transform=null}toGeometryModel(){let t=this.indices;if(null==t){let e=this.vertex.length,s=e/3;t=s>65535?new Uint32Array(s):new Uint16Array(s);for(let i=0;i<s;++i)t[i]=i}let e={uvsList:this.uvs,vertices:this.vertex,normals:this.normal,indices:t};return e}destroy(){this.uvs=null,this.vertex=null,this.normal=null,this.colors=null,this.indices=null}}e.FBXBufferObject=i},8333:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.COLOR_BUFFER_BIT=131,i.DEPTH_BUFFER_BIT=132,i.STENCIL_BUFFER_BIT=133,e.default=i},"839a":function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["Default"]=1]="Default",t[t["FragColor"]=2]="FragColor",t[t["SpecularMapColor"]=3]="SpecularMapColor"}(i||(i={})),e.SpecularMode=i},"83a3":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("2356");class r{constructor(){this.m_uid=-1,this.m_globalDataPool=null,this.m_localDataPool=null,this.m_taskPool=null,this.m_parseIndex=0,this.m_parseTotal=0,this.dependency=null}attach(t){if(this.m_uid<0&&null==this.m_taskPool&&null!=t){this.m_taskPool=t;let e=t.attachTask(this);if(e>0)return this.m_uid=e,!0;throw Error("illegal operation!!!")}return!1}detach(){this.m_uid>0&&null!=this.m_taskPool&&(this.m_taskPool.detachTask(this),this.m_uid=-1)}setDataPool(t,e=null){this.m_globalDataPool=t,this.m_localDataPool=e}reset(){this.m_parseIndex=0}setParseTotal(t){this.m_parseTotal=t}isFinished(){return this.m_parseIndex>=this.m_parseTotal}getParsedTotal(){return this.m_parseIndex>=this.m_parseTotal?this.m_parseTotal:this.m_parseIndex+1}getParseTotal(){return this.m_parseTotal}getParsedIndex(){return this.m_parseIndex}getUid(){return this.m_uid}parseDone(t,e){throw Error("ThreadTask::parseDone(), Need Override it!")}createSendData(){let t=i.ThreadSendData.Create();return t.srcuid=this.getUid(),t.taskclass=this.getTaskClass(),t}createSendDataWithParam(t,e=null,s=null){let r=i.ThreadSendData.Create();return r.srcuid=this.getUid(),r.taskclass=this.getTaskClass(),r.taskCmd=t,r.streams=e,r.descriptor=null,r}addDataWithParam(t,e=null,s=null,i=!1){let r=this.createSendData();r.taskCmd=t,r.streams=e,r.descriptor=s,this.addData(r,i)}addData(t,e=!1){if(!(this.m_uid>=0))throw Error("Need attach this task !");t.srcuid=this.m_uid,t.taskclass=this.getTaskClass(),e?null!=this.m_localDataPool&&this.m_localDataPool.addData(t):null!=this.m_globalDataPool&&this.m_globalDataPool.addData(t)}getWorkerSendDataAt(t){throw Error("ThreadTask::getWorkerSendDataAt(), Need Override !")}getTaskClass(){throw Error("ThreadTask::getTaskClass(), Need Override !")}destroy(){this.detach(),this.m_globalDataPool=null,this.m_localDataPool=null,this.dependency=null}}e.ThreadTask=r},"83d1":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73"));class a{create(t,e){let s=r.default.StageParam;return e.hasUniformByName(s.name)?t.uniformContext.createShaderGlobalUniformFromProbe(t.getStage3D().uProbe,s.name,[s.name]):null}getIDNS(){return"StageParamUniformBuilder"}}e.default=a},"857b":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73"));class a{create(t,e){let s=r.default.CameraPosParam;return e.hasUniformByName(s.name)?t.uniformContext.createShaderGlobalUniformFromProbe(t.getCamera().ucameraPosProbe,s.name,[s.name]):null}getIDNS(){return"CameraPosUniformBuilder"}}e.default=a},"85b6":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=i(s("0851"));class n extends a.default{constructor(t,e,s=!1){super(t,e,s),this.m_tex=null,this.m_type=r.TextureProxyType.Wrapper}getResUid(){return this.m_tex.getResUid()}getBufWidth(){return this.m_tex.getBufWidth()}getBufHeight(){return this.m_tex.getBufHeight()}getWidth(){return this.m_tex.getWidth()}getHeight(){return this.m_tex.getHeight()}isDirect(){return!1}getAttachTex(){return this.m_tex}attachTex(t){this.m_tex!=t&&(null!=this.m_tex&&this.m_tex.__$detachThis(),null!=t&&t.__$attachThis(),this.m_tex=t)}detachTex(){null!=this.m_tex&&this.m_tex.__$detachThis(),this.m_tex=null}__$attachThis(){super.__$attachThis(),null!=this.m_tex&&this.m_tex.__$attachThis()}__$detachThis(){super.__$detachThis(),null!=this.m_tex&&this.m_tex.__$detachThis()}__$$use(t){this.m_tex.__$$use(t)}isGpuEnabled(){return this.m_tex.isGpuEnabled()}getSampler(){return this.m_tex.getSampler()}__$updateToGpu(t){this.m_tex.__$updateToGpu(t)}__$$upload(t){this.m_tex.__$$upload(t)}__$destroy(){this.getAttachCount()<1&&(null!=this.m_tex&&this.m_tex.__$detachThis(),this.m_tex=null,super.__$destroy())}isDataEnough(){return this.m_tex.isDataEnough()}getTargetType(){return this.m_tex.getTargetType()}}e.default=n},"85f5":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.m_waitParams=[],this.m_enabledParams=[],this.m_threads=null,this.m_taskClassTotal=t>1024?t:1024,this.m_routers=new Array(t),this.m_routers.fill(null),this.m_rfs=new Array(t),this.m_rfs.fill(0)}setThreads(t){this.m_threads=t}hasRouterByTaskClass(t){return t>=0&&t<this.m_taskClassTotal&&null!=this.m_routers[t]}getRouterByTaskClass(t){if(t>=0&&t<this.m_taskClassTotal)return this.m_routers[t]}setRouter(t){let e=t.getTaskClass();if(!(e>=0&&e<this.m_taskClassTotal))throw Error("illegal object !!!");null==this.m_routers[e]&&(this.m_routers[e]=t)}waitRouterByParam(t){if(0!=t.status)throw Error("illegal param !!!");let e=t.taskclass;if(!(e>=0&&e<this.m_taskClassTotal))throw Error("illegal object !!!");this.m_waitParams.push(t),t.status=1}run(){let t=this.m_waitParams.length;if(t>0){let e=this.m_waitParams,s=null,i=null;for(let r=0;r<t;++r)i=e[r],s=this.m_routers[i.taskclass],null!=s&&s.isDataEnabled()&&!s.isTransmission()&&(s.acquireTrigger(),s.param=i,this.m_enabledParams.push(i),i.status=2,e.splice(r,1),--r,--t);if(t=this.m_enabledParams.length,t>0){e=this.m_enabledParams;for(let s=0;s<t;++s)this.m_threads[e[s].threadIndex].sendRouterDataTo(this.getRouterByTaskClass(e[s].taskclass));this.m_enabledParams=[]}}}getEnabledParams(){if(this.m_enabledParams.length>0){let t=this.m_enabledParams;return this.m_enabledParams=[],t}return null}destroy(){this.m_taskClassTotal=0,this.m_routers.length=0}}e.TDRManager=i},8875:function(t,e,s){var i,r,a;(function(s,n){r=[],i=n,a="function"===typeof i?i.apply(e,r):i,void 0===a||(t.exports=a)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(d){var s,i,r,a=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,n=/@([^@]*):(\d+):(\d+)\s*$/gi,h=a.exec(d.stack)||n.exec(d.stack),l=h&&h[1]||!1,o=h&&h[2]||!1,_=document.location.href.replace(document.location.hash,""),m=document.getElementsByTagName("script");l===_&&(s=document.documentElement.outerHTML,i=new RegExp("(?:[^\\n]+?\\n){0,"+(o-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=s.replace(i,"$1").trim());for(var u=0;u<m.length;u++){if("interactive"===m[u].readyState)return m[u];if(m[u].src===l)return m[u];if(l===_&&m[u].innerHTML&&m[u].innerHTML.trim()===r)return m[u]}return null}}return t}))},"8a0a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ca6c"));class a{static ToGL(t,e){switch(e){case a.VTX_STATIC_DRAW:return t.STATIC_DRAW;case a.VTX_DYNAMIC_DRAW:return t.DYNAMIC_DRAW;case a.VTX_STREAM_DRAW:return t.STREAM_DRAW;case a.VTX_STATIC_READ:return t.STATIC_READ;case a.VTX_DYNAMIC_READ:return t.DYNAMIC_READ;case a.VTX_STREAM_READ:return t.STREAM_READ;case a.VTX_STATIC_COPY:return t.STATIC_COPY;case a.VTX_DYNAMIC_COPY:return t.DYNAMIC_COPY;case a.VTX_STREAM_COPY:return t.STREAM_COPY;default:break}return t.STATIC_DRAW}static GetVBufTypeByNS(t){switch(t){case a.VBUF_VS_NS:return a.VBUF_VS;case a.VBUF_UVS_NS:return a.VBUF_UVS;case a.VBUF_NVS_NS:return a.VBUF_NVS;case a.VBUF_CVS_NS:return a.VBUF_CVS;case a.VBUF_VS2_NS:return a.VBUF_VS2;case a.VBUF_UVS2_NS:return a.VBUF_UVS2;case a.VBUF_NVS2_NS:return a.VBUF_NVS2;case a.VBUF_CVS2_NS:return a.VBUF_CVS2;case a.VBUF_TVS_NS:return a.VBUF_TVS;case a.VBUF_TVS2_NS:return a.VBUF_TVS2;default:}return-1}static GetVBufNSByType(t){switch(t){case a.VBUF_VS:return a.VBUF_VS_NS;case a.VBUF_UVS:return a.VBUF_UVS_NS;case a.VBUF_NVS:return a.VBUF_NVS_NS;case a.VBUF_CVS:return a.VBUF_CVS_NS;case a.VBUF_VS2:return a.VBUF_VS2_NS;case a.VBUF_UVS2:return a.VBUF_UVS2_NS;case a.VBUF_NVS2:return a.VBUF_NVS2_NS;case a.VBUF_CVS2:return a.VBUF_CVS2_NS;case a.VBUF_TVS:return a.VBUF_TVS_NS;case a.VBUF_TVS2:return a.VBUF_TVS2_NS;default:}return""}static GetVBufAttributeTypeByNS(t){return a.GetVBufTypeByNS(t)-3e3}static GetVBufAttributeTypeByVBufType(t){return t-3e3}}a.VTXTYPE_GL_POINTS=101,a.VTXTYPE_GL_LINES=102,a.VTXTYPE_GL_LINE_STRIP=103,a.VTXTYPE_GL_TRIANGLES=111,a.VTX_STATIC_DRAW=0,a.VTX_DYNAMIC_DRAW=1,a.VTX_STREAM_DRAW=2,a.VTX_STATIC_READ=3,a.VTX_DYNAMIC_READ=4,a.VTX_STREAM_READ=5,a.VTX_STATIC_COPY=6,a.VTX_DYNAMIC_COPY=7,a.VTX_STREAM_COPY=8,a.VBUF_VS=3001,a.VBUF_UVS=3002,a.VBUF_NVS=3003,a.VBUF_CVS=3004,a.VBUF_TVS=3005,a.VBUF_VS2=3006,a.VBUF_UVS2=3007,a.VBUF_NVS2=3008,a.VBUF_CVS2=3009,a.VBUF_TVS2=3010,a.VBUF_VS_INDEX=r.default.BIT_ONE_0,a.VBUF_UVS_INDEX=r.default.BIT_ONE_1,a.VBUF_NVS_INDEX=r.default.BIT_ONE_2,a.VBUF_CVS_INDEX=r.default.BIT_ONE_3,a.VBUF_TVS_INDEX=r.default.BIT_ONE_4,a.VBUF_VS2_INDEX=r.default.BIT_ONE_5,a.VBUF_UVS2_INDEX=r.default.BIT_ONE_6,a.VBUF_NVS2_INDEX=r.default.BIT_ONE_7,a.VBUF_CVS2_INDEX=r.default.BIT_ONE_8,a.VBUF_TVS2_INDEX=r.default.BIT_ONE_9,a.VBUF_VS_NS="a_vs",a.VBUF_VS2_NS="a_vs2",a.VBUF_UVS_NS="a_uvs",a.VBUF_UVS2_NS="a_uvs2",a.VBUF_NVS_NS="a_nvs",a.VBUF_NVS2_NS="a_nvs2",a.VBUF_CVS_NS="a_cvs",a.VBUF_CVS2_NS="a_cvs2",a.VBUF_TVS_NS="a_tvs",a.VBUF_TVS2_NS="a_tvs2";class n{}n.FLAT=210,n.GOURAND=310,e.VtxNormalType=n,e.default=a},"8ae4":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_uid=0,this.m_vtx=null,this.m_vtxUid=0,this.m_gpuBuf=null,this.m_ivsSize=0,this.ibufStep=0,this.m_uid=i.s_uid+1}getUid(){return this.m_uid}getVtxUid(){return this.m_vtxUid}getGpuBuf(){return this.m_gpuBuf}getVTCount(){return this.m_ivsSize}updateToGpu(t){if(null!=this.m_gpuBuf&&this.m_ivsSize>0){let e=this.m_vtx;this.version!=e.indicesVer&&(this.m_ivs=e.getIvsData(),t.bindEleBuf(this.m_gpuBuf),this.m_ivsSize>=this.m_ivs.length?t.eleBufSubData(this.m_ivs,e.getBufDataUsage()):t.eleBufData(this.m_ivs,e.getBufDataUsage()),this.m_ivsSize=this.m_ivs.length,this.version=e.indicesVer)}}initialize(t,e){if(null==this.m_gpuBuf&&null!=e.getIvsData())if(this.version=e.indicesVer,this.m_vtx=e,this.m_vtxUid=e.getUid(),this.m_ivs=e.getIvsData(),this.m_gpuBuf=t.createBuf(),t.bindEleBuf(this.m_gpuBuf),null==e.bufData)t.eleBufData(this.m_ivs,e.getBufDataUsage()),this.m_ivsSize=this.m_ivs.length;else{t.eleBufDataMem(e.bufData.getIndexDataTotalBytes(),e.getBufDataUsage());let s=null,i=0;this.m_ivsSize=0;for(let r=0,a=e.bufData.getIndexDataTotal();r<a;++r)s=e.bufData.getIndexDataAt(r),t.eleBufSubData(s,i),i+=s.byteLength,this.m_ivsSize+=s.length}}destroy(t){null!=this.m_gpuBuf&&(this.m_vtx=null,t.deleteBuf(this.m_gpuBuf),this.m_gpuBuf=null,this.m_ivs=null,this.m_ivsSize=0)}}i.s_uid=0,e.ROIndicesRes=i},"8b17":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("f689"),r=s("1280");class a{constructor(){}parse(t,e){this.m_connections=this.parseConnections(t.map);const s=this.parseDeformers(t.map,this.m_connections);let i=new r.GeometryBufferParser;i.setReader(e);const a=i.parseGeomBuf(s,t.map,this.m_connections);return this.parseScene(s,a,this.m_connections,t.map),a}parseScene(t,e,s,i){this.parseModels(e,s,i)}parseModels(t,e,s){const i=new Map,r=s.Objects.Model;for(const a in r){const t=parseInt(a),s=r[a];e.get(t);let n=null;switch(s.attrType){case"Camera":break;case"Light":break;case"Mesh":break;case"NurbsCurve":break;case"LimbNode":case"Root":break;case"Null":default:break}n.ID=t,this.getTransformData(n,s),i.set(t,n)}return i}parseBufObjTransData(t,e,s,r){const a=r.Objects.Model,n=a[e];this.getTransformData(t,n),t.parent&&(t.userData.transformData.parentMatrix=n.parent.matrix,t.userData.transformData.parentMatrixWorld=n.parent.matrixWorld);const h=i.generateTransform(t.userData.transformData);t.transform=h}getTransformData(t,e){const s={};"InheritType"in e&&(s.inheritType=parseInt(e.InheritType.value)),s.eulerOrder="RotationOrder"in e?i.getEulerOrder(e.RotationOrder.value):"ZYX","Lcl_Translation"in e&&(s.translation=e.Lcl_Translation.value),"PreRotation"in e&&(s.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(s.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(s.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(s.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(s.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(s.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(s.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(s.rotationPivot=e.RotationPivot.value),t.userData.transformData=s}parseBegin(t,e){this.m_fbxTree=t,this.m_connections=this.parseConnections(t.map);const s=this.parseDeformers(t.map,this.m_connections);this.m_geomParser=new r.GeometryBufferParser,this.m_geomParser.setReader(e),this.m_geomParser.parseGeomBufBegin(s,t.map,this.m_connections)}getGeomBufId(){return null!=this.m_geomParser?this.m_geomParser.getGeomBufId():-1}parseGeomBufNext(){let t;if(null!=this.m_geomParser){t=this.m_geomParser.parseGeomBufNext();t.ID;const e=this.m_connections.get(t.id);let s="";s=e.parents[0].ID+"",this.parseBufObjTransData(t,s,this.m_connections,this.m_fbxTree.map)}return t}parseGeomBufAt(t){let e;if(null!=this.m_geomParser){e=this.m_geomParser.parseGeomBufAt(t);const s=this.m_connections.get(e.id);let i="";i=s.parents[0].ID+"",this.parseBufObjTransData(e,i,this.m_connections,this.m_fbxTree.map)}return e}isParsing(){return null!=this.m_geomParser&&this.m_geomParser.isParsing()}getParseTotal(){return null!=this.m_geomParser?this.m_geomParser.getParseTotal():0}parseConnections(t){const e=new Map;if("Connections"in t){const s=t.Connections.connections;s.forEach((function(t){const s=t[0],i=t[1],r=t[2];e.has(s)||e.set(s,{parents:[],children:[]});const a={ID:i,relationship:r};e.get(s).parents.push(a),e.has(i)||e.set(i,{parents:[],children:[]});const n={ID:s,relationship:r};e.get(i).children.push(n)}))}return e}parseDeformers(t,e){const s={},i={};return{skeletons:s,morphTargets:i}}}e.FBXTreeBufferParser=a},"8d98":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static GetConst(t,e){switch(e){case i.NEAREST:return t.NEAREST;case i.LINEAR:return t.LINEAR;case i.LINEAR_MIPMAP_LINEAR:return t.LINEAR_MIPMAP_LINEAR;case i.NEAREST_MIPMAP_NEAREST:return t.NEAREST_MIPMAP_NEAREST;case i.LINEAR_MIPMAP_NEAREST:return t.LINEAR_MIPMAP_NEAREST;case i.NEAREST_MIPMAP_LINEAR:return t.NEAREST_MIPMAP_LINEAR;case i.WRAP_REPEAT:return t.REPEAT;case i.WRAP_CLAMP_TO_EDGE:return t.CLAMP_TO_EDGE;case i.WRAP_MIRRORED_REPEAT:return t.MIRRORED_REPEAT;default:break}return-1}}i.WRAP_REPEAT=3001,i.WRAP_CLAMP_TO_EDGE=3002,i.WRAP_MIRRORED_REPEAT=3003,i.NEAREST=4001,i.LINEAR=4002,i.LINEAR_MIPMAP_LINEAR=4003,i.NEAREST_MIPMAP_NEAREST=4004,i.LINEAR_MIPMAP_NEAREST=4005,i.NEAREST_MIPMAP_LINEAR=4006,e.default=i},"8def":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("919c"));class a extends r.default{constructor(){super(),this.shdp=null,this.vbufs=null,this.vbuf=null,this.attribTypes=null,this.wholeOffsetList=null,this.attribTypesLen=0,this.updateUnlocked=!0,this.wholeStride=0,this.m_uid=a.s_uid++}run(){this.m_rc.testVROUid(this.m_uid)&&(null!=this.vbuf?this.m_rc.useVtxAttribsPtrTypeFloat(this.shdp,this.vbuf,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride):this.m_rc.useVtxAttribsPtrTypeFloatMulti(this.shdp,this.vbufs,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride),this.m_rc.testRIOUid(this.m_vtxUid)&&this.m_rc.bindEleBuf(this.ibuf))}__$destroy(){r.default.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.m_rc=null,this.shdp=null,this.vbufs=null,this.vbuf=null,this.ibuf=null,this.attribTypes=null,this.attribTypesLen=0,this.wholeStride=0}restoreThis(){a.Restore(this)}toString(){return"VertexRenderObj(uid = "+this.m_uid+", type="+this.m_mid+")"}static HasMid(t){return r.default.s_midMap.has(t)}static GetByMid(t){return r.default.s_midMap.get(t)}static GetFreeId(){return a.s_freeIdList.length>0?a.s_freeIdList.pop():-1}static Create(t,e,s){let i=null,n=a.GetFreeId();return n>=0?(i=a.s_unitList[n],a.s_unitFlagList[n]=a.s_FLAG_BUSY,i.setMidAndBufUid(e,s)):(i=new a,i.setMidAndBufUid(e,s),a.s_unitList.push(i),a.s_unitFlagList.push(a.s_FLAG_BUSY),a.s_unitListLen++),i.setRC(t),r.default.s_midMap.set(e,i),i}static Restore(t){if(null!=t&&t.m_attachCount<1&&a.s_unitFlagList[t.getUid()]==a.s_FLAG_BUSY){let e=t.getUid();a.s_freeIdList.push(e),a.s_unitFlagList[e]=a.s_FLAG_FREE,t.__$destroy()}}}a.s_uid=0,a.s_FLAG_BUSY=1,a.s_FLAG_FREE=0,a.s_unitFlagList=[],a.s_unitListLen=0,a.s_unitList=[],a.s_freeIdList=[],e.default=a},"8e17":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=180/Math.PI,r=1e-5;class a{constructor(t=0,e=0,s=0,i=1){this.x=0,this.y=0,this.z=0,this.w=0,this.x=t,this.y=e,this.z=s,this.w=i}clone(){return new a(this.x,this.y,this.z,this.w)}setTo(t,e,s,i=1){this.x=t,this.y=e,this.z=s,this.w=i}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}setXYZ(t,e,s){this.x=t,this.y=e,this.z=s}copyFrom(t){this.x=t.x,this.y=t.y,this.z=t.z}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}multBy(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);t>r&&(this.x/=t,this.y/=t,this.z/=t)}normalizeTo(t){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);e>r?(t.x=this.x/e,t.y=this.y/e,t.z=this.z/e):(t.x=this.x,t.y=this.y,t.z=this.z)}scaleVector(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}scaleBy(t){this.x*=t,this.y*=t,this.z*=t}negate(){this.x=-this.x,this.y=-this.y,this.z=-this.z}equalsXYZ(t){return Math.abs(this.x-t.x)<r&&Math.abs(this.y-t.y)<r&&Math.abs(this.z-t.z)<r}equalsAll(t){return Math.abs(this.x-t.x)<r&&Math.abs(this.y-t.y)<r&&Math.abs(this.z-t.z)<r&&Math.abs(this.w-t.w)<r}project(){let t=1/this.w;this.x*=t,this.y*=t,this.z*=t}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getLengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}addBy(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}subtractBy(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}subtract(t){return new a(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new a(this.x+t.x,this.y+t.y,this.z+t.z)}crossProduct(t){return new a(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}crossBy(t){let e=this.y*t.z-this.z*t.y,s=this.z*t.x-this.x*t.z,i=this.x*t.y-this.y*t.x;this.x=e,this.y=s,this.z=i}reflectBy(t){let e=2*(this.x*t.x+this.y*t.y+this.z*t.z);this.x=this.x-e*t.x,this.y=this.y-e*t.y,this.z=this.z-e*t.z}scaleVecTo(t,e){this.x=t.x*e,this.y=t.y*e,this.z=t.z*e}subVecsTo(t,e){this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z}addVecsTo(t,e){this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z}crossVecsTo(t,e){this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x}toString(){return"Vector3D("+this.x+this.y+this.z+")"}static Cross(t,e,s){s.x=t.y*e.z-t.z*e.y,s.y=t.z*e.x-t.x*e.z,s.z=t.x*e.y-t.y*e.x}static CrossSubtract(t,e,s,i,r){a.__vtor3Stv0.x=e.x-t.x,a.__vtor3Stv0.y=e.y-t.y,a.__vtor3Stv0.z=e.z-t.z,a.__vtor3Stv1.x=i.x-s.x,a.__vtor3Stv1.y=i.y-s.y,a.__vtor3Stv1.z=i.z-s.z,t=a.__vtor3Stv0,s=a.__vtor3Stv1,r.x=t.y*s.z-t.z*s.y,r.y=t.z*s.x-t.x*s.z,r.z=t.x*s.y-t.y*s.x}static Subtract(t,e,s){s.x=t.x-e.x,s.y=t.y-e.y,s.z=t.z-e.z}static DistanceSquared(t,e){return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,a.__vtor3Stv0.getLengthSquared()}static DistanceXYZ(t,e,s,i,r,n){return a.__vtor3Stv0.x=t-i,a.__vtor3Stv0.y=e-r,a.__vtor3Stv0.z=s-n,a.__vtor3Stv0.getLength()}static Distance(t,e){return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,a.__vtor3Stv0.getLength()}static AngleBetween(t,e){return t.normalizeTo(a.__vtor3Stv0),e.normalizeTo(a.__vtor3Stv1),Math.acos(a.__vtor3Stv0.dot(a.__vtor3Stv1))*i}static RadianBetween(t,e){return t.normalizeTo(a.__vtor3Stv0),e.normalizeTo(a.__vtor3Stv1),Math.acos(a.__vtor3Stv0.dot(a.__vtor3Stv1))}static RadianBetween2(t,e){let s=t.getLengthSquared(),i=e.getLengthSquared();return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,Math.acos((s+i-a.__vtor3Stv0.getLengthSquared())/(2*Math.sqrt(s)*Math.sqrt(i)))}static Reflect(t,e,s){let i=2*(t.x*e.x+t.y*e.y+t.z*e.z);s.x=t.x-i*e.x,s.y=t.y-i*e.y,s.z=t.z-i*e.z}}a.X_AXIS=new a(1,0,0),a.Y_AXIS=new a(0,1,0),a.Z_AXIS=new a(0,0,1),a.__vtor3Stv0=new a,a.__vtor3Stv1=new a,a.ZERO=new a(0,0,0),a.ONE=new a(1,1,1),e.default=a},"8eb0":function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["ctmParser"]="ctmGeomParser",t["objParser"]="objGeomParser",t["dracoParser"]="dracoGeomParser"}(i||(i={})),e.ModuleNS=i},9156:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetTransUniform(t,e){i.s_transMap.set(t.getUid(),e)}static GetTransUniform(t){if(t.getUid()<0)throw Error("mat.getUid() < 0");return i.s_transMap.has(t.getUid())?i.s_transMap.get(t.getUid()):null}static HasTransUniform(t){return i.s_transMap.has(t.getUid())}static RemoveTransUniform(t){i.s_transMap.delete(t.getUid())}}i.s_transMap=new Map,e.default=i},"919c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_uid=0,this.m_mid=0,this.m_vtxUid=0,this.m_rc=null,this.indicesRes=null,this.ibuf=null,this.ibufStep=2,this.m_attachCount=0}getVTCount(){return null!=this.indicesRes?this.indicesRes.getVTCount():0}setRC(t){this.m_rc=t}setMidAndBufUid(t,e){this.m_mid=t,this.m_vtxUid=e,this.m_attachCount=0}getUid(){return this.m_uid}getVtxUid(){return this.m_vtxUid}getMid(){return this.m_mid}run(){}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}__$destroy(){i.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.ibuf=null,this.m_rc=null,this.indicesRes=null}restoreThis(){}static HasMid(t){return i.s_midMap.has(t)}static GetByMid(t){return i.s_midMap.get(t)}__$resetVRO(){i.s_mid=-1}}i.s_mid=0,i.s_midMap=new Map,e.default=i},9259:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("9a2d"),r=s("f689");class a{constructor(){this.currentIndent=0,this.allNodes=new i.FBXTree,this.nodeStack=[],this.currentProp=[],this.currentPropName=""}getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(t){this.nodeStack.push(t),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(t,e){this.currentProp=t,this.currentPropName=e}parse(t){this.currentIndent=0,this.allNodes=new i.FBXTree,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const e=this,s=t.split(/[\r\n]+/);return s.forEach((function(t,i){const r=t.match(/^[\s\t]*;/),a=t.match(/^[\s\t]*$/);if(r||a)return;const n=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){"),h=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=t.match("^\\t{"+(e.currentIndent-1)+"}}");n?e.parseNodeBegin(t,n):h?e.parseNodeProperty(t,h,s[++i]):l?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)})),this.allNodes}parseNodeBegin(t,e){const s=e[1].trim().replace(/^"/,"").replace(/"$/,""),i=e[2].split(",").map((function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")})),r={name:s},a=this.parseNodeAttr(i),n=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(s,r):s in n?("PoseNode"===s?n.PoseNode.push(r):void 0!==n[s].id&&(n[s]={},n[s][n[s].id]=n[s]),""!==a.id&&(n[s][a.id]=r)):"number"===typeof a.id?(n[s]={},n[s][a.id]=r):"Properties70"!==s&&(n[s]="PoseNode"===s?[r]:r),"number"===typeof a.id&&(r.id=a.id),""!==a.name&&(r.attrName=a.name),""!==a.type&&(r.attrType=a.type),this.pushStack(r)}parseNodeAttr(t){let e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));let s="",i="";return t.length>1&&(s=t[1].replace(/^(\w+)::/,""),i=t[2]),{id:e,name:s,type:i}}parseNodeProperty(t,e,s){let i=e[1].replace(/^"/,"").replace(/"$/,"").trim(),a=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===a&&(a=s.replace(/"/g,"").replace(/,$/,"").trim());const n=this.getCurrentNode(),h=n.name;if("Properties70"!==h){if("C"===i){const t=a.split(",").slice(1),e=parseInt(t[0]),s=parseInt(t[1]);let h=a.split(",").slice(3);h=h.map((function(t){return t.trim().replace(/^"/,"")})),i="connections",a=[e,s],r.append(a,h),void 0===n[i]&&(n[i]=[])}"Node"===i&&(n.id=a),i in n&&Array.isArray(n[i])?n[i].push(a):"a"!==i?n[i]=a:n.a=a,this.setCurrentProp(n,i),"a"===i&&","!==a.slice(-1)&&(n.a=r.parseNumberArray(a))}else this.parseNodeSpecialProperty(t,i,a)}parseNodePropertyContinued(t){const e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=r.parseNumberArray(e.a))}parseNodeSpecialProperty(t,e,s){const i=s.split('",').map((function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")})),a=i[0],n=i[1],h=i[2],l=i[3];let o=i[4];switch(n){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":o=parseFloat(o);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":o=r.parseNumberArray(o);break}this.getPrevNode()[a]={type:n,type2:h,flag:l,value:o},this.setCurrentProp(this.getPrevNode(),a)}}e.TextParser=a},9260:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("7045"));class a{static KeyDown(t){for(var e=a.m_down_listener.length,s=0;s<e;++s)a.m_down_listener[s].call(a.m_down_ers[s],t)}static KeyUp(t){let e=a.m_up_listener.length;for(let s=0;s<e;++s)a.m_up_listener[s].call(a.m_up_ers[s],t)}static RemoveEventListener(t,e){if(null!=e){let s;switch(t){case r.default.KEY_DOWN:for(s=a.m_down_listener.length-1;s>=0;--s)if(e===a.m_down_listener[s]){a.m_down_ers.splice(s,1),a.m_down_listener.splice(s,1);break}break;case r.default.KEY_UP:for(s=a.m_up_listener.length-1;s>=0;--s)if(e===a.m_up_listener[s]){a.m_up_ers.splice(s,1),a.m_up_listener.splice(s,1);break}break;default:break}}}}a.m_down_ers=[],a.m_down_listener=[],a.m_up_ers=[],a.m_up_listener=[],a.AddEventListener=function(t,e,s){if(null!=s){let i=0;switch(t){case r.default.KEY_DOWN:for(i=a.m_down_listener.length-1;i>=0;--i)if(s===a.m_down_listener[i])break;i<0&&(a.m_down_ers.push(e),a.m_down_listener.push(s));break;case r.default.KEY_UP:for(i=a.m_up_listener.length-1;i>=0;--i)if(s===a.m_up_listener[i])break;i<0&&(a.m_up_ers.push(e),a.m_up_listener.push(s));break;default:break}}},e.default=a},"937b":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("f7ee"),r=s("9a2d"),a=s("c758");class n{constructor(){this.m_reader=null,this.m_allNodes=null,this.m_version=0,this.m_parsing=!1,this.m_parsingIndex=0,this.subLossTime=0,this.nodeParsingTotal=0,this.totalBP=0,this.totalBPTime=0,this.m_isObjects=!1,this.m_isGeometry=!1,this.m_debug=!1,this.m_pptParser=new a.BufPropertyParser}parse(t){const e=new i.BinaryReader(t);e.skip(23);const s=e.getUint32();if(s<6400)throw new Error("FBXLoader: FBX version not supported, FileVersion: "+s);const a=new r.FBXTree;while(!this.endOfContent(e)){const t=this.parseNode(e,s);null!==t&&a.add(t.name,t)}return a}getFBXTree(){return this.m_allNodes}getReader(){return this.m_reader}parseBegin(t){let e=new i.BinaryReader(t);e.skip(23);const s=e.getUint32();if(s<6400)throw new Error("FBXLoader: FBX version not supported, FileVersion: "+s);this.m_reader=e,this.m_version=s,this.m_parsingIndex=0;let a=new r.FBXTree;return this.m_allNodes=a,this.m_parsing=!this.endOfContent(e),a}parseNext(){const t=this.m_allNodes,e=this.m_reader;if(this.m_parsing=!this.endOfContent(e),this.subLossTime=0,this.nodeParsingTotal=0,this.m_parsing){this.m_parsingIndex++;Date.now();const s=this.parseNode(e,this.m_version);if(null!=s){void 0!=s.name&&s.name}null!==s&&t.add(s.name,s)}}isParsing(){return this.m_parsing}endOfContent(t){return t.size()%16===0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()}parseNode(t,e){this.nodeParsingTotal++;const s={},i=e>=7500?t.getUint64():t.getUint32(),r=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();const a=t.getUint8(),n=t.getString(a);if(this.m_debug&&("Objects"==n&&(this.m_isObjects=!0),this.m_isObjects&&"Geometry"==n&&(this.m_isGeometry=!0),this.m_isGeometry),0===i)return null;const h=new Array(r);switch(this.m_pptParser.ppFlag=0,n){case"Vertices":case"Normals":case"PolygonVertexIndex":case"UV":case"NormalsIndex":this.m_pptParser.ppFlag=12;break;case"Edges":case"NormalsW":case"Materials":this.m_pptParser.ppFlag=131;break;default:break}for(let m=0;m<r;m++)h[m]=this.m_pptParser.parseProperty(t);const l=h.length>0?h[0]:"",o=h.length>1?h[1]:"",_=h.length>2?h[2]:"";s.singleProperty=1===r&&t.getOffset()===i;while(i>t.getOffset()){const i=this.parseNode(t,e);null!==i&&this.parseSubNode(n,s,i)}return s.propertyList=h,"number"===typeof l&&(s.id=l),""!==o&&(s.attrName=o),""!==_&&(s.attrType=_),""!==n&&(s.name=n),s}parseSubNode(t,e,s){if(!0===s.singleProperty){const t=s.propertyList[0];t.buffer,t instanceof Array?(e[s.name]=s,s.a=t):e[s.name]=t}else if("Connections"===t&&"C"===s.name){let t=s.propertyList,i=t.length-1;i<0&&(i=0);const r=new Array(i);for(let e=1,s=0;e<t.length;++e)r[s]=t[e],s++;void 0===e.connections&&(e.connections=[]),e.connections.push(r)}else if("Properties70"===s.name){const t=Object.keys(s);t.forEach((function(t){e[t]=s[t]}))}else if("Properties70"===t&&"P"===s.name){let t=s.propertyList[0],i=s.propertyList[1];const r=s.propertyList[2],a=s.propertyList[3];let n;0===t.indexOf("Lcl ")&&(t=t.replace("Lcl ","Lcl_")),0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),n="Color"===i||"ColorRGB"===i||"Vector"===i||"Vector3D"===i||0===i.indexOf("Lcl_")?[s.propertyList[4],s.propertyList[5],s.propertyList[6]]:s.propertyList[4],e[t]={type:i,type2:r,flag:a,value:n}}else void 0===e[s.name]?"number"===typeof s.id?(e[s.name]={},e[s.name][s.id]=s):e[s.name]=s:"PoseNode"===s.name?(Array.isArray(e[s.name])||(e[s.name]=[e[s.name]]),e[s.name].push(s)):void 0===e[s.name][s.id]&&(e[s.name][s.id]=s)}}e.BufferBinaryParser=n},9468:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("74ee"),r=s("7577");class a extends r.SceneNode{constructor(){super(),this.m_index=0}load(t){if(null!=t){super.load(t),this.m_index=0,this.m_modelsTotal=t.length,this.m_waitPartsTotal=this.m_modelsTotal,this.m_showTotal=0;for(let e=0;e<this.m_modelsTotal;++e)this.loadCTMByUrl(t[e])}}loadCTMByUrl(t){this.m_cospace.geometry.getCPUDataByUrlAndCallback(t,i.DataFormat.CTM,(t,e)=>{let s=t.data.models[0];s.normals,this.initEntity(s,null,this.m_index),this.m_index++,this.m_index==this.m_modelsTotal&&(this.m_waitPartsTotal=0)},!0)}}e.CTMSceneNode=a},"955e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("c120")),h=s("e08e"),l=i(s("29ef")),o=i(s("3930")),_=i(s("e7ce")),m=s("e160");class u{constructor(){this.m_initColor=new o.default,this.m_indexMaterial=new _.default,this.m_renderer=null,this.m_camera=null,this.m_headNode=null,this.m_rsn=null,this.m_hitList=new Uint8Array(256),this.m_rsnList=null,this.m_selectedNode=null,this.m_selectedTotal=0,this.m_testMode=0,this.m_invpv=new a.default,this.m_invtv=new a.default,this.m_rlpv=null,this.m_rltv=null,this.m_rlsiv=new Uint8Array(4),this.m_rlinvtv=new a.default,this.m_outv=new a.default,this.m_vecs=[null,null],this.m_gpuTestEnabled=!0,this.m_uintArray=new Uint8Array(4),this.m_uintList=new Uint8Array(256)}setRenderer(t){this.m_renderer=t}setRayTestMode(t){this.m_testMode=t}setRay(t,e){this.m_rlpv=t,this.m_rltv=e}getRay(t,e){t.copyFrom(this.m_rlpv),e.copyFrom(this.m_rltv)}setCamera(t){this.m_camera=t}setCullingNodeHead(t){if(this.m_headNode=t,null==this.m_rsnList){this.m_rsnList=[];let t=0;for(;t<256;++t)this.m_rsnList.push(new n.default)}}getSelectedNode(){return this.m_selectedNode}getSelectedNodes(){return this.m_rsnList}getSelectedNodesTotal(){return this.m_selectedTotal}sorting(t,e){let s=this.m_rsnList;this.m_rsn=s[t];while(t<e){while(t<e&&s[e].dis>=this.m_rsn.dis)--e;s[t]=s[e];while(t<e&&s[t].dis<=this.m_rsn.dis)++t;s[e]=s[t]}return s[t]=this.m_rsn,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}run(){let t=this.m_headNode;if(null!=t){let e=0,s=this.m_rltv,i=this.m_rlpv,a=this.m_outv,n=null,h=0;Math.abs(s.x)>r.default.MATH_MIN_POSITIVE?this.m_rlinvtv.x=1/s.x:this.m_rlinvtv.x=r.default.MATH_MAX_POSITIVE,Math.abs(s.y)>r.default.MATH_MIN_POSITIVE?this.m_rlinvtv.y=1/s.y:this.m_rlinvtv.y=r.default.MATH_MAX_POSITIVE,Math.abs(s.z)>r.default.MATH_MIN_POSITIVE?this.m_rlinvtv.z=1/s.z:this.m_rlinvtv.z=r.default.MATH_MAX_POSITIVE,this.m_rlinvtv.x<0?this.m_rlsiv[0]=1:this.m_rlsiv[0]=0,this.m_rlinvtv.y<0?this.m_rlsiv[1]=1:this.m_rlsiv[1]=0,this.m_rlinvtv.z<0?this.m_rlsiv[2]=1:this.m_rlsiv[2]=0;while(null!=t)t.drawEnabled&&t.entity.mouseEnabled&&(a.x=t.bounds.center.x-i.x,a.y=t.bounds.center.y-i.y,a.z=t.bounds.center.z-i.z,e=a.dot(s),a.x-=e*s.x,a.y-=e*s.y,a.z-=e*s.z,a.getLengthSquared()<=t.bounds.radius2&&t.rayTestState<1&&(this.m_vecs[0]=t.bounds.min,this.m_vecs[1]=t.bounds.max,m.AABBCalc.IntersectionRL3(this.m_vecs,this.m_rlsiv,this.m_rlinvtv,s,i,a)&&(n=this.m_rsnList[h],n.entity=t.entity,n.dis=this.m_rlinvtv.w,n.wpv.copyFrom(a),++h))),t=t.next;this.m_selectedNode=null;let l=0;if(h>0){let t=this.m_invpv,e=this.m_invtv,r=null,n=0,o=0,_=null,m=null,u=s.dot(i),d=0,c=!this.m_gpuTestEnabled,f=0;if(h>1){for(this.snsort(0,h-1),l=0;l<h;++l){if(m=this.m_rsnList[l],r=this.m_rsnList[l].entity,r.isPolyhedral()?c?(_=r.getInvMatrix(),_.transformOutVector3(i,t),_.deltaTransformOutVector(s,e),e.normalize(),n=r.testRay(t,e,a,!0)):(++f,n=0):(_=r.getInvMatrix(),_.transformOutVector3(i,t),_.deltaTransformOutVector(s,e),e.normalize(),n=r.testRay(t,e,a,!0)),n>0){if(m.lpv.copyFrom(a),r.getMatrix().transformOutVector3(a,m.wpv),m.dis=s.dot(m.wpv)-u,this.m_hitList[o]=l,++o,m.dis>d){this.m_selectedNode=m;break}}else if(n<0&&(this.m_hitList[o]=l,++o,m.dis>d)){this.m_selectedNode=m;break}d=m.dis}null==this.m_selectedNode&&o>0&&(this.m_selectedNode=this.m_rsnList[this.m_hitList[0]])}else m=this.m_rsnList[0],r=this.m_rsnList[0].entity,_=r.getInvMatrix(),_.transformOutVector3(i,t),_.deltaTransformOutVector(s,e),e.normalize(),r.isPolyhedral()?c?n=r.testRay(t,e,a,!0):(++f,n=0):n=r.testRay(t,e,a,!0),n>0?(m.lpv.copyFrom(a),r.getMatrix().transformOutVector3(a,m.wpv),m.dis=s.dot(m.wpv)-u,this.m_selectedNode=m):n<0&&(this.m_selectedNode=m);f>0&&(this.m_testMode<1||null==this.m_selectedNode||this.m_selectedNode.entity.isPolyhedral())&&this.gpuPick(h)}for(l=h;l<this.m_selectedTotal;++l)this.m_selectedNode!=this.m_rsnList[l]&&(this.m_rsnList[l].entity=null);this.m_selectedTotal=h}}gpuPick(t){let e=this.m_renderer.getRendererContext(),s=this.m_renderer.getRenderProxy(),i=s.getStage3D().mouseX,r=s.getStage3D().mouseY;e.vertexRenderBegin(),e.getClearRGBAColor4f(this.m_initColor),e.setClearRGBAColor4f(0,0,0,0),e.setScissorEnabled(!0),e.setScissorRect(i,r,1,1),e.clearBackBuffer(),this.m_uintArray[3]=0,l.default.LockBlendMode(h.RenderBlendMode.OPAQUE),l.default.LockDepthTestMode(h.DepthTestMode.OPAQUE),e.unlockMaterial(),e.unlockRenderState(),e.useGlobalMaterial(this.m_indexMaterial,!1,!1);let a=null,n=null,o=-1,_=0;for(;_<t;++_)a=this.m_rsnList[_],n=this.m_rsnList[_].entity,n.isPolyhedral()&&(++o,this.m_indexMaterial.setIndex(o+2),this.m_uintList[o]=_,this.m_renderer.updateMaterialUniformToCurrentShd(this.m_indexMaterial),this.m_renderer.drawEntity(n,!1,!0));if(o>-1&&s.readPixels(i,r,1,1,s.RGBA,s.UNSIGNED_BYTE,this.m_uintArray),l.default.UnlockBlendMode(),l.default.UnlockDepthTestMode(),this.m_uintArray[3]>1){_=this.m_uintList[this.m_uintArray[3]-2],a=this.m_rsnList[_];let t=(this.m_uintArray[0]<<8)+this.m_uintArray[1]+this.m_uintArray[2]/255;if(null!=this.m_selectedNode){let e=this.m_selectedNode.entity;this.m_selectedNode==a||e.isPolyhedral()||this.m_selectedNode.dis<t&&(_=-1)}_>-1&&(a.dis=t,this.getWorldPosByRayDistance(t,this.m_rltv,this.m_camera.getPosition(),a.wpv),this.m_selectedNode=a)}e.setScissorEnabled(!1),e.unlockMaterial(),e.unlockRenderState(),l.default.UnlockBlendMode(),l.default.UnlockDepthTestMode(),e.setClearRGBAColor4f(this.m_initColor.r,this.m_initColor.g,this.m_initColor.b,this.m_initColor.a),e.resetState()}clear(){this.m_selectedNode=null}getWorldPosByRayDistance(t,e,s,i){i.x=e.x*t+s.x,i.y=e.y*t+s.y,i.z=e.z*t+s.z}}e.default=u},9666:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("acfe"));class n{static CreateShdData(t,e,s,i,h){if(n.s_shdDataDict.has(t))return n.s_shdDataDict.get(t);let l=new a.default;return l.adaptationShaderVersion=i,l.preCompileInfo=h,l.initialize(t,e,s),n.s_shdDataList[l.getUid()]=l,++n.s_shdDataListLen,n.s_shdDataDict.set(t,l),r.default.SHADERCODE_TRACE_ENABLED,l}static FindData(t){return n.s_shdDataDict.has(t)?n.s_shdDataDict.get(t):null}}n.s_shdDataDict=new Map,n.s_shdDataList=[],n.s_shdDataListLen=0,e.default=n},"984e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.width=0,this.height=0,this.depth=0,this.sampler=0,this.texBuf=null,this.m_attachCount=0}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}bindToGpu(t){t.bindTexture(this.sampler,this.texBuf)}getAttachCount(){return this.m_attachCount}}class r{constructor(t,e){this.m_resMap=new Map,this.m_freeMap=new Map,this.m_texResTotal=0,this.m_attachTotal=0,this.m_delay=128,this.m_rcuid=0,this.m_gl=null,this.texMid=-1,this.unlocked=!0,this.m_rcuid=t,this.m_gl=e}createBuf(){return this.m_gl.createTexture()}createResByParams3(t,e,s,r){if(!this.m_resMap.has(t)){let a=new i;return a.rcuid=this.getRCUid(),a.resUid=t,a.width=e,a.height=s,a.sampler=r,a.texBuf=this.createBuf(),a.texBuf.resUid=t,this.addTextureRes(a),!0}return!1}getRCUid(){return this.m_rcuid}getRC(){return this.m_gl}hasResUid(t){return this.m_resMap.has(t)}renderBegin(){this.texMid=-1}getTextureResTotal(){return this.m_texResTotal}addTextureRes(t){this.m_resMap.has(t.resUid)||(t.waitDelTimes=0,this.m_resMap.set(t.resUid,t),this.m_texResTotal++)}getGpuBuffer(t){return this.m_resMap.has(t)?this.m_resMap.get(t).texBuf:null}bindToGpu(t){this.m_resMap.has(t)&&this.m_resMap.get(t).bindToGpu(this.m_gl)}getAttachTotal(){return this.m_attachTotal}__$attachRes(t){if(this.m_resMap.has(t)){this.m_attachTotal++;let e=this.m_resMap.get(t);e.getAttachCount()<1&&this.m_freeMap.has(t)&&this.m_freeMap.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.m_resMap.has(t)&&this.m_resMap.has(t)){let e=this.m_resMap.get(t);e.getAttachCount()>0&&(this.m_attachTotal--,e.__$detachThis(),e.getAttachCount()<1&&this.m_freeMap.set(t,e))}}update(){if(this.m_delay--,this.m_delay<1){this.m_delay=128;for(const[t,e]of this.m_freeMap)e.waitDelTimes++,e.waitDelTimes>5&&(this.m_resMap.delete(e.resUid),this.m_freeMap.delete(e.resUid),this.m_gl.deleteTexture(e.texBuf),e.texBuf=null,this.m_texResTotal--)}}}e.default=r},"9a2d":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.map={}}add(t,e){this.map[t]=e}}e.FBXTree=i},"9c3c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("38de")),n=i(s("fecb")),h=i(s("8a0a")),l=i(s("cb29")),o=i(s("e7d2")),_=s("e08e");class m extends l.default{constructor(t=h.default.VTX_STATIC_DRAW){super(t),this.m_vs=null,this.m_cvs=null,this.m_lsTotal=0,this.rayTestRadius=2}getVS(){return this.m_vs}getCVS(){return this.m_vs}initialize(t,e){t.length>=6&&(this.vtCount=Math.floor(t.length/3),this.m_lsTotal=Math.floor(this.vtCount/2),this.m_vs=new Float32Array(t),null==this.bounds&&(this.bounds=new n.default),this.bounds.addXYZFloat32Arr(this.m_vs),this.bounds.updateFast(),o.default.Reset(),o.default.AddFloat32Data(this.m_vs,3),this.isVBufEnabledAt(h.default.VBUF_CVS_INDEX)&&(this.m_cvs=new Float32Array(e),o.default.AddFloat32Data(this.m_cvs,3)),o.default.vbWholeDataEnabled=this.vbWholeDataEnabled,null!=this.m_vbuf?o.default.UpdateBufData(this.m_vbuf):this.m_vbuf=o.default.CreateBySaveData(this.getBufDataUsage()),this.drawMode=_.RenderDrawMode.ARRAYS_LINES,this.buildEnd())}setVSXYZAt(t,e,s,i){null!=this.m_vbuf&&this.m_vbuf.setData3fAt(t,0,e,s,i)}toString(){return"DashedLineMesh()"}isPolyhedral(){return!1}testRay(t,e,s,i){let r=0,n=this.m_vs,h=0,l=this.rayTestRadius;for(let o=0;o<this.m_lsTotal;++o){if(m.s_pv0.setXYZ(n[r],n[r+1],n[r+2]),m.s_pv1.setXYZ(n[r+3],n[r+4],n[r+5]),h=a.default.IntersectionLS(t,e,m.s_pv0,m.s_pv1,s,l),h>0)return 1;r+=6}return 0}__$destroy(){this.isResFree()&&(this.bounds=null,this.m_vs=null,this.m_cvs=null,super.__$destroy())}}m.s_pv0=new r.default,m.s_pv1=new r.default,e.default=m},"9c4d":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.prev=null,this.next=null,this.flag=0,this.target=null}reset(){this.flag=0,this.target=null}}class r{constructor(){this.m_begin=null,this.m_end=null}destroy(){this.clear()}clear(){this.m_begin=this.m_end=null}getBegin(){return this.m_begin}isEmpty(){return this.m_begin==this.m_end&&null==this.m_end}addNode(t){null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null}removeNode(t){t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}class a{constructor(){this.m_linker=new r,this.m_freeIds=[],this.m_runners=[new i]}getFreeId(){if(this.m_freeIds.length>0)return this.m_freeIds.pop();let t=new i;return t.flag=this.m_runners.length,this.m_runners.push(t),t.flag}addRunner(t){if(null!=t&&t.getRunFlag()<1){let e=this.getFreeId(),s=this.m_runners[e];s.flag=e,s.target=t,t.setRunFlag(e),this.m_linker.addNode(s)}}removeRunner(t){if(null!=t&&t.getRunFlag()>0){let e=t.getRunFlag();this.m_freeIds.push(e);let s=this.m_runners[e];s.flag=e,s.target=null,t.setRunFlag(0),this.m_linker.removeNode(s)}}run(){let t=this.m_linker.getBegin(),e=t;while(null!=e)t=e,e=t.next,t.target.isRunning()&&t.target.run()}}e.default=a},"9cb6":function(t,e,s){"use strict";s.r(e),s.d(e,"Deflate",(function(){return Nt})),s.d(e,"AsyncDeflate",(function(){return Ut})),s.d(e,"deflate",(function(){return Ot})),s.d(e,"deflateSync",(function(){return It})),s.d(e,"Inflate",(function(){return Vt})),s.d(e,"AsyncInflate",(function(){return kt})),s.d(e,"inflate",(function(){return zt})),s.d(e,"inflateSync",(function(){return Gt})),s.d(e,"Gzip",(function(){return Ht})),s.d(e,"AsyncGzip",(function(){return Wt})),s.d(e,"gzip",(function(){return Xt})),s.d(e,"gzipSync",(function(){return Yt})),s.d(e,"Gunzip",(function(){return $t})),s.d(e,"AsyncGunzip",(function(){return jt})),s.d(e,"gunzip",(function(){return Zt})),s.d(e,"gunzipSync",(function(){return Kt})),s.d(e,"Zlib",(function(){return qt})),s.d(e,"AsyncZlib",(function(){return Qt})),s.d(e,"zlib",(function(){return Jt})),s.d(e,"zlibSync",(function(){return te})),s.d(e,"Unzlib",(function(){return ee})),s.d(e,"AsyncUnzlib",(function(){return se})),s.d(e,"unzlib",(function(){return ie})),s.d(e,"unzlibSync",(function(){return re})),s.d(e,"compress",(function(){return Xt})),s.d(e,"AsyncCompress",(function(){return Wt})),s.d(e,"compressSync",(function(){return Yt})),s.d(e,"Compress",(function(){return Ht})),s.d(e,"Decompress",(function(){return ae})),s.d(e,"AsyncDecompress",(function(){return ne})),s.d(e,"decompress",(function(){return he})),s.d(e,"decompressSync",(function(){return le})),s.d(e,"DecodeUTF8",(function(){return ce})),s.d(e,"EncodeUTF8",(function(){return fe})),s.d(e,"strToU8",(function(){return pe})),s.d(e,"strFromU8",(function(){return ge})),s.d(e,"ZipPassThrough",(function(){return Ae})),s.d(e,"ZipDeflate",(function(){return Re})),s.d(e,"AsyncZipDeflate",(function(){return Me})),s.d(e,"Zip",(function(){return De})),s.d(e,"zip",(function(){return Le})),s.d(e,"zipSync",(function(){return Pe})),s.d(e,"UnzipPassThrough",(function(){return Be})),s.d(e,"UnzipInflate",(function(){return Fe})),s.d(e,"AsyncUnzipInflate",(function(){return we})),s.d(e,"Unzip",(function(){return Ce})),s.d(e,"unzip",(function(){return Ne})),s.d(e,"unzipSync",(function(){return Ue}));
/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/
var i=Uint8Array,r=Uint16Array,a=Uint32Array,n=new i([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),h=new i([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),l=new i([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(t,e){for(var s=new r(31),i=0;i<31;++i)s[i]=e+=1<<t[i-1];var n=new a(s[30]);for(i=1;i<30;++i)for(var h=s[i];h<s[i+1];++h)n[h]=h-s[i]<<5|i;return[s,n]},_=o(n,2),m=_[0],u=_[1];m[28]=258,u[258]=28;for(var d=o(h,0),c=d[0],f=d[1],p=new r(32768),g=0;g<32768;++g){var T=(43690&g)>>>1|(21845&g)<<1;T=(52428&T)>>>2|(13107&T)<<2,T=(61680&T)>>>4|(3855&T)<<4,p[g]=((65280&T)>>>8|(255&T)<<8)>>>1}var y=new i(288),E=function(t,e,s){for(var i=t.length,a=0,n=new r(e);a<i;++a)++n[t[a]-1];var h,l=new r(e);for(a=0;a<e;++a)l[a]=l[a-1]+n[a-1]<<1;if(s){h=new r(1<<e);var o=15-e;for(a=0;a<i;++a)if(t[a])for(var _=a<<4|t[a],m=e-t[a],u=l[t[a]-1]++<<m,d=u|(1<<m)-1;u<=d;++u)h[p[u]>>>o]=_}else for(h=new r(i),a=0;a<i;++a)t[a]&&(h[a]=p[l[t[a]-1]++]>>>15-t[a]);return h},x=y;for(g=0;g<144;++g)x[g]=8;for(g=144;g<256;++g)x[g]=9;for(g=256;g<280;++g)x[g]=7;for(g=280;g<288;++g)x[g]=8;var v=new i(32);for(g=0;g<32;++g)v[g]=5;var S=E(x,9,0),b=E(x,9,1),A=E(v,5,0),R=E(v,5,1),M=function(t){for(var e=t[0],s=1;s<t.length;++s)t[s]>e&&(e=t[s]);return e},D=function(t,e,s){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(7&e)&s},L=function(t,e){var s=e/8|0;return(t[s]|t[s+1]<<8|t[s+2]<<16)>>(7&e)},P=function(t){return(t/8|0)+(7&t&&1)},B=function(t,e,s){(null==e||e<0)&&(e=0),(null==s||s>t.length)&&(s=t.length);var n=new(t instanceof r?r:t instanceof a?a:i)(s-e);return n.set(t.subarray(e,s)),n},F=function(t,e,s){return t},w=new i(19);let C=new i(1024);function N(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}let U=new Array(128);U.fill(null);let O=0;var I=function(t,e,s){var r=t.length;if(!r||s&&!s.l&&r<5)return e||new i(0);var a=!e||s,o=!s||s.i;if(s||(s={}),!e){O=r;let t=N(O),s=Math.log2(t);e=U[s],null==e&&(e=new i(t),U[s]=e)}var _=function(t){var s=e.length;if(t>s){O=t;let s=N(O),a=Math.log2(s);var r=U[a];null==r&&(O<=536870912?(r=new i(s),U[a]=r):(s=O+262144,r=new i(s))),r.set(e),e=r}},u=s.f||0,d=s.p||0,f=s.b||0,p=s.l,g=s.d,T=s.m,y=s.n;let x=8*r;do{if(!p){s.f=u=D(t,d,1);var v=D(t,d+1,3);if(d+=3,!v){var S=P(d)+4,A=t[S-4]|t[S-3]<<8,B=S+A;if(B>r){if(o)throw"unexpected EOF";break}a&&_(f+A),e.set(t.subarray(S,B),f),s.b=f+=A,s.p=d=8*B;continue}if(1==v)p=b,g=R,T=9,y=5;else{if(2!=v)throw"invalid block type";{var I=D(t,d,31)+257,V=D(t,d+10,15)+4,k=I+D(t,d+5,31)+1;d+=14;let e=C.subarray(0,k);for(let t=0;t<k;++t)e[t]=0;let s=w;for(let t=0;t<19;++t)s[t]=0;for(var z=0;z<V;++z)s[l[z]]=D(t,d+3*z,7);d+=3*V;var G=M(s),H=(1<<G)-1,W=E(s,G,1);for(z=0;z<k;){var X=W[D(t,d,H)];d+=15&X;S=X>>>4;if(S<16)e[z++]=S;else{var Y=0,$=0;16==S?($=3+D(t,d,3),d+=2,Y=e[z-1]):17==S?($=3+D(t,d,7),d+=3):18==S&&($=11+D(t,d,127),d+=7);while($--)e[z++]=Y}}var j=e.subarray(0,I),Z=e.subarray(I);T=M(j),y=M(Z),p=E(j,T,1),g=E(Z,y,1)}}if(d>x){if(o)throw"unexpected EOF";break}}a&&_(f+131072);for(var K=(1<<T)-1,q=(1<<y)-1,Q=d;;Q=d){Y=p[L(t,d)&K];var J=Y>>>4;if(d+=15&Y,d>x){if(o)throw"unexpected EOF";break}if(!Y)throw"invalid length/literal";if(J<256)e[f++]=J;else{if(256==J){Q=d,p=null;break}var tt=J-254;if(J>264){z=J-257;var et=n[z];tt=D(t,d,(1<<et)-1)+m[z],d+=et}var st=g[L(t,d)&q],it=st>>>4;if(!st)throw"invalid distance";d+=15&st;Z=c[it];if(it>3){et=h[it];Z+=L(t,d)&(1<<et)-1,d+=et}if(d>x){if(o)throw"unexpected EOF";break}a&&_(f+131072);for(var rt=f+tt;f<rt;f+=4)e[f]=e[f-Z],e[f+1]=e[f+1-Z],e[f+2]=e[f+2-Z],e[f+3]=e[f+3-Z];f=rt}}s.l=p,s.p=Q,s.b=f,p&&(u=1,s.m=T,s.d=g,s.n=y)}while(!u);return f==e.length?e:F(e,0,f)},V=function(t,e,s){s<<=7&e;var i=e/8|0;t[i]|=s,t[i+1]|=s>>>8},k=function(t,e,s){s<<=7&e;var i=e/8|0;t[i]|=s,t[i+1]|=s>>>8,t[i+2]|=s>>>16},z=function(t,e){for(var s=[],a=0;a<t.length;++a)t[a]&&s.push({s:a,f:t[a]});var n=s.length,h=s.slice();if(!n)return[K,0];if(1==n){var l=new i(s[0].s+1);return l[s[0].s]=1,[l,1]}s.sort((function(t,e){return t.f-e.f})),s.push({s:-1,f:25001});var o=s[0],_=s[1],m=0,u=1,d=2;s[0]={s:-1,f:o.f+_.f,l:o,r:_};while(u!=n-1)o=s[s[m].f<s[d].f?m++:d++],_=s[m!=u&&s[m].f<s[d].f?m++:d++],s[u++]={s:-1,f:o.f+_.f,l:o,r:_};var c=h[0].s;for(a=1;a<n;++a)h[a].s>c&&(c=h[a].s);var f=new r(c+1),p=G(s[u-1],f,0);if(p>e){a=0;var g=0,T=p-e,y=1<<T;for(h.sort((function(t,e){return f[e.s]-f[t.s]||t.f-e.f}));a<n;++a){var E=h[a].s;if(!(f[E]>e))break;g+=y-(1<<p-f[E]),f[E]=e}g>>>=T;while(g>0){var x=h[a].s;f[x]<e?g-=1<<e-f[x]++-1:++a}for(;a>=0&&g;--a){var v=h[a].s;f[v]==e&&(--f[v],++g)}p=e}return[new i(f),p]},G=function(t,e,s){return-1==t.s?Math.max(G(t.l,e,s+1),G(t.r,e,s+1)):e[t.s]=s},H=function(t){var e=t.length;while(e&&!t[--e]);for(var s=new r(++e),i=0,a=t[0],n=1,h=function(t){s[i++]=t},l=1;l<=e;++l)if(t[l]==a&&l!=e)++n;else{if(!a&&n>2){for(;n>138;n-=138)h(32754);n>2&&(h(n>10?n-11<<5|28690:n-3<<5|12305),n=0)}else if(n>3){for(h(a),--n;n>6;n-=6)h(8304);n>2&&(h(n-3<<5|8208),n=0)}while(n--)h(a);n=1,a=t[l]}return[s.subarray(0,i),e]},W=function(t,e){for(var s=0,i=0;i<e.length;++i)s+=t[i]*e[i];return s},X=function(t,e,s){var i=s.length,r=P(e+2);t[r]=255&i,t[r+1]=i>>>8,t[r+2]=255^t[r],t[r+3]=255^t[r+1];for(var a=0;a<i;++a)t[r+a+4]=s[a];return 8*(r+4+i)};let Y=new r(19),$=new r(19);var j=function(t,e,s,i,r,a,o,_,m,u,d){V(e,d++,s),++r[256];var c=z(r,15),f=c[0],p=c[1],g=z(a,15),T=g[0],y=g[1],b=H(f),R=b[0],M=b[1],D=H(T),L=D[0],P=D[1];let B=$;B.set(Y);for(var F=0;F<R.length;++F)B[31&R[F]]++;for(F=0;F<L.length;++F)B[31&L[F]]++;for(var w=z(B,7),C=w[0],N=w[1],U=19;U>4&&!C[l[U-1]];--U);var O,I,G,j,Z=u+5<<3,K=W(r,x)+W(a,v)+o,q=W(r,f)+W(a,T)+o+14+3*U+W(B,C)+(2*B[16]+3*B[17]+7*B[18]);if(Z<=K&&Z<=q)return X(e,d,t.subarray(m,m+u));if(V(e,d,1+(q<K)),d+=2,q<K){O=E(f,p,0),I=f,G=E(T,y,0),j=T;var Q=E(C,N,0);V(e,d,M-257),V(e,d+5,P-1),V(e,d+10,U-4),d+=14;for(F=0;F<U;++F)V(e,d+3*F,C[l[F]]);d+=3*U;for(var J=[R,L],tt=0;tt<2;++tt){var et=J[tt];for(F=0;F<et.length;++F){var st=31&et[F];V(e,d,Q[st]),d+=C[st],st>15&&(V(e,d,et[F]>>>5&127),d+=et[F]>>>12)}}}else O=S,I=x,G=A,j=v;for(F=0;F<_;++F)if(i[F]>255){st=i[F]>>>18&31;k(e,d,O[st+257]),d+=I[st+257],st>7&&(V(e,d,i[F]>>>23&31),d+=n[st]);var it=31&i[F];k(e,d,G[it]),d+=j[it],it>3&&(k(e,d,i[F]>>>5&8191),d+=h[it])}else k(e,d,O[i[F]]),d+=I[i[F]];return k(e,d,O[256]),d+I[256]},Z=new a([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),K=new i(0);let q=new a(25e3),Q=new a(25e3),J=new r(288),tt=new r(32),et=new r(288),st=new r(32);var it=function(t,e,s,a,l,o){var _=t.length,m=new i(a+_+5*(1+Math.ceil(_/7e3))+l),d=m.subarray(a,m.length-l),c=0;if(!e||_<8)for(var p=0;p<=_;p+=65535){var g=p+65535;g<_?c=X(d,c,t.subarray(p,g)):(d[p]=o,c=X(d,c,t.subarray(p,_)))}else{var T=Z[e-1],y=T>>>13,E=8191&T,x=(1<<s)-1,v=new r(32768),S=new r(x+1),b=Math.ceil(s/3),A=2*b,R=function(e){return(t[e]^t[e+1]<<b^t[e+2]<<A)&x};let i=Q;i.set(q);let a=et;a.set(J);let l=st;l.set(tt);let m=0,p=0,g=0,P=0,B=0,at=0;for(;g<_;++g){var M=R(g),D=32767&g,L=S[M];if(v[D]=L,S[M]=D,B<=g){var F=_-g;if((m>7e3||P>24576)&&F>423){c=j(t,d,0,i,a,l,p,P,at,g-at,c),P=m=p=0,at=g;for(var w=0;w<286;++w)a[w]=0;for(w=0;w<30;++w)l[w]=0}var C=2,N=0,U=E,O=D-L&32767;if(F>2&&M==R(g-O)){var I=Math.min(y,F)-1,V=Math.min(32767,g),k=Math.min(258,F);while(O<=V&&--U&&D!=L){if(t[g+C]==t[g+C-O]){for(var z=0;z<k&&t[g+z]==t[g+z-O];++z);if(z>C){if(C=z,N=O,z>I)break;var G=Math.min(O,z-2),H=0;for(w=0;w<G;++w){var W=g-O+w+32768&32767,Y=v[W],$=W-Y+32768&32767;$>H&&(H=$,L=W)}}}D=L,L=v[D],O+=D-L+32768&32767}}if(N){i[P++]=268435456|u[C]<<18|f[N];var it=31&u[C],rt=31&f[N];p+=n[it]+h[rt],++a[257+it],++l[rt],B=g+C,++m}else i[P++]=t[g],++a[t[g]]}}c=j(t,d,o,i,a,l,p,P,at,g-at,c),!o&&7&c&&(c=X(d,c+1,K))}return B(m,0,a+P(c)+l)},rt=function(){for(var t=new a(256),e=0;e<256;++e){var s=e,i=9;while(--i)s=(1&s&&3988292384)^s>>>1;t[e]=s}return t}(),at=function(){var t=-1;return{p:function(e){for(var s=t,i=0;i<e.length;++i)s=rt[255&s^e[i]]^s>>>8;t=s},d:function(){return~t}}},nt=function(){var t=1,e=0;return{p:function(s){for(var i=t,r=e,a=s.length,n=0;n!=a;){for(var h=Math.min(n+2655,a);n<h;++n)r+=i+=s[n];i=(65535&i)+15*(i>>16),r=(65535&r)+15*(r>>16)}t=i,e=r},d:function(){return t%=65521,e%=65521,(255&t)<<24|t>>>8<<16|(255&e)<<8|e>>>8}}},ht=function(t,e,s,i,r){return it(t,null==e.level?6:e.level,null==e.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):12+e.mem,s,i,!r)},lt=function(t,e){var s={};for(var i in t)s[i]=t[i];for(var i in e)s[i]=e[i];return s},ot=function(t,e,s){for(var i=t(),r=t.toString(),a=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/ /g,"").split(","),n=0;n<i.length;++n){var h=i[n],l=a[n];if("function"==typeof h){e+=";"+l+"=";var o=h.toString();if(h.prototype)if(-1!=o.indexOf("[native code]")){var _=o.indexOf(" ",8)+1;e+=o.slice(_,o.indexOf("(",_))}else for(var m in e+=o,h.prototype)e+=";"+l+".prototype."+m+"="+h.prototype[m].toString();else e+=o}else s[l]=h}return[e,s]},_t=[],mt=function(t){var e=[];for(var s in t)(t[s]instanceof i||t[s]instanceof r||t[s]instanceof a)&&e.push((t[s]=new t[s].constructor(t[s])).buffer);return e},ut=function(t,e,s,i){var r;if(!_t[s]){for(var a="",n={},h=t.length-1,l=0;l<h;++l)r=ot(t[l],a,n),a=r[0],n=r[1];_t[s]=ot(t[h],a,n)}var o=lt({},_t[s][1]);return wk(_t[s][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",s,o,mt(o),i)},dt=function(){return[i,r,a,n,h,l,m,c,b,R,p,E,M,D,L,P,B,I,Gt,yt,Et]},ct=function(){return[i,r,a,n,h,l,u,f,S,x,A,v,p,Z,K,E,V,k,z,G,H,W,X,j,P,B,it,ht,It,yt]},ft=function(){return[Dt,Bt,Mt,at,rt]},pt=function(){return[Lt,Pt]},gt=function(){return[Ft,Mt,nt]},Tt=function(){return[wt]},yt=function(t){return postMessage(t,[t.buffer])},Et=function(t){return t&&t.size&&new i(t.size)},xt=function(t,e,s,i,r,a){var n=ut(s,i,r,(function(t,e){n.terminate(),a(t,e)}));return n.postMessage([t,e],e.consume?[t.buffer]:[]),function(){n.terminate()}},vt=function(t){return t.ondata=function(t,e){return postMessage([t,e],[t.buffer])},function(e){return t.push(e.data[0],e.data[1])}},St=function(t,e,s,i,r){var a,n=ut(t,i,r,(function(t,s){t?(n.terminate(),e.ondata.call(e,t)):(s[1]&&n.terminate(),e.ondata.call(e,t,s[0],s[1]))}));n.postMessage(s),e.push=function(t,s){if(a)throw"stream finished";if(!e.ondata)throw"no stream handler";n.postMessage([t,a=s],[t.buffer])},e.terminate=function(){n.terminate()}},bt=function(t,e){return t[e]|t[e+1]<<8},At=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},Rt=function(t,e){return At(t,e)+4294967296*At(t,e+4)},Mt=function(t,e,s){for(;s;++e)t[e]=s,s>>>=8},Dt=function(t,e){var s=e.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=e.level<2?4:9==e.level?2:0,t[9]=3,0!=e.mtime&&Mt(t,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),s){t[3]=8;for(var i=0;i<=s.length;++i)t[i+10]=s.charCodeAt(i)}},Lt=function(t){if(31!=t[0]||139!=t[1]||8!=t[2])throw"invalid gzip data";var e=t[3],s=10;4&e&&(s+=t[10]|2+(t[11]<<8));for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!t[s++]);return s+(2&e)},Pt=function(t){var e=t.length;return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0},Bt=function(t){return 10+(t.filename&&t.filename.length+1||0)},Ft=function(t,e){var s=e.level,i=0==s?0:s<6?1:9==s?3:2;t[0]=120,t[1]=i<<6|(i?32-2*i:1)},wt=function(t){if(8!=(15&t[0])||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(32&t[1])throw"invalid zlib data: preset dictionaries not supported"};function Ct(t,e){return e||"function"!=typeof t||(e=t,t={}),this.ondata=e,t}var Nt=function(){function t(t,e){e||"function"!=typeof t||(e=t,t={}),this.ondata=e,this.o=t||{}}return t.prototype.p=function(t,e){this.ondata(ht(t,this.o,0,0,!e),e)},t.prototype.push=function(t,e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=e,this.p(t,e||!1)},t}(),Ut=function(){function t(t,e){St([ct,function(){return[vt,Nt]}],this,Ct.call(this,t,e),(function(t){var e=new Nt(t.data);onmessage=vt(e)}),6)}return t}();function Ot(t,e,s){if(s||(s=e,e={}),"function"!=typeof s)throw"no callback";return xt(t,e,[ct],(function(t){return yt(It(t.data[0],t.data[1]))}),0,s)}function It(t,e){return ht(t,e||{},0,0)}var Vt=function(){function t(t){this.s={},this.p=new i(0),this.ondata=t}return t.prototype.e=function(t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var e=this.p.length,s=new i(e+t.length);s.set(this.p),s.set(t,e),this.p=s},t.prototype.c=function(t){this.d=this.s.i=t||!1;var e=this.s.b,s=I(this.p,this.o,this.s);this.ondata(B(s,e,this.s.b),this.d),this.o=B(s,this.s.b-32768),this.s.b=this.o.length,this.p=B(this.p,this.s.p/8|0),this.s.p&=7},t.prototype.push=function(t,e){this.e(t),this.c(e)},t}(),kt=function(){function t(t){this.ondata=t,St([dt,function(){return[vt,Vt]}],this,0,(function(){var t=new Vt;onmessage=vt(t)}),7)}return t}();function zt(t,e,s){if(s||(s=e,e={}),"function"!=typeof s)throw"no callback";return xt(t,e,[dt],(function(t){return yt(Gt(t.data[0],Et(t.data[1])))}),1,s)}function Gt(t,e){return I(t,e)}var Ht=function(){function t(t,e){this.c=at(),this.l=0,this.v=1,Nt.call(this,t,e)}return t.prototype.push=function(t,e){Nt.prototype.push.call(this,t,e)},t.prototype.p=function(t,e){this.c.p(t),this.l+=t.length;var s=ht(t,this.o,this.v&&Bt(this.o),e&&8,!e);this.v&&(Dt(s,this.o),this.v=0),e&&(Mt(s,s.length-8,this.c.d()),Mt(s,s.length-4,this.l)),this.ondata(s,e)},t}(),Wt=function(){function t(t,e){St([ct,ft,function(){return[vt,Nt,Ht]}],this,Ct.call(this,t,e),(function(t){var e=new Ht(t.data);onmessage=vt(e)}),8)}return t}();function Xt(t,e,s){if(s||(s=e,e={}),"function"!=typeof s)throw"no callback";return xt(t,e,[ct,ft,function(){return[Yt]}],(function(t){return yt(Yt(t.data[0],t.data[1]))}),2,s)}function Yt(t,e){e||(e={});var s=at(),i=t.length;s.p(t);var r=ht(t,e,Bt(e),8),a=r.length;return Dt(r,e),Mt(r,a-8,s.d()),Mt(r,a-4,i),r}var $t=function(){function t(t){this.v=1,Vt.call(this,t)}return t.prototype.push=function(t,e){if(Vt.prototype.e.call(this,t),this.v){var s=this.p.length>3?Lt(this.p):4;if(s>=this.p.length&&!e)return;this.p=this.p.subarray(s),this.v=0}if(e){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Vt.prototype.c.call(this,e)},t}(),jt=function(){function t(t){this.ondata=t,St([dt,pt,function(){return[vt,Vt,$t]}],this,0,(function(){var t=new $t;onmessage=vt(t)}),9)}return t}();function Zt(t,e,s){if(s||(s=e,e={}),"function"!=typeof s)throw"no callback";return xt(t,e,[dt,pt,function(){return[Kt]}],(function(t){return yt(Kt(t.data[0]))}),3,s)}function Kt(t,e){return I(t.subarray(Lt(t),-8),e||new i(Pt(t)))}var qt=function(){function t(t,e){this.c=nt(),this.v=1,Nt.call(this,t,e)}return t.prototype.push=function(t,e){Nt.prototype.push.call(this,t,e)},t.prototype.p=function(t,e){this.c.p(t);var s=ht(t,this.o,this.v&&2,e&&4,!e);this.v&&(Ft(s,this.o),this.v=0),e&&Mt(s,s.length-4,this.c.d()),this.ondata(s,e)},t}(),Qt=function(){function t(t,e){St([ct,gt,function(){return[vt,Nt,qt]}],this,Ct.call(this,t,e),(function(t){var e=new qt(t.data);onmessage=vt(e)}),10)}return t}();function Jt(t,e,s){if(s||(s=e,e={}),"function"!=typeof s)throw"no callback";return xt(t,e,[ct,gt,function(){return[te]}],(function(t){return yt(te(t.data[0],t.data[1]))}),4,s)}function te(t,e){e||(e={});var s=nt();s.p(t);var i=ht(t,e,2,4);return Ft(i,e),Mt(i,i.length-4,s.d()),i}var ee=function(){function t(t){this.v=1,Vt.call(this,t)}return t.prototype.push=function(t,e){if(Vt.prototype.e.call(this,t),this.v){if(this.p.length<2&&!e)return;this.p=this.p.subarray(2),this.v=0}if(e){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Vt.prototype.c.call(this,e)},t}(),se=function(){function t(t){this.ondata=t,St([dt,Tt,function(){return[vt,Vt,ee]}],this,0,(function(){var t=new ee;onmessage=vt(t)}),11)}return t}();function ie(t,e,s){if(s||(s=e,e={}),"function"!=typeof s)throw"no callback";return xt(t,e,[dt,Tt,function(){return[re]}],(function(t){return yt(re(t.data[0],Et(t.data[1])))}),5,s)}function re(t,e){let s=(wt(t),t.subarray(2,-4));return I(s,e)}var ae=function(){function t(t){this.G=$t,this.I=Vt,this.Z=ee,this.ondata=t}return t.prototype.push=function(t,e){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(t,e);else{if(this.p&&this.p.length){var s=new i(this.p.length+t.length);s.set(this.p),s.set(t,this.p.length)}else this.p=t;if(this.p.length>2){var r=this,a=function(){r.ondata.apply(r,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(a):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(a):new this.Z(a),this.s.push(this.p,e),this.p=null}}},t}(),ne=function(){function t(t){this.G=jt,this.I=kt,this.Z=se,this.ondata=t}return t.prototype.push=function(t,e){ae.prototype.push.call(this,t,e)},t}();function he(t,e,s){if(s||(s=e,e={}),"function"!=typeof s)throw"no callback";return 31==t[0]&&139==t[1]&&8==t[2]?Zt(t,e,s):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?zt(t,e,s):ie(t,e,s)}function le(t,e){return 31==t[0]&&139==t[1]&&8==t[2]?Kt(t,e):8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31?Gt(t,e):re(t,e)}var oe=function(t,e,s,r){for(var a in t){var n=t[a],h=e+a;n instanceof i?s[h]=[n,r]:Array.isArray(n)?s[h]=[n[0],lt(r,n[1])]:oe(n,h+"/",s,r)}},_e="undefined"!=typeof TextEncoder&&new TextEncoder,me="undefined"!=typeof TextDecoder&&new TextDecoder,ue=0;try{me.decode(K,{stream:!0}),ue=1}catch(Oe){}var de=function(t){for(var e="",s=0;;){var i=t[s++],r=(i>127)+(i>223)+(i>239);if(s+r>t.length)return[e,B(t,s-1)];r?3==r?(i=((15&i)<<18|(63&t[s++])<<12|(63&t[s++])<<6|63&t[s++])-65536,e+=String.fromCharCode(55296|i>>10,56320|1023&i)):e+=1&r?String.fromCharCode((31&i)<<6|63&t[s++]):String.fromCharCode((15&i)<<12|(63&t[s++])<<6|63&t[s++]):e+=String.fromCharCode(i)}},ce=function(){function t(t){this.ondata=t,ue?this.t=new TextDecoder:this.p=K}return t.prototype.push=function(t,e){if(!this.ondata)throw"no callback";if(e=!!e,this.t){if(this.ondata(this.t.decode(t,{stream:!0}),e),e){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var s=new i(this.p.length+t.length);s.set(this.p),s.set(t,this.p.length);var r=de(s),a=r[0],n=r[1];if(e){if(n.length)throw"invalid utf-8 data";this.p=null}else this.p=n;this.ondata(a,e)}},t}(),fe=function(){function t(t){this.ondata=t}return t.prototype.push=function(t,e){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(pe(t),this.d=e||!1)},t}();function pe(t,e){if(e){for(var s=new i(t.length),r=0;r<t.length;++r)s[r]=t.charCodeAt(r);return s}if(_e)return _e.encode(t);var a=t.length,n=new i(t.length+(t.length>>1)),h=0,l=function(t){n[h++]=t};for(r=0;r<a;++r){if(h+5>n.length){var o=new i(h+8+(a-r<<1));o.set(n),n=o}var _=t.charCodeAt(r);_<128||e?l(_):_<2048?(l(192|_>>6),l(128|63&_)):_>55295&&_<57344?(_=65536+(1047552&_)|1023&t.charCodeAt(++r),l(240|_>>18),l(128|_>>12&63),l(128|_>>6&63),l(128|63&_)):(l(224|_>>12),l(128|_>>6&63),l(128|63&_))}return B(n,0,h)}function ge(t,e){if(e){for(var s="",i=0;i<t.length;i+=16384)s+=String.fromCharCode.apply(null,t.subarray(i,i+16384));return s}if(me)return me.decode(t);var r=de(t),a=r[0],n=r[1];if(n.length)throw"invalid utf-8 data";return a}var Te=function(t){return 1==t?3:t<6?2:9==t?1:0},ye=function(t,e){return e+30+bt(t,e+26)+bt(t,e+28)},Ee=function(t,e,s){var i=bt(t,e+28),r=ge(t.subarray(e+46,e+46+i),!(2048&bt(t,e+8))),a=e+46+i,n=At(t,e+20),h=s&&4294967295==n?xe(t,a):[n,At(t,e+24),At(t,e+42)],l=h[0],o=h[1],_=h[2];return[bt(t,e+10),l,o,r,a+bt(t,e+30)+bt(t,e+32),_]},xe=function(t,e){for(;1!=bt(t,e);e+=4+bt(t,e+2));return[Rt(t,e+12),Rt(t,e+4),Rt(t,e+20)]},ve=function(t){var e=0;if(t)for(var s in t){var i=t[s].length;if(i>65535)throw"extra field too long";e+=i+4}return e},Se=function(t,e,s,i,r,a,n,h){var l=i.length,o=s.extra,_=h&&h.length,m=ve(o);Mt(t,e,null!=n?33639248:67324752),e+=4,null!=n&&(t[e++]=20,t[e++]=s.os),t[e]=20,e+=2,t[e++]=s.flag<<1|(null==a&&8),t[e++]=r&&8,t[e++]=255&s.compression,t[e++]=s.compression>>8;var u=new Date(null==s.mtime?Date.now():s.mtime),d=u.getFullYear()-1980;if(d<0||d>119)throw"date not in range 1980-2099";if(Mt(t,e,d<<25|u.getMonth()+1<<21|u.getDate()<<16|u.getHours()<<11|u.getMinutes()<<5|u.getSeconds()>>>1),e+=4,null!=a&&(Mt(t,e,s.crc),Mt(t,e+4,a),Mt(t,e+8,s.size)),Mt(t,e+12,l),Mt(t,e+14,m),e+=16,null!=n&&(Mt(t,e,_),Mt(t,e+6,s.attrs),Mt(t,e+10,n),e+=14),t.set(i,e),e+=l,m)for(var c in o){var f=o[c],p=f.length;Mt(t,e,+c),Mt(t,e+2,p),t.set(f,e+4),e+=4+p}return _&&(t.set(h,e),e+=_),e},be=function(t,e,s,i,r){Mt(t,e,101010256),Mt(t,e+8,s),Mt(t,e+10,s),Mt(t,e+12,i),Mt(t,e+16,r)},Ae=function(){function t(t){this.filename=t,this.c=at(),this.size=0,this.compression=0}return t.prototype.process=function(t,e){this.ondata(null,t,e)},t.prototype.push=function(t,e){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(t),this.size+=t.length,e&&(this.crc=this.c.d()),this.process(t,e||!1)},t}(),Re=function(){function t(t,e){var s=this;e||(e={}),Ae.call(this,t),this.d=new Nt(e,(function(t,e){s.ondata(null,t,e)})),this.compression=8,this.flag=Te(e.level)}return t.prototype.process=function(t,e){try{this.d.push(t,e)}catch(Oe){this.ondata(Oe,null,e)}},t.prototype.push=function(t,e){Ae.prototype.push.call(this,t,e)},t}(),Me=function(){function t(t,e){var s=this;e||(e={}),Ae.call(this,t),this.d=new Ut(e,(function(t,e,i){s.ondata(t,e,i)})),this.compression=8,this.flag=Te(e.level),this.terminate=this.d.terminate}return t.prototype.process=function(t,e){this.d.push(t,e)},t.prototype.push=function(t,e){Ae.prototype.push.call(this,t,e)},t}(),De=function(){function t(t){this.ondata=t,this.u=[],this.d=1}return t.prototype.add=function(t){var e=this;if(2&this.d)throw"stream finished";var s=pe(t.filename),r=s.length,a=t.comment,n=a&&pe(a),h=r!=t.filename.length||n&&a.length!=n.length,l=r+ve(t.extra)+30;if(r>65535)throw"filename too long";var o=new i(l);Se(o,0,t,s,h);var _=[o],m=function(){for(var t=0,s=_;t<s.length;t++){var i=s[t];e.ondata(null,i,!1)}_=[]},u=this.d;this.d=0;var d=this.u.length,c=lt(t,{f:s,u:h,o:n,t:function(){t.terminate&&t.terminate()},r:function(){if(m(),u){var t=e.u[d+1];t?t.r():e.d=1}u=1}}),f=0;t.ondata=function(s,r,a){if(s)e.ondata(s,r,a),e.terminate();else if(f+=r.length,_.push(r),a){var n=new i(16);Mt(n,0,134695760),Mt(n,4,t.crc),Mt(n,8,f),Mt(n,12,t.size),_.push(n),c.c=f,c.b=l+f+16,c.crc=t.crc,c.size=t.size,u&&c.r(),u=1}else u&&m()},this.u.push(c)},t.prototype.end=function(){var t=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&t.d&&(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3},t.prototype.e=function(){for(var t=0,e=0,s=0,r=0,a=this.u;r<a.length;r++){var n=a[r];s+=46+n.f.length+ve(n.extra)+(n.o?n.o.length:0)}for(var h=new i(s+22),l=0,o=this.u;l<o.length;l++){n=o[l];Se(h,t,n,n.f,n.u,n.c,e,n.o),t+=46+n.f.length+ve(n.extra)+(n.o?n.o.length:0),e+=n.b}be(h,t,this.u.length,s,e),this.ondata(null,h,!0),this.d=2},t.prototype.terminate=function(){for(var t=0,e=this.u;t<e.length;t++){var s=e[t];s.t()}this.d=2},t}();function Le(t,e,s){if(s||(s=e,e={}),"function"!=typeof s)throw"no callback";var r={};oe(t,"",r,e);var a=Object.keys(r),n=a.length,h=0,l=0,o=n,_=new Array(n),m=[],u=function(){for(var t=0;t<m.length;++t)m[t]()},d=function(){var t=new i(l+22),e=h,r=l-h;l=0;for(var a=0;a<o;++a){var n=_[a];try{var m=n.c.length;Se(t,l,n,n.f,n.u,m);var u=30+n.f.length+ve(n.extra),d=l+u;t.set(n.c,d),Se(t,h,n,n.f,n.u,m,l,n.m),h+=16+u+(n.m?n.m.length:0),l=d+m}catch(Oe){return s(Oe,null)}}be(t,h,_.length,r,e),s(null,t)};n||d();for(var c=function(t){var e=a[t],i=r[e],o=i[0],c=i[1],f=at(),p=o.length;f.p(o);var g=pe(e),T=g.length,y=c.comment,E=y&&pe(y),x=E&&E.length,v=ve(c.extra),S=0==c.level?0:8,b=function(i,r){if(i)u(),s(i,null);else{var a=r.length;_[t]=lt(c,{size:p,crc:f.d(),c:r,f:g,m:E,u:T!=e.length||E&&y.length!=x,compression:S}),h+=30+T+v+a,l+=76+2*(T+v)+(x||0)+a,--n||d()}};if(T>65535&&b("filename too long",null),S)if(p<16e4)try{b(null,It(o,c))}catch(Oe){b(Oe,null)}else m.push(Ot(o,c,b));else b(null,o)},f=0;f<o;++f)c(f);return u}function Pe(t,e){e||(e={});var s={},r=[];oe(t,"",s,e);var a=0,n=0;for(var h in s){var l=s[h],o=l[0],_=l[1],m=0==_.level?0:8,u=pe(h),d=u.length,c=_.comment,f=c&&pe(c),p=f&&f.length,g=ve(_.extra);if(d>65535)throw"filename too long";var T=m?It(o,_):o,y=T.length,E=at();E.p(o),r.push(lt(_,{size:o.length,crc:E.d(),c:T,f:u,m:f,u:d!=h.length||f&&c.length!=p,o:a,compression:m})),a+=30+d+g+y,n+=76+2*(d+g)+(p||0)+y}for(var x=new i(n+22),v=a,S=n-a,b=0;b<r.length;++b){u=r[b];Se(x,u.o,u,u.f,u.u,u.c.length);var A=30+u.f.length+ve(u.extra);x.set(u.c,u.o+A),Se(x,a,u,u.f,u.u,u.c.length,u.o,u.m),a+=16+A+(u.m?u.m.length:0)}return be(x,a,r.length,S,v),x}var Be=function(){function t(){}return t.prototype.push=function(t,e){this.ondata(null,t,e)},t.compression=0,t}(),Fe=function(){function t(){var t=this;this.i=new Vt((function(e,s){t.ondata(null,e,s)}))}return t.prototype.push=function(t,e){try{this.i.push(t,e)}catch(Oe){this.ondata(Oe,t,e)}},t.compression=8,t}(),we=function(){function t(t,e){var s=this;e<32e4?this.i=new Vt((function(t,e){s.ondata(null,t,e)})):(this.i=new kt((function(t,e,i){s.ondata(t,e,i)})),this.terminate=this.i.terminate)}return t.prototype.push=function(t,e){this.i.terminate&&(t=B(t,0)),this.i.push(t,e)},t.compression=8,t}(),Ce=function(){function t(t){this.onfile=t,this.k=[],this.o={0:Be},this.p=K}return t.prototype.push=function(t,e){var s=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var r=Math.min(this.c,t.length),a=t.subarray(0,r);if(this.c-=r,this.d?this.d.push(a,!this.c):this.k[0].push(a),t=t.subarray(r),t.length)return this.push(t,e)}else{var n=0,h=0,l=void 0,o=void 0;this.p.length?t.length?(o=new i(this.p.length+t.length),o.set(this.p),o.set(t,this.p.length)):o=this.p:o=t;for(var _=o.length,m=this.c,u=m&&this.d,d=function(){var t,e=At(o,h);if(67324752==e){n=1,l=h,c.d=null,c.c=0;var i=bt(o,h+6),r=bt(o,h+8),a=2048&i,u=8&i,d=bt(o,h+26),f=bt(o,h+28);if(_>h+30+d+f){var p=[];c.k.unshift(p),n=2;var g,T=At(o,h+18),y=At(o,h+22),E=ge(o.subarray(h+30,h+=30+d),!a);4294967295==T?(t=u?[-2]:xe(o,h),T=t[0],y=t[1]):u&&(T=-1),h+=f,c.c=T;var x={name:E,compression:r,start:function(){if(!x.ondata)throw"no callback";if(T){var t=s.o[r];if(!t)throw"unknown compression type "+r;g=T<0?new t(E):new t(E,T,y),g.ondata=function(t,e,s){x.ondata(t,e,s)};for(var e=0,i=p;e<i.length;e++){var a=i[e];g.push(a,!1)}s.k[0]==p&&s.c?s.d=g:g.push(K,!0)}else x.ondata(null,K,!0)},terminate:function(){g&&g.terminate&&g.terminate()}};T>=0&&(x.size=T,x.originalSize=y),c.onfile(x)}return"break"}if(m){if(134695760==e)return l=h+=12+(-2==m&&8),n=3,c.c=0,"break";if(33639248==e)return l=h-=4,n=3,c.c=0,"break"}},c=this;h<_-4;++h){var f=d();if("break"===f)break}if(this.p=K,m<0){var p=n?o.subarray(0,l-12-(-2==m&&8)-(134695760==At(o,l-16)&&4)):o.subarray(0,h);u?u.push(p,!!n):this.k[+(2==n)].push(p)}if(2&n)return this.push(o.subarray(h),e);this.p=o.subarray(h)}if(e){if(this.c)throw"invalid zip file";this.p=null}},t.prototype.register=function(t){this.o[t.compression]=t},t}();function Ne(t,e){if("function"!=typeof e)throw"no callback";for(var s=[],r=function(){for(var t=0;t<s.length;++t)s[t]()},a={},n=t.length-22;101010256!=At(t,n);--n)if(!n||t.length-n>65558)return void e("invalid zip file",null);var h=bt(t,n+8);h||e(null,{});var l=h,o=At(t,n+16),_=4294967295==o;if(_){if(n=At(t,n-12),101075792!=At(t,n))return void e("invalid zip file",null);l=h=At(t,n+32),o=At(t,n+48)}for(var m=function(l){var m=Ee(t,o,_),u=m[0],d=m[1],c=m[2],f=m[3],p=m[4],g=m[5],T=ye(t,g);o=p;var y=function(t,s){t?(r(),e(t,null)):(a[f]=s,--h||e(null,a))};if(u)if(8==u){var E=t.subarray(T,T+d);if(d<32e4)try{y(null,Gt(E,new i(c)))}catch(n){y(n,null)}else s.push(zt(E,{size:c},y))}else y("unknown compression type "+u,null);else y(null,B(t,T,T+d))},u=0;u<l;++u)m(u);return r}function Ue(t){for(var e={},s=t.length-22;101010256!=At(t,s);--s)if(!s||t.length-s>65558)throw"invalid zip file";var r=bt(t,s+8);if(!r)return{};var a=At(t,s+16),n=4294967295==a;if(n){if(s=At(t,s-12),101075792!=At(t,s))throw"invalid zip file";r=At(t,s+32),a=At(t,s+48)}for(var h=0;h<r;++h){var l=Ee(t,a,n),o=l[0],_=l[1],m=l[2],u=l[3],d=l[4],c=l[5],f=ye(t,c);if(a=d,o){if(8!=o)throw"unknown compression type "+o;e[u]=Gt(t.subarray(f,f+_),new i(m))}else e[u]=B(t,f,f+_)}return e}},"9cc2":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("3844");e.ListPoolItem=i.ListPoolItem;class r{constructor(){this.m_list=[null],this.m_total=1,this.m_freeUUIDs=[]}hasItemByUUID(t){return t>0&&t<this.m_total&&this.m_list[t],!1}hasItem(t){return null!=t&&t.listUUID>0&&t.listUUID<this.m_total&&this.m_list[t.listUUID],!1}hasnotItem(t){return null!=t&&t.listUUID>0&&t.listUUID<this.m_total&&this.m_list[t.listUUID],!0}getItemByUUID(t){return t>0&&t<this.m_total&&this.m_list[t],null}addItem(t){if(null!=t){if(0!=t.listUUID)throw Error("ListPool::addItem() is the illegal operation !!!");if(this.m_freeUUIDs.length>0){if(t.listUUID=this.m_freeUUIDs.pop(),null!=this.m_list[t.listUUID])throw Error("ListPool::addItem() is the illegal operation !!!");this.m_list[t.listUUID]=t}else t.listUUID=this.m_total,this.m_total++,this.m_list.push(t)}}removeItem(t){if(null!=t&&t.listUUID>0&&t.listUUID<this.m_total&&null!=this.m_list[t.listUUID]){if(this.m_list[t.listUUID]!=t)throw"ListPool::removeItem() is the illegal operation !!!";this.m_freeUUIDs.push(t.listUUID),this.m_list[t.listUUID]=null,t.listUUID=0}}}e.ListPool=r},"9f3e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=i(s("8d98")),n=i(s("ffc0")),h=i(s("1f61")),l=i(s("df25"));class o extends l.default{constructor(t,e,s=!1){super(t,e,s),this.m_type=r.TextureProxyType.Uint16,this.minFilter=a.default.LINEAR,this.dataType=h.default.UNSIGNED_SHORT}toHalfFloatOes(){this.srcFormat=n.default.RGBA,this.internalFormat=n.default.RGBA,this.unpackAlignment=4,this.dataType=h.default.HALF_FLOAT_OES}toUShort565(){this.srcFormat=n.default.RGB,this.internalFormat=n.default.RGB,this.unpackAlignment=3,this.dataType=h.default.UNSIGNED_SHORT_5_6_5}toUShort4444(){this.srcFormat=n.default.RGBA,this.internalFormat=n.default.RGBA,this.unpackAlignment=4,this.dataType=h.default.UNSIGNED_SHORT_4_4_4_4}toUShort5551(){this.unpackAlignment=4,this.dataType=h.default.UNSIGNED_SHORT_5_5_5_1}toUShort(){this.srcFormat=n.default.RGBA,this.internalFormat=n.default.RGBA,this.dataType=h.default.UNSIGNED_SHORT}toAlphaFormat(){this.dataType==h.default.UNSIGNED_SHORT&&(this.srcFormat=n.default.ALPHA,this.internalFormat=n.default.ALPHA,this.unpackAlignment=1)}toRedFormat(){this.dataType==h.default.UNSIGNED_SHORT&&(this.srcFormat=n.default.RED,this.internalFormat=n.default.RED,this.unpackAlignment=1)}toRGBFormat(){this.dataType==h.default.UNSIGNED_SHORT&&(this.srcFormat=n.default.RGB,this.internalFormat=n.default.RGB,this.unpackAlignment=3)}toRGBAFormat(){this.dataType==h.default.UNSIGNED_SHORT&&(this.srcFormat=n.default.RGBA,this.internalFormat=n.default.RGBA,this.unpackAlignment=4)}uploadFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,n=!1){super.setDataFromBytes(t,e,s,i,r,a,n)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[Uint16TextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=o},a053:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("18c7")),n=s("ac89"),h=new a.default,l=new n.Quaternion;class o{constructor(t=0,e=0,s=0,i=o.DefaultOrder){this.isEuler=!0,this._x=t,this._y=e,this._z=s,this._order=i}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get z(){return this._z}set z(t){this._z=t}get order(){return this._order}set order(t){this._order=t}set(t,e,s,i=this._order){return this._x=t,this._y=e,this._z=s,this._order=i,this}clone(){return new o(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this}setFromRotationMatrix(t,e=this._order,s=!0){const i=t.getLocalFS32(),a=i[0],n=i[4],h=i[8],l=i[1],o=i[5],_=i[9],m=i[2],u=i[6],d=i[10];let c=r.default.Clamp;switch(e){case"XYZ":this._y=Math.asin(r.default.Clamp(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-_,d),this._z=Math.atan2(-n,a)):(this._x=Math.atan2(u,o),this._z=0);break;case"YXZ":this._x=Math.asin(-c(_,-1,1)),Math.abs(_)<.9999999?(this._y=Math.atan2(h,d),this._z=Math.atan2(l,o)):(this._y=Math.atan2(-m,a),this._z=0);break;case"ZXY":this._x=Math.asin(c(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-m,d),this._z=Math.atan2(-n,o)):(this._y=0,this._z=Math.atan2(l,a));break;case"ZYX":this._y=Math.asin(-c(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-n,o));break;case"YZX":this._z=Math.asin(c(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-_,o),this._y=Math.atan2(-m,a)):(this._x=0,this._y=Math.atan2(h,d));break;case"XZY":this._z=Math.asin(-c(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(u,o),this._y=Math.atan2(h,a)):(this._x=Math.atan2(-_,d),this._y=0);break;default:}return this._order=e,this}setFromQuaternion(t,e,s=!0){return h.makeRotationFromQuaternion(t),this.setFromRotationMatrix(h,e,s)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return l.setFromEuler(this),this.setFromQuaternion(l,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(){}}o.DefaultOrder="XYZ",o.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],e.Euler=o},a054:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("58fc");e.GeometryModelDataType=i.GeometryModelDataType},a092:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("74ee"),r=s("aeff");class a{constructor(){}}class n{constructor(){this.m_urlPool=new Map,this.m_idPool=new Map,n.s_inited&&(n.s_inited=!1,this.createUnit())}createUnit(){i.DataUnitLock.lockStatus=207;let t=new i.DataUnit;return t}createGeometryUnit(){i.DataUnitLock.lockStatus=207;let t=new r.GeometryDataUnit;return t}hasUnitByUrl(t){return this.m_urlPool.has(t)}hasUnitByUUID(t){return this.m_idPool.has(t)}addUnit(t,e){if(""!=t&&null!=e&&!this.m_urlPool.has(t)){let s=new a;s.uuid=e.getUUID(),s.url=t,s.unit=e,this.m_urlPool.set(t,s),this.m_idPool.set(e.getUUID(),s)}}removeUnit(t){if(null!=t&&this.m_idPool.has(t.getUUID())){let e=this.m_idPool.get(t.getUUID());this.m_idPool.delete(e.uuid),this.m_urlPool.delete(e.url),e.unit=null}}removeUnitByUUID(t){if(this.m_idPool.has(t)){let e=this.m_idPool.get(t);this.m_idPool.delete(e.uuid),this.m_urlPool.delete(e.url),e.unit=null}}removeUnitByUrl(t){if(this.m_urlPool.has(t)){let e=this.m_urlPool.get(t);this.m_idPool.delete(e.uuid),this.m_urlPool.delete(e.url),e.unit=null}}getUnitByUrl(t){let e=this.m_urlPool.get(t);return null!=e?e.unit:null}getUnitByUUID(t){let e=this.m_idPool.get(t);return null!=e?e.unit:null}}n.s_inited=!0,e.DataUnitPool=n},a156:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("20ef"));class n{constructor(t){this.m_shdDict=new Map,this.m_shdList=[],this.m_shdListLen=0,this.m_sharedUniformList=[],this.m_rcuid=-1,this.m_rcuid=t}getRCUid(){return this.m_rcuid}create(t){let e=t.getUniqueShaderName();if(this.m_shdDict.has(e))return this.m_shdDict.get(e);let s=new a.default(this.m_shdListLen);return s.setShdData(t),this.m_shdList[s.getUid()]=s,this.m_sharedUniformList[s.getUid()]=null,++this.m_shdListLen,this.m_shdDict.set(e,s),r.default.SHADERCODE_TRACE_ENABLED,s}findShdProgramByUid(t){return this.m_shdList[t]}findShdProgram(t){return this.m_shdDict.has(t)?this.m_shdDict.get(t):null}findShdProgramByShdData(t){return null!=t&&this.m_shdDict.has(t.getUniqueShaderName())?this.m_shdDict.get(t.getUniqueShaderName()):null}hasUid(t){return null!=this.m_shdList[t]}getTotal(){return this.m_shdListLen}containsUid(t){return t>-1&&t<this.m_shdListLen}}e.ShaderProgramBuilder=n},a176:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("d35a");document.title="RenderingVerifier";let r=new i.RenderingVerifier,a=r;function n(){function t(e){a.run(),window.requestAnimationFrame(t)}a.initialize(),window.requestAnimationFrame(t)}n()},a401:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["JS"]="js-text",t["Binasy"]="binary"}(i||(i={})),e.ModuleFileType=i},a446:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=s("cc48"),n=i(s("265e")),h=i(s("af68")),l=i(s("a80a"));class o{constructor(){this.m_uid=-1,this.m_renderer=null,this.m_camera=null,this.m_stage3d=null,this.m_emptyRPONode=new n.default,this.m_rpoNodeBuilder=null,this.m_nodeQueue=new h.default,this.m_nodeWLinker=new l.default,this.m_nodeSLinker=new l.default,this.m_cullingor=null,this.m_raySelector=null,this.m_entitysTotal=0,this.m_uid=o.s_uid++,this.m_nodeQueue.initialize(1)}getUid(){return this.m_uid}initialize(t,e=null){null==this.m_renderer&&(this.m_renderer=t,this.m_stage3d=t.getStage3D(),this.m_camera=e,this.m_rpoNodeBuilder=t.getRPONodeBuilder())}getStage3D(){return this.m_stage3d}setCamera(t){this.m_camera=t}getCamera(){return this.m_camera}getMouseXYWorldRay(t,e){this.m_camera.getWorldPickingRayByScreenXY(this.m_stage3d.mouseX,this.m_stage3d.mouseY,t,e)}setSpaceCullingor(t){this.m_cullingor=t}setRaySelector(t){this.m_raySelector=t,this.m_raySelector.setRenderer(this.m_renderer)}getRaySelector(){return this.m_raySelector}addEntity(t){if(null!=t.getGlobalBounds()&&t.spaceCullMask>a.SpaceCullingMask.NONE&&r.default.TestSpaceEnabled(t.__$rseFlag)){t.update(),++this.m_entitysTotal;let e=this.m_nodeQueue.addEntity(t);e.bounds=t.getGlobalBounds(),e.pcoEnabled=(t.spaceCullMask&a.SpaceCullingMask.POV)==a.SpaceCullingMask.POV;let s=t.isInRendererProcess()||null==t.getMaterial();s&&(t.spaceCullMask&a.SpaceCullingMask.POV)==a.SpaceCullingMask.POV?(e.rstatus=1,null==t.getMaterial()&&(e.rpoNode=this.m_emptyRPONode),null==e.rpoNode&&(e.rpoNode=this.m_rpoNodeBuilder.getNodeByUid(t.getDisplay().__$rpuid)),this.m_nodeSLinker.addNode(e)):null==t.getMaterial()?(e.rstatus=1,e.rpoNode=this.m_emptyRPONode,this.m_nodeSLinker.addNode(e)):(e.rstatus=0,this.m_nodeWLinker.addNode(e))}}removeEntity(t){if(null!=t&&r.default.TestSpaceContains(t.__$rseFlag)){let e=this.m_nodeQueue.getNodeByEntity(t);null!=e&&(e.rstatus>0?this.m_nodeSLinker.removeNode(e):this.m_nodeWLinker.removeNode(e),this.m_nodeQueue.removeEntity(t),--this.m_entitysTotal)}}updateEntity(t){}update(){}runBegin(){}run(){let t=this.m_nodeWLinker.getBegin();if(null!=t){let e=null;while(null!=t)t.entity.isInRendererProcess()?(e=t,e.rstatus=1,t=t.next,this.m_nodeWLinker.removeNode(e),this.m_nodeSLinker.addNode(e),null==e.rpoNode&&(e.rpoNode=this.m_rpoNodeBuilder.getNodeByUid(e.entity.getDisplay().__$rpuid))):t=t.next}if(t=this.m_nodeSLinker.getBegin(),null!=t)if(null!=this.m_cullingor)this.m_cullingor.setCamera(this.m_camera),this.m_cullingor.setCullingNodeHead(t),this.m_cullingor.run();else{let e=null,s=this.m_camera;while(null!=t)t.rpoNode.isVsible()&&t.entity.isDrawEnabled()?(e=t.bounds,t.drawEnabled=s.visiTestSphere2(e.center,e.radius),t.entity.drawEnabled=t.drawEnabled,t.rpoNode.drawEnabled=t.drawEnabled):(t.drawEnabled=!1,t.entity.drawEnabled=!1,t.rpoNode.drawEnabled=!1),t=t.next}}rayTest(t,e){null!=this.m_raySelector&&(this.m_raySelector.setCamera(this.m_camera),this.m_raySelector.setCullingNodeHead(this.m_nodeSLinker.getBegin()),this.m_raySelector.setRay(t,e),this.m_raySelector.run())}runEnd(){}getCullingNodeHead(){return this.m_nodeSLinker.getBegin()}toString(){return"[RendererSpace(uid = "+this.m_uid+")]"}}o.s_uid=0,e.default=o},a46e:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("1710")),n=i(s("3b73"));class h{constructor(){this.m_camera=null,this.m_touchZoomBoo=!1,this.m_preDis=0,this.m_touchZoomSpd=2,this.m_slideSpd=1,this.m_mouseWheelZoomSpd=6,this.m_tempa=new r.default,this.m_tempb=new r.default,this.m_preva=new r.default,this.m_prevb=new r.default,this.m_va=new r.default,this.m_vb=new r.default,this.m_lookAt=new r.default,this.m_fowardDis=0,this.m_initBoo=!0,this.m_lookAtCtrlEnabled=!0,this.m_flagDrag=0,this.m_flagZoom=0,this.m_windowsEnvFlag=!0,this.syncLookAt=!1,this.m_flagType=2,this.m_windowsEnvFlag=!(n.default.IsMobileWeb()||n.default.IsSafariWeb())}setMobileZoomSpeed(t){this.m_touchZoomSpd=t}seSlideSpeed(t){this.m_slideSpd=t}setMouseWheelZoomSpd(t){this.m_mouseWheelZoomSpd=t}bindCamera(t){this.m_camera=t}initialize(t){this.m_initBoo&&(this.m_initBoo=!1,t.addEventListener(a.default.MOUSE_WHEEL,this,this.mouseWheelListener,!0,!0),t.addEventListener(a.default.MOUSE_MULTI_MOVE,this,this.mouseMultiMoveListener,!0,!0),t.addEventListener(a.default.MOUSE_MULTI_UP,this,this.mouseMultiUpListener,!0,!0))}setLookAtCtrlEnabled(t){this.m_lookAtCtrlEnabled=t}mouseWheelListener(t){t.wheelDeltaY>0?this.m_fowardDis+=this.m_mouseWheelZoomSpd:this.m_fowardDis-=this.m_mouseWheelZoomSpd}mouseMultiMoveListener(t){this.setTouchPosArray(t.posArray)}mouseMultiUpListener(t){this.setTouchPosArray(t.posArray)}resetState(){this.m_flagDrag=0,this.m_flagZoom=0,this.m_flagType=0}setTouchPosArray(t){if(null!=t&&t.length>1){let e=0;if(this.m_va.setXYZ(t[0].x,t[0].y,0),this.m_vb.setXYZ(t[1].x,t[1].y,0),this.m_touchZoomBoo){e=r.default.Distance(this.m_va,this.m_vb),this.m_flagType<1?(this.m_tempa.copyFrom(this.m_va),this.m_tempb.copyFrom(this.m_vb),this.m_tempa.subVecsTo(this.m_va,this.m_preva),this.m_tempb.subVecsTo(this.m_vb,this.m_prevb),this.m_tempa.normalize(),this.m_tempb.normalize(),this.m_tempa.dot(this.m_tempb)>.9?this.m_flagDrag++:this.m_flagZoom++,(this.m_flagDrag>3||this.m_flagZoom>3)&&(this.m_flagType=this.m_flagDrag>this.m_flagZoom?1:2)):this.m_tempa.subVecsTo(this.m_va,this.m_preva);let t=Math.abs(this.m_preDis-e);t>.1&&(this.m_fowardDis=(e-this.m_preDis)*this.m_touchZoomSpd,this.m_preDis=e)}else this.m_touchZoomBoo=!0,this.m_preDis=r.default.Distance(this.m_va,this.m_vb),this.resetState()}else this.resetState(),this.m_touchZoomBoo=!1;this.m_preva.copyFrom(this.m_va),this.m_prevb.copyFrom(this.m_vb)}run(t,e){let s=this.m_lookAtCtrlEnabled;if(null==t&&(t=this.m_lookAt),null!=this.m_camera)if(this.syncLookAt&&this.m_camera.setLookAtPosition(t),2==this.m_flagType){if(Math.abs(this.m_fowardDis)>.001){let i=r.default.Distance(this.m_camera.getPosition(),this.m_camera.getLookAtPosition()),a=this.m_fowardDis;this.m_fowardDis>0&&(i>e?(a=i-e,a>this.m_fowardDis&&(a=this.m_fowardDis)):a=0),Math.abs(a)>.1&&(this.m_camera.forward(a),s&&this.m_camera.setLookPosXYZFixUp(t.x,t.y,t.z)),this.m_windowsEnvFlag?this.m_fowardDis*=.95:this.m_fowardDis=0}}else 1==this.m_flagType&&this.m_camera.slideViewOffsetXY(-this.m_tempa.x*this.m_slideSpd,this.m_tempa.y*this.m_slideSpd)}}e.default=h},a567:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static uint24RGBToCSSHeXRGBColor(t){let e=Math.round(t).toString(16);if(e.length>6)e=e.slice(-6);else if(e.length<6){let t=6-e.length;const s="000000";e=s.slice(0,t)+e}return"#"+e}}e.RGBColorUtil=i},a5ba:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("e08e");class r{constructor(t,e,s){this.m_uid=-1,this.m_cullFaceMode=0,this.m_blendMode=0,this.m_depthTestMode=0,this.m_shadowMode=0,this.m_uid=r.s_uid++,this.m_cullFaceMode=t,this.m_blendMode=e,this.m_depthTestMode=s}getUid(){return this.m_uid}getCullFaceMode(){return this.m_cullFaceMode}getDepthTestMode(){return this.m_depthTestMode}getBlendMode(){return this.m_blendMode}use(){if(r.s_state!=this.m_uid){r.Rstate.setCullFaceMode(this.m_cullFaceMode);r.s_blendModes[r.m_blendMode];r.m_blendMode<0?r.Rstate.setBlendMode(this.m_blendMode,r.s_blendModes[this.m_blendMode]):r.Rstate.setBlendMode(r.m_blendMode,r.s_blendModes[r.m_blendMode]),r.s_depthTestMode<0?r.Rstate.setDepthTestMode(this.m_depthTestMode):r.Rstate.setDepthTestMode(r.s_depthTestMode),r.s_state=this.m_uid}}static CreateBlendModeSeparate(t,e,s,a,n,h=0,l=0){if(null!=t&&""!=t){let o;if(r.s_blendModeNameMap.has(t))return o=r.s_blendModeNameMap.get(t),r.s_blendModeIndexMap.get(o);h<1&&(h=i.GLBlendEquation.FUNC_ADD),l<1&&(l=i.GLBlendEquation.FUNC_ADD);let _=1;if(o=31,o=131*o+e,o=131*o+s,a>0&&n>0&&(o=131*o+a,o=131*o+n,_=1),r.s_blendModeIndexMap.has(o))return r.s_blendModeNameMap.set(t,o),r.s_blendModeIndexMap.get(o);let m=++r.s_blendModeIndex;r.s_blendModeNameMap.set(t,o),r.s_blendModeIndexMap.set(o,m);let u=[_,h,l,e,s,a,n];return r.s_blendModes[m]=u,m}return 0}static CreateBlendMode(t,e,s,a=0){if(null!=t&&""!=t){let n;if(r.s_blendModeNameMap.has(t))return n=r.s_blendModeNameMap.get(t),r.s_blendModeIndexMap.get(n);a<1&&(a=i.GLBlendEquation.FUNC_ADD);let h=0;if(n=31,n=131*n+e,n=131*n+s,r.s_blendModeIndexMap.has(n))return r.s_blendModeIndexMap.get(n);let l=++r.s_blendModeIndex;r.s_blendModeNameMap.set(t,n),r.s_blendModeIndexMap.set(n,l);let o=[h,a,0,e,s,0,0];return r.s_blendModes[l]=o,l}return 0}static Create(t,e,s,i){if(r.s_stsNameMap.has(t)){let e=r.s_stsNameMap.get(t);return e.getUid()}let a=31;if(a=131*a+i,a=131*a+s,a=131*a+e,r.s_stsMap.has(a)){let t=r.s_stsMap.get(a);a=t.getUid()}else{let n=new r(e,s,i);a=n.getUid(),r.s_stsMap.set(a,n),r.s_stsNameMap.set(t,n),r.s_states.push(n),++r.s_statesLen}return a}static GetRenderStateByName(t){if(r.s_stsNameMap.has(t)){let e=r.s_stsNameMap.get(t);return e.getUid()}return-1}static UseRenderState(t){r.s_unlocked&&r.s_state!=t&&t>-1&&t<r.s_statesLen&&r.s_states[t].use()}static UseRenderStateByName(t){if(r.s_unlocked){let e=r.GetRenderStateByName(t);r.s_state!=e&&e>-1&&e<r.s_statesLen&&r.s_states[e].use()}}static UnlockBlendMode(){r.m_blendMode=r.s_preBlendMode}static LockBlendMode(t){r.s_preBlendMode=r.m_blendMode,r.m_blendMode=t}static UnlockDepthTestMode(){r.s_depthTestMode=r.s_preDepthTestMode}static LockDepthTestMode(t){r.s_preDepthTestMode=r.s_depthTestMode,r.s_depthTestMode=t}static Lock(){r.s_unlocked=!1}static Unlock(){r.s_unlocked=!0}static Reset(){r.s_state=-1}}r.s_uid=0,r.s_state=-1,r.s_states=[],r.s_statesLen=1,r.m_blendMode=-1,r.s_depthTestMode=-1,r.s_stsMap=new Map,r.s_stsNameMap=new Map,r.s_blendModeNameMap=new Map,r.s_blendModeIndexMap=new Map,r.s_blendModeIndex=0,r.s_blendModes=new Array(256),r.s_unlocked=!0,r.Rstate=null,r.s_preBlendMode=-1,r.s_preDepthTestMode=-1,e.RenderStateObject=r},a7ed:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73"));class a{create(t,e){let s=r.default.FrustumParam;return e.hasUniformByName(s.name)?t.uniformContext.createShaderGlobalUniformFromProbe(t.getCamera().ufrustumProbe,s.name,[s.name]):null}getIDNS(){return"FrustumUniformBuilder"}}e.default=a},a80a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_begin=null,this.m_end=null}destroy(){this.clear()}clear(){this.m_begin=this.m_end=null}getBegin(){return this.m_begin}isEmpty(){return this.m_begin==this.m_end&&null==this.m_end}addNode(t){null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null}removeNode(t){t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}e.default=i},a996:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uuid="",this.phase=0,this.type=i.RESIZE,this.target=null,this.currentTarget=null,this.data=null,this.__$preventBoo=!1}getClassType(){return i.EventClassType}preventDefault(){this.__$preventBoo=!0}reset(){this.__$preventBoo=!1}toString(){return"[EventBase]"}}i.EventClassType=1001,i.RESIZE=3001,i.ENTER_FRAME=3002,e.default=i},a9f4:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["Default"]=1]="Default",t[t["VSM"]=1]="VSM"}(i||(i={})),e.ShadowMode=i},ab73:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.type="vec4",this.data=null,this.name="u_vsmParams",this.arrayLength=3}}class r{constructor(){this.type="vec4",this.data=new Float32Array([.1,.1,.1,1,1,.1,600,3500,.3,0,.9,5e-4,0,0,800,800,-500,-500,1e3,1e3]),this.name="u_envLightParams",this.arrayLength=5}}class a{constructor(){this.type="mat4",this.data=null,this.name="u_shadowMat",this.arrayLength=0}}class n{constructor(){this.type="vec4",this.data=null,this.name="u_stageParam",this.arrayLength=0}}class h{constructor(){this.type="vec4",this.data=null,this.name="u_viewParam",this.arrayLength=0}}class l{constructor(){this.type="vec4",this.data=null,this.name="u_frustumParam",this.arrayLength=0}}class o{constructor(){this.type="vec4",this.data=null,this.name="u_cameraPosition",this.arrayLength=0}}class _{constructor(){this.type="vec4",this.positionName="u_lightPositions",this.colorName="u_lightColors"}}class m{}m.LocalTransformMatUNS="u_objMat",m.CameraViewMatUNS="u_viewMat",m.CameraProjectiveMatUNS="u_projMat",m.FrustumParam=new l,m.CameraPosParam=new o,m.StageParam=new n,m.ViewportParam=new h,m.ShadowMatrix=new a,m.ShadowVSMParams=new i,m.GlobalLight=new _,m.EnvLightParams=new r,e.default=m},abdb:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.AXIS_ANGLE=0,i.QUATERNION=1,i.EULER_ANGLES=2,e.default=i},ac89:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{constructor(t=0,e=0,s=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=s,this._w=i}static Slerp(t,e,s,i){return s.slerpQuaternions(t,e,i)}static SlerpFlat(t,e,s,i){let r=e.x,a=e.y,n=e.z,h=e.w;const l=s.x,o=s.y,_=s.z,m=s.w;if(0===i)return t.x=r,t.y=a,t.z=n,void(t.w=h);if(1===i)return t.x=l,t.y=o,t.z=_,void(t.w=m);if(h!==m||r!==l||a!==o||n!==_){let t=1-i;const e=r*l+a*o+n*_+h*m,s=e>=0?1:-1,u=1-e*e;if(u>Number.EPSILON){const r=Math.sqrt(u),a=Math.atan2(r,e*s);t=Math.sin(t*a)/r,i=Math.sin(i*a)/r}const d=i*s;if(r=r*t+l*d,a=a*t+o*d,n=n*t+_*d,h=h*t+m*d,t===1-i){const t=1/Math.sqrt(r*r+a*a+n*n+h*h);r*=t,a*=t,n*=t,h*=t}}t.x=r,t.y=a,t.z=n,t.w=h}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get z(){return this._z}set z(t){this._z=t}get w(){return this._w}set w(t){this._w=t}set(t,e,s,i){return this._x=t,this._y=e,this._z=s,this._w=i,this}clone(){return new a(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this}setFromEuler(t,e=!0){if(!t||!t.isEuler)throw new Error("Quaternion::setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const s=t.x,i=t.y,r=t.z,a=t.order,n=Math.cos,h=Math.sin,l=n(s/2),o=n(i/2),_=n(r/2),m=h(s/2),u=h(i/2),d=h(r/2);switch(a){case"XYZ":this._x=m*o*_+l*u*d,this._y=l*u*_-m*o*d,this._z=l*o*d+m*u*_,this._w=l*o*_-m*u*d;break;case"YXZ":this._x=m*o*_+l*u*d,this._y=l*u*_-m*o*d,this._z=l*o*d-m*u*_,this._w=l*o*_+m*u*d;break;case"ZXY":this._x=m*o*_-l*u*d,this._y=l*u*_+m*o*d,this._z=l*o*d+m*u*_,this._w=l*o*_-m*u*d;break;case"ZYX":this._x=m*o*_-l*u*d,this._y=l*u*_+m*o*d,this._z=l*o*d-m*u*_,this._w=l*o*_+m*u*d;break;case"YZX":this._x=m*o*_+l*u*d,this._y=l*u*_+m*o*d,this._z=l*o*d-m*u*_,this._w=l*o*_-m*u*d;break;case"XZY":this._x=m*o*_-l*u*d,this._y=l*u*_-m*o*d,this._z=l*o*d+m*u*_,this._w=l*o*_+m*u*d;break;default:}return this}setFromAxisAngle(t,e){const s=e/2,i=Math.sin(s);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(s),this}setFromRotationMatrix(t){const e=t.getLocalFS32(),s=e[0],i=e[4],r=e[8],a=e[1],n=e[5],h=e[9],l=e[2],o=e[6],_=e[10],m=s+n+_;if(m>0){const t=.5/Math.sqrt(m+1);this._w=.25/t,this._x=(o-h)*t,this._y=(r-l)*t,this._z=(a-i)*t}else if(s>n&&s>_){const t=2*Math.sqrt(1+s-n-_);this._w=(o-h)/t,this._x=.25*t,this._y=(i+a)/t,this._z=(r+l)/t}else if(n>_){const t=2*Math.sqrt(1+n-s-_);this._w=(r-l)/t,this._x=(i+a)/t,this._y=.25*t,this._z=(h+o)/t}else{const t=2*Math.sqrt(1+_-s-n);this._w=(a-i)/t,this._x=(r+l)/t,this._y=(h+o)/t,this._z=.25*t}return this}setFromUnitVectors(t,e){let s=t.dot(e)+1;return s<Number.EPSILON?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(r.default.Clamp(this.dot(t),-1,1)))}rotateTowards(t,e){const s=this.angleTo(t);if(0===s)return this;const i=Math.min(1,e/s);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this}multiply(t,e){return void 0!==e?this.multiplyQuaternions(t,e):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const s=t._x,i=t._y,r=t._z,a=t._w,n=e._x,h=e._y,l=e._z,o=e._w;return this._x=s*o+a*n+i*l-r*h,this._y=i*o+a*h+r*n-s*l,this._z=r*o+a*l+s*h-i*n,this._w=a*o-s*n-i*h-r*l,this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const s=this._x,i=this._y,r=this._z,a=this._w;let n=a*t._w+s*t._x+i*t._y+r*t._z;if(n<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,n=-n):this.copy(t),n>=1)return this._w=a,this._x=s,this._y=i,this._z=r,this;const h=1-n*n;if(h<=Number.EPSILON){const t=1-e;return this._w=t*a+e*this._w,this._x=t*s+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this}const l=Math.sqrt(h),o=Math.atan2(l,n),_=Math.sin((1-e)*o)/l,m=Math.sin(e*o)/l;return this._w=a*_+this._w*m,this._x=s*_+this._x*m,this._y=i*_+this._y*m,this._z=r*_+this._z*m,this}slerpQuaternions(t,e,s){return this.copy(t).slerp(e,s)}random(){const t=Math.random(),e=Math.sqrt(1-t),s=Math.sqrt(t),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(i),s*Math.sin(r),s*Math.cos(r),e*Math.sin(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e=0){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}}e.Quaternion=a},acaa:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=i(s("8d98")),n=i(s("ffc0")),h=i(s("1f61")),l=i(s("cfaf"));class o extends l.default{constructor(t,e,s=!1){super(t,e,s),this.minFilter=a.default.NEAREST,this.magFilter=a.default.NEAREST,this.srcFormat=n.default.DEPTH_COMPONENT,this.internalFormat=n.default.DEPTH_COMPONENT,this.dataType=h.default.UNSIGNED_SHORT,this.m_generateMipmap=!1,this.m_haveRData=!0,this.mipmapEnabled=!1,this.m_type=r.TextureProxyType.Depth}toDepthUnsignedInt(){this.minFilter=a.default.NEAREST,this.magFilter=a.default.NEAREST,this.srcFormat=n.default.DEPTH_COMPONENT,this.internalFormat=n.default.DEPTH_COMPONENT,this.dataType=h.default.UNSIGNED_INT,this.m_generateMipmap=!1,this.m_haveRData=!0,this.mipmapEnabled=!1}toDepthUnsignedShort(){this.minFilter=a.default.NEAREST,this.magFilter=a.default.NEAREST,this.srcFormat=n.default.DEPTH_COMPONENT,this.internalFormat=n.default.DEPTH_COMPONENT,this.dataType=h.default.UNSIGNED_SHORT,this.m_generateMipmap=!1,this.m_haveRData=!0,this.mipmapEnabled=!1}toDepthAndStencil(){this.minFilter=a.default.NEAREST,this.magFilter=a.default.NEAREST,this.srcFormat=n.default.DEPTH_STENCIL,this.internalFormat=n.default.DEPTH_STENCIL,this.dataType=h.default.UNSIGNED_INT_24_8_WEBGL,this.m_generateMipmap=!1,this.mipmapEnabled=!1,this.m_haveRData=!0}uploadData(t){let e=t.getRC();e.texImage2D(this.m_sampler,0,n.default.ToGL(e,this.internalFormat),this.m_texWidth,this.m_texHeight,0,n.default.ToGL(e,this.srcFormat),h.default.ToGL(e,this.dataType),null)}toString(){return"[DepthTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=o},acfe:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ca6c")),a=i(s("8a0a")),n=i(s("3b73")),h=i(s("81ce")),l=i(s("fc07"));class o{constructor(){this.m_uid=-1,this.adaptationShaderVersion=!0,this.preCompileInfo=null,this.m_vshdCode="",this.m_fshdCode="",this.m_shdUniqueName="",this.m_texTotal=0,this.m_uniforms=null,this.m_useTex=!1,this.m_attriNSList=null,this.m_attriSizeList=null,this.m_aLocationTypes=null,this.m_uniformDict=new Map,this.m_layoutTypes=null,this.m_haveCommonUniform=!1,this.m_layoutBit=0,this.m_mid=0,this.m_fragOutputTotal=1,this.m_texUniformNames=null,this.dataUniformEnabled=!1,this.m_uid=o.s_uid++}getVSCodeStr(){return this.m_vshdCode}getFSCodeStr(){return this.m_fshdCode}getLocationTypes(){return this.m_layoutTypes}getLayoutBit(){return this.m_layoutBit}getMid(){return this.m_mid}getFragOutputTotal(){return this.m_fragOutputTotal}parseCode(t,e){o.s_codeParser.reset(),o.s_codeParser.parseVShaderCode(t),o.s_codeParser.parseFShaderCode(e),this.m_fragOutputTotal=o.s_codeParser.fragOutputTotal,this.m_uniforms=o.s_codeParser.uniforms}initialize(t,e,s){this.m_shdUniqueName=t,this.adaptationShaderVersion&&null==this.preCompileInfo&&n.default.IsWebGL1()&&(e=h.default.Es3VtxShaderToES2(e),s=h.default.Es3FragShaderToES2(s)),this.preCompileInfo,this.parseCode(e,s);let i=o.s_codeParser.attributes,l=0,_=i.length,m=null;this.m_attriNSList=[],this.m_attriSizeList=[],this.m_layoutBit=0;let u=0,d=this.m_layoutTypes=[];while(l<_){if(m=i[l],null!=m){this.m_attriNSList.push(m.name),this.m_attriSizeList.push(m.typeSize),u+=1;let t=a.default.GetVBufTypeByNS(m.name);switch(t){case a.default.VBUF_VS:this.m_layoutBit|=r.default.BIT_ONE_0;break;case a.default.VBUF_UVS:this.m_layoutBit|=r.default.BIT_ONE_1;break;case a.default.VBUF_NVS:this.m_layoutBit|=r.default.BIT_ONE_2;break;case a.default.VBUF_CVS:this.m_layoutBit|=r.default.BIT_ONE_3;break;case a.default.VBUF_TVS:this.m_layoutBit|=r.default.BIT_ONE_4;break;case a.default.VBUF_VS2:this.m_layoutBit|=r.default.BIT_ONE_5;break;case a.default.VBUF_UVS2:this.m_layoutBit|=r.default.BIT_ONE_6;break;case a.default.VBUF_NVS2:this.m_layoutBit|=r.default.BIT_ONE_7;break;case a.default.VBUF_CVS2:this.m_layoutBit|=r.default.BIT_ONE_8;break;case a.default.VBUF_TVS2:this.m_layoutBit|=r.default.BIT_ONE_9;break;default:u-=1,t=0;break}t>0&&d.push(a.default.GetVBufAttributeTypeByVBufType(t))}++l}let c=(u<<11)+this.m_layoutBit;o.s_midMap.has(c)||(o.s_midMap.set(c,o.s_mid),o.s_mid++),this.m_mid=o.s_midMap.get(c),this.m_texTotal=o.s_codeParser.texTotal,this.m_useTex=this.m_texTotal>0,this.m_useTex&&(this.m_texUniformNames=o.s_codeParser.texUniformNameListStr.split(",")),this.m_haveCommonUniform=this.m_texTotal<this.m_uniforms.length,this.m_vshdCode=e,this.m_fshdCode=s,this.m_shdUniqueName=t}getAttriSizeList(){return this.m_attriSizeList}getTexUniformNames(){return this.m_texUniformNames}getUniforms(){return this.m_uniforms}haveCommonUniform(){return this.m_haveCommonUniform}getAttriNSList(){return this.m_attriNSList}getUid(){return this.m_uid}getTexTotal(){return this.m_texTotal}haveTexture(){return this.m_useTex}getLocationsTotal(){return this.m_aLocationTypes.length}getUniformTypeNameByNS(t){let e=this.m_uniformDict.get(t);return null!=e?e.typeName:""}getUniformTypeByNS(t){let e=this.m_uniformDict.get(t);return null!=e?e.type:0}hasUniformByName(t){return this.m_uniformDict.has(t)}getUniformLengthByNS(t){return this.m_uniformDict.has(t)&&this.m_uniformDict.get(t).arrLength,0}getUniqueShaderName(){return this.m_shdUniqueName}destroy(){this.m_texTotal=0}}o.s_uid=0,o.s_codeParser=new l.default,o.s_midMap=new Map,o.s_mid=1,e.default=o},aeff:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("74ee");e.DataFormat=i.DataFormat,e.DataUnitLock=i.DataUnitLock,e.DataUnit=i.DataUnit;const r=s("58fc");e.GeometryModelDataType=r.GeometryModelDataType;class a{constructor(){this.dataFormat=i.DataFormat.CTM,this.models=null}setFormatBUrl(t){if(""!=t){let e=t.lastIndexOf(".");if(e<=0)throw Error("illegal geometry data url: "+t);switch(t.slice(e+1)){case i.DataFormat.CTM:this.dataFormat=i.DataFormat.CTM;break;case i.DataFormat.Draco:this.dataFormat=i.DataFormat.Draco;break;default:throw Error("illegal geometry data url: "+t)}}}destroy(){this.models=null}}e.GeometryDataContainer=a;class n extends i.DataUnit{constructor(){super(),this.data=null,this.dataClass=i.DataClass.Geometry}}e.GeometryDataUnit=n},af29:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("722e")),a=i(s("8333")),n=i(s("8d98")),h=i(s("1f61")),l=i(s("ffc0")),o=i(s("3930")),_=i(s("baae")),m=i(s("29ef"));class u{constructor(t,e){this.m_backBufferColor=new o.default,this.m_adapter=null,this.m_renderProxy=null,this.m_rcontext=null,this.m_bgColor=new o.default,this.m_renderer=null,this.m_runFlag=!0,this.m_fboIndex=-1,this.m_fboType=-1,this.m_initW=128,this.m_initH=128,this.m_enableDepth=!0,this.m_enableStencil=!1,this.m_multisampleLevel=0,this.m_gMateiral=null,this.m_gRState=-1,this.m_gRColorMask=-1,this.m_rindexs=[],this.m_texs=[null,null,null,null,null,null,null,null],this.m_texStore=null,this.m_texsTot=0,this.m_synFBOSizeWithViewport=!0,this.m_fboSizeFactor=1,this.m_clearDepth=256,this.m_clearColorBoo=!0,this.m_clearDepthBoo=!0,this.m_clearStencilBoo=!1,this.m_viewportLock=!1,this.m_texUnlock=!1,this.m_tmaterialUniformUpdate=!1,this.uns="FBOInstance",this.m_renderer=t,this.m_texStore=e,this.m_renderProxy=t.getRenderProxy(),this.m_adapter=this.m_renderProxy.getRenderAdapter(),this.m_rcontext=t.getRendererContext()}getFBOUid(){return this.m_fboIndex}setRProcessIDList(t){if(null!=t){if(t.length<1)throw Error("processIDlist.length < 1, but it must: processIDlist.length >= 1");this.m_rindexs=t.slice(0)}}setRProcessList(t){if(t.length<1)throw Error("list.length < 1, but must: list.length >= 1");this.m_rindexs=new Array(t.length);for(let e=0;e<t.length;++e)this.m_rindexs[e]=t[e].getRPIndex()}getRProcessIDAt(t){return this.m_rindexs[t]}getStage3D(){return this.m_renderProxy.getStage3D()}getCamera(){return null!=this.m_renderProxy?this.m_renderProxy.getCamera():null}lockViewport(){this.m_viewportLock=!0}unlockViewport(){this.m_viewportLock=!1}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}updateCameraDataFromCamera(t){null!=this.m_renderProxy&&this.m_renderProxy.updateCameraDataFromCamera(t)}useGlobalRenderState(t){this.m_rcontext.useGlobalRenderState(t)}useGlobalRenderStateByName(t){this.m_rcontext.useGlobalRenderStateByName(t)}setGlobalRenderState(t){this.m_gRState=t}setGlobalRenderStateByName(t){this.m_gRState=this.m_rcontext.getRenderStateByName(t)}lockRenderState(t=-1){this.m_gRState>=0||t>=0?this.m_rcontext.useGlobalRenderState(t<0?this.m_gRState:t):this.m_renderProxy.lockRenderState()}unlockRenderState(){this.m_renderProxy.unlockRenderState()}useGlobalRenderColorMask(t){this.m_rcontext.useGlobalRenderColorMask(t)}useGlobalRenderColorMaskByName(t){this.m_rcontext.useGlobalRenderColorMaskByName(t)}setGlobalRenderColorMask(t){this.m_gRColorMask=t}setGlobalRenderColorMaskByName(t){this.m_gRColorMask=this.m_rcontext.getRenderColorMaskByName(t)}lockColorMask(t=-1){this.m_gRColorMask>=0||t>=0?this.m_rcontext.useGlobalRenderColorMask(t<0?this.m_gRColorMask:t):this.m_renderProxy.lockRenderColorMask()}unlockRenderColorMask(){this.m_rcontext.useGlobalRenderColorMask(m.default.COLOR_MASK_ALL_TRUE),this.m_renderProxy.unlockRenderColorMask()}useGlobalMaterial(t,e=!1,s=!1){this.m_texUnlock=e,this.m_tmaterialUniformUpdate=s,this.m_rcontext.useGlobalMaterial(t,this.m_texUnlock,s)}setGlobalMaterial(t,e=!1,s=!1){this.m_texUnlock=e,this.m_tmaterialUniformUpdate=s,this.m_gMateiral!=t&&(null!=this.m_gMateiral&&this.m_gMateiral.__$detachThis(),null!=t&&t.__$attachThis(),this.m_gMateiral=t)}lockMaterial(){null!=this.m_gMateiral?this.m_rcontext.useGlobalMaterial(this.m_gMateiral,this.m_texUnlock,this.m_tmaterialUniformUpdate):this.m_rcontext.lockMaterial()}unlockMaterial(){this.m_rcontext.unlockMaterial()}updateGlobalMaterialUniform(){this.m_rcontext.updateMaterialUniform(this.m_gMateiral)}clearDepth(t=1){this.m_adapter.clearFBODepthAt(this.m_fboIndex,t)}synFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!0}asynFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!1}setFBOSizeFactorWithViewPort(t){this.m_fboSizeFactor=t}createViewportSizeFBOAt(t,e=!1,s=!1,i=0){this.m_fboIndex<0&&(this.m_fboIndex=t,this.m_fboType=_.default.FRAMEBUFFER,this.m_initW=this.m_adapter.getViewportWidth(),this.m_initH=this.m_adapter.getViewportHeight(),this.m_enableDepth=e,this.m_enableStencil=s,this.m_multisampleLevel=i,this.m_adapter.createFBOAt(t,this.m_fboType,this.m_initW,this.m_initH,e,s,i))}createFBO(t,e,s=0){this.m_enableDepth=t,this.m_enableStencil=e,this.m_multisampleLevel=s,this.m_adapter.createFBOAt(this.m_fboIndex,this.m_fboType,this.m_initW,this.m_initH,t,e,s)}createAutoSizeFBOAt(t,e=!1,s=!1,i=0){t>=0&&this.m_fboIndex<0&&(this.m_fboType=_.default.FRAMEBUFFER,this.m_initW=512,this.m_initH=512,this.m_fboIndex=t,this.createFBO(e,s,i))}createFBOAt(t,e,s,i=!1,r=!1,a=0){t>=0&&this.m_fboIndex<0&&(this.m_fboType=_.default.FRAMEBUFFER,this.m_initW=e,this.m_initH=s,this.m_fboIndex=t,this.m_initW<1&&(this.m_initW=this.m_adapter.getRCanvasWidth()),this.m_initH<1&&(this.m_initH=this.m_adapter.getRCanvasHeight()),this.createFBO(i,r,a))}createReadFBOAt(t,e,s,i=!1,r=!1,a=0){t>=0&&this.m_fboIndex<0&&(this.m_fboType=_.default.READ_FRAMEBUFFER,this.m_initW=e,this.m_initH=s,this.m_fboIndex=t,this.m_initW<1&&(this.m_initW=this.m_adapter.getRCanvasWidth()),this.m_initH<1&&(this.m_initH=this.m_adapter.getRCanvasHeight()),this.createFBO(i,r,a))}createDrawFBOAt(t,e,s,i=!1,r=!1,a=0){t>=0&&this.m_fboIndex<0&&(this.m_fboType=_.default.DRAW_FRAMEBUFFER,this.m_initW=e,this.m_initH=s,this.m_fboIndex=t,this.m_initW<1&&(this.m_initW=this.m_adapter.getRCanvasWidth()),this.m_initH<1&&(this.m_initH=this.m_adapter.getRCanvasHeight()),this.createFBO(i,r,a))}resizeFBO(t,e){this.m_initW==t&&this.m_initH==e||(this.m_initW=t,this.m_initH=e,this.m_adapter.resizeFBOAt(this.m_fboIndex,t,e))}getRTTAt(t){return this.m_texs[t]}enableMipmapRTTAt(t){this.m_texs[t].enableMipmap()}generateMipmapTextureAt(t){this.m_texs[t].generateMipmap(this.m_renderProxy.Texture)}setRenderToTexture(t,e=0){return 0==e?this.m_texsTot=1:this.m_texsTot<e+1&&(this.m_texsTot=e+1),this.m_texs[e]=t,t}setRenderToRTTTextureAt(t,e=0){this.setRenderToTexture(this.m_texStore.getRTTTextureAt(t),e)}setRenderToFloatTextureAt(t,e=0){this.setRenderToTexture(this.m_texStore.getRTTFloatTextureAt(t),e)}setRenderToHalfFloatTexture(t,e=0){return null==t&&(t=this.m_texStore.createRTTTex2D(128,128,!1),t.__$setRenderProxy(this.m_renderProxy),t.internalFormat=l.default.RGBA16F,t.srcFormat=l.default.RGBA,t.dataType=h.default.FLOAT,t.minFilter=n.default.LINEAR,t.magFilter=n.default.LINEAR,t.__$setRenderProxy(this.m_renderProxy)),this.setRenderToTexture(t,e)}setRenderToRGBATexture(t,e=0){return null==t&&(t=this.createRGBATexture()),this.setRenderToTexture(t,e)}setRenderToDepthTextureAt(t,e=0){return this.setRenderToTexture(this.m_texStore.getDepthTextureAt(t),e)}createRGBATexture(){let t=this.m_texStore.createRTTTex2D(32,32,!1);return t.internalFormat=l.default.RGBA,t.srcFormat=l.default.RGBA,t.dataType=h.default.UNSIGNED_BYTE,t.minFilter=n.default.LINEAR,t.magFilter=n.default.LINEAR,t.__$setRenderProxy(this.m_renderProxy),t}setClearState(t=!0,e=!0,s=!1){this.m_clearColorBoo=t,this.m_clearDepthBoo=e,this.m_clearStencilBoo=s}setRenderToBackBuffer(){this.m_renderProxy.setClearColor(this.m_backBufferColor),this.m_rcontext.setRenderToBackBuffer()}setClearDepth(t){this.m_clearDepth=t}getClearDepth(){return this.m_adapter.getClearDepth()}getViewportX(){return this.m_adapter.getViewportX()}getViewportY(){return this.m_adapter.getViewportY()}getViewportWidth(){return this.m_adapter.getViewportWidth()}getViewportHeight(){return this.m_adapter.getViewportHeight()}getFBOWidth(){return this.m_adapter.getFBOWidthAt(this.m_fboIndex)}getFBOHeight(){return this.m_adapter.getFBOHeightAt(this.m_fboIndex)}resetAttachmentMask(t){this.m_adapter.resetFBOAttachmentMask(t)}setAttachmentMaskAt(t,e){this.m_adapter.setFBOAttachmentMaskAt(t,e)}setClearRGBColor3f(t,e,s){this.m_bgColor.setRGB3f(t,e,s)}setClearColorEnabled(t){this.m_clearColorBoo=t}setClearDepthEnabled(t){this.m_clearDepthBoo=t}setClearStencilEnabled(t){this.m_clearStencilBoo=t}setClearUint24Color(t,e=1){this.m_bgColor.setRGBUint24(t),this.m_bgColor.a=e}setClearRGBAColor4f(t,e,s,i){this.m_bgColor.setRGBA4f(t,s,e,i)}blitFrom(t,e=a.default.COLOR_BUFFER_BIT,s=r.default.NEAREST,i=-1,n=0,h=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,e,s,i,n,h))}blitColorFrom(t,e=r.default.NEAREST,s=-1,i=0,n=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,a.default.COLOR_BUFFER_BIT,e,s,i,n))}blitDepthFrom(t,e=r.default.NEAREST,s=-1,i=0,n=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,a.default.COLOR_BUFFER_BIT|a.default.DEPTH_BUFFER_BIT,e,s,i,n))}blitColorAndDepthFrom(t,e=r.default.NEAREST,s=-1,i=0,n=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,a.default.COLOR_BUFFER_BIT|a.default.DEPTH_BUFFER_BIT,e,s,i,n))}blitStencilFrom(t,e=r.default.NEAREST,s=-1,i=0,n=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,a.default.STENCIL_BUFFER_BIT,e,s,i,n))}renderToTextureAt(t,e=0){this.m_adapter.setRenderToTexture(this.m_texs[t],this.m_enableDepth,this.m_enableStencil,e),this.m_adapter.useFBO(this.m_clearColorBoo,this.m_clearDepthBoo,this.m_clearStencilBoo)}runBeginDo(){if(this.m_runFlag){this.m_runFlag=!1,this.m_renderProxy.getClearRGBAColor4f(this.m_backBufferColor),this.m_viewportLock?this.m_adapter.lockViewport():this.m_adapter.unlockViewport(),this.m_adapter.bindFBOAt(this.m_fboIndex,this.m_fboType),this.m_synFBOSizeWithViewport?(this.m_adapter.synFBOSizeWithViewport(),this.m_adapter.setFBOSizeFactorWithViewPort(this.m_fboSizeFactor)):this.m_adapter.asynFBOSizeWithViewport(),this.m_clearDepth<128&&this.m_adapter.setClearDepth(this.m_clearDepth),this.m_renderProxy.setClearColor(this.m_bgColor);let t=0;for(;t<this.m_texsTot;++t)this.m_adapter.setRenderToTexture(this.m_texs[t],this.m_enableDepth,this.m_enableStencil,t);this.m_adapter.useFBO(this.m_clearColorBoo,this.m_clearDepthBoo,this.m_clearStencilBoo),null!=this.m_gMateiral?this.m_rcontext.useGlobalMaterial(this.m_gMateiral,this.m_texUnlock,this.m_tmaterialUniformUpdate):this.m_rcontext.unlockMaterial()}}run(t=!1,e=!1,s=!0,i=!0){if(t&&this.lockRenderState(),e&&!i&&this.lockMaterial(),this.m_fboIndex>=0&&(i&&this.runBeginDo(),null!=this.m_rindexs))for(let r=0,a=this.m_rindexs.length;r<a;++r)this.m_renderer.runAt(this.m_rindexs[r]);t&&this.unlockRenderState(),e&&this.unlockMaterial(),s&&this.runEnd()}runAt(t,e=!0){this.m_fboIndex>=0&&null!=this.m_rindexs&&(0==t&&e?this.runBeginDo():this.m_runFlag=!0,this.m_renderer.runAt(this.m_rindexs[t]))}drawEntity(t,e=!1,s=!0){this.m_runFlag||this.m_renderer.drawEntity(t,e,s)}runBegin(){this.m_fboIndex>=0&&null!=this.m_rindexs&&(this.m_runFlag=!0,this.runBeginDo())}runEnd(){this.m_renderProxy.setClearColor(this.m_backBufferColor),this.m_runFlag=!0,this.m_viewportLock&&this.m_adapter.unlockViewport()}useCamera(t,e=!1){this.m_renderer.useCamera(t,e)}useMainCamera(){this.m_renderer.useMainCamera()}reset(){this.setGlobalMaterial(null);let t=0;for(;t<this.m_texsTot;++t)this.m_texs[t]=null;this.m_runFlag=!1,this.m_fboIndex=-1,this.m_texsTot=0,this.m_rindexs=[]}clone(){let t=new u(this.m_renderer,this.m_texStore);t.m_fboSizeFactor=this.m_fboSizeFactor,t.m_bgColor.copyFrom(this.m_bgColor),t.m_fboIndex=this.m_fboIndex,t.m_fboType=this.m_fboType,t.m_clearDepth=this.m_clearDepth,t.m_texsTot=this.m_texsTot,t.m_enableDepth=this.m_enableDepth,t.m_enableStencil=this.m_enableStencil,t.m_synFBOSizeWithViewport=this.m_synFBOSizeWithViewport,t.m_initW=this.m_initW,t.m_initH=this.m_initH,t.m_multisampleLevel=this.m_multisampleLevel;let e=0;for(;e<this.m_texsTot;++e)t.m_texs[e]=t.m_texs[e];if(null!=this.m_rindexs){let s=this.m_rindexs.length,i=new Array(s);for(e=0;e<s;++e)i[e]=this.m_rindexs[e];t.setRProcessIDList(i)}return t}}e.default=u},af68:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=i(s("7b0e"));class n{constructor(){this.m_nodeListLen=0,this.m_nodeIdList=[],this.m_nodeList=[],this.m_entityList=[],this.m_nodeFlagList=[],this.m_freeIdList=[]}getFreeId(){return this.m_freeIdList.length>0?this.m_freeIdList.pop():-1}createNode(){let t=this.getFreeId();if(t>=0)return this.m_nodeFlagList[t]=1,this.m_nodeList[t];{t=this.m_nodeListLen;let e=a.default.Create();return this.m_nodeList.push(e),this.m_entityList.push(null),e.spaceId=t,this.m_nodeFlagList.push(1),this.m_nodeIdList.push(t),this.m_nodeFlagList.push(1),this.m_nodeListLen++,e}}restoreId(t){t>0&&1==this.m_nodeFlagList[t]&&(this.m_freeIdList.push(t),this.m_nodeFlagList[t]=0,this.m_entityList[t]=null)}addEntity(t){let e=this.createNode();return this.m_entityList[e.spaceId]=t,e.entity=t,t.__$rseFlag=r.default.AddSpaceUid(t.__$rseFlag,e.spaceId),e}initialize(t){if(t>0)for(let e=0;e<t;e++){let t=this.createNode();this.m_entityList[t.spaceId]=null}}getNodeByEntity(t){if(r.default.TestSpaceContains(t.__$rseFlag)){let e=r.default.GetSpaceUid(t.__$rseFlag);if(this.m_entityList[e]==t)return this.m_nodeList[e]}return null}removeEntity(t){if(r.default.TestSpaceContains(t.__$rseFlag)){let e=r.default.GetSpaceUid(t.__$rseFlag);this.m_entityList[e]==t&&(this.m_nodeList[e].entity=null,this.restoreId(e),t.__$rseFlag=r.default.RemoveSpaceUid(t.__$rseFlag))}}toString(){return"[EntityNodeQueue()]"}}e.default=n},b02c:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{constructor(t,e){this.m_uid=-1,this.m_mid=-1,this.m_texTotal=0,this.m_gtexList=null,this.m_samplers=null,this.m_texList=null,this.m_rcuid=0,this.m_texRes=null,this.direct=!0,this.m_attachCount=0,this.m_rcuid=t,this.m_uid=a.s_uid++,this.m_mid=e}__$setParam(t,e){this.m_rcuid=t,this.m_mid=e}getRCUid(){return this.m_rcuid}getMid(){return this.m_mid}getTexTotal(){return this.m_texTotal}collectTexList(t,e,s){this.m_texRes=t;let i=0;if(this.direct)if(this.m_texTotal<1&&e.length>0){let a,n=r.default.GetNearestCeilPow2(e.length);this.m_samplers=new Uint16Array(n),this.m_gtexList=new Array(n),this.m_texList=e;while(i<s)a=e[i],a.__$attachThis(),a.__$$upload(t),this.m_samplers[i]=a.getSampler(),this.m_gtexList[i]=this.m_texRes.getGpuBuffer(a.getResUid()),this.m_texRes.__$attachRes(a.getResUid()),i++;this.m_texTotal=i}else this.m_texTotal=0;else this.m_texTotal=s;while(i<e.length)e[i++].__$attachThis()}run(){if(this.m_texRes.unlocked&&this.m_texRes.texMid!=this.m_mid){this.m_texRes.texMid=this.m_mid;let t=this.m_texRes.getRC(),e=t.TEXTURE0;if(this.direct)for(let s=0;s<this.m_texTotal;++s)t.activeTexture(e++),t.bindTexture(this.m_samplers[s],this.m_gtexList[s]);else{let s=this.m_texList;for(let i=0;i<this.m_texTotal;++i)t.activeTexture(e++),s[i].__$$use(this.m_texRes)}}}getUid(){return this.m_uid}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0,a.Restore(this))}reset(){if(null!=this.m_texList)for(let t=0,e=this.m_texList.length;t<e;++t)this.m_texList[t].__$detachThis(),this.m_texRes.__$detachRes(this.m_texList[t].getResUid()),this.m_gtexList[t]=null;this.m_texTotal=0,this.m_texList=null,this.m_texRes=null}toString(){return"TextureRenderObj(uid = "+this.m_uid+", mid="+this.m_mid+")"}static Create(t,e,s){let i=e.length;if(i>0&&s>0){if(i<s)throw Error("There are fewer textures than in the shader : (need "+s+",but only have "+i+") !!!");let r=31,n=0,h=!0;while(n<s)r=131*r+e[n].getUid(),e[n].isDirect()||(h=!1),++n;let l=a.s_troMaps[t.getRCUid()],o=null;return l.has(r)?o=l.get(r):(o=a.s_freeTROList.length<1?new a(t.getRCUid(),r):a.s_freeTROList.pop(),o.collectTexList(t,e,s),l.set(r,o)),o.__$setParam(t.getRCUid(),r),o.direct=h,o}return null}static Restore(t){t.getMid()>-1&&(a.s_troMaps[t.getRCUid()].delete(t.getMid()),t.__$setParam(0,0),a.s_freeTROList.push(t),t.reset())}static GetByMid(t,e){return a.s_troMaps[t].get(e)}}a.s_uid=0,a.s_troMaps=[new Map,new Map,new Map,new Map,new Map,new Map,new Map,new Map],a.s_freeTROList=[],a.s_unloacked=!0,a.s_preMid=-1,e.TextureRenderObj=a;class n{constructor(t){this.m_texRes=null,this.m_texRes=t}run(){this.m_texRes.renderBegin()}getMid(){return 1}__$attachThis(){}__$detachThis(){}}e.EmptyTexRenderObj=n,e.default=a},b0ef:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_canvas=null,this.m_div=null,this.m_divW=-1,this.m_divH=-1,this.resized=!0}setDiv(t){this.m_div=t}createViewEle(t,e){null==this.m_div&&(this.m_div=document.getElementById("voxEngineDiv")),null==this.m_div&&(this.m_div=t.createElement("div"),this.m_div.style.width="400px",this.m_div.style.height="300px",document.body.appendChild(this.m_div)),this.m_div.style.display="bolck",this.m_div.style.position="absolute",""==this.m_div.style.left&&(this.m_div.style.left="0px",this.m_div.style.top="0px"),e&&(this.m_div.style.width="100%",this.m_div.style.height="100%"),null==this.m_canvas&&(this.m_canvas=document.createElement("canvas"),this.m_div.appendChild(this.m_canvas),this.m_canvas.width=800,this.m_canvas.height=600,this.m_canvas.style.display="bolck",this.m_canvas.style.left="0px",this.m_canvas.style.top="0px",this.m_canvas.style.position="absolute")}setDivStyleLeftAndTop(t,e){this.m_div.style.left=t+"px",this.m_div.style.top=e+"px"}setDivStyleSize(t,e){this.m_divW==t&&this.m_divH==e||(this.m_div.style.width=t+"px",this.m_div.style.height=e+"px",this.resized=!0)}getDiv(){return this.m_div}getCanvas(){return this.m_canvas}}e.default=i},b161:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("3806")),n=i(s("c51d")),h=i(s("c497")),l=i(s("af68")),o=i(s("a80a")),_=i(s("9c4d")),m=i(s("d958")),u=s("5d04"),d=i(s("a446")),c=i(s("c711")),f=i(s("955e")),p=i(s("765c")),g=i(s("af29")),T=i(s("d7e2")),y=i(s("70f2")),E=i(s("2139")),x=s("a156"),v=i(s("18c7"));class S{constructor(){this.m_uid=-1,this.m_adapter=null,this.m_renderProxy=null,this.m_shader=null,this.m_rcontext=null,this.m_renderer=null,this.m_processids=new Uint8Array(128),this.m_processidsLen=0,this.m_rspace=null,this.m_mouse_rltv=new r.default,this.m_mouse_rlpv=new r.default,this.m_accessor=null,this.m_evtFlowEnabled=!1,this.m_evt3DCtr=null,this.m_mouseEvtEnabled=!0,this.m_viewX=0,this.m_viewY=0,this.m_viewW=800,this.m_viewH=800,this.m_nodeWaitLinker=null,this.m_nodeWaitQueue=null,this.m_camDisSorter=null,this.m_subscList=[],this.m_subscListLen=0,this.m_runFlag=-1,this.m_autoRunning=!0,this.m_processUpdate=!1,this.m_tickId=-1,this.m_rparam=null,this.m_enabled=!0,this.runnableQueue=new _.default,this.textureBlock=new u.TextureBlock,this.stage3D=null,this.materialBlock=null,this.entityBlock=null,this.m_containers=[],this.m_containersTotal=0,this.m_currCamera=null,this.m_mouseTestBoo=!0,this.m_cullingTestBoo=!0,this.m_rayTestFlag=!0,this.m_rayTestEnabled=!0,this.m_uid=S.s_uid++}tickUpdate(){this.m_tickId>-1&&clearTimeout(this.m_tickId),this.m_tickId=setTimeout(this.tickUpdate.bind(this),this.m_rparam.getTickUpdateTime()),this.textureBlock.run()}enable(){this.m_enabled=!0}disable(){this.m_enabled=!1}isEnabled(){return this.m_enabled}getUid(){return this.m_uid}getDiv(){return this.m_renderProxy.getDiv()}getCanvas(){return this.m_renderProxy.getCanvas()}getRPONodeBuilder(){return null}getRenderProxy(){return this.m_renderProxy}setViewPort(t,e,s,i){null!=this.m_renderProxy&&(this.m_viewX=t,this.m_viewY=e,this.m_viewW=s,this.m_viewH=i,this.m_renderProxy.setViewPort(t,e,s,i))}setViewPortFromCamera(t){null!=this.m_renderProxy&&null!=t&&(this.m_viewX=t.getViewX(),this.m_viewY=t.getViewY(),this.m_viewW=t.getViewWidth(),this.m_viewH=t.getViewHeight(),this.m_renderProxy.setViewPort(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH))}reseizeViewPort(){this.m_renderProxy.reseizeRCViewPort()}lockViewport(){this.m_adapter.lockViewport()}unlockViewport(){this.m_adapter.unlockViewport()}getRendererAdapter(){return this.m_adapter}getRenderer(){return this.m_renderer}getRendererContext(){return this.m_rcontext}getStage3D(){return this.m_renderProxy.getStage3D()}getRendererStatus(){return this.m_renderer.getRendererStatus()}getViewWidth(){return this.m_renderProxy.getStage3D().viewWidth}getViewHeight(){return this.m_renderProxy.getStage3D().viewHeight}getCamera(){return this.m_renderProxy.getCamera()}asynFBOSizeWithViewport(){this.m_rcontext.asynFBOSizeWithViewport()}synFBOSizeWithViewport(){this.m_rcontext.synFBOSizeWithViewport()}cameraLock(){this.m_renderProxy.cameraLock()}cameraUnlock(){this.m_renderProxy.cameraUnlock()}getMouseXYWorldRay(t,e){this.m_renderProxy.getMouseXYWorldRay(t,e)}createCamera(){return new n.default}createFBOInstance(){return new g.default(this,this.textureBlock.getRTTStrore())}createMatrix4(){return new v.default}setClearUint24Color(t,e=1){this.m_renderProxy.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,s){this.m_renderProxy.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.m_renderProxy.setClearRGBAColor4f(t,e,s,i)}setClearColor(t){this.m_renderProxy.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.m_rcontext.setRenderToBackBuffer()}drawBackBufferToCanvas(t){let e=this.getCanvas();var s=t.getContext("2d");s.drawImage(e,0,0,t.width,t.height)}updateRenderBufferSize(){this.m_adapter.updateRenderBufferSize()}setEvt3DController(t){null!=t&&(t.initialize(this.getStage3D(),this.getStage3D()),t.setRaySelector(this.m_rspace.getRaySelector())),this.m_evt3DCtr=t}isRayPickSelected(){return null!=this.m_evt3DCtr&&this.m_evt3DCtr.isSelected()}enableMouseEvent(t=!0){null==this.m_evt3DCtr&&(t?this.m_rspace.setRaySelector(new f.default):this.m_rspace.setRaySelector(new c.default),this.setEvt3DController(new p.default)),this.m_mouseEvtEnabled=!0}disableMouseEvent(){this.m_mouseEvtEnabled=!1}getEvt3DController(){return this.m_evt3DCtr}getSpace(){return this.m_rspace}getDevicePixelRatio(){return this.m_adapter.getDevicePixelRatio()}createSubScene(){if(null!=this.m_renderer){let t=new y.default(this,this.m_renderer,this.m_evtFlowEnabled);this.m_subscList.push(t),this.m_subscListLen++;let e=t;return e.textureBlock=this.textureBlock,t}return null}addEventListener(t,e,s,i=!0,r=!1){this.stage3D.addEventListener(t,e,s,i,r)}removeEventListener(t,e,s){this.stage3D.removeEventListener(t,e,s)}setAccessor(t){this.m_accessor=t}initialize(t=null,e=3){if(null==this.m_renderer){null==t&&(t=new h.default),this.m_rparam=t;let s=this;s.stage3D=new a.default(this.getUid(),document),e<1&&(e=1),e>8&&(e=8),this.m_evtFlowEnabled=t.evtFlowEnabled,this.m_renderer=new m.default,this.m_renderer.__$setStage3D(this.stage3D),E.default.Allocate(t.getMatrix4AllocateSize());let i=new n.default;this.m_renderer.initialize(t,i,new x.ShaderProgramBuilder(this.m_renderer.getRCUid())),this.m_processids[0]=0,this.m_processidsLen++;let r=null;for(;e>=0;)r=this.m_renderer.appendProcess(t.batchEnabled,t.processFixedState),this.m_processids[this.m_processidsLen]=r.getRPIndex(),this.m_processidsLen++,--e;this.m_rcontext=this.m_renderer.getRendererContext(),this.m_renderProxy=this.m_rcontext.getRenderProxy(),this.m_adapter=this.m_renderProxy.getRenderAdapter();let l=this.m_renderProxy.getStage3D();if(this.m_viewW=l.stageWidth,this.m_viewH=l.stageHeight,this.m_shader=this.m_renderer.getDataBuilder().getRenderShader(),this.textureBlock.setRenderer(this.m_renderProxy),this.m_camDisSorter=new T.default(this.m_renderProxy),null==this.m_rspace){let t=new d.default;t.initialize(this.m_renderer,this.m_renderProxy.getCamera()),this.m_rspace=t}this.tickUpdate()}}setRendererProcessParam(t,e,s){this.m_renderer.setRendererProcessParam(this.m_processids[t],e,s)}appendARendererProcess(t=!0,e=!1){let s=this.m_renderer.appendProcess(t,e);this.m_processids[this.m_processidsLen]=s.getRPIndex(),this.m_processidsLen++}getRenderProcessAt(t){return this.m_renderer.getProcessAt(this.m_processids[t])}addContainer(t,e=0){if(e<0&&(e=0),null!=t&&t.__$wuid<0&&t.__$contId<1){let s=0;for(;s<this.m_containersTotal;++s)if(this.m_containers[s]==t)return;s>=this.m_containersTotal&&(t.__$wuid=this.m_uid,t.wprocuid=e,t.__$setRenderer(this),this.m_containers.push(t),this.m_containersTotal++)}}removeContainer(t){if(null!=t&&t.__$wuid==this.m_uid&&t.getRenderer()==this.m_renderer){let e=0;for(;e<this.m_containersTotal;++e)if(this.m_containers[e]==t){t.__$wuid=-1,t.wprocuid=-1,t.__$setRenderer(null),this.m_containers.splice(e,1),--this.m_containersTotal;break}}}setAutoRunningEnabled(t){this.m_autoRunning=t}setAutoRenderingSort(t){this.m_processUpdate=t}setProcessSortEnabledAt(t,e,s=null){if(this.m_renderer.setProcessSortEnabledAt(t,e),e){let e=this.m_renderer.getProcessAt(t);s=null!=s?s:this.m_camDisSorter,null!=e&&e.setSorter(s)}}setProcessSortEnabled(t,e,s=null){this.m_renderer.setProcessSortEnabled(t,e),e&&null!=t&&!t.hasSorter()&&(s=null!=s?s:this.m_camDisSorter,t.setSorter(s))}moveEntityTo(t,e){this.m_renderer.moveEntityToProcessAt(t,this.m_processids[e])}drawEntity(t,e=!1,s=!0){this.m_renderer.drawEntity(t,e,s)}addEntity(t,e=0,s=!0){if(null!=t&&t.__$testSpaceEnabled())if(t.isPolyhedral())if(t.hasMesh())this.m_renderer.addEntity(t,this.m_processids[e],s),null!=this.m_rspace&&this.m_rspace.addEntity(t);else{null==this.m_nodeWaitLinker&&(this.m_nodeWaitLinker=new o.default,this.m_nodeWaitQueue=new l.default);let s=this.m_nodeWaitQueue.addEntity(t);s.rstatus=e,this.m_nodeWaitLinker.addNode(s)}else this.m_renderer.addEntity(t,this.m_processids[e],s),null!=this.m_rspace&&this.m_rspace.addEntity(t)}removeEntity(t){if(null!=t){let e=null;if(null!=this.m_nodeWaitLinker){let e=this.m_nodeWaitQueue.getNodeByEntity(t);null!=e&&(this.m_nodeWaitLinker.removeNode(e),this.m_nodeWaitQueue.removeEntity(t))}null==e&&(this.m_renderer.removeEntity(t),null!=this.m_rspace&&this.m_rspace.removeEntity(t))}}updateMaterialUniformToCurrentShd(t){this.m_renderer.updateMaterialUniformToCurrentShd(t)}showInfoAt(t){this.m_renderer.showInfoAt(t)}getRenderUnitsTotal(){return this.m_renderer.getRenderUnitsTotal()}useCamera(t,e=!1){this.m_currCamera=t,e&&(this.m_renderProxy.setRCViewPort(t.getViewX(),t.getViewY(),t.getViewWidth(),t.getViewHeight(),!0),this.m_renderProxy.reseizeRCViewPort()),t.update(),this.m_rcontext.resetUniform(),this.m_renderProxy.updateCameraDataFromCamera(t)}useMainCamera(){this.m_currCamera=null;let t=this.m_renderProxy.getCamera();this.m_renderProxy.setRCViewPort(t.getViewX(),t.getViewY(),t.getViewWidth(),t.getViewHeight(),!0),this.m_renderProxy.reseizeRCViewPort(),this.m_renderProxy.updateCamera(),this.m_rcontext.resetUniform(),this.m_renderProxy.updateCameraDataFromCamera(this.m_renderProxy.getCamera())}updateCameraDataFromCamera(t){this.m_renderProxy.updateCameraDataFromCamera(t)}resetState(){this.m_rcontext.resetState()}resetUniform(){this.m_rcontext.resetUniform()}enableSynViewAndStage(){this.m_renderProxy.enableSynViewAndStage()}renderBegin(t=!0){if(null==this.m_currCamera){if(this.m_adapter.unlockViewport(),this.m_renderProxy.isAutoSynViewAndStage()){let t=this.m_renderProxy.testViewPortChanged(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH);this.m_viewX=this.m_renderProxy.getViewX(),this.m_viewY=this.m_renderProxy.getViewY(),this.m_viewW=this.m_renderProxy.getViewWidth(),this.m_viewH=this.m_renderProxy.getViewHeight(),t&&(this.m_renderProxy.setRCViewPort(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH,!0),this.m_renderProxy.reseizeRCViewPort())}else this.m_renderProxy.setViewPort(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH);this.m_renderProxy.updateCamera(),this.m_renderProxy.updateCameraDataFromCamera(this.m_renderProxy.getCamera())}this.m_shader.renderBegin(),t&&this.m_rcontext.renderBegin(null==this.m_currCamera),this.m_currCamera=null,null!=this.m_accessor&&this.m_accessor.renderBegin(this)}runBegin(t=!0,e=!0){t&&this.m_autoRunning&&(this.m_runFlag>=0&&this.runEnd(),this.m_runFlag=0);let s=this.m_currCamera,i=null==s;this.renderBegin(e),null!=this.m_rspace&&(this.m_rspace.setCamera(i?this.m_renderProxy.getCamera():s),this.m_rspace.runBegin())}renderContextBegin(){this.m_rcontext.renderBegin()}setRayTestEanbled(t){this.m_rayTestEnabled=t}runMouseTest(t,e){let s=-1;if(null!=this.m_evt3DCtr&&this.m_mouseEvtEnabled){if(this.m_rayTestFlag&&this.m_evt3DCtr.getEvtType()>0){let t=this.m_rspace.getRaySelector();if(null!=t){this.m_rayTestEnabled?this.mouseRayTest():t.clear();let e=t.getSelectedNodesTotal();if(e>1){let s=0,i=t.getSelectedNodes(),r=null;for(;s<e;++s)r=i[s],r.entity.isPolyhedral()}}this.m_rayTestFlag=!1}s=this.m_evt3DCtr.run(t,e)}return this.m_mouseTestBoo=!1,s}update(t=!0,e=!0){if(this.stage3D.enterFrame(),t&&this.m_autoRunning&&(0!=this.m_runFlag&&this.runBegin(),this.m_runFlag=1),this.m_mouseTestBoo=!0,this.m_cullingTestBoo=!0,this.m_rayTestFlag=!0,null!=this.m_nodeWaitLinker){let t=this.m_nodeWaitLinker.getBegin();if(null!=t){let e,s,i;while(null!=t)t.entity.hasMesh()?(e=t,t=t.next,s=e.entity,i=e.rstatus,this.m_nodeWaitLinker.removeNode(e),this.m_nodeWaitQueue.removeEntity(e.entity),this.addEntity(s,i)):t=t.next}}let s=0;for(;s<this.m_containersTotal;++s)this.m_containers[s].update();this.m_renderer.update(),null!=this.m_rspace&&(this.m_rspace.update(),this.m_cullingTestBoo&&(null!=this.m_evt3DCtr||this.m_processUpdate||null!=this.m_rspace.getRaySelector())&&this.m_rspace.run()),this.m_processUpdate&&this.m_renderer.updateAllProcess(),this.m_mouseTestBoo&&!this.m_evtFlowEnabled&&(e?this.runMouseTest(1,0):null!=this.m_evt3DCtr&&this.m_evt3DCtr.mouseOutEventTarget())}cullingTest(){null!=this.m_rspace&&this.m_rspace.run(),this.m_cullingTestBoo=!1}mouseRayTest(){null!=this.m_rspace&&(this.m_renderProxy.getMouseXYWorldRay(this.m_mouse_rlpv,this.m_mouse_rltv),this.m_rspace.rayTest(this.m_mouse_rlpv,this.m_mouse_rltv))}run(t=!0){if(this.m_enabled){if(t&&this.m_autoRunning&&(1!=this.m_runFlag&&this.update(),this.m_runFlag=2),this.runnableQueue.run(),this.m_subscListLen>0)for(let t=0;t<this.m_processidsLen;++t)this.m_renderer.runAt(this.m_processids[t]);else this.m_renderer.run();t&&this.runEnd()}}runAt(t){this.m_enabled&&this.m_renderer.runAt(this.m_processids[t])}runEnd(){null!=this.m_evt3DCtr&&this.m_evt3DCtr.runEnd(),this.m_rcontext.runEnd(),null!=this.m_rspace&&this.m_rspace.runEnd(),this.m_autoRunning&&(this.m_runFlag=-1),null!=this.m_accessor&&this.m_accessor.renderEnd(this)}renderFlush(){null!=this.m_renderProxy&&this.m_renderProxy.flush()}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}toString(){return"[RendererScene(uid = "+this.m_uid+")]"}}S.s_uid=0,e.default=S},b30a:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("644c"));class a{constructor(t,e,s,i){this.m_sharedUniformList=[],this.m_unlocked=!0,this.m_texUnlocked=!1,this.m_preuid=-1,this.m_currShd=null,this.m_fragOutputTotal=1,this.m_rcuid=-1,this.m_rc=null,this.m_gpuProgram=null,this.m_adapter=null,this.m_guniform=null,this.m_uniform=null,this.m_transformUniform=null,this.m_shdProgramBuilder=null,this.drawFlag=-1,this.__$globalUniform=null,this.m_rcuid=t,this.m_rc=e,this.m_adapter=s,this.m_shdProgramBuilder=i}createResByParams3(t,e,s,i){return!1}getRC(){return this.m_rc}getGPUProgram(){return this.m_gpuProgram}getRCUid(){return this.m_rcuid}useTransUniform(t){this.m_transformUniform!=t&&(this.m_transformUniform=t,t.use(this))}useUniform(t){this.m_uniform!=t&&(this.m_uniform=t,t.use(this))}updateUniform(t){null!=t&&t.use(this)}unlock(){this.m_unlocked=!0,this.__$globalUniform=null}isUnLocked(){return this.m_unlocked}lock(){this.m_unlocked=!1}textureUnlock(){this.m_texUnlocked=!0}isTextureUnLocked(){return this.m_texUnlocked}textureLock(){this.m_texUnlocked=!1}setSharedUniformByShd(t,e){this.m_sharedUniformList[t.getUid()]=e}getSharedUniformByShd(t){return this.m_sharedUniformList[t.getUid()]}getCurrFragOutputTotal(){return this.m_fragOutputTotal}hasResUid(t){return this.m_shdProgramBuilder.hasUid(t)}bindToGpu(t){if(this.m_unlocked&&this.m_shdProgramBuilder.containsUid(t))if(this.m_preuid!=t){this.m_preuid=t;let e=this.m_shdProgramBuilder.findShdProgramByUid(t);this.m_fragOutputTotal=e.getFragOutputTotal(),this.m_fragOutputTotal,this.getActiveAttachmentTotal(),this.m_gpuProgram=e.getGPUProgram(),this.m_rc.useProgram(this.m_gpuProgram),e.useTexLocation();let s=this.m_sharedUniformList[e.getUid()];this.m_guniform=s;while(null!=s)s.use(this),s=s.next;this.m_currShd=e}else if(null==this.m_guniform&&null!=this.m_currShd){let t=this.m_sharedUniformList[this.m_currShd.getUid()];this.m_guniform=t;while(null!=t)t.use(this),t=t.next}}getGpuBuffer(t){return null}getCurrentShd(){return this.m_currShd}getCurrentShdUid(){return this.m_preuid}resetUniform(){this.m_uniform=null,this.m_transformUniform=null,this.m_guniform=null}renderBegin(){this.m_fragOutputTotal=1,this.m_preuid=-1,this.m_currShd=null,this.drawFlag=-1}update(){}destroy(){this.m_rc=null,this.m_adapter=null}useUniformToCurrentShd(t){this.m_uniform!=t&&(this.m_uniform,t.useByShd(this,this.m_currShd))}useUniform2ToCurrentShd(t,e){this.m_uniform!=t&&(this.m_uniform,t.useByShd(this,this.m_currShd)),this.m_transformUniform!=e&&(this.m_transformUniform,e.useByShd(this,this.m_currShd))}useUniformMat4(t,e){this.m_rc.uniformMatrix4fv(t,!1,e)}useUniformV2(t,e,s,i,a){switch(e){case r.default.SHADER_MAT4:this.m_rc.uniformMatrix4fv(t,!1,s,a,16*i);break;case r.default.SHADER_MAT3:this.m_rc.uniformMatrix3fv(t,!1,s,0,9*i);break;case r.default.SHADER_VEC4FV:this.m_rc.uniform4fv(t,s,a,4*i);break;case r.default.SHADER_VEC3FV:this.m_rc.uniform3fv(t,s,a,3*i);break;case r.default.SHADER_VEC4:this.m_rc.uniform4f(t,s[0],s[1],s[2],s[3]);break;case r.default.SHADER_VEC3:this.m_rc.uniform3f(t,s[0],s[1],s[2]);break;case r.default.SHADER_VEC2:this.m_rc.uniform2f(t,s[0],s[1]);break;default:break}}useUniformV1(t,e,s,i){switch(e){case r.default.SHADER_MAT4:this.m_rc.uniformMatrix4fv(t,!1,s);break;case r.default.SHADER_MAT3:this.m_rc.uniformMatrix3fv(t,!1,s);break;case r.default.SHADER_VEC4FV:this.m_rc.uniform4fv(t,s,4*i);break;case r.default.SHADER_VEC3FV:this.m_rc.uniform3fv(t,s,3*i);break;case r.default.SHADER_VEC4:this.m_rc.uniform4f(t,s[0],s[1],s[2],s[3]);break;case r.default.SHADER_VEC3:this.m_rc.uniform3f(t,s[0],s[1],s[2]);break;case r.default.SHADER_VEC2:this.m_rc.uniform2f(t,s[0],s[1]);break;default:break}}getActiveAttachmentTotal(){return this.m_adapter.getActiveAttachmentTotal()}}e.default=a},b3bd:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uns="",this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,s=e.length;for(let i=0;i<s;++i)if(t==e[i])return this.dataList[i]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let s=this.uniformNameList,i=s.length;for(let r=0;r<i;++r)if(t==s[r]){this.dataList[r]=e;break}}}copyDataFromProbe(t){this.types=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]);this.uniformSize=t.uniformsTotal}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.calcModels=null}}e.default=i},b406:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}initialize(){}addModuleByUniqueName(t){}startupModuleByUniqueName(t){}destroy(){}}e.CoRuntime=i},b627:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("026b"),r=s("7577");class a extends r.SceneNode{constructor(){super(),this.m_mi=0}load(t){super.load(t),this.loadFBXBySteps(t[0])}loadFBXBySteps(t){this.m_partsTotal=0,this.m_showTotal=0;let e=new i.FBXBufferLoader;this.m_fbxBufLoader=e,e.loadBySteps(t,(t,e,s,i,r)=>{this.m_modelsTotal=i,this.m_waitPartsTotal=i,this.initEntity(t,e.transform,s),s+1==i&&(this.m_waitPartsTotal=0)},(t,e)=>{let s=Math.round(100*t.loaded/t.total);this.showInfo("fbx file loading "+s+"%")})}mouseDown(t){}loadFBX(){let t="static/assets/fbx/test01.fbx",e=new i.FBXBufferLoader;e.load(t,(t,e)=>{this.m_partsTotal=0;for(let[s,i]of t)this.m_partsTotal++,this.initEntity(i);this.m_waitPartsTotal=0})}}e.FBXSceneNode=a},b9b5:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("9c3c")),a=i(s("402a")),n=i(s("3930")),h=i(s("32cc")),l=i(s("8e17"));class o extends a.default{constructor(){super(),this.rayTestRadius=8,this.colorX=new n.default(1,0,0,1),this.colorY=new n.default(0,1,0,1),this.colorZ=new n.default(0,0,1,1),this.m_posarr=[0,0,0,100,0,0,0,0,0,0,100,0,0,0,0,0,0,100]}setLineWidth(t){}createMaterial(){if(null==this.getMaterial()){let t=new h.default;this.setMaterial(t)}}__activeMesh(t){if(null==this.getMesh()){let e=[this.colorX.r,this.colorX.g,this.colorX.b,this.colorX.r,this.colorX.g,this.colorX.b,this.colorY.r,this.colorY.g,this.colorY.b,this.colorY.r,this.colorY.g,this.colorY.b,this.colorZ.r,this.colorZ.g,this.colorZ.b,this.colorZ.r,this.colorZ.g,this.colorZ.b],s=new r.default;s.rayTestRadius=this.rayTestRadius,s.vbWholeDataEnabled=!1,s.setBufSortFormat(t.getBufSortFormat()),s.initialize(this.m_posarr,e),this.setMesh(s)}}initialize(t=100){t<2&&(t=2),this.m_posarr[3]=t,this.m_posarr[10]=t,this.m_posarr[17]=t,this.createMaterial(),this.activeDisplay()}initializeSizeXYZ(t,e,s){this.m_posarr[3]=t,this.m_posarr[10]=e,this.m_posarr[17]=s,this.createMaterial(),this.activeDisplay()}initializeCorssSizeXYZ(t,e,s){t*=.5,e*=.5,s*=.5,this.m_posarr[0]=-t,this.m_posarr[7]=-e,this.m_posarr[14]=-s,this.m_posarr[3]=t,this.m_posarr[10]=e,this.m_posarr[17]=s,this.createMaterial(),this.activeDisplay()}initializeCross(t=100,e=null){t<2&&(t=2),t*=.5,null==e&&(e=new l.default),this.m_posarr[0]=-t+e.x,this.m_posarr[7]=-t+e.y,this.m_posarr[14]=-t+e.z,this.m_posarr[3]=t+e.x,this.m_posarr[10]=t+e.y,this.m_posarr[17]=t+e.z,this.createMaterial(),this.activeDisplay()}toString(){return"Axis3DEntity(name="+this.name+",uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=o},baae:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.FRAMEBUFFER=71,i.DRAW_FRAMEBUFFER=72,i.READ_FRAMEBUFFER=73,e.default=i},badb:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("1710")),a=i(s("ee5a"));class n{constructor(){this.m_evtNodes=null,this.m_evtNodesLen=18,this.uuid="",this.data=null,this.m_evtNodesLen=r.default.GetMouseEvtTypeValuesTotal(),this.m_evtNodes=new Array(this.m_evtNodesLen)}getClassType(){return r.default.EventClassType}destroy(){for(let t=0;t<this.m_evtNodesLen;++t)null!=this.m_evtNodes[t]&&this.m_evtNodes[t].destroy()}dispatchEvt(t){if(null!=t){""!=this.uuid&&(t.uuid=this.uuid),null!=this.data&&(t.data=this.data);let e=t.type-r.default.GetMouseEvtTypeValueBase();if(e>=0&&e<r.default.GetMouseEvtTypeValuesTotal()&&null!=this.m_evtNodes[e])return this.m_evtNodes[e].dispatch(t)}return 0}passTestEvt(t){if(null!=t){let e=t.type-r.default.GetMouseEvtTypeValueBase();if(e>=0&&e<r.default.GetMouseEvtTypeValuesTotal())return this.m_evtNodes[e].passTestEvt(t)}return 0}passTestPhase(t){let e=r.default.GetMouseEvtTypeValuesTotal();for(let s=0;s<e;++s)if(null!=this.m_evtNodes[s]&&1==this.m_evtNodes[s].passTestPhase(t))return 1;return 0}addEventListener(t,e,s,i=!0,n=!1){if(null!=s&&null!=e){let h=t-r.default.GetMouseEvtTypeValueBase();if(h>=0&&h<r.default.GetMouseEvtTypeValuesTotal()){let t=0;i!=n&&(t=i?1:2),null!=this.m_evtNodes[h]||(this.m_evtNodes[h]=new a.default),this.m_evtNodes[h].addListener(e,s,t)}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=t-r.default.GetMouseEvtTypeValueBase();i>=0&&i<r.default.GetMouseEvtTypeValuesTotal()&&null!=this.m_evtNodes[i]&&this.m_evtNodes[i].removeListener(e,s)}}}e.default=n},bbf4:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.CAMERA_VISIBLE_ENABLE=0,i.CAMERA_VISIBLE_DISABLE=1,e.default=i},bcac:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(){this.m_stage3D=null,this.m_camera=null,this.m_mouseX=0,this.m_mouseY=0,this.m_enabled=!1,this.m_rotationSpeed=0,this.m_aotuRotationDelay=100,this.autoRotationEnabled=!1,this.autoRotationSpeed=.2,this.rotationAttenuationEnabled=!1,this.rotationSpeed=.2}initialize(t,e){null==this.m_stage3D&&(this.m_stage3D=t,this.m_camera=e)}attach(){this.m_mouseX=this.m_stage3D.mouseX,this.m_mouseY=this.m_stage3D.mouseY,this.m_enabled=!0,this.m_aotuRotationDelay=100}detach(){this.m_enabled=!1}runWithYAxis(){if(this.m_enabled){let t=this.m_mouseX-this.m_stage3D.mouseX,e=this.m_mouseY-this.m_stage3D.mouseY,s=Math.abs(t),i=Math.abs(e);s>i?(this.m_rotationSpeed=t*this.rotationSpeed,s>.5&&this.m_camera.swingHorizontalWithAxis(this.m_rotationSpeed,r.default.Y_AXIS)):(this.m_rotationSpeed=0,i>.5&&this.m_camera.swingVertical(-e*this.rotationSpeed)),this.m_mouseX=this.m_stage3D.mouseX,this.m_mouseY=this.m_stage3D.mouseY}else this.autoRotationEnabled&&(this.m_aotuRotationDelay<0?this.m_camera.swingHorizontalWithAxis(this.autoRotationSpeed,r.default.Y_AXIS):this.m_aotuRotationDelay--)}runWithZAxis(){if(this.m_enabled){let t=this.m_mouseX-this.m_stage3D.mouseX,e=this.m_mouseY-this.m_stage3D.mouseY,s=Math.abs(t),i=Math.abs(e);s>i?s>.5&&this.m_camera.swingHorizontalWithAxis(.2*t,r.default.Z_AXIS):i>.5&&this.m_camera.swingVertical(-.2*e),this.m_mouseX=this.m_stage3D.mouseX,this.m_mouseY=this.m_stage3D.mouseY}else this.autoRotationEnabled&&(this.m_aotuRotationDelay<0?this.m_camera.swingHorizontalWithAxis(this.autoRotationSpeed,r.default.Z_AXIS):this.m_aotuRotationDelay--)}runWithCameraAxis(){if(this.m_enabled){let t=this.m_mouseX-this.m_stage3D.mouseX,e=this.m_mouseY-this.m_stage3D.mouseY,s=Math.abs(t),i=Math.abs(e);s>i?s>.5&&this.m_camera.swingHorizontal(.2*t):i>.5&&this.m_camera.swingVertical(-.2*e),this.m_mouseX=this.m_stage3D.mouseX,this.m_mouseY=this.m_stage3D.mouseY}else this.autoRotationEnabled&&(this.m_aotuRotationDelay<0?this.m_camera.swingHorizontal(this.autoRotationSpeed):this.m_aotuRotationDelay--)}}e.CameraDragSwinger=a},bd49:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("74ee");e.DataUnitLock=i.DataUnitLock,e.DataUnit=i.DataUnit;class r{constructor(){this.dataFormat=i.DataFormat.CTM,this.image=null}setFormatBUrl(t){if(""!=t){let e=t.lastIndexOf(".");if(e<=0)throw Error("illegal geometry data url: "+t);switch(t.slice(e+1)){case i.DataFormat.CTM:this.dataFormat=i.DataFormat.CTM;break;case i.DataFormat.Draco:this.dataFormat=i.DataFormat.Draco;break;default:throw Error("illegal geometry data url: "+t)}}}}e.TextureDataContainer=r;class a extends i.DataUnit{constructor(){super(),this.data=null,this.dataClass=i.DataClass.Geometry}}e.TextureDataUnit=a},c120:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(){this.entity=null,this.lpv=new r.default,this.wpv=new r.default,this.dis=0,this.flag=0}}e.default=a},c164:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}}i.BasePredefined="\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n",e.MathShaderCode=i;class r{constructor(){}}r.BasePredefined="\nvec4 localPosition = vec4(0.0,0.0,0.0,1.0);\nvec4 worldPosition = vec4(0.0,0.0,0.0,1.0);\n// view space position\nvec4 viewPosition = vec4(0.0,0.0,0.0,1.0);\nvec3 worldNormal = vec3(0.0, 0.0, 1.0);\n",r.FragPredefined="\n",r.FragDefined="\n",r.VertPredefined="\n// origin world position\nvec4 oWorldPosition = vec4(0.0,0.0,0.0,1.0);\n",r.VertDefined="\n",e.ShaderCode=r},c497:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(t=null){this.m_matrix4AllocateSize=8192,this.m_mainDiv=null,this.m_renderContextAttri={depth:!0,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:!1,preserveDrawingBuffer:!0,powerPreference:"high-performance"},this.m_tickUpdateTime=20,this.m_polygonOffsetEnabled=!1,this.m_ditherEnabled=!1,this.autoSyncRenderBufferAndWindowSize=!0,this.maxWebGLVersion=2,this.cameraPerspectiveEnabled=!0,this.evtFlowEnabled=!1,this.camProjParam=new r.default(45,10,5e3),this.camPosition=new r.default(2e3,2e3,2e3),this.camLookAtPos=new r.default(0,0,0),this.camUpDirect=new r.default(0,1,0),this.batchEnabled=!0,this.processFixedState=!1,this.m_mainDiv=t,this.autoSyncRenderBufferAndWindowSize=null==t}setTickUpdateTime(t){t=Math.round(t),this.m_tickUpdateTime=t>5?t:5}getTickUpdateTime(){return this.m_tickUpdateTime}setPolygonOffsetEanbled(t){this.m_polygonOffsetEnabled=t}getPolygonOffsetEanbled(){return this.m_polygonOffsetEnabled}setDitherEanbled(t){this.m_ditherEnabled=t}getDitherEanbled(){return this.m_ditherEnabled}getDiv(){return this.m_mainDiv}getRenderContextAttri(){return this.m_renderContextAttri}setAttriDepth(t){this.m_renderContextAttri.depth=t}setAttriStencil(t){this.m_renderContextAttri.stencil=t}setAttriAlpha(t){this.m_renderContextAttri.alpha=t}setAttriPremultipliedAlpha(t){this.m_renderContextAttri.premultipliedAlpha=t}setAttriAntialias(t){this.m_renderContextAttri.antialias=t}setAttripreserveDrawingBuffer(t){this.m_renderContextAttri.preserveDrawingBuffer=t}setAttriHightPowerPreference(t){this.m_renderContextAttri.powerPreference=t?"high-performance":"default"}setMatrix4AllocateSize(t){t<1024&&(t=1024),this.m_matrix4AllocateSize=t}getMatrix4AllocateSize(){return this.m_matrix4AllocateSize}setCamProject(t,e,s){if(e>=s)throw Error("Error Camera cear > far !!!");this.camProjParam.setTo(t,e,s)}setCamPosition(t,e,s){this.camPosition.setTo(t,e,s)}setCamLookAtPos(t,e,s){this.camLookAtPos.setTo(t,e,s)}setCamUpDirect(t,e,s){this.camUpDirect.setTo(t,e,s)}}e.default=a},c51d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("18c7")),h=i(s("e214")),l=i(s("fecb"));class o{constructor(){this.version=0,this.matUProbe=null,this.ufrustumProbe=null,this.uniformEnabled=!1,this.name="Camera",this.m_tempV=new a.default,this.m_tempV1=new a.default,this.m_initRV=new a.default,this.m_initUP=new a.default,this.m_lookRHEnabled=!0,this.m_matrix=new n.default,this.m_viewMat=new n.default,this.m_viewInvertMat=new n.default,this.m_vpMat=new n.default,this.m_tempMat=new n.default,this.m_projMat=new n.default,this.m_camPos=new a.default,this.m_lookAtPos=new a.default,this.m_up=new a.default,this.m_lookDirectNV=new a.default,this.m_lookAtDirec=new a.default,this.m_nearPlaneWidth=1,this.m_nearPlaneHeight=1,this.m_viewX=0,this.m_viewY=0,this.m_viewW=800,this.m_viewH=600,this.m_viewHalfW=400,this.m_viewHalfH=300,this.m_fovRadian=0,this.m_aspect=1,this.m_zNear=.1,this.m_zFar=1e3,this.m_b=0,this.m_t=0,this.m_l=0,this.m_r=0,this.m_perspectiveEnabled=!1,this.m_project2Enabled=!1,this.m_rightHandEnabled=!0,this.m_rotV=new a.default(0,0,0),this.m_viewFieldZoom=1,this.m_changed=!0,this.m_unlock=!0,this.m_tempNV=new a.default,this.m_tempUPV=new a.default,this.m_tempRV=new a.default,this.m_tempCamPos=new a.default,this.m_tempLookAtPos=new a.default,this.m_rotDegree=0,this.m_rotAxis=new a.default,this.m_rotPivotPoint=null,this.m_axisRotEnabled=!1,this.m_frustumWAABB=new l.default,this.m_invViewMat=null,this.m_nearPlaneHalfW=.5,this.m_nearPlaneHalfH=.5,this.m_nearWCV=new a.default,this.m_farWCV=new a.default,this.m_wNV=new a.default,this.m_wFrustumVtxArr=[new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,null,null,null],this.m_wFruPlaneList=[new h.default,new h.default,new h.default,new h.default,new h.default,new h.default],this.m_fpNVArr=[new a.default,new a.default,new a.default,new a.default,new a.default,new a.default],this.m_fpDisArr=[0,0,0,0,0,0],this.m_viewMatrix=null}lock(){this.m_unlock=!1}unlock(){this.m_unlock=!0}lookAtLH(t,e,s){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtPos.copyFrom(e),this.m_up.copyFrom(s),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!1,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_initUP.copyFrom(s),this.m_initUP.normalize(),a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}lookAtRH(t,e,s){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtPos.copyFrom(e),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_lookAtDirec,s,this.m_initRV),a.default.Cross(this.m_initRV,this.m_lookAtDirec,this.m_initUP),this.m_initUP.normalize(),this.m_initRV.normalize(),this.m_up.copyFrom(this.m_initUP),this.m_changed=!0)}getLookAtLHToCamera(t){t.lookAtLH(this.m_camPos,this.m_lookAtPos,this.m_up)}getLookAtRHToCamera(t){t.lookAtRH(this.m_camPos,this.m_lookAtPos,this.m_up)}perspectiveLH(t,e,s,i){this.m_unlock&&(this.m_project2Enabled=!1,this.m_aspect=e,this.m_fovRadian=t,this.m_zNear=s,this.m_zFar=i,this.m_projMat.perspectiveLH(t,e,s,i),this.m_viewFieldZoom=Math.tan(.5*t),this.m_perspectiveEnabled=!0,this.m_rightHandEnabled=!1,this.m_changed=!0)}perspectiveRH(t,e,s,i){this.m_unlock&&(this.m_aspect=e,this.m_fovRadian=t,this.m_zNear=s,this.m_zFar=i,this.m_projMat.perspectiveRH(t,e,s,i),this.m_viewFieldZoom=Math.tan(.5*t),this.m_project2Enabled=!1,this.m_perspectiveEnabled=!0,this.m_rightHandEnabled=!0,this.m_changed=!0)}perspectiveRH2(t,e,s,i,r){this.m_unlock&&(this.m_aspect=e/s,this.m_fovRadian=t,this.m_zNear=i,this.m_zFar=r,this.m_projMat.perspectiveRH2(t,e,s,i,r),this.m_viewFieldZoom=Math.tan(.5*t),this.m_perspectiveEnabled=!0,this.m_project2Enabled=!0,this.m_rightHandEnabled=!0,this.m_changed=!0)}getAspect(){return this.m_aspect}getViewFieldZoom(){return this.m_viewFieldZoom}orthoRH(t,e,s,i,r,a){this.m_unlock&&(this.m_zNear=t,this.m_zFar=e,this.m_b=s,this.m_t=i,this.m_l=r,this.m_r=a,this.m_projMat.orthoRH(s,i,r,a,t,e),this.m_perspectiveEnabled=!1,this.m_rightHandEnabled=!0,this.m_changed=!0)}orthoLH(t,e,s,i,r,a){this.m_unlock&&(this.m_zNear=t,this.m_zFar=e,this.m_b=s,this.m_t=i,this.m_l=r,this.m_r=a,this.m_projMat.orthoLH(s,i,r,a,t,e),this.m_perspectiveEnabled=!1,this.m_rightHandEnabled=!1,this.m_changed=!0)}isPerspectiveEnabled(){return this.m_perspectiveEnabled}isRightHandEnabled(){return this.m_rightHandEnabled}setViewXY(t,e){this.m_unlock&&(this.m_viewX=t,this.m_viewY=e)}setViewSize(t,e){this.m_unlock&&(t==this.m_viewW&&e==this.m_viewH||(this.m_viewW=t,this.m_viewH=e,this.m_viewHalfW=.5*t,this.m_viewHalfH=.5*e,this.m_perspectiveEnabled?this.m_project2Enabled?this.m_rightHandEnabled&&this.perspectiveRH2(this.m_fovRadian,t,e,this.m_zNear,this.m_zFar):this.m_rightHandEnabled?this.perspectiveRH(this.m_fovRadian,t/e,this.m_zNear,this.m_zFar):this.perspectiveLH(this.m_fovRadian,t/e,this.m_zNear,this.m_zFar):this.orthoRH(this.m_zNear,this.m_zFar,-.5*e,.5*e,-.5*t,.5*t)))}getViewX(){return this.m_viewX}getViewY(){return this.m_viewY}getViewWidth(){return this.m_viewW}getViewHeight(){return this.m_viewH}translation(t){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtPos.x=t.x+this.m_lookAtDirec.x,this.m_lookAtPos.y=t.y+this.m_lookAtDirec.y,this.m_lookAtPos.z=t.z+this.m_lookAtDirec.z,this.m_changed=!0)}translationXYZ(t,e,s){this.m_tempV.setXYZ(t,e,s),this.m_unlock&&a.default.DistanceSquared(this.m_camPos,this.m_tempV)>1e-5&&(this.m_camPos.setTo(t,e,s),this.m_lookAtPos.x=t+this.m_lookAtDirec.x,this.m_lookAtPos.y=e+this.m_lookAtDirec.y,this.m_lookAtPos.z=s+this.m_lookAtDirec.z,this.m_changed=!0)}forward(t){this.m_unlock&&(this.m_camPos.x+=this.m_lookDirectNV.x*t,this.m_camPos.y+=this.m_lookDirectNV.y*t,this.m_camPos.z+=this.m_lookDirectNV.z*t,this.m_lookAtPos.x=this.m_camPos.x+this.m_lookAtDirec.x,this.m_lookAtPos.y=this.m_camPos.y+this.m_lookAtDirec.y,this.m_lookAtPos.z=this.m_camPos.z+this.m_lookAtDirec.z,this.m_changed=!0)}slideViewOffsetXY(t,e){if(this.m_unlock){this.m_tempV.setXYZ(t,e,0),this.m_invViewMat.transformVectorSelf(this.m_tempV),t=this.m_tempV.x-this.m_camPos.x,e=this.m_tempV.y-this.m_camPos.y;let s=this.m_tempV.z-this.m_camPos.z;this.m_camPos.x+=t,this.m_camPos.y+=e,this.m_camPos.z+=s,this.m_lookAtPos.x+=t,this.m_lookAtPos.y+=e,this.m_lookAtPos.z+=s,this.m_changed=!0}}forwardFixPos(t,e){this.m_unlock&&(this.m_camPos.x=e.x+this.m_lookDirectNV.x*t,this.m_camPos.y=e.y+this.m_lookDirectNV.y*t,this.m_camPos.z=e.z+this.m_lookDirectNV.z*t,this.m_lookAtPos.x=this.m_camPos.x+this.m_lookAtDirec.x,this.m_lookAtPos.y=this.m_camPos.y+this.m_lookAtDirec.y,this.m_lookAtPos.z=this.m_camPos.z+this.m_lookAtDirec.z,this.m_changed=!0)}swingHorizontalWithAxis(t,e){this.m_unlock&&(this.m_tempMat.identity(),null!=e?this.m_tempMat.appendRotation(t*r.default.MATH_PI_OVER_180,e):this.m_tempMat.appendRotation(t*r.default.MATH_PI_OVER_180,a.default.Y_AXIS),this.m_lookAtDirec.x=this.m_camPos.x-this.m_lookAtPos.x,this.m_lookAtDirec.y=this.m_camPos.y-this.m_lookAtPos.y,this.m_lookAtDirec.z=this.m_camPos.z-this.m_lookAtPos.z,this.m_tempMat.transformVectorSelf(this.m_lookAtDirec),this.m_camPos.x=this.m_lookAtDirec.x+this.m_lookAtPos.x,this.m_camPos.y=this.m_lookAtDirec.y+this.m_lookAtPos.y,this.m_camPos.z=this.m_lookAtDirec.z+this.m_lookAtPos.z,this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_tempMat.transformVectorSelf(this.m_initRV),this.m_initRV.normalize(),a.default.Cross(this.m_initRV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_changed=!0)}swingHorizontal(t){this.m_unlock&&(this.m_tempMat.identity(),this.m_tempMat.appendRotation(t*r.default.MATH_PI_OVER_180,this.m_up),this.m_lookAtDirec.x=this.m_camPos.x-this.m_lookAtPos.x,this.m_lookAtDirec.y=this.m_camPos.y-this.m_lookAtPos.y,this.m_lookAtDirec.z=this.m_camPos.z-this.m_lookAtPos.z,this.m_tempMat.transformVectorSelf(this.m_lookAtDirec),this.m_camPos.x=this.m_lookAtDirec.x+this.m_lookAtPos.x,this.m_camPos.y=this.m_lookAtDirec.y+this.m_lookAtPos.y,this.m_camPos.z=this.m_lookAtDirec.z+this.m_lookAtPos.z,this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}swingVertical(t){this.m_unlock&&(this.m_tempMat.identity(),this.m_tempMat.appendRotation(t*r.default.MATH_PI_OVER_180,this.m_initRV),this.m_lookAtDirec.x=this.m_camPos.x-this.m_lookAtPos.x,this.m_lookAtDirec.y=this.m_camPos.y-this.m_lookAtPos.y,this.m_lookAtDirec.z=this.m_camPos.z-this.m_lookAtPos.z,this.m_tempMat.transformVectorSelf(this.m_lookAtDirec),this.m_camPos.x=this.m_lookAtDirec.x+this.m_lookAtPos.x,this.m_camPos.y=this.m_lookAtDirec.y+this.m_lookAtPos.y,this.m_camPos.z=this.m_lookAtDirec.z+this.m_lookAtPos.z,this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_initRV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_initUP.copyFrom(this.m_up),this.m_changed=!0)}setPosition(t){if(this.m_unlock){a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_tempV);let e=this.m_tempV.dot(this.m_initUP);this.m_tempV1.copyFrom(this.m_initUP),this.m_tempV1.scaleBy(e),this.m_tempV.subtractBy(this.m_tempV1),this.m_camPos.copyFrom(t),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_tempV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_changed=!0}}setPositionXYZ(t,e,s){if(this.m_unlock){a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_tempV);var i=this.m_tempV.dot(this.m_initUP);this.m_tempV1.copyFrom(this.m_initUP),this.m_tempV1.scaleBy(i),this.m_tempV.subtractBy(this.m_tempV1),this.m_camPos.setTo(t,e,s),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_tempV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_changed=!0}}setLookPosXYZFixUp(t,e,s){this.m_unlock&&(this.m_lookAtPos.setTo(t,e,s),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}setPositionXYZFixUp(t,e,s){this.m_unlock&&(this.m_camPos.setTo(t,e,s),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}setPositionFixUp(t){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}copyFrom(t){let e=t.getPosition();this.m_camPos.copyFrom(e),e=t.getLookAtPosition(),this.m_lookAtPos.copyFrom(e),this.setZNear(t.getZNear()),this.setZFar(t.getZFar()),this.setNearPlaneWidth(t.getNearPlaneWidth()),this.setNearPlaneHeight(t.getNearPlaneHeight()),this.setPerspectiveEnabled(t.getPerspectiveEnabled()),this.m_viewInvertMat.copyFrom(t.getViewInvMatrix())}getNV(){return this.m_tempNV.copyFrom(this.m_lookDirectNV),this.m_tempNV}getUV(){return this.m_tempUPV.copyFrom(this.m_up),this.m_tempUPV}getRV(){return this.m_tempRV.copyFrom(this.m_initRV),this.m_tempRV}getPosition(){return this.m_tempCamPos.copyFrom(this.m_camPos),this.m_tempCamPos}getLookAtPosition(){return this.m_tempLookAtPos.copyFrom(this.m_lookAtPos),this.m_tempLookAtPos}setLookAtPosition(t){this.m_unlock&&(this.m_lookAtPos.copyFrom(t),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_changed=!0)}setLookAtXYZ(t,e,s){this.m_unlock&&(this.m_lookAtPos.setTo(t,e,s),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_changed=!0)}getPerspectiveEnabled(){return this.m_perspectiveEnabled}setPerspectiveEnabled(t){this.m_perspectiveEnabled=t}appendRotationByAxis(t,e,s=null){this.m_unlock&&(this.m_rotDegree=t,this.m_changed=!0,this.m_rotAxis.copyFrom(e),this.m_rotPivotPoint=s,this.m_axisRotEnabled=!0)}setRotationX(t){this.m_rotV.x=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getRotationX(){return this.m_rotV.x}setRotationY(t){this.m_rotV.y=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getRotationY(){return this.m_rotV.y}setRotationZ(t){this.m_rotV.z=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getRotationZ(){return this.m_rotV.z}setRotationXYZ(t,e,s){this.m_unlock&&(this.m_rotV.setXYZ(t,e,s),this.m_changed=!0,this.m_axisRotEnabled=!1)}screenXYToViewXYZ(t,e,s){t-=this.m_viewX,e-=this.m_viewY,this.m_perspectiveEnabled&&(t=this.m_nearPlaneWidth*(t-this.m_viewHalfW)/this.m_viewHalfW,e=this.m_nearPlaneHeight*(this.m_viewHalfH-e)/this.m_viewHalfH),s.setTo(t,e,-this.m_zNear)}screenXYToWorldXYZ(t,e,s){t-=this.m_viewX,e-=this.m_viewY,this.m_perspectiveEnabled&&(t=.5*this.m_nearPlaneWidth*(t-this.m_viewHalfW)/this.m_viewHalfW,e=.5*this.m_nearPlaneHeight*(this.m_viewHalfH-e)/this.m_viewHalfH),s.setTo(t,e,-this.m_zNear),s.w=1,this.m_viewInvertMat.transformVectorSelf(s)}getWorldPickingRayByScreenXY(t,e,s,i){t-=this.m_viewX,e-=this.m_viewY,this.m_perspectiveEnabled?(t=.5*this.m_nearPlaneWidth*(t-this.m_viewHalfW)/this.m_viewHalfW,e=.5*this.m_nearPlaneHeight*(e-this.m_viewHalfH)/this.m_viewHalfH,s.setTo(t,e,-this.m_zNear),s.w=1,this.m_viewInvertMat.transformVectorSelf(s),i.copyFrom(s),i.subtractBy(this.m_camPos),i.normalize()):(t-=this.m_viewHalfW,e-=this.m_viewHalfH,s.setTo(t,e,-this.m_zNear),s.w=1,this.m_viewInvertMat.transformVectorSelf(s),i.copyFrom(this.m_lookDirectNV))}calcScreenNormalizeXYByWorldPos(t,e){e.copyFrom(t),this.m_vpMat.transformVectorSelf(e),e.x/=e.w,e.y/=e.w}worldPosToScreen(t){this.m_viewMat.transformVector3Self(t),this.m_projMat.transformVectorSelf(t),t.x/=t.w,t.y/=t.w,t.x*=this.m_viewHalfW,t.y*=this.m_viewHalfH,t.x+=this.m_viewX,t.y+=this.m_viewY}calcViewRectByWorldSphere(t,e,s){this.m_viewMat.transformVector3Self(t),e*=1.15,s.x=t.x-e,s.y=t.y-e,s.z=t.z,t.x+=e,t.y+=e,this.m_projMat.transformPerspV4Self(s),this.m_projMat.transformPerspV4Self(t),t.z=1/t.w,s.z=t.x*t.z,s.w=t.y*t.z,s.z*=this.m_viewHalfW,s.w*=this.m_viewHalfH,s.x*=t.z,s.y*=t.z,s.x*=this.m_viewHalfW,s.y*=this.m_viewHalfH,s.z=s.z-s.x,s.w=s.w-s.y,s.x+=this.m_viewX,s.y+=this.m_viewY}calcScreenRectByWorldSphere(t,e,s){this.m_viewMat.transformVector3Self(t),e*=1.15,s.x=t.x-e,s.y=t.y-e,t.x+=e,t.y+=e,this.m_projMat.transformPerspV4Self(s),this.m_projMat.transformPerspV4Self(t),t.z=1/t.w,s.z=t.x*t.z,s.w=t.y*t.z,s.x*=t.z,s.y*=t.z,s.z=s.z-s.x,s.w=s.w-s.y}getInvertViewMatrix(){return this.m_invViewMat}getZNear(){return this.m_zNear}setZNear(t){this.m_zNear=t}getZFar(){return this.m_zFar}setZFar(t){this.m_zFar=t}getNearPlaneWidth(){return this.m_nearPlaneWidth}setNearPlaneWidth(t){this.m_nearPlaneWidth=t}getNearPlaneHeight(){return this.m_nearPlaneHeight}setNearPlaneHeight(t){this.m_nearPlaneHeight=t}getFov(){return this.m_fovRadian}__calcTestParam(){null==this.m_invViewMat&&(this.m_invViewMat=new n.default),this.m_invViewMat.copyFrom(this.m_viewMat),this.m_invViewMat.invert();let t=null,e=this.m_viewHalfH,s=this.m_viewHalfW,i=this.m_viewHalfH,r=this.m_viewHalfW;if(this.m_perspectiveEnabled){let t=Math.tan(.5*this.m_fovRadian);e=this.m_zNear*t,s=e*this.m_aspect,i=this.m_zFar*t,r=i*this.m_aspect}this.m_nearPlaneHalfW=s,this.m_nearPlaneHalfH=e,this.m_nearWCV.setTo(0,0,-this.m_zNear),this.m_farWCV.setTo(0,0,-this.m_zFar),this.m_invViewMat.transformVectorSelf(this.m_nearWCV),this.m_invViewMat.transformVectorSelf(this.m_farWCV),this.m_wNV.x=this.m_farWCV.x-this.m_nearWCV.x,this.m_wNV.y=this.m_farWCV.y-this.m_nearWCV.y,this.m_wNV.z=this.m_farWCV.z-this.m_nearWCV.z,this.m_wNV.normalize(),t=this.m_wFruPlaneList[0],t.nv.copyFrom(this.m_wNV),t.distance=t.nv.dot(this.m_farWCV),t.position.copyFrom(this.m_farWCV),t=this.m_wFruPlaneList[1],t.nv.copyFrom(this.m_wFruPlaneList[0].nv),t.distance=t.nv.dot(this.m_nearWCV),t.position.copyFrom(this.m_nearWCV),this.m_wFrustumVtxArr[8]=this.m_nearWCV,this.m_wFrustumVtxArr[9]=this.m_farWCV,this.m_wFrustumVtxArr[11]=this.m_wNV,this.m_wFrustumVtxArr[0].setTo(-r,-i,-this.m_zFar),this.m_wFrustumVtxArr[1].setTo(r,-i,-this.m_zFar),this.m_wFrustumVtxArr[2].setTo(r,i,-this.m_zFar),this.m_wFrustumVtxArr[3].setTo(-r,i,-this.m_zFar),this.m_wFrustumVtxArr[4].setTo(-s,-e,-this.m_zNear),this.m_wFrustumVtxArr[5].setTo(s,-e,-this.m_zNear),this.m_wFrustumVtxArr[6].setTo(s,e,-this.m_zNear),this.m_wFrustumVtxArr[7].setTo(-s,e,-this.m_zNear),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[0]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[1]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[2]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[3]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[4]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[5]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[6]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[7]),this.m_frustumWAABB.max.setTo(-9999999,-9999999,-9999999),this.m_frustumWAABB.min.setTo(9999999,9999999,9999999);for(let a=0;a<8;++a)this.m_frustumWAABB.addPosition(this.m_wFrustumVtxArr[a]);this.m_frustumWAABB.updateFast();let h=this.m_wFrustumVtxArr[0],l=this.m_wFrustumVtxArr[4];this.m_tempV.x=h.x-l.x,this.m_tempV.y=h.y-l.y,this.m_tempV.z=h.z-l.z,h=this.m_wFrustumVtxArr[1],l=this.m_wFrustumVtxArr[5],this.m_tempV1.x=h.x-l.x,this.m_tempV1.y=h.y-l.y,this.m_tempV1.z=h.z-l.z,t=this.m_wFruPlaneList[3],a.default.Cross(this.m_tempV1,this.m_tempV,t.nv),t.nv.normalize(),t.distance=t.nv.dot(h),t.position.copyFrom(h),h=this.m_wFrustumVtxArr[3],l=this.m_wFrustumVtxArr[7],this.m_tempV.x=h.x-l.x,this.m_tempV.y=h.y-l.y,this.m_tempV.z=h.z-l.z,h=this.m_wFrustumVtxArr[2],l=this.m_wFrustumVtxArr[6],this.m_tempV1.x=h.x-l.x,this.m_tempV1.y=h.y-l.y,this.m_tempV1.z=h.z-l.z,t=this.m_wFruPlaneList[2],a.default.Cross(this.m_tempV1,this.m_tempV,t.nv),t.nv.normalize(),t.distance=t.nv.dot(h),t.position.copyFrom(h),h=this.m_wFrustumVtxArr[0],l=this.m_wFrustumVtxArr[4],this.m_tempV.x=h.x-l.x,this.m_tempV.y=h.y-l.y,this.m_tempV.z=h.z-l.z,h=this.m_wFrustumVtxArr[3],l=this.m_wFrustumVtxArr[7],this.m_tempV1.x=h.x-l.x,this.m_tempV1.y=h.y-l.y,this.m_tempV1.z=h.z-l.z,t=this.m_wFruPlaneList[4],a.default.Cross(this.m_tempV,this.m_tempV1,t.nv),t.nv.normalize(),t.distance=t.nv.dot(h),t.position.copyFrom(h),h=this.m_wFrustumVtxArr[1],l=this.m_wFrustumVtxArr[5],this.m_tempV.x=h.x-l.x,this.m_tempV.y=h.y-l.y,this.m_tempV.z=h.z-l.z,h=this.m_wFrustumVtxArr[2],l=this.m_wFrustumVtxArr[6],this.m_tempV1.x=h.x-l.x,this.m_tempV1.y=h.y-l.y,this.m_tempV1.z=h.z-l.z,t=this.m_wFruPlaneList[5],a.default.Cross(this.m_tempV,this.m_tempV1,t.nv),t.nv.normalize(),t.distance=t.nv.dot(h),t.position.copyFrom(h),this.m_fpNVArr[0].copyFrom(this.m_wFruPlaneList[0].nv),this.m_fpNVArr[1].copyFrom(this.m_wFruPlaneList[1].nv),this.m_fpNVArr[1].scaleBy(-1),this.m_fpNVArr[2].copyFrom(this.m_wFruPlaneList[2].nv),this.m_fpNVArr[3].copyFrom(this.m_wFruPlaneList[3].nv),this.m_fpNVArr[3].scaleBy(-1),this.m_fpNVArr[4].copyFrom(this.m_wFruPlaneList[4].nv),this.m_fpNVArr[4].scaleBy(-1),this.m_fpNVArr[5].copyFrom(this.m_wFruPlaneList[5].nv),this.m_fpDisArr[0]=this.m_wFruPlaneList[0].distance,this.m_fpDisArr[1]=-this.m_wFruPlaneList[1].distance,this.m_fpDisArr[2]=this.m_wFruPlaneList[2].distance,this.m_fpDisArr[3]=-this.m_wFruPlaneList[3].distance,this.m_fpDisArr[4]=-this.m_wFruPlaneList[4].distance,this.m_fpDisArr[5]=this.m_wFruPlaneList[5].distance}getWordFrustumWAABB(){return this.m_frustumWAABB}getWordFrustumWAABBCenter(){return this.m_frustumWAABB.center}getWordFrustumVtxArr(){return this.m_wFrustumVtxArr}getWordFrustumPlaneArr(){return this.m_wFruPlaneList}visiTestSphere2(t,e){let s=this.m_fpNVArr[0].dot(t)-this.m_fpDisArr[0]-e>r.default.MATH_MIN_POSITIVE;return!s&&(s=this.m_fpNVArr[1].dot(t)-this.m_fpDisArr[1]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[2].dot(t)-this.m_fpDisArr[2]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[3].dot(t)-this.m_fpDisArr[3]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[4].dot(t)-this.m_fpDisArr[4]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[5].dot(t)-this.m_fpDisArr[5]-e>r.default.MATH_MIN_POSITIVE,!s)))))}visiTestSphere3(t,e,s){let i=this.m_fpNVArr[0].dot(t)-this.m_fpDisArr[0]+s-e>r.default.MATH_MIN_POSITIVE;return!i&&(i=this.m_fpNVArr[1].dot(t)-this.m_fpDisArr[1]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.m_fpNVArr[2].dot(t)-this.m_fpDisArr[2]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.m_fpNVArr[3].dot(t)-this.m_fpDisArr[3]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.m_fpNVArr[4].dot(t)-this.m_fpDisArr[4]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.m_fpNVArr[5].dot(t)-this.m_fpDisArr[5]-e>r.default.MATH_MIN_POSITIVE,!i)))))}visiTestPosition(t){let e=this.m_fpNVArr[0].dot(t)-this.m_fpDisArr[0]>r.default.MATH_MIN_POSITIVE;return!e&&(e=this.m_fpNVArr[1].dot(t)-this.m_fpDisArr[1]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[2].dot(t)-this.m_fpDisArr[2]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[3].dot(t)-this.m_fpDisArr[3]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[4].dot(t)-this.m_fpDisArr[4]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[5].dot(t)-this.m_fpDisArr[5]>r.default.MATH_MIN_POSITIVE,!e)))))}visiTestPlane(t,e){let s=t.dot(this.m_wFruPlaneList[0].position)-e,i=s*(t.dot(this.m_wFruPlaneList[1].position)-e);return i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.m_wFruPlaneList[2].position)-e),i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.m_wFruPlaneList[3].position)-e),i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.m_wFruPlaneList[4].position)-e),i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.m_wFruPlaneList[5].position)-e),i<r.default.MATH_MIN_POSITIVE))))}visiTestSphere(t,e){let s=this.m_frustumWAABB.sphereIntersect(t,e);if(s){let s=this.m_wFruPlaneList[0].intersectSphere(t,e),i=this.m_wFruPlaneList[1].intersectSphere(t,e);return!(s*i>=0&&!this.m_wFruPlaneList[0].intersectBoo&&!this.m_wFruPlaneList[1].intersectBoo)&&(s=this.m_wFruPlaneList[2].intersectSphere(t,e),i=this.m_wFruPlaneList[3].intersectSphere(t,e),!(s*i>=0&&!this.m_wFruPlaneList[2].intersectBoo&&!this.m_wFruPlaneList[3].intersectBoo)&&(s=this.m_wFruPlaneList[4].intersectSphere(t,e),i=this.m_wFruPlaneList[5].intersectSphere(t,e),!(s*i>=0&&!this.m_wFruPlaneList[4].intersectBoo&&!this.m_wFruPlaneList[5].intersectBoo)))}return!1}visiTestAABB(t){let e=t.center,s=t.radius,i=this.m_frustumWAABB.sphereIntersect(e,s);if(i){let t=this.m_wFruPlaneList[0].intersectSphere(e,s),i=this.m_wFruPlaneList[1].intersectSphere(e,s);return!(t*i>=0&&!this.m_wFruPlaneList[0].intersectBoo&&!this.m_wFruPlaneList[1].intersectBoo)&&(t=this.m_wFruPlaneList[2].intersectSphere(e,s),i=this.m_wFruPlaneList[3].intersectSphere(e,s),!(t*i>=0&&!this.m_wFruPlaneList[2].intersectBoo&&!this.m_wFruPlaneList[3].intersectBoo)&&(t=this.m_wFruPlaneList[4].intersectSphere(e,s),i=this.m_wFruPlaneList[5].intersectSphere(e,s),!(t*i>=0&&!this.m_wFruPlaneList[4].intersectBoo&&!this.m_wFruPlaneList[5].intersectBoo)))}return!1}setViewMatrix(t){this.m_viewMatrix=t,this.m_changed=!0}update(){this.m_changed&&(this.version++,this.m_changed=!1,null==this.m_viewMatrix?(this.m_axisRotEnabled?this.m_matrix.appendRotationPivot(this.m_rotDegree*r.default.MATH_PI_OVER_180,this.m_rotAxis,this.m_rotPivotPoint):(this.m_matrix.identity(),this.m_matrix.appendRotationEulerAngle(this.m_rotV.x*r.default.MATH_PI_OVER_180,this.m_rotV.y*r.default.MATH_PI_OVER_180,this.m_rotV.z*r.default.MATH_PI_OVER_180)),this.m_lookRHEnabled?this.m_viewMat.lookAtRH(this.m_camPos,this.m_lookAtPos,this.m_up):this.m_viewMat.lookAtLH(this.m_camPos,this.m_lookAtPos,this.m_up),this.m_viewMat.append(this.m_matrix)):this.m_viewMat.copyFrom(this.m_viewMatrix),this.m_project2Enabled?(this.m_nearPlaneWidth=this.m_zNear*Math.tan(.5*this.m_fovRadian)*2,this.m_nearPlaneHeight=this.m_nearPlaneWidth/this.m_aspect):(this.m_nearPlaneHeight=this.m_zNear*Math.tan(.5*this.m_fovRadian)*2,this.m_nearPlaneWidth=this.m_aspect*this.m_nearPlaneHeight),this.m_viewInvertMat.copyFrom(this.m_viewMat),this.m_viewInvertMat.invert(),this.m_vpMat.identity(),this.m_vpMat.copyFrom(this.m_viewMat),this.m_vpMat.append(this.m_projMat),this.__calcTestParam(),this.updateUniformData())}updateCamMatToUProbe(t){t.isEnabled()&&(t.update(),t.getFS32At(0).set(this.m_viewMat.getLocalFS32(),0),t.getFS32At(1).set(this.m_projMat.getLocalFS32(),0))}updateUniformData(){this.uniformEnabled&&(this.updateCamMatToUProbe(this.matUProbe),this.ufrustumProbe.setVec4DataAt(0,this.m_zNear,this.m_zFar,this.m_nearPlaneHalfW,this.m_nearPlaneHalfH),this.ufrustumProbe.update(),this.ucameraPosProbe.setVec4DataAt(0,this.m_camPos.x,this.m_camPos.y,this.m_camPos.z,1),this.ucameraPosProbe.update())}destroy(){}lookRHEnabled(){return this.m_lookRHEnabled}lookLHEnabled(){return!this.m_lookRHEnabled}getVPMatrix(){return this.m_vpMat}getViewMatrix(){return this.m_viewMat}getViewInvMatrix(){return this.m_viewInvertMat}getProjectMatrix(){return this.m_projMat}}e.default=o},c62b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("e08e"),a=s("070b"),n=s("a5ba"),h=i(s("29ef"));class l{constructor(){this.uid=-1,this.value=-1,this.__$rpuid=-1,this.__$rprouid=-1,this.shader=null,this.pos=null,this.bounds=null,this.ibufType=0,this.ibufStep=2,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.drawOffset=0,this.partTotal=0,this.partGroup=null,this.trisNumber=0,this.visible=!0,this.drawEnabled=!0,this.drawMode=0,this.renderState=0,this.rcolorMask=0,this.drawFlag=0,this.vro=null,this.transUniform=null,this.uniform=null,this.shdUid=-1,this.vtxUid=-1,this.tro=null,this.texMid=-1,this.ubo=null,this.polygonOffset=null}testDrawFlag(){this.shader.drawFlag!=this.drawFlag&&(this.shader.drawFlag=this.drawFlag,n.RenderStateObject.UseRenderState(this.renderState),a.RenderColorMask.UseRenderState(this.rcolorMask))}getUid(){return this.uid}getRPOUid(){return this.__$rpuid}getRPROUid(){return this.__$rprouid}getShaderUid(){return this.shdUid}setIvsParam(t,e){this.ivsIndex=t,this.ivsCount=e,this.drawOffset=t*this.ibufStep,this.drawEnabled=this.visible&&this.ivsCount>0}setVisible(t){this.visible=t,this.drawEnabled=t&&this.ivsCount>0}setDrawFlag(t,e){this.renderState=t,this.rcolorMask=e,this.drawFlag=(e<<10)+t}drawThis(t){++h.default.DrawCallTimes,h.default.DrawTrisNumber+=this.trisNumber;let e=this.indicesRes.getVTCount();switch(this.ivsCount<=e&&(e=this.ivsCount),null!=this.polygonOffset?t.setPolygonOffset(this.polygonOffset[0],this.polygonOffset[1]):t.resetPolygonOffset(),this.drawMode){case r.RenderDrawMode.ELEMENTS_TRIANGLES:t.RContext.drawElements(t.TRIANGLES,e,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_LINES:t.RContext.drawElements(t.LINES,e,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:t.RContext.drawElements(t.TRIANGLE_STRIP,e,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:t.RContext.drawElementsInstanced(t.TRIANGLES,e,this.ibufType,this.drawOffset,this.insCount);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:t.RContext.drawElements(t.TRIANGLE_FAN,e,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ARRAYS_LINES:t.RContext.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case r.RenderDrawMode.ARRAYS_LINE_STRIP:t.RContext.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}drawPart(t){++h.default.DrawCallTimes,h.default.DrawTrisNumber+=this.trisNumber;let e=this.indicesRes.getVTCount();this.ivsCount<=e&&(e=this.ivsCount),null!=this.polygonOffset?t.setPolygonOffset(this.polygonOffset[0],this.polygonOffset[1]):t.resetPolygonOffset();let s=0,i=t.RContext;switch(this.drawMode){case r.RenderDrawMode.ELEMENTS_TRIANGLES:for(;s<this.partTotal;)i.drawElements(t.TRIANGLES,this.partGroup[s++],this.ibufType,this.partGroup[s++]);break;case r.RenderDrawMode.ELEMENTS_LINES:for(;s<this.partTotal;)i.drawElements(t.LINES,this.partGroup[s++],this.ibufType,this.partGroup[s++]);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:i.drawElements(t.TRIANGLE_STRIP,this.ivsCount,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:i.drawElementsInstanced(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset,this.insCount);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:i.drawElements(t.TRIANGLE_FAN,this.ivsCount,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ARRAYS_LINES:i.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case r.RenderDrawMode.ARRAYS_LINE_STRIP:i.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}run2(t){null!=this.ubo&&this.ubo.run(t),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}run(t){null!=this.ubo&&this.ubo.run(t),this.vro.run(),this.tro.run(),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}runLockMaterial2(t){this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(null==t?this.uniform:t,this.transUniform)}runLockMaterial(){this.vro.run(),this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(this.uniform,this.transUniform)}reset(){this.indicesRes=null,this.polygonOffset=null,this.vro.__$detachThis(),this.vro=null,this.tro.__$detachThis(),this.tro=null,this.texMid=-1,this.__$rprouid=-1,this.ubo=null,this.shdUid=-1,this.vtxUid=-1,this.uniform=null,this.transUniform=null,this.partGroup=null,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.partTotal=0,this.drawMode=0,this.drawFlag=0,this.renderState=0,this.rcolorMask=0,this.drawEnabled=!0,this.shader=null,this.bounds=null,this.pos=null}destroy(){this.reset()}toString(){return"[RPOUnit(uid = "+this.uid+")]"}}e.default=l},c711:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("c120")),h=s("e160");class l{constructor(){this.m_renderer=null,this.m_camera=null,this.m_headNode=null,this.m_rsn=null,this.m_hitList=new Uint8Array(256),this.m_rsnList=null,this.m_selectedNode=null,this.m_selectedTotal=0,this.m_testMode=0,this.m_invpv=new a.default,this.m_invtv=new a.default,this.m_rlpv=null,this.m_rltv=null,this.m_rlsiv=new Uint8Array(4),this.m_rlinvtv=new a.default,this.m_outv=new a.default,this.m_vecs=[null,null],this.m_gpuTestEnabled=!1}setRenderer(t){this.m_renderer=t}setRayTestMode(t){this.m_testMode=t}setRay(t,e){this.m_rlpv=t,this.m_rltv=e}getRay(t,e){t.copyFrom(this.m_rlpv),e.copyFrom(this.m_rltv)}setCamera(t){this.m_camera=t}setCullingNodeHead(t){if(this.m_headNode=t,null==this.m_rsnList){this.m_rsnList=[];let t=0;for(;t<256;++t)this.m_rsnList.push(new n.default)}}getSelectedNode(){return this.m_selectedNode}getSelectedNodes(){return this.m_rsnList}getSelectedNodesTotal(){return this.m_selectedTotal}sorting(t,e){let s=this.m_rsnList;this.m_rsn=s[t];while(t<e){while(t<e&&s[e].dis>=this.m_rsn.dis)--e;s[t]=s[e];while(t<e&&s[t].dis<=this.m_rsn.dis)++t;s[e]=s[t]}return s[t]=this.m_rsn,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}run(){let t=this.m_headNode;if(null!=t){let e=0,s=this.m_rltv,i=this.m_rlpv,n=this.m_outv,l=null,o=0;Math.abs(s.x)>r.default.MATH_MIN_POSITIVE?this.m_rlinvtv.x=1/s.x:this.m_rlinvtv.x=r.default.MATH_MAX_POSITIVE,Math.abs(s.y)>r.default.MATH_MIN_POSITIVE?this.m_rlinvtv.y=1/s.y:this.m_rlinvtv.y=r.default.MATH_MAX_POSITIVE,Math.abs(s.z)>r.default.MATH_MIN_POSITIVE?this.m_rlinvtv.z=1/s.z:this.m_rlinvtv.z=r.default.MATH_MAX_POSITIVE,this.m_rlinvtv.x<0?this.m_rlsiv[0]=1:this.m_rlsiv[0]=0,this.m_rlinvtv.y<0?this.m_rlsiv[1]=1:this.m_rlsiv[1]=0,this.m_rlinvtv.z<0?this.m_rlsiv[2]=1:this.m_rlsiv[2]=0;while(null!=t)t.drawEnabled&&t.entity.mouseEnabled&&(n.x=t.bounds.center.x-i.x,n.y=t.bounds.center.y-i.y,n.z=t.bounds.center.z-i.z,e=n.dot(s),n.x-=e*s.x,n.y-=e*s.y,n.z-=e*s.z,n.getLengthSquared()<=t.bounds.radius2&&t.rayTestState<1&&(this.m_vecs[0]=t.bounds.min,this.m_vecs[1]=t.bounds.max,h.AABBCalc.IntersectionRL3(this.m_vecs,this.m_rlsiv,this.m_rlinvtv,s,i,n)&&(l=this.m_rsnList[o],l.entity=t.entity,l.dis=this.m_rlinvtv.w,l.wpv.copyFrom(n),++o))),t=t.next;this.m_selectedNode=null;let _=0;if(o>0){let t=this.m_invpv,e=this.m_invtv,h=null,l=0,m=0,u=null,d=null;if(o>1){let c=!this.m_gpuTestEnabled;for(_=0;_<o;++_)d=this.m_rsnList[_],d.dis=r.default.MATH_MAX_POSITIVE,d.flag=0,h=this.m_rsnList[_].entity,h.isPolyhedral()?c?(u=h.getInvMatrix(),u.transformOutVector3(i,t),u.deltaTransformOutVector(s,e),e.normalize(),l=h.testRay(t,e,n,!0)):l=0:(u=h.getInvMatrix(),u.transformOutVector3(i,t),u.deltaTransformOutVector(s,e),e.normalize(),l=h.testRay(t,e,n,!0)),l>0?(d.flag=l,d.lpv.copyFrom(n),h.getMatrix().transformOutVector3(n,d.wpv),d.dis=a.default.Distance(d.wpv,i),this.m_hitList[m]=_,++m):l<0&&(this.m_hitList[m]=_,++m);for(this.snsort(0,o-1),_=0;_<o;++_)if(this.m_rsnList[_].flag>0){this.m_selectedNode=this.m_rsnList[_];break}}else d=this.m_rsnList[0],d.dis=r.default.MATH_MAX_POSITIVE,h=this.m_rsnList[0].entity,u=h.getInvMatrix(),u.transformOutVector3(i,t),u.deltaTransformOutVector(s,e),e.normalize(),l=h.testRay(t,e,n,!0),l>0?(d.lpv.copyFrom(n),h.getMatrix().transformOutVector3(n,d.wpv),d.dis=a.default.Distance(d.wpv,i),this.m_selectedNode=d):l<0&&(this.m_selectedNode=d)}for(_=o;_<this.m_selectedTotal;++_)this.m_selectedNode!=this.m_rsnList[_]&&(this.m_rsnList[_].entity=null);this.m_selectedTotal=o}}clear(){this.m_selectedNode=null}}e.default=l},c758:function(t,e,s){"use strict";var i=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var s in t)Object.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e["default"]=t,e};Object.defineProperty(e,"__esModule",{value:!0});const r=s("f7ee"),a=i(s("9cb6"));class n{constructor(){this.ppFlag=0,this.encoding=0,this.ppType=""}parseDirec(t,e){if(e.length<1)return[];let s=e[0],i=e[1],n=e[2],h=e[3],l=e[4];switch(t.setOffset(s),l){case"b":case"c":case"d":case"f":case"i":case"l":if(0===h)switch(l){case"b":case"c":return t.getBooleanArray(n);case"d":return t.getFloat64Array(n);case"f":return t.getFloat32Array(n);case"i":return t.getInt32Array(n);case"l":return t.getInt64Array(n)}let e=t.getArrayU8Buffer(i);const s=a.unzlibSync(e,null);let o=new r.BinaryReader(s.buffer);switch(l){case"b":case"c":return o.getBooleanArray(n);case"d":return o.getFloat64Array(n);case"f":return o.getFloat32Array(n);case"i":return o.getInt32Array(n);case"l":return o.getInt64Array(n)}default:throw new Error("BufPropertyParser::parseDirec() Unknown property type "+l)}}getArrayByteLength(t,e){switch(t){case"d":case"l":return 8*e;case"f":case"i":return 4*e;default:break}return e}parseProperty(t){const e=t.getString(1);let s;switch(this.encoding=0,this.ppType=e,e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":return s=t.getUint32(),t.getArrayBuffer(s);case"S":return s=t.getUint32(),t.getString(s);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=t.getUint32(),n=t.getUint32(),h=t.getUint32();this.encoding=n;let l=t.getOffset(),o=0===n?this.getArrayByteLength(e,i):h;if(12==this.ppFlag)return t.skip(o),[l,h,i,n,e];if(131==this.ppFlag)return t.skip(o),[];if(0===n)switch(e){case"b":case"c":return t.getBooleanArray(i);case"d":return t.getFloat64Array(i);case"f":return t.getFloat32Array(i);case"i":return t.getInt32Array(i);case"l":return t.getInt64Array(i)}let _=t.getArrayU8Buffer(h);const m=a.unzlibSync(_,null);let u=new r.BinaryReader(m.buffer);switch(e){case"b":case"c":return u.getBooleanArray(i);case"d":return u.getFloat64Array(i);case"f":return u.getFloat32Array(i);case"i":return u.getInt32Array(i);case"l":return u.getInt64Array(i)}default:throw new Error("BufPropertyParser::parseProperty() Unknown property type "+e)}}}e.BufPropertyParser=n},c917:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,s,i){this.inited=!1,this.taskclass=t,this.type=e,this.src=s,this.moduleName=i}}e.TaskDescriptor=i},ca6c:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static PushThreeBitValueToInt(t,e){return(t<<3)+e}static PopThreeBitValueFromInt(t){return i.value=7&t,t>>3}static ContainsBit(t,e){return(e&t)>0}static RemoveBit(t,e){return~e&t}static AddBit(t,e){return e|t}static AssembleFromIntArray(t){let e=0,s=0,i=t.length;for(;e<i;++e)t[e]>0&&(s|=1<<e);return s}}i.BIT_ZERO=0,i.BIT_ONE_0=1,i.BIT_ONE_1=2,i.BIT_ONE_2=4,i.BIT_ONE_3=8,i.BIT_ONE_4=16,i.BIT_ONE_5=32,i.BIT_ONE_6=64,i.BIT_ONE_7=128,i.BIT_ONE_8=256,i.BIT_ONE_9=512,i.BIT_ONE_10=1024,i.BIT_ONE_11=2048,i.value=0,e.default=i},cb29:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=s("8a0a"),n=i(s("e7d2")),h=s("e08e");class l{constructor(t=r.default.VTX_STATIC_DRAW){this.m_bufDataUsage=0,this.m_bufDataList=null,this.m_bufDataStepList=null,this.m_bufStatusList=null,this.m_bufTypeList=null,this.m_bufSizeList=null,this.m_layoutBit=0,this.m_transMatrix=null,this.m_vbuf=null,this.m_ivs=null,this.forceUpdateIVS=!1,this.wireframe=!1,this.bounds=null,this.normalType=a.VtxNormalType.GOURAND,this.normalScale=1,this.vtxTotal=0,this.trisNumber=0,this.drawMode=h.RenderDrawMode.ELEMENTS_TRIANGLES,this.vtCount=0,this.vbWholeDataEnabled=!0,this.drawInsBeginIndex=0,this.drawInsStride=0,this.drawInsTotal=0,this.m_attachCount=0,this.m_bufDataUsage=t}createIVSBYSize(t){return t>65535?new Uint32Array(t):new Uint16Array(t)}createIVSByArray(t){return t.length>65535?new Uint32Array(t):new Uint16Array(t)}updateWireframeIvs(){if(this.drawMode=h.RenderDrawMode.ELEMENTS_TRIANGLES,this.wireframe&&null!==this.m_ivs){let t,e,s,i,r=this.m_ivs,a=2*r.length;t=a<65535?new Uint16Array(a):new Uint32Array(a);let n=0;for(let h=0,l=r.length;h<l;h+=3)e=r[h+0],s=r[h+1],i=r[h+2],t[n]=e,t[n+1]=s,t[n+2]=s,t[n+3]=i,t[n+4]=i,t[n+5]=e,n+=6;this.drawMode=h.RenderDrawMode.ELEMENTS_LINES}}buildEnd(){this.m_vbuf.setBufTypeList(this.m_bufTypeList),this.m_vbuf.setBufSizeList(this.m_bufSizeList),this.m_bufDataList=n.default.BufDataList,this.m_bufDataStepList=n.default.BufDataStepList,this.m_bufStatusList=n.default.BufStatusList}setTransformMatrix(t){this.m_transMatrix=t}getTransformMatrix(){return this.m_transMatrix}isPolyhedral(){return!0}setPolyhedral(t){}testRay(t,e,s,i){return-1}rebuild(){if(null==this.m_vbuf&&null!=this.m_bufDataList){n.default.Reset();let t=0,e=this.m_bufDataList.length;for(;t<e;++t)n.default.AddFloat32Data(this.m_bufDataList[t],this.m_bufDataStepList[t],this.m_bufStatusList[t]);this.m_vbuf=n.default.CreateBySaveData(this.getBufDataUsage()),null!=this.m_ivs&&(this.m_vbuf.setUintIVSData(this.m_ivs),this.vtCount=this.m_ivs.length)}}__$attachVBuf(){return null==this.m_vbuf&&this.rebuild(),n.default.__$$AttachAt(this.m_vbuf.getUid()),this.m_vbuf}__$detachVBuf(t){if(this.m_vbuf!=t)throw Error("Fatal Error!");n.default.__$$DetachAt(this.m_vbuf.getUid())}isGeomDynamic(){return this.m_bufDataUsage}getBufDataUsage(){return this.m_bufDataUsage}getVS(){return null}getUVS(){return null}getNVS(){return null}getCVS(){return null}getIVS(){return this.m_ivs}setVtxBufRenderData(t){null!=t&&(this.m_bufTypeList=t.getBufTypeList(),this.m_bufSizeList=t.getBufSizeList(),this.setBufSortFormat(t.getBufSortFormat()))}setBufSortFormat(t){this.m_layoutBit=t}getBufSortFormat(){return this.m_layoutBit}setBufTypeList(t){this.m_bufTypeList=t}setBufSizeList(t){this.m_bufSizeList=t}getBufTypeList(){return this.m_bufTypeList}getBufSizeList(){return this.m_bufSizeList}isVBufEnabledAt(t){return(t&this.m_layoutBit)>0}__$attachThis(){++this.m_attachCount}__$detachThis(){1==this.m_attachCount?(--this.m_attachCount,this.__$dispose()):--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}getAttachCount(){return this.m_attachCount}__$dispose(){this.getAttachCount()<1&&null!=this.m_vbuf&&(n.default.__$$DetachAt(this.m_vbuf.getUid()),this.m_vbuf=null)}isEnabled(){return null!=this.m_vbuf}isResFree(){return this.getAttachCount()<1&&null==this.m_vbuf}__$destroy(){this.isResFree()&&(this.m_ivs=null,this.m_bufDataList=null,this.m_bufDataStepList=null,this.m_bufStatusList=null,this.trisNumber=0,this.m_transMatrix=null,this.m_bufTypeList=null,this.m_bufSizeList=null)}toString(){return"[MeshBase()]"}}e.default=l},cbd5:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("3a1d"),r=s("2a59"),a=s("2931"),n=s("eda7"),h=s("0817"),l=s("8eb0"),o=s("1173"),_=s("b406");class m{constructor(){this.m_inited=!0,this.m_receiver=new a.ReceiverSchedule,this.system=new o.CoSystem,this.runtime=new _.CoRuntime,this.thread=new i.ThreadSchedule,this.geometry=new r.GeometryResourceSchedule,this.texture=new n.TextureResourceSchedule,this.m_timeoutId=-1}initialize(t,e,s=!1){if(this.m_inited){this.m_inited=!1,this.thread.setParams(s),this.thread.initialize(t,e);let i=[new h.TaskCodeModuleParam("static/cospace/modules/ctm/ModuleCTMGeomParser.umd.min.js",l.ModuleNS.ctmParser)];this.geometry.initialize(this.m_receiver,this.thread,i),this.update()}}update(){let t=40;this.thread.isSupported()&&(this.thread.hasTaskData()||this.m_receiver.getReceiversTotal()>0)&&(t=20),this.thread.run(),this.m_receiver.run(),this.m_timeoutId>-1&&clearTimeout(this.m_timeoutId),this.m_timeoutId=setTimeout(this.update.bind(this),t)}destroy(){}}e.CoSpace=m},cc48:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["NONE"]=0]="NONE",t[t["CAMERA"]=1]="CAMERA",t[t["POV"]=2]="POV",t[t["INNER_POV_PASS"]=3]="INNER_POV_PASS",t[t["CAMERA_AND_POV"]=4]="CAMERA_AND_POV"}(i||(i={})),e.SpaceCullingMask=i},ccdf:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8d98")),a=i(s("ffc0")),n=i(s("1f61")),h=i(s("cfaf")),l=i(s("acaa")),o=i(s("85b6")),_=i(s("3b73"));class m{constructor(t){this.m_renderProxy=null,this.m_rttTexs=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.m_rttCubeTexs=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.m_rttFloatTexs=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.m_rttDepthTexs=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.m_renderProxy=t}getRenderProxy(){return this.m_renderProxy}createWrapperTex(t,e,s=!1){let i=new o.default(t,e,s);return i}createRTTTex2D(t,e,s=!1){let i=new h.default(t,e,s);return i}createDepthTex2D(t,e,s=!1){let i=new l.default(t,e,s);return i}getCubeRTTTextureAt(t){return null!=this.m_rttCubeTexs[t]?(this.m_rttCubeTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttCubeTexs[t]):(this.m_rttCubeTexs[t]=this.createRTTTex2D(32,32),this.m_rttCubeTexs[t].toCubeTexture(),this.m_rttCubeTexs[t].name="sys_cube_rttTex_"+t,this.m_rttCubeTexs[t].minFilter=r.default.LINEAR,this.m_rttCubeTexs[t].magFilter=r.default.LINEAR,this.m_rttCubeTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttCubeTexs[t])}createCubeRTTTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.m_rttCubeTexs[t]?(this.m_rttCubeTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttCubeTexs[t]):(this.m_rttCubeTexs[t]=this.createRTTTex2D(e,s),this.m_rttCubeTexs[t].toCubeTexture(),this.m_rttCubeTexs[t].name="sys_cube_rttTex_"+t,this.m_rttCubeTexs[t].minFilter=r.default.LINEAR,this.m_rttCubeTexs[t].magFilter=r.default.LINEAR,this.m_rttCubeTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttCubeTexs[t])}getRTTTextureAt(t){return null!=this.m_rttTexs[t]?(this.m_rttTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttTexs[t]):(this.m_rttTexs[t]=this.createRTTTex2D(32,32),this.m_rttTexs[t].to2DTexture(),this.m_rttTexs[t].name="sys_rttTex_"+t,this.m_rttTexs[t].minFilter=r.default.LINEAR,this.m_rttTexs[t].magFilter=r.default.LINEAR,this.m_rttTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttTexs[t])}createRTTTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.m_rttTexs[t]?(this.m_rttTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttTexs[t]):(this.m_rttTexs[t]=this.createRTTTex2D(e,s),this.m_rttTexs[t].to2DTexture(),this.m_rttTexs[t].name="sys_rttTex_"+t,this.m_rttTexs[t].minFilter=r.default.LINEAR,this.m_rttTexs[t].magFilter=r.default.LINEAR,this.m_rttTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttTexs[t])}getDepthTextureAt(t){return null!=this.m_rttDepthTexs[t]?(this.m_rttDepthTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttDepthTexs[t]):(this.m_rttDepthTexs[t]=this.createDepthTex2D(64,64),this.m_rttDepthTexs[t].to2DTexture(),this.m_rttDepthTexs[t].name="sys_depthTex_"+t,this.m_rttDepthTexs[t].minFilter=r.default.NEAREST,this.m_rttDepthTexs[t].magFilter=r.default.NEAREST,this.m_rttDepthTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttDepthTexs[t])}createDepthTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.m_rttDepthTexs[t]?(this.m_rttDepthTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttDepthTexs[t]):(this.m_rttDepthTexs[t]=this.createDepthTex2D(e,s),this.m_rttDepthTexs[t].to2DTexture(),this.m_rttDepthTexs[t].name="sys_depthTex_"+t,this.m_rttDepthTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttDepthTexs[t])}getRTTFloatTextureAt(t){if(null!=this.m_rttFloatTexs[t])return this.m_rttFloatTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttFloatTexs[t];let e=this.createRTTTex2D(64,64);return e.to2DTexture(),this.m_rttFloatTexs[t]=e,this.m_rttFloatTexs[t].name="sys_rttFloatTex_"+t,e.internalFormat=a.default.RGBA16F,e.srcFormat=a.default.RGBA,e.dataType=n.default.FLOAT,e.minFilter=r.default.NEAREST,e.magFilter=r.default.NEAREST,_.default.IsWebGL1()&&(e.dataType=n.default.HALF_FLOAT_OES),this.m_rttFloatTexs[t].__$setRenderProxy(this.m_renderProxy),e}createRTTFloatTextureAt(t,e,s){if(e=e>1?e:1,s=s>1?s:1,null!=this.m_rttFloatTexs[t])return this.m_rttFloatTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttFloatTexs[t];let i=this.createRTTTex2D(e,s);return i.to2DTexture(),this.m_rttFloatTexs[t]=i,this.m_rttFloatTexs[t].name="sys_rttFloatTex_"+t,i.internalFormat=a.default.RGBA16F,i.srcFormat=a.default.RGBA,i.dataType=n.default.FLOAT,i.minFilter=r.default.NEAREST,i.magFilter=r.default.NEAREST,_.default.IsWebGL1()&&(i.dataType=n.default.HALF_FLOAT_OES),this.m_rttFloatTexs[t].__$setRenderProxy(this.m_renderProxy),i}}e.RTTTextureStore=m},ceac:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("a054");e.OBJModelDataType=i.OBJModelDataType;const r=s("83a3"),a=s("3b80");class n extends r.ThreadTask{constructor(t){super(),this.m_listener=null,t.indexOf("/")>0?this.dependency=new a.TaskJSFileDependency(t):this.dependency=new a.TaskUniqueNameDependency(t)}setListener(t){this.m_listener=t}addBinaryData(t,e){null!=t&&this.addDataWithParam("",[t],{url:e})}addURL(t){if(""!=t)throw Error("illegal operation!!!")}parseDone(t,e){if(null!=this.m_listener){let e=t.data;this.m_listener.objParseFinish(e.models,t.descriptor.url)}return!0}getTaskClass(){return 103}destroy(){super.destroy(),this.m_listener=null}}e.OBJParseTask=n},cfaf:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=i(s("8d98")),n=i(s("ffc0")),h=i(s("5deb")),l=i(s("1f61")),o=i(s("0851"));class _ extends o.default{constructor(t,e,s=!1){super(t,e,s),this.m_type=r.TextureProxyType.RTT,this.minFilter=a.default.NEAREST,this.magFilter=a.default.NEAREST}to2DTexture(){this.m_texTarget=h.default.TEXTURE_2D}toCubeTexture(){this.m_texTarget=h.default.TEXTURE_CUBE}setSize(t,e){this.m_texWidth=t,this.m_texHeight=e}enableMipmap(){this.minFilter=a.default.LINEAR_MIPMAP_LINEAR,this.magFilter=a.default.LINEAR,this.mipmapEnabled=!0}disableMipmap(){this.minFilter=a.default.NEAREST,this.magFilter=a.default.NEAREST,this.mipmapEnabled=!1}uploadFromFbo(t,e,s){let i=t.getRC(),r=this.mipmapEnabled;this.mipmapEnabled=!1,t.hasResUid(this.getResUid())?this.getBufWidth()==e&&this.getBufHeight()==s||(t.bindToGpu(this.getResUid()),this.bindTexture(i,e,s),this.m_texWidth=e,this.m_texHeight=s,this.__$buildParam(i)):(this.m_sampler=h.default.GetValue(i,this.m_texTarget),this.createTexBuf(t),t.bindToGpu(this.getResUid()),this.bindTexture(i,e,s),this.m_haveRData=!0,this.m_texWidth=e,this.m_texHeight=s,this.__$buildParam(i)),this.mipmapEnabled=r}bindTexture(t,e,s){let i=n.default.ToGL(t,this.internalFormat),r=n.default.ToGL(t,this.srcFormat),a=l.default.ToGL(t,this.dataType);switch(this.m_texTarget){case h.default.TEXTURE_2D:t.texImage2D(t.TEXTURE_2D,0,i,e,s,0,r,a,null);break;case h.default.TEXTURE_CUBE:for(let n=0;n<6;++n)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,i,e,s,0,r,a,null);break;case h.default.TEXTURE_SHADOW_2D:t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT16,e,s,0,t.DEPTH_COMPONENT,t.FLOAT,null);break;default:break}}toString(){return"[RTTTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=_},d2d9:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["STRING_CODE"]=0]="STRING_CODE",t[t["BLOB_CODE"]=1]="BLOB_CODE",t[t["JS_FILE_CODE"]=2]="JS_FILE_CODE",t[t["DEPENDENCY"]=3]="DEPENDENCY"}(i||(i={})),e.ThreadCodeSrcType=i},d314:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=i(s("5deb")),n=i(s("ffc0")),h=i(s("1f61")),l=i(s("0851"));class o extends l.default{constructor(t,e){super(t,e,!1),this.m_imgDataList=null,this.m_texTarget=a.default.TEXTURE_CUBE,this.m_type=r.TextureProxyType.ImageCube,this.internalFormat=n.default.RGBA,this.srcFormat=n.default.RGBA,this.dataType=h.default.UNSIGNED_BYTE,this.mipmapEnabled=!0}setDataFromImageToFaceAt(t,e,s=0){null!=e&&(null==this.m_imgDataList&&(this.m_imgDataList=[null,null,null,null,null,null]),e.width>0&&e.height>0&&(0==t&&(this.m_texWidth=e.width,this.m_texHeight=e.height,this.m_miplevel=s),this.m_imgDataList[t]={imgData:e,miplevel:s},this.m_haveRData=null!=this.m_imgDataList[t]))}uploadData(t){let e=t.getRC(),s=null;for(let i=0;i<6;++i)s=this.m_imgDataList[i],e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,this.m_miplevel,n.default.ToGL(e,this.internalFormat),n.default.ToGL(e,this.srcFormat),h.default.ToGL(e,this.dataType),s.imgData)}toString(){return"[ImageCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.m_imgDataList)for(let t=0;t<6;++t)null!=this.m_imgDataList[t]&&(this.m_imgDataList[t].imgData=null);super.__$destroy()}}}e.default=o},d35a:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("1710")),n=i(s("3b73")),h=i(s("0644")),l=i(s("c497")),o=i(s("b161")),_=i(s("0890")),m=i(s("a46e")),u=i(s("3bda")),d=i(s("e943")),c=s("4aad"),f=i(s("3930"));class p{constructor(){this.m_rscene=null,this.m_camTrack=null,this.m_stageDragSwinger=new _.default,this.m_cameraZoomController=new m.default,this.m_profileInstance=null,this.m_verifierScene=new c.VerifierScene,this.m_cameraUPY=!1,this.m_lookV=new r.default(0,0,0)}initialize(){if(null==this.m_rscene){n.default.SHADERCODE_TRACE_ENABLED=!1,n.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,n.default.SetWebBodyColor("white"),u.default.SetDebugEnabled(!0);let t=new f.default;t.setRGB3f(0,.4185,.6896),u.default.SetTextBgColor(t.getRGBUint24()),u.default.SetTextColor(15658734),u.default.SetTextBgEnabled(!1),u.default.SetXY(2,8);let e=new l.default;e.setCamProject(45,50,1e4),e.setAttriStencil(!0),e.setAttriAntialias(!0),e.setCamPosition(2e3,2e3,2e3),this.m_cameraUPY?e.setCamUpDirect(0,1,0):e.setCamUpDirect(0,0,1),e.setCamLookAtPos(this.m_lookV.x,this.m_lookV.y,this.m_lookV.z),this.m_rscene=new o.default,this.m_rscene.initialize(e,5),this.m_rscene.updateCamera(),this.m_profileInstance=new d.default,this.m_profileInstance.initialize(this.m_rscene.getRenderer()),this.m_rscene.addEventListener(a.default.MOUSE_DOWN,this,this.mouseDown),this.m_rscene.addEventListener(a.default.MOUSE_UP,this,this.mouseUp),this.m_rscene.enableMouseEvent(!0),this.m_cameraZoomController.bindCamera(this.m_rscene.getCamera()),this.m_cameraZoomController.initialize(this.m_rscene.getStage3D()),this.m_cameraZoomController.syncLookAt=!0,this.m_stageDragSwinger.initialize(this.m_rscene.getStage3D(),this.m_rscene.getCamera()),this.m_camTrack=new h.default,this.m_camTrack.bindCamera(this.m_rscene.getCamera()),this.m_rscene.setClearRGBColor3f(.5,.5,.5),this.m_verifierScene.initialize(this.m_rscene),this.m_verifierScene.initTest()}}mouseDown(t){this.m_verifierScene.mouseDown(t)}mouseUp(t){}run(){this.m_verifierScene.run(),this.m_cameraUPY?this.m_stageDragSwinger.runWithYAxis():this.m_stageDragSwinger.runWithZAxis(),this.m_cameraZoomController.run(this.m_lookV,30),this.m_rscene.run(!0),null!=this.m_profileInstance&&this.m_profileInstance.run()}}e.RenderingVerifier=p,e.default=p},d53d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uns="",this.program=null,this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataSizeList=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,s=e.length;for(let i=0;i<s;++i)if(t==e[i])return this.dataList[i]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let s=this.uniformNameList,i=s.length;for(let r=0;r<i;++r)if(t==s[r]){this.dataList[r]=e;break}}}copyDataFromProbe(t){this.types=[],this.dataSizeList=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]),this.dataSizeList.push(t.dataSizeList[e]);this.uniformSize=t.uniformsTotal}useByLocation(t,e,s,i){}useByShd(t,e){}use(t){}updateData(){}destroy(){}}e.ShaderUniform=i;class r extends i{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV1(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e])}useByLocation(t,e,s,i){t.useUniformV1(s,e,this.dataList[i],this.dataSizeList[i])}useByShd(t,e){let s=0;for(;s<this.uniformSize;++s)t.useUniformV1(e.getUniformLocationByNS(this.uniformNameList[s]),this.types[s],this.dataList[s],this.dataSizeList[s])}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let s=0;s<t;++s)e=this.calcModels[s],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null}}e.ShaderUniformV1=r;class a extends i{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV2(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e],0)}useByLocation(t,e,s,i){t.useUniformV2(s,e,this.dataList[i],this.dataSizeList[i],0)}useByShd(t,e){let s=0;for(;s<this.uniformSize;++s)t.useUniformV2(e.getUniformLocationByNS(this.uniformNameList[s]),this.types[s],this.dataList[s],this.dataSizeList[s],0)}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let s=0;s<t;++s)e=this.calcModels[s],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null,this.program=null}}e.ShaderUniformV2=a;class n extends i{constructor(){super()}use(t){t.useUniformMat4(this.locations[0],this.dataList[0])}useByLocation(t,e,s,i){t.useUniformMat4(s,this.dataList[0])}useByShd(t,e){t.useUniformMat4(e.getUniformLocationByNS(this.uniformNameList[0]),this.dataList[0])}destroy(){this.dataList[0]=null,this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null}}e.ShaderMat4Uniform=n,e.default=i},d7e2:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(t){this.m_rc=null,this.m_rc=t}sortRODisplay(t,e){let s=this.m_rc.getCamera().getPosition();for(let i=0;i<e;++i)t[i].value=-r.default.DistanceSquared(t[i].bounds.center,s);return 0}}e.default=a},d872:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("5326"),a=i(s("3077")),n=i(s("3024")),h=i(s("7279"));class l{constructor(t,e=256){this.m_rcuid=0,this.m_udSlot=null,this.m_rcuid=t,this.m_udSlot=new r.UniformDataSlot(t,e)}getRCUid(){return this.m_rcuid}createShaderUniformProbe(){let t=new a.default(this.m_udSlot);return t}createUniformVec4Probe(t){let e=new n.default(this.m_udSlot,t);return e}createGlobalUinformFromProbe(t,e=null){let s=this.createShaderGlobalUniform();return this.updateGlobalUinformDataFromProbe(s,t,e),s}updateGlobalUinformDataFromProbe(t,e,s=null){let i=t;i.uniformNameList=null!=s?s:e.uniformNames,i.copyDataFromProbe(e),e.update()}createShaderGlobalUniform(){let t=new h.default(this.m_udSlot);return t}createShaderGlobalUniformFromProbe(t,e,s=null){let i=new h.default(this.m_udSlot);return i.uns=e,i.uniformNameList=null!=s?s:t.uniformNames,i.copyDataFromProbe(t),t.update(),i}createShaderGlobalUniformFromProbeAt(t,e,s=null,i){let r=new h.default(this.m_udSlot);return r.uns=e,r.uniformNameList=null!=s?s:t.uniformNames,i<0?r.copyDataFromProbe(t):r.copyDataFromProbeAt(i,t),t.update(),r}cloneShaderGlobalUniform(t){let e=t;return e.clone()}}e.ShaderUniformContext=l},d958:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=s("d872"),n=i(s("36cb")),h=i(s("c497")),l=i(s("3c81")),o=i(s("1e15")),_=s("0e01"),m=s("eca0"),u=i(s("442e")),d=i(s("1264"));class c{constructor(){this.___$$$$$$$Author="VilyLei(vily313@126.com)",this.m_uid=-1,this.m_entity3DMana=null,this.m_processes=[],this.m_processesLen=0,this.m_sprocesses=[],this.m_sprocessesLen=0,this.m_renderProxy=null,this.m_adapter=null,this.m_dataBuilder=null,this.m_renderInsContext=null,this.m_batchEnabled=!0,this.m_processFixedState=!0,this.m_rpoUnitBuilder=new m.RPOUnitBuilder,this.m_rpoNodeBuilder=new u.default,this.m_processBuider=new l.default,this.m_roVtxBuilder=null,this.m_stage3D=null,this.m_fixProcess=null,this.m_uid=c.s_uid++,this.m_renderInsContext=new _.RendererInstanceContext(this.m_uid)}__$setStage3D(t){null!=t&&null==this.m_stage3D&&(this.m_stage3D=t)}getUid(){return this.m_uid}getRCUid(){return this.m_uid}getRPONodeBuilder(){return this.m_rpoNodeBuilder}getDataBuilder(){return this.m_dataBuilder}getRendererContext(){return this.m_renderInsContext}getRenderProxy(){return null!=this.m_renderProxy||(this.m_renderProxy=this.m_renderInsContext.getRenderProxy()),this.m_renderProxy}getStage3D(){return this.m_renderProxy.getStage3D()}getViewX(){return this.m_adapter.getViewportX()}getViewY(){return this.m_adapter.getViewportY()}getViewWidth(){return this.m_adapter.getViewportWidth()}getViewHeight(){return this.m_adapter.getViewportHeight()}getCamera(){return this.m_renderInsContext.getCamera()}createCamera(){return null}useCamera(t,e=!1){}useMainCamera(){}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}initialize(t=null,e=null,s=null){if(null==this.m_dataBuilder&&null!=e){null==t&&(t=new h.default),this.m_batchEnabled=t.batchEnabled,this.m_processFixedState=t.processFixedState,this.m_renderProxy=this.m_renderInsContext.getRenderProxy(),this.m_uid=this.m_renderProxy.getUid(),this.m_dataBuilder=new n.default(s),this.m_roVtxBuilder=new o.default,this.m_renderInsContext.setCameraParam(t.camProjParam.x,t.camProjParam.y,t.camProjParam.z);let i=new _.RendererInstanceContextParam;i.uniformContext=new a.ShaderUniformContext(this.m_renderProxy.getRCUid()),i.camera=e,i.stage=this.m_stage3D,i.builder=this.m_dataBuilder,i.vtxBuilder=this.m_roVtxBuilder,i.shaderProgramBuilder=s,this.m_renderInsContext.initialize(t,e,i),this.m_adapter=this.m_renderProxy.getRenderAdapter(),this.m_dataBuilder.initialize(this.m_renderProxy,this.m_rpoUnitBuilder,this.m_processBuider,this.m_roVtxBuilder),this.m_renderInsContext.initManager(this.m_dataBuilder),this.m_entity3DMana=new d.default(this.m_uid,this.m_dataBuilder,this.m_rpoUnitBuilder,this.m_processBuider),this.m_fixProcess=this.createSeparatedProcess(),this.appendProcess(this.m_batchEnabled,this.m_processFixedState)}}getRendererStatus(){return this.m_entity3DMana.version}update(){this.m_renderProxy.Texture.update(),this.m_renderProxy.Vertex.update(),this.m_entity3DMana.update()}updateAllProcess(){for(let t=0;t<this.m_processesLen;++t)this.m_processes[t].update()}updateProcessAt(t){t>-1&&t<this.m_processesLen&&this.m_processes[t].update()}setEntityManaListener(t){this.m_entity3DMana.setListener(t)}addEntity(t,e=0,s=!0){null!=t&&t.__$testRendererEnabled()&&e>-1&&e<this.m_processesLen&&this.m_entity3DMana.addEntity(t,this.m_processes[e].getUid(),s)}addEntityToProcess(t,e,s=!0){null!=e&&null!=t&&t.__$testRendererEnabled()&&e.getRCUid()==this.m_uid&&this.m_entity3DMana.addEntity(t,e.getUid(),s)}moveEntityToProcessAt(t,e){if(null!=t&&t.getRendererUid()==this.m_uid&&t.isInRendererProcess()&&e>-1&&e<this.m_processesLen){let s=t.getDisplay().__$$runit.getRPROUid(),i=this.m_processBuider.getNodeByUid(s),a=this.m_processes[e];i!=a&&(i.removeDispUnit(t.getDisplay()),t.__$rseFlag=a.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),a.addDisp(t.getDisplay()))}}moveEntityToProcess(t,e){if(null!=e&&null!=t&&t.getRendererUid()==this.m_uid&&t.isInRendererProcess()){let s=t.getDisplay().__$$runit.getRPROUid(),i=this.m_processBuider.getNodeByUid(s);if(i!=e){let s=e;i.removeDispUnit(t.getDisplay()),t.__$rseFlag=e.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),s.addDisp(t.getDisplay())}}}removeEntity(t){null!=t&&t.getRendererUid()==this.m_uid&&(this.m_entity3DMana.removeEntity(t),t.__$setRenderProxy(null))}removeEntityFromProcess(t,e){null!=e&&e.getRCUid()==this.m_uid&&null!=t&&t.getRendererUid()==this.m_uid&&(e.removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}removeEntityByProcessIndex(t,e){e>=0&&e<this.m_processesLen&&null!=t&&t.getRendererUid()==this.m_uid&&(this.m_processes[e].removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}setProcessSortEnabledAt(t,e){t>=0&&t<this.m_processesLen&&this.m_processes[t].setSortEnabled(e)}setProcessSortEnabled(t,e){if(null!=t&&t.getRCUid()==this.m_uid){let s=t;s.setSortEnabled(e)}}getRenderProcessAt(t){return this.m_processes[t]}appendProcess(t=!0,e=!1){this.m_processBuider.setCreateParams(this.m_dataBuilder.getRenderShader(),this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_renderProxy.Vertex,t,e);let s=this.m_processBuider.create();return this.m_processes.push(s),s.setRendererParam(this.m_renderProxy,this.m_processesLen),++this.m_processesLen,s}createSeparatedProcess(t=!0,e=!1){this.m_processBuider.setCreateParams(this.m_dataBuilder.getRenderShader(),this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_renderProxy.Vertex,t,e);let s=this.m_processBuider.create();return this.m_sprocesses.push(s),s.setRendererParam(this.m_renderProxy,this.m_sprocessesLen),s}setRendererProcessParam(t,e,s){t>-1&&t<this.m_processesLen&&this.m_processes[t].setRenderParam(e,s)}getProcessAt(t){return t>-1&&t<this.m_processesLen?this.m_processes[t]:null}showInfoAt(t){t>-1&&t<this.m_processesLen&&this.m_processes[t].showInfo()}getProcessesTotal(){return this.m_processesLen}updateMaterialUniformToCurrentShd(t){this.m_dataBuilder.getRenderShader().useUniformToCurrentShd(t.__$uniform)}drawEntityByLockMaterial(t,e=!1,s=!0){null!=t&&t.getVisible()&&t.getRendererUid()==this.m_uid&&!this.m_renderProxy.isContextLost()&&this.m_fixProcess.drawLockMaterialByDisp(t.getDisplay(),e,s)}drawEntity(t,e=!1,s=!0){null!=t&&t.getVisible()&&!this.m_renderProxy.isContextLost()&&(t.getRendererUid()==this.m_uid?this.m_fixProcess.drawDisp(t.getDisplay(),e,s):t.__$testRendererEnabled()&&this.m_entity3DMana.addEntity(t,this.m_fixProcess.getUid(),!1))}runAt(t){this.m_renderProxy.isContextLost()||this.m_processes[t].run()}runProcess(t){t.getRCUid()!=this.m_uid||this.m_renderProxy.isContextLost()||t.run()}runFromIndexTo(t){if(!this.m_renderProxy.isContextLost())for(let e=t;e<this.m_processesLen;++e)this.m_processes[e].run()}run(){if(this.m_entity3DMana.isHaveEntity()&&!this.m_renderProxy.isContextLost())for(let t=0;t<this.m_processesLen;++t)this.m_processes[t].run()}getRenderUnitsTotal(){let t=0;for(let e=0;e<this.m_processesLen;++e)t+=this.m_processes[e].getUnitsTotal();return t}renderflush(){this.m_renderProxy.flush()}toString(){return"[RendererInstance(uid = "+this.m_uid+")]"}}c.s_uid=0,e.RendererInstance=c,e.default=c},da6a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){if(this.m_texResource=null,this.m_bufferUpdater=null,this.m_textureTotal=0,this.m_textureMap=new Map,this.m_freeMap=new Map,this.m_texUid=0,this.m_freeUids=[],null!=i.s_ins)throw Error("This Class is a singleton class!!!");i.s_ins=null}static GetInstance(){return null!=i.s_ins||(i.s_ins=new i),i.s_ins}getFreeUid(){if(this.m_freeUids.length>0)return this.m_freeUids.pop();let t=this.m_texUid++;return t}__$$addTexture(t){null==t||this.m_textureMap.has(t.getUid())||(this.m_textureMap.set(t.getUid(),t),this.m_textureTotal++)}getTextureByUid(t){return this.m_textureMap.get(t)}hasTextureByUid(t){return this.m_textureMap.has(t)}removeTextureByUid(t){if(this.m_textureMap.has(t)){let e=this.m_textureMap.get(t);if(e.getAttachCount()<1)return this.m_freeMap.has(t)&&this.m_freeMap.delete(t),e.__$destroy(),e.__$$removeFromSlot(),this.m_textureMap.delete(t),this.m_freeUids.push(t),this.m_textureTotal--,e}return null}getTextureTotal(){return this.m_textureTotal}setRenderProxy(t){this.m_texResource=t.Texture}setBufferUpdater(t){this.m_bufferUpdater=t}getFreeResUidMap(){return this.m_freeMap}isGpuEnabledByResUid(t){return this.m_texResource.hasResUid(t)}addRenderBuffer(t,e){null!=this.m_bufferUpdater&&this.m_bufferUpdater.__$addBuf(t,e)}addFreeUid(t){this.m_freeMap.set(t,0)}removeFreeUid(t){this.m_freeMap.has(t)&&this.m_freeMap.delete(t)}}i.s_ins=null,e.default=i},dc2b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("e08e"),a=i(s("29ef"));class n{constructor(){this.m_uid=0,this.m_material=null,this.m_matFS32=null,this.name="RODisplay",this.visible=!0,this.ivsIndex=0,this.ivsCount=0,this.trisNumber=0,this.insCount=0,this.drawMode=r.RenderDrawMode.ELEMENTS_TRIANGLES,this.vbuf=null,this.renderState=a.default.NORMAL_STATE,this.rcolorMask=a.default.COLOR_MASK_ALL_TRUE,this.mouseEnabled=!1,this.m_partGroup=null,this.m_trans=null,this.__$ruid=-1,this.__$rpuid=-1,this.__$$rsign=r.DisplayRenderSign.NOT_IN_RENDERER,this.__$$runit=null,this.m_uid=n.s_uid++}getPartGroup(){return this.m_partGroup}createPartGroup(t){t<1&&(t=1),this.m_partGroup=new Uint16Array(2*t)}setDrawPartAt(t,e,s){t*=2,this.m_partGroup[t]=s,this.m_partGroup[++t]=e}getUid(){return this.m_uid}setTransform(t){this.m_trans=t,this.m_matFS32=t.getLocalFS32()}getTransform(){return this.m_trans}getMatrixFS32(){return this.m_matFS32}enableDrawInstanced(t,e){this.drawMode=r.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES,this.ivsIndex=t,this.insCount=e}disableDrawInstanced(){this.drawMode=r.RenderDrawMode.ELEMENTS_TRIANGLES}getMaterial(){return this.m_material}setMaterial(t){null!=this.m_material&&this.m_material!=t&&(this.m_material.__$detachThis(),null!=t&&t.__$attachThis()),this.m_material=t}copyFrom(t){this.vbuf=t.vbuf,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.setMaterial(t.getMaterial())}toString(){return"RODisplay(name="+this.name+",uid="+this.getUid()+", __$ruid="+this.__$ruid+")"}destroy(){null!=this.m_material&&(this.m_material.__$detachThis(),this.m_material.destroy(),this.m_material=null),this.m_matFS32=null,this.vbuf=null,this.__$ruid=-1,this.__$rpuid=-1,this.__$$rsign=r.DisplayRenderSign.NOT_IN_RENDERER,this.ivsIndex=0,this.ivsCount=0,this.m_partGroup=null,this.__$$runit=null}static GetFreeId(){return n.m_freeIdList.length>0?n.m_freeIdList.pop():-1}static GetByUid(t){return n.m_unitList[t]}static IsEnabledByUid(t){return n.m_unitFlagList[t]==n.s_FLAG_BUSY}static Create(){let t=null,e=n.GetFreeId();return e>=0?(t=n.m_unitList[e],n.m_unitFlagList[e]=n.s_FLAG_BUSY):(t=new n,n.m_unitList.push(t),n.m_unitFlagList.push(n.s_FLAG_BUSY),n.m_unitListLen++),t}static Restore(t){if(null!=t&&n.m_unitFlagList[t.getUid()]==n.s_FLAG_BUSY){let e=t.getUid();n.m_freeIdList.push(e),n.m_unitFlagList[e]=n.s_FLAG_FREE,t.destroy()}}}n.s_uid=0,n.s_FLAG_BUSY=1,n.s_FLAG_FREE=0,n.m_unitFlagList=[],n.m_unitListLen=0,n.m_unitList=[],n.m_freeIdList=[],e.default=n},de9d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("e2fe")),h=i(s("722e")),l=i(s("8333")),o=s("7c63"),_=s("070b"),m=s("a5ba"),u=i(s("090c")),d=i(s("1216")),c=i(s("56c5")),f=i(s("030e")),p=i(s("74c3")),g=i(s("984e")),T=i(s("29ef")),y=s("8171"),E=i(s("919c")),x=s("e602"),v=s("53d3");class S{constructor(){this.materialUpdater=null,this.vtxBufUpdater=null,this.vtxBuilder=null,this.uniformContext=null}}e.RenderProxyParam=S;class b{constructor(t){this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.RDrawState=null,this.Vertex=null,this.Texture=null,this.VtxBufUpdater=null,this.MaterialUpdater=null,this.uniformContext=null,this.adapter=null,this.stencil=null,this.renderingState=null,this.colorMask=null,this.m_uid=0,this.m_camUBO=null,this.m_adapter=null,this.m_adapterContext=new u.default,this.m_rc=null,this.m_perspectiveEnabled=!0,this.m_viewPortRect=new n.default(0,0,800,600),this.m_cameraNear=.1,this.m_cameraFar=5e3,this.m_cameraFov=45,this.m_maxWebGLVersion=2,this.m_WEBGL_VER=2,this.m_camera=null,this.m_camSwitched=!1,this.m_autoSynViewAndStage=!0,this.m_initMainCamera=!0,this.m_uid=t}getRC(){return this.m_rc}getUid(){return this.m_uid}getRCUid(){return this.m_uid}isAutoSynViewAndStage(){return this.m_autoSynViewAndStage}enableSynViewAndStage(){this.m_autoSynViewAndStage=!0}lockViewport(){this.m_adapter.lockViewport()}unlockViewport(){this.m_adapter.unlockViewport()}getDiv(){return this.m_adapter.getDiv()}getCanvas(){return this.m_adapter.getCanvas()}cameraLock(){this.m_camera.lock()}cameraUnlock(){this.m_camera.unlock()}getCamera(){return this.m_camera}updateCamera(){return this.m_camera.update()}createCameraUBO(t){}updateCameraDataFromCamera(t){null!=t&&(this.m_camSwitched||t!=this.m_camera)&&(this.m_camSwitched=t!=this.m_camera,t.updateCamMatToUProbe(this.m_camera.matUProbe),null!=this.m_camUBO&&(this.m_camUBO.setSubDataArrAt(0,t.matUProbe.getFS32At(0)),this.m_camUBO.setSubDataArrAt(16,t.matUProbe.getFS32At(1))))}useCameraData(){null!=this.m_camUBO&&this.m_camUBO.run()}getActiveAttachmentTotal(){return this.m_adapter.getActiveAttachmentTotal()}drawInstanced(t,e,s){2==this.m_WEBGL_VER?this.m_rc.drawElementsInstanced(this.TRIANGLES,t,this.UNSIGNED_SHORT,e,s):f.default.ANGLE_instanced_arrays.drawElementsInstancedANGLE(this.TRIANGLES,t,e,s)}createUBOBufferByBytesCount(t){let e=this.m_rc.createBuffer();return this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,e),this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.DYNAMIC_DRAW),e}createUBOBufferByDataArray(t){let e=this.m_rc.createBuffer();return this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,e),this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.DYNAMIC_DRAW),e}bindUBOBuffer(t){this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,t)}deleteUBOBuffer(t){this.m_rc.deleteBuffer(t)}bufferDataUBOBuffer(t){this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.STATIC_DRAW)}bindBufferBaseUBOBuffer(t,e){this.m_rc.bindBufferBase(this.m_rc.UNIFORM_BUFFER,t,e)}setWebGLMaxVersion(t){1!=t&&2!=t||(this.m_maxWebGLVersion=t)}getContext(){return this.m_adapterContext}getStage3D(){return this.m_adapterContext.getStage()}getRenderAdapter(){return this.m_adapter}getRenderContext(){return this.m_adapter.getRenderContext()}setCameraParam(t,e,s){this.m_cameraFov=t,this.m_cameraNear=e,this.m_cameraFar=s}getMouseXYWorldRay(t,e){let s=this.m_adapterContext.getStage();this.m_camera.getWorldPickingRayByScreenXY(s.mouseX,s.mouseY,t,e)}testViewPortChanged(t,e,s,i){return this.m_viewPortRect.testEqualWithParams(t,e,s,i)}testRCViewPortChanged(t,e,s,i){return this.m_adapterContext.testViewPortChanged(t,e,s,i)}getViewX(){return this.m_viewPortRect.x}getViewY(){return this.m_viewPortRect.y}getViewWidth(){return this.m_viewPortRect.width}getViewHeight(){return this.m_viewPortRect.height}setViewPort(t,e,s,i){this.m_autoSynViewAndStage=!1,this.m_viewPortRect.setTo(t,e,s,i);let r=this.m_adapterContext.getStage();null!=r&&(r.setViewPort(s,e,s,i),this.updateCameraView()),this.m_adapterContext.setViewport(t,e,s,i)}setRCViewPort(t,e,s,i,r=!1){this.m_autoSynViewAndStage=r,this.m_adapterContext.setViewport(t,e,s,i)}reseizeRCViewPort(){this.m_adapter.unlockViewport(),this.m_adapter.reseizeViewPort()}updateCameraView(){if(null!=this.m_camera){let t=this.m_viewPortRect;this.m_camera.setViewXY(t.x,t.y),this.m_camera.setViewSize(t.width,t.height)}}resizeCallback(){if(this.m_autoSynViewAndStage){let t=this.m_viewPortRect;t.setSize(this.m_adapterContext.getRCanvasWidth(),this.m_adapterContext.getRCanvasHeight()),this.createMainCamera(),this.m_adapterContext.setViewport(t.x,t.y,t.width,t.height),this.updateCameraView()}}createMainCamera(){if(this.m_initMainCamera){this.m_initMainCamera=!1,this.m_camera.uniformEnabled=!0;let t=this.m_viewPortRect;this.m_perspectiveEnabled?this.m_camera.perspectiveRH(r.default.DegreeToRadian(this.m_cameraFov),t.width/t.height,this.m_cameraNear,this.m_cameraFar):this.m_camera.orthoRH(this.m_cameraNear,this.m_cameraFar,-.5*t.height,.5*t.height,-.5*t.width,.5*t.width),this.updateCameraView()}}readPixels(t,e,s,i,r,a,n){this.m_adapter.readPixels(t,e,s,i,r,a,n)}getGLVersion(){return this.m_WEBGL_VER}buildCameraParam(){let t=this.m_camera;null==t.matUProbe&&(t.matUProbe=this.uniformContext.createShaderUniformProbe(),t.matUProbe.addMat4Data(new Float32Array(16),1),t.matUProbe.addMat4Data(new Float32Array(16),1)),null==t.ufrustumProbe&&(t.ufrustumProbe=this.uniformContext.createShaderUniformProbe(),t.ufrustumProbe.addVec4Data(new Float32Array([t.getZNear(),t.getZFar(),.5*t.getNearPlaneWidth(),.5*t.getNearPlaneHeight()]),1)),null==t.ucameraPosProbe&&(t.ucameraPosProbe=this.uniformContext.createShaderUniformProbe(),t.ucameraPosProbe.addVec4Data(new Float32Array([500,500,500,1]),1))}initialize(t,e,s,i){if(null!=this.m_rc)return;this.m_camera=e;let r=t.camPosition,n=t.camLookAtPos,_=t.camUpDirect;null==r&&(r=new a.default(800,800,800)),null==n&&(n=new a.default(0,0,0)),null==_&&(_=new a.default(0,1,0)),null!=s&&(s.uProbe=i.uniformContext.createUniformVec4Probe(1)),this.m_perspectiveEnabled=t.cameraPerspectiveEnabled,this.m_adapterContext.autoSyncRenderBufferAndWindowSize=t.autoSyncRenderBufferAndWindowSize,this.m_adapterContext.setResizeCallback(this,this.resizeCallback),this.m_adapterContext.setWebGLMaxVersion(this.m_maxWebGLVersion),this.m_adapterContext.initialize(this.m_uid,s,t.getDiv(),t.getRenderContextAttri()),this.m_WEBGL_VER=this.m_adapterContext.getWebGLVersion(),this.m_rc=this.m_adapterContext.getRC();let m=this,u=this.m_rc,S=new p.default(this.m_uid,u,i.vtxBuilder),b=new g.default(this.m_uid,u);this.m_vtxRes=S,m.Vertex=S,m.Texture=b,m.MaterialUpdater=i.materialUpdater,m.VtxBufUpdater=i.vtxBufUpdater,m.uniformContext=i.uniformContext;let A=new o.RODrawState;A.setRenderContext(this.m_adapterContext),T.default.Initialize(A,new E.default),m.RState=A,m.RContext=this.m_rc,m.stencil=new y.Stencil(A),m.renderingState=new v.RenderingState,m.colorMask=new x.RenderingColorMask,this.buildCameraParam();let R=this.m_viewPortRect;if(R.setSize(this.m_adapterContext.getRCanvasWidth(),this.m_adapterContext.getRCanvasHeight()),this.m_adapter=new d.default(this.m_uid,b),this.m_adapter.initialize(this.m_adapterContext,t,A,this.uniformContext.createUniformVec4Probe(1)),m.adapter=this.m_adapter,this.m_autoSynViewAndStage){let t=this.m_adapterContext.getStage();null!=t&&R.setSize(R.width,R.height)}this.createMainCamera(),this.m_adapterContext.setViewport(R.x,R.y,R.width,R.height),this.m_camera.lookAtRH(r,n,_),this.m_camera.update(),this.m_adapter.bgColor.setRGB3f(0,0,0),m.RGBA=u.RGBA,m.UNSIGNED_BYTE=u.UNSIGNED_BYTE,m.TRIANGLE_STRIP=u.TRIANGLE_STRIP,m.TRIANGLE_FAN=u.TRIANGLE_FAN,m.TRIANGLES=u.TRIANGLES,m.LINES=this.m_rc.LINES,m.LINE_STRIP=u.LINE_STRIP,m.UNSIGNED_SHORT=u.UNSIGNED_SHORT,m.UNSIGNED_INT=u.UNSIGNED_INT,m.COLOR=u.COLOR,m.DEPTH=u.DEPTH,m.STENCIL=u.STENCIL,m.DEPTH_STENCIL=u.DEPTH_STENCIL,this.m_WEBGL_VER>1?(m.MIN=u.MIN,m.MAX=u.MAX):(m.MIN=f.default.EXT_blend_minmax.MIN_EXT,m.MAX=f.default.EXT_blend_minmax.MAX_EXT);let M=h.default;M.NEAREST=u.NEAREST,M.LINEAR=u.LINEAR,M.LINEAR_MIPMAP_LINEAR=u.LINEAR_MIPMAP_LINEAR,M.NEAREST_MIPMAP_NEAREST=u.NEAREST_MIPMAP_NEAREST,M.LINEAR_MIPMAP_NEAREST=u.LINEAR_MIPMAP_NEAREST,M.NEAREST_MIPMAP_LINEAR=u.NEAREST_MIPMAP_LINEAR;let D=l.default;D.COLOR_BUFFER_BIT=u.COLOR_BUFFER_BIT,D.DEPTH_BUFFER_BIT=u.DEPTH_BUFFER_BIT,D.STENCIL_BUFFER_BIT=u.STENCIL_BUFFER_BIT,c.default.SetRenderer(this.m_adapterContext)}flush(){this.m_rc.flush()}setClearRGBColor3f(t,e,s){this.m_adapter.bgColor.setRGB3f(t,e,s)}setClearColor(t){this.m_adapter.bgColor.copyFrom(t)}setClearUint24Color(t,e=1){this.m_adapter.bgColor.setRGBUint24(t),this.m_adapter.bgColor.a=e}setClearRGBAColor4f(t,e,s,i){this.m_adapter.bgColor.setRGBA4f(t,e,s,i)}getClearRGBAColor4f(t){t.copyFrom(this.m_adapter.bgColor)}getViewportWidth(){return this.m_adapter.getViewportWidth()}getViewportHeight(){return this.m_adapter.getViewportHeight()}setRenderToBackBuffer(){this.m_adapter.setRenderToBackBuffer()}clearBackBuffer(){this.m_adapter.clear()}clearDepth(t=1){this.m_adapter.clearDepth(t)}renderBegin(){this.m_camera.update(),this.m_adapter.renderBegin()}renderEnd(){}useRenderStateByName(t){m.RenderStateObject.UseRenderStateByName(t)}setScissorEnabled(t){this.m_adapterContext.setScissorEnabled(t)}setScissorRect(t,e,s,i){this.m_adapterContext.setScissorRect(t,e,s,i)}useRenderColorMask(t){_.RenderColorMask.UseRenderState(t)}unlockRenderColorMask(){_.RenderColorMask.Unlock()}lockRenderColorMask(){_.RenderColorMask.Lock()}useRenderState(t){m.RenderStateObject.UseRenderState(t)}unlockRenderState(){m.RenderStateObject.Unlock()}lockRenderState(){m.RenderStateObject.Lock()}setVtxUpdateTimesTotal(t){this.m_vtxRes.setVtxUpdateTimesTotal(t)}setFrontFaceFlipped(t){this.m_adapter.setFrontFaceFlipped(t)}enabledPolygonOffset(){this.m_adapter.enabledPolygonOffset()}disabledPolygonOffset(){this.m_adapter.disabledPolygonOffset()}setPolygonOffset(t,e=0){this.m_adapter.setPolygonOffset(t,e)}resetPolygonOffset(){this.m_adapter.resetPolygonOffset()}loseContext(){this.m_adapter.loseContext()}isContextLost(){return this.m_adapter.isContextLost()}setViewProbeValue(t,e,s,i){this.m_adapter.setViewProbeValue(t,e,s,i)}toString(){return"[Object RenderProxy()]"}}e.RenderProxy=b,e.default=b},dea9:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("faa5")),a=i(s("0fc4"));class n extends r.default{constructor(){super(),this.m_uniqueName=""}initialize(t){this.m_uniqueName="NormalViewerShd"}getFragShaderCode(){let t="#version 300 es\nprecision mediump float;\nconst float MATH_PI = 3.14159265;\nconst float MATH_2PI = 2.0 * MATH_PI;\nconst float MATH_3PI = 3.0 * MATH_PI;\nconst float MATH_1PER2PI = 0.5 * MATH_PI;\nconst float MATH_3PER2PI = 3.0 * MATH_PI * 0.5;\n\nconst vec3 gama = vec3(1.0/2.2);\nin vec4 v_param;\nlayout(location = 0) out vec4 FragColor;\nvoid main() {\n\n    bool facing = gl_FrontFacing;\n    vec2 dv = fract(gl_FragCoord.xy/vec2(5.0)) - vec2(0.5);\n    vec2 f2 = sign(dv);\n    \n    vec3 nv = normalize(v_param.xyz);\n    vec3 color = pow(nv, gama);\n\n    vec3 frontColor = color.xyz;\n    vec3 backColor = vec3(sign(f2.x * f2.y), 1.0, 1.0);\n    vec3 dstColor = facing ? frontColor : backColor;\n\n    FragColor = vec4(dstColor, 1.0);\n    // FragColor = vec4(color, 1.0);\n}\n";return t}getVertShaderCode(){let t="#version 300 es\nprecision mediump float;\nlayout(location = 0) in vec3 a_vs;\nlayout(location = 1) in vec3 a_nvs;\nuniform mat4 u_objMat;\nuniform mat4 u_viewMat;\nuniform mat4 u_projMat;\nout vec4 v_param;\nvoid main()\n{\n    vec4 viewPv = u_viewMat * u_objMat * vec4(a_vs, 1.0);\n    gl_Position = u_projMat * viewPv;\n    vec3 pnv = normalize(a_nvs * inverse(mat3(u_objMat)));\n    v_param = vec4(pnv, 1.0);\n}\n";return t}getUniqueShaderName(){return this.m_uniqueName}}e.NormalViewerShaderBuffer=n;class h extends a.default{constructor(){super()}getCodeBuf(){return null!=h.s_codeBuf||(h.s_codeBuf=new n),h.s_codeBuf}}h.s_codeBuf=new n,e.NormalViewerMaterial=h},df25:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8d98")),a=i(s("ffc0")),n=i(s("1f61")),h=i(s("68aa")),l=i(s("0851"));class o extends l.default{constructor(t,e,s=!1){super(t,e,s),this.m_bytes=null,this.m_subDataList=null,this.m_texDatasLen=0,this.m_texData=null,this.m_texDatas=null,this.minFilter=r.default.LINEAR}setDataFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,n=!1){if(null!=t&&s>0&&i>0){e<0&&(e=0),e>15&&(e=15),e>=this.m_texDatasLen&&(this.m_texDatasLen=e+1),this.m_haveRData=!0;let l=this.m_texData;null!=l?this.m_texData.miplevel!=e&&(null==this.m_texDatas&&(this.m_texDatas=[this.m_texData,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),l=this.m_texDatas[e],null==l&&(l=h.default.Create(),l.miplevel=e,n=!0,this.m_texDatas[e]=l)):(this.m_texData=l=h.default.Create(),l.miplevel=e,n=!0),l.data==t&&l.offsetx==r&&l.offsety==a||(0==e&&(this.m_texWidth=s,this.m_texHeight=i,this.m_bytes=t),l.data=t,l.status=0,(l.width<s||l.height<i||n)&&(l.width=s,l.height=i,l.status=1),l.offsetx=r,l.offsety=a),this.version++}}uploadData(t){null!=this.m_texData&&this.dataUploadToGpu(t.getRC(),this.m_texData,this.m_texDatas,!0)}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())){let e=t.getRC(),s=null!=this.m_subDataList?this.m_subDataList.length:0;if(this.__$updateToGpuBegin(t),s>0){let t=0,i=null,r=a.default.ToGL(e,this.internalFormat),l=a.default.ToGL(e,this.srcFormat),o=n.default.ToGL(e,this.dataType);for(;t<s;++t)i=this.m_subDataList.pop(),i.updateToGpu(e,this.m_sampler,r,l,o,!1),h.default.Restore(i)}null!=this.m_texData&&(this.dataUploadToGpu(e,this.m_texData,this.m_texDatas),this.__$buildParam(e),this.m_generateMipmap=!0),this.__$updateToGpuEnd(e)}}setPartDataFromeBytes(t,e,s,i,r,a=0){null==this.m_subDataList&&(this.m_subDataList=[]);let n=h.default.Create();n.data=t,n.status=0,n.miplevel=a,n.offsetx=e,n.offsety=s,n.width=i,n.height=r,this.m_subDataList.push(n),this.version++}getPixels(t,e,s,i,r){if(null!=this.m_bytes&&null!=r){let n=this.unpackAlignment,h=s*i*n;if(r.length==h){let l=e,o=t,_=l+i,m=o+s,u=0;switch(this.srcFormat){case a.default.ALPHA:for(;l<_;++l)for(o=t;o<m;++o)h=l*this.m_texWidth+o,r[u]=this.m_bytes[h],u++;break;case a.default.RGBA:for(;l<_;++l)for(o=t;o<m;++o)h=(l*this.m_texWidth+o)*n,r[u]=this.m_bytes[h],r[u+1]=this.m_bytes[h+1],r[u+2]=this.m_bytes[h+2],r[u+3]=this.m_bytes[h+3],u++;break;case a.default.RGB:for(;l<_;++l)for(o=t;o<m;++o)h=(l*this.m_texWidth+o)*n,r[u]=this.m_bytes[h],r[u+1]=this.m_bytes[h+1],r[u+2]=this.m_bytes[h+2],u++;break;default:break}}}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.m_texDatas){for(let t=0;t<this.m_texDatasLen;++t)h.default.Restore(this.m_texDatas[t]);this.m_texDatasLen=0,this.m_texDatas=null,this.m_texData=null}null!=this.m_texData&&(h.default.Restore(this.m_texData),this.m_texData=null),this.m_bytes=null,super.__$destroy()}}toString(){return"[RawDataTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=o},df9d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_uid=-1,this.m_begin=null,this.m_end=null,this.m_unitMap=new Map,this.m_unitTexMap=new Map,this.m_FLAG_BUSY=1,this.m_FLAG_FREE=0,this.m_vtxFlagList=[],this.m_vtxIndexFlagList=[],this.m_vtxfreeIList=[],this.m_vtxList=[],this.m_vtxListLen=0,this.m_texFlagList=[],this.m_texIndexFlagList=[],this.m_texfreeIList=[],this.m_texList=[],this.m_texListLen=0,this.m_uid=i.s_uid++}getFreeVtxId(){return this.m_vtxfreeIList.length>0?this.m_vtxfreeIList.pop():-1}getVtxIndex(){let t=-1,e=this.getFreeVtxId();return e>=0?(t=e,this.m_vtxList[e]=0,this.m_vtxFlagList[e]=this.m_FLAG_BUSY):(t=this.m_vtxListLen,this.m_vtxList.push(0),this.m_vtxIndexFlagList.push(this.m_FLAG_FREE),this.m_vtxFlagList.push(this.m_FLAG_BUSY),this.m_vtxListLen++),t}restoreVtxIndex(t){this.m_vtxFlagList[t]==this.m_FLAG_BUSY&&(this.m_vtxfreeIList.push(t),this.m_vtxFlagList[t]=this.m_FLAG_FREE,this.m_vtxList[t]=0)}attachVtxAt(t){++this.m_vtxList[t]}detachVtxAt(t){this.m_vtxList[t]>0&&(--this.m_vtxList[t],this.m_vtxList[t]<1&&this.restoreVtxIndex(t))}getVtxTotalAt(t){return this.m_vtxList[t]}getFreeTexId(){return this.m_texfreeIList.length>0?this.m_texfreeIList.pop():-1}getTexIndex(){let t=-1,e=this.getFreeTexId();return e>=0?(t=e,this.m_texList[e]=0,this.m_texFlagList[e]=this.m_FLAG_BUSY):(t=this.m_texListLen,this.m_texList.push(0),this.m_texIndexFlagList.push(this.m_FLAG_FREE),this.m_texFlagList.push(this.m_FLAG_BUSY),this.m_texListLen++),t}restoreTexIndex(t){this.m_texFlagList[t]==this.m_FLAG_BUSY&&(this.m_texfreeIList.push(t),this.m_texFlagList[t]=this.m_FLAG_FREE,this.m_texList[t]=0)}attachTexAt(t){++this.m_texList[t]}detachTexAt(t){this.m_texList[t]>0&&(--this.m_texList[t],this.m_texList[t]<1&&this.restoreTexIndex(t))}getTexTotalAt(t){return this.m_texList[t]}destroy(){this.clear()}clear(){this.m_begin=this.m_end=null,this.m_unitMap=new Map,this.m_unitTexMap=new Map,this.m_vtxFlagList=[],this.m_vtxIndexFlagList=[],this.m_vtxList=[],this.m_vtxfreeIList=[],this.m_vtxListLen=0,this.m_texFlagList=[],this.m_texIndexFlagList=[],this.m_texList=[],this.m_texfreeIList=[],this.m_texListLen=0}getBegin(){return this.m_begin}containsNode(t){let e=this.m_unitMap.get(t.vtxUid);if(null!=e){let s=131*(31+e.rvroI);return s*=s+e.texMid,t.rtokey==s}return!1}addNodeAndSort(t){let e=this.m_unitMap.get(t.vtxUid);if(null==e){this.m_unitMap.set(t.vtxUid,t),t.rvroI=this.getVtxIndex(),this.attachVtxAt(t.rvroI);let e=131*(31+t.rvroI);e*=e+t.texMid,t.rtokey=e,t.rtroI=this.getTexIndex(),this.m_unitTexMap.set(e,t.rtroI),this.attachTexAt(t.rtroI)}else{t.rvroI=e.rvroI,this.attachVtxAt(t.rvroI);let s=131*(31+t.rvroI);if(s*=s+t.texMid,this.m_unitTexMap.has(s)?t.rtroI=this.m_unitTexMap.get(s):(t.rtroI=this.getTexIndex(),this.m_unitTexMap.set(s,t.rtroI)),t.rtokey=s,this.attachTexAt(t.rtroI),e!=this.m_end)if(e.texMid==t.texMid)e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;else while(null!=e){if(e.vtxUid!=t.vtxUid){e=e.prev,e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.texMid==t.texMid){e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.next==this.m_end){this.m_end.vtxUid!=t.vtxUid?(e.next.prev=t,t.next=e.next,t.prev=e,e.next=t):e=null;break}e=e.next}else e=null}null==e&&(null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null)}showInfo(){let t=this.getBegin();if(null!=t){let e="",s="",i="";while(null!=t)e+=t.vtxUid+",",s+=t.texMid+",",i+=t.ivsCount+",",t=t.next}}removeNodeAndSort(t){let e=this.m_unitMap.get(t.vtxUid);e!=t?e=null:(this.m_unitMap.set(t.vtxUid,null),null!=t.next&&t.next.vtxUid==t.vtxUid?this.m_unitMap.set(t.vtxUid,t.next):null!=t.prev&&t.prev.vtxUid==t.vtxUid?this.m_unitMap.set(t.vtxUid,t.prev):this.m_unitMap.delete(t.vtxUid)),t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),this.detachVtxAt(t.rvroI),this.detachTexAt(t.rtroI),t.prev=null,t.next=null}addNode(t){null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null}removeNode(t){t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}i.s_uid=0,e.default=i},e08e:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.ELEMENTS_TRIANGLES=1,i.ELEMENTS_TRIANGLE_STRIP=2,i.ELEMENTS_TRIANGLE_FAN=3,i.ELEMENTS_INSTANCED_TRIANGLES=4,i.ARRAYS_LINES=5,i.ARRAYS_LINE_STRIP=6,i.ARRAYS_POINTS=7,i.ELEMENTS_LINES=8,i.DISABLE=0,e.RenderDrawMode=i;class r{}r.NORMAL=1,r.OPAQUE=1,r.TRANSPARENT=2,r.ALPHA_ADD=3,r.ADD=4,r.ADD_LINEAR=5,r.INVERSE_ALPHA=6,r.BLAZE=7,r.OVERLAY=8,r.OVERLAY2=8,r.DISABLE=0,e.RenderBlendMode=r;class a{}a.NEVER=1,a.LESS=1,a.EQUAL=1,a.GREATER=1,a.NOTEQUAL=1,a.GEQUAL=1,a.ALWAYS=1,e.GLStencilFunc=a;class n{}n.KEEP=1,n.ZERO=1,n.REPLACE=1,n.INCR=1,n.INCR_WRAP=1,n.DECR=1,n.DECR_WRAP=1,n.INVERT=1,e.GLStencilOp=n;class h{}h.ZERO=1,h.ONE=1,h.SRC_COLOR=1,h.DST_COLOR=1,h.SRC_ALPHA=1,h.DST_ALPHA=1,h.ONE_MINUS_SRC_ALPHA=1,e.GLBlendMode=h;class l{}l.FUNC_ADD=1,l.FUNC_SUBTRACT=1,l.FUNC_REVERSE_SUBTRACT=1,l.MIN_EXT=1,l.MAX_EXT=1,l.MIN=1,l.MAX=1,e.GLBlendEquation=l;class o{}o.BACK=1,o.FRONT=2,o.FRONT_AND_BACK=3,o.NONE=0,o.DISABLE=0,e.CullFaceMode=o;class _{}_.NEVER=1,_.ALWAYS=2,_.SKY=3,_.TRUE_LESS_EQUAL=3,_.OPAQUE=4,_.TRUE_LESS=4,_.OPAQUE_OVERHEAD=5,_.FALSE_EQUAL=5,_.FALSE_LESS=6,_.BLEND=6,_.BLEND_SORT=6,_.TRANSPARENT_SORT=6,_.TRUE_LEQUAL=7,_.WIRE_FRAME=7,_.FALSE_LEQUAL=8,_.DECALS=8,_.NEXT_LAYER=11,_.WIRE_FRAME_NEXT=12,_.TRUE_EQUAL=13,_.TRUE_GREATER=14,_.TRUE_GEQUAL=15,_.DISABLE=0,e.DepthTestMode=_;class m{}m.SCENE_RO_FILTER_BEGIN=1<<19,m.SCENE_RO_FILTER_FINISH=2<<19,m.SCENE_RO_ERASE=0,e.RenderConst=m,function(t){t[t["NOT_IN_RENDERER"]=-1]="NOT_IN_RENDERER",t[t["GO_TO_RENDERER"]=1]="GO_TO_RENDERER",t[t["LIVE_IN_RENDERER"]=2]="LIVE_IN_RENDERER"}(e.DisplayRenderSign||(e.DisplayRenderSign={}))},e160:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{IntersectRL(t,e,s){let i=0,r=(s.min.x-e.x)/t.x,a=(s.max.x-e.x)/t.x;r>a&&(i=a,a=r,r=i);let n=(s.min.y-e.y)/t.y,h=(s.max.y-e.y)/t.y;if(n>h&&(i=h,h=n,n=i),r>h||n>a)return!1;n>r&&(r=n),h<a&&(a=h);let l=(s.min.z-e.z)/t.z,o=(s.max.z-e.z)/t.z;return l>o&&(i=o,o=l,l=i),!(r>o||l>a)&&(l>r&&(r=l),o<a&&(a=o),!0)}static IntersectionRL3(t,e,s,i,r,a){return s.w=(t[e[0]].x-r.x)*s.x,i.w=(t[1-e[0]].x-r.x)*s.x,a.x=(t[e[1]].y-r.y)*s.y,a.y=(t[1-e[1]].y-r.y)*s.y,!(s.w>a.y||a.x>i.w)&&(a.x>s.w&&(s.w=a.x),a.y<i.w&&(i.w=a.y),a.x=(t[e[2]].z-r.z)*s.z,a.y=(t[1-e[2]].z-r.z)*s.z,!(s.w>a.y||a.x>i.w)&&(a.x>s.w&&(s.w=a.x),a.y<i.w&&(i.w=a.y),a.copyFrom(i),a.scaleBy(s.w),a.addBy(r),i.w=1,!0))}static IntersectionRL1(t,e,s,i){let r=0,a=(s.min.x-e.x)/t.x,n=(s.max.x-e.x)/t.x;a>n&&(r=n,n=a,a=r);let h=(s.min.y-e.y)/t.y,l=(s.max.y-e.y)/t.y;if(h>l&&(r=l,l=h,h=r),a>l||h>n)return!1;h>a&&(a=h),l<n&&(n=l);let o=(s.min.z-e.z)/t.z,_=(s.max.z-e.z)/t.z;return o>_&&(r=_,_=o,o=r),!(a>_||o>n)&&(o>a&&(a=o),_<n&&(n=_),i.copyFrom(t),i.scaleBy(a),i.addBy(e),!0)}static IntersectionRL2(t,e,s,i){i.x=s.center.x-e.x,i.y=s.center.y-e.y,i.z=s.center.z-e.z;let r=i.dot(t);if(i.x-=r*t.x,i.y-=r*t.y,i.z-=r*t.z,i.getLengthSquared()>s.radius2)return!1;if(s.containsV(e))return i.copyFrom(e),!0;if(e.x<s.min.x){if(t.x>0&&(r=(s.min.x-e.x)/t.x,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsYZ(i.y,i.z)))return!0}else if(e.x>s.max.x&&t.x<0&&(r=(s.max.x-e.x)/t.x,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsYZ(i.y,i.z)))return!0;if(e.y<s.min.y){if(t.y>0&&(r=(s.min.y-e.y)/t.y,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXZ(i.x,i.z)))return!0}else if(e.y>s.max.y&&t.y<0&&(r=s.max.y,r=(s.max.y-e.y)/t.y,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXZ(i.x,i.z)))return!0;if(e.z<s.min.z){if(t.z>0&&(r=(s.min.z-e.z)/t.z,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXY(i.x,i.y)))return!0}else if(e.z>s.max.z&&t.z<0&&(r=(s.max.z-e.z)/t.z,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXY(i.x,i.y)))return!0;return!1}}e.AABBCalc=i},e214:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("f48d"));class h extends n.default{constructor(){super(...arguments),this.nv=new a.default(0,1,0),this.distance=0,this.intersectBoo=!1}intersectStraightLinePos(t,e){let s=this.nv.dot(t.tv);if(s>r.default.MATH_MIN_POSITIVE||s<r.default.MATH_MAX_NEGATIVE){let i=this.nv.dot(t.position)-this.distance;return e.x=1e5*t.tv.x+t.position.x,e.y=1e5*t.tv.y+t.position.y,e.z=1e5*t.tv.z+t.position.z,s=this.nv.dot(e)-this.distance,s=i/(i-s),e.subtractBy(t.position),e.scaleBy(s),e.addBy(t.position),1}return s=this.nv.dot(t.position)-this.distance,s<=r.default.MATH_MIN_POSITIVE||s>=r.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),2):0}intersectStraightLinePos2(t,e,s){let i=this.nv.dot(e);if(i>r.default.MATH_MIN_POSITIVE||i<r.default.MATH_MAX_NEGATIVE){let r=this.nv.dot(t)-this.distance;return s.x=1e5*e.x+t.x,s.y=1e5*e.y+t.y,s.z=1e5*e.z+t.z,i=this.nv.dot(s)-this.distance,i=r/(r-i),s.subtractBy(t),s.scaleBy(i),s.addBy(t),1}return i=this.nv.dot(t)-this.distance,i<=r.default.MATH_MIN_POSITIVE||i>=r.default.MATH_MAX_NEGATIVE?(s.copyFrom(t),2):0}intersectRadialLinePos(t,e){let s=this.nv.dot(t.position)-this.distance;if(s>r.default.MATH_MIN_POSITIVE){let s=this.nv.dot(t.tv);if(s<0)return this.intersectStraightLinePos2(t.position,t.tv,e)}else{if(!(s<r.default.MATH_MAX_NEGATIVE)){let s=this.nv.dot(t.tv);return s>r.default.MATH_MIN_POSITIVE||s<r.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),1):(e.copyFrom(t.position),2)}{let s=this.nv.dot(t.tv);if(s>0)return this.intersectStraightLinePos2(t.position,t.tv,e)}}return-1}intersectRadialLinePos2(t,e,s){let i=this.nv.dot(t)-this.distance;if(i>r.default.MATH_MIN_POSITIVE){let i=this.nv.dot(e);if(i<0)return this.intersectStraightLinePos2(t,e,s)}else{if(!(i<r.default.MATH_MAX_NEGATIVE)){let i=this.nv.dot(e);return i>r.default.MATH_MIN_POSITIVE||i<r.default.MATH_MAX_NEGATIVE?(s.copyFrom(t),1):(s.copyFrom(t),2)}{let i=this.nv.dot(e);if(i>0)return this.intersectStraightLinePos2(t,e,s)}}return-1}containsPoint(t){let e=this.nv.dot(t)-this.distance;return e>r.default.MATH_MIN_POSITIVE?1:e<r.default.MATH_MAX_NEGATIVE?-1:0}intersectSphere(t,e){this.intersectBoo=!1;let s=this.nv.dot(t)-this.distance;return s>r.default.MATH_MIN_POSITIVE?(this.intersectBoo=s<=e,1):s<r.default.MATH_MAX_NEGATIVE?(this.intersectBoo=-s<=e,-1):0}intersectAABB(t,e){this.intersectBoo=!1;let s=n.default.__tV0;s.setXYZ(e.x,t.y,e.z);let i=this.containsPoint(s);return s.setXYZ(e.x,t.y,t.z),i+=this.containsPoint(s),s.setXYZ(t.x,t.y,t.z),i+=this.containsPoint(s),s.setXYZ(t.x,t.y,e.z),i+=this.containsPoint(s),s.setXYZ(e.x,e.y,e.z),i+=this.containsPoint(s),s.setXYZ(e.x,e.y,t.z),i+=this.containsPoint(s),s.setXYZ(t.x,e.y,t.z),i+=this.containsPoint(s),s.setXYZ(t.x,e.y,e.z),i+=this.containsPoint(s),this.intersectBoo=i<8,i<-7?-1:i>7?1:0}intersectSphNegSpace(t,e){this.intersectBoo=Math.abs(this.nv.dot(t)-this.distance)<e}update(){this.nv.normalize()}updateFast(){this.nv.normalize()}static PlaneIntersectSphere(t,e,s,i){h.IntersectBoo=!1,h.IntersectSatus=0,e=t.dot(s)-e,e>r.default.MATH_MIN_POSITIVE?(h.IntersectBoo=e<=i,h.IntersectSatus=1):e<r.default.MATH_MAX_NEGATIVE&&(h.IntersectBoo=-e<=i,h.IntersectSatus=-1)}static CalcPVCloseV(t,e,s){let i=t.distance-e.dot(t.nv);s.setTo(i*t.nv.x,i*t.nv.y,i*t.nv.z),s.addBy(e)}static CalcPVCloseV2(t,e,s,i){let r=e-s.dot(t);i.setTo(r*t.x,r*t.y,r*t.z),i.addBy(s)}static IntersectionSLV2(t,e,s,i,a){let n=t.dot(i);if(n>r.default.MATH_MIN_POSITIVE||n<r.default.MATH_MAX_NEGATIVE){let r=t.dot(s)-e;return a.x=1e5*i.x+s.x,a.y=1e5*i.y+s.y,a.z=1e5*i.z+s.z,n=t.dot(a)-e,n=r/(r-n),a.subtractBy(s),a.scaleBy(n),a.addBy(s),1}return n=t.dot(s)-e,n<=r.default.MATH_MIN_POSITIVE||n>=r.default.MATH_MAX_NEGATIVE?(a.copyFrom(s),2):0}toString(){return"Plane(position="+this.position.toString()+", nv="+this.nv.toString()+")"}}h.IntersectBoo=!1,h.IntersectSatus=0,e.default=h},e2fe:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t=0,e=0,s=100,i=100){this.m_right=100,this.m_top=100,this.x=0,this.y=0,this.width=100,this.height=100,this.x=t,this.y=e,this.width=s,this.height=i,this.update()}copyFrom(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.m_right=t.m_right,this.m_top=t.m_top}clone(){return new i(this.x,this.y,this.width,this.height)}containsXY(t,e){return!(t<this.x||t>this.m_right)&&!(e<this.y||e>this.m_top)}contains(t){return t.x>=this.x&&t.m_right<=this.m_right&&t.y>=this.y&&(t.m_top,this.m_top),!0}intersect(t){return!(t.x>this.m_right)&&(!(t.m_right<this.x)&&(!(t.y>this.m_top)&&!(t.m_top<this.y)))}setTo(t,e,s,i){this.x=t,this.y=e,this.width=s,this.height=i,this.m_right=this.width+this.x,this.m_top=this.height+this.y}setSize(t,e){this.width=t,this.height=e,this.m_right=this.width+this.x,this.m_top=this.height+this.y}testEqual(t){return this.x!=t.x||this.y!=t.y||this.width!=t.width||this.height!=t.height}testEqualWithParams(t,e,s,i){return this.x!=t||this.y!=e||this.width!=s||this.height!=i}update(){this.m_right=this.width+this.x,this.m_top=this.height+this.y}flipY(t){this.y=this.y,this.m_right=this.width+this.x,this.m_top=this.height+this.y}getX(){return this.x}getY(){return this.y}getRight(){return this.m_right}getTop(){return this.m_top}}e.default=i},e602:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("29ef"));class a{constructor(){this.ALL_TRUE=0,this.ALL_FALSE=1,this.RED_TRUE=2,this.GREEN_TRUE=3,this.BLUE_TRUE=4,this.ALPHA_TRUE=5,this.RED_FALSE=6,this.GREEN_FALSE=7,this.BLUE_FALSE=8,this.ALPHA_FALSE=9;let t=r.default,e=this;e.ALL_TRUE=t.COLOR_MASK_ALL_TRUE,e.ALL_FALSE=t.COLOR_MASK_ALL_FALSE,e.RED_TRUE=t.COLOR_MASK_RED_TRUE,e.GREEN_TRUE=t.COLOR_MASK_GREEN_TRUE,e.BLUE_TRUE=t.COLOR_MASK_BLUE_TRUE,e.ALPHA_TRUE=t.COLOR_MASK_ALPHA_TRUE,e.RED_FALSE=t.COLOR_MASK_RED_FALSE,e.GREEN_FALSE=t.COLOR_MASK_GREEN_FALSE,e.BLUE_FALSE=t.COLOR_MASK_BLUE_FALSE,e.ALPHA_FALSE=t.COLOR_MASK_ALPHA_FALSE}}e.RenderingColorMask=a},e7ce:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("faa5")),a=i(s("b3bd")),n=i(s("0fc4"));class h extends r.default{constructor(){super(),this.m_uniqueName=""}initialize(t){this.m_uniqueName="PixelPickIndexShd"}getFragShaderCode(){let t="#version 300 es\nprecision highp float;\nuniform vec4 u_param;\nin vec3 v_viewPos;\n//in float v_length;\nlayout(location = 0) out vec4 FragColor0;\nvoid main()\n{\nvec4 p = vec4(length(v_viewPos.xyz));\np.x = floor(p.x)/256.0;\np.y = floor(fract(p.x) * 256.0)/255.0;\np.x = floor(p.x) / 255.0;\np.z = fract(p.z);\nFragColor0 = vec4(p.xyz,u_param.w);\n}\n";return t}getVertShaderCode(){let t="#version 300 es\nprecision highp float;\nlayout(location = 0) in vec3 a_vs;\nuniform mat4 u_objMat;\nuniform mat4 u_viewMat;\nuniform mat4 u_projMat;\nout vec3 v_viewPos;\n//out float v_length;\nvoid main(){\nmat4 viewMat4 = u_viewMat * u_objMat;\nvec4 viewPos = viewMat4 * vec4(a_vs, 1.0);\nv_viewPos = viewPos.xyz;\n//v_length = length(viewPos.xyz);\ngl_Position = u_projMat * viewPos;\n}\n";return t}getUniqueShaderName(){return this.m_uniqueName}toString(){return"[PixelPickIndexShaderBuffer()]"}static GetInstance(){return h.s_instance}}h.s_instance=new h,e.PixelPickIndexShaderBuffer=h;class l extends n.default{constructor(){super(),this.m_paramArray=new Float32Array([1,1,1,1]),this.m_1over255=1/255}getCodeBuf(){return h.GetInstance()}setIndex(t){this.m_paramArray[3]=t*this.m_1over255}getIndex(){return this.m_paramArray[3]/this.m_1over255}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_param"],t.dataList=[this.m_paramArray],t}}e.default=l},e7d2:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("710f")),n=i(s("f0f0")),h=i(s("7a04")),l=s("e08e");class o{constructor(t=r.default.VTX_STATIC_DRAW){this.m_uid=0,this.m_vtxBuf=null,this.m_ivs=null,this.m_bufDataUsage=0,this.m_ibufStep=2,this.m_bufTypeList=null,this.m_bufSizeList=null,this.layoutBit=0,this.vertexVer=0,this.indicesVer=0,this.version=0,this.drawMode=l.RenderDrawMode.ELEMENTS_TRIANGLES,this.bufData=null,this.m_uid=o.s_uid++,this.m_bufDataUsage=t}setVtxBuf(t){t!=this&&(this.m_vtxBuf=t,null!=t&&(t.layoutBit=this.layoutBit))}setBufDataUsage(t){this.m_bufDataUsage=t}getUid(){return this.m_uid}getType(){return this.m_vtxBuf.getType()}setBufTypeList(t){this.m_bufTypeList=t}setBufSizeList(t){this.m_bufSizeList=t}getBufTypeList(){return this.m_bufTypeList}getBufSizeList(){return this.m_bufSizeList}getIBufStep(){return this.m_ibufStep}getBufDataUsage(){return this.m_bufDataUsage}getBuffersTotal(){return this.m_vtxBuf.getBuffersTotal()}getAttribsTotal(){return this.m_vtxBuf.getAttribsTotal()}getF32DataAt(t){return this.m_vtxBuf.getF32DataAt(t)}getIvsData(){return this.m_ivs}setF32DataAt(t,e,s,i){this.m_vtxBuf.setF32DataAt(t,e,s,i),this.vertexVer++}setUintIVSData(t,e=r.default.VTX_STATIC_DRAW){if(t instanceof Uint16Array){if(this.m_ibufStep=2,t.length>65535)throw Error("its type is not Uint32Array.")}else{if(!(t instanceof Uint32Array))return;this.m_ibufStep=4}this.m_ivs=t,null!=t&&this.indicesVer++}setData4fAt(t,e,s,i,r,a){null!=this.m_vtxBuf&&(this.m_vtxBuf.setData4fAt(t,e,s,i,r,a),this.vertexVer++)}setData3fAt(t,e,s,i,r){null!=this.m_vtxBuf&&(this.m_vtxBuf.setData3fAt(t,e,s,i,r),this.vertexVer++)}setData2fAt(t,e,s,i){null!=this.m_vtxBuf&&(this.m_vtxBuf.setData2fAt(t,e,s,i),this.vertexVer++)}destroy(){}__$destroy(){this.m_vtxBuf.destroy(),this.m_vtxBuf.getType()<1?o.s_combinedBufs.push(this.m_vtxBuf):o.s_separatedBufs.push(this.m_vtxBuf),this.m_vtxBuf=null,this.m_ivs=null,this.bufData=null,this.m_bufTypeList=null,this.m_bufSizeList=null}toString(){return"ROVertexBuffer(uid = "+this.m_uid+")"}static GetFreeId(){return o.s_freeIdList.length>0?o.s_freeIdList.pop():-1}static GetVtxByUid(t){return o.s_unitList[t]}static Create(t=r.default.VTX_STATIC_DRAW){let e=null,s=o.GetFreeId();return s>=0?(e=o.s_unitList[s],e.setBufDataUsage(t),o.s_unitFlagList[s]=o.s_FLAG_BUSY):(e=new o(t),o.s_unitList.push(e),o.s_unitFlagList.push(o.s_FLAG_BUSY),o.s_unitListLen++),e.vertexVer=0,e.indicesVer=0,e.version++,o.s_vtxStore.__$attachAt(e.getUid()),e}static __$Restore(t){if(null!=t&&o.s_unitFlagList[t.getUid()]==o.s_FLAG_BUSY){let e=t.getUid();o.s_freeIdList.push(e),o.s_unitFlagList[e]=o.s_FLAG_FREE,t.__$destroy()}}static __$$AttachAt(t){o.s_vtxStore.__$attachAt(t)}static __$$DetachAt(t){o.s_vtxStore.__$detachAt(t)}static Reset(){o.BufDataList=[],o.s_stride=0,o.BufStatusList=[],o.BufDataStepList=[],o.vtxFS32=null,o.vbWholeDataEnabled=!1,o.dynBufSegEnabled=!1,o.useBufByIndexEnabled=!1}static AddFloat32Data(t,e,s=r.default.VTX_STATIC_DRAW){o.BufDataList.push(t),o.BufDataStepList.push(e),o.BufStatusList.push(s),o.s_stride+=e}static CreateBySaveData(t=r.default.VTX_STATIC_DRAW,e=0){let s=0,i=0,a=0,h=o.BufDataStepList.length,l=[];for(;s<h;s++)l.push(a),a+=o.BufDataStepList[s];let _=o.BufDataList[0].length/o.BufDataStepList[0],m=new Float32Array(a*_),u=0,d=0,c=null,f=null;for(s=0;s<_;++s)for(i=s*a,u=0;u<h;++u)d=o.BufDataStepList[u],c=o.BufDataList[u],f=c.subarray(s*d,(s+1)*d),m.set(f,i),i+=d;let p=o.Create(t);if(p.layoutBit=e,o.s_combinedBufs.length>0){let t=o.s_combinedBufs.pop();p.setVtxBuf(t)}else p.setVtxBuf(new n.default(p.getBufDataUsage()));return p.setF32DataAt(0,m,a,l),p}static CreateVtxCombinedBuf(t,e,s=r.default.VTX_STATIC_DRAW,i=0){let a=0,h=0,l=e.length,_=[];for(;a<l;a++)_.push(h),h+=e[a];let m=o.Create(s);if(m.layoutBit=i,o.s_combinedBufs.length>0){let t=o.s_combinedBufs.pop();m.setVtxBuf(t)}else m.setVtxBuf(new n.default(m.getBufDataUsage()));return m.setF32DataAt(0,t,h,_),m}static UpdateCombinedBufData(t){let e=0,s=0,i=0,r=o.BufDataStepList.length,a=o.BufDataList[0].length/o.BufDataStepList[0],n=t.getF32DataAt(0),h=o.s_stride*a!=n.length,l=null;if(h)for(l=[],n=new Float32Array(o.s_stride*a);e<r;e++)l.push(i),i+=o.BufDataStepList[e];else i=o.s_stride;let _=0,m=0,u=null,d=null;for(e=0;e<a;++e)for(s=e*i,_=0;_<r;++_)m=o.BufDataStepList[_],u=o.BufDataList[_],d=u.subarray(e*m,(e+1)*m),n.set(d,s),s+=m;h?t.setF32DataAt(0,n,i,l):t.setF32DataAt(0,n,i,null)}static UpdateBufData(t){0==t.getType()?o.UpdateCombinedBufData(t):o.UpdateSeparatedBufData(t)}static CreateByBufDataSeparate(t,e=r.default.VTX_STATIC_DRAW,s=0){let i=0,a=0,n=t.getAttributesTotal(),l=new Array(n);l.fill(0);let _=o.Create(e);if(_.layoutBit=s,o.s_separatedBufs.length>0){let t=o.s_separatedBufs.pop();_.setVtxBuf(t)}else _.setVtxBuf(new h.default);for(i=0;i<n;i++)_.setF32DataAt(i,t.getAttributeDataAt(i,0),a,l);return _.setUintIVSData(t.getIndexDataAt(0)),_.bufData=t,_}static CreateBySaveDataSeparate(t=r.default.VTX_STATIC_DRAW){let e=0,s=0,i=o.BufDataStepList.length,a=new Array(i),n=o.Create(t);if(o.s_separatedBufs.length>0){let t=o.s_separatedBufs.pop();n.setVtxBuf(t)}else n.setVtxBuf(new h.default);for(e=0;e<i;e++)n.setF32DataAt(e,o.BufDataList[e],s,a);return n}static UpdateSeparatedBufData(t){let e=o.BufDataStepList.length,s=new Array(e);for(let i=0;i<e;i++)t.setF32DataAt(i,o.BufDataList[i],0,s);return t}static GetVtxAttachCountAt(t){return o.s_vtxStore.getAttachCountAt(t)}static GetVtxAttachAllCount(){return o.s_vtxStore.getAttachAllCount()}static ClearTest(){if(--o.s_timeDelay,o.s_timeDelay<1){o.s_timeDelay=128;let t=o.s_vtxStore;if(t.__$getRemovedListLen()>0){let e=t.__$getRemovedList(),s=e.length,i=0,r=0,a=null,n=32;for(s=s>n?n:s;i<s;++i)r=e.shift(),t.getAttachCountAt(r)<1&&(a=o.GetVtxByUid(r),o.__$Restore(a))}}}}o.s_uid=0,o.s_combinedBufs=[],o.s_separatedBufs=[],o.s_FLAG_BUSY=1,o.s_FLAG_FREE=0,o.s_unitFlagList=[],o.s_unitListLen=0,o.s_unitList=[],o.s_freeIdList=[],o.s_vtxStore=new a.default,o.s_stride=0,o.BufDataList=null,o.BufDataStepList=null,o.BufStatusList=null,o.vtxDataFS32=null,o.vbWholeDataEnabled=!1,o.dynBufSegEnabled=!1,o.useBufByIndexEnabled=!1,o.vtxFS32=null,o.s_timeDelay=128,e.default=o},e87b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73"));class a{create(t,e){let s=r.default.ViewportParam;return e.hasUniformByName(s.name)?t.uniformContext.createShaderGlobalUniformFromProbe(t.getRenderAdapter().uViewProbe,s.name,[s.name]):null}getIDNS(){return"ViewParamUniformBuilder"}}e.default=a},e943:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("32fa"));class a{constructor(){this.m_rprocess=null,this.m_renderer=null,this.m_status=null}initialize(t){null==this.m_renderer&&(this.m_renderer=t,this.m_rprocess=this.m_renderer.createSeparatedProcess(),this.m_status=new r.default,this.m_status.initialize(this.m_renderer,this.m_rprocess))}getFPS(){return this.m_status.getFPS()}run(t=!1){null!=this.m_renderer&&(this.m_status.run(t),this.m_renderer.runProcess(this.m_rprocess))}toString(){return"[ProfileInstance]"}}e.default=a},eaee:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=i(s("8d98")),n=i(s("ffc0")),h=i(s("1f61")),l=i(s("5deb")),o=i(s("0851"));class _ extends o.default{constructor(t,e){super(t,e,!1),this.m_imgDataList=null,this.m_texTarget=l.default.TEXTURE_CUBE,this.m_type=r.TextureProxyType.FloatCube,this.internalFormat=n.default.RGBA16F,this.dataType=h.default.FLOAT,this.mipmapEnabled=!0}toAlphaFormat(){this.srcFormat=n.default.ALPHA,this.internalFormat=n.default.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=n.default.RED,this.internalFormat=n.default.RED,this.unpackAlignment=1}toRGBFormat(){this.unpackAlignment=1,this.srcFormat=n.default.RGB,this.internalFormat=n.default.RGB16F,this.minFilter=a.default.NEAREST,this.magFilter=a.default.NEAREST,this.mipmapEnabled=!1}toRGBAFormat(){this.unpackAlignment=4,this.srcFormat=n.default.RGBA,this.internalFormat=n.default.RGBA16F}toRGBFormatFloat32F(){this.unpackAlignment=1,this.srcFormat=n.default.RGB,this.internalFormat=n.default.RGB32F,this.minFilter=a.default.NEAREST,this.magFilter=a.default.NEAREST,this.mipmapEnabled=!1}toRGBAFormatFloat32F(){this.unpackAlignment=4,this.srcFormat=n.default.RGBA,this.internalFormat=n.default.RGBA32F}toRGBAFormatHalfFloat(){this.unpackAlignment=1,this.srcFormat=n.default.RGBA,this.dataType=h.default.HALF_FLOAT,this.internalFormat=n.default.RGBA16F}setDataFromBytesToFaceAt(t,e,s,i,r=0){if(null==this.m_imgDataList&&(this.m_imgDataList=[null,null,null,null,null,null]),s>0&&i>0){0==t&&r<1&&(this.m_texWidth=s,this.m_texHeight=i,this.m_miplevel=r),null==this.m_imgDataList[t]&&(this.m_imgDataList[t]=new Array(16));let a=this.m_imgDataList[t];a[r]={width:s,height:i,imgData:e,miplevel:r},this.m_haveRData=null!=a[r].imgData}}uploadData(t){let e,s,i=t.getRC(),r=null,a=this.getWidth(),l=this.getHeight();for(let o=0;o<6;++o){let t=this.m_imgDataList[o];if(this.mipmapEnabled&&this.m_generateMipmap)r=t[0],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,n.default.ToGL(i,this.internalFormat),a,l,0,n.default.ToGL(i,this.srcFormat),h.default.ToGL(i,this.dataType),r.imgData);else{e=a,s=l;let _=0;for(;e>0||s>0;)null!=t[_]&&(r=t[_],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+o,_,n.default.ToGL(i,this.internalFormat),e,s,0,n.default.ToGL(i,this.srcFormat),h.default.ToGL(i,this.dataType),r.imgData)),e>0&&(e>>=1),s>0&&(s>>=1),++_}}this.version=0}toString(){return"[FloatCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.m_imgDataList)for(let t=0;t<6;++t)null!=this.m_imgDataList[t]&&(this.m_imgDataList[t].imgData=null);super.__$destroy()}}}e.default=_},eca0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("c62b"));class n{constructor(){this.idsFlag=0,this.count=0,this.rprocessUid=-1}reset(){this.idsFlag=0}}n.RenerProcessMaxTotal=16,e.RCRPObj=n;class h extends r.default{constructor(){super(...arguments),this.m_rcpoList=[]}createNode(){let t=new n;return t.reset(),this.m_rcpoList.push(t),new a.default}restoreUid(t){this.m_rcpoList[t].reset()}testRPNodeExists(t,e){return(this.m_rcpoList[t].idsFlag&1<<e)>0}testRPNodeNotExists(t,e){return(this.m_rcpoList[t].idsFlag&1<<e)<1}setRPNodeParam(t,e,s){let i=this.m_rcpoList[t],r=1<<e;return s>-1?(i.idsFlag&r)<1&&(++i.count,i.rprocessUid=e,i.idsFlag=i.idsFlag|r):(i.idsFlag&r)>0&&(--i.count,i.idsFlag=i.idsFlag&~r),i.count}getRCRPObj(t){return this.m_rcpoList[t]}}e.RPOUnitBuilder=h},eda7:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("74ee"),r=s("7de1"),a=s("bd49");class n extends r.ResourceSchedule{constructor(){super()}createDataUnit(t,e,s=!1){a.DataUnitLock.lockStatus=207;let r=new a.TextureDataUnit;switch(r.lossTime=Date.now(),r.immediate=s,r.data=new a.TextureDataContainer,r.data.dataFormat=e,r.data.dataFormat){case i.DataFormat.Jpg:case i.DataFormat.Png:break;default:break}return r}initTask(t,e,s,i){}destroy(){super.destroy()}}e.TextureResourceSchedule=n},ee5a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.type=0,this.m_listeners=[],this.m_hosts=[],this.m_phases=[]}addListener(t,e,s){let i=this.m_hosts.length-1;for(;i>=0;--i)if(t===this.m_hosts[i])break;i<0&&(this.m_hosts.push(t),this.m_listeners.push(e),this.m_phases.push(s))}removeListener(t,e){let s=this.m_hosts.length-1;for(;s>=0;--s)if(t===this.m_hosts[s]){this.m_hosts.splice(s,1),this.m_listeners.splice(s,1),this.m_phases.splice(s,1);break}}dispatch(t){let e=0,s=this.m_hosts.length;for(let i=0;i<s;++i)(this.m_phases[i]<1||t.phase==this.m_phases[i])&&(this.m_listeners[i].call(this.m_hosts[i],t),e=1);return e}passTestEvt(t){let e=this.m_hosts.length;for(let s=0;s<e;++s)if(this.m_phases[s]<1||t.phase==this.m_phases[s])return 1;return 0}passTestPhase(t){let e=this.m_hosts.length;for(let s=0;s<e;++s)if(this.m_phases[s]<1||t==this.m_phases[s])return 1;return 0}destroy(){this.m_hosts=[],this.m_listeners=[],this.m_phases=[]}}e.default=i},efce:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("e7d2")),a=i(s("8a0a")),n=i(s("fecb")),h=i(s("cb29")),l=i(s("725b"));class o extends h.default{constructor(t=a.default.VTX_DYNAMIC_DRAW){super(t),this.m_vs=null,this.m_uvs=null,this.m_width=0,this.m_height=0,this.m_charsTotal=0,this.m_charsStr="",this.flipVerticalUV=!1,this.vtxUVEnabled=!0,this.vertColorEnabled=!1,this.alignFactorX=.5,this.alignFactorY=.5,this.fontSystem=null}getWidth(){return this.m_width}getHeight(){return this.m_height}createStrData(t){this.m_charsStr=t;let e=t.length;this.m_charsTotal=e;let s=!1,i=this.fontSystem;if(null==i&&(i=l.default.GetInstance()),e>0){i.createCharsTexFromStr(t),this.m_width=-1,this.m_height=0;let a=o.s_sizeArr,h=0,l=0,_=0,m=0,u=0;s=null!=this.m_vs&&8*e>this.m_vs.length;let d=i.getCharTable();if(s){let s=o.s_currIvs;for(s.set(o.s_initIvs,0),this.m_ivs=new Uint16Array(6*e),this.m_uvs=new Float32Array(8*e),this.m_vs=new Float32Array(8*e);h<e;++h)this.m_ivs.set(s,6*h),s[0]+=4,s[1]+=4,s[2]+=4,s[3]+=4,s[4]+=4,s[5]+=4,d.getUV8AndSizeFromChar(t.charAt(h),this.m_uvs,a,8*h),this.m_height<a[1]&&(this.m_height=a[1]),this.m_vs[8*h]=a[0],this.m_width+=a[0]}else for(null==this.m_vs&&(this.m_uvs=new Float32Array(8*e),this.m_vs=new Float32Array(8*e));h<e;++h)d.getUV8AndSizeFromChar(t.charAt(h),this.m_uvs,a,8*h),this.m_height<a[1]&&(this.m_height=a[1]),this.m_vs[8*h]=a[0],this.m_width+=a[0];let c=1;this.m_width+=e*c,m=-this.alignFactorX*this.m_width,u=-this.alignFactorY*this.m_height,_=u+this.m_height,null==this.bounds&&(this.bounds=new n.default),this.bounds.min.setXYZ(m,u,0),this.bounds.max.setXYZ(m+this.m_width,_,0);let f=0;for(h=0;h<e;++h)l=m+this.m_vs[f],this.m_vs[f]=m,this.m_vs[f+1]=u,this.m_vs[f+2]=l,this.m_vs[f+3]=u,this.m_vs[f+4]=l,this.m_vs[f+5]=_,this.m_vs[f+6]=m,this.m_vs[f+7]=_,m=l+c,f+=8;r.default.Reset(),r.default.AddFloat32Data(this.m_vs,2),r.default.AddFloat32Data(this.m_uvs,2)}s&&this.m_vbuf.setUintIVSData(this.m_ivs),this.vtCount=6*e,this.vtxTotal=4*e,this.trisNumber=2*e}initialize(t){let e=t.length,s=o.s_currIvs;s.set(o.s_initIvs,0),null==this.m_ivs&&(this.m_ivs=new Uint16Array(6*e));for(let i=0;i<e;++i)this.m_ivs.set(s,6*i),s[0]+=4,s[1]+=4,s[2]+=4,s[3]+=4,s[4]+=4,s[5]+=4;this.createStrData(t),r.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.m_vbuf=r.default.CreateBySaveData(this.getBufDataUsage()),this.m_vbuf.setUintIVSData(this.m_ivs),this.buildEnd()}updateCharStr(t){null!=this.m_vbuf&&this.m_charsStr!=t&&(this.createStrData(t),this.buildEnd(),r.default.UpdateBufData(this.m_vbuf))}__$destroy(){this.isResFree()&&(this.bounds=null,this.m_vs=null,this.m_uvs=null,super.__$destroy()),this.fontSystem=null}}o.s_initIvs=new Uint8Array([0,1,2,0,2,3]),o.s_currIvs=new Uint8Array([0,1,2,0,2,3]),o.s_sizeArr=[0,0],e.default=o},f044:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static CreateNewID(){return i.s_uid++}}i.s_uid=0,e.default=i},f0f0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("f044"));class a{constructor(t){this.m_uid=-1,this.m_total=0,this.layoutBit=0,this.m_offsetList=null,this.m_f32=null,this.m_f32Stride=0,this.m_uid=r.default.CreateNewID()}getUid(){return this.m_uid}getType(){return 0}getBuffersTotal(){return 1}getAttribsTotal(){return this.m_offsetList.length}getF32DataAt(t){return this.m_f32}setF32DataAt(t,e,s,i){null!=i&&(this.m_offsetList=i),this.m_f32Stride=s,this.m_f32=e}setData4fAt(t,e,s,i,r,a){t=this.m_f32Stride*t+this.m_offsetList[e],this.m_f32[t++]=s,this.m_f32[t++]=i,this.m_f32[t++]=r,this.m_f32[t++]=a}setData3fAt(t,e,s,i,r){t=this.m_f32Stride*t+this.m_offsetList[e],this.m_f32[t++]=s,this.m_f32[t++]=i,this.m_f32[t++]=r}setData2fAt(t,e,s,i){t=this.m_f32Stride*t+this.m_offsetList[e],this.m_f32[t++]=s,this.m_f32[t++]=i}destroy(){this.m_offsetList=null,this.m_f32=null}toString(){return"VtxCombinedBuf(uid = "+this.m_uid+")"}}e.default=a},f208:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.info=""}}e.default=i},f3a2:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["None"]="",t["Default"]="pbr",t["Lambert"]="lambert",t["PBR"]="pbr"}(i||(i={})),e.ShaderCodeUUID=i},f48d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(){this.id=-1,this.position=new r.default}update(){}updateFast(){}}a.__tV0=new r.default,a.__tV1=new r.default,a.__tV2=new r.default,e.AbsGeomBase=a,e.default=a},f689:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("6e01")),n=s("a053"),h=i(s("18c7")),l=s("0063");function o(t,e,s){return void 0===e&&(e=0),void 0===s&&(s=t.byteLength),l.LoaderUtils.decodeText(new Uint8Array(t,e,s))}function _(t){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let s=0;function i(e){const i=t[e-1];return t=t.slice(s+e),s++,i}for(let r=0;r<e.length;++r){const t=i(1);if(t===e[r])return!1}return!0}function m(t){const e=/FBXVersion: (\d+)/,s=t.match(e);if(s){const t=parseInt(s[1]);return t}throw new Error("FBXLoader: Cannot find the version number for the file given.")}e.convertArrayBufferToString=o,e.isFbxFormatASCII=_,e.getFbxVersion=m;let u=new r.default,d=new n.Euler;function c(t){const e=new h.default,s=new h.default,i=new h.default,n=new h.default,l=new h.default,o=new h.default,_=new h.default,m=new h.default,c=new h.default,f=new h.default,p=new h.default,g=new h.default;let T=a.default.DegreeToRadian;const y=t.inheritType?t.inheritType:0;if(t.translation&&e.setTranslation(u.fromArray(t.translation)),t.preRotation){const e=t.preRotation.map(T);e.push(t.eulerOrder),s.makeRotationFromEuler(d.fromArray(e))}if(t.rotation){const e=t.rotation.map(T);e.push(t.eulerOrder),i.makeRotationFromEuler(d.fromArray(e))}if(t.postRotation){const e=t.postRotation.map(T);e.push(t.eulerOrder),n.makeRotationFromEuler(d.fromArray(e)),n.invert()}t.scale&&l.setScale(u.fromArray(t.scale)),t.scalingOffset&&_.setTranslation(u.fromArray(t.scalingOffset)),t.scalingPivot&&o.setTranslation(u.fromArray(t.scalingPivot)),t.rotationOffset&&m.setTranslation(u.fromArray(t.rotationOffset)),t.rotationPivot&&c.setTranslation(u.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(p.copy(t.parentMatrix),f.copy(t.parentMatrixWorld));const E=s.clone().multiply(i).multiply(n),x=new h.default;x.extractRotation(f);const v=new h.default;v.copyTranslation(f);const S=v.clone().invertThis().multiply(f),b=x.clone().invertThis().multiply(S),A=l,R=new h.default;if(0===y)R.copy(x).multiply(E).multiply(b).multiply(A);else if(1===y)R.copy(x).multiply(b).multiply(E).multiply(A);else{let t=new r.default;p.getScale(t);const e=(new h.default).setScale(t),s=e.clone().invertThis(),i=b.clone().multiply(s);R.copy(x).multiply(E).multiply(i).multiply(A)}const M=c.clone().invertThis(),D=o.clone().invertThis();let L=e.clone().multiply(m).multiply(c).multiply(s).multiply(i).multiply(n).multiply(M).multiply(_).multiply(o).multiply(l).multiply(D);const P=(new h.default).copyTranslation(L),B=f.clone().multiply(P);return g.copyTranslation(B),L=g.clone().multiply(R),L.premultiply(f.invertThis()),L}e.generateTransform=c;const f=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];function p(t){return t=t||0,6===t?f[0]:f[t]}function g(t){const e="Kaydara FBX Binary  \0";return t.byteLength>=e.length&&e===o(t,0,e.length)}function T(t){return t/46186158e3}function y(t){const e=t.split(",").map((function(t){return parseFloat(t)}));return e}function E(t,e){for(let s=0,i=t.length,r=e.length;s<r;s++,i++)t[i]=e[s]}e.getEulerOrder=p,e.isFbxFormatBinary=g,e.convertFBXTimeToSeconds=T,e.parseNumberArray=y,e.append=E;const x=new Array(1024);function v(t,e,s,i){for(let r=s,a=0;r<i;r++,a++)t[a]=e[r];return t}function S(t,e,s,i){let r;switch(i.mappingType){case"ByPolygonVertex":r=t;break;case"ByPolygon":r=e;break;case"ByVertice":r=s;break;case"AllSame":r=i.indices[0];break;default:}"IndexToDirect"===i.referenceType&&(r=i.indices[r]);const a=r*i.dataSize,n=a+i.dataSize;return v(x,i.buffer,a,n)}e.slice=v,e.getData=S},f7ee:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("0063");class r{constructor(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(t){this.offset+=t}setOffset(t){this.offset=t}getBoolean(){return 1===(1&this.getUint8())}getBooleanArray(t){const e=new Array(t);for(let s=0;s<t;s++)e[s]=this.getBoolean();return e}getUint8(){const t=this.dv.getUint8(this.offset);return this.offset+=1,t}getInt16(){const t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}getInt32(){const t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}getInt32Array(t){const e=new Array(t);for(let s=0;s<t;s++)e[s]=this.getInt32();return e}getUint32(){const t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}getInt64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,t=4294967295&~t,4294967295===t&&(e=e+1&4294967295),t=t+1&4294967295,-(4294967296*e+t)):4294967296*e+t}getInt64Array(t){const e=new Array(t);for(let s=0;s<t;s++)e[s]=this.getInt64();return e}getUint64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t}getFloat32(){const t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}getFloat32Array(t){const e=new Array(t);for(let s=0;s<t;s++)e[s]=this.getFloat32();return e}getFloat64(){const t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}getFloat64Array(t){const e=new Array(t);for(let s=0;s<t;s++)e[s]=this.getFloat64();return e}getArrayBuffer(t){const e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}getArrayU8Buffer(t){let e=new Uint8Array(this.dv.buffer);const s=e.subarray(this.offset,this.offset+t);return this.offset+=t,s}getArrayU8BufferByOffset(t,e){let s=new Uint8Array(this.dv.buffer);return s.subarray(t,t+e)}getString(t){let e=new Array(t);for(let i=0;i<t;i++)e[i]=this.getUint8();const s=e.indexOf(0);return s>=0&&(e=e.slice(0,s)),i.LoaderUtils.decodeText(new Uint8Array(e))}}e.BinaryReader=r},f928:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=i(s("8d98")),n=i(s("ffc0")),h=i(s("1f61")),l=i(s("df25"));class o extends l.default{constructor(t,e,s=!1){super(t,e,s),this.m_type=r.TextureProxyType.Float,this.minFilter=a.default.LINEAR,this.internalFormat=n.default.RGBA16F,this.dataType=h.default.FLOAT,this.unpackAlignment=4}toAlphaFormat(){this.srcFormat=n.default.ALPHA,this.internalFormat=n.default.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=n.default.RED,this.internalFormat=n.default.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=n.default.RGB,this.internalFormat=n.default.RGB16F,this.unpackAlignment=1}toRGBAFormat(){this.srcFormat=n.default.RGBA,this.internalFormat=n.default.RGBA,this.unpackAlignment=4}toRGBAFloatFormat(){this.srcFormat=n.default.RGBA,this.internalFormat=n.default.RGBA16F,this.unpackAlignment=4}setDataFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,n=!1){super.setDataFromBytes(t,e,s,i,r,a,n)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[FloatTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=o},fa60:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("919c"));class a extends r.default{constructor(){super(),this.vao=null,this.m_uid=a.s_uid++}run(){this.m_rc.testVROUid(this.m_uid)&&(this.m_rc.bindVertexArray(this.vao),(this.m_rc.testRIOUid(this.m_vtxUid)||r.default.s_mid!=this.m_mid)&&(r.default.s_mid=this.m_mid,this.m_rc.bindEleBuf(this.ibuf)))}__$destroy(){r.default.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.ibuf=null,this.vao=null,this.m_rc=null}restoreThis(){null!=this.vao&&this.m_rc.deleteVertexArray(this.vao),a.Restore(this)}toString(){return"VaoVertexRenderObj(uid = "+this.m_uid+", type="+this.m_mid+")"}static HasMid(t){return r.default.s_midMap.has(t)}static GetByMid(t){return r.default.s_midMap.get(t)}static GetFreeId(){return a.s_freeIdList.length>0?a.s_freeIdList.pop():-1}static Create(t,e,s){let i=null,n=a.GetFreeId();return n>=0?(i=a.s_unitList[n],a.s_unitFlagList[n]=a.s_FLAG_BUSY,i.setMidAndBufUid(e,s)):(i=new a,i.setMidAndBufUid(e,s),a.s_unitList.push(i),a.s_unitFlagList.push(a.s_FLAG_BUSY),a.s_unitListLen++),i.setRC(t),r.default.s_midMap.set(e,i),i}static Restore(t){if(null!=t&&t.m_attachCount<1&&a.s_unitFlagList[t.getUid()]==a.s_FLAG_BUSY){let e=t.getUid();a.s_freeIdList.push(e),a.s_unitFlagList[e]=a.s_FLAG_FREE,t.__$destroy()}}}a.s_uid=0,a.s_FLAG_BUSY=1,a.s_FLAG_FREE=0,a.s_unitFlagList=[],a.s_unitListLen=0,a.s_unitList=[],a.s_freeIdList=[],e.default=a},faa5:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("f3a2"),a=i(s("4a54")),n=s("5216"),h=s("3113"),l=s("4efa");class o{constructor(){this.m_coder=null,this.m_shaderCodeObj=null,this.m_texList=null,this.m_texEnabled=!0,this.pipeline=null,this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.shadowReceiveEnabled=!1,this.lightEnabled=!1,this.fogEnabled=!1,this.envAmbientLightEnabled=!1,this.brightnessOverlayEnabeld=!1,this.glossinessEnabeld=!0,this.pipeTypes=null,this.keysString="",this.adaptationShaderVersion=!0,null==o.s_coder&&(o.s_uniform=new h.ShaderCodeUniform,o.s_coder=new a.default(o.s_uniform),o.s_uniform.__$setCodeBuilder(o.s_coder),o.s_texBulder=new l.ShaderTextureBuilder(o.s_coder))}reset(){this.m_coder=o.s_coder,this.m_uniform=o.s_uniform,this.m_texBulder=o.s_texBulder,this.m_texture=this.m_uniform,this.m_coder.reset(),this.m_texList=null,this.pipeTypes=null,this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.shadowReceiveEnabled=!1,this.lightEnabled=!1,this.fogEnabled=!1,this.envAmbientLightEnabled=!1,this.brightnessOverlayEnabeld=!1,this.glossinessEnabeld=!0,this.keysString=""}clear(){this.m_coder=null}setShaderCodeObject(t){this.m_shaderCodeObj=t}getShaderCodeObject(){return this.m_shaderCodeObj}getShaderCodeObjectUUID(){return r.ShaderCodeUUID.None}getShaderCodeBuilder(){return o.s_coder}static GetPreCompileInfo(){return o.s_coder.getPreCompileInfo()}initialize(t){this.m_texEnabled=t,this.bufInitWithPipeline()}buildDefine(){this.premultiplyAlpha&&(this.m_coder.addDefine("VOX_PREMULTIPLY_ALPHA"),this.keysString+="A"),this.vertColorEnabled&&(this.m_coder.addDefine("VOX_USE_VTX_COLOR"),this.keysString+="UVC"),this.brightnessOverlayEnabeld&&(this.m_coder.addDefine("VOX_USE_BRIGHTNESS_OVERLAY_COLOR"),this.keysString+="UBOC"),this.glossinessEnabeld&&(this.m_coder.addDefine("VOX_USE_GLOSSINESS"),this.keysString+="UG")}buildPipelineParams(){if(null!=this.pipeline){null==this.pipeTypes&&(this.pipeTypes=[]);let t=n.MaterialPipeType;this.lightEnabled&&!this.pipeTypes.includes(t.GLOBAL_LIGHT)&&this.pipeTypes.push(t.GLOBAL_LIGHT),this.shadowReceiveEnabled&&!this.pipeTypes.includes(t.VSM_SHADOW)&&this.pipeTypes.push(t.VSM_SHADOW),this.fogEnabled&&!this.pipeTypes.includes(t.FOG_EXP2)&&this.pipeTypes.push(t.FOG_EXP2),this.envAmbientLightEnabled&&!this.pipeTypes.includes(t.ENV_AMBIENT_LIGHT)&&this.pipeTypes.push(t.ENV_AMBIENT_LIGHT)}}getTexturesFromPipeline(t){null!=this.pipeline&&this.pipeline.getTextures(this.m_coder,t,this.pipeTypes)}bufInitWithPipeline(){null!=this.pipeline&&(this.buildPipelineParams(),this.pipeline.buildSharedUniforms(this.pipeTypes),this.pipeline.createKeys(this.pipeTypes),this.keysString+=this.pipeline.getKeysString())}isTexEanbled(){return this.m_texEnabled}setIRenderTextureList(t){this.m_texList=t}getIRenderTextureList(){return this.m_texList}buildShader(){}getFragShaderCode(){return this.m_coder.buildFragCode()}getVertShaderCode(){return this.m_coder.buildVertCode()}getUniqueShaderName(){throw Error("Illgel operation !!!")}toString(){return"[ShaderCodeBuffer()]"}}e.default=o},fae3:function(t,e,s){"use strict";s.r(e);s("1eb2");var i=s("a176");for(var r in i)["default"].indexOf(r)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(r)},fbd5:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("fecb")),n=i(s("18c7"));class h{constructor(){this.m_scaleV=new r.default,this.m_tempMat=new n.default,this.m_currMat=new n.default,this.m_aabb=new a.default}getAABB(){return this.m_aabb}calcAABB(t,e){this.m_tempMat,this.m_currMat;let s=this.m_aabb;for(let i=0;i<t.length;++i)t[i].update(),i>0?s.union(t[i].getGlobalBounds()):s.copyFrom(t[i].getGlobalBounds());return s.update(),s}fixToPosition(t,e,s,i=300){let a,n=this.m_tempMat,h=this.m_currMat,l=this.m_aabb;for(let r=0;r<t.length;++r)a=e[r],n.identity(),n.setRotationEulerAngle(.5*Math.PI,0,0),null!=a?(h.copyFrom(a),h.append(n),t[r].getTransform().setParentMatrix(h)):(h.copy(n),t[r].getTransform().setParentMatrix(h)),t[r].update(),r>0?l.union(t[r].getGlobalBounds()):l.copyFrom(t[r].getGlobalBounds());l.update();let o=i/l.getWidth(),_=i/l.getHeight(),m=i/l.getLong();o=Math.min(o,_,m),this.m_scaleV.setXYZ(o,o,o);let u=l.center,d=new r.default(s.x-u.x,s.y-u.y,s.z-u.z);d.scaleBy(o);for(let r=0;r<t.length;++r)a=e[r],n.identity(),n.setScale(this.m_scaleV),n.setRotationEulerAngle(.5*Math.PI,0,0),n.setTranslation(d),null!=a?(h.copyFrom(a),h.append(n),t[r].getTransform().setParentMatrix(h)):(h.copy(n),t[r].getTransform().setParentMatrix(h)),t[r].update(),r>0?l.union(t[r].getGlobalBounds()):l.copyFrom(t[r].getGlobalBounds());l.update()}}e.EntityLayout=h},fc07:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("2e8a")),n=i(s("78e9"));class h{constructor(){this.m_texNSMap=new Map,this.attriNSList=null,this.attriSizeList=null,this.uniformNameListStr="",this.texUniformNameListStr="",this.attributes=[null,null,null,null,null,null,null,null,null,null,null,null],this.uniforms=null,this.texTotal=0,this.fragOutputTotal=0}reset(){this.attriNSList=null,this.uniformNameListStr="",this.texUniformNameListStr="";let t=0;for(;t<12;++t)this.attributes[t]=null;this.uniforms=null,this.m_texNSMap.clear(),this.texTotal=0}parseVShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let s="\n",i=t.indexOf(s),r=0,h=[],l="",o="",_=new RegExp(" ","g");while(i>=0)l=t.slice(r,i),l.length>0&&(o=l.replace(_,""),0!=o.indexOf("//")&&h.push(l)),r=i+1,i=t.indexOf(s,r);l=t.slice(r,t.length),l.length>0&&(o=l.replace(_,""),0!=o.indexOf("//")&&h.push(l));let m="uniform ",u=h.length,d=null;for(i=0;i<12;++i)this.attributes[i]=null;this.attriNSList=[],this.attriSizeList=[];let c=null;null==this.uniforms&&(this.uniforms=[]),i=0;let f=!1,p=!1;while(i<u)l=h[i],f=l.indexOf("layout")>=0,p=l.indexOf("attribute ")>=0,f&&l.indexOf("location")>0||p?(d=new a.default,d.layoutEnabled=f,d.parseCode(l),this.attributes[d.attriType]=d,this.attriNSList.push(d.name),this.attriSizeList.push(d.typeSize)):l.indexOf(m)>=0&&(c=new n.default,c.parseCode(l)&&(this.uniforms.push(c),this.uniformNameListStr+=c.name+",",c.isTex&&!this.m_texNSMap.has(c.name)&&(this.m_texNSMap.set(c.name,1),this.texUniformNameListStr+=c.name+",",this.texTotal++))),++i}parseFShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let s="\n",i=t.indexOf(s),a=0,h=[],l="",o="",_=new RegExp(" ","g");while(i>=0)l=t.slice(a,i),l.length>0&&(o=l.replace(_,""),0!=o.indexOf("//")&&h.push(l)),a=i+1,i=t.indexOf(s,a);l=t.slice(a,t.length),l.length>0&&(o=o.replace(_,""),0!=o.indexOf("//")&&h.push(l));let m="uniform ",u=h.length,d=null;null==this.uniforms&&(this.uniforms=[]),i=0;while(i<u)l=h[i],l.indexOf(m)>=0&&this.uniformNameListStr.indexOf(m)<0&&(d=new n.default,d.parseCode(l)&&(this.uniforms.push(d),this.uniformNameListStr+=d.name+",",d.isTex&&!this.m_texNSMap.has(d.name)&&(this.m_texNSMap.set(d.name,1),this.texUniformNameListStr+=d.name+",",this.texTotal++))),++i;let c="layout";r.default.IsWebGL1()&&(c="gl_FragData"),i=t.indexOf(c),this.fragOutputTotal=0;while(i>0)this.fragOutputTotal++,i=t.indexOf(c,i+2);this.fragOutputTotal<1&&(this.fragOutputTotal=1)}}e.default=h},fce7:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.MAX_TASKS_TOTAL=1024,e.ThreadConfigure=i},fe7f:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("7918"),a=i(s("ffc0")),n=i(s("df25"));class h extends n.default{constructor(t,e,s=!1){super(t,e,s),this.m_type=r.TextureProxyType.Bytes}toAlphaFormat(){this.srcFormat=a.default.ALPHA,this.internalFormat=a.default.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=a.default.RED,this.internalFormat=a.default.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=a.default.RGB,this.internalFormat=a.default.RGB,this.unpackAlignment=3}toRGBAFormat(){this.srcFormat=a.default.RGBA,this.internalFormat=a.default.RGBA,this.unpackAlignment=4}setDataFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,n=!1){super.setDataFromBytes(t,e,s,i,r,a,n)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[BytesTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=h},fecb:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17"));class n{constructor(){this.min=new a.default,this.max=new a.default,this.version=-1,this.radius=50,this.radius2=2500,this.center=new a.default(0,0,0),this.m_long=100,this.m_width=100,this.m_height=100,this.m_halfLong=50,this.m_halfWidth=50,this.m_halfHeight=50,this.m_tempV=new a.default,this.reset()}getLong(){return this.m_long}getWidth(){return this.m_width}getHeight(){return this.m_height}reset(){let t=this.min;t.x=t.y=t.z=r.default.MATH_MAX_POSITIVE,t=this.max,t.x=t.y=t.z=r.default.MATH_MIN_NEGATIVE}equals(t){return this.min.equalsXYZ(t.min)&&this.max.equalsXYZ(t.max)}setVolume(t,e,s){this.m_width=t,this.m_height=e,this.m_long=s,this.m_halfLong=.5*this.m_long,this.m_halfWidth=.5*this.m_width,this.m_halfHeight=.5*this.m_height,this.max.x=this.center.x+this.m_halfWidth,this.max.y=this.center.y+this.m_halfHeight,this.max.z=this.center.z+this.m_halfLong,this.min.x=this.center.x-this.m_halfWidth,this.min.y=this.center.y-this.m_halfHeight,this.min.z=this.center.z-this.m_halfLong,this.radius2=this.m_halfWidth*this.m_halfWidth+this.m_halfHeight*this.m_halfHeight+this.m_halfLong*this.m_halfLong,this.radius=Math.sqrt(this.radius2)}union(t){this.addPosition(t.min),this.addPosition(t.max)}addPosition(t){this.min.x>t.x&&(this.min.x=t.x),this.min.y>t.y&&(this.min.y=t.y),this.min.z>t.z&&(this.min.z=t.z),this.max.x<t.x&&(this.max.x=t.x),this.max.y<t.y&&(this.max.y=t.y),this.max.z<t.z&&(this.max.z=t.z)}addXYZ(t,e,s){this.min.x>t&&(this.min.x=t),this.min.y>e&&(this.min.y=e),this.min.z>s&&(this.min.z=s),this.max.x<t&&(this.max.x=t),this.max.y<e&&(this.max.y=e),this.max.z<s&&(this.max.z=s)}addXYZFloat32Arr(t,e=3){let s=t.length,i=0,r=0,a=0;for(let n=0;n<s;)i=t[n],r=t[n+1],a=t[n+2],n+=e,this.min.x>i&&(this.min.x=i),this.min.y>r&&(this.min.y=r),this.min.z>a&&(this.min.z=a),this.max.x<i&&(this.max.x=i),this.max.y<r&&(this.max.y=r),this.max.z<a&&(this.max.z=a)}addXYZFloat32AndIndicesArr(t,e){let s,i=e.length,r=0,a=0,n=0;for(let h=0;h<i;h++)s=3*h,r=t[s++],a=t[s++],n=t[s],this.min.x>r&&(this.min.x=r),this.min.y>a&&(this.min.y=a),this.min.z>n&&(this.min.z=n),this.max.x<r&&(this.max.x=r),this.max.y<a&&(this.max.y=a),this.max.z<n&&(this.max.z=n)}getClosePosition(t,e,s=0){e.copyFrom(t),e.x<this.min.x?e.x=this.min.x+s:e.x>this.max.x&&(e.x=this.max.x-s),e.y<this.min.y?e.y=this.min.y+s:e.y>this.max.y&&(e.y=this.max.y-s),e.z<this.min.z?e.z=this.min.z+s:e.z>this.max.z&&(e.z=this.max.z-s)}containsV(t){return!(t.x<this.max.x||t.x>this.max.x)&&(!(t.y<this.max.y||t.y>this.max.y)&&!(t.z<this.max.z||t.z>this.max.z))}containsXY(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.y||e>this.max.y)}containsXZ(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.z||e>this.max.z)}containsYZ(t,e){return!(t<this.min.y||t>this.max.y)&&!(e<this.min.z||e>this.max.z)}copyFrom(t){this.radius=t.radius,this.radius2=t.radius2,this.min.copyFrom(t.min),this.max.copyFrom(t.max),this.center.copyFrom(t.center),this.updateVolume()}expand(t){this.min.subtractBy(t),this.max.addBy(t)}updateVolume(){this.m_width=this.max.x-this.min.x,this.m_height=this.max.y-this.min.y,this.m_long=this.max.z-this.min.z,this.m_halfLong=.5*this.m_long,this.m_halfWidth=.5*this.m_width,this.m_halfHeight=.5*this.m_height,++this.version}updateThis(){this.center.x=.5*this.m_width,this.center.y=.5*this.m_height,this.center.z=.5*this.m_long,this.m_halfLong=this.center.z,this.m_halfWidth=this.center.x,this.m_halfHeight=this.center.y,this.radius2=this.m_halfWidth*this.m_halfWidth+this.m_halfHeight*this.m_halfHeight+this.m_halfLong*this.m_halfLong,this.radius=Math.sqrt(this.radius2),this.center.addBy(this.min),++this.version}update(){this.m_width=this.max.x,this.min.x>this.max.x&&(this.max.x=this.min.x,this.min.x=this.m_width),this.m_width=this.max.x-this.min.x,this.m_height=this.max.y,this.min.y>this.max.y&&(this.max.y=this.min.y,this.min.y=this.m_height),this.m_height=this.max.y-this.min.y,this.m_long=this.max.z,this.min.z>this.max.z&&(this.max.z=this.min.z,this.min.z=this.m_long),this.m_long=this.max.z-this.min.z,this.updateThis()}updateFast(){this.m_width=this.max.x-this.min.x,this.m_height=this.max.y-this.min.y,this.m_long=this.max.z-this.min.z,this.updateThis()}toString(){return"[AABB(min->"+this.min+",size("+this.m_width+","+this.m_height+","+this.m_long+"))]"}sphereIntersect(t,e){this.m_tempV.x=this.center.x-t.x,this.m_tempV.y=this.center.y-t.y,this.m_tempV.z=this.center.z-t.z;let s=this.m_tempV.getLengthSquared();return s<this.radius2||(e+=this.radius,e*=e,e>=s)}}e.default=n},ffc0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73"));class a{static ToGL(t,e){switch(e){case a.RGBA:break;case a.R8:return t.R8;case a.RGB:return t.RGB;case a.RGB8:return t.RGB8;case a.RGBA8:return t.RGBA8;case a.ALPHA:return t.ALPHA;case a.RGB16F:return r.default.IsWebGL2()?t.RGB16F:t.RGB;case a.RGBA16F:return r.default.IsWebGL2()?t.RGBA16F:t.RGBA;case a.RGB32F:return r.default.IsWebGL2()&&t.RGB32F,t.RGB;case a.RGBA32F:return r.default.IsWebGL2()&&t.RGBA32F,t.RGBA;case a.RED:return t.RED;case a.DEPTH_COMPONENT:return t.DEPTH_COMPONENT;case a.DEPTH_STENCIL:return t.DEPTH_STENCIL;default:break}return t.RGBA}}a.R8=101,a.RGB=110,a.RED=111,a.RGBA=121,a.RGB8=122,a.RGBA8=123,a.ALPHA=132,a.RGB16F=331,a.RGBA16F=332,a.RGB32F=341,a.RGBA32F=342,a.DEPTH_COMPONENT=351,a.DEPTH_STENCIL=352,e.default=a}})}));