(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["Test"]=e():t["Test"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s="fae3")}({"0236":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("a996"),r=s("1710"),a=s("7045"),h=s("3024"),n=s("badb");class l{constructor(t,e){this.m_rcuid=0,this.pixelRatio=1,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.m_viewX=0,this.m_viewY=0,this.m_viewW=1,this.m_viewH=1,this.m_mouseEvtDispatcher=new n.default,this.m_resize_listener=[],this.m_resize_ers=[],this.m_keyDown_listener=[],this.m_keyDown_ers=[],this.m_keyUp_listener=[],this.m_keyUp_ers=[],this.uProbe=null,this.m_preStageWidth=0,this.m_preStageHeight=0,this.m_mouseEvt=new r.default,this.m_autoSynViewAndStageSize=!0,this.m_rcuid=t}getRCUid(){return this.m_rcuid}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.m_viewX}getViewY(){return this.m_viewY}getViewWidth(){return this.m_viewW}getViewHeight(){return this.m_viewH}setViewPort(t,e,s,i){this.m_autoSynViewAndStageSize=!1,this.m_viewX=t,this.m_viewY=e,s==this.m_viewW&&i==this.m_viewH||(this.m_viewW=s,this.m_viewH=i,this.updateViewUData())}updateViewUData(){null==this.uProbe&&(this.uProbe=new h.default(1),this.uProbe.bindSlotAt(this.m_rcuid)),this.uProbe.setVec4Data(2/(this.m_viewW*this.pixelRatio),2/(this.m_viewH*this.pixelRatio),this.m_viewW*this.pixelRatio,this.m_viewH*this.pixelRatio),this.uProbe.update(),this.m_preStageWidth=this.m_viewW,this.m_preStageHeight=this.m_viewH}update(){this.m_preStageWidth==this.stageWidth&&this.m_preStageHeight==this.stageHeight||(this.m_autoSynViewAndStageSize&&(this.m_viewW=this.stageWidth,this.m_viewH=this.stageHeight,this.updateViewUData()),this.stageHalfWidth=.5*this.stageWidth,this.stageHalfHeight=.5*this.stageHeight)}mouseDown(t=1){this.m_mouseEvt.type=r.default.MOUSE_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseUp(t=1){this.m_mouseEvt.phase=1,this.m_mouseEvt.type=r.default.MOUSE_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseClick(){this.m_mouseEvt.type=r.default.MOUSE_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseDoubleClick(){this.m_mouseEvt.type=r.default.MOUSE_DOUBLE_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightDown(){this.m_mouseEvt.type=r.default.MOUSE_RIGHT_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightUp(){this.m_mouseEvt.type=r.default.MOUSE_RIGHT_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseBgDown(){this.m_mouseEvt.type=r.default.MOUSE_BG_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseBgUp(){this.m_mouseEvt.type=r.default.MOUSE_BG_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightClick(){this.m_mouseEvt.type=r.default.MOUSE_RIGHT_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMove(){this.m_mouseEvt.type=r.default.MOUSE_MOVE,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseWheel(t){this.m_mouseEvt.type=r.default.MOUSE_WHEEL,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.wheelDeltaY=t.wheelDeltaY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseCancel(){this.m_mouseEvt.type=r.default.MOUSE_CANCEL,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiDown(t){this.m_mouseEvt.type=r.default.MOUSE_MULTI_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiUp(t){this.m_mouseEvt.type=r.default.MOUSE_MULTI_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiMove(t){this.m_mouseEvt.type=r.default.MOUSE_MULTI_MOVE,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}addEventListener(t,e,s,r=!0,h=!0){if(null!=s&&null!=e){switch(t){case i.default.RESIZE:console.warn("addEventListener EventBase.RESIZE invalid operation.");break;case a.default.KEY_DOWN:console.warn("addEventListener KeyboardEvent.KEY_DOWN invalid operation.");break;case a.default.KEY_UP:console.warn("addEventListener KeyboardEvent.KEY_UP invalid operation.");break;default:this.m_mouseEvtDispatcher.addEventListener(t,e,s,r,h);break}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let r=0;switch(t){case i.default.RESIZE:for(r=this.m_resize_listener.length-1;r>=0;--r)if(e===this.m_resize_ers[r]){this.m_resize_ers.splice(r,1),this.m_resize_listener.splice(r,1);break}break;case a.default.KEY_DOWN:for(r=this.m_keyDown_listener.length-1;r>=0;--r)if(e===this.m_keyDown_ers[r]){this.m_keyDown_ers.splice(r,1),this.m_keyDown_listener.splice(r,1);break}break;case a.default.KEY_UP:for(r=this.m_keyUp_listener.length-1;r>=0;--r)if(e===this.m_keyUp_ers[r]){this.m_keyUp_ers.splice(r,1),this.m_keyUp_listener.splice(r,1);break}break;default:this.m_mouseEvtDispatcher.removeEventListener(t,e,s);break}}}}e.default=l},"030e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Initialize(t,e){let s=this;1==t?(s.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),null!=s.WEBGL_draw_buffers?console.log("Use WEBGL_draw_buffers Extension success!"):console.log("WEBGL_draw_buffers Extension can not support!"),s.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),null!=s.OES_vertex_array_object?console.log("Use OES_vertex_array_object Extension success!"):console.log("OES_vertex_array_object Extension can not support!"),s.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),null!=s.ANGLE_instanced_arrays?console.log("Use ANGLE_instanced_arrays Extension success!"):console.log("ANGLE_instanced_arrays Extension can not support!"),s.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),null!=s.EXT_color_buffer_float?console.log("Use EXT_color_buffer_float Extension success!"):console.log("EXT_color_buffer_float Extension can not support!"),s.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),null!=s.EXT_color_buffer_half_float?console.log("Use EXT_color_buffer_half_float Extension success!"):console.log("EXT_color_buffer_half_float Extension can not support!"),s.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),null!=s.OES_texture_half_float_linear?console.log("Use OES_texture_half_float_linear Extension success!"):console.log("OES_texture_half_float_linear Extension can not support!"),s.OES_texture_float=e.getExtension("OES_texture_float"),null!=s.OES_texture_float?console.log("Use OES_texture_float Extension success!"):console.log("OES_texture_float Extension can not support!"),s.OES_element_index_uint=e.getExtension("OES_element_index_uint"),null!=s.OES_element_index_uint?console.log("Use OES_element_index_uint Extension success!"):console.log("OES_element_index_uint Extension can not support!"),s.EXT_blend_minmax=e.getExtension("EXT_blend_minmax"),null!=s.EXT_blend_minmax?console.log("Use EXT_blend_minmax Extension success!"):console.log("EXT_blend_minmax Extension can not support!")):(s.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),null!=s.EXT_color_buffer_half_float?console.log("Use EXT_color_buffer_half_float Extension success!"):console.log("EXT_color_buffer_half_float Extension can not support!"),s.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),null!=s.OES_texture_half_float_linear?console.log("Use OES_texture_half_float_linear Extension success!"):console.log("OES_texture_half_float_linear Extension can not support!"),s.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),null!=s.EXT_color_buffer_float?console.log("Use EXT_color_buffer_float Extension success!"):console.log("EXT_color_buffer_float Extension can not support!")),null!=s.OES_texture_float_linear?console.log("Use OES_texture_float_linear Extension success!"):console.log("OES_texture_float_linear Extension can not support!"),s.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),null!=s.WEBGL_depth_texture?console.log("Use WEBGL_depth_texture Extension success!"):console.log("WEBGL_depth_texture Extension can not support!"),s.WEBGL_debug_renderer_info=e.getExtension("WEBGL_debug_renderer_info"),null!=s.WEBGL_debug_renderer_info?console.log("Use WEBGL_debug_renderer_info Extension success!"):console.log("WEBGL_debug_renderer_info Extension can not support!")}}i.WEBGL_draw_buffers=null,i.OES_vertex_array_object=null,i.ANGLE_instanced_arrays=null,i.EXT_color_buffer_float=null,i.EXT_color_buffer_half_float=null,i.OES_texture_float_linear=null,i.OES_texture_half_float_linear=null,i.OES_texture_float=null,i.OES_element_index_uint=null,i.EXT_blend_minmax=null,i.WEBGL_depth_texture=null,i.WEBGL_debug_renderer_info=null,e.default=i},"0644":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("6e01"),r=s("8e17"),a=s("2139");class h{constructor(){this.m_matrix=a.default.GetMatrix(),this.m_position=new r.default,this.m_direction=new r.default,this.m_angle=0,this.m_updateEnabled=!1,this.m_camera=null}destroy(){this.m_camera=null}bindCamera(t){this.m_camera=t,null!=t&&(this.m_direction.copyFrom(this.m_camera.getPosition()),this.m_direction.subtractBy(this.m_camera.getLookAtPosition()))}update(){null!=this.m_camera&&this.m_updateEnabled&&(this.m_updateEnabled=!1)}rotationOffsetAngleWorldY(t){this.m_angle=t,this.m_updateEnabled=!0,this.m_direction.copyFrom(this.m_camera.getPosition()),this.m_direction.subtractBy(this.m_camera.getLookAtPosition()),this.m_matrix.identity(),this.m_matrix.appendRotationY(this.m_angle*i.default.MATH_PI_OVER_180),this.m_position.copyFrom(this.m_direction),this.m_matrix.transformVectorSelf(this.m_position),this.m_position.addBy(this.m_camera.getLookAtPosition()),this.m_camera.setPosition(this.m_position)}rotationOffsetAngleWordX(t){this.m_angle=t,this.m_updateEnabled=!0,this.m_direction.copyFrom(this.m_camera.getPosition()),this.m_direction.subtractBy(this.m_camera.getLookAtPosition()),this.m_matrix.identity(),this.m_matrix.appendRotationX(this.m_angle*i.default.MATH_PI_OVER_180),this.m_position.copyFrom(this.m_direction),this.m_matrix.transformVectorSelf(this.m_position),this.m_position.addBy(this.m_camera.getLookAtPosition()),this.m_camera.setPosition(this.m_position)}rotationOffsetAngleWordZ(t){this.m_angle=t,this.m_updateEnabled=!0,this.m_direction.copyFrom(this.m_camera.getPosition()),this.m_direction.subtractBy(this.m_camera.getLookAtPosition()),this.m_matrix.identity(),this.m_matrix.appendRotationZ(this.m_angle*i.default.MATH_PI_OVER_180),this.m_position.copyFrom(this.m_direction),this.m_matrix.transformVectorSelf(this.m_position),this.m_position.addBy(this.m_camera.getLookAtPosition()),this.m_camera.setPosition(this.m_position)}}e.default=h},"0851":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98"),r=s("6e01"),a=s("da6a");class h{constructor(t,e,s=!1){this.m_uid=-1,this.m_attachCount=0,this.m_renderProxy=null,this.m_slot=null,this.m_miplevel=-1,this.m_texWidth=128,this.m_texHeight=128,this.m_texBufW=128,this.m_texBufH=128,this.m_texTarget=i.TextureTarget.TEXTURE_2D,this.m_sampler=-1,this.m_haveRData=!1,this.m_type=i.TextureProxyType.Default,this.m_generateMipmap=!0,this.name="TextureProxy",this.internalFormat=i.TextureFormat.RGBA,this.srcFormat=i.TextureFormat.RGBA,this.dataType=i.TextureDataType.UNSIGNED_BYTE,this.wrap_s=i.TextureConst.WRAP_CLAMP_TO_EDGE,this.wrap_t=i.TextureConst.WRAP_CLAMP_TO_EDGE,this.wrap_r=i.TextureConst.WRAP_CLAMP_TO_EDGE,this.mipmapEnabled=!1,this.flipY=!1,this.premultiplyAlpha=!1,this.unpackAlignment=4,this.minFilter=i.TextureConst.LINEAR_MIPMAP_LINEAR,this.magFilter=i.TextureConst.LINEAR,this.version=0,this.m_slot=a.default.GetInstance(),this.m_uid=this.m_slot.getFreeUid(),t<1&&(t=128),e<1&&(e=128),s?(this.m_texWidth=r.default.CalcNearestCeilPow2(t),this.m_texHeight=r.default.CalcNearestCeilPow2(e)):(this.m_texWidth=t,this.m_texHeight=e),this.m_slot.__$$addTexture(this)}__$$use(t){t.bindToGpu(this.getResUid())}__$setRenderProxy(t){null!=this.m_slot||(this.m_slot=a.default.GetInstance(),this.m_uid=this.m_slot.getFreeUid(),this.m_slot.__$$addTexture(this)),this.m_renderProxy=t}__$attachThis(){-1==this.m_attachCount&&(this.m_slot.removeFreeUid(this.getUid()),this.m_attachCount=0),++this.m_attachCount}__$detachThis(){this.m_attachCount>0&&(--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=-1,this.m_slot.addFreeUid(this.getUid())))}getAttachCount(){return this.m_attachCount}isDirect(){return!0}getType(){return this.m_type}getResUid(){return this.m_uid}getUid(){return this.m_uid}setWrap(t){this.wrap_s=this.wrap_t=this.wrap_r=t}isGpuEnabled(){return null!=this.m_renderProxy&&this.m_renderProxy.Texture.hasResUid(this.getResUid())}getSampler(){return this.m_sampler}getTargetType(){return this.m_texTarget}getBufWidth(){return this.m_texBufW}getBufHeight(){return this.m_texBufH}getWidth(){return this.m_texWidth}getHeight(){return this.m_texHeight}isDataEnough(){return this.m_haveRData}__$buildParam(t){this.m_texBufW=this.m_texWidth,this.m_texBufH=this.m_texHeight,t.texParameteri(this.m_sampler,t.TEXTURE_WRAP_S,i.TextureConst.GetConst(t,this.wrap_s)),t.texParameteri(this.m_sampler,t.TEXTURE_WRAP_T,i.TextureConst.GetConst(t,this.wrap_t)),t.texParameteri(this.m_sampler,t.TEXTURE_MIN_FILTER,i.TextureConst.GetConst(t,this.minFilter)),t.texParameteri(this.m_sampler,t.TEXTURE_MAG_FILTER,i.TextureConst.GetConst(t,this.magFilter)),this.mipmapEnabled&&r.default.IsPowerOf2(this.m_texWidth)&&r.default.IsPowerOf2(this.m_texHeight)&&(this.m_texTarget==i.TextureTarget.TEXTURE_3D&&t.texParameteri(this.m_sampler,t.TEXTURE_WRAP_R,i.TextureConst.GetConst(t,this.wrap_r)),this.m_generateMipmap&&t.generateMipmap(this.m_sampler)),this.m_texTarget==i.TextureTarget.TEXTURE_3D&&(t.texParameteri(t.TEXTURE_3D,t.TEXTURE_BASE_LEVEL,0),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MAX_LEVEL,Math.log2(this.m_texWidth)))}uploadData(t){}__$updateToGpu(t){}updateDataToGpu(t=null,e=!0){null!=t&&(this.m_renderProxy=t),null!=this.m_renderProxy&&this.m_renderProxy.MaterialUpdater.updateTextureData(this,e)}createTexBuf(t){return!t.hasResUid(this.getResUid())&&(this.m_sampler=i.TextureTarget.GetValue(t.getRC(),this.m_texTarget),t.createResByParams3(this.getResUid(),this.getWidth(),this.getHeight(),this.m_sampler),!0)}__$$upload(t){if(this.m_haveRData&&null!=this.m_slot){let e=this.createTexBuf(t);e&&(this.__$updateToGpuBegin(t),this.uploadData(t),this.__$buildParam(t.getRC()),this.m_generateMipmap=!0)}}dataUploadToGpu(t,e,s,r=!1){this.version=0;let a=i.TextureFormat.ToGL(t,this.internalFormat),h=i.TextureFormat.ToGL(t,this.srcFormat),n=i.TextureDataType.ToGL(t,this.dataType),l=e;if(null==s)(l.status>-1||r)&&l.updateToGpu(t,this.m_sampler,a,h,n,r);else{let e=s;for(let s=0,i=e.length;s<i;++s)l=e[s],null!=l&&(l.status>-1||r)&&l.updateToGpu(t,this.m_sampler,a,h,n,r);this.m_generateMipmap=!1}}__$updateToGpuBegin(t){let e=t.getRC();t.bindToGpu(this.getResUid()),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,this.unpackAlignment)}__$updateToGpuEnd(t){}isDestroyed(){return this.m_attachCount<-1}__$destroy(){this.getAttachCount()<1&&(this.m_attachCount=-2,this.m_haveRData=!1,this.m_texWidth=1,this.m_texHeight=1,this.m_renderProxy=null)}__$$removeFromSlot(){null!=this.m_slot&&-2==this.getAttachCount()&&(this.m_slot=null,this.m_renderProxy=null,this.m_uid=-1)}toString(){return"[TextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.TextureProxy=h,e.default=h},"090c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("3bda"),r=s("030e"),a=s("352a"),h=s("b0ef"),n=s("3930"),l=s("29ef"),_=s("0c85");class o{constructor(){this.m_uid=o.s_uid++,this.m_rState=null,this.m_mouseEvtDisplather=new _.default,this.m_div=null,this.m_canvas=null,this.m_document=null,this.m_scissorEnabled=!1,this.m_depthTestEnabled=!0,this.m_stencilTestEnabled=!0,this.m_offcanvas=null,this.m_gl=null,this.m_stage=null,this.m_viewX=0,this.m_viewY=0,this.m_viewWidth=800,this.m_viewHeight=600,this.m_maxWebGLVersion=2,this.m_webGLVersion=2,this.m_devicePixelRatio=1,this.m_viewEle=new h.default,this.bgColor=new n.default,this.autoSyncRenderBufferAndWindowSize=!0,this.offscreenRenderEnabled=!1,this.m_WEBGL_lose_context=null,this.m_displayWidth=0,this.m_displayHeight=0,this.m_rcanvasWidth=0,this.m_rcanvasHeight=0,this.m_resizeCallback=null,this.m_resizeCallbackTarget=null}contextrestoredHandler(t){console.log("webglcontextrestored...!!!"),console.log(t)}contextlostHandler(t){console.log("webglcontextlost...!!!"),console.log(t)}setWebGLMaxVersion(t){1!=t&&2!=t||(this.m_maxWebGLVersion=t)}getWebGLVersion(){return this.m_webGLVersion}getDiv(){return this.m_div}setDivStyleLeftAndTop(t,e){this.m_viewEle.setDivStyleLeftAndTop(t,e)}setDivStyleSize(t,e){this.m_viewEle.setDivStyleSize(t,e)}getCanvas(){return this.m_canvas}getDepthTestEnabled(){return this.m_depthTestEnabled}getStencilTestEnabled(){return this.m_stencilTestEnabled}initialize(t,e,s,h=null){this.m_stage=e;var n=null,_=null;try{void 0!=document&&(n=document,_=window)}catch(m){console.log("RAdapterContext::initialize(), document is undefined.")}if(null!=n){l.default.Initialize(),this.m_rState=l.default.Rstate,this.m_viewEle.setDiv(s),this.m_viewEle.createViewEle(n,this.autoSyncRenderBufferAndWindowSize),this.m_div=s=this.m_viewEle.getDiv();let t=this.m_canvas=this.m_viewEle.getCanvas();this.m_devicePixelRatio=window.devicePixelRatio,this.m_mouseEvtDisplather.dpr=this.m_devicePixelRatio;let m=h;null==h?m={depth:this.m_depthTestEnabled,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:this.m_stencilTestEnabled,preserveDrawingBuffer:!0,powerPreference:"default"}:(this.m_depthTestEnabled=m.depth,this.m_stencilTestEnabled=m.stencil),console.log("this.m_devicePixelRatio: "+this.m_devicePixelRatio+",rattr == null: "+(null==h)),console.log("depthTestEnabled: "+m.depth),console.log("stencilTestEnabled: "+m.stencil),console.log("antialiasEnabled: "+m.antialias),console.log("alphaEnabled: "+m.alpha);let u=null;if(this.offscreenRenderEnabled&&(u=t.transferControlToOffscreen()),this.m_offcanvas=u,2==this.m_maxWebGLVersion&&(this.m_gl=null==u?t.getContext("webgl2",m):u.getContext("webgl2",m),null!=this.m_gl?(console.log("Use WebGL2 success!"),this.m_webGLVersion=2):console.log("WebGL2 can not support!")),null==this.m_gl&&(this.m_gl=null==u?t.getContext("webgl",m)||t.getContext("experimental-webgl",m):u.getContext("webgl",m)||u.getContext("experimental-webgl",m),null!=this.m_gl?(console.log("Use WebGL1 success!"),this.m_webGLVersion=1):console.log("WebGL1 can not support!")),!this.m_gl)throw this.m_webGLVersion=-1,alert("Unable to initialize WebGL. Your browser or machine may not support it."),Error("WebGL initialization failure.");let d=a.default;d.MAX_TEXTURE_SIZE=this.m_gl.getParameter(this.m_gl.MAX_TEXTURE_SIZE),d.MAX_RENDERBUFFER_SIZE=this.m_gl.getParameter(this.m_gl.MAX_RENDERBUFFER_SIZE);let c=this.m_gl.getParameter(this.m_gl.MAX_VIEWPORT_DIMS);d.MAX_VIEWPORT_WIDTH=c[0],d.MAX_VIEWPORT_HEIGHT=c[1],r.default.Initialize(this.m_webGLVersion,this.m_gl),a.default.Initialize([this.m_webGLVersion]),null!=e&&this.m_mouseEvtDisplather.initialize(t,s,e);let f=r.default.WEBGL_debug_renderer_info;if(null!=f){let t=this.m_gl.getParameter(f.UNMASKED_VENDOR_WEBGL),e=this.m_gl.getParameter(f.UNMASKED_RENDERER_WEBGL);d.GPU_VENDOR=t,d.GPU_RENDERER=t,console.log("webgl_vendor: ",t),console.log("webgl_renderer: ",e),i.default.ShowLog("webgl_vendor: "+t),i.default.ShowLog("webgl_renderer: "+e)}var o=this;_.onresize=function(t){o.autoSyncRenderBufferAndWindowSize&&o.updateRenderBufferSize()},this.m_rState.setRenderer(this.m_gl),t.addEventListener("webglcontextrestored",this.contextrestoredHandler,!1),t.addEventListener("webglcontextlost",this.contextlostHandler,!1),this.updateRenderBufferSize()}else console.log("initialize WebGL failure!")}loseContext(){null==this.m_WEBGL_lose_context&&(this.m_WEBGL_lose_context=this.m_gl.getExtension("WEBGL_lose_context")),null==this.m_WEBGL_lose_context&&this.m_WEBGL_lose_context.loseContext()}isContextLost(){return this.m_gl.isContextLost()}getRC(){return this.m_gl}getRenderState(){return this.m_rState}setScissorEnabled(t){t?this.m_scissorEnabled||(this.m_scissorEnabled=!0,this.m_gl.enable(this.m_gl.SCISSOR_TEST)):this.m_scissorEnabled&&(this.m_scissorEnabled=!1,this.m_gl.disable(this.m_gl.SCISSOR_TEST))}setScissorRect(t,e,s,i){this.m_gl.scissor(t,e,s,i)}setResizeCallback(t,e){this.m_resizeCallbackTarget=t,this.m_resizeCallback=e}getDevicePixelRatio(){return this.m_devicePixelRatio}resizeBufferSize(t,e){t=Math.floor(t),e=Math.floor(e);let s=window.devicePixelRatio,i=Math.abs(s-this.m_devicePixelRatio)>.02;this.m_devicePixelRatio=s,this.m_mouseEvtDisplather.dpr=s,a.default.SetDevicePixelRatio(this.m_devicePixelRatio),(this.m_displayWidth!=t||this.m_displayHeight!=e||i)&&(this.m_displayWidth=t,this.m_displayHeight=e,this.m_rcanvasWidth=Math.floor(t*s),this.m_rcanvasHeight=Math.floor(e*s),null==this.m_offcanvas?(this.m_canvas.width=this.m_rcanvasWidth,this.m_canvas.height=this.m_rcanvasHeight):(this.m_offcanvas.width=this.m_rcanvasWidth,this.m_offcanvas.height=this.m_rcanvasHeight),this.m_canvas.style.width=this.m_displayWidth+"px",this.m_canvas.style.height=this.m_displayHeight+"px",null!=this.m_stage&&(this.m_stage.stageWidth=this.m_rcanvasWidth,this.m_stage.stageHeight=this.m_rcanvasHeight,this.m_stage.viewWidth=this.m_displayWidth,this.m_stage.viewHeight=this.m_displayHeight,this.m_stage.pixelRatio=s,this.m_stage.update()),null!=this.m_resizeCallback&&this.m_resizeCallback.call(this.m_resizeCallbackTarget))}getStage(){return this.m_stage}getStageWidth(){return this.m_stage.stageWidth}getStageHeight(){return this.m_stage.stageHeight}getDisplayWidth(){return this.m_displayWidth}getDisplayHeight(){return this.m_displayHeight}setViewport(t,e,s,i){let r=this.m_viewX!=t||this.m_viewY!=e;(this.m_viewWidth!=s||this.m_viewHeight!=i||r)&&(this.m_viewX=t,this.m_viewY=e,this.m_viewWidth=s,this.m_viewHeight=i)}setViewportSize(t,e){this.m_viewWidth==t&&this.m_viewHeight==e||(this.m_viewWidth=t,this.m_viewHeight=e)}getViewportX(){return this.m_viewX}getViewportY(){return this.m_viewY}getViewportWidth(){return this.m_viewWidth}getViewportHeight(){return this.m_viewHeight}getFBOWidth(){return this.m_viewWidth<a.default.MAX_RENDERBUFFER_SIZE?this.m_viewWidth:a.default.MAX_RENDERBUFFER_SIZE}getFBOHeight(){return this.m_viewHeight<a.default.MAX_RENDERBUFFER_SIZE?this.m_viewHeight:a.default.MAX_RENDERBUFFER_SIZE}getRCanvasWidth(){return this.m_rcanvasWidth}getRCanvasHeight(){return this.m_rcanvasHeight}updateRenderBufferSize(){let t=this.m_div.getBoundingClientRect();this.resizeBufferSize(t.width,t.height)}}o.s_uid=0,e.default=o},"0929":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("6e01"),r=s("2139"),a=s("9156");class h{constructor(){this.m_uid=0,this.m_fs32=new Float32Array(16),this.m_invMatEnabled=!1,this.updatedStatus=h.UPDATE_POSITION,this.updateStatus=h.UPDATE_TRANSFORM,this.m_omat=null,this.m_localMat=null,this.m_parentMat=null,this.m_toParentMat=null,this.m_toParentMatFlag=!0,this.m_invOmat=null,this.m_uid=h.s_uid++}getUid(){return this.m_uid}getX(){return this.m_fs32[12]}getY(){return this.m_fs32[13]}getZ(){return this.m_fs32[14]}setX(t){this.updateStatus|=1,this.updatedStatus|=1,this.m_fs32[12]=t}setY(t){this.updateStatus|=1,this.updatedStatus|=1,this.m_fs32[13]=t}setZ(t){this.updateStatus|=1,this.updatedStatus|=1,this.m_fs32[14]=t}setXYZ(t,e,s){this.m_fs32[12]=t,this.m_fs32[13]=e,this.m_fs32[14]=s,this.updateStatus|=1,this.updatedStatus|=1}setPosition(t){this.m_fs32[12]=t.x,this.m_fs32[13]=t.y,this.m_fs32[14]=t.z,this.updateStatus|=1,this.updatedStatus|=1}getPosition(t){t.x=this.m_fs32[12],t.y=this.m_fs32[13],t.z=this.m_fs32[14]}copyPositionFrom(t){null!=t&&(this.m_fs32[12]=t.m_fs32[12],this.m_fs32[13]=t.m_fs32[13],this.m_fs32[14]=t.m_fs32[14],this.updateStatus|=1,this.updatedStatus|=1)}copyFrom(t){this.m_fs32.set(t.m_fs32,0),this.updatedStatus|=1,this.updateStatus|=7}getRotationX(){return this.m_fs32[1]}getRotationY(){return this.m_fs32[6]}getRotationZ(){return this.m_fs32[9]}setRotationX(t){this.m_fs32[1]=t,this.updateStatus|=2,this.updatedStatus|=2}setRotationY(t){this.m_fs32[6]=t,this.updateStatus|=2,this.updatedStatus|=2}setRotationZ(t){this.m_fs32[9]=t,this.updateStatus|=2,this.updatedStatus|=2}setRotationXYZ(t,e,s){this.m_fs32[1]=t,this.m_fs32[6]=e,this.m_fs32[9]=s,this.updateStatus|=2,this.updatedStatus|=2}getScaleX(){return this.m_fs32[0]}getScaleY(){return this.m_fs32[5]}getScaleZ(){return this.m_fs32[10]}setScaleX(t){this.m_fs32[0]=t,this.updateStatus|=4,this.updatedStatus|=4}setScaleY(t){this.m_fs32[5]=t,this.updateStatus|=4,this.updatedStatus|=4}setScaleZ(t){this.m_fs32[10]=t,this.updateStatus|=4,this.updatedStatus|=4}setScaleXYZ(t,e,s){this.m_fs32[0]=t,this.m_fs32[5]=e,this.m_fs32[10]=s,this.updateStatus|=4,this.updatedStatus|=4}setScale(t){this.m_fs32[0]=t,this.m_fs32[5]=t,this.m_fs32[10]=t,this.updateStatus|=4,this.updatedStatus|=4}getRotationXYZ(t){t.x=this.m_fs32[1],t.y=this.m_fs32[6],t.z=this.m_fs32[9]}getScaleXYZ(t){t.x=this.m_fs32[0],t.y=this.m_fs32[5],t.z=this.m_fs32[10]}localToGlobal(t){this.getMatrix().transformVectorSelf(t)}globalToLocal(t){this.getInvMatrix().transformVectorSelf(t)}getInvMatrix(){return null!=this.m_invOmat?this.m_invMatEnabled&&(this.m_invOmat.copyFrom(this.m_omat),this.m_invOmat.invert()):(this.m_invOmat=r.default.GetMatrix(),this.m_invOmat.copyFrom(this.m_omat),this.m_invOmat.invert()),this.m_invMatEnabled=!1,this.m_invOmat}getLocalMatrix(){return this.updateStatus>0&&this.update(),this.m_localMat}getMatrix(){return this.updateStatus&&this.update(),this.m_omat}getToParentMatrix(){return null!=this.m_toParentMat?this.m_toParentMat:this.m_omat}setParentMatrix(t){this.m_parentMat=t,this.m_invMatEnabled=!0,null!=this.m_parentMat&&(this.m_localMat==this.m_omat?(this.updateStatus=h.UPDATE_TRANSFORM,this.m_localMat=r.default.GetMatrix()):this.updateStatus|=h.UPDATE_PARENT_MAT)}updateMatrixData(t){null!=t&&(this.updateStatus=h.UPDATE_NONE,this.m_invMatEnabled=!0,this.m_omat.copyFrom(t))}__$setMatrix(t){null!=t&&(this.updateStatus=h.UPDATE_NONE,this.m_invMatEnabled=!0,this.m_localMat==this.m_omat&&(this.m_localMat=t),null!=this.m_omat&&(a.default.RemoveTransUniform(this.m_omat),r.default.RetrieveMatrix(this.m_omat)),this.m_omat=t)}destroy(){null!=this.m_invOmat&&r.default.RetrieveMatrix(this.m_invOmat),null!=this.m_localMat&&(this.m_omat==this.m_localMat&&a.default.RemoveTransUniform(this.m_omat),r.default.RetrieveMatrix(this.m_localMat)),null!=this.m_omat&&this.m_omat!=this.m_localMat&&(a.default.RemoveTransUniform(this.m_omat),r.default.RetrieveMatrix(this.m_omat)),this.m_invOmat=null,this.m_localMat=null,this.m_omat=null,this.m_parentMat=null,this.updateStatus=h.UPDATE_TRANSFORM}update(){this.updateStatus>0&&(this.m_invMatEnabled=!0,this.updateStatus=this.updateStatus|this.updatedStatus,(this.updateStatus&h.UPDATE_TRANSFORM)>0&&(this.m_localMat.getLocalFS32().set(this.m_fs32,0),(this.updateStatus&h.UPDATE_ROTATION)==h.UPDATE_ROTATION&&this.m_localMat.setRotationEulerAngle(this.m_fs32[1]*i.default.MATH_PI_OVER_180,this.m_fs32[6]*i.default.MATH_PI_OVER_180,this.m_fs32[9]*i.default.MATH_PI_OVER_180),null!=this.m_parentMat&&(this.updateStatus=this.updateStatus|h.UPDATE_PARENT_MAT)),this.m_omat!=this.m_localMat&&this.m_omat.copyFrom(this.m_localMat),(this.updateStatus&h.UPDATE_PARENT_MAT)==h.UPDATE_PARENT_MAT&&(null!=this.m_toParentMat||(this.m_toParentMat=r.default.GetMatrix()),this.m_toParentMat.copyFrom(this.m_omat),this.m_toParentMatFlag=!0,this.m_omat.append(this.m_parentMat)),this.updateStatus=h.UPDATE_NONE)}getMatrixFS32(){return this.getMatrix().getLocalFS32()}toString(){return"[ROTransform(uid = "+this.m_uid+")]"}static GetFreeId(){return h.m_freeIdList.length>0?h.m_freeIdList.pop():-1}static Create(t=null){let e=null,s=h.GetFreeId();return s>=0?(e=h.m_unitList[s],h.m_unitFlagList[s]=h.S_FLAG_BUSY):(e=new h,h.m_unitList.push(e),h.m_unitFlagList.push(h.S_FLAG_BUSY),h.m_unitListLen++),e.m_omat=null==t?r.default.GetMatrix():t,e.m_localMat=e.m_omat,e.m_fs32.set(h.s_initData,0),e}static Restore(t){if(null!=t&&h.m_unitFlagList[t.getUid()]==h.S_FLAG_BUSY){let e=t.getUid();h.m_freeIdList.push(e),h.m_unitFlagList[e]=h.S_FLAG_FREE,t.destroy()}}}h.s_uid=0,h.s_initData=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),h.UPDATE_NONE=0,h.UPDATE_POSITION=1,h.UPDATE_ROTATION=2,h.UPDATE_SCALE=4,h.UPDATE_TRANSFORM=7,h.UPDATE_PARENT_MAT=8,h.S_FLAG_BUSY=1,h.S_FLAG_FREE=0,h.m_unitFlagList=[],h.m_unitListLen=0,h.m_unitList=[],h.m_freeIdList=[],e.default=h},"0c85":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("352a");class r{constructor(){this.m_singleDown=!1,this.dpr=1}initMobile(t,e,s){var i=null;try{void 0!=document&&(i=document,window)}catch(r){console.log("ContextMouseEvtDispatcher::initMobile(), document is undefined.")}if(null!=i){let t=this;e.addEventListener("touchstart",(function(e){let i=e.targetTouches,r=0,a=0;if(i.length<2)r=0|t.dpr*(e.targetTouches[0].pageX-this.offsetLeft),a=0|t.dpr*(e.targetTouches[0].pageY-this.offsetTop),s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,t.m_singleDown=!0,s.mouseDown(1);else{let h=[];for(let s=0;s<i.length;++s)r=0|t.dpr*(e.targetTouches[s].pageX-this.offsetLeft),a=0|t.dpr*(e.targetTouches[s].pageY-this.offsetTop),h.push({x:r,y:a});s.mouseMultiDown(h),t.m_singleDown=!1}e.preventDefault()}),!1),e.addEventListener("touchend",(function(e){t.m_singleDown=!1;let i=e.targetTouches,r=0,a=0;if(i.length<1)s.mouseUp(1);else{let h=[];for(let s=0;s<i.length;++s)r=0|t.dpr*(e.targetTouches[s].pageX-this.offsetLeft),a=0|t.dpr*(e.targetTouches[s].pageY-this.offsetTop),h.push({x:r,y:a});s.mouseMultiUp(h)}e.preventDefault()}),!1),e.addEventListener("touchcancel",(function(e){t.m_singleDown=!1;e.targetTouches;s.mouseCancel(),e.preventDefault()}),!1),e.addEventListener("touchmove",(function(e){let i=e.targetTouches,r=0,a=0;if(t.m_singleDown&&(r=0|t.dpr*(i[0].pageX-this.offsetLeft),a=0|t.dpr*(i[0].pageY-this.offsetTop),s.mouseViewX=r,s.mouseViewY=a,s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseMove()),i.length>1){let h=[];for(let s=0;s<i.length;++s)r=0|t.dpr*(e.targetTouches[s].pageX-this.offsetLeft),a=0|t.dpr*(e.targetTouches[s].pageY-this.offsetTop),h.push({x:r,y:a});s.mouseMultiMove(h)}e.preventDefault()}),!1)}}initialize(t,e,s){i.default.IsMobileWeb()?this.initMobile(t,e,s):this.initPC(t,e,s)}initPC(t,e,s){var i=null;try{void 0!=document&&(i=document,window)}catch(r){console.log("ContextMouseEvtDispatcher::initPC(), document is undefined.")}if(null!=i){let i=this;if(void 0==t.onmousewheel&&void 0!=t.addEventListener){let e=function(t){t.wheelDeltaY=-t.detail,s.mouseWheel(t)};t.addEventListener("DOMMouseScroll",e,!1)}t.onmousewheel=function(t){s.mouseWheel(t)},t.onmousedown=function(t){let r=e.getBoundingClientRect(),a=0|i.dpr*(t.clientX-r.left),h=0|i.dpr*(t.clientY-r.top);s.mouseX=a,s.mouseY=s.stageHeight-h,s.mouseViewX=a,s.mouseViewY=h,0==t.button?s.mouseDown(1):2==t.button&&s.mouseRightDown()},t.onmouseup=function(t){let r=e.getBoundingClientRect(),a=0|i.dpr*(t.clientX-r.left),h=0|i.dpr*(t.clientY-r.top);s.mouseX=a,s.mouseY=s.stageHeight-h,s.mouseViewX=a,s.mouseViewY=h,0==t.button?s.mouseUp(1):2==t.button&&s.mouseRightUp()},t.onmousemove=function(t){let r=e.getBoundingClientRect(),a=0|i.dpr*(t.clientX-r.left),h=0|i.dpr*(t.clientY-r.top);s.mouseX=a,s.mouseY=s.stageHeight-h,s.mouseViewX=a,s.mouseViewY=h,s.mouseMove()},t.onclick=function(t){let r=e.getBoundingClientRect(),a=0|i.dpr*(t.clientX-r.left),h=0|i.dpr*(t.clientY-r.top);s.mouseX=a,s.mouseY=s.stageHeight-h,s.mouseViewX=a,s.mouseViewY=h,0==t.button?s.mouseClick():2==t.button&&s.mouseRightClick()},t.ondblclick=function(t){let r=e.getBoundingClientRect(),a=0|i.dpr*(t.clientX-r.left),h=0|i.dpr*(t.clientY-r.top);s.mouseX=a,s.mouseY=s.stageHeight-h,s.mouseViewX=a,s.mouseViewY=h,0==t.button?s.mouseDoubleClick():t.button}}}}e.default=r},"0e01":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("2139"),r=s("5326"),a=s("29ef"),h=s("de9d"),n=s("4f27"),l=s("7499");class _{constructor(t){this.m_adapter=null,this.m_renderProxy=null,this.m_materialProxy=null,this.m_Matrix4AllocateSize=0,this.m_cameraNear=.1,this.m_cameraFar=5e3,this.m_cameraFov=45,this.m_rcuid=0,this.m_rcuid=t,this.m_renderProxy=new h.default(t)}getRCUid(){return this.m_rcuid}getDiv(){return this.m_adapter.getDiv()}getCanvas(){return this.m_adapter.getCanvas()}getRenderAdapter(){return this.m_adapter}getRenderMaterialProxy(){return this.m_materialProxy}getRenderProxy(){return this.m_renderProxy}getTextureResTotal(){return this.m_renderProxy.Texture.getTextureResTotal()}getTextureAttachTotal(){return this.m_renderProxy.Texture.getAttachTotal()}getStage3D(){return this.m_renderProxy.getStage3D()}getCamera(){return null!=this.m_renderProxy?this.m_renderProxy.getCamera():null}cameraLock(){this.m_renderProxy.cameraLock()}cameraUnlock(){this.m_renderProxy.cameraUnlock()}createCamera(){if(null==this.m_renderProxy)return this.m_renderProxy.createCamera()}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}updateCameraDataFromCamera(t){null!=this.m_renderProxy&&this.m_renderProxy.updateCameraDataFromCamera(t)}lockRenderState(){null!=this.m_renderProxy&&this.m_renderProxy.lockRenderState()}unlockRenderState(){null!=this.m_renderProxy&&this.m_renderProxy.unlockRenderState()}useGlobalRenderState(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderState(),this.m_renderProxy.useRenderState(t),this.m_renderProxy.lockRenderState())}useGlobalRenderStateByName(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderState(),this.m_renderProxy.useRenderState(a.default.GetRenderStateByName(t)),this.m_renderProxy.lockRenderState())}lockMaterial(){null!=this.m_materialProxy&&this.m_materialProxy.lockMaterial()}unlockMaterial(){null!=this.m_materialProxy&&this.m_materialProxy.unlockMaterial()}useGlobalMaterial(t){null!=this.m_materialProxy&&(this.m_materialProxy.unlockMaterial(),this.m_materialProxy.useGlobalMaterial(t),this.m_materialProxy.lockMaterial())}setScissorRect(t,e,s,i){this.m_adapter.setScissorRect(t,e,s,i)}setScissorEnabled(t){this.m_adapter.setScissorEnabled(t)}setViewPort(t,e,s,i){this.m_renderProxy.setViewPort(t,e,s,i)}synFBOSizeWithViewport(){this.m_adapter.synFBOSizeWithViewport()}asynFBOSizeWithViewport(){this.m_adapter.asynFBOSizeWithViewport()}setFBOSizeFactorWithViewPort(t){this.m_adapter.setFBOSizeFactorWithViewPort(t)}createFBOAt(t,e,s,i,r=!1,a=!1,h=0){this.m_adapter.createFBOAt(t,e,s,i,r,a,h)}bindFBOAt(t,e){this.m_adapter.bindFBOAt(t,e)}setRenderToTexture(t,e=!1,s=!1,i=0){this.m_adapter.setRenderToTexture(t,e,s,i)}useFBO(t=!1,e=!1,s=!1){this.m_adapter.useFBO(t,e,s)}setRenderToBackBuffer(){null!=this.m_adapter&&this.m_adapter.setRenderToBackBuffer()}lockViewport(){this.m_adapter.lockViewport()}unlockViewport(){this.m_adapter.unlockViewport()}setClearDepth(t){this.m_adapter.setClearDepth(t)}getClearDepth(){return this.m_adapter.getClearDepth()}getViewportX(){return this.m_adapter.getViewportX()}getViewportY(){return this.m_adapter.getViewportY()}getViewportWidth(){return this.m_adapter.getViewportWidth()}getViewportHeight(){return this.m_adapter.getViewportHeight()}setContextViewSize(t,e){this.m_adapter.setContextViewSize(t,e)}setMatrix4AllocateSize(t){this.m_Matrix4AllocateSize<1&&(t<1024&&(t=1024),this.m_Matrix4AllocateSize=t,i.default.Allocate(t))}setCameraParam(t,e,s){this.m_cameraFov=t,this.m_cameraNear=e,this.m_cameraFar=s,null!=this.m_renderProxy&&this.m_renderProxy.setCameraParam(t,e,s)}initialize(t,e,s,i){if(this.m_Matrix4AllocateSize<1024&&this.setMatrix4AllocateSize(1024),null==this.m_adapter){r.default.Initialize(this.m_renderProxy.getUid()),this.m_renderProxy.setCameraParam(this.m_cameraFov,this.m_cameraNear,this.m_cameraFar),this.m_renderProxy.setWebGLMaxVersion(t.maxWebGLVersion),this.m_renderProxy.initialize(t,e,s,s,i),this.m_rcuid=this.m_renderProxy.getRCUid(),i.initialize(this.m_rcuid,this.m_renderProxy.getRC(),this.m_renderProxy.getGLVersion()),this.m_adapter=this.m_renderProxy.getRenderAdapter(),this.m_adapter.bgColor.setRGBA4f(0,0,0,1);let a=this.m_renderProxy.getContext();a.setViewport(0,0,a.getRCanvasWidth(),a.getRCanvasHeight()),n.default.Initialize()}}initManager(t){null==this.m_materialProxy&&(this.m_materialProxy=new l.default,this.m_materialProxy.setDispBuilder(t))}setClearRGBColor3f(t,e,s){null!=this.m_renderProxy&&this.m_renderProxy.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){null!=this.m_renderProxy&&this.m_renderProxy.setClearRGBAColor4f(t,e,s,i)}updateRenderBufferSize(){this.m_adapter.updateRenderBufferSize()}renderBegin(){null!=this.m_renderProxy&&(this.m_adapter.unlockViewport(),this.m_adapter.setClearDepth(1),a.default.ResetInfo(),a.default.Reset(this.m_renderProxy.RContext),this.m_renderProxy.Vertex.renderBegin(),this.m_materialProxy.renderBegin(),this.m_adapter.update(),this.m_adapter.setClearMaskClearAll(),this.m_adapter.renderBegin(),this.m_renderProxy.useCameraData(),this.m_renderProxy.updateCameraDataFromCamera(this.m_renderProxy.getCamera()))}runEnd(){}}e.default=_},"0fc4":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("9666"),r=s("faa5");class a{constructor(){this.m_shduns="",this.m_shdData=null,this.__$troMid=-1,this.__$uniform=null,this.m_texList=null,this.m_texListLen=0,this.m_texDataEnabled=!1,this.m_attachCount=0}getShdUniqueName(){return this.m_shduns}initializeByUniqueName(t){if(null==this.getShaderData()){let e=i.default.FindData(t);null!=e&&(this.m_shdData=e)}return null!=this.getShaderData()}initialize(t,e,s){if(null==this.getShaderData()){r.default.UseShaderBuffer(null);let a=i.default.FindData(t);null==a&&(a=i.default.CreateShdData(t,e,s)),this.m_shduns=t,this.m_shdData=a}}getCodeBuf(){return null!=a.s_codeBuffer||(a.s_codeBuffer=new r.default),a.s_codeBuffer}hasShaderData(){if(null!=this.m_shdData){if(!this.m_shdData.haveTexture())return!0;if(this.texDataEnabled())return!0}return!1}initializeByCodeBuf(t=!1){if(null==this.m_shdData){let e=this.getCodeBuf();if(null!=e){null==a.s_codeBuffer&&(a.s_codeBuffer=new r.default),r.default.UseShaderBuffer(e),a.s_codeBuffer.initialize(t);let s=a.s_codeBuffer.getUniqueShaderName();this.m_shduns=s,this.__$initShd(this.m_shduns);let h=i.default.FindData(s);if(null==h){a.s_codeBuffer.buildShader();let t=a.s_codeBuffer.getFragShaderCode(),e=a.s_codeBuffer.getVtxShaderCode();h=i.default.CreateShdData(s,e,t)}r.default.UseShaderBuffer(null),this.m_shdData=h}}}__$initShd(t){}getShaderData(){return this.m_shdData}setTextureList(t){if(this.m_texList!=t){this.m_texDataEnabled=!1,this.m_texListLen=null!=t?t.length:0;let e=0;if(null!=this.m_texList)for(;e<this.m_texList.length;++e)this.m_texList[e].__$detachThis();if(this.m_texDataEnabled=!0,this.m_texList=t,null!=this.m_texList){let t=31;for(e=0;e<this.m_texList.length;++e)t=131*t+this.m_texList[e].getUid(),this.m_texList[e].__$attachThis(),this.m_texList[e].isDataEnough()||(this.m_texDataEnabled=!1);this.__$troMid=t}}}setTextureAt(t,e){if(t>=0&&null!=e){let s=this.m_texList,i=s.length;if(null!=s&&s[t]!=e&&t<i&&i>0){s=s.slice(0),s[t].__$detachThis(),s[t]=e,this.m_texDataEnabled=e.isDataEnough(),e.__$attachThis();let r=31;for(let t=0;t<i;++t)r=131*r+s[t].getUid();this.__$troMid=r,this.m_texList=s}}}getTextureList(){return this.m_texList}getTextureAt(t){return this.m_texList[t]}getTextureTotal(){return this.m_texListLen}getShdTexTotal(){return null!=this.m_shdData?this.m_shdData.getTexTotal():0}texDataEnabled(){if(null!=this.m_texList){if(this.m_texDataEnabled)return!0;let t=!0,e=this.m_texList;for(let s=0;s<this.m_texListLen;++s)if(!e[s].isDataEnough()){t=!1;break}return this.m_texDataEnabled=t,t}return!1}createSharedUniform(){return null}createSelfUniformData(){return null}updateSelfData(t){}hasTexture(){return this.m_shdData.haveTexture()}getBufSortFormat(){return null!=this.m_shdData?this.m_shdData.getLayoutBit():0}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}getAttachCount(){return this.m_attachCount}destroy(){if(this.getAttachCount()<1){if(null!=this.m_texList)for(let t=0;t<this.m_texList.length;++t)this.m_texList[t].__$detachThis();this.m_shdData=null,this.m_texList=null,this.m_texDataEnabled=!1,this.__$troMid=0,null!=this.__$uniform&&(this.__$uniform.destroy(),this.__$uniform=null)}}toString(){return"[MaterialBase()]"}}a.s_codeBuffer=null,e.default=a},"11e6":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static AddContainerFlag(t){return 2147483648|t}static RemoveContainerFlag(t){return-2147483649&t}static AddSpaceUid(t,e){return-1048576&t|e}static RemoveSpaceUid(t){return-1048576&t}static GetSpaceUid(t){return 1048575&t}static AddRendererUid(t,e){return-133169153&t|e<<20}static RemoveRendererUid(t){return 133169152|t}static GetRendererUid(t){return(133169152&t)>>20}static AddSortEnabled(t){return 1073741824|t}static RemoveSortEnabled(t){return-1073741825&t}static TestSortEnabled(t){return 1073741824==(1073741824&t)}static AddRendererLoad(t){return 805306368|t}static RemoveRendererLoad(t){return-805306369&t}static TestSpaceContains(t){return(1048575&t)>0}static TestSpaceEnabled(t){return(1048575&t)<1}static TestSpaceEnabled2(t){return(1048575&t)<1&&2147483648!=(2147483648&t)}static TestContainerEnabled(t){return 133169152==(133169152&t)&&2147483648!=(2147483648&t)}static TestRendererEnabled(t){return 133169152==(938475520&t)&&2147483648!=(2147483648&t)}}i.DEFAULT=133169152,i.CONTAINER_FLAG=2147483648,i.CONTAINER_NOT_FLAG=-2147483649,i.SPACE_FLAT=1048575,i.SPACE_NOT_FLAT=-1048576,i.RENDERER_UID_FLAT=133169152,i.RENDERER_UID_NOT_FLAT=-133169153,i.SORT_FLAT=1073741824,i.SORT_NOT_FLAT=-1073741825,i.RENDERER_LOAD_FLAT=805306368,i.RENDERER_LOAD_NOT_FLAT=-805306369,i.RENDERER_ADN_LOAD_FLAT=938475520,e.default=i},1216:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("3bda"),r=s("8e17"),a=s("3930"),h=s("baae"),n=s("722e"),l=s("8333"),_=s("6d49"),o=s("e08e"),m=s("8d98"),u=s("7c63"),d=s("29ef"),c=s("3024");class f{constructor(t,e){this.m_uid=f.s_uid++,this.m_rcuid=0,this.m_texResource=null,this.m_rc=null,this.m_fontFaceFlipped=!1,this.m_colorMask={mr:!0,mg:!0,mb:!0,ma:!0},this.m_rcontext=null,this.m_clearMask=0,this.m_fboBuf=null,this.m_fboIndex=0,this.m_fboType=h.default.FRAMEBUFFER,this.m_fboBufList=[null,null,null,null,null,null,null,null],this.m_fboClearBoo=!0,this.m_fboViewRectBoo=!1,this.m_viewX=0,this.m_viewY=0,this.m_viewWidth=800,this.m_viewHeight=600,this.m_clearDepth=1,this.m_preDepth=0,this.m_fboViewSize=new r.default(0,0,800,600),this.m_fboSizeFactor=1,this.m_fboBiltRect=new Uint16Array(8),this.m_fboViewRect=new Uint16Array(4),this.m_activeAttachmentTotal=1,this.m_scissorEnabled=!1,this.m_rState=null,this.m_webglVer=2,this.bgColor=new a.default,this.uViewProbe=null,this.m_polygonOffset=!1,this.m_devPRatio=1,this.m_viewportUnlock=!0,this.m_synFBOSizeWithViewport=!1,this.m_texResource=e,this.m_rcuid=t}initialize(t,e){if(this.m_webglVer=t.getWebGLVersion(),null==this.m_rcontext){this.m_rcontext=t,this.m_rc=t.getRC(),this.m_rc.disable(this.m_rc.SCISSOR_TEST);let s=t.getDepthTestEnabled();if(s?this.m_rc.enable(this.m_rc.DEPTH_TEST):this.m_rc.disable(this.m_rc.DEPTH_TEST),t.getStencilTestEnabled()?this.m_rc.enable(this.m_rc.STENCIL_TEST):this.m_rc.disable(this.m_rc.STENCIL_TEST),this.m_rc.enable(this.m_rc.CULL_FACE),this.m_rc.cullFace(this.m_rc.BACK),this.m_rc.enable(this.m_rc.BLEND),e.getDitherEanbled()?this.m_rc.enable(this.m_rc.DITHER):this.m_rc.disable(this.m_rc.DITHER),this.m_rc.frontFace(this.m_rc.CCW),e.getPolygonOffsetEanbled()?this.m_rc.enable(this.m_rc.POLYGON_OFFSET_FILL):this.m_rc.disable(this.m_rc.POLYGON_OFFSET_FILL),this.m_clearMask=this.m_rc.COLOR_BUFFER_BIT|this.m_rc.DEPTH_BUFFER_BIT|this.m_rc.STENCIL_BUFFER_BIT,this.m_rState=t.getRenderState(),null==this.uViewProbe){let t=this;t.uViewProbe=new c.default(1),this.uViewProbe.bindSlotAt(this.m_rcuid),this.uViewProbe.setVec4DataWithArr4([this.m_viewX,this.m_viewY,this.m_viewWidth,this.m_viewHeight])}}}setFrontFaceFlipped(t){this.m_fontFaceFlipped!=t&&(t?this.m_rc.frontFace(this.m_rc.CW):this.m_rc.frontFace(this.m_rc.CCW),this.m_fontFaceFlipped=t)}setPolygonOffset(t,e=0){this.m_rc.polygonOffset(t,e),this.m_polygonOffset=!0}resetPolygonOffset(){this.m_polygonOffset&&(this.m_rc.polygonOffset(0,0),this.m_polygonOffset=!1)}getDiv(){return this.m_rcontext.getDiv()}getCanvas(){return this.m_rcontext.getCanvas()}setClearDepth(t){this.m_clearDepth=t}getClearDepth(){return this.m_clearDepth}setContextViewSize(t,e){this.m_rcontext.autoSyncRenderBufferAndWindowSize=!1,this.m_rcontext.resizeBufferSize(t,e)}getViewportX(){return this.m_rcontext.getViewportX()}getViewportY(){return this.m_rcontext.getViewportY()}getViewportWidth(){return this.m_rcontext.getViewportWidth()}getViewportHeight(){return this.m_rcontext.getViewportHeight()}getFBOFitWidth(){return this.m_rcontext.getFBOWidth()}getFBOFitHeight(){return this.m_rcontext.getFBOHeight()}setColorMask(t,e,s,i){this.m_colorMask.mr=t,this.m_colorMask.mg=e,this.m_colorMask.mb=s,this.m_colorMask.ma=i}setClearMaskClearAll(){this.m_clearMask=this.m_rc.COLOR_BUFFER_BIT|this.m_rc.DEPTH_BUFFER_BIT|this.m_rc.STENCIL_BUFFER_BIT}setClearMaskClearOnlyColor(){this.m_clearMask=this.m_rc.COLOR_BUFFER_BIT}setClearMaskClearOnlyDepthAndStencil(){this.m_clearMask=this.m_rc.DEPTH_BUFFER_BIT|this.m_rc.STENCIL_BUFFER_BIT}setScissorRect(t,e,s,i){this.m_scissorEnabled&&this.m_rc.scissor(t,e,s,i)}setScissorEnabled(t){t?this.m_scissorEnabled||(this.m_scissorEnabled=!0,this.m_rc.enable(this.m_rc.SCISSOR_TEST)):this.m_scissorEnabled&&(this.m_scissorEnabled=!1,this.m_rc.disable(this.m_rc.SCISSOR_TEST))}clear(){this.m_preDepth!==this.m_clearDepth&&(this.m_preDepth=this.m_clearDepth,this.m_rc.clearDepth(this.m_clearDepth)),this.m_rc.clearColor(this.bgColor.r,this.bgColor.g,this.bgColor.b,this.bgColor.a),this.m_rc.clear(this.m_clearMask)}reset(){this.m_rState.setCullFaceMode(o.CullFaceMode.BACK),this.m_rState.setDepthTestMode(o.DepthTestMode.RENDER_OPAQUE),d.default.Reset(this.m_rc)}getRenderContext(){return this.m_rcontext}renderBegin(){null!=this.m_rcontext&&(this.m_fboSizeFactor=1,this.reseizeViewPort(),u.RenderStateObject.Unlock(),u.RenderStateObject.UseRenderState(u.RenderStateObject.NORMAL_STATE),u.RenderColorMask.Unlock(),u.RenderColorMask.UseRenderState(u.RenderColorMask.ALL_TRUE_COLOR_MASK),this.clear())}reseizeViewPort(){if(this.m_viewportUnlock){let t=this.m_rcontext.getDevicePixelRatio(),e=this.m_viewX!=this.m_rcontext.getViewportX()||this.m_viewY!=this.m_rcontext.getViewportY();e=e||this.m_viewWidth!=this.m_rcontext.getViewportWidth(),e=e||this.m_viewHeight!=this.m_rcontext.getViewportHeight(),e=e||Math.abs(this.m_devPRatio-t)>.01,e&&(this.m_devPRatio=t,this.m_viewX=this.m_rcontext.getViewportX(),this.m_viewY=this.m_rcontext.getViewportY(),this.m_viewWidth=this.m_rcontext.getViewportWidth(),this.m_viewHeight=this.m_rcontext.getViewportHeight(),this.uViewProbe.setVec4Data(this.m_viewX,this.m_viewY,this.m_viewWidth,this.m_viewHeight),this.uViewProbe.update(),i.default.ShowLog("reseizeViewPort: "+this.m_viewX+","+this.m_viewY+","+this.m_viewWidth+","+this.m_viewHeight),this.m_rc.viewport(this.m_viewX,this.m_viewY,this.m_viewWidth,this.m_viewHeight))}}reseizeFBOViewPort(){if(this.m_viewportUnlock){let t=this.m_rcontext.getDevicePixelRatio(),e=this.m_viewX!=this.m_fboViewSize.x||this.m_viewY!=this.m_fboViewSize.y;e=e||this.m_viewWidth!=this.m_fboViewSize.z,e=e||this.m_viewHeight!=this.m_fboViewSize.w,e=e||Math.abs(this.m_devPRatio-t)>.01,e&&(this.m_devPRatio=t,this.m_viewX=this.m_fboViewSize.x,this.m_viewY=this.m_fboViewSize.y,this.m_viewWidth=this.m_fboViewSize.z,this.m_viewHeight=this.m_fboViewSize.w,this.uViewProbe.setVec4Data(this.m_viewX,this.m_viewY,this.m_viewWidth,this.m_viewHeight),this.uViewProbe.update(),i.default.ShowLog("reseizeFBOViewPort: "+this.m_viewX+","+this.m_viewY+","+this.m_viewWidth+","+this.m_viewHeight),this.m_rc.viewport(this.m_viewX,this.m_viewY,this.m_viewWidth,this.m_viewHeight))}}setViewProbeValue(t,e,s,i){this.uViewProbe.setVec4Data(t,e,s,i),this.uViewProbe.update()}lockViewport(){this.m_viewportUnlock=!1}unlockViewport(){this.m_viewportUnlock=!0}renderEnd(){}update(){}updateRenderBufferSize(){this.m_rcontext.updateRenderBufferSize()}destroy(){this.m_rcontext=null,this.m_rState=null}getDevicePixelRatio(){return this.m_rcontext.getDevicePixelRatio()}loseContext(){this.m_rcontext.loseContext()}isContextLost(){return this.m_rcontext.isContextLost()}readPixels(t,e,s,i,r,a,h){this.m_rc.readPixels(t,e,s,i,m.TextureFormat.ToGL(this.m_rc,r),m.TextureDataType.ToGL(this.m_rc,a),h)}setFBOViewRect(t,e,s,i){this.m_fboViewRect[0]=t,this.m_fboViewRect[1]=e,this.m_fboViewRect[2]=s,this.m_fboViewRect[3]=i,this.m_fboViewRectBoo=!0}createFBOAt(t,e,s,i,r=!1,a=!1,h=0){null==this.m_fboBufList[t]&&(t>7&&(t=7),this.m_fboType=e,this.m_fboBuf=new _.default(this.m_rcuid,this.m_texResource,this.m_fboType),this.m_fboBuf.multisampleEnabled=h>0,this.m_fboBuf.multisampleLevel=h,this.m_fboBuf.writeDepthEnabled=r,this.m_fboBuf.writeStencilEnabled=a,this.m_fboBuf.initialize(this.m_rc,s,i),this.m_fboBufList[t]=this.m_fboBuf,this.m_fboBuf.sizeFixed=!0)}resizeFBOAt(t,e,s){t>7?t=7:t<0&&(t=0),null!=this.m_fboBufList[this.m_fboIndex]&&this.m_fboBufList[this.m_fboIndex].resize(e,s)}getFBOWidthAt(t){return null!=this.m_fboBufList[t]?this.m_fboBufList[t].getWidth():0}getFBOHeightAt(t){return null!=this.m_fboBufList[t]?this.m_fboBufList[t].getHeight():0}synFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!0}asynFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!1}setFBOSizeFactorWithViewPort(t){this.m_fboSizeFactor=t}bindFBOAt(t,e){if(t>7?t=7:t<0&&(t=0),this.m_fboBuf=this.m_fboBufList[t],null==this.m_fboBuf)throw Error("Fatal Error!!! this.m_fboBuf == null.");this.m_fboIndex=t,this.m_fboType=e,this.m_fboBuf.bind(e),this.m_fboClearBoo=!0}resetFBOAttachmentMask(t){null!=this.m_fboBuf&&this.m_fboBuf.resetAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){null!=this.m_fboBuf&&this.m_fboBuf.setAttachmentMaskAt(t,e)}getFBOAttachmentTotal(){return null!=this.m_fboBuf?this.m_fboBuf.getAttachmentTotal():0}setRenderToTexture(t,e=!1,s=!1,i=0){(i<0||i>=8)&&(i=0),null==t&&0==i?this.setRenderToBackBuffer(h.default.FRAMEBUFFER):(0==i&&(null!=this.m_fboBuf&&(this.m_synFBOSizeWithViewport?this.m_fboBuf.initialize(this.m_rc,Math.floor(this.m_rcontext.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rcontext.getFBOHeight()*this.m_fboSizeFactor)):this.m_fboViewRectBoo?this.m_fboBuf.initialize(this.m_rc,this.m_fboViewRect[2],this.m_fboViewRect[3]):this.m_fboBuf.sizeFixed||this.m_fboBuf.initialize(this.m_rc,t.getWidth(),t.getHeight())),this.m_fboIndex>=0&&null==this.m_fboBuf&&(this.m_fboBuf=new _.default(this.m_rcuid,this.m_texResource,this.m_fboType),this.m_fboBufList[this.m_fboIndex]=this.m_fboBuf,this.m_fboBuf.writeDepthEnabled=e,this.m_fboBuf.writeStencilEnabled=s,this.m_synFBOSizeWithViewport?this.m_fboBuf.initialize(this.m_rc,Math.floor(this.m_rcontext.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rcontext.getFBOHeight()*this.m_fboSizeFactor)):this.m_fboViewRectBoo?this.m_fboBuf.initialize(this.m_rc,this.m_fboViewRect[2],this.m_fboViewRect[3]):this.m_fboBuf.initialize(this.m_rc,t.getWidth(),t.getHeight()))),null!=this.m_fboBuf&&this.m_fboBuf.renderToTexAt(this.m_rc,t,i),this.m_fboClearBoo=!0)}getActiveAttachmentTotal(){return this.m_activeAttachmentTotal}getAttachmentTotal(){return this.m_activeAttachmentTotal}useFBO(t=!1,e=!1,s=!1){null!=this.m_fboBuf&&this.m_fboClearBoo&&(this.m_fboClearBoo=!1,this.m_fboBuf.use(this.m_rc),this.m_activeAttachmentTotal=this.m_fboBuf.getActiveAttachmentTotal(),t&&this.m_fboBuf.clearOnlyColor(this.bgColor),this.m_fboBuf.writeDepthEnabled?this.m_fboBuf.writeStencilEnabled?e&&s?this.m_fboBuf.clearOnlyDepthAndStencil(this.m_clearDepth,4294967295):e?this.m_fboBuf.clearOnlyDepth(this.m_clearDepth):s&&this.m_fboBuf.clearOnlyStencil(255):e&&this.m_fboBuf.clearOnlyDepth(this.m_clearDepth):s&&this.m_fboBuf.writeStencilEnabled&&this.m_fboBuf.clearOnlyStencil(255),1==this.m_webglVer&&this.m_rc.clear(this.m_clearMask),this.m_fboBiltRect[4]=this.m_fboBiltRect[0]=this.m_viewX,this.m_fboBiltRect[5]=this.m_fboBiltRect[1]=this.m_viewY,this.m_fboBiltRect[6]=this.m_fboBiltRect[2]=this.m_viewX+this.m_viewWidth,this.m_fboBiltRect[7]=this.m_fboBiltRect[3]=this.m_viewY+this.m_viewHeight,this.m_fboViewRectBoo?(this.m_fboViewRectBoo=!1,this.m_fboViewSize.setTo(this.m_fboViewRect[0],this.m_fboViewRect[1],this.m_fboViewRect[2],this.m_fboViewRect[3]),this.reseizeFBOViewPort()):(this.m_synFBOSizeWithViewport?this.m_fboViewSize.setTo(0,0,Math.floor(this.m_rcontext.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rcontext.getFBOHeight()*this.m_fboSizeFactor)):this.m_fboViewSize.setTo(0,0,this.m_fboBuf.getWidth(),this.m_fboBuf.getHeight()),this.reseizeFBOViewPort()))}setRenderToBackBuffer(t=h.default.FRAMEBUFFER){this.m_activeAttachmentTotal=1,_.default.BindToBackbuffer(this.m_rc,t),this.reseizeViewPort()}bindFBOToDraw(){null!=this.m_fboBuf&&this.m_fboBuf.bind(h.default.DRAW_FRAMEBUFFER)}bindFBOToWrite(){null!=this.m_fboBuf&&this.m_fboBuf.bind(h.default.READ_FRAMEBUFFER)}setBlitFboSrcRect(t,e,s,i){this.m_fboBiltRect[0]=t,this.m_fboBiltRect[1]=e,this.m_fboBiltRect[2]=t+s,this.m_fboBiltRect[3]=e+i}setBlitFboDstRect(t,e,s,i){this.m_fboBiltRect[4]=t,this.m_fboBiltRect[5]=e,this.m_fboBiltRect[6]=t+s,this.m_fboBiltRect[7]=e+i}blitFBO(t=0,e=0,s=l.default.COLOR_BUFFER_BIT,i=n.default.NEAREST,r=0,a=0,o=null){t>7&&(t=7),e>7&&(e=7),t>=0&&null!=this.m_fboBufList[t]?this.m_fboBufList[t].bind(h.default.READ_FRAMEBUFFER):_.default.BindToBackbuffer(this.m_rc,h.default.READ_FRAMEBUFFER),e>=0&&null!=this.m_fboBufList[e]?this.m_fboBufList[e].bind(h.default.DRAW_FRAMEBUFFER):_.default.BindToBackbuffer(this.m_rc,h.default.DRAW_FRAMEBUFFER),r>0&&(a<0&&(a=0),null==o&&(o=[0,0,0,1]),this.m_rc.clearBufferfv(r,a,o));let m=this.m_fboBiltRect;this.m_rc.blitFramebuffer(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],s,i)}}f.s_uid=0,e.default=f},1264:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("11e6"),r=s("e08e"),a=s("eca0");class h{constructor(t,e,s,i){this.m_rpoUnitBuilder=null,this.m_dataBuilder=null,this.m_processBuider=null,this.m_waitList=[],this.m_processUidList=[],this.m_rendererUid=-1,this.m_existencetotal=0,this.m_rprocess=null,this.entityManaListener=null,this.m_rendererUid=t,this.m_dataBuilder=e,this.m_rpoUnitBuilder=s,this.m_processBuider=i}isEmpty(){return this.m_existencetotal<1}isHaveEntity(){return this.m_existencetotal>0}removeEntity(t){this.m_existencetotal--;let e=t.getDisplay();if(null!=e&&null!=e.__$$runit){let t=e.__$ruid,s=this.m_rpoUnitBuilder.getRCRPObj(t);if(null!=s){if(s.count>0)if(s.count<2)s.rprocessUid>-1&&(this.m_rprocess=this.m_processBuider.getNodeByUid(s.rprocessUid),this.m_rprocess.removeDisp(e),s.rprocessUid=-1);else{let t=a.RCRPObj.RenerProcessMaxTotal;for(let i=0;i<t;++i)(s.idsFlag&1<<i)>0&&(this.m_rprocess=this.m_processBuider.getNodeByUid(i),this.m_rprocess.removeDisp(e))}}else this.m_rprocess=this.m_processBuider.getNodeByUid(e.__$$runit.getRPROUid()),this.m_rprocess.removeDisp(e);0==s.count?(e.__$$rsign!=r.DisplayRenderSign.LIVE_IN_WORLD&&console.error("DispEntity3DManager::removeEntity(), Error: display.__$$rsign != RODisplay.LIVE_IN_WORLD."),e.__$$rsign=r.DisplayRenderSign.NOT_IN_WORLD,this.m_rpoUnitBuilder.restoreByUid(t)):console.warn("Error: DispEntity3DManager::removeEntity(), remove a entity from all processes failed.")}t.__$rseFlag=i.default.RemoveRendererUid(t.__$rseFlag),t.__$rseFlag=i.default.RemoveRendererLoad(t.__$rseFlag),t.__$rseFlag=i.default.RemoveSortEnabled(t.__$rseFlag),null!=this.entityManaListener&&this.entityManaListener.removeFromWorld(t,this.m_rendererUid,-1)}addEntity(t,e,s=!1){if(null!=t){let a=t.getDisplay();if(null!=a){if(a.__$$rsign==r.DisplayRenderSign.LIVE_IN_WORLD&&!this.m_rpoUnitBuilder.testRPNodeNotExists(a.__$ruid,e))return;this.m_rprocess=this.m_processBuider.getNodeByUid(e),t.__$rseFlag=this.m_rprocess.getSortEnabled()?i.default.AddSortEnabled(t.__$rseFlag):i.default.RemoveSortEnabled(t.__$rseFlag),s?(a.__$$rsign==r.DisplayRenderSign.NOT_IN_WORLD&&(a.__$$rsign=r.DisplayRenderSign.GO_TO_WORLD),t.__$rseFlag=i.default.AddRendererLoad(t.__$rseFlag),t.__$rseFlag=i.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid),this.m_waitList.push(t),this.m_processUidList.push(e)):this.testValidData(t)?this.ensureAdd(t,a,e):(a.__$$rsign==r.DisplayRenderSign.NOT_IN_WORLD&&(a.__$$rsign=r.DisplayRenderSign.GO_TO_WORLD),t.__$rseFlag=i.default.AddRendererLoad(t.__$rseFlag),this.m_waitList.push(t),this.m_processUidList.push(e))}else t.__$rseFlag=i.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid)}return!1}testValidData(t){if(null!=t.getMaterial()&&t.hasMesh()){if(t.getMaterial().hasShaderData())return!0;null!=t.getMaterial().getCodeBuf()&&t.activeDisplay()}return!1}ensureAdd(t,e,s){t.update(),t.__$rseFlag=i.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid),t.__$rseFlag=i.default.RemoveRendererLoad(t.__$rseFlag),this.m_existencetotal++,e.__$$rsign==r.DisplayRenderSign.NOT_IN_WORLD&&(e.__$$rsign=r.DisplayRenderSign.GO_TO_WORLD),this.m_rprocess=this.m_processBuider.getNodeByUid(s),(e.__$ruid>-1||this.m_dataBuilder.buildGpuDisp(e))&&this.m_rprocess.addDisp(e),null!=this.entityManaListener&&this.entityManaListener.addToWorld(t,this.m_rendererUid,s),t.update()}updateWaitList(){let t=this.m_waitList.length,e=null,s=null;for(let a=0;a<t;++a)if(e=this.m_waitList[a],(i.default.RENDERER_LOAD_FLAT&e.__$rseFlag)==i.default.RENDERER_LOAD_FLAT){if(this.testValidData(e)){if(s=e.getDisplay(),s.__$$rsign==r.DisplayRenderSign.LIVE_IN_WORLD&&!this.m_rpoUnitBuilder.testRPNodeNotExists(s.__$ruid,this.m_processUidList[a])){this.m_waitList.splice(a,1),this.m_processUidList.splice(a,1),--t,--a;continue}this.ensureAdd(e,s,this.m_processUidList[a]),this.m_waitList.splice(a,1),this.m_processUidList.splice(a,1),--t,--a}}else s=e.getDisplay(),null!=s&&s.__$$rsign==r.DisplayRenderSign.GO_TO_WORLD&&(s.__$$rsign=r.DisplayRenderSign.NOT_IN_WORLD),e.__$rseFlag=i.default.RemoveRendererLoad(e.__$rseFlag),e.__$rseFlag=i.default.RemoveRendererUid(e.__$rseFlag),e.__$rseFlag=i.default.RemoveSortEnabled(e.__$rseFlag),this.m_waitList.splice(a,1),this.m_processUidList.splice(a,1),--t,--a,null!=this.entityManaListener&&this.entityManaListener.removeFromWorld(e,this.m_rendererUid,-1)}update(){this.m_waitList.length>0&&this.updateWaitList(),this.m_dataBuilder.update()}}e.default=h},1710:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8e17");class r{constructor(){this.phase=0,this.type=0,this.target=null,this.lpos=new i.default,this.wpos=new i.default,this.raytv=new i.default(1,0,0),this.raypv=new i.default(0,0,0),this.mouseX=0,this.mouseY=0,this.mouseViewX=0,this.mouseViewY=0,this.posArray=null,this.wheelDeltaY=0}static GetEvtTypeValueBase(){return 5001}static GetEvtTypeValuesTotal(){return 17}getClassType(){return r.EventClassType}toString(){return"[MouseEvent]"}}r.EventClassType=1002,r.MOUSE_DOWN=5001,r.MOUSE_UP=5002,r.MOUSE_RIGHT_UP=5003,r.MOUSE_RIGHT_DOWN=5004,r.MOUSE_MOVE=5005,r.MOUSE_WHEEL=5006,r.MOUSE_OVER=5007,r.MOUSE_OUT=5008,r.MOUSE_CLICK=5009,r.MOUSE_RIGHT_CLICK=5010,r.MOUSE_DOUBLE_CLICK=5011,r.MOUSE_CANCEL=5012,r.MOUSE_MULTI_DOWN=5013,r.MOUSE_MULTI_UP=5014,r.MOUSE_MULTI_MOVE=5015,r.MOUSE_BG_DOWN=5016,r.MOUSE_BG_UP=5017,e.default=r},"18c7":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("6e01"),r=s("8e17"),a=s("abdb");class h{constructor(t=null,e=0){this.m_uid=-1,this.m_index=0,this.m_fs32=null,this.m_localFS32=null,this.m_index=e,null!=t?(this.m_uid=h.s_uid++,this.m_fs32=t,this.m_localFS32=this.m_fs32.subarray(e,e+16)):(this.m_uid=h.s_isolatedUid++,this.m_fs32=new Float32Array(16),this.m_fs32.set(h.s_InitData,0),this.m_localFS32=this.m_fs32)}getCapacity(){return 16}GetMaxUid(){return h.s_uid}getUid(){return this.m_uid}getLocalFS32(){return this.m_localFS32}getFS32(){return this.m_fs32}getFSIndex(){return this.m_index}identity(){this.m_localFS32.set(h.s_InitData,0)}determinant(){return(this.m_localFS32[0]*this.m_localFS32[5]-this.m_localFS32[4]*this.m_localFS32[1])*(this.m_localFS32[10]*this.m_localFS32[15]-this.m_localFS32[14]*this.m_localFS32[11])-(this.m_localFS32[0]*this.m_localFS32[9]-this.m_localFS32[8]*this.m_localFS32[1])*(this.m_localFS32[6]*this.m_localFS32[15]-this.m_localFS32[14]*this.m_localFS32[7])+(this.m_localFS32[0]*this.m_localFS32[13]-this.m_localFS32[12]*this.m_localFS32[1])*(this.m_localFS32[6]*this.m_localFS32[11]-this.m_localFS32[10]*this.m_localFS32[7])+(this.m_localFS32[4]*this.m_localFS32[9]-this.m_localFS32[8]*this.m_localFS32[5])*(this.m_localFS32[2]*this.m_localFS32[15]-this.m_localFS32[14]*this.m_localFS32[3])-(this.m_localFS32[4]*this.m_localFS32[13]-this.m_localFS32[12]*this.m_localFS32[5])*(this.m_localFS32[2]*this.m_localFS32[11]-this.m_localFS32[10]*this.m_localFS32[3])+(this.m_localFS32[8]*this.m_localFS32[13]-this.m_localFS32[12]*this.m_localFS32[9])*(this.m_localFS32[2]*this.m_localFS32[7]-this.m_localFS32[6]*this.m_localFS32[3])}append(t){let e=t.getLocalFS32(),s=this.m_localFS32,i=s[0],r=s[4],a=s[8],h=s[12],n=s[1],l=s[5],_=s[9],o=s[13],m=s[2],u=s[6],d=s[10],c=s[14],f=s[3],p=s[7],g=s[11],x=s[15],T=e[0],E=e[4],y=e[8],v=e[12],S=e[1],R=e[5],b=e[9],A=e[13],L=e[2],D=e[6],M=e[10],F=e[14],B=e[3],w=e[7],P=e[11],N=e[15];s[0]=i*T+n*E+m*y+f*v,s[1]=i*S+n*R+m*b+f*A,s[2]=i*L+n*D+m*M+f*F,s[3]=i*B+n*w+m*P+f*N,s[4]=r*T+l*E+u*y+p*v,s[5]=r*S+l*R+u*b+p*A,s[6]=r*L+l*D+u*M+p*F,s[7]=r*B+l*w+u*P+p*N,s[8]=a*T+_*E+d*y+g*v,s[9]=a*S+_*R+d*b+g*A,s[10]=a*L+_*D+d*M+g*F,s[11]=a*B+_*w+d*P+g*N,s[12]=h*T+o*E+c*y+x*v,s[13]=h*S+o*R+c*b+x*A,s[14]=h*L+o*D+c*M+x*F,s[15]=h*B+o*w+c*P+x*N}append3x3(t){let e=t.getLocalFS32(),s=this.m_localFS32,i=s[0],r=s[4],a=s[8],h=s[1],n=s[5],l=s[9],_=s[2],o=s[6],m=s[10],u=e[0],d=e[4],c=e[8],f=e[1],p=e[5],g=e[9],x=e[2],T=e[6],E=e[10];s[0]=i*u+h*d+_*c,s[1]=i*f+h*p+_*g,s[2]=i*x+h*T+_*E,s[4]=r*u+n*d+o*c,s[5]=r*f+n*p+o*g,s[6]=r*x+n*T+o*E,s[8]=a*u+l*d+m*c,s[9]=a*f+l*p+m*g,s[10]=a*x+l*T+m*E}appendRotationPivot(t,e,s=null){null==s&&(s=r.default.Z_AXIS),h.s_tMat4.identity(),h.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),h.s_tMat4.appendTranslationXYZ(s.x,s.y,s.z),this.append(h.s_tMat4)}appendRotation(t,e){h.s_tMat4.identity(),h.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),this.append(h.s_tMat4)}appendRotationX(t){h.s_tMat4.rotationX(t),this.append3x3(h.s_tMat4)}appendRotationY(t){h.s_tMat4.rotationY(t),this.append3x3(h.s_tMat4)}appendRotationZ(t){h.s_tMat4.rotationZ(t),this.append3x3(h.s_tMat4)}appendRotationEulerAngle(t,e,s){h.s_tMat4.rotationY(e),this.append3x3(h.s_tMat4),h.s_tMat4.rotationX(t),this.append3x3(h.s_tMat4),h.s_tMat4.rotationZ(s),this.append3x3(h.s_tMat4)}setScaleXYZ(t,e,s){let i=this.m_localFS32;i[0]=t,i[5]=e,i[10]=s}setRotationEulerAngle(t,e,s){let i=this.m_localFS32,r=Math.cos(t),a=Math.sin(t),h=Math.cos(e),n=Math.sin(e),l=Math.cos(s),_=Math.sin(s),o=l*n,m=_*n,u=h*i[0],d=a*i[5],c=r*i[5],f=r*i[10],p=a*i[10];i[1]=_*u,i[2]=-n*i[0],i[0]=l*u,i[4]=o*d-_*c,i[8]=o*f+_*p,i[5]=m*d+l*c,i[9]=m*f-l*p,i[6]=h*d,i[10]=h*f}setRotationEulerAngle2(t,e,s,i,r,a){let h=this.m_localFS32,n=r*i,l=a*i,_=s*h[0],o=e*h[5],m=t*h[5],u=t*h[10],d=e*h[10];h[1]=a*_,h[2]=-i*h[0],h[0]=r*_,h[4]=n*o-a*m,h[8]=n*u+a*d,h[5]=l*o+r*m,h[9]=l*u-r*d,h[6]=s*o,h[10]=s*u}setTranslationXYZ(t,e,s){this.m_localFS32[12]=t,this.m_localFS32[13]=e,this.m_localFS32[14]=s}setTranslation(t){this.m_localFS32[12]=t.x,this.m_localFS32[13]=t.y,this.m_localFS32[14]=t.z}appendScaleXYZ(t,e,s){let i=this.m_localFS32;i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=e,i[5]*=e,i[6]*=e,i[7]*=e,i[8]*=s,i[9]*=s,i[10]*=s,i[11]*=s}appendScaleXY(t,e){this.m_localFS32[0]*=t,this.m_localFS32[1]*=t,this.m_localFS32[2]*=t,this.m_localFS32[3]*=t,this.m_localFS32[4]*=e,this.m_localFS32[5]*=e,this.m_localFS32[6]*=e,this.m_localFS32[7]*=e}appendTranslationXYZ(t,e,s){this.m_localFS32[12]+=t,this.m_localFS32[13]+=e,this.m_localFS32[14]+=s}appendTranslation(t){this.m_localFS32[12]+=t.x,this.m_localFS32[13]+=t.y,this.m_localFS32[14]+=t.z}copyColumnFrom(t,e){switch(t){case 0:this.m_localFS32[0]=e.x,this.m_localFS32[1]=e.y,this.m_localFS32[2]=e.z,this.m_localFS32[3]=e.w;break;case 1:this.m_localFS32[4]=e.x,this.m_localFS32[5]=e.y,this.m_localFS32[6]=e.z,this.m_localFS32[7]=e.w;break;case 2:this.m_localFS32[8]=e.x,this.m_localFS32[9]=e.y,this.m_localFS32[10]=e.z,this.m_localFS32[11]=e.w;break;case 3:this.m_localFS32[12]=e.x,this.m_localFS32[13]=e.y,this.m_localFS32[14]=e.z,this.m_localFS32[15]=e.w;break;default:break}}copyColumnTo(t,e){t<<=2,e.x=this.m_localFS32[t],e.y=this.m_localFS32[1+t],e.z=this.m_localFS32[2+t],e.w=this.m_localFS32[3+t]}setF32ArrAndIndex(t,e=0){null!=t&&e>=0&&(this.m_fs32=t,this.m_index=e,this.m_localFS32=this.m_fs32.subarray(e,e+16))}setF32ArrIndex(t=0){t>=0&&(this.m_index=t,this.m_localFS32=this.m_fs32.subarray(t,t+16))}setF32Arr(t){null!=t&&(this.m_fs32=t)}copyFromF32Arr(t,e=0){let s=0;for(let i=e+16;e<i;e++)this.m_localFS32[s]=t[e],++s}copyToF32Arr(t,e=0){t.set(this.m_localFS32,e)}copyFrom(t){this.m_localFS32.set(t.m_localFS32,0)}copyTo(t){t.m_localFS32.set(this.m_localFS32,0)}copyRawDataFrom(t,e=16,s=0,i=!1){i&&this.transpose(),e-=s;let r=0;while(r<e)this.m_fs32[this.m_index+r]=t[r+s],++r;i&&this.transpose()}copyRawDataTo(t,e=16,s=0,i=!1){i&&this.transpose();let r=0;while(r<e)t[r+s]=this.m_fs32[this.m_index+r],++r;i&&this.transpose()}copyRowFrom(t,e){switch(t){case 0:this.m_localFS32[0]=e.x,this.m_localFS32[4]=e.y,this.m_localFS32[8]=e.z,this.m_localFS32[12]=e.w;break;case 1:this.m_localFS32[1]=e.x,this.m_localFS32[5]=e.y,this.m_localFS32[9]=e.z,this.m_localFS32[13]=e.w;break;case 2:this.m_localFS32[2]=e.x,this.m_localFS32[6]=e.y,this.m_localFS32[10]=e.z,this.m_localFS32[14]=e.w;break;case 3:this.m_localFS32[3]=e.x,this.m_localFS32[7]=e.y,this.m_localFS32[11]=e.z,this.m_localFS32[15]=e.w;break;default:break}}copyRowTo(t,e){e.x=this.m_localFS32[t],e.y=this.m_localFS32[4+t],e.z=this.m_localFS32[8+t],e.w=this.m_localFS32[12+t]}decompose(t){let e=[],s=h.s_tMat4,n=s.getFS32();s.copyFrom(this);let l=new r.default(n[12],n[13],n[14]),_=new r.default;_.x=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),_.y=Math.sqrt(n[4]*n[4]+n[5]*n[5]+n[6]*n[6]),_.z=Math.sqrt(n[8]*n[8]+n[9]*n[9]+n[10]*n[10]),n[0]*(n[5]*n[10]-n[6]*n[9])-n[1]*(n[4]*n[10]-n[6]*n[8])+n[2]*(n[4]*n[9]-n[5]*n[8])<0&&(_.z=-_.z),n[0]/=_.x,n[1]/=_.x,n[2]/=_.x,n[4]/=_.y,n[5]/=_.y,n[6]/=_.y,n[8]/=_.z,n[9]/=_.z,n[10]/=_.z;let o=new r.default;switch(t){case a.default.AXIS_ANGLE:{o.w=i.default.SafeACos((n[0]+n[5]+n[10]-1)/2);let t=Math.sqrt((n[6]-n[9])*(n[6]-n[9])+(n[8]-n[2])*(n[8]-n[2])+(n[1]-n[4])*(n[1]-n[4]));t>i.default.MATH_MIN_POSITIVE?(o.x=(n[6]-n[9])/t,o.y=(n[8]-n[2])/t,o.z=(n[1]-n[4])/t):o.x=o.y=o.z=0}break;case a.default.QUATERNION:{let t=n[0]+n[5]+n[10];t>0?(o.w=Math.sqrt(1+t)/2,o.x=(n[6]-n[9])/(4*o.w),o.y=(n[8]-n[2])/(4*o.w),o.z=(n[1]-n[4])/(4*o.w)):n[0]>n[5]&&n[0]>n[10]?(o.x=Math.sqrt(1+n[0]-n[5]-n[10])/2,o.w=(n[6]-n[9])/(4*o.x),o.y=(n[1]+n[4])/(4*o.x),o.z=(n[8]+n[2])/(4*o.x)):n[5]>n[10]?(o.y=Math.sqrt(1+n[5]-n[0]-n[10])/2,o.x=(n[1]+n[4])/(4*o.y),o.w=(n[8]-n[2])/(4*o.y),o.z=(n[6]+n[9])/(4*o.y)):(o.z=Math.sqrt(1+n[10]-n[0]-n[5])/2,o.x=(n[8]+n[2])/(4*o.z),o.y=(n[6]+n[9])/(4*o.z),o.w=(n[1]-n[4])/(4*o.z))}break;case a.default.EULER_ANGLES:o.y=Math.asin(-n[2]),1!=n[2]&&-1!=n[2]?(o.x=Math.atan2(n[6],n[10]),o.z=Math.atan2(n[1],n[0])):(o.z=0,o.x=Math.atan2(n[4],n[5]));break;default:break}return e.push(l),e.push(o),e.push(_),s=null,e}invert(){let t=this.determinant(),e=Math.abs(t)>i.default.MATH_MIN_POSITIVE;if(e){let e=this.m_localFS32;t=1/t;let s=e[0],i=e[4],r=e[8],a=e[12],h=e[1],n=e[5],l=e[9],_=e[13],o=e[2],m=e[6],u=e[10],d=e[14],c=e[3],f=e[7],p=e[11],g=e[15];e[0]=t*(n*(u*g-d*p)-l*(m*g-d*f)+_*(m*p-u*f)),e[1]=-t*(h*(u*g-d*p)-l*(o*g-d*c)+_*(o*p-u*c)),e[2]=t*(h*(m*g-d*f)-n*(o*g-d*c)+_*(o*f-m*c)),e[3]=-t*(h*(m*p-u*f)-n*(o*p-u*c)+l*(o*f-m*c)),e[4]=-t*(i*(u*g-d*p)-r*(m*g-d*f)+a*(m*p-u*f)),e[5]=t*(s*(u*g-d*p)-r*(o*g-d*c)+a*(o*p-u*c)),e[6]=-t*(s*(m*g-d*f)-i*(o*g-d*c)+a*(o*f-m*c)),e[7]=t*(s*(m*p-u*f)-i*(o*p-u*c)+r*(o*f-m*c)),e[8]=t*(i*(l*g-_*p)-r*(n*g-_*f)+a*(n*p-l*f)),e[9]=-t*(s*(l*g-_*p)-r*(h*g-_*c)+a*(h*p-l*c)),e[10]=t*(s*(n*g-_*f)-i*(h*g-_*c)+a*(h*f-n*c)),e[11]=-t*(s*(n*p-l*f)-i*(h*p-l*c)+r*(h*f-n*c)),e[12]=-t*(i*(l*d-_*u)-r*(n*d-_*m)+a*(n*u-l*m)),e[13]=t*(s*(l*d-_*u)-r*(h*d-_*o)+a*(h*u-l*o)),e[14]=-t*(s*(n*d-_*m)-i*(h*d-_*o)+a*(h*m-n*o)),e[15]=t*(s*(n*u-l*m)-i*(h*u-l*o)+r*(h*m-n*o))}return e}pointAt(t,e,s){null!=e&&void 0!=e||(e=new r.default(0,0,-1)),null!=s&&void 0!=s||(s=new r.default(0,-1,0));let a=e.subtract(t),h=new r.default(s.x,s.y,s.z);a.normalize(),h.normalize();let n=new r.default(a.x,a.y,a.z);n.scaleBy(h.dot(a)),h.subtractBy(n),h.getLength()>i.default.MATH_MIN_POSITIVE?h.normalize():0!=a.x?h.setTo(-a.y,a.x,0):h.setTo(1,0,0);let l=h.crossProduct(a);l.normalize();let _=this.m_localFS32;_[0]=l.x,_[4]=l.y,_[8]=l.z,_[12]=0,_[1]=h.x,_[5]=h.y,_[9]=h.z,_[13]=0,_[2]=a.x,_[6]=a.y,_[10]=a.z,_[14]=0,_[3]=t.x,_[7]=t.y,_[11]=t.z,_[15]=1}prepend(t){let e=t.getLocalFS32(),s=this.m_localFS32,i=e[0],r=e[4],a=e[8],h=e[12],n=e[1],l=e[5],_=e[9],o=e[13],m=e[2],u=e[6],d=e[10],c=e[14],f=e[3],p=e[7],g=e[11],x=e[15],T=s[0],E=s[4],y=s[8],v=s[12],S=s[1],R=s[5],b=s[9],A=s[13],L=s[2],D=s[6],M=s[10],F=s[14],B=s[3],w=s[7],P=s[11],N=s[15];s[0]=i*T+n*E+m*y+f*v,s[1]=i*S+n*R+m*b+f*A,s[2]=i*L+n*D+m*M+f*F,s[3]=i*B+n*w+m*P+f*N,s[4]=r*T+l*E+u*y+p*v,s[5]=r*S+l*R+u*b+p*A,s[6]=r*L+l*D+u*M+p*F,s[7]=r*B+l*w+u*P+p*N,s[8]=a*T+_*E+d*y+g*v,s[9]=a*S+_*R+d*b+g*A,s[10]=a*L+_*D+d*M+g*F,s[11]=a*B+_*w+d*P+g*N,s[12]=h*T+o*E+c*y+x*v,s[13]=h*S+o*R+c*b+x*A,s[14]=h*L+o*D+c*M+x*F,s[15]=h*B+o*w+c*P+x*N}prepend3x3(t){let e=t.getLocalFS32(),s=this.m_localFS32,i=e[0],r=e[4],a=e[8],h=e[1],n=e[5],l=e[9],_=e[2],o=e[6],m=e[10],u=s[0],d=s[4],c=s[8],f=s[1],p=s[5],g=s[9],x=s[2],T=s[6],E=s[10];s[0]=i*u+h*d+_*c,s[1]=i*f+h*p+_*g,s[2]=i*x+h*T+_*E,s[4]=r*u+n*d+o*c,s[5]=r*f+n*p+o*g,s[6]=r*x+n*T+o*E,s[8]=a*u+l*d+m*c,s[9]=a*f+l*p+m*g,s[10]=a*x+l*T+m*E}prependRotationPivot(t,e,s){h.s_tMat4.identity(),h.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),h.s_tMat4.appendTranslationXYZ(s.x,s.y,s.z),this.prepend(h.s_tMat4)}prependRotation(t,e){h.s_tMat4.identity(),h.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),this.prepend(h.s_tMat4)}prependRotationX(t){h.s_tMat4.rotationX(t),this.prepend3x3(h.s_tMat4)}prependRotationY(t){h.s_tMat4.rotationY(t),this.prepend3x3(h.s_tMat4)}prependRotationZ(t){h.s_tMat4.rotationZ(t),this.prepend3x3(h.s_tMat4)}prependRotationEulerAngle(t,e,s){h.s_tMat4.rotationY(e),this.prepend3x3(h.s_tMat4),h.s_tMat4.rotationX(t),this.prepend3x3(h.s_tMat4),h.s_tMat4.rotationZ(s),this.prepend3x3(h.s_tMat4)}prependScale(t,e,s){let i=this.m_localFS32;i[0]*=t,i[1]*=e,i[2]*=s,i[4]*=t,i[5]*=e,i[6]*=s,i[8]*=t,i[9]*=e,i[10]*=s,i[12]*=t,i[13]*=e,i[14]*=s}prependScaleXY(t,e){this.m_localFS32[0]*=t,this.m_localFS32[1]*=e,this.m_localFS32[4]*=t,this.m_localFS32[5]*=e,this.m_localFS32[8]*=t,this.m_localFS32[9]*=e,this.m_localFS32[12]*=t,this.m_localFS32[13]*=e}prependTranslationXYZ(t,e,s){h.s_tMat4.identity(),this.prepend(h.s_tMat4)}prependTranslation(t){h.s_tMat4.identity(),this.prepend(h.s_tMat4)}recompose(t,e){if(t.length<3||0==t[2].x||0==t[2].y||0==t[2].z)return!1;this.identity();let s=h.s_tMat4.getFS32();s[0]=s[1]=s[2]=t[2].x,s[4]=s[5]=s[6]=t[2].y,s[8]=s[9]=s[10]=t[2].z;let i=this.m_localFS32;switch(e){case a.default.EULER_ANGLES:{let e=Math.cos(t[1].x),r=Math.cos(t[1].y),a=Math.cos(t[1].z),h=Math.sin(t[1].x),n=Math.sin(t[1].y),l=Math.sin(t[1].z);i[0]=r*a*s[0],i[1]=r*l*s[1],i[2]=-n*s[2],i[3]=0,i[4]=(h*n*a-e*l)*s[4],i[5]=(h*n*l+e*a)*s[5],i[6]=h*r*s[6],i[7]=0,i[8]=(e*n*a+h*l)*s[8],i[9]=(e*n*l-h*a)*s[9],i[10]=e*r*s[10],i[11]=0,i[12]=t[0].x,i[13]=t[0].y,i[14]=t[0].z,i[15]=1}break;default:{let r=t[1].x,h=t[1].y,n=t[1].z,l=t[1].w;if(e==a.default.AXIS_ANGLE){let t=.5*l;r*=Math.sin(t),h*=Math.sin(t),n*=Math.sin(t),l=Math.cos(t)}i[0]=(1-2*h*h-2*n*n)*s[0],i[1]=(2*r*h+2*l*n)*s[1],i[2]=(2*r*n-2*l*h)*s[2],i[3]=0,i[4]=(2*r*h-2*l*n)*s[4],i[5]=(1-2*r*r-2*n*n)*s[5],i[6]=(2*h*n+2*l*r)*s[6],i[7]=0,i[8]=(2*r*n+2*l*h)*s[8],i[9]=(2*h*n-2*l*r)*s[9],i[10]=(1-2*r*r-2*h*h)*s[10],i[11]=0,i[12]=t[0].x,i[13]=t[0].y,i[14]=t[0].z,i[15]=1}break}return 0==t[2].x&&(this.m_localFS32[0]=0),0==t[2].y&&(this.m_localFS32[5]=0),0==t[2].z&&(this.m_localFS32[10]=0),s=null,!0}deltaTransformVector(t){let e=t.x,s=t.y,i=t.z;return new r.default(e*this.m_localFS32[0]+s*this.m_localFS32[4]+i*this.m_localFS32[8],e*this.m_localFS32[1]+s*this.m_localFS32[5]+i*this.m_localFS32[9],e*this.m_localFS32[2]+s*this.m_localFS32[6]+i*this.m_localFS32[10],0)}deltaTransformVectorSelf(t){let e=this.m_localFS32,s=t.x,i=t.y,r=t.z;t.x=s*e[0]+i*e[4]+r*e[8],t.y=s*e[1]+i*e[5]+r*e[9],t.z=s*e[2]+i*e[6]+r*e[10]}deltaTransformOutVector(t,e){let s=this.m_localFS32;e.x=t.x*s[0]+t.y*s[4]+t.z*s[8],e.y=t.x*s[1]+t.y*s[5]+t.z*s[9],e.z=t.x*s[2]+t.y*s[6]+t.z*s[10]}transformVector(t){let e=this.m_localFS32,s=t.x,i=t.y,a=t.z;return new r.default(s*e[0]+i*e[4]+a*e[8]+e[12],s*e[1]+i*e[5]+a*e[9]+e[13],s*e[2]+i*e[6]+a*e[10]+e[14],s*e[3]+i*e[7]+a*e[11]+e[15])}transformOutVector(t,e){let s=t.x,i=t.y,r=t.z,a=this.m_localFS32;e.setTo(s*a[0]+i*a[4]+r*a[8]+a[12],s*a[1]+i*a[5]+r*a[9]+a[13],s*a[2]+i*a[6]+r*a[10]+a[14],s*a[3]+i*a[7]+r*a[11]+a[15])}transformOutVector3(t,e){let s=this.m_localFS32;e.x=t.x*s[0]+t.y*s[4]+t.z*s[8]+s[12],e.y=t.x*s[1]+t.y*s[5]+t.z*s[9]+s[13],e.z=t.x*s[2]+t.y*s[6]+t.z*s[10]+s[14]}transformVector3Self(t){let e=t.x,s=t.y,i=t.z,r=this.m_localFS32;t.x=e*r[0]+s*r[4]+i*r[8]+r[12],t.y=e*r[1]+s*r[5]+i*r[9]+r[13],t.z=e*r[2]+s*r[6]+i*r[10]+r[14]}transformVectorSelf(t){let e=t.x,s=t.y,i=t.z,r=this.m_localFS32;t.setTo(e*r[0]+s*r[4]+i*r[8]+r[12],e*r[1]+s*r[5]+i*r[9]+r[13],e*r[2]+s*r[6]+i*r[10]+r[14],e*r[3]+s*r[7]+i*r[11]+r[15])}transformVectors(t,e,s){let i,r,a,h=0,n=this.m_localFS32;e-=3;while(h<=e)i=t[h],r=t[h+1],a=t[h+2],s[h]=i*n[0]+r*n[4]+a*n[8]+n[12],s[h+1]=i*n[1]+r*n[5]+a*n[9]+n[13],s[h+2]=i*n[2]+r*n[6]+a*n[10]+n[14],h+=3}transformVectorsSelf(t,e){let s,i,r,a=0,h=this.m_localFS32;e-=3;while(a<=e)s=t[a],i=t[a+1],r=t[a+2],t[a]=s*h[0]+i*h[4]+r*h[8]+h[12],t[a+1]=s*h[1]+i*h[5]+r*h[9]+h[13],t[a+2]=s*h[2]+i*h[6]+r*h[10]+h[14],a+=3}transformVectorsRangeSelf(t,e,s){let i,r,a,h=e,n=this.m_localFS32;s-=3;while(h<=s)i=t[h],r=t[h+1],a=t[h+2],t[h]=i*n[0]+r*n[4]+a*n[8]+n[12],t[h+1]=i*n[1]+r*n[5]+a*n[9]+n[13],t[h+2]=i*n[2]+r*n[6]+a*n[10]+n[14],h+=3}transpose(){h.s_tMat4.copyFrom(this);let t=h.s_tMat4.getFS32(),e=this.m_localFS32;e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11]}interpolateTo(t,e){let s=t.getFS32(),i=t.getFSIndex(),r=0,a=this.m_index;while(r<16)this.m_fs32[a]+=(s[i+r]-this.m_fs32[a])*e,++a,++r}getAxisRotation(t,e,s,i){i=-i;let r=this.m_localFS32,a=Math.sin(i),h=Math.cos(i),n=1-h;r[0]=h+t*t*n,r[5]=h+e*e*n,r[10]=h+s*s*n;let l=t*e*n,_=s*a;r[4]=l+_,r[1]=l-_,l=t*s*n,_=e*a,r[8]=l-_,r[2]=l+_,l=e*s*n,_=t*a,r[9]=l+_,r[6]=l-_}rotationX(t){let e=Math.sin(t),s=Math.cos(t);this.m_localFS32[0]=1,this.m_localFS32[1]=0,this.m_localFS32[2]=0,this.m_localFS32[4]=0,this.m_localFS32[5]=s,this.m_localFS32[6]=e,this.m_localFS32[8]=0,this.m_localFS32[9]=-e,this.m_localFS32[10]=s}rotationY(t){let e=Math.sin(t),s=Math.cos(t);this.m_localFS32[0]=s,this.m_localFS32[1]=0,this.m_localFS32[2]=-e,this.m_localFS32[4]=0,this.m_localFS32[5]=1,this.m_localFS32[6]=0,this.m_localFS32[8]=e,this.m_localFS32[9]=0,this.m_localFS32[10]=s}rotationZ(t){let e=Math.sin(t),s=Math.cos(t);this.m_localFS32[0]=s,this.m_localFS32[1]=e,this.m_localFS32[2]=0,this.m_localFS32[4]=-e,this.m_localFS32[5]=s,this.m_localFS32[6]=0,this.m_localFS32[8]=0,this.m_localFS32[9]=0,this.m_localFS32[10]=1}toString(){let t="\n"+this.m_localFS32[0]+","+this.m_localFS32[1]+","+this.m_localFS32[2]+","+this.m_localFS32[3]+"\n";return t+=this.m_localFS32[4]+","+this.m_localFS32[5]+","+this.m_localFS32[6]+","+this.m_localFS32[7]+"\n",t+=this.m_localFS32[8]+","+this.m_localFS32[9]+","+this.m_localFS32[10]+","+this.m_localFS32[11]+"\n",t+=this.m_localFS32[12]+","+this.m_localFS32[13]+","+this.m_localFS32[14]+","+this.m_localFS32[15]+"\n",t}transformPerspV4Self(t){t.w=t.z,t.x*=this.m_localFS32[0],t.y*=this.m_localFS32[5],t.z*=this.m_localFS32[10],t.z+=this.m_localFS32[14],t.w*=this.m_localFS32[11],t.w+=this.m_localFS32[15]}perspectiveRH(t,e,s,i){let r=Math.tan(.5*t);this.identity(),this.m_localFS32[0]=1/(e*r),this.m_localFS32[5]=1/r,this.m_localFS32[10]=-(i+s)/(i-s),this.m_localFS32[11]=-1,this.m_localFS32[14]=-2*i*s/(i-s)}perspectiveRH2(t,e,s,i,r){let a=e/Math.tan(.5*t),h=a/e,n=a/s,l=-r/(r-i),_=-i*l;this.identity(),this.m_localFS32[0]=h,this.m_localFS32[5]=n,this.m_localFS32[10]=l,this.m_localFS32[11]=-1,this.m_localFS32[14]=_}orthoRH(t,e,s,i,r,a){this.identity(),this.m_localFS32[0]=2/(i-s),this.m_localFS32[5]=2/(e-t),this.m_localFS32[10]=-2/(a-r),this.m_localFS32[12]=-(i+s)/(i-s),this.m_localFS32[13]=-(e+t)/(e-t),this.m_localFS32[14]=-(a+r)/(a-r),this.m_localFS32[15]=1}perspectiveLH(t,e,s,i){let r=Math.tan(.5*t);this.identity(),this.m_localFS32[0]=1/(e*r),this.m_localFS32[5]=1/r,this.m_localFS32[10]=(i+s)/(i-s),this.m_localFS32[11]=1,this.m_localFS32[14]=2*i*s/(i-s)}orthoLH(t,e,s,i,r,a){this.identity(),this.m_localFS32[0]=2/(i-s),this.m_localFS32[5]=2/(e-t),this.m_localFS32[10]=2/(a-r),this.m_localFS32[12]=-(i+s)/(i-s),this.m_localFS32[13]=-(e+t)/(e-t),this.m_localFS32[14]=-(a+r)/(a-r),this.m_localFS32[15]=1}lookAtRH(t,e,s){this.identity();let i=e.subtract(t);i.normalize();let r=i.crossProduct(s);r.normalize();let a=r.crossProduct(i);r.w=-r.dot(t),a.w=-a.dot(t),i.w=i.dot(t),i.negate(),this.copyRowFrom(0,r),this.copyRowFrom(1,a),this.copyRowFrom(2,i)}lookAtLH(t,e,s){this.identity();let i=e.subtract(t);i.normalize();let r=i.crossProduct(s);r.normalize();let a=r.crossProduct(i);r.w=-r.dot(t),a.w=-a.dot(t),i.w=-i.dot(t),this.copyRowFrom(0,r),this.copyRowFrom(1,a),this.copyRowFrom(2,i)}destroy(){this.m_localFS32=null,this.m_fs32=null,this.m_index=-1}}h.s_InitData=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),h.s_uid=0,h.s_isolatedUid=327679,h.s_tMat4=new h,e.default=h},"1e15":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8a0a"),r=s("030e");class a{constructor(){this.m_rcuid=0,this.m_glVer=2,this.m_rc=null,this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.vroUid=0,this.rioUid=0}getRC(){return this.m_rc}getRCUid(){return this.m_rcuid}createBuf(){return this.m_rc.createBuffer()}deleteBuf(t){this.m_rc.deleteBuffer(t)}bindArrBuf(t){this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,t)}bindEleBuf(t){this.m_rc.bindBuffer(this.m_rc.ELEMENT_ARRAY_BUFFER,t)}arrBufSubData(t,e){this.m_rc.bufferSubData(this.m_rc.ARRAY_BUFFER,e,t)}arrBufData(t,e){this.m_rc.bufferData(this.m_rc.ARRAY_BUFFER,t,i.default.ToGL(this.m_rc,e))}eleBufSubData(t,e){this.m_rc.bufferSubData(this.m_rc.ELEMENT_ARRAY_BUFFER,e,t)}eleBufData(t,e){this.m_rc.bufferData(this.m_rc.ELEMENT_ARRAY_BUFFER,t,i.default.ToGL(this.m_rc,e))}arrBufDataMem(t,e){this.m_rc.bufferData(this.m_rc.ARRAY_BUFFER,t,i.default.ToGL(this.m_rc,e))}eleBufDataMem(t,e){this.m_rc.bufferData(this.m_rc.ELEMENT_ARRAY_BUFFER,t,i.default.ToGL(this.m_rc,e))}useVtxAttribsPtrTypeFloat(t,e,s,i,r,a){this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,e);for(let h=0;h<i;++h)t.vertexAttribPointerTypeFloat(s[h],a,r[h])}useVtxAttribsPtrTypeFloatMulti(t,e,s,i,r,a){for(let h=0;h<i;++h)this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,e[h]),t.vertexAttribPointerTypeFloat(s[h],a,r[h])}createVertexArray(){let t=null;return t=2==this.m_glVer?this.m_rc.createVertexArray():r.default.OES_vertex_array_object.createVertexArrayOES(),t}bindVertexArray(t){return 2==this.m_glVer?this.m_rc.bindVertexArray(t):r.default.OES_vertex_array_object.bindVertexArrayOES(t),t}deleteVertexArray(t){2==this.m_glVer?this.m_rc.deleteVertexArray(t):r.default.OES_vertex_array_object.deleteVertexArrayOES(t)}testVROUid(t){return this.vroUid!=t&&(this.vroUid=t,!0)}testRIOUid(t){return this.rioUid!=t&&(this.rioUid=t,!0)}initialize(t,e,s){this.m_rc=e,this.m_rcuid=t,this.m_glVer=s;let i=this;i.RGBA=e.RGBA,i.UNSIGNED_BYTE=e.UNSIGNED_BYTE,i.TRIANGLE_STRIP=e.TRIANGLE_STRIP,i.TRIANGLE_FAN=e.TRIANGLE_FAN,i.TRIANGLES=e.TRIANGLES,i.LINES=this.m_rc.LINES,i.LINE_STRIP=e.LINE_STRIP,i.UNSIGNED_SHORT=e.UNSIGNED_SHORT,i.UNSIGNED_INT=e.UNSIGNED_INT,i.COLOR=e.COLOR,i.DEPTH=e.DEPTH,i.STENCIL=e.STENCIL,i.DEPTH_STENCIL=e.DEPTH_STENCIL,this.m_glVer>1?(i.MIN=e.MIN,i.MAX=e.MAX):(i.MIN=r.default.EXT_blend_minmax.MIN_EXT,i.MAX=r.default.EXT_blend_minmax.MAX_EXT),i.RContext=e}renderBegin(){this.vroUid=-2,this.rioUid=-3}toString(){return"[Object ROVtxBuilder()]"}}e.default=a},"1eb2":function(t,e,s){"use strict";if("undefined"!==typeof window){var i=window.document.currentScript,r=s("8875");i=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var a=i&&i.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(s.p=a[1])}},"20ef":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("352a"),r=s("8a0a");class a{constructor(t){this.m_shdData=null,this.m_uid=-1,this.m_program=null,this.m_rcuid=-1,this.m_gl=null,this.m_shdUniqueName="",this.m_texTotal=0,this.m_aLocations=null,this.m_aLocationTypes=null,this.m_aLocationSizes=null,this.m_uLocations=null,this.m_texLocations=null,this.m_attribLIndexList=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.m_attribTypeSizeList=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.m_uniformDict=new Map,this.m_uLocationDict=new Map,this.m_vtxShd=null,this.m_frgShd=null,this.dataUniformEnabled=!1,this.m_attrid=0,this.m_attridIndex=0,this.m_uLc=null,this.m_uIndex=0,this.m_uid=t}setShdData(t){this.m_shdData=t,this.m_shdUniqueName=t.getUniqueShaderName()}getUid(){return this.m_uid}getTexTotal(){return this.m_shdData.getTexTotal()}useTexLocation(){for(let t=0;t<this.m_texTotal;t++)this.m_gl.uniform1i(this.m_texLocations[t],t)}haveTexture(){return this.m_shdData.haveTexture()}createLocations(){let t=0,e=0,s=this.m_shdData.getAttriNSList();if(null!=s&&s.length>0&&null==this.m_aLocations){this.dataUniformEnabled=!1;let a=this.m_shdData.getAttriSizeList();this.m_aLocations=[],this.m_aLocationTypes=[],this.m_aLocationSizes=[],e=s.length;let h=0,n=0;while(t<e)n=this.m_gl.getAttribLocation(this.m_program,s[t]),this.m_aLocations.push(n),h=r.default.GetVBufAttributeTypeByNS(s[t]),this.m_aLocationTypes.push(h),this.m_aLocationSizes.push(a[t]),this.m_attribLIndexList[h]=n,this.m_attribTypeSizeList[h]=a[t],this.dataUniformEnabled=!0,++t;i.default.SHADERCODE_TRACE_ENABLED&&(console.log("ShdProgram("+this.m_uid+")::createLocations(), attri aLocationTypes: "+this.m_aLocationTypes),console.log("ShdProgram("+this.m_uid+")::createLocations(), attri m_aLocations: "+this.m_aLocations),console.log("ShdProgram("+this.m_uid+")::createLocations(), attriNSList: "+s),console.log("ShdProgram("+this.m_uid+")::createLocations(), m_attribLIndexList: "+this.m_attribLIndexList))}if(this.m_shdData.haveCommonUniform()&&null==this.m_uLocations){let s=this.m_shdData.getUniforms();this.m_uLocations=[],e=s.length,t=0;let r=null,a="";while(t<e)s[t].isTex||(a=s[t].name,r=this.m_gl.getUniformLocation(this.m_program,a),i.default.SHADERCODE_TRACE_ENABLED&&console.log("ShdProgram::createLocations() uniform, ul "+r+", uninforms["+t+"].name: "+a),null!=r?(s[t].location=r,this.m_uniformDict.set(a,s[t]),this.m_uLocationDict.set(a,r),this.m_uLocations.push(r),this.dataUniformEnabled=!0):i.default.SHADERCODE_TRACE_ENABLED&&console.warn("uniform ",a," was not used!")),++t}if(this.m_texTotal=this.m_shdData.getTexTotal(),this.m_texTotal>0){this.m_texLocations=new Array(this.m_texTotal);let e=this.m_shdData.getTexUniformNames();for(t=0;t<this.m_texTotal;++t)this.m_texLocations[t]=this.m_gl.getUniformLocation(this.m_program,e[t])}}getLayoutBit(){return this.m_shdData.getLayoutBit()}getFragOutputTotal(){return this.m_shdData.getFragOutputTotal()}getLocationsTotal(){return this.m_aLocationTypes.length}getLocationTypeByIndex(t){return this.m_aLocationTypes[t]}getLocationSizeByIndex(t){return this.m_aLocationSizes[t]}vertexAttribPointerType(t,e,s,i,r,a){this.m_attrid=this.m_attribLIndexList[t],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,this.m_attribTypeSizeList[t],s,i,r,a))}vertexAttribPointerTypeFloat(t,e,s){this.m_attrid=this.m_attribLIndexList[t],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,this.m_attribTypeSizeList[t],this.m_gl.FLOAT,!1,e,s))}testVertexAttribPointerType(t){return this.m_attribLIndexList[t]>-1}getVertexAttribByTpye(t){return this.m_attribLIndexList[t]}vertexAttribPointerAt(t,e,s,i,r,a){this.m_attridIndex=t,this.m_attrid=this.m_aLocations[t],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,e,s,i,r,a))}vertexAttribPointerNext(t,e,s,i,r){this.m_attrid=this.m_aLocations[this.m_attridIndex],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,t,e,s,i,r)),this.m_attridIndex++}vertexAttribPointerFirst(t,e,s,i,r){this.m_attridIndex=1,this.m_attrid=this.m_aLocations[0],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,t,e,s,i,r))}getUniformLocationAt(t){return this.m_uIndex=t+1,this.m_uLocations[t]}getUniformLocationNext(){return this.m_uLc=this.m_uLocations[this.m_uIndex++],this.m_uLc}getUniformLocationFirst(){return this.m_uIndex=1,this.m_uLocations[0]}getUniformLocationByNS(t){return this.m_uLocationDict.get(t)}getUniformTypeNameByNS(t){let e=this.m_uniformDict.get(t);return null!=e?e.typeName:""}getUniformTypeByNS(t){let e=this.m_uniformDict.get(t);return null!=e?e.type:0}hasUniformByName(t){return this.m_uniformDict.has(t)}getUniformLengthByNS(t){return this.m_uniformDict.has(t)&&this.m_uniformDict.get(t).arrLength,0}initShdProgram(){let t,e=this.m_shdData.getVSCodeStr(),s=this.m_shdData.getFSCodeStr();i.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(e.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),e=e.replace(t," highp ")),e.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),e=e.replace(t," highp "))),i.default.SHADERCODE_TRACE_ENABLED&&console.log("vshd_str: \n"+e);let r=this.loadShader(this.m_gl.VERTEX_SHADER,e);i.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(s.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),s=s.replace(t," highp ")),s.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),s=s.replace(t," highp "))),i.default.SHADERCODE_TRACE_ENABLED&&console.log("fshd_str: \n"+s);let a=this.loadShader(this.m_gl.FRAGMENT_SHADER,s),h=this.m_gl.createProgram();return this.m_gl.attachShader(h,a),this.m_gl.attachShader(h,r),this.m_gl.linkProgram(h),this.m_gl.getProgramParameter(h,this.m_gl.LINK_STATUS)?(this.m_vtxShd=r,this.m_frgShd=a,h):(i.default.SHADERCODE_TRACE_ENABLED&&console.log("Unable to initialize the shader program: "+this.m_gl.getProgramInfoLog(h)),null)}loadShader(t,e){let s=this.m_gl.createShader(t);return this.m_gl.shaderSource(s,e),this.m_gl.compileShader(s),this.m_gl.getShaderParameter(s,this.m_gl.COMPILE_STATUS)?s:(i.default.SHADERCODE_TRACE_ENABLED&&console.log("An error occurred compiling the shaders: "+this.m_gl.getShaderInfoLog(s)),this.m_gl.deleteShader(s),null)}getUniqueShaderName(){return this.m_shdUniqueName}enabled(){return null!=this.m_program}upload(t,e){null==this.m_program&&(this.m_rcuid=e,this.m_gl=t,this.m_program=this.initShdProgram(),null!=this.m_program&&this.createLocations())}getRCUid(){return this.m_rcuid}uniformBlockBinding(t,e){this.m_gl.uniformBlockBinding(this.m_program,this.m_gl.getUniformBlockIndex(this.m_program,t),e)}toString(){return"[ShdProgram(uniqueName = "+this.m_shdUniqueName+")]"}getProgram(){return this.m_program}destroy(){this.m_aLocations=null,this.m_texTotal>0&&(this.m_texLocations.fill(null),this.m_texTotal=0),null!=this.m_program&&(this.m_gl.deleteShader(this.m_vtxShd),this.m_gl.deleteShader(this.m_frgShd),this.m_vtxShd=null,this.m_frgShd=null,this.m_gl.deleteProgram(this.m_program),this.m_program=null),this.m_gl=null,this.m_shdData=null}}e.default=a},2139:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("18c7");class r{static GetMatTotal(){return r.s_mtotal}static GetFS32Arr(){return r.s_mfs32Arr}static SetFS32Arr(t){r.s_mfs32Arr=t;let e=r.s_mtotal,s=r.s_matList;for(let i=0;i<e;++i)s[i].setF32Arr(t)}static GetFreeId(){return r.m_freeIdList.length>0?r.m_freeIdList.pop():-1}static Allocate(t){if(t<512&&(t=512),r.s_mtotal<1){r.s_mtotal=t,r.s_mfs32Arr=new Float32Array(16*t);let e=0,s=new i.default(r.s_mfs32Arr,16*e),a=s.getUid();for(r.s_baseUid=a,r.s_maxUid=a+t;e<a;++e)r.s_matList.push(null),r.s_matFlagList.push(r.S_FLAG_FREE);for(r.s_matList.push(s),r.s_matFlagList.push(r.S_FLAG_FREE),r.m_freeIdList.push(s.getUid()),e=1;e<t;++e)s=new i.default(r.s_mfs32Arr,16*e),r.s_matList.push(s),r.s_matFlagList.push(r.S_FLAG_FREE),r.m_freeIdList.push(s.getUid())}}static GetMatrix(){let t=null,e=r.GetFreeId()-r.s_baseUid;return e>=0?(t=r.s_matList[e],t.identity(),r.s_matFlagList[e]=r.S_FLAG_BUSY):t=new i.default,t}static RetrieveMatrix(t){if(null!=t){let e=t.getUid();e>=r.s_baseUid&&e<r.s_maxUid&&r.s_matFlagList[e-r.s_baseUid]==r.S_FLAG_BUSY&&(r.m_freeIdList.push(e),r.s_matFlagList[e-r.s_baseUid]=r.S_FLAG_FREE)}}}r.S_FLAG_BUSY=1,r.S_FLAG_FREE=0,r.s_matList=[],r.s_matFlagList=[],r.m_freeIdList=[],r.s_mfs32Arr=null,r.s_baseUid=0,r.s_maxUid=0,r.s_mtotal=0,e.default=r},2560:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("ab73"),r=s("7279");class a{create(t,e){let s=null,a=t.getCamera();return e.hasUniformByName(i.default.CameraViewMatUNS)&&e.hasUniformByName(i.default.CameraProjectiveMatUNS)?(s=new r.default,s.uniformNameList=[i.default.CameraViewMatUNS,i.default.CameraProjectiveMatUNS],s.copyDataFromProbe(a.matUProbe)):e.hasUniformByName(i.default.CameraViewMatUNS)?(s=new r.default,s.uniformNameList=[i.default.CameraViewMatUNS],s.copyDataFromProbeAt(0,a.matUProbe)):e.hasUniformByName(i.default.CameraProjectiveMatUNS)&&(s=new r.default,s.uniformNameList=[i.default.CameraProjectiveMatUNS],s.copyDataFromProbeAt(1,a.matUProbe)),s}getIDNS(){return"CameraUniformBuilder"}}e.default=a},"264c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.m_begin=null,this.m_end=null,this.m_next=null,this.m_node=null,this.m_nodes=[],this.m_nodesTotal=0,this.m_shader=null,this.m_renderTotal=0,this.m_sorter=null,this.sortEnabled=!0,this.m_shader=t}setSorter(t){this.m_sorter=t}showInfo(){let t="",e=this.m_begin;while(null!=e)t+=e.unit.value+",",e=e.next;console.log("RenderSortBlock info: \n",t)}clear(){if(null!=this.m_shader){this.m_nodes.length>0&&(this.m_nodes=[]);let t=this.m_begin,e=null;while(null!=t)e=t,t=t.next,e.prev=null,e.next=null;this.m_begin=this.m_end=null,this.m_nodesTotal=0,this.m_renderTotal=0,this.sortEnabled=!0,this.m_shader=null}this.m_sorter=null}update(){this.sortEnabled&&this.sort()}run(t){this.m_shader.resetUniform();let e=null,s=this.m_nodes;for(let i=0;i<this.m_renderTotal;++i)e=s[i],this.m_shader.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t)}runLockMaterial(t){this.m_shader.resetUniform();let e=null,s=this.m_nodes;for(let i=0;i<this.m_renderTotal;++i)e=s[i],this.m_shader.bindToGpu(e.shdUid),e.vro.run(),e.runLockMaterial2(),e.partTotal<1?e.drawThis(t):e.drawPart(t)}sort(){if(this.m_nodesTotal>0){let t=this.m_begin;this.m_nodes.length<this.m_nodesTotal&&(this.m_nodes=new Array(Math.round(1.1*this.m_nodesTotal)+1));let e=0;while(null!=t)t.drawEnabled&&t.unit.drawEnabled&&(this.m_nodes[e]=t.unit,++e),t=t.next;this.m_renderTotal=e;let s=0;null!=this.m_sorter&&(s=this.m_sorter.sortRODisplay(this.m_nodes,e)),s<1&&this.snsort(0,e-1)}}sorting(t,e){let s=this.m_nodes;this.m_node=s[t];let i=this.m_node.value;while(t<e){while(t<e&&s[e].value>=i)--e;s[t]=s[e];while(t<e&&s[t].value<=i)++t;s[e]=s[t]}return s[t]=this.m_node,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}getNodesTotal(){return this.m_nodesTotal}getBegin(){return this.m_next=this.m_begin,this.m_begin}getNext(){return null!=this.m_next&&(this.m_next=this.m_next.next),this.m_next}isEmpty(){return this.m_nodesTotal<1}addNode(t){null==t.prev&&null==t.next&&(null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null,this.m_nodesTotal++)}removeNode(t){null==t.prev&&null==t.next&&t!=this.m_begin||(t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null,this.m_nodesTotal--)}}e.default=i},"265e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.__$ruid=-1,this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.prev=null,this.next=null,this.unit=null,this.vro=null,this.tro=null,this.rvroI=-1,this.rtroI=-1}setValue(t){this.unit.value=t}isVsible(){return null==this.unit||this.unit.drawEnabled}updateData(){let t=this.unit;this.drawMode=t.drawMode,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,this.vtxUid=t.vtxUid,this.vro=t.vro,this.shdUid=t.shdUid,this.texMid=t.texMid,this.tro=t.tro}reset(){this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.unit=null,this.vro=null,this.tro=null,this.prev=null,this.next=null}toString(){return"[Object RPONode(uid = "+this.uid+", index = "+this.index+", shdUid = "+this.shdUid+", vtxUid = "+this.vtxUid+")]"}}e.default=i},"29ef":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("7c63"),r=s("e08e");class a{static Initialize(){a.s_initBoo&&(a.s_initBoo=!1,a.Rstate=new i.RODrawState,i.RenderColorMask.Rstate=a.Rstate,i.RenderStateObject.Rstate=a.Rstate,a.ALL_TRUE_COLOR_MASK=i.RenderColorMask.Create("all_true",!0,!0,!0,!0),a.ALL_FALSE_COLOR_MASK=i.RenderColorMask.Create("all_false",!1,!1,!1,!1),a.BACK_CULLFACE_NORMAL_STATE=i.RenderStateObject.Create("normal",r.CullFaceMode.BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.RENDER_OPAQUE),a.FRONT_CULLFACE_NORMAL_STATE=i.RenderStateObject.Create("front_normal",r.CullFaceMode.FRONT,r.RenderBlendMode.NORMAL,r.DepthTestMode.RENDER_OPAQUE),a.NONE_CULLFACE_NORMAL_STATE=i.RenderStateObject.Create("none_normal",r.CullFaceMode.NONE,r.RenderBlendMode.NORMAL,r.DepthTestMode.RENDER_OPAQUE),a.ALL_CULLFACE_NORMAL_STATE=i.RenderStateObject.Create("all_cull_normal",r.CullFaceMode.FRONT_AND_BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.RENDER_OPAQUE),a.BACK_NORMAL_ALWAYS_STATE=i.RenderStateObject.Create("back_normal_always",r.CullFaceMode.BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.RENDER_ALWAYS),a.BACK_TRANSPARENT_STATE=i.RenderStateObject.Create("back_transparent",r.CullFaceMode.BACK,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.RENDER_TRANSPARENT_SORT),a.BACK_TRANSPARENT_ALWAYS_STATE=i.RenderStateObject.Create("back_transparent_always",r.CullFaceMode.BACK,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.RENDER_ALWAYS),a.NONE_TRANSPARENT_STATE=i.RenderStateObject.Create("none_transparent",r.CullFaceMode.NONE,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.RENDER_TRANSPARENT_SORT),a.NONE_TRANSPARENT_ALWAYS_STATE=i.RenderStateObject.Create("none_transparent_always",r.CullFaceMode.NONE,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.RENDER_ALWAYS),a.FRONT_CULLFACE_GREATER_STATE=i.RenderStateObject.Create("front_greater",r.CullFaceMode.FRONT,r.RenderBlendMode.NORMAL,r.DepthTestMode.RENDER_TRUE_GREATER),a.BACK_ADD_BLENDSORT_STATE=i.RenderStateObject.Create("back_add_blendSort",r.CullFaceMode.BACK,r.RenderBlendMode.ADD,r.DepthTestMode.RENDER_TRANSPARENT_SORT),a.BACK_ADD_ALWAYS_STATE=i.RenderStateObject.Create("back_add_always",r.CullFaceMode.BACK,r.RenderBlendMode.ADD,r.DepthTestMode.RENDER_ALWAYS),a.BACK_ALPHA_ADD_ALWAYS_STATE=i.RenderStateObject.Create("back_alpha_add_always",r.CullFaceMode.BACK,r.RenderBlendMode.ALPHA_ADD,r.DepthTestMode.RENDER_ALWAYS),a.NONE_ADD_ALWAYS_STATE=i.RenderStateObject.Create("none_add_always",r.CullFaceMode.NONE,r.RenderBlendMode.ADD,r.DepthTestMode.RENDER_ALWAYS),a.NONE_ADD_BLENDSORT_STATE=i.RenderStateObject.Create("none_add_blendSort",r.CullFaceMode.NONE,r.RenderBlendMode.ADD,r.DepthTestMode.RENDER_TRANSPARENT_SORT),a.NONE_ALPHA_ADD_ALWAYS_STATE=i.RenderStateObject.Create("none_alpha_add_always",r.CullFaceMode.NONE,r.RenderBlendMode.ALPHA_ADD,r.DepthTestMode.RENDER_ALWAYS),a.FRONT_ADD_ALWAYS_STATE=i.RenderStateObject.Create("front_add_always",r.CullFaceMode.FRONT,r.RenderBlendMode.ADD,r.DepthTestMode.RENDER_ALWAYS),a.FRONT_TRANSPARENT_STATE=i.RenderStateObject.Create("front_transparent",r.CullFaceMode.FRONT,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.RENDER_TRANSPARENT_SORT),a.FRONT_TRANSPARENT_ALWAYS_STATE=i.RenderStateObject.Create("front_transparent_always",r.CullFaceMode.FRONT,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.RENDER_ALWAYS),a.NONE_CULLFACE_NORMAL_ALWAYS_STATE=i.RenderStateObject.Create("none_normal_always",r.CullFaceMode.NONE,r.RenderBlendMode.NORMAL,r.DepthTestMode.RENDER_ALWAYS))}static CreateRenderState(t,e,s,r){return i.RenderStateObject.Create(t,e,s,r)}static CreateRenderColorMask(t,e,s,r,a){return i.RenderColorMask.Create(t,e,s,r,a)}static GetRenderStateByName(t){return i.RenderStateObject.GetRenderStateByName(t)}static GetRenderColorMaskByName(t){return i.RenderColorMask.GetColorMaskByName(t)}static UnlockBlendMode(){i.RenderStateObject.UnlockBlendMode()}static LockBlendMode(t){i.RenderStateObject.LockBlendMode(t)}static UnlockDepthTestMode(){i.RenderStateObject.UnlockDepthTestMode()}static LockDepthTestMode(t){i.RenderStateObject.LockDepthTestMode(t)}static Reset(t){i.RenderColorMask.Reset(),i.RenderStateObject.Reset(),a.Rstate.reset(),a.Rstate.setRenderer(t)}static SetDrawState(t){i.RenderColorMask.Rstate=t,i.RenderStateObject.Rstate=t}static ResetInfo(){a.DrawCallTimes=0,a.DrawTrisNumber=0,a.POVNumber=0}}a.s_initBoo=!0,a.Rstate=null,a.DrawCallTimes=0,a.DrawTrisNumber=0,a.POVNumber=0,a.ALL_TRUE_COLOR_MASK=0,a.ALL_FALSE_COLOR_MASK=1,a.NORMAL_STATE=0,a.BACK_CULLFACE_NORMAL_STATE=0,a.FRONT_CULLFACE_NORMAL_STATE=1,a.NONE_CULLFACE_NORMAL_STATE=2,a.ALL_CULLFACE_NORMAL_STATE=3,a.BACK_NORMAL_ALWAYS_STATE=4,a.BACK_TRANSPARENT_STATE=5,a.BACK_TRANSPARENT_ALWAYS_STATE=6,a.NONE_TRANSPARENT_STATE=7,a.NONE_TRANSPARENT_ALWAYS_STATE=8,a.FRONT_CULLFACE_GREATER_STATE=9,a.BACK_ADD_BLENDSORT_STATE=10,a.BACK_ADD_ALWAYS_STATE=11,a.BACK_ALPHA_ADD_ALWAYS_STATE=12,a.NONE_ADD_ALWAYS_STATE=13,a.NONE_ADD_BLENDSORT_STATE=14,a.NONE_ALPHA_ADD_ALWAYS_STATE=15,a.FRONT_ADD_ALWAYS_STATE=16,a.FRONT_TRANSPARENT_STATE=17,a.FRONT_TRANSPARENT_ALWAYS_STATE=18,a.NONE_CULLFACE_NORMAL_ALWAYS_STATE=19,e.default=a},"2be1":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_nodesTotal=0,this.m_nodes=[],this.m_flags=[],this.m_freeIdList=[]}createNode(){return null}restoreUid(t){}getFreeId(){return this.m_freeIdList.length>0?this.m_freeIdList.pop():-1}getNodeByUid(t){return this.m_nodes[t]}create(){let t=null,e=this.getFreeId();return e>=0?(t=this.m_nodes[e],t.uid=e,this.m_flags[e]=i.S_BUSY):(t=this.createNode(),this.m_nodes.push(t),this.m_flags.push(i.S_BUSY),t.uid=this.m_nodesTotal,this.m_nodesTotal++),t}restore(t){return null!=t&&t.uid>=0&&this.m_flags[t.uid]==i.S_BUSY&&(this.restoreUid(t.uid),this.m_freeIdList.push(t.uid),this.m_flags[t.uid]=i.S_FREE,t.reset(),!0)}restoreByUid(t){return t>=0&&t<this.m_nodesTotal&&this.m_flags[t]==i.S_BUSY&&(this.restoreUid(t),this.m_freeIdList.push(t),this.m_flags[t]=i.S_FREE,this.m_nodes[t].reset(),!0)}}i.S_BUSY=1,i.S_FREE=0,e.default=i},"2e8a":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8a0a"),r=s("644c");class a{constructor(){this.type=-1,this.attriType=-1,this.typeSize=3,this.typeName="",this.name="",this.layoutEnabled=!0}parseCode(t){let e=";",s=" ",a=t.indexOf(e);a>0&&(t=t.slice(0,a)),a=t.indexOf(s);let h=0,n="",l=[];while(a>=0)n=t.slice(h,a),n.length>0&&l.push(n),h=a+1,a=t.indexOf(s,h);n=t.slice(h,t.length),n.length>0&&l.push(n),this.layoutEnabled,this.typeName=l[l.length-2],this.name=l[l.length-1],this.type=r.default.GetTypeByTypeNS(this.typeName),this.typeSize=parseInt(this.typeName.slice(this.typeName.length-1)),this.attriType=i.default.GetVBufAttributeTypeByNS(this.name)}}e.default=a},3024:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("3077");class r extends i.default{constructor(t){super(),this.m_datafs=new Float32Array(4),this.m_vec4Total=1,t<1&&(t=1),this.m_vec4Total=t}bindSlotAt(t){super.bindSlotAt(t),this.addVec4Data(this.m_datafs,this.m_vec4Total)}destroy(){super.destroy(),this.m_datafs=null}}e.default=r},3077:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("644c"),r=s("5326");class a{constructor(){this.m_slot=null,this.m_fsList=null,this.m_fsIndex=0,this.m_slotBeginIndex=-1,this.rst=-1,this.uniformsTotal=0,this.uniformTypes=null,this.dataSizeList=null}getSlotBeginIndex(){return this.m_slotBeginIndex}getSlotUid(){return this.m_slot.getUid()}getFS32At(t){return this.m_fsList[t]}setFS32At(t,e){this.m_fsList[e]=t}setVec4DataAt(t,e,s,i,r){let a=this.m_fsList[t];a[0]=e,a[1]=s,a[2]=i,a[3]=r}setVec4Data(t,e,s,i){let r=this.m_fsList[0];r[0]=t,r[1]=e,r[2]=s,r[3]=i}setVec4DataAtWithArr4(t,e){this.m_fsList[t].set(e,0)}setVec4DataWithArr4(t){this.m_fsList[0].set(t,0)}addVec4Data(t,e){this.m_fsList.push(t),this.uniformTypes.push(i.default.SHADER_VEC4),this.dataSizeList.push(e),this.m_slot.dataList[this.m_fsIndex]=t,this.m_fsIndex++,this.uniformsTotal++,this.m_slot.index++}addMat4Data(t,e){this.m_fsList.push(t),this.uniformTypes.push(i.default.SHADER_MAT4),this.dataSizeList.push(e),this.m_slot.dataList[this.m_fsIndex]=t,this.m_fsIndex++,this.uniformsTotal++,this.m_slot.index++}isEnabled(){return this.rst>=0}bindSlotAt(t){let e=r.default.GetSlotAt(t);this.rst>=0&&this.reset(),null==this.m_fsList&&(this.m_fsList=[],this.uniformTypes=[],this.dataSizeList=[]),this.m_slot=e,this.rst=1,this.m_slotBeginIndex=e.index,this.m_fsIndex=e.index}update(){if(this.rst++,this.uniformsTotal<2)this.m_slot.flagList[this.m_slotBeginIndex]=this.rst;else for(let t=this.m_slotBeginIndex;t<=this.m_fsIndex;++t)this.m_slot.flagList[t]=this.rst}reset(){this.rst=-1,this.m_slotBeginIndex=-1,this.uniformsTotal=0,this.m_fsIndex=0,null!=this.m_fsList&&(this.m_fsList=null,this.uniformTypes=null,this.dataSizeList=null),this.m_slot=null}destroy(){this.reset()}}e.default=a},"32cc":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("b3bd"),r=s("faa5"),a=s("0fc4");class h extends r.default{constructor(){super(),this.m_uniqueName="",this.dynColorEnabled=!1}initialize(t){this.m_uniqueName="Line3DShd",this.dynColorEnabled&&(this.m_uniqueName+="_dynColor")}getFragShaderCode(){let t="precision mediump float;\nvarying vec3 v_vtxColor;\nvoid main()\n{gl_FragColor = vec4(v_vtxColor, 1.0);\n}\n";return t}getVtxShaderCode(){let t="precision mediump float;\nattribute vec3 a_vs;\n";return this.dynColorEnabled?t+="uniform vec4 u_color;\n":t+="attribute vec3 a_cvs;\n",t+="uniform mat4 u_objMat;\nuniform mat4 u_viewMat;\nuniform mat4 u_projMat;\nvarying vec3 v_vtxColor;\nvoid main()\n{\nvec4 pv = u_projMat * u_viewMat * u_objMat * vec4(a_vs,1.0);\n// pixels move offset, and no perspective error.\n//  pv.xy = (pv.xy/pv.w - vec2(0.5)) * pv.w;\ngl_Position = pv;\n",this.dynColorEnabled?t+="v_vtxColor = u_color.xyz;\n":t+="v_vtxColor = a_cvs;\n",t+="}\n",t}getUniqueShaderName(){return this.m_uniqueName}toString(){return"[Line3DShaderBuffer()]"}static GetInstance(){return null!=h.___s_instance||(h.___s_instance=new h),h.___s_instance}}h.___s_instance=null;class n extends a.default{constructor(t=!1){super(),this.m_dynColorEnabled=!1,this.m_colorArray=null,t&&(this.m_colorArray=new Float32Array([1,1,1,1])),this.m_dynColorEnabled=t}getCodeBuf(){return h.GetInstance().dynColorEnabled=this.m_dynColorEnabled,h.GetInstance()}setRGB3f(t,e,s){null!=this.m_colorArray&&(this.m_colorArray[0]=t,this.m_colorArray[1]=e,this.m_colorArray[2]=s)}createSelfUniformData(){if(this.m_dynColorEnabled){let t=new i.default;return t.uniformNameList=["u_color"],t.dataList=[this.m_colorArray],t}return null}}e.default=n},"32fa":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("29ef"),r=s("725b"),a=s("617e");class h{constructor(){this.m_fps=60,this.m_lastTime=0,this.m_times=60,this.m_dealytime=0}getFPS(){return this.m_fps}getFPSStr(){return this.m_fps>60?"60":this.m_fps<10?"0"+this.m_fps:""+this.m_fps}updateFPS(){let t=Date.now();this.m_lastTime>0&&(--this.m_times,this.m_times<1&&(this.m_fps=Math.round(6e4/this.m_dealytime),this.m_dealytime=0,this.m_times=60),this.m_dealytime+=t-this.m_lastTime),this.m_lastTime=t}}class n{constructor(){this.m_rprocess=null,this.m_renderer=null,this.m_fpsInfo=new h,this.m_textFPSNS=null,this.m_textFPS=null,this.m_fps=60,this.m_drawCallNS=null,this.m_drawCall=null,this.m_drawCalls=0,this.m_drawTrisNS=null,this.m_drawTri=null,this.m_drawTris=0,this.m_povNS=null,this.m_pov=null,this.m_povNumber=0}initialize(t,e){if(null==this.m_renderer){r.default.GetInstance().isEnabled()||(r.default.GetInstance().setRenderProxy(t.getRenderProxy()),r.default.GetInstance().initialize("fontTex",18,512,512,!1,!1)),this.m_renderer=t,this.m_rprocess=e;let s=20,i=2,h=100,n=h-10,l=null;l=new a.default,l.initialize("FPS:"),l.setXY(n-l.getWidth(),i),this.m_renderer.addEntityToProcess(l,this.m_rprocess),this.m_textFPSNS=l;let _=l.getWidth();l=new a.default,l.__$setRenderProxy(t.getRenderProxy()),l.initialize("60"),l.setXY(h,2),this.m_renderer.addEntityToProcess(l,this.m_rprocess),this.m_textFPS=l,i+=s,l=new a.default,l.initialize("DrawCall:"),l.setXY(n-l.getWidth(),i),this.m_renderer.addEntityToProcess(l,this.m_rprocess),this.m_drawCallNS=l,_=l.getWidth(),l=new a.default,l.__$setRenderProxy(t.getRenderProxy()),l.initialize("00"),l.setXY(h,i),this.m_renderer.addEntityToProcess(l,this.m_rprocess),this.m_drawCall=l,i+=s,l=new a.default,l.initialize("DrawTris:"),l.setXY(n-l.getWidth(),i),this.m_renderer.addEntityToProcess(l,this.m_rprocess),this.m_drawTrisNS=l,_=l.getWidth(),l=new a.default,l.__$setRenderProxy(t.getRenderProxy()),l.initialize("00"),l.setXY(h,i),this.m_renderer.addEntityToProcess(l,this.m_rprocess),this.m_drawTri=l,i+=s,l=new a.default,l.initialize("POV:"),l.setXY(n-l.getWidth(),i),this.m_renderer.addEntityToProcess(l,this.m_rprocess),this.m_povNS=l,_=l.getWidth(),l=new a.default,l.__$setRenderProxy(t.getRenderProxy()),l.initialize("00"),l.setXY(h,i),this.m_renderer.addEntityToProcess(l,this.m_rprocess),this.m_pov=l}}run(t){if(this.m_fpsInfo.updateFPS(),this.m_fps!=this.m_fpsInfo.getFPS()&&(this.m_fps=this.m_fpsInfo.getFPS(),this.m_textFPS.setText(this.m_fpsInfo.getFPSStr()),this.m_textFPS.updateMeshToGpu(),this.m_textFPS.update()),this.m_drawCalls!=i.default.DrawCallTimes){let t=i.default.DrawCallTimes+"";this.m_drawCalls=i.default.DrawCallTimes,this.m_drawCall.setText(t),this.m_drawCall.updateMeshToGpu(),this.m_drawCall.update()}if(this.m_drawTris!=i.default.DrawTrisNumber){let t=i.default.DrawTrisNumber+"";this.m_drawTris=i.default.DrawTrisNumber,this.m_drawTri.setText(t),this.m_drawTri.updateMeshToGpu(),this.m_drawTri.update()}if(this.m_povNumber!=i.default.POVNumber){let t=i.default.POVNumber+"";this.m_povNumber=i.default.POVNumber,this.m_pov.setText(t),this.m_pov.updateMeshToGpu(),this.m_pov.update()}t&&this.m_renderer.getRenderProxy().setViewPort(0,0,this.m_renderer.getViewWidth(),this.m_renderer.getViewHeight())}toString(){return"[RendererStatus]"}}e.default=n},"352a":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetThreadEnabled(t){i.s_threadEnabled=t}static GetThreadEnabled(){return i.s_threadEnabled}static GetDebugEnabled(){return i.s_debugEnabled}static SetDebugEnabled(t){i.s_debugEnabled=t}static SetDevicePixelRatio(t){i.s_devicePixelRatio=t}static GetDevicePixelRatio(){return i.s_devicePixelRatio}static Initialize(t){i.s_inited&&(i.s_inited=!1,i.s_WEBGL_VER=t[0],i.TestMobileWeb())}static IsWebGL1(){return 1==i.s_WEBGL_VER}static IsWebGL2(){return 2==i.s_WEBGL_VER}static IsMobileWeb(){return i.s_mobileWeb}static TestMobileWeb(){return/mobile/.test(location.href)?(i.s_mobileWeb=!0,!0):/Android/i.test(navigator.userAgent)?/Mobile/i.test(navigator.userAgent)?(i.s_mobileWeb=!0,!0):(i.s_mobileWeb=!1,!1):/webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(i.s_mobileWeb=!0,!0):(i.s_mobileWeb=!1,!1)}}i.s_inited=!0,i.s_WEBGL_VER=2,i.s_devicePixelRatio=1,i.s_mobileWeb=!1,i.s_debugEnabled=!0,i.GPU_VENDOR="unknown",i.GPU_RENDERER="unknown",i.MAX_TEXTURE_SIZE=4096,i.MAX_RENDERBUFFER_SIZE=4096,i.MAX_VIEWPORT_WIDTH=4096,i.MAX_VIEWPORT_HEIGHT=4096,i.SHOWLOG_ENABLED=!1,i.SHADERCODE_TRACE_ENABLED=!1,i.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,i.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!1,i.s_threadEnabled=!0,e.default=i},"35fa":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8e17");class r{static ClacTriNormal(t,e,s,a){i.default.Subtract(e,t,r.s_temp_vb),i.default.Subtract(s,e,r.s_temp_vc),i.default.Cross(r.s_temp_vb,r.s_temp_vc,a),a.normalize()}static ClacTriNormalByVS(t,e,s){let i=9*e;r.s_temp_va.setTo(t[i],t[i+1],t[i+2]),s.setTo(t[i+3],t[i+4],t[i+5]),r.s_temp_vc.setTo(t[i+6],t[i+7],t[i+8]),s.subtractBy(r.s_temp_va),r.s_temp_vc.subtractBy(r.s_temp_va),s.crossBy(r.s_temp_vc),s.normalize()}static ClacTriNormalByIVS(t,e,s,i){let a=3*e,h=3*s[a];r.s_temp_va.setTo(t[h],t[h+1],t[h+2]),h=3*s[a+1],i.setTo(t[h],t[h+1],t[h+2]),h=3*s[a+2],r.s_temp_vc.setTo(t[h],t[h+1],t[h+2]),i.subtractBy(r.s_temp_va),r.s_temp_vc.subtractBy(r.s_temp_va),i.crossBy(r.s_temp_vc),i.normalize()}static ClacTrisNormal(t,e,s,a,h){let n=new i.default,l=0,_=0,o=0;for(o=0;o<e;++o)h[o]=0;for(o=0;o<s;++o)r.ClacTriNormalByIVS(t,o,a,n),l=3*o,_=3*a[l],h[_]+=n.x,h[_+1]+=n.y,h[_+2]+=n.z,_=3*a[l+1],h[_]+=n.x,h[_+1]+=n.y,h[_+2]+=n.z,_=3*a[l+2],h[_]+=n.x,h[_+1]+=n.y,h[_+2]+=n.z;for(o=0;o<e;o+=3)r.s_temp_va.setTo(h[o],h[o+1],h[o+2]),r.s_temp_va.normalize(),h[o]=r.s_temp_va.x,h[o+1]=r.s_temp_va.y,h[o+2]=r.s_temp_va.z}static ClacTriTangent(t,e,s,i,a,h,n){let l=3*i,_=3*a[l];r.s_temp_va.setTo(s[_],s[_+1],s[_+2]),r.s_temp_va.setTo(t[_],t[_+1],t[_+2]),_=3*a[l+1],r.s_temp_vb.setTo(t[_],t[_+1],t[_+2]),_=3*a[l+2],r.s_temp_vc.setTo(t[_],t[_+1],t[_+2]),_=2*a[l],r.s_temp_vd.setTo(e[_],e[_+1],0),_=2*a[l+1],r.s_temp_ve.setTo(e[_],e[_+1],0),_=2*a[l+2],r.s_temp_vf.setTo(e[_],e[_+1],0),r.s_temp_vb.subtractBy(r.s_temp_va),r.s_temp_vc.subtractBy(r.s_temp_va),r.s_temp_ve.subtractBy(r.s_temp_vd),r.s_temp_vf.subtractBy(r.s_temp_vd);let o=1/(r.s_temp_ve.x*r.s_temp_vf.y-r.s_temp_ve.y*r.s_temp_vf.x);h.copyFrom(r.s_temp_vb),h.scaleBy(r.s_temp_vf.y),r.s_temp_va.copyFrom(r.s_temp_vc),r.s_temp_va.scaleBy(r.s_temp_ve.y),h.subtractBy(r.s_temp_va),h.scaleBy(o),h.normalize(),n.copyFrom(r.s_temp_vc),n.scaleBy(r.s_temp_ve.x),r.s_temp_va.copyFrom(r.s_temp_vb),r.s_temp_va.scaleBy(r.s_temp_vf.x),n.subtractBy(r.s_temp_va),n.scaleBy(o),n.normalize()}static ClacTrisTangent(t,e,s,a,h,n,l,_){let o=new i.default,m=new i.default,u=0,d=0,c=0;for(c=0;c<e;++c)l[c]=0,_[c]=0;for(c=0;c<h;++c)r.ClacTriTangent(t,s,a,c,n,o,m),u=3*c,d=3*n[u],l[d]=o.x,l[d+1]=o.y,l[d+2]=o.z,_[d]=m.x,_[d+1]=m.y,_[d+2]=m.z,d=3*n[u+1],l[d]=o.x,l[d+1]=o.y,l[d+2]=o.z,_[d]=m.x,_[d+1]=m.y,_[d+2]=m.z,d=3*n[u+2],l[d]=o.x,l[d+1]=o.y,l[d+2]=o.z,_[d]=m.x,_[d+1]=m.y,_[d+2]=m.z;for(c=0;c<e;c+=3)r.s_temp_vd.setTo(l[c],l[c+1],l[c+2]),r.s_temp_vd.normalize(),r.s_temp_vb.setTo(_[c],_[c+1],_[c+2]),r.s_temp_vb.normalize(),r.s_temp_vc.setTo(a[c],a[c+1],a[c+2]),r.s_temp_va.copyFrom(r.s_temp_vc),r.s_temp_vc.scaleBy(r.s_temp_vc.dot(r.s_temp_vd)),r.s_temp_vd.subtractBy(r.s_temp_vc),r.s_temp_vd.normalize(),r.s_temp_vc.setTo(a[c],a[c+1],a[c+2]),r.s_temp_vc.scaleBy(r.s_temp_vb.dot(r.s_temp_vc)),r.s_temp_vb.subtractBy(r.s_temp_vc),r.s_temp_vb.normalize(),r.s_temp_va.crossBy(r.s_temp_vd),r.s_temp_va.dot(r.s_temp_vb)<0&&r.s_temp_vd.scaleBy(-1),l[c]=r.s_temp_vd.x,l[c+1]=r.s_temp_vd.y,l[c+2]=r.s_temp_vd.z,r.s_temp_vb.setTo(a[c],a[c+1],a[c+2]),r.s_temp_vb.crossBy(r.s_temp_vd),r.s_temp_vb.normalize(),_[c]=r.s_temp_vb.x,_[c+1]=r.s_temp_vb.y,_[c+2]=r.s_temp_vb.z}}r.s_temp_va=new i.default,r.s_temp_vb=new i.default,r.s_temp_vc=new i.default,r.s_temp_vd=new i.default,r.s_temp_ve=new i.default,r.s_temp_vf=new i.default,r.s_temp_vg=new i.default,e.default=r},"36cb":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("e08e"),r=s("ab73"),a=s("b02c"),h=s("4f27"),n=s("b30a"),l=s("9156"),_=s("74c3");var o=a.vox.render.TextureRenderObj,m=a.vox.render.EmptyTexRenderObj;class u{constructor(){this.m_emptyTRO=null,this.m_shader=null,this.m_rpoUnitBuilder=null,this.m_processBuider=null,this.m_roVtxBuild=null,this.m_rc=null,this.m_vtxRes=null,this.m_texRes=null,this.m_deferredVbufs=[],this.m_deferredTROs=[],this.m_deferredTextures=[],this.m_haveDeferredUpdate=!1}initialize(t,e,s,i){null==this.m_shader&&(this.m_rc=t,this.m_vtxRes=t.Vertex,this.m_texRes=t.Texture,this.m_shader=new n.default(t.getRCUid(),t.getRC(),t.getRenderAdapter()),this.m_rpoUnitBuilder=e,this.m_processBuider=s,this.m_roVtxBuild=i,this.m_emptyTRO=new m(this.m_texRes))}getRenderShader(){return this.m_shader}getTextureResource(){return this.m_texRes}updateTextureData(t,e){this.m_texRes.hasResUid(t.getResUid())&&(e?(this.m_deferredTextures.push(t),this.m_haveDeferredUpdate=!0):t.__$updateToGpu(this.m_texRes))}updateDispTRO(t,e){t.__$ruid>-1&&(e?(this.m_deferredTROs.push(t),this.m_haveDeferredUpdate=!0):this.updateTextureTRO(t))}updateTextureTRO(t){if(null!=t.__$$runit){let e=t.getMaterial();if(null!=e){let s=this.m_texRes,i=t.__$$runit,r=o.GetByMid(s.getRCUid(),e.__$troMid);if(null!=i.tro&&(null==r||i.tro.getMid()!=r.getMid())){let t=this.m_shader.findShdProgramByShdData(e.getShaderData());null!=t&&(t.getTexTotal()>0?(null==r&&(r=o.Create(s,e.getTextureList(),t.getTexTotal())),i.tro!=r&&(null!=i.tro&&i.tro.__$detachThis(),i.tro=r,r.__$attachThis(),i.texMid=i.tro.getMid(),this.m_processBuider.rejoinRunitForTro(i),e.__$troMid=i.tro.getMid())):i.tro!=this.m_emptyTRO&&(null!=i.tro&&i.tro.__$detachThis(),i.tro=this.m_emptyTRO,i.texMid=i.tro.getMid(),this.m_processBuider.rejoinRunitForTro(i),e.__$troMid=i.texMid))}}}}updateDispMaterial(t,e){let s=null;if(e.__$ruid>=0){let i=this.m_rc,a=e.getMaterial();if(null!=a){if(null==a.getShaderData()){let t=a.getTextureList(),e=null!=t&&null!=t&&t.length>0;a.initializeByCodeBuf(e)}s=this.m_shader.create(a.getShaderData()),s.upload(i.RContext,i.getUid()),t.shdUid=s.getUid();let n=null;s.getTexTotal()>0?(n=o.Create(this.m_texRes,a.getTextureList(),s.getTexTotal()),t.tro!=n&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=n,n.__$attachThis(),t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.m_processBuider.rejoinRunitForTro(t),a.__$troMid=t.tro.getMid())):t.tro!=this.m_emptyTRO&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=this.m_emptyTRO,t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.m_processBuider.rejoinRunitForTro(t),a.__$troMid=t.texMid),null==this.m_shader.getSharedUniformByShd(s)&&this.m_shader.setSharedUniformByShd(s,h.default.BuildShared(a.createSharedUniform(),i,s));let _=s.hasUniformByName(r.default.LocalTransformMatUNS);null==a.__$uniform&&(a.__$uniform=h.default.BuildLocalFromData(a.createSelfUniformData(),s)),_&&null!=e.getTransform()&&(t.transUniform=l.default.GetTransUniform(e.getTransform())),null==t.transUniform&&(t.transUniform=h.default.BuildLocalFromTransformV(_?e.getMatrixFS32():null,s),l.default.SetTransUniform(e.getTransform(),t.transUniform)),t.uniform=a.__$uniform}else console.log("Error RODataBuilder::updateDispMaterial(), material is null !!!")}return s}updateVtxDataToGpuByUid(t,e){this.m_vtxRes.updateDataToGpu(t,e)}updateDispVbuf(t,e){if(t.__$ruid>-1)if(e)this.m_deferredVbufs.push(t),this.m_haveDeferredUpdate=!0;else{let e=t.__$$runit;if(null!=e&&e.vtxUid!=t.vbuf.getUid()){let s=e.vtxUid,i=this.m_vtxRes;i.hasResUid(s)&&i.__$detachRes(s),e.vro.__$detachThis(),this.buildVtxRes(t,e,this.m_shader.findShdProgramByUid(e.shdUid)),e.__$rprouid>=0&&this.m_processBuider.rejoinRunitForVro(e)}}}buildVtxRes(t,e,s){if(null!=t.vbuf){let i=this.m_vtxRes;e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,e.visible=t.visible,e.setVisible(t.visible),e.drawMode=t.drawMode,e.renderState=t.renderState,e.rcolorMask=t.rcolorMask,e.trisNumber=t.trisNumber;let r,a=t.vbuf.getUid(),h=!0;i.hasResUid(a)?(r=i.getVertexRes(a),h=r.version!=t.vbuf.version,h&&(i.destroyRes(a),r.rcuid=i.getRCUid(),r.resUid=a)):(r=new _.GpuVtxObect,r.rcuid=i.getRCUid(),r.resUid=a,i.addVertexRes(r)),h&&(r.indices.ibufStep=t.vbuf.getIBufStep(),r.indices.initialize(this.m_roVtxBuild,t.vbuf),r.vertex.initialize(this.m_roVtxBuild,s,t.vbuf),r.version=t.vbuf.version),i.__$attachRes(a),e.vro=r.createVRO(this.m_roVtxBuild,s,!0),e.vro.__$attachThis(),e.vtxUid=t.vbuf.getUid(),e.ibufStep=e.vro.ibufStep,e.ibufType=4!=e.ibufStep?this.m_rc.UNSIGNED_SHORT:this.m_rc.UNSIGNED_INT}}buildGpuDisp(t){if(t.__$ruid<0){if(null!=t.getMaterial()){t.__$$rsign=i.DisplayRenderSign.LIVE_IN_WORLD;let e=this.m_rpoUnitBuilder.create();if(t.__$ruid=e.uid,t.__$$runit=e,null!=t.getPartGroup()){e.partGroup=t.getPartGroup().slice(0),e.partTotal=e.partGroup.length;let s=e.partGroup;for(let t=0,i=e.partTotal;t<i;)t++,s[t++]*=e.ibufStep}return e.setDrawFlag(t.renderState,t.rcolorMask),this.buildVtxRes(t,e,this.updateDispMaterial(e,t)),!0}console.log("Error RODataBuilder::buildGpuDisp(), material is null !!!")}return!1}update(){if(this.m_haveDeferredUpdate){this.m_haveDeferredUpdate=!1;let t=this.m_deferredVbufs.length,e=0;if(t>0){for(;e<t;++e)this.updateDispVbuf(this.m_deferredVbufs[e],!1);this.m_deferredVbufs=[]}if(t=this.m_deferredTROs.length,t>0){for(e=0;e<t;++e)this.updateTextureTRO(this.m_deferredTROs[e]);this.m_deferredTROs=[]}if(t=this.m_deferredTextures.length,t>0){for(e=0;e<t;++e)this.m_deferredTextures[e].__$updateToGpu(this.m_texRes);this.m_deferredTextures=[]}}}updateGlobalMaterial(t){if(null!=t){let e=this.m_rc,s=e.RContext,i=null,r=null,a=null,n=!1;null==t.getShaderData()&&(a=t.getTextureList(),n=null!=a&&a.length>0,t.initializeByCodeBuf(n)),r=this.m_shader.create(t.getShaderData()),r.upload(e.RContext,e.getUid());let l=r.getTexTotal();n&&l>0&&(i=o.Create(s,a,l)),null==this.m_shader.getSharedUniformByShd(r)&&this.m_shader.setSharedUniformByShd(r,h.default.BuildShared(t.createSharedUniform(),e,r)),null==t.__$uniform&&(t.__$uniform=h.default.BuildLocalFromData(t.createSelfUniformData(),r)),this.m_shader.bindToGpu(r.getUid()),null!=i&&i.run()}}reset(){this.m_deferredVbufs=[],this.m_deferredTROs=[]}}e.default=u},3806:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("a996"),r=s("1710"),a=s("7045"),h=s("9260"),n=s("3024"),l=s("badb");class _{constructor(t,e){this.m_rcuid=0,this.pixelRatio=1,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.m_viewX=0,this.m_viewY=0,this.m_viewW=1,this.m_viewH=1,this.m_mouseEvtDispatcher=new l.default,this.m_resize_listener=[],this.m_resize_ers=[],this.m_keyEvt=new a.default,this.m_keyDown_listener=[],this.m_keyDown_ers=[],this.m_keyUp_listener=[],this.m_keyUp_ers=[],this.uProbe=null,this.m_preStageWidth=0,this.m_preStageHeight=0,this.m_mouseEvt=new r.default,this.m_baseEvt=new i.default,this.m_autoSynViewAndStageSize=!0,this.m_rcuid=t,null==_.s_document&&(_.s_document=e,e.onkeydown=function(t){h.default.KeyDown(t)},e.onkeyup=function(t){h.default.KeyUp(t)}),h.default.AddEventListener(a.default.KEY_DOWN,this,this.keyDown),h.default.AddEventListener(a.default.KEY_UP,this,this.keyUp)}getRCUid(){return this.m_rcuid}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.m_viewX}getViewY(){return this.m_viewY}getViewWidth(){return this.m_viewW}getViewHeight(){return this.m_viewH}setViewPort(t,e,s,i){this.m_autoSynViewAndStageSize=!1,this.m_viewX=t,this.m_viewY=e,s==this.m_viewW&&i==this.m_viewH||(this.m_viewW=s,this.m_viewH=i,this.updateViewUData())}updateViewUData(){null==this.uProbe&&(this.uProbe=new n.default(1),this.uProbe.bindSlotAt(this.m_rcuid)),this.uProbe.setVec4Data(2/(this.m_viewW*this.pixelRatio),2/(this.m_viewH*this.pixelRatio),this.m_viewW*this.pixelRatio,this.m_viewH*this.pixelRatio),this.uProbe.update(),this.m_preStageWidth=this.m_viewW,this.m_preStageHeight=this.m_viewH}update(){this.m_preStageWidth==this.stageWidth&&this.m_preStageHeight==this.stageHeight||(this.m_autoSynViewAndStageSize&&(this.m_viewW=this.stageWidth,this.m_viewH=this.stageHeight,this.updateViewUData()),this.stageHalfWidth=.5*this.stageWidth,this.stageHalfHeight=.5*this.stageHeight,this.m_baseEvt.target=this,this.m_baseEvt.type=i.default.RESIZE,this.m_baseEvt.phase=1,this.sendResizeEvt(this.m_baseEvt))}keyDown(t){this.m_keyEvt.phase=1,this.m_keyEvt.type=a.default.KEY_DOWN,this.m_keyEvt.altKey=t.altKey,this.m_keyEvt.ctrlKey=t.ctrlKey,this.m_keyEvt.shiftKey=t.shiftKey,this.m_keyEvt.repeat=t.repeat,this.m_keyEvt.key=t.key,this.m_keyEvt.keyCode=t.keyCode,this.m_keyEvt.location=t.location;let e=this.m_keyDown_listener.length;for(var s=0;s<e;++s)this.m_keyDown_listener[s].call(this.m_keyDown_ers[s],this.m_keyEvt)}keyUp(t){this.m_keyEvt.phase=1,this.m_keyEvt.type=a.default.KEY_UP,this.m_keyEvt.altKey=t.altKey,this.m_keyEvt.ctrlKey=t.ctrlKey,this.m_keyEvt.shiftKey=t.shiftKey,this.m_keyEvt.repeat=t.repeat,this.m_keyEvt.key=t.key,this.m_keyEvt.keyCode=t.keyCode,this.m_keyEvt.location=t.location,this.m_keyEvt.target=this;let e=this.m_keyUp_listener.length;for(var s=0;s<e;++s)this.m_keyUp_listener[s].call(this.m_keyUp_ers[s],this.m_keyEvt)}sendResizeEvt(t){let e=this.m_resize_listener.length;for(var s=0;s<e;++s)this.m_resize_listener[s].call(this.m_resize_ers[s],t)}mouseDown(t=1){this.m_mouseEvt.type=r.default.MOUSE_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseUp(t=1){this.m_mouseEvt.phase=1,this.m_mouseEvt.type=r.default.MOUSE_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseClick(){this.m_mouseEvt.type=r.default.MOUSE_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseDoubleClick(){this.m_mouseEvt.type=r.default.MOUSE_DOUBLE_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightDown(){this.m_mouseEvt.type=r.default.MOUSE_RIGHT_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightUp(){this.m_mouseEvt.type=r.default.MOUSE_RIGHT_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseBgDown(){this.m_mouseEvt.type=r.default.MOUSE_BG_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseBgUp(){this.m_mouseEvt.type=r.default.MOUSE_BG_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightClick(){this.m_mouseEvt.type=r.default.MOUSE_RIGHT_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMove(){this.m_mouseEvt.type=r.default.MOUSE_MOVE,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseWheel(t){this.m_mouseEvt.type=r.default.MOUSE_WHEEL,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.wheelDeltaY=t.wheelDeltaY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseCancel(){this.m_mouseEvt.type=r.default.MOUSE_CANCEL,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiDown(t){this.m_mouseEvt.type=r.default.MOUSE_MULTI_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiUp(t){this.m_mouseEvt.type=r.default.MOUSE_MULTI_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiMove(t){this.m_mouseEvt.type=r.default.MOUSE_MULTI_MOVE,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}addEventListener(t,e,s,r=!0,h=!0){if(null!=s&&null!=e){let n=0;switch(t){case i.default.RESIZE:for(n=this.m_resize_listener.length-1;n>=0;--n)if(e===this.m_resize_ers[n])break;n<0&&(this.m_resize_ers.push(e),this.m_resize_listener.push(s));break;case a.default.KEY_DOWN:for(n=this.m_keyDown_listener.length-1;n>=0;--n)if(e===this.m_keyDown_ers[n])break;n<0&&(this.m_keyDown_ers.push(e),this.m_keyDown_listener.push(s));break;case a.default.KEY_UP:for(n=this.m_keyUp_listener.length-1;n>=0;--n)if(e===this.m_keyUp_ers[n])break;n<0&&(this.m_keyUp_ers.push(e),this.m_keyUp_listener.push(s));break;default:this.m_mouseEvtDispatcher.addEventListener(t,e,s,r,h);break}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let r=0;switch(t){case i.default.RESIZE:for(r=this.m_resize_listener.length-1;r>=0;--r)if(e===this.m_resize_ers[r]){this.m_resize_ers.splice(r,1),this.m_resize_listener.splice(r,1);break}break;case a.default.KEY_DOWN:for(r=this.m_keyDown_listener.length-1;r>=0;--r)if(e===this.m_keyDown_ers[r]){this.m_keyDown_ers.splice(r,1),this.m_keyDown_listener.splice(r,1);break}break;case a.default.KEY_UP:for(r=this.m_keyUp_listener.length-1;r>=0;--r)if(e===this.m_keyUp_ers[r]){this.m_keyUp_ers.splice(r,1),this.m_keyUp_listener.splice(r,1);break}break;default:this.m_mouseEvtDispatcher.removeEventListener(t,e,s);break}}}}_.s_document=null,e.default=_},"38de":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("6e01"),r=s("8e17"),a=s("f48d");class h extends a.default{constructor(){super(...arguments),this.tv=new r.default(1,0,0)}update(){this.tv.normalize()}updateFast(){this.tv.normalize()}static IntersectionTri(t,e,s,i,r,a){return 0}static IntersectionLS(t,e,s,i,n,l=1){let _=h.__tAv;if(_.copyFrom(i),_.subtractBy(s),_.normalize(),r.default.Cross(e,_,n),n.normalize(),_.w=n.dot(t)-n.dot(i),Math.abs(_.w)<=l){n.crossBy(e),n.normalize(),n.w=n.dot(t),_.w=(n.w-n.dot(s))/_.dot(n),n.copyFrom(_),n.scaleBy(_.w),n.addBy(s),_.copyFrom(n),_.subtractBy(s);let r=a.default.__tV1;if(r.copyFrom(n),r.subtractBy(i),_.dot(r)<=0)return 1}return 0}static IntersectioNearSphere2(t,e,s,r,a){let n=h.__tAv;if(n.x=s.x-t.x,n.y=s.y-t.y,n.z=s.z-t.z,n.w=n.dot(e),r*=r,n.w>i.default.MATH_MIN_POSITIVE){if(a.copyFrom(e),a.scaleBy(n.w),a.subtractBy(n),n.x=a.getLengthSquared(),n.x<=r)return n.w-=Math.sqrt(r-n.x),a.copyFrom(e),a.scaleBy(n.w),a.addBy(t),a.w=1,1}else if(n.getLengthSquared()<=r&&(a.copyFrom(e),a.scaleBy(n.w),a.subtractBy(n),n.x=a.getLengthSquared(),n.x<=r))return n.w+=Math.sqrt(r-n.x),a.copyFrom(e),a.scaleBy(n.w),a.addBy(t),a.w=1,1;return 0}static IntersectioNearSphere(t,e,s,r,a){let n=h.__tAv;if(n.x=s.x-t.x,n.y=s.y-t.y,n.z=s.z-t.z,n.w=n.dot(e),n.w>i.default.MATH_MIN_POSITIVE){if(a.x=n.x-n.w*e.x,a.y=n.y-n.w*e.y,a.z=n.z-n.w*e.z,a.x=a.getLengthSquared(),a.w=r*r,a.x<=a.w)return a.x=n.getLengthSquared(),a.z=a.w-a.x,n.normalize(),a.y=n.dot(e)*Math.sqrt(a.x),n.w=.5*(-a.y+Math.sqrt(a.y*a.y+4*a.z)),a.copyFrom(e),a.scaleBy(n.w),a.addBy(t),a.w=1,1}else if(a.x=n.getLengthSquared(),a.w=r*r,a.x<=a.w)return a.z=a.w-a.x,n.normalize(),a.y=n.dot(e)*Math.sqrt(a.x),n.w=.5*(-a.y+Math.sqrt(a.y*a.y+4*a.z)),a.copyFrom(e),a.scaleBy(n.w),a.addBy(t),a.w=1,1;return 0}static IntersectSphere(t,e,s,r){let a=h.__tAv;return a.x=s.x-t.x,a.y=s.y-t.y,a.z=s.z-t.z,a.w=a.dot(e),a.w<i.default.MATH_MIN_POSITIVE||(a.x-=a.w*e.x,a.y-=a.w*e.y,a.z-=a.w*e.z),a.getLengthSquared()<=r*r}}h.__tAv=new r.default,e.default=h},3930:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("6e01");class r{constructor(t=1,e=1,s=1,i=1){this.r=1,this.g=1,this.b=1,this.a=1,this.r=t,this.g=e,this.b=s,this.a=i}setRGB3Bytes(t,e,s){this.r=t/255,this.g=e/255,this.b=s/255}setRGB3f(t,e,s){this.r=t,this.g=e,this.b=s}setRGBUint24(t){this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255}setRGBA4f(t,e,s,i){this.r=t,this.g=e,this.b=s,this.a=i}copyFrom(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}scaleBy(t){this.r*=t,this.g*=t,this.b*=t}randomRGB(t=1){this.r=Math.random()*t,this.g=Math.random()*t,this.b=Math.random()*t}normalizeRandom(t=1){this.r=Math.random()*t,this.g=Math.random()*t,this.b=Math.random()*t;let e=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);e>i.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/e,this.g=t*this.g/e,this.b=t*this.b/e)}normalize(t){void 0==t&&(t=1);let e=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);e>i.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/e,this.g=t*this.g/e,this.b=t*this.b/e)}toString(){return"[Color4(r="+this.r+", g="+this.g+",b="+this.b+",a="+this.a+")]"}}e.default=r},"3bda":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetDebugEnabled(t){i.s_debugEanbled=t}static ShowLog(t){i.s_debugEanbled&&(i.s_logStr.length>0?i.s_logStr+="<br/>"+t:i.s_logStr=t,i.UpdateDivText())}static GetLog(){return i.s_logStr}static ShowLogOnce(t){i.s_debugEanbled&&(i.s_logStr=t,i.UpdateDivText())}static ClearLog(t=""){i.s_debugEanbled&&(i.s_logStr=t,i.UpdateDivText())}static UpdateDivText(){if(i.s_debugEanbled)if(null!=i.s_infoDiv)i.s_infoDiv.innerHTML=i.s_logStr;else{var t=document.createElement("div");t.width=128,t.height=64,t.style.backgroundColor="#aa0033",t.style.left="0px",t.style.top="128px",t.style.position="absolute",document.body.appendChild(t),i.s_infoDiv=t,t.innerHTML=i.s_logStr}}}i.s_logStr="",i.s_infoDiv=null,i.s_debugEanbled=!1,e.default=i},"3bfb":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("6e01"),r=s("8e17"),a=s("35fa"),h=s("8a0a"),n=s("e7d2"),l=s("8a0a"),_=s("fecb"),o=s("cb29");class m extends o.default{constructor(t=h.default.VTX_STATIC_DRAW){super(t),this.m_posList=[null,null,null,null,null,null,null,null],this.m_pos=new r.default,this.normalType=l.VtxNormalType.FLAT,this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,this.flipVerticalUV=!1}getVS(){return this.m_vs}getUVS(){return this.m_uvs}getNVS(){return this.m_nvs}getCVS(){return this.m_cvs}setPositionAt(t,e){if(t>=0&&t<8&&null!=this.m_vs){let s=this.m_posList[t];s[0]=e.x,s[1]=e.y,s[2]=e.z}}getPositionAt(t,e){if(t>=0&&t<8&&null!=this.m_vs){let s=this.m_posList[t];e.x=s[0],e.y=s[1],e.z=s[2]}}setEdgeAt(t,e,s){if(t>=0&&t<8&&null!=this.m_vs){let i=this.m_posList[t];t++,3==t?t=0:7==t&&(t=4);let r=this.m_posList[t];i[0]=e.x,i[1]=e.y,i[2]=e.z,r[0]=s.x,r[1]=s.y,r[2]=s.z}}getEdgeAt(t,e,s){if(t>=0&&t<8&&null!=this.m_vs){let i=this.m_posList[t];t++,3==t?t=0:7==t&&(t=4);let r=this.m_posList[t];e.x=i[0],e.y=i[1],e.z=i[2],s.x=r[0],s.y=r[1],s.z=r[2]}}setFaceAt(t,e,s,i,r){if(t>=0&&t<8&&null!=this.m_vs){t*=4;let a,h,n=[e,s,i,r],l=m.s_facePosIds,_=this.m_posList;for(let e=t+4,s=0;t<e;++t)a=_[l[t]],h=n[s++],a[0]=h.x,a[1]=h.y,a[2]=h.z}}getFaceAt(t,e,s,i,r){if(t>=0&&t<8&&null!=this.m_vs){t*=4;let a,h,n=[e,s,i,r],l=m.s_facePosIds,_=this.m_posList;for(let e=t+4,s=0;t<e;++t)a=_[l[t]],h=n[s++],h.x=a[0],h.y=a[1],h.z=a[2]}}getFaceCenterAt(t,e){if(t>=0&&t<8&&null!=this.m_vs){t*=4;let s,i=m.s_facePosIds,r=this.m_posList;e.setXYZ(0,0,0);for(let a=t+4;t<a;++t)s=r[i[t]],e.x+=s[0],e.y+=s[1],e.z+=s[2];e.scaleBy(.33333)}}transformFaceAt(t,e){if(t>=0&&t<8&&null!=this.m_vs){t*=4;let s=m.s_facePosIds,i=this.m_posList;for(let r=t+4;t<r;++t)e.transformVectorsSelf(i[s[t]],3)}}initializeWithYFace(t,e,s,i){let r=t,a=e,h=.5*(r.y+a.y);this.m_posList[0]=[a.x,h,a.z],this.m_posList[1]=[a.x,h,r.z],this.m_posList[2]=[r.x,h,r.z],this.m_posList[3]=[r.x,h,a.z],r=s,a=i;let n=.5*(r.y+a.y);this.m_posList[4]=[a.x,n,a.z],this.m_posList[5]=[a.x,n,r.z],this.m_posList[6]=[r.x,n,r.z],this.m_posList[7]=[r.x,n,a.z],this.initData(this.m_posList)}initialize(t,e){this.m_posList[0]=[e.x,t.y,e.z],this.m_posList[1]=[e.x,t.y,t.z],this.m_posList[2]=[t.x,t.y,t.z],this.m_posList[3]=[t.x,t.y,e.z],this.m_posList[4]=[e.x,e.y,e.z],this.m_posList[5]=[e.x,e.y,t.z],this.m_posList[6]=[t.x,e.y,t.z],this.m_posList[7]=[t.x,e.y,e.z],this.initData(this.m_posList)}scaleUVFaceAt(t,e,s,i,r){if(null!=this.m_uvs&&t>=0&&t<6){let a=8*t,h=a+8,n=this.m_uvs;for(;a<h;a+=2)n[a]=e+n[a]*i,n[a+1]=s+n[a+1]*r}}reinitialize(){this.initData(this.m_posList)}initData(t){this.vtxTotal=24;let e=0,s=0,r=0,o=null==this.m_ivs;if(o){this.m_vs=new Float32Array(72),this.m_ivs=new Uint16Array(36);let t=[3,2,3,3,2,2];for(e=0;e<6;++e)3==t[e]?(this.m_ivs[r]=s+3,this.m_ivs[r+1]=s+2,this.m_ivs[r+2]=s+1,this.m_ivs[r+3]=s+3,this.m_ivs[r+4]=s+1,this.m_ivs[r+5]=s):(this.m_ivs[r]=s+2,this.m_ivs[r+1]=s+3,this.m_ivs[r+2]=s,this.m_ivs[r+3]=s+2,this.m_ivs[r+4]=s,this.m_ivs[r+5]=s+1),r+=6,s+=4}let u,d=m.s_facePosIds,c=this.m_posList,f=this.m_vs;for(s=0,e=0;e<this.vtxTotal;++e)u=c[d[e]],f.set(u,s),s+=3;this.bounds=new _.default,null!=this.m_transMatrix?(this.m_transMatrix.transformVectorsSelf(this.m_vs,this.m_vs.length),this.bounds.addXYZFloat32Arr(this.m_vs)):this.bounds.addXYZFloat32Arr(this.m_vs),this.bounds.updateFast(),n.default.Reset(),n.default.AddFloat32Data(this.m_vs,3);let p=6;if(this.isVBufEnabledAt(h.default.VBUF_UVS_INDEX)){if(null==this.m_uvs){if(e=0,r=2*this.vtxTotal,this.m_uvs=new Float32Array(48),this.flipVerticalUV)while(e<r)this.m_uvs[e]=1,this.m_uvs[e+1]=1,this.m_uvs[e+2]=0,this.m_uvs[e+3]=1,this.m_uvs[e+4]=0,this.m_uvs[e+5]=0,this.m_uvs[e+6]=1,this.m_uvs[e+7]=0,e+=8;else while(e<r)this.m_uvs[e]=0,this.m_uvs[e+1]=0,this.m_uvs[e+2]=1,this.m_uvs[e+3]=0,this.m_uvs[e+4]=1,this.m_uvs[e+5]=1,this.m_uvs[e+6]=0,this.m_uvs[e+7]=1,e+=8;if(this.isVBufEnabledAt(h.default.VBUF_TVS_INDEX)){r=0;while(r<6){switch(r){case 0:e=0,this.m_uvs[e]=0,this.m_uvs[e+1]=1,this.m_uvs[e+2]=1,this.m_uvs[e+3]=1,this.m_uvs[e+4]=1,this.m_uvs[e+5]=0,this.m_uvs[e+6]=0,this.m_uvs[e+7]=0;break;case 3:e=24,this.m_uvs[e]=0,this.m_uvs[e+1]=1,this.m_uvs[e+2]=1,this.m_uvs[e+3]=1,this.m_uvs[e+4]=1,this.m_uvs[e+5]=0,this.m_uvs[e+6]=0,this.m_uvs[e+7]=0;break;case 5:e=32,this.m_uvs[e]=0,this.m_uvs[e+1]=1,this.m_uvs[e+2]=1,this.m_uvs[e+3]=1,this.m_uvs[e+4]=1,this.m_uvs[e+5]=0,this.m_uvs[e+6]=0,this.m_uvs[e+7]=0;break;default:break}++r}}}n.default.AddFloat32Data(this.m_uvs,2)}if(this.isVBufEnabledAt(h.default.VBUF_NVS_INDEX)){this.m_nvs=new Float32Array(72),r=0;let t=0,s=0,a=0;if(this.normalType==l.VtxNormalType.FLAT)while(r<p){switch(t=0,s=0,a=0,r){case 0:s=-1;break;case 1:s=1;break;case 2:t=1;break;case 3:a=-1;break;case 4:t=-1;break;case 5:a=1;break;default:break}e=12*r,t*=this.normalScale,s*=this.normalScale,a*=this.normalScale,this.m_nvs[e]=t,this.m_nvs[e+1]=s,this.m_nvs[e+2]=a,this.m_nvs[e+3]=t,this.m_nvs[e+4]=s,this.m_nvs[e+5]=a,this.m_nvs[e+6]=t,this.m_nvs[e+7]=s,this.m_nvs[e+8]=a,this.m_nvs[e+9]=t,this.m_nvs[e+10]=s,this.m_nvs[e+11]=a,++r}else{let h=this.bounds.center,n=0;while(r<this.vtxTotal)e=3*r,t=this.m_vs[e]-h.x,s=this.m_vs[e+1]-h.y,a=this.m_vs[e+2]-h.z,n=Math.sqrt(t*t+s*s+a*a),n>i.default.MATH_MIN_POSITIVE&&(this.m_nvs[e]=t/n,this.m_nvs[e+1]=s/n,this.m_nvs[e+2]=a/n),++r}n.default.AddFloat32Data(this.m_nvs,3)}if(this.isVBufEnabledAt(h.default.VBUF_CVS_INDEX)){this.m_cvs=new Float32Array(72),r=0;let t=1,s=1,i=1;while(r<p)e=12*r,this.m_cvs[e]=t,this.m_cvs[e+1]=s,this.m_cvs[e+2]=i,this.m_cvs[e+3]=t,this.m_cvs[e+4]=s,this.m_cvs[e+5]=i,this.m_cvs[e+6]=t,this.m_cvs[e+7]=s,this.m_cvs[e+8]=i,this.m_cvs[e+9]=t,this.m_cvs[e+10]=s,this.m_cvs[e+11]=i,++r;n.default.AddFloat32Data(this.m_cvs,3)}if(this.isVBufEnabledAt(h.default.VBUF_TVS_INDEX)){let t=12,e=new Float32Array(this.m_nvs.length),s=new Float32Array(this.m_nvs.length);a.default.ClacTrisTangent(this.m_vs,this.m_vs.length,this.m_uvs,this.m_nvs,t,this.m_ivs,e,s),n.default.AddFloat32Data(e,3),n.default.AddFloat32Data(s,3)}n.default.vbWholeDataEnabled=this.vbWholeDataEnabled,o?(this.m_vbuf=n.default.CreateBySaveData(this.getBufDataUsage()),this.m_vbuf.setUint16IVSData(this.m_ivs),this.vtCount=this.m_ivs.length,this.trisNumber=12,this.buildEnd()):n.default.UpdateBufData(this.m_vbuf)}setFaceUVSAt(t,e){null!=this.m_uvs&&this.m_uvs.set(e,8*t)}toString(){return"Box3DMesh()"}__$destroy(){this.isResFree()&&(this.bounds=null,this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,super.__$destroy())}}m.s_facePosIds=[0,1,2,3,4,5,6,7,4,5,1,0,5,6,2,1,7,6,2,3,4,7,3,0],e.default=m},"3c81":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("2be1"),r=s("7696");class a extends i.default{setCreateParams(t,e,s,i,r,a){this.m_shader=t,this.m_rpoNodeBuilder=e,this.m_rpoUnitBuilder=s,this.m_vtxResource=i,this.m_batchEnabled=r,this.m_fixedState=a}createNode(){return new r.default(this.m_shader,this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_vtxResource,this.m_batchEnabled,this.m_fixedState)}rejoinRunitForTro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForTro(t)}rejoinRunitForVro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForVro(t)}}e.default=a},"402a":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("11e6"),r=s("8e17"),a=s("fecb"),h=s("1710"),n=s("29ef"),l=s("0929"),_=s("cc48"),o=s("dc2b");class m{constructor(t=null){this.m_uid=0,this.m_transfrom=null,this.m_mouseEvtDispatcher=null,this.m_visible=!0,this.m_drawEnabled=!0,this.m_rcolorMask=n.default.ALL_TRUE_COLOR_MASK,this.m_renderState=n.default.BACK_CULLFACE_NORMAL_STATE,this.m_display=null,this.m_mesh=null,this.m_globalBounds=null,this.m_parent=null,this.m_renderProxy=null,this.__$rseFlag=i.default.DEFAULT,this.name="DisplayEntity",this.spaceCullMask=_.default.CAMERA,this.drawEnabled=!1,this.mouseEnabled=!1,this.vbWholeDataEnabled=!0,this.m_texChanged=!1,this.m_meshChanged=!1,this.m_transStatus=l.default.UPDATE_TRANSFORM,this.m_uid=m.s_uid++,this.m_transfrom=null==t?l.default.Create():t,this.createBounds()}createBounds(){this.m_globalBounds=new a.default}__$setRenderProxy(t){this.m_renderProxy=t}__$setParent(t){this.m_parent,this.m_parent=t}__$getParent(){return this.m_parent}__$testSpaceEnabled(){return i.default.TestSpaceEnabled2(this.__$rseFlag)}__$testContainerEnabled(){return i.default.TestContainerEnabled(this.__$rseFlag)}__$testRendererEnabled(){return i.default.TestRendererEnabled(this.__$rseFlag)}getRendererUid(){return i.default.GetRendererUid(this.__$rseFlag)}isFree(){return this.__$rseFlag==i.default.DEFAULT}dispatchEvt(t){t.getClassType()==h.default.EventClassType&&null!=this.m_mouseEvtDispatcher&&this.m_mouseEvtDispatcher.dispatchEvt(t)}getEvtDispatcher(t){return this.m_mouseEvtDispatcher}setEvtDispatcher(t){this.m_mouseEvtDispatcher=t}getGlobalBounds(){return this.m_globalBounds}getLocalBounds(){return this.m_mesh.bounds}getGlobalBoundsVer(){return null!=this.m_globalBounds?this.m_globalBounds.version:-1}__$setDrawEnabled(t){this.m_drawEnabled!=t&&(this.m_drawEnabled=t,null!=this.m_display&&(this.m_display.visible=this.m_visible&&t,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setVisible(this.m_display.visible)))}getDrawEnabled(){return this.m_drawEnabled}updateMeshToGpu(t=null,e=!0){null!=t&&(this.m_renderProxy=t),null!=this.m_renderProxy&&null!=this.m_display&&this.m_display.__$ruid>-1&&(this.m_meshChanged?(this.m_meshChanged=!1,this.m_renderProxy.VtxBufUpdater.updateDispVbuf(this.m_display,e)):this.m_renderProxy.VtxBufUpdater.updateVtxDataToGpuByUid(this.m_display.vbuf.getUid(),e))}updateMaterialToGpu(t=null,e=!0){null!=t&&(this.m_renderProxy=t),null!=this.m_renderProxy&&null!=this.m_display&&this.m_display.__$ruid>-1&&this.m_texChanged&&(this.m_texChanged=!1,this.m_renderProxy.MaterialUpdater.updateDispTRO(this.m_display,e))}setTextureList(t){null!=this.m_display&&this.m_display.__$ruid>-1&&null!=this.m_display.getMaterial()&&(this.m_display.getMaterial().setTextureList(t),this.m_texChanged=!0)}setTextureAt(t,e){null!=this.m_display&&this.m_display.__$ruid>-1&&null!=this.m_display.getMaterial()&&(this.m_display.getMaterial().setTextureAt(t,e),this.m_texChanged=!0)}setSortValue(t){null!=this.m_display&&null!=this.m_display.__$$runit&&(this.m_display.__$$runit.value=t)}setVisible(t){this.m_visible!=t&&(this.m_visible=t,null!=this.m_display&&(this.m_display.visible=t&&this.m_drawEnabled,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setVisible(this.m_display.visible)))}getVisible(){return this.m_visible}getTransform(){return this.m_transfrom}copyPositionFrom(t){null!=t&&this.m_transfrom.copyPositionFrom(t.getTransform())}copyMeshFrom(t){null!=t&&this.setMesh(t.getMesh())}copyMaterialFrom(t){null!=t&&this.setMaterial(t.getMaterial())}copyTransformFrom(t){let e=t;null!=e&&this.m_transfrom.copyFrom(e.m_transfrom)}initDisplay(t){this.m_display.vbuf=t.__$attachVBuf(),this.m_display.ivsIndex=0,this.m_display.ivsCount=t.vtCount,this.m_display.drawMode=t.drawMode,this.m_display.trisNumber=t.trisNumber,this.m_display.visible=this.m_visible&&this.m_drawEnabled}setMesh(t){null==this.m_mesh?null!=t&&(t.isEnabled()||t.rebuild(),t.isEnabled()&&(this.m_mesh=t,t.__$attachThis(),null==this.m_display&&this.createDisplay(),null!=this.m_display&&(this.m_display.setTransform(this.m_transfrom.getMatrix()),this.initDisplay(t)),null!=this.m_globalBounds&&this.m_globalBounds.copyFrom(t.bounds),this.updateMesh())):null!=this.m_display&&this.m_display.__$ruid>-1&&this.m_mesh!=t&&null!=t&&(this.m_transfrom.updatedStatus|=2,this.m_mesh.__$detachVBuf(this.m_display.vbuf),this.m_mesh.__$detachThis(),t.__$attachThis(),this.m_mesh=t,this.initDisplay(t),this.m_meshChanged=!0,this.updateMesh())}updateMesh(){}getIvsIndex(){return this.m_display.ivsIndex}getIvsCount(){return this.m_display.ivsCount}setIvsParam(t,e){null!=this.m_display&&(this.m_display.ivsIndex=t,this.m_display.ivsCount=e,this.m_display.__$ruid>-1&&this.m_display.__$$runit.setIvsParam(t,e))}getMesh(){return this.m_mesh}hasMesh(){return null!=this.m_mesh}isPolyhedral(){return null==this.m_mesh||this.m_mesh.isPolyhedral()}testRay(t,e,s,i){return this.m_mesh.testRay(t,e,s,i)}setMaterial(t){null!=t&&(null==this.m_display&&(this.m_display=o.default.Create(),this.m_display.setTransform(this.m_transfrom.getMatrix()),this.m_display.visible=this.m_visible&&this.m_drawEnabled),this.m_display.getMaterial()!=t&&(i.default.RENDERER_UID_FLAT&this.__$rseFlag)==i.default.RENDERER_UID_FLAT&&this.m_display.__$ruid<0&&(this.m_display.renderState=this.m_renderState,this.m_display.rcolorMask=this.m_rcolorMask,this.m_display.setMaterial(t)))}getMaterial(){return null!=this.m_display?this.m_display.getMaterial():null}getDisplay(){return this.m_display}getInvMatrix(){return this.m_transfrom.getInvMatrix()}getMatrix(){return this.m_transfrom.getMatrix()}getToParentMatrix(){return this.m_transfrom.getToParentMatrix()}setRenderColorMask(t){this.m_rcolorMask=t,null!=this.m_display&&(this.m_display.rcolorMask=this.m_rcolorMask,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setDrawFlag(this.m_renderState,this.m_rcolorMask))}setRenderColorMaskByName(t){this.m_rcolorMask=n.default.GetRenderColorMaskByName(t),null!=this.m_display&&(this.m_display.rcolorMask=this.m_rcolorMask,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setDrawFlag(this.m_renderState,this.m_rcolorMask))}setRenderState(t){this.m_renderState=t,null!=this.m_display&&(this.m_display.renderState=this.m_renderState,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setDrawFlag(this.m_renderState,this.m_rcolorMask))}setRenderStateByName(t){this.m_renderState=n.default.GetRenderStateByName(t),null!=this.m_display&&(this.m_display.renderState=this.m_renderState,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setDrawFlag(this.m_renderState,this.m_rcolorMask))}createDisplay(){this.m_display=o.default.Create()}activeDisplay(){if(null!=this.m_display){let t=this.m_display.getMaterial();if(null!=t){if(null==t.getShaderData()&&null!=t.getCodeBuf()&&null==t.getShaderData()){let e=t.getTextureList(),s=null!=e&&e.length>0;t.initializeByCodeBuf(s)}null==this.getMesh()&&(this.__activeMesh(t),this.m_display.name=this.name)}}}__activeMesh(t){}getUid(){return this.m_uid}setXYZ(t,e,s){this.m_transfrom.setXYZ(t,e,s)}setPosition(t){this.m_transfrom.setPosition(t)}getPosition(t){this.m_transfrom.getPosition(t)}setRotationXYZ(t,e,s){this.m_transfrom.setRotationXYZ(t,e,s)}setScaleXYZ(t,e,s){this.m_transfrom.setScaleXYZ(t,e,s)}getRotationXYZ(t){this.m_transfrom.getRotationXYZ(t)}getScaleXYZ(t){this.m_transfrom.getScaleXYZ(t)}destroy(){null!=this.m_mouseEvtDispatcher&&(this.m_mouseEvtDispatcher.destroy(),this.m_mouseEvtDispatcher=null),null!=this.m_transfrom&&this.isFree()&&(null!=this.m_display&&(this.m_mesh.__$detachVBuf(this.m_display.vbuf),o.default.Restore(this.m_display),this.m_display=null),l.default.Restore(this.m_transfrom),this.m_transfrom=null,null!=this.m_mesh&&(this.m_mesh.__$detachThis(),this.m_mesh=null),this.__$setParent(null),this.m_visible=!0,this.m_drawEnabled=!0,this.m_renderProxy=null,this.__$rseFlag=i.default.DEFAULT)}isInRenderer(){return(this.__$rseFlag&i.default.RENDERER_UID_FLAT)!=i.default.RENDERER_UID_FLAT}isRenderEnabled(){return null!=this.m_display&&this.m_display.__$ruid>-1}updateBounds(){null!=this.m_transfrom&&(this.m_transfrom.setX(this.m_transfrom.getX()),this.update())}update(){if(this.m_transfrom.updatedStatus>this.m_transStatus&&(this.m_transStatus=this.m_transfrom.updatedStatus),this.m_transStatus!=l.default.UPDATE_NONE){if(null!=this.m_globalBounds&&null!=this.m_mesh)if(this.m_transfrom.update(),this.m_transStatus>l.default.UPDATE_POSITION){let t=this.m_mesh.bounds.min,e=this.m_mesh.bounds.max,s=m.s_boundsInVS;s[0]=t.x,s[1]=t.y,s[2]=t.z,s[3]=e.x,s[4]=t.y,s[5]=t.z,s[6]=t.x,s[7]=t.y,s[8]=e.z,s[9]=e.x,s[10]=t.y,s[11]=e.z,s[12]=t.x,s[13]=e.y,s[14]=t.z,s[15]=e.x,s[16]=e.y,s[17]=t.z,s[18]=t.x,s[19]=e.y,s[20]=e.z,s[21]=e.x,s[22]=e.y,s[23]=e.z,this.m_transfrom.getMatrix().transformVectors(s,24,m.s_boundsOutVS),this.m_globalBounds.reset(),this.m_globalBounds.addXYZFloat32Arr(m.s_boundsOutVS),this.m_globalBounds.update()}else this.m_globalBounds.radius=this.m_mesh.bounds.radius,this.m_globalBounds.radius2=this.m_mesh.bounds.radius2,this.m_globalBounds.center.copyFrom(this.m_mesh.bounds.center),this.m_transfrom.getPosition(m.s_pos),this.m_globalBounds.center.addBy(m.s_pos),this.m_globalBounds.min.copyFrom(this.m_mesh.bounds.min),this.m_globalBounds.min.addBy(m.s_pos),this.m_globalBounds.max.copyFrom(this.m_mesh.bounds.max),this.m_globalBounds.max.addBy(m.s_pos),++this.m_globalBounds.version;else this.m_transfrom.update();this.m_transStatus=l.default.UPDATE_NONE}null!=this.m_display&&null!=this.m_display.__$$runit&&(this.m_display.__$$runit.bounds=this.m_globalBounds,this.m_transfrom.getPosition(this.m_display.__$$runit.pos))}toString(){return"DisplayEntity(name="+this.name+",uid = "+this.m_uid+", rseFlag = "+this.__$rseFlag+")"}}m.s_uid=0,m.s_boundsInVS=new Float32Array(24),m.s_boundsOutVS=new Float32Array(24),m.s_pos=new r.default,e.default=m},"442e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("2be1"),r=s("265e");class a extends i.default{createNode(){return new r.default}}e.default=a},4835:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("6e01"),r=s("faa5"),a=s("b3bd"),h=s("0fc4");class n extends r.default{constructor(){super(),this.m_uniqueName="",this.m_hasTex=!1}initialize(t){this.m_uniqueName="Text2DShd",this.m_hasTex=t,t&&(this.m_uniqueName+="_tex")}getFragShaderCode(){let t="#version 300 es\nprecision mediump float;\nin vec4 v_color;\n";return this.m_hasTex&&(t+="uniform sampler2D u_sampler0;\nin vec2 v_texUV;\nlayout(location = 0) out vec4 FragColor;\n"),t+="void main()\n{\n",this.m_hasTex?t+="float pa = pow(texture(u_sampler0, v_texUV).a,0.8);\nFragColor = vec4(v_color.xyz, min(v_color.w * pa,1.0));\n":t+="FragColor = v_color;\n",t+="}\n",t}getVtxShaderCode(){let t="#version 300 es\nprecision mediump float;\nlayout(location = 0) in vec2 a_vs;\nuniform vec4 u_stageParam;\nuniform vec4 u_params[3];\nout vec4 v_color;\n";return this.m_hasTex&&(t+="layout(location = 1) in vec2 a_uvs;\nout vec2 v_texUV;\n"),t+="void main()\n{\nvec4 pv4 = vec4(a_vs.xy,0.0,1.0);\npv4.xy *= u_params[1].xy;\nfloat cosv = cos(u_params[1].w);\nfloat sinv = sin(u_params[1].w);\npv4.xy = vec2(pv4.x * cosv - pv4.y * sinv, pv4.x * sinv + pv4.y * cosv);\npv4.xy += u_params[0].xy;\npv4.xy *= u_stageParam.xy;\npv4.xy += -1.0;\ngl_Position = pv4;\n",this.m_hasTex&&(t+="v_texUV = a_uvs.xy;\n"),t+="v_color = u_params[2];\n}\n",t}getUniqueShaderName(){return this.m_uniqueName}toString(){return"[Text2DShaderBuffer()]"}static GetInstance(){return null!=n.___s_instance||(n.___s_instance=new n),n.___s_instance}}n.___s_instance=null;class l extends h.default{constructor(){super(),this.m_rotation=0,this.m_r=0,this.m_g=0,this.m_b=0,this.m_brightness=1,this.m_paramArray=new Float32Array([0,0,0,0,1,1,0,0,1,1,1,1])}getCodeBuf(){return n.GetInstance()}setXY(t,e){this.m_paramArray[0]=t,this.m_paramArray[1]=e}setX(t){this.m_paramArray[0]=t}setY(t){this.m_paramArray[1]=t}getX(){return this.m_paramArray[0]}getY(){return this.m_paramArray[1]}setScale(t){this.m_paramArray[4]=t,this.m_paramArray[5]=t}setScaleXY(t,e){this.m_paramArray[4]=t,this.m_paramArray[5]=e}setScaleX(t){this.m_paramArray[4]=t}setScaleY(t){this.m_paramArray[5]=t}getScaleX(){return this.m_paramArray[4]}getScaleY(){return this.m_paramArray[5]}setRotation(t){this.m_rotation=t,this.m_paramArray[7]=i.default.MATH_PI_OVER_180*t}getRotation(){return this.m_rotation}setRGB3f(t,e,s){this.m_r=t,this.m_g=e,this.m_b=s,this.m_paramArray[8]=t*this.m_brightness,this.m_paramArray[9]=e*this.m_brightness,this.m_paramArray[10]=s*this.m_brightness}setRGBA4f(t,e,s,i){this.m_r=t,this.m_g=e,this.m_b=s,this.m_paramArray[8]=t*this.m_brightness,this.m_paramArray[9]=e*this.m_brightness,this.m_paramArray[10]=s*this.m_brightness,this.m_paramArray[11]=i}setAlpha(t){this.m_paramArray[11]=t}getAlpha(){return this.m_paramArray[6]}setBrightness(t){this.m_brightness=t,this.m_paramArray[4]=this.m_r*t,this.m_paramArray[5]=this.m_g*t,this.m_paramArray[6]=this.m_b*t}getBrightness(){return this.m_brightness}createSharedUniform(){return null}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_params"],t.dataList=[this.m_paramArray],t}}e.default=l},"4a54":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("352a");class r{constructor(){this.m_versionDeclare="#version 300 es\n",this.m_preciousCode="\nprecision mediump float;\n",this.m_mainBeginCode="\n\nvoid main(){\n",this.m_mainEndCode="\n}\n",this.m_vertLayoutNames=[],this.m_vertLayoutTypes=[],this.m_fragOutputNames=[],this.m_fragOutputTypes=[],this.m_vertUniformNames=[],this.m_vertUniformTypes=[],this.m_fragUniformNames=[],this.m_fragUniformTypes=[],this.m_varyingNames=[],this.m_varyingTypes=[],this.m_textureSampleTypes=[],this.m_objMat=!1,this.m_viewMat=!1,this.m_projMat=!1,this.m_vertMainCode="",this.m_fragMainCode=""}reset(){this.m_objMat=!1,this.m_viewMat=!1,this.m_projMat=!1,this.m_vertMainCode="",this.m_fragMainCode="",this.m_vertLayoutNames=[],this.m_vertLayoutTypes=[],this.m_fragOutputNames=[],this.m_fragOutputTypes=[],this.m_varyingNames=[],this.m_varyingTypes=[],this.m_vertUniformNames=[],this.m_vertUniformTypes=[],this.m_fragUniformNames=[],this.m_fragUniformTypes=[],this.m_textureSampleTypes=[]}addVertLayout(t,e){this.m_vertLayoutNames.push(e),this.m_vertLayoutTypes.push(t)}addFragOutput(t,e){this.m_fragOutputNames.push(e),this.m_fragOutputTypes.push(t)}addVarying(t,e){this.m_varyingNames.push(e),this.m_varyingTypes.push(t)}addVertUniform(t,e){this.m_vertUniformNames.push(e),this.m_vertUniformTypes.push(t)}addFragUniform(t,e){this.m_fragUniformNames.push(e),this.m_fragUniformTypes.push(t)}addTextureSample2D(){this.m_textureSampleTypes.push("sampler2D")}addTextureSampleCube(){this.m_textureSampleTypes.push("samplerCube")}addTextureSample3D(){this.m_textureSampleTypes.push("sampler3D")}useVertSpaceMats(t,e=!1,s=!0){this.m_objMat=!0,this.m_viewMat=!0,this.m_projMat=!0}addVertMainCode(t){this.m_vertMainCode+=t}addFragMainCode(t){this.m_fragMainCode+=t}buildFragCode(){let t="";i.default.IsWebGL2()&&(t+=this.m_versionDeclare),t+=this.m_preciousCode;let e=0,s=0;for(e=0,s=this.m_textureSampleTypes.length;e<s;e++)t+="\nuniform "+this.m_textureSampleTypes[e]+" u_sampler"+e+";";for(e=0,s=this.m_fragUniformTypes.length;e<s;e++)t+="\nuniform "+this.m_fragUniformTypes[e]+" "+this.m_fragUniformNames[e]+";";for(e=0,s=this.m_varyingNames.length;e<s;e++)t+="\nin "+this.m_varyingTypes[e]+" "+this.m_varyingNames[e]+";";for(e=0,s=this.m_fragOutputNames.length;e<s;e++)t+="\nout "+this.m_fragOutputTypes[e]+" "+this.m_fragOutputNames[e]+";";return t+=this.m_mainBeginCode,t+=this.m_fragMainCode,t+=this.m_mainEndCode,t}buildVertCode(){let t="";i.default.IsWebGL2()&&(t+=this.m_versionDeclare),t+=this.m_preciousCode;let e=0,s=this.m_vertLayoutNames.length;for(;e<s;e++)t+="\nlayout(location = "+e+") in "+this.m_vertLayoutTypes[e]+" "+this.m_vertLayoutNames[e]+";";for(e=0,s=this.m_vertUniformTypes.length;e<s;e++)t+="\nuniform "+this.m_vertUniformTypes[e]+" "+this.m_vertUniformNames[e]+";";for(this.m_objMat&&(t+="\nuniform mat4 u_objMat;"),this.m_viewMat&&(t+="\nuniform mat4 u_viewMat;"),this.m_projMat&&(t+="\nuniform mat4 u_projMat;"),e=0,s=this.m_varyingNames.length;e<s;e++)t+="\nout "+this.m_varyingTypes[e]+" "+this.m_varyingNames[e]+";";return t+=this.m_mainBeginCode,t+=this.m_vertMainCode,t+=this.m_mainEndCode,t}}e.default=r},"4cf7":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98");class r{constructor(){this.m_imgTexList=[],this.m_bytesTexList=[],this.m_floatTexList=[],this.m_wrapperTexList=[]}addTexture(t){switch(t.getType()){case i.TextureProxyType.Image:this.m_imgTexList.push(t);break;case i.TextureProxyType.Bytes:this.m_bytesTexList.push(t);break;case i.TextureProxyType.Float:this.m_floatTexList.push(t);break;case i.TextureProxyType.Wrapper:this.m_wrapperTexList.push(t);break;default:break}}getTexture(t){switch(t){case i.TextureProxyType.Image:if(this.m_imgTexList.length>0)return this.m_imgTexList.pop();break;case i.TextureProxyType.Bytes:if(this.m_bytesTexList.length>0)return this.m_bytesTexList.pop();break;case i.TextureProxyType.Float:if(this.m_floatTexList.length>0)return this.m_floatTexList.pop();break;case i.TextureProxyType.Wrapper:if(this.m_wrapperTexList.length>0)return this.m_wrapperTexList.pop();break;default:break}return null}}e.TexturePool=r,e.default=r},"4f27":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("352a"),r=s("d53d"),a=s("2560"),h=s("83d1"),n=s("d88f"),l=s("e87b");class _ extends r.ShaderUniform{use(t){}useByLocation(t,e,s,i){}useByShd(t,e){}updateData(){}destroy(){}}_.EmptyUniform=new _;class o{static Initialize(){if(o.s_initBoo){o.s_initBoo=!1;let t=new a.default;o.s_builders.push(t),o.s_uniformDict.set(t.getIDNS(),t),t=new h.default,o.s_builders.push(t),o.s_uniformDict.set(t.getIDNS(),t),t=new n.default,o.s_builders.push(t),o.s_uniformDict.set(t.getIDNS(),t),t=new l.default,o.s_builders.push(t),o.s_uniformDict.set(t.getIDNS(),t),o.s_buildersTot=o.s_builders.length}}static AddSharedUniformBuilder(t){null==t||o.s_uniformDict.has(t.getIDNS())||(o.s_builders.push(t),o.s_uniformDict.set(t.getIDNS(),t),++o.s_buildersTot)}static removeSharedUniformBuilder(t){if(null!=t&&o.s_uniformDict.has(t.getIDNS())){for(let e=0;e<o.s_buildersTot;++e)if(t==o.s_builders[e]){o.s_builders.splice(e,1),--o.s_buildersTot;break}o.s_uniformDict.delete(t.getIDNS())}}static removeSharedUniformBuilderByName(t){if(o.s_uniformDict.has(t)){let e=o.s_uniformDict.get(t);for(let t=0;t<o.s_buildersTot;++t)if(e==o.s_builders[t]){o.s_builders.splice(t,1),--o.s_buildersTot;break}o.s_uniformDict.delete(t)}}static BuildShared(t,e,s){let i=null,r=null,a=o.s_builders,h=0,n=o.s_buildersTot,l=null;for(;h<n;++h)l=a[h].create(e,s),null!=l&&(null!=r?r.next=l:null==i&&(i=l),r=l);if(null==t?t=i:null!=i&&(r.next=t,t=i),null==t)t=_.EmptyUniform;else{let e=t,i=0;while(null!=e){if(null!=e.uniformNameList&&null==e.locations)for(e.types=[],e.locations=[],e.uniformSize=e.uniformNameList.length,i=0;i<e.uniformSize;++i)e.types.push(s.getUniformTypeByNS(e.uniformNameList[i])),e.locations.push(s.getUniformLocationByNS(e.uniformNameList[i]));e=e.next}}return t}static BuildLocalFromTransformV(t,e){if(null!=t){let s;return s=new r.ShaderMat4Uniform,s.uniformSize=0,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize+=1,s.uniformNameList.push("u_objMat"),s.types.push(e.getUniformTypeByNS("u_objMat")),s.locations.push(e.getUniformLocationByNS("u_objMat")),s.dataList.push(t),s.dataSizeList.push(1),s}return o.s_emptyUniform}static BuildLocalFromData(t,e){if(null!=t){let s;s=i.default.IsWebGL1()?new r.ShaderUniformV1:new r.ShaderUniformV2,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize=0;let a=t,h=0;while(null!=a){if(null!=a.uniformNameList&&null==a.locations)for(s.uniformSize+=a.uniformNameList.length,h=0;h<s.uniformSize;++h)s.uniformNameList.push(a.uniformNameList[h]),s.types.push(e.getUniformTypeByNS(a.uniformNameList[h])),s.locations.push(e.getUniformLocationByNS(a.uniformNameList[h])),s.dataList.push(a.dataList[h]),s.dataSizeList.push(e.getUniformLengthByNS(a.uniformNameList[h]));a=a.next}return s}return _.EmptyUniform}static BuildLocal(t,e){let s=new r.ShaderUniform;s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize=0;let i=t,a=0;while(null!=i){if(null!=i.uniformNameList&&null==i.locations)for(s.uniformSize+=i.uniformNameList.length,a=0;a<s.uniformSize;++a)s.uniformNameList.push(i.uniformNameList[a]),s.types.push(e.getUniformTypeByNS(i.uniformNameList[a])),s.locations.push(e.getUniformLocationByNS(i.uniformNameList[a])),s.dataList.push(i.dataList[a]),s.dataSizeList.push(e.getUniformLengthByNS(i.uniformNameList[a]));i=i.next}return s}}o.s_initBoo=!0,o.s_uniformDict=new Map,o.s_builders=[],o.s_buildersTot=0,o.s_emptyUniform=new r.ShaderUniform,e.default=o},5282:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t=0,e=0,s=0,i=0){this.x=0,this.y=0,this.z=0,this.u=0,this.v=1,this.nx=0,this.ny=0,this.nz=0,this.index=0,this.x=t,this.y=e,this.z=s,this.index=i}cloneVertex(){let t=new i(this.x,this.y,this.z,this.index);return t.nx=this.nx,t.ny=this.ny,t.nz=this.nz,t.u=this.u,t.v=this.v,t}copyFrom(t){this.x=t.x,this.y=t.y,this.z=t.z,this.u=t.u,this.v=t.v,this.nx=t.nx,this.ny=t.ny,this.nz=t.nz,this.index=t.index}}e.default=i},"52e0":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98"),r=s("0851");class a extends r.default{constructor(t,e){super(t,e,!1),this.m_imgDataList=null,this.m_texTarget=i.TextureTarget.TEXTURE_CUBE,this.mipmapEnabled=!0,this.m_type=i.TextureProxyType.BytesCube}toAlphaFormat(){this.srcFormat=i.TextureFormat.ALPHA,this.internalFormat=i.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=i.TextureFormat.RED,this.internalFormat=i.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=i.TextureFormat.RGB,this.internalFormat=i.TextureFormat.RGB,this.unpackAlignment=3}toRGBAFormat(){this.srcFormat=i.TextureFormat.RGBA,this.internalFormat=i.TextureFormat.RGBA,this.unpackAlignment=4}setDataFromBytesToFaceAt(t,e,s,i,r=0){if(null==this.m_imgDataList&&(this.m_imgDataList=[null,null,null,null,null,null]),s>0&&i>0){0==t&&(this.m_texWidth=s,this.m_texHeight=i,this.m_miplevel=r),this.m_imgDataList[t]={imgData:e,miplevel:r};let a=5;for(;a>=0;--a)if(null==this.m_imgDataList[a])break;this.m_haveRData=a<0}}uploadData(t){let e=t.getRC(),s=null;for(let r=0;r<6;++r)s=this.m_imgDataList[r],e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,this.m_miplevel,i.TextureFormat.ToGL(e,this.internalFormat),this.getWidth(),this.getWidth(),0,i.TextureFormat.ToGL(e,this.srcFormat),i.TextureDataType.ToGL(e,this.dataType),s.imgData);this.version=0}toString(){return"[BytesCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.m_imgDataList)for(let t=0;t<6;++t)null!=this.m_imgDataList[t]&&(this.m_imgDataList[t].imgData=null);console.log("BytesCubeTextureProxy::destroy(), destroy a BytesCubeTextureProxy instance..."),super.__$destroy()}}}e.default=a},5326:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.m_total=256,this.m_uid=0,this.index=0,this.dataList=[],this.flagList=null,this.m_uid=t}getUid(){return this.m_uid}static GetSlotAt(t){return i.s_slots[t]}static Initialize(t){let e=i.s_slots[t];if(null==e&&(e=new i(t),i.s_slots[t]=e),null==e.flagList){e.flagList=new Uint16Array(e.m_total);for(let t=0;t<e.m_total;++t)e.dataList.push(null),e.flagList[t]=0}}}i.s_slots=new Array(16),e.default=i},5336:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_lastTime=0,this.m_fps=60,this.m_canvas2D=null,this.m_ctx2D=null,this.m_delayTime=10,this.delayTime=40,this.statusInfo="",this.statusEnbled=!0}initialize(t,e=0){var s=null;try{void 0!=document&&(s=document)}catch(i){console.log("RenderStatusDisplay::initialize(), document is undefined.")}null!=s&&(this.m_canvas2D=s.getElementById(t),null==this.m_canvas2D&&(this.m_canvas2D=document.createElement("canvas"),document.body.appendChild(this.m_canvas2D),this.m_canvas2D.width=e<10?300:e,this.m_canvas2D.height=70,this.m_canvas2D.style.display="bolck",this.m_canvas2D.style.left="0px",this.m_canvas2D.style.top="0px",this.m_canvas2D.style.position="absolute",this.m_canvas2D.style.backgroundColor="transparent",this.m_canvas2D.style.pointerEvents="none"),this.m_ctx2D=this.m_canvas2D.getContext("2d"),this.m_ctx2D.font="50px Verdana",this.m_ctx2D.fillStyle="red",this.m_ctx2D.textAlign="left")}getFPS(){return this.m_fps}getFPSStr(){return this.m_fps>60?"FPS: 60":this.m_fps<10?"FPS: 0"+this.m_fps:"FPS: "+this.m_fps}render(){this.statusEnbled&&(this.m_ctx2D.clearRect(0,0,600,70),this.m_ctx2D.fillText("FPS:"+this.m_fps+this.statusInfo,5,50))}update(t=!0){if(this.m_delayTime>0)--this.m_delayTime,this.m_lastTime=Date.now();else{if(null!=this.m_ctx2D){let e=Date.now();this.m_lastTime>0&&(this.m_lastTime=e-this.m_lastTime,this.m_fps=Math.round(1e3/this.m_lastTime),t&&this.render()),this.m_lastTime=e}this.m_delayTime=this.delayTime}}}e.default=i},"557f":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98"),r=s("0851");class a extends r.default{constructor(t,e,s=1,r=!1){super(t,e,r),this.m_bytes=null,this.m_tex3DDepth=1,this.internalFormat=i.TextureFormat.R8,this.srcFormat=i.TextureFormat.RED,this.m_tex3DDepth=s,this.m_texTarget=i.TextureTarget.TEXTURE_3D,this.m_type=i.TextureProxyType.Texture3D,this.unpackAlignment=1}getDepth(){return this.m_tex3DDepth}uploadFromTypedArray(t,e=0){this.isGpuEnabled()||(this.m_bytes=t,this.m_miplevel=e,this.m_haveRData=!0)}uploadData(t){if(null!=this.m_bytes){let e=t.getRC();e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage3D(e.TEXTURE_3D,0,i.TextureFormat.ToGL(e,this.internalFormat),this.m_texWidth,this.m_texHeight,this.m_tex3DDepth,0,i.TextureFormat.ToGL(e,this.srcFormat),e.UNSIGNED_BYTE,this.m_bytes),e.pixelStorei(e.UNPACK_ALIGNMENT,4)}}__$destroy(){this.getAttachCount()<1&&(this.m_bytes=null,console.log("Texture3DProxy::destroy(), destroy a Texture3DProxy instance..."),super.__$destroy())}toString(){return"[Texture3DProxy(width="+this.getWidth()+",height="+this.getHeight()+",depth="+this.getDepth()+")]"}}e.default=a},"56c5":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("030e");class r{static SetRenderer(t){r.m_rc=t.getRC(),r.m_webGLVer=t.getWebGLVersion();let e=r;1==r.m_webGLVer&&null!=i.default.WEBGL_draw_buffers?e.COLOR_ATTACHMENT0=i.default.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL:e.COLOR_ATTACHMENT0=r.m_rc.COLOR_ATTACHMENT0}static DrawBuffers(t){2==r.m_webGLVer?r.m_rc.drawBuffers(t):null!=i.default.WEBGL_draw_buffers&&i.default.WEBGL_draw_buffers.drawBuffersWEBGL(t)}}r.m_rc=null,r.m_webGLVer=2,r.COLOR_ATTACHMENT0=0,e.default=r},"5d04":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98"),r=s("4cf7"),a=s("5e78"),h=s("fe7f"),n=s("9f3e"),l=s("f928"),_=s("eaee"),o=s("52e0"),m=s("d314"),u=s("557f"),d=s("cfaf"),c=s("85b6"),f=s("da6a"),p=s("ccdf");class g{constructor(){this.m_texPool=new r.default,this.m_rttStore=null,this.m_renderer=null,this.m_texLoaders=[],this.m_clearDelay=128}addTexLoader(t){if(null!=t){let e=0,s=this.m_texLoaders.length;for(;e<s;++e)if(t==this.m_texLoaders[e])break;e>=s&&this.m_texLoaders.push(t)}}removeTexLoader(t){if(null!=t){let e=0,s=this.m_texLoaders.length;for(;e<s;++e)if(t==this.m_texLoaders[e]){this.m_texLoaders.slice(e,1);break}}}setRenderer(t){this.m_renderer=t,f.default.GetInstance().setRenderProxy(t.getRenderProxy()),null==this.m_rttStore&&null!=t&&(this.m_rttStore=new p.default(t.getRenderProxy()))}getRTTStrore(){return this.m_rttStore}createWrapperTex(t,e,s=!1){let i=new c.default(t,e,s);return i.__$setRenderProxy(this.m_renderer.getRenderProxy()),i}createRTTTex2D(t,e,s=!1){let i=new d.default(t,e,s);return i.__$setRenderProxy(this.m_renderer.getRenderProxy()),i}createImageTex2D(t,e,s=!1){let r=this.m_texPool.getTexture(i.TextureProxyType.Image);return null==r&&(r=new a.default(t,e,s)),r.__$setRenderProxy(this.m_renderer.getRenderProxy()),r.mipmapEnabled=!0,r.setWrap(i.TextureConst.WRAP_REPEAT),r}createHalfFloatTex2D(t,e,s=!1){let r=this.m_texPool.getTexture(i.TextureProxyType.Float);return null==r&&(r=new l.default(t,e,s)),r.__$setRenderProxy(this.m_renderer.getRenderProxy()),r.srcFormat=i.TextureFormat.RGBA,r.dataType=i.TextureDataType.HALF_FLOAT_OES,r}createFloatTex2D(t,e,s=!1){let r=this.m_texPool.getTexture(i.TextureProxyType.Float);return null==r&&(r=new l.default(t,e,s)),r.__$setRenderProxy(this.m_renderer.getRenderProxy()),r}createUint16Tex2D(t,e,s=!1){return new n.default(t,e,s)}createFloatCubeTex(t,e,s=!1){return new _.default(t,e)}createBytesTex(t,e){let s=this.m_texPool.getTexture(i.TextureProxyType.Bytes);return null==s&&(s=new h.default(t,e)),s.__$setRenderProxy(this.m_renderer.getRenderProxy()),s}createBytesCubeTex(t,e){let s=new o.default(t,e);return s.__$setRenderProxy(this.m_renderer.getRenderProxy()),s}createImageCubeTex(t,e){let s=new m.default(t,e);return s.__$setRenderProxy(this.m_renderer.getRenderProxy()),s}createTex3D(t,e,s=1){s<1&&(s=1);let i=new u.default(t,e,s);return i.__$setRenderProxy(this.m_renderer.getRenderProxy()),i}createRGBATex2D(t,e,s){t=t>1?t:1,e=e>1?e:1;let i=t*e,r=this.createBytesTex(t,e),a=new Uint8Array(4*i),h=Math.round(255*s.r),n=Math.round(255*s.g),l=Math.round(255*s.b),_=Math.round(255*s.a),o=0,m=[h,n,l,_];for(let u=0;u<i;++u)a.set(m,o),o+=4;return r.setDataFromBytes(a,0,t,e),r.__$setRenderProxy(this.m_renderer.getRenderProxy()),r}createAlphaTex2D(t,e,s){t=t>1?t:1,e=e>1?e:1;let i=t*e,r=this.createBytesTex(t,e);r.toAlphaFormat();let a=new Uint8Array(i),h=Math.round(255*s);return a.fill(h,0,i),r.setDataFromBytes(a,0,t,e),r.__$setRenderProxy(this.m_renderer.getRenderProxy()),r}createAlphaTexBytes2D(t,e,s){let i=this.createBytesTex(t,e);return i.setDataFromBytes(s,0,t,e),i.toAlphaFormat(),i.__$setRenderProxy(this.m_renderer.getRenderProxy()),i}getCubeRTTTextureAt(t){return this.m_rttStore.getCubeRTTTextureAt(t)}createCubeRTTTextureAt(t,e,s){return this.m_rttStore.createCubeRTTTextureAt(t,e,s)}getRTTTextureAt(t){return this.m_rttStore.getRTTTextureAt(t)}createRTTTextureAt(t,e,s){return this.m_rttStore.createRTTTextureAt(t,e,s)}getDepthTextureAt(t){return this.m_rttStore.getDepthTextureAt(t)}createDepthTextureAt(t,e,s){return this.m_rttStore.createDepthTextureAt(t,e,s)}getRTTFloatTextureAt(t){return this.m_rttStore.getRTTFloatTextureAt(t)}createRTTFloatTextureAt(t,e,s){return this.m_rttStore.createRTTFloatTextureAt(t,e,s)}run(){let t=0,e=this.m_texLoaders.length;for(;t<e;++t)this.m_texLoaders[t].run();if(this.m_clearDelay<1){let t;this.m_clearDelay=128;let e=f.default.GetInstance().getFreeResUidMap(),s=32;for(const[i,r]of e){if(s<1)break;s--,r>2?(e.delete(i),t=f.default.GetInstance().removeTextureByUid(i),null!=t?this.m_texPool.addTexture(t):console.warn("TextureBlock remove a texture(uid="+i+") error."),console.log("TextureBlock remove a texture: ",t)):e.set(i,r+1)}}this.m_clearDelay--}}e.TextureBlock=g,e.default=g},"5e78":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98"),r=s("7181"),a=s("0851");class h extends a.default{constructor(t,e,s=!1){super(t,e,s),this.m_texData=null,this.m_texDatas=null,this.m_texDatasLen=0,this.minFilter=i.TextureConst.LINEAR_MIPMAP_LINEAR,this.m_type=i.TextureProxyType.Image}getTexData(){return this.m_texData}setDataFromImage(t,e=0,s=0,i=0,a=!1){if(null!=t&&t.width>0&&t.height>0){this.m_haveRData=!0,e<0&&(e=0),e>15&&(e=15),e>=this.m_texDatasLen&&(this.m_texDatasLen=e+1);let h=this.m_texData;null!=h?this.m_texData.miplevel!=e&&(null==this.m_texDatas&&(this.m_texDatas=[this.m_texData,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),h=this.m_texDatas[e],null==h&&(h=r.default.Create(),h.miplevel=e,a=!0,this.m_texDatas[e]=h)):(h=this.m_texData=r.default.Create(),h.miplevel=e,a=!0,this.m_texWidth=t.width,this.m_texHeight=t.height),h.data==t&&h.offsetx==s&&h.offsety==i||(0==e&&(this.m_texWidth=t.width,this.m_texHeight=t.height),h.data=t,h.status=0,(h.width<t.width||h.height<t.height||a)&&(h.width=t.width,h.height=t.height,h.status=1),h.offsetx=s,h.offsety=i),this.version++}}uploadData(t){null!=this.m_texData&&this.dataUploadToGpu(t.getRC(),this.m_texData,this.m_texDatas,!0),this.version=0}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())&&null!=this.m_texData){let e=t.getRC();this.__$updateToGpuBegin(t),this.dataUploadToGpu(e,this.m_texData,this.m_texDatas),this.__$buildParam(e),this.m_generateMipmap=!0}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.m_texDatas){for(let t=0;t<this.m_texDatasLen;++t)r.default.Restore(this.m_texDatas[t]);this.m_texDatasLen=0,this.m_texDatas=null,this.m_texData=null}null!=this.m_texData&&(r.default.Restore(this.m_texData),this.m_texData=null),super.__$destroy()}}toString(){return"[ImageTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=h},"5f3c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("352a"),r=s("df9d"),a=s("7c63");class h{constructor(t){this.m_uid=-1,this.m_nodeLinker=new r.default,this.index=-1,this.shdUid=-1,this.procuid=-1,this.batchEnabled=!0,this.fixedState=!0,this.runMode=0,this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null,this.m_shader=null,this.m_shader=t,this.m_uid=h.__s_uid++}showInfo(){this.m_nodeLinker.showInfo()}addNode(t){this.m_nodeLinker.addNodeAndSort(t)}rejoinNode(t){this.m_nodeLinker.containsNode(t)&&(this.m_nodeLinker.removeNodeAndSort(t),this.m_nodeLinker.addNodeAndSort(t))}removeNode(t){this.m_nodeLinker.removeNodeAndSort(t)}isEmpty(){return null==this.m_nodeLinker.getBegin()}run(t){switch(this.runMode){case 2:this.run2(t);break;case 1:this.run1(t);break;case 0:this.run0(t);break;default:break}}run0(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let s=null;while(null!=e)e.drawEnabled&&(s=e.unit,s.drawEnabled&&(s.run(t),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}run1(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let s=null,i=0,r=0,a=!1,h=!1;while(null!=e)i>0?i--:(i=this.m_nodeLinker.getVtxTotalAt(e.rvroI)-1,a=!0),r>0?r--:(r=this.m_nodeLinker.getTexTotalAt(e.rtroI)-1,h=!0),e.drawEnabled&&(s=e.unit,s.drawEnabled&&(a&&(e.vro.run(),a=!1),h&&(e.tro.run(),h=!1),s.run2(t),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}run2(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let s=null,i=0,r=0,h=!1,n=!1;a.RenderStateObject.UseRenderState(e.unit.renderState),a.RenderColorMask.UseRenderState(e.unit.rcolorMask);while(null!=e)i>0?i--:(i=this.m_nodeLinker.getVtxTotalAt(e.rvroI)-1,h=!0),r>0?r--:(r=this.m_nodeLinker.getTexTotalAt(e.rtroI)-1,n=!0),e.drawEnabled&&(s=e.unit,s.drawEnabled&&(h&&(e.vro.run(),h=!1),n&&(e.tro.run(),n=!1),null!=s.ubo&&s.ubo.run(t),this.m_shader.useTransUniform(s.transUniform),this.m_shader.useUniform(s.uniform),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}runLockMaterial(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let s=null,i=!1;if(this.batchEnabled){let r=0;while(null!=e)r>0?r--:(r=this.m_nodeLinker.getVtxTotalAt(e.rvroI)-1,i=!0),s=e.unit,e.drawEnabled&&s.drawEnabled&&(i&&(e.vro.run(),i=!1),s.runLockMaterial2(),s.partTotal<1?s.drawThis(t):s.drawPart(t)),e=e.next}else while(null!=e)s=e.unit,e.drawEnabled&&s.drawEnabled&&(s.runLockMaterial(),s.partTotal<1?s.drawThis(t):s.drawPart(t)),e=e.next}}drawUnit(t,e,s){e.drawEnabled&&(this.m_shader.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t))}drawLockMaterialByUnit(t,e,s,r){if(e.drawEnabled){if(r&&this.m_shader.resetUniform(),i.default.IsMobileWeb()){let t=this.vtxResource.getVROByResUid(s.vbuf.getUid(),this.m_shader.getCurrentShd(),!0);t.run()}else e.vro.run();e.runLockMaterial2(),e.partTotal<1?e.drawThis(t):e.drawPart(t)}}reset(){let t=this.m_nodeLinker.getBegin(),e=null;if(null!=t){let s;while(null!=t)e=t,t=t.next,this.rpoUnitBuilder.setRPNodeParam(e.__$ruid,this.procuid,-1),e.reset(),s=e.unit,this.rpoNodeBuilder.restore(e)&&this.rpoUnitBuilder.restore(s)}this.index=-1,this.shdUid=-1,this.procuid=-1,this.m_nodeLinker.clear(),this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null}destroy(){this.reset()}getUid(){return this.m_uid}toString(){return"[RPOBlock(uid = "+this.m_uid+", index = "+this.index+", shdUid = "+this.shdUid+")]"}}h.__s_uid=0,e.default=h},"617e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("29ef"),r=s("402a"),a=s("4835"),h=s("efce"),n=s("725b"),l=s("cc48");class _ extends r.default{constructor(t=!0){super(),this.m_dynamicEnbaled=!0,this.m_currMaterial=null,this.m_currMesh=null,this.m_charsStr="",this.m_alignFactorX=.5,this.m_alignFactorY=.5,this.flipVerticalUV=!1,this.m_dynamicEnbaled=t}setAlignFactor(t,e){this.m_alignFactorX=t,this.m_alignFactorY=e,null!=this.m_currMesh&&this.m_currMesh.updateCharStr(this.m_charsStr)}alignLeftTop(){this.setAlignFactor(0,0)}alignCenter(){this.setAlignFactor(.5,.5)}alignLeftCenter(){this.setAlignFactor(0,.5)}setText(t){null!=this.m_currMesh&&(this.m_charsStr=t,this.m_currMesh.alignFactorX=this.m_alignFactorX,this.m_currMesh.alignFactorY=this.m_alignFactorY,this.m_currMesh.updateCharStr(t),this.update())}setRGBA4f(t,e,s,i){null!=this.m_currMaterial&&this.m_currMaterial.setRGBA4f(t,e,s,i)}setRGB3f(t,e,s){null!=this.m_currMaterial&&this.m_currMaterial.setRGB3f(t,e,s)}setAlpha(t){this.m_currMaterial.setAlpha(t)}getAlpha(){return this.m_currMaterial.getAlpha()}setBrightness(t){this.m_currMaterial.setBrightness(t)}getBrightness(){return this.m_currMaterial.getBrightness()}getWidth(){return this.m_currMesh.getWidth()*this.m_currMaterial.getScaleX()}getHeight(){return this.m_currMesh.getHeight()*this.m_currMaterial.getScaleY()}setXYZ(t,e,s){null!=this.m_currMaterial&&this.m_currMaterial.setXY(t,e)}setXY(t,e){null!=this.m_currMaterial&&this.m_currMaterial.setXY(t,e)}setX(t){null!=this.m_currMaterial&&this.m_currMaterial.setX(t)}setY(t){null!=this.m_currMaterial&&this.m_currMaterial.setY(t)}getX(){return null!=this.m_currMaterial?this.m_currMaterial.getX():0}getY(){return null!=this.m_currMaterial?this.m_currMaterial.getY():0}setScale(t){null!=this.m_currMaterial&&this.m_currMaterial.setScale(t)}getScaleX(){return this.m_currMaterial.getScaleX()}getScaleY(){return this.m_currMaterial.getScaleY()}setScaleX(t){this.m_currMaterial.setScaleX(t)}setScaleY(t){this.m_currMaterial.setScaleY(t)}setScaleXY(t,e){this.m_currMaterial.setScaleXY(t,e)}createMaterial(t){null==this.getMaterial()?(this.m_currMaterial=new a.default,this.m_currMaterial.setTextureList(t),this.setMaterial(this.m_currMaterial)):this.m_currMaterial.setTextureList(t)}initialize(t,e=null){this.m_charsStr=t,this.spaceCullMask=l.default.NONE,this.spaceCullMask=0,this.m_alignFactorX=0,this.m_alignFactorY=0,null==e?this.createMaterial([n.default.GetInstance().getTextureAt(0)]):this.createMaterial(e),this.activeDisplay(),this.setRenderState(i.default.BACK_TRANSPARENT_ALWAYS_STATE)}createBounds(){}__activeMesh(t){if(null==this.getMesh()){let e=new h.default;e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.alignFactorX=this.m_alignFactorX,e.alignFactorY=this.m_alignFactorY,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.m_charsStr),this.setMesh(e),this.m_currMesh=e}}update(){this.m_dynamicEnbaled&&this.m_mesh.isGeomDynamic()&&this.setIvsParam(0,this.m_mesh.vtCount),this.m_transfrom.update()}toString(){return"Text2DEntity(uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=_},"644c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}static GetTypeByTypeNS(t){switch(t){case"mat4":return i.SHADER_MAT4;case"mat3":return i.SHADER_MAT3;case"mat2":return i.SHADER_MAT2;case"float":return i.SHADER_FLOAT;case"int":return i.SHADER_INT;case"vec4":return i.SHADER_VEC4;case"vec3":return i.SHADER_VEC3;case"vec2":return i.SHADER_VEC2;case"vec4[]":return i.SHADER_VEC4FV;case"vec3[]":return i.SHADER_VEC3FV;case"vec2[]":return i.SHADER_VEC2FV;case"sampler2D":return i.SHADER_SAMPLER2D;case"sampler3D":return i.SHADER_SAMPLER3D;case"samplerCube":return i.SHADER_SAMPLERCUBE;default:break}return i.SHADER_UNDEFINED}static GetTypeNSByType(t){switch(t){case i.SHADER_MAT4:return"mat4";case i.SHADER_MAT3:return"mat3";case i.SHADER_MAT2:return"mat2";case i.SHADER_FLOAT:return"float";case i.SHADER_VEC4:return"vec4";case i.SHADER_VEC3:return"vec3";case i.SHADER_VEC2:return"vec2";case i.SHADER_SAMPLER2D:return"sampler2D";case i.SHADER_SAMPLER3D:return"sampler3D";case i.SHADER_SAMPLERCUBE:return"samplerCube";case i.SHADER_UNDEFINED:return"undefined";default:break}return""}}i.ATTRINS_VTX_VS="a_vs",i.ATTRINS_VTX_UVS="a_uvs",i.ATTRINS_VTX_NVS="a_nvs",i.ATTRINS_VTX_CVS="a_cvs",i.UNIFORMNS_OBJ_MAT_NS="u_objMat",i.UNIFORMNS_VIEW_MAT_NS="u_viewMat",i.UNIFORMNS_PROJ_MAT_NS="u_projMat",i.SHADER_UNDEFINED=3010,i.SHADER_VEC2=3011,i.SHADER_VEC3=3012,i.SHADER_VEC4=3013,i.SHADER_VEC2FV=3014,i.SHADER_VEC3FV=3015,i.SHADER_VEC4FV=3016,i.SHADER_MAT2=3017,i.SHADER_MAT3=3018,i.SHADER_MAT4=3019,i.SHADER_FLOAT=3020,i.SHADER_INT=3021,i.SHADER_MAT2FV=3022,i.SHADER_MAT3FV=3023,i.SHADER_MAT4FV=3024,i.SHADER_SAMPLER2D=3031,i.SHADER_SAMPLERCUBE=3032,i.SHADER_SAMPLER3D=3033,i.SHADER_PRECISION_LOWP=3101,i.SHADER_PRECISION_MEDIUMP=3111,i.SHADER_PRECISION_HIGHP=3121,i.UNIFORM_TEX_SAMPLER2D="sampler2D",i.UNIFORM_TEX_SAMPLERCUBE="samplerCube",i.UNIFORM_TEX_SAMPLER3D="sampler3D",i.UNIFORMNS_TEX_SAMPLER_0="u_sampler0",i.UNIFORMNS_TEX_SAMPLER_1="u_sampler1",i.UNIFORMNS_TEX_SAMPLER_2="u_sampler2",i.UNIFORMNS_TEX_SAMPLER_3="u_sampler3",i.UNIFORMNS_TEX_SAMPLER_4="u_sampler4",i.UNIFORMNS_TEX_SAMPLER_5="u_sampler5",i.UNIFORMNS_TEX_SAMPLER_6="u_sampler6",i.UNIFORMNS_TEX_SAMPLER_7="u_sampler7",i.UNIFORMNS_TEX_SAMPLER_LIST=[i.UNIFORMNS_TEX_SAMPLER_0,i.UNIFORMNS_TEX_SAMPLER_1,i.UNIFORMNS_TEX_SAMPLER_2,i.UNIFORMNS_TEX_SAMPLER_3,i.UNIFORMNS_TEX_SAMPLER_4,i.UNIFORMNS_TEX_SAMPLER_5,i.UNIFORMNS_TEX_SAMPLER_6,i.UNIFORMNS_TEX_SAMPLER_7],e.default=i},"65b4":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_runFlag=-1,this.m_running=!0}setRunFlag(t){this.m_runFlag=t}getRunFlag(){return this.m_runFlag}isRunning(){return this.m_running}isStopped(){return!this.m_running}run(){}}e.default=i},"68aa":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,s,i,r,a){1==this.status||a?t.texImage2D(e,this.miplevel,s,this.width,this.height,0,i,r,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,this.width,this.height,i,r,this.data),this.status=-1}static Create(){return i.s_list.length>0?i.s_list.pop():new i}static Restore(t){null!=t&&(t.data=null,i.s_list.push(t))}}i.s_list=[],e.default=i},"6a22":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_initX=0,this.m_initY=0,this.m_initMouseX=0,this.m_initMouseY=0,this.m_preMouseX=0,this.m_preMouseY=0,this.m_lockStatus=0,this.m_xRange=[-100,100],this.m_yRange=[-100,100],this.x=0,this.y=0}attach(t,e,s,i){this.m_initX=t,this.m_initY=e,this.m_initMouseX=s,this.m_initMouseY=i,this.x=this.m_initX,this.y=this.m_initY}detach(){}lockX(t=-1048575,e=1048575){this.m_lockStatus=2,this.m_xRange[0]=t,this.m_xRange[1]=e}lockY(t=-1048575,e=1048575){this.m_lockStatus=1,this.m_yRange[0]=t,this.m_yRange[1]=e}lockXY(t=-1048575,e=1048575,s=-1048575,i=1048575){this.m_lockStatus=3,this.m_xRange[0]=t,this.m_xRange[1]=e,this.m_yRange[0]=s,this.m_yRange[1]=i}unlock(){this.m_lockStatus=0}test(t,e){return Math.abs(t-this.m_preMouseX)>.001||Math.abs(e-this.m_preMouseY)>.001}updateDrag(t,e){switch(this.m_preMouseX=t,this.m_preMouseY=e,this.m_lockStatus){case 0:this.x=this.m_initX+(t-this.m_initMouseX),this.y=this.m_initY+(e-this.m_initMouseY);break;case 1:e=this.m_initY+(e-this.m_initMouseY),e=e<this.m_yRange[0]?e=this.m_yRange[0]:e>this.m_yRange[1]?e=this.m_yRange[1]:e,this.y=e;break;case 2:t=this.m_initX+(t-this.m_initMouseX),t=t<this.m_xRange[0]?t=this.m_xRange[0]:t>this.m_xRange[1]?t=this.m_xRange[1]:t,this.x=t;break;case 3:t=this.m_initX+(t-this.m_initMouseX),e=this.m_initY+(e-this.m_initMouseY),t=t<this.m_xRange[0]?t=this.m_xRange[0]:t>this.m_xRange[1]?t=this.m_xRange[1]:t,e=e<this.m_yRange[0]?e=this.m_yRange[0]:e>this.m_yRange[1]?e=this.m_yRange[1]:e,this.x=t,this.y=e;break;default:this.x=this.m_initX+(t-this.m_initMouseX),this.y=this.m_initY+(e-this.m_initMouseY);break}}}e.default=i},"6d49":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("352a"),r=s("baae"),a=s("8d98"),h=s("56c5");class n{constructor(t,e,s){this.m_uid=-1,this.m_rcuid=0,this.m_COLOR_ATTACHMENT0=0,this.m_fbo=null,this.m_depthStencilRBO=null,this.m_depthRBO=null,this.m_colorRBO=null,this.m_width=512,this.m_height=512,this.m_bufferLType=0,this.m_gl=null,this.m_fboTarget=0,this.m_texTargetTypes=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.m_attachmentMaskList=[!0,!0,!0,!0,!0,!0,!0,!0],this.m_preAttachTotal=0,this.m_preAttachIndex=0,this.m_activeAttachmentTotal=0,this.m_attachmentIndex=0,this.m_clearDepthArr=new Float32Array(1),this.m_clearColorArr=new Float32Array(4),this.m_stencilValueArr=new Int16Array(4),this.m_fboSizeChanged=!1,this.sizeFixed=!1,this.writeDepthEnabled=!0,this.writeStencilEnabled=!1,this.multisampleEnabled=!1,this.multisampleLevel=0,this.m_resizeW=2,this.m_resizeH=2,this.toString=function(){switch(this.m_bufferLType){case r.default.DRAW_FRAMEBUFFER:return"[FrameBufferObject(DRAW_FRAMEBUFFER(uid="+this.m_uid+" width="+this.m_width+",height="+this.m_height+")]";case r.default.READ_FRAMEBUFFER:return"[FrameBufferObject(READ_FRAMEBUFFER(uid="+this.m_uid+" width="+this.m_width+",height="+this.m_height+")]";default:break}return"[FrameBufferObject(FRAMEBUFFER(uid="+this.m_uid+" width="+this.m_width+",height="+this.m_height+")]"},this.m_rcuid=t,this.m_texRes=e,this.m_bufferLType=s,this.m_uid=n.s_uid++}getUid(){return this.m_uid}resetAttachmentMask(t){let e=this.m_attachmentMaskList.length-1;while(e>=0)this.m_attachmentMaskList[e]=t,--e}setAttachmentMaskAt(t,e){this.m_attachmentMaskList[t]=e}getActiveAttachmentTotal(){return this.m_activeAttachmentTotal}getAttachmentTotal(){return this.m_attachmentMaskList.length}bindToBackbuffer(t){switch(t){case r.default.DRAW_FRAMEBUFFER:this.m_gl.bindFramebuffer(this.m_gl.DRAW_FRAMEBUFFER,null);break;case r.default.READ_FRAMEBUFFER:this.m_gl.indFramebuffer(this.m_gl.READ_FRAMEBUFFER,null);break;default:this.m_gl.bindFramebuffer(this.m_gl.FRAMEBUFFER,null)}}bind(t){if(null!=this.m_fbo)switch(t){case r.default.DRAW_FRAMEBUFFER:this.m_gl.bindFramebuffer(this.m_gl.DRAW_FRAMEBUFFER,this.m_fbo);break;case r.default.READ_FRAMEBUFFER:this.m_gl.bindFramebuffer(this.m_gl.READ_FRAMEBUFFER,this.m_fbo);break;default:this.m_gl.bindFramebuffer(this.m_gl.FRAMEBUFFER,this.m_fbo)}}getFBO(){return this.m_fbo}getDepthStencilRBO(){return this.m_depthStencilRBO}getDepthRBO(){return this.m_depthRBO}getWidth(){return this.m_width}getHeight(){return this.m_height}getFramebufferType(){return this.m_bufferLType}renderToTexAt(t,e,s){let i=null!=e?e.internalFormat:-1;0==s&&(this.m_gl.bindFramebuffer(this.m_fboTarget,this.m_fbo),i!=a.TextureFormat.DEPTH_COMPONENT&&(this.m_activeAttachmentTotal=0,this.m_attachmentIndex=0));let r=-1,h=null;null!=e?(r=e.getTargetType(),e.uploadFromFbo(this.m_texRes,this.m_width,this.m_height),h=this.m_texRes.getGpuBuffer(e.getResUid())):r=this.m_texTargetTypes[this.m_activeAttachmentTotal],this.framebufferTextureBind(t,r,i,h)}framebufferTexture2D(t,e,s,i){switch(s){case a.TextureFormat.DEPTH_COMPONENT:t.framebufferTexture2D(this.m_fboTarget,this.m_gl.DEPTH_ATTACHMENT,t.TEXTURE_2D,i,0);break;case a.TextureFormat.DEPTH_STENCIL:t.framebufferTexture2D(this.m_fboTarget,this.m_gl.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,i,0);break;default:this.m_attachmentMaskList[this.m_activeAttachmentTotal]?(t.framebufferTexture2D(this.m_fboTarget,this.m_COLOR_ATTACHMENT0+this.m_attachmentIndex,t.TEXTURE_2D,i,0),++this.m_attachmentIndex,this.m_texTargetTypes[this.m_activeAttachmentTotal]=null!=i?e:0):this.m_texTargetTypes[this.m_activeAttachmentTotal]=0,++this.m_activeAttachmentTotal;break}}framebufferTextureBind(t,e,s,i){switch(e){case a.TextureTarget.TEXTURE_2D:this.framebufferTexture2D(t,e,s,i);break;case a.TextureTarget.TEXTURE_CUBE:for(let s=0;s<6;++s)this.m_attachmentMaskList[this.m_activeAttachmentTotal]?(t.framebufferTexture2D(this.m_fboTarget,this.m_COLOR_ATTACHMENT0+this.m_attachmentIndex,t.TEXTURE_CUBE_MAP_POSITIVE_X+s,i,0),++this.m_attachmentIndex,this.m_texTargetTypes[this.m_activeAttachmentTotal]=null!=i?e:0):this.m_texTargetTypes[this.m_activeAttachmentTotal]=0,++this.m_activeAttachmentTotal;break;case a.TextureTarget.TEXTURE_SHADOW_2D:this.m_attachmentMaskList[this.m_activeAttachmentTotal]?(t.framebufferTexture2D(this.m_gl.FRAMEBUFFER,this.m_gl.DEPTH_ATTACHMENT,this.m_gl.TEXTURE_2D,i,0),this.m_texTargetTypes[this.m_activeAttachmentTotal]=null!=i?e:0):this.m_texTargetTypes[this.m_activeAttachmentTotal]=0,++this.m_activeAttachmentTotal;break;default:break}}reset(){this.m_preAttachTotal=-1,this.m_preAttachIndex=-1}use(t){if(this.m_gl=t,null!=this.m_fbo){if(this.m_activeAttachmentTotal>1){if(this.m_preAttachIndex!=this.m_attachmentIndex){this.m_preAttachIndex=this.m_attachmentIndex;let t=[];for(let e=0;e<this.m_preAttachIndex;++e)t.push(this.m_COLOR_ATTACHMENT0+e);h.default.DrawBuffers(t)}}else this.m_preAttachIndex!=this.m_attachmentIndex&&(h.default.DrawBuffers([this.m_COLOR_ATTACHMENT0]),this.m_preAttachIndex=this.m_attachmentIndex);this.m_preAttachTotal=this.m_activeAttachmentTotal}}clearOnlyColor(t){if(null!=this.m_fbo)if(i.default.IsWebGL2())if(this.m_clearColorArr[0]=t.r,this.m_clearColorArr[1]=t.g,this.m_clearColorArr[2]=t.b,this.m_clearColorArr[3]=t.a,this.m_preAttachTotal>1)for(let e=0;e<this.m_preAttachTotal;++e)this.m_gl.clearBufferfv(this.m_gl.COLOR,e,this.m_clearColorArr);else this.m_gl.clearBufferfv(this.m_gl.COLOR,0,this.m_clearColorArr);else this.m_gl.clearColor(t.r,t.g,t.b,t.a)}clearOnlyDepth(t=1){i.default.IsWebGL2()?(this.m_clearDepthArr[0]=t,this.m_gl.clearBufferfv(this.m_gl.DEPTH,0,this.m_clearDepthArr)):this.m_gl.clearDepth(t)}clearOnlyStencil(t){this.m_stencilValueArr[0]=t,this.m_gl.clearBufferuiv(this.m_gl.STENCIL,0,this.m_stencilValueArr)}clearOnlyDepthAndStencil(t,e){this.m_gl.clearBufferfi(this.m_gl.DEPTH_STENCIL,0,t,e)}invalidateFramebuffer(){}resize(t,e){this.m_resizeW==t&&this.m_resizeH==e||(this.m_fboSizeChanged=!0,this.m_resizeW=t,this.m_resizeH=e)}initialize(t,e,s){this.m_gl=t,this.m_COLOR_ATTACHMENT0=h.default.COLOR_ATTACHMENT0,this.m_fboSizeChanged&&(e=this.m_resizeW,s=this.m_resizeH),null==this.m_fbo?this.createNewFBO(t,e,s):this.m_width==e&&this.m_height==s||(this.createNewFBO(t,e,s),console.log("FrameBufferObject ready rebuild another new fbo's Renderbuffers.fbo: "+this))}destroy(t){null!=this.m_fbo&&(null!=this.m_depthStencilRBO&&(t.deleteFramebuffer(this.m_depthStencilRBO),this.m_depthStencilRBO=null),null!=this.m_depthRBO&&(t.deleteFramebuffer(this.m_depthRBO),this.m_depthRBO=null),null!=this.m_colorRBO&&(t.deleteFramebuffer(this.m_colorRBO),this.m_colorRBO=null),t.deleteFramebuffer(this.m_fbo),this.m_fbo=null),this.m_gl=null,this.m_fboTarget=0,this.m_fboSizeChanged=!1}buildDepthStencilRBO(t,e,s){null==this.m_depthStencilRBO&&(this.m_depthStencilRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_STENCIL,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO))}buildDepthRBO(t,e,s){null==this.m_depthRBO&&(this.m_depthRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_COMPONENT24,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.m_depthRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthRBO),i.default.IsWebGL2()?t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT24,e,s):(console.log("Only use webgl1 depth fbo buffer."),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,s)),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.m_depthRBO))}buildStencilRBO(t,e,s){null==this.m_depthStencilRBO&&(null==this.m_depthStencilRBO&&(this.m_depthStencilRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.STENCIL_INDEX8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorage(t.RENDERBUFFER,t.STENCIL_INDEX8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO)))}buildColorRBO(t,e,s){this.multisampleEnabled&&(null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)),console.log("FrameBufferObject create only color buf...this.multisampleEnabled: "+this.multisampleEnabled+",this.multisampleLevel:"+this.multisampleLevel)}createNewFBO(t,e,s){let i=null==this.m_fbo;switch(this.m_preAttachTotal=this.m_activeAttachmentTotal=0,this.m_preAttachIndex=this.m_attachmentIndex=0,this.m_width=e,this.m_height=s,this.m_resizeW=e,this.m_resizeH=s,i&&(this.m_fbo=t.createFramebuffer()),this.m_bufferLType){case r.default.DRAW_FRAMEBUFFER:this.m_fboTarget=t.DRAW_FRAMEBUFFER;break;case r.default.READ_FRAMEBUFFER:this.m_fboTarget=t.READ_FRAMEBUFFER;break;default:this.m_fboTarget=t.FRAMEBUFFER;break}if(t.bindFramebuffer(this.m_fboTarget,this.m_fbo),this.writeDepthEnabled?this.writeStencilEnabled?null==this.m_depthStencilRBO&&this.buildDepthStencilRBO(t,e,s):this.buildDepthRBO(t,e,s):this.writeStencilEnabled?this.buildStencilRBO(t,e,s):this.buildColorRBO(t,e,s),i){let i=t.checkFramebufferStatus(this.m_fboTarget);i!==t.FRAMEBUFFER_COMPLETE?console.error("FrameBufferObject::createNewFBO(), Error: create failure!!!!"):console.log("FrameBufferObject::createNewFBO(), create success...,size: "+e+","+s)}}static BindToBackbuffer(t,e){switch(e){case r.default.DRAW_FRAMEBUFFER:t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null);break;case r.default.READ_FRAMEBUFFER:t.indFramebuffer(t.READ_FRAMEBUFFER,null);break;default:t.bindFramebuffer(t.FRAMEBUFFER,null);break}}}n.s_uid=0,e.default=n},"6e01":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static IsPowerOf2(t){return 0==(t&t-1)}static CalcNearestCeilPow2(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}static DegreeToRadian(t){return i.MATH_PI_OVER_180*t}static SafeACos(t){return t<=-1?i.MATH_PI:t>=1?0:Math.acos(t)}static GetNearestCeilPow2(t){let e=1;while(e<t)e<<=1;return e}static GetMinRadian(t,e){return e%=i.MATH_2PI,t%=i.MATH_2PI,e<t?(e=i.MATH_2PI-t+e,e>i.MATH_PI?e-i.MATH_2PI:e):e>t?(t=i.MATH_2PI-e+t,t>i.MATH_PI?i.MATH_2PI-t:-t):0}static GetMinDegree(t,e){let s=0;return e>=270&&t<90?s=(e-(t+360))%180:e<=90&&t>=270?s=(e+360-t)%180:(s=e-t,s>180?(s-=360,s%=360):s<-180&&(s+=360,s%=360)),s}static GetDegreeByXY(t,e){if(Math.abs(t)<1e-5)return e>=0?270:90;let s=180*Math.atan(e/t)/Math.PI;return e>0&&t>0?s:e<0&&t>=0?360+s:180+s}static GetRadianByXY(t,e){if(Math.abs(t)<i.MATH_MIN_POSITIVE)return e>=0?i.MATH_1PER2PI:i.MATH_3PER2PI;let s=Math.atan(e/t);return t>=0?s:i.MATH_PI+s}static GetRadianByCos(t,e,s){var r=Math.acos(t);return e>=0?r:i.MATH_PI+r}}i.MATH_MIN_POSITIVE=1e-5,i.MATH_MAX_NEGATIVE=-1e-5,i.MATH_MAX_POSITIVE=268435454,i.MATH_MIN_NEGATIVE=-268435454,i.MATH_1_OVER_255=1/255,i.MATH_PI=Math.PI,i.MATH_2PI=2*i.MATH_PI,i.MATH_3PER2PI=1.5*i.MATH_PI,i.MATH_1PER2PI=.5*i.MATH_PI,i.MATH_1_OVER_PI=1/i.MATH_PI,i.MATH_1_OVER_360=1/360,i.MATH_1_OVER_180=1/180,i.MATH_180_OVER_PI=180/i.MATH_PI,i.MATH_PI_OVER_180=i.MATH_PI/180,i.MATH_LN2=.6931471805599453,e.default=i},7045:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.phase=0,this.type=i.KEY_DOWN,this.target=null,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.repeat=!1,this.key="",this.keyCode=0,this.location=0}getClassType(){return i.EventClassType}toString(){return"[KeyboardEvent]"}}i.EventClassType=1003,i.KEY_DOWN=6001,i.KEY_UP=6002,e.default=i},"70f2":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("6e01"),r=s("8e17"),a=s("0236"),h=s("af68"),n=s("a80a"),l=s("a446"),_=s("c711"),o=s("955e"),m=s("765c");class u{constructor(t,e){this.m_uid=-1,this.m_adapter=null,this.m_renderProxy=null,this.m_rcontext=null,this.m_renderer=null,this.m_processids=new Uint8Array(128),this.m_processidsLen=0,this.m_rspace=null,this.m_mouse_rltv=new r.default,this.m_mouse_rlpv=new r.default,this.m_evtFlowEnabled=!1,this.m_evt3DCtr=null,this.m_mouseEvtEnabled=!0,this.m_camera=null,this.m_viewX=0,this.m_viewY=0,this.m_viewW=800,this.m_viewH=800,this.m_nodeWaitLinker=null,this.m_nodeWaitQueue=null,this.m_perspectiveEnabled=!0,this.m_rparam=null,this.m_stage3D=null,this.m_shader=null,this.m_runFlag=-1,this.m_autoRunning=!0,this.m_currStage3D=null,this.m_children=[],this.m_childrenTotal=0,this.m_mouseTestBoo=!0,this.m_cullingTestBoo=!0,this.m_rayTestBoo=!0,this.m_evtFlowEnabled=e,this.m_renderer=t,this.m_shader=t.getDataBuilder().getRenderShader(),this.m_uid=1024+u.__s_uid++}getUid(){return this.m_uid}getRPONodeBuilder(){return null}getRenderProxy(){return this.m_renderProxy}setViewPort(t,e,s,i){null!=this.m_renderProxy&&(this.m_viewX=t,this.m_viewY=e,this.m_viewW=s,this.m_viewH=i)}reseizeViewPort(){this.m_renderProxy.reseizeRCViewPort()}getRendererAdapter(){return this.m_adapter}getRenderer(){return this.m_renderer}getRendererContext(){return this.m_rcontext}getStage3D(){return this.m_renderProxy.getStage3D()}getCurrentStage3D(){return this.m_currStage3D}getCamera(){return this.m_camera}getMouseXYWorldRay(t,e){this.m_camera.getWorldPickingRayByScreenXY(this.m_stage3D.mouseX,this.m_stage3D.mouseY,t,e)}createCamera(){return this.m_renderProxy.createCamera()}setClearRGBColor3f(t,e,s){null!=this.m_renderProxy&&this.m_renderProxy.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){null!=this.m_renderProxy&&this.m_renderProxy.setClearRGBAColor4f(t,e,s,i)}setEvt3DController(t){null!=t&&(null==this.m_currStage3D&&(this.m_currStage3D=new a.default(this.m_renderProxy.getRCUid(),null)),t.initialize(this.getStage3D(),this.m_currStage3D),t.setRaySelector(this.m_rspace.getRaySelector())),this.m_evt3DCtr=t}isRayPickSelected(){return null!=this.m_evt3DCtr&&this.m_evt3DCtr.isSelected()}enableMouseEvent(t=!0){null==this.m_evt3DCtr&&(t?this.m_rspace.setRaySelector(new o.default):this.m_rspace.setRaySelector(new _.default),this.setEvt3DController(new m.default)),this.m_mouseEvtEnabled=!0}disableMouseEvent(){this.m_mouseEvtEnabled=!1}getEvt3DController(){return this.m_evt3DCtr}getSpace(){return this.m_rspace}getDevicePixelRatio(){return this.m_adapter.getDevicePixelRatio()}addEventListener(t,e,s,i=!0,r=!1){this.m_currStage3D.addEventListener(t,e,s,i,r)}removeEventListener(t,e,s){this.m_currStage3D.removeEventListener(t,e,s)}initialize(t,e=3,s=!0){if(null==this.m_renderProxy){e<1&&(e=1),e>8&&(e=8),this.m_rparam=t,this.m_perspectiveEnabled=t.cameraPerspectiveEnabled;let i=null;for(;e>=0;)i=this.m_renderer.appendProcess(t.batchEnabled,t.processFixedState),this.m_processids[this.m_processidsLen]=i.getRPIndex(),this.m_processidsLen++,--e;this.m_rcontext=this.m_renderer.getRendererContext(),this.m_renderProxy=this.m_rcontext.getRenderProxy(),this.m_adapter=this.m_renderProxy.getRenderAdapter(),this.m_stage3D=this.m_renderProxy.getStage3D(),this.m_viewX=this.m_stage3D.getViewX(),this.m_viewY=this.m_stage3D.getViewY(),this.m_viewW=this.m_stage3D.getViewWidth(),this.m_viewH=this.m_stage3D.getViewHeight(),s?this.createMainCamera():this.m_camera=this.m_renderProxy.getCamera(),null==this.m_rspace&&(this.m_rspace=new l.default,this.m_rspace.initialize(this.m_renderer,this.m_camera))}}createMainCamera(){this.m_camera=this.m_renderProxy.createCamera(),this.m_camera.setViewXY(this.m_viewX,this.m_viewY),this.m_camera.setViewSize(this.m_viewW,this.m_viewH,this.m_adapter.getDevicePixelRatio());let t=this.m_rparam.camProjParam;this.m_perspectiveEnabled?this.m_camera.perspectiveRH(i.default.DegreeToRadian(t.x),this.m_viewW/this.m_viewH,t.y,t.z):this.m_camera.orthoRH(t.y,t.z,-.5*this.m_viewH,.5*this.m_viewH,-.5*this.m_viewW,.5*this.m_viewW,this.m_adapter.getDevicePixelRatio()),this.m_camera.lookAtRH(this.m_rparam.camPosition,this.m_rparam.camLookAtPos,this.m_rparam.camUpDirect),this.m_camera.update()}cameraLock(){this.m_camera.lock()}cameraUnlock(){this.m_camera.unlock()}updateRenderBufferSize(){this.m_adapter.updateRenderBufferSize()}setRendererProcessParam(t,e,s){this.m_renderer.setRendererProcessParam(this.m_processids[t],e,s)}appendARendererProcess(t=!0,e=!1){let s=this.m_renderer.appendProcess(t,e);this.m_processids[this.m_processidsLen]=s.getRPIndex(),this.m_processidsLen++}addContainer(t,e=0){if(e<0&&(e=0),null!=t&&t.__$wuid<0&&t.__$contId<0){let s=0;for(;s<this.m_childrenTotal;++s)if(this.m_children[s]==t)return;s>=this.m_childrenTotal&&(t.__$wuid=this.m_uid,t.wprocuid=this.m_processids[e],t.__$setRenderer(this),this.m_children.push(t),this.m_childrenTotal++)}}removeContainer(t){if(null!=t&&t.__$wuid==this.m_uid&&t.getRenderer()==this.m_renderer){let e=0;for(;e<this.m_childrenTotal;++e)if(this.m_children[e]==t){t.__$wuid=-1,t.wprocuid=-1,t.__$setRenderer(null),this.m_children.splice(e,1),--this.m_childrenTotal;break}}}setAutoRunningEnabled(t){this.m_autoRunning=t}moveEntityTo(t,e){this.m_renderer.moveEntityToProcessAt(t,this.m_processids[e])}addEntity(t,e=0,s=!0){if(t.__$testSpaceEnabled())if(t.isPolyhedral())if(t.hasMesh())this.m_renderer.addEntity(t,this.m_processids[e],s),null!=this.m_rspace&&this.m_rspace.addEntity(t);else{null==this.m_nodeWaitLinker&&(this.m_nodeWaitLinker=new n.default,this.m_nodeWaitQueue=new h.default);let s=this.m_nodeWaitQueue.addEntity(t);s.rstatus=e,this.m_nodeWaitLinker.addNode(s)}else this.m_renderer.addEntity(t,this.m_processids[e],s),null!=this.m_rspace&&this.m_rspace.addEntity(t)}removeEntity(t){let e=null;if(null!=this.m_nodeWaitLinker){let e=this.m_nodeWaitQueue.getNodeByEntity(t);null!=e&&(this.m_nodeWaitLinker.removeNode(e),this.m_nodeWaitQueue.removeEntity(t))}null==e&&(this.m_renderer.removeEntity(t),null!=this.m_rspace&&this.m_rspace.removeEntity(t))}updateMaterialUniformToCurrentShd(t){this.m_renderer.updateMaterialUniformToCurrentShd(t)}drawEntityByLockMaterial(t){this.m_renderer.drawEntityByLockMaterial(t)}showInfoAt(t){this.m_renderer.showInfoAt(t)}runBegin(t=!0,e=!1){t&&this.m_autoRunning&&(this.m_runFlag>=0&&this.runEnd(),this.m_runFlag=0),e&&this.m_rcontext.renderBegin(),this.m_shader.renderBegin(),this.m_renderProxy.getCamera()!=this.m_camera?(this.m_camera.setViewXY(this.m_viewX,this.m_viewY),this.m_camera.setViewSize(this.m_viewW,this.m_viewH,this.m_adapter.getDevicePixelRatio()),this.m_renderProxy.setRCViewPort(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH),this.m_renderProxy.reseizeRCViewPort(),this.m_camera.update(),this.m_rcontext.updateCameraDataFromCamera(this.m_camera)):(this.m_camera.update(),this.m_rcontext.updateCameraDataFromCamera(this.m_camera)),null!=this.m_rspace&&this.m_rspace.runBegin()}renderBegin(t=!1){this.m_renderProxy.getCamera()!=this.m_camera?(this.m_camera.setViewXY(this.m_viewX,this.m_viewY),this.m_camera.setViewSize(this.m_viewW,this.m_viewH,this.m_adapter.getDevicePixelRatio()),this.m_renderProxy.setRCViewPort(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH),this.m_renderProxy.reseizeRCViewPort(),this.m_camera.update(),this.m_rcontext.updateCameraDataFromCamera(this.m_camera)):this.m_camera.update(),this.m_shader.renderBegin(),t&&this.m_rcontext.renderBegin()}runMouseTest(t,e){let s=-1;if(null!=this.m_evt3DCtr&&this.m_mouseEvtEnabled){if(this.m_rayTestBoo&&this.m_evt3DCtr.getEvtType()>0){this.mouseRayTest();let t=this.m_rspace.getRaySelector();if(null!=t){let e=t.getSelectedNodesTotal();if(e>1){let s=0,i=t.getSelectedNodes(),r=null;for(;s<e;++s)r=i[s],r.entity.isPolyhedral()}}this.m_rayTestBoo=!1}s=this.m_evt3DCtr.run(t,e)}return this.m_mouseTestBoo=!1,s}update(t=!0,e=!0){if(t&&this.m_autoRunning&&(0!=this.m_runFlag&&this.runBegin(),this.m_runFlag=1),this.m_mouseTestBoo=!0,this.m_cullingTestBoo=!0,this.m_rayTestBoo=!0,null!=this.m_nodeWaitLinker){let t=this.m_nodeWaitLinker.getBegin();if(null!=t){let e,s,i;while(null!=t)t.entity.hasMesh()?(e=t,t=t.next,s=e.entity,i=e.rstatus,this.m_nodeWaitLinker.removeNode(e),this.m_nodeWaitQueue.removeEntity(e.entity),this.addEntity(s,i)):t=t.next}}let s=0;for(;s<this.m_childrenTotal;++s)this.m_children[s].update();null!=this.m_rspace&&this.m_rspace.update(),null!=this.m_rspace&&this.m_cullingTestBoo&&(null==this.m_evt3DCtr&&null==this.m_rspace.getRaySelector()||this.m_rspace.run()),this.m_mouseTestBoo&&!this.m_evtFlowEnabled&&(e?this.runMouseTest(1,0):null!=this.m_evt3DCtr&&this.m_evt3DCtr.mouseOutEventTarget())}cullingTest(){null!=this.m_rspace&&this.m_rspace.run(),this.m_cullingTestBoo=!1}mouseRayTest(){null!=this.m_rspace&&(this.getMouseXYWorldRay(this.m_mouse_rlpv,this.m_mouse_rltv),this.m_rspace.rayTest(this.m_mouse_rlpv,this.m_mouse_rltv))}run(t=!1){t&&this.m_autoRunning&&(1!=this.m_runFlag&&this.update(),this.m_runFlag=2);for(let e=0;e<this.m_processidsLen;++e)this.m_renderer.runAt(this.m_processids[e]);t&&this.runEnd()}runAt(t){this.m_renderer.runAt(this.m_processids[t])}runEnd(){null!=this.m_evt3DCtr&&this.m_evt3DCtr.runEnd(),null!=this.m_rspace&&this.m_rspace.runEnd(),this.m_autoRunning&&(this.m_runFlag=-1)}updateCamera(){null!=this.m_camera&&this.m_camera.update()}toString(){return"[RendererSubScene(uid = "+this.m_uid+")]"}}u.__s_uid=0,e.default=u},"710f":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){if(this.m_useidList=[],this.m_removeidList=[],null!=i.s_ins)throw Error("ROVtxBufUidStore is a singleton class!!");i.s_ins=this}static GetInstance(){return i.s_ins}__$getRemovedListLen(){return this.m_removeidList.length}__$getRemovedList(){return this.m_removeidList}__$attachAt(t){if(t<this.m_useidList.length)++this.m_useidList[t];else{let e=this.m_useidList.length;for(;e<=t;++e)this.m_useidList.push(0);++this.m_useidList[t]}}__$detachAt(t){--this.m_useidList[t],this.m_useidList[t]<1&&(this.m_useidList[t]=0,console.log("ROVtxBufUidStore::__$detachAt("+t+") tex useCount value is 0."),this.m_removeidList.push(t))}getAttachCountAt(t){return t<this.m_useidList.length?this.m_useidList[t]:0}getAttachAllCount(){let t=0,e=0,s=this.m_useidList.length;for(;e<s;++e)this.m_useidList[e]>0&&(t+=this.m_useidList[e]);return t}}i.s_ins=null,e.default=i},7181:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,s,i,r,a){1==this.status||a?t.texImage2D(e,this.miplevel,s,i,r,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,i,r,this.data),this.status=-1}static Create(){return i.s_list.length>0?i.s_list.pop():new i}static Restore(t){null!=t&&(t.data=null,i.s_list.push(t))}}i.s_list=[],e.default=i},"722e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.NEAREST=4001,i.LINEAR=4002,i.LINEAR_MIPMAP_LINEAR=4003,i.NEAREST_MIPMAP_NEAREST=4004,i.LINEAR_MIPMAP_NEAREST=4005,i.NEAREST_MIPMAP_LINEAR=4006,e.default=i},"725b":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98"),r=s("fe7f");class a{constructor(){this.width=4,this.height=4,this.x=0,this.y=0,this.uvs=new Float32Array(8)}toString(){return"FontTexCharGrid(x="+this.x+",y="+this.y+",width="+this.width+",height="+this.height+")"}}class h{constructor(){this.m_texWidth=512,this.m_texHeight=256,this.m_gridMp=new Map,this.layoutDataStr="",this.m_minX=0,this.m_minY=0,this.m_maxX=0,this.m_maxY=0}initialize(t,e){this.m_texWidth=t,this.m_texHeight=e}addCharsByRawData(t,e){let s=0,i=0,r=e.split(","),a=r.length/4;for(;s<a;++s)i=4*s,this.addUV8RawDataFromChar(t.charAt(s),parseInt(r[i]),parseInt(r[i+1]),parseInt(r[i+2]),parseInt(r[i+3]))}addUV8RawDataFromChar(t,e,s,i,r){if(null==this.m_gridMp.get(t)){let h=new a,n=h.uvs,l=this.m_texWidth,_=this.m_texHeight;this.m_minX=e/l,this.m_minY=s/_,this.m_maxX=(e+i)/l,this.m_maxY=(s+r)/_,n[0]=this.m_minX,n[1]=this.m_maxY,n[2]=this.m_maxX,n[3]=this.m_maxY,n[4]=this.m_maxX,n[5]=this.m_minY,n[6]=this.m_minX,n[7]=this.m_minY,h.x=e,h.y=s,h.width=i,h.height=r,this.m_gridMp.set(t,h)}}getGridByChar(t){return this.m_gridMp.get(t)}getUV8FromChar(t,e,s=0){let i=this.m_gridMp.get(t);null==i&&(i=this.m_gridMp.get("?")),e.set(i.uvs,s)}getVtxFromChar(t,e,s=0){let i=this.m_gridMp.get(t);null==i&&(i=this.m_gridMp.get("?"));let r=[0,0,0,i.width,0,0,i.width,i.height,0,0,i.height,0];e.set(r,s)}getUV8AndVtxFromChar(t,e,s,i=0,r=0){let a=this.m_gridMp.get(t);null==a&&(a=this.m_gridMp.get("?")),e.set(a.uvs,i);let h=[0,0,0,a.width,0,0,a.width,a.height,0,0,a.height,0];s.set(h,r)}getUV8AndSizeFromChar(t,e,s,i=0){let r=this.m_gridMp.get(t);null==r&&(r=this.m_gridMp.get("?")),e.set(r.uvs,i),s[0]=r.width,s[1]=r.height}getUV8AndOffsetXYVtxFromChar(t,e,s,i=0,r=0,a=0,h=0){let n=this.m_gridMp.get(t);null==n&&(n=this.m_gridMp.get("?")),e.set(n.uvs,a);let l=[i,r,0,i+n.width,r,0,i+n.width,r+n.height,0,i,r+n.height,0];s.set(l,h)}}e.FontTexCharTable=h;class n{constructor(){this.m_currPosX=0,this.m_currPosY=0,this.m_texText="",this.m_fontCharTable=null,this.pixMinPos={x:0,y:0},this.pixMaxPos={x:0,y:0},this.canvas=null,this.ctx2d=null,this.m_py=0,this.charTexWidth=0,this.px=0,this.py=0,this.ph=0,this.linedis=2,this.charHDis=1,this.tx=0,this.char="",this.meao=null}setFontCharTable(t){this.m_fontCharTable=t}textFilte(t){let e=t.length,s="",i="";for(let r=0;r<e;++r)i=t.charAt(r),this.m_texText.indexOf(i)<0&&s.indexOf(i)<0&&(s+=i);return s}crateTextUVData(t,e,s,i=18){this.m_texText+=t;let r=this.ctx2d;this.m_currPosY<2&&(this.m_currPosY=i),this.charTexWidth=0,r.textAlign="left",r.fillStyle="white",r.font=i+"px Arial";let a=t.length;this.pixMinPos.x=2e4,this.pixMinPos.y=2e4,this.pixMaxPos.x=-2e4,this.pixMaxPos.y=-2e4,this.ph=i+8;for(let h=0;h<a;h++)this.char=t.charAt(h),this.meao=r.measureText(this.char),this.charTexWidth=Math.floor(this.meao.width)+1,this.tx=this.m_currPosX+this.charTexWidth,this.tx<e?(r.fillText(this.char,this.m_currPosX,this.m_currPosY),this.m_py=this.m_currPosY-i,this.pixMinPos.x>this.m_currPosX&&(this.pixMinPos.x=this.m_currPosX),this.pixMinPos.y>this.m_py&&(this.pixMinPos.y=this.m_py),this.px=this.m_currPosX+this.charTexWidth,this.py=this.m_py+this.ph,this.pixMaxPos.x<this.px&&(this.pixMaxPos.x=this.px),this.pixMaxPos.y<this.py&&(this.pixMaxPos.y=this.py),this.m_fontCharTable.addUV8RawDataFromChar(this.char,this.m_currPosX,this.m_py+1,this.charTexWidth,this.ph),this.m_currPosX=this.tx+this.charHDis):(this.m_currPosX=0,this.m_currPosY+=this.ph+this.linedis,r.fillText(this.char,this.m_currPosX,this.m_currPosY),this.m_py=this.m_currPosY-i,this.pixMinPos.x>this.m_currPosX&&(this.pixMinPos.x=this.m_currPosX),this.pixMinPos.y>this.m_py&&(this.pixMinPos.y=this.m_py),this.px=this.m_currPosX+this.charTexWidth,this.py=this.m_py+this.ph,this.pixMaxPos.x<this.px&&(this.pixMaxPos.x=this.px),this.pixMaxPos.y<this.py&&(this.pixMaxPos.y=this.py),this.m_fontCharTable.addUV8RawDataFromChar(this.char,this.m_currPosX,this.m_py+1,this.charTexWidth,this.ph),this.m_currPosX+=this.charTexWidth)}}e.FontTexDataBuilder=n;class l{constructor(){this.m_texWidth=512,this.m_texHeight=256,this.m_canvas=null,this.m_ctx2D=null,this.m_texBase=null,this.m_fontSize=18,this.m_fontCharTable=new h,this.m_fontTexDataBuilder=new n,this.m_renderProxy=null,this.m_preSW=0,this.m_preSH=0,this.m_areaBytes=null}setRenderProxy(t){null!=t&&(this.m_renderProxy=t,null!=this.m_texBase&&this.m_texBase.__$setRenderProxy(t))}isEnabled(){return null!=this.m_canvas}initialize(t,e=10,s=512,a=512,h=!1,n=!1){if(null==this.m_canvas){s<32&&(s=32),a<32&&(a=32),this.m_texWidth=s,this.m_texHeight=a,e<10&&(e=10),this.m_fontSize=e;var l=null;try{void 0!=document&&(l=document)}catch(_){console.log("H5FontSystem::initialize(), document is undefined.")}this.m_canvas=l.getElementById(t),null==this.m_canvas&&(this.m_canvas=document.createElement("canvas"),document.body.appendChild(this.m_canvas),this.m_canvas.style.width="128px",this.m_canvas.style.height="128px",this.m_canvas.style.display="bolck",this.m_canvas.style.overflow="hidden",this.m_canvas.style.left="0px",this.m_canvas.style.top="0px",this.m_canvas.style.position="absolute",this.m_canvas.style.backgroundColor="transparent",this.m_canvas.style.pointerEvents="none"),this.m_canvas.width=s,this.m_canvas.height=a,this.m_canvas.style.visibility=h?"visible":"hidden",this.m_ctx2D=this.m_canvas.getContext("2d"),this.m_fontTexDataBuilder.canvas=this.m_canvas,this.m_fontTexDataBuilder.ctx2d=this.m_ctx2D,this.m_fontTexDataBuilder.setFontCharTable(this.m_fontCharTable),this.m_fontCharTable.initialize(this.m_texWidth,this.m_texHeight),this.m_texBase=new r.default(this.m_texWidth,this.m_texHeight),this.m_texBase.__$setRenderProxy(this.m_renderProxy),this.m_texBase.toAlphaFormat(),this.m_texBase.mipmapEnabled=n,this.m_texBase.minFilter=i.TextureConst.LINEAR,this.m_texBase.magFilter=i.TextureConst.NEAREST,this.createInitTexAndChars()}}setStyleSize(t,e){null!=this.m_canvas&&(this.m_preSW==t&&this.m_preSH==e||(this.m_preSW=t,this.m_preSH=e,this.m_canvas.style.width=t+"px",this.m_canvas.style.height=e+"px"))}setCanvasVisible(t){this.m_canvas.style.visibility=t?"visible":"hidden"}getUV8FromChar(t,e,s=0){this.m_fontCharTable.getUV8FromChar(t,e,s)}getCharTable(){return this.m_fontCharTable}createCharsTexFromStr(t){if(t=this.m_fontTexDataBuilder.textFilte(t),t.length<1)return;let e=t;this.m_fontTexDataBuilder.crateTextUVData(e,this.m_texWidth,this.m_texHeight,this.m_fontSize);let s=0,i=0,r=0,a=0,h=0,n=this.m_fontTexDataBuilder.pixMaxPos.x-this.m_fontTexDataBuilder.pixMinPos.x,l=this.m_fontTexDataBuilder.pixMaxPos.y-this.m_fontTexDataBuilder.pixMinPos.y,_=this.m_ctx2D.getImageData(this.m_fontTexDataBuilder.pixMinPos.x,this.m_fontTexDataBuilder.pixMinPos.y,n,l),o=_.data,m=new Uint8Array(n*l),u=this.m_fontTexDataBuilder.pixMinPos.x,d=this.m_fontTexDataBuilder.pixMinPos.y;for(i=0;i<l;++i)for(r=0;r<n;++r)h=(i+d)*this.m_texWidth+(u+r),s=4*(i*n+r),this.m_areaBytes[h]=o[s+3],m[a]=this.m_areaBytes[h],a++;this.m_texBase.setPartDataFromeBytes(m,this.m_fontTexDataBuilder.pixMinPos.x,this.m_fontTexDataBuilder.pixMinPos.y,n,l),this.m_texBase.updateDataToGpu()}createInitTexAndChars(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890~`!@#$%^&*()_+-={}[]:\";\\|'<>,.?/\n ",e="",s=t+e;this.m_fontTexDataBuilder.crateTextUVData(s,this.m_texWidth,this.m_texHeight,this.m_fontSize);let i=this.m_ctx2D.getImageData(0,0,this.m_texWidth,this.m_texHeight),r=i.data,a=0,h=0,n=0;this.m_areaBytes=new Uint8Array(this.m_texWidth*this.m_texHeight);let l=0;for(a=0;a<this.m_texHeight;++a)for(h=0;h<this.m_texWidth;++h)n=4*(a*this.m_texWidth+h),this.m_areaBytes[l]=r[n+3],l++;this.m_texBase.setDataFromBytes(this.m_areaBytes,0,this.m_texWidth,this.m_texHeight)}getTextureAt(t=0){return this.m_texBase}static GetInstance(){return null!=l.s_ins||(l.s_ins=new l),l.s_ins}}l.s_ins=null,e.default=l},7279:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("5326"),r=s("352a"),a=s("d53d");class h extends a.default{constructor(){super(),this.slotId=0,this.slotIndex=0,this.uniformsTotal=0,this.locationIndexList=null,this.locations=null,this.rst=0,this.always=!1}copyDataFromProbe(t){this.types=t.uniformTypes.slice(0),this.dataSizeList=t.dataSizeList.slice(0),this.slotIndex=t.getSlotBeginIndex(),this.uniformsTotal=t.uniformsTotal,this.slotId=t.getSlotUid()}copyDataFromProbeAt(t,e){null==this.types&&(this.types=[],this.dataSizeList=[]),this.slotIndex=e.getSlotBeginIndex(),this.uniformsTotal=e.uniformsTotal,this.slotId=e.getSlotUid(),this.types[t]=e.uniformTypes[t],this.dataSizeList[t]=e.dataSizeList[t]}use(t){let e=i.default.GetSlotAt(t.getRCUid());if(this.always||this.rst!=e.flagList[this.slotIndex]){this.rst=e.flagList[this.slotIndex];let s=0;if(r.default.IsWebGL1())for(;s<this.uniformsTotal;++s)t.useUniformV1(this.locations[s],this.types[s],e.dataList[this.slotIndex+s],this.dataSizeList[s]);else for(;s<this.uniformsTotal;++s)t.useUniformV2(this.locations[s],this.types[s],e.dataList[this.slotIndex+s],this.dataSizeList[s],0)}}destroy(){this.types=null,this.dataSizeList=null,this.slotIndex=-1,this.uniformsTotal=0}}e.default=h},7499:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_dispBuilder=null,this.m_shader=null,this.m_texRes=null}setDispBuilder(t){null==this.m_dispBuilder&&(this.m_dispBuilder=t,this.m_shader=t.getRenderShader(),this.m_texRes=t.getTextureResource())}unlockMaterial(){this.m_shader.unlock(),this.m_texRes.unlocked=!0}lockMaterial(){this.m_shader.lock(),this.m_texRes.unlocked=!1}renderBegin(){this.m_shader.renderBegin(),this.m_texRes.renderBegin()}useGlobalMaterial(t){this.m_dispBuilder.updateGlobalMaterial(t)}}e.default=i},"74c3":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8def"),r=s("fa60");class a{constructor(){this.m_vtx=null,this.m_vtxUid=-1,this.m_gpuBufs=[],this.m_gpuBufsTotal=0,this.m_type=0,this.m_attribsTotal=0,this.m_wholeStride=0,this.m_typeList=null,this.m_offsetList=null,this.m_sizeList=null,this.m_vroList=[],this.m_vroListLen=0}updateToGpu(t){let e=this.m_gpuBufs.length;if(e>0){let s=this.m_vtx;if(this.version!=s.vertexVer){let i,r=s.getBufDataUsage(),a=this.m_sizeList;for(let h=0;h<e;++h)i=s.getF32DataAt(h),a[h]>=i.length?(t.bindArrBuf(this.m_gpuBufs[h]),t.arrBufSubData(i,0)):(t.bindArrBuf(this.m_gpuBufs[h]),t.arrBufData(i,r),a[h]=i.length);this.version=s.vertexVer}}}uploadCombined(t,e){let s=this.m_vtx,i=s.getF32DataAt(0);if(this.m_gpuBufs.push(t.createBuf()),t.bindArrBuf(this.m_gpuBufs[0]),t.arrBufData(i,s.getBufDataUsage()),this.m_gpuBufsTotal=1,this.m_sizeList=[i.length],null==this.m_typeList){this.m_wholeStride=0,this.m_typeList=new Array(this.m_attribsTotal),this.m_offsetList=new Array(this.m_attribsTotal);for(let t=0;t<this.m_attribsTotal;++t)this.m_offsetList[t]=this.m_wholeStride,this.m_wholeStride+=4*e.getLocationSizeByIndex(t),this.m_typeList[t]=e.getLocationTypeByIndex(t)}}uploadSeparated(t,e){let s=this.m_vtx,i=0,r=null,a=s.getBufDataUsage();if(this.m_gpuBufsTotal=this.m_vtx.getBuffersTotal(),this.m_sizeList=new Array(this.m_attribsTotal),null==s.bufData)for(;i<this.m_attribsTotal;++i)r=t.createBuf(),this.m_gpuBufs.push(r),t.bindArrBuf(r),t.arrBufData(s.getF32DataAt(i),a),this.m_sizeList[i]=s.getF32DataAt(i).length;else{let e=null,h=0,n=0,l=0,_=0;for(;i<this.m_attribsTotal;++i){for(r=t.createBuf(),this.m_gpuBufs.push(r),t.bindArrBuf(r),t.arrBufDataMem(s.bufData.getAttributeDataTotalBytesAt(i),a),l=0,_=0,n=s.bufData.getAttributeDataTotalAt(i),h=0;h<n;++h)e=s.bufData.getAttributeDataAt(i,h),_+=e.length,t.arrBufSubData(e,l),l+=e.byteLength;this.m_sizeList[i]=_}}if(null==this.m_typeList){this.m_wholeStride=0,this.m_typeList=new Array(this.m_attribsTotal),this.m_offsetList=new Array(this.m_attribsTotal),this.m_offsetList.fill(0);for(let t=0;t<this.m_attribsTotal;++t)this.m_typeList[t]=e.getLocationTypeByIndex(t)}}initialize(t,e,s){this.m_gpuBufs.length<1&&null!=s&&(this.version=s.vertexVer,this.m_vtx=s,this.m_vtxUid=s.getUid(),this.m_type=s.getType(),this.m_attribsTotal=e.getLocationsTotal(),this.m_type<1?this.uploadCombined(t,e):this.uploadSeparated(t,e))}getVROMid(t,e,s){let i=(131+t.getRCUid())*this.m_vtxUid;return i=s?131*i+e.getLayoutBit()+983040:131*i+e.getLayoutBit(),i}createVRO(t,e,s){if(this.m_attribsTotal>0){let a=this.getVROMid(t,e,s),h=0,n=r.default.GetByMid(a);if(null!=n)return n;let l=this.m_attribsTotal;if(s){let s=r.default.Create(t,a,this.m_vtx.getUid());if(s.vao=t.createVertexArray(),t.bindVertexArray(s.vao),this.m_type<1)for(t.bindArrBuf(this.m_gpuBufs[0]),h=0;h<l;++h)e.vertexAttribPointerTypeFloat(this.m_typeList[h],this.m_wholeStride,this.m_offsetList[h]);else for(h=0;h<l;++h)t.bindArrBuf(this.m_gpuBufs[h]),e.vertexAttribPointerTypeFloat(this.m_typeList[h],0,0);n=s,t.bindVertexArray(null)}else{let s=i.default.Create(t,a,this.m_vtx.getUid());for(s.shdp=e,s.attribTypes=[],s.wholeOffsetList=[],s.wholeStride=this.m_wholeStride,this.m_type<1?s.vbuf=this.m_gpuBufs[0]:s.vbufs=this.m_gpuBufs,h=0;h<l;++h)e.testVertexAttribPointerType(this.m_typeList[h])&&(s.attribTypes.push(this.m_typeList[h]),s.wholeOffsetList.push(this.m_offsetList[h]));s.attribTypesLen=s.attribTypes.length,n=s}return this.m_vroList.push(n),++this.m_vroListLen,n}return null}destroy(t){if(this.m_gpuBufs.length>0){console.log("ROVertexRes::destroy(), type: "+this.m_type),this.m_type=-1;let e=0,s=null;for(;e<this.m_vroListLen;++e)s=this.m_vroList.pop(),s.restoreThis(),this.m_vroList[e]=null;for(this.m_vroListLen=0,e=0;e<this.m_attribsTotal;++e)t.deleteBuf(this.m_gpuBufs[e]),this.m_gpuBufs[e]=null;this.m_attribsTotal=0,this.m_gpuBufs=[]}}}class h{constructor(){this.m_vtx=null,this.m_vtxUid=0,this.m_gpuBuf=null,this.m_ivsSize=0,this.ibufStep=0}getVtxUid(){return this.m_vtxUid}getGpuBuf(){return this.m_gpuBuf}updateToGpu(t){if(null!=this.m_gpuBuf&&this.m_ivsSize>0){let e=this.m_vtx;this.version!=e.indicesVer&&(this.m_ivs=e.getIvsData(),t.bindEleBuf(this.m_gpuBuf),this.m_ivsSize>=this.m_ivs.length?t.eleBufSubData(this.m_ivs,e.getBufDataUsage()):t.eleBufData(this.m_ivs,e.getBufDataUsage()),this.m_ivsSize=this.m_ivs.length,this.version=e.indicesVer)}}initialize(t,e){if(null==this.m_gpuBuf&&null!=e.getIvsData())if(this.version=e.indicesVer,this.m_vtx=e,this.m_vtxUid=e.getUid(),this.m_ivs=e.getIvsData(),this.m_gpuBuf=t.createBuf(),t.bindEleBuf(this.m_gpuBuf),null==e.bufData)t.eleBufData(this.m_ivs,e.getBufDataUsage()),this.m_ivsSize=this.m_ivs.length;else{t.eleBufDataMem(e.bufData.getIndexDataTotalBytes(),e.getBufDataUsage());let s=null,i=0;this.m_ivsSize=0;for(let r=0,a=e.bufData.getIndexDataTotal();r<a;++r)s=e.bufData.getIndexDataAt(r),t.eleBufSubData(s,i),i+=s.byteLength,this.m_ivsSize+=s.length}}destroy(t){null!=this.m_gpuBuf&&(this.m_vtx=null,t.deleteBuf(this.m_gpuBuf),this.m_gpuBuf=null,this.m_ivs=null,this.m_ivsSize=0)}}class n{constructor(){this.version=-1,this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.vertex=new a,this.indices=new h,this.m_attachCount=0}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0,console.log("GpuVtxObect::__$detachThis() this.m_attachCount value is 0."))}getAttachCount(){return this.m_attachCount}createVRO(t,e,s){let i=this.vertex.createVRO(t,e,s);return i.ibuf=this.indices.getGpuBuf(),i.ibufStep=this.indices.ibufStep,i}updateToGpu(t){this.indices.updateToGpu(t),this.vertex.updateToGpu(t)}destroy(t){this.getAttachCount()<1&&this.resUid>=0&&(this.vertex.destroy(t),this.indices.destroy(t),this.resUid=-1)}}e.GpuVtxObect=n;class l{constructor(t,e,s){this.m_resMap=new Map,this.m_freeMap=new Map,this.m_updateIds=[],this.m_vtxResTotal=0,this.m_attachTotal=0,this.m_delay=128,this.m_haveDeferredUpdate=!1,this.m_rcuid=0,this.m_gl=null,this.m_vtxBuilder=null,this.unlocked=!0,this.m_rcuid=t,this.m_gl=e,this.m_vtxBuilder=s}createResByParams3(t,e,s,i){return!1}getRCUid(){return this.m_rcuid}getRC(){return this.m_gl}hasResUid(t){return this.m_resMap.has(t)}bindToGpu(t){}getGpuBuffer(t){return null}renderBegin(){this.m_vtxBuilder.renderBegin()}getVertexResTotal(){return this.m_vtxResTotal}updateDataToGpu(t,e){e?(this.m_updateIds.push(t),this.m_haveDeferredUpdate=!0):this.m_resMap.has(t)&&this.m_resMap.get(t).updateToGpu(this.m_vtxBuilder)}addVertexRes(t){this.m_resMap.has(t.resUid)||(t.waitDelTimes=0,this.m_resMap.set(t.resUid,t),this.m_vtxResTotal++)}getVertexRes(t){return this.m_resMap.get(t)}destroyRes(t){this.m_resMap.has(t)&&this.m_resMap.get(t).destroy(this.m_vtxBuilder)}__$attachRes(t){if(this.m_resMap.has(t)){this.m_attachTotal++;let e=this.m_resMap.get(t);e.getAttachCount()<1&&this.m_freeMap.has(t)&&this.m_freeMap.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.m_resMap.has(t)&&this.m_resMap.has(t)){let e=this.m_resMap.get(t);e.getAttachCount()>0&&(this.m_attachTotal--,e.__$detachThis(),e.getAttachCount()<1&&this.m_freeMap.set(t,e))}}getVROByResUid(t,e,s){let i=this.m_resMap.get(t);return null!=i?i.createVRO(this.m_vtxBuilder,e,s):null}update(){if(this.m_haveDeferredUpdate){this.m_haveDeferredUpdate=!1;let t,e=this.m_updateIds.length;e=e>16?16:e;for(let s=0;s<e;++s)t=this.m_updateIds.shift(),this.m_resMap.has(t)&&this.m_resMap.get(t).updateToGpu(this.m_vtxBuilder)}if(this.m_delay--,this.m_delay<1){this.m_delay=128;for(const[t,e]of this.m_freeMap)e.waitDelTimes++,e.getAttachCount()<1?e.waitDelTimes>5&&(console.log("ROVertexResource remove a vertex buffer(resUid="+e.resUid+")"),this.m_resMap.delete(e.resUid),this.m_freeMap.delete(e.resUid),e.destroy(this.m_vtxBuilder),this.m_vtxResTotal--):(console.log("ROVertexResource repeat use a vertex buffer(resUid="+e.resUid+") from freeMap."),this.m_freeMap.delete(e.resUid))}}}e.ROVertexResource=l,e.default=l},"765c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("1710");class r{constructor(){this.m_mainStage=null,this.m_currStage=null,this.m_raySelector=null,this.m_unlockBoo=!0,this.m_uid=0,this.m_mouseEvt=new i.default,this.m_mouseOverEvt=new i.default,this.m_mouseOutEvt=new i.default,this.m_evtTarget=null,this.m_evtTypes=new Float32Array(64),this.m_evtXList=new Float32Array(64),this.m_evtYList=new Float32Array(64),this.m_evtWheelDeltaYs=new Float32Array(64),this.m_evtTotal=0,this.m_evtFlowPhase=-1,this.m_uid=r.s_uid++}initialize(t,e){null==this.m_mainStage&&(this.m_mainStage=t,this.m_currStage=e,t.addEventListener(i.default.MOUSE_DOWN,this,this.mouseDownListener,!0,!1),t.addEventListener(i.default.MOUSE_UP,this,this.mouseUpListener,!0,!1),t.addEventListener(i.default.MOUSE_MOVE,this,this.mouseMoveListener,!0,!1),t.addEventListener(i.default.MOUSE_WHEEL,this,this.mouseWheeelListener,!0,!1))}setRaySelector(t){this.m_raySelector=t}mouseWheeelListener(t){this.m_evtTypes[this.m_evtTotal]=t.type,this.m_evtXList[this.m_evtTotal]=t.mouseX,this.m_evtYList[this.m_evtTotal]=t.mouseY,this.m_evtWheelDeltaYs[this.m_evtTotal]=t.wheelDeltaY,this.m_mouseEvt.type=t.type,this.m_evtTotal++}mouseMoveListener(t){this.m_evtTypes[this.m_evtTotal]=t.type,this.m_evtXList[this.m_evtTotal]=t.mouseX,this.m_evtYList[this.m_evtTotal]=t.mouseY,this.m_evtWheelDeltaYs[this.m_evtTotal]=0,this.m_mouseEvt.type=t.type,this.m_evtTotal++}mouseDownListener(t){r.s_unlockMouseEvt&&(this.m_evtTypes[this.m_evtTotal]=t.type,this.m_evtXList[this.m_evtTotal]=t.mouseX,this.m_evtYList[this.m_evtTotal]=t.mouseY,this.m_evtWheelDeltaYs[this.m_evtTotal]=0,this.m_mouseEvt.type=t.type,this.m_evtTotal++)}mouseUpListener(t){r.s_unlockMouseEvt&&(this.m_evtTypes[this.m_evtTotal]=t.type,this.m_evtXList[this.m_evtTotal]=t.mouseX,this.m_evtYList[this.m_evtTotal]=t.mouseY,this.m_evtWheelDeltaYs[this.m_evtTotal]=0,this.m_mouseEvt.type=t.type,this.m_evtTotal++)}mouseOutEventTarget(){if(null!=this.m_evtTarget){let t=this.m_evtTarget.getEvtDispatcher(i.default.EventClassType);if(null!=t)return this.m_mouseOutEvt.phase=this.m_evtFlowPhase,this.m_mouseOutEvt.type=i.default.MOUSE_OUT,this.m_mouseOutEvt.mouseX=this.m_mouseEvt.mouseX,this.m_mouseOutEvt.mouseY=this.m_mouseEvt.mouseY,this.m_mouseOutEvt.target=this.m_evtTarget,this.m_raySelector.getRay(this.m_mouseOutEvt.raypv,this.m_mouseOutEvt.raytv),this.m_evtTarget=null,t.dispatchEvt(this.m_mouseOutEvt);this.m_evtTarget=null}return 0}run(t,e){let s=-1;if(this.m_unlockBoo){this.m_evtFlowPhase=t;let a=0;s=this.m_evtTotal>0?0:-1;let h,n,l,_=null;if(s>-1){if(this.m_currStage!=this.m_mainStage&&null!=this.m_currStage){for(r.s_unlockMouseEvt=!1,a=0;a<this.m_evtTotal;a++)switch(this.m_evtTypes[a]){case i.default.MOUSE_DOWN:this.m_currStage.mouseDown(1);break;case i.default.MOUSE_UP:this.m_currStage.mouseUp(1);break;default:break}r.s_unlockMouseEvt=!0}if(h=e<1?this.m_raySelector.getSelectedNode():null,null!=h){n=h.lpv,l=h.wpv;let e=h.entity;_=e.getEvtDispatcher(i.default.EventClassType);for(let r=0;r<this.m_evtTotal;r++)this.m_mouseEvt.type=this.m_evtTypes[r],this.m_mouseEvt.mouseX=this.m_evtXList[r],this.m_mouseEvt.mouseY=this.m_evtYList[r],this.m_mouseEvt.wheelDeltaY=this.m_evtWheelDeltaYs[r],this.m_mouseEvt.type>0&&null!=h&&null!=_&&(this.m_mouseEvt.target=e,this.m_mouseEvt.phase=t,this.m_mouseEvt.lpos.copyFrom(n),this.m_mouseEvt.wpos.copyFrom(l),this.m_raySelector.getRay(this.m_mouseEvt.raypv,this.m_mouseEvt.raytv),this.m_evtTarget!=e&&(this.m_mouseOverEvt.phase=t,this.m_mouseOverEvt.type=i.default.MOUSE_OVER,this.m_mouseOverEvt.mouseX=this.m_mouseEvt.mouseX,this.m_mouseOverEvt.mouseY=this.m_mouseEvt.mouseY,this.m_mouseOverEvt.target=e,this.m_mouseOverEvt.lpos.copyFrom(n),this.m_mouseOverEvt.wpos.copyFrom(l),this.m_raySelector.getRay(this.m_mouseOverEvt.raypv,this.m_mouseOverEvt.raytv),s+=_.dispatchEvt(this.m_mouseOverEvt)),s+=_.dispatchEvt(this.m_mouseEvt),null!=this.m_evtTarget&&this.m_evtTarget!=e&&(_=this.m_evtTarget.getEvtDispatcher(i.default.EventClassType),null!=_&&(this.m_mouseOutEvt.phase=t,this.m_mouseOutEvt.type=i.default.MOUSE_OUT,this.m_mouseOutEvt.mouseX=this.m_mouseEvt.mouseX,this.m_mouseOutEvt.mouseY=this.m_mouseEvt.mouseY,this.m_mouseOutEvt.target=this.m_evtTarget,this.m_mouseOutEvt.lpos.copyFrom(n),this.m_mouseOutEvt.wpos.copyFrom(l),this.m_raySelector.getRay(this.m_mouseOutEvt.raypv,this.m_mouseOutEvt.raytv),s+=_.dispatchEvt(this.m_mouseOutEvt))),this.m_evtTarget=e)}else if(s+=this.mouseOutEventTarget(),null!=this.m_currStage)for(a=0;a<this.m_evtTotal;a++)switch(this.m_evtTypes[a]){case i.default.MOUSE_DOWN:this.m_currStage.mouseBgDown();break;case i.default.MOUSE_UP:this.m_currStage.mouseBgUp();break;default:break}if(null!=this.m_currStage){for(r.s_unlockMouseEvt=!1,a=0;a<this.m_evtTotal;a++)switch(this.m_evtTypes[a]){case i.default.MOUSE_DOWN:this.m_currStage.mouseDown(2);break;case i.default.MOUSE_UP:this.m_currStage.mouseUp(2);break;default:break}r.s_unlockMouseEvt=!0}}0==s&&null!=_&&(s=_.passTestPhase(t))}return s>0?1:0}runEnd(){this.m_evtTotal=0,this.m_mouseEvt.type=0}reset(){this.m_evtTotal=0}getEvtType(){return this.m_mouseEvt.type}isSelected(){return null!=this.m_raySelector.getSelectedNode()}lock(){this.m_unlockBoo=!1}unlock(){this.m_unlockBoo=!0}isUnlock(){return this.m_unlockBoo}}r.s_uid=0,r.s_unlockMouseEvt=!0,e.default=r},7696:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("264c"),r=s("5f3c");class a{constructor(t,e,s,i,r,h){this.m_rcuid=-1,this.m_rpIndex=-1,this.m_nodesLen=0,this.m_enabled=!0,this.m_blockList=[],this.m_blockListLen=0,this.m_blockFList=new Int8Array(a.s_max_shdTotal),this.m_blockFListLen=a.s_max_shdTotal,this.m_shader=null,this.m_rpoNodeBuilder=null,this.m_rpoUnitBuilder=null,this.m_vtxResource=null,this.m_fixBlock=null,this.m_sortBlock=null,this.m_sorter=null,this.m_batchEnabled=!0,this.m_fixedState=!0,this.m_sortEnabled=!1,this.uid=-1,this.m_shader=t,this.m_rpoNodeBuilder=e,this.m_rpoUnitBuilder=s,this.m_vtxResource=i,this.m_fixBlock=this.createBlock(),this.m_batchEnabled=r,this.m_fixedState=h;for(let a=0;a<this.m_blockFListLen;++a)this.m_blockFList[a]=-1}createBlock(){let t=new r.default(this.m_shader);return t.rpoNodeBuilder=this.m_rpoNodeBuilder,t.rpoUnitBuilder=this.m_rpoUnitBuilder,t.vtxResource=this.m_vtxResource,t}setRenderParam(t,e){this.m_blockListLen<1&&(this.m_batchEnabled=t,this.m_fixedState=e)}setRendererParam(t,e){this.m_rc=t,this.m_rcuid=t.getRCUid(),this.m_rpIndex=e}getUid(){return this.uid}getRCUid(){return this.m_rcuid}getRPIndex(){return this.m_rpIndex}hasSorter(){return null!=this.m_sorter}setSorter(t){this.m_sorter=t,null!=this.m_sortBlock&&this.m_sortBlock.setSorter(t)}setSortEnabled(t){this.m_nodesLen<1?this.m_sortEnabled=t:null!=this.m_sortBlock&&(this.m_sortBlock.sortEnabled=t)}getSortEnabled(){return this.m_sortEnabled}getUnitsTotal(){return this.m_nodesLen}addNodeToBlock(t){let e=null;if(t.shdUid>=a.s_max_shdTotal)throw Error("Shader uid >= "+a.s_max_shdTotal);this.m_blockFList[t.shdUid]<0?(e=this.createBlock(),e.batchEnabled=this.m_batchEnabled,e.fixedState=this.m_fixedState,e.batchEnabled?e.fixedState?e.runMode=2:e.runMode=1:e.runMode=0,e.shdUid=t.shdUid,e.index=this.m_blockListLen,e.procuid=this.m_rpIndex,this.m_blockList.push(e),this.m_blockFList[t.shdUid]=this.m_blockListLen,++this.m_blockListLen):e=this.m_blockList[this.m_blockFList[t.shdUid]],t.index=e.index,e.addNode(t)}rejoinRunitForTro(t){let e=this.m_rpoNodeBuilder.getNodeByUid(t.__$rpuid);null!=e&&(e.tro=t.tro,e.texMid=e.unit.texMid,this.m_blockList[e.index].rejoinNode(e))}rejoinRunitForVro(t){let e=this.m_rpoNodeBuilder.getNodeByUid(t.__$rpuid);null!=e&&(e.drawMode=t.drawMode,e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,e.vtxUid=t.vtxUid,e.vro=t.vro,this.m_blockList[e.index].rejoinNode(e))}addDisp(t){if(null!=t&&null!=t.__$$runit&&t.__$$runit.getRPROUid()<0)if(t.__$$runit.getRPROUid()!=this.uid){let e=this.m_rpoNodeBuilder.create();e.unit=this.m_rpoUnitBuilder.getNodeByUid(t.__$ruid),e.unit.shader=this.m_shader,e.unit.__$rprouid=this.uid,t.__$rpuid=e.uid,e.__$ruid=t.__$ruid,e.unit.__$rpuid=e.uid,e.updateData(),++this.m_nodesLen,this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.m_rpIndex,e.uid),this.m_sortEnabled?(console.log("sort process add a disp..."),null!=this.m_sortBlock||(this.m_sortBlock=new i.default(this.m_shader),this.m_sortBlock.setSorter(this.m_sorter)),this.m_sortBlock.addNode(e)):this.addNodeToBlock(e)}else console.log("RenderProcess::addDisp(), Warn: add entity repeat in processid("+this.m_rpIndex+").")}updateDispMateiral(t){if(null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),s=this.m_rpoNodeBuilder.getNodeByUid(e);s.shdUid=s.unit.shdUid,s.texMid=s.unit.texMid,s.tro=s.unit.tro;let i=this.m_blockList[s.index];i.removeNode(s),this.addNodeToBlock(s)}}removeDisp(t){if(null!=t&&null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),s=this.m_rpoNodeBuilder.getNodeByUid(e);if(null!=s){if(null==this.m_sortBlock){let t=this.m_blockList[s.index];t.removeNode(s)}else this.m_sortBlock.removeNode(s);this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.m_rpIndex,-1),--this.m_nodesLen;let e=s.unit;this.m_rpoNodeBuilder.restore(s)&&this.m_rpoUnitBuilder.restore(e),this.m_vtxResource.__$detachRes(t.vbuf.getUid()),t.__$$runit=null,t.__$ruid=-1}else console.error("There is no this display instance.")}}removeDispUnit(t){if(null!=t&&t.__$ruid>-1){let e=t.__$$runit.getRPOUid(),s=this.m_rpoNodeBuilder.getNodeByUid(e);if(null!=s){if(null==this.m_sortBlock){let t=this.m_blockList[s.index];t.removeNode(s)}else this.m_sortBlock.removeNode(s);this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.m_rpIndex,-1),s.unit.__$rprouid=-1,--this.m_nodesLen,this.m_rpoNodeBuilder.restore(s)}}}update(){this.m_enabled&&this.m_nodesLen>0&&null!=this.m_sortBlock&&this.m_sortBlock.update()}run(){if(this.m_enabled&&this.m_nodesLen>0){let t=this.m_rc;if(null==this.m_sortBlock)if(this.m_shader.isUnLocked())for(let e=0;e<this.m_blockListLen;++e)this.m_blockList[e].run(t);else for(let e=0;e<this.m_blockListLen;++e)this.m_blockList[e].runLockMaterial(t);else this.m_shader.isUnLocked()?this.m_sortBlock.run(t):this.m_sortBlock.runLockMaterial(t)}}drawDisp(t){if(null!=t){let e=t.__$$runit;null!=e&&this.m_fixBlock.drawUnit(this.m_rc,e,t)}}drawLockMaterialByDisp(t,e){if(null!=t){let s=t.__$$runit;null!=s&&this.m_fixBlock.drawLockMaterialByUnit(this.m_rc,s,t,e)}}reset(){this.m_sortEnabled=!1,this.m_nodesLen=0,this.uid=-1,this.m_rpIndex=-1,this.m_rcuid=-1,this.m_rpIndex=-1;let t=0;for(;t<this.m_blockListLen;++t)this.m_blockList[t].reset();this.m_blockListLen=0,this.m_blockList=[],this.m_rpoNodeBuilder=null,this.m_rpoUnitBuilder=null,this.m_vtxResource=null,this.m_rc=null,null!=this.m_sortBlock&&(this.m_sortBlock.clear(),this.m_sortBlock=null)}showInfo(){let t=0;for(;t<this.m_blockListLen;++t)this.m_blockList[t].showInfo()}destroy(){this.reset()}setEnabled(t){this.m_enabled=t}getEnabled(){return this.m_enabled}toString(){return"[RenderProcess(uid = "+this.m_rpIndex+")]"}}a.s_max_shdTotal=1024,e.default=a},"76b0":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8e17"),r=s("d1a0"),a=s("35fa"),h=s("8a0a"),n=s("fecb"),l=s("cb29"),_=s("e7d2"),o=s("e08e");class m extends l.default{constructor(t=h.default.VTX_STATIC_DRAW){super(t),this.offsetU=0,this.offsetV=0,this.uScale=1,this.vScale=1,this.flipVerticalUV=!1,this.axisFlag=0,this.m_polyhedralBoo=!0,this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,this.vsFloat32=null,this.dataStepList=null}getVS(){return this.m_vs}getUVS(){return this.m_uvs}getNVS(){return this.m_nvs}getCVS(){return this.m_cvs}initialize(t,e,s,i){if(null!=this.m_vs)return;let r=t,l=e,m=t+s,u=e+i,d=0;switch(this.m_ivs=new Uint16Array([0,1,2,0,2,3]),this.axisFlag){case 0:this.m_vs=new Float32Array([r,l,d,m,l,d,m,u,d,r,u,d]);break;case 1:this.m_vs=new Float32Array([m,d,l,r,d,l,r,d,u,m,d,u]);break;case 2:this.m_vs=new Float32Array([d,r,l,d,m,l,d,m,u,d,r,u]);break;default:break}if(null==this.bounds&&(this.bounds=new n.default),this.bounds.addXYZFloat32Arr(this.m_vs),this.bounds.updateFast(),_.default.Reset(),_.default.AddFloat32Data(this.m_vs,3),this.isVBufEnabledAt(h.default.VBUF_UVS_INDEX)&&(this.flipVerticalUV?this.m_uvs=new Float32Array([this.offsetU+0*this.uScale,this.offsetV+1*this.vScale,this.offsetU+1*this.uScale,this.offsetV+1*this.vScale,this.offsetU+1*this.uScale,this.offsetV+0*this.vScale,this.offsetU+0*this.uScale,this.offsetV+0*this.vScale]):this.m_uvs=new Float32Array([this.offsetU+0*this.uScale,this.offsetV+0*this.vScale,this.offsetU+1*this.uScale,this.offsetV+0*this.vScale,this.offsetU+1*this.uScale,this.offsetV+1*this.vScale,this.offsetU+0*this.uScale,this.offsetV+1*this.vScale]),_.default.AddFloat32Data(this.m_uvs,2)),this.isVBufEnabledAt(h.default.VBUF_NVS_INDEX)){switch(this.axisFlag){case 0:this.m_nvs=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]);break;case 1:this.m_nvs=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0]);break;case 2:this.m_nvs=new Float32Array([1,0,0,1,0,0,1,0,0,1,0,0]);break;default:break}_.default.AddFloat32Data(this.m_nvs,3)}if(this.isVBufEnabledAt(h.default.VBUF_CVS_INDEX)&&(this.m_cvs=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1]),_.default.AddFloat32Data(this.m_cvs,3)),this.isVBufEnabledAt(h.default.VBUF_TVS_INDEX)){let t=2,e=new Float32Array(12),s=new Float32Array(12);a.default.ClacTrisTangent(this.m_vs,this.m_vs.length,this.m_uvs,this.m_nvs,t,this.m_ivs,e,s),_.default.AddFloat32Data(e,3),_.default.AddFloat32Data(s,3)}_.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.vtCount=this.m_ivs.length,this.m_vbuf=_.default.CreateBySaveData(this.getBufDataUsage()),this.m_vbuf.setUintIVSData(this.m_ivs),this.vtxTotal=4,this.trisNumber=2,this.drawMode=o.RenderDrawMode.ELEMENTS_TRIANGLES,this.buildEnd()}isPolyhedral(){return this.m_polyhedralBoo}setPolyhedral(t){this.m_polyhedralBoo=t}testRay(t,e,s,a){if(this.m_polyhedralBoo)return-1;if(a){switch(this.axisFlag){case 0:r.default.IntersectionSLV2(i.default.Z_AXIS,0,t,e,s);break;case 1:r.default.IntersectionSLV2(i.default.Y_AXIS,0,t,e,s);break;case 2:r.default.IntersectionSLV2(i.default.X_AXIS,0,t,e,s);break;default:break}return 1}return-1}toString(){return"[RectPlaneMesh()]"}__$destroy(){this.isResFree()&&(this.bounds=null,this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,super.__$destroy())}}e.default=m},"78e9":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("644c");class r{constructor(){this.type=-1,this.typeName="",this.name="",this.isArray=!1,this.arrLength=0,this.isTex=!1,this.location=null}parseCode(t){const e=";";let s=t.indexOf(e);if(s<0)return!1;const r=" ";s>0&&(t=t.slice(0,s)),s=t.indexOf(r);let a=0,h="",n=[];while(s>=0)h=t.slice(a,s),h.length>0&&n.push(h),a=s+1,s=t.indexOf(r,a);return h=t.slice(a,t.length),h.length>0&&n.push(h),this.typeName=n[n.length-2],this.name=n[n.length-1],s=this.name.indexOf("["),this.isArray=s>0,this.arrLength=0,this.isArray&&(this.arrLength=parseInt(this.name.slice(s+1,this.name.indexOf("]",s+1))),this.name=this.name.slice(0,s),this.typeName+="[]"),this.type=i.default.GetTypeByTypeNS(this.typeName),!(this.type<0)&&(this.isTex=this.type==i.default.SHADER_SAMPLER2D||this.type==i.default.SHADER_SAMPLERCUBE||this.type==i.default.SHADER_SAMPLER3D,!0)}}e.default=r},"7a04":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("f044");class r{constructor(){this.m_uid=-1,this.m_total=0,this.m_fOffsetList=null,this.m_f32List=null,this.m_f32SizeList=null,this.m_f32PreSizeList=null,this.m_f32ChangedList=null,this.m_f32Bufs=null,this.m_stepFloatsTotal=0,this.m_uid=i.default.CreateNewID()}getUid(){return this.m_uid}getType(){return 1}getBuffersTotal(){return this.m_f32List.length}getF32DataAt(t){return this.m_f32List[t]}setF32DataAt(t,e,s,i){null==this.m_f32List&&(this.m_f32List=[null,null,null,null,null,null,null,null],this.m_f32ChangedList=[!1,!1,!1,!1,!1,!1,!1,!1],this.m_f32SizeList=[0,0,0,0,0,0,0,0],this.m_f32PreSizeList=[0,0,0,0,0,0,0,0]),this.m_f32List[t]=e,null!=this.m_f32Bufs&&null!=e&&(this.m_f32ChangedList[t]=!0),null!=i&&(this.m_fOffsetList=i),this.m_stepFloatsTotal=s,null!=e&&(this.m_f32SizeList[t]=e.length)}setData4fAt(t,e,s,i,r,a){t*=this.m_fOffsetList[e],this.m_f32List[e][t++]=s,this.m_f32List[e][t++]=i,this.m_f32List[e][t++]=r,this.m_f32List[e][t++]=a}setData3fAt(t,e,s,i,r){t*=this.m_fOffsetList[e],this.m_f32List[e][t++]=s,this.m_f32List[e][t++]=i,this.m_f32List[e][t++]=r}setData2fAt(t,e,s,i){t*=this.m_fOffsetList[e],this.m_f32List[e][t++]=s,this.m_f32List[e][t++]=i}destroy(){this.m_f32List=null,this.m_f32ChangedList=null,this.m_f32SizeList=null,this.m_f32PreSizeList=null,console.log("VtxSeparatedBuf::__$destroy()... ",this),this.m_f32List=null}toString(){return"VtxSeparatedBuf(uid = "+this.m_uid+")"}}e.default=r},"7b0e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("bbf4");class r{constructor(){this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rayTestState=0,this.rpoNode=null,this.spaceId=-1,this.camVisiSt=0,this.camVisi=i.default.CAMERA_VISIBLE_ENABLE}reset(){this.rayTestState=0,this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rpoNode=null,this.spaceId=-1,this.camVisi=0}static GetFreeId(){return r.m_freeIdList.length>0?r.m_freeIdList.pop():-1}static GetByUid(t){return t>-1&&t<r.m_nodeListLen?r.m_nodeList[t]:null}static SetCamVisiByUid(t,e){r.m_nodeList[t].camVisi=e}static GetCamVisiByUid(t){return r.m_nodeList[t].camVisi}static Create(){let t=null,e=r.GetFreeId();return e>=0?(t=r.m_nodeList[e],t.uid=e,r.m_nodeFlagList[e]=r.S_FLAG_BUSY):(t=new r,r.m_nodeList.push(t),r.m_nodeFlagList.push(r.S_FLAG_BUSY),t.uid=r.m_nodeListLen,r.m_nodeListLen++),t}static Restore(t){null!=t&&t.uid>=0&&r.m_nodeFlagList[t.uid]==r.S_FLAG_BUSY&&(r.m_freeIdList.push(t.uid),r.m_nodeFlagList[t.uid]=r.S_FLAG_FREE,t.reset())}}r.S_FLAG_BUSY=1,r.S_FLAG_FREE=0,r.m_nodeListLen=0,r.m_nodeList=[],r.m_nodeFlagList=[],r.m_freeIdList=[],e.default=r},"7c63":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("e08e");class r{constructor(t,e,s,i){this.m_uid=-1,this.m_rBoo=!0,this.m_gBoo=!0,this.m_bBoo=!0,this.m_aBoo=!0,this.m_state=0,this.m_uid=r.s_uid++,this.m_rBoo=t,this.m_gBoo=e,this.m_bBoo=s,this.m_aBoo=i,this.m_state=(this.m_rBoo?64:0)|(this.m_gBoo?16:0)|(this.m_bBoo?4:0)|(this.m_aBoo?1:0)}getUid(){return this.m_uid}getState(){return this.m_state}getR(){return this.m_rBoo}getG(){return this.m_gBoo}getB(){return this.m_bBoo}getA(){return this.m_aBoo}use(){r.s_state!=this.m_uid&&(r.Rstate.setColorMask(this.m_rBoo,this.m_gBoo,this.m_bBoo,this.m_aBoo),r.s_state=this.m_uid)}static Create(t,e,s,i,a){if(r.s_stsNameMap.has(t)){let e=r.s_stsNameMap.get(t);return e.getUid()}let h=(e?64:32)|(s?16:8)|(i?4:2)|(a?1:0);if(r.s_stsMap.has(h)){let t=r.s_stsMap.get(h);h=t.getUid()}else{let n=new r(e,s,i,a);h=n.getUid(),r.s_stsMap.set(h,n),r.s_stsNameMap.set(t,n),r.s_states.push(n),++r.s_statesLen}return h}static GetColorMaskByName(t){if(r.s_stsNameMap.has(t)){let e=r.s_stsNameMap.get(t);return e.getUid()}return-1}static UseRenderState(t){r.s_unlocked&&r.Rstate.roColorMask!=t&&t>-1&&t<r.s_statesLen&&r.s_states[t].use()}static UseColorMaskByName(t){let e=r.GetColorMaskByName(t);r.s_unlocked&&r.Rstate.roColorMask!=e&&e>-1&&e<r.s_statesLen&&r.s_states[e].use()}static Lock(){r.s_unlocked=!1}static Unlock(){r.s_unlocked=!0}static Reset(){r.s_state=-1}}r.s_uid=0,r.s_state=-1,r.s_states=[],r.s_statesLen=1,r.s_stsMap=new Map,r.s_stsNameMap=new Map,r.s_unlocked=!0,r.ALL_TRUE_COLOR_MASK=0,r.ALL_FALSE_COLOR_MASK=1,r.Rstate=null,e.RenderColorMask=r;class a{constructor(t,e,s){this.m_uid=-1,this.m_cullFaceMode=0,this.m_blendMode=0,this.m_depthTestMode=0,this.m_shadowMode=0,this.m_state=0,this.m_uid=a.s_uid++,this.m_cullFaceMode=t,this.m_blendMode=e,this.m_depthTestMode=s,this.m_state=this.m_shadowMode<<12|this.m_depthTestMode<<8|this.m_blendMode<<4|this.m_cullFaceMode}getUid(){return this.m_uid}getState(){return this.m_state}getCullFaceMode(){return this.m_cullFaceMode}getDepthTestMode(){return this.m_depthTestMode}getBlendMode(){return this.m_blendMode}use(){a.s_state!=this.m_uid&&(a.Rstate.setCullFaceMode(this.m_cullFaceMode),a.m_blendMode<0?a.Rstate.setBlendMode(this.m_blendMode):a.Rstate.setBlendMode(a.m_blendMode),a.s_depthTestMode<0?a.Rstate.setDepthTestMode(this.m_depthTestMode):a.Rstate.setDepthTestMode(a.s_depthTestMode),a.s_state=this.m_uid)}static Create(t,e,s,i){if(a.s_stsNameMap.has(t)){let e=a.s_stsNameMap.get(t);return e.getUid()}let r=i<<8|s<<4|e;if(a.s_stsMap.has(r)){let t=a.s_stsMap.get(r);r=t.getUid()}else{let h=new a(e,s,i);r=h.getUid(),a.s_stsMap.set(r,h),a.s_stsNameMap.set(t,h),a.s_states.push(h),++a.s_statesLen}return r}static GetRenderStateByName(t){if(a.s_stsNameMap.has(t)){let e=a.s_stsNameMap.get(t);return e.getUid()}return-1}static UseRenderState(t){a.s_unlocked&&a.s_state!=t&&t>-1&&t<a.s_statesLen&&a.s_states[t].use()}static UseRenderStateByName(t){if(a.s_unlocked){let e=a.GetRenderStateByName(t);a.s_state!=e&&e>-1&&e<a.s_statesLen&&a.s_states[e].use()}}static UnlockBlendMode(){a.m_blendMode=-1}static LockBlendMode(t){a.m_blendMode=t}static UnlockDepthTestMode(){a.s_depthTestMode=-1}static LockDepthTestMode(t){a.s_depthTestMode=t}static Lock(){a.s_unlocked=!1}static Unlock(){a.s_unlocked=!0}static Reset(){a.s_state=-1}}a.s_uid=0,a.s_state=-1,a.s_states=[],a.s_statesLen=1,a.m_blendMode=-1,a.s_depthTestMode=-1,a.s_stsMap=new Map,a.s_stsNameMap=new Map,a.s_unlocked=!0,a.NORMAL_STATE=0,a.BACK_CULLFACE_NORMAL_STATE=0,a.FRONT_CULLFACE_NORMAL_STATE=1,a.NONE_CULLFACE_NORMAL_STATE=2,a.ALL_CULLFACE_NORMAL_STATE=3,a.BACK_NORMAL_ALWAYS_STATE=4,a.BACK_TRANSPARENT_STATE=5,a.BACK_TRANSPARENT_ALWAYS_STATE=6,a.NONE_TRANSPARENT_STATE=7,a.Rstate=null,e.RenderStateObject=a;class h{constructor(){this.m_blendMode=i.RenderBlendMode.NORMAL,this.m_cullMode=i.CullFaceMode.NONE,this.m_depthTestType=i.DepthTestMode.DISABLE,this.s_blendDisabled=!0,this.s_cullDisabled=!0,this.m_gl=null,this.roColorMask=-11}reset(){this.roColorMask=-11}setRenderer(t){this.m_gl=t}setColorMask(t,e,s,i){this.m_gl.colorMask(t,e,s,i)}setCullFaceMode(t){switch(t){case i.CullFaceMode.BACK:this.m_cullMode!=t&&(this.m_cullMode=t,this.s_cullDisabled&&(this.s_cullDisabled=!1,this.m_gl.enable(this.m_gl.CULL_FACE)),this.m_gl.cullFace(this.m_gl.BACK));break;case i.CullFaceMode.FRONT:this.m_cullMode!=t&&(this.m_cullMode=t,this.s_cullDisabled&&(this.s_cullDisabled=!1,this.m_gl.enable(this.m_gl.CULL_FACE)),this.m_gl.cullFace(this.m_gl.FRONT));break;case i.CullFaceMode.FRONT_AND_BACK:this.m_cullMode!=t&&(this.m_cullMode=t,this.s_cullDisabled&&(this.s_cullDisabled=!1,this.m_gl.enable(this.m_gl.CULL_FACE)),this.m_gl.cullFace(this.m_gl.FRONT_AND_BACK));break;case i.CullFaceMode.NONE:case i.CullFaceMode.DISABLE:this.m_cullMode!=t&&(this.m_cullMode=t,this.s_cullDisabled||(this.s_cullDisabled=!0,this.m_gl.disable(this.m_gl.CULL_FACE)));break;default:break}}setBlendMode(t){if(this.m_blendMode!=t)switch(this.m_blendMode=t,t){case i.RenderBlendMode.NORMAL:this.s_blendDisabled&&(this.m_gl.enable(this.m_gl.BLEND),this.s_blendDisabled=!1,this.m_gl.blendEquation(this.m_gl.FUNC_ADD)),this.m_gl.blendFunc(this.m_gl.ONE,this.m_gl.ZERO);break;case i.RenderBlendMode.TRANSPARENT:this.s_blendDisabled&&(this.m_gl.enable(this.m_gl.BLEND),this.s_blendDisabled=!1,this.m_gl.blendEquation(this.m_gl.FUNC_ADD)),this.m_gl.blendFunc(this.m_gl.SRC_ALPHA,this.m_gl.ONE_MINUS_SRC_ALPHA);break;case i.RenderBlendMode.ALPHA_ADD:this.s_blendDisabled&&(this.m_gl.enable(this.m_gl.BLEND),this.s_blendDisabled=!1,this.m_gl.blendEquation(this.m_gl.FUNC_ADD)),this.m_gl.blendFunc(this.m_gl.ONE,this.m_gl.ONE_MINUS_SRC_ALPHA);break;case i.RenderBlendMode.ADD:this.s_blendDisabled&&(this.m_gl.enable(this.m_gl.BLEND),this.s_blendDisabled=!1,this.m_gl.blendEquation(this.m_gl.FUNC_ADD)),this.m_gl.blendFunc(this.m_gl.SRC_ALPHA,this.m_gl.ONE);break;case i.RenderBlendMode.ADD2:this.s_blendDisabled&&(this.m_gl.enable(this.m_gl.BLEND),this.s_blendDisabled=!1,this.m_gl.blendEquation(this.m_gl.FUNC_ADD)),this.m_gl.blendFunc(this.m_gl.ONE,this.m_gl.ONE);break;case i.RenderBlendMode.INVERSE_ALPHA:this.s_blendDisabled&&(this.m_gl.enable(this.m_gl.BLEND),this.s_blendDisabled=!1,this.m_gl.blendEquation(this.m_gl.FUNC_ADD)),this.m_gl.blendFunc(this.m_gl.ONE,this.m_gl.SRC_ALPHA);break;case i.RenderBlendMode.BLAZE:this.s_blendDisabled&&(this.m_gl.enable(this.m_gl.BLEND),this.s_blendDisabled=!1,this.m_gl.blendEquation(this.m_gl.FUNC_ADD)),this.m_gl.blendFunc(this.m_gl.SRC_COLOR,this.m_gl.ONE);break;case i.RenderBlendMode.OVERLAY:this.s_blendDisabled&&(this.m_gl.enable(this.m_gl.BLEND),this.s_blendDisabled=!1,this.m_gl.blendEquation(this.m_gl.FUNC_ADD)),this.m_gl.blendFunc(this.m_gl.DST_COLOR,this.m_gl.DST_ALPHA);break;case i.RenderBlendMode.OVERLAY2:this.s_blendDisabled&&(this.m_gl.enable(this.m_gl.BLEND),this.s_blendDisabled=!1,this.m_gl.blendEquation(this.m_gl.FUNC_ADD)),this.m_gl.blendFunc(this.m_gl.DST_COLOR,this.m_gl.SRC_ALPHA);break;case i.RenderBlendMode.DISABLE:this.s_blendDisabled||(this.m_gl.disable(this.m_gl.BLEND),this.s_blendDisabled=!0);break;default:break}}setDepthTestMode(t){if(this.m_depthTestType!=t)switch(this.m_depthTestType=t,t){case i.DepthTestMode.RENDER_ALWAYS:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.ALWAYS);break;case i.DepthTestMode.RENDER_SKY:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.LEQUAL);break;case i.DepthTestMode.RENDER_OPAQUE:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.LESS);break;case i.DepthTestMode.RENDER_OPAQUE_OVERHEAD:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.EQUAL);break;case i.DepthTestMode.RENDER_DECALS:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.LEQUAL);break;case i.DepthTestMode.RENDER_BLEND:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.LESS);break;case i.DepthTestMode.RENDER_WIRE_FRAME:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.LEQUAL);break;case i.DepthTestMode.RENDER_NEXT_LAYER:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.ALWAYS);break;case i.DepthTestMode.RENDER_TRUE_EQUAL:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.EQUAL);break;case i.DepthTestMode.RENDER_TRUE_GREATER:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.GREATER);break;case i.DepthTestMode.RENDER_TRUE_GEQUAL:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.GEQUAL);break;case i.DepthTestMode.RENDER_WIRE_FRAME_NEXT:break;default:break}}}e.RODrawState=h},"81c4":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8e17"),r=s("f48d"),a=s("d1a0");class h extends r.default{constructor(){super(...arguments),this.radiusSquared=2500,this.tv=new i.default(1,0,0),this.center=new i.default(50,0,0),this.anotherPosition=new i.default(100,0,0),this.length=100}intersectionCopSLV2(t,e,s){i.default.Cross(this.tv,e,r.default.__tV1),i.default.Cross(this.tv,r.default.__tV1,r.default.__tV2),r.default.__tV2.normalize(),a.default.IntersectionSLV2(r.default.__tV2,r.default.__tV2.dot(this.position),t,e,s),r.default.__tV2.x=s.x-this.position.x,r.default.__tV2.y=s.y-this.position.y,r.default.__tV2.z=s.z-this.position.z;let h=r.default.__tV2.dot(this.tv);h<0?s.copyFrom(this.position):h>this.length&&s.copyFrom(this.anotherPosition)}update(){this.tv.x=this.anotherPosition.x-this.position.x,this.tv.y=this.anotherPosition.y-this.position.y,this.tv.z=this.anotherPosition.z-this.position.z,this.length=this.tv.getLength(),this.tv.x*=.5,this.tv.y*=.5,this.tv.z*=.5,this.center.x=this.position.x+this.tv.x,this.center.y=this.position.y+this.tv.y,this.center.z=this.position.z+this.tv.z,this.radiusSquared=this.tv.getLengthSquared(),this.tv.normalize()}updateFast(){this.update()}}e.default=h},"81ce":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Es2VtxShderToES3(t){let e=t;const s="attribute",i="varying ";let r=e.indexOf(s),a=0;while(r>=0)e=e.slice(0,r)+"layout(location="+a+") in"+e.slice(r+9),r=e.indexOf(s),a++;let h=new RegExp(i,"g");return e=e.replace(h,"out "),"#version 300 es\n"+e}static Es2FragShderToES3(t){let e=t;const s="gl_FragColor",i="varying ";let r=e.indexOf(s),a=0,h="FragColorOut_"+a;r>=0&&(e=e.slice(0,r)+h+e.slice(r+12)),r=e.indexOf("void "),e=e.slice(0,r)+"out vec4 "+h+";\n"+e.slice(r);let n=new RegExp(i,"g");return e=e.replace(n,"in "),n=new RegExp(" texture2D","g"),e=e.replace(n," texture"),n=new RegExp(" textureCube","g"),e=e.replace(n," texture"),"#version 300 es\n"+e}static Es3VtxShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const s=/\blayout\b.+\bin\b/g;t=t.replace(s,"attribute");const r=/\bout\b/g;t=t.replace(r,"varying");const a=/\btexture\b/g;t=t.replace(a,"texture2D"),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version"));let h=0,n=0,l=t.indexOf("inverse(");l<0&&(l=t.indexOf("inverse ("));let _="",o=!1,m=!1;while(l>3){if(h=t.indexOf(")",l+2),_=t.slice(l+2,h),_.indexOf("mat3")>0)o=!0;else if(_=_.replace(/\s+/g,""),h=_.indexOf("("),_=_.slice(h+1),h=t.indexOf(_,1),n=t.lastIndexOf("mat",h),n>0)switch(_=t.slice(n,h),_=_.replace(/\s+/g,""),_){case"mat3":o=!0;break;case"mat4":m=!0;break}if(l=t.indexOf("inverse(",l+5),l<0&&(l=t.indexOf("inverse (",l+5)),o&&m)break}h=0,l=t.indexOf("transpose("),l<0&&(l=t.indexOf("transpose (")),_="";let u=!1,d=!1;while(l>3){if(h=t.indexOf(")",l+2),_=t.slice(l+2,h+1),_.indexOf("mat3")>0)u=!0;else if(_=_.replace(/\s+/g,""),h=_.indexOf("("),_=_.slice(h+1),h=t.indexOf(_,1),n=t.lastIndexOf("mat",h),n>0)switch(_=t.slice(n,h),_=_.replace(/\s+/g,""),_){case"mat3":u=!0;break;case"mat4":d=!0;break}if(l=t.indexOf("transpose(",l+5),l<0&&(l=t.indexOf("transpose (",l+5)),u&&d)break}return(o||m)&&(l=t.indexOf("void "),l>10&&(o&&m?t=t.slice(0,l)+i.__glslInverseMat3+i.__glslInverseMat4+t.slice(l):o?t=t.slice(0,l)+i.__glslInverseMat3+t.slice(l):m&&(t=t.slice(0,l)+i.__glslInverseMat4+t.slice(l)))),(u||d)&&(l=t.indexOf("void "),l>10&&(u&&d?t=t.slice(0,l)+i.__glslTransposeMat3+i.__glslTransposeMat4+t.slice(l):u?t=t.slice(0,l)+i.__glslTransposeMat3+t.slice(l):d&&(t=t.slice(0,l)+i.__glslTransposeMat4+t.slice(l)))),t}static Es3FragShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const s=new RegExp(" in ","g");t=t.replace(s,"_fref_");const i=/\bin\b/g;t=t.replace(i,"varying");const r=new RegExp("_fref_","g");t=t.replace(r," in ");const a=/\btexture\b/g;t=t.replace(a,"texture2D");const h=/" "/g;let n=t;const l=";",_="layout";let o=n.indexOf(_),m=0,u=0,d="",c="",f=0,p=null,g=[],x=[];while(o>=0)m=n.indexOf(l,o+1),d=n.slice(o+1,m),c=d.slice(d.lastIndexOf(" ")+1),f=d.indexOf(")"),o=d.lastIndexOf("=",f)+1,d=d.slice(o+1,f),f=parseInt(d.replace(h,"")),g.push(c),x.push(f),o=n.indexOf(_,m);let T=g.length;if(T>0)if(p=/layout/g,t=t.replace(p,"//layout"),T>1){o=0;while(o<T)p=new RegExp(g[o],"g"),t=t.replace(p,"gl_FragData["+x[o]+"]"),++o}else p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor");else o=n.indexOf("out "),o>0&&(m=n.indexOf(l,o+1),d=n.slice(o+1,m),c=d.slice(d.lastIndexOf(" ")+1),p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor"),p=new RegExp("out ","g"),t=t.replace(p,"//out "));T>1&&(t="#extension GL_EXT_draw_buffers: require\n"+t),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version")),o=0;for(let E=0;E<16;++E){if(o=t.indexOf("samplerCube ",o),!(o>0))break;{m=t.indexOf(";",o),d=n.slice(o+12,m),c="";let e=d.split(" ");for(let t=0;t<16;++t)if(""!=e[t]){c=e[t];break}for(T=0;T<16;++T){if(m=t.indexOf(c,m+1),!(m>0))break;u=t.lastIndexOf("texture2D",m-1),d=t.slice(u,m),t=t.slice(0,u)+"textureCube("+t.slice(m),m+=2}}o+=4}return t}}i.__glslTransposeMat3="\n    mat3 transpose(mat3 m) {\n        return mat3(m[0][0],m[1][0],m[2][0],\n            m[0][1],m[1][1],m[2][1],\n            m[0][2],m[1][2],m[2][2]);\n    }\n    ",i.__glslTransposeMat4="\n    mat4 transpose(mat4 m) {\n        return mat4(m[0][0],m[1][0],m[2][0],m[3][0],\n            m[0][1],m[1][1],m[2][1],m[3][1],\n            m[0][2],m[1][2],m[2][2],m[3][2],\n            m[0][3],m[1][3],m[2][3],m[3][3]);\n    }\n    ",i.__glslInverseMat3="\n    mat3 inverse(mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];  \n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;  \n        float det = a00 * b01 + a01 * b11 + a02 * b21;  \n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n    ",i.__glslInverseMat4="\n    mat4 inverse(mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n        }\n    ",e.default=i},8333:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.COLOR_BUFFER_BIT=131,i.DEPTH_BUFFER_BIT=132,i.STENCIL_BUFFER_BIT=133,e.default=i},"83d1":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("ab73"),r=s("7279");class a{create(t,e){let s=null;return e.hasUniformByName(i.default.StageParamUNS)&&(s=new r.default,s.uniformNameList=[i.default.StageParamUNS],s.copyDataFromProbe(t.getStage3D().uProbe)),s}getIDNS(){return"StageParamUniformBuilder"}}e.default=a},"85b6":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98"),r=s("0851");class a extends r.default{constructor(t,e,s=!1){super(t,e,s),this.m_tex=null,this.m_type=i.TextureProxyType.Wrapper}getResUid(){return this.m_tex.getResUid()}isDirect(){return!1}attachTex(t){null!=t&&t!=this&&(this.m_tex!=t&&t.__$attachThis(),this.m_tex=t)}detachTex(){null!=this.m_tex&&this.m_tex.__$detachThis(),this.m_tex=null}__$attachThis(){super.__$attachThis(),null!=this.m_tex&&this.m_tex.__$attachThis()}__$detachThis(){super.__$detachThis(),null!=this.m_tex&&this.m_tex.__$detachThis()}__$$use(t){this.m_tex.__$$use(t)}isGpuEnabled(){return this.m_tex.isGpuEnabled()}getSampler(){return this.m_tex.getSampler()}__$updateToGpu(t){this.m_tex.__$updateToGpu(t)}__$$upload(t){this.m_tex.__$$upload(t)}__$destroy(){this.getAttachCount()<1&&(null!=this.m_tex&&this.m_tex.__$detachThis(),this.m_tex=null,super.__$destroy())}isDataEnough(){return this.m_tex.isDataEnough()}getTargetType(){return this.m_tex.getTargetType()}toString(){return"[WrapperTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=a},8875:function(t,e,s){var i,r,a;(function(s,h){r=[],i=h,a="function"===typeof i?i.apply(e,r):i,void 0===a||(t.exports=a)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(d){var s,i,r,a=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,h=/@([^@]*):(\d+):(\d+)\s*$/gi,n=a.exec(d.stack)||h.exec(d.stack),l=n&&n[1]||!1,_=n&&n[2]||!1,o=document.location.href.replace(document.location.hash,""),m=document.getElementsByTagName("script");l===o&&(s=document.documentElement.outerHTML,i=new RegExp("(?:[^\\n]+?\\n){0,"+(_-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=s.replace(i,"$1").trim());for(var u=0;u<m.length;u++){if("interactive"===m[u].readyState)return m[u];if(m[u].src===l)return m[u];if(l===o&&m[u].innerHTML&&m[u].innerHTML.trim()===r)return m[u]}return null}}return t}))},"8a0a":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("ca6c");class r{static ToGL(t,e){switch(e){case r.VTX_STATIC_DRAW:return t.STATIC_DRAW;case r.VTX_DYNAMIC_DRAW:return t.DYNAMIC_DRAW;case r.VTX_STREAM_DRAW:return t.STREAM_DRAW;case r.VTX_STATIC_READ:return t.STATIC_READ;case r.VTX_DYNAMIC_READ:return t.DYNAMIC_READ;case r.VTX_STREAM_READ:return t.STREAM_READ;case r.VTX_STATIC_COPY:return t.STATIC_COPY;case r.VTX_DYNAMIC_COPY:return t.DYNAMIC_COPY;case r.VTX_STREAM_COPY:return t.STREAM_COPY;default:break}return t.STATIC_DRAW}static GetVBufTypeByNS(t){switch(t){case r.VBUF_VS_NS:return r.VBUF_VS;case r.VBUF_UVS_NS:return r.VBUF_UVS;case r.VBUF_NVS_NS:return r.VBUF_NVS;case r.VBUF_CVS_NS:return r.VBUF_CVS;case r.VBUF_VS2_NS:return r.VBUF_VS2;case r.VBUF_UVS2_NS:return r.VBUF_UVS2;case r.VBUF_NVS2_NS:return r.VBUF_NVS2;case r.VBUF_CVS2_NS:return r.VBUF_CVS2;case r.VBUF_TVS_NS:return r.VBUF_TVS;case r.VBUF_TVS2_NS:return r.VBUF_TVS2;default:}return-1}static GetVBufNSByType(t){switch(t){case r.VBUF_VS:return r.VBUF_VS_NS;case r.VBUF_UVS:return r.VBUF_UVS_NS;case r.VBUF_NVS:return r.VBUF_NVS_NS;case r.VBUF_CVS:return r.VBUF_CVS_NS;case r.VBUF_VS2:return r.VBUF_VS2_NS;case r.VBUF_UVS2:return r.VBUF_UVS2_NS;case r.VBUF_NVS2:return r.VBUF_NVS2_NS;case r.VBUF_CVS2:return r.VBUF_CVS2_NS;case r.VBUF_TVS:return r.VBUF_TVS_NS;case r.VBUF_TVS2:return r.VBUF_TVS2_NS;default:}return""}static GetVBufAttributeTypeByNS(t){return r.GetVBufTypeByNS(t)-3e3}}r.VTXTYPE_GL_POINTS=101,r.VTXTYPE_GL_LINES=102,r.VTXTYPE_GL_LINE_STRIP=103,r.VTXTYPE_GL_TRIANGLES=111,r.VTX_STATIC_DRAW=0,r.VTX_DYNAMIC_DRAW=1,r.VTX_STREAM_DRAW=2,r.VTX_STATIC_READ=3,r.VTX_DYNAMIC_READ=4,r.VTX_STREAM_READ=5,r.VTX_STATIC_COPY=6,r.VTX_DYNAMIC_COPY=7,r.VTX_STREAM_COPY=8,r.VBUF_VS=3001,r.VBUF_VS2=3002,r.VBUF_UVS=3003,r.VBUF_UVS2=3004,r.VBUF_NVS=3005,r.VBUF_NVS2=3006,r.VBUF_CVS=3007,r.VBUF_CVS2=3008,r.VBUF_TVS=3009,r.VBUF_TVS2=3010,r.VBUF_VS_INDEX=i.default.BIT_ONE_0,r.VBUF_UVS_INDEX=i.default.BIT_ONE_1,r.VBUF_NVS_INDEX=i.default.BIT_ONE_2,r.VBUF_CVS_INDEX=i.default.BIT_ONE_3,r.VBUF_TVS_INDEX=i.default.BIT_ONE_4,r.VBUF_VS2_INDEX=i.default.BIT_ONE_5,r.VBUF_UVS2_INDEX=i.default.BIT_ONE_6,r.VBUF_NVS2_INDEX=i.default.BIT_ONE_7,r.VBUF_CVS2_INDEX=i.default.BIT_ONE_8,r.VBUF_TVS2_INDEX=i.default.BIT_ONE_9,r.VBUF_VS_NS="a_vs",r.VBUF_VS2_NS="a_vs2",r.VBUF_UVS_NS="a_uvs",r.VBUF_UVS2_NS="a_uvs2",r.VBUF_NVS_NS="a_nvs",r.VBUF_NVS2_NS="a_nvs2",r.VBUF_CVS_NS="a_cvs",r.VBUF_CVS2_NS="a_cvs2",r.VBUF_TVS_NS="a_tvs",r.VBUF_TVS2_NS="a_tvs2";class a{}a.FLAT=210,a.GOURAND=310,e.VtxNormalType=a,e.default=r},"8d98":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("352a"),r=s("030e");class a{static ToGL(t,e){switch(e){case a.RGBA:break;case a.R8:return t.R8;case a.RGB:return t.RGB;case a.RGB8:return t.RGB8;case a.RGBA8:return t.RGBA8;case a.ALPHA:return t.ALPHA;case a.RGB16F:return i.default.IsWebGL2()?t.RGB16F:t.RGB;case a.RGBA16F:return i.default.IsWebGL2()?t.RGBA16F:t.RGBA;case a.RGB32F:return i.default.IsWebGL2()&&t.RGB32F,t.RGB;case a.RGBA32F:return i.default.IsWebGL2()&&t.RGBA32F,t.RGBA;case a.RED:return t.RED;case a.DEPTH_COMPONENT:return t.DEPTH_COMPONENT;case a.DEPTH_STENCIL:return t.DEPTH_STENCIL;default:break}return t.RGBA}}a.R8=101,a.RGB=110,a.RED=111,a.RGBA=121,a.RGB8=122,a.RGBA8=123,a.ALPHA=132,a.RGB16F=331,a.RGBA16F=332,a.RGB32F=341,a.RGBA32F=342,a.DEPTH_COMPONENT=351,a.DEPTH_STENCIL=352,e.TextureFormat=a;class h{static ToGL(t,e){switch(e){case h.UNSIGNED_BYTE:return t.UNSIGNED_BYTE;case h.BYTE:return t.BYTE;case h.FLOAT:return t.FLOAT;case h.HALF_FLOAT:return t.HALF_FLOAT;case h.HALF_FLOAT_OES:return t.HALF_FLOAT_OES;case h.UNSIGNED_SHORT:return t.UNSIGNED_SHORT;case h.UNSIGNED_INT:return t.UNSIGNED_INT;case h.UNSIGNED_SHORT_5_6_5:return t.UNSIGNED_SHORT_5_6_5;case h.UNSIGNED_SHORT_4_4_4_4:return t.UNSIGNED_SHORT_4_4_4_4;case h.UNSIGNED_SHORT_5_5_5_1:return t.UNSIGNED_SHORT_5_5_5_1;case h.UNSIGNED_INT_24_8_WEBGL:return r.default.WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL;default:break}return t.UNSIGNED_BYTE}}h.UNSIGNED_BYTE=1108,h.UNSIGNED_SHORT=1109,h.UNSIGNED_INT=1110,h.BYTE=1111,h.FLOAT=1211,h.HALF_FLOAT=1212,h.HALF_FLOAT_OES=1213,h.UNSIGNED_SHORT_5_6_5=1214,h.UNSIGNED_SHORT_4_4_4_4=1215,h.UNSIGNED_SHORT_5_5_5_1=1216,h.UNSIGNED_INT_24_8_WEBGL=1217,e.TextureDataType=h;class n{static GetValue(t,e){switch(e){case n.TEXTURE_2D:return t.TEXTURE_2D;case n.TEXTURE_2D_ARRAY:return t.TEXTURE_2D_ARRAY;case n.TEXTURE_CUBE:return t.TEXTURE_CUBE_MAP;case n.TEXTURE_3D:return t.TEXTURE_3D;default:break}return t.TEXTURE_2D}}n.TEXTURE_2D=20,n.TEXTURE_2D_ARRAY=22,n.TEXTURE_SHADOW_2D=23,n.TEXTURE_CUBE=25,n.TEXTURE_3D=30,e.TextureTarget=n,function(t){t[t["Default"]=0]="Default",t[t["Depth"]=1]="Depth",t[t["Wrapper"]=2]="Wrapper",t[t["RTT"]=3]="RTT",t[t["Image"]=4]="Image",t[t["Float"]=5]="Float",t[t["Uint16"]=6]="Uint16",t[t["FloatCube"]=7]="FloatCube",t[t["Bytes"]=8]="Bytes",t[t["BytesCube"]=9]="BytesCube",t[t["ImageCube"]=10]="ImageCube",t[t["Texture3D"]=11]="Texture3D"}(e.TextureProxyType||(e.TextureProxyType={}));class l{static GetConst(t,e){switch(e){case l.NEAREST:return t.NEAREST;case l.LINEAR:return t.LINEAR;case l.LINEAR_MIPMAP_LINEAR:return t.LINEAR_MIPMAP_LINEAR;case l.NEAREST_MIPMAP_NEAREST:return t.NEAREST_MIPMAP_NEAREST;case l.LINEAR_MIPMAP_NEAREST:return t.LINEAR_MIPMAP_NEAREST;case l.NEAREST_MIPMAP_LINEAR:return t.NEAREST_MIPMAP_LINEAR;case l.WRAP_REPEAT:return t.REPEAT;case l.WRAP_CLAMP_TO_EDGE:return t.CLAMP_TO_EDGE;case l.WRAP_MIRRORED_REPEAT:return t.MIRRORED_REPEAT;default:break}return-1}}l.WRAP_REPEAT=3001,l.WRAP_CLAMP_TO_EDGE=3002,l.WRAP_MIRRORED_REPEAT=3003,l.NEAREST=4001,l.LINEAR=4002,l.LINEAR_MIPMAP_LINEAR=4003,l.NEAREST_MIPMAP_NEAREST=4004,l.LINEAR_MIPMAP_NEAREST=4005,l.NEAREST_MIPMAP_LINEAR=4006,e.TextureConst=l},"8def":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("919c");class r extends i.default{constructor(){super(),this.shdp=null,this.vbufs=null,this.vbuf=null,this.attribTypes=null,this.wholeOffsetList=null,this.attribTypesLen=0,this.updateUnlocked=!0,this.wholeStride=0,this.m_uid=r.s_uid++}run(){this.m_rc.testVROUid(this.m_uid)&&(null!=this.vbuf?this.m_rc.useVtxAttribsPtrTypeFloat(this.shdp,this.vbuf,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride):this.m_rc.useVtxAttribsPtrTypeFloatMulti(this.shdp,this.vbufs,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride),this.m_rc.testRIOUid(this.m_vtxUid)&&this.m_rc.bindEleBuf(this.ibuf))}__$destroy(){console.log("VertexRenderObj::__$destroy()..., "+this),i.default.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.m_rc=null,this.shdp=null,this.vbufs=null,this.vbuf=null,this.ibuf=null,this.attribTypes=null,this.attribTypesLen=0,this.wholeStride=0}restoreThis(){r.Restore(this)}toString(){return"VertexRenderObj(uid = "+this.m_uid+", type="+this.m_mid+")"}static HasMid(t){return i.default.s_midMap.has(t)}static GetByMid(t){return i.default.s_midMap.get(t)}static GetFreeId(){return r.s_freeIdList.length>0?r.s_freeIdList.pop():-1}static Create(t,e,s){let a=null,h=r.GetFreeId();return h>=0?(a=r.s_unitList[h],r.s_unitFlagList[h]=r.S_FLAG_BUSY,a.setMidAndBufUid(e,s)):(a=new r,a.setMidAndBufUid(e,s),r.s_unitList.push(a),r.s_unitFlagList.push(r.S_FLAG_BUSY),r.s_unitListLen++),a.setRC(t),i.default.s_midMap.set(e,a),a}static Restore(t){if(null!=t&&t.m_attachCount<1&&r.s_unitFlagList[t.getUid()]==r.S_FLAG_BUSY){let e=t.getUid();r.s_freeIdList.push(e),r.s_unitFlagList[e]=r.S_FLAG_FREE,t.__$destroy()}}}r.s_uid=0,r.S_FLAG_BUSY=1,r.S_FLAG_FREE=0,r.s_unitFlagList=[],r.s_unitListLen=0,r.s_unitList=[],r.s_freeIdList=[],e.default=r},"8e17":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("6e01");class r{constructor(t=0,e=0,s=0,i=1){this.x=0,this.y=0,this.z=0,this.w=0,this.x=t,this.y=e,this.z=s,this.w=i}setTo(t,e,s,i=1){this.x=t,this.y=e,this.z=s,this.w=i}setXYZ(t,e,s){this.x=t,this.y=e,this.z=s}copyFrom(t){this.x=t.x,this.y=t.y,this.z=t.z}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}multBy(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);t>i.default.MATH_MIN_POSITIVE&&(this.x/=t,this.y/=t,this.z/=t)}normalizeTo(t){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);e>i.default.MATH_MIN_POSITIVE?(t.x=this.x/e,t.y=this.y/e,t.z=this.z/e):(t.x=this.x,t.y=this.y,t.z=this.z)}scaleVector(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}scaleBy(t){this.x*=t,this.y*=t,this.z*=t}negate(){this.x=-this.x,this.y=-this.y,this.z=-this.z}equalsXYZ(t){return Math.abs(this.x-t.x)<i.default.MATH_MIN_POSITIVE&&Math.abs(this.y-t.y)<i.default.MATH_MIN_POSITIVE&&Math.abs(this.z-t.z)<i.default.MATH_MIN_POSITIVE}equalsAll(t){return Math.abs(this.x-t.x)<i.default.MATH_MIN_POSITIVE&&Math.abs(this.y-t.y)<i.default.MATH_MIN_POSITIVE&&Math.abs(this.z-t.z)<i.default.MATH_MIN_POSITIVE&&Math.abs(this.w-t.w)<i.default.MATH_MIN_POSITIVE}project(){let t=1/this.w;this.x*=t,this.y*=t,this.z*=t}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getLengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}addBy(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}subtractBy(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}subtract(t){return new r(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new r(this.x+t.x,this.y+t.y,this.z+t.z)}crossProduct(t){return new r(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}crossBy(t){let e=this.y*t.z-this.z*t.y,s=this.z*t.x-this.x*t.z,i=this.x*t.y-this.y*t.x;this.x=e,this.y=s,this.z=i}reflectBy(t){let e=2*(this.x*t.x+this.y*t.y+this.z*t.z);this.x=this.x-e*t.x,this.y=this.y-e*t.y,this.z=this.z-e*t.z}scaleVecTo(t,e){this.x=t.x*e,this.y=t.y*e,this.z=t.z*e}subVecsTo(t,e){this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z}addVecsTo(t,e){this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z}crossVecsTo(t,e){this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x}toString(){return"[Vector3D(x="+this.x+", y="+this.y+",z="+this.z+",w="+this.w+")]"}static Cross(t,e,s){s.x=t.y*e.z-t.z*e.y,s.y=t.z*e.x-t.x*e.z,s.z=t.x*e.y-t.y*e.x}static CrossSubtract(t,e,s,i,a){r.__vtor3Stv0.x=e.x-t.x,r.__vtor3Stv0.y=e.y-t.y,r.__vtor3Stv0.z=e.z-t.z,r.__vtor3Stv1.x=i.x-s.x,r.__vtor3Stv1.y=i.y-s.y,r.__vtor3Stv1.z=i.z-s.z,t=r.__vtor3Stv0,s=r.__vtor3Stv1,a.x=t.y*s.z-t.z*s.y,a.y=t.z*s.x-t.x*s.z,a.z=t.x*s.y-t.y*s.x}static Subtract(t,e,s){s.x=t.x-e.x,s.y=t.y-e.y,s.z=t.z-e.z}static DistanceSquared(t,e){return r.__vtor3Stv0.x=t.x-e.x,r.__vtor3Stv0.y=t.y-e.y,r.__vtor3Stv0.z=t.z-e.z,r.__vtor3Stv0.getLengthSquared()}static DistanceXYZ(t,e,s,i,a,h){return r.__vtor3Stv0.x=t-i,r.__vtor3Stv0.y=e-a,r.__vtor3Stv0.z=s-h,r.__vtor3Stv0.getLength()}static Distance(t,e){return r.__vtor3Stv0.x=t.x-e.x,r.__vtor3Stv0.y=t.y-e.y,r.__vtor3Stv0.z=t.z-e.z,r.__vtor3Stv0.getLength()}static AngleBetween(t,e){return t.normalizeTo(r.__vtor3Stv0),e.normalizeTo(r.__vtor3Stv1),Math.acos(r.__vtor3Stv0.dot(r.__vtor3Stv1))*i.default.MATH_180_OVER_PI}static RadianBetween(t,e){return t.normalizeTo(r.__vtor3Stv0),e.normalizeTo(r.__vtor3Stv1),Math.acos(r.__vtor3Stv0.dot(r.__vtor3Stv1))}static RadianBetween2(t,e){let s=t.getLengthSquared(),i=e.getLengthSquared();return r.__vtor3Stv0.x=t.x-e.x,r.__vtor3Stv0.y=t.y-e.y,r.__vtor3Stv0.z=t.z-e.z,Math.acos((s+i-r.__vtor3Stv0.getLengthSquared())/(2*Math.sqrt(s)*Math.sqrt(i)))}static Reflect(t,e,s){let i=2*(t.x*e.x+t.y*e.y+t.z*e.z);s.x=t.x-i*e.x,s.y=t.y-i*e.y,s.z=t.z-i*e.z}}r.X_AXIS=new r(1,0,0),r.Y_AXIS=new r(0,1,0),r.Z_AXIS=new r(0,0,1),r.__vtor3Stv0=new r,r.__vtor3Stv1=new r,r.ZERO=new r,e.default=r},9156:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetTransUniform(t,e){i.s_transMap.set(t.getUid(),e)}static GetTransUniform(t){if(t.getUid()<0)throw Error("mat.getUid() < 0");return i.s_transMap.get(t.getUid())}static HasTransUniform(t){return i.s_transMap.has(t.getUid())}static RemoveTransUniform(t){i.s_transMap.delete(t.getUid())}}i.s_transMap=new Map,e.default=i},"919c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_uid=0,this.m_mid=0,this.m_vtxUid=0,this.m_rc=null,this.ibuf=null,this.ibufStep=2,this.m_attachCount=0}setRC(t){this.m_rc=t}setMidAndBufUid(t,e){this.m_mid=t,this.m_vtxUid=e,this.m_attachCount=0}getUid(){return this.m_uid}getVtxUid(){return this.m_vtxUid}getMid(){return this.m_mid}run(){}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}__$destroy(){i.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.ibuf=null,this.m_rc=null}restoreThis(){}static HasMid(t){return i.s_midMap.has(t)}static GetByMid(t){return i.s_midMap.get(t)}}i.s_midMap=new Map,e.default=i},"91e2":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8e17"),r=s("29ef"),a=s("402a"),h=s("f63e"),n=s("8a0a"),l=s("3bfb");class _ extends a.default{constructor(t=null){super(t),this.normalScale=1,this.m_normalType=n.VtxNormalType.FLAT,this.m_minV=null,this.m_maxV=null,this.m_transMatrix=null,this.m_currMesh=null}setVtxTransformMatrix(t){this.m_transMatrix=t}useFlatNormal(){this.m_normalType=n.VtxNormalType.FLAT}useGourandNormal(){this.m_normalType=n.VtxNormalType.GOURAND}createMaterial(t){if(null==this.getMaterial()){let e=new h.default;e.setTextureList(t),this.setMaterial(e)}else this.getMaterial().setTextureList(t)}showBackFace(){this.setRenderState(r.default.FRONT_CULLFACE_NORMAL_STATE)}showFrontFace(){this.setRenderState(r.default.NORMAL_STATE)}scaleUVFaceAt(t,e,s,i,r){let a=this.getMesh();null!=a&&a.scaleUVFaceAt(t,e,s,i,r)}reinitializeMesh(){null!=this.m_currMesh&&this.m_currMesh.reinitialize()}initialize(t,e,s=null){this.m_minV=t,this.m_maxV=e,this.createMaterial(s),this.activeDisplay()}initializeCube(t,e=null){t*=.5,this.m_minV=new i.default(-t,-t,-t),this.m_maxV=new i.default(t,t,t),this.createMaterial(e),this.activeDisplay()}initializeSizeXYZ(t,e,s,r=null){this.m_minV=new i.default(.5*-t,.5*-e,.5*-s),this.m_maxV=new i.default(.5*t,.5*e,.5*s),this.createMaterial(r),this.activeDisplay()}__activeMesh(t){if(this.m_currMesh=this.getMesh(),null==this.m_currMesh&&(this.m_currMesh=new l.default),null!=this.m_currMesh){let e=this.m_currMesh;null!=this.m_transMatrix&&e.setTransformMatrix(this.m_transMatrix),e.normalType=this.m_normalType,e.normalScale=this.normalScale,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.m_minV,this.m_maxV),this.m_minV=null,this.m_maxV=null,this.setMesh(e),e.setTransformMatrix(null)}this.m_transMatrix=null}updateMesh(){this.m_currMesh=this.getMesh()}setFaceUVSAt(t,e){null!=this.m_currMesh&&this.m_currMesh.setFaceUVSAt(e,t)}transformFaceAt(t,e){null!=this.m_currMesh&&this.m_currMesh.transformFaceAt(t,e)}getFaceCenterAt(t,e){null!=this.m_currMesh&&this.m_currMesh.getFaceCenterAt(t,e)}toString(){return"[Box3DEntity(uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=_},9260:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("7045");class r{static KeyDown(t){for(var e=r.m_down_listener.length,s=0;s<e;++s)r.m_down_listener[s].call(r.m_down_ers[s],t)}static KeyUp(t){let e=r.m_up_listener.length;for(let s=0;s<e;++s)r.m_up_listener[s].call(r.m_up_ers[s],t)}static RemoveEventListener(t,e){if(null!=e){let s;switch(t){case i.default.KEY_DOWN:for(s=r.m_down_listener.length-1;s>=0;--s)if(e===r.m_down_listener[s]){r.m_down_ers.splice(s,1),r.m_down_listener.splice(s,1);break}break;case i.default.KEY_UP:for(s=r.m_up_listener.length-1;s>=0;--s)if(e===r.m_up_listener[s]){r.m_up_ers.splice(s,1),r.m_up_listener.splice(s,1);break}break;default:break}}}}r.m_down_ers=[],r.m_down_listener=[],r.m_up_ers=[],r.m_up_listener=[],r.AddEventListener=function(t,e,s){if(null!=s){let a=0;switch(t){case i.default.KEY_DOWN:for(a=r.m_down_listener.length-1;a>=0;--a)if(s===r.m_down_listener[a])break;a<0&&(r.m_down_ers.push(e),r.m_down_listener.push(s));break;case i.default.KEY_UP:for(a=r.m_up_listener.length-1;a>=0;--a)if(s===r.m_up_listener[a])break;a<0&&(r.m_up_ers.push(e),r.m_up_listener.push(s));break;default:break}}},e.default=r},"955e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("6e01"),r=s("8e17"),a=s("fecb"),h=s("c120"),n=s("e08e"),l=s("29ef"),_=s("3930"),o=s("e7ce");class m{constructor(){this.m_initColor=new _.default,this.m_indexMaterial=new o.default,this.m_renderer=null,this.m_camera=null,this.m_headNode=null,this.m_rsn=null,this.m_hitList=new Uint8Array(256),this.m_rsnList=null,this.m_selectedNode=null,this.m_selectedTotal=0,this.m_testMode=0,this.m_invpv=new r.default,this.m_invtv=new r.default,this.m_rlpv=null,this.m_rltv=null,this.m_rlsiv=new Uint8Array(4),this.m_rlinvtv=new r.default,this.m_outv=new r.default,this.m_vecs=[null,null],this.m_gpuTestEnabled=!0,this.m_uintArray=new Uint8Array(4),this.m_uintList=new Uint8Array(256)}setRenderer(t){this.m_renderer=t}setRayTestMode(t){this.m_testMode=t}setRay(t,e){this.m_rlpv=t,this.m_rltv=e}getRay(t,e){t.copyFrom(this.m_rlpv),e.copyFrom(this.m_rltv)}setCamera(t){this.m_camera=t}setCullingNodeHead(t){if(this.m_headNode=t,null==this.m_rsnList){this.m_rsnList=[];let t=0;for(;t<256;++t)this.m_rsnList.push(new h.default)}}getSelectedNode(){return this.m_selectedNode}getSelectedNodes(){return this.m_rsnList}getSelectedNodesTotal(){return this.m_selectedTotal}sorting(t,e){let s=this.m_rsnList;this.m_rsn=s[t];while(t<e){while(t<e&&s[e].dis>=this.m_rsn.dis)--e;s[t]=s[e];while(t<e&&s[t].dis<=this.m_rsn.dis)++t;s[e]=s[t]}return s[t]=this.m_rsn,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}run(){let t=this.m_headNode;if(null!=t){let e=0,s=this.m_rltv,r=this.m_rlpv,h=this.m_outv,n=null,l=0;Math.abs(s.x)>i.default.MATH_MIN_POSITIVE?this.m_rlinvtv.x=1/s.x:this.m_rlinvtv.x=i.default.MATH_MAX_POSITIVE,Math.abs(s.y)>i.default.MATH_MIN_POSITIVE?this.m_rlinvtv.y=1/s.y:this.m_rlinvtv.y=i.default.MATH_MAX_POSITIVE,Math.abs(s.z)>i.default.MATH_MIN_POSITIVE?this.m_rlinvtv.z=1/s.z:this.m_rlinvtv.z=i.default.MATH_MAX_POSITIVE,this.m_rlinvtv.x<0?this.m_rlsiv[0]=1:this.m_rlsiv[0]=0,this.m_rlinvtv.y<0?this.m_rlsiv[1]=1:this.m_rlsiv[1]=0,this.m_rlinvtv.z<0?this.m_rlsiv[2]=1:this.m_rlsiv[2]=0;while(null!=t)t.drawEnabled&&t.entity.mouseEnabled&&(h.x=t.bounds.center.x-r.x,h.y=t.bounds.center.y-r.y,h.z=t.bounds.center.z-r.z,e=h.dot(s),h.x-=e*s.x,h.y-=e*s.y,h.z-=e*s.z,h.getLengthSquared()<=t.bounds.radius2&&t.rayTestState<1&&(this.m_vecs[0]=t.bounds.min,this.m_vecs[1]=t.bounds.max,a.default.IntersectionRL3(this.m_vecs,this.m_rlsiv,this.m_rlinvtv,s,r,h)&&(n=this.m_rsnList[l],n.entity=t.entity,n.dis=this.m_rlinvtv.w,n.wpv.copyFrom(h),++l))),t=t.next;this.m_selectedNode=null;let _=0;if(l>0){let t=this.m_invpv,e=this.m_invtv,i=null,a=0,n=0,o=null,m=null,u=s.dot(r),d=0,c=!this.m_gpuTestEnabled,f=0;if(l>1){for(this.snsort(0,l-1),_=0;_<l;++_){if(m=this.m_rsnList[_],i=this.m_rsnList[_].entity,i.isPolyhedral()?c?(o=i.getInvMatrix(),o.transformOutVector3(r,t),o.deltaTransformOutVector(s,e),a=i.testRay(t,e,h,!0)):(++f,a=0):(o=i.getInvMatrix(),o.transformOutVector3(r,t),o.deltaTransformOutVector(s,e),a=i.testRay(t,e,h,!0)),a>0){if(m.lpv.copyFrom(h),i.getMatrix().transformOutVector3(h,m.wpv),m.dis=s.dot(m.wpv)-u,this.m_hitList[n]=_,++n,m.dis>d){this.m_selectedNode=m;break}}else if(a<0&&(this.m_hitList[n]=_,++n,m.dis>d)){this.m_selectedNode=m;break}d=m.dis}null==this.m_selectedNode&&n>0&&(this.m_selectedNode=this.m_rsnList[this.m_hitList[0]])}else m=this.m_rsnList[0],i=this.m_rsnList[0].entity,o=i.getInvMatrix(),o.transformOutVector3(r,t),o.deltaTransformOutVector(s,e),i.isPolyhedral()?c?a=i.testRay(t,e,h,!0):(++f,a=0):a=i.testRay(t,e,h,!0),a>0?(m.lpv.copyFrom(h),i.getMatrix().transformOutVector3(h,m.wpv),m.dis=s.dot(m.wpv)-u,this.m_selectedNode=m):a<0&&(this.m_selectedNode=m);f>0&&(this.m_testMode<1||null==this.m_selectedNode||this.m_selectedNode.entity.isPolyhedral())&&this.gpuPick(l)}for(_=l;_<this.m_selectedTotal;++_)this.m_selectedNode!=this.m_rsnList[_]&&(this.m_rsnList[_].entity=null);this.m_selectedTotal=l}}gpuPick(t){let e=this.m_renderer.getRenderProxy(),s=e.getStage3D().mouseX,i=e.getStage3D().mouseY;e.Vertex.renderBegin(),e.getClearRGBAColor4f(this.m_initColor),e.setClearRGBAColor4f(0,0,0,0),e.setScissorEnabled(!0),e.setScissorRect(s,i,1,1),e.clearRenderBuffer(),this.m_uintArray[3]=0,l.default.LockBlendMode(n.RenderBlendMode.OPAQUE),l.default.LockDepthTestMode(n.DepthTestMode.RENDER_OPAQUE);let r=this.m_renderer.getRendererContext();r.unlockMaterial(),r.unlockRenderState(),r.useGlobalMaterial(this.m_indexMaterial);let a=null,h=null,_=-1,o=0;for(;o<t;++o)a=this.m_rsnList[o],h=this.m_rsnList[o].entity,h.isPolyhedral()&&(++_,this.m_indexMaterial.setIndex(_+2),this.m_uintList[_]=o,this.m_renderer.updateMaterialUniformToCurrentShd(this.m_indexMaterial),this.m_renderer.drawEntityByLockMaterial(h));if(_>-1&&e.readPixels(s,i,1,1,e.RGBA,e.UNSIGNED_BYTE,this.m_uintArray),l.default.UnlockBlendMode(),l.default.UnlockDepthTestMode(),this.m_uintArray[3]>1){o=this.m_uintList[this.m_uintArray[3]-2],a=this.m_rsnList[o];let t=(this.m_uintArray[0]<<8)+this.m_uintArray[1]+this.m_uintArray[2]/255;if(null!=this.m_selectedNode){let e=this.m_selectedNode.entity;this.m_selectedNode==a||e.isPolyhedral()||this.m_selectedNode.dis<t&&(o=-1)}o>-1&&(a.dis=t,this.getWorldPosByRayDistance(t,this.m_rltv,this.m_camera.getPosition(),a.wpv),this.m_selectedNode=a)}e.setScissorEnabled(!1),r.unlockMaterial(),r.unlockRenderState(),l.default.UnlockBlendMode(),l.default.UnlockDepthTestMode(),e.setClearRGBAColor4f(this.m_initColor.r,this.m_initColor.g,this.m_initColor.b,this.m_initColor.a)}getWorldPosByRayDistance(t,e,s,i){i.x=e.x*t+s.x,i.y=e.y*t+s.y,i.z=e.z*t+s.z}}e.default=m},9666:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("352a"),r=s("acfe");class a{static CreateShdData(t,e,s){if(a.s_shdDataDict.has(t))return a.s_shdDataDict.get(t);let h=new r.default;return h.initialize(t,e,s),a.s_shdDataList[h.getUid()]=h,++a.s_shdDataListLen,a.s_shdDataDict.set(t,h),i.default.SHADERCODE_TRACE_ENABLED&&console.log("MaterialResource.Create() a new ShaderProgram: ",h.toString()),h}static FindData(t){return a.s_shdDataDict.has(t)?a.s_shdDataDict.get(t):null}}a.s_shdDataDict=new Map,a.s_shdDataList=[],a.s_shdDataListLen=0,e.default=a},"984e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.width=0,this.height=0,this.depth=0,this.sampler=0,this.texBuf=null,this.m_attachCount=0}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}bindToGpu(t){t.bindTexture(this.sampler,this.texBuf)}getAttachCount(){return this.m_attachCount}}class r{constructor(t,e){this.m_resMap=new Map,this.m_freeMap=new Map,this.m_texResTotal=0,this.m_attachTotal=0,this.m_delay=128,this.m_rcuid=0,this.m_gl=null,this.texMid=-1,this.unlocked=!0,this.m_rcuid=t,this.m_gl=e}createBuf(){return this.m_gl.createTexture()}createResByParams3(t,e,s,r){if(!this.m_resMap.has(t)){let a=new i;return a.rcuid=this.getRCUid(),a.resUid=t,a.width=e,a.height=s,a.sampler=r,a.texBuf=this.createBuf(),this.addTextureRes(a),!0}return!1}getRCUid(){return this.m_rcuid}getRC(){return this.m_gl}hasResUid(t){return this.m_resMap.has(t)}renderBegin(){this.texMid=-1}getTextureResTotal(){return this.m_texResTotal}addTextureRes(t){this.m_resMap.has(t.resUid)||(t.waitDelTimes=0,this.m_resMap.set(t.resUid,t),this.m_texResTotal++)}getGpuBuffer(t){return this.m_resMap.has(t)?this.m_resMap.get(t).texBuf:null}bindToGpu(t){this.m_resMap.has(t)&&this.m_resMap.get(t).bindToGpu(this.m_gl)}getAttachTotal(){return this.m_attachTotal}__$attachRes(t){if(this.m_resMap.has(t)){this.m_attachTotal++;let e=this.m_resMap.get(t);e.getAttachCount()<1&&this.m_freeMap.has(t)&&this.m_freeMap.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.m_resMap.has(t)&&this.m_resMap.has(t)){let e=this.m_resMap.get(t);e.getAttachCount()>0&&(this.m_attachTotal--,e.__$detachThis(),e.getAttachCount()<1&&this.m_freeMap.set(t,e))}}update(){if(this.m_delay--,this.m_delay<1){this.m_delay=128;for(const[t,e]of this.m_freeMap)e.waitDelTimes++,e.waitDelTimes>5&&(this.m_resMap.delete(e.resUid),this.m_freeMap.delete(e.resUid),this.m_gl.deleteTexture(e.texBuf),e.texBuf=null,this.m_texResTotal--)}}}e.default=r},"9c3c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8e17"),r=s("38de"),a=s("fecb"),h=s("8a0a"),n=s("cb29"),l=s("e7d2"),_=s("e08e");class o extends n.default{constructor(t=h.default.VTX_STATIC_DRAW){super(t),this.m_vs=null,this.m_cvs=null,this.m_lsTotal=0,this.rayTestRadius=2}getVS(){return this.m_vs}getCVS(){return this.m_vs}initialize(t,e){t.length>=6&&(this.vtCount=Math.floor(t.length/3),this.m_lsTotal=Math.floor(this.vtCount/2),this.m_vs=new Float32Array(t),this.bounds=new a.default,this.bounds.addXYZFloat32Arr(this.m_vs),this.bounds.updateFast(),l.default.Reset(),l.default.AddFloat32Data(this.m_vs,3),this.isVBufEnabledAt(h.default.VBUF_CVS_INDEX)&&(this.m_cvs=new Float32Array(e),l.default.AddFloat32Data(this.m_cvs,3)),l.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.m_vbuf=l.default.CreateBySaveData(this.getBufDataUsage()),this.drawMode=_.RenderDrawMode.ARRAYS_LINES,this.buildEnd())}setVSXYZAt(t,e,s,i){null!=this.m_vbuf&&this.m_vbuf.setData3fAt(t,0,e,s,i)}toString(){return"DashedLineMesh()"}isPolyhedral(){return!1}testRay(t,e,s,i){let a=0,h=this.m_vs,n=0,l=this.rayTestRadius;for(let _=0;_<this.m_lsTotal;++_){if(o.s_pv0.setXYZ(h[a],h[a+1],h[a+2]),o.s_pv1.setXYZ(h[a+3],h[a+4],h[a+5]),n=r.default.IntersectionLS(t,e,o.s_pv0,o.s_pv1,s,l),n>0)return 1;a+=6}return 0}__$destroy(){this.isResFree()&&(this.bounds=null,this.m_vs=null,this.m_cvs=null,super.__$destroy())}}o.s_pv0=new i.default,o.s_pv1=new i.default,e.default=o},"9c4d":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.prev=null,this.next=null,this.flag=0,this.target=null}reset(){this.flag=0,this.target=null}}class r{constructor(){this.m_begin=null,this.m_end=null}destroy(){this.clear()}clear(){this.m_begin=this.m_end=null}getBegin(){return this.m_begin}isEmpty(){return this.m_begin==this.m_end&&null==this.m_end}addNode(t){null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null}removeNode(t){t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}class a{constructor(){this.m_linker=new r,this.m_freeIds=[],this.m_runners=[new i]}getFreeId(){if(this.m_freeIds.length>0)return this.m_freeIds.pop();let t=new i;return t.flag=this.m_runners.length,this.m_runners.push(t),t.flag}addRunner(t){if(null!=t&&t.getRunFlag()<1){let e=this.getFreeId(),s=this.m_runners[e];s.flag=e,s.target=t,t.setRunFlag(e),this.m_linker.addNode(s)}}removeRunner(t){if(null!=t&&t.getRunFlag()>0){let e=t.getRunFlag();this.m_freeIds.push(e);let s=this.m_runners[e];s.flag=e,s.target=null,t.setRunFlag(0),this.m_linker.removeNode(s)}}run(){let t=this.m_linker.getBegin(),e=t;while(null!=e)t=e,e=t.next,t.target.isRunning()&&t.target.run()}}e.default=a},"9d26":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8e17"),r=s("352a"),a=s("e08e"),h=s("29ef"),n=s("c497"),l=s("5336"),_=s("1710"),o=s("a996"),m=s("7045"),u=s("b161"),d=s("bd6f"),c=s("b9b5"),f=s("91e2"),p=s("b8ff"),g=s("c8c5"),x=s("f63b"),T=s("0644"),E=s("e9d3"),y=s("a905"),v=s("3930"),S=s("e943");class R extends E.default{constructor(){super(),this.m_color=new v.default}setRGB3f(t,e,s){if(this.m_color.setRGB3f(t,e,s),null!=this.m_targetEntity){let i=this.m_targetEntity.getMaterial();i.setRGB3f(t,e,s)}}mouseOverListener(t){if(null!=this.m_targetEntity){let t=this.m_targetEntity.getMaterial();t.setRGB3f(1,0,0)}}mouseOutListener(t){if(null!=this.m_targetEntity){let t=this.m_targetEntity.getMaterial();t.setRGB3f(this.m_color.r,this.m_color.g,this.m_color.b)}}}class b{constructor(){this.m_rendererScene=null}initialize(t,e){this.m_rendererScene=t,this.m_texLoader=e;let s=this.m_texLoader.getTexByUrl("static/assets/default.jpg"),r=this.m_texLoader.getTexByUrl("static/assets/broken_iron.jpg"),a=new g.default;a.showDoubleFace(!0,!1),a.initialize(-1,-1,2,2),a.getMaterial().setRGB3f(.3*Math.random(),.3*Math.random(),.3*Math.random()),t.addEntity(a);let h=new c.default;h.name="axis",h.initialize(600),t.addEntity(h,1);let n,l,_=0;for(_=0;_<1;++_)n=new f.default,n.name="box_"+_,n.initialize(new i.default(-150,-150,-150),new i.default(150,150,15),[r]),n.setXYZ(1e3*Math.random()-500,1e3*Math.random()-500,1e3*Math.random()-500),t.addEntity(n,1),this.useEvt(n);for(_=0;_<1;++_)l=new p.default,l.name="sphere_"+_,l.initialize(110,15,15,[s]),l.setXYZ(1e3*Math.random()-500,1e3*Math.random()-500,1e3*Math.random()-500),t.addEntity(l,1),this.useEvt(l)}useEvt(t){let e=new y.default;e.bindTarget(t)}}class A{constructor(){this.m_rendererScene=null}initialize(t,e){this.m_rendererScene=t,this.m_texLoader=e;let s=this.m_texLoader.getTexByUrl("static/assets/broken_iron.jpg"),r=this.m_texLoader.getTexByUrl("static/assets/warter_01.jpg"),a=new g.default;a.showDoubleFace(!0,!1),a.initialize(-1,-1,2,2),a.getMaterial().setRGB3f(.3*Math.random(),.3*Math.random(),.3*Math.random()),t.addEntity(a);let h=new c.default;h.initialize(600),this.m_rendererScene.addEntity(h,1);let n,l,_=0,o=Math.round(4*Math.random())+1;for(_=0;_<o;++_)n=new f.default,n.name="box_"+_,n.initialize(new i.default(-50,-50,-50),new i.default(50,50,5),[r]),n.setXYZ(1e3*Math.random()-500,1e3*Math.random()-500,1e3*Math.random()-500),this.m_rendererScene.addEntity(n,1),this.useEvt(n);for(o=Math.round(4*Math.random())+1,_=0;_<o;++_)l=new p.default,l.name="sphere_"+_,l.initialize(110,15,15,[s]),l.setXYZ(1e3*Math.random()-500,1e3*Math.random()-500,1e3*Math.random()-500),this.m_rendererScene.addEntity(l,1),this.useEvt(l)}useEvt(t){let e=new y.default;e.bindTarget(t)}}class L{constructor(){this.m_rendererScene=null}initialize(t,e){this.m_rendererScene=t,this.m_texLoader=e;let s=this.m_texLoader.getTexByUrl("static/assets/broken_iron.jpg"),r=this.m_texLoader.getTexByUrl("static/assets/warter_01.jpg"),a=new c.default;a.initialize(600),this.m_rendererScene.addEntity(a);let h,n,l=0,_=Math.round(4*Math.random())+1;for(l=0;l<_;++l)h=new f.default,h.name="box_"+l,h.initialize(new i.default(-50,-50,-50),new i.default(50,50,5),[r]),h.setXYZ(1e3*Math.random()-500,1e3*Math.random()-500,1e3*Math.random()-500),this.m_rendererScene.addEntity(h),this.useEvt(h);for(l=0;l<_;++l)n=new p.default,n.name="sphere_"+l,n.initialize(110,15,15,[s]),n.setXYZ(1e3*Math.random()-500,1e3*Math.random()-500,1e3*Math.random()-500),this.m_rendererScene.addEntity(n),this.useEvt(n)}useEvt(t){let e=new y.default;e.bindTarget(t)}}class D{constructor(){this.m_rendererScene=null,this.m_mainRScene=null,this.m_stage3D=null,this.targetAxis=null,this.horizontalDivision=null,this.leftVerticalDivision=null}initialize(t,e,s){this.m_mainRScene=t,this.m_rendererScene=e,this.m_texLoader=s;let i=this.m_texLoader.getTexByUrl("static/assets/caustics_02.jpg"),r=this.m_texLoader.getTexByUrl("static/assets/white.jpg"),a=this.m_rendererScene.getStage3D();this.m_stage3D=a;let h,n=Math.round(a.stageWidth*(.2+.6*Math.random())),l=Math.round(a.stageHeight*(.2+.6*Math.random()));h=new d.default,h.initializeXOY(0,0,4,100,[r]),h.setScaleXYZ(1,a.stageHeight/100,1),h.setXYZ(n,0,0),this.m_rendererScene.addEntity(h),this.horizontalDivision=this.useDragXEvt(h),this.horizontalDivision.setRGB3f(.8,.8,.8),this.horizontalDivision.dragController.lockX(50,a.stageWidth-50),h=new d.default,h.initializeXOY(0,0,100,4,[r]),h.setScaleXYZ(n/100,1,1),h.setXYZ(0,l,0),this.m_rendererScene.addEntity(h),this.leftVerticalDivision=this.useDragXEvt(h),this.leftVerticalDivision.setRGB3f(.5,.5,.8),this.leftVerticalDivision.dragController.lockY(50,a.stageHeight-50);let _,o=new c.default;o.initializeCross(100),o.setXYZ(100,100,0),this.m_rendererScene.addEntity(o),this.targetAxis=o;let m=0;for(n-=100,m=0;m<1;++m)_=new d.default,_.toBrightnessBlend(!0,!1),_.initializeXOY(0,0,200,150,[i]),_.setXYZ(n+300*m,150,0),this.m_rendererScene.addEntity(_),this.useDragEvt(_)}useDragEvt(t){let e=new R;e.setStage3D(this.m_stage3D),e.bindTarget(t),this.m_mainRScene.runnableQueue.addRunner(e)}useDragXEvt(t){let e=new R;return e.setStage3D(this.m_stage3D),e.bindTarget(t),this.m_mainRScene.runnableQueue.addRunner(e),e}}class M{constructor(){this.m_uid=M.s_uid++,this.m_rendererScene=null,this.m_rendererLeftTopScene=null,this.m_rendererLeftBottomScene=null,this.m_rendererRightScene=null,this.m_rendererUIScene=null,this.m_letfTopCamTrack=null,this.m_leftBottomCamTrack=null,this.m_rightCamTrack=null,this.m_statusDisp=new l.default,this.m_stage3D=null,this.m_leftScene=new b,this.m_leftBottomScene=new A,this.m_rightScene=new L,this.m_uiScene=new D,this.m_div=null,this.m_pos=new i.default}initialize(t=null){if(console.log("DemoMultiRendererScene2::initialize()......, div: ",t),null==this.m_rendererScene){let e;r.default.SHADERCODE_TRACE_ENABLED=!0,this.m_div=t,e=new n.default(t),e.autoSyncRenderBufferAndWindowSize=null==t,e.setCamProject(45,.1,5e3),e.setCamPosition(1500,1500,1500),this.m_rendererScene=new u.default,this.m_rendererScene.initialize(e),this.m_rendererScene.enableMouseEvent(!0),this.m_stage3D=this.m_rendererScene.getStage3D(),this.m_profileInstance=new S.default,null!=this.m_profileInstance&&this.m_profileInstance.initialize(this.m_rendererScene.getRenderer()),this.m_texLoader=new x.default(this.m_rendererScene.textureBlock),this.m_rendererScene.setClearRGBColor3f(.3*Math.random(),.3*Math.random(),.3*Math.random()),this.m_statusDisp.initialize("rstatus",this.m_stage3D.viewWidth-180),this.m_rendererLeftTopScene=this.m_rendererScene,e=new n.default,e.setCamProject(45,.1,5e3),e.setCamPosition(1500,1500,1200),this.m_rendererRightScene=this.m_rendererScene.createSubScene(),this.m_rendererRightScene.initialize(e),this.m_rendererRightScene.enableMouseEvent(!0),e=new n.default,e.setCamProject(45,.1,5e3),e.setCamPosition(1500,1500,1200),this.m_rendererLeftBottomScene=this.m_rendererScene.createSubScene(),this.m_rendererLeftBottomScene.initialize(e),this.m_rendererLeftBottomScene.enableMouseEvent(!0),e=new n.default,e.cameraPerspectiveEnabled=!1,e.setCamProject(45,.1,3e3),e.setCamPosition(0,0,1500),this.m_rendererUIScene=this.m_rendererScene.createSubScene(),this.m_rendererUIScene.initialize(e),this.m_rendererUIScene.enableMouseEvent(!0),this.m_rendererUIScene.getCamera().translationXYZ(this.m_stage3D.stageHalfWidth,this.m_stage3D.stageHalfHeight,1500),this.m_rendererUIScene.getCamera().update(),this.m_rendererScene.addEventListener(_.default.MOUSE_DOWN,this,this.mouseDownListener),this.m_rendererScene.addEventListener(_.default.MOUSE_UP,this,this.mouseUpListener),this.m_rendererScene.addEventListener(o.default.RESIZE,this,this.resizeListener),this.m_rendererScene.addEventListener(_.default.MOUSE_WHEEL,this,this.mouseWheeelListener),this.m_rendererScene.addEventListener(m.default.KEY_DOWN,this,this.keyDownListener),this.m_rendererScene.addEventListener(m.default.KEY_UP,this,this.keyUpListener),this.m_letfTopCamTrack=new T.default,this.m_letfTopCamTrack.bindCamera(this.m_rendererLeftTopScene.getCamera()),this.m_leftBottomCamTrack=new T.default,this.m_leftBottomCamTrack.bindCamera(this.m_rendererLeftBottomScene.getCamera()),this.m_rightCamTrack=new T.default,this.m_rightCamTrack.bindCamera(this.m_rendererRightScene.getCamera()),h.default.CreateRenderState("ADD01",a.CullFaceMode.BACK,a.RenderBlendMode.ADD,a.DepthTestMode.RENDER_BLEND),h.default.CreateRenderState("ADD02",a.CullFaceMode.BACK,a.RenderBlendMode.ADD,a.DepthTestMode.RENDER_ALWAYS),this.m_leftScene.initialize(this.m_rendererLeftTopScene,this.m_texLoader),this.m_leftBottomScene.initialize(this.m_rendererLeftBottomScene,this.m_texLoader),this.m_rightScene.initialize(this.m_rendererRightScene,this.m_texLoader),this.m_uiScene.initialize(this.m_rendererScene,this.m_rendererUIScene,this.m_texLoader)}}keyDownListener(t){console.log("keyDownListener call, key: "+t.key+",repeat: "+t.repeat)}keyUpListener(t){switch(console.log("keyUpListener call, key: "+t.key+",repeat: "+t.repeat),t.key){case"z":console.log("reset cam lookAt."),this.m_rendererLeftTopScene.getCamera().lookAtRH(new i.default(1500,1500,1500),new i.default,new i.default(0,1,0));break}}mouseDownListener(t){this.m_uiScene.targetAxis.setXYZ(t.mouseX,t.mouseY,0),this.m_uiScene.targetAxis.update()}mouseUpListener(t){}resizeListener(t){this.m_rendererLeftTopScene.setViewPort(0,0,this.m_stage3D.stageWidth,this.m_stage3D.stageHeight),this.m_rendererUIScene.setViewPort(0,0,this.m_stage3D.stageWidth,this.m_stage3D.stageHeight),this.m_rendererUIScene.getCamera().translationXYZ(this.m_stage3D.stageHalfWidth,this.m_stage3D.stageHalfHeight,1500)}mouseWheeelListener(t){t.wheelDeltaY<0?this.m_rendererLeftTopScene.getCamera().forward(-25):this.m_rendererLeftTopScene.getCamera().forward(25)}run(){null==this.m_div&&this.m_statusDisp.update(),this.m_uiScene.horizontalDivision.getPosition(this.m_pos),this.m_uiScene.leftVerticalDivision.setScaleXYZ(this.m_pos.x/100,1,1),this.m_uiScene.leftVerticalDivision.updateTargetEntity();let t=this.m_pos.x,e=0;e=e>=0?e:0,this.m_uiScene.leftVerticalDivision.getPosition(this.m_pos);let s=this.m_pos.y,i=0;i=i>=0?i:0;let r=t-e,a=s-i;this.m_rendererLeftTopScene.setViewPort(e,a,r,this.m_stage3D.stageHeight-a),this.m_rendererLeftBottomScene.setViewPort(e,i,r,a),this.m_rendererRightScene.setViewPort(t,0,this.m_stage3D.stageWidth-r,this.m_stage3D.stageHeight);let h=!0;this.m_rendererUIScene.runBegin(!0,!0),this.m_rendererUIScene.update(!1,!0),h=this.m_rendererUIScene.isRayPickSelected(),this.m_rendererLeftTopScene.runBegin(!1),this.m_rendererLeftTopScene.update(!1,!h),h=h||this.m_rendererLeftTopScene.isRayPickSelected(),this.m_rendererLeftBottomScene.runBegin(!1),this.m_rendererLeftBottomScene.update(!1,!h),h=h||this.m_rendererLeftBottomScene.isRayPickSelected(),this.m_rendererRightScene.runBegin(!0),this.m_rendererRightScene.update(!1,!h),this.m_rendererLeftTopScene.renderBegin(),this.m_rendererLeftTopScene.run(!1),this.m_rendererLeftTopScene.runEnd(),this.m_rendererLeftBottomScene.renderBegin(),this.m_rendererLeftBottomScene.run(!1),this.m_rendererLeftBottomScene.runEnd(),this.m_rendererRightScene.renderBegin(),this.m_rendererRightScene.run(!1),this.m_rendererRightScene.runEnd(),this.m_rendererUIScene.renderBegin(),this.m_rendererUIScene.run(!1),this.m_rendererUIScene.runEnd(),this.m_letfTopCamTrack.rotationOffsetAngleWorldY(-.2),this.m_leftBottomCamTrack.rotationOffsetAngleWorldY(.1),this.m_rightCamTrack.rotationOffsetAngleWorldY(-.1),null!=this.m_profileInstance&&this.m_profileInstance.run(!0)}}M.s_uid=0,e.DemoMultiRendererScene2=M},"9f3e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98"),r=s("df25");class a extends r.default{constructor(t,e,s=!1){super(t,e,s),this.m_type=i.TextureProxyType.Uint16,this.minFilter=i.TextureConst.LINEAR,this.dataType=i.TextureDataType.UNSIGNED_SHORT}toHalfFloatOes(){this.srcFormat=i.TextureFormat.RGBA,this.internalFormat=i.TextureFormat.RGBA,this.unpackAlignment=4,this.dataType=i.TextureDataType.HALF_FLOAT_OES}toUShort565(){this.srcFormat=i.TextureFormat.RGB,this.internalFormat=i.TextureFormat.RGB,this.unpackAlignment=3,this.dataType=i.TextureDataType.UNSIGNED_SHORT_5_6_5}toUShort4444(){this.srcFormat=i.TextureFormat.RGBA,this.internalFormat=i.TextureFormat.RGBA,this.unpackAlignment=4,this.dataType=i.TextureDataType.UNSIGNED_SHORT_4_4_4_4}toUShort5551(){this.unpackAlignment=4,this.dataType=i.TextureDataType.UNSIGNED_SHORT_5_5_5_1}toUShort(){this.srcFormat=i.TextureFormat.RGBA,this.internalFormat=i.TextureFormat.RGBA,this.dataType=i.TextureDataType.UNSIGNED_SHORT}toAlphaFormat(){this.dataType==i.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=i.TextureFormat.ALPHA,this.internalFormat=i.TextureFormat.ALPHA,this.unpackAlignment=1)}toRedFormat(){this.dataType==i.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=i.TextureFormat.RED,this.internalFormat=i.TextureFormat.RED,this.unpackAlignment=1)}toRGBFormat(){this.dataType==i.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=i.TextureFormat.RGB,this.internalFormat=i.TextureFormat.RGB,this.unpackAlignment=3)}toRGBAFormat(){this.dataType==i.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=i.TextureFormat.RGBA,this.internalFormat=i.TextureFormat.RGBA,this.unpackAlignment=4)}uploadFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,h=!1){super.setDataFromBytes(t,e,s,i,r,a,h)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[Uint16TextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=a},a254:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("faa5"),r=s("b3bd"),a=s("0fc4");class h extends i.default{constructor(){super(),this.m_uniqueName="",this.m_hasTex=!1}initialize(t){console.log("ScreenPlaneShaderBuffer::initialize()... texEnabled: "+t),this.m_uniqueName="ScreenPlaneShd",this.m_hasTex=t,t&&(this.m_uniqueName+="_tex")}getFragShaderCode(){let t="precision mediump float;\nuniform vec4 u_color;\n";return this.m_hasTex&&(t+="uniform sampler2D u_sampler0;\nvarying vec2 v_texUV;\n"),t+="void main()\n{\n",this.m_hasTex?t+="gl_FragColor = texture2D(u_sampler0, v_texUV) * u_color;\n":t+="gl_FragColor = u_color;\n",t+="}\n",t}getVtxShaderCode(){let t="precision mediump float;\nattribute vec3 a_vs;\nuniform mat4 u_objMat;\n";return this.m_hasTex&&(t+="attribute vec2 a_uvs;\nvarying vec2 v_texUV;\n"),t+="void main()\n{\ngl_Position = u_objMat * vec4(a_vs,1.0);\n",this.m_hasTex&&(t+="v_texUV = a_uvs;\n"),t+="}\n",t}getUniqueShaderName(){return this.m_uniqueName}toString(){return"[ScreenPlaneShaderBuffer()]"}static GetInstance(){return null!=h.___s_instance||(h.___s_instance=new h),h.___s_instance}}h.___s_instance=null;class n extends a.default{constructor(){super(),this.m_colorArray=new Float32Array([1,1,1,1])}getCodeBuf(){return h.GetInstance()}setRGB3f(t,e,s){this.m_colorArray[0]=t,this.m_colorArray[1]=e,this.m_colorArray[2]=s}setRGBA4f(t,e,s,i){this.m_colorArray[0]=t,this.m_colorArray[1]=e,this.m_colorArray[2]=s,this.m_colorArray[3]=i}createSharedUniform(){return null}createSelfUniformData(){let t=new r.default;return t.uniformNameList=["u_color"],t.dataList=[this.m_colorArray],t}}e.default=n},a446:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("11e6"),r=s("cc48"),a=s("265e"),h=s("af68"),n=s("a80a");class l{constructor(){this.m_uid=-1,this.m_renderer=null,this.m_camera=null,this.m_stage3d=null,this.m_emptyRPONode=new a.default,this.m_rpoNodeBuilder=null,this.m_nodeQueue=new h.default,this.m_nodeWLinker=new n.default,this.m_nodeSLinker=new n.default,this.m_cullingor=null,this.m_raySelector=null,this.m_entitysTotal=0,this.m_uid=l.s_uid++,this.m_nodeQueue.initialize(1)}getUid(){return this.m_uid}initialize(t,e=null){null==this.m_renderer&&(this.m_renderer=t,this.m_stage3d=t.getStage3D(),this.m_camera=e,this.m_rpoNodeBuilder=t.getRPONodeBuilder())}getStage3D(){return this.m_stage3d}getCamera(){return this.m_camera}getMouseXYWorldRay(t,e){this.m_camera.getWorldPickingRayByScreenXY(this.m_stage3d.mouseX,this.m_stage3d.mouseY,t,e)}setSpaceCullingor(t){this.m_cullingor=t}setRaySelector(t){this.m_raySelector=t,this.m_raySelector.setRenderer(this.m_renderer)}getRaySelector(){return this.m_raySelector}addEntity(t){if(null!=t.getGlobalBounds()&&t.spaceCullMask>r.default.NONE&&i.default.TestSpaceEnabled(t.__$rseFlag)){t.update(),++this.m_entitysTotal;let e=this.m_nodeQueue.addEntity(t);e.bounds=t.getGlobalBounds(),e.pcoEnabled=(t.spaceCullMask&r.default.POV)==r.default.POV;let s=t.isRenderEnabled()||null==t.getMaterial();s&&(t.spaceCullMask&r.default.POV)==r.default.POV?(e.rstatus=1,null==t.getMaterial()&&(e.rpoNode=this.m_emptyRPONode),null==e.rpoNode&&(e.rpoNode=this.m_rpoNodeBuilder.getNodeByUid(t.getDisplay().__$rpuid)),this.m_nodeSLinker.addNode(e)):null==t.getMaterial()?(e.rstatus=1,e.rpoNode=this.m_emptyRPONode,this.m_nodeSLinker.addNode(e)):(e.rstatus=0,this.m_nodeWLinker.addNode(e))}}removeEntity(t){if(i.default.TestSpaceContains(t.__$rseFlag)){let e=this.m_nodeQueue.getNodeByEntity(t);null!=e&&(e.rstatus>0?this.m_nodeSLinker.removeNode(e):this.m_nodeWLinker.removeNode(e),this.m_nodeQueue.removeEntity(t),--this.m_entitysTotal)}}updateEntity(t){}update(){}runBegin(){}run(){let t=this.m_nodeWLinker.getBegin();if(null!=t){let e=null;while(null!=t)t.entity.isRenderEnabled()?(e=t,e.rstatus=1,t=t.next,this.m_nodeWLinker.removeNode(e),this.m_nodeSLinker.addNode(e),null==e.rpoNode&&(e.rpoNode=this.m_rpoNodeBuilder.getNodeByUid(e.entity.getDisplay().__$rpuid))):t=t.next}if(t=this.m_nodeSLinker.getBegin(),null!=t)if(null!=this.m_cullingor)this.m_cullingor.setCamera(this.m_camera),this.m_cullingor.setCullingNodeHead(t),this.m_cullingor.run();else{let e=null,s=this.m_camera;s.getPosition();while(null!=t)t.rpoNode.isVsible()?(e=t.bounds,t.drawEnabled=s.visiTestSphere2(e.center,e.radius),t.entity.drawEnabled=t.drawEnabled,t.rpoNode.drawEnabled=t.drawEnabled):(t.drawEnabled=!1,t.entity.drawEnabled=!1,t.rpoNode.drawEnabled=!1),t=t.next}}rayTest(t,e){null!=this.m_raySelector&&(this.m_raySelector.setCamera(this.m_camera),this.m_raySelector.setCullingNodeHead(this.m_nodeSLinker.getBegin()),this.m_raySelector.setRay(t,e),this.m_raySelector.run())}runEnd(){}getCullingNodeHead(){return this.m_nodeSLinker.getBegin()}toString(){return"[RendererSpace(uid = "+this.m_uid+")]"}}l.s_uid=0,e.default=l},a80a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_begin=null,this.m_end=null}destroy(){this.clear()}clear(){this.m_begin=this.m_end=null}getBegin(){return this.m_begin}isEmpty(){return this.m_begin==this.m_end&&null==this.m_end}addNode(t){null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null}removeNode(t){t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}e.default=i},a905:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("1710"),r=s("badb");class a{constructor(){this.m_dispatcher=null,this.m_targetEntity=null}bindTarget(t){if(null==this.m_targetEntity&&null!=t){this.m_targetEntity=t;let e=new r.default;e.addEventListener(i.default.MOUSE_DOWN,this,this.mouseDownListener),e.addEventListener(i.default.MOUSE_UP,this,this.mouseUpListener),e.addEventListener(i.default.MOUSE_OVER,this,this.mouseOverListener),e.addEventListener(i.default.MOUSE_OUT,this,this.mouseOutListener),e.addEventListener(i.default.MOUSE_MOVE,this,this.mouseMoveListener),t.setEvtDispatcher(e),t.mouseEnabled=!0,this.m_dispatcher=e}}mouseMoveListener(t){}mouseOverListener(t){if(null!=this.m_targetEntity){let t=this.m_targetEntity.getMaterial();t.setRGB3f(1.2*Math.random(),1.2*Math.random(),1.2*Math.random())}}mouseOutListener(t){if(null!=this.m_targetEntity){let t=this.m_targetEntity.getMaterial();t.setRGB3f(1,1,1)}}mouseDownListener(t){console.log("MouseEventEntityController mouse down. "),this.m_targetEntity.setRotationXYZ(0,0,this.m_targetEntity.getTransform().getRotationZ()+2),this.m_targetEntity.update()}mouseUpListener(t){console.log("MouseEventEntityController mouse up. ")}destory(){null!=this.m_targetEntity&&(this.m_targetEntity.mouseEnabled=!1,this.m_targetEntity=null,this.m_targetEntity.setEvtDispatcher(null)),null!=this.m_dispatcher&&(this.m_dispatcher.destroy(),this.m_dispatcher=null)}}e.default=a},a996:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.phase=0,this.type=i.RESIZE,this.target=null,this.__$preventBoo=!1}getClassType(){return i.EventClassType}preventDefault(){this.__$preventBoo=!0}reset(){this.__$preventBoo=!1}toString(){return"[EventBase]"}}i.EventClassType=1001,i.RESIZE=3001,e.default=i},ab73:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.LocalTransformMatUNS="u_objMat",i.CameraViewMatUNS="u_viewMat",i.CameraProjectiveMatUNS="u_projMat",i.CameraParamUNS="u_cameraParam",i.StageParamUNS="u_stageParam",i.ViewParamUNS="u_viewParam",e.default=i},abdb:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.AXIS_ANGLE=0,i.QUATERNION=1,i.EULER_ANGLES=2,e.default=i},acaa:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98"),r=s("cfaf");class a extends r.default{constructor(t,e,s=!1){super(t,e,s),this.minFilter=i.TextureConst.NEAREST,this.magFilter=i.TextureConst.NEAREST,this.srcFormat=i.TextureFormat.DEPTH_COMPONENT,this.internalFormat=i.TextureFormat.DEPTH_COMPONENT,this.dataType=i.TextureDataType.UNSIGNED_SHORT,this.m_generateMipmap=!1,this.m_haveRData=!0,this.mipmapEnabled=!1,this.m_type=i.TextureProxyType.Depth}toDepthUnsignedInt(){this.minFilter=i.TextureConst.NEAREST,this.magFilter=i.TextureConst.NEAREST,this.srcFormat=i.TextureFormat.DEPTH_COMPONENT,this.internalFormat=i.TextureFormat.DEPTH_COMPONENT,this.dataType=i.TextureDataType.UNSIGNED_INT,this.m_generateMipmap=!1,this.m_haveRData=!0,this.mipmapEnabled=!1}toDepthUnsignedShort(){this.minFilter=i.TextureConst.NEAREST,this.magFilter=i.TextureConst.NEAREST,this.srcFormat=i.TextureFormat.DEPTH_COMPONENT,this.internalFormat=i.TextureFormat.DEPTH_COMPONENT,this.dataType=i.TextureDataType.UNSIGNED_SHORT,this.m_generateMipmap=!1,this.m_haveRData=!0,this.mipmapEnabled=!1}toDepthAndStencil(){this.minFilter=i.TextureConst.NEAREST,this.magFilter=i.TextureConst.NEAREST,this.srcFormat=i.TextureFormat.DEPTH_STENCIL,this.internalFormat=i.TextureFormat.DEPTH_STENCIL,this.dataType=i.TextureDataType.UNSIGNED_INT_24_8_WEBGL,this.m_generateMipmap=!1,this.mipmapEnabled=!1,this.m_haveRData=!0}uploadData(t){let e=t.getRC();e.texImage2D(this.m_sampler,0,i.TextureFormat.ToGL(e,this.internalFormat),this.m_texWidth,this.m_texHeight,0,i.TextureFormat.ToGL(e,this.srcFormat),i.TextureDataType.ToGL(e,this.dataType),null)}toString(){return"[DepthTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=a},acfe:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("ca6c"),r=s("8a0a"),a=s("352a"),h=s("81ce"),n=s("fc07");class l{constructor(){this.m_uid=-1,this.m_vshdCode="",this.m_fshdCode="",this.m_shdUniqueName="",this.m_texTotal=0,this.m_uniforms=null,this.m_useTex=!1,this.m_attriNSList=null,this.m_attriSizeList=null,this.m_aLocationTypes=null,this.m_uniformDict=new Map,this.m_haveCommonUniform=!1,this.m_layoutBit=0,this.m_fragOutputTotal=1,this.m_texUniformNames=null,this.dataUniformEnabled=!1,this.m_uid=l.s_uid++}getVSCodeStr(){return this.m_vshdCode}getFSCodeStr(){return this.m_fshdCode}getLayoutBit(){return this.m_layoutBit}getFragOutputTotal(){return this.m_fragOutputTotal}parseCode(t,e){l.s_codeParser.reset(),l.s_codeParser.parseVShaderCode(t),l.s_codeParser.parseFShaderCode(e),this.m_fragOutputTotal=l.s_codeParser.fragOutputTotal,this.m_uniforms=l.s_codeParser.m_uniforms}initialize(t,e,s){a.default.IsWebGL1()&&(e=h.default.Es3VtxShaderToES2(e),s=h.default.Es3FragShaderToES2(s)),this.parseCode(e,s);let n=l.s_codeParser.attributes,_=0,o=n.length,m=null;this.m_attriNSList=[],this.m_attriSizeList=[],this.m_layoutBit=0;while(_<o){if(m=n[_],null!=m)switch(this.m_attriNSList.push(m.name),this.m_attriSizeList.push(m.typeSize),r.default.GetVBufTypeByNS(m.name)){case r.default.VBUF_VS:this.m_layoutBit|=i.default.BIT_ONE_0;break;case r.default.VBUF_UVS:this.m_layoutBit|=i.default.BIT_ONE_1;break;case r.default.VBUF_NVS:this.m_layoutBit|=i.default.BIT_ONE_2;break;case r.default.VBUF_CVS:this.m_layoutBit|=i.default.BIT_ONE_3;break;case r.default.VBUF_TVS:this.m_layoutBit|=i.default.BIT_ONE_4;break;case r.default.VBUF_VS2:this.m_layoutBit|=i.default.BIT_ONE_5;break;case r.default.VBUF_UVS2:this.m_layoutBit|=i.default.BIT_ONE_6;break;case r.default.VBUF_NVS2:this.m_layoutBit|=i.default.BIT_ONE_7;break;case r.default.VBUF_CVS2:this.m_layoutBit|=i.default.BIT_ONE_8;break;case r.default.VBUF_TVS2:this.m_layoutBit|=i.default.BIT_ONE_9;break;default:break}++_}this.m_texTotal=l.s_codeParser.texTotal,this.m_useTex=this.m_texTotal>0,this.m_useTex&&(this.m_texUniformNames=l.s_codeParser.texUniformNameListStr.split(",")),this.m_haveCommonUniform=this.m_texTotal<this.m_uniforms.length,this.m_vshdCode=e,this.m_fshdCode=s,this.m_shdUniqueName=t}getAttriSizeList(){return this.m_attriSizeList}getTexUniformNames(){return this.m_texUniformNames}getUniforms(){return this.m_uniforms}haveCommonUniform(){return this.m_haveCommonUniform}getAttriNSList(){return this.m_attriNSList}getUid(){return this.m_uid}getTexTotal(){return this.m_texTotal}haveTexture(){return this.m_useTex}getLocationsTotal(){return this.m_aLocationTypes.length}getUniformTypeNameByNS(t){let e=this.m_uniformDict.get(t);return null!=e?e.typeName:""}getUniformTypeByNS(t){let e=this.m_uniformDict.get(t);return null!=e?e.type:0}hasUniformByName(t){return this.m_uniformDict.has(t)}getUniformLengthByNS(t){return this.m_uniformDict.has(t)&&this.m_uniformDict.get(t).arrLength,0}getUniqueShaderName(){return this.m_shdUniqueName}destroy(){this.m_texTotal=0}}l.s_uid=0,l.s_codeParser=new n.default,e.default=l},af29:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("baae"),r=s("722e"),a=s("8333"),h=s("29ef"),n=s("8d98"),l=s("cfaf"),_=s("3930");class o{constructor(t,e){this.m_adapter=null,this.m_renderProxy=null,this.m_materialProxy=null,this.m_bgColor=new _.default,this.m_render=null,this.m_runBegin=!0,this.m_fboIndex=-1,this.m_fboType=-1,this.m_initW=128,this.m_initH=128,this.m_enableDepth=!0,this.m_enableStencil=!1,this.m_multisampleLevel=0,this.m_gMateiral=null,this.m_rindexs=[],this.m_texs=[null,null,null,null,null,null,null,null],this.m_texStore=null,this.m_texsTot=0,this.m_synFBOSizeWithViewport=!0,this.m_fboSizeFactor=1,this.m_clearDepth=256,this.m_clearColorBoo=!0,this.m_clearDepthBoo=!0,this.m_clearStencilBoo=!1,this.m_viewportLock=!1,this.m_render=t,this.m_texStore=e,this.m_renderProxy=t.getRenderProxy(),this.m_adapter=this.m_renderProxy.getRenderAdapter(),this.m_materialProxy=this.m_render.getRendererContext().getRenderMaterialProxy()}getFBOUid(){return this.m_fboIndex}setRProcessIDList(t){if(t.length<1)throw Error("list.length < 1, but must: list.length >= 1");this.m_rindexs=t}setRProcessList(t){if(t.length<1)throw Error("list.length < 1, but must: list.length >= 1");this.m_rindexs=new Array(t.length);for(let e=0;e<t.length;++e)this.m_rindexs[e]=t[e].getRPIndex()}getRProcessIDAt(t){return this.m_rindexs[t]}getStage3D(){return this.m_renderProxy.getStage3D()}getCamera(){return null!=this.m_renderProxy?this.m_renderProxy.getCamera():null}lockViewport(){this.m_viewportLock=!0}unlockViewport(){this.m_viewportLock=!1}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}updateCameraDataFromCamera(t){null!=this.m_renderProxy&&this.m_renderProxy.updateCameraDataFromCamera(t)}useGlobalRenderState(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderState(),this.m_renderProxy.useRenderState(t),this.m_renderProxy.lockRenderState())}lockRenderState(){this.m_renderProxy.lockRenderState()}unlockRenderState(){this.m_renderProxy.unlockRenderState()}useGlobalRenderStateByName(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderState(),this.m_renderProxy.useRenderState(h.default.GetRenderStateByName(t)),this.m_renderProxy.lockRenderState())}useGlobalMaterial(t){this.m_gMateiral=t}lockMaterial(){this.m_materialProxy.lockMaterial()}unlockMaterial(){this.m_gMateiral=null,this.m_materialProxy.unlockMaterial()}synFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!0}asynFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!1}setFBOSizeFactorWithViewPort(t){this.m_fboSizeFactor=t}createViewportSizeFBOAt(t,e=!1,s=!1,r=0){this.m_fboIndex<0&&(this.m_fboIndex=t,this.m_fboType=i.default.FRAMEBUFFER,this.m_initW=this.m_adapter.getViewportWidth(),this.m_initH=this.m_adapter.getViewportHeight(),this.m_enableDepth=e,this.m_enableStencil=s,this.m_multisampleLevel=r,this.m_adapter.createFBOAt(t,this.m_fboType,this.m_initW,this.m_initH,e,s,r))}createFBO(t,e,s=0){this.m_enableDepth=t,this.m_enableStencil=e,this.m_multisampleLevel=s,this.m_adapter.createFBOAt(this.m_fboIndex,this.m_fboType,this.m_initW,this.m_initH,t,e,s)}createAutoSizeFBOAt(t,e=!1,s=!1,r=0){t>=0&&this.m_fboIndex<0&&(this.m_fboType=i.default.FRAMEBUFFER,this.m_initW=512,this.m_initH=512,this.m_fboIndex=t,this.createFBO(e,s,r))}createFBOAt(t,e,s,r=!1,a=!1,h=0){t>=0&&this.m_fboIndex<0&&(this.m_fboType=i.default.FRAMEBUFFER,this.m_initW=e,this.m_initH=s,this.m_fboIndex=t,this.createFBO(r,a,h))}createReadFBOAt(t,e,s,r=!1,a=!1,h=0){t>=0&&this.m_fboIndex<0&&(this.m_fboType=i.default.READ_FRAMEBUFFER,this.m_initW=e,this.m_initH=s,this.m_fboIndex=t,this.createFBO(r,a,h))}createDrawFBOAt(t,e,s,r=!1,a=!1,h=0){t>=0&&this.m_fboIndex<0&&(this.m_fboType=i.default.DRAW_FRAMEBUFFER,this.m_initW=e,this.m_initH=s,this.m_fboIndex=t,this.createFBO(r,a,h))}getRTTAt(t){return this.m_texs[t]}setRenderToTexture(t,e=0){0==e?this.m_texsTot=1:this.m_texsTot<e+1&&(this.m_texsTot=e+1),this.m_texs[e]=t}setRenderToRTTTextureAt(t,e=0){this.setRenderToTexture(this.m_texStore.getRTTTextureAt(t),e)}setRenderToFloatTextureAt(t,e=0){this.setRenderToTexture(this.m_texStore.getRTTFloatTextureAt(t),e)}setRenderToHalfFloatTexture(t,e=0){null==t&&(t=new l.default(128,128),t.__$setRenderProxy(this.m_renderProxy),t.internalFormat=n.TextureFormat.RGBA16F,t.srcFormat=n.TextureFormat.RGBA,t.dataType=n.TextureDataType.FLOAT,t.minFilter=n.TextureConst.LINEAR,t.magFilter=n.TextureConst.LINEAR,t.__$setRenderProxy(this.m_renderProxy)),this.setRenderToTexture(t,e)}setRenderToRGBATexture(t,e=0){null==t&&(t=new l.default(32,32),t.internalFormat=n.TextureFormat.RGBA,t.srcFormat=n.TextureFormat.RGBA,t.dataType=n.TextureDataType.UNSIGNED_BYTE,t.minFilter=n.TextureConst.LINEAR,t.magFilter=n.TextureConst.LINEAR,t.__$setRenderProxy(this.m_renderProxy)),this.setRenderToTexture(t,e)}setRenderToDepthTextureAt(t,e=0){this.setRenderToTexture(this.m_texStore.getDepthTextureAt(t),e)}setClearState(t,e,s=!1){this.m_clearColorBoo=t,this.m_clearDepthBoo=e,this.m_clearStencilBoo=s}setRenderToBackBuffer(){this.m_adapter.setRenderToBackBuffer()}setClearDepth(t){this.m_clearDepth=t}getClearDepth(){return this.m_adapter.getClearDepth()}getViewX(){return this.m_adapter.getViewportX()}getViewY(){return this.m_adapter.getViewportY()}getViewWidth(){return this.m_adapter.getViewportWidth()}getViewHeight(){return this.m_adapter.getViewportHeight()}getFBOWidth(){return this.m_adapter.getFBOWidthAt(this.m_fboIndex)}getFBOHeight(){return this.m_adapter.getFBOHeightAt(this.m_fboIndex)}setClearRGBColor3f(t,e,s){this.m_bgColor.setRGB3f(t,e,s)}setClearColorEnabled(t){this.m_clearColorBoo=t}setClearDepthEnabled(t){this.m_clearDepthBoo=t}setClearStencilEnabled(t){this.m_clearStencilBoo=t}setClearUint24Color(t,e=1){this.m_bgColor.setRGBUint24(t),this.m_bgColor.a=e}setClearRGBAColor4f(t,e,s,i){this.m_bgColor.setRGBA4f(t,s,e,i)}blitFrom(t,e=a.default.COLOR_BUFFER_BIT,s=r.default.NEAREST,i=-1,h=0,n=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,e,s,i,h,n))}blitColorFrom(t,e=r.default.NEAREST,s=-1,i=0,h=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,a.default.COLOR_BUFFER_BIT,e,s,i,h))}blitDepthFrom(t,e=r.default.NEAREST,s=-1,i=0,h=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,a.default.COLOR_BUFFER_BIT|a.default.DEPTH_BUFFER_BIT,e,s,i,h))}blitColorAndDepthFrom(t,e=r.default.NEAREST,s=-1,i=0,h=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,a.default.COLOR_BUFFER_BIT|a.default.DEPTH_BUFFER_BIT,e,s,i,h))}blitStencilFrom(t,e=r.default.NEAREST,s=-1,i=0,h=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,a.default.STENCIL_BUFFER_BIT,e,s,i,h))}runBeginDo(){if(this.m_runBegin){this.m_runBegin=!1,this.m_viewportLock?this.m_adapter.lockViewport():this.m_adapter.unlockViewport(),this.m_adapter.bindFBOAt(this.m_fboIndex,this.m_fboType),this.m_synFBOSizeWithViewport?(this.m_adapter.synFBOSizeWithViewport(),this.m_adapter.setFBOSizeFactorWithViewPort(this.m_fboSizeFactor)):this.m_adapter.asynFBOSizeWithViewport(),this.m_clearDepth<128&&this.m_adapter.setClearDepth(this.m_clearDepth),this.m_renderProxy.setClearColor(this.m_bgColor);let t=0;for(;t<this.m_texsTot;++t)this.m_adapter.setRenderToTexture(this.m_texs[t],this.m_enableDepth,this.m_enableStencil,t);this.m_adapter.useFBO(this.m_clearColorBoo,this.m_clearDepthBoo,this.m_clearStencilBoo),null!=this.m_gMateiral?(this.m_materialProxy.unlockMaterial(),this.m_materialProxy.useGlobalMaterial(this.m_gMateiral),this.m_materialProxy.lockMaterial()):this.m_materialProxy.unlockMaterial()}}run(){if(this.m_fboIndex>=0&&null!=this.m_rindexs){this.runBeginDo();for(let t=0,e=this.m_rindexs.length;t<e;++t)this.m_render.runAt(this.m_rindexs[t]);this.m_runBegin=!0}}runAt(t){this.m_fboIndex>=0&&null!=this.m_rindexs&&(0==t?this.runBeginDo():this.m_runBegin=!0,this.m_render.runAt(this.m_rindexs[t]))}runBegin(){this.m_fboIndex>=0&&null!=this.m_rindexs&&(this.m_runBegin=!0,this.runBeginDo())}runEnd(){this.m_runBegin=!0,this.m_adapter.unlockViewport()}reset(){let t=0;for(;t<this.m_texsTot;++t)this.m_texs[t]=null;this.m_runBegin=!0,this.m_fboIndex=-1,this.m_texsTot=0,this.m_rindexs=[]}clone(){let t=new o(this.m_render,this.m_texStore);t.m_fboSizeFactor=this.m_fboSizeFactor,t.m_bgColor.copyFrom(this.m_bgColor),t.m_fboIndex=this.m_fboIndex,t.m_fboType=this.m_fboType,t.m_clearDepth=this.m_clearDepth,t.m_texsTot=this.m_texsTot,t.m_enableDepth=this.m_enableDepth,t.m_enableStencil=this.m_enableStencil,t.m_initW=this.m_initW,t.m_initH=this.m_initH,t.m_multisampleLevel=this.m_multisampleLevel;let e=0;for(;e<this.m_texsTot;++e)t.m_texs[e]=t.m_texs[e];if(null!=this.m_rindexs){let s=this.m_rindexs.length,i=new Array(s);for(e=0;e<s;++e)i[e]=this.m_rindexs[e];t.setRProcessIDList(i)}return t}}e.default=o},af68:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("11e6"),r=s("7b0e");class a{constructor(){this.m_nodeListLen=0,this.m_nodeIdList=[],this.m_nodeList=[],this.m_entityList=[],this.m_nodeFlagList=[],this.m_freeIdList=[]}getFreeId(){return this.m_freeIdList.length>0?this.m_freeIdList.pop():-1}createNode(){let t=this.getFreeId();if(t>=0)return this.m_nodeFlagList[t]=1,this.m_nodeList[t];{t=this.m_nodeListLen;let e=r.default.Create();return this.m_nodeList.push(e),this.m_entityList.push(null),e.spaceId=t,this.m_nodeFlagList.push(1),this.m_nodeIdList.push(t),this.m_nodeFlagList.push(1),this.m_nodeListLen++,e}}restoreId(t){t>0&&1==this.m_nodeFlagList[t]&&(this.m_freeIdList.push(t),this.m_nodeFlagList[t]=0,this.m_entityList[t]=null)}addEntity(t){let e=this.createNode();return this.m_entityList[e.spaceId]=t,e.entity=t,t.__$rseFlag=i.default.AddSpaceUid(t.__$rseFlag,e.spaceId),e}initialize(t){if(t>0)for(let e=0;e<t;e++){let t=this.createNode();this.m_entityList[t.spaceId]=null}}getNodeByEntity(t){if(i.default.TestSpaceContains(t.__$rseFlag)){let e=i.default.GetSpaceUid(t.__$rseFlag);if(this.m_entityList[e]==t)return this.m_nodeList[e]}return null}removeEntity(t){if(i.default.TestSpaceContains(t.__$rseFlag)){let e=i.default.GetSpaceUid(t.__$rseFlag);this.m_entityList[e]==t&&(this.m_nodeList[e].entity=null,this.restoreId(e),t.__$rseFlag=i.default.RemoveSpaceUid(t.__$rseFlag))}}toString(){return"[EntityNodeQueue()]"}}e.default=a},b02c:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("6e01");(function(t){let e;(function(t){class e{constructor(t,s){this.m_uid=-1,this.m_mid=-1,this.m_texTotal=0,this.m_gtexList=null,this.m_samplers=null,this.m_texList=null,this.m_rcuid=0,this.m_texRes=null,this.direct=!0,this.m_attachCount=0,this.m_rcuid=t,this.m_uid=e.s_uid++,this.m_mid=s}__$setParam(t,e){this.m_rcuid=t,this.m_mid=e}getRCUid(){return this.m_rcuid}getMid(){return this.m_mid}getTexTotal(){return this.m_texTotal}collectTexList(t,e,s){this.m_texRes=t;let r=0;if(this.direct)if(this.m_texTotal<1&&e.length>0){let a,h=i.default.GetNearestCeilPow2(e.length);this.m_samplers=new Uint16Array(h),this.m_gtexList=new Array(h),this.m_texList=e;while(r<s)a=e[r],a.__$attachThis(),a.__$$upload(t),this.m_samplers[r]=a.getSampler(),this.m_gtexList[r]=this.m_texRes.getGpuBuffer(a.getResUid()),this.m_texRes.__$attachRes(a.getResUid()),r++;this.m_texTotal=r}else this.m_texTotal=0;else this.m_texTotal=s;while(r<e.length)e[r].__$detachThis()}run(){if(this.m_texRes.unlocked&&this.m_texRes.texMid!=this.m_mid){this.m_texRes.texMid=this.m_mid;let t=this.m_texRes.getRC(),e=t.TEXTURE0;if(this.direct)for(let s=0;s<this.m_texTotal;++s)t.activeTexture(e++),t.bindTexture(this.m_samplers[s],this.m_gtexList[s]);else{let s=this.m_texList;for(let i=0;i<this.m_texTotal;++i)t.activeTexture(e++),s[i].__$$use(this.m_texRes)}}}getUid(){return this.m_uid}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0,e.Restore(this))}reset(){if(null!=this.m_texList)for(let t=0,e=this.m_texList.length;t<e;++t)this.m_texList[t].__$detachThis(),this.m_texRes.__$detachRes(this.m_texList[t].getResUid()),this.m_gtexList[t]=null;this.m_texTotal=0,this.m_texList=null,this.m_texRes=null}toString(){return"TextureRenderObj(uid = "+this.m_uid+", mid="+this.m_mid+")"}static Create(t,s,i){let r=s.length;if(r>0&&i>0){if(r<i)throw Error("There are fewer textures than in the shader : (need "+i+",but only have "+r+") !!!");let a=31,h=0,n=!0;while(h<i)a=131*a+s[h].getUid(),s[h].isDirect()||(n=!1),++h;let l=e.s_troMaps[t.getRCUid()],_=null;return l.has(a)?_=l.get(a):(_=e.s_freeTROList.length<1?new e(t.getRCUid(),a):e.s_freeTROList.pop(),_.collectTexList(t,s,i),l.set(a,_)),_.__$setParam(t.getRCUid(),a),_.direct=n,_}return null}static Restore(t){t.getMid()>-1&&(e.s_troMaps[t.getRCUid()].delete(t.getMid()),t.__$setParam(0,0),e.s_freeTROList.push(t),t.reset())}static GetByMid(t,s){return e.s_troMaps[t].get(s)}}e.s_uid=0,e.s_troMaps=[new Map,new Map,new Map,new Map,new Map,new Map,new Map,new Map],e.s_freeTROList=[],e.s_unloacked=!0,e.s_preMid=-1,t.TextureRenderObj=e;class s{constructor(t){this.m_texRes=null,this.m_texRes=t}run(){this.m_texRes.renderBegin()}getMid(){return 1}__$attachThis(){}__$detachThis(){}}t.EmptyTexRenderObj=s})(e=t.render||(t.render={}))})(e.vox||(e.vox={}))},b0ef:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_canvas=null,this.m_div=null,this.m_divW=-1,this.m_divH=-1,this.resized=!0}setDiv(t){this.m_div=t}createViewEle(t,e){null==this.m_div&&(this.m_div=t.createElement("div"),this.m_div.style.width="400px",this.m_div.style.height="300px",document.body.appendChild(this.m_div)),this.m_div.style.display="bolck",this.m_div.style.position="absolute",""==this.m_div.style.left&&(this.m_div.style.left="0px",this.m_div.style.top="0px"),e&&(this.m_div.style.width="100%",this.m_div.style.height="100%"),null==this.m_canvas&&(this.m_canvas=document.createElement("canvas"),this.m_div.appendChild(this.m_canvas),this.m_canvas.width=800,this.m_canvas.height=600,this.m_canvas.style.display="bolck",this.m_canvas.style.left="0px",this.m_canvas.style.top="0px",this.m_canvas.style.position="absolute")}setDivStyleLeftAndTop(t,e){this.m_div.style.left=t+"px",this.m_div.style.top=e+"px"}setDivStyleSize(t,e){this.m_divW==t&&this.m_divH==e||(this.m_div.style.width=t+"px",this.m_div.style.height=e+"px",this.resized=!0)}getDiv(){return this.m_div}getCanvas(){return this.m_canvas}}e.default=i},b161:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8e17"),r=s("3806"),a=s("c497"),h=s("af68"),n=s("a80a"),l=s("9c4d"),_=s("d958"),o=s("5d04"),m=s("a446"),u=s("c711"),d=s("955e"),c=s("765c"),f=s("af29"),p=s("d7e2"),g=s("70f2");class x{constructor(){this.m_uid=-1,this.m_adapter=null,this.m_renderProxy=null,this.m_shader=null,this.m_rcontext=null,this.m_renderer=null,this.m_processids=new Uint8Array(128),this.m_processidsLen=0,this.m_rspace=null,this.m_mouse_rltv=new i.default,this.m_mouse_rlpv=new i.default,this.m_evtFlowEnabled=!1,this.m_evt3DCtr=null,this.m_mouseEvtEnabled=!0,this.m_viewX=0,this.m_viewY=0,this.m_viewW=800,this.m_viewH=800,this.m_nodeWaitLinker=null,this.m_nodeWaitQueue=null,this.m_camDisSorter=null,this.m_subscList=[],this.m_subscListLen=0,this.m_runFlag=-1,this.m_autoRunning=!0,this.m_processUpdate=!1,this.m_tickId=-1,this.m_rparam=null,this.runnableQueue=new l.default,this.textureBlock=new o.default,this.stage3D=null,this.m_children=[],this.m_childrenTotal=0,this.m_mouseTestBoo=!0,this.m_cullingTestBoo=!0,this.m_rayTestBoo=!0,this.m_uid=x.s_uid++}tickUpdate(){this.m_tickId>-1&&clearTimeout(this.m_tickId),this.m_tickId=setTimeout(this.tickUpdate.bind(this),this.m_rparam.getTickUpdateTime()),this.textureBlock.run()}getUid(){return this.m_uid}getDiv(){return this.m_renderProxy.getDiv()}getCanvas(){return this.m_renderProxy.getCanvas()}getRPONodeBuilder(){return null}getRenderProxy(){return this.m_renderProxy}setViewPort(t,e,s,i){null!=this.m_renderProxy&&(this.m_viewX=t,this.m_viewY=e,this.m_viewW=s,this.m_viewH=i,this.m_renderProxy.setViewPort(t,e,s,i))}reseizeViewPort(){this.m_renderProxy.reseizeRCViewPort()}lockViewport(){this.m_adapter.lockViewport()}unlockViewport(){this.m_adapter.unlockViewport()}getRendererAdapter(){return this.m_adapter}getRenderer(){return this.m_renderer}getRendererContext(){return this.m_rcontext}getStage3D(){return this.m_renderProxy.getStage3D()}getCamera(){return this.m_renderProxy.getCamera()}cameraLock(){this.m_renderProxy.cameraLock()}cameraUnlock(){this.m_renderProxy.cameraUnlock()}getMouseXYWorldRay(t,e){this.m_renderProxy.getMouseXYWorldRay(t,e)}createCamera(){return this.m_renderProxy.createCamera()}createFBOInstance(){return new f.default(this,this.textureBlock.getRTTStrore())}setClearUint24Color(t,e=1){this.m_renderProxy.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,s){this.m_renderProxy.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.m_renderProxy.setClearRGBAColor4f(t,e,s,i)}setClearColor(t){this.m_renderProxy.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.m_rcontext.setRenderToBackBuffer()}updateRenderBufferSize(){this.m_adapter.updateRenderBufferSize()}setEvt3DController(t){null!=t&&(t.initialize(this.getStage3D(),this.getStage3D()),t.setRaySelector(this.m_rspace.getRaySelector())),this.m_evt3DCtr=t}isRayPickSelected(){return null!=this.m_evt3DCtr&&this.m_evt3DCtr.isSelected()}enableMouseEvent(t=!0){null==this.m_evt3DCtr&&(t?this.m_rspace.setRaySelector(new d.default):this.m_rspace.setRaySelector(new u.default),this.setEvt3DController(new c.default)),this.m_mouseEvtEnabled=!0}disableMouseEvent(){this.m_mouseEvtEnabled=!1}getEvt3DController(){return this.m_evt3DCtr}getSpace(){return this.m_rspace}getDevicePixelRatio(){return this.m_adapter.getDevicePixelRatio()}createSubScene(){if(null!=this.m_renderer){let t=new g.default(this.m_renderer,this.m_evtFlowEnabled);return this.m_subscList.push(t),this.m_subscListLen++,t}return null}addEventListener(t,e,s,i=!0,r=!1){this.stage3D.addEventListener(t,e,s,i,r)}removeEventListener(t,e,s){this.stage3D.removeEventListener(t,e,s)}initialize(t=null,e=3){if(null==this.m_renderer){null==t&&(t=new a.default),this.m_rparam=t;let s=this;s.stage3D=new r.default(this.getUid(),document),e<1&&(e=1),e>8&&(e=8),this.m_evtFlowEnabled=t.evtFlowEnabled,this.m_renderer=new _.default,this.m_renderer.__$setStage3D(this.stage3D),this.m_renderer.initialize(t),this.m_processids[0]=0,this.m_processidsLen++;let i=null;for(;e>=0;)i=this.m_renderer.appendProcess(t.batchEnabled,t.processFixedState),this.m_processids[this.m_processidsLen]=i.getRPIndex(),this.m_processidsLen++,--e;this.m_rcontext=this.m_renderer.getRendererContext(),this.m_renderProxy=this.m_rcontext.getRenderProxy(),this.m_adapter=this.m_renderProxy.getRenderAdapter();let h=this.m_renderProxy.getStage3D();if(this.m_viewW=h.stageWidth,this.m_viewH=h.stageHeight,this.m_shader=this.m_renderer.getDataBuilder().getRenderShader(),this.textureBlock.setRenderer(this.m_renderer),this.m_camDisSorter=new p.default(this.m_renderProxy),null==this.m_rspace){let t=new m.default;t.initialize(this.m_renderer,this.m_renderProxy.getCamera()),this.m_rspace=t}this.tickUpdate()}}setRendererProcessParam(t,e,s){this.m_renderer.setRendererProcessParam(this.m_processids[t],e,s)}appendARendererProcess(t=!0,e=!1){let s=this.m_renderer.appendProcess(t,e);this.m_processids[this.m_processidsLen]=s.getRPIndex(),this.m_processidsLen++}addContainer(t,e=0){if(e<0&&(e=0),null!=t&&t.__$wuid<0&&t.__$contId<1){let s=0;for(;s<this.m_childrenTotal;++s)if(this.m_children[s]==t)return;s>=this.m_childrenTotal&&(t.__$wuid=this.m_uid,t.wprocuid=this.m_processids[e],t.__$setRenderer(this),this.m_children.push(t),this.m_childrenTotal++)}}removeContainer(t){if(null!=t&&t.__$wuid==this.m_uid&&t.getRenderer()==this.m_renderer){let e=0;for(;e<this.m_childrenTotal;++e)if(this.m_children[e]==t){t.__$wuid=-1,t.wprocuid=-1,t.__$setRenderer(null),this.m_children.splice(e,1),--this.m_childrenTotal;break}}}setAutoRunningEnabled(t){this.m_autoRunning=t}setAutoRenderingSort(t){this.m_processUpdate=t}setProcessSortEnabledAt(t,e,s=null){if(this.m_renderer.setProcessSortEnabledAt(t,e),e){let e=this.m_renderer.getProcessAt(t);s=null!=s?s:this.m_camDisSorter,null!=e&&e.setSorter(s)}}setProcessSortEnabled(t,e,s=null){this.m_renderer.setProcessSortEnabled(t,e),e&&null!=t&&!t.hasSorter()&&(s=null!=s?s:this.m_camDisSorter,t.setSorter(s))}moveEntityTo(t,e){this.m_renderer.moveEntityToProcessAt(t,this.m_processids[e])}drawEntity(t){this.m_renderer.drawEntity(t)}addEntity(t,e=0,s=!0){if(t.__$testSpaceEnabled())if(t.isPolyhedral())if(t.hasMesh())this.m_renderer.addEntity(t,this.m_processids[e],s),null!=this.m_rspace&&this.m_rspace.addEntity(t);else{null==this.m_nodeWaitLinker&&(this.m_nodeWaitLinker=new n.default,this.m_nodeWaitQueue=new h.default);let s=this.m_nodeWaitQueue.addEntity(t);s.rstatus=e,this.m_nodeWaitLinker.addNode(s)}else this.m_renderer.addEntity(t,this.m_processids[e],s),null!=this.m_rspace&&this.m_rspace.addEntity(t)}removeEntity(t){let e=null;if(null!=this.m_nodeWaitLinker){let e=this.m_nodeWaitQueue.getNodeByEntity(t);null!=e&&(this.m_nodeWaitLinker.removeNode(e),this.m_nodeWaitQueue.removeEntity(t))}null==e&&(this.m_renderer.removeEntity(t),null!=this.m_rspace&&this.m_rspace.removeEntity(t))}updateMaterialUniformToCurrentShd(t){this.m_renderer.updateMaterialUniformToCurrentShd(t)}drawEntityByLockMaterial(t){this.m_renderer.drawEntityByLockMaterial(t)}showInfoAt(t){this.m_renderer.showInfoAt(t)}getRenderUnitsTotal(){return this.m_renderer.getRenderUnitsTotal()}runBegin(t=!0,e=!0){t&&this.m_autoRunning&&(this.m_runFlag>=0&&this.runEnd(),this.m_runFlag=0),this.m_adapter.unlockViewport(),this.m_renderProxy.isAutoSynViewAndStage()||this.m_renderProxy.setViewPort(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH),this.m_renderProxy.updateCamera(),this.m_shader.renderBegin(),this.m_rcontext.updateCameraDataFromCamera(this.m_renderProxy.getCamera()),e&&this.m_rcontext.renderBegin(),null!=this.m_rspace&&this.m_rspace.runBegin()}renderBegin(t=!0){this.m_adapter.unlockViewport(),this.m_renderProxy.isAutoSynViewAndStage()||this.m_renderProxy.setViewPort(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH),this.m_renderProxy.updateCamera(),this.m_shader.renderBegin(),this.m_rcontext.updateCameraDataFromCamera(this.m_renderProxy.getCamera()),t&&this.m_rcontext.renderBegin()}renderContextBegin(){this.m_rcontext.renderBegin()}synFBOSizeWithViewport(){this.m_rcontext.synFBOSizeWithViewport()}runMouseTest(t,e){let s=-1;if(null!=this.m_evt3DCtr&&this.m_mouseEvtEnabled){if(this.m_rayTestBoo&&this.m_evt3DCtr.getEvtType()>0){this.mouseRayTest();let t=this.m_rspace.getRaySelector();if(null!=t){let e=t.getSelectedNodesTotal();if(e>1){let s=0,i=t.getSelectedNodes(),r=null;for(;s<e;++s)r=i[s],r.entity.isPolyhedral()}}this.m_rayTestBoo=!1}s=this.m_evt3DCtr.run(t,e)}return this.m_mouseTestBoo=!1,s}update(t=!0,e=!0){if(t&&this.m_autoRunning&&(0!=this.m_runFlag&&this.runBegin(),this.m_runFlag=1),this.m_mouseTestBoo=!0,this.m_cullingTestBoo=!0,this.m_rayTestBoo=!0,null!=this.m_nodeWaitLinker){let t=this.m_nodeWaitLinker.getBegin();if(null!=t){let e,s,i;while(null!=t)t.entity.hasMesh()?(e=t,t=t.next,s=e.entity,i=e.rstatus,this.m_nodeWaitLinker.removeNode(e),this.m_nodeWaitQueue.removeEntity(e.entity),this.addEntity(s,i)):t=t.next}}let s=0;for(;s<this.m_childrenTotal;++s)this.m_children[s].update();this.m_renderer.update(),null!=this.m_rspace&&(this.m_rspace.update(),this.m_cullingTestBoo&&(null!=this.m_evt3DCtr||this.m_processUpdate||null!=this.m_rspace.getRaySelector())&&this.m_rspace.run()),this.m_processUpdate&&this.m_renderer.updateAllProcess(),this.m_mouseTestBoo&&!this.m_evtFlowEnabled&&(e?this.runMouseTest(1,0):null!=this.m_evt3DCtr&&this.m_evt3DCtr.mouseOutEventTarget())}cullingTest(){null!=this.m_rspace&&this.m_rspace.run(),this.m_cullingTestBoo=!1}mouseRayTest(){null!=this.m_rspace&&(this.m_renderProxy.getMouseXYWorldRay(this.m_mouse_rlpv,this.m_mouse_rltv),this.m_rspace.rayTest(this.m_mouse_rlpv,this.m_mouse_rltv))}run(t=!0){if(t&&this.m_autoRunning&&(1!=this.m_runFlag&&this.update(),this.m_runFlag=2),this.runnableQueue.run(),this.m_subscListLen>0)for(let e=0;e<this.m_processidsLen;++e)this.m_renderer.runAt(this.m_processids[e]);else this.m_renderer.run();t&&this.runEnd()}runAt(t){this.m_renderer.runAt(this.m_processids[t])}runEnd(){null!=this.m_evt3DCtr&&this.m_evt3DCtr.runEnd(),this.m_rcontext.runEnd(),null!=this.m_rspace&&this.m_rspace.runEnd(),this.m_autoRunning&&(this.m_runFlag=-1)}renderFlush(){null!=this.m_renderProxy&&this.m_renderProxy.flush()}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}toString(){return"[RendererScene(uid = "+this.m_uid+")]"}}x.s_uid=0,e.default=x},b30a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("352a"),r=s("644c"),a=s("20ef");class h{constructor(t,e,s){this.m_shdDict=new Map,this.m_shdList=[],this.m_shdListLen=0,this.m_sharedUniformList=[],this.m_unlocked=!0,this.m_preuid=-1,this.m_currShd=null,this.m_fragOutputTotal=1,this.m_rcuid=-1,this.m_rc=null,this.m_adapter=null,this.m_uniform=null,this.m_transformUniform=null,this.drawFlag=0,this.m_rcuid=t,this.m_adapter=s,this.m_rc=e}createResByParams3(t,e,s,i){return!1}getRC(){return this.m_rc}getRCUid(){return this.m_rcuid}useTransUniform(t){this.m_transformUniform!=t&&(this.m_transformUniform=t,t.use(this))}useUniform(t){this.m_uniform!=t&&(this.m_uniform=t,t.use(this))}create(t){let e=t.getUniqueShaderName();if(this.m_shdDict.has(e))return this.m_shdDict.get(e);let s=new a.default(this.m_shdListLen);return s.setShdData(t),this.m_shdList[s.getUid()]=s,this.m_sharedUniformList[s.getUid()]=null,++this.m_shdListLen,this.m_shdDict.set(e,s),i.default.SHADERCODE_TRACE_ENABLED&&console.log("this.Create() a new ShdProgram: ",s.toString()),s}findShdProgramByUid(t){return this.m_shdList[t]}findShdProgram(t){return this.m_shdDict.has(t)?this.m_shdDict.get(t):null}findShdProgramByShdData(t){return null!=t&&this.m_shdDict.has(t.getUniqueShaderName())?this.m_shdDict.get(t.getUniqueShaderName()):null}unlock(){this.m_unlocked=!0}isUnLocked(){return this.m_unlocked}lock(){this.m_unlocked=!1}setSharedUniformByShd(t,e){this.m_sharedUniformList[t.getUid()]=e}getSharedUniformByShd(t){return this.m_sharedUniformList[t.getUid()]}getCurrFragOutputTotal(){return this.m_fragOutputTotal}hasResUid(t){return null!=this.m_shdList[t]}bindToGpu(t){if(this.m_unlocked&&this.m_preuid!=t&&t>-1&&t<this.m_shdListLen){this.m_preuid=t;let s=this.m_shdList[t];this.m_fragOutputTotal=s.getFragOutputTotal(),this.m_fragOutputTotal!=this.getActiveAttachmentTotal()&&(console.log("shd.getUniqueShaderName(): "+s.getUniqueShaderName()),console.log("this.m_fragOutputTotal: "+this.m_fragOutputTotal+", rc.getActiveAttachmentTotal(): "+this.getActiveAttachmentTotal()),console.log("Error: MRT output amount is not equal to current shader( "+s.toString()+" ) frag shader output amount !!!")),this.m_rc.useProgram(s.getProgram()),s.useTexLocation();var e=this.m_sharedUniformList[s.getUid()];while(null!=e)e.use(this),e=e.next;this.m_currShd=s}}getGpuBuffer(t){return null}getCurrentShd(){return this.m_currShd}getCurrentShdUid(){return this.m_preuid}resetUniform(){this.m_uniform=null,this.m_transformUniform=null}renderBegin(){this.m_fragOutputTotal=1,this.m_preuid=-1,this.m_currShd=null,this.drawFlag=0}update(){}destroy(){this.m_rc=null,this.m_adapter=null}useUniformToCurrentShd(t){this.m_uniform!=t&&(this.m_uniform,t.useByShd(this,this.m_currShd))}useUniform2ToCurrentShd(t,e){this.m_uniform!=t&&(this.m_uniform,t.useByShd(this,this.m_currShd)),this.m_transformUniform!=e&&(this.m_transformUniform,e.useByShd(this,this.m_currShd))}useUniformMat4(t,e){this.m_rc.uniformMatrix4fv(t,!1,e)}useUniformV2(t,e,s,i,a){switch(e){case r.default.SHADER_MAT4:a<1?this.m_rc.uniformMatrix4fv(t,!1,s):this.m_rc.uniformMatrix4fv(t,!1,s,a,16*i);break;case r.default.SHADER_MAT3:this.m_rc.uniformMatrix3fv(t,!1,s,0,9*i);break;case r.default.SHADER_VEC4FV:this.m_rc.uniform4fv(t,s,a,4*i);break;case r.default.SHADER_VEC3FV:this.m_rc.uniform3fv(t,s,a,3*i);break;case r.default.SHADER_VEC4:this.m_rc.uniform4f(t,s[0],s[1],s[2],s[3]);break;case r.default.SHADER_VEC3:this.m_rc.uniform3f(t,s[0],s[1],s[2]);break;case r.default.SHADER_VEC2:this.m_rc.uniform2f(t,s[0],s[1]);break;default:break}}useUniformV1(t,e,s,i){switch(e){case r.default.SHADER_MAT4:this.m_rc.uniformMatrix4fv(t,!1,s);break;case r.default.SHADER_MAT3:this.m_rc.uniformMatrix3fv(t,!1,s);break;case r.default.SHADER_VEC4FV:this.m_rc.uniform4fv(t,s,4*i);break;case r.default.SHADER_VEC3FV:this.m_rc.uniform3fv(t,s,3*i);break;case r.default.SHADER_VEC4:this.m_rc.uniform4f(t,s[0],s[1],s[2],s[3]);break;case r.default.SHADER_VEC3:this.m_rc.uniform3f(t,s[0],s[1],s[2]);break;case r.default.SHADER_VEC2:this.m_rc.uniform2f(t,s[0],s[1]);break;default:break}}getActiveAttachmentTotal(){return this.m_adapter.getActiveAttachmentTotal()}}e.default=h},b3bd:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,s=e.length;for(let i=0;i<s;++i)if(t==e[i])return this.dataList[i]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let s=this.uniformNameList,i=s.length;for(let r=0;r<i;++r)if(t==s[r]){this.dataList[r]=e;break}}}copyDataFromProbe(t){this.types=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]);this.uniformSize=t.uniformsTotal}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.calcModels=null}}e.default=i},b88e:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("dd53");let r=new i.DemoMultiGpuContext,a=r;if(void 0!=a.runBegin){function h(){function t(e){a.runBegin(),a.run(),a.runEnd(),window.requestAnimationFrame(t)}console.log("------ demo --- init ------"),a.initialize(),window.requestAnimationFrame(t),console.log("------ demo --- running ------")}h()}else{function n(){function t(e){r.run(),window.requestAnimationFrame(t)}console.log("------ demo --- init ------"),r.initialize(),window.requestAnimationFrame(t),console.log("------ demo --- running ------")}n()}},b8ff:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("402a"),r=s("f63e"),a=s("f152");class h extends i.default{constructor(t=null){super(t),this.doubleTriFaceEnabled=!1,this.m_radius=50,this.m_longitudeNumSegments=10,this.m_latitudeNumSegments=10}createMaterial(t){if(null==this.getMaterial()){let e=new r.default;e.setTextureList(t),this.setMaterial(e)}else this.getMaterial().setTextureList(t)}initializeFrom(t,e=null){this.copyMeshFrom(t),this.copyMaterialFrom(t),this.createMaterial(e),this.activeDisplay()}initialize(t,e,s,i){this.m_radius=t,this.m_longitudeNumSegments=e,this.m_latitudeNumSegments=s,this.createMaterial(i),this.activeDisplay()}__activeMesh(t){if(null==this.getMesh()){let e=new a.default;e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.m_radius,this.m_longitudeNumSegments,this.m_latitudeNumSegments,this.doubleTriFaceEnabled),this.setMesh(e)}}toString(){return"[Sphere3DEntity(uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")]"}}e.default=h},b9b5:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("9c3c"),r=s("402a"),a=s("3930"),h=s("32cc");class n extends r.default{constructor(){super(),this.rayTestRadius=8,this.colorX=new a.default(1,0,0,1),this.colorY=new a.default(0,1,0,1),this.colorZ=new a.default(0,0,1,1),this.m_posarr=[0,0,0,100,0,0,0,0,0,0,100,0,0,0,0,0,0,100]}setLineWidth(t){}createMaterial(){if(null==this.getMaterial()){let t=new h.default;this.setMaterial(t)}}__activeMesh(t){if(null==this.getMesh()){let e=[this.colorX.r,this.colorX.g,this.colorX.b,this.colorX.r,this.colorX.g,this.colorX.b,this.colorY.r,this.colorY.g,this.colorY.b,this.colorY.r,this.colorY.g,this.colorY.b,this.colorZ.r,this.colorZ.g,this.colorZ.b,this.colorZ.r,this.colorZ.g,this.colorZ.b],s=new i.default;s.rayTestRadius=this.rayTestRadius,s.vbWholeDataEnabled=!1,s.setBufSortFormat(t.getBufSortFormat()),s.initialize(this.m_posarr,e),this.setMesh(s)}}initialize(t=100){t<2&&(t=2),this.m_posarr[3]=t,this.m_posarr[10]=t,this.m_posarr[17]=t,this.createMaterial(),this.activeDisplay()}initializeSizeXYZ(t,e,s){this.m_posarr[3]=t,this.m_posarr[10]=e,this.m_posarr[17]=s,this.createMaterial(),this.activeDisplay()}initializeCorssSizeXYZ(t,e,s){t*=.5,e*=.5,s*=.5,this.m_posarr[0]=-t,this.m_posarr[7]=-e,this.m_posarr[14]=-s,this.m_posarr[3]=t,this.m_posarr[10]=e,this.m_posarr[17]=s,this.createMaterial(),this.activeDisplay()}initializeCross(t=100){t<2&&(t=2),t*=.5,this.m_posarr[0]=-t,this.m_posarr[7]=-t,this.m_posarr[14]=-t,this.m_posarr[3]=t,this.m_posarr[10]=t,this.m_posarr[17]=t,this.createMaterial(),this.activeDisplay()}toString(){return"Axis3DEntity(name="+this.name+",uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=n},ba5e:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("faa5"),r=s("b3bd"),a=s("0fc4");class h extends i.default{constructor(){super(),this.m_uniqueName="",this.m_hasTex=!1}initialize(t){console.log("ScreenFixedPlaneShaderBuffer::initialize()... texEnabled: "+t),this.m_uniqueName="ScreenFixedPlaneShd",this.m_hasTex=t,t&&(this.m_uniqueName+="_tex")}getFragShaderCode(){let t="precision mediump float;\n";return this.m_hasTex?t+="uniform sampler2D u_sampler0;\nvarying vec2 v_texUV;\n":t+="uniform vec4 u_color;\n",t+="void main()\n{\n",this.m_hasTex?t+="gl_FragColor = texture2D(u_sampler0, v_texUV);\n":t+="gl_FragColor = u_color;\n",t+="}\n",t}getVtxShaderCode(){let t="precision mediump float;\nattribute vec3 a_vs;\n";return this.m_hasTex&&(t+="attribute vec2 a_uvs;\nvarying vec2 v_texUV;\n"),t+="void main()\n{\ngl_Position = vec4(a_vs,1.0);\n",this.m_hasTex&&(t+="v_texUV = a_uvs;\n"),t+="}\n",t}getUniqueShaderName(){return this.m_uniqueName}toString(){return"[ScreenFixedPlaneShaderBuffer()]"}static GetInstance(){return null!=h.___s_instance||(h.___s_instance=new h),h.___s_instance}}h.___s_instance=null;class n extends a.default{constructor(){super(),this.m_colorArray=new Float32Array([1,1,1,1])}getCodeBuf(){return h.GetInstance()}setRGB3f(t,e,s){this.m_colorArray[0]=t,this.m_colorArray[1]=e,this.m_colorArray[2]=s}setRGBA4f(t,e,s,i){this.m_colorArray[0]=t,this.m_colorArray[1]=e,this.m_colorArray[2]=s,this.m_colorArray[3]=i}createSharedUniform(){return null}createSelfUniformData(){let t=new r.default;return t.uniformNameList=["u_color"],t.dataList=[this.m_colorArray],t}}e.default=n},baae:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.FRAMEBUFFER=71,i.DRAW_FRAMEBUFFER=72,i.READ_FRAMEBUFFER=73,e.default=i},badb:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("1710"),r=s("ee5a");class a{constructor(){this.m_evtNodes=null,this.m_evtNodesLen=17,this.m_evtNodesLen=i.default.GetEvtTypeValueBase(),this.m_evtNodes=new Array(this.m_evtNodesLen)}getClassType(){return i.default.EventClassType}destroy(){for(let t=0;t<this.m_evtNodesLen;++t)this.m_evtNodes[t].destroy()}dispatchEvt(t){if(null!=t){let e=t.type-i.default.GetEvtTypeValueBase();if(e>=0&&e<i.default.GetEvtTypeValuesTotal()){if(null!=this.m_evtNodes[e])return this.m_evtNodes[e].dispatch(t)}else console.log("MouseEvt3DDispatcher::dispatchEvt(), Warn: undefined Event type.")}return 0}passTestEvt(t){if(null!=t){let e=t.type-i.default.GetEvtTypeValueBase();if(e>=0&&e<i.default.GetEvtTypeValuesTotal())return this.m_evtNodes[e].passTestEvt(t)}return 0}passTestPhase(t){let e=i.default.GetEvtTypeValuesTotal();for(let s=0;s<e;++s)if(null!=this.m_evtNodes[s]&&1==this.m_evtNodes[s].passTestPhase(t))return 1;return 0}addEventListener(t,e,s,a=!0,h=!1){if(null!=s&&null!=e){let n=t-i.default.GetEvtTypeValueBase();if(n>=0&&n<i.default.GetEvtTypeValuesTotal()){let t=0;a!=h&&(t=a?1:2),null!=this.m_evtNodes[n]||(this.m_evtNodes[n]=new r.default),this.m_evtNodes[n].addListener(e,s,t)}else console.log("MouseEvt3DDispatcher::addEventListener(), Warn: undefined Event type.")}}removeEventListener(t,e,s){if(null!=s&&null!=e){let r=t-i.default.GetEvtTypeValueBase();r>=0&&r<i.default.GetEvtTypeValuesTotal()&&null!=this.m_evtNodes[r]&&this.m_evtNodes[r].removeListener(e,s)}}}e.default=a},bbf4:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.CAMERA_VISIBLE_ENABLE=0,i.CAMERA_VISIBLE_DISABLE=1,e.default=i},bd6f:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("29ef"),r=s("402a"),a=s("f63e"),h=s("a254"),n=s("76b0");class l extends r.default{constructor(t=null){super(t),this.m_startX=0,this.m_startZ=0,this.m_pwidth=0,this.m_plong=0,this.m_flag=0,this.flipVerticalUV=!1,this.m_screenAlignEnabled=!1}setScreenAlignEnable(t){this.m_screenAlignEnabled=t}createMaterial(t){if(null==this.getMaterial())if(this.m_screenAlignEnabled){let e=new h.default;e.setTextureList(t),this.setMaterial(e)}else{let e=new a.default;e.setTextureList(t),this.setMaterial(e)}else this.getMaterial().setTextureList(t)}showDoubleFace(t=!1,e=!0){t?e?this.setRenderState(i.default.NONE_CULLFACE_NORMAL_ALWAYS_STATE):this.setRenderState(i.default.BACK_NORMAL_ALWAYS_STATE):e?this.setRenderState(i.default.NONE_CULLFACE_NORMAL_STATE):this.setRenderState(i.default.NORMAL_STATE)}toTransparentBlend(t=!1,e=!1){t?e?this.setRenderState(i.default.NONE_TRANSPARENT_ALWAYS_STATE):this.setRenderState(i.default.BACK_TRANSPARENT_ALWAYS_STATE):e?this.setRenderState(i.default.NONE_TRANSPARENT_STATE):this.setRenderState(i.default.BACK_TRANSPARENT_STATE)}toBrightnessBlend(t=!1,e=!1){t?e?this.setRenderState(i.default.NONE_ADD_ALWAYS_STATE):this.setRenderState(i.default.BACK_ADD_ALWAYS_STATE):e?this.setRenderState(i.default.NONE_ADD_BLENDSORT_STATE):this.setRenderState(i.default.BACK_ADD_BLENDSORT_STATE)}initializeFixScreen(t=null){this.initializeXOY(-1,-1,2,2,t)}initializeXOY(t,e,s,i,r=null){this.m_startX=t,this.m_startZ=e,this.m_pwidth=s,this.m_plong=i,this.m_flag=0,this.createMaterial(r),this.activeDisplay()}initializeXOYSquare(t,e=null){this.m_startX=-.5*t,this.m_startZ=-.5*t,this.m_pwidth=t,this.m_plong=t,this.m_flag=0,this.createMaterial(e),this.activeDisplay()}initializeXOZ(t,e,s,i,r=null){this.m_flag=1,this.m_startX=t,this.m_startZ=e,this.m_pwidth=s,this.m_plong=i,this.createMaterial(r),this.activeDisplay()}initializeYOZ(t,e,s,i,r=null){this.m_flag=2,this.m_startX=t,this.m_startZ=e,this.m_pwidth=s,this.m_plong=i,this.createMaterial(r),this.activeDisplay()}initializeXOZSquare(t,e=null){this.m_flag=1,this.m_startX=-.5*t,this.m_startZ=-.5*t,this.m_pwidth=t,this.m_plong=t,this.createMaterial(e),this.activeDisplay()}__activeMesh(t){if(null==this.getMesh()){let e=new n.default;e.flipVerticalUV=this.flipVerticalUV,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.axisFlag=this.m_flag,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.m_startX,this.m_startZ,this.m_pwidth,this.m_plong),this.setMesh(e)}}toString(){return"[Plane3DEntity]"}}e.default=l},c120:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8e17");class r{constructor(){this.entity=null,this.lpv=new i.default,this.wpv=new i.default,this.dis=0}}e.default=r},c497:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8e17");class r{constructor(t=null){this.m_matrix4AllocateSize=8192,this.m_mainDiv=null,this.m_renderContextAttri={depth:!0,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:!1,preserveDrawingBuffer:!0,powerPreference:"high-performance"},this.m_tickUpdateTime=20,this.m_polygonOffsetEnabled=!0,this.m_ditherEnabled=!1,this.autoSyncRenderBufferAndWindowSize=!0,this.maxWebGLVersion=2,this.cameraPerspectiveEnabled=!0,this.evtFlowEnabled=!1,this.camProjParam=new i.default(45,10,5e3),this.camPosition=new i.default(2e3,2e3,2e3),this.camLookAtPos=new i.default(0,0,0),this.camUpDirect=new i.default(0,1,0),this.batchEnabled=!0,this.processFixedState=!1,this.m_mainDiv=t}setTickUpdateTime(t){t=Math.round(t),this.m_tickUpdateTime=t>5?t:5}getTickUpdateTime(){return this.m_tickUpdateTime}setPolygonOffsetEanbled(t){this.m_polygonOffsetEnabled=t}getPolygonOffsetEanbled(){return this.m_polygonOffsetEnabled}setDitherEanbled(t){this.m_ditherEnabled=t}getDitherEanbled(){return this.m_ditherEnabled}getDiv(){return this.m_mainDiv}getRenderContextAttri(){return this.m_renderContextAttri}setAttriDepth(t){this.m_renderContextAttri.depth=t}setAttriStencil(t){this.m_renderContextAttri.stencil=t}setAttriAlpha(t){this.m_renderContextAttri.alpha=t}setAttriPremultipliedAlpha(t){this.m_renderContextAttri.premultipliedAlpha=t}setAttriAntialias(t){this.m_renderContextAttri.antialias=t}setAttripreserveDrawingBuffer(t){this.m_renderContextAttri.preserveDrawingBuffer=t}setAttriHightPowerPreference(t){this.m_renderContextAttri.powerPreference=t?"high-performance":"default"}setMatrix4AllocateSize(t){t<1024&&(t=1024),this.m_matrix4AllocateSize=t}getMatrix4AllocateSize(){return this.m_matrix4AllocateSize}setCamProject(t,e,s){if(e>=s)throw Error("Error Camera cear > far !!!");this.camProjParam.setTo(t,e,s)}setCamPosition(t,e,s){this.camPosition.setTo(t,e,s)}setCamLookAtPos(t,e,s){this.camLookAtPos.setTo(t,e,s)}setCamUpDirect(t,e,s){this.camUpDirect.setTo(t,e,s)}}e.default=r},c51d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("6e01"),r=s("8e17"),a=s("2139"),h=s("e214"),n=s("fecb"),l=s("3077");class _{constructor(t){this.m_uslotIndex=0,this.version=0,this.matUProbe=null,this.ufrustumProbe=null,this.uniformEnabled=!1,this.name="Camera",this.m_tempV=new r.default,this.m_tempV1=new r.default,this.m_initRV=new r.default,this.m_initUP=new r.default,this.m_lookRHEnabled=!0,this.m_matrix=a.default.GetMatrix(),this.m_viewMat=a.default.GetMatrix(),this.m_viewInvertMat=a.default.GetMatrix(),this.m_tempMat=a.default.GetMatrix(),this.m_projMat=a.default.GetMatrix(),this.m_camPos=new r.default,this.m_lookAtPos=new r.default,this.m_up=new r.default,this.m_lookDirectNV=new r.default,this.m_lookAtDirec=new r.default,this.m_nearPlaneWidth=1,this.m_nearPlaneHeight=1,this.m_viewX=0,this.m_viewY=0,this.m_viewW=800,this.m_viewH=600,this.m_viewHalfW=400,this.m_viewHalfH=300,this.m_fovy=0,this.m_aspect=1,this.m_zNear=.1,this.m_zFar=1e3,this.m_b=0,this.m_t=0,this.m_l=0,this.m_r=0,this.m_perspectiveEnabled=!1,this.m_project2Enabled=!1,this.m_rightHandEnabled=!0,this.m_rotateX=0,this.m_rotateY=0,this.m_rotateZ=0,this.m_viewFieldZoom=1,this.m_changed=!0,this.m_unlock=!0,this.m_devPRatio=0,this.m_rotDegree=0,this.m_rotAxis=new r.default,this.m_rotPivotPoint=null,this.m_axisRotEnabled=!1,this.m_frustumWAABB=new n.default,this.m_invViewMat=null,this.m_nearPlaneHalfW=.5,this.m_nearPlaneHalfH=.5,this.m_nearWCV=new r.default,this.m_farWCV=new r.default,this.m_wNV=new r.default,this.m_wFrustumVtxArr=[new r.default,new r.default,new r.default,new r.default,new r.default,new r.default,new r.default,new r.default,null,null,null],this.m_wFruPlaneList=[new h.default,new h.default,new h.default,new h.default,new h.default,new h.default],this.m_fpNVArr=[new r.default,new r.default,new r.default,new r.default,new r.default,new r.default],this.m_fpDisArr=[0,0,0,0,0,0],this.m_vpMat=a.default.GetMatrix(),this.m_uslotIndex=t}lock(){this.m_unlock=!1}unlock(){this.m_unlock=!0}lookAtLH(t,e,s){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtPos.copyFrom(e),this.m_up.copyFrom(s),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!1,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_initUP.copyFrom(s),this.m_initUP.normalize(),r.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}lookAtRH(t,e,s){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtPos.copyFrom(e),this.m_up.copyFrom(s),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_initUP.copyFrom(s),this.m_initUP.normalize(),r.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}getLookAtLH(t,e,s,i){i.lookAtLH(t,e,s)}getLookAtRH(t,e,s,i){i.lookAtRH(t,e,s)}perspectiveLH(t,e,s,i){this.m_unlock&&(this.m_project2Enabled=!1,this.m_aspect=e,this.m_fovy=t,this.m_zNear=s,this.m_zFar=i,this.m_projMat.perspectiveLH(t,e,s,i),this.m_viewFieldZoom=Math.tan(.5*t),this.m_perspectiveEnabled=!0,this.m_rightHandEnabled=!1,this.m_changed=!0)}perspectiveRH(t,e,s,i){this.m_unlock&&(this.m_aspect=e,this.m_fovy=t,this.m_zNear=s,this.m_zFar=i,this.m_projMat.perspectiveRH(t,e,s,i),this.m_viewFieldZoom=Math.tan(.5*t),this.m_project2Enabled=!1,this.m_perspectiveEnabled=!0,this.m_rightHandEnabled=!0,this.m_changed=!0)}perspectiveRH2(t,e,s,i,r){this.m_unlock&&(this.m_aspect=e/s,this.m_fovy=t,this.m_zNear=i,this.m_zFar=r,this.m_projMat.perspectiveRH2(t,e,s,i,r),this.m_viewFieldZoom=Math.tan(.5*t),this.m_perspectiveEnabled=!0,this.m_project2Enabled=!0,this.m_rightHandEnabled=!0,this.m_changed=!0)}getAspect(){return this.m_aspect}getViewFieldZoom(){return this.m_viewFieldZoom}orthoRH(t,e,s,i,r,a,h=1){this.m_unlock&&(this.m_zNear=t,this.m_zFar=e,this.m_b=s,this.m_t=i,this.m_l=r,this.m_r=a,this.m_projMat.orthoRH(s,i,r,a,t,e),this.m_perspectiveEnabled=!1,this.m_rightHandEnabled=!0,this.m_changed=!0)}orthoLH(t,e,s,i,r,a,h=1){this.m_unlock&&(this.m_zNear=t,this.m_zFar=e,this.m_b=s,this.m_t=i,this.m_l=r,this.m_r=a,this.m_projMat.orthoLH(Math.floor(h*s),Math.floor(h*i),Math.floor(h*r),Math.floor(h*a),t,e),this.m_perspectiveEnabled=!1,this.m_rightHandEnabled=!1,this.m_changed=!0)}perspectiveEnabled(){return this.m_perspectiveEnabled}rightHandEnabled(){return this.m_rightHandEnabled}setViewXY(t,e){this.m_unlock&&(this.m_viewX=t,this.m_viewY=e)}setViewSize(t,e,s=1){this.m_unlock&&(t!=this.m_viewW||e!=this.m_viewH||Math.abs(this.m_devPRatio-s)>.01)&&(this.m_devPRatio=s,this.m_viewW=t,this.m_viewH=e,this.m_viewHalfW=.5*t,this.m_viewHalfH=.5*e,this.m_perspectiveEnabled?this.m_project2Enabled?this.m_rightHandEnabled&&this.perspectiveRH2(this.m_fovy,t,e,this.m_zNear,this.m_zFar):this.m_rightHandEnabled?this.perspectiveRH(this.m_fovy,t/e,this.m_zNear,this.m_zFar):this.perspectiveLH(this.m_fovy,t/e,this.m_zNear,this.m_zFar):this.orthoRH(this.m_zNear,this.m_zFar,-.5*e,.5*e,-.5*t,.5*t,1))}translation(t){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtPos.x=t.x+this.m_lookAtDirec.x,this.m_lookAtPos.y=t.y+this.m_lookAtDirec.y,this.m_lookAtPos.z=t.z+this.m_lookAtDirec.z,this.m_changed=!0)}translationXYZ(t,e,s){this.m_unlock&&(this.m_camPos.setTo(t,e,s),this.m_lookAtPos.x=t+this.m_lookAtDirec.x,this.m_lookAtPos.y=e+this.m_lookAtDirec.y,this.m_lookAtPos.z=s+this.m_lookAtDirec.z,this.m_changed=!0)}forward(t){this.m_unlock&&(this.m_camPos.x+=this.m_lookDirectNV.x*t,this.m_camPos.y+=this.m_lookDirectNV.y*t,this.m_camPos.z+=this.m_lookDirectNV.z*t,this.m_lookAtPos.x=this.m_camPos.x+this.m_lookAtDirec.x,this.m_lookAtPos.y=this.m_camPos.y+this.m_lookAtDirec.y,this.m_lookAtPos.z=this.m_camPos.z+this.m_lookAtDirec.z,this.m_changed=!0)}forwardFixPos(t,e){this.m_unlock&&(this.m_camPos.x=e.x+this.m_lookDirectNV.x*t,this.m_camPos.y=e.y+this.m_lookDirectNV.y*t,this.m_camPos.z=e.z+this.m_lookDirectNV.z*t,this.m_lookAtPos.x=this.m_camPos.x+this.m_lookAtDirec.x,this.m_lookAtPos.y=this.m_camPos.y+this.m_lookAtDirec.y,this.m_lookAtPos.z=this.m_camPos.z+this.m_lookAtDirec.z,this.m_changed=!0)}swingHorizontalWithAxis(t,e){this.m_unlock&&(this.m_tempMat.identity(),null!=e?this.m_tempMat.appendRotation(t*i.default.MATH_PI_OVER_180,e):this.m_tempMat.appendRotation(t*i.default.MATH_PI_OVER_180,r.default.Y_AXIS),this.m_lookAtDirec.x=this.m_camPos.x-this.m_lookAtPos.x,this.m_lookAtDirec.y=this.m_camPos.y-this.m_lookAtPos.y,this.m_lookAtDirec.z=this.m_camPos.z-this.m_lookAtPos.z,this.m_tempMat.transformVectorSelf(this.m_lookAtDirec),this.m_camPos.x=this.m_lookAtDirec.x+this.m_lookAtPos.x,this.m_camPos.y=this.m_lookAtDirec.y+this.m_lookAtPos.y,this.m_camPos.z=this.m_lookAtDirec.z+this.m_lookAtPos.z,this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_tempMat.transformVectorSelf(this.m_initRV),this.m_initRV.normalize(),r.default.Cross(this.m_initRV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_changed=!0)}swingHorizontal(t){this.m_unlock&&(this.m_tempMat.identity(),this.m_tempMat.appendRotation(t*i.default.MATH_PI_OVER_180,this.m_up),this.m_lookAtDirec.x=this.m_camPos.x-this.m_lookAtPos.x,this.m_lookAtDirec.y=this.m_camPos.y-this.m_lookAtPos.y,this.m_lookAtDirec.z=this.m_camPos.z-this.m_lookAtPos.z,this.m_tempMat.transformVectorSelf(this.m_lookAtDirec),this.m_camPos.x=this.m_lookAtDirec.x+this.m_lookAtPos.x,this.m_camPos.y=this.m_lookAtDirec.y+this.m_lookAtPos.y,this.m_camPos.z=this.m_lookAtDirec.z+this.m_lookAtPos.z,this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),r.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}swingVertical(t){this.m_unlock&&(this.m_tempMat.identity(),this.m_tempMat.appendRotation(t*i.default.MATH_PI_OVER_180,this.m_initRV),this.m_lookAtDirec.x=this.m_camPos.x-this.m_lookAtPos.x,this.m_lookAtDirec.y=this.m_camPos.y-this.m_lookAtPos.y,this.m_lookAtDirec.z=this.m_camPos.z-this.m_lookAtPos.z,this.m_tempMat.transformVectorSelf(this.m_lookAtDirec),this.m_camPos.x=this.m_lookAtDirec.x+this.m_lookAtPos.x,this.m_camPos.y=this.m_lookAtDirec.y+this.m_lookAtPos.y,this.m_camPos.z=this.m_lookAtDirec.z+this.m_lookAtPos.z,this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),r.default.Cross(this.m_initRV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_initUP.copyFrom(this.m_up),this.m_changed=!0)}setPosition(t){if(this.m_unlock){r.default.Cross(this.m_lookAtDirec,this.m_up,this.m_tempV);var e=this.m_tempV.dot(this.m_initUP);this.m_tempV1.copyFrom(this.m_initUP),this.m_tempV1.scaleBy(e),this.m_tempV.subtractBy(this.m_tempV1),this.m_camPos.copyFrom(t),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),r.default.Cross(this.m_tempV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_changed=!0}}setPositionXYZ(t,e,s){if(this.m_unlock){r.default.Cross(this.m_lookAtDirec,this.m_up,this.m_tempV);var i=this.m_tempV.dot(this.m_initUP);this.m_tempV1.copyFrom(this.m_initUP),this.m_tempV1.scaleBy(i),this.m_tempV.subtractBy(this.m_tempV1),this.m_camPos.setTo(t,e,s),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),r.default.Cross(this.m_tempV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_changed=!0}}setLookPosXYZFixUp(t,e,s){this.m_unlock&&(this.m_lookAtPos.setTo(t,e,s),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),r.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}setPositionXYZFixUp(t,e,s){this.m_unlock&&(this.m_camPos.setTo(t,e,s),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),r.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}setPositionFixUp(t){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),r.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}copyFrom(t){let e=t.getPosition();this.m_camPos.copyFrom(e),e=t.getLookAtPosition(),this.m_lookAtPos.copyFrom(e),this.setZNear(t.getZNear()),this.setZFar(t.getZFar()),this.setNearPlaneWidth(t.getNearPlaneWidth()),this.setNearPlaneHeight(t.getNearPlaneHeight()),this.setPerspectiveEnabled(t.getPerspectiveEnabled()),this.m_viewInvertMat.copyFrom(t.getViewInvMatrix())}getNV(){return this.m_lookDirectNV}getUV(){return this.m_up}getRV(){return this.m_initRV}getPosition(){return this.m_camPos}setLookAtPosition(t,e,s){this.m_unlock&&(this.m_lookAtPos.setTo(t,e,s),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_changed=!0)}getPerspectiveEnabled(){return this.m_perspectiveEnabled}setPerspectiveEnabled(t){this.m_perspectiveEnabled=t}getLookAtPosition(){return this.m_lookAtPos}appendRotationByAxis(t,e,s=null){this.m_unlock&&(this.m_rotDegree=t,this.m_changed=!0,this.m_rotAxis.copyFrom(e),this.m_rotPivotPoint=s,this.m_axisRotEnabled=!0)}setRotationX(t){this.m_rotateX=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getRotationX(){return this.m_rotateX}setRotationY(t){this.m_rotateY=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getRotationY(){return this.m_rotateY}setRotationZ(t){this.m_rotateZ=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getRotationZ(){return this.m_rotateZ}setRotationXYZ(t,e,s){this.m_unlock&&(this.m_rotateX=t,this.m_rotateY=e,this.m_rotateZ=s,this.m_changed=!0,this.m_axisRotEnabled=!1)}screenXYToViewXYZ(t,e,s){t-=this.m_viewX,e-=this.m_viewY,this.m_perspectiveEnabled&&(t=this.m_nearPlaneWidth*(t-this.m_viewHalfW)/this.m_viewHalfW,e=this.m_nearPlaneHeight*(this.m_viewHalfH-e)/this.m_viewHalfH),s.setTo(t,e,-this.m_zNear)}screenXYToWorldXYZ(t,e,s){t-=this.m_viewX,e-=this.m_viewY,this.m_perspectiveEnabled&&(t=.5*this.m_nearPlaneWidth*(t-this.m_viewHalfW)/this.m_viewHalfW,e=.5*this.m_nearPlaneHeight*(this.m_viewHalfH-e)/this.m_viewHalfH),s.setTo(t,e,-this.m_zNear),s.w=1,this.m_viewInvertMat.transformVectorSelf(s)}getWorldPickingRayByScreenXY(t,e,s,i){t-=this.m_viewX,e-=this.m_viewY,this.m_perspectiveEnabled?(t=.5*this.m_nearPlaneWidth*(t-this.m_viewHalfW)/this.m_viewHalfW,e=.5*this.m_nearPlaneHeight*(e-this.m_viewHalfH)/this.m_viewHalfH,s.setTo(t,e,-this.m_zNear),s.w=1,this.m_viewInvertMat.transformVectorSelf(s),i.copyFrom(s),i.subtractBy(this.m_camPos),i.normalize()):(t-=this.m_viewHalfW,e-=this.m_viewHalfH,s.setTo(t,e,-this.m_zNear),s.w=1,this.m_viewInvertMat.transformVectorSelf(s),i.copyFrom(this.m_lookDirectNV))}calcScreenNormalizeXYByWorldPos(t,e){e.copyFrom(t),this.m_vpMat.transformVectorSelf(e),e.x/=e.w,e.y/=e.w}worldPosToScreen(t){this.m_viewMat.transformVector3Self(t),this.m_projMat.transformVectorSelf(t),t.x/=t.w,t.y/=t.w,t.x*=this.m_viewHalfW,t.y*=this.m_viewHalfH,t.x+=this.m_viewX,t.y+=this.m_viewY}calcViewRectByWorldSphere(t,e,s){this.m_viewMat.transformVector3Self(t),e*=1.15,s.x=t.x-e,s.y=t.y-e,s.z=t.z,t.x+=e,t.y+=e,this.m_projMat.transformPerspV4Self(s),this.m_projMat.transformPerspV4Self(t),t.z=1/t.w,s.z=t.x*t.z,s.w=t.y*t.z,s.z*=this.m_viewHalfW,s.w*=this.m_viewHalfH,s.x*=t.z,s.y*=t.z,s.x*=this.m_viewHalfW,s.y*=this.m_viewHalfH,s.z=s.z-s.x,s.w=s.w-s.y,s.x+=this.m_viewX,s.y+=this.m_viewY}calcScreenRectByWorldSphere(t,e,s){this.m_viewMat.transformVector3Self(t),e*=1.15,s.x=t.x-e,s.y=t.y-e,t.x+=e,t.y+=e,this.m_projMat.transformPerspV4Self(s),this.m_projMat.transformPerspV4Self(t),t.z=1/t.w,s.z=t.x*t.z,s.w=t.y*t.z,s.x*=t.z,s.y*=t.z,s.z=s.z-s.x,s.w=s.w-s.y}getInvertViewMatrix(){return this.m_invViewMat}getZNear(){return this.m_zNear}setZNear(t){this.m_zNear=t}getZFar(){return this.m_zFar}setZFar(t){this.m_zFar=t}getNearPlaneWidth(){return this.m_nearPlaneWidth}setNearPlaneWidth(t){this.m_nearPlaneWidth=t}getNearPlaneHeight(){return this.m_nearPlaneHeight}setNearPlaneHeight(t){this.m_nearPlaneHeight=t}getFov(){return this.m_fovy}__calcTestParam(){null==this.m_invViewMat&&(this.m_invViewMat=a.default.GetMatrix()),this.m_invViewMat.copyFrom(this.m_viewMat),this.m_invViewMat.invert();let t=null,e=Math.tan(.5*this.m_fovy),s=this.m_zNear*e,i=s*this.m_aspect;this.m_nearPlaneHalfW=i,this.m_nearPlaneHalfH=s;let h=this.m_zFar*e,n=h*this.m_aspect;this.m_nearWCV.setTo(0,0,-this.m_zNear),this.m_farWCV.setTo(0,0,-this.m_zFar),this.m_invViewMat.transformVectorSelf(this.m_nearWCV),this.m_invViewMat.transformVectorSelf(this.m_farWCV),this.m_wNV.x=this.m_farWCV.x-this.m_nearWCV.x,this.m_wNV.y=this.m_farWCV.y-this.m_nearWCV.y,this.m_wNV.z=this.m_farWCV.z-this.m_nearWCV.z,this.m_wNV.normalize(),t=this.m_wFruPlaneList[0],t.nv.copyFrom(this.m_wNV),t.distance=t.nv.dot(this.m_farWCV),t.position.copyFrom(this.m_farWCV),t=this.m_wFruPlaneList[1],t.nv.copyFrom(this.m_wFruPlaneList[0].nv),t.distance=t.nv.dot(this.m_nearWCV),t.position.copyFrom(this.m_nearWCV),this.m_wFrustumVtxArr[8]=this.m_nearWCV,this.m_wFrustumVtxArr[9]=this.m_farWCV,this.m_wFrustumVtxArr[11]=this.m_wNV,this.m_wFrustumVtxArr[0].setTo(-n,-h,-this.m_zFar),this.m_wFrustumVtxArr[1].setTo(n,-h,-this.m_zFar),this.m_wFrustumVtxArr[2].setTo(n,h,-this.m_zFar),this.m_wFrustumVtxArr[3].setTo(-n,h,-this.m_zFar),this.m_wFrustumVtxArr[4].setTo(-i,-s,-this.m_zNear),this.m_wFrustumVtxArr[5].setTo(i,-s,-this.m_zNear),this.m_wFrustumVtxArr[6].setTo(i,s,-this.m_zNear),this.m_wFrustumVtxArr[7].setTo(-i,s,-this.m_zNear),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[0]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[1]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[2]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[3]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[4]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[5]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[6]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[7]),this.m_frustumWAABB.max.setTo(-9999999,-9999999,-9999999),this.m_frustumWAABB.min.setTo(9999999,9999999,9999999);for(let r=0;r<8;++r)this.m_frustumWAABB.addPosition(this.m_wFrustumVtxArr[r]);this.m_frustumWAABB.updateFast();let l=this.m_wFrustumVtxArr[0],_=this.m_wFrustumVtxArr[4];this.m_tempV.x=l.x-_.x,this.m_tempV.y=l.y-_.y,this.m_tempV.z=l.z-_.z,l=this.m_wFrustumVtxArr[1],_=this.m_wFrustumVtxArr[5],this.m_tempV1.x=l.x-_.x,this.m_tempV1.y=l.y-_.y,this.m_tempV1.z=l.z-_.z,t=this.m_wFruPlaneList[3],r.default.Cross(this.m_tempV1,this.m_tempV,t.nv),t.nv.normalize(),t.distance=t.nv.dot(l),t.position.copyFrom(l),l=this.m_wFrustumVtxArr[3],_=this.m_wFrustumVtxArr[7],this.m_tempV.x=l.x-_.x,this.m_tempV.y=l.y-_.y,this.m_tempV.z=l.z-_.z,l=this.m_wFrustumVtxArr[2],_=this.m_wFrustumVtxArr[6],this.m_tempV1.x=l.x-_.x,this.m_tempV1.y=l.y-_.y,this.m_tempV1.z=l.z-_.z,t=this.m_wFruPlaneList[2],r.default.Cross(this.m_tempV1,this.m_tempV,t.nv),t.nv.normalize(),t.distance=t.nv.dot(l),t.position.copyFrom(l),l=this.m_wFrustumVtxArr[0],_=this.m_wFrustumVtxArr[4],this.m_tempV.x=l.x-_.x,this.m_tempV.y=l.y-_.y,this.m_tempV.z=l.z-_.z,l=this.m_wFrustumVtxArr[3],_=this.m_wFrustumVtxArr[7],this.m_tempV1.x=l.x-_.x,this.m_tempV1.y=l.y-_.y,this.m_tempV1.z=l.z-_.z,t=this.m_wFruPlaneList[4],r.default.Cross(this.m_tempV,this.m_tempV1,t.nv),t.nv.normalize(),t.distance=t.nv.dot(l),t.position.copyFrom(l),l=this.m_wFrustumVtxArr[1],_=this.m_wFrustumVtxArr[5],this.m_tempV.x=l.x-_.x,this.m_tempV.y=l.y-_.y,this.m_tempV.z=l.z-_.z,l=this.m_wFrustumVtxArr[2],_=this.m_wFrustumVtxArr[6],this.m_tempV1.x=l.x-_.x,this.m_tempV1.y=l.y-_.y,this.m_tempV1.z=l.z-_.z,t=this.m_wFruPlaneList[5],r.default.Cross(this.m_tempV,this.m_tempV1,t.nv),t.nv.normalize(),t.distance=t.nv.dot(l),t.position.copyFrom(l),this.m_fpNVArr[0].copyFrom(this.m_wFruPlaneList[0].nv),this.m_fpNVArr[1].copyFrom(this.m_wFruPlaneList[1].nv),this.m_fpNVArr[1].scaleBy(-1),this.m_fpNVArr[2].copyFrom(this.m_wFruPlaneList[2].nv),this.m_fpNVArr[3].copyFrom(this.m_wFruPlaneList[3].nv),this.m_fpNVArr[3].scaleBy(-1),this.m_fpNVArr[4].copyFrom(this.m_wFruPlaneList[4].nv),this.m_fpNVArr[4].scaleBy(-1),this.m_fpNVArr[5].copyFrom(this.m_wFruPlaneList[5].nv),this.m_fpDisArr[0]=this.m_wFruPlaneList[0].distance,this.m_fpDisArr[1]=-this.m_wFruPlaneList[1].distance,this.m_fpDisArr[2]=this.m_wFruPlaneList[2].distance,this.m_fpDisArr[3]=-this.m_wFruPlaneList[3].distance,this.m_fpDisArr[4]=-this.m_wFruPlaneList[4].distance,this.m_fpDisArr[5]=this.m_wFruPlaneList[5].distance}getWordFrustumWAABB(){return this.m_frustumWAABB}getWordFrustumWAABBCenter(){return this.m_frustumWAABB.center}getWordFrustumVtxArr(){return this.m_wFrustumVtxArr}getWordFrustumPlaneArr(){return this.m_wFruPlaneList}visiTestSphere2(t,e){let s=this.m_fpNVArr[0].dot(t)-this.m_fpDisArr[0]-e>i.default.MATH_MIN_POSITIVE;return!s&&(s=this.m_fpNVArr[1].dot(t)-this.m_fpDisArr[1]-e>i.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[2].dot(t)-this.m_fpDisArr[2]-e>i.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[3].dot(t)-this.m_fpDisArr[3]-e>i.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[4].dot(t)-this.m_fpDisArr[4]-e>i.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[5].dot(t)-this.m_fpDisArr[5]-e>i.default.MATH_MIN_POSITIVE,!s)))))}visiTestSphere3(t,e,s){let r=this.m_fpNVArr[0].dot(t)-this.m_fpDisArr[0]+s-e>i.default.MATH_MIN_POSITIVE;return!r&&(r=this.m_fpNVArr[1].dot(t)-this.m_fpDisArr[1]-e>i.default.MATH_MIN_POSITIVE,!r&&(r=this.m_fpNVArr[2].dot(t)-this.m_fpDisArr[2]-e>i.default.MATH_MIN_POSITIVE,!r&&(r=this.m_fpNVArr[3].dot(t)-this.m_fpDisArr[3]-e>i.default.MATH_MIN_POSITIVE,!r&&(r=this.m_fpNVArr[4].dot(t)-this.m_fpDisArr[4]-e>i.default.MATH_MIN_POSITIVE,!r&&(r=this.m_fpNVArr[5].dot(t)-this.m_fpDisArr[5]-e>i.default.MATH_MIN_POSITIVE,!r)))))}visiTestPosition(t){let e=this.m_fpNVArr[0].dot(t)-this.m_fpDisArr[0]>i.default.MATH_MIN_POSITIVE;return!e&&(e=this.m_fpNVArr[1].dot(t)-this.m_fpDisArr[1]>i.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[2].dot(t)-this.m_fpDisArr[2]>i.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[3].dot(t)-this.m_fpDisArr[3]>i.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[4].dot(t)-this.m_fpDisArr[4]>i.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[5].dot(t)-this.m_fpDisArr[5]>i.default.MATH_MIN_POSITIVE,!e)))))}visiTestPlane(t,e){let s=t.dot(this.m_wFruPlaneList[0].position)-e,r=s*(t.dot(this.m_wFruPlaneList[1].position)-e);return r<i.default.MATH_MIN_POSITIVE||(r=s*(t.dot(this.m_wFruPlaneList[2].position)-e),r<i.default.MATH_MIN_POSITIVE||(r=s*(t.dot(this.m_wFruPlaneList[3].position)-e),r<i.default.MATH_MIN_POSITIVE||(r=s*(t.dot(this.m_wFruPlaneList[4].position)-e),r<i.default.MATH_MIN_POSITIVE||(r=s*(t.dot(this.m_wFruPlaneList[5].position)-e),r<i.default.MATH_MIN_POSITIVE))))}visiTestSphere(t,e){let s=this.m_frustumWAABB.sphereIntersect(t,e);if(s){let s=this.m_wFruPlaneList[0].intersectSphere(t,e),i=this.m_wFruPlaneList[1].intersectSphere(t,e);return!(s*i>=0&&!this.m_wFruPlaneList[0].intersectBoo&&!this.m_wFruPlaneList[1].intersectBoo)&&(s=this.m_wFruPlaneList[2].intersectSphere(t,e),i=this.m_wFruPlaneList[3].intersectSphere(t,e),!(s*i>=0&&!this.m_wFruPlaneList[2].intersectBoo&&!this.m_wFruPlaneList[3].intersectBoo)&&(s=this.m_wFruPlaneList[4].intersectSphere(t,e),i=this.m_wFruPlaneList[5].intersectSphere(t,e),!(s*i>=0&&!this.m_wFruPlaneList[4].intersectBoo&&!this.m_wFruPlaneList[5].intersectBoo)))}return!1}visiTestAABB(t){let e=t.center,s=t.radius,i=this.m_frustumWAABB.sphereIntersect(e,s);if(i){let t=this.m_wFruPlaneList[0].intersectSphere(e,s),i=this.m_wFruPlaneList[1].intersectSphere(e,s);return!(t*i>=0&&!this.m_wFruPlaneList[0].intersectBoo&&!this.m_wFruPlaneList[1].intersectBoo)&&(t=this.m_wFruPlaneList[2].intersectSphere(e,s),i=this.m_wFruPlaneList[3].intersectSphere(e,s),!(t*i>=0&&!this.m_wFruPlaneList[2].intersectBoo&&!this.m_wFruPlaneList[3].intersectBoo)&&(t=this.m_wFruPlaneList[4].intersectSphere(e,s),i=this.m_wFruPlaneList[5].intersectSphere(e,s),!(t*i>=0&&!this.m_wFruPlaneList[4].intersectBoo&&!this.m_wFruPlaneList[5].intersectBoo)))}return!1}update(){this.m_changed&&(this.version++,this.m_changed=!1,this.m_axisRotEnabled?this.m_matrix.appendRotationPivot(this.m_rotDegree*i.default.MATH_PI_OVER_180,this.m_rotAxis,this.m_rotPivotPoint):(this.m_matrix.identity(),this.m_matrix.appendRotationEulerAngle(this.m_rotateX*i.default.MATH_PI_OVER_180,this.m_rotateY*i.default.MATH_PI_OVER_180,this.m_rotateZ*i.default.MATH_PI_OVER_180)),this.m_lookRHEnabled?this.m_viewMat.lookAtRH(this.m_camPos,this.m_lookAtPos,this.m_up):this.m_viewMat.lookAtLH(this.m_camPos,this.m_lookAtPos,this.m_up),this.m_project2Enabled?(this.m_nearPlaneWidth=this.m_zNear*Math.tan(.5*this.m_fovy)*2,this.m_nearPlaneHeight=this.m_nearPlaneWidth/this.m_aspect):(this.m_nearPlaneHeight=this.m_zNear*Math.tan(.5*this.m_fovy)*2,this.m_nearPlaneWidth=this.m_aspect*this.m_nearPlaneHeight),this.m_viewMat.append(this.m_matrix),this.m_viewInvertMat.copyFrom(this.m_viewMat),this.m_viewInvertMat.invert(),this.m_vpMat.identity(),this.m_vpMat.copyFrom(this.m_viewMat),this.m_vpMat.append(this.m_projMat),this.__calcTestParam(),this.updateUniformData())}updateCamMatToUProbe(t){t.isEnabled()&&(t.update(),t.getFS32At(0).set(this.m_viewMat.getLocalFS32(),0),t.getFS32At(1).set(this.m_projMat.getLocalFS32(),0))}updateUniformData(){this.uniformEnabled&&(null==this.matUProbe&&(this.matUProbe=new l.default,this.matUProbe.bindSlotAt(this.m_uslotIndex),this.matUProbe.addMat4Data(new Float32Array(16),1),this.matUProbe.addMat4Data(new Float32Array(16),1)),this.updateCamMatToUProbe(this.matUProbe),null==this.ufrustumProbe?(this.ufrustumProbe=new l.default,this.ufrustumProbe.bindSlotAt(this.m_uslotIndex),this.ufrustumProbe.addVec4Data(new Float32Array([this.m_zNear,this.m_zFar,this.m_nearPlaneHalfW,this.m_nearPlaneHalfH]),1)):this.ufrustumProbe.setVec4DataAt(0,this.m_zNear,this.m_zFar,this.m_nearPlaneHalfW,this.m_nearPlaneHalfH),this.ufrustumProbe.update())}destroy(){}lookRHEnabled(){return this.m_lookRHEnabled}lookLHEnabled(){return!this.m_lookRHEnabled}getVPMatrix(){return this.m_vpMat}getViewMatrix(){return this.m_viewMat}getViewInvMatrix(){return this.m_viewInvertMat}getProjectMatrix(){return this.m_projMat}toString(){return"[Object CameraBase()]"}}e.default=_},c62b:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8e17"),r=s("e08e"),a=s("7c63"),h=s("29ef");class n{constructor(){this.uid=-1,this.value=-1,this.__$rpuid=-1,this.__$rprouid=-1,this.shader=null,this.pos=new i.default,this.bounds=null,this.ibufType=0,this.ibufStep=2,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.drawOffset=0,this.partTotal=0,this.partGroup=null,this.trisNumber=0,this.visible=!0,this.drawEnabled=!0,this.drawMode=0,this.renderState=0,this.rcolorMask=0,this.drawFlag=0,this.vro=null,this.transUniform=null,this.uniform=null,this.shdUid=-1,this.vtxUid=-1,this.tro=null,this.texMid=-1,this.ubo=null}testDrawFlag(){this.shader.drawFlag!=this.drawFlag&&(this.shader.drawFlag=this.drawFlag,a.RenderStateObject.UseRenderState(this.renderState),a.RenderColorMask.UseRenderState(this.rcolorMask))}getUid(){return this.uid}getRPOUid(){return this.__$rpuid}getRPROUid(){return this.__$rprouid}getShaderUid(){return this.shdUid}setIvsParam(t,e){this.ivsIndex=t,this.ivsCount=e,this.drawOffset=t*this.ibufStep,this.drawEnabled=this.visible&&this.ivsCount>0}setVisible(t){this.visible=t,this.drawEnabled=t&&this.ivsCount>0}setDrawFlag(t,e){this.renderState=t,this.rcolorMask=e,this.drawFlag=(e<<10)+t}drawThis(t){switch(++h.default.DrawCallTimes,h.default.DrawTrisNumber+=this.trisNumber,this.drawMode){case r.RenderDrawMode.ELEMENTS_TRIANGLES:t.RContext.drawElements(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:t.RContext.drawElements(t.TRIANGLE_STRIP,this.ivsCount,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:t.RContext.drawElementsInstanced(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset,this.insCount);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:t.RContext.drawElements(t.TRIANGLE_FAN,this.ivsCount,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ARRAYS_LINES:t.RContext.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case r.RenderDrawMode.ARRAYS_LINE_STRIP:t.RContext.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}drawPart(t){++h.default.DrawCallTimes,h.default.DrawTrisNumber+=this.trisNumber;let e=0,s=t.RContext;switch(this.drawMode){case r.RenderDrawMode.ELEMENTS_TRIANGLES:for(;e<this.partTotal;)s.drawElements(t.TRIANGLES,this.partGroup[e++],this.ibufType,this.partGroup[e++]);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:s.drawElements(t.TRIANGLE_STRIP,this.ivsCount,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:s.drawElementsInstanced(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset,this.insCount);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:s.drawElements(t.TRIANGLE_FAN,this.ivsCount,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ARRAYS_LINES:s.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case r.RenderDrawMode.ARRAYS_LINE_STRIP:s.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}run2(t){null!=this.ubo&&this.ubo.run(t),null==this.shader&&console.log("this.shader == null unit this.uid: ",this.uid),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}run(t){null!=this.ubo&&this.ubo.run(t),this.vro.run(),this.tro.run(),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}runLockMaterial2(){this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(this.uniform,this.transUniform)}runLockMaterial(){this.vro.run(),this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(this.uniform,this.transUniform)}reset(){this.vro.__$detachThis(),this.vro=null,this.tro.__$detachThis(),this.tro=null,this.texMid=-1,this.__$rprouid=-1,this.ubo=null,this.shdUid=-1,this.vtxUid=-1,this.uniform=null,this.transUniform=null,this.partGroup=null,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.partTotal=0,this.drawMode=0,this.drawFlag=0,this.renderState=0,this.rcolorMask=0,this.drawEnabled=!0,this.shader=null,this.bounds=null}destroy(){this.reset()}toString(){return"[RPOUnit(uid = "+this.uid+")]"}}e.default=n},c711:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("6e01"),r=s("8e17"),a=s("fecb"),h=s("c120");class n{constructor(){this.m_renderer=null,this.m_camera=null,this.m_headNode=null,this.m_rsn=null,this.m_hitList=new Uint8Array(256),this.m_rsnList=null,this.m_selectedNode=null,this.m_selectedTotal=0,this.m_testMode=0,this.m_invpv=new r.default,this.m_invtv=new r.default,this.m_rlpv=null,this.m_rltv=null,this.m_rlsiv=new Uint8Array(4),this.m_rlinvtv=new r.default,this.m_outv=new r.default,this.m_vecs=[null,null],this.m_gpuTestEnabled=!1}setRenderer(t){this.m_renderer=t}setRayTestMode(t){this.m_testMode=t}setRay(t,e){this.m_rlpv=t,this.m_rltv=e}getRay(t,e){t.copyFrom(this.m_rlpv),e.copyFrom(this.m_rltv)}setCamera(t){this.m_camera=t}setCullingNodeHead(t){if(this.m_headNode=t,null==this.m_rsnList){this.m_rsnList=[];let t=0;for(;t<256;++t)this.m_rsnList.push(new h.default)}}getSelectedNode(){return this.m_selectedNode}getSelectedNodes(){return this.m_rsnList}getSelectedNodesTotal(){return this.m_selectedTotal}sorting(t,e){let s=this.m_rsnList;this.m_rsn=s[t];while(t<e){while(t<e&&s[e].dis>=this.m_rsn.dis)--e;s[t]=s[e];while(t<e&&s[t].dis<=this.m_rsn.dis)++t;s[e]=s[t]}return s[t]=this.m_rsn,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}run(){let t=this.m_headNode;if(null!=t){let e=0,s=this.m_rltv,r=this.m_rlpv,h=this.m_outv,n=null,l=0;Math.abs(s.x)>i.default.MATH_MIN_POSITIVE?this.m_rlinvtv.x=1/s.x:this.m_rlinvtv.x=i.default.MATH_MAX_POSITIVE,Math.abs(s.y)>i.default.MATH_MIN_POSITIVE?this.m_rlinvtv.y=1/s.y:this.m_rlinvtv.y=i.default.MATH_MAX_POSITIVE,Math.abs(s.z)>i.default.MATH_MIN_POSITIVE?this.m_rlinvtv.z=1/s.z:this.m_rlinvtv.z=i.default.MATH_MAX_POSITIVE,this.m_rlinvtv.x<0?this.m_rlsiv[0]=1:this.m_rlsiv[0]=0,this.m_rlinvtv.y<0?this.m_rlsiv[1]=1:this.m_rlsiv[1]=0,this.m_rlinvtv.z<0?this.m_rlsiv[2]=1:this.m_rlsiv[2]=0;while(null!=t)t.drawEnabled&&t.entity.mouseEnabled&&(h.x=t.bounds.center.x-r.x,h.y=t.bounds.center.y-r.y,h.z=t.bounds.center.z-r.z,e=h.dot(s),h.x-=e*s.x,h.y-=e*s.y,h.z-=e*s.z,h.getLengthSquared()<=t.bounds.radius2&&t.rayTestState<1&&(this.m_vecs[0]=t.bounds.min,this.m_vecs[1]=t.bounds.max,a.default.IntersectionRL3(this.m_vecs,this.m_rlsiv,this.m_rlinvtv,s,r,h)&&(n=this.m_rsnList[l],n.entity=t.entity,n.dis=this.m_rlinvtv.w,n.wpv.copyFrom(h),++l))),t=t.next;this.m_selectedNode=null;let _=0;if(l>0){let t=this.m_invpv,e=this.m_invtv,i=null,a=0,n=0,o=null,m=null,u=s.dot(r),d=0;if(l>1){this.snsort(0,l-1);let c=!this.m_gpuTestEnabled;for(_=0;_<l;++_){if(m=this.m_rsnList[_],i=this.m_rsnList[_].entity,i.isPolyhedral()?c?(o=i.getInvMatrix(),o.transformOutVector3(r,t),o.deltaTransformOutVector(s,e),a=i.testRay(t,e,h,!0)):a=0:(o=i.getInvMatrix(),o.transformOutVector3(r,t),o.deltaTransformOutVector(s,e),a=i.testRay(t,e,h,!0)),a>0){if(m.lpv.copyFrom(h),i.getMatrix().transformOutVector3(h,m.wpv),m.dis=s.dot(m.wpv)-u,this.m_hitList[n]=_,++n,m.dis>d){this.m_selectedNode=m;break}}else if(a<0&&(this.m_hitList[n]=_,++n,m.dis>d)){this.m_selectedNode=m;break}d=m.dis}null==this.m_selectedNode&&n>0&&(this.m_selectedNode=this.m_rsnList[this.m_hitList[0]])}else m=this.m_rsnList[0],i=this.m_rsnList[0].entity,o=i.getInvMatrix(),o.transformOutVector3(r,t),o.deltaTransformOutVector(s,e),a=i.testRay(t,e,h,!0),a>0?(m.lpv.copyFrom(h),i.getMatrix().transformOutVector3(h,m.wpv),m.dis=s.dot(m.wpv)-u,this.m_selectedNode=m):a<0&&(this.m_selectedNode=m)}for(_=l;_<this.m_selectedTotal;++_)this.m_selectedNode!=this.m_rsnList[_]&&(this.m_rsnList[_].entity=null);this.m_selectedTotal=l}}}e.default=n},c8c5:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("29ef"),r=s("402a"),a=s("ba5e"),h=s("76b0"),n=s("cc48");class l extends r.default{constructor(){super(),this.m_startX=0,this.m_startZ=0,this.m_pwidth=0,this.m_plong=0,this.m_flag=0,this.m_currMaterial=null,this.flipVerticalUV=!1}setRGB3f(t,e,s){this.m_currMaterial.setRGB3f(t,e,s)}setRGBA4f(t,e,s,i){this.m_currMaterial.setRGBA4f(t,e,s,i)}createMaterial(t){null==this.getMaterial()?(this.m_currMaterial=new a.default,this.m_currMaterial.setTextureList(t),this.setMaterial(this.m_currMaterial)):this.getMaterial().setTextureList(t)}showDoubleFace(t=!1,e=!0){t?e?this.setRenderState(i.default.NONE_CULLFACE_NORMAL_ALWAYS_STATE):this.setRenderState(i.default.BACK_NORMAL_ALWAYS_STATE):e?this.setRenderState(i.default.NONE_CULLFACE_NORMAL_STATE):this.setRenderState(i.default.NORMAL_STATE)}toTransparentBlend(t=!1,e=!1){t?e?this.setRenderState(i.default.NONE_TRANSPARENT_ALWAYS_STATE):this.setRenderState(i.default.BACK_TRANSPARENT_ALWAYS_STATE):e?this.setRenderState(i.default.NONE_TRANSPARENT_STATE):this.setRenderState(i.default.BACK_TRANSPARENT_STATE)}toBrightnessBlend(t=!1,e=!1){t?e?this.setRenderState(i.default.NONE_ADD_ALWAYS_STATE):this.setRenderState(i.default.BACK_ADD_ALWAYS_STATE):e?this.setRenderState(i.default.NONE_ADD_BLENDSORT_STATE):this.setRenderState(i.default.BACK_ADD_BLENDSORT_STATE)}initialize(t,e,s,i,r=null){this.m_startX=t,this.m_startZ=e,this.m_pwidth=s,this.m_plong=i,this.m_flag=0,this.spaceCullMask=n.default.NONE,this.createMaterial(r),this.activeDisplay()}__activeMesh(t){if(null==this.getMesh()){let e=new h.default;e.flipVerticalUV=this.flipVerticalUV,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.axisFlag=0,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.m_startX,this.m_startZ,this.m_pwidth,this.m_plong),this.setMesh(e)}}destroy(){super.destroy(),this.m_currMaterial=null}toString(){return"[ScreenFixedAlignPlaneEntity]"}}e.default=l},ca6c:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static PushThreeBitValueToInt(t,e){return(t<<3)+e}static PopThreeBitValueFromInt(t){return i.value=7&t,t>>3}static ContainsBit(t,e){return(e&t)>0}static RemoveBit(t,e){return~e&t}static AddBit(t,e){return e|t}static AssembleFromIntArray(t){let e=0,s=0,i=t.length;for(;e<i;++e)t[e]>0&&(s|=1<<e);return s}}i.BIT_ZERO=0,i.BIT_ONE_0=1,i.BIT_ONE_1=2,i.BIT_ONE_2=4,i.BIT_ONE_3=8,i.BIT_ONE_4=16,i.BIT_ONE_5=32,i.BIT_ONE_6=64,i.BIT_ONE_7=128,i.BIT_ONE_8=256,i.BIT_ONE_9=512,i.BIT_ONE_10=1024,i.BIT_ONE_11=2048,i.value=0,e.default=i},cb29:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8a0a"),r=s("8a0a"),a=s("e7d2"),h=s("e08e");class n{constructor(t=i.default.VTX_STATIC_DRAW){this.m_bufDataUsage=0,this.m_layoutBit=0,this.m_transMatrix=null,this.m_vbuf=null,this.m_ivs=null,this.m_bufDataList=null,this.m_bufDataStepList=null,this.m_bufStatusList=null,this.bounds=null,this.normalType=r.VtxNormalType.GOURAND,this.normalScale=1,this.vtxTotal=0,this.trisNumber=0,this.drawMode=h.RenderDrawMode.ELEMENTS_TRIANGLES,this.vtCount=0,this.vbWholeDataEnabled=!1,this.drawInsBeginIndex=0,this.drawInsStride=0,this.drawInsTotal=0,this.m_attachCount=0,this.m_bufDataUsage=t}buildEnd(){this.m_bufDataList=a.default.BufDataList,this.m_bufDataStepList=a.default.BufDataStepList,this.m_bufStatusList=a.default.BufStatusList}setTransformMatrix(t){this.m_transMatrix=t}getTransformMatrix(){return this.m_transMatrix}isPolyhedral(){return!0}setPolyhedral(t){}testRay(t,e,s,i){return-1}rebuild(){if(null==this.m_vbuf&&null!=this.m_bufDataList){console.log("MeshBase::rebuild()..."),a.default.Reset();let t=0,e=this.m_bufDataList.length;for(;t<e;++t)a.default.AddFloat32Data(this.m_bufDataList[t],this.m_bufDataStepList[t],this.m_bufStatusList[t]);this.m_vbuf=a.default.CreateBySaveData(this.getBufDataUsage()),null!=this.m_ivs&&(this.m_vbuf.setUint16IVSData(this.m_ivs),this.vtCount=this.m_ivs.length)}}__$attachVBuf(){return null==this.m_vbuf&&this.rebuild(),a.default.__$$AttachAt(this.m_vbuf.getUid()),this.m_vbuf}__$detachVBuf(t){if(this.m_vbuf!=t)throw Error("Fatal Error!");a.default.__$$DetachAt(this.m_vbuf.getUid())}isGeomDynamic(){return this.m_bufDataUsage}getBufDataUsage(){return this.m_bufDataUsage}getVS(){return null}getIVS(){return this.m_ivs}setBufSortFormat(t){this.m_layoutBit=t}isVBufEnabledAt(t){return(t&this.m_layoutBit)>0}__$attachThis(){++this.m_attachCount}__$detachThis(){1==this.m_attachCount?(--this.m_attachCount,this.__$dispose()):--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}getAttachCount(){return this.m_attachCount}__$dispose(){this.getAttachCount()<1&&null!=this.m_vbuf&&(a.default.__$$DetachAt(this.m_vbuf.getUid()),this.m_vbuf=null)}isEnabled(){return null!=this.m_vbuf}isResFree(){return this.getAttachCount()<1&&null==this.m_vbuf}__$destroy(){this.isResFree()&&(this.m_ivs=null,this.m_bufDataList=null,this.m_bufDataStepList=null,this.m_bufStatusList=null,this.trisNumber=0,this.m_transMatrix=null)}toString(){return"[MeshBase()]"}}e.default=n},cc48:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["NONE"]=0]="NONE",t[t["CAMERA"]=1]="CAMERA",t[t["POV"]=2]="POV",t[t["INNER_POV_PASS"]=3]="INNER_POV_PASS",t[t["CAMERA_AND_POV"]=4]="CAMERA_AND_POV"}(i||(i={})),e.default=i},ccdf:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98"),r=s("cfaf"),a=s("acaa"),h=s("85b6");class n{constructor(t){this.m_renderProxy=null,this.m_rttTexs=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.m_rttCubeTexs=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.m_rttFloatTexs=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.m_rttDepthTexs=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.m_renderProxy=t}getRenderProxy(){return this.m_renderProxy}createWrapperTex(t,e,s=!1){let i=new h.default(t,e,s);return i}createRTTTex2D(t,e,s=!1){let i=new r.default(t,e,s);return i}createDepthTex2D(t,e,s=!1){let i=new a.default(t,e,s);return i}getCubeRTTTextureAt(t){return null!=this.m_rttCubeTexs[t]?(this.m_rttCubeTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttCubeTexs[t]):(this.m_rttCubeTexs[t]=this.createRTTTex2D(32,32),this.m_rttCubeTexs[t].toCubeTexture(),this.m_rttCubeTexs[t].name="sys_cube_rttTex_"+t,this.m_rttCubeTexs[t].minFilter=i.TextureConst.LINEAR,this.m_rttCubeTexs[t].magFilter=i.TextureConst.LINEAR,this.m_rttCubeTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttCubeTexs[t])}createCubeRTTTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.m_rttCubeTexs[t]?(this.m_rttCubeTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttCubeTexs[t]):(this.m_rttCubeTexs[t]=this.createRTTTex2D(e,s),this.m_rttCubeTexs[t].toCubeTexture(),this.m_rttCubeTexs[t].name="sys_cube_rttTex_"+t,this.m_rttCubeTexs[t].minFilter=i.TextureConst.LINEAR,this.m_rttCubeTexs[t].magFilter=i.TextureConst.LINEAR,this.m_rttCubeTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttCubeTexs[t])}getRTTTextureAt(t){return null!=this.m_rttTexs[t]?(this.m_rttTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttTexs[t]):(this.m_rttTexs[t]=this.createRTTTex2D(32,32),this.m_rttTexs[t].to2DTexture(),this.m_rttTexs[t].name="sys_rttTex_"+t,this.m_rttTexs[t].minFilter=i.TextureConst.LINEAR,this.m_rttTexs[t].magFilter=i.TextureConst.LINEAR,this.m_rttTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttTexs[t])}createRTTTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.m_rttTexs[t]?(this.m_rttTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttTexs[t]):(this.m_rttTexs[t]=this.createRTTTex2D(e,s),this.m_rttTexs[t].to2DTexture(),this.m_rttTexs[t].name="sys_rttTex_"+t,this.m_rttTexs[t].minFilter=i.TextureConst.LINEAR,this.m_rttTexs[t].magFilter=i.TextureConst.LINEAR,this.m_rttTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttTexs[t])}getDepthTextureAt(t){return null!=this.m_rttDepthTexs[t]?(this.m_rttDepthTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttDepthTexs[t]):(this.m_rttDepthTexs[t]=this.createDepthTex2D(64,64),this.m_rttDepthTexs[t].to2DTexture(),this.m_rttDepthTexs[t].name="sys_depthTex_"+t,this.m_rttDepthTexs[t].minFilter=i.TextureConst.LINEAR,this.m_rttDepthTexs[t].magFilter=i.TextureConst.LINEAR,this.m_rttDepthTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttDepthTexs[t])}createDepthTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.m_rttDepthTexs[t]?(this.m_rttDepthTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttDepthTexs[t]):(this.m_rttDepthTexs[t]=this.createDepthTex2D(e,s),this.m_rttDepthTexs[t].to2DTexture(),this.m_rttDepthTexs[t].name="sys_depthTex_"+t,this.m_rttDepthTexs[t].minFilter=i.TextureConst.LINEAR,this.m_rttDepthTexs[t].magFilter=i.TextureConst.LINEAR,this.m_rttDepthTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttDepthTexs[t])}getRTTFloatTextureAt(t){if(null!=this.m_rttFloatTexs[t])return this.m_rttFloatTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttFloatTexs[t];let e=this.createRTTTex2D(64,64);return e.to2DTexture(),this.m_rttFloatTexs[t].name="sys_rttFloatTex_"+t,this.m_rttFloatTexs[t]=e,e.internalFormat=i.TextureFormat.RGBA16F,e.srcFormat=i.TextureFormat.RGBA,e.dataType=i.TextureDataType.FLOAT,e.magFilter=i.TextureConst.NEAREST,this.m_rttFloatTexs[t].__$setRenderProxy(this.m_renderProxy),e}createRTTFloatTextureAt(t,e,s){if(e=e>1?e:1,s=s>1?s:1,null!=this.m_rttFloatTexs[t])return this.m_rttFloatTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttFloatTexs[t];let r=this.createRTTTex2D(e,s);return r.to2DTexture(),this.m_rttFloatTexs[t].name="sys_rttFloatTex_"+t,this.m_rttFloatTexs[t]=r,r.internalFormat=i.TextureFormat.RGBA16F,r.srcFormat=i.TextureFormat.RGBA,r.dataType=i.TextureDataType.FLOAT,r.magFilter=i.TextureConst.NEAREST,this.m_rttFloatTexs[t].__$setRenderProxy(this.m_renderProxy),r}}e.RTTTextureStore=n,e.default=n},cfaf:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98"),r=s("0851");class a extends r.default{constructor(t,e,s=!1){super(t,e,s),this.m_type=i.TextureProxyType.RTT,this.minFilter=i.TextureConst.NEAREST,this.magFilter=i.TextureConst.NEAREST}to2DTexture(){this.m_texTarget=i.TextureTarget.TEXTURE_2D}toCubeTexture(){this.m_texTarget=i.TextureTarget.TEXTURE_CUBE}uploadFromFbo(t,e,s){let r=t.getRC();t.hasResUid(this.getResUid())?this.getBufWidth()==e&&this.getBufHeight()==s||(t.bindToGpu(this.getResUid()),this.bindTexture(r,e,s),this.m_texWidth=e,this.m_texHeight=s,this.__$buildParam(r)):(this.m_sampler=i.TextureTarget.GetValue(r,this.m_texTarget),this.createTexBuf(t),t.bindToGpu(this.getResUid()),this.bindTexture(r,e,s),this.m_haveRData=!0,this.m_texWidth=e,this.m_texHeight=s,this.__$buildParam(r))}bindTexture(t,e,s){let r=i.TextureFormat.ToGL(t,this.internalFormat),a=i.TextureFormat.ToGL(t,this.srcFormat),h=i.TextureDataType.ToGL(t,this.dataType);switch(this.m_texTarget){case i.TextureTarget.TEXTURE_2D:t.texImage2D(t.TEXTURE_2D,0,r,e,s,0,a,h,null);break;case i.TextureTarget.TEXTURE_CUBE:for(let i=0;i<6;++i)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,r,e,s,0,a,h,null);break;case i.TextureTarget.TEXTURE_SHADOW_2D:t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT16,e,s,0,t.DEPTH_COMPONENT,t.FLOAT,null);break;default:break}}toString(){return"[RTTTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=a},d1a0:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("6e01");class r{static PlaneCalcIntersectSphere(t,e,s,a){r.IntersectBoo=!1,r.IntersectSatus=0,e=t.dot(s)-e,e>i.default.MATH_MIN_POSITIVE?(r.IntersectBoo=e<=a,r.IntersectSatus=1):e<i.default.MATH_MAX_NEGATIVE&&(r.IntersectBoo=-e<=a,r.IntersectSatus=-1)}static CalcPVCloseV(t,e,s,i){let r=e-s.dot(t);i.setTo(r*t.x,r*t.y,r*t.z),i.addBy(s)}static CalcPVCloseV2(t,e,s,i){let r=e-s.dot(t);i.setTo(r*t.x,r*t.y,r*t.z),i.addBy(s)}static IntersectionSLV2(t,e,s,r,a){let h=t.dot(r);if(h>i.default.MATH_MIN_POSITIVE||h<i.default.MATH_MAX_NEGATIVE){let i=t.dot(s)-e;return a.x=1e5*r.x+s.x,a.y=1e5*r.y+s.y,a.z=1e5*r.z+s.z,h=t.dot(a)-e,h=i/(i-h),a.subtractBy(s),a.scaleBy(h),a.addBy(s),1}return h=t.dot(s)-e,h<=i.default.MATH_MIN_POSITIVE||h>=i.default.MATH_MAX_NEGATIVE?(a.copyFrom(s),2):0}}r.IntersectBoo=!1,r.IntersectSatus=0,e.default=r},d314:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98"),r=s("0851");class a extends r.default{constructor(t,e){super(t,e,!1),this.m_imgDataList=null,this.m_texTarget=i.TextureTarget.TEXTURE_CUBE,this.m_type=i.TextureProxyType.ImageCube}setDataFromImageToFaceAt(t,e,s=0){if(null!=e&&(null==this.m_imgDataList&&(this.m_imgDataList=[null,null,null,null,null,null]),e.width>0&&e.height>0)){0==t&&(this.m_texWidth=e.width,this.m_texHeight=e.height,this.m_miplevel=s),this.m_imgDataList[t]={imgData:e,miplevel:s};let i=5;for(;i>=0;--i)if(null==this.m_imgDataList[i])break;this.m_haveRData=i<0}}uploadData(t){let e=t.getRC(),s=null;for(let r=0;r<6;++r)s=this.m_imgDataList[r],e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,this.m_miplevel,i.TextureFormat.ToGL(e,this.internalFormat),i.TextureFormat.ToGL(e,this.srcFormat),i.TextureDataType.ToGL(e,this.dataType),s.imgData)}toString(){return"[ImageCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.m_imgDataList)for(let t=0;t<6;++t)null!=this.m_imgDataList[t]&&(this.m_imgDataList[t].imgData=null);console.log("ImageCubeTextureProxy::destroy(), destroy a ImageCubeTextureProxy instance..."),super.__$destroy()}}}e.default=a},d53d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataSizeList=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,s=e.length;for(let i=0;i<s;++i)if(t==e[i])return this.dataList[i]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let s=this.uniformNameList,i=s.length;for(let r=0;r<i;++r)if(t==s[r]){this.dataList[r]=e;break}}}copyDataFromProbe(t){this.types=[],this.dataSizeList=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]),this.dataSizeList.push(t.dataSizeList[e]);this.uniformSize=t.uniformsTotal}useByLocation(t,e,s,i){}useByShd(t,e){}use(t){}updateData(){}destroy(){}}e.ShaderUniform=i;class r extends i{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV1(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e])}useByLocation(t,e,s,i){t.useUniformV1(s,e,this.dataList[i],this.dataSizeList[i])}useByShd(t,e){let s=0;for(;s<this.uniformSize;++s)t.useUniformV1(e.getUniformLocationByNS(this.uniformNameList[s]),this.types[s],this.dataList[s],this.dataSizeList[s])}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let s=0;s<t;++s)e=this.calcModels[s],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null}}e.ShaderUniformV1=r;class a extends i{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV2(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e],0)}useByLocation(t,e,s,i){t.useUniformV2(s,e,this.dataList[i],this.dataSizeList[i],0)}useByShd(t,e){let s=0;for(;s<this.uniformSize;++s)t.useUniformV2(e.getUniformLocationByNS(this.uniformNameList[s]),this.types[s],this.dataList[s],this.dataSizeList[s],0)}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let s=0;s<t;++s)e=this.calcModels[s],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null}}e.ShaderUniformV2=a;class h extends i{constructor(){super()}use(t){t.useUniformMat4(this.locations[0],this.dataList[0])}useByLocation(t,e,s,i){t.useUniformMat4(s,this.dataList[0])}useByShd(t,e){t.useUniformMat4(e.getUniformLocationByNS(this.uniformNameList[0]),this.dataList[0])}destroy(){this.dataList[0]=null,this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null}}e.ShaderMat4Uniform=h,e.default=i},d7e2:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8e17");class r{constructor(t){this.m_rc=null,this.m_rc=t}sortRODisplay(t,e){let s=this.m_rc.getCamera().getPosition();for(let r=0;r<e;++r)t[r].value=-i.default.DistanceSquared(t[r].bounds.center,s);return 0}}e.default=r},d88f:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("ab73"),r=s("7279");class a{create(t,e){let s=null;return e.hasUniformByName(i.default.CameraParamUNS)&&(s=new r.default,s.uniformNameList=[i.default.CameraParamUNS],s.copyDataFromProbe(t.getCamera().ufrustumProbe)),s}getIDNS(){return"CameraParamUniformBuilder"}}e.default=a},d958:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("11e6"),r=s("36cb"),a=s("c497"),h=s("3c81"),n=s("1e15"),l=s("0e01"),_=s("eca0"),o=s("442e"),m=s("1264");class u{constructor(){this.m_uid=-1,this.m_entity3DMana=null,this.m_processes=[],this.m_processesLen=0,this.m_sprocesses=[],this.m_sprocessesLen=0,this.m_renderProxy=null,this.m_adapter=null,this.m_dataBuilder=null,this.m_renderInsContext=null,this.m_batchEnabled=!0,this.m_processFixedState=!0,this.m_rpoUnitBuilder=new _.RPOUnitBuilder,this.m_rpoNodeBuilder=new o.default,this.m_processBuider=new h.default,this.m_roVtxBuild=null,this.m_stage3D=null,this.m_fixProcess=null,this.m_uid=u.s_uid++,this.m_renderInsContext=new l.default(this.m_uid)}__$setStage3D(t){null!=t&&null==this.m_stage3D&&(this.m_stage3D=t)}getUid(){return this.m_uid}getRCUid(){return this.m_uid}getRPONodeBuilder(){return this.m_rpoNodeBuilder}getDataBuilder(){return this.m_dataBuilder}getRendererContext(){return this.m_renderInsContext}getRenderProxy(){return this.m_renderProxy}getStage3D(){return this.m_renderProxy.getStage3D()}getViewX(){return this.m_adapter.getViewportX()}getViewY(){return this.m_adapter.getViewportY()}getViewWidth(){return this.m_adapter.getViewportWidth()}getViewHeight(){return this.m_adapter.getViewportHeight()}getCamera(){return null==this.m_renderProxy?this.m_renderInsContext.getCamera():null}createCamera(){if(null==this.m_renderProxy)return this.m_renderProxy.createCamera()}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}initialize(t=null){null==this.m_renderProxy&&(null==t&&(t=new a.default),this.m_batchEnabled=t.batchEnabled,this.m_processFixedState=t.processFixedState,this.m_renderProxy=this.m_renderInsContext.getRenderProxy(),this.m_dataBuilder=new r.default,this.m_roVtxBuild=new n.default,this.m_renderInsContext.setCameraParam(t.camProjParam.x,t.camProjParam.y,t.camProjParam.z),this.m_renderInsContext.setMatrix4AllocateSize(t.getMatrix4AllocateSize()),this.m_renderInsContext.initialize(t,this.m_stage3D,this.m_dataBuilder,this.m_roVtxBuild),this.m_adapter=this.m_renderProxy.getRenderAdapter(),this.m_uid=this.m_renderProxy.getUid(),this.m_dataBuilder.initialize(this.m_renderProxy,this.m_rpoUnitBuilder,this.m_processBuider,this.m_roVtxBuild),this.m_renderInsContext.initManager(this.m_dataBuilder),this.m_entity3DMana=new m.default(this.m_uid,this.m_dataBuilder,this.m_rpoUnitBuilder,this.m_processBuider),this.m_fixProcess=this.createSeparatedProcess(),this.appendProcess(this.m_batchEnabled,this.m_processFixedState))}update(){this.m_renderProxy.Texture.update(),this.m_renderProxy.Vertex.update(),this.m_entity3DMana.update()}updateAllProcess(){for(let t=0;t<this.m_processesLen;++t)this.m_processes[t].update()}updateProcessAt(t){t>-1&&t<this.m_processesLen&&this.m_processes[t].update()}setEntityManaListener(t){this.m_entity3DMana.entityManaListener=t}addEntity(t,e=0,s=!0){null!=t&&t.__$testRendererEnabled()&&e>-1&&e<this.m_processesLen&&this.m_entity3DMana.addEntity(t,this.m_processes[e].getUid(),s)}addEntityToProcess(t,e,s=!0){null!=e&&null!=t&&t.__$testRendererEnabled()&&e.getRCUid()==this.m_uid&&this.m_entity3DMana.addEntity(t,e.getUid(),s)}moveEntityToProcessAt(t,e){if(null!=t&&t.getRendererUid()==this.m_uid&&t.isRenderEnabled()&&e>-1&&e<this.m_processesLen){let s=t.getDisplay().__$$runit.getRPROUid(),r=this.m_processBuider.getNodeByUid(s),a=this.m_processes[e];r!=a&&(r.removeDispUnit(t.getDisplay()),t.__$rseFlag=a.getSortEnabled()?i.default.AddSortEnabled(t.__$rseFlag):i.default.RemoveSortEnabled(t.__$rseFlag),a.addDisp(t.getDisplay()))}}moveEntityToProcess(t,e){if(null!=e&&null!=t&&t.getRendererUid()==this.m_uid&&t.isRenderEnabled()){let s=t.getDisplay().__$$runit.getRPROUid(),r=this.m_processBuider.getNodeByUid(s);if(r!=e){let s=e;r.removeDispUnit(t.getDisplay()),t.__$rseFlag=e.getSortEnabled()?i.default.AddSortEnabled(t.__$rseFlag):i.default.RemoveSortEnabled(t.__$rseFlag),s.addDisp(t.getDisplay())}}}removeEntity(t){null!=t&&t.getRendererUid()==this.m_uid&&this.m_entity3DMana.removeEntity(t)}removeEntityFromProcess(t,e){null!=e&&e.getRCUid()==this.m_uid&&null!=t&&t.getRendererUid()==this.m_uid&&e.removeDisp(t.getDisplay())}removeEntityByProcessIndex(t,e){e>=0&&e<this.m_processesLen&&null!=t&&t.getRendererUid()==this.m_uid&&this.m_processes[e].removeDisp(t.getDisplay())}setProcessSortEnabledAt(t,e){t>=0&&t<this.m_processesLen&&this.m_processes[t].setSortEnabled(e)}setProcessSortEnabled(t,e){if(null!=t&&t.getRCUid()==this.m_uid){let s=t;s.setSortEnabled(e)}}appendProcess(t=!0,e=!1){this.m_processBuider.setCreateParams(this.m_dataBuilder.getRenderShader(),this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_renderProxy.Vertex,t,e);let s=this.m_processBuider.create();return this.m_processes.push(s),s.setRendererParam(this.m_renderProxy,this.m_processesLen),++this.m_processesLen,s}createSeparatedProcess(t=!0,e=!1){this.m_processBuider.setCreateParams(this.m_dataBuilder.getRenderShader(),this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_renderProxy.Vertex,t,e);let s=this.m_processBuider.create();return this.m_sprocesses.push(s),s.setRendererParam(this.m_renderProxy,this.m_sprocessesLen),s}setRendererProcessParam(t,e,s){t>-1&&t<this.m_processesLen&&this.m_processes[t].setRenderParam(e,s)}getProcessAt(t){return t>-1&&t<this.m_processesLen?this.m_processes[t]:null}showInfoAt(t){t>-1&&t<this.m_processesLen&&this.m_processes[t].showInfo()}getProcessesTotal(){return this.m_processesLen}updateMaterialUniformToCurrentShd(t){this.m_dataBuilder.getRenderShader().useUniformToCurrentShd(t.__$uniform)}drawEntityByLockMaterial(t,e=!0){null!=t&&t.getVisible()&&t.getRendererUid()==this.m_uid&&!this.m_renderProxy.isContextLost()&&this.m_fixProcess.drawLockMaterialByDisp(t.getDisplay(),e)}drawEntity(t){null!=t&&t.getVisible()&&!this.m_renderProxy.isContextLost()&&(t.getRendererUid()==this.m_uid?this.m_fixProcess.drawDisp(t.getDisplay()):t.__$testRendererEnabled()&&this.m_entity3DMana.addEntity(t,this.m_fixProcess.getUid(),!1))}runAt(t){this.m_renderProxy.isContextLost()||this.m_processes[t].run()}runProcess(t){t.getRCUid()!=this.m_uid||this.m_renderProxy.isContextLost()||t.run()}runFromIndexTo(t){if(!this.m_renderProxy.isContextLost())for(let e=t;e<this.m_processesLen;++e)this.m_processes[e].run()}run(){if(this.m_entity3DMana.isHaveEntity()&&!this.m_renderProxy.isContextLost())for(let t=0;t<this.m_processesLen;++t)this.m_processes[t].run()}getRenderUnitsTotal(){let t=0;for(let e=0;e<this.m_processesLen;++e)t+=this.m_processes[e].getUnitsTotal();return t}renderflush(){this.m_renderProxy.flush()}toString(){return"[RendererInstance(uid = "+this.m_uid+")]"}}u.s_uid=0,e.RendererInstance=u,e.default=u},da6a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){if(this.m_texResource=null,this.m_bufferUpdater=null,this.m_textureTotal=0,this.m_textureMap=new Map,this.m_freeMap=new Map,this.m_texUid=0,this.m_freeUids=[],null!=i.s_ins)throw Error("This Class is a singleton class!!!");i.s_ins=null}static GetInstance(){return null!=i.s_ins||(i.s_ins=new i),i.s_ins}getFreeUid(){if(this.m_freeUids.length>0)return this.m_freeUids.pop();let t=this.m_texUid++;return t}__$$addTexture(t){null==t||this.m_textureMap.has(t.getUid())||(this.m_textureMap.set(t.getUid(),t),this.m_textureTotal++)}getTextureByUid(t){return this.m_textureMap.get(t)}hasTextureByUid(t){return this.m_textureMap.has(t)}removeTextureByUid(t){if(this.m_textureMap.has(t)){let e=this.m_textureMap.get(t);if(e.getAttachCount()<1)return this.m_freeMap.has(t)&&this.m_freeMap.delete(t),e.__$destroy(),e.__$$removeFromSlot(),this.m_textureMap.delete(t),this.m_freeUids.push(t),this.m_textureTotal--,e}return null}getTextureTotal(){return this.m_textureTotal}setRenderProxy(t){this.m_texResource=t.Texture}setBufferUpdater(t){this.m_bufferUpdater=t}getFreeResUidMap(){return this.m_freeMap}isGpuEnabledByResUid(t){return this.m_texResource.hasResUid(t)}addRenderBuffer(t,e){null!=this.m_bufferUpdater&&this.m_bufferUpdater.__$addBuf(t,e)}addFreeUid(t){this.m_freeMap.set(t,0)}removeFreeUid(t){this.m_freeMap.has(t)&&this.m_freeMap.delete(t)}}i.s_ins=null,e.default=i},dc2b:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("e08e"),r=s("29ef");class a{constructor(){this.m_uid=0,this.m_material=null,this.m_matFS32=null,this.name="RODisplay",this.visible=!0,this.ivsIndex=0,this.ivsCount=0,this.trisNumber=0,this.insCount=0,this.drawMode=i.RenderDrawMode.ELEMENTS_TRIANGLES,this.vbuf=null,this.renderState=r.default.NORMAL_STATE,this.rcolorMask=r.default.ALL_TRUE_COLOR_MASK,this.mouseEnabled=!1,this.m_partGroup=null,this.m_trans=null,this.__$ruid=-1,this.__$rpuid=-1,this.__$$rsign=i.DisplayRenderSign.NOT_IN_WORLD,this.__$$runit=null,this.m_uid=a.s_uid++}getPartGroup(){return this.m_partGroup}createPartGroup(t){t<1&&(t=1),this.m_partGroup=new Uint16Array(2*t)}setDrawPartAt(t,e,s){t*=2,this.m_partGroup[t]=s,this.m_partGroup[++t]=e}getUid(){return this.m_uid}setTransform(t){this.m_trans=t,this.m_matFS32=t.getLocalFS32()}getTransform(){return this.m_trans}getMatrixFS32(){return this.m_matFS32}enableDrawInstanced(t,e){this.drawMode=i.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES,this.ivsIndex=t,this.insCount=e}disableDrawInstanced(){this.drawMode=i.RenderDrawMode.ELEMENTS_TRIANGLES}getMaterial(){return this.m_material}setMaterial(t){null!=this.m_material&&this.m_material!=t&&(this.m_material.__$detachThis(),null!=t&&t.__$attachThis()),this.m_material=t}copyFrom(t){this.vbuf=t.vbuf,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.setMaterial(t.getMaterial())}toString(){return"RODisplay(name="+this.name+",uid="+this.getUid()+", __$ruid="+this.__$ruid+")"}destroy(){null!=this.m_material&&(this.m_material.__$detachThis(),this.m_material.destroy(),this.m_material=null),this.m_matFS32=null,this.vbuf=null,this.__$ruid=-1,this.__$rpuid=-1,this.__$$rsign=i.DisplayRenderSign.NOT_IN_WORLD,this.ivsIndex=0,this.ivsCount=0,this.m_partGroup=null,this.__$$runit=null}static GetFreeId(){return a.m_freeIdList.length>0?a.m_freeIdList.pop():-1}static GetByUid(t){return a.m_unitList[t]}static IsEnabledByUid(t){return a.m_unitFlagList[t]==a.S_FLAG_BUSY}static Create(){let t=null,e=a.GetFreeId();return e>=0?(t=a.m_unitList[e],a.m_unitFlagList[e]=a.S_FLAG_BUSY):(t=new a,a.m_unitList.push(t),a.m_unitFlagList.push(a.S_FLAG_BUSY),a.m_unitListLen++),t}static Restore(t){if(null!=t&&a.m_unitFlagList[t.getUid()]==a.S_FLAG_BUSY){let e=t.getUid();a.m_freeIdList.push(e),a.m_unitFlagList[e]=a.S_FLAG_FREE,t.destroy()}}}a.s_uid=0,a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.m_unitFlagList=[],a.m_unitListLen=0,a.m_unitList=[],a.m_freeIdList=[],e.default=a},dd53:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("5336"),r=s("9d26");class a{constructor(){this.m_statusDisp=new i.default,this.m_inited=!0,this.m_scIns0=new r.DemoMultiRendererScene2,this.m_scIns1=new r.DemoMultiRendererScene2,this.m_scIns2=new r.DemoMultiRendererScene2,this.m_scIns3=new r.DemoMultiRendererScene2}createDiv(t,e,s,i){let r=document.createElement("div");return r.style.width=s+"px",r.style.height=i+"px",document.body.appendChild(r),r.style.display="bolck",r.style.left=t+"px",r.style.top=e+"px",r.style.position="absolute",r.style.display="bolck",r.style.position="absolute",r}initialize(){if(console.log("DemoMultiGpuContext::initialize()......"),this.m_inited){let t;this.m_inited=!0,t=this.createDiv(660,60,600,300),this.m_scIns0.initialize(t),t=this.createDiv(50,60,600,300),this.m_scIns1.initialize(t),t=this.createDiv(50,370,600,300),this.m_scIns2.initialize(t),t=this.createDiv(660,370,600,300),this.m_scIns3.initialize(t),this.m_statusDisp.initialize("rstatus",280)}}run(){this.m_statusDisp.update(),this.m_scIns0.run(),this.m_scIns1.run(),this.m_scIns2.run(),this.m_scIns3.run()}}e.DemoMultiGpuContext=a,e.default=a},de9d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("722e"),r=s("8333"),a=s("6e01"),h=s("8e17"),n=s("c51d"),l=s("7c63"),_=s("090c"),o=s("1216"),m=s("56c5"),u=s("030e"),d=s("74c3"),c=s("984e");class f{constructor(t){this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.RState=null,this.Vertex=null,this.Texture=null,this.VtxBufUpdater=null,this.MaterialUpdater=null,this.m_uid=0,this.m_camUBO=null,this.m_adapter=null,this.m_adapterContext=new _.default,this.m_rc=null,this.m_perspectiveEnabled=!0,this.m_viewX=0,this.m_viewY=0,this.m_viewW=800,this.m_viewH=600,this.m_cameraNear=.1,this.m_cameraFar=5e3,this.m_cameraFov=45,this.m_maxWebGLVersion=2,this.m_WEBGL_VER=2,this.m_camera=null,this.m_camSwitched=!1,this.m_autoSynViewAndStage=!0,this.m_uid=t}getRC(){return this.m_rc}getUid(){return this.m_uid}getRCUid(){return this.m_uid}isAutoSynViewAndStage(){return this.m_autoSynViewAndStage}lockViewport(){this.m_adapter.lockViewport()}unlockViewport(){this.m_adapter.unlockViewport()}getDiv(){return this.m_adapter.getDiv()}getCanvas(){return this.m_adapter.getCanvas()}cameraLock(){this.m_camera.lock()}cameraUnlock(){this.m_camera.unlock()}getCamera(){return this.m_camera}updateCamera(){return this.m_camera.update()}createCameraUBO(t){}updateCameraDataFromCamera(t){null!=t&&(this.m_camSwitched||t!=this.m_camera)&&(this.m_camSwitched=t!=this.m_camera,t.updateCamMatToUProbe(this.m_camera.matUProbe),null!=this.m_camUBO&&(this.m_camUBO.setSubDataArrAt(0,t.getViewMatrix().getLocalFS32()),this.m_camUBO.setSubDataArrAt(16,t.getProjectMatrix().getLocalFS32())))}useCameraData(){null!=this.m_camUBO&&this.m_camUBO.run()}getActiveAttachmentTotal(){return this.m_adapter.getActiveAttachmentTotal()}drawInstanced(t,e,s){2==this.m_WEBGL_VER?this.m_rc.drawElementsInstanced(this.TRIANGLES,t,this.UNSIGNED_SHORT,e,s):u.default.ANGLE_instanced_arrays.drawElementsInstancedANGLE(this.TRIANGLES,t,e,s)}createUBOBufferByBytesCount(t){let e=this.m_rc.createBuffer();return this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,e),this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.DYNAMIC_DRAW),e}createUBOBufferByDataArray(t){let e=this.m_rc.createBuffer();return this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,e),this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.DYNAMIC_DRAW),e}bindUBOBuffer(t){this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,t)}deleteUBOBuffer(t){this.m_rc.deleteBuffer(t)}bufferDataUBOBuffer(t){this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.STATIC_DRAW)}bindBufferBaseUBOBuffer(t,e){this.m_rc.bindBufferBase(this.m_rc.UNIFORM_BUFFER,t,e)}setWebGLMaxVersion(t){1!=t&&2!=t||(this.m_maxWebGLVersion=t)}getContext(){return this.m_adapterContext}getStage3D(){return this.m_adapterContext.getStage()}getRenderAdapter(){return this.m_adapter}setCameraParam(t,e,s){this.m_cameraFov=t,this.m_cameraNear=e,this.m_cameraFar=s}getMouseXYWorldRay(t,e){let s=this.m_adapterContext.getStage();this.m_camera.getWorldPickingRayByScreenXY(s.mouseX,s.mouseY,t,e)}setViewPort(t,e,s,i){this.m_autoSynViewAndStage=!1,this.m_viewX=t,this.m_viewY=e,this.m_viewW=s,this.m_viewH=i;let r=this.m_adapterContext.getStage();null!=r&&(r.setViewPort(s,e,s,i),null!=this.m_camera&&(this.m_camera.setViewXY(this.m_viewX,this.m_viewY),this.m_camera.setViewSize(this.m_viewW,this.m_viewH,this.m_adapterContext.getDevicePixelRatio()))),this.setRCViewPort(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH)}setRCViewPort(t,e,s,i){this.m_autoSynViewAndStage=!1,this.m_adapterContext.setViewport(t,e,s,i)}reseizeRCViewPort(){this.m_adapter.unlockViewport(),this.m_adapter.reseizeViewPort()}resizeCallback(){this.m_autoSynViewAndStage&&(this.m_viewX=0,this.m_viewY=0,this.m_viewW=this.m_adapterContext.getRCanvasWidth(),this.m_viewH=this.m_adapterContext.getRCanvasHeight(),null==this.m_camera&&this.createMainCamera(),this.m_adapterContext.setViewport(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH),this.m_camera.setViewXY(this.m_viewX,this.m_viewY),this.m_camera.setViewSize(this.m_viewW,this.m_viewH,this.m_adapterContext.getDevicePixelRatio()))}createMainCamera(){this.m_camera=new n.default(this.m_uid),this.m_camera.uniformEnabled=!0,this.m_perspectiveEnabled?this.m_camera.perspectiveRH(a.default.DegreeToRadian(this.m_cameraFov),this.m_viewW/this.m_viewH,this.m_cameraNear,this.m_cameraFar):this.m_camera.orthoRH(this.m_cameraNear,this.m_cameraFar,-.5*this.m_viewH,.5*this.m_viewH,-.5*this.m_viewW,.5*this.m_viewW),this.m_camera.setViewXY(this.m_viewX,this.m_viewY),this.m_camera.setViewSize(this.m_viewW,this.m_viewH,this.m_adapterContext.getDevicePixelRatio())}readPixels(t,e,s,i,r,a,h){this.m_adapter.readPixels(t,e,s,i,r,a,h)}getGLVersion(){return this.m_WEBGL_VER}initialize(t,e,s,a,n){if(null!=this.m_rc)return;let l=t.camPosition,_=t.camLookAtPos,f=t.camUpDirect;null==l&&(l=new h.default(500,500,500)),null==_&&(_=new h.default(0,0,0)),null==f&&(f=new h.default(0,1,0)),this.m_perspectiveEnabled=t.cameraPerspectiveEnabled,this.m_adapterContext.autoSyncRenderBufferAndWindowSize=t.autoSyncRenderBufferAndWindowSize,this.m_adapterContext.setResizeCallback(this,this.resizeCallback),this.m_adapterContext.setWebGLMaxVersion(this.m_maxWebGLVersion),this.m_adapterContext.initialize(this.m_uid,e,t.getDiv(),t.getRenderContextAttri()),this.m_WEBGL_VER=this.m_adapterContext.getWebGLVersion(),this.m_rc=this.m_adapterContext.getRC();let p=this,g=this.m_rc,x=new d.default(this.m_uid,g,n),T=new c.default(this.m_uid,g);if(p.Vertex=x,p.Texture=T,p.MaterialUpdater=s,p.VtxBufUpdater=a,this.m_viewW=this.m_adapterContext.getViewportWidth(),this.m_viewH=this.m_adapterContext.getViewportHeight(),this.m_adapter=new o.default(this.m_uid,T),this.m_adapter.initialize(this.m_adapterContext,t),this.m_autoSynViewAndStage){let t=this.m_adapterContext.getStage();null!=t&&(this.m_viewW=t.stageWidth,this.m_viewH=t.stageHeight)}null==this.m_camera&&this.createMainCamera(),this.m_adapterContext.setViewport(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH),this.m_camera.lookAtRH(l,_,f),this.m_camera.update(),this.m_adapter.bgColor.setRGB3f(0,0,0),p.RGBA=g.RGBA,p.UNSIGNED_BYTE=g.UNSIGNED_BYTE,p.TRIANGLE_STRIP=g.TRIANGLE_STRIP,p.TRIANGLE_FAN=g.TRIANGLE_FAN,p.TRIANGLES=g.TRIANGLES,p.LINES=this.m_rc.LINES,p.LINE_STRIP=g.LINE_STRIP,p.UNSIGNED_SHORT=g.UNSIGNED_SHORT,p.UNSIGNED_INT=g.UNSIGNED_INT,p.COLOR=g.COLOR,p.DEPTH=g.DEPTH,p.STENCIL=g.STENCIL,p.DEPTH_STENCIL=g.DEPTH_STENCIL,this.m_WEBGL_VER>1?(p.MIN=g.MIN,p.MAX=g.MAX):(p.MIN=u.default.EXT_blend_minmax.MIN_EXT,p.MAX=u.default.EXT_blend_minmax.MAX_EXT);let E=i.default;E.NEAREST=g.NEAREST,E.LINEAR=g.LINEAR,E.LINEAR_MIPMAP_LINEAR=g.LINEAR_MIPMAP_LINEAR,E.NEAREST_MIPMAP_NEAREST=g.NEAREST_MIPMAP_NEAREST,E.LINEAR_MIPMAP_NEAREST=g.LINEAR_MIPMAP_NEAREST,E.NEAREST_MIPMAP_LINEAR=g.NEAREST_MIPMAP_LINEAR;let y=r.default;y.COLOR_BUFFER_BIT=g.COLOR_BUFFER_BIT,y.DEPTH_BUFFER_BIT=g.DEPTH_BUFFER_BIT,y.STENCIL_BUFFER_BIT=g.STENCIL_BUFFER_BIT,m.default.SetRenderer(this.m_adapterContext),p.RState=this.m_adapterContext.getRenderState(),p.RContext=this.m_rc}flush(){this.m_rc.flush()}createCamera(){return new n.default(this.m_uid)}setClearRGBColor3f(t,e,s){this.m_adapter.bgColor.setRGB3f(t,e,s)}setClearColor(t){this.m_adapter.bgColor.copyFrom(t)}setClearUint24Color(t,e){this.m_adapter.bgColor.setRGBUint24(t),this.m_adapter.bgColor.a=e}setClearRGBAColor4f(t,e,s,i){this.m_adapter.bgColor.setRGBA4f(t,e,s,i)}getClearRGBAColor4f(t){t.copyFrom(this.m_adapter.bgColor)}getViewportWidth(){return this.m_adapter.getViewportWidth()}getViewportHeight(){return this.m_adapter.getViewportHeight()}setRenderToBackBuffer(){this.m_adapter.setRenderToBackBuffer()}clearRenderBuffer(){this.m_adapter.clear()}renderBegin(){this.m_camera.update(),this.m_adapter.renderBegin()}renderEnd(){}useRenderStateByName(t){l.RenderStateObject.UseRenderStateByName(t)}setScissorEnabled(t){this.m_adapterContext.setScissorEnabled(t)}setScissorRect(t,e,s,i){this.m_adapterContext.setScissorRect(t,e,s,i)}useRenderColorMask(t){l.RenderColorMask.UseRenderState(t)}unlockRenderColorMask(){l.RenderColorMask.Unlock()}lockRenderColorMask(){l.RenderColorMask.Lock()}useRenderState(t){l.RenderStateObject.UseRenderState(t)}unlockRenderState(){l.RenderStateObject.Unlock()}lockRenderState(){l.RenderStateObject.Lock()}setFrontFaceFlipped(t){this.m_adapter.setFrontFaceFlipped(t)}setPolygonOffset(t,e=0){this.m_adapter.setPolygonOffset(t,e)}resetPolygonOffset(){this.m_adapter.resetPolygonOffset()}loseContext(){this.m_adapter.loseContext()}isContextLost(){return this.m_adapter.isContextLost()}setViewProbeValue(t,e,s,i){this.m_adapter.setViewProbeValue(t,e,s,i)}toString(){return"[Object RenderProxy()]"}}e.default=f},df25:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98"),r=s("68aa"),a=s("0851");class h extends a.default{constructor(t,e,s=!1){super(t,e,s),this.m_bytes=null,this.m_subDataList=null,this.m_texDatasLen=0,this.m_texData=null,this.m_texDatas=null,this.minFilter=i.TextureConst.LINEAR}setDataFromBytes(t,e=0,s=-1,i=-1,a=0,h=0,n=!1){if(null!=t&&s>0&&i>0){e<0&&(e=0),e>15&&(e=15),e>=this.m_texDatasLen&&(this.m_texDatasLen=e+1),this.m_haveRData=!0;let l=this.m_texData;null!=l?this.m_texData.miplevel!=e&&(null==this.m_texDatas&&(this.m_texDatas=[this.m_texData,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),l=this.m_texDatas[e],null==l&&(l=r.default.Create(),l.miplevel=e,n=!0,this.m_texDatas[e]=l)):(this.m_texData=l=r.default.Create(),l.miplevel=e,n=!0),l.data==t&&l.offsetx==a&&l.offsety==h||(0==e&&(this.m_texWidth=s,this.m_texHeight=i,this.m_bytes=t),l.data=t,l.status=0,(l.width<s||l.height<i||n)&&(l.width=s,l.height=i,l.status=1),l.offsetx=a,l.offsety=h),this.version++}else console.error("bytes != null: "+(null!=t)+",imgWidth > 0: "+(s>0)+",imgHeight > 0: "+(i>0))}uploadData(t){null!=this.m_texData&&this.dataUploadToGpu(t.getRC(),this.m_texData,this.m_texDatas,!0)}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())){let e=t.getRC(),s=null!=this.m_subDataList?this.m_subDataList.length:0;if(this.__$updateToGpuBegin(t),s>0){let t=0,a=null,h=i.TextureFormat.ToGL(e,this.internalFormat),n=i.TextureFormat.ToGL(e,this.srcFormat),l=i.TextureDataType.ToGL(e,this.dataType);for(;t<s;++t)a=this.m_subDataList.pop(),a.updateToGpu(e,this.m_sampler,h,n,l,!1),r.default.Restore(a)}null!=this.m_texData&&(this.dataUploadToGpu(e,this.m_texData,this.m_texDatas),this.__$buildParam(e),this.m_generateMipmap=!0),this.__$updateToGpuEnd(e)}}setPartDataFromeBytes(t,e,s,i,a,h=0){null==this.m_subDataList&&(this.m_subDataList=[]);let n=r.default.Create();n.data=t,n.status=0,n.miplevel=h,n.offsetx=e,n.offsety=s,n.width=i,n.height=a,this.m_subDataList.push(n),this.version++}getPixels(t,e,s,r,a){if(null!=this.m_bytes&&null!=a){let h=this.unpackAlignment,n=s*r*h;if(a.length==n){let l=e,_=t,o=l+r,m=_+s,u=0;switch(this.srcFormat){case i.TextureFormat.ALPHA:for(;l<o;++l)for(_=t;_<m;++_)n=l*this.m_texWidth+_,a[u]=this.m_bytes[n],u++;break;case i.TextureFormat.RGBA:for(;l<o;++l)for(_=t;_<m;++_)n=(l*this.m_texWidth+_)*h,a[u]=this.m_bytes[n],a[u+1]=this.m_bytes[n+1],a[u+2]=this.m_bytes[n+2],a[u+3]=this.m_bytes[n+3],u++;break;case i.TextureFormat.RGB:for(;l<o;++l)for(_=t;_<m;++_)n=(l*this.m_texWidth+_)*h,a[u]=this.m_bytes[n],a[u+1]=this.m_bytes[n+1],a[u+2]=this.m_bytes[n+2],u++;break;default:break}}else console.warn("outBytes.length != (pw * ph * pixelSegSize)")}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.m_texDatas){for(let t=0;t<this.m_texDatasLen;++t)r.default.Restore(this.m_texDatas[t]);this.m_texDatasLen=0,this.m_texDatas=null,this.m_texData=null}null!=this.m_texData&&(r.default.Restore(this.m_texData),this.m_texData=null),this.m_bytes=null,console.log("RawDataTextureProxy::destroy(), destroy a RawDataTextureProxy instance..."),super.__$destroy()}}toString(){return"[RawDataTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=h},df9d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_uid=-1,this.m_begin=null,this.m_end=null,this.m_unitMap=new Map,this.m_unitTexMap=new Map,this.m_FLAG_BUSY=1,this.m_FLAG_FREE=0,this.m_vtxFlagList=[],this.m_vtxIndexFlagList=[],this.m_vtxfreeIList=[],this.m_vtxList=[],this.m_vtxListLen=0,this.m_texFlagList=[],this.m_texIndexFlagList=[],this.m_texfreeIList=[],this.m_texList=[],this.m_texListLen=0,this.m_uid=i.s_uid++}getFreeVtxId(){return this.m_vtxfreeIList.length>0?this.m_vtxfreeIList.pop():-1}getVtxIndex(){let t=-1,e=this.getFreeVtxId();return e>=0?(t=e,this.m_vtxList[e]=0,this.m_vtxFlagList[e]=this.m_FLAG_BUSY):(t=this.m_vtxListLen,this.m_vtxList.push(0),this.m_vtxIndexFlagList.push(this.m_FLAG_FREE),this.m_vtxFlagList.push(this.m_FLAG_BUSY),this.m_vtxListLen++),t}restoreVtxIndex(t){this.m_vtxFlagList[t]==this.m_FLAG_BUSY&&(this.m_vtxfreeIList.push(t),this.m_vtxFlagList[t]=this.m_FLAG_FREE,this.m_vtxList[t]=0)}attachVtxAt(t){++this.m_vtxList[t]}detachVtxAt(t){this.m_vtxList[t]>0&&(--this.m_vtxList[t],this.m_vtxList[t]<1&&this.restoreVtxIndex(t))}getVtxTotalAt(t){return this.m_vtxList[t]}getFreeTexId(){return this.m_texfreeIList.length>0?this.m_texfreeIList.pop():-1}getTexIndex(){let t=-1,e=this.getFreeTexId();return e>=0?(t=e,this.m_texList[e]=0,this.m_texFlagList[e]=this.m_FLAG_BUSY):(t=this.m_texListLen,this.m_texList.push(0),this.m_texIndexFlagList.push(this.m_FLAG_FREE),this.m_texFlagList.push(this.m_FLAG_BUSY),this.m_texListLen++),t}restoreTexIndex(t){this.m_texFlagList[t]==this.m_FLAG_BUSY&&(this.m_texfreeIList.push(t),this.m_texFlagList[t]=this.m_FLAG_FREE,this.m_texList[t]=0)}attachTexAt(t){++this.m_texList[t]}detachTexAt(t){this.m_texList[t]>0&&(--this.m_texList[t],this.m_texList[t]<1&&this.restoreTexIndex(t))}getTexTotalAt(t){return this.m_texList[t]}destroy(){this.clear()}clear(){this.m_begin=this.m_end=null,this.m_unitMap=new Map,this.m_unitTexMap=new Map,this.m_vtxFlagList=[],this.m_vtxIndexFlagList=[],this.m_vtxList=[],this.m_vtxfreeIList=[],this.m_vtxListLen=0,this.m_texFlagList=[],this.m_texIndexFlagList=[],this.m_texList=[],this.m_texfreeIList=[],this.m_texListLen=0}getBegin(){return this.m_begin}containsNode(t){let e=this.m_unitMap.get(t.vtxUid);if(null!=e){let s=131*(31+e.rvroI);return s*=s+e.texMid,t.rtokey==s}return!1}addNodeAndSort(t){let e=this.m_unitMap.get(t.vtxUid);if(null==e){this.m_unitMap.set(t.vtxUid,t),t.rvroI=this.getVtxIndex(),this.attachVtxAt(t.rvroI);let e=131*(31+t.rvroI);e*=e+t.texMid,t.rtokey=e,t.rtroI=this.getTexIndex(),this.m_unitTexMap.set(e,t.rtroI),this.attachTexAt(t.rtroI)}else{t.rvroI=e.rvroI,this.attachVtxAt(t.rvroI);let s=131*(31+t.rvroI);if(s*=s+t.texMid,this.m_unitTexMap.has(s)?t.rtroI=this.m_unitTexMap.get(s):(t.rtroI=this.getTexIndex(),this.m_unitTexMap.set(s,t.rtroI)),t.rtokey=s,this.attachTexAt(t.rtroI),e!=this.m_end)if(e.texMid==t.texMid)e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;else while(null!=e){if(e.vtxUid!=t.vtxUid){e=e.prev,e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.texMid==t.texMid){e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.next==this.m_end){e=null;break}e=e.next}else e=null}null==e&&(null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null)}showInfo(){let t=this.getBegin();if(null!=t){let e="",s="",i="";while(null!=t)e+=t.vtxUid+",",s+=t.texMid+",",i+=t.ivsCount+",",t=t.next;console.log("RPONodeLinker::showInfo(), vtx: "+e),console.log("RPONodeLinker::showInfo(), tex: "+s),console.log("RPONodeLinker::showInfo(), ivs: "+i)}}removeNodeAndSort(t){let e=this.m_unitMap.get(t.vtxUid);e!=t?e=null:(this.m_unitMap.set(t.vtxUid,null),null!=t.next&&t.next.vtxUid==t.vtxUid?this.m_unitMap.set(t.vtxUid,t.next):null!=t.prev&&t.prev.vtxUid==t.vtxUid?this.m_unitMap.set(t.vtxUid,t.prev):this.m_unitMap.delete(t.vtxUid)),t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),this.detachVtxAt(t.rvroI),this.detachTexAt(t.rtroI),t.prev=null,t.next=null}addNode(t){null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null}removeNode(t){t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}i.s_uid=0,e.default=i},e08e:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.ELEMENTS_TRIANGLES=1,i.ELEMENTS_TRIANGLE_STRIP=2,i.ELEMENTS_TRIANGLE_FAN=3,i.ELEMENTS_INSTANCED_TRIANGLES=4,i.ARRAYS_LINES=5,i.ARRAYS_LINE_STRIP=6,i.ARRAYS_POINTS=7,i.DISABLE=0,e.RenderDrawMode=i;class r{}r.NORMAL=1,r.OPAQUE=1,r.TRANSPARENT=2,r.ALPHA_ADD=3,r.ADD=4,r.ADD2=5,r.INVERSE_ALPHA=6,r.BLAZE=7,r.OVERLAY=8,r.OVERLAY2=8,r.DISABLE=0,e.RenderBlendMode=r;class a{}a.BACK=1,a.FRONT=2,a.FRONT_AND_BACK=3,a.NONE=4,a.DISABLE=0,e.CullFaceMode=a;class h{}h.RENDER_NEVER=1,h.RENDER_ALWAYS=2,h.RENDER_SKY=3,h.RENDER_TRUE_LESS_EQUAL=3,h.RENDER_OPAQUE=4,h.RENDER_TRUE_LESS=4,h.RENDER_OPAQUE_OVERHEAD=5,h.RENDER_FALSE_EQUAL=5,h.RENDER_FALSE_LESS=6,h.RENDER_BLEND=6,h.RENDER_BLEND_SORT=6,h.RENDER_TRANSPARENT_SORT=6,h.RENDER_TRUE_LEQUAL=7,h.RENDER_WIRE_FRAME=7,h.RENDER_FALSE_LEQUAL=8,h.RENDER_DECALS=8,h.RENDER_NEXT_LAYER=11,h.RENDER_WIRE_FRAME_NEXT=12,h.RENDER_TRUE_EQUAL=13,h.RENDER_TRUE_GREATER=14,h.RENDER_TRUE_GEQUAL=15,h.DISABLE=0,e.DepthTestMode=h;class n{}n.SCENE_RO_FILTER_BEGIN=1<<19,n.SCENE_RO_FILTER_FINISH=2<<19,n.SCENE_RO_ERASE=0,e.RenderConst=n,function(t){t[t["NOT_IN_WORLD"]=-1]="NOT_IN_WORLD",t[t["GO_TO_WORLD"]=1]="GO_TO_WORLD",t[t["LIVE_IN_WORLD"]=2]="LIVE_IN_WORLD"}(e.DisplayRenderSign||(e.DisplayRenderSign={}))},e214:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("6e01"),r=s("8e17"),a=s("f48d"),h=s("81c4");class n extends a.default{constructor(){super(...arguments),this.nv=new r.default(0,1,0),this.distance=0,this.intersectBoo=!1}intersectStraightLinePos(t,e){let s=this.nv.dot(t.tv);if(s>i.default.MATH_MIN_POSITIVE||s<i.default.MATH_MAX_NEGATIVE){let i=this.nv.dot(t.position)-this.distance;return e.x=1e5*t.tv.x+t.position.x,e.y=1e5*t.tv.y+t.position.y,e.z=1e5*t.tv.z+t.position.z,s=this.nv.dot(e)-this.distance,s=i/(i-s),e.subtractBy(t.position),e.scaleBy(s),e.addBy(t.position),1}return s=this.nv.dot(t.position)-this.distance,s<=i.default.MATH_MIN_POSITIVE||s>=i.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),2):0}intersectStraightLinePos2(t,e,s){let r=this.nv.dot(e);if(r>i.default.MATH_MIN_POSITIVE||r<i.default.MATH_MAX_NEGATIVE){let i=this.nv.dot(t)-this.distance;return s.x=1e5*e.x+t.x,s.y=1e5*e.y+t.y,s.z=1e5*e.z+t.z,r=this.nv.dot(s)-this.distance,r=i/(i-r),s.subtractBy(t),s.scaleBy(r),s.addBy(t),1}return r=this.nv.dot(t)-this.distance,r<=i.default.MATH_MIN_POSITIVE||r>=i.default.MATH_MAX_NEGATIVE?(s.copyFrom(t),2):0}intersectRadialLinePos(t,e){let s=this.nv.dot(t.position)-this.distance;if(s>i.default.MATH_MIN_POSITIVE){let s=this.nv.dot(t.tv);if(s<0)return this.intersectStraightLinePos2(t.position,t.tv,e)}else{if(!(s<i.default.MATH_MAX_NEGATIVE)){let s=this.nv.dot(t.tv);return s>i.default.MATH_MIN_POSITIVE||s<i.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),1):(e.copyFrom(t.position),2)}{let s=this.nv.dot(t.tv);if(s>0)return this.intersectStraightLinePos2(t.position,t.tv,e)}}return-1}intersectRadialLinePos2(t,e,s){let r=this.nv.dot(t)-this.distance;if(r>i.default.MATH_MIN_POSITIVE){let i=this.nv.dot(e);if(i<0)return this.intersectStraightLinePos2(t,e,s)}else{if(!(r<i.default.MATH_MAX_NEGATIVE)){let r=this.nv.dot(e);return r>i.default.MATH_MIN_POSITIVE||r<i.default.MATH_MAX_NEGATIVE?(s.copyFrom(t),1):(s.copyFrom(t),2)}{let i=this.nv.dot(e);if(i>0)return this.intersectStraightLinePos2(t,e,s)}}return-1}containsPoint(t){let e=this.nv.dot(t)-this.distance;return e>i.default.MATH_MIN_POSITIVE?1:e<i.default.MATH_MAX_NEGATIVE?-1:0}intersectSphere(t,e){this.intersectBoo=!1;let s=this.nv.dot(t)-this.distance;return s>i.default.MATH_MIN_POSITIVE?(this.intersectBoo=s<=e,1):s<i.default.MATH_MAX_NEGATIVE?(this.intersectBoo=-s<=e,-1):0}intersectSphNegSpace(t,e){this.intersectBoo=Math.abs(this.nv.dot(t)-this.distance)<e}update(){this.nv.normalize()}updateFast(){this.nv.normalize()}static PlaneIntersectSphere(t,e,s,r){n.IntersectBoo=!1,n.IntersectSatus=0,e=t.dot(s)-e,e>i.default.MATH_MIN_POSITIVE?(n.IntersectBoo=e<=r,n.IntersectSatus=1):e<i.default.MATH_MAX_NEGATIVE&&(n.IntersectBoo=-e<=r,n.IntersectSatus=-1)}static CalcPVCloseV(t,e,s){let i=t.distance-e.dot(t.nv);s.setTo(i*t.nv.x,i*t.nv.y,i*t.nv.z),s.addBy(e)}static CalcPVCloseV2(t,e,s,i){let r=e-s.dot(t);i.setTo(r*t.x,r*t.y,r*t.z),i.addBy(s)}static IntersectionSLV2(t,e,s,r,a){let h=t.dot(r);if(h>i.default.MATH_MIN_POSITIVE||h<i.default.MATH_MAX_NEGATIVE){let i=t.dot(s)-e;return a.x=1e5*r.x+s.x,a.y=1e5*r.y+s.y,a.z=1e5*r.z+s.z,h=t.dot(a)-e,h=i/(i-h),a.subtractBy(s),a.scaleBy(h),a.addBy(s),1}return h=t.dot(s)-e,h<=i.default.MATH_MIN_POSITIVE||h>=i.default.MATH_MAX_NEGATIVE?(a.copyFrom(s),2):0}toString(){return"Plane(position="+this.position.toString()+", nv="+this.nv.toString()+")"}}n.IntersectBoo=!1,n.IntersectSatus=0;class l extends n{constructor(){super(...arguments),this.v0=new r.default(100,0,0),this.v1=new r.default(0,0,-100),this.v2=new r.default(0,0,0),this.ls01=new h.default,this.ls12=new h.default,this.ls20=new h.default,this.radiusSquared=100}getRandomPosition(t){let e=this.ls01.length*Math.random();t.x=this.ls01.position.x+e*this.ls01.tv.x,t.y=this.ls01.position.y+e*this.ls01.tv.y,t.z=this.ls01.position.z+e*this.ls01.tv.z,e=this.ls12.length*Math.random(),t.x+=this.ls12.position.x+e*this.ls12.tv.x,t.y+=this.ls12.position.y+e*this.ls12.tv.y,t.z+=this.ls12.position.z+e*this.ls12.tv.z,e=this.ls20.length*Math.random(),t.x+=this.ls20.position.x+e*this.ls20.tv.x,t.y+=this.ls20.position.y+e*this.ls20.tv.y,t.z+=this.ls20.position.z+e*this.ls20.tv.z,t.x*=.33333,t.y*=.33333,t.z*=.33333}triIntersectStraightLinePos(t,e){let s=this.intersectStraightLinePos(t,e);return 1==s&&(s=this.triContainsPoint(e),s>0)?1:-1}triIntersectRadialLinePos(t,e){let s=this.intersectRadialLinePos(t,e);return 1==s&&(s=this.triContainsPoint(e),s>0)?1:-1}triIntersectStraightLinePos2(t,e,s){let i=this.intersectStraightLinePos2(t,e,s);return 1==i&&(i=this.triContainsPoint(s),i>0)?1:-1}triIntersectRadialLinePos2(t,e,s){let i=this.intersectStraightLinePos2(t,e,s);return 1==i&&(i=this.triContainsPoint(s),i>0)?1:-1}triContainsPoint(t){let e=this.nv.dot(t)-this.distance;return e>i.default.MATH_MIN_POSITIVE||e<i.default.MATH_MAX_NEGATIVE?-1:(a.default.__tV0.x=t.x-this.v0.x,a.default.__tV0.y=t.y-this.v0.y,a.default.__tV0.z=t.z-this.v0.z,r.default.Cross(this.ls01.tv,a.default.__tV0,a.default.__tV1),this.nv.dot(a.default.__tV1)<0?-1:(a.default.__tV0.x=t.x-this.v1.x,a.default.__tV0.y=t.y-this.v1.y,a.default.__tV0.z=t.z-this.v1.z,r.default.Cross(this.ls12.tv,a.default.__tV0,a.default.__tV1),this.nv.dot(a.default.__tV1)<0?-1:(a.default.__tV0.x=t.x-this.v2.x,a.default.__tV0.y=t.y-this.v2.y,a.default.__tV0.z=t.z-this.v2.z,r.default.Cross(this.ls20.tv,a.default.__tV0,a.default.__tV1),this.nv.dot(a.default.__tV1)<0?-1:1)))}update(){let t=1/3;this.position.x=t*(this.v0.x+this.v1.x+this.v2.x),this.position.y=t*(this.v0.y+this.v1.y+this.v2.y),this.position.z=t*(this.v0.z+this.v1.z+this.v2.z),this.nv.x=this.position.x-this.v0.x,this.nv.y=this.position.y-this.v0.y,this.nv.z=this.position.z-this.v0.z,this.radiusSquared=this.nv.getLengthSquared(),this.ls01.position.copyFrom(this.v0),this.ls01.anotherPosition.copyFrom(this.v1),this.ls12.position.copyFrom(this.v1),this.ls12.anotherPosition.copyFrom(this.v2),this.ls20.position.copyFrom(this.v2),this.ls20.anotherPosition.copyFrom(this.v0),this.ls01.update(),this.ls12.update(),this.ls20.update(),r.default.Cross(this.ls01.tv,this.ls12.tv,this.nv),this.nv.normalize(),this.distance=this.nv.dot(this.v0)}updateFast(){this.update()}}e.Triangle=l,e.default=n},e7ce:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("faa5"),r=s("b3bd"),a=s("0fc4");class h extends i.default{constructor(){super(),this.m_uniqueName=""}initialize(t){this.m_uniqueName="PixelPickIndexShd"}getFragShaderCode(){let t="#version 300 es\nprecision highp float;\nuniform vec4 u_param;\nin vec3 v_viewPos;\n//in float v_length;\nlayout(location = 0) out vec4 FragColor0;\nvoid main()\n{\nvec4 p = vec4(length(v_viewPos.xyz));\np.x = floor(p.x)/256.0;\np.y = floor(fract(p.x) * 256.0)/255.0;\np.x = floor(p.x) / 255.0;\np.z = fract(p.z);\nFragColor0 = vec4(p.xyz,u_param.w);\n}\n";return t}getVtxShaderCode(){let t="#version 300 es\nprecision highp float;\nlayout(location = 0) in vec3 a_vs;\nuniform mat4 u_objMat;\nuniform mat4 u_viewMat;\nuniform mat4 u_projMat;\nout vec3 v_viewPos;\n//out float v_length;\nvoid main(){\nmat4 viewMat4 = u_viewMat * u_objMat;\nvec4 viewPos = viewMat4 * vec4(a_vs, 1.0);\nv_viewPos = viewPos.xyz;\n//v_length = length(viewPos.xyz);\ngl_Position = u_projMat * viewPos;\n}\n";return t}getUniqueShaderName(){return this.m_uniqueName}toString(){return"[PixelPickIndexShaderBuffer()]"}static GetInstance(){return h.___s_instance}}h.___s_instance=new h,e.PixelPickIndexShaderBuffer=h;class n extends a.default{constructor(){super(),this.m_paramArray=new Float32Array([1,1,1,1]),this.m_1over255=1/255}getCodeBuf(){return h.GetInstance()}setIndex(t){this.m_paramArray[3]=t*this.m_1over255}getIndex(){return this.m_paramArray[3]/this.m_1over255}createSelfUniformData(){let t=new r.default;return t.uniformNameList=["u_param"],t.dataList=[this.m_paramArray],t}}e.default=n},e7d2:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8a0a"),r=s("710f"),a=s("f0f0"),h=s("7a04"),n=s("e08e");class l{constructor(t=i.default.VTX_STATIC_DRAW){this.m_uid=0,this.m_vtxBuf=null,this.m_ivs=null,this.m_bufDataUsage=0,this.m_ibufStep=2,this.vertexVer=0,this.indicesVer=0,this.version=0,this.drawMode=n.RenderDrawMode.ELEMENTS_TRIANGLES,this.bufData=null,this.m_uid=l.s_uid++,this.m_bufDataUsage=t}setVtxBuf(t){t!=this&&(this.m_vtxBuf=t)}getUid(){return this.m_uid}getType(){return this.m_vtxBuf.getType()}getIBufStep(){return this.m_ibufStep}getBufDataUsage(){return this.m_bufDataUsage}setBufDataUsage(t){this.m_bufDataUsage=t}getBuffersTotal(){return this.m_vtxBuf.getBuffersTotal()}getF32DataAt(t){return this.m_vtxBuf.getF32DataAt(t)}getIvsData(){return this.m_ivs}setF32DataAt(t,e,s,i){this.m_vtxBuf.setF32DataAt(t,e,s,i),this.vertexVer++}setUintIVSData(t,e=i.default.VTX_STATIC_DRAW){if(t instanceof Uint16Array)this.m_ibufStep=2;else{if(!(t instanceof Uint32Array))return void console.error("Error: uint16Or32Arr is not an Uint32Array or an Uint16Array bufferArray instance !!!!");this.m_ibufStep=4}this.m_ivs=t,null!=t&&this.indicesVer++}setUint16IVSData(t,e=i.default.VTX_STATIC_DRAW){t instanceof Uint16Array?(this.m_ivs=t,this.indicesVer++,this.m_ibufStep=2):console.error("Error: uint16Arr is not an Uint16Array bufferArray instance !!!!")}setUint32IVSData(t,e=i.default.VTX_STATIC_DRAW){t instanceof Uint32Array?(this.m_ivs=t,this.indicesVer++,this.m_ibufStep=4):console.error("Error: uint32Arr is not an Uint32Array bufferArray instance !!!!")}setData4fAt(t,e,s,i,r,a){null!=this.m_vtxBuf&&(this.m_vtxBuf.setData4fAt(t,e,s,i,r,a),this.vertexVer++)}setData3fAt(t,e,s,i,r){null!=this.m_vtxBuf&&(this.m_vtxBuf.setData3fAt(t,e,s,i,r),this.vertexVer++)}setData2fAt(t,e,s,i){null!=this.m_vtxBuf&&(this.m_vtxBuf.setData2fAt(t,e,s,i),this.vertexVer++)}destroy(){}__$destroy(){console.log("ROVertexBuffer::__$destroy()... "+this),this.m_vtxBuf.destroy(),this.m_vtxBuf.getType()<1?l.s_combinedBufs.push(this.m_vtxBuf):l.s_separatedBufs.push(this.m_vtxBuf),this.m_vtxBuf=null,this.m_ivs=null,this.bufData=null}toString(){return"ROVertexBuffer(uid = "+this.m_uid+")"}static GetFreeId(){return l.s_freeIdList.length>0?l.s_freeIdList.pop():-1}static GetVtxByUid(t){return l.s_unitList[t]}static Create(t=i.default.VTX_STATIC_DRAW){let e=null,s=l.GetFreeId();return s>=0?(e=l.s_unitList[s],e.setBufDataUsage(t),l.s_unitFlagList[s]=l.S_FLAG_BUSY):(e=new l(t),l.s_unitList.push(e),l.s_unitFlagList.push(l.S_FLAG_BUSY),l.s_unitListLen++),e.vertexVer=0,e.indicesVer=0,e.version++,l.s_vtxStore.__$attachAt(e.getUid()),e}static __$Restore(t){if(null!=t&&l.s_unitFlagList[t.getUid()]==l.S_FLAG_BUSY){let e=t.getUid();l.s_freeIdList.push(e),l.s_unitFlagList[e]=l.S_FLAG_FREE,t.__$destroy()}}static __$$AttachAt(t){l.s_vtxStore.__$attachAt(t)}static __$$DetachAt(t){l.s_vtxStore.__$detachAt(t)}static Reset(){l.BufDataList=[],l.s_stride=0,l.BufStatusList=[],l.BufDataStepList=[],l.vtxFS32=null,l.vbWholeDataEnabled=!1,l.dynBufSegEnabled=!1,l.useBufByIndexEnabled=!1}static AddFloat32Data(t,e,s=i.default.VTX_STATIC_DRAW){l.BufDataList.push(t),l.BufDataStepList.push(e),l.BufStatusList.push(s),l.s_stride+=e}static CreateBySaveData(t=i.default.VTX_STATIC_DRAW){let e=0,s=0,r=0,h=l.BufDataStepList.length,n=[];for(;e<h;e++)n.push(r),r+=l.BufDataStepList[e];let _=l.BufDataList[0].length/l.BufDataStepList[0],o=new Float32Array(r*_),m=0,u=0,d=null,c=null;for(e=0;e<_;++e)for(s=e*r,m=0;m<h;++m)u=l.BufDataStepList[m],d=l.BufDataList[m],c=d.subarray(e*u,(e+1)*u),o.set(c,s),s+=u;let f=l.Create(t);if(l.s_combinedBufs.length>0){let t=l.s_combinedBufs.pop();f.setVtxBuf(t)}else f.setVtxBuf(new a.default(f.getBufDataUsage()));return f.setF32DataAt(0,o,r,n),f}static UpdateBufData(t){let e=0,s=0,i=0,r=l.BufDataStepList.length,a=l.BufDataList[0].length/l.BufDataStepList[0],h=t.getF32DataAt(0),n=l.s_stride*a!=h.length,_=null;if(n)for(_=[],h=new Float32Array(l.s_stride*a);e<r;e++)_.push(i),i+=l.BufDataStepList[e];else i=l.s_stride;let o=0,m=0,u=null,d=null;for(e=0;e<a;++e)for(s=e*i,o=0;o<r;++o)m=l.BufDataStepList[o],u=l.BufDataList[o],d=u.subarray(e*m,(e+1)*m),h.set(d,s),s+=m;n?t.setF32DataAt(0,h,i,_):t.setF32DataAt(0,h,i,null)}static CreateByBufDataSeparate(t,e=i.default.VTX_STATIC_DRAW){let s=0,r=0,a=t.getAttributesTotal(),n=new Array(a);n.fill(0);let _=l.Create(e);if(l.s_separatedBufs.length>0){let t=l.s_separatedBufs.pop();_.setVtxBuf(t)}else _.setVtxBuf(new h.default);for(s=0;s<a;s++)_.setF32DataAt(s,t.getAttributeDataAt(s,0),r,n);return _.setUintIVSData(t.getIndexDataAt(0)),_.bufData=t,_}static CreateBySaveDataSeparate(t=i.default.VTX_STATIC_DRAW){let e=0,s=0,r=l.BufDataStepList.length,a=new Array(r);a.fill(0);let n=l.Create(t);if(l.s_separatedBufs.length>0){let t=l.s_separatedBufs.pop();n.setVtxBuf(t)}else n.setVtxBuf(new h.default);for(e=0;e<r;e++)n.setF32DataAt(e,l.BufDataList[e],s,a);return n}static GetVtxAttachCountAt(t){return l.s_vtxStore.getAttachCountAt(t)}static GetVtxAttachAllCount(){return l.s_vtxStore.getAttachAllCount()}static ClearTest(){if(--l.s_timeDelay,l.s_timeDelay<1){l.s_timeDelay=128;let t=l.s_vtxStore;if(t.__$getRemovedListLen()>0){let e=t.__$getRemovedList(),s=e.length,i=0,r=0,a=null,h=32;for(s=s>h?h:s;i<s;++i)r=e.shift(),t.getAttachCountAt(r)<1&&(console.log("ROVertexBuffer remove a instance, vtxUid: "+r),a=l.GetVtxByUid(r),l.__$Restore(a))}}}}l.s_uid=0,l.s_combinedBufs=[],l.s_separatedBufs=[],l.S_FLAG_BUSY=1,l.S_FLAG_FREE=0,l.s_unitFlagList=[],l.s_unitListLen=0,l.s_unitList=[],l.s_freeIdList=[],l.s_vtxStore=new r.default,l.s_stride=0,l.BufDataList=null,l.BufDataStepList=null,l.BufStatusList=null,l.vtxDataFS32=null,l.vbWholeDataEnabled=!1,l.dynBufSegEnabled=!1,l.useBufByIndexEnabled=!1,l.vtxFS32=null,l.s_timeDelay=128,e.default=l},e87b:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("ab73"),r=s("7279");class a{create(t,e){let s=null;return e.hasUniformByName(i.default.ViewParamUNS)&&(s=new r.default,s.uniformNameList=[i.default.ViewParamUNS],s.copyDataFromProbe(t.getRenderAdapter().uViewProbe)),s}getIDNS(){return"ViewParamUniformBuilder"}}e.default=a},e943:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("32fa");class r{constructor(){this.m_rprocess=null,this.m_renderer=null,this.m_status=null}initialize(t){null==this.m_renderer&&(this.m_renderer=t,this.m_rprocess=this.m_renderer.createSeparatedProcess(),this.m_status=new i.default,this.m_status.initialize(this.m_renderer,this.m_rprocess))}run(t=!1){null!=this.m_renderer&&(this.m_status.run(t),this.m_renderer.runProcess(this.m_rprocess))}toString(){return"[ProfileInstance]"}}e.default=r},e9d3:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8e17"),r=s("65b4"),a=s("6a22"),h=s("1710"),n=s("badb");class l extends r.default{constructor(){super(),this.m_hitFlag=!1,this.m_pos=new i.default,this.m_stage3D=null,this.m_dispatcher=null,this.m_targetEntity=null,this.dragController=new a.default}setStage3D(t){null==this.m_stage3D&&null!=t&&(this.m_stage3D=t,t.addEventListener(h.default.MOUSE_UP,this,this.mouseUpListener,!1,!0))}bindTarget(t){if(null==this.m_targetEntity&&null!=t){this.m_targetEntity=t,t.getPosition(this.m_pos);let e=new n.default;e.addEventListener(h.default.MOUSE_DOWN,this,this.mouseDownListener),e.addEventListener(h.default.MOUSE_UP,this,this.mouseUpListener),e.addEventListener(h.default.MOUSE_OVER,this,this.mouseOverListener),e.addEventListener(h.default.MOUSE_OUT,this,this.mouseOutListener),e.addEventListener(h.default.MOUSE_MOVE,this,this.mouseMoveListener),t.setEvtDispatcher(e),t.mouseEnabled=!0,this.m_dispatcher=e}}setScaleXYZ(t,e,s){null!=this.m_targetEntity&&this.m_targetEntity.setScaleXYZ(t,e,s)}setXYZ(t,e,s){null!=this.m_targetEntity&&this.m_targetEntity.setXYZ(t,e,s)}mouseMoveListener(t){}mouseOverListener(t){}mouseOutListener(t){}mouseDownListener(t){this.m_hitFlag=!0,this.m_targetEntity.getPosition(this.m_pos),this.dragController.attach(this.m_pos.x,this.m_pos.y,t.mouseX,t.mouseY)}mouseUpListener(t){this.m_hitFlag=!1,this.dragController.detach()}drag(){}isHitFlag(){return this.m_hitFlag}run(){null!=this.m_stage3D&&this.m_hitFlag&&this.dragController.test(this.m_stage3D.mouseX,this.m_stage3D.mouseY)&&(this.dragController.updateDrag(this.m_stage3D.mouseX,this.m_stage3D.mouseY),this.m_pos.x=this.dragController.x,this.m_pos.y=this.dragController.y,this.m_targetEntity.setPosition(this.m_pos),this.updateTargetEntity(),this.drag())}updateTargetEntity(){this.m_targetEntity.update()}getPosition(t){t.copyFrom(this.m_pos)}destory(){null!=this.m_targetEntity&&(this.m_targetEntity.mouseEnabled=!1,this.m_targetEntity=null,this.m_targetEntity.setEvtDispatcher(null)),null!=this.m_stage3D&&(this.m_stage3D.removeEventListener(h.default.MOUSE_UP,this,this.mouseUpListener),this.m_stage3D=null),null!=this.m_dispatcher&&(this.m_dispatcher.destroy(),this.m_dispatcher=null)}}e.default=l},eaee:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98"),r=s("0851");class a extends r.default{constructor(t,e){super(t,e,!1),this.m_imgDataList=null,this.m_texTarget=i.TextureTarget.TEXTURE_CUBE,this.m_type=i.TextureProxyType.FloatCube,this.internalFormat=i.TextureFormat.RGBA16F,this.dataType=i.TextureDataType.FLOAT,this.mipmapEnabled=!0}setDataFromBytesToFaceAt(t,e,s,i,r=0){if(null==this.m_imgDataList&&(this.m_imgDataList=[null,null,null,null,null,null]),this.isGpuEnabled()&&s>0&&i>0){0==t&&(this.m_texWidth=s,this.m_texHeight=i,this.m_miplevel=r),this.m_imgDataList[t]={imgData:e,miplevel:r};let a=5;for(;a>=0;--a)if(null==this.m_imgDataList[a])break;this.m_haveRData=a<0}}uploadData(t){let e=t.getRC(),s=null;for(let r=0;r<6;++r)s=this.m_imgDataList[r],e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,this.m_miplevel,i.TextureFormat.ToGL(e,this.internalFormat),this.getWidth(),this.getWidth(),0,i.TextureFormat.ToGL(e,this.srcFormat),i.TextureDataType.ToGL(e,this.dataType),s.imgData)}toString(){return"[FloatCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.m_imgDataList)for(let t=0;t<6;++t)null!=this.m_imgDataList[t]&&(this.m_imgDataList[t].imgData=null);console.log("FloatCubeTextureProxy::destroy(), destroy a FloatCubeTextureProxy instance..."),super.__$destroy()}}}e.default=a},eca0:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("2be1"),r=s("c62b");class a{constructor(){this.idsFlag=0,this.count=0,this.rprocessUid=-1}reset(){this.idsFlag=0}}a.RenerProcessMaxTotal=16,e.RCRPObj=a;class h extends i.default{constructor(){super(...arguments),this.m_rcpoList=[]}createNode(){let t=new a;return t.reset(),this.m_rcpoList.push(t),new r.default}restoreUid(t){this.m_rcpoList[t].reset()}testRPNodeExists(t,e){return(this.m_rcpoList[t].idsFlag&1<<e)>0}testRPNodeNotExists(t,e){return(this.m_rcpoList[t].idsFlag&1<<e)<1}setRPNodeParam(t,e,s){let i=this.m_rcpoList[t],r=1<<e;return s>-1?(i.idsFlag&r)<1&&(++i.count,i.rprocessUid=e,i.idsFlag=i.idsFlag|r):(i.idsFlag&r)>0&&(--i.count,i.idsFlag=i.idsFlag&~r),i.count}getRCRPObj(t){return this.m_rcpoList[t]}}e.RPOUnitBuilder=h},ee5a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.type=0,this.m_listeners=[],this.m_hosts=[],this.m_phases=[]}addListener(t,e,s){let i=this.m_hosts.length-1;for(;i>=0;--i)if(t===this.m_hosts[i])break;i<0&&(this.m_hosts.push(t),this.m_listeners.push(e),this.m_phases.push(s))}removeListener(t,e){let s=this.m_hosts.length-1;for(;s>=0;--s)if(t===this.m_hosts[s]){this.m_hosts.splice(s,1),this.m_listeners.splice(s,1),this.m_phases.splice(s,1);break}}dispatch(t){let e=0,s=this.m_hosts.length;for(let i=0;i<s;++i)(this.m_phases[i]<1||t.phase==this.m_phases[i])&&(this.m_listeners[i].call(this.m_hosts[i],t),e=1);return e}passTestEvt(t){let e=this.m_hosts.length;for(let s=0;s<e;++s)if(this.m_phases[s]<1||t.phase==this.m_phases[s])return 1;return 0}passTestPhase(t){let e=this.m_hosts.length;for(let s=0;s<e;++s)if(this.m_phases[s]<1||t==this.m_phases[s])return 1;return 0}destroy(){this.m_hosts=[],this.m_listeners=[],this.m_phases=[]}}e.default=i},efce:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("e7d2"),r=s("8a0a"),a=s("fecb"),h=s("cb29"),n=s("725b");class l extends h.default{constructor(t=r.default.VTX_DYNAMIC_DRAW){super(t),this.m_vs=null,this.m_uvs=null,this.m_width=0,this.m_height=0,this.m_charsTotal=0,this.m_charsStr="",this.flipVerticalUV=!1,this.vtxUVEnabled=!0,this.vtxColorEnabled=!1,this.alignFactorX=.5,this.alignFactorY=.5}getWidth(){return this.m_width}getHeight(){return this.m_height}createStrData(t){this.m_charsStr=t;let e=t.length;this.m_charsTotal=e;let s=!1;if(e>0){n.default.GetInstance().createCharsTexFromStr(t),this.m_width=-1,this.m_height=0;let r=l.s_sizeArr,h=0,_=0,o=0,m=0,u=0;if(s=null!=this.m_vs&&8*e>this.m_vs.length,s){let s=l.s_currIvs;for(s.set(l.s_initIvs,0),this.m_ivs=new Uint16Array(6*e),this.m_uvs=new Float32Array(8*e),this.m_vs=new Float32Array(8*e);h<e;++h)this.m_ivs.set(s,6*h),s[0]+=4,s[1]+=4,s[2]+=4,s[3]+=4,s[4]+=4,s[5]+=4,n.default.GetInstance().getCharTable().getUV8AndSizeFromChar(t.charAt(h),this.m_uvs,r,8*h),this.m_height<r[1]&&(this.m_height=r[1]),this.m_vs[8*h]=r[0],this.m_width+=r[0]}else for(null==this.m_vs&&(this.m_uvs=new Float32Array(8*e),this.m_vs=new Float32Array(8*e));h<e;++h)n.default.GetInstance().getCharTable().getUV8AndSizeFromChar(t.charAt(h),this.m_uvs,r,8*h),this.m_height<r[1]&&(this.m_height=r[1]),this.m_vs[8*h]=r[0],this.m_width+=r[0];let d=1;this.m_width+=e*d,m=-this.alignFactorX*this.m_width,u=-this.alignFactorY*this.m_height,o=u+this.m_height,null==this.bounds&&(this.bounds=new a.default),this.bounds.min.setXYZ(m,u,0),this.bounds.max.setXYZ(m+this.m_width,o,0);let c=0;for(h=0;h<e;++h)_=m+this.m_vs[c],this.m_vs[c]=m,this.m_vs[c+1]=u,this.m_vs[c+2]=_,this.m_vs[c+3]=u,this.m_vs[c+4]=_,this.m_vs[c+5]=o,this.m_vs[c+6]=m,this.m_vs[c+7]=o,m=_+d,c+=8;i.default.Reset(),i.default.AddFloat32Data(this.m_vs,2),i.default.AddFloat32Data(this.m_uvs,2)}s&&this.m_vbuf.setUint16IVSData(this.m_ivs),this.vtCount=6*e,this.vtxTotal=4*e,this.trisNumber=2*e}initialize(t){let e=t.length,s=l.s_currIvs;s.set(l.s_initIvs,0),null==this.m_ivs&&(this.m_ivs=new Uint16Array(6*e));for(let i=0;i<e;++i)this.m_ivs.set(s,6*i),s[0]+=4,s[1]+=4,s[2]+=4,s[3]+=4,s[4]+=4,s[5]+=4;this.createStrData(t),i.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.m_vbuf=i.default.CreateBySaveData(this.getBufDataUsage()),this.m_vbuf.setUint16IVSData(this.m_ivs),this.buildEnd()}updateCharStr(t){null!=this.m_vbuf&&this.m_charsStr!=t&&(this.createStrData(t),this.buildEnd(),i.default.UpdateBufData(this.m_vbuf))}__$destroy(){this.isResFree()&&(this.bounds=null,this.m_vs=null,this.m_uvs=null,super.__$destroy())}}l.s_initIvs=new Uint8Array([0,1,2,0,2,3]),l.s_currIvs=new Uint8Array([0,1,2,0,2,3]),l.s_sizeArr=[0,0],e.default=l},f044:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static CreateNewID(){return i.__s_uid++}}i.__s_uid=0,e.default=i},f0f0:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("f044");class r{constructor(t){this.m_uid=-1,this.m_total=0,this.m_offsetList=null,this.m_f32=null,this.m_f32Stride=0,this.m_uid=i.default.CreateNewID()}getUid(){return this.m_uid}getType(){return 0}getBuffersTotal(){return 1}getF32DataAt(t){return this.m_f32}setF32DataAt(t,e,s,i){null!=i&&(this.m_offsetList=i),this.m_f32Stride=s,this.m_f32=e}setData4fAt(t,e,s,i,r,a){t=this.m_f32Stride*t+this.m_offsetList[e],this.m_f32[t++]=s,this.m_f32[t++]=i,this.m_f32[t++]=r,this.m_f32[t++]=a}setData3fAt(t,e,s,i,r){t=this.m_f32Stride*t+this.m_offsetList[e],this.m_f32[t++]=s,this.m_f32[t++]=i,this.m_f32[t++]=r}setData2fAt(t,e,s,i){t=this.m_f32Stride*t+this.m_offsetList[e],this.m_f32[t++]=s,this.m_f32[t++]=i}destroy(){console.log("VtxCombinedBuf::__$destroy()... ",this),this.m_offsetList=null,this.m_f32=null}toString(){return"VtxCombinedBuf(uid = "+this.m_uid+")"}}e.default=r},f152:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8e17"),r=s("38de"),a=s("fecb"),h=s("35fa"),n=s("8a0a"),l=s("e7d2"),_=s("5282"),o=s("cb29");class m extends o.default{constructor(t=n.default.VTX_STATIC_DRAW){super(t),this.m_longitudeNumSegments=10,this.m_latitudeNumSegments=10,this.m_radius=50,this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,this.inverseUV=!1}getVS(){return this.m_vs}getUVS(){return this.m_uvs}getNVS(){return this.m_nvs}getCVS(){return this.m_cvs}getIVS(){return this.m_ivs}initialize(t,e,s,i){if(this.vtxTotal<1){if(t<.01)return;this.bounds=new a.default,this.bounds.min.setXYZ(-t,-t,-t),this.bounds.max.setXYZ(t,t,t),this.bounds.updateFast(),e<2&&(e=2),s<2&&(s=2),this.m_radius=Math.abs(t),this.m_longitudeNumSegments=e,this.m_latitudeNumSegments=s,(this.m_latitudeNumSegments+1)%2==0&&(this.m_latitudeNumSegments+=1),(this.m_longitudeNumSegments=this.m_latitudeNumSegments)&&(this.m_longitudeNumSegments+=1);let r=1,o=0,m=0,u=0,d=0,c=0,f=new _.default(0,-this.m_radius,0,m),p=[],g=[];g.push([]);let x=g[0];f.u=.5,f.v=.5,f.nx=0,f.ny=-1,f.nz=0,x.push(f.cloneVertex()),p.push(x[0]);let T=0,E=2.01*this.m_radius,y=0,v=1/this.m_radius;for(;r<this.m_latitudeNumSegments;++r){u=Math.PI*r/this.m_latitudeNumSegments,d=Math.sin(u),c=Math.cos(u),f.y=-this.m_radius*c,T=this.m_radius*d,y=f.y,y<0&&(y=-y),this.inverseUV||(y=this.m_radius-y),y/=E,g.push([]);let t=g[r];for(o=0;o<this.m_longitudeNumSegments;++o)u=2*Math.PI*o/this.m_longitudeNumSegments,++m,d=Math.sin(u),c=Math.cos(u),f.x=d*T,f.z=c*T,f.index=m,d*=y,c*=y,f.u=.5+d,f.v=.5+c,f.nx=f.x*v,f.ny=f.y*v,f.nz=f.z*v,t.push(f.cloneVertex()),p.push(t[o]);t.push(t[0])}++m,f.index=m,f.x=0,f.y=this.m_radius,f.z=0,f.u=.5,f.v=.5,f.nx=0,f.ny=1,f.nz=0,g.push([]);let S=g[this.m_latitudeNumSegments];S.push(f.cloneVertex()),p.push(S[0]);let R=null,b=[],A=null,L=null;for(r=1;r<=this.m_latitudeNumSegments;++r)for(A=g[r-1],L=g[r],o=1;o<=this.m_longitudeNumSegments;++o)1==r?(b.push(A[0].index),b.push(L[o].index),b.push(L[o-1].index)):r==this.m_latitudeNumSegments?(b.push(A[o].index),b.push(L[0].index),b.push(A[o-1].index)):(b.push(A[o].index),b.push(L[o-1].index),b.push(A[o-1].index),b.push(A[o].index),b.push(L[o].index),b.push(L[o-1].index));for(this.vtxTotal=p.length,i?(this.m_ivs=new Uint16Array(2*b.length),this.m_ivs.set(b,0),b.reverse(),this.m_ivs.set(b,b.length)):this.m_ivs=new Uint16Array(b),this.m_vs=new Float32Array(3*this.vtxTotal),r=0,o=0;o<this.vtxTotal;++o)R=p[o],this.m_vs[r]=R.x,this.m_vs[r+1]=R.y,this.m_vs[r+2]=R.z,r+=3;if(l.default.Reset(),l.default.AddFloat32Data(this.m_vs,3),this.isVBufEnabledAt(n.default.VBUF_UVS_INDEX)){for(this.m_uvs=new Float32Array(2*this.vtxTotal),r=0,o=0;o<this.vtxTotal;++o)R=p[o],this.m_uvs[r]=R.u,this.m_uvs[r+1]=R.v,r+=2;l.default.AddFloat32Data(this.m_uvs,2)}if(this.isVBufEnabledAt(n.default.VBUF_NVS_INDEX)){for(this.m_nvs=new Float32Array(3*this.vtxTotal),r=0,o=0;o<this.vtxTotal;++o)R=p[o],this.m_nvs[r]=R.nx,this.m_nvs[r+1]=R.ny,this.m_nvs[r+2]=R.nz,r+=3;l.default.AddFloat32Data(this.m_nvs,3)}if(this.isVBufEnabledAt(n.default.VBUF_CVS_INDEX)){for(this.m_cvs=new Float32Array(3*this.vtxTotal),r=0,o=0;o<this.vtxTotal;++o)this.m_cvs[r]=1,this.m_cvs[r+1]=1,this.m_cvs[r+2]=1,r+=3;l.default.AddFloat32Data(this.m_cvs,3)}if(this.isVBufEnabledAt(n.default.VBUF_TVS_INDEX)){let t=this.m_ivs.length/3,e=new Float32Array(this.m_vs.length),s=new Float32Array(this.m_vs.length);h.default.ClacTrisTangent(this.m_vs,this.m_vs.length,this.m_uvs,this.m_nvs,t,this.m_ivs,e,s),l.default.AddFloat32Data(e,3),l.default.AddFloat32Data(s,3)}l.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.m_vbuf=l.default.CreateBySaveData(this.getBufDataUsage()),this.m_vbuf.setUint16IVSData(this.m_ivs),this.vtCount=this.m_ivs.length,this.trisNumber=this.vtCount/3}}__$destroy(){this.isResFree()&&(this.bounds=null,this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,super.__$destroy())}testRay(t,e,s,a){return r.default.IntersectioNearSphere2(t,e,i.default.ZERO,this.m_radius,s)}toString(){return"Sphere3DMesh()"}}e.default=m},f48d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8e17");class r{constructor(){this.id=-1,this.position=new i.default}update(){}updateFast(){}}r.__tV0=new i.default,r.__tV1=new i.default,r.__tV2=new i.default,e.AbsGeomBase=r,e.default=r},f63b:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("6e01"),r=s("8d98");function a(t,e,s){var i=document.createElement("canvas");i.width=e,i.height=s,i.style.backgroundColor="transparent",i.style.display="block",i.style.left="0px",i.style.top="0px",i.style.position="absolute";let r=i.getContext("2d");return r.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height),{canvas:i,ctx2d:r}}function h(t,e,s){var i=document.createElement("canvas");i.width=e,i.height=s,i.style.backgroundColor="transparent",i.style.display="block",i.style.left="0px",i.style.top="0px",i.style.position="absolute";let r=i.getContext("2d");return r.globalCompositeOperation="destination-atop",r.fillStyle="rgba(255, 255, 255, 1.0)",r.rect(0,0,i.width,i.height),r.fill(),r.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height),{canvas:i,ctx2d:r}}class n{constructor(t,e){this.m_url="",this.m_img=null,this.m_loaded=!1,this.m_mipLv=0,this.texture=null,this.bytesTex=null,this.offsetTex=null,this.premultipliedAlpha=!0,this.m_url=t,this.m_mipLv=e}startLoad(){if(null==this.m_img){let t=this;this.m_img=new Image,this.m_img.onload=function(e){t.m_loaded=!0,t.buildTex()},this.m_img.addEventListener("error",e=>{""!=t.m_url&&console.error("load image url error: ",t.m_url)}),this.m_img.crossOrigin="",this.m_img.src=this.m_url}}buildTex(){let t=this.m_img;if(null!=t&&this.m_loaded){let e=this.texture,s=this.offsetTex,r=this.bytesTex,n=null,l=i.default.IsPowerOf2(t.width)&&i.default.IsPowerOf2(t.height);if(l){if(null!=e)e.setDataFromImage(t,this.m_mipLv),e.name=this.m_img.src;else if(null!=r){let e=i.default.CalcNearestCeilPow2(t.width),s=i.default.CalcNearestCeilPow2(t.height);e>2048&&(e=2048),s>2048&&(e=2048);let h=a(t,e,s),l=this.m_mipLv;n=h.ctx2d.getImageData(0,0,h.canvas.width,h.canvas.height),r.setDataFromBytes(n.data,l,h.canvas.width,h.canvas.height),r.name=this.m_img.src}}else{let l=i.default.CalcNearestCeilPow2(t.width),_=i.default.CalcNearestCeilPow2(t.height);l>2048&&(l=2048),_>2048&&(l=2048),console.log("image canvas size: "+l+","+_);let o=a(t,l,_),m=this.m_mipLv;if(null!=e&&(e.setDataFromImage(o.canvas,m),console.log("use a base canvas create a img tex."),e.name=this.m_img.src,null!=s&&(o=h(t,l,_),s.setDataFromImage(o.canvas,m))),null!=r)if(this.premultipliedAlpha)console.log("use a base canvas create a bytes tex."),n=o.ctx2d.getImageData(0,0,o.canvas.width,o.canvas.height),r.setDataFromBytes(n.data,m,o.canvas.width,o.canvas.height),r.name=this.m_img.src;else{console.log("use a base canvas and a blendCanvas create a bytes tex."),n=o.ctx2d.getImageData(0,0,o.canvas.width,o.canvas.height);let e=n.data,s=h(t,l,_);n=s.ctx2d.getImageData(0,0,s.canvas.width,s.canvas.height);let i=n.data,a=0,u=0,d=0;for(;a<_;++a)for(u=0;u<l;++u)e[d]+=255-i[d],e[d+1]+=255-i[d+1],e[d+2]+=255-i[d+2],d+=4;r.setDataFromBytes(e,m,o.canvas.width,o.canvas.height),r.name=this.m_img.src}}this.m_loaded=!0}}getURL(){return this.m_url}getImage(){return this.m_img}isLoaded(){return this.m_loaded}destroy(){this.m_loaded=!1,this.m_url="",this.texture=null,this.m_img.src="",this.m_img=null}}class l{constructor(t){this.m_urls=null,this.m_imgs=[],this.m_loadedTotal=0,this.m_loaded=!1,this.m_texList=[],this.m_mLvList=[],this.m_urls=t;var e=this;let s=0,i=null;for(;s<6;++s)i=new Image,i.onload=function(t){if(e.m_loadedTotal++,e.m_loadedTotal>=6){let t=0;for(t=0;t<6;++t)e.m_texList[0].setDataFromImageToFaceAt(t,e.m_imgs[t],e.m_mLvList[0]);e.m_texList[0].name=e.m_imgs.src}},i.crossOrigin="",i.src=e.m_urls[s],e.m_imgs.push(i)}addTex(t,e){this.m_texList.push(t),this.m_mLvList.push(e)}getURLAt(t){return this.m_urls[0]}getTexAt(t){return this.m_texList[t]}isLoaded(){return this.m_loaded}destroy(){}}class _{constructor(t){this.m_cubeDict=new Map,this.m_resMap=new Map,this.m_loadedList=[],this.m_waitLoadList=[],this.m_loadingList=[],this.m_loadingQueueMaxLength=5,this.m_loadDelay=17,this.m_loadDelayTime=17,this.m_testDelay=512,this.m_testDelayTime=512,this.m_texBlock=null,this.m_runFlag=0,this.m_texBlock=t,null!=t&&t.addTexLoader(this)}getTexByUrl(t,e=!0,s=!0){let i=this.getImageTexByUrl(t);return i.mipmapEnabled=s,e&&i.setWrap(r.TextureConst.WRAP_REPEAT),i}getBytesNoPremultipliedAlphaTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.m_resMap.get(t);if(null==s){s=new n(t,e),s.premultipliedAlpha=!1,this.m_resMap.set(t,s);let i=this.m_texBlock.createBytesTex(1,1);return i.name=t,s.bytesTex=i,this.m_waitLoadList.push(s),i}return s.bytesTex.isDestroyed()&&(s.bytesTex=this.m_texBlock.createBytesTex(1,1)),s.bytesTex}getBytesTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.m_resMap.get(t);if(null==s){s=new n(t,e),this.m_resMap.set(t,s);let i=this.m_texBlock.createBytesTex(1,1);return i.name=t,s.bytesTex=i,this.m_waitLoadList.push(s),i}return s.bytesTex.isDestroyed()&&(s.bytesTex=this.m_texBlock.createBytesTex(1,1)),s.bytesTex}getImageOffsetTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.m_resMap.get(t);return null!=s?s.offsetTex:null}getImageTexByUrl(t,e=0,s=!1){if(""==t)return null;e<0&&(e=0);let i=this.m_resMap.get(t);if(null==i){i=new n(t,e),s&&(i.offsetTex=this.m_texBlock.createImageTex2D(1,1)),this.m_resMap.set(t,i);let r=this.m_texBlock.createImageTex2D(1,1);return r.name=t,i.texture=r,this.m_waitLoadList.push(i),r}return i.texture.isDestroyed()&&(i.texture=this.m_texBlock.createImageTex2D(1,1)),i.texture}getCubeTexAndLoadImg(t,e,s=0){if(""==t||null==e||e.length<6)return null;s<0&&(s=0);let i=this.m_cubeDict.get(t);if(null==i){i=new l(e),this.m_cubeDict.set(t,i);let r=this.m_texBlock.createImageCubeTex(8,8);return i.addTex(r,s),r}return i.getTexAt(0)}setRunFlag(t){this.m_runFlag=t}getRunFlag(){return this.m_runFlag}isRunning(){return!0}isStopped(){return!1}run(){let t=0,e=null;if(--this.m_loadDelay,this.m_loadDelay<1){this.m_loadDelay=this.m_loadDelayTime;let s=this.m_loadingList.length;if(s>0)for(;t<s;++t)this.m_loadingList[t].isLoaded()&&(this.m_loadedList.push(this.m_loadingList[t]),this.m_loadingList.splice(t,1),--t,--s);let i=this.m_waitLoadList.length;if(i>0&&s<this.m_loadingQueueMaxLength)for(t=s;t<this.m_loadingQueueMaxLength;++t){if(!(this.m_waitLoadList.length>0))break;e=this.m_waitLoadList.pop(),this.m_loadingList.push(e),e.startLoad()}}if(--this.m_testDelay,this.m_testDelay<1){this.m_testDelay=this.m_testDelayTime;let s=null,i=this.m_loadedList.length;for(t=0;t<i;++t)e=this.m_loadedList[t],s=null!=e.texture?e.texture:e.bytesTex,s.isDestroyed()&&(console.log("ImageTextureLoader::run(),remove a resource,url: ",e.getURL()),this.m_resMap.delete(e.getURL()),this.m_loadedList.splice(t,1),e.destroy(),--t,--i)}}}e.default=_},f63e:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("b3bd"),r=s("0fc4");class a extends r.default{constructor(){super(),this.m_colorArray=new Float32Array([1,1,1,1])}setRGB3f(t,e,s){this.m_colorArray[0]=t,this.m_colorArray[1]=e,this.m_colorArray[2]=s}setRGBA4f(t,e,s,i){this.m_colorArray[0]=t,this.m_colorArray[1]=e,this.m_colorArray[2]=s,this.m_colorArray[3]=i}setAlpha(t){this.m_colorArray[3]=t}createSelfUniformData(){let t=new i.default;return t.uniformNameList=["u_color"],t.dataList=[this.m_colorArray],t}}e.default=a},f928:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98"),r=s("df25");class a extends r.default{constructor(t,e,s=!1){super(t,e,s),this.m_type=i.TextureProxyType.Float,this.minFilter=i.TextureConst.LINEAR,this.internalFormat=i.TextureFormat.RGBA16F,this.dataType=i.TextureDataType.FLOAT,this.unpackAlignment=4}toAlphaFormat(){this.srcFormat=i.TextureFormat.ALPHA,this.internalFormat=i.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=i.TextureFormat.RED,this.internalFormat=i.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=i.TextureFormat.RGB,this.internalFormat=i.TextureFormat.RGB,this.unpackAlignment=3}toRGBAFormat(){this.srcFormat=i.TextureFormat.RGBA,this.internalFormat=i.TextureFormat.RGBA,this.unpackAlignment=4}uploadFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,h=!1){super.setDataFromBytes(t,e,s,i,r,a,h)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[FloatTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=a},fa60:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("919c");class r extends i.default{constructor(){super(),this.vao=null,this.m_uid=r.s_uid++}run(){this.m_rc.testVROUid(this.m_uid)&&(this.m_rc.bindVertexArray(this.vao),this.m_rc.testRIOUid(this.m_vtxUid)&&this.m_rc.bindEleBuf(this.ibuf))}__$destroy(){console.log("VaoVertexRenderObj::__$destroy()..., "+this),i.default.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.ibuf=null,this.vao=null,this.m_rc=null}restoreThis(){null!=this.vao&&this.m_rc.deleteVertexArray(this.vao),r.Restore(this)}toString(){return"VaoVertexRenderObj(uid = "+this.m_uid+", type="+this.m_mid+")"}static HasMid(t){return i.default.s_midMap.has(t)}static GetByMid(t){return i.default.s_midMap.get(t)}static GetFreeId(){return r.s_freeIdList.length>0?r.s_freeIdList.pop():-1}static Create(t,e,s){let a=null,h=r.GetFreeId();return h>=0?(a=r.s_unitList[h],r.s_unitFlagList[h]=r.S_FLAG_BUSY,a.setMidAndBufUid(e,s)):(a=new r,a.setMidAndBufUid(e,s),r.s_unitList.push(a),r.s_unitFlagList.push(r.S_FLAG_BUSY),r.s_unitListLen++),a.setRC(t),i.default.s_midMap.set(e,a),a}static Restore(t){if(null!=t&&t.m_attachCount<1&&r.s_unitFlagList[t.getUid()]==r.S_FLAG_BUSY){let e=t.getUid();r.s_freeIdList.push(e),r.s_unitFlagList[e]=r.S_FLAG_FREE,t.__$destroy()}}}r.s_uid=0,r.S_FLAG_BUSY=1,r.S_FLAG_FREE=0,r.s_unitFlagList=[],r.s_unitListLen=0,r.s_unitList=[],r.s_freeIdList=[],e.default=r},faa5:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("4a54");class r{constructor(){this.m_texList=null,this.m_texEnabled=!0}initialize(t){null!=r.___s_csBuf&&r.___s_csBuf!=this&&r.___s_csBuf.initialize(t),this.m_texEnabled=t}isTexEanbled(){return this.m_texEnabled}setIRenderTextureList(t){this.m_texList=t}getIRenderTextureList(){return this.m_texList}buildShader(){}getFragShaderCode(){if(r.___s_csBuf!=this)return r.___s_csBuf.getFragShaderCode();let t="";return t=this.m_texEnabled?"#version 300 es\nprecision mediump float;\nuniform sampler2D u_sampler0;\nuniform vec4 u_color;\nin vec2 v_uvs;\nlayout(location = 0) out vec4 FragColor;\nvoid main(){\n    FragColor = u_color * texture(u_sampler0, v_uvs);\n}\n":"#version 300 es\nprecision mediump float;\nuniform vec4 u_color;\nlayout(location = 0) out vec4 FragColor;\nvoid main(){\n    FragColor = u_color;\n}\n",t}getVtxShaderCode(){if(r.___s_csBuf!=this)return r.___s_csBuf.getVtxShaderCode();let t="";return t=this.m_texEnabled?"#version 300 es\nprecision mediump float;\nlayout(location = 0) in vec3 a_vs;\nlayout(location = 1) in vec2 a_uvs;\nuniform mat4 u_objMat;\nuniform mat4 u_viewMat;\nuniform mat4 u_projMat;\nout vec2 v_uvs;\nvoid main(){\n    gl_Position = u_projMat * u_viewMat * u_objMat * vec4(a_vs,1.0);\n    v_uvs = a_uvs;\n}\n":"#version 300 es\nprecision mediump float;\nlayout(location = 0) in vec3 a_vs;\nuniform mat4 u_objMat;\nuniform mat4 u_viewMat;\nuniform mat4 u_projMat;\nvoid main(){\n    gl_Position = u_projMat * u_viewMat * u_objMat * vec4(a_vs,1.0);\n}\n",t}getUniqueShaderName(){return r.___s_csBuf!=this?r.___s_csBuf.getUniqueShaderName():this.m_texEnabled?"vox_default_shd_tex":"vox_default_shd"}toString(){return"[ShaderCodeBuffer()]"}static UseShaderBuffer(t){r.___s_csBuf=t}}r.___s_csBuf=null,r.s_coder=new i.default,e.default=r},fae3:function(t,e,s){"use strict";s.r(e);s("1eb2");var i=s("b88e");for(var r in i)["default"].indexOf(r)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(r)},fc07:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("352a"),r=s("2e8a"),a=s("78e9");class h{constructor(){this.m_useTex=!1,this.m_attriNSList=null,this.m_attriSizeList=null,this.uniformNameListStr="",this.texUniformNameListStr="",this.attributes=[null,null,null,null,null,null,null,null,null,null,null,null],this.m_uniforms=null,this.texTotal=0,this.fragOutputTotal=0}reset(){this.m_useTex=!1,this.m_attriNSList=null,this.uniformNameListStr="",this.texUniformNameListStr="";let t=0;for(;t<12;++t)this.attributes[t]=null;this.m_uniforms=null,this.texTotal=0}parseVShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let s="\n",i=t.indexOf(s),h=0,n=[],l="",_="",o=new RegExp(" ","g");while(i>=0)l=t.slice(h,i),l.length>0&&(_=l.replace(o,""),0!=_.indexOf("//")&&n.push(l)),h=i+1,i=t.indexOf(s,h);l=t.slice(h,t.length),l.length>0&&(_=l.replace(o,""),0!=_.indexOf("//")&&n.push(l));let m="uniform ",u=n.length,d=null;for(i=0;i<12;++i)this.attributes[i]=null;this.m_attriNSList=[],this.m_attriSizeList=[];let c=null;null==this.m_uniforms&&(this.m_uniforms=[]),i=0;let f=!1,p=!1;while(i<u)l=n[i],f=l.indexOf("layout")>=0,p=l.indexOf("attribute ")>=0,f&&l.indexOf("location")>0||p?(d=new r.default,d.layoutEnabled=f,d.parseCode(l),this.attributes[d.attriType]=d,this.m_attriNSList.push(d.name),this.m_attriSizeList.push(d.typeSize)):l.indexOf(m)>=0&&(c=new a.default,c.parseCode(l)&&(this.m_uniforms.push(c),this.uniformNameListStr+=c.name+",",c.isTex&&(console.log("use vtx texture !!!"),this.texUniformNameListStr+=c.name+",",this.texTotal++))),++i}parseFShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let s="\n",r=t.indexOf(s),h=0,n=[],l="",_="",o=new RegExp(" ","g");while(r>=0)l=t.slice(h,r),l.length>0&&(_=l.replace(o,""),0!=_.indexOf("//")&&n.push(l)),h=r+1,r=t.indexOf(s,h);l=t.slice(h,t.length),l.length>0&&(_=_.replace(o,""),0!=_.indexOf("//")&&n.push(l));let m="uniform ",u=n.length,d=null;null==this.m_uniforms&&(this.m_uniforms=[]),r=0;while(r<u)l=n[r],l.indexOf(m)>=0&&this.uniformNameListStr.indexOf(m)<0&&(d=new a.default,d.parseCode(l)&&(this.m_uniforms.push(d),this.uniformNameListStr+=d.name+",",d.isTex&&(this.texUniformNameListStr+=d.name+",",this.texTotal++))),++r;let c="layout";i.default.IsWebGL1()&&(c="gl_FragData"),r=t.indexOf(c),this.fragOutputTotal=0;while(r>0)this.fragOutputTotal++,r=t.indexOf(c,r+2);this.fragOutputTotal<1&&(this.fragOutputTotal=1)}}e.default=h},fe7f:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98"),r=s("df25");class a extends r.default{constructor(t,e,s=!1){super(t,e,s),this.m_type=i.TextureProxyType.Bytes}toAlphaFormat(){this.srcFormat=i.TextureFormat.ALPHA,this.internalFormat=i.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=i.TextureFormat.RED,this.internalFormat=i.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=i.TextureFormat.RGB,this.internalFormat=i.TextureFormat.RGB,this.unpackAlignment=3}toRGBAFormat(){this.srcFormat=i.TextureFormat.RGBA,this.internalFormat=i.TextureFormat.RGBA,this.unpackAlignment=4}setDataFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,h=!1){super.setDataFromBytes(t,e,s,i,r,a,h)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[BytesTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=a},fecb:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("6e01"),r=s("8e17");class a{constructor(){this.min=new r.default(i.default.MATH_MAX_POSITIVE,i.default.MATH_MAX_POSITIVE,i.default.MATH_MAX_POSITIVE),this.max=new r.default(i.default.MATH_MIN_NEGATIVE,i.default.MATH_MIN_NEGATIVE,i.default.MATH_MIN_NEGATIVE),this.version=-1,this.radius=50,this.radius2=2500,this.center=new r.default(0,0,0),this.m_long=100,this.m_width=100,this.m_height=100,this.m_halfLong=50,this.m_halfWidth=50,this.m_halfHeight=50,this.m_tempV=new r.default}reset(){this.min.setXYZ(i.default.MATH_MAX_POSITIVE,i.default.MATH_MAX_POSITIVE,i.default.MATH_MAX_POSITIVE),this.max.setXYZ(i.default.MATH_MIN_NEGATIVE,i.default.MATH_MIN_NEGATIVE,i.default.MATH_MIN_NEGATIVE)}equals(t){return this.min.equalsXYZ(t.min)&&this.max.equalsXYZ(t.max)}setVolume(t,e,s){this.m_width=t,this.m_height=e,this.m_long=s,this.m_halfLong=.5*this.m_long,this.m_halfWidth=.5*this.m_width,this.m_halfHeight=.5*this.m_height,this.max.x=this.center.x+this.m_halfWidth,this.max.y=this.center.y+this.m_halfHeight,this.max.z=this.center.z+this.m_halfLong,this.min.x=this.center.x-this.m_halfWidth,this.min.y=this.center.y-this.m_halfHeight,this.min.z=this.center.z-this.m_halfLong,this.radius2=this.m_halfWidth*this.m_halfWidth+this.m_halfHeight*this.m_halfHeight+this.m_halfLong*this.m_halfLong,this.radius=Math.sqrt(this.radius2)}union(t){this.addPosition(t.min),this.addPosition(t.max)}addPosition(t){this.min.x>t.x&&(this.min.x=t.x),this.min.y>t.y&&(this.min.y=t.y),this.min.z>t.z&&(this.min.z=t.z),this.max.x<t.x&&(this.max.x=t.x),this.max.y<t.y&&(this.max.y=t.y),this.max.z<t.z&&(this.max.z=t.z)}addXYZ(t,e,s){this.min.x>t&&(this.min.x=t),this.min.y>e&&(this.min.y=e),this.min.z>s&&(this.min.z=s),this.max.x<t&&(this.max.x=t),this.max.y<e&&(this.max.y=e),this.max.z<s&&(this.max.z=s)}addXYZFloat32Arr(t){let e=t.length,s=0,i=0,r=0;for(let a=0;a<e;)s=t[a],++a,i=t[a],++a,r=t[a],++a,this.min.x>s&&(this.min.x=s),this.min.y>i&&(this.min.y=i),this.min.z>r&&(this.min.z=r),this.max.x<s&&(this.max.x=s),this.max.y<i&&(this.max.y=i),this.max.z<r&&(this.max.z=r)}containsV(t){return!(t.x<this.max.x||t.x>this.max.x)&&(!(t.y<this.max.y||t.y>this.max.y)&&!(t.z<this.max.z||t.z>this.max.z))}containsXY(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.y||e>this.max.y)}containsXZ(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.z||e>this.max.z)}containsYZ(t,e){return!(t<this.min.y||t>this.max.y)&&!(e<this.min.z||e>this.max.z)}update(){this.m_width=this.max.x,this.min.x>this.max.x&&(this.max.x=this.min.x,this.min.x=this.m_width),this.m_width=this.max.x-this.min.x,this.m_height=this.max.y,this.min.y>this.max.y&&(this.max.y=this.min.y,this.min.y=this.m_height),this.m_height=this.max.y-this.min.y,this.m_long=this.max.z,this.min.z>this.max.z&&(this.max.z=this.min.z,this.min.z=this.m_long),this.m_long=this.max.z-this.min.z,this.center.x=.5*this.m_width,this.center.y=.5*this.m_height,this.center.z=.5*this.m_long,this.m_halfLong=this.center.z,this.m_halfWidth=this.center.x,this.m_halfHeight=this.center.y,this.radius2=this.m_halfWidth*this.m_halfWidth+this.m_halfHeight*this.m_halfHeight+this.m_halfLong*this.m_halfLong,this.radius=Math.sqrt(this.radius2),this.center.x+=this.min.x,this.center.y+=this.min.y,this.center.z+=this.min.z,++this.version}updateVolume(){this.m_width=this.max.x-this.min.x,this.m_height=this.max.y-this.min.y,this.m_long=this.max.z-this.min.z,this.m_halfLong=.5*this.m_long,this.m_halfWidth=.5*this.m_width,this.m_halfHeight=.5*this.m_height}copyFrom(t){this.radius=t.radius,this.radius2=t.radius2,this.min.copyFrom(t.min),this.max.copyFrom(t.max),this.center.copyFrom(t.center),this.updateVolume()}updateFast(){this.m_width=this.max.x-this.min.x,this.m_height=this.max.y-this.min.y,this.m_long=this.max.z-this.min.z,this.center.x=.5*this.m_width,this.center.y=.5*this.m_height,this.center.z=.5*this.m_long,this.m_halfLong=this.center.z,this.m_halfWidth=this.center.x,this.m_halfHeight=this.center.y,this.radius2=this.m_halfWidth*this.m_halfWidth+this.m_halfHeight*this.m_halfHeight+this.m_halfLong*this.m_halfLong,this.radius=Math.sqrt(this.radius2),this.center.x+=this.min.x,this.center.y+=this.min.y,this.center.z+=this.min.z,++this.version}toString(){return"[AABB(min->"+this.min+",size("+this.m_width+","+this.m_height+","+this.m_long+"))]"}sphereIntersect(t,e){this.m_tempV.x=this.center.x-t.x,this.m_tempV.y=this.center.y-t.y,this.m_tempV.z=this.center.z-t.z;let s=this.m_tempV.getLengthSquared();return s<this.radius2||(e+=this.radius,e*=e,e>=s)}intersectRL(t,e){let s=0,i=(this.min.x-e.x)/t.x,r=(this.max.x-e.x)/t.x;i>r&&(s=r,r=i,i=s);let a=(this.min.y-e.y)/t.y,h=(this.max.y-e.y)/t.y;if(a>h&&(s=h,h=a,a=s),i>h||a>r)return!1;a>i&&(i=a),h<r&&(r=h);let n=(this.min.z-e.z)/t.z,l=(this.max.z-e.z)/t.z;return n>l&&(s=l,l=n,n=s),!(i>l||n>r)&&(n>i&&(i=n),l<r&&(r=l),!0)}static IntersectionRL3(t,e,s,i,r,a){return s.w=(t[e[0]].x-r.x)*s.x,i.w=(t[1-e[0]].x-r.x)*s.x,a.x=(t[e[1]].y-r.y)*s.y,a.y=(t[1-e[1]].y-r.y)*s.y,!(s.w>a.y||a.x>i.w)&&(a.x>s.w&&(s.w=a.x),a.y<i.w&&(i.w=a.y),a.x=(t[e[2]].z-r.z)*s.z,a.y=(t[1-e[2]].z-r.z)*s.z,!(s.w>a.y||a.x>i.w)&&(a.x>s.w&&(s.w=a.x),a.y<i.w&&(i.w=a.y),a.copyFrom(i),a.scaleBy(s.w),a.addBy(r),i.w=1,!0))}static IntersectionRL1(t,e,s,i){let r=0,a=(s.min.x-e.x)/t.x,h=(s.max.x-e.x)/t.x;a>h&&(r=h,h=a,a=r);let n=(s.min.y-e.y)/t.y,l=(s.max.y-e.y)/t.y;if(n>l&&(r=l,l=n,n=r),a>l||n>h)return!1;n>a&&(a=n),l<h&&(h=l);let _=(s.min.z-e.z)/t.z,o=(s.max.z-e.z)/t.z;return _>o&&(r=o,o=_,_=r),!(a>o||_>h)&&(_>a&&(a=_),o<h&&(h=o),i.copyFrom(t),i.scaleBy(a),i.addBy(e),console.log("L Hit outV: "+i.toString()),!0)}static IntersectionRL2(t,e,s,i){i.x=s.center.x-e.x,i.y=s.center.y-e.y,i.z=s.center.z-e.z;let r=i.dot(t);if(i.x-=r*t.x,i.y-=r*t.y,i.z-=r*t.z,i.getLengthSquared()>s.radius2)return console.log("Hit shp failure."),!1;if(s.containsV(e))return i.copyFrom(e),!0;if(e.x<s.min.x){if(t.x>0&&(r=(s.min.x-e.x)/t.x,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsYZ(i.y,i.z)))return!0}else if(e.x>s.max.x&&t.x<0&&(r=(s.max.x-e.x)/t.x,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsYZ(i.y,i.z)))return!0;if(e.y<s.min.y){if(t.y>0&&(r=(s.min.y-e.y)/t.y,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXZ(i.x,i.z)))return!0}else if(e.y>s.max.y&&t.y<0&&(r=s.max.y,r=(s.max.y-e.y)/t.y,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXZ(i.x,i.z)))return!0;if(e.z<s.min.z){if(t.z>0&&(r=(s.min.z-e.z)/t.z,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXY(i.x,i.y)))return!0}else if(e.z>s.max.z&&t.z<0&&(r=(s.max.z-e.z)/t.z,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXY(i.x,i.y)))return!0;return!1}}a.___pnV=new r.default,e.default=a}})}));