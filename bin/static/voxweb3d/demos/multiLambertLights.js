(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["VoxApp"]=e():t["VoxApp"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(i,a,function(e){return t[e]}.bind(null,a));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s="fae3")}({"0236":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("a996")),r=i(s("1710")),n=i(s("7045")),h=i(s("3024")),l=i(s("badb"));class o{constructor(t,e){this.A=0,this.pixelRatio=1,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.B=0,this.C=0,this.D=1,this.E=1,this.F=new l.default,this.G=[],this.H=[],this.I=[],this.J=[],this.K=[],this.L=[],this.M=[],this.N=[],this.uProbe=null,this.O=0,this.P=0,this.Q=new r.default,this.R=!0,this.S=new a.default,this.A=t}getRCUid(){return this.A}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.B}getViewY(){return this.C}getViewWidth(){return this.D}getViewHeight(){return this.E}setViewPort(t,e,s,i){this.R=!1,this.B=t,this.C=e,s==this.D&&i==this.E||(this.D=s,this.E=i,this.updateViewUData())}updateViewUData(){null==this.uProbe&&(this.uProbe=new h.default(1),this.uProbe.bindSlotAt(this.A)),this.uProbe.setVec4Data(2/(this.D*this.pixelRatio),2/(this.E*this.pixelRatio),this.D*this.pixelRatio,this.E*this.pixelRatio),this.uProbe.update(),this.O=this.D,this.P=this.E}update(){this.O==this.stageWidth&&this.P==this.stageHeight||(this.R&&(this.D=this.stageWidth,this.E=this.stageHeight,this.updateViewUData()),this.stageHalfWidth=.5*this.stageWidth,this.stageHalfHeight=.5*this.stageHeight)}mouseDown(t=1){this.Q.type=r.default.MOUSE_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=t,this.F.dispatchEvt(this.Q)}mouseUp(t=1){this.Q.phase=1,this.Q.type=r.default.MOUSE_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=t,this.F.dispatchEvt(this.Q)}mouseClick(){this.Q.type=r.default.MOUSE_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseDoubleClick(){this.Q.type=r.default.MOUSE_DOUBLE_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightDown(t=1){this.Q.type=r.default.MOUSE_RIGHT_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightUp(t=1){this.Q.type=r.default.MOUSE_RIGHT_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgDown(){this.Q.type=r.default.MOUSE_BG_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgUp(){this.Q.type=r.default.MOUSE_BG_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgClick(){this.Q.type=r.default.MOUSE_BG_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightClick(){this.Q.type=r.default.MOUSE_RIGHT_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseMove(){this.Q.type=r.default.MOUSE_MOVE,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseWheel(t){this.Q.type=r.default.MOUSE_WHEEL,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.wheelDeltaY=t.wheelDeltaY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseCancel(){this.Q.type=r.default.MOUSE_CANCEL,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseMultiDown(t){this.Q.type=r.default.MOUSE_MULTI_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseMultiUp(t){this.Q.type=r.default.MOUSE_MULTI_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseMultiMove(t){this.Q.type=r.default.MOUSE_MULTI_MOVE,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseWindowUp(t=1){}mouseWindowRightUp(t=1){}enterFrame(){this.S.type=a.default.ENTER_FRAME;let t=this.I.length;for(var e=0;e<t;++e)this.I[e].call(this.J[e],this.S)}addEventListener(t,e,s,i=!0,r=!0){if(null!=s&&null!=e){let h=0;switch(t){case a.default.RESIZE:break;case a.default.ENTER_FRAME:for(h=this.I.length-1;h>=0;--h)if(e===this.J[h])break;h<0&&(this.J.push(e),this.I.push(s));break;case n.default.KEY_DOWN:break;case n.default.KEY_UP:break;default:this.F.addEventListener(t,e,s,i,r);break}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=0;switch(t){case a.default.RESIZE:for(i=this.G.length-1;i>=0;--i)if(e===this.H[i]){this.H.splice(i,1),this.G.splice(i,1);break}break;case a.default.ENTER_FRAME:for(i=this.I.length-1;i>=0;--i)if(e===this.J[i]){this.J.splice(i,1),this.I.splice(i,1);break}break;case n.default.KEY_DOWN:for(i=this.K.length-1;i>=0;--i)if(e===this.L[i]){this.L.splice(i,1),this.K.splice(i,1);break}break;case n.default.KEY_UP:for(i=this.M.length-1;i>=0;--i)if(e===this.N[i]){this.N.splice(i,1),this.M.splice(i,1);break}break;default:this.F.removeEventListener(t,e,s);break}}}}e.default=o},"030e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Initialize(t,e){let s=this;1==t?(s.OES_standard_derivatives=e.getExtension("OES_standard_derivatives"),s.OES_standard_derivatives,s.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),s.EXT_shader_texture_lod,s.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),s.WEBGL_draw_buffers,s.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),s.OES_vertex_array_object,s.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),s.ANGLE_instanced_arrays,s.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),s.EXT_color_buffer_float,s.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),s.EXT_color_buffer_half_float,s.OES_texture_half_float=e.getExtension("OES_texture_half_float"),s.OES_texture_half_float,s.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),s.OES_texture_half_float_linear,s.OES_texture_float=e.getExtension("OES_texture_float"),s.OES_texture_float,s.OES_element_index_uint=e.getExtension("OES_element_index_uint"),s.OES_element_index_uint,s.EXT_blend_minmax=e.getExtension("EXT_blend_minmax"),s.EXT_blend_minmax):(s.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),s.EXT_shader_texture_lod,s.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),s.EXT_color_buffer_half_float,s.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),s.OES_texture_half_float_linear,s.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),s.EXT_color_buffer_float),s.OES_texture_float_linear=e.getExtension("OES_texture_float_linear"),s.OES_texture_float_linear,s.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),s.WEBGL_depth_texture,s.WEBGL_debug_renderer_info=e.getExtension("WEBGL_debug_renderer_info"),s.WEBGL_debug_renderer_info}}i.OES_standard_derivatives=null,i.EXT_shader_texture_lod=null,i.WEBGL_draw_buffers=null,i.OES_vertex_array_object=null,i.ANGLE_instanced_arrays=null,i.EXT_color_buffer_float=null,i.EXT_color_buffer_half_float=null,i.OES_texture_float_linear=null,i.OES_texture_half_float_linear=null,i.OES_texture_half_float=null,i.OES_texture_float=null,i.OES_element_index_uint=null,i.EXT_blend_minmax=null,i.WEBGL_depth_texture=null,i.WEBGL_debug_renderer_info=null,e.default=i},"0714":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t=null){this.T=i.F_j++,this.U=null,this.V=!1,this.W=new Map,this.X=[],this.Y=null,this.Z=null,this.a=null,this.b="",this.uuid="",this.Z=t}getUid(){return this.T}addShaderCodeWithUUID(t,e){null!=this.Z&&this.addShaderCode(this.Z.getShaderCodeObjectWithUUID(t),e)}addShaderCode(t,e=!1){this.V=null!=t,(null==this.U||null!=t&&e)&&(this.U=t)}hasShaderCode(){return null!=this.U}addPipe(t){let e=t.getPipeTypes();for(let s=0;s<e.length;++s)this.W.has(e[s])||this.W.set(e[s],t)}getPipeByType(t){return this.W.get(t)}hasPipeByType(t){return this.W.has(t)}createKeys(t){if(this.X=[],null!=t){let e,s,i=t;for(let t=0;t<i.length;++t)s=i[t],this.W.has(s)&&(e=this.W.get(s),this.X.push(e.getPipeKey(s)))}}buildSharedUniforms(t){if(this.Y=[],this.a=t,null!=t){let e,s,i=t;for(let t=0;t<i.length;++t)s=i[t],this.W.has(s)&&(e=this.W.get(s),e.resetPipe(),this.Y.push(e.getGlobalUinform()))}}build(t){if(this.V&&null!=this.U&&t.addShaderObject(this.U),null!=this.a){let e,s,i=this.a;for(let a=0;a<i.length;++a)s=i[a],this.W.has(s)&&(e=this.W.get(s),e.useShaderPipe(t,s))}}getTextures(t,e,s){if(null!=s){let i,a,r=s;for(let s=0;s<r.length;++s)a=r[s],this.W.has(a)&&(i=this.W.get(a),i.getTextures(t,e,a))}}getSharedUniforms(){return this.Y}getSelfUniformData(){return null}appendKeyString(t){this.b+=t}getKeys(){return this.X}getKeysString(){let t="";for(let e=0;e<this.X.length;++e)t+=this.X[e];return t+this.b}reset(){this.b="",this.V=!1}clear(){this.W=new Map,this.X=[],this.Y=null,this.U=null,this.Z=null,this.a=null}}i.F_j=0,e.MaterialPipeline=i},"0851":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("8d98"),r=i(s("6e01")),n=i(s("da6a"));class h{constructor(t,e,s=!1){this.T=-1,this.c=0,this.d=null,this.e=null,this.f=-1,this.g=128,this.h=128,this.i=128,this.j=128,this.k=a.TextureTarget.TEXTURE_2D,this.l=-1,this.m=!1,this.n=a.TextureProxyType.Default,this.o=!0,this.name="TextureProxy",this.internalFormat=a.TextureFormat.RGBA,this.srcFormat=a.TextureFormat.RGBA,this.dataType=a.TextureDataType.UNSIGNED_BYTE,this.wrap_s=a.TextureConst.WRAP_CLAMP_TO_EDGE,this.wrap_t=a.TextureConst.WRAP_CLAMP_TO_EDGE,this.wrap_r=a.TextureConst.WRAP_CLAMP_TO_EDGE,this.mipmapEnabled=!1,this.flipY=!1,this.premultiplyAlpha=!1,this.unpackAlignment=4,this.minFilter=a.TextureConst.LINEAR_MIPMAP_LINEAR,this.magFilter=a.TextureConst.LINEAR,this.version=0,this.e=n.default.GetInstance(),this.T=this.e.getFreeUid(),t<1&&(t=128),e<1&&(e=128),s?(this.g=r.default.CalcNearestCeilPow2(t),this.h=r.default.CalcNearestCeilPow2(e)):(this.g=t,this.h=e),this.e.__$$addTexture(this)}__$$use(t){t.bindToGpu(this.getResUid())}__$setRenderProxy(t){null!=this.e||(this.e=n.default.GetInstance(),this.T=this.e.getFreeUid(),this.e.__$$addTexture(this)),this.d=t}__$attachThis(){-1==this.c&&(this.e.removeFreeUid(this.getUid()),this.c=0),++this.c}__$detachThis(){this.c>0&&(--this.c,this.c<1&&(this.c=-1,this.e.addFreeUid(this.getUid())))}getAttachCount(){return this.c}isDirect(){return!0}getType(){return this.n}getResUid(){return this.T}getUid(){return this.T}setWrap(t){this.wrap_s=this.wrap_t=this.wrap_r=t}isGpuEnabled(){return null!=this.d&&this.d.Texture.hasResUid(this.getResUid())}getSampler(){return this.l}getTargetType(){return this.k}getBufWidth(){return this.i}getBufHeight(){return this.j}getWidth(){return this.g}getHeight(){return this.h}isDataEnough(){return this.m}uploadFromFbo(t,e,s){}__$buildParam(t){this.i=this.g,this.j=this.h,t.texParameteri(this.l,t.TEXTURE_WRAP_S,a.TextureConst.GetConst(t,this.wrap_s)),t.texParameteri(this.l,t.TEXTURE_WRAP_T,a.TextureConst.GetConst(t,this.wrap_t)),t.texParameteri(this.l,t.TEXTURE_MIN_FILTER,a.TextureConst.GetConst(t,this.minFilter)),t.texParameteri(this.l,t.TEXTURE_MAG_FILTER,a.TextureConst.GetConst(t,this.magFilter)),this.k==a.TextureTarget.TEXTURE_3D&&(t.texParameteri(this.l,t.TEXTURE_WRAP_R,a.TextureConst.GetConst(t,this.wrap_r)),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_BASE_LEVEL,0),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MAX_LEVEL,Math.log2(this.g))),this.mipmapEnabled&&this.o&&t.generateMipmap(this.l)}generateMipmap(t){if(this.mipmapEnabled&&this.o){let e=t.getRC();t.bindToGpu(this.getResUid()),this.__$buildParam(e)}}uploadData(t){}__$updateToGpu(t){}updateDataToGpu(t=null,e=!0){null!=t&&(this.d=t),null!=this.d&&this.d.MaterialUpdater.updateTextureData(this,e)}createTexBuf(t){return!t.hasResUid(this.getResUid())&&(this.l=a.TextureTarget.GetValue(t.getRC(),this.k),t.createResByParams3(this.getResUid(),this.getWidth(),this.getHeight(),this.l),!0)}__$$upload(t){if(this.m&&null!=this.e){let e=this.createTexBuf(t);e&&(this.__$updateToGpuBegin(t),this.uploadData(t),this.__$buildParam(t.getRC()),this.o=!0)}}dataUploadToGpu(t,e,s,i=!1){this.version=0;let r=a.TextureFormat.ToGL(t,this.internalFormat),n=a.TextureFormat.ToGL(t,this.srcFormat),h=a.TextureDataType.ToGL(t,this.dataType),l=e;if(null==s)(l.status>-1||i)&&l.updateToGpu(t,this.l,r,n,h,i);else{let e=s;for(let s=0,a=e.length;s<a;++s)l=e[s],null!=l&&(l.status>-1||i)&&l.updateToGpu(t,this.l,r,n,h,i);this.o=!1}}__$updateToGpuBegin(t){let e=t.getRC();t.bindToGpu(this.getResUid()),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,this.unpackAlignment)}__$updateToGpuEnd(t){}isDestroyed(){return this.c<-1}__$destroy(){this.getAttachCount()<1&&(this.c=-2,this.m=!1,this.g=1,this.h=1,this.d=null)}__$$removeFromSlot(){null!=this.e&&-2==this.getAttachCount()&&(this.e=null,this.d=null,this.T=-1)}toString(){return"[TextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.TextureProxy=h,e.default=h},"090c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("030e")),r=i(s("3b73")),n=i(s("b0ef")),h=i(s("0c85")),l=s("e08e");class o{constructor(){this.T=o.F_j++,this.p=new h.default,this.q=null,this.r=null,this.s=null,this.t=!1,this.u=!0,this.v=!0,this.w=null,this.x=null,this.y=null,this.z=0,this.A_=0,this.B_=800,this.C_=600,this.D_=2,this.E_=2,this.F_=1,this.G_=new n.default,this.autoSyncRenderBufferAndWindowSize=!0,this.offscreenRenderEnabled=!1,this.H_=null,this.I_=0,this.J_=0,this.K_=0,this.L_=0,this.M_=null,this.N_=null}contextrestoredHandler(t){}contextlostHandler(t){}setWebGLMaxVersion(t){1!=t&&2!=t||(this.D_=t)}getWebGLVersion(){return this.E_}getDiv(){return this.q}setDivStyleLeftAndTop(t,e){this.G_.setDivStyleLeftAndTop(t,e)}setDivStyleSize(t,e){this.G_.setDivStyleSize(t,e)}getCanvas(){return this.r}isDepthTestEnabled(){return this.u}isStencilTestEnabled(){return this.v}initialize(t,e,s,i=null){this.y=e;var n=null,h=null;try{void 0!=document&&(n=document,h=window)}catch(_){}if(null!=n){this.G_.setDiv(s),this.G_.createViewEle(n,this.autoSyncRenderBufferAndWindowSize),this.q=s=this.G_.getDiv();let _=this.r=this.G_.getCanvas();this.F_=window.devicePixelRatio,this.p.dpr=this.F_;let m=i;null==i?m={depth:this.u,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:this.v,preserveDrawingBuffer:!0,powerPreference:"default"}:(this.u=m.depth,this.v=m.stencil);let u=null;if(this.offscreenRenderEnabled&&(u=_.transferControlToOffscreen()),this.w=u,2==this.D_&&(this.x=null==u?_.getContext("webgl2",m):u.getContext("webgl2",m),null!=this.x&&(this.E_=2)),null==this.x&&(this.x=null==u?_.getContext("webgl",m)||_.getContext("experimental-webgl",m):u.getContext("webgl",m)||u.getContext("experimental-webgl",m),null!=this.x&&(this.E_=1)),!this.x)throw this.E_=-1,alert("Unable to initialize WebGL. Your browser or machine may not support it."),Error("WebGL initialization failure.");let d=this.x;d.rcuid=t;let c=l.GLStencilFunc;c.NEVER=d.NEVER,c.LESS=d.LESS,c.EQUAL=d.EQUAL,c.GREATER=d.GREATER,c.NOTEQUAL=d.NOTEQUAL,c.GEQUAL=d.GEQUAL,c.ALWAYS=d.ALWAYS;let f=l.GLStencilOp;f.KEEP=d.KEEP,f.ZERO=d.ZERO,f.REPLACE=d.REPLACE,f.INCR=d.INCR,f.INCR_WRAP=d.INCR_WRAP,f.DECR=d.DECR,f.DECR_WRAP=d.DECR_WRAP,f.INVERT=d.INVERT;let p=l.GLBlendMode;p.ZERO=d.ZERO,p.ONE=d.ONE,p.SRC_COLOR=d.SRC_COLOR,p.DST_COLOR=d.DST_COLOR,p.SRC_ALPHA=d.SRC_ALPHA,p.DST_ALPHA=d.DST_ALPHA,p.ONE_MINUS_SRC_ALPHA=d.ONE_MINUS_SRC_ALPHA;let g=l.GLBlendEquation;g.FUNC_ADD=d.FUNC_ADD,g.FUNC_SUBTRACT=d.FUNC_SUBTRACT,g.FUNC_REVERSE_SUBTRACT=d.FUNC_REVERSE_SUBTRACT,g.MIN_EXT=d.MIN_EXT,g.MAX_EXT=d.MAX_EXT,g.MIN=d.MIN,g.MAX=d.MAX;let v=l.CullFaceMode;v.BACK=d.BACK,v.FRONT=d.FRONT,v.FRONT_AND_BACK=d.FRONT_AND_BACK;let x=r.default;x.MAX_TEXTURE_SIZE=this.x.getParameter(this.x.MAX_TEXTURE_SIZE),x.MAX_RENDERBUFFER_SIZE=this.x.getParameter(this.x.MAX_RENDERBUFFER_SIZE);let T=this.x.getParameter(this.x.MAX_VIEWPORT_DIMS);x.MAX_VIEWPORT_WIDTH=T[0],x.MAX_VIEWPORT_HEIGHT=T[1],a.default.Initialize(this.E_,this.x),r.default.Initialize([this.E_]),null!=e&&this.p.initialize(_,s,e);let E=a.default.WEBGL_debug_renderer_info;if(null!=E){let t=this.x.getParameter(E.UNMASKED_VENDOR_WEBGL),e=this.x.getParameter(E.UNMASKED_RENDERER_WEBGL);x.GPU_VENDOR=t,x.GPU_RENDERER=e,r.default.IsWinExternalVideoCard()}var o=this;h.onresize=function(t){o.autoSyncRenderBufferAndWindowSize&&o.updateRenderBufferSize()},_.addEventListener("webglcontextrestored",this.contextrestoredHandler,!1),_.addEventListener("webglcontextlost",this.contextlostHandler,!1),this.updateRenderBufferSize()}}loseContext(){null==this.H_&&(this.H_=this.x.getExtension("WEBGL_lose_context")),null==this.H_&&this.H_.loseContext()}isContextLost(){return this.x.isContextLost()}getRC(){return this.x}setScissorEnabled(t){t?this.t||(this.t=!0,this.x.enable(this.x.SCISSOR_TEST)):this.t&&(this.t=!1,this.x.disable(this.x.SCISSOR_TEST))}setScissorRect(t,e,s,i){this.x.scissor(t,e,s,i)}setResizeCallback(t,e){this.N_=t,this.M_=e}getDevicePixelRatio(){return this.F_}resizeBufferSize(t,e){t=Math.floor(t),e=Math.floor(e);let s=window.devicePixelRatio,i=Math.abs(s-this.F_)>.02;this.F_=s,this.p.dpr=s,r.default.SetDevicePixelRatio(this.F_),(this.I_!=t||this.J_!=e||i)&&(this.I_=t,this.J_=e,this.K_=Math.floor(t*s),this.L_=Math.floor(e*s),null==this.w?(this.r.width=this.K_,this.r.height=this.L_):(this.w.width=this.K_,this.w.height=this.L_),this.r.style.width=this.I_+"px",this.r.style.height=this.J_+"px",null!=this.y&&(this.y.stageWidth=this.K_,this.y.stageHeight=this.L_,this.y.viewWidth=this.I_,this.y.viewHeight=this.J_,this.y.pixelRatio=s,this.y.update()),null!=this.M_&&this.M_.call(this.N_))}getStage(){return this.y}getStageWidth(){return this.y.stageWidth}getStageHeight(){return this.y.stageHeight}getDisplayWidth(){return this.I_}getDisplayHeight(){return this.J_}setViewport(t,e,s,i){let a=this.z!=t||this.A_!=e;(this.B_!=s||this.C_!=i||a)&&(this.z=t,this.A_=e,this.B_=s,this.C_=i)}setViewportSize(t,e){this.B_==t&&this.C_==e||(this.B_=t,this.C_=e)}testViewPortChanged(t,e,s,i){return this.z!=t||this.A_!=e||this.B_!=s||this.C_!=i}getViewportX(){return this.z}getViewportY(){return this.A_}getViewportWidth(){return this.B_}getViewportHeight(){return this.C_}getFBOWidth(){return this.B_<r.default.MAX_RENDERBUFFER_SIZE?this.B_:r.default.MAX_RENDERBUFFER_SIZE}getFBOHeight(){return this.C_<r.default.MAX_RENDERBUFFER_SIZE?this.C_:r.default.MAX_RENDERBUFFER_SIZE}getRCanvasWidth(){return this.K_}getRCanvasHeight(){return this.L_}updateRenderBufferSize(){let t=this.q.getBoundingClientRect();this.resizeBufferSize(t.width,t.height)}}o.F_j=0,e.default=o},"0929":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("6e01")),r=i(s("2139")),n=i(s("9156"));class h{constructor(){this.T=0,this.O_=new Float32Array(16),this.P_=!1,this.Q_=!1,this.updatedStatus=h.UPDATE_POSITION,this.updateStatus=h.UPDATE_TRANSFORM,this.R_=null,this.S_=null,this.T_=null,this.U_=null,this.V_=!0,this.W_=null,this.T=h.F_j++}getUid(){return this.T}getRotationFlag(){return this.Q_}getX(){return this.O_[12]}getY(){return this.O_[13]}getZ(){return this.O_[14]}setX(t){this.updateStatus|=1,this.updatedStatus|=1,this.O_[12]=t}setY(t){this.updateStatus|=1,this.updatedStatus|=1,this.O_[13]=t}setZ(t){this.updateStatus|=1,this.updatedStatus|=1,this.O_[14]=t}setXYZ(t,e,s){this.O_[12]=t,this.O_[13]=e,this.O_[14]=s,this.updateStatus|=1,this.updatedStatus|=1}offsetPosition(t){this.O_[12]+=t.x,this.O_[13]+=t.y,this.O_[14]+=t.z,this.updateStatus|=1,this.updatedStatus|=1}setPosition(t){this.O_[12]=t.x,this.O_[13]=t.y,this.O_[14]=t.z,this.updateStatus|=1,this.updatedStatus|=1}getPosition(t){t.x=this.O_[12],t.y=this.O_[13],t.z=this.O_[14]}copyPositionFrom(t){null!=t&&(this.O_[12]=t.O_[12],this.O_[13]=t.O_[13],this.O_[14]=t.O_[14],this.updateStatus|=h.UPDATE_POSITION,this.updatedStatus|=h.UPDATE_POSITION)}getRotationX(){return this.O_[1]}getRotationY(){return this.O_[6]}getRotationZ(){return this.O_[9]}setRotationX(t){this.O_[1]=t,this.Q_=!0,this.updateStatus|=h.UPDATE_ROTATION,this.updatedStatus|=h.UPDATE_ROTATION}setRotationY(t){this.O_[6]=t,this.Q_=!0,this.updateStatus|=h.UPDATE_ROTATION,this.updatedStatus|=h.UPDATE_ROTATION}setRotationZ(t){this.O_[9]=t,this.Q_=!0,this.updateStatus|=h.UPDATE_ROTATION,this.updatedStatus|=h.UPDATE_ROTATION}setRotationXYZ(t,e,s){this.O_[1]=t,this.O_[6]=e,this.O_[9]=s,this.updateStatus|=h.UPDATE_ROTATION,this.updatedStatus|=h.UPDATE_ROTATION,this.Q_=!0}getScaleX(){return this.O_[0]}getScaleY(){return this.O_[5]}getScaleZ(){return this.O_[10]}setScaleX(t){this.O_[0]=t,this.updateStatus|=h.UPDATE_SCALE,this.updatedStatus|=h.UPDATE_SCALE}setScaleY(t){this.O_[5]=t,this.updateStatus|=h.UPDATE_SCALE,this.updatedStatus|=h.UPDATE_SCALE}setScaleZ(t){this.O_[10]=t,this.updateStatus|=h.UPDATE_SCALE,this.updatedStatus|=h.UPDATE_SCALE}setScaleXYZ(t,e,s){this.O_[0]=t,this.O_[5]=e,this.O_[10]=s,this.updateStatus|=h.UPDATE_SCALE,this.updatedStatus|=h.UPDATE_SCALE}setScale(t){this.O_[0]=t,this.O_[5]=t,this.O_[10]=t,this.updateStatus|=h.UPDATE_SCALE,this.updatedStatus|=h.UPDATE_SCALE}getRotationXYZ(t){t.x=this.O_[1],t.y=this.O_[6],t.z=this.O_[9]}getScaleXYZ(t){t.x=this.O_[0],t.y=this.O_[5],t.z=this.O_[10]}localToGlobal(t){this.getMatrix().transformVectorSelf(t)}globalToLocal(t){this.getInvMatrix().transformVectorSelf(t)}getInvMatrix(){return null!=this.W_?this.P_&&(this.W_.copyFrom(this.R_),this.W_.invert()):(this.W_=r.default.GetMatrix(),this.W_.copyFrom(this.R_),this.W_.invert()),this.P_=!1,this.W_}getLocalMatrix(){return this.updateStatus>0&&this.update(),this.S_}getMatrix(t=!0){return this.updateStatus>0&&t&&this.update(),this.R_}getToParentMatrix(){return null!=this.U_?this.U_:this.R_}setParentMatrix(t){this.T_=t,this.P_=!0,null!=this.T_&&(this.S_==this.R_?(this.updateStatus=h.UPDATE_TRANSFORM,this.updatedStatus=this.updateStatus,this.S_=r.default.GetMatrix()):(this.updateStatus|=h.UPDATE_PARENT_MAT,this.updatedStatus=this.updateStatus))}updateMatrixData(t){null!=t&&(this.updateStatus=h.UPDATE_NONE,this.P_=!0,this.R_.copyFrom(t))}__$setMatrix(t){null!=t&&(this.updateStatus=h.UPDATE_NONE,this.P_=!0,this.S_==this.R_&&(this.S_=t),null!=this.R_&&(n.default.RemoveTransUniform(this.R_),r.default.RetrieveMatrix(this.R_)),this.R_=t)}destroy(){null!=this.W_&&r.default.RetrieveMatrix(this.W_),null!=this.S_&&(this.R_==this.S_&&n.default.RemoveTransUniform(this.R_),r.default.RetrieveMatrix(this.S_)),null!=this.R_&&this.R_!=this.S_&&(n.default.RemoveTransUniform(this.R_),r.default.RetrieveMatrix(this.R_)),this.W_=null,this.S_=null,this.R_=null,this.T_=null,this.updateStatus=h.UPDATE_TRANSFORM}copyFrom(t){this.O_.set(t.O_,0),this.updatedStatus|=1,this.updateStatus|=h.UPDATE_TRANSFORM,this.Q_=t.Q_}update(){this.updateStatus>0&&(this.P_=!0,this.updateStatus=this.updateStatus|this.updatedStatus,(this.updateStatus&h.UPDATE_TRANSFORM)>0&&(this.S_.getLocalFS32().set(this.O_,0),this.Q_&&this.S_.setRotationEulerAngle(this.O_[1]*a.default.MATH_PI_OVER_180,this.O_[6]*a.default.MATH_PI_OVER_180,this.O_[9]*a.default.MATH_PI_OVER_180),null!=this.T_&&(this.updateStatus=this.updateStatus|h.UPDATE_PARENT_MAT)),this.R_!=this.S_&&this.R_.copyFrom(this.S_),(this.updateStatus&h.UPDATE_PARENT_MAT)==h.UPDATE_PARENT_MAT&&(null!=this.U_||(this.U_=r.default.GetMatrix()),this.U_.copyFrom(this.R_),this.V_=!0,this.R_.append(this.T_)),this.updateStatus=h.UPDATE_NONE)}getMatrixFS32(){return this.getMatrix().getLocalFS32()}toString(){return"[ROTransform(uid = "+this.T+")]"}static GetFreeId(){return h.X_.length>0?h.X_.pop():-1}static Create(t=null){let e=null,s=h.GetFreeId();return s>=0?(e=h.Y_[s],h.Z_[s]=h.S_FLAG_BUSY):(e=new h,h.Y_.push(e),h.Z_.push(h.S_FLAG_BUSY),h.a_++),e.R_=null==t?r.default.GetMatrix():t,e.S_=e.R_,e.O_.set(h.F_k,0),e}static Restore(t){if(null!=t&&h.Z_[t.getUid()]==h.S_FLAG_BUSY){let e=t.getUid();h.X_.push(e),h.Z_[e]=h.S_FLAG_FREE,t.destroy()}}}h.F_j=0,h.F_k=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),h.UPDATE_NONE=0,h.UPDATE_POSITION=1,h.UPDATE_ROTATION=2,h.UPDATE_SCALE=4,h.UPDATE_TRANSFORM=7,h.UPDATE_PARENT_MAT=8,h.S_FLAG_BUSY=1,h.S_FLAG_FREE=0,h.Z_=[],h.a_=0,h.Y_=[],h.X_=[],e.default=h},"0c85":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("3b73"));class r{constructor(){this.b_=!1,this.c_=0,this.d_=0,this.e_=0,this.dpr=1}initMobile(t,e,s){var i=null;try{void 0!=document&&(i=document)}catch(r){}if(null!=i){let t=this;if(e.addEventListener("touchstart",t=>{let e=t.targetTouches,i=0,a=0;if(e.length<2)i=0|this.dpr*t.targetTouches[0].pageX,a=0|this.dpr*t.targetTouches[0].pageY,s.mouseX=i,s.mouseY=s.stageHeight-a,s.mouseViewX=i,s.mouseViewY=a,this.b_=!0,this.c_=s.mouseX,this.d_=s.mouseY,this.e_=Date.now(),s.mouseDown(1);else{let r=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,a=0|this.dpr*t.targetTouches[s].pageY,r.push({x:i,y:a});s.mouseMultiDown(r),this.b_=!1}t.preventDefault(),t.stopPropagation()},!1),e.addEventListener("touchend",t=>{this.b_=!1;let e=t.targetTouches,i=0,a=0;if(e.length<1)s.mouseUp(1),this.e_=Date.now()-this.e_,Math.abs(this.c_-s.mouseX)<3&&Math.abs(this.d_-s.mouseY)<3&&this.e_<900&&(this.c_=s.mouseX,this.d_=s.mouseY,s.mouseClick());else{let r=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,a=0|this.dpr*t.targetTouches[s].pageY,r.push({x:i,y:a});s.mouseMultiUp(r)}t.preventDefault()},!1),e.addEventListener("touchcancel",e=>{t.b_=!1;e.targetTouches;s.mouseCancel(),e.preventDefault()},!1),e.addEventListener("touchmove",t=>{t.preventDefault();let e=t.targetTouches,i=0,a=0;if(this.b_&&(i=0|this.dpr*e[0].pageX,a=0|this.dpr*e[0].pageY,s.mouseViewX=i,s.mouseViewY=a,s.mouseX=i,s.mouseY=s.stageHeight-a,s.mouseMove()),e.length>1){let r=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,a=0|this.dpr*t.targetTouches[s].pageY,r.push({x:i,y:a});s.mouseMultiMove(r)}},{passive:!1},!1),a.default.IsIpadOS()){let t=document.createElement("meta");t.name="viewport",t.content="width=device-width,initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no",document.getElementsByTagName("head")[0].appendChild(t)}}}initialize(t,e,s){a.default.IsMobileWeb()||a.default.IsIpadOS()||this.initPC(t,e,s),this.initMobile(t,e,s)}initPC(t,e,s){var i=null;try{void 0!=document&&(i=document)}catch(a){}if(null!=i){if(void 0==t.onmousewheel&&void 0!=t.addEventListener){let e=function(t){t.wheelDeltaY=-t.detail,s.mouseWheel(t)};t.addEventListener("DOMMouseScroll",e,!1)}t.onmousewheel=t=>{t.preventDefault(),t.stopPropagation(),s.mouseWheel(t)},t.onmousedown=t=>{let i=e.getBoundingClientRect(),a=0|this.dpr*(t.clientX-i.left),r=0|this.dpr*(t.clientY-i.top);s.mouseX=a,s.mouseY=s.stageHeight-r,s.mouseViewX=a,s.mouseViewY=r,this.c_=s.mouseX,this.d_=s.mouseY,this.e_=Date.now(),0==t.button?s.mouseDown(1):2==t.button&&s.mouseRightDown(1)},t.onmouseup=t=>{let i=e.getBoundingClientRect(),a=0|this.dpr*(t.clientX-i.left),r=0|this.dpr*(t.clientY-i.top);s.mouseX=a,s.mouseY=s.stageHeight-r,0==t.button?s.mouseUp(1):2==t.button&&s.mouseRightUp(1)},document.onmouseup=t=>{0==t.button?s.mouseWindowUp(1):2==t.button&&s.mouseWindowRightUp(1)},t.onmousemove=t=>{let i=e.getBoundingClientRect(),a=0|this.dpr*(t.clientX-i.left),r=0|this.dpr*(t.clientY-i.top);s.mouseX=a,s.mouseY=s.stageHeight-r,s.mouseViewX=a,s.mouseViewY=r,s.mouseMove()},t.onclick=t=>{let i=e.getBoundingClientRect(),a=0|this.dpr*(t.clientX-i.left),r=0|this.dpr*(t.clientY-i.top);s.mouseX=a,s.mouseY=s.stageHeight-r,s.mouseViewX=a,s.mouseViewY=r,this.e_=Date.now()-this.e_,Math.abs(this.c_-s.mouseX)<3&&Math.abs(this.d_-s.mouseY)<3&&this.e_<900&&(this.c_=s.mouseX,this.d_=s.mouseY,0==t.button?s.mouseClick():2==t.button&&s.mouseRightClick())},t.ondblclick=t=>{let i=e.getBoundingClientRect(),a=0|this.dpr*(t.clientX-i.left),r=0|this.dpr*(t.clientY-i.top);s.mouseX=a,s.mouseY=s.stageHeight-r,s.mouseViewX=a,s.mouseViewY=r,0==t.button?s.mouseDoubleClick():t.button}}}}e.default=r},"0e01":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("baae")),r=i(s("5326")),n=i(s("29ef")),h=i(s("de9d")),l=i(s("4f27")),o=i(s("7499"));class _{constructor(t){this.f_=null,this.d=null,this.g_=null,this.h_=.1,this.i_=5e3,this.j_=45,this.A=0,this.A=t,this.d=new h.default(t)}getRCUid(){return this.A}getDiv(){return this.f_.getDiv()}getCanvas(){return this.f_.getCanvas()}getRenderAdapter(){return this.f_}getRenderMaterialProxy(){return this.g_}getRenderProxy(){return this.d}getTextureResTotal(){return this.d.Texture.getTextureResTotal()}getTextureAttachTotal(){return this.d.Texture.getAttachTotal()}getDevicePixelRatio(){return this.f_.getDevicePixelRatio()}getStage3D(){return this.d.getStage3D()}getCamera(){return null!=this.d?this.d.getCamera():null}cameraLock(){this.d.cameraLock()}cameraUnlock(){this.d.cameraUnlock()}updateCamera(){null!=this.d&&this.d.updateCamera()}updateCameraDataFromCamera(t){null!=this.d&&this.d.updateCameraDataFromCamera(t)}lockRenderColorMask(){null!=this.d&&this.d.lockRenderColorMask()}unlockRendererColorMask(){null!=this.d&&this.d.unlockRenderState()}useGlobalRenderColorMask(t){null!=this.d&&(this.d.unlockRenderColorMask(),this.d.useRenderColorMask(t),this.d.lockRenderColorMask())}useGlobalRenderColorMaskByName(t){null!=this.d&&(this.d.unlockRenderColorMask(),this.d.useRenderColorMask(n.default.GetRenderColorMaskByName(t)),this.d.lockRenderColorMask())}getRenderColorMaskByName(t){return n.default.GetRenderColorMaskByName(t)}lockRenderState(){null!=this.d&&this.d.lockRenderState()}unlockRenderState(){null!=this.d&&this.d.unlockRenderState()}useGlobalRenderState(t){null!=this.d&&(this.d.unlockRenderState(),this.d.useRenderState(t),this.d.lockRenderState())}useGlobalRenderStateByName(t){null!=this.d&&(this.d.unlockRenderState(),this.d.useRenderState(n.default.GetRenderStateByName(t)),this.d.lockRenderState())}getRenderStateByName(t){return n.default.GetRenderStateByName(t)}lockMaterial(){null!=this.g_&&this.g_.lockMaterial()}unlockMaterial(){null!=this.g_&&this.g_.unlockMaterial()}isUnlockMaterial(){return this.g_.isUnlockMatrial()}useGlobalMaterial(t,e=!1,s=!1){null!=this.g_&&(this.g_.unlockMaterial(),e?this.g_.unlockTexture():this.g_.lockTexture(),this.g_.useGlobalMaterial(t,s),this.g_.lockMaterial())}updateMaterialUniform(t){this.g_.updateMaterialUniform(t)}clearBackBuffer(){this.d.clearBackBuffer()}setScissorRect(t,e,s,i){this.f_.setScissorRect(t,e,s,i)}setScissorEnabled(t){this.f_.setScissorEnabled(t)}setViewPort(t,e,s,i){this.d.setViewPort(t,e,s,i)}synFBOSizeWithViewport(){this.f_.synFBOSizeWithViewport()}asynFBOSizeWithViewport(){this.f_.asynFBOSizeWithViewport()}setFBOSizeFactorWithViewPort(t){this.f_.setFBOSizeFactorWithViewPort(t)}createFBOAt(t,e,s,i,a=!1,r=!1,n=0){this.f_.createFBOAt(t,e,s,i,a,r,n)}bindFBOAt(t,e){this.f_.bindFBOAt(t,e)}setRenderToTexture(t,e=!1,s=!1,i=0){this.f_.setRenderToTexture(t,e,s,i)}useFBO(t=!1,e=!1,s=!1){this.f_.useFBO(t,e,s)}resetFBOAttachmentMask(t){this.f_.resetFBOAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){this.f_.setFBOAttachmentMaskAt(t,e)}setRenderToBackBuffer(){null!=this.f_&&(this.f_.setRenderToBackBuffer(a.default.FRAMEBUFFER),this.g_.renderBegin())}lockViewport(){this.f_.lockViewport()}unlockViewport(){this.f_.unlockViewport()}setClearDepth(t){this.f_.setClearDepth(t)}getClearDepth(){return this.f_.getClearDepth()}getViewportX(){return this.f_.getViewportX()}getViewportY(){return this.f_.getViewportY()}getViewportWidth(){return this.f_.getViewportWidth()}getViewportHeight(){return this.f_.getViewportHeight()}setContextViewSize(t,e){this.f_.setContextViewSize(t,e)}setCameraParam(t,e,s){this.j_=t,this.h_=e,this.i_=s,null!=this.d&&this.d.setCameraParam(t,e,s)}initialize(t,e,s,i,a){if(null==this.f_){r.default.Initialize(this.d.getUid()),this.d.setCameraParam(this.j_,this.h_,this.i_),this.d.setWebGLMaxVersion(t.maxWebGLVersion),this.d.initialize(t,e,s,i,i,a),this.A=this.d.getRCUid(),a.initialize(this.A,this.d.getRC(),this.d.getGLVersion()),this.f_=this.d.getRenderAdapter(),this.f_.bgColor.setRGBA4f(0,0,0,1);let n=this.d.getContext();n.setViewport(0,0,n.getRCanvasWidth(),n.getRCanvasHeight()),l.default.Initialize()}}initManager(t){null==this.g_&&(this.g_=new o.default,this.g_.setDispBuilder(t))}setClearRGBColor3f(t,e,s){this.d.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.d.setClearRGBAColor4f(t,e,s,i)}getClearRGBAColor4f(t){t.copyFrom(this.f_.bgColor)}updateRenderBufferSize(){this.f_.updateRenderBufferSize()}vertexRenderBegin(){this.d.Vertex.renderBegin()}renderBegin(t=!0){null!=this.f_&&(this.f_.unlockViewport(),this.f_.setClearDepth(1),this.d.Vertex.renderBegin(),this.g_.renderBegin(),this.f_.update(),this.f_.setClearMaskClearAll(),this.f_.renderBegin(),n.default.ResetInfo(),n.default.Reset(this.d.getRenderContext()),t&&(this.d.useCameraData(),this.d.updateCameraDataFromCamera(this.d.getCamera())))}resetState(){n.default.ResetState(),this.g_.renderBegin()}resetmaterial(){this.g_.renderBegin()}resetUniform(){this.g_.resetUniform()}runEnd(){}}e.default=_},"0fc4":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("9666")),r=i(s("faa5"));class n{constructor(){this.Y=null,this.k_=null,this.l_=null,this.t_="",this.n_="",this.o_=null,this.p_=null,this.__$troMid=-1,this.__$uniform=null,this.pipeTypes=null,this.q_=null,this.r_=0,this.F_l=!1,this.c=0}setPolygonOffset(t,e=0){null==this.p_?this.p_=[t,e]:(this.p_[0]=t,this.p_[1]=e)}getPolygonOffset(){return this.p_}setDepthOffset(t){}setMaterialPipeline(t){this.l_=t}getMaterialPipeline(){return this.l_}getShdUniqueName(){return this.n_}initializeByUniqueName(t){if(null==this.getShaderData()){let e=a.default.FindData(t);null!=e&&(this.o_=e)}return null!=this.getShaderData()}getCodeBuf(){return null!=n.F_m||(n.F_m=new r.default),n.F_m}hasShaderData(){return null!=this.o_&&(!this.o_.haveTexture()||this.texDataEnabled())}initializeByCodeBuf(t=!1){if(null==this.o_){let e=this.getCodeBuf();if(null!=e){let s;e.reset(),e.pipeline=this.l_,e.pipeTypes=this.pipeTypes,null!=e.pipeline&&e.pipeline.reset(),this.buildBuf();let i=this.t_;if(""!=i&&(s=a.default.FindData(i),this.n_=i),null==s?(null==n.F_m&&(n.F_m=new r.default),r.default.UseShaderBuffer(e),t=t||this.getTextureTotal()>0,e.initialize(t),i=e.getUniqueShaderName()+e.keysString+e.getShaderCodeBuilder().getUniqueNSKeyString(),this.n_=i,this.__$initShd(this.n_),s=a.default.FindData(i),this.t_=this.n_):(r.default.UseShaderBuffer(e),t=t||this.getTextureTotal()>0,e.initialize(t)),null==s){e.buildShader(),e.buildDefine(),null!=e.pipeline&&(null!=e.getShaderCodeObject()?e.pipeline.addShaderCode(e.getShaderCodeObject(),!1):e.pipeline.addShaderCodeWithUUID(e.getShaderCodeObjectUUID(),!1),e.pipeline.build(e.getShaderCodeBuilder()));let t=e.getFragShaderCode(),n=e.getVertShaderCode();s=a.default.CreateShdData(i,n,t,e.adaptationShaderVersion,r.default.GetPreCompileInfo())}null!=this.l_&&(this.Y=this.l_.getSharedUniforms()),r.default.UseShaderBuffer(null),this.o_=s}}}buildBuf(){}__$initShd(t){}getShaderData(){return this.o_}setTextureList(t){if(this.q_!=t){this.F_l=!1,this.r_=null!=t?t.length:0;let e=0;if(null!=this.q_)for(;e<this.q_.length;++e)this.q_[e].__$detachThis();if(this.F_l=!0,this.q_=t,null!=this.q_){let t=31;for(e=0;e<this.q_.length;++e)t=131*t+this.q_[e].getUid(),this.q_[e].__$attachThis(),this.q_[e].isDataEnough()||(this.F_l=!1);this.__$troMid=t}}}setTextureAt(t,e){if(t>=0&&null!=e){let s=this.q_,i=s.length;if(null!=s&&s[t]!=e&&t<i&&i>0){s=s.slice(0),s[t].__$detachThis(),s[t]=e,this.F_l=e.isDataEnough(),e.__$attachThis();let a=31;for(let t=0;t<i;++t)a=131*a+s[t].getUid();this.__$troMid=a,this.q_=s}}}getTextureList(){return this.q_}getTextureAt(t){return this.q_[t]}getTextureTotal(){return this.r_}getShdTexTotal(){return null!=this.o_?this.o_.getTexTotal():0}texDataEnabled(){if(null!=this.q_){if(this.F_l)return!0;let t=!0,e=this.q_;for(let s=0;s<this.r_;++s)if(!e[s].isDataEnough()){t=!1;break}return this.F_l=t,t}return null!=this.o_&&this.o_.getTexTotal(),!1}createSharedUniforms(){return this.Y}createSharedUniformsData(){return null}createSelfUniformData(){return this.k_}updateSelfData(t){}hasTexture(){return this.o_.haveTexture()}getBufSortFormat(){return null!=this.o_?this.o_.getLayoutBit():0}__$attachThis(){++this.c}__$detachThis(){--this.c,this.c<1&&(this.c=0)}getAttachCount(){return this.c}destroy(){if(this.Y=null,this.k_=null,this.pipeTypes=null,this.getAttachCount()<1){if(null!=this.q_)for(let t=0;t<this.q_.length;++t)this.q_[t].__$detachThis();this.o_=null,this.q_=null,this.F_l=!1,this.__$troMid=0,null!=this.__$uniform&&(this.__$uniform.destroy(),this.__$uniform=null)}}toString(){return"[MaterialBase()]"}}n.F_m=null,e.default=n},"11e6":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static AddContainerFlag(t){return 2147483648|t}static RemoveContainerFlag(t){return-2147483649&t}static AddSpaceUid(t,e){return-1048576&t|e}static RemoveSpaceUid(t){return-1048576&t}static GetSpaceUid(t){return 1048575&t}static AddRendererUid(t,e){return-133169153&t|e<<20}static RemoveRendererUid(t){return 133169152|t}static GetRendererUid(t){return t=(133169152&t)>>20,t<127?t:-1}static TestRendererUid(t){return t=(133169152&t)>>20,t<127}static AddSortEnabled(t){return 1073741824|t}static RemoveSortEnabled(t){return-1073741825&t}static TestSortEnabled(t){return 1073741824==(1073741824&t)}static AddRendererLoad(t){return 805306368|t}static RemoveRendererLoad(t){return-805306369&t}static TestSpaceContains(t){return(1048575&t)>0}static TestSpaceEnabled(t){return(1048575&t)<1}static TestSpaceEnabled2(t){return(1048575&t)<1&&2147483648!=(2147483648&t)}static TestContainerEnabled(t){return 133169152==(133169152&t)&&2147483648!=(2147483648&t)}static TestRendererEnabled(t){return 133169152==(938475520&t)&&2147483648!=(2147483648&t)}}i.DEFAULT=133169152,i.CONTAINER_FLAG=2147483648,i.CONTAINER_NOT_FLAG=-2147483649,i.SPACE_FLAG=1048575,i.SPACE_NOT_FLAG=-1048576,i.RENDERER_UID_FLAG=133169152,i.RENDERER_UID_NOT_FLAG=-133169153,i.RENDERER_UID_INVALID=127,i.SORT_FLAG=1073741824,i.SORT_NOT_FLAG=-1073741825,i.RENDERER_LOAD_FLAG=805306368,i.RENDERER_LOAD_NOT_FLAG=-805306369,i.RENDERER_ADN_LOAD_FLAG=938475520,e.default=i},1216:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17")),r=i(s("3930")),n=i(s("baae")),h=i(s("722e")),l=i(s("8333")),o=i(s("6d49")),_=s("e08e"),m=s("8d98"),u=s("7c63"),d=i(s("29ef")),c=i(s("3024"));class f{constructor(t,e){this.A=0,this.u_=null,this.x=null,this.v_=!1,this.w_={mr:!0,mg:!0,mb:!0,ma:!0},this.x_=null,this.y_=0,this.z_=null,this.AA=0,this.AB=n.default.FRAMEBUFFER,this.AC=[null,null,null,null,null,null,null,null],this.AD=!0,this.AE=!1,this.AF=!1,this.p_=!1,this.B=0,this.C=0,this.AG=800,this.AH=600,this.AI=1,this.AJ=0,this.AK=new a.default(0,0,800,600),this.AL=1,this.AM=0,this.AN=new Uint16Array(8),this.AO=new Uint16Array(4),this.AP=1,this.t=!1,this.AQ=null,this.AR=2,this.bgColor=new r.default,this.uViewProbe=null,this.AS=1,this.AT=!0,this.AU=!1,this.u_=e,this.A=t}initialize(t,e,s){if(null==this.x_&&(this.AR=t.getWebGLVersion(),this.AQ=s,this.x_=t,this.x=t.getRC(),this.x.disable(this.x.SCISSOR_TEST),t.isDepthTestEnabled()?this.x.enable(this.x.DEPTH_TEST):this.x.disable(this.x.DEPTH_TEST),t.isStencilTestEnabled()?this.x.enable(this.x.STENCIL_TEST):this.x.disable(this.x.STENCIL_TEST),e.getPolygonOffsetEanbled()?this.enabledPolygonOffset():this.disabledPolygonOffset(),this.x.enable(this.x.CULL_FACE),this.x.cullFace(this.x.BACK),this.x.enable(this.x.BLEND),e.getDitherEanbled()?this.x.enable(this.x.DITHER):this.x.disable(this.x.DITHER),this.x.frontFace(this.x.CCW),this.y_=this.x.COLOR_BUFFER_BIT|this.x.DEPTH_BUFFER_BIT|this.x.STENCIL_BUFFER_BIT,null==this.uViewProbe)){let t=this;t.uViewProbe=new c.default(1),this.uViewProbe.bindSlotAt(this.A),this.uViewProbe.setVec4DataWithArr4([this.B,this.C,this.AG,this.AH])}}setFrontFaceFlipped(t){this.v_!=t&&(t?this.x.frontFace(this.x.CW):this.x.frontFace(this.x.CCW),this.v_=t)}enabledPolygonOffset(){this.p_||(this.p_=!0,this.x.enable(this.x.POLYGON_OFFSET_FILL))}disabledPolygonOffset(){this.p_&&(this.p_=!1,this.x.disable(this.x.POLYGON_OFFSET_FILL))}setPolygonOffset(t,e=0){this.x.polygonOffset(t,e),this.AF=!0}resetPolygonOffset(){this.AF&&(this.x.polygonOffset(0,0),this.AF=!1)}getDiv(){return this.x_.getDiv()}getCanvas(){return this.x_.getCanvas()}setClearDepth(t){this.AI=t}getClearDepth(){return this.AI}setContextViewSize(t,e){this.x_.autoSyncRenderBufferAndWindowSize=!1,this.x_.resizeBufferSize(t,e)}getViewportX(){return this.x_.getViewportX()}getViewportY(){return this.x_.getViewportY()}getViewportWidth(){return this.x_.getViewportWidth()}getViewportHeight(){return this.x_.getViewportHeight()}getFBOFitWidth(){return this.x_.getFBOWidth()}getFBOFitHeight(){return this.x_.getFBOHeight()}getRCanvasWidth(){return this.x_.getRCanvasWidth()}getRCanvasHeight(){return this.x_.getRCanvasHeight()}setColorMask(t,e,s,i){this.w_.mr=t,this.w_.mg=e,this.w_.mb=s,this.w_.ma=i}setClearMaskClearAll(){this.y_=this.x.COLOR_BUFFER_BIT|this.x.DEPTH_BUFFER_BIT|this.x.STENCIL_BUFFER_BIT}setClearMaskClearOnlyColor(){this.y_=this.x.COLOR_BUFFER_BIT}setClearMaskClearOnlyDepthAndStencil(){this.y_=this.x.DEPTH_BUFFER_BIT|this.x.STENCIL_BUFFER_BIT}setScissorRect(t,e,s,i){this.t&&this.x.scissor(t,e,s,i)}setScissorEnabled(t){t?this.t||(this.t=!0,this.x.enable(this.x.SCISSOR_TEST)):this.t&&(this.t=!1,this.x.disable(this.x.SCISSOR_TEST))}clearDepth(t=1){this.AI=t,this.AJ!==this.AI&&(this.AJ=this.AI,this.x.clearDepth(this.AI)),this.x.clear(this.x.DEPTH_BUFFER_BIT)}clearColor(t){this.x.clearColor(t.r,t.g,t.b,t.a),this.x.clear(this.x.COLOR_BUFFER_BIT)}clear(){this.AJ!==this.AI&&(this.AJ=this.AI,this.x.clearDepth(this.AI)),this.x_.isStencilTestEnabled()&&this.x.clearStencil(this.AM),this.x.clearColor(this.bgColor.r,this.bgColor.g,this.bgColor.b,this.bgColor.a),this.x.clear(this.y_)}reset(){this.AQ.setCullFaceMode(_.CullFaceMode.BACK),this.AQ.setDepthTestMode(_.DepthTestMode.OPAQUE),d.default.Reset(this.x)}getRenderContext(){return this.x_}renderBegin(){null!=this.x_&&(this.AL=1,this.reseizeViewPort(),u.RenderStateObject.Unlock(),u.RenderStateObject.UseRenderState(d.default.NORMAL_STATE),u.RenderColorMask.Unlock(),u.RenderColorMask.UseRenderState(u.RenderColorMask.ALL_TRUE_COLOR_MASK),this.clear())}reseizeViewPort(){if(this.AT){let t=this.x_.getDevicePixelRatio(),e=this.B!=this.x_.getViewportX()||this.C!=this.x_.getViewportY();e=e||this.AG!=this.x_.getViewportWidth(),e=e||this.AH!=this.x_.getViewportHeight(),e=e||Math.abs(this.AS-t)>.01,e&&(this.AS=t,this.B=this.x_.getViewportX(),this.C=this.x_.getViewportY(),this.AG=this.x_.getViewportWidth(),this.AH=this.x_.getViewportHeight(),this.uViewProbe.setVec4Data(this.B,this.C,this.AG,this.AH),this.uViewProbe.update(),this.x.viewport(this.B,this.C,this.AG,this.AH))}}reseizeFBOViewPort(){if(this.AT){let t=this.x_.getDevicePixelRatio(),e=this.B!=this.AK.x||this.C!=this.AK.y;e=e||this.AG!=this.AK.z,e=e||this.AH!=this.AK.w,e=e||Math.abs(this.AS-t)>.01,e&&(this.AS=t,this.B=this.AK.x,this.C=this.AK.y,this.AG=this.AK.z,this.AH=this.AK.w,this.uViewProbe.setVec4Data(this.B,this.C,this.AG,this.AH),this.uViewProbe.update(),this.x.viewport(this.B,this.C,this.AG,this.AH))}}setViewProbeValue(t,e,s,i){this.uViewProbe.setVec4Data(t,e,s,i),this.uViewProbe.update()}lockViewport(){this.AT=!1}unlockViewport(){this.AT=!0}renderEnd(){}update(){}updateRenderBufferSize(){this.x_.updateRenderBufferSize()}destroy(){this.x_=null,this.AQ=null}getDevicePixelRatio(){return this.x_.getDevicePixelRatio()}loseContext(){this.x_.loseContext()}isContextLost(){return this.x_.isContextLost()}readPixels(t,e,s,i,a,r,n){this.x.readPixels(t,e,s,i,m.TextureFormat.ToGL(this.x,a),m.TextureDataType.ToGL(this.x,r),n)}setFBOViewRect(t,e,s,i){this.AO[0]=t,this.AO[1]=e,this.AO[2]=s,this.AO[3]=i,this.AE=!0}createFBOAt(t,e,s,i,a=!1,r=!1,n=0){null==this.AC[t]&&(t>7&&(t=7),this.AB=e,this.z_=new o.default(this.A,this.u_,this.AB),this.z_.multisampleEnabled=n>0,this.z_.multisampleLevel=n,this.z_.writeDepthEnabled=a,this.z_.writeStencilEnabled=r,this.z_.initialize(this.x,s,i),this.AC[t]=this.z_,this.z_.sizeFixed=!0)}resizeFBOAt(t,e,s){t>7?t=7:t<0&&(t=0),null!=this.AC[t]&&this.AC[t].resize(e,s)}getFBOWidthAt(t){return null!=this.AC[t]?this.AC[t].getWidth():0}getFBOHeightAt(t){return null!=this.AC[t]?this.AC[t].getHeight():0}synFBOSizeWithViewport(){this.AU=!0}asynFBOSizeWithViewport(){this.AU=!1}setFBOSizeFactorWithViewPort(t){this.AL=t}bindFBOAt(t,e){if(t>7?t=7:t<0&&(t=0),this.z_=this.AC[t],null==this.z_)throw Error("Fatal Error!!! this.z_ == null.");this.AA=t,this.AB=e,this.z_.bind(e),this.AD=!0}clearFBODepthAt(t,e=1){let s=this.AC[t];null!=s&&s.clearOnlyDepth(e)}resetFBOAttachmentMask(t){null!=this.z_&&this.z_.resetAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){null!=this.z_&&this.z_.setAttachmentMaskAt(t,e)}getFBOAttachmentTotal(){return null!=this.z_?this.z_.getAttachmentTotal():0}setRenderToTexture(t,e=!1,s=!1,i=0){(i<0||i>=8)&&(i=0),null==t&&0==i?this.setRenderToBackBuffer(n.default.FRAMEBUFFER):(0==i&&(null!=this.z_&&(this.AU?this.z_.initialize(this.x,Math.floor(this.x_.getFBOWidth()*this.AL),Math.floor(this.x_.getFBOHeight()*this.AL)):this.AE?this.z_.initialize(this.x,this.AO[2],this.AO[3]):this.z_.sizeFixed||this.z_.initialize(this.x,t.getWidth(),t.getHeight())),this.AA>=0&&null==this.z_&&(this.z_=new o.default(this.A,this.u_,this.AB),this.AC[this.AA]=this.z_,this.z_.writeDepthEnabled=e,this.z_.writeStencilEnabled=s,this.AU?this.z_.initialize(this.x,Math.floor(this.x_.getFBOWidth()*this.AL),Math.floor(this.x_.getFBOHeight()*this.AL)):this.AE?this.z_.initialize(this.x,this.AO[2],this.AO[3]):this.z_.initialize(this.x,t.getWidth(),t.getHeight()))),null!=this.z_&&this.z_.renderToTexAt(this.x,t,i),this.AD=!0)}getActiveAttachmentTotal(){return this.AP}getAttachmentTotal(){return this.AP}useFBO(t=!1,e=!1,s=!1){null!=this.z_&&this.AD&&(this.AD=!1,this.z_.use(this.x),this.AP=this.z_.getActiveAttachmentTotal(),t&&this.z_.clearOnlyColor(this.bgColor),this.z_.writeDepthEnabled?this.z_.writeStencilEnabled?e&&s?this.z_.clearOnlyDepthAndStencil(this.AI,4294967295):e?this.z_.clearOnlyDepth(this.AI):s&&this.z_.clearOnlyStencil(255):e&&this.z_.clearOnlyDepth(this.AI):s&&this.z_.writeStencilEnabled&&this.z_.clearOnlyStencil(255),1==this.AR&&this.x.clear(this.y_),this.AN[4]=this.AN[0]=this.B,this.AN[5]=this.AN[1]=this.C,this.AN[6]=this.AN[2]=this.B+this.AG,this.AN[7]=this.AN[3]=this.C+this.AH,this.AE?(this.AE=!1,this.AK.setTo(this.AO[0],this.AO[1],this.AO[2],this.AO[3]),this.reseizeFBOViewPort()):(this.AU?this.AK.setTo(0,0,Math.floor(this.x_.getFBOWidth()*this.AL),Math.floor(this.x_.getFBOHeight()*this.AL)):(this.z_.isSizeChanged()&&this.z_.initialize(this.x,this.z_.getWidth(),this.z_.getHeight()),this.AK.setTo(0,0,this.z_.getWidth(),this.z_.getHeight())),this.reseizeFBOViewPort()))}setRenderToBackBuffer(t=n.default.FRAMEBUFFER){this.AP=1,o.default.BindToBackbuffer(this.x,t),this.reseizeViewPort()}bindFBOToDraw(){null!=this.z_&&this.z_.bind(n.default.DRAW_FRAMEBUFFER)}bindFBOToWrite(){null!=this.z_&&this.z_.bind(n.default.READ_FRAMEBUFFER)}setBlitFboSrcRect(t,e,s,i){this.AN[0]=t,this.AN[1]=e,this.AN[2]=t+s,this.AN[3]=e+i}setBlitFboDstRect(t,e,s,i){this.AN[4]=t,this.AN[5]=e,this.AN[6]=t+s,this.AN[7]=e+i}blitFBO(t=0,e=0,s=l.default.COLOR_BUFFER_BIT,i=h.default.NEAREST,a=0,r=0,_=null){t>7&&(t=7),e>7&&(e=7),t>=0&&null!=this.AC[t]?this.AC[t].bind(n.default.READ_FRAMEBUFFER):o.default.BindToBackbuffer(this.x,n.default.READ_FRAMEBUFFER),e>=0&&null!=this.AC[e]?this.AC[e].bind(n.default.DRAW_FRAMEBUFFER):o.default.BindToBackbuffer(this.x,n.default.DRAW_FRAMEBUFFER),a>0&&(r<0&&(r=0),null==_&&(_=[0,0,0,1]),this.x.clearBufferfv(a,r,_));let m=this.AN;this.x.blitFramebuffer(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],s,i)}}e.default=f},"125c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("e9f0"));class r{constructor(){this.uvs=null,this.texture=null,this.rect=null,this.clampUVRect=null,this.uniqueName=""}getWidth(){return null!=this.rect?this.rect.width:0}getHeight(){return null!=this.rect?this.rect.height:0}destroy(){this.uvs=null,this.texture=null,this.rect=null}}e.CanvasTextureObject=r;class n{constructor(){if(this.AV=null,this.AW=null,null!=n.F_n)throw Error("class CanvasTextureTool is a singleton class.");n.F_n=this}static GetInstance(){return null!=n.F_n?n.F_n:new n}initialize(t){null==this.AV&&(this.AV=t)}initializeAtlas(t,e,s,i=!1){let r=null;null==n.F_q[0]&&(r=new a.default(this.AV,t,e,s,i),n.F_q[0]=r)}getAtlasAt(t){return n.F_q[t]}addcharsToAtlas(t,e,s="rgba(255,255,255,1.0)",i="rgba(255,255,255,0.3)"){if(""!=t){n.F_q[0];let r=a.default.CreateCharsTexture(t,e,s,i);return this.addImageToAtlas(t,r)}return null}getTextureObject(t){let e=n.F_q[0],s=e.getAreaByName(t);if(null!=s){let t=new r;return t.texture=e.getTexture(),t.uvs=s.uvs.slice(0),t.rect=s.texRect.clone(),t.clampUVRect=s.texRect.clone(),t.clampUVRect.x/=e.getWidth(),t.clampUVRect.y/=e.getHeight(),t.clampUVRect.width/=e.getWidth(),t.clampUVRect.height/=e.getHeight(),t.uniqueName=s.uniqueNS,t}return null}addImageToAtlas(t,e){let s=n.F_q[0],i=s.addSubImage(t,e);if(null!=i){let t=new r;return t.texture=s.getTexture(),t.uvs=i.uvs,t.rect=i.texRect,t.clampUVRect=i.texRect.clone(),t.clampUVRect.x/=s.getWidth(),t.clampUVRect.y/=s.getHeight(),t.clampUVRect.width/=s.getWidth(),t.clampUVRect.height/=s.getHeight(),t.uniqueName=i.uniqueNS,t}return null}getTextureObjectFromAtlas(t){return null}createCharsImage(t,e,s="rgba(255,255,255,1.0)",i="rgba(255,255,255,0.3)"){return null==t||""==t||e<8?null:a.default.CreateCharsTexture(t,e,s,i)}createWhiteTex(){if(null!=this.AW)return this.AW;let t=16,e=document.createElement("canvas");e.width=t,e.height=t;let s=e.getContext("2d");s.fillStyle="white",s.fillRect(0,0,t,t);let i=this.AV.textureBlock.createImageTex2D(32,32);return i.setDataFromImage(e),this.AW=i,i.premultiplyAlpha=!0,i}}n.F_n=null,n.F_o=new Map,n.F_p=new Map,n.F_q=[null,null,null,null],e.CanvasTextureTool=n,e.default=n},1264:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("11e6")),r=s("e08e"),n=s("eca0");class h{constructor(t,e,s,i){this.AX=null,this.AY=null,this.AZ=null,this.Aa=[],this.Ab=[],this.Ac=-1,this.Ad=0,this.Ae=null,this.Af=null,this.version=0,this.Ac=t,this.AY=e,this.AX=s,this.AZ=i}setListener(t){this.Af=t}isEmpty(){return this.Ad<1}isHaveEntity(){return this.Ad>0}removeEntity(t){this.Ad--;let e=t.getDisplay();if(null!=e&&null!=e.__$$runit){let t=e.__$ruid,s=this.AX.getRCRPObj(t);if(null!=s){if(s.count>0)if(s.count<2)s.rprocessUid>-1&&(this.Ae=this.AZ.getNodeByUid(s.rprocessUid),this.Ae.removeDisp(e),s.rprocessUid=-1);else{let t=n.RCRPObj.RenerProcessMaxTotal;for(let i=0;i<t;++i)(s.idsFlag&1<<i)>0&&(this.Ae=this.AZ.getNodeByUid(i),this.Ae.removeDisp(e))}}else this.Ae=this.AZ.getNodeByUid(e.__$$runit.getRPROUid()),this.Ae.removeDisp(e);0==s.count&&(e.__$$rsign,r.DisplayRenderSign.LIVE_IN_RENDERER,e.__$$rsign=r.DisplayRenderSign.NOT_IN_RENDERER,this.AX.restoreByUid(t)),this.version++}t.__$rseFlag=a.default.RemoveRendererUid(t.__$rseFlag),t.__$rseFlag=a.default.RemoveRendererLoad(t.__$rseFlag),t.__$rseFlag=a.default.RemoveSortEnabled(t.__$rseFlag),null!=this.Af&&this.Af.removeFromRenderer(t,this.Ac,-1)}addEntity(t,e,s=!1){if(null!=t){let i=t.getDisplay();if(null!=i){if(i.__$$rsign==r.DisplayRenderSign.LIVE_IN_RENDERER&&!this.AX.testRPNodeNotExists(i.__$ruid,e))return;this.Ae=this.AZ.getNodeByUid(e),t.__$rseFlag=this.Ae.getSortEnabled()?a.default.AddSortEnabled(t.__$rseFlag):a.default.RemoveSortEnabled(t.__$rseFlag),s?(i.__$$rsign==r.DisplayRenderSign.NOT_IN_RENDERER&&(i.__$$rsign=r.DisplayRenderSign.GO_TO_RENDERER),t.__$rseFlag=a.default.AddRendererLoad(t.__$rseFlag),t.__$rseFlag=a.default.AddRendererUid(t.__$rseFlag,this.Ac),this.Aa.push(t),this.Ab.push(e)):this.testValidData(t)?this.ensureAdd(t,i,e):(i.__$$rsign==r.DisplayRenderSign.NOT_IN_RENDERER&&(i.__$$rsign=r.DisplayRenderSign.GO_TO_RENDERER),t.__$rseFlag=a.default.AddRendererLoad(t.__$rseFlag),this.Aa.push(t),this.Ab.push(e))}else t.__$rseFlag=a.default.AddRendererUid(t.__$rseFlag,this.Ac)}return!1}testValidData(t){if(null!=t.getMaterial()&&t.hasMesh()){if(t.getMaterial().hasShaderData())return!0;null!=t.getMaterial().getCodeBuf()&&t.activeDisplay()}return!1}ensureAdd(t,e,s){t.update(),t.__$rseFlag=a.default.AddRendererUid(t.__$rseFlag,this.Ac),t.__$rseFlag=a.default.RemoveRendererLoad(t.__$rseFlag),t.__$setRenderProxy(this.AY.getRenderProxy()),this.Ad++,e.__$$rsign==r.DisplayRenderSign.NOT_IN_RENDERER&&(e.__$$rsign=r.DisplayRenderSign.GO_TO_RENDERER),this.Ae=this.AZ.getNodeByUid(s),(e.__$ruid>-1||this.AY.buildGpuDisp(e))&&this.Ae.addDisp(e),null!=this.Af&&this.Af.addToRenderer(t,this.Ac,s),null!=t.getGlobalBounds()&&(e.__$$runit.bounds=t.getGlobalBounds(),e.__$$runit.pos=e.__$$runit.bounds.center),this.version++}updateWaitList(){let t=this.Aa.length,e=null,s=null;for(let i=0;i<t;++i)if(e=this.Aa[i],(a.default.RENDERER_LOAD_FLAG&e.__$rseFlag)==a.default.RENDERER_LOAD_FLAG){if(this.testValidData(e)){if(s=e.getDisplay(),s.__$$rsign==r.DisplayRenderSign.LIVE_IN_RENDERER&&!this.AX.testRPNodeNotExists(s.__$ruid,this.Ab[i])){this.Aa.splice(i,1),this.Ab.splice(i,1),--t,--i;continue}this.ensureAdd(e,s,this.Ab[i]),this.Aa.splice(i,1),this.Ab.splice(i,1),--t,--i}}else s=e.getDisplay(),null!=s&&s.__$$rsign==r.DisplayRenderSign.GO_TO_RENDERER&&(s.__$$rsign=r.DisplayRenderSign.NOT_IN_RENDERER),e.__$rseFlag=a.default.RemoveRendererLoad(e.__$rseFlag),e.__$rseFlag=a.default.RemoveRendererUid(e.__$rseFlag),e.__$rseFlag=a.default.RemoveSortEnabled(e.__$rseFlag),this.Aa.splice(i,1),this.Ab.splice(i,1),--t,--i,null!=this.Af&&this.Af.removeFromRenderer(e,this.Ac,-1)}update(){this.Aa.length>0&&this.updateWaitList(),this.AY.update()}}e.default=h},1710:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17")),r=i(s("a996"));class n extends r.default{constructor(){super(),this.lpos=new a.default,this.wpos=new a.default,this.raytv=new a.default(1,0,0),this.raypv=new a.default(0,0,0),this.mouseX=0,this.mouseY=0,this.mouseViewX=0,this.mouseViewY=0,this.posArray=null,this.wheelDeltaY=0}static GetMouseEvtTypeValueBase(){return 5001}static GetMouseEvtTypeValuesTotal(){return 18}getClassType(){return n.EventClassType}toString(){return"[MouseEvent]"}}n.EventClassType=1002,n.MOUSE_DOWN=5001,n.MOUSE_UP=5002,n.MOUSE_RIGHT_UP=5003,n.MOUSE_RIGHT_DOWN=5004,n.MOUSE_MOVE=5005,n.MOUSE_WHEEL=5006,n.MOUSE_OVER=5007,n.MOUSE_OUT=5008,n.MOUSE_CLICK=5009,n.MOUSE_RIGHT_CLICK=5010,n.MOUSE_DOUBLE_CLICK=5011,n.MOUSE_CANCEL=5012,n.MOUSE_MULTI_DOWN=5013,n.MOUSE_MULTI_UP=5014,n.MOUSE_MULTI_MOVE=5015,n.MOUSE_BG_DOWN=5016,n.MOUSE_BG_UP=5017,n.MOUSE_BG_CLICK=5018,e.default=n},"18c7":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("6e01")),r=i(s("8e17")),n=i(s("abdb"));class h{constructor(t=null,e=0){this.T=-1,this.Ag=0,this.O_=null,this.Ah=null,this.Ag=e,null!=t?(this.T=h.F_j++,this.O_=t,this.Ah=this.O_.subarray(e,e+16)):(this.T=h.F_t++,this.O_=new Float32Array(16),this.O_.set(h.F_s,0),this.Ah=this.O_)}setData(t){16==t.length&&this.Ah.set(t)}getCapacity(){return 16}GetMaxUid(){return h.F_j}getUid(){return this.T}getLocalFS32(){return this.Ah}getFS32(){return this.O_}getFSIndex(){return this.Ag}identity(){this.Ah.set(h.F_s,0)}determinant(){return(this.Ah[0]*this.Ah[5]-this.Ah[4]*this.Ah[1])*(this.Ah[10]*this.Ah[15]-this.Ah[14]*this.Ah[11])-(this.Ah[0]*this.Ah[9]-this.Ah[8]*this.Ah[1])*(this.Ah[6]*this.Ah[15]-this.Ah[14]*this.Ah[7])+(this.Ah[0]*this.Ah[13]-this.Ah[12]*this.Ah[1])*(this.Ah[6]*this.Ah[11]-this.Ah[10]*this.Ah[7])+(this.Ah[4]*this.Ah[9]-this.Ah[8]*this.Ah[5])*(this.Ah[2]*this.Ah[15]-this.Ah[14]*this.Ah[3])-(this.Ah[4]*this.Ah[13]-this.Ah[12]*this.Ah[5])*(this.Ah[2]*this.Ah[11]-this.Ah[10]*this.Ah[3])+(this.Ah[8]*this.Ah[13]-this.Ah[12]*this.Ah[9])*(this.Ah[2]*this.Ah[7]-this.Ah[6]*this.Ah[3])}append(t){let e=t.getLocalFS32(),s=this.Ah,i=s[0],a=s[4],r=s[8],n=s[12],h=s[1],l=s[5],o=s[9],_=s[13],m=s[2],u=s[6],d=s[10],c=s[14],f=s[3],p=s[7],g=s[11],v=s[15],x=e[0],T=e[4],E=e[8],y=e[12],S=e[1],b=e[5],M=e[9],A=e[13],R=e[2],L=e[6],D=e[10],P=e[14],F=e[3],w=e[7],B=e[11],C=e[15];s[0]=i*x+h*T+m*E+f*y,s[1]=i*S+h*b+m*M+f*A,s[2]=i*R+h*L+m*D+f*P,s[3]=i*F+h*w+m*B+f*C,s[4]=a*x+l*T+u*E+p*y,s[5]=a*S+l*b+u*M+p*A,s[6]=a*R+l*L+u*D+p*P,s[7]=a*F+l*w+u*B+p*C,s[8]=r*x+o*T+d*E+g*y,s[9]=r*S+o*b+d*M+g*A,s[10]=r*R+o*L+d*D+g*P,s[11]=r*F+o*w+d*B+g*C,s[12]=n*x+_*T+c*E+v*y,s[13]=n*S+_*b+c*M+v*A,s[14]=n*R+_*L+c*D+v*P,s[15]=n*F+_*w+c*B+v*C}append3x3(t){let e=t.getLocalFS32(),s=this.Ah,i=s[0],a=s[4],r=s[8],n=s[1],h=s[5],l=s[9],o=s[2],_=s[6],m=s[10],u=e[0],d=e[4],c=e[8],f=e[1],p=e[5],g=e[9],v=e[2],x=e[6],T=e[10];s[0]=i*u+n*d+o*c,s[1]=i*f+n*p+o*g,s[2]=i*v+n*x+o*T,s[4]=a*u+h*d+_*c,s[5]=a*f+h*p+_*g,s[6]=a*v+h*x+_*T,s[8]=r*u+l*d+m*c,s[9]=r*f+l*p+m*g,s[10]=r*v+l*x+m*T}appendRotationPivot(t,e,s=null){null==s&&(s=r.default.Z_AXIS),h.F_r.identity(),h.F_r.getAxisRotation(e.x,e.y,e.z,t),h.F_r.appendTranslationXYZ(s.x,s.y,s.z),this.append(h.F_r)}appendRotation(t,e){h.F_r.identity(),h.F_r.getAxisRotation(e.x,e.y,e.z,t),this.append(h.F_r)}appendRotationX(t){h.F_r.rotationX(t),this.append3x3(h.F_r)}appendRotationY(t){h.F_r.rotationY(t),this.append3x3(h.F_r)}appendRotationZ(t){h.F_r.rotationZ(t),this.append3x3(h.F_r)}appendRotationEulerAngle(t,e,s){h.F_r.rotationY(e),this.append3x3(h.F_r),h.F_r.rotationX(t),this.append3x3(h.F_r),h.F_r.rotationZ(s),this.append3x3(h.F_r)}setScaleXYZ(t,e,s){let i=this.Ah;i[0]=t,i[5]=e,i[10]=s}setRotationEulerAngle(t,e,s){let i=this.Ah,a=Math.cos(t),r=Math.sin(t),n=Math.cos(e),h=Math.sin(e),l=Math.cos(s),o=Math.sin(s),_=l*h,m=o*h,u=n*i[0],d=r*i[5],c=a*i[5],f=a*i[10],p=r*i[10];i[1]=o*u,i[2]=-h*i[0],i[0]=l*u,i[4]=_*d-o*c,i[8]=_*f+o*p,i[5]=m*d+l*c,i[9]=m*f-l*p,i[6]=n*d,i[10]=n*f}setRotationEulerAngle2(t,e,s,i,a,r){let n=this.Ah,h=a*i,l=r*i,o=s*n[0],_=e*n[5],m=t*n[5],u=t*n[10],d=e*n[10];n[1]=r*o,n[2]=-i*n[0],n[0]=a*o,n[4]=h*_-r*m,n[8]=h*u+r*d,n[5]=l*_+a*m,n[9]=l*u-a*d,n[6]=s*_,n[10]=s*u}setTranslationXYZ(t,e,s){this.Ah[12]=t,this.Ah[13]=e,this.Ah[14]=s}setTranslation(t){this.Ah[12]=t.x,this.Ah[13]=t.y,this.Ah[14]=t.z}appendScaleXYZ(t,e,s){let i=this.Ah;i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=e,i[5]*=e,i[6]*=e,i[7]*=e,i[8]*=s,i[9]*=s,i[10]*=s,i[11]*=s}appendScaleXY(t,e){this.Ah[0]*=t,this.Ah[1]*=t,this.Ah[2]*=t,this.Ah[3]*=t,this.Ah[4]*=e,this.Ah[5]*=e,this.Ah[6]*=e,this.Ah[7]*=e}appendTranslationXYZ(t,e,s){this.Ah[12]+=t,this.Ah[13]+=e,this.Ah[14]+=s}appendTranslation(t){this.Ah[12]+=t.x,this.Ah[13]+=t.y,this.Ah[14]+=t.z}copyColumnFrom(t,e){switch(t){case 0:this.Ah[0]=e.x,this.Ah[1]=e.y,this.Ah[2]=e.z,this.Ah[3]=e.w;break;case 1:this.Ah[4]=e.x,this.Ah[5]=e.y,this.Ah[6]=e.z,this.Ah[7]=e.w;break;case 2:this.Ah[8]=e.x,this.Ah[9]=e.y,this.Ah[10]=e.z,this.Ah[11]=e.w;break;case 3:this.Ah[12]=e.x,this.Ah[13]=e.y,this.Ah[14]=e.z,this.Ah[15]=e.w;break;default:break}}copyColumnTo(t,e){t<<=2,e.x=this.Ah[t],e.y=this.Ah[1+t],e.z=this.Ah[2+t],e.w=this.Ah[3+t]}setF32ArrAndIndex(t,e=0){null!=t&&e>=0&&(this.O_=t,this.Ag=e,this.Ah=this.O_.subarray(e,e+16))}setF32ArrIndex(t=0){t>=0&&(this.Ag=t,this.Ah=this.O_.subarray(t,t+16))}setF32Arr(t){null!=t&&(this.O_=t)}copyFromF32Arr(t,e=0){let s=0;for(let i=e+16;e<i;e++)this.Ah[s]=t[e],++s}copyToF32Arr(t,e=0){t.set(this.Ah,e)}copyFrom(t){this.Ah.set(t.Ah,0)}copyTo(t){t.Ah.set(this.Ah,0)}copyRawDataFrom(t,e=16,s=0,i=!1){i&&this.transpose(),e-=s;let a=0;while(a<e)this.O_[this.Ag+a]=t[a+s],++a;i&&this.transpose()}copyRawDataTo(t,e=16,s=0,i=!1){i&&this.transpose();let a=0;while(a<e)t[a+s]=this.O_[this.Ag+a],++a;i&&this.transpose()}copyRowFrom(t,e){switch(t){case 0:this.Ah[0]=e.x,this.Ah[4]=e.y,this.Ah[8]=e.z,this.Ah[12]=e.w;break;case 1:this.Ah[1]=e.x,this.Ah[5]=e.y,this.Ah[9]=e.z,this.Ah[13]=e.w;break;case 2:this.Ah[2]=e.x,this.Ah[6]=e.y,this.Ah[10]=e.z,this.Ah[14]=e.w;break;case 3:this.Ah[3]=e.x,this.Ah[7]=e.y,this.Ah[11]=e.z,this.Ah[15]=e.w;break;default:break}}copyRowTo(t,e){e.x=this.Ah[t],e.y=this.Ah[4+t],e.z=this.Ah[8+t],e.w=this.Ah[12+t]}decompose(t){let e=[],s=h.F_r,i=s.getFS32();s.copyFrom(this);let l=new r.default(i[12],i[13],i[14]),o=new r.default;o.x=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),o.y=Math.sqrt(i[4]*i[4]+i[5]*i[5]+i[6]*i[6]),o.z=Math.sqrt(i[8]*i[8]+i[9]*i[9]+i[10]*i[10]),i[0]*(i[5]*i[10]-i[6]*i[9])-i[1]*(i[4]*i[10]-i[6]*i[8])+i[2]*(i[4]*i[9]-i[5]*i[8])<0&&(o.z=-o.z),i[0]/=o.x,i[1]/=o.x,i[2]/=o.x,i[4]/=o.y,i[5]/=o.y,i[6]/=o.y,i[8]/=o.z,i[9]/=o.z,i[10]/=o.z;let _=new r.default;switch(t){case n.default.AXIS_ANGLE:{_.w=a.default.SafeACos((i[0]+i[5]+i[10]-1)/2);let t=Math.sqrt((i[6]-i[9])*(i[6]-i[9])+(i[8]-i[2])*(i[8]-i[2])+(i[1]-i[4])*(i[1]-i[4]));t>a.default.MATH_MIN_POSITIVE?(_.x=(i[6]-i[9])/t,_.y=(i[8]-i[2])/t,_.z=(i[1]-i[4])/t):_.x=_.y=_.z=0}break;case n.default.QUATERNION:{let t=i[0]+i[5]+i[10];t>0?(_.w=Math.sqrt(1+t)/2,_.x=(i[6]-i[9])/(4*_.w),_.y=(i[8]-i[2])/(4*_.w),_.z=(i[1]-i[4])/(4*_.w)):i[0]>i[5]&&i[0]>i[10]?(_.x=Math.sqrt(1+i[0]-i[5]-i[10])/2,_.w=(i[6]-i[9])/(4*_.x),_.y=(i[1]+i[4])/(4*_.x),_.z=(i[8]+i[2])/(4*_.x)):i[5]>i[10]?(_.y=Math.sqrt(1+i[5]-i[0]-i[10])/2,_.x=(i[1]+i[4])/(4*_.y),_.w=(i[8]-i[2])/(4*_.y),_.z=(i[6]+i[9])/(4*_.y)):(_.z=Math.sqrt(1+i[10]-i[0]-i[5])/2,_.x=(i[8]+i[2])/(4*_.z),_.y=(i[6]+i[9])/(4*_.z),_.w=(i[1]-i[4])/(4*_.z))}break;case n.default.EULER_ANGLES:_.y=Math.asin(-i[2]),1!=i[2]&&-1!=i[2]?(_.x=Math.atan2(i[6],i[10]),_.z=Math.atan2(i[1],i[0])):(_.z=0,_.x=Math.atan2(i[4],i[5]));break;default:break}return e.push(l),e.push(_),e.push(o),s=null,e}invert(){let t=this.determinant(),e=Math.abs(t)>a.default.MATH_MIN_POSITIVE;if(e){let e=this.Ah;t=1/t;let s=e[0],i=e[4],a=e[8],r=e[12],n=e[1],h=e[5],l=e[9],o=e[13],_=e[2],m=e[6],u=e[10],d=e[14],c=e[3],f=e[7],p=e[11],g=e[15];e[0]=t*(h*(u*g-d*p)-l*(m*g-d*f)+o*(m*p-u*f)),e[1]=-t*(n*(u*g-d*p)-l*(_*g-d*c)+o*(_*p-u*c)),e[2]=t*(n*(m*g-d*f)-h*(_*g-d*c)+o*(_*f-m*c)),e[3]=-t*(n*(m*p-u*f)-h*(_*p-u*c)+l*(_*f-m*c)),e[4]=-t*(i*(u*g-d*p)-a*(m*g-d*f)+r*(m*p-u*f)),e[5]=t*(s*(u*g-d*p)-a*(_*g-d*c)+r*(_*p-u*c)),e[6]=-t*(s*(m*g-d*f)-i*(_*g-d*c)+r*(_*f-m*c)),e[7]=t*(s*(m*p-u*f)-i*(_*p-u*c)+a*(_*f-m*c)),e[8]=t*(i*(l*g-o*p)-a*(h*g-o*f)+r*(h*p-l*f)),e[9]=-t*(s*(l*g-o*p)-a*(n*g-o*c)+r*(n*p-l*c)),e[10]=t*(s*(h*g-o*f)-i*(n*g-o*c)+r*(n*f-h*c)),e[11]=-t*(s*(h*p-l*f)-i*(n*p-l*c)+a*(n*f-h*c)),e[12]=-t*(i*(l*d-o*u)-a*(h*d-o*m)+r*(h*u-l*m)),e[13]=t*(s*(l*d-o*u)-a*(n*d-o*_)+r*(n*u-l*_)),e[14]=-t*(s*(h*d-o*m)-i*(n*d-o*_)+r*(n*m-h*_)),e[15]=t*(s*(h*u-l*m)-i*(n*u-l*_)+a*(n*m-h*_))}return e}pointAt(t,e,s){null!=e&&void 0!=e||(e=new r.default(0,0,-1)),null!=s&&void 0!=s||(s=new r.default(0,-1,0));let i=e.subtract(t),n=new r.default(s.x,s.y,s.z);i.normalize(),n.normalize();let h=new r.default(i.x,i.y,i.z);h.scaleBy(n.dot(i)),n.subtractBy(h),n.getLength()>a.default.MATH_MIN_POSITIVE?n.normalize():0!=i.x?n.setTo(-i.y,i.x,0):n.setTo(1,0,0);let l=n.crossProduct(i);l.normalize();let o=this.Ah;o[0]=l.x,o[4]=l.y,o[8]=l.z,o[12]=0,o[1]=n.x,o[5]=n.y,o[9]=n.z,o[13]=0,o[2]=i.x,o[6]=i.y,o[10]=i.z,o[14]=0,o[3]=t.x,o[7]=t.y,o[11]=t.z,o[15]=1}prepend(t){let e=t.getLocalFS32(),s=this.Ah,i=e[0],a=e[4],r=e[8],n=e[12],h=e[1],l=e[5],o=e[9],_=e[13],m=e[2],u=e[6],d=e[10],c=e[14],f=e[3],p=e[7],g=e[11],v=e[15],x=s[0],T=s[4],E=s[8],y=s[12],S=s[1],b=s[5],M=s[9],A=s[13],R=s[2],L=s[6],D=s[10],P=s[14],F=s[3],w=s[7],B=s[11],C=s[15];s[0]=i*x+h*T+m*E+f*y,s[1]=i*S+h*b+m*M+f*A,s[2]=i*R+h*L+m*D+f*P,s[3]=i*F+h*w+m*B+f*C,s[4]=a*x+l*T+u*E+p*y,s[5]=a*S+l*b+u*M+p*A,s[6]=a*R+l*L+u*D+p*P,s[7]=a*F+l*w+u*B+p*C,s[8]=r*x+o*T+d*E+g*y,s[9]=r*S+o*b+d*M+g*A,s[10]=r*R+o*L+d*D+g*P,s[11]=r*F+o*w+d*B+g*C,s[12]=n*x+_*T+c*E+v*y,s[13]=n*S+_*b+c*M+v*A,s[14]=n*R+_*L+c*D+v*P,s[15]=n*F+_*w+c*B+v*C}prepend3x3(t){let e=t.getLocalFS32(),s=this.Ah,i=e[0],a=e[4],r=e[8],n=e[1],h=e[5],l=e[9],o=e[2],_=e[6],m=e[10],u=s[0],d=s[4],c=s[8],f=s[1],p=s[5],g=s[9],v=s[2],x=s[6],T=s[10];s[0]=i*u+n*d+o*c,s[1]=i*f+n*p+o*g,s[2]=i*v+n*x+o*T,s[4]=a*u+h*d+_*c,s[5]=a*f+h*p+_*g,s[6]=a*v+h*x+_*T,s[8]=r*u+l*d+m*c,s[9]=r*f+l*p+m*g,s[10]=r*v+l*x+m*T}prependRotationPivot(t,e,s){h.F_r.identity(),h.F_r.getAxisRotation(e.x,e.y,e.z,t),h.F_r.appendTranslationXYZ(s.x,s.y,s.z),this.prepend(h.F_r)}prependRotation(t,e){h.F_r.identity(),h.F_r.getAxisRotation(e.x,e.y,e.z,t),this.prepend(h.F_r)}prependRotationX(t){h.F_r.rotationX(t),this.prepend3x3(h.F_r)}prependRotationY(t){h.F_r.rotationY(t),this.prepend3x3(h.F_r)}prependRotationZ(t){h.F_r.rotationZ(t),this.prepend3x3(h.F_r)}prependRotationEulerAngle(t,e,s){h.F_r.rotationY(e),this.prepend3x3(h.F_r),h.F_r.rotationX(t),this.prepend3x3(h.F_r),h.F_r.rotationZ(s),this.prepend3x3(h.F_r)}prependScale(t,e,s){let i=this.Ah;i[0]*=t,i[1]*=e,i[2]*=s,i[4]*=t,i[5]*=e,i[6]*=s,i[8]*=t,i[9]*=e,i[10]*=s,i[12]*=t,i[13]*=e,i[14]*=s}prependScaleXY(t,e){this.Ah[0]*=t,this.Ah[1]*=e,this.Ah[4]*=t,this.Ah[5]*=e,this.Ah[8]*=t,this.Ah[9]*=e,this.Ah[12]*=t,this.Ah[13]*=e}prependTranslationXYZ(t,e,s){h.F_r.identity(),this.prepend(h.F_r)}prependTranslation(t){h.F_r.identity(),this.prepend(h.F_r)}recompose(t,e){if(t.length<3||0==t[2].x||0==t[2].y||0==t[2].z)return!1;this.identity();let s=h.F_r.getFS32();s[0]=s[1]=s[2]=t[2].x,s[4]=s[5]=s[6]=t[2].y,s[8]=s[9]=s[10]=t[2].z;let i=this.Ah;switch(e){case n.default.EULER_ANGLES:{let e=Math.cos(t[1].x),a=Math.cos(t[1].y),r=Math.cos(t[1].z),n=Math.sin(t[1].x),h=Math.sin(t[1].y),l=Math.sin(t[1].z);i[0]=a*r*s[0],i[1]=a*l*s[1],i[2]=-h*s[2],i[3]=0,i[4]=(n*h*r-e*l)*s[4],i[5]=(n*h*l+e*r)*s[5],i[6]=n*a*s[6],i[7]=0,i[8]=(e*h*r+n*l)*s[8],i[9]=(e*h*l-n*r)*s[9],i[10]=e*a*s[10],i[11]=0,i[12]=t[0].x,i[13]=t[0].y,i[14]=t[0].z,i[15]=1}break;default:{let a=t[1].x,r=t[1].y,h=t[1].z,l=t[1].w;if(e==n.default.AXIS_ANGLE){let t=.5*l;a*=Math.sin(t),r*=Math.sin(t),h*=Math.sin(t),l=Math.cos(t)}i[0]=(1-2*r*r-2*h*h)*s[0],i[1]=(2*a*r+2*l*h)*s[1],i[2]=(2*a*h-2*l*r)*s[2],i[3]=0,i[4]=(2*a*r-2*l*h)*s[4],i[5]=(1-2*a*a-2*h*h)*s[5],i[6]=(2*r*h+2*l*a)*s[6],i[7]=0,i[8]=(2*a*h+2*l*r)*s[8],i[9]=(2*r*h-2*l*a)*s[9],i[10]=(1-2*a*a-2*r*r)*s[10],i[11]=0,i[12]=t[0].x,i[13]=t[0].y,i[14]=t[0].z,i[15]=1}break}return 0==t[2].x&&(this.Ah[0]=0),0==t[2].y&&(this.Ah[5]=0),0==t[2].z&&(this.Ah[10]=0),s=null,!0}setThreeAxes(t,e,s){let i=this.Ah;i[0]=t.x,i[1]=t.y,i[2]=t.z,i[4]=e.x,i[5]=e.y,i[6]=e.z,i[8]=s.x,i[9]=s.y,i[10]=s.z}deltaTransformVector(t){let e=t.x,s=t.y,i=t.z;return new r.default(e*this.Ah[0]+s*this.Ah[4]+i*this.Ah[8],e*this.Ah[1]+s*this.Ah[5]+i*this.Ah[9],e*this.Ah[2]+s*this.Ah[6]+i*this.Ah[10],0)}deltaTransformVectorSelf(t){let e=this.Ah,s=t.x,i=t.y,a=t.z;t.x=s*e[0]+i*e[4]+a*e[8],t.y=s*e[1]+i*e[5]+a*e[9],t.z=s*e[2]+i*e[6]+a*e[10]}deltaTransformOutVector(t,e){let s=this.Ah;e.x=t.x*s[0]+t.y*s[4]+t.z*s[8],e.y=t.x*s[1]+t.y*s[5]+t.z*s[9],e.z=t.x*s[2]+t.y*s[6]+t.z*s[10]}transformVector(t){let e=this.Ah,s=t.x,i=t.y,a=t.z;return new r.default(s*e[0]+i*e[4]+a*e[8]+e[12],s*e[1]+i*e[5]+a*e[9]+e[13],s*e[2]+i*e[6]+a*e[10]+e[14],s*e[3]+i*e[7]+a*e[11]+e[15])}transformOutVector(t,e){let s=t.x,i=t.y,a=t.z,r=this.Ah;e.setTo(s*r[0]+i*r[4]+a*r[8]+r[12],s*r[1]+i*r[5]+a*r[9]+r[13],s*r[2]+i*r[6]+a*r[10]+r[14],s*r[3]+i*r[7]+a*r[11]+r[15])}transformOutVector3(t,e){let s=this.Ah;e.x=t.x*s[0]+t.y*s[4]+t.z*s[8]+s[12],e.y=t.x*s[1]+t.y*s[5]+t.z*s[9]+s[13],e.z=t.x*s[2]+t.y*s[6]+t.z*s[10]+s[14]}transformVector3Self(t){let e=t.x,s=t.y,i=t.z,a=this.Ah;t.x=e*a[0]+s*a[4]+i*a[8]+a[12],t.y=e*a[1]+s*a[5]+i*a[9]+a[13],t.z=e*a[2]+s*a[6]+i*a[10]+a[14]}transformVectorSelf(t){let e=t.x,s=t.y,i=t.z,a=this.Ah;t.setTo(e*a[0]+s*a[4]+i*a[8]+a[12],e*a[1]+s*a[5]+i*a[9]+a[13],e*a[2]+s*a[6]+i*a[10]+a[14],e*a[3]+s*a[7]+i*a[11]+a[15])}transformVectors(t,e,s){let i,a,r,n=0,h=this.Ah;e-=3;while(n<=e)i=t[n],a=t[n+1],r=t[n+2],s[n]=i*h[0]+a*h[4]+r*h[8]+h[12],s[n+1]=i*h[1]+a*h[5]+r*h[9]+h[13],s[n+2]=i*h[2]+a*h[6]+r*h[10]+h[14],n+=3}transformVectorsSelf(t,e){let s,i,a,r=0,n=this.Ah;e-=3;while(r<=e)s=t[r],i=t[r+1],a=t[r+2],t[r]=s*n[0]+i*n[4]+a*n[8]+n[12],t[r+1]=s*n[1]+i*n[5]+a*n[9]+n[13],t[r+2]=s*n[2]+i*n[6]+a*n[10]+n[14],r+=3}transformVectorsRangeSelf(t,e,s){let i,a,r,n=e,h=this.Ah;s-=3;while(n<=s)i=t[n],a=t[n+1],r=t[n+2],t[n]=i*h[0]+a*h[4]+r*h[8]+h[12],t[n+1]=i*h[1]+a*h[5]+r*h[9]+h[13],t[n+2]=i*h[2]+a*h[6]+r*h[10]+h[14],n+=3}transpose(){h.F_r.copyFrom(this);let t=h.F_r.getFS32(),e=this.Ah;e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11]}interpolateTo(t,e){let s=t.getFS32(),i=t.getFSIndex(),a=0,r=this.Ag;while(a<16)this.O_[r]+=(s[i+a]-this.O_[r])*e,++r,++a}getAxisRotation(t,e,s,i){i=-i;let a=this.Ah,r=Math.sin(i),n=Math.cos(i),h=1-n;a[0]=n+t*t*h,a[5]=n+e*e*h,a[10]=n+s*s*h;let l=t*e*h,o=s*r;a[4]=l+o,a[1]=l-o,l=t*s*h,o=e*r,a[8]=l-o,a[2]=l+o,l=e*s*h,o=t*r,a[9]=l+o,a[6]=l-o}rotationX(t){let e=Math.sin(t),s=Math.cos(t);this.Ah[0]=1,this.Ah[1]=0,this.Ah[2]=0,this.Ah[4]=0,this.Ah[5]=s,this.Ah[6]=e,this.Ah[8]=0,this.Ah[9]=-e,this.Ah[10]=s}rotationY(t){let e=Math.sin(t),s=Math.cos(t);this.Ah[0]=s,this.Ah[1]=0,this.Ah[2]=-e,this.Ah[4]=0,this.Ah[5]=1,this.Ah[6]=0,this.Ah[8]=e,this.Ah[9]=0,this.Ah[10]=s}rotationZ(t){let e=Math.sin(t),s=Math.cos(t);this.Ah[0]=s,this.Ah[1]=e,this.Ah[2]=0,this.Ah[4]=-e,this.Ah[5]=s,this.Ah[6]=0,this.Ah[8]=0,this.Ah[9]=0,this.Ah[10]=1}toString(){let t="\n"+this.Ah[0]+","+this.Ah[1]+","+this.Ah[2]+","+this.Ah[3]+"\n";return t+=this.Ah[4]+","+this.Ah[5]+","+this.Ah[6]+","+this.Ah[7]+"\n",t+=this.Ah[8]+","+this.Ah[9]+","+this.Ah[10]+","+this.Ah[11]+"\n",t+=this.Ah[12]+","+this.Ah[13]+","+this.Ah[14]+","+this.Ah[15]+"\n",t}transformPerspV4Self(t){t.w=t.z,t.x*=this.Ah[0],t.y*=this.Ah[5],t.z*=this.Ah[10],t.z+=this.Ah[14],t.w*=this.Ah[11],t.w+=this.Ah[15]}perspectiveRH(t,e,s,i){let a=Math.tan(.5*t);this.identity(),this.Ah[0]=1/(e*a),this.Ah[5]=1/a,this.Ah[10]=-(i+s)/(i-s),this.Ah[11]=-1,this.Ah[14]=-2*i*s/(i-s)}perspectiveRH2(t,e,s,i,a){let r=e/Math.tan(.5*t),n=r/e,h=r/s,l=-a/(a-i),o=-i*l;this.identity(),this.Ah[0]=n,this.Ah[5]=h,this.Ah[10]=l,this.Ah[11]=-1,this.Ah[14]=o}orthoRH(t,e,s,i,a,r){this.identity(),this.Ah[0]=2/(i-s),this.Ah[5]=2/(e-t),this.Ah[10]=-2/(r-a),this.Ah[12]=-(i+s)/(i-s),this.Ah[13]=-(e+t)/(e-t),this.Ah[14]=-(r+a)/(r-a),this.Ah[15]=1}perspectiveLH(t,e,s,i){let a=Math.tan(.5*t);this.identity(),this.Ah[0]=1/(e*a),this.Ah[5]=1/a,this.Ah[10]=(i+s)/(i-s),this.Ah[11]=1,this.Ah[14]=2*i*s/(i-s)}orthoLH(t,e,s,i,a,r){this.identity(),this.Ah[0]=2/(i-s),this.Ah[5]=2/(e-t),this.Ah[10]=2/(r-a),this.Ah[12]=-(i+s)/(i-s),this.Ah[13]=-(e+t)/(e-t),this.Ah[14]=-(r+a)/(r-a),this.Ah[15]=1}lookAtRH(t,e,s){this.identity();let i=e.subtract(t);i.normalize();let a=i.crossProduct(s);a.normalize();let r=a.crossProduct(i);a.w=-a.dot(t),r.w=-r.dot(t),i.w=i.dot(t),i.negate(),this.copyRowFrom(0,a),this.copyRowFrom(1,r),this.copyRowFrom(2,i)}lookAtLH(t,e,s){this.identity();let i=e.subtract(t);i.normalize();let a=i.crossProduct(s);a.normalize();let r=a.crossProduct(i);a.w=-a.dot(t),r.w=-r.dot(t),i.w=-i.dot(t),this.copyRowFrom(0,a),this.copyRowFrom(1,r),this.copyRowFrom(2,i)}destroy(){this.Ah=null,this.O_=null,this.Ag=-1}}h.F_s=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),h.F_j=0,h.F_t=327679,h.F_r=new h,e.default=h},"1e15":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8a0a")),r=i(s("030e"));class n{constructor(){this.A=0,this.Ai=2,this.Aj=null,this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.vroUid=0,this.rioUid=0}getRC(){return this.Aj}getRCUid(){return this.A}createBuf(){return this.Aj.createBuffer()}deleteBuf(t){this.Aj.deleteBuffer(t)}bindArrBuf(t){this.Aj.bindBuffer(this.Aj.ARRAY_BUFFER,t)}bindEleBuf(t){this.Aj.bindBuffer(this.Aj.ELEMENT_ARRAY_BUFFER,t)}arrBufSubData(t,e){this.Aj.bufferSubData(this.Aj.ARRAY_BUFFER,e,t)}arrBufData(t,e){this.Aj.bufferData(this.Aj.ARRAY_BUFFER,t,a.default.ToGL(this.Aj,e))}eleBufSubData(t,e){this.Aj.bufferSubData(this.Aj.ELEMENT_ARRAY_BUFFER,e,t)}eleBufData(t,e){this.Aj.bufferData(this.Aj.ELEMENT_ARRAY_BUFFER,t,a.default.ToGL(this.Aj,e))}arrBufDataMem(t,e){this.Aj.bufferData(this.Aj.ARRAY_BUFFER,t,a.default.ToGL(this.Aj,e))}eleBufDataMem(t,e){this.Aj.bufferData(this.Aj.ELEMENT_ARRAY_BUFFER,t,a.default.ToGL(this.Aj,e))}useVtxAttribsPtrTypeFloat(t,e,s,i,a,r){this.Aj.bindBuffer(this.Aj.ARRAY_BUFFER,e);for(let n=0;n<i;++n)t.vertexAttribPointerTypeFloat(s[n],r,a[n])}useVtxAttribsPtrTypeFloatMulti(t,e,s,i,a,r){for(let n=0;n<i;++n)this.Aj.bindBuffer(this.Aj.ARRAY_BUFFER,e[n]),t.vertexAttribPointerTypeFloat(s[n],r,a[n])}createVertexArray(){let t=null;return t=2==this.Ai?this.Aj.createVertexArray():r.default.OES_vertex_array_object.createVertexArrayOES(),t}bindVertexArray(t){return 2==this.Ai?this.Aj.bindVertexArray(t):r.default.OES_vertex_array_object.bindVertexArrayOES(t),t}deleteVertexArray(t){2==this.Ai?this.Aj.deleteVertexArray(t):r.default.OES_vertex_array_object.deleteVertexArrayOES(t)}testVROUid(t){return this.vroUid!=t&&(this.vroUid=t,!0)}testRIOUid(t){return this.rioUid!=t&&(this.rioUid=t,!0)}initialize(t,e,s){this.Aj=e,this.A=t,this.Ai=s;let i=this;i.RGBA=e.RGBA,i.UNSIGNED_BYTE=e.UNSIGNED_BYTE,i.TRIANGLE_STRIP=e.TRIANGLE_STRIP,i.TRIANGLE_FAN=e.TRIANGLE_FAN,i.TRIANGLES=e.TRIANGLES,i.LINES=this.Aj.LINES,i.LINE_STRIP=e.LINE_STRIP,i.UNSIGNED_SHORT=e.UNSIGNED_SHORT,i.UNSIGNED_INT=e.UNSIGNED_INT,i.COLOR=e.COLOR,i.DEPTH=e.DEPTH,i.STENCIL=e.STENCIL,i.DEPTH_STENCIL=e.DEPTH_STENCIL,this.Ai>1?(i.MIN=e.MIN,i.MAX=e.MAX):(i.MIN=r.default.EXT_blend_minmax.MIN_EXT,i.MAX=r.default.EXT_blend_minmax.MAX_EXT),i.RContext=e}renderBegin(){this.vroUid=-2,this.rioUid=-3}toString(){return"[Object ROVtxBuilder()]"}}e.default=n},"1ea6":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("ab73"));class r{constructor(){this.Ak="PBRShd",this.codeBuilder=null,this.specularEnvMap=null,this.diffuseMap=null,this.normalMap=null,this.mirrorMap=null,this.indirectEnvMap=null,this.parallaxMap=null,this.aoMap=null,this.roughnessMap=null,this.metalhnessMap=null,this.armMap=null,this.glossinessEnabeld=!0,this.woolEnabled=!0,this.toneMappingEnabled=!0,this.specularEnvMapEnabled=!0,this.scatterEnabled=!0,this.specularBleedEnabled=!0,this.metallicCorrection=!0,this.gammaCorrection=!0,this.absorbEnabled=!1,this.normalNoiseEnabled=!1,this.pixelNormalNoiseEnabled=!1,this.mirrorProjEnabled=!1,this.mirrorMapLodEnabled=!1,this.diffuseMapEnabled=!1,this.normalMapEnabled=!1,this.aoMapEnabled=!1,this.indirectEnvMapEnabled=!1,this.hdrBrnEnabled=!1,this.vtxFlatNormal=!1,this.lightEnabled=!0,this.shadowReceiveEnabled=!1,this.fogEnabled=!1,this.texturesTotal=1,this.fragLocalParamsTotal=2,this.parallaxParamIndex=2}createTextureList(){let t=this.codeBuilder,e=t.uniform,s=[];return null!=this.armMap&&(this.aoMapEnabled=!0),this.specularEnvMapEnabled&&null!=this.specularEnvMap&&(s.push(this.specularEnvMap),e.addspecularEnvMap(!0)),this.diffuseMapEnabled&&null!=this.diffuseMap&&(s.push(this.diffuseMap),e.addDiffuseMap()),this.normalMapEnabled&&null!=this.normalMap&&(s.push(this.normalMap),e.addNormalMap()),null!=this.parallaxMap&&(s.push(this.parallaxMap),e.addParallaxMap(this.parallaxParamIndex)),this.aoMapEnabled&&null!=this.aoMap&&(s.push(this.aoMap),e.addAOMap()),null!=this.roughnessMap&&(s.push(this.roughnessMap),e.addRoughnessMap()),null!=this.metalhnessMap&&(s.push(this.metalhnessMap),e.addMetalnessMap()),null!=this.armMap&&(s.push(this.armMap),e.addARMMap()),this.mirrorProjEnabled&&null!=this.mirrorMap&&(s.push(this.mirrorMap),e.add2DMap("VOX_MIRROR_PROJ_MAP",!0,!0,!1)),this.indirectEnvMapEnabled&&null!=this.indirectEnvMap&&(s.push(this.indirectEnvMap),e.addCubeMap("VOX_INDIRECT_ENV_MAP",!0,!1)),this.texturesTotal=s.length,s}copyFrom(t){this.woolEnabled=t.woolEnabled,this.toneMappingEnabled=t.toneMappingEnabled,this.specularEnvMapEnabled=t.specularEnvMapEnabled,this.scatterEnabled=t.scatterEnabled,this.specularBleedEnabled=t.specularBleedEnabled,this.metallicCorrection=t.metallicCorrection,this.gammaCorrection=t.gammaCorrection,this.absorbEnabled=t.absorbEnabled,this.normalNoiseEnabled=t.normalNoiseEnabled,this.pixelNormalNoiseEnabled=t.pixelNormalNoiseEnabled,this.mirrorProjEnabled=t.mirrorProjEnabled,this.mirrorMapLodEnabled=t.mirrorMapLodEnabled,this.diffuseMapEnabled=t.diffuseMapEnabled,this.normalMapEnabled=t.normalMapEnabled,this.aoMapEnabled=t.aoMapEnabled,this.indirectEnvMapEnabled=t.indirectEnvMapEnabled,this.shadowReceiveEnabled=t.shadowReceiveEnabled,this.fogEnabled=t.fogEnabled,this.hdrBrnEnabled=t.hdrBrnEnabled,this.vtxFlatNormal=t.vtxFlatNormal,this.fragLocalParamsTotal=t.fragLocalParamsTotal,null==this.specularEnvMap&&(this.specularEnvMap=t.specularEnvMap),null==this.diffuseMap&&(this.diffuseMap=t.diffuseMap),null==this.normalMap&&(this.normalMap=t.normalMap),null==this.aoMap&&(this.aoMap=t.aoMap),null==this.mirrorMap&&(this.mirrorMap=t.mirrorMap),null==this.indirectEnvMap&&this.indirectEnvMapEnabled&&(this.indirectEnvMap=t.indirectEnvMap),null==this.parallaxMap&&(this.parallaxMap=t.parallaxMap),null==this.roughnessMap&&(this.roughnessMap=t.roughnessMap),this.lightEnabled=t.lightEnabled,this.texturesTotal=t.texturesTotal}buildShader(){let t=this.codeBuilder;t.normalMapEnabled=this.normalMapEnabled,t.mapLodEnabled=!0,t.useHighPrecious();let e=this.mirrorProjEnabled&&this.texturesTotal>0;this.normalNoiseEnabled&&t.addDefine("VOX_NORMAL_NOISE"),this.woolEnabled&&t.addDefine("VOX_WOOL"),this.toneMappingEnabled&&t.addDefine("VOX_TONE_MAPPING"),this.scatterEnabled&&t.addDefine("VOX_SCATTER"),this.specularBleedEnabled&&t.addDefine("VOX_SPECULAR_BLEED"),this.metallicCorrection&&t.addDefine("VOX_METALLIC_CORRECTION"),this.gammaCorrection&&t.addDefine("VOX_GAMMA_CORRECTION"),this.absorbEnabled&&t.addDefine("VOX_ABSORB"),this.pixelNormalNoiseEnabled&&t.addDefine("VOX_PIXEL_NORMAL_NOISE"),this.mirrorMapLodEnabled&&t.addDefine("VOX_MIRROR_MAP_LOD","1"),this.hdrBrnEnabled&&t.addDefine("VOX_HDR_BRN","1"),this.vtxFlatNormal&&t.addDefine("VOX_VTX_FLAT_NORMAL","1"),t.addFragUniform("vec4","u_fragLocalParams",this.fragLocalParamsTotal),t.addFragUniform("vec4","u_pbrParams",4),e&&(t.addFragUniformParam(a.default.StageParam),t.addFragUniform("vec4","u_mirrorParams",2)),t.vertMatrixInverseEnabled=!0}getUniqueShaderName(){let t=this.Ak;return this.woolEnabled&&(t+="_wl"),this.toneMappingEnabled&&(t+="TM"),this.specularEnvMapEnabled&&(t+="EnvM"),this.scatterEnabled&&(t+="Sct"),this.specularBleedEnabled&&(t+="SpecBl"),this.metallicCorrection&&(t+="MetCorr"),this.gammaCorrection&&(t+="GmaCorr"),this.absorbEnabled&&(t+="Absorb"),this.pixelNormalNoiseEnabled&&(t+="PNNoise"),this.mirrorProjEnabled&&(t+="MirPrj"),this.normalNoiseEnabled&&(t+="NNoise"),this.indirectEnvMapEnabled&&(t+="IndirEnv"),this.normalMapEnabled&&(t+="NorMap"),this.aoMapEnabled&&(t+="AoMap"),this.shadowReceiveEnabled&&(t+="Shadow"),this.fogEnabled&&(t+="Fog"),this.hdrBrnEnabled&&(t+="HdrBrn"),this.vtxFlatNormal&&(t+="vtxFlagN"),t+="_T"+this.texturesTotal,this.Ak=t,t}toString(){return"[PBRShaderBuffer()]"}}e.default=r},"1eb2":function(t,e,s){"use strict";if("undefined"!==typeof window){var i=window.document.currentScript,a=s("8875");i=a(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:a});var r=i&&i.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);r&&(s.p=r[1])}},"1f1a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("3b73")),r=i(s("c497")),n=i(s("f63b")),h=i(s("b161")),l=s("2fe8"),o=s("da82");class _{constructor(t){if(this.Al=null,this.priority=0,this.processIdList=null,this.contextResetEnabled=!1,null==t)throw Error("rscene is null !!!");this.Al=t}enableMouseEvent(t=!0){this.Al.enableMouseEvent(t)}getRScene(){return this.Al}}e.RendererSceneNode=_;class m{constructor(){this.Am=[],this.texLoader=null,this.stage3D=null,this.rscene=null,this.uiScene=null,this.interaction=new o.UserInteraction}initialize(t=null,e=3){if(null==this.rscene){let s;null==t&&(t=new r.default,t.setAttriAntialias(!a.default.IsMobileWeb()),t.setCamPosition(1800,1800,1800),t.setCamProject(45,20,7e3)),s=new h.default,s.initialize(t,e),s.updateCamera();let i=this;i.stage3D=s.getStage3D(),i.rscene=s,i.texLoader=new n.default(this.rscene.textureBlock),i.uiScene=new l.OrthoUIScene,this.uiScene.initialize(this.rscene),this.interaction.initialize(s);let o=new _(this.rscene);o.priority=0,o.contextResetEnabled=!0,this.Am.push(o),o=new _(this.uiScene),o.priority=1,o.contextResetEnabled=!0,this.Am.push(o)}}setAccessorAt(t,e){if(t>=0&&t<this.Am.length){let s=this.Am[t];if(0!=t){let t=s.getRScene();t.setAccessor(e)}else{let t=s.getRScene();t.setAccessor(e)}}}appendRendererScene(t,e=3,s=!0,i=-1){null==t&&(t=new r.default,t.setAttriAntialias(!a.default.IsMobileWeb()),t.setCamPosition(1800,1800,1800),t.setCamProject(45,20,7e3));let n=this.rscene.createSubScene();n.initialize(t,e,s);let h=new _(n);return h.priority=i<0?this.Am.length:i,this.Am.push(h),h}getRendererSceneAt(t){return t>=0&&t<this.Am.length?this.Am[t]:null}getRendererScenesTotal(){return this.Am.length}setProcessIdListAt(t,e){t>=0&&t<this.Am.length&&(this.Am[t].processIdList=e)}setPriorityAt(t,e){if(e<1)throw Error("priority < 1 !!!");t>0&&t<this.Am.length&&(this.Am[t].priority=e)}swapScenePriorityAt(t,e){if(0!=t&&0!=e&&t!=e&&t>=0&&t<this.Am.length&&e>=0&&e<this.Am.length){let s=this.Am[t].priority;this.Am[t].priority=this.Am[e].priority,this.Am[e].priority=s}}swapSceneAt(t,e){if(0!=t&&0!=e&&t!=e&&t>=0&&t<this.Am.length&&e>=0&&e<this.Am.length){let s=this.Am[t].priority;this.Am[t].priority=this.Am[e].priority,this.Am[e].priority=s;let i=this.Am[t];this.Am[t]=this.Am[e],this.Am[e]=i}}sortScenes(){this.Am[0].priority=0,this.Am.sort((t,e)=>t.priority-e.priority)}showInfo(){}getRendererStatus(){return this.rscene.getRendererStatus()}run(){this.interaction.run();let t,e=!0,s=this.Am,i=s.length,a=i-1,r=s[a].getRScene();for(r.runBegin(!0,!0),r.update(!1,!0),e=r.isRayPickSelected(),a-=1;a>=0;--a)r=s[a].getRScene(),r.runBegin(!1,!0),r.update(!1,!e),e=e||r.isRayPickSelected();for(a=0;a<i;++a){t=s[a],r=s[a].getRScene(),r.renderBegin(t.contextResetEnabled);const e=t.processIdList;if(null==e)r.run(!1);else for(let t=0;t<e.length;++t)r.runAt(e[t]);r.runEnd()}}}e.EngineBase=m,e.default=m},"1f43":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("3b73")),r=i(s("c497")),n=i(s("5336")),h=i(s("402a")),l=i(s("bd6f")),o=i(s("b9b5")),_=i(s("1710")),m=i(s("8e17")),u=i(s("3930")),d=i(s("91e2")),c=i(s("b8ff")),f=s("5216"),p=s("4df3"),g=i(s("bbd2")),v=i(s("1f1a")),x=s("bf2a"),T=s("debe"),E=i(s("f367")),y=i(s("f63e")),S=i(s("29ef")),b=s("326d"),M=i(s("899a")),A=s("cc48");class R{constructor(){this.An=null,this.Ao=null,this.Ap=new n.default,this.Aq=new p.CommonMaterialContext,this.Ar=null,this.As=[],this.At=new m.default(-150,100,-170),this.Au=new m.default(150,0,150),this.Av=null,this.Aw=new m.default(0,0,0),this.Ax=new m.default(0,500,-100),this.Ay=new m.default(.3,0),this.Az=10,this.A0=null,this.A1=!0,this.A2=null,this.A3=new m.default(0,-90,0),this.A4=0,this.A5=[],this.A6=-1,this.A7=1.1}initialize(){if(null==this.An){a.default.SHADERCODE_TRACE_ENABLED=!0,a.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,a.default.SetWebBodyColor("black");let t=new r.default;t.setCamProject(45,10,8e3),t.setAttriStencil(!0),t.setAttriAlpha(!1),t.setAttriAntialias(!a.default.IsMobileWeb()),t.setCamPosition(800,800,800),this.An=new v.default,this.An.initialize(t,7),this.An.setProcessIdListAt(0,[0,1,2,3,5]),this.An.interaction.zoomLookAtPosition=new m.default,this.An.rscene.addEventListener(_.default.MOUSE_DOWN,this,this.mouseDown),this.initMaterialCtx(),this.update()}}initMaterialCtx(){let t=new p.MaterialContextParam;t.shaderLibVersion="v101",t.pointLightsTotal=3,t.directionLightsTotal=0,t.spotLightsTotal=0,t.loadAllShaderCode=!0,t.shaderCodeBinary=!0,t.pbrMaterialEnabled=!1,t.shaderFileRename=!0,t.vsmFboIndex=0,this.Aq.addShaderLibListener(this),this.Aq.initialize(this.An.rscene,t);let e=this.Aq.lightModule.getPointLightAt(0);e.position.setXYZ(0,150,-50),e.color.setRGB3f(1,1,1),e.attenuationFactor1=1e-5,e.attenuationFactor2=1e-6;let s,i=new x.FloatYPointLightEntity;i.center.copyFrom(e.position),i.center.y=60,i.position.copyFrom(e.position),i.light=e,i.displayEntity=this.createPointLightDisp(e),this.As.push(i),e=this.Aq.lightModule.getPointLightAt(1),e.color.setRGB3f(1,0,0),e.attenuationFactor1=1e-5,e.attenuationFactor2=1e-6,s=new x.RotateYPointLightEntity(10*Math.random()),s.rotationSpd=.01,s.radius=230,s.center.copyFrom(this.At),s.center.y+=20,s.light=e,s.displayEntity=this.createPointLightDisp(e),this.As.push(s),e=this.Aq.lightModule.getPointLightAt(2),e.color.setRGB3f(0,1,1),e.attenuationFactor1=1e-5,e.attenuationFactor2=1e-6,s=new x.RotateYPointLightEntity(10*Math.random()),s.rotationSpd=.01,s.radius=230,s.center.copyFrom(this.Au),s.center.y+=20,s.light=e,s.displayEntity=this.createPointLightDisp(e),this.As.push(s),this.Aq.lightModule.update()}createPointLightDisp(t){let e=60,s=new g.default;return s.pipeTypes=[f.MaterialPipeType.FOG_EXP2],s.setMaterialPipeline(this.Aq.pipeline),s.toBrightnessBlend(),s.initialize(e,e,[this.Aq.getTextureByUrl("static/assets/flare_core_03.jpg")]),s.setPosition(t.position),s.setRGB3f(t.color.r,t.color.g,t.color.b),this.An.rscene.addEntity(s,3),s}createDestroyEffect(t){let e=200,s=200,i=this.Aq.getTextureByUrl("static/assets/particle/explosion/explodeBg_01c.png"),a=new l.default;a.normalEnabled=!0,a.initializeXOZSquare(1,[i]),a.setScaleXYZ(e,1,s),this.An.rscene.addEntity(a,3),a.setVisible(!1),t.y+=2;let r=new y.default,n=new u.default(1.3,.8,.3);r.pipeTypes=[f.MaterialPipeType.FOG_EXP2],r.setMaterialPipeline(this.Aq.pipeline),r.initializeByCodeBuf(!0),r.setAlpha(.6),r.setTextureList([i]),r.setRGB3f(n.r,n.g,n.b);let o=new h.default;o.setMaterial(r),o.copyMeshFrom(a),o.setPosition(t),o.setScaleXYZ(e,1,s),o.setRotationXYZ(0,1e3*Math.random(),0),o.setRenderState(S.default.BACK_TRANSPARENT_STATE),this.An.rscene.addEntity(o,3)}initScene(){a.default.IsWebGL1()?(this.Ar=new b.ViewTextureMaker(1,!0),this.Ar.setClearColorEnabled(!0)):(this.Ar=new b.ViewTextureMaker(1),this.Ar.setClearColorEnabled(!1)),this.Ar.setCameraViewSize(2048,2048),this.Ar.setMapSize(2048,2048),this.Ar.initialize(this.An.rscene,[4]),this.Ar.upate(),this.Ar.force=!0,this.Ar.histroyUpdating=!0,this.Ar.run();let t=new u.default(1,1,0),e=new u.default(0,0,0);this.createDestroyEffect(new m.default(200,-188,-200));let s=new g.default;s.pipeTypes=[f.MaterialPipeType.FOG_EXP2],s.setMaterialPipeline(this.Aq.pipeline),s.toTransparentBlend(),s.initialize(120,120,[this.Aq.getTextureByUrl("static/assets/guangyun_40.png")]),s.setXYZ(200,300,200),this.An.rscene.addEntity(s,3);let i=this.Aq.getTextureByUrl("static/assets/flare_core_01.jpg"),r=new E.default;r.pipeTypes=[f.MaterialPipeType.FOG_EXP2],r.setMaterialPipeline(this.Aq.pipeline),r.toBrightnessBlend(),r.initialize([i]),r.setBeginAndEndPos(this.Aw,this.Ax),r.setLineWidth(50),r.setRGB3f(.1,.1,.1),r.setUVOffset(this.Ay.x,this.Ay.y),r.setFadeRange(.3,.7),r.setXYZ(20,0,20),r.setRGBOffset3f(1.5*Math.random()+.1,1.5*Math.random()+.1,1.5*Math.random()+.1),this.An.rscene.addEntity(r,3),this.Av=r;let n=30,h=new c.default;h.pipeTypes=[f.MaterialPipeType.FOG_EXP2],h.setMaterialPipeline(this.Aq.pipeline),h.initialize(n,20,20,[this.Aq.getTextureByUrl("static/assets/color_02.jpg")]),h.setXYZ(-200,-170+n,200),this.An.rscene.addEntity(h);let l,_,p=new o.default;p.pipeTypes=[f.MaterialPipeType.FOG_EXP2],p.setMaterialPipeline(this.Aq.pipeline),p.initialize(150),this.An.rscene.addEntity(p,2),_=this.Aq.createLambertLightMaterial(),_.envAmbientLightEnabled=!0,l=new T.VertUniformComp,_.vertUniform=l,l.uvTransformEnabled=!0,this.useMaps(_,"metal_08",!0,!0,!0),_.fogEnabled=!0,_.initializeLocalData(),l.setUVScale(8,8),l.setDisplacementParams(10,-10),t.normalizeRandom(.5),e.randomRGB(),_.setColor(t,e),_.setSpecularIntensity(128),_.setBlendFactor(.3,.7),t.setRGB3f(1,1,1),_.setSpecularColor(t);let v=new c.default;v.setMaterial(_),v.initialize(150,100,100),v.setPosition(this.At),v.setRotationXYZ(360*Math.random(),360*Math.random(),360*Math.random()),this.An.rscene.addEntity(v);let x=v;_=this.Aq.createLambertLightMaterial(),_.envAmbientLightEnabled=!0,l=new T.VertUniformComp,_.vertUniform=l,l.uvTransformEnabled=!0,this.useMaps(_,"lava_03",!0,!0,!0),_.fogEnabled=!0,_.initializeLocalData(),l.setUVScale(6,6),l.setDisplacementParams(10,-10),t.normalizeRandom(1.1),e.normalizeRandom(.5),_.setColor(t,e),_.setSpecularColor(new u.default(1,1,1,1)),_.setSpecularIntensity(64),v=new c.default,v.copyMeshFrom(x),v.setMaterial(_),v.setPosition(this.Au),v.setRotationXYZ(360*Math.random(),360*Math.random(),360*Math.random()),this.An.rscene.addEntity(v),_=this.Aq.createLambertLightMaterial(),_.diffuseMap2=this.Ar.getMap(),_.diffuseMap2Matrix=this.Ar.getMatrix(),_.envAmbientLightEnabled=!0,l=new T.VertUniformComp,_.vertUniform=l,l.uvTransformEnabled=!0,this.useMaps(_,"box",!0,!1,!0),_.fogEnabled=!0,_.lightEnabled=!0,_.initializeLocalData(),l.setDisplacementParams(3,0),_.setSpecularIntensity(64),t.normalizeRandom(1.1),_.setSpecularColor(t);let y=new d.default;y.setMaterial(_),y.initializeSizeXYZ(800,20,800),y.setXYZ(0,-200,0),this.An.rscene.addEntity(y),this.initEnvBox()}shaderLibLoadComplete(t,e){this.Aq.envData.setAmbientColorRGB3f(3,3,3),this.Aq.envData.setEnvAmbientLightAreaOffset(-500,-500),this.Aq.envData.setEnvAmbientLightAreaSize(1e3,1e3),this.Aq.envData.setEnvAmbientMap(this.Aq.getTextureByUrl("static/assets/brn_03.jpg")),this.initScene()}useMaps(t,e,s=!0,i=!0,a=!1,r=!1){t.diffuseMap=this.Aq.getTextureByUrl("static/assets/disp/"+e+"_COLOR.png"),t.specularMap=this.Aq.getTextureByUrl("static/assets/disp/"+e+"_SPEC.png"),s&&(t.normalMap=this.Aq.getTextureByUrl("static/assets/disp/"+e+"_NRM.png")),r&&(t.aoMap=this.Aq.getTextureByUrl("static/assets/disp/"+e+"_OCC.png")),i&&null!=t.vertUniform&&(t.vertUniform.displacementMap=this.Aq.getTextureByUrl("static/assets/disp/"+e+"_DISP.png")),t.shadowReceiveEnabled=a}initEnvBox(){let t=new d.default;t.normalScale=-1,t.pipeTypes=[f.MaterialPipeType.FOG_EXP2],t.setMaterialPipeline(this.Aq.pipeline),t.showFrontFace(),t.initializeCube(4e3,[this.Aq.getTextureByUrl("static/assets/disp/box_COLOR.png")]),this.An.rscene.addEntity(t,2)}mouseDown(t){this.A1=!0,M.default.Flag_0=1,this.A4++;let e=this.Aq.getTextureByUrl("static/assets/particle/explosion/explodeBg_01c.png");e.premultiplyAlpha=!0;let s=new l.default;s.spaceCullMask=A.SpaceCullingMask.NONE,s.premultiplyAlpha=!0,s.setRenderState(S.default.BACK_ALPHA_ADD_ALWAYS_STATE),s.initializeXOZSquare(50+200*Math.random(),[e]),s.setRotationXYZ(0,400*Math.random(),0),this.A3.setXYZ(400*Math.random()-200,-180,400*Math.random()-200),s.setPosition(this.A3),s.getMaterial().setRGB3f(.7*Math.random(),.7*Math.random(),.7*Math.random()),s.getMaterial().setAlpha(.7),this.An.rscene.addEntity(s,4),this.A5.push(s)}update(){this.A6>-1&&clearTimeout(this.A6),this.A6=setTimeout(this.update.bind(this),50),this.Ap.render()}run(){null!=this.Av&&(this.Aw.x=200*Math.sin(this.A7),this.A7+=.02,this.Ay.x+=.01,this.Ay.y+=.01,this.Av.setUVOffset(this.Ay.x,this.Ay.y));for(let t=0;t<this.As.length;++t)null!=this.As[t]&&this.As[t].run();if(this.As.length>0&&null!=this.As[0]&&this.Aq.lightModule.update(),this.Ap.update(!1),this.An.rscene.setClearRGBColor3f(.2,.2,.2),this.Aq.run(),this.An.run(),this.A5.length>0){let t=!1;for(let e=0;e<this.A5.length;++e)this.A5[e].isInRendererProcess()&&(t=!0);if(t&&M.default.Flag_0>0){this.Ar.force=!0,this.Ar.histroyUpdating=!0,this.Ar.run();for(let t=0;t<this.A5.length;++t)this.A5[t].setVisible(!1);this.A5=[]}}M.default.Flag_0=0}}e.DemoMultiLambertLights=R,e.default=R},"20ef":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("3b73")),r=i(s("8a0a"));class n{constructor(t){this.o_=null,this.T=-1,this.A8=null,this.A=-1,this.x=null,this.A9="",this.A_A=0,this.A_B=null,this.A_C=null,this.A_D=null,this.A_E=null,this.A_F=null,this.A_G=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.A_H=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.A_I=null,this.A_J=new Map,this.A_K=new Map,this.A_L=null,this.A_M=null,this.dataUniformEnabled=!1,this.A_N=0,this.A_O=0,this.A_P=null,this.A_Q=0,this.T=t}setShdData(t){this.o_=t,this.A9=t.getUniqueShaderName()}getUid(){return this.T}getTexTotal(){return this.o_.getTexTotal()}useTexLocation(){for(let t=0;t<this.A_A;t++)this.x.uniform1i(this.A_F[t],t)}haveTexture(){return this.o_.haveTexture()}createLocations(){let t=0,e=0,s=this.o_.getAttriNSList();if(null!=s&&s.length>0&&null==this.A_B){this.dataUniformEnabled=!1;let i=this.o_.getAttriSizeList();this.A_B=[],this.A_C=[],this.A_D=[],e=s.length;let n=0,h=0;while(t<e)h=this.x.getAttribLocation(this.A8,s[t]),this.A_B.push(h),n=r.default.GetVBufAttributeTypeByNS(s[t]),this.A_C.push(n),this.A_D.push(i[t]),this.A_G[n]=h,this.A_H[n]=i[t],this.dataUniformEnabled=!0,++t;for(this.A_I=[],t=0;t<this.A_H.length;++t)this.A_H[t]>0&&this.A_I.push(this.A_H[t]);a.default.SHADERCODE_TRACE_ENABLED}if(this.o_.haveCommonUniform()&&null==this.A_E){let s=this.o_.getUniforms();this.A_E=[],e=s.length,t=0;let i=null,r="";while(t<e)s[t].isTex||(r=s[t].name,i=this.x.getUniformLocation(this.A8,r),a.default.SHADERCODE_TRACE_ENABLED,null!=i?(i.uniformName=r,i.uniqueName=this.A9,s[t].location=i,this.A_J.set(r,s[t]),this.A_K.set(r,i),this.A_E.push(i),this.dataUniformEnabled=!0):a.default.SHADERCODE_TRACE_ENABLED),++t}if(this.A_A=this.o_.getTexTotal(),this.A_A>0){this.A_F=new Array(this.A_A);let e=this.o_.getTexUniformNames();for(t=0;t<this.A_A;++t)e[t]="u_sampler"+t,this.A_F[t]=this.x.getUniformLocation(this.A8,e[t])}}getLayoutBit(){return this.o_.getLayoutBit()}getMid(){return this.o_.getMid()}getFragOutputTotal(){return this.o_.getFragOutputTotal()}getLocationsTotal(){return this.A_C.length}getLocationTypeByIndex(t){return this.A_C[t]}getLocationSizeByIndex(t){return this.A_D[t]}testVertexAttribPointerOffset(t){let e=!1;if(null!=t&&null!=this.A_I&&t.length>=this.A_I.length){let s=0,i=0;for(;i<this.A_I.length;++i){if(s!=t[i])break;s+=4*this.A_I[i]}e=i>=this.A_I.length}if(!e)throw Error("Shader program vertx attributes layout can not match float attribute vertex data !!!");return e}vertexAttribPointerType(t,e,s,i,a,r){this.A_N=this.A_G[t],this.A_N>-1&&(this.x.enableVertexAttribArray(this.A_N),this.x.vertexAttribPointer(this.A_N,this.A_H[t],s,i,a,r))}vertexAttribPointerTypeFloat(t,e,s){this.A_N=this.A_G[t],this.A_N>-1&&(this.x.enableVertexAttribArray(this.A_N),this.x.vertexAttribPointer(this.A_N,this.A_H[t],this.x.FLOAT,!1,e,s))}testVertexAttribPointerType(t){return this.A_G[t]>-1}getVertexAttribByTpye(t){return this.A_G[t]}vertexAttribPointerAt(t,e,s,i,a,r){this.A_O=t,this.A_N=this.A_B[t],this.A_N>-1&&(this.x.enableVertexAttribArray(this.A_N),this.x.vertexAttribPointer(this.A_N,e,s,i,a,r))}vertexAttribPointerNext(t,e,s,i,a){this.A_N=this.A_B[this.A_O],this.A_N>-1&&(this.x.enableVertexAttribArray(this.A_N),this.x.vertexAttribPointer(this.A_N,t,e,s,i,a)),this.A_O++}vertexAttribPointerFirst(t,e,s,i,a){this.A_O=1,this.A_N=this.A_B[0],this.A_N>-1&&(this.x.enableVertexAttribArray(this.A_N),this.x.vertexAttribPointer(this.A_N,t,e,s,i,a))}getUniformLocationAt(t){return this.A_Q=t+1,this.A_E[t]}getUniformLocationNext(){return this.A_P=this.A_E[this.A_Q++],this.A_P}getUniformLocationFirst(){return this.A_Q=1,this.A_E[0]}getUniformLocationByNS(t){return this.A_K.get(t)}getUniformTypeNameByNS(t){return this.A_J.has(t)?this.A_J.get(t).typeName:""}getUniformTypeByNS(t){return this.A_J.has(t)?this.A_J.get(t).type:0}hasUniformByName(t){return this.A_J.has(t)}getUniformLengthByNS(t){return this.A_J.has(t)?this.A_J.get(t).arrLength:0}initShdProgram(){let t,e=this.o_.getVSCodeStr(),s=this.o_.getFSCodeStr();null==this.o_.preCompileInfo&&a.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(e.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),e=e.replace(t," highp ")),e.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),e=e.replace(t," highp "))),a.default.SHADERCODE_TRACE_ENABLED;let i=this.loadShader(this.x.VERTEX_SHADER,e);null==this.o_.preCompileInfo&&a.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(s.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),s=s.replace(t," highp ")),s.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),s=s.replace(t," highp "))),a.default.SHADERCODE_TRACE_ENABLED;let r=this.loadShader(this.x.FRAGMENT_SHADER,s),n=this.x.createProgram();return this.x.attachShader(n,r),this.x.attachShader(n,i),this.x.linkProgram(n),this.x.getProgramParameter(n,this.x.LINK_STATUS)?(this.A_L=i,this.A_M=r,n):(a.default.SHADERCODE_TRACE_ENABLED,null)}loadShader(t,e){let s=this.x.createShader(t);return this.x.shaderSource(s,e),this.x.compileShader(s),this.x.getShaderParameter(s,this.x.COMPILE_STATUS)?s:(a.default.SHADERCODE_TRACE_ENABLED,this.x.deleteShader(s),null)}getUniqueShaderName(){return this.A9}enabled(){return null!=this.A8}upload(t,e){null==this.A8&&(this.A=e,this.x=t,this.A8=this.initShdProgram(),this.A8.uniqueName=this.A9,null!=this.A8&&this.createLocations())}getRCUid(){return this.A}uniformBlockBinding(t,e){this.x.uniformBlockBinding(this.A8,this.x.getUniformBlockIndex(this.A8,t),e)}toString(){return"[ShdProgram(uniqueName = "+this.A9+")]"}getGPUProgram(){return this.A8}destroy(){this.A_B=null,this.A_I=null,this.A_A>0&&(this.A_F.fill(null),this.A_A=0),null!=this.A8&&(this.x.deleteShader(this.A_L),this.x.deleteShader(this.A_M),this.A_L=null,this.A_M=null,this.x.deleteProgram(this.A8),this.A8=null),this.x=null,this.o_=null}}e.default=n},2139:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("18c7"));class r{static GetMatTotal(){return r.F_w}static GetFS32Arr(){return r.F_u}static SetFS32Arr(t){r.F_u=t;let e=r.F_w,s=r.F_v;for(let i=0;i<e;++i)s[i].setF32Arr(t)}static GetFreeId(){return r.X_.length>0?r.X_.pop():-1}static Allocate(t){if(t<1024&&(t=1024),r.F_w<1){r.F_w=t,r.F_u=new Float32Array(16*t);let e=0,s=new a.default(r.F_u,16*e),i=s.getUid();for(r.F_x=i,r.F_y=i+t;e<i;++e)r.F_v.push(null),r.F_z.push(r.S_FLAG_FREE);for(r.F_v.push(s),r.F_z.push(r.S_FLAG_FREE),r.X_.push(s.getUid()),e=1;e<t;++e)s=new a.default(r.F_u,16*e),r.F_v.push(s),r.F_z.push(r.S_FLAG_FREE),r.X_.push(s.getUid())}}static GetMatrix(){let t=null,e=r.GetFreeId()-r.F_x;return e>=0?(t=r.F_v[e],t.identity(),r.F_z[e]=r.S_FLAG_BUSY):t=new a.default,t}static RetrieveMatrix(t){if(null!=t){let e=t.getUid();e>=r.F_x&&e<r.F_y&&r.F_z[e-r.F_x]==r.S_FLAG_BUSY&&(r.X_.push(e),r.F_z[e-r.F_x]=r.S_FLAG_FREE)}}}r.S_FLAG_BUSY=1,r.S_FLAG_FREE=0,r.F_v=[],r.F_z=[],r.X_=[],r.F_u=null,r.F_x=0,r.F_y=0,r.F_w=0,e.default=r},2560:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("ab73")),r=i(s("7279"));class n{create(t,e){let s=null,i=t.getCamera();return e.hasUniformByName(a.default.CameraViewMatUNS)&&e.hasUniformByName(a.default.CameraProjectiveMatUNS)?(s=new r.default,s.uns="u_viewAndProjMat",s.uniformNameList=[a.default.CameraViewMatUNS,a.default.CameraProjectiveMatUNS],s.copyDataFromProbe(i.matUProbe)):e.hasUniformByName(a.default.CameraViewMatUNS)?(s=new r.default,s.uns="u_viewMat",s.uniformNameList=[a.default.CameraViewMatUNS],s.copyDataFromProbeAt(0,i.matUProbe)):e.hasUniformByName(a.default.CameraProjectiveMatUNS)&&(s=new r.default,s.uns="u_projMat",s.uniformNameList=[a.default.CameraProjectiveMatUNS],s.copyDataFromProbeAt(1,i.matUProbe)),s}getIDNS(){return"CameraUniformBuilder"}}e.default=n},"25cf":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("6e01")),r=i(s("8e17")),n=i(s("c217")),h=i(s("faa5")),l=i(s("b3bd")),o=i(s("0fc4")),_=s("5216");class m extends h.default{constructor(){super(),this.billFS=new n.default,this.Ak="",this.brightnessEnabled=!1}initialize(t){super.initialize(t),this.Ak="BillboardLine3DShader",this.Ak+=this.brightnessEnabled?"Brn":"Alp"}buildShader(){let t=this.A_R;if(this.brightnessEnabled){let t=this.fogEnabled;null!=this.pipeline&&(t=t||this.pipeline.hasPipeByType(_.MaterialPipeType.FOG_EXP2),t=t||this.pipeline.hasPipeByType(_.MaterialPipeType.FOG)),this.brightnessOverlayEnabeld=t}this.A_S.addDiffuseMap(),t.addVertLayout("vec2","a_vs"),t.addVertLayout("vec2","a_uvs"),t.addVarying("vec4","v_colorMult"),t.addVarying("vec4","v_colorOffset"),t.addVarying("vec4","v_fadeV"),t.addVarying("vec4","v_uv"),t.addVertUniform("vec4","u_billParam",6),t.addDefine("FADE_VAR","fv4"),t.addVertHeadCode("\n    const vec4  direcV = vec4(1.0,-1.0,-1.0,1.0);\n");let e="\n    vec4 color = VOX_Texture2D(VOX_DIFFUSE_MAP, v_uv.xy);\n    vec3 offsetColor = v_colorOffset.rgb;\n    float kf = v_uv.z;\n    //kf = min(kf / 0.3, 1.0) * (1.0 - max((kf - 0.7)/(1.0 - 0.7),0.0));\n    kf = min(kf / v_fadeV.x, 1.0) * (1.0 - max((kf - v_fadeV.y)/(1.0 - v_fadeV.y),0.0));\n    vec4 fv4 = vec4(v_colorMult.w * kf * v_fadeV.w);\n",s=this.billFS.getBrnAndAlphaCode(),i="\n    FragColor0 = color;\n";t.addFragMainCode(e+s+i),t.addVertMainCode("\n    int i = int(a_vs.x);\n    mat4 voMat4 = u_viewMat * u_objMat;\n    viewPosition = voMat4 * vec4(u_billParam[i].xyz,1.0);\n    vec4 pv1 = voMat4 * vec4(u_billParam[i+1].xyz,1.0);\n    pv1.xy = pv1.xy - viewPosition.xy;\n    pv1.xy = pv1.yx * (a_vs.y > 0.0 ? direcV.xy : direcV.zw);\n    viewPosition.xy += normalize(pv1.xy) * abs(u_billParam[3].w);\n    gl_Position = u_projMat * viewPosition;\n    \n    vec2 puv = a_uvs * u_billParam[0].xy;\n    float cosv = cos(u_billParam[2].w);\n    float sinv = sin(u_billParam[2].w);\n    puv = vec2(puv.x * cosv - puv.y * sinv, puv.x * sinv + puv.y * cosv);\n    v_uv.xy = puv + u_billParam[0].zw;\n    v_uv.zw = a_uvs;\n    v_colorMult = u_billParam[1];\n    v_colorOffset = u_billParam[2];\n    v_fadeV = vec4(u_billParam[4].w, u_billParam[5].w, 1.0,1.0);\n")}getUniqueShaderName(){return this.Ak+"_"+this.billFS.getBrnAlphaStatus()}toString(){return"[BillboardLine3DShaderBuffer()]"}static GetInstance(){return null!=m.F_0||(m.F_0=new m),m.F_0}}m.F_0=new m;class u extends o.default{constructor(t=!0,e=!1){super(),this.A_T=!0,this.A_U=!1,this.Aw=new r.default,this.Ax=new r.default,this.A_V=new r.default,this.A_W=0,this.A_X=new Float32Array([1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,10,100,0,0,.3,200,0,0,.7]),this.A_T=t,this.A_U=e}buildBuf(){let t=m.GetInstance();t.billFS.setBrightnessAndAlpha(this.A_T,this.A_U),t.brightnessEnabled=this.A_T}getCodeBuf(){return m.GetInstance()}createSelfUniformData(){let t=new l.default;return t.uniformNameList=["u_billParam"],t.dataList=[this.A_X],t}setBeginAndEndPos(t,e){this.Aw.copyFrom(t),this.Ax.copyFrom(e),this.A_V.subVecsTo(e,t),this.A_V.addBy(e),this.A_X[12]=t.x,this.A_X[13]=t.y,this.A_X[14]=t.z,this.A_X[16]=e.x,this.A_X[17]=e.y,this.A_X[18]=e.z,this.A_X[20]=this.A_V.x,this.A_X[21]=this.A_V.y,this.A_X[22]=this.A_V.z}setBeginPos(t){this.Aw.copyFrom(t),this.A_V.subVecsTo(this.Ax,t),this.A_V.addBy(this.Ax),this.A_X[12]=t.x,this.A_X[13]=t.y,this.A_X[14]=t.z,this.A_X[20]=this.A_V.x,this.A_X[21]=this.A_V.y,this.A_X[22]=this.A_V.z}setEndPos(t){this.Ax.copyFrom(t),this.A_V.subVecsTo(t,this.Aw),this.A_V.addBy(t),this.A_X[16]=t.x,this.A_X[17]=t.y,this.A_X[18]=t.z,this.A_X[20]=this.A_V.x,this.A_X[21]=this.A_V.y,this.A_X[22]=this.A_V.z}setLineWidth(t){this.A_X[15]=.5*t}getLineWidth(){return this.A_X[15]}setUVRotation(t){this.A_W=t,this.A_X[11]=a.default.DegreeToRadian(t)}getUVRotation(){return this.A_W}setUVParam(t,e,s,i){this.A_X[0]=t,this.A_X[1]=e,this.A_X[2]=s,this.A_X[3]=i}setUVScale(t,e){this.A_X[0]=t,this.A_X[1]=e}setUVOffset(t,e){this.A_X[2]=t,this.A_X[3]=e}setRGB3f(t,e,s){this.A_X[4]=t,this.A_X[5]=e,this.A_X[6]=s}setFadeRange(t,e){this.A_X[19]=t,this.A_X[23]=e}setFadeFactor(t){this.A_X[7]=t}getFadeFactor(){return this.A_X[7]}setRGBOffset3f(t,e,s){this.A_X[8]=t,this.A_X[9]=e,this.A_X[10]=s}getUniformData(){return this.A_X}destroy(){super.destroy(),this.A_X=null}}e.default=u},"264c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.A_Y=null,this.A_Z=null,this.A_a=null,this.A_b=null,this.A_c=[],this.A_d=0,this.A_e=null,this.A_f=0,this.A_g=null,this.sortEnabled=!0,this.A_e=t}setSorter(t){this.A_g=t}showInfo(){let t="",e=this.A_Y;while(null!=e)t+=e.unit.value+",",e=e.next}clear(){if(null!=this.A_e){this.A_c.length>0&&(this.A_c=[]);let t=this.A_Y,e=null;while(null!=t)e=t,t=t.next,e.prev=null,e.next=null;this.A_Y=this.A_Z=null,this.A_d=0,this.A_f=0,this.sortEnabled=!0,this.A_e=null}this.A_g=null}update(){this.sortEnabled&&this.sort()}run(t){this.A_e.resetUniform();let e=null,s=this.A_c;for(let i=0;i<this.A_f;++i)e=s[i],this.A_e.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t)}runLockMaterial(t){this.A_e.resetUniform();let e=null,s=this.A_c;for(let i=0;i<this.A_f;++i)e=s[i],this.A_e.bindToGpu(e.shdUid),e.vro.run(),e.runLockMaterial2(null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}sort(){if(this.A_d>0){let t=this.A_Y;this.A_c.length<this.A_d&&(this.A_c=new Array(Math.round(1.1*this.A_d)+1));let e=0;while(null!=t)t.drawEnabled&&t.unit.drawEnabled&&(this.A_c[e]=t.unit,++e),t=t.next;this.A_f=e;let s=0;null!=this.A_g&&(s=this.A_g.sortRODisplay(this.A_c,e)),s<1&&this.snsort(0,e-1)}}sorting(t,e){let s=this.A_c;this.A_b=s[t];let i=this.A_b.value;while(t<e){while(t<e&&s[e].value>=i)--e;s[t]=s[e];while(t<e&&s[t].value<=i)++t;s[e]=s[t]}return s[t]=this.A_b,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}getNodesTotal(){return this.A_d}getBegin(){return this.A_a=this.A_Y,this.A_Y}getNext(){return null!=this.A_a&&(this.A_a=this.A_a.next),this.A_a}isEmpty(){return this.A_d<1}addNode(t){null==t.prev&&null==t.next&&(null==this.A_Y?this.A_Z=this.A_Y=t:null!=this.A_Z.prev?(this.A_Z.next=t,t.prev=this.A_Z,this.A_Z=t):(this.A_Y.next=t,t.prev=this.A_Z,this.A_Z=t),this.A_Z.next=null,this.A_d++)}removeNode(t){null==t.prev&&null==t.next&&t!=this.A_Y||(t==this.A_Y?t==this.A_Z?this.A_Y=this.A_Z=null:(this.A_Y=t.next,this.A_Y.prev=null):t==this.A_Z?(this.A_Z=t.prev,this.A_Z.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null,this.A_d--)}}e.default=i},"265e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.__$ruid=-1,this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.prev=null,this.next=null,this.unit=null,this.vro=null,this.tro=null,this.rvroI=-1,this.rtroI=-1}setValue(t){this.unit.value=t}isVsible(){return null==this.unit||this.unit.drawEnabled}updateData(){let t=this.unit;this.drawMode=t.drawMode,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,this.vtxUid=t.vtxUid,this.vro=t.vro,this.shdUid=t.shdUid,this.texMid=t.texMid,this.tro=t.tro}reset(){this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.unit=null,this.vro=null,this.tro=null,this.prev=null,this.next=null}toString(){return"[Object RPONode(uid = "+this.uid+", index = "+this.index+", shdUid = "+this.shdUid+", vtxUid = "+this.vtxUid+")]"}}e.default=i},"278e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.A_h=null,this.A_i=null,this.slideSpeed=2,this.c_=0,this.d_=0,this.A_j=!1}initialize(t,e){null==this.A_h&&(this.A_h=t,this.A_i=e)}attach(){this.c_=this.A_h.mouseX,this.d_=this.A_h.mouseY,this.A_j=!0}detach(){this.A_j=!1}run(){if(this.A_j){let t=(this.c_-this.A_h.mouseX)*this.slideSpeed,e=(this.d_-this.A_h.mouseY)*this.slideSpeed;this.A_i.slideViewOffsetXY(t,e),this.c_=this.A_h.mouseX,this.d_=this.A_h.mouseY}}}e.CameraDragSlide=i},"28a9":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("f3a2"),a=s("69ed");class r{constructor(){this.types=[a.ShaderCodeType.VertHead,a.ShaderCodeType.VertBody,a.ShaderCodeType.FragHead,a.ShaderCodeType.FragBody],this.urls=null,this.uuid=i.ShaderCodeUUID.Default,this.binary=!1,this.buildBinaryFile=!1}}e.ShaderCodeConfigure=r},"29ef":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("7c63"),r=s("e08e"),n=i(s("919c"));class h{static Initialize(){if(h.F_1){h.F_1=!1;let t=h;t.Rstate=new a.RODrawState,a.RenderColorMask.Rstate=h.Rstate,a.RenderStateObject.Rstate=h.Rstate,t.COLOR_MASK_ALL_TRUE=a.RenderColorMask.Create("all_true",!0,!0,!0,!0),t.COLOR_MASK_ALL_FALSE=a.RenderColorMask.Create("all_false",!1,!1,!1,!1),t.COLOR_MASK_RED_TRUE=a.RenderColorMask.Create("red_true",!0,!1,!1,!1),t.COLOR_MASK_GREEN_TRUE=a.RenderColorMask.Create("green_true",!1,!0,!1,!1),t.COLOR_MASK_BLUE_TRUE=a.RenderColorMask.Create("blue_true",!1,!1,!0,!1),t.COLOR_MASK_ALPHA_TRUE=a.RenderColorMask.Create("alpha_true",!1,!1,!1,!0),t.COLOR_MASK_RED_FALSE=a.RenderColorMask.Create("red_false",!1,!0,!0,!0),t.COLOR_MASK_GREEN_FALSE=a.RenderColorMask.Create("green_false",!0,!1,!0,!0),t.COLOR_MASK_BLUE_FALSE=a.RenderColorMask.Create("blue_false",!0,!0,!1,!0),t.COLOR_MASK_ALPHA_FALSE=a.RenderColorMask.Create("alpha_false",!0,!0,!0,!1);let e=a.RenderStateObject,s=r.RenderBlendMode;s.NORMAL=e.CreateBlendMode("NORMAL",r.GLBlendMode.ONE,r.GLBlendMode.ZERO,r.GLBlendEquation.FUNC_ADD),s.OPAQUE=e.CreateBlendMode("OPAQUE",r.GLBlendMode.ONE,r.GLBlendMode.ZERO,r.GLBlendEquation.FUNC_ADD),s.TRANSPARENT=e.CreateBlendMode("TRANSPARENT",r.GLBlendMode.SRC_ALPHA,r.GLBlendMode.ONE_MINUS_SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),s.ALPHA_ADD=e.CreateBlendMode("ALPHA_ADD",r.GLBlendMode.ONE,r.GLBlendMode.ONE_MINUS_SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),s.ADD=e.CreateBlendMode("ADD",r.GLBlendMode.SRC_ALPHA,r.GLBlendMode.ONE,r.GLBlendEquation.FUNC_ADD),s.ADD_LINEAR=e.CreateBlendMode("ADD_LINEAR",r.GLBlendMode.ONE,r.GLBlendMode.ONE,r.GLBlendEquation.FUNC_ADD),s.INVERSE_ALPHA=e.CreateBlendMode("INVERSE_ALPHA",r.GLBlendMode.ONE,r.GLBlendMode.SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),s.BLAZE=e.CreateBlendMode("BLAZE",r.GLBlendMode.SRC_COLOR,r.GLBlendMode.ONE,r.GLBlendEquation.FUNC_ADD),s.OVERLAY=e.CreateBlendMode("OVERLAY",r.GLBlendMode.DST_COLOR,r.GLBlendMode.DST_ALPHA,r.GLBlendEquation.FUNC_ADD),s.OVERLAY2=e.CreateBlendMode("OVERLAY2",r.GLBlendMode.DST_COLOR,r.GLBlendMode.SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),t.NORMAL_STATE=e.Create("normal",r.CullFaceMode.BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.BACK_CULLFACE_NORMAL_STATE=t.NORMAL_STATE,t.FRONT_CULLFACE_NORMAL_STATE=e.Create("front_normal",r.CullFaceMode.FRONT,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.NONE_CULLFACE_NORMAL_STATE=e.Create("none_normal",r.CullFaceMode.NONE,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.ALL_CULLFACE_NORMAL_STATE=e.Create("all_cull_normal",r.CullFaceMode.FRONT_AND_BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.BACK_NORMAL_ALWAYS_STATE=e.Create("back_normal_always",r.CullFaceMode.BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.ALWAYS),t.BACK_TRANSPARENT_STATE=e.Create("back_transparent",r.CullFaceMode.BACK,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.TRANSPARENT_SORT),t.BACK_TRANSPARENT_ALWAYS_STATE=e.Create("back_transparent_always",r.CullFaceMode.BACK,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.ALWAYS),t.NONE_TRANSPARENT_STATE=e.Create("none_transparent",r.CullFaceMode.NONE,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.TRANSPARENT_SORT),t.NONE_TRANSPARENT_ALWAYS_STATE=e.Create("none_transparent_always",r.CullFaceMode.NONE,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.ALWAYS),t.FRONT_CULLFACE_GREATER_STATE=e.Create("front_greater",r.CullFaceMode.FRONT,r.RenderBlendMode.NORMAL,r.DepthTestMode.TRUE_GREATER),t.BACK_ADD_BLENDSORT_STATE=e.Create("back_add_blendSort",r.CullFaceMode.BACK,r.RenderBlendMode.ADD,r.DepthTestMode.TRANSPARENT_SORT),t.BACK_ADD_ALWAYS_STATE=e.Create("back_add_always",r.CullFaceMode.BACK,r.RenderBlendMode.ADD,r.DepthTestMode.ALWAYS),t.BACK_ALPHA_ADD_ALWAYS_STATE=e.Create("back_alpha_add_always",r.CullFaceMode.BACK,r.RenderBlendMode.ALPHA_ADD,r.DepthTestMode.ALWAYS),t.NONE_ADD_ALWAYS_STATE=e.Create("none_add_always",r.CullFaceMode.NONE,r.RenderBlendMode.ADD,r.DepthTestMode.ALWAYS),t.NONE_ADD_BLENDSORT_STATE=e.Create("none_add_blendSort",r.CullFaceMode.NONE,r.RenderBlendMode.ADD,r.DepthTestMode.TRANSPARENT_SORT),t.NONE_ALPHA_ADD_ALWAYS_STATE=e.Create("none_alpha_add_always",r.CullFaceMode.NONE,r.RenderBlendMode.ALPHA_ADD,r.DepthTestMode.ALWAYS),t.FRONT_ADD_ALWAYS_STATE=e.Create("front_add_always",r.CullFaceMode.FRONT,r.RenderBlendMode.ADD,r.DepthTestMode.ALWAYS),t.FRONT_TRANSPARENT_STATE=e.Create("front_transparent",r.CullFaceMode.FRONT,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.TRANSPARENT_SORT),t.FRONT_TRANSPARENT_ALWAYS_STATE=e.Create("front_transparent_always",r.CullFaceMode.FRONT,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.ALWAYS),t.NONE_CULLFACE_NORMAL_ALWAYS_STATE=e.Create("none_normal_always",r.CullFaceMode.NONE,r.RenderBlendMode.NORMAL,r.DepthTestMode.ALWAYS),t.BACK_ALPHA_ADD_BLENDSORT_STATE=e.Create("back_alpha_add_blendSort",r.CullFaceMode.BACK,r.RenderBlendMode.ALPHA_ADD,r.DepthTestMode.TRANSPARENT_SORT)}}static CreateBlendMode(t,e,s,i=0){return a.RenderStateObject.CreateBlendMode(t,e,s,i)}static CreateBlendModeSeparate(t,e,s,i=0,r=0,n=0){return a.RenderStateObject.CreateBlendModeSeparate(t,e,s,i,r,n)}static CreateRenderState(t,e,s,i){return a.RenderStateObject.Create(t,e,s,i)}static CreateRenderColorMask(t,e,s,i,r){return a.RenderColorMask.Create(t,e,s,i,r)}static GetRenderStateByName(t){return a.RenderStateObject.GetRenderStateByName(t)}static GetRenderColorMaskByName(t){return a.RenderColorMask.GetColorMaskByName(t)}static UnlockBlendMode(){a.RenderStateObject.UnlockBlendMode()}static LockBlendMode(t){a.RenderStateObject.LockBlendMode(t)}static UnlockDepthTestMode(){a.RenderStateObject.UnlockDepthTestMode()}static LockDepthTestMode(t){a.RenderStateObject.LockDepthTestMode(t)}static ResetState(){a.RenderColorMask.Reset(),a.RenderStateObject.Reset(),h.Rstate.reset(),n.default.Reset()}static Reset(t){a.RenderColorMask.Reset(),a.RenderStateObject.Reset(),h.Rstate.setRenderContext(t),h.Rstate.reset()}static ResetInfo(){h.DrawCallTimes=0,h.DrawTrisNumber=0,h.POVNumber=0}static SetDepthTestEnable(t){h.Rstate.setDepthTestEnable(t)}static SetBlendEnable(t){h.Rstate.setBlendEnable(t)}static SetStencilFunc(t,e,s){h.Rstate.setStencilFunc(t,e,s)}static SetStencilMask(t){h.Rstate.setStencilMask(t)}static SetStencilOp(t,e,s){h.Rstate.setStencilOp(t,e,s)}}h.F_1=!0,h.Rstate=null,h.DrawCallTimes=0,h.DrawTrisNumber=0,h.POVNumber=0,h.COLOR_MASK_ALL_TRUE=0,h.COLOR_MASK_ALL_FALSE=1,h.COLOR_MASK_RED_TRUE=2,h.COLOR_MASK_GREEN_TRUE=3,h.COLOR_MASK_BLUE_TRUE=4,h.COLOR_MASK_ALPHA_TRUE=5,h.COLOR_MASK_RED_FALSE=6,h.COLOR_MASK_GREEN_FALSE=7,h.COLOR_MASK_BLUE_FALSE=8,h.COLOR_MASK_ALPHA_FALSE=9,h.NORMAL_STATE=0,h.BACK_CULLFACE_NORMAL_STATE=0,h.FRONT_CULLFACE_NORMAL_STATE=1,h.NONE_CULLFACE_NORMAL_STATE=2,h.ALL_CULLFACE_NORMAL_STATE=3,h.BACK_NORMAL_ALWAYS_STATE=4,h.BACK_TRANSPARENT_STATE=5,h.BACK_TRANSPARENT_ALWAYS_STATE=6,h.NONE_TRANSPARENT_STATE=7,h.NONE_TRANSPARENT_ALWAYS_STATE=8,h.FRONT_CULLFACE_GREATER_STATE=9,h.BACK_ADD_BLENDSORT_STATE=10,h.BACK_ADD_ALWAYS_STATE=11,h.BACK_ALPHA_ADD_ALWAYS_STATE=12,h.NONE_ADD_ALWAYS_STATE=13,h.NONE_ADD_BLENDSORT_STATE=14,h.NONE_ALPHA_ADD_ALWAYS_STATE=15,h.FRONT_ADD_ALWAYS_STATE=16,h.FRONT_TRANSPARENT_STATE=17,h.FRONT_TRANSPARENT_ALWAYS_STATE=18,h.NONE_CULLFACE_NORMAL_ALWAYS_STATE=19,h.BACK_ALPHA_ADD_BLENDSORT_STATE=20,e.default=h},"2be0":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uuid="BinaryLoader"}async load(t,e,s=""){const i=new FileReader;i.onload=t=>{e.loaded(i.result,this.uuid)};const a=new XMLHttpRequest;a.open("GET",t,!0),""!=s&&a.setRequestHeader("Range",s),a.responseType="blob",a.onload=t=>{a.status<=206?i.readAsArrayBuffer(a.response):e.loadError(a.status,this.uuid)},a.onerror=t=>{e.loadError(a.status,this.uuid)},a.send()}}e.default=i},"2be1":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.A_d=0,this.A_c=[],this.A_k=[],this.X_=[]}createNode(){return null}restoreUid(t){}getFreeId(){return this.X_.length>0?this.X_.pop():-1}getNodeByUid(t){return this.A_c[t]}create(){let t=null,e=this.getFreeId();return e>=0?(t=this.A_c[e],t.uid=e,this.A_k[e]=i.S_BUSY):(t=this.createNode(),this.A_c.push(t),this.A_k.push(i.S_BUSY),t.uid=this.A_d,this.A_d++),t}restore(t){return null!=t&&t.uid>=0&&this.A_k[t.uid]==i.S_BUSY&&(this.restoreUid(t.uid),this.X_.push(t.uid),this.A_k[t.uid]=i.S_FREE,t.reset(),!0)}restoreByUid(t){return t>=0&&t<this.A_d&&this.A_k[t]==i.S_BUSY&&(this.restoreUid(t),this.X_.push(t),this.A_k[t]=i.S_FREE,this.A_c[t].reset(),!0)}}i.S_BUSY=1,i.S_FREE=0,e.default=i},"2e8a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8a0a")),r=i(s("644c"));class n{constructor(){this.type=-1,this.attriType=-1,this.typeSize=3,this.typeName="",this.name="",this.layoutEnabled=!0}parseCode(t){const e=";",s=" ";t=t.replace(/^\s*|\s*$/g,"");let i=t.indexOf(e);i>0&&(t=t.slice(0,i));let n=t.split(s);this.typeName=n[n.length-2],this.name=n[n.length-1],this.type=r.default.GetTypeByTypeNS(this.typeName),this.typeSize=parseInt(this.typeName.slice(this.typeName.length-1)),this.attriType=a.default.GetVBufAttributeTypeByNS(this.name)}}e.default=n},"2fe8":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("a996")),r=i(s("c497")),n=i(s("125c")),h=i(s("3930"));class l{constructor(){this.Al=null,this.A_l=null}initialize(t){null!=t&&(this.Al=t,this.Al.addEventListener(a.default.RESIZE,this,this.resize),this.initUIScene())}enable(){this.A_l.enable()}disable(){this.A_l.disable()}isEnabled(){return this.A_l.isEnabled()}initUIScene(){let t=new r.default;t.cameraPerspectiveEnabled=!1,t.setCamProject(45,.1,3e3),t.setCamPosition(0,0,1500);let e=null;e=this.Al.createSubScene(),e.initialize(t),e.enableMouseEvent(!0),this.A_l=e;let s=this.Al.getStage3D();this.A_l.getCamera().translationXYZ(s.stageHalfWidth,s.stageHalfHeight,1500),this.A_l.getCamera().update(),n.default.GetInstance().initialize(this.Al),n.default.GetInstance().initializeAtlas(1024,1024,new h.default(1,1,1,0),!0)}getRendererScene(){return this.A_l}getRendererStatus(){return this.A_l.getRendererStatus()}getUid(){return this.A_l.getUid()}enableMouseEvent(t=!0){this.A_l.enableMouseEvent(t)}getMouseXYWorldRay(t,e){this.A_l.getMouseXYWorldRay(t,e)}renderBegin(t=!1){this.A_l.renderBegin()}runBegin(t=!0,e=!1){this.A_l.runBegin(t,e)}setRayTestEanbled(t){this.A_l.setRayTestEanbled(t)}update(t=!0,e=!0){this.A_l.update(t,e)}run(t=!1){this.A_l.run(t)}runEnd(){this.A_l.runEnd()}runAt(t){this.A_l.runAt(t)}addEntity(t,e=0,s=!0){this.A_l.addEntity(t,e,s)}removeEntity(t){this.A_l.removeEntity(t)}addContainer(t,e=0){this.A_l.addContainer(t,e)}removeContainer(t){this.A_l.removeContainer(t)}drawEntity(t,e=!1,s=!0){this.A_l.drawEntity(t,e,s)}isRayPickSelected(){return this.A_l.isRayPickSelected()}addEventListener(t,e,s,i,a=!1){this.A_l.addEventListener(t,e,s,i,a)}removeEventListener(t,e,s){this.A_l.removeEventListener(t,e,s)}resize(t){if(null!=this.A_l){let t=this.A_l.getStage3D();this.A_l.getCamera().translationXYZ(t.stageHalfWidth,t.stageHalfHeight,1500)}}setClearUint24Color(t,e=1){this.Al.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,s){this.Al.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.Al.setClearRGBAColor4f(t,e,s,i)}setClearColor(t){this.Al.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.Al.setRenderToBackBuffer()}updateCamera(){this.Al.updateCamera()}getCamera(){return this.Al.getCamera()}getStage3D(){return this.A_l.getStage3D()}getRenderProxy(){return this.A_l.getRenderProxy()}getRenderProcessAt(t){return this.A_l.getRenderProcessAt(t)}}e.OrthoUIScene=l},3024:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("3077"));class r extends a.default{constructor(t){super(),this.A_m=null,this.A_n=1,t<1&&(t=1),this.A_n=t,this.A_m=new Float32Array(4*t)}bindSlotAt(t){super.bindSlotAt(t),this.addVec4Data(this.A_m,this.A_n)}destroy(){super.destroy(),this.A_m=null}}e.default=r},3077:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("644c")),r=i(s("5326"));class n{constructor(){this.T=n.F_j++,this.e=null,this.A_o=null,this.A_p=0,this.A_q=-1,this.rst=-1,this.uniformsTotal=0,this.uniformTypes=null,this.dataSizeList=null}getUid(){return this.T}getSlotBeginIndex(){return this.A_q}getSlotUid(){return this.e.getUid()}getFS32At(t){return this.A_o[t]}setFS32At(t,e){this.A_o[e]=t}setVec4DataAt(t,e,s,i,a){let r=this.A_o[t];r[0]=e,r[1]=s,r[2]=i,r[3]=a}setVec4Data(t,e,s,i){let a=this.A_o[0];a[0]=t,a[1]=e,a[2]=s,a[3]=i}setVec4DataAtWithArr4(t,e){this.A_o[t].set(e,0)}setVec4DataWithArr4(t){this.A_o[0].set(t,0)}addVec4Data(t,e){t.length,this.A_o.push(t),this.uniformTypes.push(a.default.SHADER_VEC4),this.dataSizeList.push(e),this.e.dataList[this.A_p]=t,this.A_p++,this.uniformsTotal++,this.e.index++}addMat4Data(t,e){this.A_o.push(t),this.uniformTypes.push(a.default.SHADER_MAT4),this.dataSizeList.push(e),this.e.dataList[this.A_p]=t,this.A_p++,this.uniformsTotal++,this.e.index++}isEnabled(){return this.rst>=0}bindSlotAt(t){let e=r.default.GetSlotAt(t);this.rst>=0&&this.reset(),null==this.A_o&&(this.A_o=[],this.uniformTypes=[],this.dataSizeList=[]),this.e=e,this.rst=1,this.A_q=e.index,this.A_p=e.index}update(){if(this.rst++,this.uniformsTotal<2)this.e.flagList[this.A_q]=this.rst;else for(let t=this.A_q;t<=this.A_p;++t)this.e.flagList[t]=this.rst}reset(){this.rst=-1,this.A_q=-1,this.uniformsTotal=0,this.A_p=0,null!=this.A_o&&(this.A_o=null,this.uniformTypes=null,this.dataSizeList=null),this.e=null}destroy(){this.reset()}}n.F_j=0,e.default=n},3113:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("839a"),r=s("a9f4"),n=i(s("ab73"));class h{constructor(){this.A_r=null,this.A_s="",this.A_t=new Uint16Array(128),this.A_u=16,this.A_v=!1}__$setCodeBuilder(t){this.A_r=t}getUniqueNSKeyID(){if(this.A_v){let t=31;for(let e=0;e<this.A_u;++e)t=131*t+this.A_t[e];return t}return 0}getUniqueNSKeyString(){if(this.A_v){this.A_s="["+this.A_t[0];for(let t=1;t<this.A_u;++t)this.A_s+=""+this.A_t[t];return this.A_s+="]",this.A_s}return""}reset(){if(this.A_v){for(let t=0;t<this.A_u;++t)this.A_t[t]=0;this.A_v=!1}}useCameraPosition(t=!1,e=!0){t&&this.A_r.addVertUniformParam(n.default.CameraPosParam),e&&this.A_r.addFragUniformParam(n.default.CameraPosParam)}useViewPort(t=!1,e=!0){t&&this.A_r.addVertUniformParam(n.default.ViewportParam),e&&this.A_r.addFragUniformParam(n.default.ViewportParam)}useFrustum(t=!1,e=!0){t&&this.A_r.addVertUniformParam(n.default.FrustumParam),e&&this.A_r.addFragUniformParam(n.default.FrustumParam)}useStage(t,e){t&&this.A_r.addVertUniformParam(n.default.StageParam),e&&this.A_r.addFragUniformParam(n.default.StageParam)}addDiffuseMap(){this.A_r.addTextureSample2D("VOX_DIFFUSE_MAP",!0,!0,!1),this.A_t[0]=1,this.A_v=!0}addNormalMap(){this.A_r.addTextureSample2D("VOX_NORMAL_MAP",!0,!0,!1),this.A_r.normalMapEnabled=!0,this.A_t[1]=1,this.A_v=!0}addParallaxMap(t){this.A_r.addTextureSample2D("VOX_PARALLAX_MAP",!0,!0,!1),t>=0?(this.A_r.addDefine("VOX_PARALLAX_PARAMS_INDEX",""+t),this.A_t[2]=1+(t<<1)):this.A_t[2]=1,this.A_v=!0}addDisplacementMap(t){this.A_r.addTextureSample2D("VOX_DISPLACEMENT_MAP",!0,!1,!0),t>=0?(this.A_r.addDefine("VOX_DISPLACEMENT_PARAMS_INDEX",""+t),this.A_t[3]=1+(t<<1)):this.A_t[3]=1,this.A_v=!0}addSpecularMap(t=a.SpecularMode.Default){this.A_r.addTextureSample2D("VOX_SPECULAR_MAP",!0,!0,!1),this.A_r.addDefine("VOX_SPECULAR_MODE",""+t),this.A_t[5]=1+(t<<1),this.A_v=!0}addShadowMap(t=r.ShadowMode.VSM){this.A_r.addTextureSample2D("VOX_VSM_SHADOW_MAP",!1,!0,!1),this.A_t[6]=1+(t<<1),this.A_v=!0}addFogColorMap(){this.A_r.addTextureSample2D("VOX_FOG_COLOR_MAP",!0,!0,!1),this.A_t[7]=1,this.A_v=!0}addspecularEnvMap(t=!0){t?this.A_r.addTextureSampleCube("VOX_ENV_MAP",!0,!1):this.A_r.addTextureSample2D("VOX_ENV_MAP",!0,!0,!1),this.A_t[8]=1,this.A_v=!0}addAOMap(){this.A_r.addTextureSample2D("VOX_AO_MAP",!0,!0,!1),this.A_t[4]=1,this.A_v=!0}addRoughnessMap(){this.A_r.addTextureSample2D("VOX_ROUGHNESS_MAP",!0,!0,!1),this.A_t[9]=1,this.A_v=!0}addMetalnessMap(){this.A_r.addTextureSample2D("VOX_METALNESS_MAP",!0,!0,!1),this.A_t[10]=1,this.A_v=!0}addARMMap(){this.A_r.addTextureSample2D("VOX_ARM_MAP",!0,!0,!1),this.A_t[11]=1,this.A_v=!0}add2DMap(t="",e=!0,s=!0,i=!1){this.A_r.addTextureSample2D(t,e,s,i)}addCubeMap(t="",e=!0,s=!1){this.A_r.addTextureSampleCube(t,e,s)}add3DMap(t="",e=!0,s=!1){this.A_r.addTextureSample3D(t,e,s)}}e.ShaderCodeUniform=h},"319d":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("f3a2"),r=i(s("faa5")),n=s("839a");class h extends r.default{constructor(){super(),this.Ak="",this.colorEnabled=!0,this.specularMode=n.SpecularMode.Default,this.fragLocalParamsTotal=2,this.lightParamsIndex=2,this.normalEnabled=!0,this.buildFlag=!0,this.diffuseMap2Matrix=!0,this.vertColorEnabled=!1,this.vertUniform=null}reset(){super.reset(),this.A_R.normalEnabled=!0,this.A_R.vertMatrixInverseEnabled=!0,this.q_=[],this.Ak="LambertShd"}addDiffuseMap(t){null!=t&&(this.q_.push(t),this.buildFlag&&this.A_S.addDiffuseMap())}addDiffuseMap2(t){null!=t&&(this.q_.push(t),this.buildFlag&&(this.diffuseMap2Matrix&&(this.A_R.addDefine("VOX_USE_DIFFUSEMAP2_MAT"),this.A_R.addVarying("vec4","v_map2Pos"),this.A_R.addVertUniform("mat4","u_map2ViewMat"),this.A_R.addUniqueNSKeyString("M2VM")),this.A_S.add2DMap("VOX_DIFFUSE_MAP2",!this.diffuseMap2Matrix,!0,!1)))}addNormalMap(t){null!=t&&this.lightEnabled&&(this.q_.push(t),this.buildFlag&&this.A_S.addNormalMap())}addParallaxMap(t,e=0){null!=t&&this.lightEnabled&&(this.q_.push(t),this.buildFlag&&this.A_S.addParallaxMap(e))}addDisplacementMap(t,e=0){null!=t&&(this.q_.push(t),this.buildFlag&&this.A_S.addDisplacementMap(e))}addAOMap(t){null!=t&&(this.q_.push(t),this.buildFlag&&this.A_S.addAOMap())}addSpecularMap(t){null!=t&&this.lightEnabled&&(this.q_.push(t),this.buildFlag&&this.A_S.addSpecularMap(this.specularMode))}initialize(t){t=null!=this.q_&&this.q_.length>0,super.initialize(t),this.colorEnabled&&(this.Ak+="Col"),this.Ak+=this.fragLocalParamsTotal}buildShader(){null!=this.vertUniform&&this.vertUniform.use(this.A_R),this.A_R.addFragUniform("vec4","u_fragLocalParams",this.fragLocalParamsTotal),this.lightEnabled&&this.A_R.addDefine("VOX_LIGHT_LOCAL_PARAMS_INDEX",""+this.lightParamsIndex),this.vertColorEnabled&&(this.A_R.addVertLayout("vec3","a_cvs"),this.A_R.addVarying("vec3","v_cv"))}getShaderCodeObjectUUID(){return a.ShaderCodeUUID.Lambert}getUniqueShaderName(){return null!=this.vertUniform?this.Ak+this.keysString+this.vertUniform.getUniqueNSKeyString():this.Ak+this.keysString}toString(){return"[LambertLightShaderBuffer()]"}}e.AdvancedShaderCodeBuffer=h},3221:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.A_w=null,this.A_s=""}initialize(){}use(t){}getTextures(t,e=null){return null}reset(){}destroy(){}getUniqueNSKeyString(){return this.A_s}clone(){return null}getParams(){return this.A_w}getParamsTotal(){return null!=this.A_w?this.A_w.length>>2:0}buildShaderUniformData(t){}}e.UniformComp=i},"326d":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17")),r=i(s("c51d")),n=i(s("18c7")),h=i(s("c8c5")),l=i(s("29ef"));class o{constructor(t,e=!1){this.Al=null,this.A_x=null,this.A_y=null,this.A_z=null,this.A_0=null,this.A_1=new a.default(0,800,0),this.A_2=128,this.A_3=128,this.AG=1300,this.AH=1300,this.A_4=10,this.A_5=2e3,this.A_6=null,this.A_7=null,this.A_8=null,this.A_9=null,this.AA=0,this.A_=null,this.BA=-1,this.BB=-1,this.BC=!0,this.BD=!1,this.histroyUpdating=!1,this.mm_camVersion=-1,this.force=!0,this.AA=t,this.BD=e}initialize(t,e){null==this.Al&&(this.Al=t,this.A_=e.slice(0),this.initConfig(e))}setMapSize(t,e){this.A_2=t,this.A_3=e}setCameraPosition(t){this.A_1.copyFrom(t)}setCameraNear(t){this.A_4=t}setCameraFar(t){this.A_5=t}setCameraViewSize(t,e){this.AG=t,this.AH=e}getMap(){return this.A_9}getMatrix(){return this.A_z}getCamera(){return this.A_x}setRendererProcessIDList(t){null!=this.A_0&&(this.A_=t.slice(0),this.A_0.setRProcessIDList(t))}setClearColorEnabled(t){this.BC=t,null!=this.A_0&&this.A_0.setClearColorEnabled(t)}initConfig(t){this.A_0=this.Al.createFBOInstance(),this.A_0.asynFBOSizeWithViewport(),this.A_0.setClearRGBAColor4f(0,0,0,0),this.A_0.createFBOAt(this.AA,this.A_2,this.A_3,!0,!1),this.BD?(this.A_7=this.A_0.setRenderToRGBATexture(null,0),this.A_6=this.A_0.setRenderToRGBATexture(null,0),this.A_8=this.Al.textureBlock.createWrapperTex(64,64),this.A_8.attachTex(this.A_7),this.A_0.setRenderToRGBATexture(this.A_6,0),this.BF=new h.default,this.BF.setRenderState(l.default.BACK_ALPHA_ADD_BLENDSORT_STATE),this.BF.initialize(-1,-1,2,2,[this.A_8])):this.A_6=this.A_0.setRenderToRGBATexture(null,0),this.A_9=this.Al.textureBlock.createWrapperTex(64,64),this.A_9.attachTex(this.A_6),this.A_0.setRProcessIDList(t),this.A_0.setClearColorEnabled(this.BC),this.A_x=new r.default,this.A_z=new n.default,this.A_y=new n.default,this.A_y.identity(),this.A_y.setScaleXYZ(.5,.5,.5),this.A_y.setTranslationXYZ(.5,.5,.5),this.updateData()}updateData(){if(null!=this.A_x){this.A_0.resizeFBO(this.A_2,this.A_3);let t=this.AG,e=this.AH;this.A_x.lookAtRH(this.A_1,a.default.ZERO,a.default.Z_AXIS),this.A_x.orthoRH(this.A_4,this.A_5,-.5*e,.5*e,-.5*t,.5*t),this.A_x.setViewXY(0,0),this.A_x.setViewSize(t,e),this.A_x.update(),this.A_z.copyFrom(this.A_x.getVPMatrix()),this.A_z.append(this.A_y)}}upate(){this.mm_camVersion=this.A_x.version,this.updateData()}getRendererProcessStatus(){let t=31;for(let e=0;e<this.A_.length;++e)t+=t*this.Al.getRenderProcessAt(e).getStatus();return t}run(){this.A_x.version!=this.mm_camVersion&&(this.mm_camVersion=this.A_x.version);let t=this.force;if(t)this.build();else{if(this.BA!=this.Al.getRendererStatus()){let e=this.getRendererProcessStatus();this.BB!=e&&(this.BB=e,t=!0),this.BA=this.Al.getRendererStatus()}t&&this.build()}this.force=!1}build(){if(this.A_0.useCamera(this.A_x),this.A_0.lockColorMask(),this.BD){if(this.histroyUpdating){let t=this.A_7,e=this.A_6;this.A_9.getAttachTex()==this.A_6&&(t=this.A_6,e=this.A_7),this.A_8.attachTex(t),this.A_9.attachTex(e),this.A_0.setRenderToRGBATexture(e,0),this.histroyUpdating=!1}this.A_0.runBegin(),this.A_0.drawEntity(this.BF)}this.A_0.run(),this.A_0.useMainCamera(),this.A_0.setRenderToBackBuffer()}}e.ViewTextureMaker=o},"32cc":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("b3bd")),r=i(s("faa5")),n=i(s("0fc4"));class h extends r.default{constructor(){super(),this.Ak="",this.dynColorEnabled=!1}initialize(t){super.initialize(t),this.Ak="Line3DShd",this.dynColorEnabled&&(this.Ak+="_dynColor")}buildShader(){this.A_R.addVertLayout("vec3","a_vs"),this.dynColorEnabled?(this.A_R.addDefine("DYNAMIC_COLOR"),this.A_R.addFragUniform("vec4","u_color")):(this.A_R.addVertLayout("vec3","a_cvs"),this.A_R.addVarying("vec3","v_color")),this.A_R.addFragOutputHighp("vec4","FragColor0"),this.A_R.addFragMainCode("\n    #ifndef DYNAMIC_COLOR\n        FragColor0 = vec4(v_color, 1.0);\n    #else\n        FragColor0 = u_color;\n    #endif\n"),this.A_R.addVertMainCode("\n    viewPosition = u_viewMat * u_objMat * vec4(a_vs,1.0);\n    vec4 pv = u_projMat * viewPosition;\n    // pixels move offset, and no perspective error.\n    //  pv.xy = (pv.xy/pv.w - vec2(0.5)) * pv.w;\n    #ifndef DYNAMIC_COLOR\n        v_color = a_cvs;\n    #endif\n    gl_Position = pv;\n            ")}getUniqueShaderName(){return this.Ak}toString(){return"[Line3DShaderBuffer()]"}static GetInstance(){return null!=h.F_0||(h.F_0=new h),h.F_0}}h.F_0=null;class l extends n.default{constructor(t=!1){if(super(),this.BI=!1,this.BJ=null,this.BI=t,t&&(this.BJ=new Float32Array([1,1,1,1]),this.BI)){let t=new a.default;t.uniformNameList=["u_color"],t.dataList=[this.BJ],this.k_=t}}getCodeBuf(){return h.GetInstance().dynColorEnabled=this.BI,h.GetInstance()}setRGB3f(t,e,s){null!=this.BJ&&(this.BJ[0]=t,this.BJ[1]=e,this.BJ[2]=s)}}e.default=l},"35fa":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17"));class r{static ClacTriNormal(t,e,s,i){a.default.Subtract(e,t,r.F_4),a.default.Subtract(s,e,r.F_3),a.default.Cross(r.F_4,r.F_3,i),i.normalize()}static ClacTriNormalByVS(t,e,s){let i=9*e;r.F_2.setTo(t[i],t[i+1],t[i+2]),s.setTo(t[i+3],t[i+4],t[i+5]),r.F_3.setTo(t[i+6],t[i+7],t[i+8]),s.subtractBy(r.F_2),r.F_3.subtractBy(r.F_2),s.crossBy(r.F_3),s.normalize()}static ClacTriNormalByIVS(t,e,s,i){let a=3*e,n=3*s[a];r.F_2.setTo(t[n],t[n+1],t[n+2]),n=3*s[a+1],i.setTo(t[n],t[n+1],t[n+2]),n=3*s[a+2],r.F_3.setTo(t[n],t[n+1],t[n+2]),i.subtractBy(r.F_2),r.F_3.subtractBy(r.F_2),i.crossBy(r.F_3),i.normalize()}static ClacTrisNormal(t,e,s,i,n){let h=new a.default,l=0,o=0,_=0;for(_=0;_<e;++_)n[_]=0;for(_=0;_<s;++_)r.ClacTriNormalByIVS(t,_,i,h),l=3*_,o=3*i[l],n[o]+=h.x,n[o+1]+=h.y,n[o+2]+=h.z,o=3*i[l+1],n[o]+=h.x,n[o+1]+=h.y,n[o+2]+=h.z,o=3*i[l+2],n[o]+=h.x,n[o+1]+=h.y,n[o+2]+=h.z;for(_=0;_<e;_+=3)r.F_2.setTo(n[_],n[_+1],n[_+2]),r.F_2.normalize(),n[_]=r.F_2.x,n[_+1]=r.F_2.y,n[_+2]=r.F_2.z}static ClacTriTangent(t,e,s,i,a,n,h){let l=3*i,o=3*a[l];r.F_2.setTo(s[o],s[o+1],s[o+2]),r.F_2.setTo(t[o],t[o+1],t[o+2]),o=3*a[l+1],r.F_4.setTo(t[o],t[o+1],t[o+2]),o=3*a[l+2],r.F_3.setTo(t[o],t[o+1],t[o+2]),o=2*a[l],r.F_5.setTo(e[o],e[o+1],0),o=2*a[l+1],r.F_6.setTo(e[o],e[o+1],0),o=2*a[l+2],r.F_7.setTo(e[o],e[o+1],0),r.F_4.subtractBy(r.F_2),r.F_3.subtractBy(r.F_2),r.F_6.subtractBy(r.F_5),r.F_7.subtractBy(r.F_5);let _=1/(r.F_6.x*r.F_7.y-r.F_6.y*r.F_7.x);n.copyFrom(r.F_4),n.scaleBy(r.F_7.y),r.F_2.copyFrom(r.F_3),r.F_2.scaleBy(r.F_6.y),n.subtractBy(r.F_2),n.scaleBy(_),n.normalize(),h.copyFrom(r.F_3),h.scaleBy(r.F_6.x),r.F_2.copyFrom(r.F_4),r.F_2.scaleBy(r.F_7.x),h.subtractBy(r.F_2),h.scaleBy(_),h.normalize()}static ClacTrisTangent(t,e,s,i,n,h,l,o){let _=new a.default,m=new a.default,u=0,d=0,c=0;for(c=0;c<e;++c)l[c]=0,o[c]=0;for(c=0;c<n;++c)r.ClacTriTangent(t,s,i,c,h,_,m),u=3*c,d=3*h[u],l[d]=_.x,l[d+1]=_.y,l[d+2]=_.z,o[d]=m.x,o[d+1]=m.y,o[d+2]=m.z,d=3*h[u+1],l[d]=_.x,l[d+1]=_.y,l[d+2]=_.z,o[d]=m.x,o[d+1]=m.y,o[d+2]=m.z,d=3*h[u+2],l[d]=_.x,l[d+1]=_.y,l[d+2]=_.z,o[d]=m.x,o[d+1]=m.y,o[d+2]=m.z;for(c=0;c<e;c+=3)r.F_5.setTo(l[c],l[c+1],l[c+2]),r.F_5.normalize(),r.F_4.setTo(o[c],o[c+1],o[c+2]),r.F_4.normalize(),r.F_3.setTo(i[c],i[c+1],i[c+2]),r.F_2.copyFrom(r.F_3),r.F_3.scaleBy(r.F_3.dot(r.F_5)),r.F_5.subtractBy(r.F_3),r.F_5.normalize(),r.F_3.setTo(i[c],i[c+1],i[c+2]),r.F_3.scaleBy(r.F_4.dot(r.F_3)),r.F_4.subtractBy(r.F_3),r.F_4.normalize(),r.F_2.crossBy(r.F_5),r.F_2.dot(r.F_4)<0&&r.F_5.scaleBy(-1),l[c]=r.F_5.x,l[c+1]=r.F_5.y,l[c+2]=r.F_5.z,r.F_4.setTo(i[c],i[c+1],i[c+2]),r.F_4.crossBy(r.F_5),r.F_4.normalize(),o[c]=r.F_4.x,o[c+1]=r.F_4.y,o[c+2]=r.F_4.z}}r.F_2=new a.default,r.F_4=new a.default,r.F_3=new a.default,r.F_5=new a.default,r.F_6=new a.default,r.F_7=new a.default,r.F_8=new a.default,e.default=r},"36cb":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("e08e"),r=i(s("ab73")),n=s("b02c"),h=i(s("4f27")),l=i(s("b30a")),o=i(s("9156")),_=s("670e");class m{constructor(){this.BK=null,this.A_e=null,this.AX=null,this.AZ=null,this.BL=null,this.Aj=null,this.BM=null,this.BN=null,this.BO=[],this.BP=[],this.BQ=[],this.BR=!1}initialize(t,e,s,i){null==this.A_e&&(this.Aj=t,this.BM=t.Vertex,this.BN=t.Texture,this.A_e=new l.default(t.getRCUid(),t.getRC(),t.getRenderAdapter()),this.AX=e,this.AZ=s,this.BL=i,this.BK=new n.EmptyTexRenderObj(this.BN))}getRenderProxy(){return this.Aj}getRenderShader(){return this.A_e}getTextureResource(){return this.BN}updateTextureData(t,e){this.BN.hasResUid(t.getResUid())&&(e?(this.BQ.push(t),this.BR=!0):t.__$updateToGpu(this.BN))}updateDispTRO(t,e){t.__$ruid>-1&&(e?(this.BP.push(t),this.BR=!0):this.updateTextureTRO(t))}createTRO(t,e){if(null!=t){for(let e=0;e<t.length;++e)null!=t[e]&&t[e].__$setRenderProxy(this.Aj);return n.TextureRenderObj.Create(this.BN,t,e)}return null}updateTextureTRO(t){if(null!=t.__$$runit){let e=t.getMaterial();if(null!=e){let s=this.BN,i=t.__$$runit,a=n.TextureRenderObj.GetByMid(s.getRCUid(),e.__$troMid);if(null!=i.tro&&(null==a||i.tro.getMid()!=a.getMid())){let t=this.A_e.findShdProgramByShdData(e.getShaderData());null!=t&&(t.getTexTotal()>0?(null==a&&(a=this.createTRO(e.getTextureList(),t.getTexTotal())),i.tro!=a&&(null!=i.tro&&i.tro.__$detachThis(),i.tro=a,a.__$attachThis(),i.texMid=i.tro.getMid(),this.AZ.rejoinRunitForTro(i),e.__$troMid=i.tro.getMid())):i.tro!=this.BK&&(null!=i.tro&&i.tro.__$detachThis(),i.tro=this.BK,i.texMid=i.tro.getMid(),this.AZ.rejoinRunitForTro(i),e.__$troMid=i.texMid))}}}}updateDispMaterial(t,e){let s=null;if(e.__$ruid>=0){let i=this.Aj,a=e.getMaterial();if(null!=a){if(null==a.getShaderData()){let t=a.getTextureList(),e=null!=t&&null!=t&&t.length>0;a.initializeByCodeBuf(e)}s=this.A_e.create(a.getShaderData()),s.upload(i.RContext,i.getUid()),t.shdUid=s.getUid();let n=null;if(s.getTexTotal()>0?(n=this.createTRO(a.getTextureList(),s.getTexTotal()),t.tro!=n&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=n,n.__$attachThis(),t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.AZ.rejoinRunitForTro(t),a.__$troMid=t.tro.getMid())):t.tro!=this.BK&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=this.BK,t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.AZ.rejoinRunitForTro(t),a.__$troMid=t.texMid),null==this.A_e.getSharedUniformByShd(s)){let t=this.createsharedMList(a,s);if(null!=t)for(let e=0;e<t.length;++e)t[e].program=s.getGPUProgram();this.A_e.setSharedUniformByShd(s,h.default.BuildShared(t,i,s))}let l=s.hasUniformByName(r.default.LocalTransformMatUNS);null==a.__$uniform&&(a.__$uniform=h.default.BuildLocalFromData(a.createSelfUniformData(),s)),l&&null!=e.getTransform()&&(t.transUniform=o.default.GetTransUniform(e.getTransform())),null==t.transUniform?(t.transUniform=h.default.BuildLocalFromTransformV(l?e.getMatrixFS32():null,s),o.default.SetTransUniform(e.getTransform(),t.transUniform)):t.transUniform=h.default.UpdateLocalFromTransformV(t.transUniform,l?e.getMatrixFS32():null,s),t.polygonOffset=a.getPolygonOffset(),t.uniform=a.__$uniform}}return s}updateVtxDataToGpuByUid(t,e){this.BM.updateDataToGpu(t,e)}updateDispVbuf(t,e){if(t.__$ruid>-1)if(e)this.BO.push(t),this.BR=!0;else{let e=t.__$$runit;if(null!=e&&e.vtxUid!=t.vbuf.getUid()){let s=e.vtxUid,i=this.BM;i.hasResUid(s)&&i.__$detachRes(s),e.vro.__$detachThis(),this.buildVtxRes(t,e,this.A_e.findShdProgramByUid(e.shdUid)),e.__$rprouid>=0&&this.AZ.rejoinRunitForVro(e)}}}buildVtxRes(t,e,s){if(null!=t.vbuf){let i=this.BM;e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,e.visible=t.visible,e.setVisible(t.visible),e.drawMode=t.drawMode,e.renderState=t.renderState,e.rcolorMask=t.rcolorMask,e.trisNumber=t.trisNumber;let a,r=t.vbuf.getUid(),n=!0;i.hasResUid(r)?(a=i.getVertexRes(r),n=a.version!=t.vbuf.version,n&&(i.destroyRes(r),a.rcuid=i.getRCUid(),a.resUid=r)):(a=new _.GpuVtxObject,a.rcuid=i.getRCUid(),a.resUid=r,i.addVertexRes(a)),n&&(a.indices.ibufStep=t.vbuf.getIBufStep(),a.indices.initialize(this.BL,t.vbuf),a.vertex.initialize(this.BL,s,t.vbuf),a.version=t.vbuf.version),i.__$attachRes(r),e.vro=a.createVRO(this.BL,s,!0),e.indicesRes=e.vro.indicesRes,e.vro.__$attachThis(),e.vtxUid=t.vbuf.getUid(),e.ibufStep=e.vro.ibufStep,e.ibufType=4!=e.ibufStep?this.Aj.UNSIGNED_SHORT:this.Aj.UNSIGNED_INT}}buildGpuDisp(t){if(t.__$ruid<0&&null!=t.getMaterial()){t.__$$rsign=a.DisplayRenderSign.LIVE_IN_RENDERER;let e=this.AX.create();if(t.__$ruid=e.uid,t.__$$runit=e,null!=t.getPartGroup()){e.partGroup=t.getPartGroup().slice(0),e.partTotal=e.partGroup.length;let s=e.partGroup;for(let t=0,i=e.partTotal;t<i;)t++,s[t++]*=e.ibufStep}return e.setDrawFlag(t.renderState,t.rcolorMask),this.buildVtxRes(t,e,this.updateDispMaterial(e,t)),!0}return!1}update(){if(this.BR){this.BR=!1;let t=this.BO.length,e=0;if(t>0){for(;e<t;++e)this.updateDispVbuf(this.BO[e],!1);this.BO=[]}if(t=this.BP.length,t>0){for(e=0;e<t;++e)this.updateTextureTRO(this.BP[e]);this.BP=[]}if(t=this.BQ.length,t>0){for(e=0;e<t;++e)this.BQ[e].__$updateToGpu(this.BN);this.BQ=[]}}}createsharedMList(t,e){let s=t.createSharedUniforms();if(null==s){let i=t.createSharedUniformsData();if(null!=i&&i.length>0){s=[];for(let t=0;t<i.length;++t)if(null!=i[t]){let a=h.default.BuildLocalFromData(i[t],e);s.push(a)}s.length<1&&(s=null)}}return s}updateGlobalMaterial(t,e=!1){if(null!=t){let s=this.Aj,i=null,a=null,r=null,n=!1;null==t.getShaderData()?(r=t.getTextureList(),n=null!=r&&r.length>0,t.initializeByCodeBuf(n)):r=t.getTextureList(),a=this.A_e.create(t.getShaderData()),a.upload(s.RContext,s.getUid());let l=a.getTexTotal();if(l>0&&(i=this.createTRO(r,l)),null==this.A_e.getSharedUniformByShd(a)){let e=this.createsharedMList(t,a);if(null!=e)for(let t=0;t<e.length;++t)e[t].program=a.getGPUProgram();this.A_e.setSharedUniformByShd(a,h.default.BuildShared(e,s,a))}null==t.__$uniform&&(t.__$uniform=h.default.BuildLocalFromData(t.createSelfUniformData(),a)),this.A_e.__$globalUniform=t.__$uniform,this.A_e.bindToGpu(a.getUid()),e&&null!=t.__$uniform&&this.A_e.useUniform(t.__$uniform),null!=i&&i.run()}}reset(){this.BO=[],this.BP=[]}}e.default=m},3806:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("a996")),r=i(s("1710")),n=i(s("7045")),h=i(s("9260")),l=i(s("3024")),o=i(s("badb"));class _{constructor(t,e){this.A=0,this.uProbe=null,this.pixelRatio=1,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.B=0,this.C=0,this.D=1,this.E=1,this.F=new o.default,this.G=[],this.H=[],this.I=[],this.J=[],this.BS=new n.default,this.K=[],this.L=[],this.M=[],this.N=[],this.O=0,this.P=0,this.Q=new r.default,this.BT=new a.default,this.R=!0,this.S=new a.default,this.A=t,null==_.F_9&&(_.F_9=e,e.onkeydown=function(t){h.default.KeyDown(t)},e.onkeyup=function(t){h.default.KeyUp(t)}),h.default.AddEventListener(n.default.KEY_DOWN,this,this.keyDown),h.default.AddEventListener(n.default.KEY_UP,this,this.keyUp)}getRCUid(){return this.A}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.B}getViewY(){return this.C}getViewWidth(){return this.D}getViewHeight(){return this.E}setViewPort(t,e,s,i){this.R=!1,this.B=t,this.C=e,s==this.D&&i==this.E||(this.D=s,this.E=i,this.updateViewUData())}updateViewUData(){null==this.uProbe&&(this.uProbe=new l.default(1),this.uProbe.bindSlotAt(this.A)),this.uProbe.setVec4Data(2/this.stageWidth,2/this.stageHeight,this.stageWidth,this.stageHeight),this.uProbe.update(),this.O=this.D,this.P=this.E}update(){this.O==this.stageWidth&&this.P==this.stageHeight||(this.R&&(this.D=this.stageWidth,this.E=this.stageHeight,this.updateViewUData()),this.stageHalfWidth=.5*this.stageWidth,this.stageHalfHeight=.5*this.stageHeight,this.BT.target=this,this.BT.type=a.default.RESIZE,this.BT.phase=1,this.sendResizeEvt(this.BT))}keyDown(t){this.BS.phase=1,this.BS.type=n.default.KEY_DOWN,this.BS.altKey=t.altKey,this.BS.ctrlKey=t.ctrlKey,this.BS.shiftKey=t.shiftKey,this.BS.repeat=t.repeat,this.BS.key=t.key,this.BS.keyCode=t.keyCode,this.BS.location=t.location;let e=this.K.length;for(var s=0;s<e;++s)this.K[s].call(this.L[s],this.BS)}keyUp(t){this.BS.phase=1,this.BS.type=n.default.KEY_UP,this.BS.altKey=t.altKey,this.BS.ctrlKey=t.ctrlKey,this.BS.shiftKey=t.shiftKey,this.BS.repeat=t.repeat,this.BS.key=t.key,this.BS.keyCode=t.keyCode,this.BS.location=t.location,this.BS.target=this;let e=this.M.length;for(var s=0;s<e;++s)this.M[s].call(this.N[s],this.BS)}sendResizeEvt(t){let e=this.G.length;for(var s=0;s<e;++s)this.G[s].call(this.H[s],t)}mouseDown(t=1){this.Q.type=r.default.MOUSE_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=t,this.F.dispatchEvt(this.Q)}mouseUp(t=1){this.Q.phase=1,this.Q.type=r.default.MOUSE_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=t,this.F.dispatchEvt(this.Q)}mouseClick(){this.Q.type=r.default.MOUSE_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseDoubleClick(){this.Q.type=r.default.MOUSE_DOUBLE_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightDown(t=1){this.Q.type=r.default.MOUSE_RIGHT_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightUp(t=1){this.Q.type=r.default.MOUSE_RIGHT_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgDown(){this.Q.type=r.default.MOUSE_BG_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgUp(){this.Q.type=r.default.MOUSE_BG_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgClick(){this.Q.type=r.default.MOUSE_BG_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightClick(){this.Q.type=r.default.MOUSE_RIGHT_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseMove(){this.Q.type=r.default.MOUSE_MOVE,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseWheel(t){this.Q.type=r.default.MOUSE_WHEEL,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.wheelDeltaY=t.wheelDeltaY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseCancel(){this.Q.type=r.default.MOUSE_CANCEL,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseMultiDown(t){this.Q.type=r.default.MOUSE_MULTI_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseMultiUp(t){this.Q.type=r.default.MOUSE_MULTI_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseMultiMove(t){this.Q.type=r.default.MOUSE_MULTI_MOVE,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseWindowUp(t=1){}mouseWindowRightUp(t=1){}enterFrame(){this.S.type=a.default.ENTER_FRAME;let t=this.I.length;for(var e=0;e<t;++e)this.I[e].call(this.J[e],this.S)}addEventListener(t,e,s,i=!0,r=!0){if(null!=s&&null!=e){let h=0;switch(t){case a.default.RESIZE:for(h=this.G.length-1;h>=0;--h)if(e===this.H[h])break;h<0&&(this.H.push(e),this.G.push(s));break;case a.default.ENTER_FRAME:for(h=this.I.length-1;h>=0;--h)if(e===this.J[h])break;h<0&&(this.J.push(e),this.I.push(s));break;case n.default.KEY_DOWN:for(h=this.K.length-1;h>=0;--h)if(e===this.L[h])break;h<0&&(this.L.push(e),this.K.push(s));break;case n.default.KEY_UP:for(h=this.M.length-1;h>=0;--h)if(e===this.N[h])break;h<0&&(this.N.push(e),this.M.push(s));break;default:this.F.addEventListener(t,e,s,i,r);break}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=0;switch(t){case a.default.RESIZE:for(i=this.G.length-1;i>=0;--i)if(e===this.H[i]){this.H.splice(i,1),this.G.splice(i,1);break}break;case a.default.ENTER_FRAME:for(i=this.I.length-1;i>=0;--i)if(e===this.J[i]){this.J.splice(i,1),this.I.splice(i,1);break}break;case n.default.KEY_DOWN:for(i=this.K.length-1;i>=0;--i)if(e===this.L[i]){this.L.splice(i,1),this.K.splice(i,1);break}break;case n.default.KEY_UP:for(i=this.M.length-1;i>=0;--i)if(e===this.N[i]){this.N.splice(i,1),this.M.splice(i,1);break}break;default:this.F.removeEventListener(t,e,s);break}}}}_.F_9=null,e.default=_},"38de":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("6e01")),r=i(s("8e17")),n=i(s("f48d"));class h extends n.default{constructor(){super(...arguments),this.tv=new r.default(1,0,0)}update(){this.tv.normalize()}updateFast(){this.tv.normalize()}static IntersectionTri(t,e,s,i,a,r){return 0}static IntersectionLS(t,e,s,i,a,l=1){let o=h.__tAv;if(o.copyFrom(i),o.subtractBy(s),o.normalize(),r.default.Cross(e,o,a),a.normalize(),o.w=a.dot(t)-a.dot(i),Math.abs(o.w)<=l){a.crossBy(e),a.normalize(),a.w=a.dot(t),o.w=(a.w-a.dot(s))/o.dot(a),a.copyFrom(o),a.scaleBy(o.w),a.addBy(s),o.copyFrom(a),o.subtractBy(s);let r=n.default.__tV1;if(r.copyFrom(a),r.subtractBy(i),o.dot(r)<=0)return 1}return 0}static IntersectioNearSphere2(t,e,s,i,r){let n=h.__tAv;if(n.x=s.x-t.x,n.y=s.y-t.y,n.z=s.z-t.z,n.w=n.dot(e),i*=i,n.w>a.default.MATH_MIN_POSITIVE){if(r.copyFrom(e),r.scaleBy(n.w),r.subtractBy(n),n.x=r.getLengthSquared(),n.x<=i)return n.w-=Math.sqrt(i-n.x),r.copyFrom(e),r.scaleBy(n.w),r.addBy(t),r.w=1,1}else if(n.getLengthSquared()<=i&&(r.copyFrom(e),r.scaleBy(n.w),r.subtractBy(n),n.x=r.getLengthSquared(),n.x<=i))return n.w+=Math.sqrt(i-n.x),r.copyFrom(e),r.scaleBy(n.w),r.addBy(t),r.w=1,1;return 0}static IntersectioNearSphere(t,e,s,i,r){let n=h.__tAv;if(n.x=s.x-t.x,n.y=s.y-t.y,n.z=s.z-t.z,n.w=n.dot(e),n.w>a.default.MATH_MIN_POSITIVE){if(r.x=n.x-n.w*e.x,r.y=n.y-n.w*e.y,r.z=n.z-n.w*e.z,r.x=r.getLengthSquared(),r.w=i*i,r.x<=r.w)return r.x=n.getLengthSquared(),r.z=r.w-r.x,n.normalize(),r.y=n.dot(e)*Math.sqrt(r.x),n.w=.5*(-r.y+Math.sqrt(r.y*r.y+4*r.z)),r.copyFrom(e),r.scaleBy(n.w),r.addBy(t),r.w=1,1}else if(r.x=n.getLengthSquared(),r.w=i*i,r.x<=r.w)return r.z=r.w-r.x,n.normalize(),r.y=n.dot(e)*Math.sqrt(r.x),n.w=.5*(-r.y+Math.sqrt(r.y*r.y+4*r.z)),r.copyFrom(e),r.scaleBy(n.w),r.addBy(t),r.w=1,1;return 0}static IntersectSphere(t,e,s,i){let r=h.__tAv;return r.x=s.x-t.x,r.y=s.y-t.y,r.z=s.z-t.z,r.w=r.dot(e),r.w<a.default.MATH_MIN_POSITIVE||(r.x-=r.w*e.x,r.y-=r.w*e.y,r.z-=r.w*e.z),r.getLengthSquared()<=i*i}}h.__tAv=new r.default,e.default=h},3930:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("6e01"));class r{constructor(t=1,e=1,s=1,i=1){this.r=1,this.g=1,this.b=1,this.a=1,this.r=t,this.g=e,this.b=s,this.a=i}setRGB3Bytes(t,e,s){this.r=t/255,this.g=e/255,this.b=s/255}setRGB3f(t,e,s){this.r=t,this.g=e,this.b=s}setRGBUint24(t){this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255}setRGBA4f(t,e,s,i){this.r=t,this.g=e,this.b=s,this.a=i}copyFrom(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}copyFromRGB(t){this.r=t.r,this.g=t.g,this.b=t.b}scaleBy(t){this.r*=t,this.g*=t,this.b*=t}inverseRGB(){this.r=1-this.r,this.g=1-this.g,this.b=1-this.b}randomRGB(t=1,e=0){this.r=Math.random()*t,this.g=Math.random()*t,this.b=Math.random()*t,this.r+=e,this.g+=e,this.b+=e}normalizeRandom(t=1,e=0){this.r=Math.random(),this.g=Math.random(),this.b=Math.random();let s=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);s>a.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/s,this.g=t*this.g/s,this.b=t*this.b/s),this.r+=e,this.g+=e,this.b+=e}normalize(t){void 0==t&&(t=1);let e=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);e>a.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/e,this.g=t*this.g/e,this.b=t*this.b/e)}getCSSDecRGBAColor(){let t=Math.floor(255*this.r),e=Math.floor(255*this.g),s=Math.floor(255*this.b),i=this.a;return"rgba("+t+","+e+","+s+","+i+")"}getCSSHeXRGBColor(){let t="#",e=Math.floor(255*this.r);return t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.g),t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.b),t+=e<15?"0"+e.toString(16):""+e.toString(16),t}toString(){return"[Color4(r="+this.r+", g="+this.g+",b="+this.b+",a="+this.a+")]"}}e.default=r},"3b73":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetWebBodyColor(t="white"){const e=document.body;e.style.background=t}static SetLanguage(t){i.F_=t}static GetLanguage(){return""!=i.F_||(i.F_=navigator.language),i.F_}static SetThreadEnabled(t){i.GA=t}static GetThreadEnabled(){return i.GA}static GetDebugEnabled(){return i.GB}static SetDebugEnabled(t){i.GB=t}static SetDevicePixelRatio(t){i.GC=t}static GetDevicePixelRatio(){return i.GC}static Initialize(t){i.GD&&(i.GD=!1,i.GE=t[0],i.TestMobileWeb(),i.F_=navigator.language+"")}static IsWindowsPCOS(){return!(i.IsSafariWeb()||i.IsMobileWeb())}static IsWinExternalVideoCard(){if(i.GF>0)return 2==i.GF;let t=i.IsSafariWeb()||i.IsMobileWeb();return t||(t=i.GPU_RENDERER.indexOf("Intel(R)")<0),i.GF=t?2:1,2==i.GF}static TestSafariWeb(){return/Safari/.test(navigator.userAgent)&&/Mac OS/.test(navigator.userAgent)}static IsWebGL1(){return 1==i.GE}static IsWebGL2(){return 2==i.GE}static IsMobileWeb(){return i.GK>0?2==i.GK:i.TestMobileWeb()}static IsSafariWeb(){return i.GG>0||(i.GG=i.TestSafariWeb()?2:1),2==i.GG}static IsIOS(){if(i.GH>0)return 2==i.GH;let t=!1;return t=!!/iPad|iPhone|iPod/.test(navigator.platform)||void 0!=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),i.GH=t?2:1,t}static IsIpadOS(){if(i.GI>0)return 2==i.GI;let t=navigator.maxTouchPoints>0&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform);return!t&&/iPod|iPad|iPadPro|iPodPro/i.test(navigator.userAgent)&&(t=!0),i.GI=t?2:1,t}static IsAndroidOS(){if(i.GJ>0)return 2==i.GJ;let t=i.TestMobileWeb();return t=!(!t||!/Android|Linux/i.test(navigator.userAgent)),i.GJ=t?2:1,t}static TestMobileWeb(){return i.GK>0?2==i.GK:/mobile/.test(location.href)?(i.GK=2,2==i.GK):/Android/i.test(navigator.userAgent)?/Mobile/i.test(navigator.userAgent)?(i.GK=2,2==i.GK):(i.GK=1,2==i.GK):/webOS|iPhone|iPod|iPad|iPodPro|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(i.GK=2,2==i.GK):(i.GK=1,2==i.GK)}}i.GD=!0,i.GE=2,i.GC=1,i.GK=0,i.GG=0,i.GJ=0,i.GH=0,i.GI=0,i.GF=0,i.F_="",i.GB=!0,i.GPU_VENDOR="unknown",i.GPU_RENDERER="unknown",i.MAX_TEXTURE_SIZE=4096,i.MAX_RENDERBUFFER_SIZE=4096,i.MAX_VIEWPORT_WIDTH=4096,i.MAX_VIEWPORT_HEIGHT=4096,i.SHOWLOG_ENABLED=!1,i.SHADERCODE_TRACE_ENABLED=!1,i.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,i.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,i.GA=!0,e.default=i},"3bfb":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("6e01")),r=i(s("35fa")),n=i(s("8a0a")),h=i(s("e7d2")),l=s("8a0a"),o=i(s("fecb")),_=i(s("cb29"));class m extends _.default{constructor(t=n.default.VTX_STATIC_DRAW){super(t),this.BU=[null,null,null,null,null,null,null,null],this.normalType=l.VtxNormalType.FLAT,this.BV=null,this.BW=null,this.BX=null,this.BY=null,this.vtxColor=null,this.flipVerticalUV=!1,this.uvPartsNumber=0,this.uScale=1,this.vScale=1}getVS(){return this.BV}getUVS(){return this.BW}getNVS(){return this.BX}getCVS(){return this.BY}setPositionAt(t,e){if(t>=0&&t<8&&null!=this.BV){let s=this.BU[t];s[0]=e.x,s[1]=e.y,s[2]=e.z}}getPositionAt(t,e){if(t>=0&&t<8&&null!=this.BV){let s=this.BU[t];e.x=s[0],e.y=s[1],e.z=s[2]}}setEdgeAt(t,e,s){if(t>=0&&t<8&&null!=this.BV){let i=this.BU[t];t++,3==t?t=0:7==t&&(t=4);let a=this.BU[t];i[0]=e.x,i[1]=e.y,i[2]=e.z,a[0]=s.x,a[1]=s.y,a[2]=s.z}}getEdgeAt(t,e,s){if(t>=0&&t<8&&null!=this.BV){let i=this.BU[t];t++,3==t?t=0:7==t&&(t=4);let a=this.BU[t];e.x=i[0],e.y=i[1],e.z=i[2],s.x=a[0],s.y=a[1],s.z=a[2]}}setFaceAt(t,e,s,i,a){if(t>=0&&t<8&&null!=this.BV){t*=4;let r,n,h=[e,s,i,a],l=m.GL,o=this.BU;for(let e=t+4,s=0;t<e;++t)r=o[l[t]],n=h[s++],r[0]=n.x,r[1]=n.y,r[2]=n.z}}getFaceAt(t,e,s,i,a){if(t>=0&&t<8&&null!=this.BV){t*=4;let r,n,h=[e,s,i,a],l=m.GL,o=this.BU;for(let e=t+4,s=0;t<e;++t)r=o[l[t]],n=h[s++],n.x=r[0],n.y=r[1],n.z=r[2]}}getFaceCenterAt(t,e){if(t>=0&&t<8&&null!=this.BV){t*=4;let s,i=m.GL,a=this.BU;e.setXYZ(0,0,0);for(let r=t+4;t<r;++t)s=a[i[t]],e.x+=s[0],e.y+=s[1],e.z+=s[2];e.scaleBy(.33333)}}transformFaceAt(t,e){if(t>=0&&t<8&&null!=this.BV){t*=4;let s=m.GL,i=this.BU;for(let a=t+4;t<a;++t)e.transformVectorsSelf(i[s[t]],3)}}initializeWithYFace(t,e,s,i){let a=t,r=e,n=.5*(a.y+r.y);this.BU[0]=[r.x,n,r.z],this.BU[1]=[r.x,n,a.z],this.BU[2]=[a.x,n,a.z],this.BU[3]=[a.x,n,r.z],a=s,r=i;let h=.5*(a.y+r.y);this.BU[4]=[r.x,h,r.z],this.BU[5]=[r.x,h,a.z],this.BU[6]=[a.x,h,a.z],this.BU[7]=[a.x,h,r.z],this.initData()}initialize(t,e){this.BU[0]=[e.x,t.y,e.z],this.BU[1]=[e.x,t.y,t.z],this.BU[2]=[t.x,t.y,t.z],this.BU[3]=[t.x,t.y,e.z],this.BU[4]=[e.x,e.y,e.z],this.BU[5]=[e.x,e.y,t.z],this.BU[6]=[t.x,e.y,t.z],this.BU[7]=[t.x,e.y,e.z],this.initData()}scaleUVFaceAt(t,e,s,i,a){if(null!=this.BW&&t>=0&&t<6){let r=8*t,n=r+8,h=this.BW;for(;r<n;r+=2)h[r]=e+h[r]*i,h[r+1]=s+h[r+1]*a}}reinitialize(){this.initData()}initData(){this.vtxTotal=24;let t=0,e=0,s=0,i=null==this.BZ;if(i){this.BV=new Float32Array(72),this.BZ=new Uint16Array(36);let i=[3,2,3,3,2,2];for(t=0;t<6;++t)3==i[t]?(this.BZ[s]=e+3,this.BZ[s+1]=e+2,this.BZ[s+2]=e+1,this.BZ[s+3]=e+3,this.BZ[s+4]=e+1,this.BZ[s+5]=e):(this.BZ[s]=e+2,this.BZ[s+1]=e+3,this.BZ[s+2]=e,this.BZ[s+3]=e+2,this.BZ[s+4]=e,this.BZ[s+5]=e+1),s+=6,e+=4}let _,u=m.GL,d=this.BU,c=this.BV;for(e=0,t=0;t<this.vtxTotal;++t)_=d[u[t]],c.set(_,e),e+=3;null==this.bounds?this.bounds=new o.default:this.bounds.reset(),null!=this.Ba?(this.Ba.transformVectorsSelf(this.BV,this.BV.length),this.bounds.addXYZFloat32Arr(this.BV)):this.bounds.addXYZFloat32Arr(this.BV),this.bounds.updateFast(),h.default.Reset(),h.default.AddFloat32Data(this.BV,3);let f=6;if(this.isVBufEnabledAt(n.default.VBUF_UVS_INDEX)){if(null==this.BW&&(this.BW=new Float32Array(48),this.initUVData(2*this.vtxTotal),4==this.uvPartsNumber?(this.scaleUVFaceAt(0,.5,.5,.5,.5),this.scaleUVFaceAt(1,0,0,.5,.5),this.scaleUVFaceAt(2,.5,0,.5,.5),this.scaleUVFaceAt(3,0,.5,.5,.5),this.scaleUVFaceAt(4,.5,0,.5,.5),this.scaleUVFaceAt(5,0,.5,.5,.5)):6==this.uvPartsNumber&&(this.scaleUVFaceAt(0,0,0,.25,.5),this.scaleUVFaceAt(1,.25,0,.25,.5),this.scaleUVFaceAt(2,.5,0,.25,.5),this.scaleUVFaceAt(3,.75,0,.25,.5),this.scaleUVFaceAt(4,0,.5,.25,.5),this.scaleUVFaceAt(5,.25,.5,.25,.5)),this.isVBufEnabledAt(n.default.VBUF_TVS_INDEX))){s=0;while(s<6){switch(s){case 0:t=0,this.BW[t]=0,this.BW[t+1]=1,this.BW[t+2]=1,this.BW[t+3]=1,this.BW[t+4]=1,this.BW[t+5]=0,this.BW[t+6]=0,this.BW[t+7]=0;break;case 3:t=24,this.BW[t]=0,this.BW[t+1]=1,this.BW[t+2]=1,this.BW[t+3]=1,this.BW[t+4]=1,this.BW[t+5]=0,this.BW[t+6]=0,this.BW[t+7]=0;break;case 5:t=32,this.BW[t]=0,this.BW[t+1]=1,this.BW[t+2]=1,this.BW[t+3]=1,this.BW[t+4]=1,this.BW[t+5]=0,this.BW[t+6]=0,this.BW[t+7]=0;break;default:break}++s}}h.default.AddFloat32Data(this.BW,2)}if(this.isVBufEnabledAt(n.default.VBUF_NVS_INDEX)){this.BX=new Float32Array(72),s=0;let e=0,i=0,r=0;if(this.normalType==l.VtxNormalType.FLAT)while(s<f){switch(e=0,i=0,r=0,s){case 0:i=-1;break;case 1:i=1;break;case 2:e=1;break;case 3:r=-1;break;case 4:e=-1;break;case 5:r=1;break;default:break}t=12*s,e*=this.normalScale,i*=this.normalScale,r*=this.normalScale,this.BX[t]=e,this.BX[t+1]=i,this.BX[t+2]=r,this.BX[t+3]=e,this.BX[t+4]=i,this.BX[t+5]=r,this.BX[t+6]=e,this.BX[t+7]=i,this.BX[t+8]=r,this.BX[t+9]=e,this.BX[t+10]=i,this.BX[t+11]=r,++s}else{let n=this.bounds.center,h=0;while(s<this.vtxTotal)t=3*s,e=this.BV[t]-n.x,i=this.BV[t+1]-n.y,r=this.BV[t+2]-n.z,h=Math.sqrt(e*e+i*i+r*r),h>a.default.MATH_MIN_POSITIVE&&(this.BX[t]=e/h,this.BX[t+1]=i/h,this.BX[t+2]=r/h),++s}h.default.AddFloat32Data(this.BX,3)}if(this.isVBufEnabledAt(n.default.VBUF_CVS_INDEX)){this.BY=new Float32Array(72),s=0;let e=1,i=1,a=1;null!=this.vtxColor&&(e=this.vtxColor.r,i=this.vtxColor.g,a=this.vtxColor.b);while(s<f)t=12*s,this.BY[t]=e,this.BY[t+1]=i,this.BY[t+2]=a,this.BY[t+3]=e,this.BY[t+4]=i,this.BY[t+5]=a,this.BY[t+6]=e,this.BY[t+7]=i,this.BY[t+8]=a,this.BY[t+9]=e,this.BY[t+10]=i,this.BY[t+11]=a,++s;h.default.AddFloat32Data(this.BY,3)}if(this.isVBufEnabledAt(n.default.VBUF_TVS_INDEX)){let t=12,e=new Float32Array(this.BX.length),s=new Float32Array(this.BX.length);r.default.ClacTrisTangent(this.BV,this.BV.length,this.BW,this.BX,t,this.BZ,e,s),h.default.AddFloat32Data(e,3),h.default.AddFloat32Data(s,3)}h.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.updateWireframeIvs(),null==this.Bb?(this.Bb=h.default.CreateBySaveData(this.getBufDataUsage()),this.Bb.setUintIVSData(this.BZ),this.vtCount=this.BZ.length,this.trisNumber=12,this.buildEnd()):(this.forceUpdateIVS&&this.Bb.setUintIVSData(this.BZ),h.default.UpdateBufData(this.Bb))}setFaceUVSAt(t,e,s=0){if(null!=this.BW)if(s<1)this.BW.set(e,8*t);else{t*=8,s<0&&(s=0);for(let i=0;i<4;++i)this.BW[t++]=e[2*s],this.BW[t++]=e[2*s+1],s++,s%=4}}initUVData(t){let e=this.uScale,s=this.vScale,i=0;if(this.flipVerticalUV)while(i<t)this.BW[i]=1*e,this.BW[i+1]=1*s,this.BW[i+2]=0*e,this.BW[i+3]=1*s,this.BW[i+4]=0*e,this.BW[i+5]=0*s,this.BW[i+6]=1*e,this.BW[i+7]=0*s,i+=8;else while(i<t)this.BW[i]=0*e,this.BW[i+1]=0*s,this.BW[i+2]=1*e,this.BW[i+3]=0*s,this.BW[i+4]=1*e,this.BW[i+5]=1*s,this.BW[i+6]=0*e,this.BW[i+7]=1*s,i+=8}testRay(t,e,s,i){let a=o.default.IntersectionRL2(e,t,this.bounds,s);return a?1:-1}toString(){return"Box3DMesh()"}__$destroy(){this.isResFree()&&(this.bounds=null,this.BV=null,this.BW=null,this.BX=null,this.BY=null,this.vtxColor=null,super.__$destroy())}}m.GL=[0,1,2,3,4,5,6,7,4,5,1,0,5,6,2,1,7,6,2,3,4,7,3,0],e.default=m},"3c81":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("2be1")),r=i(s("7696"));class n extends a.default{setCreateParams(t,e,s,i,a,r){this.A_e=t,this.Bc=e,this.AX=s,this.Bd=i,this.Be=a,this.Bf=r}createNode(){return new r.default(this.A_e,this.Bc,this.AX,this.Bd,this.Be,this.Bf)}rejoinRunitForTro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForTro(t)}rejoinRunitForVro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForVro(t)}}e.default=n},"3d98":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("8d98"),r=i(s("2be0"));class n{constructor(){this.Al=null,this.texture=null}loadTextureWithUrl(t,e){let s=new r.default;s.uuid=t,s.load(t,this),this.Al=e,this.createTexture()}createTexture(){this.texture=this.Al.textureBlock.createFloatCubeTex(32,32)}loaded(t,e){this.parseTextureBuffer(t),this.Al=null,this.texture=null}loadError(t,e){}parseTextureBuffer(t){let e=0,s=128,i=128,a=s*i*3,r=new Float32Array(t),n=null,h=this.texture;h.toRGBFormat();for(let l=0,o=6;l<o;++l)n=r.slice(e,e+a),h.setDataFromBytesToFaceAt(l,n,s,i,0),e+=a}}e.TextureLoader=n;class h extends n{constructor(){super(),this.hdrBrnEnabled=!1}createTexture(){this.hdrBrnEnabled?this.texture=this.Al.textureBlock.createBytesCubeTex(32,32):this.texture=this.Al.textureBlock.createFloatCubeTex(32,32)}parseFloat(t){let e=0,s=128,i=128,r=3,n=new Float32Array(t),h=null,l=this.texture;l.toRGBFormat(),l.minFilter=a.TextureConst.LINEAR_MIPMAP_LINEAR,l.magFilter=a.TextureConst.LINEAR;for(let a=0;a<9;a++){for(let t=0;t<6;t++){const o=s*i*r;h=n.subarray(e,e+o),l.setDataFromBytesToFaceAt(t,h,s,i,a),e+=o}s>>=1,i>>=1}}parseHdrBrn(t){let e=new Uint16Array(t),s=new Uint8Array(t),i=0,r=e[4],n=e[5],h=e[6],l=0,o=s.subarray(32),_=this.texture;h>1?(_.mipmapEnabled=!1,_.minFilter=a.TextureConst.LINEAR_MIPMAP_LINEAR,_.magFilter=a.TextureConst.LINEAR):(_.mipmapEnabled=!0,_.minFilter=a.TextureConst.LINEAR_MIPMAP_LINEAR,_.magFilter=a.TextureConst.LINEAR);for(let a=0;a<h;a++){for(let t=0;t<6;t++)l=r*n*4,_.setDataFromBytesToFaceAt(t,o.subarray(i,i+l),r,n,a),i+=l;r>>=1,n>>=1}}parseTextureBuffer(t){this.hdrBrnEnabled?this.parseHdrBrn(t):this.parseFloat(t)}}e.SpecularTextureLoader=h},"402a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("11e6")),r=i(s("8e17")),n=i(s("fecb")),h=i(s("29ef")),l=i(s("0929")),o=s("cc48"),_=i(s("dc2b"));class m{constructor(t=null){this.T=0,this.Bg=null,this.Bh=null,this.Bi=!0,this.Bj=!0,this.Bk=h.default.COLOR_MASK_ALL_TRUE,this.Bl=h.default.BACK_CULLFACE_NORMAL_STATE,this.Bm=null,this.Bn=null,this.Bo=null,this.Bp=null,this.Bq=-1,this.Br=null,this.d=null,this.l_=null,this.__$rseFlag=a.default.DEFAULT,this.name="DisplayEntity",this.spaceCullMask=o.SpaceCullingMask.CAMERA,this.drawEnabled=!1,this.mouseEnabled=!1,this.vbWholeDataEnabled=!0,this.pipeTypes=null,this.Bs=!1,this.Bt=!1,this.Bu=null,this.Bv=l.default.UPDATE_TRANSFORM,this.T=m.F_j++,this.Bg=null==t?l.default.Create():t,this.createBounds()}createBounds(){this.Bp=new n.default}__$setRenderProxy(t){this.d=t}__$setParent(t){this.Br,this.Br=t}__$getParent(){return this.Br}__$testSpaceEnabled(){return a.default.TestSpaceEnabled2(this.__$rseFlag)}__$testContainerEnabled(){return a.default.TestContainerEnabled(this.__$rseFlag)}__$testRendererEnabled(){return a.default.TestRendererEnabled(this.__$rseFlag)}getRendererUid(){return a.default.GetRendererUid(this.__$rseFlag)}setMaterialPipeline(t){this.l_=t}getMaterialPipeline(){return this.l_}isFree(){return this.__$rseFlag==a.default.DEFAULT}dispatchEvt(t){return null!=this.Bh?this.Bh.dispatchEvt(t):0}getEvtDispatcher(t){return this.Bh}setEvtDispatcher(t){this.Bh=t}getGlobalBounds(){return this.Bp}getLocalBounds(){return this.Bn.bounds}getGlobalBoundsVer(){return null!=this.Bp?this.Bp.version:-1}__$setDrawEnabled(t){this.Bj!=t&&(this.Bj=t,null!=this.Bm&&(this.Bm.visible=this.Bi&&t,null!=this.Bm.__$$runit&&this.Bm.__$$runit.setVisible(this.Bm.visible)))}isDrawEnabled(){return this.Bj}updateMeshToGpu(t=null,e=!0){null!=t&&(this.d=t),null!=this.d&&null!=this.Bm&&this.Bm.__$ruid>-1&&(this.Bt?(this.Bt=!1,this.d.VtxBufUpdater.updateDispVbuf(this.Bm,e)):this.d.VtxBufUpdater.updateVtxDataToGpuByUid(this.Bm.vbuf.getUid(),e))}updateMaterialToGpu(t=null,e=!0){null!=t&&(this.d=t),null!=this.d&&null!=this.Bm&&this.Bm.__$ruid>-1&&this.Bs&&(this.Bs=!1,this.d.MaterialUpdater.updateDispTRO(this.Bm,e))}setTextureList(t){null!=this.Bm&&this.Bm.__$ruid>-1&&null!=this.Bm.getMaterial()&&(this.Bm.getMaterial().setTextureList(t),this.Bs=!0)}setTextureAt(t,e){null!=this.Bm&&this.Bm.__$ruid>-1&&null!=this.Bm.getMaterial()&&(this.Bm.getMaterial().setTextureAt(t,e),this.Bs=!0)}setSortValue(t){null!=this.Bm&&null!=this.Bm.__$$runit&&(this.Bm.__$$runit.value=t)}setVisible(t){this.Bi!=t&&(this.Bi=t,null!=this.Bm&&(this.Bm.visible=t&&this.Bj,null!=this.Bm.__$$runit&&this.Bm.__$$runit.setVisible(this.Bm.visible)))}getVisible(){return this.Bi}getTransform(){return this.Bg}copyPositionFrom(t){null!=t&&this.Bg.copyPositionFrom(t.getTransform())}copyMeshFrom(t){null!=t&&this.setMesh(t.getMesh())}copyMaterialFrom(t){null!=t&&this.setMaterial(t.getMaterial())}copyTransformFrom(t){let e=t;null!=e&&this.Bg.copyFrom(e.Bg)}initDisplay(t){this.Bm.vbuf=t.__$attachVBuf(),this.Bm.ivsIndex=0,this.Bm.ivsCount=t.vtCount,this.Bm.drawMode=t.drawMode,this.Bm.trisNumber=t.trisNumber,this.Bm.visible=this.Bi&&this.Bj}setMesh(t){null==this.Bn?null!=t&&(t.isEnabled()||t.rebuild(),t.isEnabled()&&(this.Bn=t,t.__$attachThis(),null==this.Bm&&this.createDisplay(),null!=this.Bm&&(this.Bm.setTransform(this.Bg.getMatrix()),this.initDisplay(t)),null==this.Bo?this.Bo=t.bounds:this.Bo.copyFrom(t.bounds),this.updateMesh())):null!=this.Bm&&this.Bm.__$ruid>-1&&this.Bn!=t&&null!=t&&(this.Bg.updatedStatus|=2,this.Bn.__$detachVBuf(this.Bm.vbuf),this.Bn.__$detachThis(),t.__$attachThis(),this.Bn=t,this.initDisplay(t),this.updateMesh(),this.Bt=!0)}updateMesh(){}getIvsIndex(){return this.Bm.ivsIndex}getIvsCount(){return this.Bm.ivsCount}setIvsParam(t,e,s=!1){if(null!=this.Bm&&(this.Bm.ivsIndex=t,this.Bm.ivsCount=e,this.Bm.__$ruid>-1&&(this.Bm.__$$runit.trisNumber=Math.floor((e-t)/3),this.Bm.__$$runit.setIvsParam(t,e),this.Bm.__$$runit.drawMode=this.Bn.drawMode,s&&this.isPolyhedral()))){this.Bo==this.Bn.bounds&&(this.Bo=new n.default,this.Bo.copyFrom(this.Bn.bounds)),this.Bv=l.default.UPDATE_TRANSFORM,this.Bo.reset();let s=this.Bn.getIVS();this.Bo.addXYZFloat32AndIndicesArr(this.Bn.getVS(),s.subarray(t,t+e)),this.Bo.update()}}getMesh(){return this.Bn}hasMesh(){return null!=this.Bn}isPolyhedral(){return null==this.Bn||this.Bn.isPolyhedral()}testRay(t,e,s,i){return this.Bn.testRay(t,e,s,i)}setMaterial(t){null!=t&&(null==this.Bm&&(this.Bm=_.default.Create(),this.Bm.setTransform(this.Bg.getMatrix()),this.Bm.visible=this.Bi&&this.Bj),this.Bm.getMaterial()!=t&&(a.default.RENDERER_UID_FLAG&this.__$rseFlag)==a.default.RENDERER_UID_FLAG&&this.Bm.__$ruid<0&&(this.Bm.renderState=this.Bl,this.Bm.rcolorMask=this.Bk,this.Bm.setMaterial(t)))}getMaterial(){return null!=this.Bm?this.Bm.getMaterial():null}getDisplay(){return this.Bm}getInvMatrix(){return this.Bg.getInvMatrix()}getMatrix(t=!0){return this.Bg.getMatrix(t)}getToParentMatrix(){return this.Bg.getToParentMatrix()}setRenderColorMask(t){this.Bk=t,null!=this.Bm&&(this.Bm.rcolorMask=this.Bk,null!=this.Bm.__$$runit&&this.Bm.__$$runit.setDrawFlag(this.Bl,this.Bk))}setRenderColorMaskByName(t){this.Bk=h.default.GetRenderColorMaskByName(t),null!=this.Bm&&(this.Bm.rcolorMask=this.Bk,null!=this.Bm.__$$runit&&this.Bm.__$$runit.setDrawFlag(this.Bl,this.Bk))}setRenderState(t){this.Bl=t,null!=this.Bm&&(this.Bm.renderState=this.Bl,null!=this.Bm.__$$runit&&this.Bm.__$$runit.setDrawFlag(this.Bl,this.Bk))}setRenderStateByName(t){this.Bl=h.default.GetRenderStateByName(t),null!=this.Bm&&(this.Bm.renderState=this.Bl,null!=this.Bm.__$$runit&&this.Bm.__$$runit.setDrawFlag(this.Bl,this.Bk))}createDisplay(){this.Bm=_.default.Create()}activeDisplay(){if(null!=this.Bm){let t=this.Bm.getMaterial();if(null!=t){if(null==t.getShaderData()&&null!=t.getCodeBuf()&&null==t.getShaderData()){let e=t.getTextureList(),s=null!=e&&e.length>0;null==t.getMaterialPipeline()&&null!=this.getMaterialPipeline()&&t.setMaterialPipeline(this.getMaterialPipeline()),null==t.pipeTypes&&(t.pipeTypes=this.pipeTypes),t.initializeByCodeBuf(s)}null==this.getMesh()&&(this.__activeMesh(t),this.Bm.name=this.name)}}}__activeMesh(t){}getUid(){return this.T}setXYZ(t,e,s){this.Bg.setXYZ(t,e,s)}offsetPosition(t){this.Bg.offsetPosition(t)}setPosition(t){this.Bg.setPosition(t)}getPosition(t){this.Bg.getPosition(t)}setRotation3(t){this.Bg.setRotationXYZ(t.x,t.y,t.z)}setRotationXYZ(t,e,s){this.Bg.setRotationXYZ(t,e,s)}setScale3(t){this.Bg.setScaleXYZ(t.x,t.y,t.z)}setScaleXYZ(t,e,s){this.Bg.setScaleXYZ(t,e,s)}getRotationXYZ(t){this.Bg.getRotationXYZ(t)}getScaleXYZ(t){this.Bg.getScaleXYZ(t)}localToGlobal(t){null!=this.Bg&&this.Bg.localToGlobal(t)}globalToLocal(t){null!=this.Bg&&this.Bg.globalToLocal(t)}isInRenderer(){return(this.__$rseFlag&a.default.RENDERER_UID_FLAG)!=a.default.RENDERER_UID_FLAG}isInRendererProcess(){return null!=this.Bm&&this.Bm.__$ruid>-1}isRenderEnabled(){return this.drawEnabled&&this.Bi&&null!=this.Bm&&this.Bm.__$ruid>-1}updateBounds(){if(null!=this.Bg){if(this.Bv=l.default.UPDATE_TRANSFORM,null!=this.Bn&&this.Bo!=this.Bn.bounds){this.Bo.reset();let t=this.Bn.getIVS();this.Bo.addXYZFloat32AndIndicesArr(this.Bn.getVS(),t.subarray(this.Bm.ivsIndex,this.Bm.ivsIndex+this.Bm.ivsCount)),this.Bo.update()}this.update()}}updateLocalBoundsVS(t){let e=t.min,s=t.max;null==this.Bu&&(this.Bu=new Float32Array(24));let i=this.Bu;i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=s.x,i[4]=e.y,i[5]=e.z,i[6]=e.x,i[7]=e.y,i[8]=s.z,i[9]=s.x,i[10]=e.y,i[11]=s.z,i[12]=e.x,i[13]=s.y,i[14]=e.z,i[15]=s.x,i[16]=s.y,i[17]=e.z,i[18]=e.x,i[19]=s.y,i[20]=s.z,i[21]=s.x,i[22]=s.y,i[23]=s.z}updateGlobalBounds(){let t=this.Bo;if(this.Bv>l.default.UPDATE_POSITION||this.Bq!=t.version){let e=this.Bg.updateStatus;if(this.Bg.update(),this.Bq!=t.version||e!=this.Bg.updateStatus){this.Bq=t.version,this.updateLocalBoundsVS(t);let e=this.Bu,s=m.GM;this.Bg.getMatrix().transformVectors(e,24,s),this.Bp.reset(),this.Bp.addXYZFloat32Arr(s),this.Bp.update()}}else{m.GN.setXYZ(0,0,0),m.GO.setXYZ(0,0,0);let t=this.Bg.getMatrix(!1);t.transformVector3Self(m.GN),this.Bg.update(),t=this.Bg.getMatrix(!1),t.transformVector3Self(m.GO),m.GO.subtractBy(m.GN);let e=this.Bp;e.min.addBy(m.GO),e.max.addBy(m.GO),e.center.addBy(m.GO),++this.Bp.version}}update(){this.Bg.updatedStatus>this.Bv&&(this.Bv=this.Bg.updatedStatus),this.Bv!=l.default.UPDATE_NONE&&(null!=this.Bn&&null!=this.Bp?this.updateGlobalBounds():this.Bg.update(),this.Bv=l.default.UPDATE_NONE,this.Bg.updatedStatus=this.Bv)}destroy(){null!=this.Bh&&(this.Bh.destroy(),this.Bh=null),null!=this.Bg&&this.isFree()&&(null!=this.Bm&&(this.Bn.__$detachVBuf(this.Bm.vbuf),_.default.Restore(this.Bm),this.Bm=null),l.default.Restore(this.Bg),this.Bg=null,null!=this.Bn&&(this.Bn.__$detachThis(),this.Bn=null),this.__$setParent(null),this.Bi=!0,this.Bj=!0,this.d=null,this.__$rseFlag=a.default.DEFAULT),this.Bp=null,this.Bo=null,this.l_=null}toString(){return"DisplayEntity(name="+this.name+",uid = "+this.T+", rseFlag = "+this.__$rseFlag+")"}}m.F_j=0,m.GM=new Float32Array(24),m.GO=new r.default,m.GN=new r.default,e.default=m},"442e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("2be1")),r=i(s("265e"));class n extends a.default{createNode(){return new r.default}}e.default=n},"45db":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8def")),r=i(s("fa60"));class n{constructor(){this.Bw=null,this.Bx=-1,this.By=[],this.Bz=0,this.n=0,this.B0=0,this.B1=0,this.B2=null,this.B3=null,this.B4=null,this.B5=[],this.B6=0}updateToGpu(t){let e=this.By.length;if(e>0){let s=this.Bw;if(this.version!=s.vertexVer){let i,a=s.getBufDataUsage(),r=this.B4;for(let n=0;n<e;++n)i=s.getF32DataAt(n),r[n]>=i.length?(t.bindArrBuf(this.By[n]),t.arrBufSubData(i,0)):(t.bindArrBuf(this.By[n]),t.arrBufData(i,a),r[n]=i.length);this.version=s.vertexVer}}}uploadCombined(t,e){let s=this.Bw,i=s.getF32DataAt(0);if(this.By.push(t.createBuf()),t.bindArrBuf(this.By[0]),t.arrBufData(i,s.getBufDataUsage()),this.Bz=1,this.B4=[i.length],null==this.B2){this.B1=0,this.B2=new Array(this.B0),this.B3=new Array(this.B0);for(let t=0;t<this.B0;++t)this.B3[t]=this.B1,this.B1+=4*e.getLocationSizeByIndex(t),this.B2[t]=e.getLocationTypeByIndex(t)}}uploadSeparated(t,e){let s=this.Bw,i=0,a=null,r=s.getBufDataUsage();if(this.Bz=this.Bw.getBuffersTotal(),this.B4=new Array(this.B0),null==s.bufData)for(;i<this.B0;++i)a=t.createBuf(),this.By.push(a),t.bindArrBuf(a),t.arrBufData(s.getF32DataAt(i),r),this.B4[i]=s.getF32DataAt(i).length;else{let e=null,n=0,h=0,l=0,o=0;for(;i<this.B0;++i){for(a=t.createBuf(),this.By.push(a),t.bindArrBuf(a),t.arrBufDataMem(s.bufData.getAttributeDataTotalBytesAt(i),r),l=0,o=0,h=s.bufData.getAttributeDataTotalAt(i),n=0;n<h;++n)e=s.bufData.getAttributeDataAt(i,n),o+=e.length,t.arrBufSubData(e,l),l+=e.byteLength;this.B4[i]=o}}if(null==this.B2){this.B2=new Array(this.B0),this.B3=new Array(this.B0);for(let t=0;t<this.B0;++t)this.B3[t]=this.B1,this.B1+=4*e.getLocationSizeByIndex(t),this.B2[t]=e.getLocationTypeByIndex(t);this.B1=0}}initialize(t,e,s){this.By.length<1&&null!=s&&(this.version=s.vertexVer,this.Bw=s,this.Bx=s.getUid(),this.n=s.getType(),e.getLocationsTotal(),s.getAttribsTotal(),this.B0=e.getLocationsTotal(),this.n<1?this.uploadCombined(t,e):this.uploadSeparated(t,e))}getVROMid(t,e,s,i){let a=(131+t.getRCUid())*this.Bx;return s&&(a=131*a+1),a=131*a+e.getMid(),a=131*a+i,a}createVRO(t,e,s,i,n){let h=e.getLocationsTotal();if(this.B0*h>0&&h<=this.B0){let l=this.getVROMid(t,e,s,n),o=0,_=r.default.GetByMid(l);if(null!=_)return _;if(s){let s=r.default.Create(t,l,this.Bw.getUid());if(s.indicesRes=i,s.vao=t.createVertexArray(),t.bindVertexArray(s.vao),this.n<1)for(t.bindArrBuf(this.By[0]),o=0;o<h;++o)e.vertexAttribPointerTypeFloat(this.B2[o],this.B1,this.B3[o]);else for(o=0;o<h;++o)t.bindArrBuf(this.By[o]),e.vertexAttribPointerTypeFloat(this.B2[o],0,0);_=s,s.ibuf=i.getGpuBuf(),t.bindVertexArray(null)}else{let s=a.default.Create(t,l,this.Bw.getUid());for(s.indicesRes=i,s.shdp=e,s.attribTypes=[],s.wholeOffsetList=[],s.wholeStride=this.B1,this.n<1?s.vbuf=this.By[0]:s.vbufs=this.By,o=0;o<h;++o)e.testVertexAttribPointerType(this.B2[o])&&(s.attribTypes.push(this.B2[o]),s.wholeOffsetList.push(0));s.attribTypesLen=s.attribTypes.length,s.ibuf=i.getGpuBuf(),_=s}return this.B5.push(_),++this.B6,_}return null}destroy(t){if(this.By.length>0){this.n=-1;let e=0,s=null;for(;e<this.B6;++e)s=this.B5.pop(),s.restoreThis(),this.B5[e]=null;for(this.B6=0,e=0;e<this.B0;++e)t.deleteBuf(this.By[e]),this.By[e]=null;this.B0=0,this.By=[]}}}e.ROVertexRes=n},"4a54":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("3b73")),r=i(s("81ce")),n=i(s("f208")),h=s("c164");class l{constructor(t){this.B7="#version 300 es\n",this.B8="precision mediump float;\n",this.B9=[],this.B_A=[],this.B_B=[],this.B_C=[],this.B_D=[],this.B_E=[],this.B_F=[],this.B_G=[],this.B_H=[],this.B_I=[],this.B_J=[],this.B_K=[],this.B_L=[],this.B_M=[],this.B_N=[],this.B_O=[],this.B_P=[],this.B_Q=[],this.B_R=[],this.B_S=[],this.B_T="",this.B_U=[],this.B_V=!1,this.B_W=!1,this.B_X=!1,this.B_Y=!1,this.B_Z=!1,this.B_a=!1,this.B_b="",this.B_c="",this.B_d="",this.B_e="",this.A_s="",this.A_u=10,this.B_f=!1,this.B_g=null,this.fragHeadCodeUnlock=!0,this.fragMainCodeUnlock=!0,this.vertHeadCodeUnlock=!0,this.vertMainCodeUnlock=!0,this.autoBuildHeadCodeEnabled=!0,this.mathDefineEanbled=!0,this.normalEnabled=!1,this.normalMapEnabled=!1,this.mapLodEnabled=!1,this.derivatives=!1,this.vertMatrixInverseEnabled=!1,this.vtxUVTransfromEnabled=!1,this.fragMatrixInverseEnabled=!1;let e=this;e.uniform=t}getUniqueNSKeyID(){throw Error("can not use this function !!!")}getUniqueNSKeyString(){let t=this.A_s;return this.vtxUVTransfromEnabled&&(t+="VtxUVT"),this.normalEnabled&&(t+="Nor"),this.uniform.getUniqueNSKeyString()+t}reset(){this.B_V=!0,this.B_W=!0,this.B_X=!0,this.B_Y=!1,this.B_Z=!1,this.B_a=!1,this.fragHeadCodeUnlock=!0,this.fragMainCodeUnlock=!0,this.vertHeadCodeUnlock=!0,this.vertMainCodeUnlock=!0,this.autoBuildHeadCodeEnabled=!0,this.B_f=!1,this.B_b="",this.B_c="",this.B_d="",this.B_e="",this.A_s="",this.B_A=[],this.B9=[],this.B_D=[],this.B_E=[],this.B_F=[],this.B_G=[],this.B_H=[],this.B_M=[],this.B_N=[],this.B_I=[],this.B_J=[],this.B_K=[],this.B_L=[],this.B_O=[],this.B_P=[],this.B_B=[],this.B_C=[],this.B_Q=[],this.B_R=[],this.B_S=[],this.B_U=[],this.B_T="",this.mathDefineEanbled=!0,this.normalEnabled=!1,this.normalMapEnabled=!1,this.mapLodEnabled=!1,this.vertMatrixInverseEnabled=!1,this.fragMatrixInverseEnabled=!1,this.vtxUVTransfromEnabled=!1,this.B_g=null,this.uniform.reset()}addUniqueNSKeyString(t){this.A_s+=t}getPreCompileInfo(){let t=this.B_g;return this.B_g=null,t}useHighPrecious(){this.B8="precision highp float;"}useMediumPrecious(){this.B8="precision mediump float;"}useLowPrecious(){this.B8="precision lowp float;"}addDefine(t,e="1"){return!this.B_B.includes(t)&&(this.B_B.push(t),this.B_C.push(e),!0)}addVertLayout(t,e){this.B_D.includes(e)||(this.B_D.push(e),this.B_E.push(t))}addFragOutputHighp(t,e){this.B_G.includes(e)||(this.B_F.push("highp"),this.B_G.push(e),this.B_H.push(t))}addFragOutput(t,e){this.B_G.includes(e)||(this.B_F.push(""),this.B_G.push(e),this.B_H.push(t))}addVarying(t,e){this.B_M.includes(e)||(this.B_M.push(e),this.B_N.push(t))}addVertUniform(t,e,s=0){this.B_I.includes(e)||(s>0?this.B_I.push(e+"["+s+"]"):this.B_I.push(e),this.B_J.push(t))}addVertUniformParam(t){this.addVertUniform(t.type,t.name,t.arrayLength)}addFragUniform(t,e,s=0){this.B_K.includes(e)||(s>0?this.B_K.push(e+"["+s+"]"):this.B_K.push(e),this.B_L.push(t))}addFragUniformParam(t){this.addFragUniform(t.type,t.name,t.arrayLength)}addVertAndFragUniform(t,e,s=0){this.addVertUniform(t,e,s),this.addFragUniform(t,e,s)}addFragFunction(t){this.B_O.push(t)}addVertFunction(t){this.B_P.push(t)}useTexturePreciseHighp(){this.B_T="highp"}addTextureSample2D(t="",e=!0,s=!0,i=!1){if(""==t||!this.B_S.includes(t)){this.B_Q.push("sampler2D"),this.B_S.push(t),this.B_R.push(this.B_T);let a=0;s&&(a|=2),i&&(a|=4),this.B_U.push(a),this.B_T="",e&&(this.B_f=!0)}}addTextureSampleCube(t="",e=!0,s=!1){if(""==t||!this.B_S.includes(t)){this.B_Q.push("samplerCube"),this.B_S.push(t),this.B_R.push(this.B_T);let i=0;e&&(i|=2),s&&(i|=4),this.B_U.push(i),this.B_T=""}}addTextureSample3D(t="",e=!0,s=!1){if(""==t||!this.B_S.includes(t)){this.B_Q.push("sampler3D"),this.B_S.push(t),this.B_R.push(this.B_T);let i=0;e&&(i|=2),s&&(i|=4),this.B_U.push(i),this.B_T=""}}isHaveTexture(){return this.B_Q.length>0}isHaveTexture2D(){return this.B_f}useVertSpaceMats(t=!0,e=!0,s=!0){this.B_V=t,this.B_W=e,this.B_X=s}useFragSpaceMats(t=!0,e=!0,s=!0){this.B_Y=t,this.B_Z=e,this.B_a=s}addVertExtend(t){this.B_A.push(t)}addFragExtend(t){this.B9.push(t)}addVertHeadCode(t){""!=t&&(this.B_b+="\n"+t)}addVertMainCode(t){""!=t&&(this.B_c+="\n"+t)}addFragHeadCode(t){""!=t&&(this.B_d+="\n"+t)}addFragMainCode(t){""!=t&&(this.B_e+="\n"+t)}addShaderObject(t){this.fragHeadCodeUnlock&&this.addFragHeadCode(t.frag_head),this.fragMainCodeUnlock&&this.addFragMainCode(t.frag_body),this.vertHeadCodeUnlock&&this.addVertHeadCode(t.vert_head),this.vertMainCodeUnlock&&this.addVertMainCode(t.vert_body)}addShaderObjectHead(t){this.fragHeadCodeUnlock&&this.addFragHeadCode(t.frag_head),this.vertHeadCodeUnlock&&this.addVertMainCode(t.vert_head)}autoBuildHeadCode(){this.addVertLayout("vec3","a_vs"),(this.B_f||this.B_D.includes("a_uvs"))&&(this.addVertLayout("vec2","a_uvs"),this.addVarying("vec2","v_uv")),(this.normalEnabled||this.normalMapEnabled||this.B_D.includes("a_nvs"))&&(this.addVertLayout("vec3","a_nvs"),this.addVarying("vec3","v_worldNormal"),this.addVarying("vec3","v_worldPosition"),this.addDefine("VOX_USE_NORMAL"));let t=["a_vs","a_uvs","a_nvs"],e=[],s=[];for(;t.length>0;){let i=this.B_D.indexOf(t[0]);i>=0&&(e.push(this.B_D[i]),s.push(this.B_E[i]),this.B_D.splice(i,1),this.B_E.splice(i,1)),t.shift()}this.B_D=e.concat(this.B_D),this.B_E=s.concat(this.B_E),this.vtxUVTransfromEnabled&&this.addDefine("VOX_VTX_TRANSFORM_PARAM_INDEX","0")}buildFragCode(){this.autoBuildHeadCodeEnabled&&this.autoBuildHeadCode(),this.B_G.length<1&&this.addFragOutput("vec4","FragColor0");let t=0,e=0,s="";for((a.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED||a.default.IsMobileWeb())&&this.useHighPrecious(),a.default.IsWebGL2()&&(s+=this.B7),this.B_g=new n.default,this.B_g.info="\n//##COMPILE_INFO_BEGIN",this.B_g.info+="\n//##COMPILE_INFO_END",t=0,e=this.B9.length;t<e;t++)s+="\n"+this.B9[t];for(a.default.IsWebGL1()&&(this.B_G.length>1&&(s+="\n#extension GL_EXT_draw_buffers: require"),(this.normalMapEnabled||this.derivatives)&&(s+="\n#extension GL_OES_standard_derivatives : enable"),this.mapLodEnabled&&(s+="\n#extension GL_EXT_shader_texture_lod : enable")),a.default.IsMobileWeb()?s+="\nprecision highp float;":s+="\n"+this.B8,a.default.IsWebGL2()?(s+="\n#define VOX_GLSL_ES3 1",s+="\n#define VOX_IN in",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureLod",s+="\n#define VOX_Texture2DLod textureLod"),s+="\n#define VOX_Texture2D texture",s+="\n#define VOX_TextureCube texture"):(s+="\n#define VOX_GLSL_ES2 1",s+="\n#define VOX_IN varying",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureCubeLodEXT",s+="\n#define VOX_Texture2DLod texture2DLodEXT"),s+="\n#define VOX_TextureCube textureCube",s+="\n#define VOX_Texture2D texture2D"),this.mathDefineEanbled&&(s+=h.MathShaderCode.BasePredefined),e=this.B_B.length,t=0;t<e;t++)""!=this.B_C[t]?s+="\n#define "+this.B_B[t]+" "+this.B_C[t]:s+="\n#define "+this.B_B[t]+" 1";for(t=0,e=this.B_S.length;t<e;t++)""!=this.B_S[t]&&0!=(2&this.B_U[t])&&(s+="\n#define "+this.B_S[t]+" u_sampler"+t);for(this.B_f&&(s+="\n#define VOX_USE_2D_MAP 1"),t=0,e=this.B_Q.length;t<e;t++)0!=(2&this.B_U[t])&&(""==this.B_R[t]?s+="\nuniform "+this.B_Q[t]+" u_sampler"+t+";":s+="\nuniform "+this.B_R[t]+" "+this.B_Q[t]+" u_sampler"+t+";");for(t=0,e=this.B_L.length;t<e;t++)s+="\nuniform "+this.B_L[t]+" "+this.B_K[t]+";";if(this.B_Y&&(s+="\nuniform mat4 u_objMat;"),this.B_Z&&(s+="\nuniform mat4 u_viewMat;"),this.B_a&&(s+="\nuniform mat4 u_projMat;"),e=this.B_M.length,a.default.IsWebGL2())for(t=0;t<e;t++)s+="\nin "+this.B_N[t]+" "+this.B_M[t]+";";else for(t=0;t<e;t++)s+="\nvarying "+this.B_N[t]+" "+this.B_M[t]+";";for(s+=h.ShaderCode.BasePredefined,this.fragMatrixInverseEnabled&&a.default.IsWebGL1()&&(this.addVertFunction(r.default.__glslInverseMat3),this.addVertFunction(r.default.__glslInverseMat4)),s+=this.B_d,t=0,e=this.B_O.length;t<e;t++)s+="\n"+this.B_O[t];if(t=0,e=this.B_G.length,a.default.IsWebGL2())for(;t<e;t++)""!=this.B_F[t]?s+="\nlayout(location = "+t+") out "+this.B_F[t]+" "+this.B_H[t]+" "+this.B_G[t]+";":s+="\nlayout(location = "+t+") out "+this.B_H[t]+" "+this.B_G[t]+";";else 1==e&&(s+="\n#define "+this.B_G[t]+" gl_FragColor");let i=!1,l=this.B_e.indexOf("{");if(l>0){let t=this.B_e.slice(0,l);i=t.indexOf(" main")>0,i||(i=this.B_e.indexOf(" main")>0)}if(i?s+=this.B_e:(s+="\nvoid main() {\n",s+=this.B_e,s+="\n}\n"),e=this.B_G.length,a.default.IsWebGL1()&&e>1)for(t=0;t<e;t++){let e=new RegExp(this.B_G[t],"g");s=s.replace(e,"gl_FragData["+t+"]")}return s}buildVertCode(){let t=0,e=0,s="";for(a.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&this.useHighPrecious(),a.default.IsWebGL2()&&(s+=this.B7),t=0,e=this.B_A.length;t<e;t++)s+="\n"+this.B_A[t];for(a.default.IsMobileWeb()?s+="\nprecision highp float;":s+="\n"+this.B8,a.default.IsWebGL2()?(s+="\n#define VOX_GLSL_ES3 1",s+="\n#define VOX_IN in",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureLod",s+="\n#define VOX_Texture2DLod textureLod"),s+="\n#define VOX_Texture2D texture",s+="\n#define VOX_TextureCube texture"):(s+="\n#define VOX_GLSL_ES2 1",s+="\n#define VOX_IN varying",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureCubeLodEXT",s+="\n#define VOX_Texture2DLod texture2DLodEXT"),s+="\n#define VOX_TextureCube textureCube",s+="\n#define VOX_Texture2D texture2D"),a.default.IsWebGL2()?s+="\n#define VOX_OUT out":s+="\n#define VOX_OUT varying",this.mathDefineEanbled&&(s+=h.MathShaderCode.BasePredefined),e=this.B_B.length,t=0;t<e;t++)""!=this.B_C[t]?s+="\n#define "+this.B_B[t]+" "+this.B_C[t]:s+="\n#define "+this.B_B[t];for(t=0,e=this.B_S.length;t<e;t++)""!=this.B_S[t]&&0!=(4&this.B_U[t])&&(s+="\n#define "+this.B_S[t]+" u_sampler"+t);for(this.B_f&&(s+="\n#define VOX_USE_2D_MAP 1"),t=0,e=this.B_Q.length;t<e;t++)0!=(4&this.B_U[t])&&(""==this.B_R[t]?s+="\nuniform "+this.B_Q[t]+" u_sampler"+t+";":s+="\nuniform "+this.B_R[t]+" "+this.B_Q[t]+" u_sampler"+t+";");if(e=this.B_D.length,a.default.IsWebGL2())for(t=0;t<e;t++)s+="\nlayout(location = "+t+") in "+this.B_E[t]+" "+this.B_D[t]+";";else for(t=0;t<e;t++)s+="\nattribute "+this.B_E[t]+" "+this.B_D[t]+";";for(e=this.B_J.length,t=0;t<e;t++)s+="\nuniform "+this.B_J[t]+" "+this.B_I[t]+";";if(this.B_V&&(s+="\nuniform mat4 u_objMat;"),this.B_W&&(s+="\nuniform mat4 u_viewMat;"),this.B_X&&(s+="\nuniform mat4 u_projMat;"),e=this.B_M.length,a.default.IsWebGL2())for(t=0;t<e;t++)s+="\nout "+this.B_N[t]+" "+this.B_M[t]+";";else for(t=0;t<e;t++)s+="\nvarying "+this.B_N[t]+" "+this.B_M[t]+";";for(s+=h.ShaderCode.BasePredefined,s+=h.ShaderCode.VertPredefined,this.vertMatrixInverseEnabled&&a.default.IsWebGL1()&&(this.addVertFunction(r.default.__glslInverseMat3),this.addVertFunction(r.default.__glslInverseMat4)),s+=this.B_b,t=0,e=this.B_P.length;t<e;t++)s+="\n"+this.B_P[t];let i=!1,n=this.B_c.indexOf("{");if(n>0){let t=this.B_c.slice(0,n);i=t.indexOf(" main")>0,i||(i=this.B_c.indexOf(" main")>0)}return i?s+=this.B_c:(s+="\nvoid main() {\n",s+=this.B_c,s+="\n}\n"),s}}e.default=l},"4cf7":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98");class a{constructor(){this.B_h=[],this.B_i=[],this.B_j=[],this.B_k=[]}addTexture(t){switch(t.getType()){case i.TextureProxyType.Image:this.B_h.push(t);break;case i.TextureProxyType.Bytes:this.B_i.push(t);break;case i.TextureProxyType.Float:this.B_j.push(t);break;case i.TextureProxyType.Wrapper:this.B_k.push(t);break;default:break}}getTexture(t){switch(t){case i.TextureProxyType.Image:if(this.B_h.length>0)return this.B_h.pop();break;case i.TextureProxyType.Bytes:if(this.B_i.length>0)return this.B_i.pop();break;case i.TextureProxyType.Float:if(this.B_j.length>0)return this.B_j.pop();break;case i.TextureProxyType.Wrapper:if(this.B_k.length>0)return this.B_k.pop();break;default:break}return null}}e.TexturePool=a,e.default=a},"4df3":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("b4ea");e.IShaderLibConfigure=a.IShaderLibConfigure,e.ShaderCodeType=a.ShaderCodeType,e.ShaderCodeUUID=a.ShaderCodeUUID,e.ShaderCodeConfigure=a.ShaderCodeConfigure,e.IShaderLibListener=a.IShaderLibListener,e.MaterialContext=a.MaterialContext,e.MaterialContextParam=a.MaterialContextParam;const r=i(s("b409")),n=i(s("cf91")),h=i(s("1ea6")),l=i(s("f63e")),o=s("debe"),_=s("3d98");class m extends a.MaterialContext{constructor(){super(),this.B_l=null,this.B_m=null,this.lambertPipeline=null,this.pbrPipeline=null}createDefaultMaterial(t,e=!0){let s=new l.default;if(s.setMaterialPipeline(this.pipeline),s.setTextureList(t),e){let e=null!=t&&t.length>0&&null!=t[0];s.initializeByCodeBuf(e)}return s}createLambertLightMaterial(t=!1){let e=new r.default;return e.setMaterialPipeline(this.lambertPipeline),t&&(e.vertUniform=new o.VertUniformComp),e}createPBRLightMaterial(t=!0,e=!1,s=!1){let i=new n.default;if(i.setMaterialPipeline(this.pbrPipeline),t&&(i.decorator=new h.default),e&&(i.vertUniform=new o.VertUniformComp),null!=i.decorator&&s){if(i.decorator.hdrBrnEnabled=!0,null==this.B_m){let t="static/bytes/spe.mdf";i.decorator.hdrBrnEnabled&&(t="static/bytes/speBrn.bin"),this.B_l=new _.SpecularTextureLoader,this.B_l.hdrBrnEnabled=i.decorator.hdrBrnEnabled,this.B_l.loadTextureWithUrl(t,this.Al),this.B_m=this.B_l.texture,this.B_m.__$attachThis()}i.decorator.specularEnvMap=this.B_m}return i}initialize(t,e=null,s=null){null==this.Al&&(s=this.buildConfigure(e,s),super.initialize(t,e,s))}buildConfigure(t,e){if(null==e){let s=this.createShaderLibConfig(),i=null;null==t&&(t=new a.MaterialContextParam),t.loadAllShaderCode=!0;let r="static/shader/"+(null!=t.shaderLibVersion?t.shaderLibVersion+"/":"");t.loadAllShaderCode&&(t.lambertMaterialEnabled&&(i=new a.ShaderCodeConfigure,i.buildBinaryFile=t.buildBinaryFile,i.uuid=a.ShaderCodeUUID.Lambert,i.types=[a.ShaderCodeType.VertHead,a.ShaderCodeType.VertBody,a.ShaderCodeType.FragHead,a.ShaderCodeType.FragBody],t.shaderCodeBinary&&t.shaderFileRename&&(i.urls=[r+"glsl/lambert/glsl01.bin",r+"glsl/lambert/glsl02.bin",r+"glsl/lambert/glsl03.bin",r+"glsl/lambert/glsl04.bin"]),i.binary=t.shaderCodeBinary,s.shaderCodeConfigures.push(i)),t.pbrMaterialEnabled&&(i=new a.ShaderCodeConfigure,i.buildBinaryFile=t.buildBinaryFile,i.uuid=a.ShaderCodeUUID.PBR,i.types=[a.ShaderCodeType.VertHead,a.ShaderCodeType.VertBody,a.ShaderCodeType.FragHead,a.ShaderCodeType.FragBody],t.shaderCodeBinary&&(t.shaderFileRename&&(i.urls=[r+"glsl/pbr/glsl01.bin",r+"glsl/pbr/glsl02.bin",r+"glsl/pbr/glsl03.bin",r+"glsl/pbr/glsl04.bin"]),i.binary=t.shaderCodeBinary),s.shaderCodeConfigures.push(i))),e=s}return e}initEnd(t){let e=this;null==this.pbrPipeline&&(e.pbrPipeline=this.createPipeline()),null==this.lambertPipeline&&(e.lambertPipeline=this.createPipeline()),this.pbrPipeline.uuid="pbr",this.lambertPipeline.uuid="lambert",super.initEnd(t)}}e.CommonMaterialContext=m},"4f27":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("3b73")),r=s("d53d"),n=i(s("2560")),h=i(s("83d1")),l=i(s("a7ed")),o=i(s("857b")),_=i(s("e87b"));class m extends r.ShaderUniform{use(t){}useByLocation(t,e,s,i){}useByShd(t,e){}updateData(){}destroy(){}}m.EmptyUniform=new m;class u{static appendUniformBuilder(t){u.GP.has(t.getIDNS())||(u.GQ.push(t),u.GP.set(t.getIDNS(),t),u.GR=u.GQ.length)}static Initialize(){u.F_1&&(u.F_1=!1,u.appendUniformBuilder(new n.default),u.appendUniformBuilder(new l.default),u.appendUniformBuilder(new o.default),u.appendUniformBuilder(new h.default),u.appendUniformBuilder(new _.default))}static AddSharedUniformBuilder(t){null==t||u.GP.has(t.getIDNS())||(u.GQ.push(t),u.GP.set(t.getIDNS(),t),++u.GR)}static removeSharedUniformBuilder(t){if(null!=t&&u.GP.has(t.getIDNS())){for(let e=0;e<u.GR;++e)if(t==u.GQ[e]){u.GQ.splice(e,1),--u.GR;break}u.GP.delete(t.getIDNS())}}static removeSharedUniformBuilderByName(t){if(u.GP.has(t)){let e=u.GP.get(t);for(let t=0;t<u.GR;++t)if(e==u.GQ[t]){u.GQ.splice(t,1),--u.GR;break}u.GP.delete(t)}}static BuildShared(t,e,s){let i,a=null,r=null,n=u.GQ,h=0,l=u.GR,o=null;for(;h<l;++h)o=n[h].create(e,s),null!=o&&(null!=r?r.next=o:null==a&&(a=o),r=o);if(null==t)i=a;else if(null!=a){for(let e=0;e<t.length;++e)r.next=t[e],r=r.next;i=a}if(null==i)i=m.EmptyUniform;else{let t=i,e=0;while(null!=t){if(null!=t.uniformNameList&&null==t.locations)for(t.types=[],t.locations=[],t.uniformSize=t.uniformNameList.length,e=0;e<t.uniformSize;++e)t.types.push(s.getUniformTypeByNS(t.uniformNameList[e])),t.locations.push(s.getUniformLocationByNS(t.uniformNameList[e]));t=t.next}}return i}static BuildLocalFromTransformV(t,e){if(null!=t){let s;return s=new r.ShaderMat4Uniform,s.uniformSize=0,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize+=1,s.uniformNameList.push("u_objMat"),s.types.push(e.getUniformTypeByNS("u_objMat")),s.locations.push(e.getUniformLocationByNS("u_objMat")),s.dataList.push(t),s.dataSizeList.push(1),s}return u.GS}static UpdateLocalFromTransformV(t,e,s){if(null!=e){let i,a=t;return null==a?(a=new r.ShaderMat4Uniform,i=a,i.uniformSize=0,i.uniformNameList=[],i.types=[],i.locations=[],i.dataList=[],i.dataSizeList=[],i.uniformSize+=1,i.uniformNameList.push("u_objMat"),i.types.push(s.getUniformTypeByNS("u_objMat")),i.locations.push(s.getUniformLocationByNS("u_objMat")),i.dataList.push(e),i.dataSizeList.push(1)):(i=a,i.locations=[],i.locations.push(s.getUniformLocationByNS("u_objMat"))),i}return u.GS}static BuildLocalFromData(t,e){if(null!=t){let s;s=a.default.IsWebGL1()?new r.ShaderUniformV1:new r.ShaderUniformV2,s.uns=t.uns,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize=0;let i=t,n=0;while(null!=i){if(null!=i.uniformNameList&&null==i.locations)for(s.uniformSize+=i.uniformNameList.length,n=0;n<s.uniformSize;++n)s.uniformNameList.push(i.uniformNameList[n]),s.types.push(e.getUniformTypeByNS(i.uniformNameList[n])),s.locations.push(e.getUniformLocationByNS(i.uniformNameList[n])),s.dataList.push(i.dataList[n]),s.dataSizeList.push(e.getUniformLengthByNS(i.uniformNameList[n]));i=i.next}return s}return m.EmptyUniform}static BuildLocal(t,e){let s=new r.ShaderUniform;s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize=0;let i=t,a=0;while(null!=i){if(null!=i.uniformNameList&&null==i.locations)for(s.uniformSize+=i.uniformNameList.length,a=0;a<s.uniformSize;++a)s.uniformNameList.push(i.uniformNameList[a]),s.types.push(e.getUniformTypeByNS(i.uniformNameList[a])),s.locations.push(e.getUniformLocationByNS(i.uniformNameList[a])),s.dataList.push(i.dataList[a]),s.dataSizeList.push(e.getUniformLengthByNS(i.uniformNameList[a]));i=i.next}return s}}u.F_1=!0,u.GP=new Map,u.GQ=[],u.GR=0,u.GS=new r.ShaderUniform,e.default=u},5216:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["ENV_LIGHT_PARAM"]=0]="ENV_LIGHT_PARAM",t[t["ENV_AMBIENT_LIGHT"]=1]="ENV_AMBIENT_LIGHT",t[t["FOG"]=2]="FOG",t[t["FOG_EXP2"]=3]="FOG_EXP2",t[t["VSM_SHADOW"]=4]="VSM_SHADOW",t[t["GLOBAL_LIGHT"]=5]="GLOBAL_LIGHT"}(i||(i={})),e.MaterialPipeType=i},5282:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t=0,e=0,s=0,i=0){this.x=0,this.y=0,this.z=0,this.u=0,this.v=1,this.nx=0,this.ny=0,this.nz=0,this.index=0,this.x=t,this.y=e,this.z=s,this.index=i}cloneVertex(){let t=new i(this.x,this.y,this.z,this.index);return t.nx=this.nx,t.ny=this.ny,t.nz=this.nz,t.u=this.u,t.v=this.v,t}copyFrom(t){this.x=t.x,this.y=t.y,this.z=t.z,this.u=t.u,this.v=t.v,this.nx=t.nx,this.ny=t.ny,this.nz=t.nz,this.index=t.index}}e.default=i},"52e0":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("8d98"),r=i(s("0851"));class n extends r.default{constructor(t,e){super(t,e,!1),this.B_n=null,this.k=a.TextureTarget.TEXTURE_CUBE,this.mipmapEnabled=!0,this.n=a.TextureProxyType.BytesCube}toAlphaFormat(){this.srcFormat=a.TextureFormat.ALPHA,this.internalFormat=a.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=a.TextureFormat.RED,this.internalFormat=a.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=a.TextureFormat.RGB,this.internalFormat=a.TextureFormat.RGB,this.unpackAlignment=1}toRGBAFormat(){this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA,this.unpackAlignment=4}setDataFromBytesToFaceAt(t,e,s,i,a=0){if(null==this.B_n&&(this.B_n=[null,null,null,null,null,null]),s>0&&i>0){0==t&&a<1&&(this.g=s,this.h=i,this.f=a),null==this.B_n[t]&&(this.B_n[t]=new Array(16));let r=this.B_n[t];r[a]={width:s,height:i,imgData:e,miplevel:a},this.m=null!=r[a].imgData}}uploadData(t){let e,s,i=t.getRC(),r=null,n=this.getWidth(),h=this.getHeight();for(let l=0;l<6;++l){let t=this.B_n[l];if(this.mipmapEnabled&&this.o)r=t[0],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,a.TextureFormat.ToGL(i,this.internalFormat),n,h,0,a.TextureFormat.ToGL(i,this.srcFormat),a.TextureDataType.ToGL(i,this.dataType),r.imgData);else{e=n,s=h;let o=0;for(;e>0||s>0;)null!=t[o]&&(r=t[o],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,o,a.TextureFormat.ToGL(i,this.internalFormat),e,s,0,a.TextureFormat.ToGL(i,this.srcFormat),a.TextureDataType.ToGL(i,this.dataType),r.imgData)),e>0&&(e>>=1),s>0&&(s>>=1),++o}}this.version=0}toString(){return"[BytesCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.B_n)for(let t=0;t<6;++t)null!=this.B_n[t]&&(this.B_n[t].imgData=null);super.__$destroy()}}}e.default=n},5326:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.B_o=256,this.T=0,this.index=0,this.dataList=[],this.flagList=null,this.T=t}getUid(){return this.T}static GetSlotAt(t){return i.GT[t]}static Initialize(t){let e=i.GT[t];if(null==e&&(e=new i(t),i.GT[t]=e),null==e.flagList){e.flagList=new Uint16Array(e.B_o);for(let t=0;t<e.B_o;++t)e.dataList.push(null),e.flagList[t]=0}}}i.GT=new Array(16),e.default=i},5336:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.B_p=0,this.B_q=60,this.B_r=null,this.B_s=null,this.B_t=10,this.B_u=128,this.B_v=128,this.B_w=70,this.delayTime=40,this.statusInfo="",this.statusEnbled=!0}initialize(){var t=null;try{void 0!=document&&(t=document)}catch(e){}if(null!=t){this.B_u=window.innerWidth;let t=this.B_u-20;this.createCanvas(t)}}createCanvas(t){null==this.B_r&&(this.B_r=document.createElement("canvas"),document.body.appendChild(this.B_r),this.B_r.style.display="bolck",this.B_r.style.left="0px",this.B_r.style.top="0px",this.B_r.style.position="absolute",this.B_r.style.backgroundColor="transparent",this.B_r.style.pointerEvents="none",this.B_r.height=this.B_w),t=t<10?10:t,this.B_r.width=t,this.B_s=this.B_r.getContext("2d"),this.B_s.font="50px Verdana",this.B_s.fillStyle="red",this.B_s.textAlign="left",this.B_v=this.B_r.width}getFPS(){return this.B_q}getFPSStr(){return this.B_q>60?"FPS: 60":this.B_q<10?"FPS: 0"+this.B_q:"FPS: "+this.B_q}render(){if(this.B_u!=window.innerWidth){this.B_u=window.innerWidth;let t=this.B_u-20;this.createCanvas(t)}this.statusEnbled&&(this.B_s.clearRect(0,0,this.B_v,this.B_w),this.B_s.fillText("FPS:"+this.B_q+this.statusInfo,5,50))}update(t=!0){if(this.B_t>0)--this.B_t,this.B_p=Date.now();else{if(null!=this.B_s){let e=Date.now();this.B_p>0&&(this.B_p=e-this.B_p,this.B_q=Math.round(1e3/this.B_p),t&&this.render()),this.B_p=e}this.B_t=this.delayTime}}}e.default=i},"53ea":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17")),r=i(s("e214"));class n{constructor(){this.A_i=null,this.y=null,this.B_x=new a.default,this.B_y=new a.default,this.B_z=new a.default(0,1,0),this.B_0=0,this.position=new a.default}bindCameraAndStage(t,e){this.A_i=t,this.y=e}setPlaneParam(t,e){this.B_z.copyFrom(t),this.B_z.normalize(),this.B_0=e}intersectPlane(){null!=this.A_i&&null!=this.y&&(this.A_i.update(),this.A_i.getWorldPickingRayByScreenXY(this.y.mouseX,this.y.mouseY,this.B_x,this.B_y),r.default.IntersectionSLV2(this.B_z,this.B_0,this.B_x,this.B_y,this.position))}destroy(){this.A_i=null,this.y=null}}e.default=n},"557f":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("8d98"),r=i(s("0851"));class n extends r.default{constructor(t,e,s=1,i=!1){super(t,e,i),this.B_1=null,this.B_2=1,this.internalFormat=a.TextureFormat.R8,this.srcFormat=a.TextureFormat.RED,this.B_2=s,this.k=a.TextureTarget.TEXTURE_3D,this.n=a.TextureProxyType.Texture3D,this.unpackAlignment=1}getDepth(){return this.B_2}uploadFromTypedArray(t,e=0){this.isGpuEnabled()||(this.B_1=t,this.f=e,this.m=!0)}uploadData(t){if(null!=this.B_1){let e=t.getRC();e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage3D(e.TEXTURE_3D,0,a.TextureFormat.ToGL(e,this.internalFormat),this.g,this.h,this.B_2,0,a.TextureFormat.ToGL(e,this.srcFormat),e.UNSIGNED_BYTE,this.B_1),e.pixelStorei(e.UNPACK_ALIGNMENT,4)}}__$destroy(){this.getAttachCount()<1&&(this.B_1=null,super.__$destroy())}toString(){return"[Texture3DProxy(width="+this.getWidth()+",height="+this.getHeight()+",depth="+this.getDepth()+")]"}}e.default=n},"56c5":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("030e"));class r{static SetRenderer(t){r.Aj=t.getRC(),r.B_3=t.getWebGLVersion();let e=r;1==r.B_3&&null!=a.default.WEBGL_draw_buffers?e.COLOR_ATTACHMENT0=a.default.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL:e.COLOR_ATTACHMENT0=r.Aj.COLOR_ATTACHMENT0}static DrawBuffers(t){2==r.B_3?r.Aj.drawBuffers(t):null!=a.default.WEBGL_draw_buffers&&a.default.WEBGL_draw_buffers.drawBuffersWEBGL(t)}}r.Aj=null,r.B_3=2,r.COLOR_ATTACHMENT0=0,e.default=r},"5d04":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("8d98"),r=i(s("4cf7")),n=i(s("5e78")),h=i(s("fe7f")),l=i(s("9f3e")),o=i(s("f928")),_=i(s("eaee")),m=i(s("52e0")),u=i(s("d314")),d=i(s("557f")),c=i(s("cfaf")),f=i(s("85b6")),p=i(s("da6a")),g=i(s("ccdf"));class v{constructor(){this.B_4=new r.default,this.B_5=null,this.B_6=null,this.B_7=[],this.B_8=128}addTexLoader(t){if(null!=t){let e=0,s=this.B_7.length;for(;e<s;++e)if(t==this.B_7[e])break;e>=s&&this.B_7.push(t)}}removeTexLoader(t){if(null!=t){let e=0,s=this.B_7.length;for(;e<s;++e)if(t==this.B_7[e]){this.B_7.slice(e,1);break}}}setRenderer(t){this.B_6=t,p.default.GetInstance().setRenderProxy(t.getRenderProxy()),null==this.B_5&&null!=t&&(this.B_5=new g.default(t.getRenderProxy()))}getRTTStrore(){return this.B_5}createWrapperTex(t,e,s=!1){let i=new f.default(t,e,s);return i.__$setRenderProxy(this.B_6.getRenderProxy()),i}createRTTTex2D(t,e,s=!1){let i=new c.default(t,e,s);return i.__$setRenderProxy(this.B_6.getRenderProxy()),i}createImageTex2D(t,e,s=!1){let i=this.B_4.getTexture(a.TextureProxyType.Image);return null==i&&(i=new n.default(t,e,s)),i.__$setRenderProxy(this.B_6.getRenderProxy()),i.mipmapEnabled=!0,i.setWrap(a.TextureConst.WRAP_REPEAT),i}createHalfFloatTex2D(t,e,s=!1){let i=this.B_4.getTexture(a.TextureProxyType.Float);return null==i&&(i=new o.default(t,e,s)),i.__$setRenderProxy(this.B_6.getRenderProxy()),i.srcFormat=a.TextureFormat.RGBA,i.dataType=a.TextureDataType.HALF_FLOAT_OES,i}createFloatTex2D(t,e,s=!1){let i=this.B_4.getTexture(a.TextureProxyType.Float);return null==i&&(i=new o.default(t,e,s)),i.__$setRenderProxy(this.B_6.getRenderProxy()),i}createUint16Tex2D(t,e,s=!1){return new l.default(t,e,s)}createFloatCubeTex(t,e,s=!1){return new _.default(t,e)}createBytesTex(t,e){let s=this.B_4.getTexture(a.TextureProxyType.Bytes);return null==s&&(s=new h.default(t,e)),s.__$setRenderProxy(this.B_6.getRenderProxy()),s}createBytesCubeTex(t,e){let s=new m.default(t,e);return s.__$setRenderProxy(this.B_6.getRenderProxy()),s}createImageCubeTex(t,e){let s=new u.default(t,e);return s.__$setRenderProxy(this.B_6.getRenderProxy()),s}createTex3D(t,e,s=1){s<1&&(s=1);let i=new d.default(t,e,s);return i.__$setRenderProxy(this.B_6.getRenderProxy()),i}createRGBATex2D(t,e,s){t=t>1?t:1,e=e>1?e:1;let i=t*e,a=this.createBytesTex(t,e),r=new Uint8Array(4*i),n=Math.round(255*s.r),h=Math.round(255*s.g),l=Math.round(255*s.b),o=Math.round(255*s.a),_=0,m=[n,h,l,o];for(let u=0;u<i;++u)r.set(m,_),_+=4;return a.setDataFromBytes(r,0,t,e),a.__$setRenderProxy(this.B_6.getRenderProxy()),a}createAlphaTex2D(t,e,s){t=t>1?t:1,e=e>1?e:1;let i=t*e,a=this.createBytesTex(t,e);a.toAlphaFormat();let r=new Uint8Array(i),n=Math.round(255*s);return r.fill(n,0,i),a.setDataFromBytes(r,0,t,e),a.__$setRenderProxy(this.B_6.getRenderProxy()),a}createAlphaTexBytes2D(t,e,s){let i=this.createBytesTex(t,e);return i.setDataFromBytes(s,0,t,e),i.toAlphaFormat(),i.__$setRenderProxy(this.B_6.getRenderProxy()),i}getCubeRTTTextureAt(t){return this.B_5.getCubeRTTTextureAt(t)}createCubeRTTTextureAt(t,e,s){return this.B_5.createCubeRTTTextureAt(t,e,s)}getRTTTextureAt(t){return this.B_5.getRTTTextureAt(t)}createRTTTextureAt(t,e,s){return this.B_5.createRTTTextureAt(t,e,s)}getDepthTextureAt(t){return this.B_5.getDepthTextureAt(t)}createDepthTextureAt(t,e,s){return this.B_5.createDepthTextureAt(t,e,s)}getRTTFloatTextureAt(t){return this.B_5.getRTTFloatTextureAt(t)}createRTTFloatTextureAt(t,e,s){return this.B_5.createRTTFloatTextureAt(t,e,s)}run(){let t=0,e=this.B_7.length;for(;t<e;++t)this.B_7[t].run();if(this.B_8<1){let t;this.B_8=128;let e=p.default.GetInstance().getFreeResUidMap(),s=32;for(const[i,a]of e){if(s<1)break;s--,a>2?(e.delete(i),t=p.default.GetInstance().removeTextureByUid(i),null!=t&&this.B_4.addTexture(t)):e.set(i,a+1)}}this.B_8--}}e.TextureBlock=v,e.default=v},"5e78":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("8d98"),r=i(s("7181")),n=i(s("0851"));class h extends n.default{constructor(t,e,s=!1){super(t,e,s),this.B_9=null,this.B_=null,this.CA=0,this.mipmapEnabled=!0,this.minFilter=a.TextureConst.LINEAR_MIPMAP_LINEAR,this.n=a.TextureProxyType.Image}getTexData(){return this.B_9}setDataFromImage(t,e=0,s=0,i=0,a=!1){if(null!=t&&t.width>0&&t.height>0){this.m=!0,e<0&&(e=0),e>15&&(e=15),e>=this.CA&&(this.CA=e+1);let n=this.B_9;null!=n?this.B_9.miplevel!=e?(null==this.B_&&(this.B_=[this.B_9,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),n=this.B_[e],null==n&&(n=r.default.Create(),n.miplevel=e,a=!0,this.B_[e]=n)):this.isGpuEnabled()&&(n.status=0):(n=this.B_9=r.default.Create(),n.miplevel=e,a=!0,this.g=t.width,this.h=t.height),n.data==t&&n.offsetx==s&&n.offsety==i||(0==e&&(this.g=t.width,this.h=t.height),n.data=t,n.status=0,(n.width<t.width||n.height<t.height||a)&&(n.width=t.width,n.height=t.height,n.status=1),n.offsetx=s,n.offsety=i),this.version++}}uploadData(t){null!=this.B_9&&this.dataUploadToGpu(t.getRC(),this.B_9,this.B_,!0),this.version=0}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())&&null!=this.B_9){let e=t.getRC();this.__$updateToGpuBegin(t),this.dataUploadToGpu(e,this.B_9,this.B_),this.__$buildParam(e),this.o=!0}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.B_){for(let t=0;t<this.CA;++t)r.default.Restore(this.B_[t]);this.CA=0,this.B_=null,this.B_9=null}null!=this.B_9&&(r.default.Restore(this.B_9),this.B_9=null),super.__$destroy()}}toString(){return"[ImageTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=h},"5f3c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("3b73")),r=i(s("df9d")),n=s("7c63");class h{constructor(t){this.T=-1,this.CB=new r.default,this.A_e=null,this.index=-1,this.shdUid=-1,this.procuid=-1,this.batchEnabled=!0,this.fixedState=!0,this.runMode=0,this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null,this.A_e=t,this.T=h.F_j++}showInfo(){this.CB.showInfo()}addNode(t){this.CB.addNodeAndSort(t)}rejoinNode(t){this.CB.containsNode(t)&&(this.CB.removeNodeAndSort(t),this.CB.addNodeAndSort(t))}removeNode(t){this.CB.removeNodeAndSort(t)}isEmpty(){return null==this.CB.getBegin()}run(t){switch(this.runMode){case 2:this.run2(t);break;case 1:this.run1(t);break;case 0:this.run0(t);break;default:break}}run0(t){let e=this.CB.getBegin();if(null!=e){this.A_e.bindToGpu(this.shdUid),this.A_e.resetUniform();let s=null;while(null!=e)e.drawEnabled&&(s=e.unit,s.drawEnabled&&(s.run(t),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}run1(t){let e=this.CB.getBegin();if(null!=e){this.A_e.bindToGpu(this.shdUid),this.A_e.resetUniform();let s=null,i=this.CB.getVtxTotalAt(e.rvroI),a=this.CB.getTexTotalAt(e.rtroI),r=i>0,n=a>0;while(null!=e)i<1&&(i=this.CB.getVtxTotalAt(e.rvroI),r=!0),i--,a<1&&(a=this.CB.getTexTotalAt(e.rtroI),n=!0),a--,e.drawEnabled&&(s=e.unit,s.drawEnabled&&(r&&(e.vro.run(),r=!1),n&&(e.tro.run(),n=!1),s.run2(t),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}run2(t){let e=this.CB.getBegin();if(null!=e){this.A_e.bindToGpu(this.shdUid),this.A_e.resetUniform();let s=null;n.RenderStateObject.UseRenderState(e.unit.renderState),n.RenderColorMask.UseRenderState(e.unit.rcolorMask);let i=this.CB.getVtxTotalAt(e.rvroI),a=this.CB.getTexTotalAt(e.rtroI),r=i>0,h=a>0;while(null!=e)i<0&&(i=this.CB.getVtxTotalAt(e.rvroI),r=!0),i--,a<0&&(a=this.CB.getTexTotalAt(e.rtroI),h=!0),a--,e.drawEnabled&&(s=e.unit,s.drawEnabled&&(r&&(e.vro.run(),r=!1),h&&(e.tro.run(),h=!1),null!=s.ubo&&s.ubo.run(t),this.A_e.useTransUniform(s.transUniform),this.A_e.useUniform(s.uniform),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}runLockMaterial(t){let e=this.CB.getBegin();if(null!=e){this.A_e.bindToGpu(this.shdUid),this.A_e.resetUniform();let s=this.A_e.isTextureUnLocked();t.Texture.unlocked=s;let i=null;if(this.batchEnabled){let a=this.CB.getVtxTotalAt(e.rvroI),r=a>0;while(null!=e)a<1&&(a=this.CB.getVtxTotalAt(e.rvroI),r=!0),a--,i=e.unit,e.drawEnabled&&i.drawEnabled&&(r&&(e.vro.run(),r=!1),s&&e.tro.run(),i.runLockMaterial2(null),i.partTotal<1?i.drawThis(t):i.drawPart(t)),e=e.next}else while(null!=e)i=e.unit,e.drawEnabled&&i.drawEnabled&&(i.runLockMaterial(),s&&e.tro.run(),i.partTotal<1?i.drawThis(t):i.drawPart(t)),e=e.next;t.Texture.unlocked=!1}}drawUnit(t,e,s){e.drawEnabled&&(this.A_e.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t))}drawLockMaterialByUnit(t,e,s,i,r){if(e.drawEnabled){if(r&&this.A_e.resetUniform(),a.default.IsMobileWeb()){let t=this.vtxResource.getVROByResUid(s.vbuf.getUid(),this.A_e.getCurrentShd(),!0);t.run()}else e.vro.run();e.runLockMaterial2(i?this.A_e.__$globalUniform:null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}}reset(){let t=this.CB.getBegin(),e=null;if(null!=t){let s;while(null!=t)e=t,t=t.next,this.rpoUnitBuilder.setRPNodeParam(e.__$ruid,this.procuid,-1),e.reset(),s=e.unit,this.rpoNodeBuilder.restore(e)&&this.rpoUnitBuilder.restore(s)}this.index=-1,this.shdUid=-1,this.procuid=-1,this.CB.clear(),this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null}destroy(){this.reset()}getUid(){return this.T}toString(){return"[RPOBlock(uid = "+this.T+", index = "+this.index+", shdUid = "+this.shdUid+")]"}}h.F_j=0,e.default=h},6098:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("6e01")),r=i(s("faa5")),n=i(s("b3bd")),h=i(s("0fc4")),l=i(s("c217")),o=s("5216");class _ extends r.default{constructor(){super(),this.billFS=new l.default,this.Ak="",this.rotationEnabled=!1,this.brightnessEnabled=!1}initialize(t){super.initialize(t),this.Ak="BillboardShader",this.rotationEnabled&&(this.Ak+="Rot"),this.Ak+=this.brightnessEnabled?"Brn":"Alp"}buildShader(){let t=this.A_R;if(this.rotationEnabled&&t.addDefine("VOX_ROTATION","1"),this.brightnessEnabled){let t=this.fogEnabled;null!=this.pipeline&&(t=t||this.pipeline.hasPipeByType(o.MaterialPipeType.FOG_EXP2),t=t||this.pipeline.hasPipeByType(o.MaterialPipeType.FOG)),this.brightnessOverlayEnabeld=t}this.A_S.addDiffuseMap(),t.addVertLayout("vec2","a_vs"),t.addVertLayout("vec2","a_uvs"),t.addVarying("vec4","v_colorMult"),t.addVarying("vec4","v_colorOffset"),t.addVarying("vec2","v_uv"),t.addVertUniform("vec4","u_billParam",3),t.addDefine("FADE_VAR","fv4");let e="\n    vec4 color = VOX_Texture2D(VOX_DIFFUSE_MAP, v_uv);\n    vec3 offsetColor = v_colorOffset.rgb;\n    vec4 fv4 = v_colorMult.wwww;\n",s=this.billFS.getBrnAndAlphaCode(),i="\n    FragColor0 = color;\n";t.addFragMainCode(e+s+i),t.addVertMainCode("\n    vec4 temp = u_billParam[0];\n    float cosv = cos(temp.z);\n    float sinv = sin(temp.z);\n    vec2 vtx = a_vs.xy * temp.xy;\n    vec2 vtx_pos = vec2(vtx.x * cosv - vtx.y * sinv, vtx.x * sinv + vtx.y * cosv);\n    viewPosition = u_viewMat * u_objMat * vec4(0.0,0.0,0.0,1.0);\n    viewPosition.xy += vtx_pos.xy;\n    gl_Position =  u_projMat * viewPosition;\n    gl_Position.z = ((gl_Position.z / gl_Position.w) + temp.w) * gl_Position.w;\n    v_uv = a_uvs;\n    v_colorMult = u_billParam[1];\n    v_colorOffset = u_billParam[2];\n")}getUniqueShaderName(){return this.Ak+"_"+this.billFS.getBrnAlphaStatus()}toString(){return"[BillboardShaderBuffer()]"}static GetInstance(){return null!=_.F_0||(_.F_0=new _),_.F_0}}_.F_0=new _;class m extends h.default{constructor(t=!0,e=!1,s=!1){super(),this.A_T=!0,this.A_U=!1,this.CC=!1,this.CD=0,this.A_X=new Float32Array([1,1,0,0,1,1,1,1,0,0,0,0]),this.A_T=t,this.A_U=e,this.CC=s}buildBuf(){let t=_.GetInstance();t.rotationEnabled=this.CC,t.brightnessEnabled=this.A_T,t.billFS.setBrightnessAndAlpha(this.A_T,this.A_U)}getCodeBuf(){return _.GetInstance()}createSelfUniformData(){let t=new n.default;return t.uniformNameList=["u_billParam"],t.dataList=[this.A_X],t}setRGBA4f(t,e,s,i){this.A_X[4]=t,this.A_X[5]=e,this.A_X[6]=s,this.A_X[7]=i}setRGB3f(t,e,s){this.A_X[4]=t,this.A_X[5]=e,this.A_X[6]=s}setFadeFactor(t){this.A_X[7]=t}getFadeFactor(){return this.A_X[7]}setRGBAOffset4f(t,e,s,i){this.A_X[8]=t,this.A_X[9]=e,this.A_X[10]=s,this.A_X[11]=i}setRGBOffset3f(t,e,s){this.A_X[8]=t,this.A_X[9]=e,this.A_X[10]=s}getRotationZ(){return this.CD}setRotationZ(t){this.CD=t,this.A_X[2]=t*a.default.MATH_PI_OVER_180}getScaleX(){return this.A_X[0]}getScaleY(){return this.A_X[1]}setScaleX(t){this.A_X[0]=t}setScaleY(t){this.A_X[1]=t}setScaleXY(t,e){this.A_X[0]=t,this.A_X[1]=e}setDepthOffset(t){this.A_X[3]=t}getUniformData(){return this.A_X}destroy(){super.destroy(),this.A_X=null}}e.default=m},"61d7":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8ae0");class a{constructor(t,e){this.T=0,this.CE=null,this.CF=new Map,this.CG=new i.TexArea,this.CH=2,this.CI=32,this.B_v=32,this.B_w=32,this.CJ=!1,t<128&&(t=128),e<128&&(e=128),this.B_v=t,this.B_w=e,this.CE=new i.TexAreaNode(0,0,t,e),this.T=a.F_j++}getUid(){return this.T}getWidth(){return this.B_v}getHeight(){return this.B_w}setMinSize(t){this.CI=Math.max(t,4)}getAreaByName(t){return this.CF.has(t)?this.CF.get(t):null}getTexAreaByXY(t,e){let s=this.CE.findByXY(t,e);return null!=s&&this.CF.has(s.uniqueNS)?this.CF.get(s.uniqueNS):null}addSubTexArea(t,e,s){if(this.CF.has(t))return this.CF.get(t);{let a=this.CG;a.offset=this.CH,a.minSize=this.CI,a.uniqueNS=t,a.rect.width=e+2*a.offset,a.rect.height=s+2*a.offset;let r=this.CE.addTexArea(a);if(r){a=new i.TexArea,a.copyFrom(this.CG),this.CF.set(t,a),a.atlasUid=this.T;let e=a.rect,s=a.texRect;s.copyFrom(e),s.x+=a.offset,s.y+=a.offset,s.width-=2*a.offset,s.height-=2*a.offset,s.flipY(this.B_w);let r=s.x/this.B_v,n=s.y/this.B_w,h=s.getRight()/this.B_v,l=s.getTop()/this.B_w;return this.CJ?a.uvs.set([r,l,h,l,h,n,r,n],0):a.uvs.set([r,n,h,n,h,l,r,l],0),a}return null}}}a.F_j=0,e.default=a},"644c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}static GetTypeByTypeNS(t){switch(t){case"mat4":return i.SHADER_MAT4;case"mat3":return i.SHADER_MAT3;case"mat2":return i.SHADER_MAT2;case"float":return i.SHADER_FLOAT;case"int":return i.SHADER_INT;case"vec4":return i.SHADER_VEC4;case"vec3":return i.SHADER_VEC3;case"vec2":return i.SHADER_VEC2;case"vec4[]":return i.SHADER_VEC4FV;case"vec3[]":return i.SHADER_VEC3FV;case"vec2[]":return i.SHADER_VEC2FV;case"sampler2D":return i.SHADER_SAMPLER2D;case"sampler3D":return i.SHADER_SAMPLER3D;case"samplerCube":return i.SHADER_SAMPLERCUBE;default:break}return i.SHADER_UNDEFINED}static GetTypeNSByType(t){switch(t){case i.SHADER_MAT4:return"mat4";case i.SHADER_MAT3:return"mat3";case i.SHADER_MAT2:return"mat2";case i.SHADER_FLOAT:return"float";case i.SHADER_VEC4:return"vec4";case i.SHADER_VEC3:return"vec3";case i.SHADER_VEC2:return"vec2";case i.SHADER_SAMPLER2D:return"sampler2D";case i.SHADER_SAMPLER3D:return"sampler3D";case i.SHADER_SAMPLERCUBE:return"samplerCube";case i.SHADER_UNDEFINED:return"undefined";default:break}return""}}i.ATTRINS_VTX_VS="a_vs",i.ATTRINS_VTX_UVS="a_uvs",i.ATTRINS_VTX_NVS="a_nvs",i.ATTRINS_VTX_CVS="a_cvs",i.UNIFORMNS_OBJ_MAT_NS="u_objMat",i.UNIFORMNS_VIEW_MAT_NS="u_viewMat",i.UNIFORMNS_PROJ_MAT_NS="u_projMat",i.SHADER_UNDEFINED=3010,i.SHADER_VEC2=3011,i.SHADER_VEC3=3012,i.SHADER_VEC4=3013,i.SHADER_VEC2FV=3014,i.SHADER_VEC3FV=3015,i.SHADER_VEC4FV=3016,i.SHADER_MAT2=3017,i.SHADER_MAT3=3018,i.SHADER_MAT4=3019,i.SHADER_FLOAT=3020,i.SHADER_INT=3021,i.SHADER_MAT2FV=3022,i.SHADER_MAT3FV=3023,i.SHADER_MAT4FV=3024,i.SHADER_SAMPLER2D=3031,i.SHADER_SAMPLERCUBE=3032,i.SHADER_SAMPLER3D=3033,i.SHADER_PRECISION_LOWP=3101,i.SHADER_PRECISION_MEDIUMP=3111,i.SHADER_PRECISION_HIGHP=3121,i.UNIFORM_TEX_SAMPLER2D="sampler2D",i.UNIFORM_TEX_SAMPLERCUBE="samplerCube",i.UNIFORM_TEX_SAMPLER3D="sampler3D",i.UNIFORMNS_TEX_SAMPLER_0="u_sampler0",i.UNIFORMNS_TEX_SAMPLER_1="u_sampler1",i.UNIFORMNS_TEX_SAMPLER_2="u_sampler2",i.UNIFORMNS_TEX_SAMPLER_3="u_sampler3",i.UNIFORMNS_TEX_SAMPLER_4="u_sampler4",i.UNIFORMNS_TEX_SAMPLER_5="u_sampler5",i.UNIFORMNS_TEX_SAMPLER_6="u_sampler6",i.UNIFORMNS_TEX_SAMPLER_7="u_sampler7",i.UNIFORMNS_TEX_SAMPLER_LIST=[i.UNIFORMNS_TEX_SAMPLER_0,i.UNIFORMNS_TEX_SAMPLER_1,i.UNIFORMNS_TEX_SAMPLER_2,i.UNIFORMNS_TEX_SAMPLER_3,i.UNIFORMNS_TEX_SAMPLER_4,i.UNIFORMNS_TEX_SAMPLER_5,i.UNIFORMNS_TEX_SAMPLER_6,i.UNIFORMNS_TEX_SAMPLER_7],e.default=i},6661:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("3b73")),r=i(s("faa5")),n=i(s("b3bd")),h=i(s("0fc4"));class l extends r.default{constructor(){super(),this.Ak=""}initialize(t){this.Ak="PingpongHBlurBlurShd"}getFragShaderCode(){let t="";return t=a.default.IsWebGL2()?"#version 300 es\nprecision mediump float;\nfloat weight[5] = float[] (0.227027, 0.1945946, 0.1216216, 0.054054, 0.016216);\nuniform vec4 u_texSize;\nuniform sampler2D u_sampler0;\nin vec2 v_uvs;\nout vec4 FragColor;\nvoid main()\n{\n    vec2 tex_offset = u_texSize.w / u_texSize.xy;\n    float dx = tex_offset.x;\n    tex_offset.y = 0.0;\n    vec4 result = texture(u_sampler0, v_uvs) * weight[0];\n    for(int i = 1; i < 5; ++i)\n    {\n        tex_offset.x = dx * float(i);\n        result += texture(u_sampler0, v_uvs + tex_offset) * weight[i];\n        result += texture(u_sampler0, v_uvs - tex_offset) * weight[i];\n    }\n    FragColor = result;\n}\n":"\nprecision mediump float;\nuniform vec4 u_texSize;\nuniform sampler2D u_sampler0;\nin vec2 v_uvs;\nout vec4 FragColor;\nvoid main()\n{\n    vec2 tex_offset = u_texSize.w / u_texSize.xy;\n    float dx = tex_offset.x;\n    tex_offset.y = 0.0;\n    vec4 result = texture2D(u_sampler0, v_uvs) * 0.227027;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.1945946;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.1945946;\n    tex_offset.x = dx * 2.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.1216216;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.1216216;\n    tex_offset.x = dx * 3.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.054054;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.054054;\n    tex_offset.x = dx * 4.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.016216;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.016216;\n    FragColor = result;\n}\n",t}getVertShaderCode(){let t="#version 300 es\nprecision mediump float;\nlayout(location = 0) in vec3 a_vs;\nlayout(location = 1) in vec2 a_uvs;\nout vec2 v_uvs;\nvoid main()\n{\n    gl_Position = vec4(a_vs, 1.0);\n    v_uvs = vec2(a_uvs.x, a_uvs.y);\n}\n";return t}getUniqueShaderName(){return this.Ak}toString(){return"[PingpongHBlurShaderBuffer()]"}static GetInstance(){return l.F_0}}l.F_0=new l;class o extends r.default{constructor(){super(),this.Ak=""}initialize(t){this.Ak="PingpongVBlurBlurShd"}getFragShaderCode(){let t="";return t=a.default.IsWebGL2()?"#version 300 es\nprecision mediump float;\nfloat weight[5] = float[] (0.227027, 0.1945946, 0.1216216, 0.054054, 0.016216);\nuniform vec4 u_texSize;\nuniform sampler2D u_sampler0;\nin vec2 v_uvs;\nout vec4 FragColor;\nvoid main()\n{\n    //vec2 tex_offset = u_texSize.w / vec2(textureSize(u_sampler0, 0));\n    vec2 tex_offset = u_texSize.w / u_texSize.xy;\n    float dy = tex_offset.y;\n    tex_offset.x = 0.0;\n    vec4 result = texture(u_sampler0, v_uvs) * weight[0];\n    for(int i = 1; i < 5; ++i)\n    {\n        tex_offset.y = dy * float(i);\n        result += texture(u_sampler0, v_uvs + tex_offset) * weight[i];\n        result += texture(u_sampler0, v_uvs - tex_offset) * weight[i];\n    }\n    FragColor = result;\n}\n":"\nprecision mediump float;\nuniform vec4 u_texSize;\nuniform sampler2D u_sampler0;\nin vec2 v_uvs;\nout vec4 FragColor;\nvoid main()\n{\n    vec2 tex_offset = u_texSize.w / u_texSize.xy;\n    float dy = tex_offset.y;\n    tex_offset.x = 0.0;\n    vec4 result = texture2D(u_sampler0, v_uvs) * 0.227027;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.1945946;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.1945946;\n    tex_offset.y = dy * 2.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.1216216;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.1216216;\n    tex_offset.y = dy * 3.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.054054;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.054054;\n    tex_offset.y = dy * 4.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.016216;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.016216;\n\n    FragColor = result;\n}\n",t}getVertShaderCode(){let t="#version 300 es\nprecision mediump float;\nlayout(location = 0) in vec3 a_vs;\nlayout(location = 1) in vec2 a_uvs;\nout vec2 v_uvs;\nvoid main()\n{\n    gl_Position = vec4(a_vs, 1.0);\n    v_uvs = vec2(a_uvs.x, a_uvs.y);\n}\n";return t}getUniqueShaderName(){return this.Ak}toString(){return"[PingpongVBlurShaderBuffer()]"}static GetInstance(){return o.F_0}}o.F_0=new o,e.PingpongVBlurShaderBuffer=o;class _ extends h.default{constructor(t=0){super(),this.CK=0,this.CL=new Float32Array([800,600,0,0]),this.CK=t}setTexSize(t,e){this.CL[0]=t,this.CL[1]=e}setBlurDensity(t){this.CL[3]=t}getCodeBuf(){return this.CK>0?o.GetInstance():l.GetInstance()}createSelfUniformData(){let t=new n.default;return t.uniformNameList=["u_texSize"],t.dataList=[this.CL],t}}e.default=_},"670e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("45db"),a=s("8ae4");class r{constructor(){this.version=-1,this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.vertex=new i.ROVertexRes,this.indices=new a.ROIndicesRes,this.c=0}__$attachThis(){++this.c}__$detachThis(){--this.c,this.c<1&&(this.c=0)}getAttachCount(){return this.c}createVRO(t,e,s){let i=this.vertex.createVRO(t,e,s,this.indices,this.indices.getUid());return i.ibufStep=this.indices.ibufStep,i}updateToGpu(t){this.indices.updateToGpu(t),this.vertex.updateToGpu(t)}destroy(t){this.getAttachCount()<1&&this.resUid>=0&&(this.vertex.destroy(t),this.indices.destroy(t),this.resUid=-1)}}e.GpuVtxObject=r},"68aa":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,s,i,a,r){1==this.status||r?t.texImage2D(e,this.miplevel,s,this.width,this.height,0,i,a,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,this.width,this.height,i,a,this.data),this.status=-1}static Create(){return i.GU.length>0?i.GU.pop():new i}static Restore(t){null!=t&&(t.data=null,i.GU.push(t))}}i.GU=[],e.default=i},"69ed":function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["VertHead"]="vertHead",t["VertBody"]="vertBody",t["FragHead"]="fragHead",t["FragBody"]="fragBody"}(i||(i={})),e.ShaderCodeType=i},"6a30":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17")),r=i(s("3930"));class n{constructor(){this.direction=new a.default(0,-1,0,0),this.color=new r.default(1,1,1,1),this.attenuationFactor1=0,this.attenuationFactor2=0}}e.DirectionLight=n},"6d49":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("3b73")),r=i(s("baae")),n=s("8d98"),h=i(s("56c5"));class l{constructor(t,e,s){this.T=-1,this.A=0,this.CM=0,this.A_0=null,this.CN=null,this.CO=null,this.CP=null,this.B_v=512,this.B_w=512,this.CQ=0,this.x=null,this.CR=0,this.CS=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.CT=[!0,!0,!0,!0,!0,!0,!0,!0],this.CU=0,this.CV=0,this.AP=0,this.CW=0,this.CX=new Float32Array(1),this.CY=new Float32Array(4),this.CZ=new Int16Array(4),this.Ca=!1,this.textureLevel=0,this.sizeFixed=!1,this.writeDepthEnabled=!0,this.writeStencilEnabled=!1,this.multisampleEnabled=!1,this.multisampleLevel=0,this.Cb=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.Cc=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.Cd=0,this.Ce=!1,this.Cf=2,this.Cg=2,this.A=t,this.BN=e,this.CQ=s,this.T=l.F_j++}getUid(){return this.T}resetAttachmentMask(t){let e=this.CT.length-1;while(e>=0)this.CT[e]=t,--e}setAttachmentMaskAt(t,e){this.CT[t]=e}getActiveAttachmentTotal(){return this.Ce?this.AP-1:this.AP}getAttachmentTotal(){return this.CT.length}bindToBackbuffer(t){switch(t){case r.default.DRAW_FRAMEBUFFER:this.x.bindFramebuffer(this.x.DRAW_FRAMEBUFFER,null);break;case r.default.READ_FRAMEBUFFER:this.x.indFramebuffer(this.x.READ_FRAMEBUFFER,null);break;default:this.x.bindFramebuffer(this.x.FRAMEBUFFER,null)}}bind(t){if(null!=this.A_0)switch(t){case r.default.DRAW_FRAMEBUFFER:this.x.bindFramebuffer(this.x.DRAW_FRAMEBUFFER,this.A_0);break;case r.default.READ_FRAMEBUFFER:this.x.bindFramebuffer(this.x.READ_FRAMEBUFFER,this.A_0);break;default:this.x.bindFramebuffer(this.x.FRAMEBUFFER,this.A_0)}}getFBO(){return this.A_0}getDepthStencilRBO(){return this.CN}getDepthRBO(){return this.CO}getWidth(){return this.B_v}getHeight(){return this.B_w}getFramebufferType(){return this.CQ}renderToTexAt(t,e,s){let i=null!=e?e.internalFormat:-1;this.x=t,0==s&&(this.Cd=0,this.Ce=!1,this.x.bindFramebuffer(this.CR,this.A_0),i!=n.TextureFormat.DEPTH_COMPONENT&&i!=n.TextureFormat.DEPTH_STENCIL&&(this.AP=0,this.CW=0));let a=-1,r=null;null!=e?(a=e.getTargetType(),r=this.BN.getGpuBuffer(e.getResUid()),e.uploadFromFbo(this.BN,this.B_v,this.B_w)):a=this.CS[this.AP],this.framebufferTextureBind(t,a,i,r)}glFramebufferTex2D(t,e){let s=this.x;s.framebufferTexture2D(this.CR,t,s.TEXTURE_2D,e,0),this.Cb[this.Cd]=t,this.Cc[this.Cd]=s.TEXTURE_2D,this.Cd++}glFramebufferTexCube(t,e,s){let i=this.x;i.framebufferTexture2D(this.CR,t,i.TEXTURE_CUBE_MAP_POSITIVE_X+e,s,0),this.Cb[this.Cd]=t,this.Cc[this.Cd]=i.TEXTURE_CUBE_MAP_POSITIVE_X+e,this.Cd++}framebufferTexture2D(t,e,s,i){let a=-1;switch(s){case n.TextureFormat.DEPTH_COMPONENT:this.Ce=!0,a=this.x.DEPTH_ATTACHMENT;break;case n.TextureFormat.DEPTH_STENCIL:this.Ce=!0,a=this.x.DEPTH_STENCIL_ATTACHMENT;break;default:a=this.CM+this.CW;break}a>0&&(this.CT[this.AP]?(this.glFramebufferTex2D(a,i),++this.CW,this.CS[this.AP]=null!=i?e:0):this.CS[this.AP]=0,++this.AP)}framebufferTextureBind(t,e,s,i){switch(e){case n.TextureTarget.TEXTURE_2D:this.framebufferTexture2D(t,e,s,i);break;case n.TextureTarget.TEXTURE_CUBE:let a=0;for(let t=0;t<6;++t)this.CT[t]?(this.glFramebufferTexCube(this.CM+this.CW,t,i),++this.CW,this.CS[this.AP+t]=null!=i?e:0,a++):this.CS[this.AP+t]=0;a=a>0?a:6,this.AP+=a;break;case n.TextureTarget.TEXTURE_SHADOW_2D:this.CT[this.AP]?(this.glFramebufferTex2D(this.x.DEPTH_ATTACHMENT,i),this.CS[this.AP]=null!=i?e:0):this.CS[this.AP]=0,++this.AP;break;default:break}}reset(){this.CU=-1,this.CV=-1}use(t){if(this.x=t,null!=this.A_0){if(this.AP>1){if(this.CV!=this.CW){let t=[],e=0;for(;e<this.CW;++e)t.push(this.CM+e);if(this.CV>this.CW)for(;e<this.CV;++e)this.x.framebufferTexture2D(this.CR,this.Cb[e],this.Cc[e],null,0);h.default.DrawBuffers(t),this.CV=this.CW}}else if(this.CV!=this.CW){if(this.CV>this.CW)for(let e=1;e<this.CV;++e)this.x.framebufferTexture2D(this.CR,this.Cb[e],this.Cc[e],null,0);let t=[this.CM];h.default.DrawBuffers(t),this.CV=this.CW}this.CU=this.AP}}clearOnlyColor(t){if(null!=this.A_0)if(a.default.IsWebGL2())if(this.CY[0]=t.r,this.CY[1]=t.g,this.CY[2]=t.b,this.CY[3]=t.a,this.CU>1)for(let e=0;e<this.CU;++e)this.x.clearBufferfv(this.x.COLOR,e,this.CY);else this.x.clearBufferfv(this.x.COLOR,0,this.CY);else this.x.clearColor(t.r,t.g,t.b,t.a)}clearOnlyDepth(t=1){a.default.IsWebGL2()?(this.CX[0]=t,this.x.clearBufferfv(this.x.DEPTH,0,this.CX)):this.x.clearDepth(t)}clearOnlyStencil(t){this.CZ[0]=t,this.x.clearBufferuiv(this.x.STENCIL,0,this.CZ)}clearOnlyDepthAndStencil(t,e){this.x.clearBufferfi(this.x.DEPTH_STENCIL,0,t,e)}invalidateFramebuffer(){}resize(t,e){this.Cf==t&&this.Cg==e||(this.Ca=!0,this.Cf=t,this.Cg=e)}initialize(t,e,s){this.x=t,this.CM=h.default.COLOR_ATTACHMENT0,this.Ca&&(e=this.Cf,s=this.Cg),null==this.A_0?this.createNewFBO(t,e,s):this.B_v==e&&this.B_w==s||this.createNewFBO(t,e,s),this.Ca=!1}isSizeChanged(){return this.Ca}destroy(t){null!=this.A_0&&(null!=this.CN&&(t.deleteFramebuffer(this.CN),this.CN=null),null!=this.CO&&(t.deleteFramebuffer(this.CO),this.CO=null),null!=this.CP&&(t.deleteFramebuffer(this.CP),this.CP=null),t.deleteFramebuffer(this.A_0),this.A_0=null),this.x=null,this.CR=0,this.Ca=!1}buildDepthStencilRBO(t,e,s){null==this.CN&&(this.CN=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.CN),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_STENCIL,e,s),t.framebufferRenderbuffer(this.CR,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.CN),null==this.CP&&(this.CP=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.CP),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.CR,this.CM,t.RENDERBUFFER,this.CP)):(t.bindRenderbuffer(t.RENDERBUFFER,this.CN),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e,s),t.framebufferRenderbuffer(this.CR,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.CN))}buildDepthRBO(t,e,s){null==this.CO&&(this.CO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.CO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_COMPONENT24,e,s),t.framebufferRenderbuffer(this.CR,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.CO),null==this.CP&&(this.CP=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.CP),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.CR,this.CM,t.RENDERBUFFER,this.CP)):(t.bindRenderbuffer(t.RENDERBUFFER,this.CO),a.default.IsWebGL2()?t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT24,e,s):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,s),t.framebufferRenderbuffer(this.CR,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.CO))}buildStencilRBO(t,e,s){null==this.CN&&(null==this.CN&&(this.CN=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.CN),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.STENCIL_INDEX8,e,s),t.framebufferRenderbuffer(this.CR,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.CN),null==this.CP&&(this.CP=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.CP),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.CR,this.CM,t.RENDERBUFFER,this.CP)):(t.bindRenderbuffer(t.RENDERBUFFER,this.CN),t.renderbufferStorage(t.RENDERBUFFER,t.STENCIL_INDEX8,e,s),t.framebufferRenderbuffer(this.CR,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.CN)))}buildColorRBO(t,e,s){this.multisampleEnabled&&(null==this.CP&&(this.CP=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.CP),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.CR,this.CM,t.RENDERBUFFER,this.CP))}createNewFBO(t,e,s){let i=null==this.A_0;switch(this.CU=this.AP=0,this.CV=this.CW=0,this.B_v=e,this.B_w=s,this.Cf=e,this.Cg=s,i&&(this.A_0=t.createFramebuffer()),this.CQ){case r.default.DRAW_FRAMEBUFFER:this.CR=t.DRAW_FRAMEBUFFER;break;case r.default.READ_FRAMEBUFFER:this.CR=t.READ_FRAMEBUFFER;break;default:this.CR=t.FRAMEBUFFER;break}if(t.bindFramebuffer(this.CR,this.A_0),this.writeDepthEnabled?this.writeStencilEnabled?null==this.CN&&this.buildDepthStencilRBO(t,e,s):this.buildDepthRBO(t,e,s):this.writeStencilEnabled?this.buildStencilRBO(t,e,s):this.buildColorRBO(t,e,s),i){t.checkFramebufferStatus(this.CR);t.FRAMEBUFFER_COMPLETE}l.BindToBackbuffer(t,this.CQ)}static BindToBackbuffer(t,e){switch(e){case r.default.DRAW_FRAMEBUFFER:t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null);break;case r.default.READ_FRAMEBUFFER:t.indFramebuffer(t.READ_FRAMEBUFFER,null);break;default:t.bindFramebuffer(t.FRAMEBUFFER,null);break}}}l.F_j=0,e.default=l},"6e01":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Clamp(t,e,s){return Math.max(Math.min(t,s),e)}static IsPowerOf2(t){return 0==(t&t-1)}static CalcCeilPowerOfTwo(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}static CalcNearestCeilPow2(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}static CalcFloorCeilPow2(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}static DegreeToRadian(t){return i.MATH_PI_OVER_180*t}static Log2(t){return Math.log(t)/Math.LN2}static GetMaxMipMapLevel(t,e){return Math.round(i.Log2(Math.max(t,e))+1)}static SafeACos(t){return t<=-1?i.MATH_PI:t>=1?0:Math.acos(t)}static GetNearestCeilPow2(t){let e=1;while(e<t)e<<=1;return e}static GetMinRadian(t,e){return e%=i.MATH_2PI,t%=i.MATH_2PI,e<t?(e=i.MATH_2PI-t+e,e>i.MATH_PI?e-i.MATH_2PI:e):e>t?(t=i.MATH_2PI-e+t,t>i.MATH_PI?i.MATH_2PI-t:-t):0}static GetMinDegree(t,e){let s=0;return e>=270&&t<90?s=(e-(t+360))%180:e<=90&&t>=270?s=(e+360-t)%180:(s=e-t,s>180?(s-=360,s%=360):s<-180&&(s+=360,s%=360)),s}static GetDegreeByXY(t,e){if(Math.abs(t)<1e-5)return e>=0?270:90;let s=180*Math.atan(e/t)/Math.PI;return t>=0?s:180+s}static GetRadianByXY(t,e){if(Math.abs(t)<i.MATH_MIN_POSITIVE)return e>=0?i.MATH_1PER2PI:i.MATH_3PER2PI;let s=Math.atan(e/t);return t>=0?s:i.MATH_PI+s}static GetRadianByCos(t,e,s){var a=Math.acos(t);return e>=0?a:i.MATH_PI+a}}i.MATH_MIN_POSITIVE=1e-5,i.MATH_MAX_NEGATIVE=-1e-5,i.MATH_MAX_POSITIVE=268435454,i.MATH_MIN_NEGATIVE=-268435454,i.MATH_1_OVER_255=1/255,i.MATH_PI=Math.PI,i.MATH_2PI=2*i.MATH_PI,i.MATH_3PER2PI=1.5*i.MATH_PI,i.MATH_1PER2PI=.5*i.MATH_PI,i.MATH_1_OVER_PI=1/i.MATH_PI,i.MATH_1_OVER_360=1/360,i.MATH_1_OVER_180=1/180,i.MATH_180_OVER_PI=180/i.MATH_PI,i.MATH_PI_OVER_180=i.MATH_PI/180,i.MATH_LN2=.6931471805599453,e.default=i},7045:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.phase=0,this.type=i.KEY_DOWN,this.target=null,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.repeat=!1,this.key="",this.keyCode=0,this.location=0}getClassType(){return i.EventClassType}toString(){return"[KeyboardEvent]"}}i.EventClassType=1003,i.KEY_DOWN=6001,i.KEY_UP=6002,e.default=i},"70f2":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("6e01")),r=i(s("8e17")),n=i(s("0236")),h=i(s("c51d")),l=i(s("af68")),o=i(s("a80a")),_=i(s("a446")),m=i(s("c711")),u=i(s("955e")),d=i(s("765c")),c=i(s("af29"));class f{constructor(t,e,s){this.T=-1,this.f_=null,this.d=null,this.x_=null,this.B_6=null,this.Br=null,this.Ch=new Uint8Array(128),this.Ci=0,this.Cj=null,this.Ck=new r.default,this.Cl=new r.default,this.Cm=null,this.Cn=!1,this.Co=null,this.Cp=!0,this.A_i=null,this.B=0,this.C=0,this.D=800,this.E=800,this.Cq=null,this.Cr=null,this.Cs=!0,this.Ct=null,this.A_h=null,this.A_e=null,this.Cu=-1,this.Cv=!0,this.Cw=null,this.A_j=!0,this.textureBlock=null,this.Cx=[],this.Cy=0,this.Cz=!0,this.C0=!0,this.C1=!0,this.C2=!0,this.Cn=s,this.Br=t,this.B_6=e,this.A_e=e.getDataBuilder().getRenderShader(),this.T=1024+f.__s_uid++}enable(){this.A_j=!0}disable(){this.A_j=!1}isEnabled(){return this.A_j}getUid(){return this.T}getRPONodeBuilder(){return null}getRenderProxy(){return this.d}setViewPort(t,e,s,i){null!=this.d&&(this.B=t,this.C=e,this.D=s,this.E=i)}reseizeViewPort(){this.d.reseizeRCViewPort()}getRendererAdapter(){return this.f_}getRenderer(){return this.B_6}getRendererContext(){return this.x_}getStage3D(){return this.d.getStage3D()}getCurrentStage3D(){return this.Cw}getCamera(){return this.A_i}getRendererStatus(){return this.B_6.getRendererStatus()}getMouseXYWorldRay(t,e){this.A_i.getWorldPickingRayByScreenXY(this.A_h.mouseX,this.A_h.mouseY,t,e)}createCamera(){return new h.default}createFBOInstance(){return new c.default(this,this.textureBlock.getRTTStrore())}setEvt3DController(t){null!=t&&(null==this.Cw&&(this.Cw=new n.default(this.d.getRCUid(),null)),t.initialize(this.getStage3D(),this.Cw),t.setRaySelector(this.Cj.getRaySelector())),this.Co=t}isRayPickSelected(){return null!=this.Co&&this.Co.isSelected()}enableMouseEvent(t=!0){null==this.Co&&(t?this.Cj.setRaySelector(new u.default):this.Cj.setRaySelector(new m.default),this.setEvt3DController(new d.default)),this.Cp=!0}disableMouseEvent(){this.Cp=!1}getEvt3DController(){return this.Co}getSpace(){return this.Cj}getDevicePixelRatio(){return this.f_.getDevicePixelRatio()}addEventListener(t,e,s,i=!0,a=!1){this.Cw.addEventListener(t,e,s,i,a)}removeEventListener(t,e,s){this.Cw.removeEventListener(t,e,s)}setAccessor(t){this.Cm=t}initialize(t,e=3,s=!0){if(null==this.d){e<1&&(e=1),e>8&&(e=8),this.Ct=t,this.Cs=t.cameraPerspectiveEnabled;let i=null;for(;e>=0;)i=this.B_6.appendProcess(t.batchEnabled,t.processFixedState),this.Ch[this.Ci]=i.getRPIndex(),this.Ci++,--e;this.x_=this.B_6.getRendererContext(),this.d=this.x_.getRenderProxy(),this.f_=this.d.getRenderAdapter(),this.A_h=this.d.getStage3D(),this.B=this.A_h.getViewX(),this.C=this.A_h.getViewY(),this.D=this.A_h.getViewWidth(),this.E=this.A_h.getViewHeight(),s?this.createMainCamera():this.A_i=this.d.getCamera(),null==this.Cj&&(this.Cj=new _.default,this.Cj.initialize(this.B_6,this.A_i))}}createMainCamera(){this.A_i=new h.default,this.A_i.setViewXY(this.B,this.C),this.A_i.setViewSize(this.D,this.E);let t=this.Ct.camProjParam;this.Cs?this.A_i.perspectiveRH(a.default.DegreeToRadian(t.x),this.D/this.E,t.y,t.z):this.A_i.orthoRH(t.y,t.z,-.5*this.E,.5*this.E,-.5*this.D,.5*this.D),this.A_i.lookAtRH(this.Ct.camPosition,this.Ct.camLookAtPos,this.Ct.camUpDirect),this.A_i.update()}cameraLock(){this.A_i.lock()}cameraUnlock(){this.A_i.unlock()}updateRenderBufferSize(){this.f_.updateRenderBufferSize()}setRendererProcessParam(t,e,s){this.B_6.setRendererProcessParam(this.Ch[t],e,s)}appendARendererProcess(t=!0,e=!1){let s=this.B_6.appendProcess(t,e);this.Ch[this.Ci]=s.getRPIndex(),this.Ci++}getRenderProcessAt(t){return this.B_6.getProcessAt(this.Ch[t])}addContainer(t,e=0){if(e<0&&(e=0),null!=t&&t.__$wuid<0&&t.__$contId<1){let s=0;for(;s<this.Cy;++s)if(this.Cx[s]==t)return;s>=this.Cy&&(t.__$wuid=this.T,t.wprocuid=e,t.__$setRenderer(this),this.Cx.push(t),this.Cy++)}}removeContainer(t){if(null!=t&&t.__$wuid==this.T&&t.getRenderer()==this.B_6){let e=0;for(;e<this.Cy;++e)if(this.Cx[e]==t){t.__$wuid=-1,t.wprocuid=-1,t.__$setRenderer(null),this.Cx.splice(e,1),--this.Cy;break}}}setAutoRunningEnabled(t){this.Cv=t}moveEntityTo(t,e){this.B_6.moveEntityToProcessAt(t,this.Ch[e])}drawEntity(t,e=!1,s=!0){this.B_6.drawEntity(t,e,s)}addEntity(t,e=0,s=!0){if(null!=t&&t.__$testSpaceEnabled())if(t.isPolyhedral())if(t.hasMesh())this.B_6.addEntity(t,this.Ch[e],s),null!=this.Cj&&this.Cj.addEntity(t);else{null==this.Cq&&(this.Cq=new o.default,this.Cr=new l.default);let s=this.Cr.addEntity(t);s.rstatus=e,this.Cq.addNode(s)}else this.B_6.addEntity(t,this.Ch[e],s),null!=this.Cj&&this.Cj.addEntity(t)}removeEntity(t){if(null!=t){let e=null;if(null!=this.Cq){let e=this.Cr.getNodeByEntity(t);null!=e&&(this.Cq.removeNode(e),this.Cr.removeEntity(t))}null==e&&(this.B_6.removeEntity(t),null!=this.Cj&&this.Cj.removeEntity(t))}}updateMaterialUniformToCurrentShd(t){this.B_6.updateMaterialUniformToCurrentShd(t)}drawEntityByLockMaterial(t){this.B_6.drawEntityByLockMaterial(t)}showInfoAt(t){this.B_6.showInfoAt(t)}updateCameraData(t){this.x_.updateCameraDataFromCamera(this.d.getCamera())}renderBegin(t=!1){t&&this.x_.renderBegin(),this.d.getCamera()!=this.A_i&&(this.d.isAutoSynViewAndStage()&&(this.B=this.d.getViewX(),this.C=this.d.getViewY(),this.D=this.d.getViewWidth(),this.E=this.d.getViewHeight()),this.A_i.setViewXY(this.B,this.C),this.A_i.setViewSize(this.D,this.E),this.d.setRCViewPort(this.B,this.C,this.D,this.E,this.d.isAutoSynViewAndStage()),this.d.reseizeRCViewPort()),this.A_i.update(),this.x_.updateCameraDataFromCamera(this.A_i),this.A_e.renderBegin(),null!=this.Cm&&this.Cm.renderBegin(this)}runBegin(t=!0,e=!1){t&&this.Cv&&(this.Cu>=0&&this.runEnd(),this.Cu=0),this.renderBegin(e),null!=this.Cj&&(this.Cj.setCamera(this.A_i),this.Cj.runBegin())}setRayTestEanbled(t){this.C2=t}runMouseTest(t,e){let s=-1;if(null!=this.Co&&this.Cp){if(this.C1&&this.Co.getEvtType()>0){let t=this.Cj.getRaySelector();if(null!=t){this.C2?this.mouseRayTest():t.clear();let e=t.getSelectedNodesTotal();if(e>1){let s=0,i=t.getSelectedNodes(),a=null;for(;s<e;++s)a=i[s],a.entity.isPolyhedral()}}this.C1=!1}s=this.Co.run(t,e)}return this.Cz=!1,s}update(t=!0,e=!0){if(null!=this.Cw&&this.Cw.enterFrame(),t&&this.Cv&&(0!=this.Cu&&this.runBegin(),this.Cu=1),this.Cz=!0,this.C0=!0,this.C1=!0,null!=this.Cq){let t=this.Cq.getBegin();if(null!=t){let e,s,i;while(null!=t)t.entity.hasMesh()?(e=t,t=t.next,s=e.entity,i=e.rstatus,this.Cq.removeNode(e),this.Cr.removeEntity(e.entity),this.addEntity(s,i)):t=t.next}}let s=0;for(;s<this.Cy;++s)this.Cx[s].update();null!=this.Cj&&this.Cj.update(),null!=this.Cj&&this.C0&&(null==this.Co&&null==this.Cj.getRaySelector()||this.Cj.run()),this.Cz&&!this.Cn&&(e?this.runMouseTest(1,0):null!=this.Co&&this.Co.mouseOutEventTarget())}cullingTest(){null!=this.Cj&&this.Cj.run(),this.C0=!1}mouseRayTest(){null!=this.Cj&&(this.getMouseXYWorldRay(this.Cl,this.Ck),this.Cj.rayTest(this.Cl,this.Ck))}run(t=!1){if(this.A_j){t&&this.Cv&&(1!=this.Cu&&this.update(),this.Cu=2);for(let t=0;t<this.Ci;++t)this.B_6.runAt(this.Ch[t]);t&&this.runEnd()}}runAt(t){this.B_6.runAt(this.Ch[t])}runEnd(){null!=this.Co&&this.Co.runEnd(),null!=this.Cj&&this.Cj.runEnd(),this.Cv&&(this.Cu=-1),null!=this.Cm&&this.Cm.renderEnd(this)}useCamera(t,e=!1){this.Br.useCamera(t,e)}useMainCamera(){this.Br.useMainCamera()}updateCamera(){null!=this.A_i&&this.A_i.update()}setClearUint24Color(t,e=1){this.d.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,s){this.d.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.d.setClearRGBAColor4f(t,e,s,i)}setClearColor(t){this.d.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.d.setRenderToBackBuffer()}toString(){return"[RendererSubScene(uid = "+this.T+")]"}}f.__s_uid=0,e.default=f},"710f":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){if(this.C3=[],this.C4=[],null!=i.F_n)throw Error("ROVtxBufUidStore is a singleton class!!");i.F_n=this}static GetInstance(){return i.F_n}__$getRemovedListLen(){return this.C4.length}__$getRemovedList(){return this.C4}__$attachAt(t){if(t<this.C3.length)++this.C3[t];else{let e=this.C3.length;for(;e<=t;++e)this.C3.push(0);++this.C3[t]}}__$detachAt(t){--this.C3[t],this.C3[t]<1&&(this.C3[t]=0,this.C4.push(t))}getAttachCountAt(t){return t<this.C3.length?this.C3[t]:0}getAttachAllCount(){let t=0,e=0,s=this.C3.length;for(;e<s;++e)this.C3[e]>0&&(t+=this.C3[e]);return t}}i.F_n=null,e.default=i},7181:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,s,i,a,r){1==this.status||r?t.texImage2D(e,this.miplevel,s,i,a,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,i,a,this.data),this.status=-1}static Create(){return i.GU.length>0?i.GU.pop():new i}static Restore(t){null!=t&&(t.data=null,i.GU.push(t))}}i.GU=[],e.default=i},"722e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.NEAREST=4001,i.LINEAR=4002,i.LINEAR_MIPMAP_LINEAR=4003,i.NEAREST_MIPMAP_NEAREST=4004,i.LINEAR_MIPMAP_NEAREST=4005,i.NEAREST_MIPMAP_LINEAR=4006,e.default=i},7279:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("5326")),r=i(s("3b73")),n=i(s("d53d"));class h extends n.default{constructor(){super(),this.slotId=0,this.slotIndex=0,this.uniformsTotal=0,this.locationIndexList=null,this.locations=null,this.rst=0,this.always=!1}clone(){let t=new h;return t.types=this.types.slice(0),t.uniformNameList=this.uniformNameList.slice(0),t.dataSizeList=this.dataSizeList.slice(0),t.slotIndex=this.slotIndex,t.uniformsTotal=this.uniformsTotal,t.slotId=this.slotId,t.always=this.always,t.rst=this.rst,t}copyDataFromProbe(t){this.types=t.uniformTypes.slice(0),this.dataSizeList=t.dataSizeList.slice(0),this.slotIndex=t.getSlotBeginIndex(),this.uniformsTotal=t.uniformsTotal,this.slotId=t.getSlotUid()}copyDataFromProbeAt(t,e){null==this.types&&(this.types=[],this.dataSizeList=[]),this.slotIndex=e.getSlotBeginIndex()+t,this.uniformsTotal=1,this.slotId=e.getSlotUid(),this.types[0]=e.uniformTypes[t],this.dataSizeList[0]=e.dataSizeList[t]}use(t){let e=a.default.GetSlotAt(t.getRCUid());if(this.always||this.rst!=e.flagList[this.slotIndex]){this.rst=e.flagList[this.slotIndex];let s=0;if(r.default.IsWebGL1())for(;s<this.uniformsTotal;++s)t.useUniformV1(this.locations[s],this.types[s],e.dataList[this.slotIndex+s],this.dataSizeList[s]);else for(;s<this.uniformsTotal;++s)t.useUniformV2(this.locations[s],this.types[s],e.dataList[this.slotIndex+s],this.dataSizeList[s],0)}}destroy(){this.types=null,this.dataSizeList=null,this.slotIndex=-1,this.uniformsTotal=0}}e.default=h},7499:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.C5=null,this.A_e=null,this.BN=null}setDispBuilder(t){null==this.C5&&(this.C5=t,this.A_e=t.getRenderShader(),this.BN=t.getTextureResource())}unlockMaterial(){this.A_e.unlock(),this.BN.unlocked=!0}lockMaterial(){this.A_e.lock(),this.BN.unlocked=!1}isUnlockMatrial(){return this.BN.unlocked}unlockTexture(){this.A_e.textureUnlock()}lockTexture(){this.A_e.textureLock()}renderBegin(){this.A_e.renderBegin(),this.BN.renderBegin()}resetUniform(){this.A_e.resetUniform()}useGlobalMaterial(t,e=!1){null!=t&&this.C5.updateGlobalMaterial(t,e)}updateMaterialUniform(t){this.A_e.updateUniform(t.__$uniform)}}e.default=i},"74c3":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,s){this.C6=new Map,this.C7=new Map,this.C8=[],this.C9=0,this.C_A=0,this.C_B=128,this.BR=!1,this.C_C=16,this.A=0,this.x=null,this.C_D=null,this.unlocked=!0,this.A=t,this.x=e,this.C_D=s}setVtxUpdateTimesTotal(t){this.C_C=t>4?t:4}createResByParams3(t,e,s,i){return!1}getRCUid(){return this.A}getRC(){return this.x}hasResUid(t){return this.C6.has(t)}bindToGpu(t){}getGpuBuffer(t){return null}renderBegin(){this.C_D.renderBegin()}getVertexResTotal(){return this.C9}updateDataToGpu(t,e){e?(this.C8.push(t),this.BR=!0):this.C6.has(t)&&this.C6.get(t).updateToGpu(this.C_D)}addVertexRes(t){this.C6.has(t.resUid)||(t.waitDelTimes=0,this.C6.set(t.resUid,t),this.C9++)}getVertexRes(t){return this.C6.get(t)}destroyRes(t){this.C6.has(t)&&this.C6.get(t).destroy(this.C_D)}__$attachRes(t){if(this.C6.has(t)){this.C_A++;let e=this.C6.get(t);e.getAttachCount()<1&&this.C7.has(t)&&this.C7.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.C6.has(t)&&this.C6.has(t)){let e=this.C6.get(t);e.getAttachCount()>0&&(this.C_A--,e.__$detachThis(),e.getAttachCount()<1&&this.C7.set(t,e))}}getVROByResUid(t,e,s){let i=this.C6.get(t);return null!=i?i.createVRO(this.C_D,e,s):null}update(){if(this.BR){let t=this.C8.length;if(t>0){let e;t>this.C_C&&(t=this.C_C);for(let s=0;s<t;++s)e=this.C8.shift(),this.C6.has(e)&&this.C6.get(e).updateToGpu(this.C_D)}else this.BR=!1}if(this.C_B--,this.C_B<1){this.C_B=128;for(const[t,e]of this.C7)e.waitDelTimes++,e.getAttachCount()<1?e.waitDelTimes>5&&(this.C6.delete(e.resUid),this.C7.delete(e.resUid),e.destroy(this.C_D),this.C9--):this.C7.delete(e.resUid)}}}e.ROVertexResource=i,e.default=i},"765c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("1710"));class r{constructor(){this.T=0,this.C_E=null,this.C_F=null,this.C_G=null,this.C_H=!0,this.Q=new a.default,this.C_I=new a.default,this.C_J=new a.default,this.C_K=new Float32Array(64),this.C_L=new Float32Array(64),this.C_M=new Float32Array(64),this.C_N=new Float32Array(64),this.C_O=0,this.C_P=null,this.C_Q=null,this.C_R=-1,this.T=r.F_j++}initialize(t,e){null==this.C_E&&(this.C_E=t,this.C_F=e,t.addEventListener(a.default.MOUSE_DOWN,this,this.mouseDownListener,!0,!1),t.addEventListener(a.default.MOUSE_UP,this,this.mouseUpListener,!0,!1),t.addEventListener(a.default.MOUSE_CLICK,this,this.mouseClickListener,!0,!1),t.addEventListener(a.default.MOUSE_MOVE,this,this.mouseMoveListener,!0,!1),t.addEventListener(a.default.MOUSE_WHEEL,this,this.mouseWheeelListener,!0,!1))}setRaySelector(t){this.C_G=t}mouseWheeelListener(t){null!=this.C_F&&(this.C_F.mouseX=this.C_E.mouseX,this.C_F.mouseY=this.C_E.mouseY),this.C_K[this.C_O]=t.type,this.C_L[this.C_O]=t.mouseX,this.C_M[this.C_O]=t.mouseY,this.C_N[this.C_O]=t.wheelDeltaY,this.Q.type=t.type,this.C_O++}mouseMoveListener(t){null!=this.C_F&&(this.C_F.mouseX=this.C_E.mouseX,this.C_F.mouseY=this.C_E.mouseY),this.C_K[this.C_O]=t.type,this.C_L[this.C_O]=t.mouseX,this.C_M[this.C_O]=t.mouseY,this.C_N[this.C_O]=0,this.Q.type=t.type,this.C_O++}mouseDownListener(t){null!=this.C_F&&(this.C_F.mouseX=this.C_E.mouseX,this.C_F.mouseY=this.C_E.mouseY),r.GV&&(this.C_K[this.C_O]=t.type,this.C_L[this.C_O]=t.mouseX,this.C_M[this.C_O]=t.mouseY,this.C_N[this.C_O]=0,this.Q.type=t.type,this.C_O++)}mouseUpListener(t){null!=this.C_F&&(this.C_F.mouseX=this.C_E.mouseX,this.C_F.mouseY=this.C_E.mouseY),r.GV&&(this.C_K[this.C_O]=t.type,this.C_L[this.C_O]=t.mouseX,this.C_M[this.C_O]=t.mouseY,this.C_N[this.C_O]=0,this.Q.type=t.type,this.C_O++)}mouseClickListener(t){null!=this.C_F&&(this.C_F.mouseX=this.C_E.mouseX,this.C_F.mouseY=this.C_E.mouseY),r.GV&&(this.C_K[this.C_O]=t.type,this.C_L[this.C_O]=t.mouseX,this.C_M[this.C_O]=t.mouseY,this.C_N[this.C_O]=0,this.Q.type=t.type,this.C_O++)}mouseOutEventTarget(){if(null!=this.C_F&&(this.C_F.mouseX=this.C_E.mouseX,this.C_F.mouseY=this.C_E.mouseY),null!=this.C_P){let t=this.C_P.getEvtDispatcher(a.default.EventClassType);if(null!=t)return this.C_J.phase=this.C_R,this.C_J.type=a.default.MOUSE_OUT,this.C_J.mouseX=this.Q.mouseX,this.C_J.mouseY=this.Q.mouseY,this.C_J.target=this.C_P,this.C_G.getRay(this.C_J.raypv,this.C_J.raytv),this.C_P=null,t.dispatchEvt(this.C_J);this.C_P=null}return 0}run(t,e){let s=-1;if(this.C_H){this.C_R=t;let i=0;s=this.C_O>0?0:-1;let n,h,l,o=null;if(s>-1){if(this.C_F!=this.C_E&&null!=this.C_F){for(r.GV=!1,i=0;i<this.C_O;i++)switch(this.C_K[i]){case a.default.MOUSE_DOWN:this.C_F.mouseDown(1);break;case a.default.MOUSE_UP:this.C_F.mouseUp(1);break;case a.default.MOUSE_MOVE:this.C_F.mouseMove();break;default:break}r.GV=!0}if(n=e<1?this.C_G.getSelectedNode():null,null!=n){h=n.lpv,l=n.wpv;let e=n.entity;o=e.getEvtDispatcher(a.default.EventClassType);let i=e.__$getParent(),r=null!=i&&i.mouseEnabled;r||(s+=this.mouseOutContainer(t,null,null,null),this.C_Q=null);let _=this.C_P;for(let m=0;m<this.C_O;m++)this.Q.type=this.C_K[m],this.Q.mouseX=this.C_L[m],this.Q.mouseY=this.C_M[m],this.Q.wheelDeltaY=this.C_N[m],this.Q.type>0&&null!=n&&null!=o&&(this.Q.target=e,this.Q.currentTarget=e,this.Q.phase=t,this.Q.lpos.copyFrom(h),this.Q.wpos.copyFrom(l),this.C_G.getRay(this.Q.raypv,this.Q.raytv),s+=this.mouseOutEntity(t,e,h,l),this.C_P!=e&&(this.C_I.phase=t,this.C_I.type=a.default.MOUSE_OVER,this.C_I.mouseX=this.Q.mouseX,this.C_I.mouseY=this.Q.mouseY,this.C_I.target=e,this.C_I.currentTarget=e,this.C_I.lpos.copyFrom(h),this.C_I.wpos.copyFrom(l),this.C_G.getRay(this.C_I.raypv,this.C_I.raytv),s+=o.dispatchEvt(this.C_I)),s+=o.dispatchEvt(this.Q),this.C_P=e);if(r){null!=_&&null==_.__$getParent()&&(this.C_P=_,s+=this.mouseOutEntity(t,null,null,null),this.C_P=null);for(let r=0;r<this.C_O;r++)this.Q.type=this.C_K[r],this.Q.mouseX=this.C_L[r],this.Q.mouseY=this.C_M[r],this.Q.wheelDeltaY=this.C_N[r],this.Q.type>0&&null!=n&&(this.Q.target=i,this.Q.currentTarget=e,this.Q.phase=t,this.Q.lpos.copyFrom(h),this.Q.wpos.copyFrom(l),this.C_G.getRay(this.Q.raypv,this.Q.raytv),s+=this.mouseOutContainer(t,i,h,l),this.C_Q!=i&&(this.C_I.phase=t,this.C_I.type=a.default.MOUSE_OVER,this.C_I.mouseX=this.Q.mouseX,this.C_I.mouseY=this.Q.mouseY,this.C_I.target=i,this.C_I.currentTarget=e,this.C_I.lpos.copyFrom(h),this.C_I.wpos.copyFrom(l),this.C_G.getRay(this.C_I.raypv,this.C_I.raytv),s+=i.dispatchEvt(this.C_I)),s+=i.dispatchEvt(this.Q),this.C_Q=i)}}else if(this.mouseOutEntity(t,null,null,null),this.mouseOutContainer(t,null,null,null),this.C_P=null,this.C_Q=null,s+=this.mouseOutEventTarget(),null!=this.C_F)for(i=0;i<this.C_O;i++)switch(this.C_K[i]){case a.default.MOUSE_DOWN:this.C_F.mouseBgDown();break;case a.default.MOUSE_UP:this.C_F.mouseBgUp();break;case a.default.MOUSE_CLICK:this.C_F.mouseBgClick();break;default:break}if(null!=this.C_F){for(r.GV=!1,i=0;i<this.C_O;i++)switch(this.C_K[i]){case a.default.MOUSE_DOWN:this.C_F.mouseDown(2);break;case a.default.MOUSE_UP:this.C_F.mouseUp(2);break;default:break}r.GV=!0}}0==s&&null!=o&&(s=o.passTestPhase(t))}return s>0?1:0}mouseOutEntity(t,e,s,i){if(null!=this.C_P&&this.C_P!=e){let e=this.C_P.getEvtDispatcher(a.default.EventClassType);if(null!=e)return this.C_J.phase=t,this.C_J.type=a.default.MOUSE_OUT,this.C_J.mouseX=this.Q.mouseX,this.C_J.mouseY=this.Q.mouseY,this.C_J.target=this.C_P,this.C_I.currentTarget=this.C_P,null!=s&&this.C_J.lpos.copyFrom(s),null!=i&&this.C_J.wpos.copyFrom(i),this.C_G.getRay(this.C_J.raypv,this.C_J.raytv),e.dispatchEvt(this.C_J)}return 0}mouseOutContainer(t,e,s,i){return null!=this.C_Q&&this.C_Q!=e?(this.C_J.phase=t,this.C_J.type=a.default.MOUSE_OUT,this.C_J.mouseX=this.Q.mouseX,this.C_J.mouseY=this.Q.mouseY,this.C_J.target=this.C_Q,this.C_J.currentTarget=null,null!=s&&this.C_J.lpos.copyFrom(s),null!=i&&this.C_J.wpos.copyFrom(i),this.C_G.getRay(this.C_J.raypv,this.C_J.raytv),this.C_Q.dispatchEvt(this.C_J)):0}runEnd(){this.C_O=0,this.Q.type=0}reset(){this.C_O=0}getEvtType(){return this.Q.type}isSelected(){return null!=this.C_G.getSelectedNode()}lock(){this.C_H=!1}unlock(){this.C_H=!0}isUnlock(){return this.C_H}}r.GV=!0,r.F_j=0,e.default=r},7696:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("264c")),r=i(s("5f3c"));class n{constructor(t,e,s,i,a,r){this.A=-1,this.C_S=-1,this.C_T=0,this.A_j=!0,this.C_U=[],this.C_V=0,this.C_W=new Int8Array(n.GW),this.C_X=n.GW,this.A_e=null,this.Bc=null,this.AX=null,this.Bd=null,this.C_Y=null,this.C_Z=null,this.A_g=null,this.Be=!0,this.Bf=!0,this.C_a=!1,this.C_b=0,this.uid=-1,this.A_e=t,this.Bc=e,this.AX=s,this.Bd=i,this.C_Y=this.createBlock(),this.Be=a,this.Bf=r;for(let n=0;n<this.C_X;++n)this.C_W[n]=-1}createBlock(){let t=new r.default(this.A_e);return t.rpoNodeBuilder=this.Bc,t.rpoUnitBuilder=this.AX,t.vtxResource=this.Bd,t}setRenderParam(t,e){this.C_V<1&&(this.Be=t,this.Bf=e)}setRendererParam(t,e){this.Aj=t,this.A=t.getRCUid(),this.C_S=e}getUid(){return this.uid}getRCUid(){return this.A}getRPIndex(){return this.C_S}hasSorter(){return null!=this.A_g}setSorter(t){this.A_g=t,null!=this.C_Z&&this.C_Z.setSorter(t)}setSortEnabled(t){this.C_T<1?this.C_a=t:null!=this.C_Z&&(this.C_Z.sortEnabled=t)}getSortEnabled(){return this.C_a}getUnitsTotal(){return this.C_T}addNodeToBlock(t){let e=null;if(t.shdUid>=n.GW)throw Error("Shader uid >= "+n.GW);this.C_W[t.shdUid]<0?(e=this.createBlock(),e.batchEnabled=this.Be,e.fixedState=this.Bf,e.batchEnabled?e.fixedState?e.runMode=2:e.runMode=1:e.runMode=0,e.shdUid=t.shdUid,e.index=this.C_V,e.procuid=this.C_S,this.C_U.push(e),this.C_W[t.shdUid]=this.C_V,++this.C_V):e=this.C_U[this.C_W[t.shdUid]],t.index=e.index,e.addNode(t)}rejoinRunitForTro(t){let e=this.Bc.getNodeByUid(t.__$rpuid);null!=e&&(e.tro=t.tro,e.texMid=e.unit.texMid,this.C_U[e.index].rejoinNode(e))}rejoinRunitForVro(t){let e=this.Bc.getNodeByUid(t.__$rpuid);null!=e&&(e.drawMode=t.drawMode,e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,e.vtxUid=t.vtxUid,e.vro=t.vro,this.C_U[e.index].rejoinNode(e),this.C_b++)}addDisp(t){if(null!=t&&null!=t.__$$runit&&t.__$$runit.getRPROUid()<0&&t.__$$runit.getRPROUid()!=this.uid){let e=this.Bc.create();e.unit=this.AX.getNodeByUid(t.__$ruid),e.unit.shader=this.A_e,e.unit.__$rprouid=this.uid,t.__$rpuid=e.uid,e.__$ruid=t.__$ruid,e.unit.__$rpuid=e.uid,e.updateData(),++this.C_T,this.AX.setRPNodeParam(t.__$ruid,this.getUid(),e.uid),this.C_a?(null!=this.C_Z||(this.C_Z=new a.default(this.A_e),this.C_Z.setSorter(this.A_g)),this.C_Z.addNode(e)):this.addNodeToBlock(e),this.C_b++}}updateDispMateiral(t){if(null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),s=this.Bc.getNodeByUid(e);s.shdUid=s.unit.shdUid,s.texMid=s.unit.texMid,s.tro=s.unit.tro;let i=this.C_U[s.index];i.removeNode(s),this.addNodeToBlock(s)}}removeDisp(t){if(null!=t&&null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),s=this.Bc.getNodeByUid(e);if(null!=s){if(null==this.C_Z){let t=this.C_U[s.index];t.removeNode(s)}else this.C_Z.removeNode(s);this.AX.setRPNodeParam(t.__$ruid,this.getUid(),-1),--this.C_T;let e=s.unit;this.Bc.restore(s)&&this.AX.restore(e),this.Bd.__$detachRes(t.vbuf.getUid()),t.__$$runit=null,t.__$ruid=-1,this.C_b++}}}getStatus(){return this.C_b}removeDispUnit(t){if(null!=t&&t.__$ruid>-1){let e=t.__$$runit.getRPOUid(),s=this.Bc.getNodeByUid(e);if(null!=s){if(null==this.C_Z){let t=this.C_U[s.index];t.removeNode(s)}else this.C_Z.removeNode(s);this.AX.setRPNodeParam(t.__$ruid,this.C_S,-1),s.unit.__$rprouid=-1,--this.C_T,this.Bc.restore(s)}}}update(){this.A_j&&this.C_T>0&&null!=this.C_Z&&this.C_Z.update()}run(){if(this.A_j&&this.C_T>0){let t=this.Aj;if(null==this.C_Z)if(this.A_e.isUnLocked())for(let e=0;e<this.C_V;++e)this.C_U[e].run(t);else for(let e=0;e<this.C_V;++e)this.C_U[e].runLockMaterial(t);else this.A_e.isUnLocked()?this.C_Z.run(t):this.C_Z.runLockMaterial(t)}}drawDisp(t,e=!1,s=!0){if(null!=t){let i=t.__$$runit;null!=i&&(this.A_e.isUnLocked()?(s&&this.A_e.resetUniform(),this.C_Y.drawUnit(this.Aj,i,t)):this.C_Y.drawLockMaterialByUnit(this.Aj,i,t,e,s))}}drawLockMaterialByDisp(t,e=!1,s=!0){if(null!=t){let i=t.__$$runit;null!=i&&this.C_Y.drawLockMaterialByUnit(this.Aj,i,t,e,s)}}reset(){this.C_a=!1,this.C_T=0,this.uid=-1,this.C_S=-1,this.A=-1,this.C_S=-1;let t=0;for(;t<this.C_V;++t)this.C_U[t].reset();this.C_V=0,this.C_U=[],this.Bc=null,this.AX=null,this.Bd=null,this.Aj=null,null!=this.C_Z&&(this.C_Z.clear(),this.C_Z=null)}showInfo(){let t=0;for(;t<this.C_V;++t)this.C_U[t].showInfo()}destroy(){this.reset()}setEnabled(t){this.A_j=t}getEnabled(){return this.A_j}toString(){return"[RenderProcess(uid = "+this.C_S+")]"}}n.GW=1024,e.default=n},"76b0":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("35fa")),r=i(s("8a0a")),n=i(s("fecb")),h=i(s("cb29")),l=i(s("e7d2")),o=s("e08e"),_=i(s("3930"));class m extends h.default{constructor(t=r.default.VTX_STATIC_DRAW){super(t),this.color0=new _.default,this.color1=new _.default,this.color2=new _.default,this.color3=new _.default,this.offsetU=0,this.offsetV=0,this.uScale=1,this.vScale=1,this.flipVerticalUV=!1,this.axisFlag=0,this.C_c=!0,this.BV=null,this.BW=null,this.BX=null,this.BY=null,this.C_d=null,this.C_e=null,this.vsFloat32=null,this.dataStepList=null}getVS(){return this.BV}getUVS(){return this.BW}setUVS(t){null!=t&&8==t.length&&(null==this.BW?this.BW=t.slice(0):this.BW.set(t))}getNVS(){return this.BX}getCVS(){return this.BY}initialize(t,e,s,i){if(null!=this.BV)return;let h=t,_=e,m=t+s,u=e+i,d=0;switch(this.BZ=new Uint16Array([0,1,2,0,2,3]),this.axisFlag){case 0:this.BV=new Float32Array([h,_,d,m,_,d,m,u,d,h,u,d]);break;case 1:this.BV=new Float32Array([m,d,_,h,d,_,h,d,u,m,d,u]);break;case 2:this.BV=new Float32Array([d,h,_,d,m,_,d,m,u,d,h,u]);break;default:break}if(null==this.bounds&&(this.bounds=new n.default),this.bounds.addXYZFloat32Arr(this.BV),this.bounds.updateFast(),l.default.Reset(),l.default.AddFloat32Data(this.BV,3),null==this.BW&&this.isVBufEnabledAt(r.default.VBUF_UVS_INDEX)&&(this.flipVerticalUV?this.BW=new Float32Array([this.offsetU+0*this.uScale,this.offsetV+1*this.vScale,this.offsetU+1*this.uScale,this.offsetV+1*this.vScale,this.offsetU+1*this.uScale,this.offsetV+0*this.vScale,this.offsetU+0*this.uScale,this.offsetV+0*this.vScale]):this.BW=new Float32Array([this.offsetU+0*this.uScale,this.offsetV+0*this.vScale,this.offsetU+1*this.uScale,this.offsetV+0*this.vScale,this.offsetU+1*this.uScale,this.offsetV+1*this.vScale,this.offsetU+0*this.uScale,this.offsetV+1*this.vScale])),this.isVBufEnabledAt(r.default.VBUF_NVS_INDEX))switch(this.axisFlag){case 0:this.BX=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]);break;case 1:this.BX=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0]);break;case 2:this.BX=new Float32Array([1,0,0,1,0,0,1,0,0,1,0,0]);break;default:break}if(this.isVBufEnabledAt(r.default.VBUF_CVS_INDEX)&&(this.BY=new Float32Array([this.color0.r,this.color0.g,this.color0.b,this.color1.r,this.color1.g,this.color1.b,this.color2.r,this.color2.g,this.color2.b,this.color3.r,this.color3.g,this.color3.b])),this.isVBufEnabledAt(r.default.VBUF_TVS_INDEX)){let t=2;this.C_d=new Float32Array(12),this.C_e=new Float32Array(12),a.default.ClacTrisTangent(this.BV,this.BV.length,this.BW,this.BX,t,this.BZ,this.C_d,this.C_e)}this.drawMode=o.RenderDrawMode.ELEMENTS_TRIANGLES,this.buildVbuf(),this.vtxTotal=4,this.trisNumber=2,this.buildEnd()}reinitialize(){this.buildVbuf()}buildVbuf(){l.default.Reset(),l.default.AddFloat32Data(this.BV,3),this.isVBufEnabledAt(r.default.VBUF_UVS_INDEX)&&l.default.AddFloat32Data(this.BW,2),this.isVBufEnabledAt(r.default.VBUF_NVS_INDEX)&&l.default.AddFloat32Data(this.BX,3),this.isVBufEnabledAt(r.default.VBUF_CVS_INDEX)&&l.default.AddFloat32Data(this.BY,3),this.isVBufEnabledAt(r.default.VBUF_TVS_INDEX)&&(l.default.AddFloat32Data(this.C_d,3),l.default.AddFloat32Data(this.C_e,3)),l.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.updateWireframeIvs(),this.vtCount=this.BZ.length,null!=this.Bb?(this.forceUpdateIVS&&this.Bb.setUintIVSData(this.BZ),l.default.UpdateBufData(this.Bb)):this.Bb=l.default.CreateBySaveData(this.getBufDataUsage(),this.getBufSortFormat()),this.Bb.setUintIVSData(this.BZ),this.buildEnd()}isPolyhedral(){return this.C_c}setPolyhedral(t){this.C_c=t}testRay(t,e,s,i){if(this.C_c)return-1;if(i){let i=n.default.IntersectionRL2(e,t,this.bounds,s);return i?1:-1}return-1}toString(){return"[RectPlaneMesh()]"}__$destroy(){this.isResFree()&&(this.bounds=null,this.BV=null,this.BW=null,this.BX=null,this.BY=null,super.__$destroy())}}e.default=m},"77cf":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("ab73")),r=i(s("3077")),n=s("5216"),h=s("a9bf"),l=s("c70f");class o{constructor(t=0){this.T=-1,this.C_f=new l.GlobalEnvLightUniformParam,this.C_g=null,this.C_h=null,this.C_i=!1,this.C_j=0,this.C_k=!0,this.C_l=!0,this.C_m=null,this.C_j=t,this.T=o.F_j++}setEnvAmbientMap(t){null==this.C_m&&null!=t&&(this.C_m=t,this.C_m.__$attachThis())}getUid(){return this.T}setAmbientColorRGB3f(t,e,s){let i=a.default.EnvLightParams.data;i[0]=t,i[1]=e,i[2]=s,this.C_i=!0}setFogColorRGB3f(t,e,s){let i=a.default.EnvLightParams.data;i[8]=t,i[9]=e,i[10]=s,this.C_i=!0}setFogDensity(t){a.default.EnvLightParams.data[11]=t,this.C_i=!0}setFogNear(t){a.default.EnvLightParams.data[6]=t,this.C_i=!0}setFogFar(t){a.default.EnvLightParams.data[7]=t,this.C_i=!0}setFogAreaOffset(t,e){a.default.EnvLightParams.data[12]=t,a.default.EnvLightParams.data[13]=e,this.C_i=!0}setFogAreaSize(t,e){a.default.EnvLightParams.data[14]=t,a.default.EnvLightParams.data[15]=e,this.C_i=!0}setEnvAmbientLightAreaOffset(t,e){a.default.EnvLightParams.data[16]=t,a.default.EnvLightParams.data[17]=e,this.C_i=!0}setEnvAmbientLightAreaSize(t,e){a.default.EnvLightParams.data[18]=t,a.default.EnvLightParams.data[19]=e,this.C_i=!0}resetPipe(){this.C_k=!0,this.C_l=!0}getTextures(t,e,s){return null!=this.C_m&&s==n.MaterialPipeType.ENV_AMBIENT_LIGHT?(null==e&&(e=[]),e.push(this.C_m),t.uniform.add2DMap("VOX_ENV_AMBIENT_LIGHT_LIGHT_MAP",!0,!0,!1),e):null}useShaderPipe(t,e){if(null!=this.C_g)switch(e){case n.MaterialPipeType.ENV_LIGHT_PARAM:this.buildUniformCode(t);break;case n.MaterialPipeType.FOG:case n.MaterialPipeType.FOG_EXP2:this.buildUniformCode(t),this.useFogData(t,e==n.MaterialPipeType.FOG_EXP2,!0);break;case n.MaterialPipeType.ENV_AMBIENT_LIGHT:this.buildUniformCode(t);break;default:break}}getPipeTypes(){return[n.MaterialPipeType.ENV_LIGHT_PARAM,n.MaterialPipeType.FOG,n.MaterialPipeType.FOG_EXP2,n.MaterialPipeType.ENV_AMBIENT_LIGHT]}getPipeKey(t){switch(t){case n.MaterialPipeType.ENV_LIGHT_PARAM:case n.MaterialPipeType.FOG:case n.MaterialPipeType.FOG_EXP2:case n.MaterialPipeType.ENV_AMBIENT_LIGHT:return"["+t+"]";default:break}return""}useUniforms(t){null!=this.C_g&&t.addFragUniformParam(a.default.EnvLightParams)}buildUniformCode(t){this.C_l&&(this.C_l=!1,this.C_f.use(t))}useFogData(t,e,s){t.addDefine("VOX_USE_FOG","1"),e&&t.addDefine("VOX_FOG_EXP2","1"),t.addVarying("float","v_fogDepth"),this.useShaderCode(t,s)}useShaderCode(t,e){this.C_k&&(this.C_k=!1,e?t.addShaderObject(h.EnvShaderCode):t.addShaderObjectHead(h.EnvShaderCode))}initialize(){null==this.C_g&&(this.C_g=new r.default,this.C_g.bindSlotAt(this.C_j),this.C_g.addVec4Data(a.default.EnvLightParams.data,a.default.EnvLightParams.arrayLength),this.C_h=this.C_f.createGlobalUinform(this.C_g),this.C_g.update())}update(){null!=this.C_g&&this.C_i&&(this.C_i=!1,this.C_g.update())}getGlobalUinform(){return this.C_h.clone()}}o.F_j=0,e.default=o},"78e9":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("644c"));class r{constructor(){this.type=-1,this.typeName="",this.name="",this.isArray=!1,this.arrLength=0,this.isTex=!1,this.location=null}parseCode(t){const e=";";let s=t.indexOf(e);if(s<0)return!1;const i=" ";t=t.replace(/^\s*|\s*$/g,""),s>0&&(t=t.slice(0,s));let r=t.split(i);return this.typeName=r[r.length-2],this.name=r[r.length-1],s=this.name.indexOf("["),this.isArray=s>0,this.arrLength=0,this.isArray&&(this.arrLength=parseInt(this.name.slice(s+1,this.name.indexOf("]",s+1))),this.name=this.name.slice(0,s),this.typeName+="[]"),this.type=a.default.GetTypeByTypeNS(this.typeName),!(this.type<0)&&(this.isTex=this.type==a.default.SHADER_SAMPLER2D||this.type==a.default.SHADER_SAMPLERCUBE||this.type==a.default.SHADER_SAMPLER3D,!0)}}e.default=r},"7a04":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("f044"));class r{constructor(){this.T=-1,this.B_o=0,this.layoutBit=0,this.C_n=null,this.C_o=null,this.C_p=null,this.C_q=null,this.C_r=null,this.C_s=null,this.C_t=0,this.T=a.default.CreateNewID()}getUid(){return this.T}getType(){return 1}getBuffersTotal(){return this.C_o.length}getAttribsTotal(){return this.C_o.length}getF32DataAt(t){return this.C_o[t]}setF32DataAt(t,e,s,i){null==this.C_o&&(this.C_o=[null,null,null,null,null,null,null,null],this.C_r=[!1,!1,!1,!1,!1,!1,!1,!1],this.C_p=[0,0,0,0,0,0,0,0],this.C_q=[0,0,0,0,0,0,0,0]),this.C_o[t]=e,null!=this.C_s&&null!=e&&(this.C_r[t]=!0),null!=i&&(this.C_n=i),this.C_t=s,null!=e&&(this.C_p[t]=e.length)}setData4fAt(t,e,s,i,a,r){t*=this.C_n[e],this.C_o[e][t++]=s,this.C_o[e][t++]=i,this.C_o[e][t++]=a,this.C_o[e][t++]=r}setData3fAt(t,e,s,i,a){t*=this.C_n[e],this.C_o[e][t++]=s,this.C_o[e][t++]=i,this.C_o[e][t++]=a}setData2fAt(t,e,s,i){t*=this.C_n[e],this.C_o[e][t++]=s,this.C_o[e][t++]=i}destroy(){this.C_o=null,this.C_r=null,this.C_p=null,this.C_q=null,this.C_o=null}toString(){return"VtxSeparatedBuf(uid = "+this.T+")"}}e.default=r},"7b0e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("bbf4"));class r{constructor(){this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rayTestState=0,this.rpoNode=null,this.spaceId=-1,this.camVisiSt=0,this.camVisi=a.default.CAMERA_VISIBLE_ENABLE}reset(){this.rayTestState=0,this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rpoNode=null,this.spaceId=-1,this.camVisi=0}static GetFreeId(){return r.X_.length>0?r.X_.pop():-1}static GetByUid(t){return t>-1&&t<r.C_v?r.C_u[t]:null}static SetCamVisiByUid(t,e){r.C_u[t].camVisi=e}static GetCamVisiByUid(t){return r.C_u[t].camVisi}static Create(){let t=null,e=r.GetFreeId();return e>=0?(t=r.C_u[e],t.uid=e,r.D_v[e]=r.S_FLAG_BUSY):(t=new r,r.C_u.push(t),r.D_v.push(r.S_FLAG_BUSY),t.uid=r.C_v,r.C_v++),t}static Restore(t){null!=t&&t.uid>=0&&r.D_v[t.uid]==r.S_FLAG_BUSY&&(r.X_.push(t.uid),r.D_v[t.uid]=r.S_FLAG_FREE,t.reset())}}r.S_FLAG_BUSY=1,r.S_FLAG_FREE=0,r.C_v=0,r.C_u=[],r.D_v=[],r.X_=[],e.default=r},"7c63":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("e08e");class a{constructor(t,e,s,i){this.T=-1,this.C_w=!0,this.C_x=!0,this.C_y=!0,this.C_z=!0,this.T=a.F_j++,this.C_w=t,this.C_x=e,this.C_y=s,this.C_z=i}getUid(){return this.T}getR(){return this.C_w}getG(){return this.C_x}getB(){return this.C_y}getA(){return this.C_z}use(){a.GX!=this.T&&(a.Rstate.setColorMask(this.C_w,this.C_x,this.C_y,this.C_z),a.GX=this.T)}static Create(t,e,s,i,r){if(a.GY.has(t)){let e=a.GY.get(t);return e.getUid()}let n=(e?64:32)|(s?16:8)|(i?4:2)|(r?1:0);if(a.GZ.has(n)){let t=a.GZ.get(n);n=t.getUid()}else{let h=new a(e,s,i,r);n=h.getUid(),a.GZ.set(n,h),a.GY.set(t,h),a.Ga.push(h),++a.Gc}return n}static GetColorMaskByName(t){if(a.GY.has(t)){let e=a.GY.get(t);return e.getUid()}return-1}static UseRenderState(t){a.Gb&&a.Rstate.roColorMask!=t&&t>-1&&t<a.Gc&&a.Ga[t].use()}static UseColorMaskByName(t){let e=a.GetColorMaskByName(t);a.Gb&&a.Rstate.roColorMask!=e&&e>-1&&e<a.Gc&&a.Ga[e].use()}static Lock(){a.Gb=!1}static Unlock(){a.Gb=!0}static Reset(){a.GX=-1}}a.F_j=0,a.GX=-1,a.Ga=[],a.Gc=1,a.GZ=new Map,a.GY=new Map,a.Gb=!0,a.ALL_TRUE_COLOR_MASK=0,a.ALL_FALSE_COLOR_MASK=1,a.Rstate=null,e.RenderColorMask=a;class r{constructor(t,e,s){this.T=-1,this.C_0=0,this.C_1=0,this.C_2=0,this.C_3=0,this.T=r.F_j++,this.C_0=t,this.C_1=e,this.C_2=s}getUid(){return this.T}getCullFaceMode(){return this.C_0}getDepthTestMode(){return this.C_2}getBlendMode(){return this.C_1}use(){if(r.GX!=this.T){r.Rstate.setCullFaceMode(this.C_0);r.Gj[r.C_1];r.C_1<0?r.Rstate.setBlendMode(this.C_1,r.Gj[this.C_1]):r.Rstate.setBlendMode(r.C_1,r.Gj[r.C_1]),r.Gh<0?r.Rstate.setDepthTestMode(this.C_2):r.Rstate.setDepthTestMode(r.Gh),r.GX=this.T}}static CreateBlendModeSeparate(t,e,s,a,n,h=0,l=0){if(null!=t&&""!=t){let o;if(r.Gd.has(t))return o=r.Gd.get(t),r.Ge.get(o);h<1&&(h=i.GLBlendEquation.FUNC_ADD),l<1&&(l=i.GLBlendEquation.FUNC_ADD);let _=1;if(o=31,o=131*o+e,o=131*o+s,a>0&&n>0&&(o=131*o+a,o=131*o+n,_=1),r.Ge.has(o))return r.Gd.set(t,o),r.Ge.get(o);let m=++r.Gf;r.Gd.set(t,o),r.Ge.set(o,m);let u=[_,h,l,e,s,a,n];return r.Gj[m]=u,m}return 0}static CreateBlendMode(t,e,s,a=0){if(null!=t&&""!=t){let n;if(r.Gd.has(t))return n=r.Gd.get(t),r.Ge.get(n);a<1&&(a=i.GLBlendEquation.FUNC_ADD);let h=0;if(n=31,n=131*n+e,n=131*n+s,r.Ge.has(n))return r.Ge.get(n);let l=++r.Gf;r.Gd.set(t,n),r.Ge.set(n,l);let o=[h,a,0,e,s,0,0];return r.Gj[l]=o,l}return 0}static Create(t,e,s,i){if(r.GY.has(t)){let e=r.GY.get(t);return e.getUid()}let a=31;if(a=131*a+i,a=131*a+s,a=131*a+e,r.GZ.has(a)){let t=r.GZ.get(a);a=t.getUid()}else{let n=new r(e,s,i);a=n.getUid(),r.GZ.set(a,n),r.GY.set(t,n),r.Ga.push(n),++r.Gc}return a}static GetRenderStateByName(t){if(r.GY.has(t)){let e=r.GY.get(t);return e.getUid()}return-1}static UseRenderState(t){r.Gb&&r.GX!=t&&t>-1&&t<r.Gc&&r.Ga[t].use()}static UseRenderStateByName(t){if(r.Gb){let e=r.GetRenderStateByName(t);r.GX!=e&&e>-1&&e<r.Gc&&r.Ga[e].use()}}static UnlockBlendMode(){r.C_1=r.Gg}static LockBlendMode(t){r.Gg=r.C_1,r.C_1=t}static UnlockDepthTestMode(){r.Gh=r.Gi}static LockDepthTestMode(t){r.Gi=r.Gh,r.Gh=t}static Lock(){r.Gb=!1}static Unlock(){r.Gb=!0}static Reset(){r.GX=-1}}r.F_j=0,r.GX=-1,r.Ga=[],r.Gc=1,r.C_1=-1,r.Gh=-1,r.GZ=new Map,r.GY=new Map,r.Gd=new Map,r.Ge=new Map,r.Gf=0,r.Gj=new Array(256),r.Gb=!0,r.Rstate=null,r.Gg=-1,r.Gi=-1,e.RenderStateObject=r;class n{constructor(){this.stencilMask=-1}}class h{constructor(){this.C_4=new Array(128),this.C_5=null,this.C_1=i.RenderBlendMode.NORMAL,this.C_6=i.CullFaceMode.NONE,this.C_7=i.DepthTestMode.DISABLE,this.C_8=!0,this.C_9=null,this.x=null,this.roColorMask=-11}reset(){this.roColorMask=-11}setRenderContext(t){this.C_9=t,this.x=t.getRC();let e=this.x.rcuid;this.C_5=this.C_4[e],null==this.C_5&&(this.C_5=this.C_4[e]=new n)}setColorMask(t,e,s,i){this.x.colorMask(t,e,s,i)}setStencilFunc(t,e,s){this.x.stencilFunc(t,e,s)}setStencilMask(t){this.C_5.stencilMask!=t&&t>=0&&(this.C_5.stencilMask=t,this.x.stencilMask(t))}setStencilOp(t,e,s){this.x.stencilOp(t,e,s)}setDepthTestEnable(t){t?this.x.enable(this.x.DEPTH_TEST):this.x.disable(this.x.DEPTH_TEST)}setCullFaceEnable(t){t?this.x.enable(this.x.CULL_FACE):this.x.disable(this.x.CULL_FACE)}setBlendEnable(t){t?this.x.enable(this.x.BLEND):this.x.disable(this.x.BLEND)}setCullFaceMode(t){this.C_6!=t&&(this.C_6=t,t!=i.CullFaceMode.NONE?(this.C_8&&(this.C_8=!1,this.x.enable(this.x.CULL_FACE)),this.x.cullFace(t)):this.C_8||(this.C_8=!0,this.x.disable(this.x.CULL_FACE)))}setBlendMode(t,e){this.C_1!=t&&(this.C_1=t,t>0?e[0]<1?(this.x.blendEquation(this.x.FUNC_ADD),this.x.blendFunc(this.x.ONE,this.x.ZERO),this.x.blendEquation(e[1]),this.x.blendFunc(e[3],e[4])):(this.x.blendEquationSeparate(e[1],e[2]),this.x.blendFuncSeparate(e[3],e[4],e[5],e[6])):this.x.disable(this.x.BLEND))}setDepthTestMode(t){if(this.C_7!=t)switch(this.C_7=t,t){case i.DepthTestMode.ALWAYS:this.x.depthMask(!1),this.x.depthFunc(this.x.ALWAYS);break;case i.DepthTestMode.SKY:this.x.depthMask(!0),this.x.depthFunc(this.x.LEQUAL);break;case i.DepthTestMode.OPAQUE:this.x.depthMask(!0),this.x.depthFunc(this.x.LESS);break;case i.DepthTestMode.OPAQUE_OVERHEAD:this.x.depthMask(!1),this.x.depthFunc(this.x.EQUAL);break;case i.DepthTestMode.DECALS:this.x.depthMask(!1),this.x.depthFunc(this.x.LEQUAL);break;case i.DepthTestMode.BLEND:this.x.depthMask(!1),this.x.depthFunc(this.x.LESS);break;case i.DepthTestMode.WIRE_FRAME:this.x.depthMask(!0),this.x.depthFunc(this.x.LEQUAL);break;case i.DepthTestMode.NEXT_LAYER:this.x.depthMask(!1),this.x.depthFunc(this.x.ALWAYS);break;case i.DepthTestMode.TRUE_EQUAL:this.x.depthMask(!0),this.x.depthFunc(this.x.EQUAL);break;case i.DepthTestMode.TRUE_GREATER:this.x.depthMask(!0),this.x.depthFunc(this.x.GREATER);break;case i.DepthTestMode.TRUE_GEQUAL:this.x.depthMask(!0),this.x.depthFunc(this.x.GEQUAL);break;case i.DepthTestMode.WIRE_FRAME_NEXT:break;default:break}}}e.RODrawState=h},"81c4":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17")),r=i(s("f48d")),n=i(s("d1a0"));class h extends r.default{constructor(){super(...arguments),this.radiusSquared=2500,this.tv=new a.default(1,0,0),this.center=new a.default(50,0,0),this.anotherPosition=new a.default(100,0,0),this.length=100}intersectionCopSLV2(t,e,s){a.default.Cross(this.tv,e,r.default.__tV1),a.default.Cross(this.tv,r.default.__tV1,r.default.__tV2),r.default.__tV2.normalize(),n.default.IntersectionSLV2(r.default.__tV2,r.default.__tV2.dot(this.position),t,e,s),r.default.__tV2.x=s.x-this.position.x,r.default.__tV2.y=s.y-this.position.y,r.default.__tV2.z=s.z-this.position.z;let i=r.default.__tV2.dot(this.tv);i<0?s.copyFrom(this.position):i>this.length&&s.copyFrom(this.anotherPosition)}update(){this.tv.x=this.anotherPosition.x-this.position.x,this.tv.y=this.anotherPosition.y-this.position.y,this.tv.z=this.anotherPosition.z-this.position.z,this.length=this.tv.getLength(),this.tv.x*=.5,this.tv.y*=.5,this.tv.z*=.5,this.center.x=this.position.x+this.tv.x,this.center.y=this.position.y+this.tv.y,this.center.z=this.position.z+this.tv.z,this.radiusSquared=this.tv.getLengthSquared(),this.tv.normalize()}updateFast(){this.update()}}e.default=h},"81ce":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Es2VtxShderToES3(t){let e=t;const s="attribute",i="varying ";let a=e.indexOf(s),r=0;while(a>=0)e=e.slice(0,a)+"layout(location="+r+") in"+e.slice(a+9),a=e.indexOf(s),r++;let n=new RegExp(i,"g");return e=e.replace(n,"out "),"#version 300 es\n"+e}static Es2FragShderToES3(t){let e=t;const s="gl_FragColor",i="varying ";let a=e.indexOf(s),r=0,n="FragColorOut_"+r;a>=0&&(e=e.slice(0,a)+n+e.slice(a+12)),a=e.indexOf("void "),e=e.slice(0,a)+"out vec4 "+n+";\n"+e.slice(a);let h=new RegExp(i,"g");return e=e.replace(h,"in "),h=new RegExp(" texture2D","g"),e=e.replace(h," texture"),h=new RegExp(" textureCube","g"),e=e.replace(h," texture"),"#version 300 es\n"+e}static Es3VtxShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const s=/\blayout\b.+\bin\b/g;t=t.replace(s,"attribute");const a=/\bout\b/g;t=t.replace(a,"varying");const r=/\btexture\b/g;t=t.replace(r,"texture2D"),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version"));let n=0,h=0,l=t.indexOf("inverse(");l<0&&(l=t.indexOf("inverse ("));let o="",_=!1,m=!1;while(l>3){if(n=t.indexOf(")",l+2),o=t.slice(l+2,n),o.indexOf("mat3")>0)_=!0;else if(o=o.replace(/\s+/g,""),n=o.indexOf("("),o=o.slice(n+1),n=t.indexOf(o,1),h=t.lastIndexOf("mat",n),h>0)switch(o=t.slice(h,n),o=o.replace(/\s+/g,""),o){case"mat3":_=!0;break;case"mat4":m=!0;break}if(l=t.indexOf("inverse(",l+5),l<0&&(l=t.indexOf("inverse (",l+5)),_&&m)break}n=0,l=t.indexOf("transpose("),l<0&&(l=t.indexOf("transpose (")),o="";let u=!1,d=!1;while(l>3){if(n=t.indexOf(")",l+2),o=t.slice(l+2,n+1),o.indexOf("mat3")>0)u=!0;else if(o=o.replace(/\s+/g,""),n=o.indexOf("("),o=o.slice(n+1),n=t.indexOf(o,1),h=t.lastIndexOf("mat",n),h>0)switch(o=t.slice(h,n),o=o.replace(/\s+/g,""),o){case"mat3":u=!0;break;case"mat4":d=!0;break}if(l=t.indexOf("transpose(",l+5),l<0&&(l=t.indexOf("transpose (",l+5)),u&&d)break}return(_||m)&&(l=t.indexOf("void "),l>10&&(_&&m?t=t.slice(0,l)+i.__glslInverseMat3+i.__glslInverseMat4+t.slice(l):_?t=t.slice(0,l)+i.__glslInverseMat3+t.slice(l):m&&(t=t.slice(0,l)+i.__glslInverseMat4+t.slice(l)))),(u||d)&&(l=t.indexOf("void "),l>10&&(u&&d?t=t.slice(0,l)+i.__glslTransposeMat3+i.__glslTransposeMat4+t.slice(l):u?t=t.slice(0,l)+i.__glslTransposeMat3+t.slice(l):d&&(t=t.slice(0,l)+i.__glslTransposeMat4+t.slice(l)))),t}static Es3FragShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const s=new RegExp(" in ","g");t=t.replace(s,"_fref_");const i=/\bin\b/g;t=t.replace(i,"varying");const a=new RegExp("_fref_","g");t=t.replace(a," in ");const r=/\btexture\b/g;t=t.replace(r,"texture2D");const n=/" "/g;let h=t;const l=";",o="layout";let _=h.indexOf(o),m=0,u=0,d="",c="",f=0,p=null,g=[],v=[];while(_>=0)m=h.indexOf(l,_+1),d=h.slice(_+1,m),c=d.slice(d.lastIndexOf(" ")+1),f=d.indexOf(")"),_=d.lastIndexOf("=",f)+1,d=d.slice(_+1,f),f=parseInt(d.replace(n,"")),g.push(c),v.push(f),_=h.indexOf(o,m);let x=g.length;if(x>0)if(p=/layout/g,t=t.replace(p,"//layout"),x>1){_=0;while(_<x)p=new RegExp(g[_],"g"),t=t.replace(p,"gl_FragData["+v[_]+"]"),++_}else p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor");else _=h.indexOf("out "),_>0&&(m=h.indexOf(l,_+1),d=h.slice(_+1,m),c=d.slice(d.lastIndexOf(" ")+1),p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor"),p=/\bout\b/g,t=t.replace(p,"//out"));x>1&&(t="#extension GL_EXT_draw_buffers: require\n"+t),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version")),_=0;for(let T=0;T<16;++T){if(_=t.indexOf("samplerCube ",_),!(_>0))break;{m=t.indexOf(";",_),d=h.slice(_+12,m),c="";let e=d.split(" ");for(let t=0;t<16;++t)if(""!=e[t]){c=e[t];break}for(x=0;x<16;++x){if(m=t.indexOf(c,m+1),!(m>0))break;if(u=t.lastIndexOf("texture2D",m-1),u<0)break;d=t.slice(u,m),t=t.slice(0,u)+"textureCube("+t.slice(m),m+=2}}_+=4}return t}}i.__glslTransposeMat3="\n    mat3 transpose(mat3 m) {\n        return mat3(m[0][0],m[1][0],m[2][0],\n            m[0][1],m[1][1],m[2][1],\n            m[0][2],m[1][2],m[2][2]);\n    }\n    ",i.__glslTransposeMat4="\n    mat4 transpose(mat4 m) {\n        return mat4(m[0][0],m[1][0],m[2][0],m[3][0],\n            m[0][1],m[1][1],m[2][1],m[3][1],\n            m[0][2],m[1][2],m[2][2],m[3][2],\n            m[0][3],m[1][3],m[2][3],m[3][3]);\n    }\n    ",i.__glslInverseMat3="\n    mat3 inverse(mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];  \n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;  \n        float det = a00 * b01 + a01 * b11 + a02 * b21;  \n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n    ",i.__glslInverseMat4="\n    mat4 inverse(mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n        }\n    ",e.default=i},"829f":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("cfaf")),r=i(s("bd6f")),n=i(s("6661")),h=i(s("29ef")),l=i(s("85b6")),o=i(s("baae"));class _{constructor(t,e=2){if(this.C_=2,this.B_6=null,this.DA=null,this.DB=null,this.DC=null,this.DD=null,this.DE=[null,null],this.DF=null,this.DG=!1,this.DH=6,this.DI=2,this.DJ=-1,this.DK=!0,this.DL=0,this.DM=0,this.DN=null,this.B_6=t,e>=0&&e<3&&(this.C_=e),null==this.DF){this.DF=[null,null];let t=new l.default(32,32,!0);t.__$setRenderProxy(this.B_6.getRenderProxy());let e=new l.default(32,32,!0);e.__$setRenderProxy(this.B_6.getRenderProxy()),this.DF[0]=t,this.DF[1]=e,this.DE=[new a.default(32,32),new a.default(32,32)],t.attachTex(this.DE[0]),e.attachTex(this.DE[1])}}bindSrcProcessId(t){this.DJ=t}bindSrcProcess(t){this.DJ=t.getRPIndex()}bindDrawEntity(t){this.DN=t}setBackbufferVisible(t){this.DG=t}setSyncViewSizeEnabled(t){this.DK=t}setBlurCount(t){t<1&&(t=1),this.DH=t}setBlurDensity(t){this.DI=t}setFBOSize(t,e){(Math.abs(this.DL-t)>.1||Math.abs(this.DM-e))&&(this.DL=t,this.DM=e,this.DK=!1,null!=this.DE[0]&&this.DE[0].setSize(t,e),null!=this.DE[1]&&this.DE[1].setSize(t,e))}getDstTexture(){return this.getTextureAt(this.DH%2)}swapTextureAt(t,e){t>0&&t<2&&null!=e&&e!=this.DE[t]&&(this.DE[t]=e,this.DF[t].attachTex(e))}getTextureAt(t){return null!=this.DE[t]?(this.DL*this.DM>0?this.DE[t].setSize(this.DL,this.DM):this.DE[t].setSize(this.B_6.getViewWidth(),this.B_6.getViewHeight()),this.DE[t]):null}updateState(t){if(null==this.DA){let t=0,e=1;switch(this.C_){case _.HORIZONTAL:e=0;break;case _.VERTICAL:t=1;break;default:break}this.DD=new n.default(e),this.DD.setBlurDensity(this.DI);let s=new r.default;s.setMaterial(this.DD),s.initializeXOY(-1,-1,2,2,[this.DF[0]]),s.setRenderState(h.default.BACK_NORMAL_ALWAYS_STATE),this.DA=s,this.DC=new n.default(t),this.DC.setBlurDensity(this.DI),s=new r.default,s.setMaterial(this.DC),s.copyMeshFrom(this.DA),s.initializeXOY(-1,-1,2,2,[this.DF[1]]),s.setRenderState(h.default.BACK_NORMAL_ALWAYS_STATE),this.DB=s}let e=t.getFBOFitWidth(),s=t.getFBOFitHeight();this.DL*this.DM>0&&(e=this.DL,s=this.DM),this.DD.setTexSize(e,s),this.DC.setTexSize(e,s)}run(t=-1){let e=this.B_6.getRenderProxy(),s=e.getRenderAdapter();this.DK?s.synFBOSizeWithViewport():s.asynFBOSizeWithViewport(),t<0&&(t=this.DJ),this.updateState(s),s.setRenderToTexture(this.getTextureAt(0),!0,!1,0),s.useFBO(!0,!0,!1),null!=this.DN&&this.B_6.drawEntity(this.DN),t>=0&&this.B_6.runAt(t);let i=0;for(;i<this.DH;++i)s.setRenderToTexture(this.getTextureAt(1-i%2),!0,!1,0),s.useFBO(!0,!0,!1),i%2==0?this.B_6.drawEntity(this.DA):this.B_6.drawEntity(this.DB);this.DG&&(s.setRenderToBackBuffer(o.default.FRAMEBUFFER),e.unlockRenderState(),i%2==0?this.B_6.drawEntity(this.DA):this.B_6.drawEntity(this.DB))}destroy(){null!=this.B_6&&(this.B_6.removeEntity(this.DA),this.B_6.removeEntity(this.DB),this.DA.destroy(),this.DB.destroy(),this.DA=null,this.DB=null,this.DC=null,this.DD=null,this.DE[0]=null,this.DE[1]=null,this.B_6=null)}}_.HORIZONTAL=0,_.VERTICAL=1,_.DEFALUT=2,e.default=_},8333:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.COLOR_BUFFER_BIT=131,i.DEPTH_BUFFER_BIT=132,i.STENCIL_BUFFER_BIT=133,e.default=i},"839a":function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["Default"]=1]="Default",t[t["FragColor"]=2]="FragColor",t[t["SpecularMapColor"]=3]="SpecularMapColor"}(i||(i={})),e.SpecularMode=i},"83d1":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("ab73")),r=i(s("7279"));class n{create(t,e){let s=null,i=a.default.StageParam;return e.hasUniformByName(i.name)&&(s=new r.default,s.uns=i.name,s.uniformNameList=[i.name],s.copyDataFromProbe(t.getStage3D().uProbe)),s}getIDNS(){return"StageParamUniformBuilder"}}e.default=n},"857b":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("ab73")),r=i(s("7279"));class n{create(t,e){let s=null,i=a.default.CameraPosParam;return e.hasUniformByName(i.name)&&(s=new r.default,s.uns=i.name,s.uniformNameList=[i.name],s.copyDataFromProbe(t.getCamera().ucameraPosProbe)),s}getIDNS(){return"CameraPosUniformBuilder"}}e.default=n},"85b6":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("8d98"),r=i(s("0851"));class n extends r.default{constructor(t,e,s=!1){super(t,e,s),this.DO=null,this.n=a.TextureProxyType.Wrapper}getResUid(){return this.DO.getResUid()}getBufWidth(){return this.DO.getBufWidth()}getBufHeight(){return this.DO.getBufHeight()}getWidth(){return this.DO.getWidth()}getHeight(){return this.DO.getHeight()}isDirect(){return!1}getAttachTex(){return this.DO}attachTex(t){null!=t&&t!=this&&(this.DO!=t&&t.__$attachThis(),this.DO=t)}detachTex(){null!=this.DO&&this.DO.__$detachThis(),this.DO=null}__$attachThis(){super.__$attachThis(),null!=this.DO&&this.DO.__$attachThis()}__$detachThis(){super.__$detachThis(),null!=this.DO&&this.DO.__$detachThis()}__$$use(t){this.DO.__$$use(t)}isGpuEnabled(){return this.DO.isGpuEnabled()}getSampler(){return this.DO.getSampler()}__$updateToGpu(t){this.DO.__$updateToGpu(t)}__$$upload(t){this.DO.__$$upload(t)}__$destroy(){this.getAttachCount()<1&&(null!=this.DO&&this.DO.__$detachThis(),this.DO=null,super.__$destroy())}isDataEnough(){return this.DO.isDataEnough()}getTargetType(){return this.DO.getTargetType()}toString(){return"[WrapperTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},8602:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17")),r=i(s("3930"));class n{constructor(){this.position=new a.default(0,100,0),this.color=new r.default(1,1,1,1),this.attenuationFactor1=1e-4,this.attenuationFactor2=5e-4}}e.PointLight=n},8875:function(t,e,s){var i,a,r;(function(s,n){a=[],i=n,r="function"===typeof i?i.apply(e,a):i,void 0===r||(t.exports=r)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(d){var s,i,a,r=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,n=/@([^@]*):(\d+):(\d+)\s*$/gi,h=r.exec(d.stack)||n.exec(d.stack),l=h&&h[1]||!1,o=h&&h[2]||!1,_=document.location.href.replace(document.location.hash,""),m=document.getElementsByTagName("script");l===_&&(s=document.documentElement.outerHTML,i=new RegExp("(?:[^\\n]+?\\n){0,"+(o-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),a=s.replace(i,"$1").trim());for(var u=0;u<m.length;u++){if("interactive"===m[u].readyState)return m[u];if(m[u].src===l)return m[u];if(l===_&&m[u].innerHTML&&m[u].innerHTML.trim()===a)return m[u]}return null}}return t}))},8910:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8a0a")),r=i(s("fecb")),n=i(s("cb29")),h=i(s("e7d2")),l=s("e08e");class o extends n.default{constructor(t=a.default.VTX_STATIC_DRAW){super(t),this.offsetU=0,this.offsetV=0,this.uScale=1,this.vScale=1,this.flipVerticalUV=!1,this.flip90UV=!1,this.BV=null,this.BW=null,this.BX=null,this.BY=null}getVS(){return this.BV}getUVS(){return this.BW}getNVS(){return this.BX}getCVS(){return this.BY}initialize(t,e,s){if(null!=this.BV)return;s=Math.abs(.5*s),this.BZ=new Uint16Array([0,1,2,0,2,3]),this.BV=new Float32Array([t.x,t.y,t.z,s,e.x,e.y,e.z,s,e.x,e.y,e.z,-s,t.x,t.y,t.z,-s]);let i={x:0,y:0,z:0};if(i.x=2*e.x-t.x,i.y=2*e.y-t.y,i.z=2*e.z-t.z,this.BX=new Float32Array([e.x,e.y,e.z,i.x,i.y,i.z,i.x,i.y,i.z,e.x,e.y,e.z]),null==this.bounds&&(this.bounds=new r.default),this.bounds.addXYZFloat32Arr(this.BV),this.bounds.updateFast(),h.default.Reset(),h.default.AddFloat32Data(this.BV,4),this.isVBufEnabledAt(a.default.VBUF_UVS_INDEX)){let t;t=this.flipVerticalUV?[0,0,1,0,1,1,0,1]:this.flip90UV?[1,1,1,0,0,0,0,1]:[0,1,1,1,1,0,0,0],this.BW=new Float32Array(t),h.default.AddFloat32Data(this.BW,2)}h.default.AddFloat32Data(this.BX,3),h.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.vtCount=this.BZ.length,this.Bb=h.default.CreateBySaveData(this.getBufDataUsage()),this.Bb.setUintIVSData(this.BZ),this.vtxTotal=4,this.trisNumber=2,this.drawMode=l.RenderDrawMode.ELEMENTS_TRIANGLES,this.buildEnd()}initializeBill(){if(null==this.BV){if(this.BZ=new Uint16Array([0,1,2,0,2,3]),this.BV=new Float32Array([3,1,4,1,4,-1,3,-1]),null==this.bounds&&(this.bounds=new r.default),this.bounds.addXYZFloat32Arr(this.BV),this.bounds.updateFast(),h.default.Reset(),h.default.AddFloat32Data(this.BV,2),this.isVBufEnabledAt(a.default.VBUF_UVS_INDEX)){let t;t=this.flipVerticalUV?[0,0,1,0,1,1,0,1]:this.flip90UV?[1,1,1,0,0,0,0,1]:[0,1,1,1,1,0,0,0],this.BW=new Float32Array(t),h.default.AddFloat32Data(this.BW,2)}h.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.vtCount=this.BZ.length,this.Bb=h.default.CreateBySaveData(this.getBufDataUsage()),this.Bb.setUintIVSData(this.BZ),this.vtxTotal=4,this.trisNumber=2,this.drawMode=l.RenderDrawMode.ELEMENTS_TRIANGLES,this.buildEnd()}}toString(){return"[LightLine3DMesh()]"}__$destroy(){this.isResFree()&&(this.bounds=null,this.BV=null,this.BW=null,this.BX=null,this.BY=null,super.__$destroy())}}e.default=o},"899a":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}static Reset(){i.Flag_0=0}}i.Flag_0=0,e.default=i},"8a0a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("ca6c"));class r{static ToGL(t,e){switch(e){case r.VTX_STATIC_DRAW:return t.STATIC_DRAW;case r.VTX_DYNAMIC_DRAW:return t.DYNAMIC_DRAW;case r.VTX_STREAM_DRAW:return t.STREAM_DRAW;case r.VTX_STATIC_READ:return t.STATIC_READ;case r.VTX_DYNAMIC_READ:return t.DYNAMIC_READ;case r.VTX_STREAM_READ:return t.STREAM_READ;case r.VTX_STATIC_COPY:return t.STATIC_COPY;case r.VTX_DYNAMIC_COPY:return t.DYNAMIC_COPY;case r.VTX_STREAM_COPY:return t.STREAM_COPY;default:break}return t.STATIC_DRAW}static GetVBufTypeByNS(t){switch(t){case r.VBUF_VS_NS:return r.VBUF_VS;case r.VBUF_UVS_NS:return r.VBUF_UVS;case r.VBUF_NVS_NS:return r.VBUF_NVS;case r.VBUF_CVS_NS:return r.VBUF_CVS;case r.VBUF_VS2_NS:return r.VBUF_VS2;case r.VBUF_UVS2_NS:return r.VBUF_UVS2;case r.VBUF_NVS2_NS:return r.VBUF_NVS2;case r.VBUF_CVS2_NS:return r.VBUF_CVS2;case r.VBUF_TVS_NS:return r.VBUF_TVS;case r.VBUF_TVS2_NS:return r.VBUF_TVS2;default:}return-1}static GetVBufNSByType(t){switch(t){case r.VBUF_VS:return r.VBUF_VS_NS;case r.VBUF_UVS:return r.VBUF_UVS_NS;case r.VBUF_NVS:return r.VBUF_NVS_NS;case r.VBUF_CVS:return r.VBUF_CVS_NS;case r.VBUF_VS2:return r.VBUF_VS2_NS;case r.VBUF_UVS2:return r.VBUF_UVS2_NS;case r.VBUF_NVS2:return r.VBUF_NVS2_NS;case r.VBUF_CVS2:return r.VBUF_CVS2_NS;case r.VBUF_TVS:return r.VBUF_TVS_NS;case r.VBUF_TVS2:return r.VBUF_TVS2_NS;default:}return""}static GetVBufAttributeTypeByNS(t){return r.GetVBufTypeByNS(t)-3e3}}r.VTXTYPE_GL_POINTS=101,r.VTXTYPE_GL_LINES=102,r.VTXTYPE_GL_LINE_STRIP=103,r.VTXTYPE_GL_TRIANGLES=111,r.VTX_STATIC_DRAW=0,r.VTX_DYNAMIC_DRAW=1,r.VTX_STREAM_DRAW=2,r.VTX_STATIC_READ=3,r.VTX_DYNAMIC_READ=4,r.VTX_STREAM_READ=5,r.VTX_STATIC_COPY=6,r.VTX_DYNAMIC_COPY=7,r.VTX_STREAM_COPY=8,r.VBUF_VS=3001,r.VBUF_UVS=3002,r.VBUF_NVS=3003,r.VBUF_CVS=3004,r.VBUF_TVS=3005,r.VBUF_VS2=3006,r.VBUF_UVS2=3007,r.VBUF_NVS2=3008,r.VBUF_CVS2=3009,r.VBUF_TVS2=3010,r.VBUF_VS_INDEX=a.default.BIT_ONE_0,r.VBUF_UVS_INDEX=a.default.BIT_ONE_1,r.VBUF_NVS_INDEX=a.default.BIT_ONE_2,r.VBUF_CVS_INDEX=a.default.BIT_ONE_3,r.VBUF_TVS_INDEX=a.default.BIT_ONE_4,r.VBUF_VS2_INDEX=a.default.BIT_ONE_5,r.VBUF_UVS2_INDEX=a.default.BIT_ONE_6,r.VBUF_NVS2_INDEX=a.default.BIT_ONE_7,r.VBUF_CVS2_INDEX=a.default.BIT_ONE_8,r.VBUF_TVS2_INDEX=a.default.BIT_ONE_9,r.VBUF_VS_NS="a_vs",r.VBUF_VS2_NS="a_vs2",r.VBUF_UVS_NS="a_uvs",r.VBUF_UVS2_NS="a_uvs2",r.VBUF_NVS_NS="a_nvs",r.VBUF_NVS2_NS="a_nvs2",r.VBUF_CVS_NS="a_cvs",r.VBUF_CVS2_NS="a_cvs2",r.VBUF_TVS_NS="a_tvs",r.VBUF_TVS2_NS="a_tvs2";class n{}n.FLAT=210,n.GOURAND=310,e.VtxNormalType=n,e.default=r},"8ae0":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("e2fe"));var r;(function(t){t[t["NONE"]=0]="NONE",t[t["ONE"]=1]="ONE",t[t["TWO_H"]=2]="TWO_H",t[t["TWO_V"]=3]="TWO_V",t[t["THREE"]=4]="THREE",t[t["FOUR"]=5]="FOUR"})(r=e.TexAreaFillType||(e.TexAreaFillType={}));class n{constructor(t=0,e=0,s=100,i=100){this.uniqueNS="TexArea",this.listIndex=-1,this.atlasUid=0,this.rect=null,this.texRect=null,this.offset=2,this.minSize=32,this.uvs=new Float32Array(8),this.rect=new a.default(t,e,s,i),this.texRect=new a.default(t,e,s,i)}copyFrom(t){this.uniqueNS=t.uniqueNS,this.rect.copyFrom(t.rect),this.offset=t.offset,this.uvs.set(t.uvs,0)}update(){this.rect.update()}}e.TexArea=n;class h{constructor(t=0,e=0,s=100,i=100){this.rect=null,this.subNodes=null,this.uniqueNS="TexAreaNode",this.subIndex=0,this.DP=r.NONE,this.rect=new a.default(t,e,s,i)}isFull(){if(null==this.subNodes)return!1;let t=null,e=this.subNodes;if(1==e.length)return!0;for(let s=0;s<e.length;++s)if(t=e[s],!t.isFull())return!1;return!0}fillFour(t,e){let s=!1;if(null==this.subNodes){let e=this.rect,i=(t.rect,.5*this.rect.width),a=.5*this.rect.height,n=new h(e.x,e.y,i,a),l=new h(e.x+i,e.y,i,a),o=new h(e.x+i,e.y+a,i,a),_=new h(e.x,e.y+a,i,a);this.subNodes=[n,l,o,_];for(let t=0;t<this.subNodes.length;++t)this.subNodes[t].subIndex=t;let m=this.subNodes[0];this.subNodes.sort((t,e)=>t.rect.width*t.rect.height-e.rect.width*e.rect.height),this.DP=r.FOUR,s=m.fillOne(t)}else{let e=null,i=this.subNodes;for(let a=0;a<i.length;++a)if(e=i[a],!e.isFull()&&(s=e.addTexArea(t),s))break}return s}fillThree(t){let e=!1;if(null==this.subNodes){let e,s,i=this.rect,a=t.rect,n=new h(i.x,i.y,a.width,a.height);a.width>a.height?(e=new h(i.x+a.width,i.y,this.rect.width-a.width,this.rect.height),s=new h(i.x,i.y+a.height,a.width,this.rect.height-a.height)):(e=new h(i.x+a.width,i.y,this.rect.width-a.width,a.height),s=new h(i.x,i.y+a.height,this.rect.width,this.rect.height-a.height)),this.subNodes=[n,e,s];for(let t=0;t<this.subNodes.length;++t)this.subNodes[t].subIndex=t;let l=this.subNodes[1],o=this.subNodes[2];return l.rect.width*l.rect.height>o.rect.width*o.rect.height&&(this.subNodes[1]=o,this.subNodes[2]=l),this.DP=r.THREE,this.subNodes[0].fillOne(t)}{let s=null,i=this.subNodes;for(let a=0;a<i.length;++a)if(s=i[a],!s.isFull()&&(e=s.addTexArea(t),e))break}return e}fillTwoH(t){if(null==this.subNodes){let e=t.rect.width,s=this.rect.width-t.rect.width,i=this.rect.height,a=this.rect,n=new h(a.x,a.y,e,i),l=new h(a.x+e,a.y,s,i);return this.subNodes=[n,l],this.DP=r.TWO_H,n.fillOne(t)}return!this.subNodes[1].isFull()&&this.subNodes[1].addTexArea(t)}fillTwoV(t){if(null==this.subNodes){let e=this.rect.width,s=t.rect.height,i=this.rect.height-t.rect.height,a=this.rect,n=new h(a.x,a.y,e,s),l=new h(a.x,a.y+s,e,i);return this.subNodes=[n,l],this.DP=r.TWO_V,n.fillOne(t)}return!this.subNodes[1].isFull()&&this.subNodes[1].addTexArea(t)}fillOne(t){let e=!0;return null==this.subNodes&&(this.subNodes=[this],this.DP=r.ONE,t.rect.x=this.rect.x,t.rect.y=this.rect.y,t.update(),this.uniqueNS=t.uniqueNS),e}findByXY(t,e){if(this.rect.containsXY(t,e)&&null!=this.subNodes){if(this.DP==r.ONE)return this;let s;for(let i=0;i<this.subNodes.length;++i)if(s=this.subNodes[i].findByXY(t,e),null!=s)return s}return null}addTexArea(t){let e=t.rect.width,s=t.rect.height;if(this.rect.width<=t.minSize&&this.rect.height<=t.minSize)return e<=this.rect.width&&s<=this.rect.height&&!this.isFull()&&this.fillOne(t);let i=this.rect.width>t.minSize?this.rect.width:t.minSize,a=this.rect.height>t.minSize?this.rect.height:t.minSize;if(e<=i&&s<=a){let n=.5*i,h=.5*a,l=this.DP;if(this.DP==r.NONE)l=e<=n&&s<=h?r.FOUR:e<=n?r.TWO_H:s<=h?r.TWO_V:r.ONE;else if(l==r.ONE)return!1;return!this.isFull()&&(l==r.THREE||l==r.FOUR?this.fillThree(t):l==r.TWO_H?this.fillTwoH(t):l==r.TWO_V?this.fillTwoV(t):this.fillOne(t))}return!1}}e.TexAreaNode=h},"8ae4":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.T=0,this.Bw=null,this.Bx=0,this.DQ=null,this.DR=0,this.ibufStep=0,this.T=i.F_j+1}getUid(){return this.T}getVtxUid(){return this.Bx}getGpuBuf(){return this.DQ}getVTCount(){return this.DR}updateToGpu(t){if(null!=this.DQ&&this.DR>0){let e=this.Bw;this.version!=e.indicesVer&&(this.BZ=e.getIvsData(),t.bindEleBuf(this.DQ),this.DR>=this.BZ.length?t.eleBufSubData(this.BZ,e.getBufDataUsage()):t.eleBufData(this.BZ,e.getBufDataUsage()),this.DR=this.BZ.length,this.version=e.indicesVer)}}initialize(t,e){if(null==this.DQ&&null!=e.getIvsData())if(this.version=e.indicesVer,this.Bw=e,this.Bx=e.getUid(),this.BZ=e.getIvsData(),this.DQ=t.createBuf(),t.bindEleBuf(this.DQ),null==e.bufData)t.eleBufData(this.BZ,e.getBufDataUsage()),this.DR=this.BZ.length;else{t.eleBufDataMem(e.bufData.getIndexDataTotalBytes(),e.getBufDataUsage());let s=null,i=0;this.DR=0;for(let a=0,r=e.bufData.getIndexDataTotal();a<r;++a)s=e.bufData.getIndexDataAt(a),t.eleBufSubData(s,i),i+=s.byteLength,this.DR+=s.length}}destroy(t){null!=this.DQ&&(this.Bw=null,t.deleteBuf(this.DQ),this.DQ=null,this.BZ=null,this.DR=0)}}i.F_j=0,e.ROIndicesRes=i},"8d98":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("3b73")),r=i(s("030e"));class n{static ToGL(t,e){switch(e){case n.RGBA:break;case n.R8:return t.R8;case n.RGB:return t.RGB;case n.RGB8:return t.RGB8;case n.RGBA8:return t.RGBA8;case n.ALPHA:return t.ALPHA;case n.RGB16F:return a.default.IsWebGL2()?t.RGB16F:t.RGB;case n.RGBA16F:return a.default.IsWebGL2()?t.RGBA16F:t.RGBA;case n.RGB32F:return a.default.IsWebGL2()&&t.RGB32F,t.RGB;case n.RGBA32F:return a.default.IsWebGL2()&&t.RGBA32F,t.RGBA;case n.RED:return t.RED;case n.DEPTH_COMPONENT:return t.DEPTH_COMPONENT;case n.DEPTH_STENCIL:return t.DEPTH_STENCIL;default:break}return t.RGBA}}n.R8=101,n.RGB=110,n.RED=111,n.RGBA=121,n.RGB8=122,n.RGBA8=123,n.ALPHA=132,n.RGB16F=331,n.RGBA16F=332,n.RGB32F=341,n.RGBA32F=342,n.DEPTH_COMPONENT=351,n.DEPTH_STENCIL=352,e.TextureFormat=n;class h{static ToGL(t,e){switch(e){case h.UNSIGNED_BYTE:return t.UNSIGNED_BYTE;case h.BYTE:return t.BYTE;case h.FLOAT:return t.FLOAT;case h.HALF_FLOAT:return t.HALF_FLOAT;case h.HALF_FLOAT_OES:return null!=r.default.OES_texture_half_float?r.default.OES_texture_half_float.HALF_FLOAT_OES:t.FLOAT;case h.UNSIGNED_SHORT:return t.UNSIGNED_SHORT;case h.UNSIGNED_INT:return t.UNSIGNED_INT;case h.UNSIGNED_SHORT_5_6_5:return t.UNSIGNED_SHORT_5_6_5;case h.UNSIGNED_SHORT_4_4_4_4:return t.UNSIGNED_SHORT_4_4_4_4;case h.UNSIGNED_SHORT_5_5_5_1:return t.UNSIGNED_SHORT_5_5_5_1;case h.UNSIGNED_INT_24_8_WEBGL:return r.default.WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL;default:break}return t.UNSIGNED_BYTE}}h.UNSIGNED_BYTE=1108,h.UNSIGNED_SHORT=1109,h.UNSIGNED_INT=1110,h.BYTE=1111,h.FLOAT=1211,h.HALF_FLOAT=1212,h.HALF_FLOAT_OES=1213,h.UNSIGNED_SHORT_5_6_5=1214,h.UNSIGNED_SHORT_4_4_4_4=1215,h.UNSIGNED_SHORT_5_5_5_1=1216,h.UNSIGNED_INT_24_8_WEBGL=1217,e.TextureDataType=h;class l{static GetValue(t,e){switch(e){case l.TEXTURE_2D:return t.TEXTURE_2D;case l.TEXTURE_2D_ARRAY:return t.TEXTURE_2D_ARRAY;case l.TEXTURE_CUBE:return t.TEXTURE_CUBE_MAP;case l.TEXTURE_3D:return t.TEXTURE_3D;default:break}return t.TEXTURE_2D}}l.TEXTURE_2D=20,l.TEXTURE_2D_ARRAY=22,l.TEXTURE_SHADOW_2D=23,l.TEXTURE_CUBE=25,l.TEXTURE_3D=30,e.TextureTarget=l,function(t){t[t["Default"]=0]="Default",t[t["Depth"]=1]="Depth",t[t["Wrapper"]=2]="Wrapper",t[t["RTT"]=3]="RTT",t[t["Image"]=4]="Image",t[t["Float"]=5]="Float",t[t["Uint16"]=6]="Uint16",t[t["FloatCube"]=7]="FloatCube",t[t["Bytes"]=8]="Bytes",t[t["BytesCube"]=9]="BytesCube",t[t["ImageCube"]=10]="ImageCube",t[t["Texture3D"]=11]="Texture3D"}(e.TextureProxyType||(e.TextureProxyType={}));class o{static GetConst(t,e){switch(e){case o.NEAREST:return t.NEAREST;case o.LINEAR:return t.LINEAR;case o.LINEAR_MIPMAP_LINEAR:return t.LINEAR_MIPMAP_LINEAR;case o.NEAREST_MIPMAP_NEAREST:return t.NEAREST_MIPMAP_NEAREST;case o.LINEAR_MIPMAP_NEAREST:return t.LINEAR_MIPMAP_NEAREST;case o.NEAREST_MIPMAP_LINEAR:return t.NEAREST_MIPMAP_LINEAR;case o.WRAP_REPEAT:return t.REPEAT;case o.WRAP_CLAMP_TO_EDGE:return t.CLAMP_TO_EDGE;case o.WRAP_MIRRORED_REPEAT:return t.MIRRORED_REPEAT;default:break}return-1}}o.WRAP_REPEAT=3001,o.WRAP_CLAMP_TO_EDGE=3002,o.WRAP_MIRRORED_REPEAT=3003,o.NEAREST=4001,o.LINEAR=4002,o.LINEAR_MIPMAP_LINEAR=4003,o.NEAREST_MIPMAP_NEAREST=4004,o.LINEAR_MIPMAP_NEAREST=4005,o.NEAREST_MIPMAP_LINEAR=4006,e.TextureConst=o},"8def":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("919c"));class r extends a.default{constructor(){super(),this.shdp=null,this.vbufs=null,this.vbuf=null,this.attribTypes=null,this.wholeOffsetList=null,this.attribTypesLen=0,this.updateUnlocked=!0,this.wholeStride=0,this.T=r.F_j++}run(){this.Aj.testVROUid(this.T)&&(null!=this.vbuf?this.Aj.useVtxAttribsPtrTypeFloat(this.shdp,this.vbuf,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride):this.Aj.useVtxAttribsPtrTypeFloatMulti(this.shdp,this.vbufs,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride),this.Aj.testRIOUid(this.Bx)&&this.Aj.bindEleBuf(this.ibuf))}__$destroy(){a.default.Gk.delete(this.DS),this.DS=0,this.Bx=-1,this.Aj=null,this.shdp=null,this.vbufs=null,this.vbuf=null,this.ibuf=null,this.attribTypes=null,this.attribTypesLen=0,this.wholeStride=0}restoreThis(){r.Restore(this)}toString(){return"VertexRenderObj(uid = "+this.T+", type="+this.DS+")"}static HasMid(t){return a.default.Gk.has(t)}static GetByMid(t){return a.default.Gk.get(t)}static GetFreeId(){return r.Gl.length>0?r.Gl.pop():-1}static Create(t,e,s){let i=null,n=r.GetFreeId();return n>=0?(i=r.Gm[n],r.Gn[n]=r.S_FLAG_BUSY,i.setMidAndBufUid(e,s)):(i=new r,i.setMidAndBufUid(e,s),r.Gm.push(i),r.Gn.push(r.S_FLAG_BUSY),r.Go++),i.setRC(t),a.default.Gk.set(e,i),i}static Restore(t){if(null!=t&&t.c<1&&r.Gn[t.getUid()]==r.S_FLAG_BUSY){let e=t.getUid();r.Gl.push(e),r.Gn[e]=r.S_FLAG_FREE,t.__$destroy()}}}r.F_j=0,r.S_FLAG_BUSY=1,r.S_FLAG_FREE=0,r.Gn=[],r.Go=0,r.Gm=[],r.Gl=[],e.default=r},"8e17":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("6e01"));class r{constructor(t=0,e=0,s=0,i=1){this.x=0,this.y=0,this.z=0,this.w=0,this.x=t,this.y=e,this.z=s,this.w=i}clone(){return new r(this.x,this.y,this.z,this.w)}setTo(t,e,s,i=1){this.x=t,this.y=e,this.z=s,this.w=i}setXYZ(t,e,s){this.x=t,this.y=e,this.z=s}copyFrom(t){this.x=t.x,this.y=t.y,this.z=t.z}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}multBy(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);t>a.default.MATH_MIN_POSITIVE&&(this.x/=t,this.y/=t,this.z/=t)}normalizeTo(t){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);e>a.default.MATH_MIN_POSITIVE?(t.x=this.x/e,t.y=this.y/e,t.z=this.z/e):(t.x=this.x,t.y=this.y,t.z=this.z)}scaleVector(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}scaleBy(t){this.x*=t,this.y*=t,this.z*=t}negate(){this.x=-this.x,this.y=-this.y,this.z=-this.z}equalsXYZ(t){return Math.abs(this.x-t.x)<a.default.MATH_MIN_POSITIVE&&Math.abs(this.y-t.y)<a.default.MATH_MIN_POSITIVE&&Math.abs(this.z-t.z)<a.default.MATH_MIN_POSITIVE}equalsAll(t){return Math.abs(this.x-t.x)<a.default.MATH_MIN_POSITIVE&&Math.abs(this.y-t.y)<a.default.MATH_MIN_POSITIVE&&Math.abs(this.z-t.z)<a.default.MATH_MIN_POSITIVE&&Math.abs(this.w-t.w)<a.default.MATH_MIN_POSITIVE}project(){let t=1/this.w;this.x*=t,this.y*=t,this.z*=t}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getLengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}addBy(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}subtractBy(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}subtract(t){return new r(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new r(this.x+t.x,this.y+t.y,this.z+t.z)}crossProduct(t){return new r(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}crossBy(t){let e=this.y*t.z-this.z*t.y,s=this.z*t.x-this.x*t.z,i=this.x*t.y-this.y*t.x;this.x=e,this.y=s,this.z=i}reflectBy(t){let e=2*(this.x*t.x+this.y*t.y+this.z*t.z);this.x=this.x-e*t.x,this.y=this.y-e*t.y,this.z=this.z-e*t.z}scaleVecTo(t,e){this.x=t.x*e,this.y=t.y*e,this.z=t.z*e}subVecsTo(t,e){this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z}addVecsTo(t,e){this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z}crossVecsTo(t,e){this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x}toString(){return"Vector3D("+this.x+this.y+this.z+")"}static Cross(t,e,s){s.x=t.y*e.z-t.z*e.y,s.y=t.z*e.x-t.x*e.z,s.z=t.x*e.y-t.y*e.x}static CrossSubtract(t,e,s,i,a){r.__vtor3Stv0.x=e.x-t.x,r.__vtor3Stv0.y=e.y-t.y,r.__vtor3Stv0.z=e.z-t.z,r.__vtor3Stv1.x=i.x-s.x,r.__vtor3Stv1.y=i.y-s.y,r.__vtor3Stv1.z=i.z-s.z,t=r.__vtor3Stv0,s=r.__vtor3Stv1,a.x=t.y*s.z-t.z*s.y,a.y=t.z*s.x-t.x*s.z,a.z=t.x*s.y-t.y*s.x}static Subtract(t,e,s){s.x=t.x-e.x,s.y=t.y-e.y,s.z=t.z-e.z}static DistanceSquared(t,e){return r.__vtor3Stv0.x=t.x-e.x,r.__vtor3Stv0.y=t.y-e.y,r.__vtor3Stv0.z=t.z-e.z,r.__vtor3Stv0.getLengthSquared()}static DistanceXYZ(t,e,s,i,a,n){return r.__vtor3Stv0.x=t-i,r.__vtor3Stv0.y=e-a,r.__vtor3Stv0.z=s-n,r.__vtor3Stv0.getLength()}static Distance(t,e){return r.__vtor3Stv0.x=t.x-e.x,r.__vtor3Stv0.y=t.y-e.y,r.__vtor3Stv0.z=t.z-e.z,r.__vtor3Stv0.getLength()}static AngleBetween(t,e){return t.normalizeTo(r.__vtor3Stv0),e.normalizeTo(r.__vtor3Stv1),Math.acos(r.__vtor3Stv0.dot(r.__vtor3Stv1))*a.default.MATH_180_OVER_PI}static RadianBetween(t,e){return t.normalizeTo(r.__vtor3Stv0),e.normalizeTo(r.__vtor3Stv1),Math.acos(r.__vtor3Stv0.dot(r.__vtor3Stv1))}static RadianBetween2(t,e){let s=t.getLengthSquared(),i=e.getLengthSquared();return r.__vtor3Stv0.x=t.x-e.x,r.__vtor3Stv0.y=t.y-e.y,r.__vtor3Stv0.z=t.z-e.z,Math.acos((s+i-r.__vtor3Stv0.getLengthSquared())/(2*Math.sqrt(s)*Math.sqrt(i)))}static Reflect(t,e,s){let i=2*(t.x*e.x+t.y*e.y+t.z*e.z);s.x=t.x-i*e.x,s.y=t.y-i*e.y,s.z=t.z-i*e.z}}r.X_AXIS=new r(1,0,0),r.Y_AXIS=new r(0,1,0),r.Z_AXIS=new r(0,0,1),r.__vtor3Stv0=new r,r.__vtor3Stv1=new r,r.ZERO=new r,e.default=r},9156:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetTransUniform(t,e){i.Gp.set(t.getUid(),e)}static GetTransUniform(t){if(t.getUid()<0)throw Error("mat.getUid() < 0");return i.Gp.has(t.getUid())?i.Gp.get(t.getUid()):null}static HasTransUniform(t){return i.Gp.has(t.getUid())}static RemoveTransUniform(t){i.Gp.delete(t.getUid())}}i.Gp=new Map,e.default=i},"919c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.T=0,this.DS=0,this.Bx=0,this.Aj=null,this.indicesRes=null,this.ibuf=null,this.ibufStep=2,this.c=0}getVTCount(){return null!=this.indicesRes?this.indicesRes.getVTCount():0}setRC(t){this.Aj=t}setMidAndBufUid(t,e){this.DS=t,this.Bx=e,this.c=0}getUid(){return this.T}getVtxUid(){return this.Bx}getMid(){return this.DS}run(){}__$attachThis(){++this.c}__$detachThis(){--this.c,this.c<1&&(this.c=0)}__$destroy(){i.Gk.delete(this.DS),this.DS=0,this.Bx=-1,this.ibuf=null,this.Aj=null,this.indicesRes=null}restoreThis(){}static HasMid(t){return i.Gk.has(t)}static GetByMid(t){return i.Gk.get(t)}static Reset(){i.Gq=-1}}i.Gq=0,i.Gk=new Map,e.default=i},"91e2":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17")),r=i(s("29ef")),n=i(s("402a")),h=i(s("f63e")),l=s("8a0a"),o=i(s("3bfb"));class _ extends n.default{constructor(t=null){super(t),this.DT=l.VtxNormalType.FLAT,this.DU=new a.default(-50,-50,-50),this.DV=new a.default(50,50,50),this.Ba=null,this.DW=null,this.DX=!0,this.vtxColor=null,this.uScale=1,this.vScale=1,this.normalScale=1,this.normalEnabled=!1,this.uvPartsNumber=0,this.wireframe=!1}setVtxTransformMatrix(t){this.Ba=t}useFlatNormal(){this.DT=l.VtxNormalType.FLAT}useGourandNormal(){this.DT=l.VtxNormalType.GOURAND}createMaterial(t){if(null==this.getMaterial()){let e=new h.default;e.normalEnabled=this.normalEnabled,e.vertColorEnabled=null!=this.vtxColor,e.setTextureList(t),this.setMaterial(e)}else null!=t&&this.getMaterial().getTextureTotal()<1&&this.getMaterial().setTextureList(t)}initializeThis(t){if(this.DX)this.createMaterial(t),this.activeDisplay();else{let t=this.getMesh();null!=t&&t.initialize(this.DU,this.DV)}this.DX=!1}showBackFace(){this.setRenderState(r.default.BACK_CULLFACE_NORMAL_STATE)}showFrontFace(){this.setRenderState(r.default.FRONT_CULLFACE_NORMAL_STATE)}showDoubleFace(){this.setRenderState(r.default.NONE_CULLFACE_NORMAL_STATE)}scaleUVFaceAt(t,e,s,i,a){let r=this.getMesh();null!=r&&r.scaleUVFaceAt(t,e,s,i,a)}scaleUVSFaceAt(t,e){let s=this.getMesh();null!=s&&s.setFaceUVSAt(t,e)}reinitializeMesh(){null!=this.DW&&this.DW.reinitialize()}initialize(t,e,s=null){null!=t&&this.DU.copyFrom(t),null!=e&&this.DV.copyFrom(e),this.initializeThis(s)}initializeCube(t,e=null){t*=.5,this.DU.setXYZ(-t,-t,-t),this.DV.setXYZ(t,t,t),this.initializeThis(e)}initializeSizeXYZ(t,e,s,i=null){this.DU.setXYZ(.5*-t,.5*-e,.5*-s),this.DV.setXYZ(.5*t,.5*e,.5*s),this.initializeThis(i)}__activeMesh(t){if(this.DW=this.getMesh(),null==this.DW&&(this.DW=new o.default),null!=this.DW){let e=this.DW;null!=this.Ba&&e.setTransformMatrix(this.Ba),e.vtxColor=this.vtxColor,e.uScale=this.uScale,e.vScale=this.vScale,e.wireframe=this.wireframe,e.normalType=this.DT,e.normalScale=this.normalScale,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.uvPartsNumber=this.uvPartsNumber,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.DU,this.DV),this.setMesh(e),e.setTransformMatrix(null)}this.Ba=null}updateMesh(){this.DW=this.getMesh()}setFaceUVSAt(t,e,s=0){null!=this.DW&&this.DW.setFaceUVSAt(t,e,s)}transformFaceAt(t,e){null!=this.DW&&this.DW.transformFaceAt(t,e)}getFaceCenterAt(t,e){null!=this.DW&&this.DW.getFaceCenterAt(t,e)}destroy(){super.destroy(),this.vtxColor=null,this.DW=null,this.DX=!0}toString(){return"[Box3DEntity(uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=_},9260:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("7045"));class r{static KeyDown(t){for(var e=r.DY.length,s=0;s<e;++s)r.DY[s].call(r.Da[s],t)}static KeyUp(t){let e=r.DZ.length;for(let s=0;s<e;++s)r.DZ[s].call(r.Db[s],t)}static RemoveEventListener(t,e){if(null!=e){let s;switch(t){case a.default.KEY_DOWN:for(s=r.DY.length-1;s>=0;--s)if(e===r.DY[s]){r.Da.splice(s,1),r.DY.splice(s,1);break}break;case a.default.KEY_UP:for(s=r.DZ.length-1;s>=0;--s)if(e===r.DZ[s]){r.Db.splice(s,1),r.DZ.splice(s,1);break}break;default:break}}}}r.Da=[],r.DY=[],r.Db=[],r.DZ=[],r.AddEventListener=function(t,e,s){if(null!=s){let i=0;switch(t){case a.default.KEY_DOWN:for(i=r.DY.length-1;i>=0;--i)if(s===r.DY[i])break;i<0&&(r.Da.push(e),r.DY.push(s));break;case a.default.KEY_UP:for(i=r.DZ.length-1;i>=0;--i)if(s===r.DZ[i])break;i<0&&(r.Db.push(e),r.DZ.push(s));break;default:break}}},e.default=r},9266:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("e7d2")),r=i(s("8a0a")),n=i(s("fecb")),h=i(s("cb29")),l=s("e08e");class o extends h.default{constructor(t=r.default.VTX_STATIC_DRAW){super(t),this.BV=null,this.BW=null,this.flipVerticalUV=!1,this.vtxUVEnabled=!0}setUVSFloatArr(t){null==this.BW&&(this.BW=new Float32Array(8)),this.BW.set(t,0)}setUVSArr(t){null==this.BW&&(this.BW=new Float32Array(8)),this.BW.set(t,0)}initialize(t,e){if(null!=this.BV)return;let s=.5*t,i=.5*e,r=-s,h=-i;this.bounds=new n.default,this.bounds.min.setXYZ(r,h,r),this.bounds.max.setXYZ(s,i,s),this.bounds.updateFast(),this.BZ=new Uint16Array([1,2,0,3]),this.BV=new Float32Array([r,h,s,h,s,i,r,i]),a.default.Reset(),a.default.AddFloat32Data(this.BV,2),this.vtxUVEnabled&&(null==this.BW&&(this.flipVerticalUV?this.BW=new Float32Array([0,0,1,0,1,1,0,1]):this.BW=new Float32Array([0,1,1,1,1,0,0,0])),a.default.AddFloat32Data(this.BW,2)),a.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.Bb=a.default.CreateBySaveData(this.getBufDataUsage()),this.Bb.setUintIVSData(this.BZ),this.vtCount=this.BZ.length,this.vtxTotal=4,this.trisNumber=2,this.drawMode=l.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP,this.buildEnd()}setUV(t,e,s,i){null!=this.Bb&&(this.Bb.setData2fAt(0,1,t,e+i),this.Bb.setData2fAt(1,1,t+s,e+i),this.Bb.setData2fAt(2,1,t+s,e),this.Bb.setData2fAt(3,1,t,e))}}e.default=o},"955e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("6e01")),r=i(s("8e17")),n=i(s("fecb")),h=i(s("c120")),l=s("e08e"),o=i(s("29ef")),_=i(s("3930")),m=i(s("e7ce"));class u{constructor(){this.Dc=new _.default,this.Dd=new m.default,this.B_6=null,this.A_i=null,this.De=null,this.Df=null,this.Dg=new Uint8Array(256),this.Dh=null,this.Di=null,this.Dj=0,this.Dk=0,this.Dl=new r.default,this.Dm=new r.default,this.B_x=null,this.B_y=null,this.Dn=new Uint8Array(4),this.Do=new r.default,this.Dp=new r.default,this.Dq=[null,null],this.Dr=!0,this.Ds=new Uint8Array(4),this.Dt=new Uint8Array(256)}setRenderer(t){this.B_6=t}setRayTestMode(t){this.Dk=t}setRay(t,e){this.B_x=t,this.B_y=e}getRay(t,e){t.copyFrom(this.B_x),e.copyFrom(this.B_y)}setCamera(t){this.A_i=t}setCullingNodeHead(t){if(this.De=t,null==this.Dh){this.Dh=[];let t=0;for(;t<256;++t)this.Dh.push(new h.default)}}getSelectedNode(){return this.Di}getSelectedNodes(){return this.Dh}getSelectedNodesTotal(){return this.Dj}sorting(t,e){let s=this.Dh;this.Df=s[t];while(t<e){while(t<e&&s[e].dis>=this.Df.dis)--e;s[t]=s[e];while(t<e&&s[t].dis<=this.Df.dis)++t;s[e]=s[t]}return s[t]=this.Df,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}run(){let t=this.De;if(null!=t){let e=0,s=this.B_y,i=this.B_x,r=this.Dp,h=null,l=0;Math.abs(s.x)>a.default.MATH_MIN_POSITIVE?this.Do.x=1/s.x:this.Do.x=a.default.MATH_MAX_POSITIVE,Math.abs(s.y)>a.default.MATH_MIN_POSITIVE?this.Do.y=1/s.y:this.Do.y=a.default.MATH_MAX_POSITIVE,Math.abs(s.z)>a.default.MATH_MIN_POSITIVE?this.Do.z=1/s.z:this.Do.z=a.default.MATH_MAX_POSITIVE,this.Do.x<0?this.Dn[0]=1:this.Dn[0]=0,this.Do.y<0?this.Dn[1]=1:this.Dn[1]=0,this.Do.z<0?this.Dn[2]=1:this.Dn[2]=0;while(null!=t)t.drawEnabled&&t.entity.mouseEnabled&&(r.x=t.bounds.center.x-i.x,r.y=t.bounds.center.y-i.y,r.z=t.bounds.center.z-i.z,e=r.dot(s),r.x-=e*s.x,r.y-=e*s.y,r.z-=e*s.z,r.getLengthSquared()<=t.bounds.radius2&&t.rayTestState<1&&(this.Dq[0]=t.bounds.min,this.Dq[1]=t.bounds.max,n.default.IntersectionRL3(this.Dq,this.Dn,this.Do,s,i,r)&&(h=this.Dh[l],h.entity=t.entity,h.dis=this.Do.w,h.wpv.copyFrom(r),++l))),t=t.next;this.Di=null;let o=0;if(l>0){let t=this.Dl,e=this.Dm,a=null,n=0,h=0,_=null,m=null,u=s.dot(i),d=0,c=!this.Dr,f=0;if(l>1){for(this.snsort(0,l-1),o=0;o<l;++o){if(m=this.Dh[o],a=this.Dh[o].entity,a.isPolyhedral()?c?(_=a.getInvMatrix(),_.transformOutVector3(i,t),_.deltaTransformOutVector(s,e),e.normalize(),n=a.testRay(t,e,r,!0)):(++f,n=0):(_=a.getInvMatrix(),_.transformOutVector3(i,t),_.deltaTransformOutVector(s,e),e.normalize(),n=a.testRay(t,e,r,!0)),n>0){if(m.lpv.copyFrom(r),a.getMatrix().transformOutVector3(r,m.wpv),m.dis=s.dot(m.wpv)-u,this.Dg[h]=o,++h,m.dis>d){this.Di=m;break}}else if(n<0&&(this.Dg[h]=o,++h,m.dis>d)){this.Di=m;break}d=m.dis}null==this.Di&&h>0&&(this.Di=this.Dh[this.Dg[0]])}else m=this.Dh[0],a=this.Dh[0].entity,_=a.getInvMatrix(),_.transformOutVector3(i,t),_.deltaTransformOutVector(s,e),e.normalize(),a.isPolyhedral()?c?n=a.testRay(t,e,r,!0):(++f,n=0):n=a.testRay(t,e,r,!0),n>0?(m.lpv.copyFrom(r),a.getMatrix().transformOutVector3(r,m.wpv),m.dis=s.dot(m.wpv)-u,this.Di=m):n<0&&(this.Di=m);f>0&&(this.Dk<1||null==this.Di||this.Di.entity.isPolyhedral())&&this.gpuPick(l)}for(o=l;o<this.Dj;++o)this.Di!=this.Dh[o]&&(this.Dh[o].entity=null);this.Dj=l}}gpuPick(t){let e=this.B_6.getRendererContext(),s=this.B_6.getRenderProxy(),i=s.getStage3D().mouseX,a=s.getStage3D().mouseY;e.vertexRenderBegin(),e.getClearRGBAColor4f(this.Dc),e.setClearRGBAColor4f(0,0,0,0),e.setScissorEnabled(!0),e.setScissorRect(i,a,1,1),e.clearBackBuffer(),this.Ds[3]=0,o.default.LockBlendMode(l.RenderBlendMode.OPAQUE),o.default.LockDepthTestMode(l.DepthTestMode.OPAQUE),e.unlockMaterial(),e.unlockRenderState(),e.useGlobalMaterial(this.Dd,!1,!1);let r=null,n=null,h=-1,_=0;for(;_<t;++_)r=this.Dh[_],n=this.Dh[_].entity,n.isPolyhedral()&&(++h,this.Dd.setIndex(h+2),this.Dt[h]=_,this.B_6.updateMaterialUniformToCurrentShd(this.Dd),this.B_6.drawEntity(n,!1,!0));if(h>-1&&s.readPixels(i,a,1,1,s.RGBA,s.UNSIGNED_BYTE,this.Ds),o.default.UnlockBlendMode(),o.default.UnlockDepthTestMode(),this.Ds[3]>1){_=this.Dt[this.Ds[3]-2],r=this.Dh[_];let t=(this.Ds[0]<<8)+this.Ds[1]+this.Ds[2]/255;if(null!=this.Di){let e=this.Di.entity;this.Di==r||e.isPolyhedral()||this.Di.dis<t&&(_=-1)}_>-1&&(r.dis=t,this.getWorldPosByRayDistance(t,this.B_y,this.A_i.getPosition(),r.wpv),this.Di=r)}e.setScissorEnabled(!1),e.unlockMaterial(),e.unlockRenderState(),o.default.UnlockBlendMode(),o.default.UnlockDepthTestMode(),e.setClearRGBAColor4f(this.Dc.r,this.Dc.g,this.Dc.b,this.Dc.a),e.resetState()}clear(){this.Di=null}getWorldPosByRayDistance(t,e,s,i){i.x=e.x*t+s.x,i.y=e.y*t+s.y,i.z=e.z*t+s.z}}e.default=u},9666:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("3b73")),r=i(s("acfe"));class n{static CreateShdData(t,e,s,i,h){if(n.Gr.has(t))return n.Gr.get(t);let l=new r.default;return l.adaptationShaderVersion=i,l.preCompileInfo=h,l.initialize(t,e,s),n.Gs[l.getUid()]=l,++n.s_shdDataListLen,n.Gr.set(t,l),a.default.SHADERCODE_TRACE_ENABLED,l}static FindData(t){return n.Gr.has(t)?n.Gr.get(t):null}}n.Gr=new Map,n.Gs=[],n.s_shdDataListLen=0,e.default=n},"984e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.width=0,this.height=0,this.depth=0,this.sampler=0,this.texBuf=null,this.c=0}__$attachThis(){++this.c}__$detachThis(){--this.c,this.c<1&&(this.c=0)}bindToGpu(t){t.bindTexture(this.sampler,this.texBuf)}getAttachCount(){return this.c}}class a{constructor(t,e){this.C6=new Map,this.C7=new Map,this.Du=0,this.C_A=0,this.C_B=128,this.A=0,this.x=null,this.texMid=-1,this.unlocked=!0,this.A=t,this.x=e}createBuf(){return this.x.createTexture()}createResByParams3(t,e,s,a){if(!this.C6.has(t)){let r=new i;return r.rcuid=this.getRCUid(),r.resUid=t,r.width=e,r.height=s,r.sampler=a,r.texBuf=this.createBuf(),r.texBuf.resUid=t,this.addTextureRes(r),!0}return!1}getRCUid(){return this.A}getRC(){return this.x}hasResUid(t){return this.C6.has(t)}renderBegin(){this.texMid=-1}getTextureResTotal(){return this.Du}addTextureRes(t){this.C6.has(t.resUid)||(t.waitDelTimes=0,this.C6.set(t.resUid,t),this.Du++)}getGpuBuffer(t){return this.C6.has(t)?this.C6.get(t).texBuf:null}bindToGpu(t){this.C6.has(t)&&this.C6.get(t).bindToGpu(this.x)}getAttachTotal(){return this.C_A}__$attachRes(t){if(this.C6.has(t)){this.C_A++;let e=this.C6.get(t);e.getAttachCount()<1&&this.C7.has(t)&&this.C7.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.C6.has(t)&&this.C6.has(t)){let e=this.C6.get(t);e.getAttachCount()>0&&(this.C_A--,e.__$detachThis(),e.getAttachCount()<1&&this.C7.set(t,e))}}update(){if(this.C_B--,this.C_B<1){this.C_B=128;for(const[t,e]of this.C7)e.waitDelTimes++,e.waitDelTimes>5&&(this.C6.delete(e.resUid),this.C7.delete(e.resUid),this.x.deleteTexture(e.texBuf),e.texBuf=null,this.Du--)}}}e.default=a},"9bb7":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("faa5")),r=i(s("0fc4"));class n extends a.default{constructor(){super(),this.Ak=""}initialize(t){super.initialize(t),this.Ak="DepthShd",this.adaptationShaderVersion=!1}buildThisCode(){let t=this.A_R;t.reset(),t.addVertLayout("vec3","a_vs"),t.addVarying("vec4","v_pos"),t.addFragOutput("vec4","FragColor0"),t.useVertSpaceMats(!0,!0,!0),t.addFragFunction("\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\n\treturn r * PackUpscale;\n}\n")}getFragShaderCode(){return this.buildThisCode(),this.A_R.addFragMainCode("\nvoid main() {\n    // Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\n    float fragCoordZ = 0.5 * v_pos[2] / v_pos[3] + 0.5;\n    FragColor0 = packDepthToRGBA( fragCoordZ );\n}\n"),this.A_R.buildFragCode()}getVertShaderCode(){return this.A_R.addVertMainCode("\nvoid main() {\n    vec4 wpos = u_objMat * vec4(a_vs, 1.0);\n    vec4 viewPos = u_viewMat * wpos;\n    gl_Position =  u_projMat * viewPos;\n    v_pos = gl_Position;\n}\n"),this.A_R.buildVertCode()}getUniqueShaderName(){return this.Ak}toString(){return"[DepthShaderBuffer()]"}static GetInstance(){return n.F_0}}n.F_0=new n;class h extends r.default{constructor(){super()}getCodeBuf(){return n.GetInstance()}createSelfUniformData(){return null}}e.default=h},"9c3c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17")),r=i(s("38de")),n=i(s("fecb")),h=i(s("8a0a")),l=i(s("cb29")),o=i(s("e7d2")),_=s("e08e");class m extends l.default{constructor(t=h.default.VTX_STATIC_DRAW){super(t),this.BV=null,this.BY=null,this.Dv=0,this.rayTestRadius=2}getVS(){return this.BV}getCVS(){return this.BV}initialize(t,e){t.length>=6&&(this.vtCount=Math.floor(t.length/3),this.Dv=Math.floor(this.vtCount/2),this.BV=new Float32Array(t),null==this.bounds&&(this.bounds=new n.default),this.bounds.addXYZFloat32Arr(this.BV),this.bounds.updateFast(),o.default.Reset(),o.default.AddFloat32Data(this.BV,3),this.isVBufEnabledAt(h.default.VBUF_CVS_INDEX)&&(this.BY=new Float32Array(e),o.default.AddFloat32Data(this.BY,3)),o.default.vbWholeDataEnabled=this.vbWholeDataEnabled,null!=this.Bb?o.default.UpdateBufData(this.Bb):this.Bb=o.default.CreateBySaveData(this.getBufDataUsage()),this.drawMode=_.RenderDrawMode.ARRAYS_LINES,this.buildEnd())}setVSXYZAt(t,e,s,i){null!=this.Bb&&this.Bb.setData3fAt(t,0,e,s,i)}toString(){return"DashedLineMesh()"}isPolyhedral(){return!1}testRay(t,e,s,i){let a=0,n=this.BV,h=0,l=this.rayTestRadius;for(let o=0;o<this.Dv;++o){if(m.Gt.setXYZ(n[a],n[a+1],n[a+2]),m.Gu.setXYZ(n[a+3],n[a+4],n[a+5]),h=r.default.IntersectionLS(t,e,m.Gt,m.Gu,s,l),h>0)return 1;a+=6}return 0}__$destroy(){this.isResFree()&&(this.bounds=null,this.BV=null,this.BY=null,super.__$destroy())}}m.Gt=new a.default,m.Gu=new a.default,e.default=m},"9c4d":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.prev=null,this.next=null,this.flag=0,this.target=null}reset(){this.flag=0,this.target=null}}class a{constructor(){this.A_Y=null,this.A_Z=null}destroy(){this.clear()}clear(){this.A_Y=this.A_Z=null}getBegin(){return this.A_Y}isEmpty(){return this.A_Y==this.A_Z&&null==this.A_Z}addNode(t){null==this.A_Y?this.A_Z=this.A_Y=t:null!=this.A_Z.prev?(this.A_Z.next=t,t.prev=this.A_Z,this.A_Z=t):(this.A_Y.next=t,t.prev=this.A_Z,this.A_Z=t),this.A_Z.next=null}removeNode(t){t==this.A_Y?t==this.A_Z?this.A_Y=this.A_Z=null:(this.A_Y=t.next,this.A_Y.prev=null):t==this.A_Z?(this.A_Z=t.prev,this.A_Z.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}class r{constructor(){this.Dw=new a,this.Dx=[],this.Dy=[new i]}getFreeId(){if(this.Dx.length>0)return this.Dx.pop();let t=new i;return t.flag=this.Dy.length,this.Dy.push(t),t.flag}addRunner(t){if(null!=t&&t.getRunFlag()<1){let e=this.getFreeId(),s=this.Dy[e];s.flag=e,s.target=t,t.setRunFlag(e),this.Dw.addNode(s)}}removeRunner(t){if(null!=t&&t.getRunFlag()>0){let e=t.getRunFlag();this.Dx.push(e);let s=this.Dy[e];s.flag=e,s.target=null,t.setRunFlag(0),this.Dw.removeNode(s)}}run(){let t=this.Dw.getBegin(),e=t;while(null!=e)t=e,e=t.next,t.target.isRunning()&&t.target.run()}}e.default=r},"9f3e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("8d98"),r=i(s("df25"));class n extends r.default{constructor(t,e,s=!1){super(t,e,s),this.n=a.TextureProxyType.Uint16,this.minFilter=a.TextureConst.LINEAR,this.dataType=a.TextureDataType.UNSIGNED_SHORT}toHalfFloatOes(){this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA,this.unpackAlignment=4,this.dataType=a.TextureDataType.HALF_FLOAT_OES}toUShort565(){this.srcFormat=a.TextureFormat.RGB,this.internalFormat=a.TextureFormat.RGB,this.unpackAlignment=3,this.dataType=a.TextureDataType.UNSIGNED_SHORT_5_6_5}toUShort4444(){this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA,this.unpackAlignment=4,this.dataType=a.TextureDataType.UNSIGNED_SHORT_4_4_4_4}toUShort5551(){this.unpackAlignment=4,this.dataType=a.TextureDataType.UNSIGNED_SHORT_5_5_5_1}toUShort(){this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA,this.dataType=a.TextureDataType.UNSIGNED_SHORT}toAlphaFormat(){this.dataType==a.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=a.TextureFormat.ALPHA,this.internalFormat=a.TextureFormat.ALPHA,this.unpackAlignment=1)}toRedFormat(){this.dataType==a.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=a.TextureFormat.RED,this.internalFormat=a.TextureFormat.RED,this.unpackAlignment=1)}toRGBFormat(){this.dataType==a.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=a.TextureFormat.RGB,this.internalFormat=a.TextureFormat.RGB,this.unpackAlignment=3)}toRGBAFormat(){this.dataType==a.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA,this.unpackAlignment=4)}uploadFromBytes(t,e=0,s=-1,i=-1,a=0,r=0,n=!1){super.setDataFromBytes(t,e,s,i,a,r,n)}setPartDataFromeBytes(t,e,s,i,a,r=0){super.setPartDataFromeBytes(t,e,s,i,a,r)}getPixels(t,e,s,i,a){super.getPixels(t,e,s,i,a)}toString(){return"[Uint16TextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},a221:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},a254:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("faa5")),r=i(s("b3bd")),n=i(s("0fc4"));class h extends a.default{constructor(){super(),this.Ak="",this.Dz=!1,this.mapLodEnabled=!1}initialize(t){this.Ak="ScreenPlaneShd",this.Dz=t,t&&(this.Ak+="_tex",this.mapLodEnabled&&(this.Ak+="Lod"))}buildShader(){let t=this.A_R;t.mapLodEnabled=!1,this.Dz&&(t.mapLodEnabled=this.mapLodEnabled,this.A_S.addDiffuseMap()),t.addFragUniform("vec4","u_param",3),t.useVertSpaceMats(!0,!1,!1),this.A_R.addFragMainCode("\nvoid main() {\n#ifdef VOX_USE_2D_MAP\n    #ifdef VOX_Texture2DLod\n    vec4 color4 = VOX_Texture2DLod(VOX_DIFFUSE_MAP, v_uv, u_param[2].w);\n    #else\n    vec4 color4 = VOX_Texture2D(VOX_DIFFUSE_MAP, v_uv);\n    #endif\n    color4 *= u_param[0];\n    color4 += u_param[1];\n    FragColor0 = color4;\n#else\n    FragColor0 = u_param[0] + u_param[1];\n#endif\n}\n"),this.A_R.addVertMainCode("\nvoid main() {\n    gl_Position = u_objMat * vec4(a_vs,1.0);\n#ifdef VOX_USE_2D_MAP\n    v_uv = a_uvs.xy;\n#endif\n}\n")}getUniqueShaderName(){return this.Ak}toString(){return"[ScreenPlaneShaderBuffer()]"}static GetInstance(){return null!=h.F_0||(h.F_0=new h),h.F_0}}h.F_0=null;class l extends n.default{constructor(){super(),this.mapLodEnabled=!1,this.D0=new Float32Array([1,1,1,1,0,0,0,0,0,0,0,0])}buildBuf(){let t=h.GetInstance();t.mapLodEnabled=this.mapLodEnabled}getCodeBuf(){return h.GetInstance()}setRGB3f(t,e,s){this.D0[0]=t,this.D0[1]=e,this.D0[2]=s}setRGBA4f(t,e,s,i){this.D0[0]=t,this.D0[1]=e,this.D0[2]=s,this.D0[3]=i}setOffsetRGB3f(t,e,s){this.D0[0]=t,this.D0[1]=e,this.D0[2]=s}setOffsetRGBA4f(t,e,s,i){this.D0[0]=t,this.D0[1]=e,this.D0[2]=s,this.D0[3]=i}setTextureLodLevel(t){this.D0[11]=t}createSelfUniformData(){let t=new r.default;return t.uniformNameList=["u_param"],t.dataList=[this.D0],t}}e.default=l},a446:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("11e6")),r=s("cc48"),n=i(s("265e")),h=i(s("af68")),l=i(s("a80a"));class o{constructor(){this.T=-1,this.B_6=null,this.A_i=null,this.D1=null,this.D2=new n.default,this.Bc=null,this.D3=new h.default,this.D4=new l.default,this.D5=new l.default,this.D6=null,this.C_G=null,this.D7=0,this.T=o.F_j++,this.D3.initialize(1)}getUid(){return this.T}initialize(t,e=null){null==this.B_6&&(this.B_6=t,this.D1=t.getStage3D(),this.A_i=e,this.Bc=t.getRPONodeBuilder())}getStage3D(){return this.D1}setCamera(t){this.A_i=t}getCamera(){return this.A_i}getMouseXYWorldRay(t,e){this.A_i.getWorldPickingRayByScreenXY(this.D1.mouseX,this.D1.mouseY,t,e)}setSpaceCullingor(t){this.D6=t}setRaySelector(t){this.C_G=t,this.C_G.setRenderer(this.B_6)}getRaySelector(){return this.C_G}addEntity(t){if(null!=t.getGlobalBounds()&&t.spaceCullMask>r.SpaceCullingMask.NONE&&a.default.TestSpaceEnabled(t.__$rseFlag)){t.update(),++this.D7;let e=this.D3.addEntity(t);e.bounds=t.getGlobalBounds(),e.pcoEnabled=(t.spaceCullMask&r.SpaceCullingMask.POV)==r.SpaceCullingMask.POV;let s=t.isInRendererProcess()||null==t.getMaterial();s&&(t.spaceCullMask&r.SpaceCullingMask.POV)==r.SpaceCullingMask.POV?(e.rstatus=1,null==t.getMaterial()&&(e.rpoNode=this.D2),null==e.rpoNode&&(e.rpoNode=this.Bc.getNodeByUid(t.getDisplay().__$rpuid)),this.D5.addNode(e)):null==t.getMaterial()?(e.rstatus=1,e.rpoNode=this.D2,this.D5.addNode(e)):(e.rstatus=0,this.D4.addNode(e))}}removeEntity(t){if(null!=t&&a.default.TestSpaceContains(t.__$rseFlag)){let e=this.D3.getNodeByEntity(t);null!=e&&(e.rstatus>0?this.D5.removeNode(e):this.D4.removeNode(e),this.D3.removeEntity(t),--this.D7)}}updateEntity(t){}update(){}runBegin(){}run(){let t=this.D4.getBegin();if(null!=t){let e=null;while(null!=t)t.entity.isInRendererProcess()?(e=t,e.rstatus=1,t=t.next,this.D4.removeNode(e),this.D5.addNode(e),null==e.rpoNode&&(e.rpoNode=this.Bc.getNodeByUid(e.entity.getDisplay().__$rpuid))):t=t.next}if(t=this.D5.getBegin(),null!=t)if(null!=this.D6)this.D6.setCamera(this.A_i),this.D6.setCullingNodeHead(t),this.D6.run();else{let e=null,s=this.A_i;while(null!=t)t.rpoNode.isVsible()&&t.entity.isDrawEnabled()?(e=t.bounds,t.drawEnabled=s.visiTestSphere2(e.center,e.radius),t.entity.drawEnabled=t.drawEnabled,t.rpoNode.drawEnabled=t.drawEnabled):(t.drawEnabled=!1,t.entity.drawEnabled=!1,t.rpoNode.drawEnabled=!1),t=t.next}}rayTest(t,e){null!=this.C_G&&(this.C_G.setCamera(this.A_i),this.C_G.setCullingNodeHead(this.D5.getBegin()),this.C_G.setRay(t,e),this.C_G.run())}runEnd(){}getCullingNodeHead(){return this.D5.getBegin()}toString(){return"[RendererSpace(uid = "+this.T+")]"}}o.F_j=0,e.default=o},a46e:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17")),r=i(s("1710")),n=i(s("3b73"));class h{constructor(){this.A_i=null,this.D8=!1,this.D9=0,this.D_A=2,this.D_B=1,this.D_C=6,this.D_D=new a.default,this.D_E=new a.default,this.D_F=new a.default,this.D_G=new a.default,this.D_H=new a.default,this.D_I=new a.default,this.D_J=new a.default,this.D_K=0,this.D_L=!0,this.D_M=!0,this.D_N=0,this.D_O=0,this.D_P=!0,this.syncLookAt=!1,this.D_Q=2,this.D_P=!(n.default.IsMobileWeb()||n.default.IsSafariWeb())}setMobileZoomSpeed(t){this.D_A=t}seSlideSpeed(t){this.D_B=t}setMouseWheelZoomSpd(t){this.D_C=t}bindCamera(t){this.A_i=t}initialize(t){this.D_L&&(this.D_L=!1,t.addEventListener(r.default.MOUSE_WHEEL,this,this.mouseWheelListener,!0,!0),t.addEventListener(r.default.MOUSE_MULTI_MOVE,this,this.mouseMultiMoveListener,!0,!0),t.addEventListener(r.default.MOUSE_MULTI_UP,this,this.mouseMultiUpListener,!0,!0))}setLookAtCtrlEnabled(t){this.D_M=t}mouseWheelListener(t){t.wheelDeltaY>0?this.D_K+=this.D_C:this.D_K-=this.D_C}mouseMultiMoveListener(t){this.setTouchPosArray(t.posArray)}mouseMultiUpListener(t){this.setTouchPosArray(t.posArray)}resetState(){this.D_N=0,this.D_O=0,this.D_Q=0}setTouchPosArray(t){if(null!=t&&t.length>1){let e=0;if(this.D_H.setXYZ(t[0].x,t[0].y,0),this.D_I.setXYZ(t[1].x,t[1].y,0),this.D8){e=a.default.Distance(this.D_H,this.D_I),this.D_Q<1?(this.D_D.copyFrom(this.D_H),this.D_E.copyFrom(this.D_I),this.D_D.subVecsTo(this.D_H,this.D_F),this.D_E.subVecsTo(this.D_I,this.D_G),this.D_D.normalize(),this.D_E.normalize(),this.D_D.dot(this.D_E)>.9?this.D_N++:this.D_O++,(this.D_N>3||this.D_O>3)&&(this.D_Q=this.D_N>this.D_O?1:2)):this.D_D.subVecsTo(this.D_H,this.D_F);let t=Math.abs(this.D9-e);t>.1&&(this.D_K=(e-this.D9)*this.D_A,this.D9=e)}else this.D8=!0,this.D9=a.default.Distance(this.D_H,this.D_I),this.resetState()}else this.resetState(),this.D8=!1;this.D_F.copyFrom(this.D_H),this.D_G.copyFrom(this.D_I)}run(t,e){let s=this.D_M;if(null==t&&(t=this.D_J),null!=this.A_i)if(this.syncLookAt&&this.A_i.setLookAtPosition(t),2==this.D_Q){if(Math.abs(this.D_K)>.001){let i=a.default.Distance(this.A_i.getPosition(),this.A_i.getLookAtPosition()),r=this.D_K;this.D_K>0&&(i>e?(r=i-e,r>this.D_K&&(r=this.D_K)):r=0),Math.abs(r)>.1&&(this.A_i.forward(r),s&&this.A_i.setLookPosXYZFixUp(t.x,t.y,t.z)),this.D_P?this.D_K*=.95:this.D_K=0}}else 1==this.D_Q&&this.A_i.slideViewOffsetXY(-this.D_D.x*this.D_B,this.D_D.y*this.D_B)}}e.default=h},a7ed:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("ab73")),r=i(s("7279"));class n{create(t,e){let s=null,i=a.default.FrustumParam;return e.hasUniformByName(i.name)&&(s=new r.default,s.uns=i.name,s.uniformNameList=[i.name],s.copyDataFromProbe(t.getCamera().ufrustumProbe)),s}getIDNS(){return"FrustumUniformBuilder"}}e.default=n},a80a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.A_Y=null,this.A_Z=null}destroy(){this.clear()}clear(){this.A_Y=this.A_Z=null}getBegin(){return this.A_Y}isEmpty(){return this.A_Y==this.A_Z&&null==this.A_Z}addNode(t){null==this.A_Y?this.A_Z=this.A_Y=t:null!=this.A_Z.prev?(this.A_Z.next=t,t.prev=this.A_Z,this.A_Z=t):(this.A_Y.next=t,t.prev=this.A_Z,this.A_Z=t),this.A_Z.next=null}removeNode(t){t==this.A_Y?t==this.A_Z?this.A_Y=this.A_Z=null:(this.A_Y=t.next,this.A_Y.prev=null):t==this.A_Z?(this.A_Z=t.prev,this.A_Z.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}e.default=i},a996:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uuid="",this.phase=0,this.type=i.RESIZE,this.target=null,this.currentTarget=null,this.data=null,this.__$preventBoo=!1}getClassType(){return i.EventClassType}preventDefault(){this.__$preventBoo=!0}reset(){this.__$preventBoo=!1}toString(){return"[EventBase]"}}i.EventClassType=1001,i.RESIZE=3001,i.ENTER_FRAME=3002,e.default=i},a9bf:function(t,e,s){"use strict";s.r(e),s.d(e,"EnvShaderCode",(function(){return h}));var i="#ifdef VOX_USE_FOG\r\n    #ifdef VOX_FOG_COLOR_MAP\r\n        vec3 fogEnvColor = vec3(1.0);\r\n        vec4 getFogColorFromTexture2D(sampler2D tex) {\r\n            vec4 color = VOX_Texture2D(tex, (u_envLightParams[3].xy + worldPosition.xz) / u_envLightParams[3].zw);\r\n            fogEnvColor = color.xyz;\r\n            return color;\r\n        }\r\n    #endif\r\n    void useFog(inout vec4 color) {\r\n        vec3 fogColor = u_envLightParams[2].xyz;\r\n        #ifdef VOX_FOG_COLOR_MAP\r\n            fogColor *= fogEnvColor;\r\n        #endif\r\n        #ifdef VOX_FOG_EXP2\r\n            float fogDensity = u_envLightParams[2].w;\r\n            float fogFactor = 1.0 - exp( - fogDensity * fogDensity * v_fogDepth * v_fogDepth );\r\n        #else\r\n            float fogNear = u_envLightParams[1].z;\r\n            float fogFar = u_envLightParams[1].w;\r\n            float fogFactor = smoothstep( fogNear, fogFar, v_fogDepth );\r\n        #endif\r\n        #ifdef VOX_USE_BRIGHTNESS_OVERLAY_COLOR\r\n            color.xyz = mix( color.rgb, fogColor, fogFactor ) * length(color.rgb) * (1.0 - fogFactor);\r\n        #else\r\n            color.xyz = mix( color.rgb, fogColor, fogFactor );\r\n            #ifdef VOX_PREMULTIPLY_ALPHA\r\n                color.xyz *= color.w;\r\n            #endif\r\n        #endif\r\n    }\r\n#endif",a="void calcFogDepth(in vec4 viewPos) {\r\n    v_fogDepth = -viewPosition.z;\r\n}",r="#ifdef VOX_FOG_COLOR_MAP\r\n    getFogColorFromTexture2D( VOX_FOG_COLOR_MAP );\r\n#endif\r\n\r\n#ifdef VOX_USE_FOG\r\n    useFog( FragColor0 );\r\n#endif ",n="#ifdef VOX_USE_FOG\r\n\r\ncalcFogDepth(viewPosition);\r\n\r\n#endif";const h={vert:"",vert_head:a,vert_body:n,frag:"",frag_head:i,frag_body:r}},a9f4:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["Default"]=1]="Default",t[t["VSM"]=1]="VSM"}(i||(i={})),e.ShadowMode=i},ab73:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.type="vec4",this.data=null,this.name="u_vsmParams",this.arrayLength=3}}class a{constructor(){this.type="vec4",this.data=new Float32Array([.1,.1,.1,1,1,.1,600,3500,.3,0,.9,5e-4,0,0,800,800,-500,-500,1e3,1e3]),this.name="u_envLightParams",this.arrayLength=5}}class r{constructor(){this.type="mat4",this.data=null,this.name="u_shadowMat",this.arrayLength=0}}class n{constructor(){this.type="vec4",this.data=null,this.name="u_stageParam",this.arrayLength=0}}class h{constructor(){this.type="vec4",this.data=null,this.name="u_viewParam",this.arrayLength=0}}class l{constructor(){this.type="vec4",this.data=null,this.name="u_frustumParam",this.arrayLength=0}}class o{constructor(){this.type="vec4",this.data=null,this.name="u_cameraPosition",this.arrayLength=0}}class _{constructor(){this.type="vec4",this.positionName="u_lightPositions",this.colorName="u_lightColors"}}class m{}m.LocalTransformMatUNS="u_objMat",m.CameraViewMatUNS="u_viewMat",m.CameraProjectiveMatUNS="u_projMat",m.FrustumParam=new l,m.CameraPosParam=new o,m.StageParam=new n,m.ViewportParam=new h,m.ShadowMatrix=new r,m.ShadowVSMParams=new i,m.GlobalLight=new _,m.EnvLightParams=new a,e.default=m},abdb:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.AXIS_ANGLE=0,i.QUATERNION=1,i.EULER_ANGLES=2,e.default=i},acaa:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("8d98"),r=i(s("cfaf"));class n extends r.default{constructor(t,e,s=!1){super(t,e,s),this.minFilter=a.TextureConst.NEAREST,this.magFilter=a.TextureConst.NEAREST,this.srcFormat=a.TextureFormat.DEPTH_COMPONENT,this.internalFormat=a.TextureFormat.DEPTH_COMPONENT,this.dataType=a.TextureDataType.UNSIGNED_SHORT,this.o=!1,this.m=!0,this.mipmapEnabled=!1,this.n=a.TextureProxyType.Depth}toDepthUnsignedInt(){this.minFilter=a.TextureConst.NEAREST,this.magFilter=a.TextureConst.NEAREST,this.srcFormat=a.TextureFormat.DEPTH_COMPONENT,this.internalFormat=a.TextureFormat.DEPTH_COMPONENT,this.dataType=a.TextureDataType.UNSIGNED_INT,this.o=!1,this.m=!0,this.mipmapEnabled=!1}toDepthUnsignedShort(){this.minFilter=a.TextureConst.NEAREST,this.magFilter=a.TextureConst.NEAREST,this.srcFormat=a.TextureFormat.DEPTH_COMPONENT,this.internalFormat=a.TextureFormat.DEPTH_COMPONENT,this.dataType=a.TextureDataType.UNSIGNED_SHORT,this.o=!1,this.m=!0,this.mipmapEnabled=!1}toDepthAndStencil(){this.minFilter=a.TextureConst.NEAREST,this.magFilter=a.TextureConst.NEAREST,this.srcFormat=a.TextureFormat.DEPTH_STENCIL,this.internalFormat=a.TextureFormat.DEPTH_STENCIL,this.dataType=a.TextureDataType.UNSIGNED_INT_24_8_WEBGL,this.o=!1,this.mipmapEnabled=!1,this.m=!0}uploadData(t){let e=t.getRC();e.texImage2D(this.l,0,a.TextureFormat.ToGL(e,this.internalFormat),this.g,this.h,0,a.TextureFormat.ToGL(e,this.srcFormat),a.TextureDataType.ToGL(e,this.dataType),null)}toString(){return"[DepthTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},acfe:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("ca6c")),r=i(s("8a0a")),n=i(s("3b73")),h=i(s("81ce")),l=i(s("fc07"));class o{constructor(){this.T=-1,this.adaptationShaderVersion=!0,this.preCompileInfo=null,this.D_R="",this.D_S="",this.A9="",this.A_A=0,this.D_T=null,this.D_U=!1,this.D_V=null,this.A_I=null,this.A_C=null,this.A_J=new Map,this.D_W=!1,this.D_X=0,this.DS=0,this.D_Y=1,this.D_Z=null,this.dataUniformEnabled=!1,this.T=o.F_j++}getVSCodeStr(){return this.D_R}getFSCodeStr(){return this.D_S}getLayoutBit(){return this.D_X}getMid(){return this.DS}getFragOutputTotal(){return this.D_Y}parseCode(t,e){o.Gv.reset(),o.Gv.parseVShaderCode(t),o.Gv.parseFShaderCode(e),this.D_Y=o.Gv.fragOutputTotal,this.D_T=o.Gv.uniforms}initialize(t,e,s){this.A9=t,this.adaptationShaderVersion&&null==this.preCompileInfo&&n.default.IsWebGL1()&&(e=h.default.Es3VtxShaderToES2(e),s=h.default.Es3FragShaderToES2(s)),this.preCompileInfo,this.parseCode(e,s);let i=o.Gv.attributes,l=0,_=i.length,m=null;this.D_V=[],this.A_I=[],this.D_X=0;let u=0;while(l<_){if(m=i[l],null!=m)switch(this.D_V.push(m.name),this.A_I.push(m.typeSize),u+=1,r.default.GetVBufTypeByNS(m.name)){case r.default.VBUF_VS:this.D_X|=a.default.BIT_ONE_0;break;case r.default.VBUF_UVS:this.D_X|=a.default.BIT_ONE_1;break;case r.default.VBUF_NVS:this.D_X|=a.default.BIT_ONE_2;break;case r.default.VBUF_CVS:this.D_X|=a.default.BIT_ONE_3;break;case r.default.VBUF_TVS:this.D_X|=a.default.BIT_ONE_4;break;case r.default.VBUF_VS2:this.D_X|=a.default.BIT_ONE_5;break;case r.default.VBUF_UVS2:this.D_X|=a.default.BIT_ONE_6;break;case r.default.VBUF_NVS2:this.D_X|=a.default.BIT_ONE_7;break;case r.default.VBUF_CVS2:this.D_X|=a.default.BIT_ONE_8;break;case r.default.VBUF_TVS2:this.D_X|=a.default.BIT_ONE_9;break;default:u-=1;break}++l}let d=(u<<11)+this.D_X;o.Gk.has(d)||(o.Gk.set(d,o.Gq),o.Gq++),this.DS=o.Gk.get(d),this.A_A=o.Gv.texTotal,this.D_U=this.A_A>0,this.D_U&&(this.D_Z=o.Gv.texUniformNameListStr.split(",")),this.D_W=this.A_A<this.D_T.length,this.D_R=e,this.D_S=s,this.A9=t}getAttriSizeList(){return this.A_I}getTexUniformNames(){return this.D_Z}getUniforms(){return this.D_T}haveCommonUniform(){return this.D_W}getAttriNSList(){return this.D_V}getUid(){return this.T}getTexTotal(){return this.A_A}haveTexture(){return this.D_U}getLocationsTotal(){return this.A_C.length}getUniformTypeNameByNS(t){let e=this.A_J.get(t);return null!=e?e.typeName:""}getUniformTypeByNS(t){let e=this.A_J.get(t);return null!=e?e.type:0}hasUniformByName(t){return this.A_J.has(t)}getUniformLengthByNS(t){return this.A_J.has(t)&&this.A_J.get(t).arrLength,0}getUniqueShaderName(){return this.A9}destroy(){this.A_A=0}}o.F_j=0,o.Gv=new l.default,o.Gk=new Map,o.Gq=1,e.default=o},af29:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("722e")),r=i(s("8333")),n=s("8d98"),h=i(s("cfaf")),l=i(s("3930")),o=i(s("baae")),_=i(s("29ef"));class m{constructor(t,e){this.D_a=new l.default,this.f_=null,this.d=null,this.x_=null,this.D_b=new l.default,this.B_6=null,this.Cu=!0,this.AA=-1,this.AB=-1,this.D_c=128,this.D_d=128,this.D_e=!0,this.D_f=!1,this.D_g=0,this.D_h=null,this.D_i=-1,this.D_j=-1,this.D_k=[],this.DE=[null,null,null,null,null,null,null,null],this.D_l=null,this.D_m=0,this.AU=!0,this.AL=1,this.AI=256,this.D_n=!0,this.D_o=!0,this.D_p=!1,this.D_q=!1,this.D_r=!1,this.D_s=!1,this.uns="FBOInstance",this.B_6=t,this.D_l=e,this.d=t.getRenderProxy(),this.f_=this.d.getRenderAdapter(),this.x_=t.getRendererContext()}getFBOUid(){return this.AA}setRProcessIDList(t){if(null!=t){if(t.length<1)throw Error("processIDlist.length < 1, but it must: processIDlist.length >= 1");this.D_k=t.slice(0)}}setRProcessList(t){if(t.length<1)throw Error("list.length < 1, but must: list.length >= 1");this.D_k=new Array(t.length);for(let e=0;e<t.length;++e)this.D_k[e]=t[e].getRPIndex()}getRProcessIDAt(t){return this.D_k[t]}getStage3D(){return this.d.getStage3D()}getCamera(){return null!=this.d?this.d.getCamera():null}lockViewport(){this.D_q=!0}unlockViewport(){this.D_q=!1}updateCamera(){null!=this.d&&this.d.updateCamera()}updateCameraDataFromCamera(t){null!=this.d&&this.d.updateCameraDataFromCamera(t)}useGlobalRenderState(t){this.x_.useGlobalRenderState(t)}useGlobalRenderStateByName(t){this.x_.useGlobalRenderStateByName(t)}setGlobalRenderState(t){this.D_i=t}setGlobalRenderStateByName(t){this.D_i=this.x_.getRenderStateByName(t)}lockRenderState(t=-1){this.D_i>=0||t>=0?this.x_.useGlobalRenderState(t<0?this.D_i:t):this.d.lockRenderState()}unlockRenderState(){this.d.unlockRenderState()}useGlobalRenderColorMask(t){this.x_.useGlobalRenderColorMask(t)}useGlobalRenderColorMaskByName(t){this.x_.useGlobalRenderColorMaskByName(t)}setGlobalRenderColorMask(t){this.D_j=t}setGlobalRenderColorMaskByName(t){this.D_j=this.x_.getRenderColorMaskByName(t)}lockColorMask(t=-1){this.D_j>=0||t>=0?this.x_.useGlobalRenderColorMask(t<0?this.D_j:t):this.d.lockRenderColorMask()}unlockRenderColorMask(){this.x_.useGlobalRenderColorMask(_.default.COLOR_MASK_ALL_TRUE),this.d.unlockRenderColorMask()}useGlobalMaterial(t,e=!1,s=!1){this.D_r=e,this.D_s=s,this.x_.useGlobalMaterial(t,this.D_r,s)}setGlobalMaterial(t,e=!1,s=!1){this.D_r=e,this.D_s=s,this.D_h!=t&&(null!=this.D_h&&this.D_h.__$detachThis(),null!=t&&t.__$attachThis()),this.D_h=t}lockMaterial(){null!=this.D_h?this.x_.useGlobalMaterial(this.D_h,this.D_r,this.D_s):this.x_.lockMaterial()}unlockMaterial(){this.x_.unlockMaterial()}updateGlobalMaterialUniform(){this.x_.updateMaterialUniform(this.D_h)}clearDepth(t=1){this.f_.clearFBODepthAt(this.AA,t)}synFBOSizeWithViewport(){this.AU=!0}asynFBOSizeWithViewport(){this.AU=!1}setFBOSizeFactorWithViewPort(t){this.AL=t}createViewportSizeFBOAt(t,e=!1,s=!1,i=0){this.AA<0&&(this.AA=t,this.AB=o.default.FRAMEBUFFER,this.D_c=this.f_.getViewportWidth(),this.D_d=this.f_.getViewportHeight(),this.D_e=e,this.D_f=s,this.D_g=i,this.f_.createFBOAt(t,this.AB,this.D_c,this.D_d,e,s,i))}createFBO(t,e,s=0){this.D_e=t,this.D_f=e,this.D_g=s,this.f_.createFBOAt(this.AA,this.AB,this.D_c,this.D_d,t,e,s)}createAutoSizeFBOAt(t,e=!1,s=!1,i=0){t>=0&&this.AA<0&&(this.AB=o.default.FRAMEBUFFER,this.D_c=512,this.D_d=512,this.AA=t,this.createFBO(e,s,i))}createFBOAt(t,e,s,i=!1,a=!1,r=0){t>=0&&this.AA<0&&(this.AB=o.default.FRAMEBUFFER,this.D_c=e,this.D_d=s,this.AA=t,this.D_c<1&&(this.D_c=this.f_.getRCanvasWidth()),this.D_d<1&&(this.D_d=this.f_.getRCanvasHeight()),this.createFBO(i,a,r))}createReadFBOAt(t,e,s,i=!1,a=!1,r=0){t>=0&&this.AA<0&&(this.AB=o.default.READ_FRAMEBUFFER,this.D_c=e,this.D_d=s,this.AA=t,this.D_c<1&&(this.D_c=this.f_.getRCanvasWidth()),this.D_d<1&&(this.D_d=this.f_.getRCanvasHeight()),this.createFBO(i,a,r))}createDrawFBOAt(t,e,s,i=!1,a=!1,r=0){t>=0&&this.AA<0&&(this.AB=o.default.DRAW_FRAMEBUFFER,this.D_c=e,this.D_d=s,this.AA=t,this.D_c<1&&(this.D_c=this.f_.getRCanvasWidth()),this.D_d<1&&(this.D_d=this.f_.getRCanvasHeight()),this.createFBO(i,a,r))}resizeFBO(t,e){this.D_c==t&&this.D_d==e||(this.D_c=t,this.D_d=e,this.f_.resizeFBOAt(this.AA,t,e))}getRTTAt(t){return this.DE[t]}enableMipmapRTTAt(t){this.DE[t].enableMipmap()}generateMipmapTextureAt(t){this.DE[t].generateMipmap(this.d.Texture)}setRenderToTexture(t,e=0){return 0==e?this.D_m=1:this.D_m<e+1&&(this.D_m=e+1),this.DE[e]=t,t}setRenderToRTTTextureAt(t,e=0){this.setRenderToTexture(this.D_l.getRTTTextureAt(t),e)}setRenderToFloatTextureAt(t,e=0){this.setRenderToTexture(this.D_l.getRTTFloatTextureAt(t),e)}setRenderToHalfFloatTexture(t,e=0){return null==t&&(t=new h.default(128,128),t.__$setRenderProxy(this.d),t.internalFormat=n.TextureFormat.RGBA16F,t.srcFormat=n.TextureFormat.RGBA,t.dataType=n.TextureDataType.FLOAT,t.minFilter=n.TextureConst.LINEAR,t.magFilter=n.TextureConst.LINEAR,t.__$setRenderProxy(this.d)),this.setRenderToTexture(t,e)}setRenderToRGBATexture(t,e=0){return null==t&&(t=this.createRGBATexture()),this.setRenderToTexture(t,e)}setRenderToDepthTextureAt(t,e=0){return this.setRenderToTexture(this.D_l.getDepthTextureAt(t),e)}createRGBATexture(){let t=new h.default(32,32);return t.internalFormat=n.TextureFormat.RGBA,t.srcFormat=n.TextureFormat.RGBA,t.dataType=n.TextureDataType.UNSIGNED_BYTE,t.minFilter=n.TextureConst.LINEAR,t.magFilter=n.TextureConst.LINEAR,t.__$setRenderProxy(this.d),t}setClearState(t,e,s=!1){this.D_n=t,this.D_o=e,this.D_p=s}setRenderToBackBuffer(){this.d.setClearColor(this.D_a),this.x_.setRenderToBackBuffer()}setClearDepth(t){this.AI=t}getClearDepth(){return this.f_.getClearDepth()}getViewportX(){return this.f_.getViewportX()}getViewportY(){return this.f_.getViewportY()}getViewportWidth(){return this.f_.getViewportWidth()}getViewportHeight(){return this.f_.getViewportHeight()}getFBOWidth(){return this.f_.getFBOWidthAt(this.AA)}getFBOHeight(){return this.f_.getFBOHeightAt(this.AA)}resetAttachmentMask(t){this.f_.resetFBOAttachmentMask(t)}setAttachmentMaskAt(t,e){this.f_.setFBOAttachmentMaskAt(t,e)}setClearRGBColor3f(t,e,s){this.D_b.setRGB3f(t,e,s)}setClearColorEnabled(t){this.D_n=t}setClearDepthEnabled(t){this.D_o=t}setClearStencilEnabled(t){this.D_p=t}setClearUint24Color(t,e=1){this.D_b.setRGBUint24(t),this.D_b.a=e}setClearRGBAColor4f(t,e,s,i){this.D_b.setRGBA4f(t,s,e,i)}blitFrom(t,e=r.default.COLOR_BUFFER_BIT,s=a.default.NEAREST,i=-1,n=0,h=null){this.AA>=0&&(this.f_.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.f_.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.f_.blitFBO(t.getFBOUid(),this.AA,e,s,i,n,h))}blitColorFrom(t,e=a.default.NEAREST,s=-1,i=0,n=null){this.AA>=0&&(this.f_.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.f_.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.f_.blitFBO(t.getFBOUid(),this.AA,r.default.COLOR_BUFFER_BIT,e,s,i,n))}blitDepthFrom(t,e=a.default.NEAREST,s=-1,i=0,n=null){this.AA>=0&&(this.f_.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.f_.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.f_.blitFBO(t.getFBOUid(),this.AA,r.default.COLOR_BUFFER_BIT|r.default.DEPTH_BUFFER_BIT,e,s,i,n))}blitColorAndDepthFrom(t,e=a.default.NEAREST,s=-1,i=0,n=null){this.AA>=0&&(this.f_.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.f_.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.f_.blitFBO(t.getFBOUid(),this.AA,r.default.COLOR_BUFFER_BIT|r.default.DEPTH_BUFFER_BIT,e,s,i,n))}blitStencilFrom(t,e=a.default.NEAREST,s=-1,i=0,n=null){this.AA>=0&&(this.f_.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.f_.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.f_.blitFBO(t.getFBOUid(),this.AA,r.default.STENCIL_BUFFER_BIT,e,s,i,n))}renderToTextureAt(t,e=0){this.f_.setRenderToTexture(this.DE[t],this.D_e,this.D_f,e),this.f_.useFBO(this.D_n,this.D_o,this.D_p)}runBeginDo(){if(this.Cu){this.Cu=!1,this.d.getClearRGBAColor4f(this.D_a),this.D_q?this.f_.lockViewport():this.f_.unlockViewport(),this.f_.bindFBOAt(this.AA,this.AB),this.AU?(this.f_.synFBOSizeWithViewport(),this.f_.setFBOSizeFactorWithViewPort(this.AL)):this.f_.asynFBOSizeWithViewport(),this.AI<128&&this.f_.setClearDepth(this.AI),this.d.setClearColor(this.D_b);let t=0;for(;t<this.D_m;++t)this.f_.setRenderToTexture(this.DE[t],this.D_e,this.D_f,t);this.f_.useFBO(this.D_n,this.D_o,this.D_p),null!=this.D_h?this.x_.useGlobalMaterial(this.D_h,this.D_r,this.D_s):this.x_.unlockMaterial()}}run(t=!1,e=!1,s=!0,i=!0){if(t&&this.lockRenderState(),e&&!i&&this.lockMaterial(),this.AA>=0&&null!=this.D_k){i&&this.runBeginDo();for(let t=0,e=this.D_k.length;t<e;++t)this.B_6.runAt(this.D_k[t])}t&&this.unlockRenderState(),e&&this.unlockMaterial(),s&&this.runEnd()}runAt(t,e=!0){this.AA>=0&&null!=this.D_k&&(0==t&&e?this.runBeginDo():this.Cu=!0,this.B_6.runAt(this.D_k[t]))}drawEntity(t,e=!1,s=!0){this.Cu||this.B_6.drawEntity(t,e,s)}runBegin(){this.AA>=0&&null!=this.D_k&&(this.Cu=!0,this.runBeginDo())}runEnd(){this.d.setClearColor(this.D_a),this.Cu=!0,this.D_q&&this.f_.unlockViewport()}useCamera(t,e=!1){this.B_6.useCamera(t,e)}useMainCamera(){this.B_6.useMainCamera()}reset(){let t=0;for(;t<this.D_m;++t)this.DE[t]=null;this.Cu=!1,this.AA=-1,this.D_m=0,this.D_k=[],null!=this.D_h&&(this.D_h.__$detachThis(),this.D_h=null)}clone(){let t=new m(this.B_6,this.D_l);t.AL=this.AL,t.D_b.copyFrom(this.D_b),t.AA=this.AA,t.AB=this.AB,t.AI=this.AI,t.D_m=this.D_m,t.D_e=this.D_e,t.D_f=this.D_f,t.AU=this.AU,t.D_c=this.D_c,t.D_d=this.D_d,t.D_g=this.D_g;let e=0;for(;e<this.D_m;++e)t.DE[e]=t.DE[e];if(null!=this.D_k){let s=this.D_k.length,i=new Array(s);for(e=0;e<s;++e)i[e]=this.D_k[e];t.setRProcessIDList(i)}return t}}e.default=m},af68:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("11e6")),r=i(s("7b0e"));class n{constructor(){this.C_v=0,this.D_t=[],this.C_u=[],this.D_u=[],this.D_v=[],this.X_=[]}getFreeId(){return this.X_.length>0?this.X_.pop():-1}createNode(){let t=this.getFreeId();if(t>=0)return this.D_v[t]=1,this.C_u[t];{t=this.C_v;let e=r.default.Create();return this.C_u.push(e),this.D_u.push(null),e.spaceId=t,this.D_v.push(1),this.D_t.push(t),this.D_v.push(1),this.C_v++,e}}restoreId(t){t>0&&1==this.D_v[t]&&(this.X_.push(t),this.D_v[t]=0,this.D_u[t]=null)}addEntity(t){let e=this.createNode();return this.D_u[e.spaceId]=t,e.entity=t,t.__$rseFlag=a.default.AddSpaceUid(t.__$rseFlag,e.spaceId),e}initialize(t){if(t>0)for(let e=0;e<t;e++){let t=this.createNode();this.D_u[t.spaceId]=null}}getNodeByEntity(t){if(a.default.TestSpaceContains(t.__$rseFlag)){let e=a.default.GetSpaceUid(t.__$rseFlag);if(this.D_u[e]==t)return this.C_u[e]}return null}removeEntity(t){if(a.default.TestSpaceContains(t.__$rseFlag)){let e=a.default.GetSpaceUid(t.__$rseFlag);this.D_u[e]==t&&(this.C_u[e].entity=null,this.restoreId(e),t.__$rseFlag=a.default.RemoveSpaceUid(t.__$rseFlag))}}toString(){return"[EntityNodeQueue()]"}}e.default=n},b02c:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("6e01"));class r{constructor(t,e){this.T=-1,this.DS=-1,this.A_A=0,this.D_w=null,this.D_x=null,this.q_=null,this.A=0,this.BN=null,this.direct=!0,this.c=0,this.A=t,this.T=r.F_j++,this.DS=e}__$setParam(t,e){this.A=t,this.DS=e}getRCUid(){return this.A}getMid(){return this.DS}getTexTotal(){return this.A_A}collectTexList(t,e,s){this.BN=t;let i=0;if(this.direct)if(this.A_A<1&&e.length>0){let r,n=a.default.GetNearestCeilPow2(e.length);this.D_x=new Uint16Array(n),this.D_w=new Array(n),this.q_=e;while(i<s)r=e[i],r.__$attachThis(),r.__$$upload(t),this.D_x[i]=r.getSampler(),this.D_w[i]=this.BN.getGpuBuffer(r.getResUid()),this.BN.__$attachRes(r.getResUid()),i++;this.A_A=i}else this.A_A=0;else this.A_A=s;while(i<e.length)e[i++].__$attachThis()}run(){if(this.BN.unlocked&&this.BN.texMid!=this.DS){this.BN.texMid=this.DS;let t=this.BN.getRC(),e=t.TEXTURE0;if(this.direct)for(let s=0;s<this.A_A;++s)t.activeTexture(e++),t.bindTexture(this.D_x[s],this.D_w[s]);else{let s=this.q_;for(let i=0;i<this.A_A;++i)t.activeTexture(e++),s[i].__$$use(this.BN)}}}getUid(){return this.T}__$attachThis(){++this.c}__$detachThis(){--this.c,this.c<1&&(this.c=0,r.Restore(this))}reset(){if(null!=this.q_)for(let t=0,e=this.q_.length;t<e;++t)this.q_[t].__$detachThis(),this.BN.__$detachRes(this.q_[t].getResUid()),this.D_w[t]=null;this.A_A=0,this.q_=null,this.BN=null}toString(){return"TextureRenderObj(uid = "+this.T+", mid="+this.DS+")"}static Create(t,e,s){let i=e.length;if(i>0&&s>0){if(i<s)throw Error("There are fewer textures than in the shader : (need "+s+",but only have "+i+") !!!");let a=31,n=0,h=!0;while(n<s)a=131*a+e[n].getUid(),e[n].isDirect()||(h=!1),++n;let l=r.Gx[t.getRCUid()],o=null;return l.has(a)?o=l.get(a):(o=r.Gw.length<1?new r(t.getRCUid(),a):r.Gw.pop(),o.collectTexList(t,e,s),l.set(a,o)),o.__$setParam(t.getRCUid(),a),o.direct=h,o}return null}static Restore(t){t.getMid()>-1&&(r.Gx[t.getRCUid()].delete(t.getMid()),t.__$setParam(0,0),r.Gw.push(t),t.reset())}static GetByMid(t,e){return r.Gx[t].get(e)}}r.F_j=0,r.Gx=[new Map,new Map,new Map,new Map,new Map,new Map,new Map,new Map],r.Gw=[],r.Gy=!0,r.Gz=-1,e.TextureRenderObj=r;class n{constructor(t){this.BN=null,this.BN=t}run(){this.BN.renderBegin()}getMid(){return 1}__$attachThis(){}__$detachThis(){}}e.EmptyTexRenderObj=n,e.default=r},b0ef:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.r=null,this.q=null,this.D_y=-1,this.D_z=-1,this.resized=!0}setDiv(t){this.q=t}createViewEle(t,e){null==this.q&&(this.q=document.getElementById("voxEngineDiv")),null==this.q&&(this.q=t.createElement("div"),this.q.style.width="400px",this.q.style.height="300px",document.body.appendChild(this.q)),this.q.style.display="bolck",this.q.style.position="absolute",""==this.q.style.left&&(this.q.style.left="0px",this.q.style.top="0px"),e&&(this.q.style.width="100%",this.q.style.height="100%"),null==this.r&&(this.r=document.createElement("canvas"),this.q.appendChild(this.r),this.r.width=800,this.r.height=600,this.r.style.display="bolck",this.r.style.left="0px",this.r.style.top="0px",this.r.style.position="absolute")}setDivStyleLeftAndTop(t,e){this.q.style.left=t+"px",this.q.style.top=e+"px"}setDivStyleSize(t,e){this.D_y==t&&this.D_z==e||(this.q.style.width=t+"px",this.q.style.height=e+"px",this.resized=!0)}getDiv(){return this.q}getCanvas(){return this.r}}e.default=i},b161:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17")),r=i(s("3806")),n=i(s("c51d")),h=i(s("c497")),l=i(s("af68")),o=i(s("a80a")),_=i(s("9c4d")),m=i(s("d958")),u=i(s("5d04")),d=i(s("a446")),c=i(s("c711")),f=i(s("955e")),p=i(s("765c")),g=i(s("af29")),v=i(s("d7e2")),x=i(s("70f2")),T=i(s("2139"));class E{constructor(){this.T=-1,this.f_=null,this.d=null,this.A_e=null,this.x_=null,this.B_6=null,this.Ch=new Uint8Array(128),this.Ci=0,this.Cj=null,this.Ck=new a.default,this.Cl=new a.default,this.Cm=null,this.Cn=!1,this.Co=null,this.Cp=!0,this.B=0,this.C=0,this.D=800,this.E=800,this.Cq=null,this.Cr=null,this.D_0=null,this.D_1=[],this.D_2=0,this.Cu=-1,this.Cv=!0,this.D_3=!1,this.D_4=-1,this.Ct=null,this.A_j=!0,this.runnableQueue=new _.default,this.textureBlock=new u.default,this.stage3D=null,this.Cx=[],this.Cy=0,this.D_5=null,this.Cz=!0,this.C0=!0,this.C1=!0,this.C2=!0,this.T=E.F_j++}tickUpdate(){this.D_4>-1&&clearTimeout(this.D_4),this.D_4=setTimeout(this.tickUpdate.bind(this),this.Ct.getTickUpdateTime()),this.textureBlock.run()}enable(){this.A_j=!0}disable(){this.A_j=!1}isEnabled(){return this.A_j}getUid(){return this.T}getDiv(){return this.d.getDiv()}getCanvas(){return this.d.getCanvas()}getRPONodeBuilder(){return null}getRenderProxy(){return this.d}setViewPort(t,e,s,i){null!=this.d&&(this.B=t,this.C=e,this.D=s,this.E=i,this.d.setViewPort(t,e,s,i))}setViewPortFromCamera(t){null!=this.d&&null!=t&&(this.B=t.getViewX(),this.C=t.getViewY(),this.D=t.getViewWidth(),this.E=t.getViewHeight(),this.d.setViewPort(this.B,this.C,this.D,this.E))}reseizeViewPort(){this.d.reseizeRCViewPort()}lockViewport(){this.f_.lockViewport()}unlockViewport(){this.f_.unlockViewport()}getRendererAdapter(){return this.f_}getRenderer(){return this.B_6}getRendererContext(){return this.x_}getStage3D(){return this.d.getStage3D()}getRendererStatus(){return this.B_6.getRendererStatus()}getViewWidth(){return this.d.getStage3D().viewWidth}getViewHeight(){return this.d.getStage3D().viewHeight}getCamera(){return this.d.getCamera()}asynFBOSizeWithViewport(){this.x_.asynFBOSizeWithViewport()}synFBOSizeWithViewport(){this.x_.synFBOSizeWithViewport()}cameraLock(){this.d.cameraLock()}cameraUnlock(){this.d.cameraUnlock()}getMouseXYWorldRay(t,e){this.d.getMouseXYWorldRay(t,e)}createCamera(){return new n.default}createFBOInstance(){return new g.default(this,this.textureBlock.getRTTStrore())}setClearUint24Color(t,e=1){this.d.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,s){this.d.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.d.setClearRGBAColor4f(t,e,s,i)}setClearColor(t){this.d.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.x_.setRenderToBackBuffer()}drawBackBufferToCanvas(t){let e=this.getCanvas();var s=t.getContext("2d");s.drawImage(e,0,0,t.width,t.height)}updateRenderBufferSize(){this.f_.updateRenderBufferSize()}setEvt3DController(t){null!=t&&(t.initialize(this.getStage3D(),this.getStage3D()),t.setRaySelector(this.Cj.getRaySelector())),this.Co=t}isRayPickSelected(){return null!=this.Co&&this.Co.isSelected()}enableMouseEvent(t=!0){null==this.Co&&(t?this.Cj.setRaySelector(new f.default):this.Cj.setRaySelector(new c.default),this.setEvt3DController(new p.default)),this.Cp=!0}disableMouseEvent(){this.Cp=!1}getEvt3DController(){return this.Co}getSpace(){return this.Cj}getDevicePixelRatio(){return this.f_.getDevicePixelRatio()}createSubScene(){if(null!=this.B_6){let t=new x.default(this,this.B_6,this.Cn);this.D_1.push(t),this.D_2++;let e=t;return e.textureBlock=this.textureBlock,t}return null}addEventListener(t,e,s,i=!0,a=!1){this.stage3D.addEventListener(t,e,s,i,a)}removeEventListener(t,e,s){this.stage3D.removeEventListener(t,e,s)}setAccessor(t){this.Cm=t}initialize(t=null,e=3){if(null==this.B_6){null==t&&(t=new h.default),this.Ct=t;let s=this;s.stage3D=new r.default(this.getUid(),document),e<1&&(e=1),e>8&&(e=8),this.Cn=t.evtFlowEnabled,this.B_6=new m.default,this.B_6.__$setStage3D(this.stage3D),T.default.Allocate(t.getMatrix4AllocateSize());let i=new n.default;this.B_6.initialize(t,i),this.Ch[0]=0,this.Ci++;let a=null;for(;e>=0;)a=this.B_6.appendProcess(t.batchEnabled,t.processFixedState),this.Ch[this.Ci]=a.getRPIndex(),this.Ci++,--e;this.x_=this.B_6.getRendererContext(),this.d=this.x_.getRenderProxy(),this.f_=this.d.getRenderAdapter();let l=this.d.getStage3D();if(this.D=l.stageWidth,this.E=l.stageHeight,this.A_e=this.B_6.getDataBuilder().getRenderShader(),this.textureBlock.setRenderer(this.B_6),this.D_0=new v.default(this.d),null==this.Cj){let t=new d.default;t.initialize(this.B_6,this.d.getCamera()),this.Cj=t}this.tickUpdate()}}setRendererProcessParam(t,e,s){this.B_6.setRendererProcessParam(this.Ch[t],e,s)}appendARendererProcess(t=!0,e=!1){let s=this.B_6.appendProcess(t,e);this.Ch[this.Ci]=s.getRPIndex(),this.Ci++}getRenderProcessAt(t){return this.B_6.getProcessAt(this.Ch[t])}addContainer(t,e=0){if(e<0&&(e=0),null!=t&&t.__$wuid<0&&t.__$contId<1){let s=0;for(;s<this.Cy;++s)if(this.Cx[s]==t)return;s>=this.Cy&&(t.__$wuid=this.T,t.wprocuid=e,t.__$setRenderer(this),this.Cx.push(t),this.Cy++)}}removeContainer(t){if(null!=t&&t.__$wuid==this.T&&t.getRenderer()==this.B_6){let e=0;for(;e<this.Cy;++e)if(this.Cx[e]==t){t.__$wuid=-1,t.wprocuid=-1,t.__$setRenderer(null),this.Cx.splice(e,1),--this.Cy;break}}}setAutoRunningEnabled(t){this.Cv=t}setAutoRenderingSort(t){this.D_3=t}setProcessSortEnabledAt(t,e,s=null){if(this.B_6.setProcessSortEnabledAt(t,e),e){let e=this.B_6.getProcessAt(t);s=null!=s?s:this.D_0,null!=e&&e.setSorter(s)}}setProcessSortEnabled(t,e,s=null){this.B_6.setProcessSortEnabled(t,e),e&&null!=t&&!t.hasSorter()&&(s=null!=s?s:this.D_0,t.setSorter(s))}moveEntityTo(t,e){this.B_6.moveEntityToProcessAt(t,this.Ch[e])}drawEntity(t,e=!1,s=!0){this.B_6.drawEntity(t,e,s)}addEntity(t,e=0,s=!0){if(null!=t&&t.__$testSpaceEnabled())if(t.isPolyhedral())if(t.hasMesh())this.B_6.addEntity(t,this.Ch[e],s),null!=this.Cj&&this.Cj.addEntity(t);else{null==this.Cq&&(this.Cq=new o.default,this.Cr=new l.default);let s=this.Cr.addEntity(t);s.rstatus=e,this.Cq.addNode(s)}else this.B_6.addEntity(t,this.Ch[e],s),null!=this.Cj&&this.Cj.addEntity(t)}removeEntity(t){if(null!=t){let e=null;if(null!=this.Cq){let e=this.Cr.getNodeByEntity(t);null!=e&&(this.Cq.removeNode(e),this.Cr.removeEntity(t))}null==e&&(this.B_6.removeEntity(t),null!=this.Cj&&this.Cj.removeEntity(t))}}updateMaterialUniformToCurrentShd(t){this.B_6.updateMaterialUniformToCurrentShd(t)}showInfoAt(t){this.B_6.showInfoAt(t)}getRenderUnitsTotal(){return this.B_6.getRenderUnitsTotal()}useCamera(t,e=!1){this.D_5=t,e&&(this.d.setRCViewPort(t.getViewX(),t.getViewY(),t.getViewWidth(),t.getViewHeight(),!0),this.d.reseizeRCViewPort()),t.update(),this.x_.resetUniform(),this.d.updateCameraDataFromCamera(t)}useMainCamera(){this.D_5=null;let t=this.d.getCamera();this.d.setRCViewPort(t.getViewX(),t.getViewY(),t.getViewWidth(),t.getViewHeight(),!0),this.d.reseizeRCViewPort(),this.d.updateCamera(),this.x_.resetUniform(),this.d.updateCameraDataFromCamera(this.d.getCamera())}updateCameraDataFromCamera(t){this.d.updateCameraDataFromCamera(t)}resetState(){this.x_.resetState()}resetUniform(){this.x_.resetUniform()}enableSynViewAndStage(){this.d.enableSynViewAndStage()}renderBegin(t=!0){if(null==this.D_5){if(this.f_.unlockViewport(),this.d.isAutoSynViewAndStage()){let t=this.d.testViewPortChanged(this.B,this.C,this.D,this.E);this.B=this.d.getViewX(),this.C=this.d.getViewY(),this.D=this.d.getViewWidth(),this.E=this.d.getViewHeight(),t&&(this.d.setRCViewPort(this.B,this.C,this.D,this.E,!0),this.d.reseizeRCViewPort())}else this.d.setViewPort(this.B,this.C,this.D,this.E);this.d.updateCamera(),this.d.updateCameraDataFromCamera(this.d.getCamera())}this.A_e.renderBegin(),t&&this.x_.renderBegin(null==this.D_5),this.D_5=null,null!=this.Cm&&this.Cm.renderBegin(this)}runBegin(t=!0,e=!0){t&&this.Cv&&(this.Cu>=0&&this.runEnd(),this.Cu=0);let s=this.D_5,i=null==s;this.renderBegin(e),null!=this.Cj&&(this.Cj.setCamera(i?this.d.getCamera():s),this.Cj.runBegin())}renderContextBegin(){this.x_.renderBegin()}setRayTestEanbled(t){this.C2=t}runMouseTest(t,e){let s=-1;if(null!=this.Co&&this.Cp){if(this.C1&&this.Co.getEvtType()>0){let t=this.Cj.getRaySelector();if(null!=t){this.C2?this.mouseRayTest():t.clear();let e=t.getSelectedNodesTotal();if(e>1){let s=0,i=t.getSelectedNodes(),a=null;for(;s<e;++s)a=i[s],a.entity.isPolyhedral()}}this.C1=!1}s=this.Co.run(t,e)}return this.Cz=!1,s}update(t=!0,e=!0){if(this.stage3D.enterFrame(),t&&this.Cv&&(0!=this.Cu&&this.runBegin(),this.Cu=1),this.Cz=!0,this.C0=!0,this.C1=!0,null!=this.Cq){let t=this.Cq.getBegin();if(null!=t){let e,s,i;while(null!=t)t.entity.hasMesh()?(e=t,t=t.next,s=e.entity,i=e.rstatus,this.Cq.removeNode(e),this.Cr.removeEntity(e.entity),this.addEntity(s,i)):t=t.next}}let s=0;for(;s<this.Cy;++s)this.Cx[s].update();this.B_6.update(),null!=this.Cj&&(this.Cj.update(),this.C0&&(null!=this.Co||this.D_3||null!=this.Cj.getRaySelector())&&this.Cj.run()),this.D_3&&this.B_6.updateAllProcess(),this.Cz&&!this.Cn&&(e?this.runMouseTest(1,0):null!=this.Co&&this.Co.mouseOutEventTarget())}cullingTest(){null!=this.Cj&&this.Cj.run(),this.C0=!1}mouseRayTest(){null!=this.Cj&&(this.d.getMouseXYWorldRay(this.Cl,this.Ck),this.Cj.rayTest(this.Cl,this.Ck))}run(t=!0){if(this.A_j){if(t&&this.Cv&&(1!=this.Cu&&this.update(),this.Cu=2),this.runnableQueue.run(),this.D_2>0)for(let t=0;t<this.Ci;++t)this.B_6.runAt(this.Ch[t]);else this.B_6.run();t&&this.runEnd()}}runAt(t){this.A_j&&this.B_6.runAt(this.Ch[t])}runEnd(){null!=this.Co&&this.Co.runEnd(),this.x_.runEnd(),null!=this.Cj&&this.Cj.runEnd(),this.Cv&&(this.Cu=-1),null!=this.Cm&&this.Cm.renderEnd(this)}renderFlush(){null!=this.d&&this.d.flush()}updateCamera(){null!=this.d&&this.d.updateCamera()}toString(){return"[RendererScene(uid = "+this.T+")]"}}E.F_j=0,e.default=E},b30a:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("3b73")),r=i(s("644c")),n=i(s("20ef"));class h{constructor(t,e,s){this.D_6=new Map,this.D_7=[],this.D_8=0,this.D_9=[],this.D_=!0,this.EA=!1,this.EB=-1,this.EC=null,this.D_Y=1,this.A=-1,this.Aj=null,this.ED=null,this.f_=null,this.EE=null,this.A_S=null,this.EF=null,this.drawFlag=-1,this.__$globalUniform=null,this.A=t,this.f_=s,this.Aj=e}createResByParams3(t,e,s,i){return!1}getRC(){return this.Aj}getGPUProgram(){return this.ED}getRCUid(){return this.A}useTransUniform(t){this.EF!=t&&(this.EF=t,t.use(this))}useUniform(t){this.A_S!=t&&(this.A_S=t,t.use(this))}updateUniform(t){null!=t&&t.use(this)}create(t){let e=t.getUniqueShaderName();if(this.D_6.has(e))return this.D_6.get(e);let s=new n.default(this.D_8);return s.setShdData(t),this.D_7[s.getUid()]=s,this.D_9[s.getUid()]=null,++this.D_8,this.D_6.set(e,s),a.default.SHADERCODE_TRACE_ENABLED,s}findShdProgramByUid(t){return this.D_7[t]}findShdProgram(t){return this.D_6.has(t)?this.D_6.get(t):null}findShdProgramByShdData(t){return null!=t&&this.D_6.has(t.getUniqueShaderName())?this.D_6.get(t.getUniqueShaderName()):null}unlock(){this.D_=!0,this.__$globalUniform=null}isUnLocked(){return this.D_}lock(){this.D_=!1}textureUnlock(){this.EA=!0}isTextureUnLocked(){return this.EA}textureLock(){this.EA=!1}setSharedUniformByShd(t,e){this.D_9[t.getUid()]=e}getSharedUniformByShd(t){return this.D_9[t.getUid()]}getCurrFragOutputTotal(){return this.D_Y}hasResUid(t){return null!=this.D_7[t]}bindToGpu(t){if(this.D_&&t>-1&&t<this.D_8)if(this.EB!=t){this.EB=t;let e=this.D_7[t];this.D_Y=e.getFragOutputTotal(),this.D_Y,this.getActiveAttachmentTotal(),this.ED=e.getGPUProgram(),this.Aj.useProgram(this.ED),e.useTexLocation();let s=this.D_9[e.getUid()];this.EE=s;while(null!=s)s.use(this),s=s.next;this.EC=e}else if(null==this.EE&&null!=this.EC){let t=this.D_9[this.EC.getUid()];this.EE=t;while(null!=t)t.use(this),t=t.next}}getGpuBuffer(t){return null}getCurrentShd(){return this.EC}getCurrentShdUid(){return this.EB}resetUniform(){this.A_S=null,this.EF=null,this.EE=null}renderBegin(){this.D_Y=1,this.EB=-1,this.EC=null,this.drawFlag=-1}update(){}destroy(){this.Aj=null,this.f_=null}useUniformToCurrentShd(t){this.A_S!=t&&(this.A_S,t.useByShd(this,this.EC))}useUniform2ToCurrentShd(t,e){this.A_S!=t&&(this.A_S,t.useByShd(this,this.EC)),this.EF!=e&&(this.EF,e.useByShd(this,this.EC))}useUniformMat4(t,e){this.Aj.uniformMatrix4fv(t,!1,e)}useUniformV2(t,e,s,i,a){switch(e){case r.default.SHADER_MAT4:a<1?this.Aj.uniformMatrix4fv(t,!1,s):this.Aj.uniformMatrix4fv(t,!1,s,a,16*i);break;case r.default.SHADER_MAT3:this.Aj.uniformMatrix3fv(t,!1,s,0,9*i);break;case r.default.SHADER_VEC4FV:this.Aj.uniform4fv(t,s,a,4*i);break;case r.default.SHADER_VEC3FV:this.Aj.uniform3fv(t,s,a,3*i);break;case r.default.SHADER_VEC4:this.Aj.uniform4f(t,s[0],s[1],s[2],s[3]);break;case r.default.SHADER_VEC3:this.Aj.uniform3f(t,s[0],s[1],s[2]);break;case r.default.SHADER_VEC2:this.Aj.uniform2f(t,s[0],s[1]);break;default:break}}useUniformV1(t,e,s,i){switch(e){case r.default.SHADER_MAT4:this.Aj.uniformMatrix4fv(t,!1,s);break;case r.default.SHADER_MAT3:this.Aj.uniformMatrix3fv(t,!1,s);break;case r.default.SHADER_VEC4FV:this.Aj.uniform4fv(t,s,4*i);break;case r.default.SHADER_VEC3FV:this.Aj.uniform3fv(t,s,3*i);break;case r.default.SHADER_VEC4:this.Aj.uniform4f(t,s[0],s[1],s[2],s[3]);break;case r.default.SHADER_VEC3:this.Aj.uniform3f(t,s[0],s[1],s[2]);break;case r.default.SHADER_VEC2:this.Aj.uniform2f(t,s[0],s[1]);break;default:break}}getActiveAttachmentTotal(){return this.f_.getActiveAttachmentTotal()}}e.default=h},b3bd:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uns="",this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,s=e.length;for(let i=0;i<s;++i)if(t==e[i])return this.dataList[i]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let s=this.uniformNameList,i=s.length;for(let a=0;a<i;++a)if(t==s[a]){this.dataList[a]=e;break}}}copyDataFromProbe(t){this.types=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]);this.uniformSize=t.uniformsTotal}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.calcModels=null}}e.default=i},b409:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("b3bd")),r=i(s("0fc4")),n=s("839a");e.SpecularMode=n.SpecularMode;const h=s("319d");class l extends r.default{constructor(){super(),this.EG=null,this.EH=1,this.EI=null,this.EJ=null,this.EK=1,this.EL=1,this.colorEnabled=!0,this.normalEnabled=!0,this.diffuseMap=null,this.diffuseMap2=null,this.normalMap=null,this.parallaxMap=null,this.aoMap=null,this.specularMap=null,this.specularMode=n.SpecularMode.Default,this.shadowReceiveEnabled=!1,this.lightEnabled=!0,this.fogEnabled=!1,this.vertColorEnabled=!1,this.envAmbientLightEnabled=!1,this.diffuseMap2Matrix=null,this.vertUniform=null,null==l.G0&&(l.G0=new h.AdvancedShaderCodeBuffer)}clone(){let t=new l;return t.initializeByCodeBuf(!1),t.copyFrom(this),t}copyFrom(t){this.l_=t.l_,this.colorEnabled=t.colorEnabled,this.lightEnabled=t.lightEnabled,this.shadowReceiveEnabled=t.shadowReceiveEnabled,this.fogEnabled=t.fogEnabled,this.normalEnabled=t.normalEnabled,this.vertColorEnabled=t.vertColorEnabled,this.envAmbientLightEnabled=t.envAmbientLightEnabled,this.vertUniform=t.vertUniform,this.diffuseMap2Matrix=t.diffuseMap2Matrix,null==this.diffuseMap&&(this.diffuseMap=t.diffuseMap),null==this.diffuseMap2&&(this.diffuseMap=t.diffuseMap2),null==this.normalMap&&(this.normalMap=t.normalMap),null==this.parallaxMap&&(this.parallaxMap=t.parallaxMap),null==this.aoMap&&(this.aoMap=t.aoMap),null==this.specularMap&&(this.specularMap=t.specularMap),this.specularMode=t.specularMode,this.EJ=t.EJ.slice();let e=2;null!=this.parallaxMap&&(this.EG=this.EJ.subarray(4*e,4*(e+1)),e+=1),this.lightEnabled&&(this.EI=this.EJ.subarray(4*e)),this.EL=t.EL,this.EH=t.EH,this.EK=t.EK,this.t_=t.t_}buildTextureList(){let t=l.G0;t.setIRenderTextureList([]),t.addDiffuseMap(this.diffuseMap),t.addDiffuseMap2(this.diffuseMap2),t.addNormalMap(this.normalMap),t.addParallaxMap(this.parallaxMap,this.EH),t.addAOMap(this.aoMap),t.addSpecularMap(this.specularMap);let e=t.getIRenderTextureList();return null!=this.vertUniform&&this.vertUniform.getTextures(t.getShaderCodeBuilder(),e),t.getTexturesFromPipeline(e),e}initializeLocalData(){if(null!=this.vertUniform&&this.vertUniform.initialize(),null==this.EJ){this.EK=2,null!=this.parallaxMap&&(this.EK+=1),this.lightEnabled&&(this.EK+=3),this.EJ=new Float32Array(4*this.EK),this.EJ.set([1,1,1,1,0,0,0,0]);let t=2;null!=this.parallaxMap&&(this.EG=this.EJ.subarray(4*t,4*(t+1)),this.EG.set([1,10,2,.1]),this.EH=t,t+=1),this.lightEnabled&&(this.EL=t,this.EI=this.EJ.subarray(4*t),this.EI.set([.5,.5,.5,32,.7,.3,.3,.7,.01,.01,.01,0]))}}buildBuf(){null==this.EJ&&this.initializeLocalData();let t=l.G0;t.lightEnabled=this.lightEnabled,t.shadowReceiveEnabled=this.shadowReceiveEnabled,t.fogEnabled=this.fogEnabled,t.envAmbientLightEnabled=this.envAmbientLightEnabled,t.buildPipelineParams(),t.colorEnabled=this.colorEnabled,t.vertColorEnabled=this.vertColorEnabled,t.lightParamsIndex=this.EL,t.normalEnabled=this.normalEnabled,t.vertUniform=this.vertUniform,t.diffuseMap2Matrix=null!=this.diffuseMap2Matrix,t.fragLocalParamsTotal=this.EK,t.buildFlag=""==this.t_;let e=this.buildTextureList();super.setTextureList(e),t.buildFlag=!1}getCodeBuf(){return l.G0}setSpecularColor(t){null!=this.EI&&(this.EI[0]=t.r,this.EI[1]=t.g,this.EI[2]=t.b)}setSpecularIntensity(t){null!=this.EI&&(this.EI[3]=t)}setLightBlendFactor(t,e){null!=this.EI&&(this.EI[4]=t,this.EI[5]=e)}setBlendFactor(t,e){null!=this.EI&&(this.EI[6]=t,this.EI[7]=e)}setAmbientFactor(t,e,s){null!=this.EI&&(this.EI[8]=t,this.EI[9]=e,this.EI[10]=s)}setParallaxParams(t=1,e=10,s=2,i=.1){null!=this.EG&&(this.EG[0]=t,this.EG[1]=e,this.EG[2]=s,this.EG[3]=i)}setRGB3f(t,e,s){this.EJ[0]=t,this.EJ[1]=e,this.EJ[2]=s}setColor(t,e=null){null!=t&&(this.EJ[0]=t.r,this.EJ[1]=t.g,this.EJ[2]=t.b,this.EJ[3]=t.a),null!=e&&(this.EJ[4]=e.r,this.EJ[5]=e.g,this.EJ[6]=e.b,this.EJ[7]=e.a)}setColorAlpha(t){this.EJ[3]=t}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_fragLocalParams"],t.dataList=[this.EJ],null!=this.vertUniform&&this.vertUniform.buildShaderUniformData(t),null!=this.diffuseMap2Matrix&&(t.uniformNameList.push("u_map2ViewMat"),t.dataList.push(this.diffuseMap2Matrix.getLocalFS32())),t}destroy(){super.destroy(),this.EJ=null,this.vertUniform=null,this.diffuseMap2Matrix=null,this.diffuseMap=null,this.diffuseMap2=null,this.normalMap=null,this.parallaxMap=null,this.aoMap=null,this.specularMap=null}}l.G0=null,e.default=l,e.LambertLightMaterial=l},b498:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("18c7")),r=i(s("ab73")),n=i(s("7279")),h=i(s("3077")),l=s("5216"),o=s("c70f"),_=s("d846"),m=s("a9f4");class u{constructor(t=0){this.C_f=new o.GlobalVSMShadowUniformParam,this.C_g=null,this.C_h=null,this.A_z=null,this.A_w=null,this.A_y=null,this.EM=null,this.BE=-1,this.C_i=!1,this.C_j=0,this.C_j=t}setShadowMap(t){this.EM=t}resetPipe(){}getTextures(t,e,s){return null!=this.EM?(null==e&&(e=[]),e.push(this.EM),t.uniform.addShadowMap(m.ShadowMode.VSM),e):null}useShaderPipe(t,e){null!=this.C_g&&(t.addDefine("VOX_USE_SHADOW","1"),t.addVarying("vec4","v_shadowPos"),this.C_f.use(t),t.addShaderObject(_.VSMShaderCode))}getPipeTypes(){return[l.MaterialPipeType.VSM_SHADOW]}getPipeKey(t){switch(t){case l.MaterialPipeType.VSM_SHADOW:return"["+t+"]";default:break}return""}initialize(){null==this.C_g&&(this.A_z=new a.default,this.A_y=new a.default,this.A_y.identity(),this.A_y.setScaleXYZ(.5,.5,.5),this.A_y.setTranslationXYZ(.5,.5,.5),this.A_w=new Float32Array([-5e-4,0,4,.8,512,512,.1,0,1,1,1,0]),this.C_g=new h.default,this.C_g.bindSlotAt(this.C_j),this.C_g.addMat4Data(this.A_z.getLocalFS32(),1),this.C_g.addVec4Data(this.A_w,r.default.ShadowVSMParams.arrayLength),this.C_h=this.C_f.createGlobalUinform(this.C_g),this.C_g.update())}getGlobalUinform(){return this.C_h.clone()}getGlobalUinformAt(t){let e=new n.default;return e.copyDataFromProbeAt(t,this.C_g),e}updateShadowCamera(t){this.BE!=t.version&&(this.BE=t.version,this.A_z.copyFrom(t.getVPMatrix()),this.A_z.append(this.A_y),this.setDirec(t.getNV()),this.C_i=!0)}setShadowParam(t,e,s){this.A_w[0]=t,this.A_w[1]=e,this.A_w[2]=s,this.C_i=!0}setShadowIntensity(t){this.A_w[3]=t,this.C_i=!0}setColorIntensity(t){this.A_w[6]=t,this.C_i=!0}setShadowRadius(t){this.A_w[2]=t,this.C_i=!0}setShadowBias(t){this.A_w[0]=t,this.C_i=!0}setShadowSize(t,e){this.A_w[4]=t,this.A_w[5]=e,this.C_i=!0}setDirec(t){this.A_w[8]=-t.x,this.A_w[9]=-t.y,this.A_w[10]=-t.z,this.C_i=!0}update(){this.C_i&&null!=this.C_g&&(this.C_i=!1,this.C_g.update())}destroy(){this.EM=null}}e.default=u},b4ea:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17")),r=s("0714"),n=s("e753"),h=i(s("77cf")),l=i(s("e439")),o=i(s("6e01")),_=i(s("f63b")),m=s("8d98"),u=s("f3a2");e.ShaderCodeUUID=u.ShaderCodeUUID;const d=s("c052");e.ShaderCodeConfigure=d.ShaderCodeConfigure,e.ShaderCodeType=d.ShaderCodeType,e.IShaderLibConfigure=d.IShaderLibConfigure,e.IShaderLibListener=d.IShaderLibListener;class c{constructor(){this.pointLightsTotal=1,this.directionLightsTotal=1,this.spotLightsTotal=0,this.vsmFboIndex=0,this.vsmEnabled=!0,this.loadAllShaderCode=!1,this.shaderCodeBinary=!1,this.shaderLibVersion="",this.shaderFileRename=!1,this.lambertMaterialEnabled=!0,this.pbrMaterialEnabled=!0,this.buildBinaryFile=!1}}e.MaterialContextParam=c;class f{constructor(){this.DX=!0,this.EN=null,this.Al=null,this.lightModule=new n.LightModule,this.envData=new h.default,this.vsmModule=null,this.pipeline=null}addShaderLibListener(t){null!=f.ShaderLib&&f.ShaderLib.setListener(t)}getTextureLoader(){return this.EN}isTextureLoadedAll(){return this.EN.isLoadedAll()}getTextureByUrl(t,e=!0,s=!0){let i=null,a=t.slice(t.lastIndexOf(".")+1);switch(a=a.toLocaleLowerCase(),a){case"jpeg":case"jpg":case"png":case"gif":i=this.EN.getImageTexByUrl(t),i.mipmapEnabled=s,e&&i.setWrap(m.TextureConst.WRAP_REPEAT);break;default:break}return i}createShaderLibConfig(){return{shaderCodeConfigures:[],version:""}}initialize(t,e=null,s=null){if(this.DX){this.DX=!1,this.Al=t,this.EN=new _.default(this.Al.textureBlock);let i=this;null==e&&(e=new c),this.D0=e,""!=e.shaderLibVersion&&(s.version=e.shaderLibVersion),f.ShaderLib.initialize(s,e.shaderCodeBinary),e.loadAllShaderCode&&f.ShaderLib.addAllShaderCodeObject(),e.pointLightsTotal=o.default.Clamp(e.pointLightsTotal,0,256),e.directionLightsTotal=o.default.Clamp(e.directionLightsTotal,0,256),e.spotLightsTotal=o.default.Clamp(e.spotLightsTotal,0,256);for(let t=0;t<e.pointLightsTotal;++t)this.lightModule.appendPointLight();for(let t=0;t<e.directionLightsTotal;++t)this.lightModule.appendDirectionLight();for(let t=0;t<e.spotLightsTotal;++t)this.lightModule.appendSpotLight();if(this.lightModule.update(),i.envData=new h.default,this.envData.initialize(),this.envData.setFogColorRGB3f(0,.8,.1),e.vsmEnabled&&(i.vsmModule=new l.default(e.vsmFboIndex),this.vsmModule.setCameraPosition(new a.default(1,800,1)),this.vsmModule.setCameraNear(10),this.vsmModule.setCameraFar(3e3),this.vsmModule.setMapSize(512,512),this.vsmModule.setCameraViewSize(4e3,4e3),this.vsmModule.setShadowRadius(2),this.vsmModule.setShadowBias(-5e-4),this.vsmModule.initialize(t,[0],3e3),this.vsmModule.setShadowIntensity(.8),this.vsmModule.setColorIntensity(.3)),i.pipeline=this.createPipeline(),this.initEnd(e),!e.loadAllShaderCode){let t=f.ShaderLib.getListener();null!=t&&t.shaderLibLoadComplete(0,0)}}}initEnd(t){}addShaderCodeObject(t,e){f.ShaderLib.addShaderCodeObject(t,e)}addPipeline(t){null!=t&&t!=this.pipeline&&(t.addPipe(this.lightModule),t.addPipe(this.envData),null!=this.vsmModule&&t.addPipe(this.vsmModule.getVSMData()))}createPipeline(){let t=new r.MaterialPipeline(f.ShaderLib);return t.addPipe(this.lightModule),t.addPipe(this.envData),null!=this.vsmModule&&t.addPipe(this.vsmModule.getVSMData()),t}run(){null!=this.vsmModule&&this.D0.vsmEnabled&&this.vsmModule.run()}destroy(){this.Al=null}}f.ShaderLib=new d.ShaderLib,e.MaterialContext=f},b88e:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("1f43");document.title="Vox APP";let a=new i.DemoMultiLambertLights,r=a;if(void 0!=r.runBegin){function n(){function t(e){r.runBegin(),r.run(),r.runEnd(),window.requestAnimationFrame(t)}r.initialize(),window.requestAnimationFrame(t)}n()}else{function h(){function t(e){a.run(),window.requestAnimationFrame(t)}a.initialize(),window.requestAnimationFrame(t)}h()}},b8ff:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("402a")),r=i(s("f63e")),n=i(s("f152")),h=i(s("29ef"));class l extends a.default{constructor(t=null){super(t),this.normalEnabled=!1,this.doubleTriFaceEnabled=!1,this.wireframe=!1,this.inverseUV=!1,this.uvScale=1,this.vtxColor=null,this.EO=50,this.EP=10,this.EQ=10}showBackFace(){this.setRenderState(h.default.NORMAL_STATE)}showFrontFace(){this.setRenderState(h.default.FRONT_CULLFACE_NORMAL_STATE)}showDoubleFace(t=!1,e=!0){t?e?this.setRenderState(h.default.NONE_CULLFACE_NORMAL_ALWAYS_STATE):this.setRenderState(h.default.BACK_NORMAL_ALWAYS_STATE):e?this.setRenderState(h.default.NONE_CULLFACE_NORMAL_STATE):this.setRenderState(h.default.NORMAL_STATE)}toTransparentBlend(t=!1,e=!1){t?e?this.setRenderState(h.default.NONE_TRANSPARENT_ALWAYS_STATE):this.setRenderState(h.default.BACK_TRANSPARENT_ALWAYS_STATE):e?this.setRenderState(h.default.NONE_TRANSPARENT_STATE):this.setRenderState(h.default.BACK_TRANSPARENT_STATE)}toBrightnessBlend(t=!1,e=!1){t?e?this.setRenderState(h.default.NONE_ADD_ALWAYS_STATE):this.setRenderState(h.default.BACK_ADD_ALWAYS_STATE):e?this.setRenderState(h.default.NONE_ADD_BLENDSORT_STATE):this.setRenderState(h.default.BACK_ADD_BLENDSORT_STATE)}createMaterial(t){if(null==this.getMaterial()){let e=new r.default;e.vertColorEnabled=null!=this.vtxColor,e.normalEnabled=this.normalEnabled,e.setTextureList(t),this.setMaterial(e)}else null!=t&&this.getMaterial().getTextureTotal()<1&&this.getMaterial().setTextureList(t)}initializeFrom(t,e=null){this.copyMeshFrom(t),this.copyMaterialFrom(t),this.createMaterial(e),this.activeDisplay()}initialize(t,e,s,i=null){this.EO=t,this.EP=e,this.EQ=s,this.createMaterial(i),this.activeDisplay()}__activeMesh(t){if(null==this.getMesh()){let e=new n.default;e.wireframe=this.wireframe,e.inverseUV=this.inverseUV,e.uvScale=this.uvScale,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.EO,this.EP,this.EQ,this.doubleTriFaceEnabled),this.setMesh(e)}}toString(){return"[Sphere3DEntity(uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")]"}}e.default=l},b9b5:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("9c3c")),r=i(s("402a")),n=i(s("3930")),h=i(s("32cc")),l=i(s("8e17"));class o extends r.default{constructor(){super(),this.rayTestRadius=8,this.colorX=new n.default(1,0,0,1),this.colorY=new n.default(0,1,0,1),this.colorZ=new n.default(0,0,1,1),this.ER=[0,0,0,100,0,0,0,0,0,0,100,0,0,0,0,0,0,100]}setLineWidth(t){}createMaterial(){if(null==this.getMaterial()){let t=new h.default;this.setMaterial(t)}}__activeMesh(t){if(null==this.getMesh()){let e=[this.colorX.r,this.colorX.g,this.colorX.b,this.colorX.r,this.colorX.g,this.colorX.b,this.colorY.r,this.colorY.g,this.colorY.b,this.colorY.r,this.colorY.g,this.colorY.b,this.colorZ.r,this.colorZ.g,this.colorZ.b,this.colorZ.r,this.colorZ.g,this.colorZ.b],s=new a.default;s.rayTestRadius=this.rayTestRadius,s.vbWholeDataEnabled=!1,s.setBufSortFormat(t.getBufSortFormat()),s.initialize(this.ER,e),this.setMesh(s)}}initialize(t=100){t<2&&(t=2),this.ER[3]=t,this.ER[10]=t,this.ER[17]=t,this.createMaterial(),this.activeDisplay()}initializeSizeXYZ(t,e,s){this.ER[3]=t,this.ER[10]=e,this.ER[17]=s,this.createMaterial(),this.activeDisplay()}initializeCorssSizeXYZ(t,e,s){t*=.5,e*=.5,s*=.5,this.ER[0]=-t,this.ER[7]=-e,this.ER[14]=-s,this.ER[3]=t,this.ER[10]=e,this.ER[17]=s,this.createMaterial(),this.activeDisplay()}initializeCross(t=100,e=null){t<2&&(t=2),t*=.5,null==e&&(e=new l.default),this.ER[0]=-t+e.x,this.ER[7]=-t+e.y,this.ER[14]=-t+e.z,this.ER[3]=t+e.x,this.ER[10]=t+e.y,this.ER[17]=t+e.z,this.createMaterial(),this.activeDisplay()}toString(){return"Axis3DEntity(name="+this.name+",uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=o},ba5e:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("faa5")),r=i(s("b3bd")),n=i(s("0fc4"));class h extends a.default{constructor(){super(),this.Ak="",this.Dz=!1}initialize(t){this.Ak="ScreenFixedPlaneShd",this.Dz=t,t&&(this.Ak+="_tex")}getFragShaderCode(){let t="precision mediump float;\n";return this.Dz&&(t+="uniform sampler2D u_sampler0;\nvarying vec2 v_texUV;\n"),t+="uniform vec4 u_color;\nvoid main()\n{\n",this.Dz?t+="gl_FragColor = texture2D(u_sampler0, v_texUV) * u_color;\n":t+="gl_FragColor = u_color;\n",t+="}\n",t}getVertShaderCode(){let t="precision mediump float;\nattribute vec3 a_vs;\n";return this.Dz&&(t+="uniform vec4 u_param;\nattribute vec2 a_uvs;\nvarying vec2 v_texUV;\n"),t+="void main()\n{\ngl_Position = vec4(a_vs,1.0);\n",this.Dz&&(t+="v_texUV.xy = u_param.zw + (a_uvs.xy * u_param.xy);\n"),t+="}\n",t}getUniqueShaderName(){return this.Ak}toString(){return"[ScreenFixedPlaneShaderBuffer()]"}static GetInstance(){return null!=h.F_0||(h.F_0=new h),h.F_0}}h.F_0=null;class l extends n.default{constructor(){super(),this.BJ=new Float32Array([1,1,1,1]),this.D0=new Float32Array([1,1,0,0])}getCodeBuf(){return h.GetInstance()}setUVScale(t,e){this.D0[0]=t,this.D0[1]=t}setUVTranslation(t,e){this.D0[2]=t,this.D0[3]=e}setRGB3f(t,e,s){this.BJ[0]=t,this.BJ[1]=e,this.BJ[2]=s}setRGBA4f(t,e,s,i){this.BJ[0]=t,this.BJ[1]=e,this.BJ[2]=s,this.BJ[3]=i}createSelfUniformData(){let t=new r.default;return t.uniformNameList=["u_color","u_param"],t.dataList=[this.BJ,this.D0],t}}e.default=l},baae:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.FRAMEBUFFER=71,i.DRAW_FRAMEBUFFER=72,i.READ_FRAMEBUFFER=73,e.default=i},badb:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("1710")),r=i(s("ee5a"));class n{constructor(){this.ES=null,this.ET=18,this.uuid="",this.data=null,this.ET=a.default.GetMouseEvtTypeValuesTotal(),this.ES=new Array(this.ET)}getClassType(){return a.default.EventClassType}destroy(){for(let t=0;t<this.ET;++t)null!=this.ES[t]&&this.ES[t].destroy()}dispatchEvt(t){if(null!=t){""!=this.uuid&&(t.uuid=this.uuid),null!=this.data&&(t.data=this.data);let e=t.type-a.default.GetMouseEvtTypeValueBase();if(e>=0&&e<a.default.GetMouseEvtTypeValuesTotal()&&null!=this.ES[e])return this.ES[e].dispatch(t)}return 0}passTestEvt(t){if(null!=t){let e=t.type-a.default.GetMouseEvtTypeValueBase();if(e>=0&&e<a.default.GetMouseEvtTypeValuesTotal())return this.ES[e].passTestEvt(t)}return 0}passTestPhase(t){let e=a.default.GetMouseEvtTypeValuesTotal();for(let s=0;s<e;++s)if(null!=this.ES[s]&&1==this.ES[s].passTestPhase(t))return 1;return 0}addEventListener(t,e,s,i=!0,n=!1){if(null!=s&&null!=e){let h=t-a.default.GetMouseEvtTypeValueBase();if(h>=0&&h<a.default.GetMouseEvtTypeValuesTotal()){let t=0;i!=n&&(t=i?1:2),null!=this.ES[h]||(this.ES[h]=new r.default),this.ES[h].addListener(e,s,t)}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=t-a.default.GetMouseEvtTypeValueBase();i>=0&&i<a.default.GetMouseEvtTypeValuesTotal()&&null!=this.ES[i]&&this.ES[i].removeListener(e,s)}}}e.default=n},bbd2:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("29ef")),r=i(s("402a")),n=i(s("6098")),h=i(s("9266"));class l extends r.default{constructor(t=null){super(t),this.A_T=!0,this.A_U=!1,this.flipVerticalUV=!1,this.EU=0,this.EV=0,this.EW=null,this.EX=null,this.setRenderState(a.default.BACK_ADD_BLENDSORT_STATE)}setRGB3f(t,e,s){null!=this.EW&&this.EW.setRGB3f(t,e,s)}setRGBOffset3f(t,e,s){null!=this.EW&&this.EW.setRGBOffset3f(t,e,s)}setFadeFactor(t){null!=this.EW&&this.EW.setFadeFactor(t)}getFadeFactor(){return this.EW.getFadeFactor()}getRotationZ(){return this.EW.getRotationZ()}setRotationZ(t){this.EW.setRotationZ(t)}getScaleX(){return this.EW.getScaleX()}getScaleY(){return this.EW.getScaleY()}setScaleX(t){this.EW.setScaleX(t)}setScaleY(t){this.EW.setScaleY(t)}setScaleXY(t,e){this.EW.setScaleXY(t,e)}createMaterial(t){null==this.getMaterial()?(this.EW=new n.default(this.A_T,this.A_U),this.EW.setTextureList(t),this.setMaterial(this.EW)):(this.EW=this.getMaterial(),this.EW.setTextureList(t))}toTransparentBlend(t=!1){this.A_T=!1,this.A_U=!0,t?this.setRenderState(a.default.BACK_TRANSPARENT_STATE):this.setRenderState(a.default.BACK_TRANSPARENT_ALWAYS_STATE)}toBrightnessBlend(t=!1){this.A_T=!0,this.A_U=!1,this.setRenderState(a.default.BACK_ADD_BLENDSORT_STATE)}initializeSquare(t,e){this.EU=t,this.EV=t,this.createMaterial(e),this.activeDisplay()}initialize(t,e,s){this.EU=t,this.EV=e,this.createMaterial(s),this.activeDisplay()}createBounds(){}__activeMesh(t){if(null==this.getMesh()){let e=new h.default;e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.flipVerticalUV=this.flipVerticalUV,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.EU,this.EV),this.setMesh(e),this.EX=e}}setUV(t,e,s,i){null!=this.EX&&this.EX.setUV(t,e,s,i)}update(){this.Bg.update()}destroy(){this.EW=null,this.EX=null,super.destroy()}toString(){return"Billboard3DEntity(uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=l},bbf4:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.CAMERA_VISIBLE_ENABLE=0,i.CAMERA_VISIBLE_DISABLE=1,e.default=i},bcac:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17"));class r{constructor(){this.A_h=null,this.A_i=null,this.c_=0,this.d_=0,this.A_j=!1,this.EY=0,this.EZ=100,this.autoRotationEnabled=!1,this.autoRotationSpeed=.2,this.rotationAttenuationEnabled=!1,this.rotationSpeed=.2}initialize(t,e){null==this.A_h&&(this.A_h=t,this.A_i=e)}attach(){this.c_=this.A_h.mouseX,this.d_=this.A_h.mouseY,this.A_j=!0,this.EZ=100}detach(){this.A_j=!1}runWithYAxis(){if(this.A_j){let t=this.c_-this.A_h.mouseX,e=this.d_-this.A_h.mouseY,s=Math.abs(t),i=Math.abs(e);s>i?(this.EY=t*this.rotationSpeed,s>.5&&this.A_i.swingHorizontalWithAxis(this.EY,a.default.Y_AXIS)):(this.EY=0,i>.5&&this.A_i.swingVertical(-e*this.rotationSpeed)),this.c_=this.A_h.mouseX,this.d_=this.A_h.mouseY}else this.autoRotationEnabled&&(this.EZ<0?this.A_i.swingHorizontalWithAxis(this.autoRotationSpeed,a.default.Y_AXIS):this.EZ--)}runWithZAxis(){if(this.A_j){let t=this.c_-this.A_h.mouseX,e=this.d_-this.A_h.mouseY,s=Math.abs(t),i=Math.abs(e);s>i?s>.5&&this.A_i.swingHorizontalWithAxis(.2*t,a.default.Z_AXIS):i>.5&&this.A_i.swingVertical(-.2*e),this.c_=this.A_h.mouseX,this.d_=this.A_h.mouseY}else this.autoRotationEnabled&&(this.EZ<0?this.A_i.swingHorizontalWithAxis(this.autoRotationSpeed,a.default.Z_AXIS):this.EZ--)}}e.CameraDragSwinger=r},bd6f:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("29ef")),r=i(s("402a")),n=i(s("f63e")),h=i(s("a254")),l=i(s("76b0")),o=i(s("3930"));class _ extends r.default{constructor(t=null){super(t),this.Ea=0,this.Eb=0,this.Ec=0,this.Ed=0,this.A1=0,this.Ee=!1,this.color0=new o.default,this.color1=new o.default,this.color2=new o.default,this.color3=new o.default,this.C_c=!0,this.offsetU=0,this.offsetV=0,this.uScale=1,this.vScale=1,this.normalEnabled=!1,this.wireframe=!1,this.uvs=null,this.flipVerticalUV=!1,this.vertColorEnabled=!1,this.premultiplyAlpha=!1}setPolyhedral(t){this.C_c=t;let e=this.getMesh();null!=e&&e.setPolyhedral(t)}setScreenAlignEnable(t){this.Ee=t}createMaterial(t){if(null==this.getMaterial())if(this.Ee){let e=new h.default;e.setTextureList(t),this.setMaterial(e)}else{let e=new n.default;e.normalEnabled=this.normalEnabled,e.vertColorEnabled=this.vertColorEnabled,e.premultiplyAlpha=this.premultiplyAlpha,e.setTextureList(t),this.setMaterial(e)}else null!=t&&this.getMaterial().getTextureTotal()<1&&this.getMaterial().setTextureList(t)}showDoubleFace(t=!1,e=!0){t?e?this.setRenderState(a.default.NONE_CULLFACE_NORMAL_ALWAYS_STATE):this.setRenderState(a.default.BACK_NORMAL_ALWAYS_STATE):e?this.setRenderState(a.default.NONE_CULLFACE_NORMAL_STATE):this.setRenderState(a.default.NORMAL_STATE)}toTransparentBlend(t=!1,e=!1){t?e?this.setRenderState(a.default.NONE_TRANSPARENT_ALWAYS_STATE):this.setRenderState(a.default.BACK_TRANSPARENT_ALWAYS_STATE):e?this.setRenderState(a.default.NONE_TRANSPARENT_STATE):this.setRenderState(a.default.BACK_TRANSPARENT_STATE)}toBrightnessBlend(t=!1,e=!1){t?e?this.setRenderState(a.default.NONE_ADD_ALWAYS_STATE):this.setRenderState(a.default.BACK_ADD_ALWAYS_STATE):e?this.setRenderState(a.default.NONE_ADD_BLENDSORT_STATE):this.setRenderState(a.default.BACK_ADD_BLENDSORT_STATE)}initializeFixScreen(t=null){this.initializeXOY(-1,-1,2,2,t)}initializeXOY(t,e,s,i,a=null){this.Ea=t,this.Eb=e,this.Ec=s,this.Ed=i,this.A1=0,this.createMaterial(a),this.activeDisplay()}initializeXOYSquare(t,e=null){this.Ea=-.5*t,this.Eb=-.5*t,this.Ec=t,this.Ed=t,this.A1=0,this.createMaterial(e),this.activeDisplay()}initializeXOZ(t,e,s,i,a=null){this.A1=1,this.Ea=t,this.Eb=e,this.Ec=s,this.Ed=i,this.createMaterial(a),this.activeDisplay()}initializeYOZ(t,e,s,i,a=null){this.A1=2,this.Ea=t,this.Eb=e,this.Ec=s,this.Ed=i,this.createMaterial(a),this.activeDisplay()}initializeXOZSquare(t,e=null){this.A1=1,this.Ea=-.5*t,this.Eb=-.5*t,this.Ec=t,this.Ed=t,this.createMaterial(e),this.activeDisplay()}__activeMesh(t){if(null==this.getMesh()){let e=new l.default;e.color0.copyFrom(this.color0),e.color1.copyFrom(this.color1),e.color2.copyFrom(this.color2),e.color3.copyFrom(this.color3),e.setPolyhedral(this.C_c),e.setUVS(this.uvs),this.uvs=null,e.uScale=this.uScale,e.vScale=this.vScale,e.offsetU=this.offsetU,e.offsetV=this.offsetV,e.wireframe=this.wireframe,e.flipVerticalUV=this.flipVerticalUV,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.axisFlag=this.A1,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.Ea,this.Eb,this.Ec,this.Ed),this.setMesh(e)}}setUVS(t){let e=this.getMesh();null!=e&&e.setUVS(t)}reinitializeMesh(){let t=this.getMesh();null!=t&&t.reinitialize()}toString(){return"[Plane3DEntity]"}}e.default=_},bf2a:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17"));class r{constructor(){this.center=new a.default,this.position=new a.default}run(){}}e.PointLightEntity=r;class n extends r{constructor(){super(),this.A7=0}run(){this.position.y=this.center.y+220*Math.cos(this.A7),this.A7+=.01,null!=this.displayEntity&&(this.displayEntity.setPosition(this.position),this.displayEntity.update()),null!=this.light&&this.light.position.copyFrom(this.position)}}e.FloatYPointLightEntity=n;class h extends r{constructor(t){super(),this.Ef=0,this.radius=200,this.rotationSpd=.05,this.Ef=t}run(){this.Ef+=this.rotationSpd,this.position.y=0,this.position.x=this.radius*Math.cos(this.Ef),this.position.z=this.radius*Math.sin(this.Ef),this.position.addBy(this.center),null!=this.displayEntity&&(this.displayEntity.setPosition(this.position),this.displayEntity.update()),null!=this.light&&this.light.position.copyFrom(this.position)}}e.RotateYPointLightEntity=h},c052:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("f3a2"),a=s("cc55"),r=s("69ed");e.ShaderCodeType=r.ShaderCodeType;const n=s("28a9");e.ShaderCodeConfigure=n.ShaderCodeConfigure;const h=s("a221");e.IShaderLibConfigure=h.IShaderLibConfigure;const l=s("ca2f");class o{constructor(){this.A_9=new Map,this.Eg=[]}addConfigureWithUUID(t,e){""==t||this.A_9.has(t)||(this.A_9.set(t,e),this.Eg.push(t))}getConfigureWithUUID(t){return this.A_9.get(t)}getUUIDList(){return this.Eg}getUUIDListLength(){return this.Eg.length}}class _{constructor(t){this.Eh=0,this.Ei=new a.ShaderCodeObject,this.Ej=null,this.version="",this.Ej=t}decodeUint8Arr(t){return new TextDecoder("utf-8").decode(t)}encodeUint8Arr(t){return(new TextEncoder).encode(t)}loadedShdCode(t,e,s){if(this.Eh++,this.Ej.buildBinaryFile&&!this.Ej.binary){let s=this.encodeUint8Arr(t);for(let t=0;t<s.length;++t)s[t]=222-s[t];_.G1.downloadBinFile(s,e+"","bin")}switch(e){case r.ShaderCodeType.VertHead:this.Ei.vert_head=t;break;case r.ShaderCodeType.VertBody:this.Ei.vert_body=t;break;case r.ShaderCodeType.FragHead:this.Ei.frag_head=t;break;case r.ShaderCodeType.FragBody:this.Ei.frag_body=t;break;default:break}this.Eh==this.Ej.types.length&&(s(this.Ej.uuid,this.Ei),this.Ei=null,this.Ej=null)}async loadBinCode(t,e,s){const i=new FileReader;i.onload=t=>{let a=new Uint8Array(i.result);for(let e=0;e<a.length;++e)a[e]=222-a[e];this.loadedShdCode(this.decodeUint8Arr(a),e,s)};const a=new XMLHttpRequest;a.open("GET",t,!0),a.responseType="blob",a.onload=t=>{a.status<=206&&i.readAsArrayBuffer(a.response)},a.onerror=t=>{},a.send()}loadTextCode(t,e,s){let i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=()=>{i.status<=206&&this.loadedShdCode(i.responseText,e,s)},i.onerror=t=>{},i.send()}loadCode(t,e,s){this.Ej.binary?this.loadBinCode(t,e,s):this.loadTextCode(t,e,s)}load(t){if(this.Eh=0,null==this.Ej.urls){let e=""!=this.version?this.version+"/":"",s=this.Ej.binary?".bin":".glsl";for(let i=0;i<this.Ej.types.length;++i){let a="static/shader/"+e+"glsl/"+this.Ej.uuid+"/"+this.Ej.types[i]+s;this.loadCode(a,this.Ej.types[i],t)}}else for(let e=0;e<this.Ej.urls.length;++e){let s=this.Ej.urls[e];this.loadCode(s,this.Ej.types[e],t)}}}_.G1=new l.FileIO;class m{constructor(){this.Eh=0,this.Ek=0,this.El=new Map,this.Em=new Map,this.En=null,this.Eo=null,this.C_b=""}setListener(t){this.Eo=t}getListener(){return this.Eo}initialize(t=null,e=!1){if(null==this.En){let s;this.En=new o;let a=null;if(null!=t&&(a=t.shaderCodeConfigures,this.C_b=t.version),null!=a)for(let t=0;t<a.length;++t)s=a[t],null!=s&&this.En.addConfigureWithUUID(s.uuid,s);else s=new n.ShaderCodeConfigure,s.uuid=i.ShaderCodeUUID.PBR,s.types=[r.ShaderCodeType.VertHead,r.ShaderCodeType.VertBody,r.ShaderCodeType.FragHead,r.ShaderCodeType.FragBody],s.binary=e,this.En.addConfigureWithUUID(s.uuid,s)}}addAllShaderCodeObject(){if(this.En.getUUIDListLength()>0){let t=this.En.getUUIDList();for(let e=0;e<t.length;++e)this.addShaderCodeObjectWithUUID(t[e])}else null!=this.Eo&&this.Eo.shaderLibLoadComplete(0,0)}addShaderCodeObjectWithUUID(t){if(!this.Em.has(t)&&!this.El.has(t)){this.Eh++;let e=new _(this.En.getConfigureWithUUID(t));e.version=this.C_b,e.load((t,e)=>{this.Em.set(t,e),this.Ek++,null!=this.Eo&&this.Eo.shaderLibLoadComplete(this.Eh,this.Ek)})}}addShaderCodeObject(t,e){null==e||e.uuid!=""+t||this.Em.has(t)||this.Em.set(t,e)}getShaderCodeObjectWithUUID(t){let e=null;return this.Em.has(t)&&(e=this.Em.get(t)),e}}e.ShaderLib=m},c120:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17"));class r{constructor(){this.entity=null,this.lpv=new a.default,this.wpv=new a.default,this.dis=0,this.flag=0}}e.default=r},c164:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}}i.BasePredefined="\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n",e.MathShaderCode=i;class a{constructor(){}}a.BasePredefined="\nvec4 localPosition = vec4(0.0,0.0,0.0,1.0);\nvec4 worldPosition = vec4(0.0,0.0,0.0,1.0);\n// view space position\nvec4 viewPosition = vec4(0.0,0.0,0.0,1.0);\nvec3 worldNormal = vec3(0.0, 0.0, 1.0);\n",a.FragPredefined="\n",a.FragDefined="\n",a.VertPredefined="\n// origin world position\nvec4 oWorldPosition = vec4(0.0,0.0,0.0,1.0);\n",a.VertDefined="\n",e.ShaderCode=a},c217:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.Ep=0}getBrnAlphaStatus(){return this.Ep}setBrightnessAndAlpha(t,e){this.Ep=10*Number(t)+Number(e)}getBrnAndAlphaCode(){let t;return t=11==this.Ep?"\ncolor.rgb = color.rgb * v_colorMult.xyz + color.aaa * offsetColor;\ncolor *= FADE_VAR.zzzz;\n":10==this.Ep?"\ncolor.rgb = min(color.rgb * v_colorMult.xyz + color.rgb * offsetColor, vec3(1.0));\ncolor.rgb *= FADE_VAR.zzz;\n":1==this.Ep?"\ncolor.rgb = color.rgb * v_colorMult.xyz + color.aaa * offsetColor;\ncolor.a *= FADE_VAR.z;\n":"\ncolor.rgb = color.rgb * v_colorMult.xyz + offsetColor;\ncolor.a *= FADE_VAR.z;\n",t}getMixThreeColorsCode(){let t="\nvec4 mixThreeColors(vec4 color0,vec4 color1,vec4 color2,float t)\n{\n    float k0 = max(1.0 - 2.0 * t, 0.0);\n    float k = max(t - 0.5, 0.0);\n    float k1 = (1.0 - (2.0 * k)) * step(-0.00001,k);\n    k = step(0.00001,k0);\n    return mix(mix(color2,color1,k1), mix(color1,color0,k0), k);\n}\n";return t}getOffsetColorCode(t,e=!1){let s;return s=t?e?"\nvec3 offsetColor = clamp(v_colorOffset.xyz + texture(VOX_OFFSET_COLOR_MAP, v_uv.xy).xyz,vec3(0.0),vec3(1.0));\n":"\nvec3 offsetColor = clamp(v_colorOffset.xyz + texture(VOX_OFFSET_COLOR_MAP, v_texUV.xy).xyz,vec3(0.0),vec3(1.0));\n":"\nvec3 offsetColor = v_colorOffset.xyz;\n",s}}e.default=i},c497:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17"));class r{constructor(t=null){this.Eq=8192,this.Er=null,this.Es={depth:!0,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:!1,preserveDrawingBuffer:!0,powerPreference:"high-performance"},this.Et=20,this.Eu=!1,this.Ev=!1,this.autoSyncRenderBufferAndWindowSize=!0,this.maxWebGLVersion=2,this.cameraPerspectiveEnabled=!0,this.evtFlowEnabled=!1,this.camProjParam=new a.default(45,10,5e3),this.camPosition=new a.default(2e3,2e3,2e3),this.camLookAtPos=new a.default(0,0,0),this.camUpDirect=new a.default(0,1,0),this.batchEnabled=!0,this.processFixedState=!1,this.Er=t,this.autoSyncRenderBufferAndWindowSize=null==t}setTickUpdateTime(t){t=Math.round(t),this.Et=t>5?t:5}getTickUpdateTime(){return this.Et}setPolygonOffsetEanbled(t){this.Eu=t}getPolygonOffsetEanbled(){return this.Eu}setDitherEanbled(t){this.Ev=t}getDitherEanbled(){return this.Ev}getDiv(){return this.Er}getRenderContextAttri(){return this.Es}setAttriDepth(t){this.Es.depth=t}setAttriStencil(t){this.Es.stencil=t}setAttriAlpha(t){this.Es.alpha=t}setAttriPremultipliedAlpha(t){this.Es.premultipliedAlpha=t}setAttriAntialias(t){this.Es.antialias=t}setAttripreserveDrawingBuffer(t){this.Es.preserveDrawingBuffer=t}setAttriHightPowerPreference(t){this.Es.powerPreference=t?"high-performance":"default"}setMatrix4AllocateSize(t){t<1024&&(t=1024),this.Eq=t}getMatrix4AllocateSize(){return this.Eq}setCamProject(t,e,s){if(e>=s)throw Error("Error Camera cear > far !!!");this.camProjParam.setTo(t,e,s)}setCamPosition(t,e,s){this.camPosition.setTo(t,e,s)}setCamLookAtPos(t,e,s){this.camLookAtPos.setTo(t,e,s)}setCamUpDirect(t,e,s){this.camUpDirect.setTo(t,e,s)}}e.default=r},c51d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("6e01")),r=i(s("8e17")),n=i(s("18c7")),h=i(s("e214")),l=i(s("fecb"));class o{constructor(){this.version=0,this.matUProbe=null,this.ufrustumProbe=null,this.uniformEnabled=!1,this.name="Camera",this.Ew=new r.default,this.Ex=new r.default,this.Ey=new r.default,this.Ez=new r.default,this.E0=!0,this.E1=new n.default,this.E2=new n.default,this.E3=new n.default,this.E4=new n.default,this.E5=new n.default,this.E6=new n.default,this.A_1=new r.default,this.E7=new r.default,this.E8=new r.default,this.E9=new r.default,this.E_A=new r.default,this.E_B=1,this.E_C=1,this.B=0,this.C=0,this.D=800,this.E=600,this.E_D=400,this.E_E=300,this.E_F=0,this.E_G=1,this.E_H=.1,this.E_I=1e3,this.E_J=0,this.E_K=0,this.E_L=0,this.E_M=0,this.Cs=!1,this.E_N=!1,this.E_O=!0,this.E_P=new r.default(0,0,0),this.E_Q=1,this.E_R=!0,this.E_S=!0,this.E_T=new r.default,this.E_U=new r.default,this.E_V=new r.default,this.E_W=new r.default,this.E_X=new r.default,this.E_Y=0,this.E_Z=new r.default,this.E_a=null,this.E_b=!1,this.E_c=new l.default,this.E_d=null,this.E_e=.5,this.E_f=.5,this.E_g=new r.default,this.E_h=new r.default,this.E_i=new r.default,this.E_j=[new r.default,new r.default,new r.default,new r.default,new r.default,new r.default,new r.default,new r.default,null,null,null],this.E_k=[new h.default,new h.default,new h.default,new h.default,new h.default,new h.default],this.E_l=[new r.default,new r.default,new r.default,new r.default,new r.default,new r.default],this.E_m=[0,0,0,0,0,0],this.E_n=null}lock(){this.E_S=!1}unlock(){this.E_S=!0}lookAtLH(t,e,s){this.E_S&&(this.A_1.copyFrom(t),this.E7.copyFrom(e),this.E8.copyFrom(s),this.E_A.x=this.E7.x-this.A_1.x,this.E_A.y=this.E7.y-this.A_1.y,this.E_A.z=this.E7.z-this.A_1.z,this.E0=!1,this.E9.copyFrom(this.E_A),this.E9.normalize(),this.Ez.copyFrom(s),this.Ez.normalize(),r.default.Cross(this.E_A,this.E8,this.Ey),this.Ey.normalize(),this.E_R=!0)}lookAtRH(t,e,s){this.E_S&&(this.A_1.copyFrom(t),this.E7.copyFrom(e),this.E_A.x=this.E7.x-this.A_1.x,this.E_A.y=this.E7.y-this.A_1.y,this.E_A.z=this.E7.z-this.A_1.z,this.E0=!0,this.E9.copyFrom(this.E_A),this.E9.normalize(),r.default.Cross(this.E_A,s,this.Ey),r.default.Cross(this.Ey,this.E_A,this.Ez),this.Ez.normalize(),this.Ey.normalize(),this.E8.copyFrom(this.Ez),this.E_R=!0)}getLookAtLHToCamera(t){t.lookAtLH(this.A_1,this.E7,this.E8)}getLookAtRHToCamera(t){t.lookAtRH(this.A_1,this.E7,this.E8)}perspectiveLH(t,e,s,i){this.E_S&&(this.E_N=!1,this.E_G=e,this.E_F=t,this.E_H=s,this.E_I=i,this.E6.perspectiveLH(t,e,s,i),this.E_Q=Math.tan(.5*t),this.Cs=!0,this.E_O=!1,this.E_R=!0)}perspectiveRH(t,e,s,i){this.E_S&&(this.E_G=e,this.E_F=t,this.E_H=s,this.E_I=i,this.E6.perspectiveRH(t,e,s,i),this.E_Q=Math.tan(.5*t),this.E_N=!1,this.Cs=!0,this.E_O=!0,this.E_R=!0)}perspectiveRH2(t,e,s,i,a){this.E_S&&(this.E_G=e/s,this.E_F=t,this.E_H=i,this.E_I=a,this.E6.perspectiveRH2(t,e,s,i,a),this.E_Q=Math.tan(.5*t),this.Cs=!0,this.E_N=!0,this.E_O=!0,this.E_R=!0)}getAspect(){return this.E_G}getViewFieldZoom(){return this.E_Q}orthoRH(t,e,s,i,a,r){this.E_S&&(this.E_H=t,this.E_I=e,this.E_J=s,this.E_K=i,this.E_L=a,this.E_M=r,this.E6.orthoRH(s,i,a,r,t,e),this.Cs=!1,this.E_O=!0,this.E_R=!0)}orthoLH(t,e,s,i,a,r){this.E_S&&(this.E_H=t,this.E_I=e,this.E_J=s,this.E_K=i,this.E_L=a,this.E_M=r,this.E6.orthoLH(s,i,a,r,t,e),this.Cs=!1,this.E_O=!1,this.E_R=!0)}isPerspectiveEnabled(){return this.Cs}isRightHandEnabled(){return this.E_O}setViewXY(t,e){this.E_S&&(this.B=t,this.C=e)}setViewSize(t,e){this.E_S&&(t==this.D&&e==this.E||(this.D=t,this.E=e,this.E_D=.5*t,this.E_E=.5*e,this.Cs?this.E_N?this.E_O&&this.perspectiveRH2(this.E_F,t,e,this.E_H,this.E_I):this.E_O?this.perspectiveRH(this.E_F,t/e,this.E_H,this.E_I):this.perspectiveLH(this.E_F,t/e,this.E_H,this.E_I):this.orthoRH(this.E_H,this.E_I,-.5*e,.5*e,-.5*t,.5*t)))}getViewX(){return this.B}getViewY(){return this.C}getViewWidth(){return this.D}getViewHeight(){return this.E}translation(t){this.E_S&&(this.A_1.copyFrom(t),this.E7.x=t.x+this.E_A.x,this.E7.y=t.y+this.E_A.y,this.E7.z=t.z+this.E_A.z,this.E_R=!0)}translationXYZ(t,e,s){this.Ew.setXYZ(t,e,s),this.E_S&&r.default.DistanceSquared(this.A_1,this.Ew)>1e-5&&(this.A_1.setTo(t,e,s),this.E7.x=t+this.E_A.x,this.E7.y=e+this.E_A.y,this.E7.z=s+this.E_A.z,this.E_R=!0)}forward(t){this.E_S&&(this.A_1.x+=this.E9.x*t,this.A_1.y+=this.E9.y*t,this.A_1.z+=this.E9.z*t,this.E7.x=this.A_1.x+this.E_A.x,this.E7.y=this.A_1.y+this.E_A.y,this.E7.z=this.A_1.z+this.E_A.z,this.E_R=!0)}slideViewOffsetXY(t,e){if(this.E_S){this.Ew.setXYZ(t,e,0),this.E_d.transformVectorSelf(this.Ew),t=this.Ew.x-this.A_1.x,e=this.Ew.y-this.A_1.y;let s=this.Ew.z-this.A_1.z;this.A_1.x+=t,this.A_1.y+=e,this.A_1.z+=s,this.E7.x+=t,this.E7.y+=e,this.E7.z+=s,this.E_R=!0}}forwardFixPos(t,e){this.E_S&&(this.A_1.x=e.x+this.E9.x*t,this.A_1.y=e.y+this.E9.y*t,this.A_1.z=e.z+this.E9.z*t,this.E7.x=this.A_1.x+this.E_A.x,this.E7.y=this.A_1.y+this.E_A.y,this.E7.z=this.A_1.z+this.E_A.z,this.E_R=!0)}swingHorizontalWithAxis(t,e){this.E_S&&(this.E5.identity(),null!=e?this.E5.appendRotation(t*a.default.MATH_PI_OVER_180,e):this.E5.appendRotation(t*a.default.MATH_PI_OVER_180,r.default.Y_AXIS),this.E_A.x=this.A_1.x-this.E7.x,this.E_A.y=this.A_1.y-this.E7.y,this.E_A.z=this.A_1.z-this.E7.z,this.E5.transformVectorSelf(this.E_A),this.A_1.x=this.E_A.x+this.E7.x,this.A_1.y=this.E_A.y+this.E7.y,this.A_1.z=this.E_A.z+this.E7.z,this.E_A.x=this.E7.x-this.A_1.x,this.E_A.y=this.E7.y-this.A_1.y,this.E_A.z=this.E7.z-this.A_1.z,this.E0=!0,this.E9.copyFrom(this.E_A),this.E9.normalize(),this.E5.transformVectorSelf(this.Ey),this.Ey.normalize(),r.default.Cross(this.Ey,this.E_A,this.E8),this.E8.normalize(),this.E_R=!0)}swingHorizontal(t){this.E_S&&(this.E5.identity(),this.E5.appendRotation(t*a.default.MATH_PI_OVER_180,this.E8),this.E_A.x=this.A_1.x-this.E7.x,this.E_A.y=this.A_1.y-this.E7.y,this.E_A.z=this.A_1.z-this.E7.z,this.E5.transformVectorSelf(this.E_A),this.A_1.x=this.E_A.x+this.E7.x,this.A_1.y=this.E_A.y+this.E7.y,this.A_1.z=this.E_A.z+this.E7.z,this.E_A.x=this.E7.x-this.A_1.x,this.E_A.y=this.E7.y-this.A_1.y,this.E_A.z=this.E7.z-this.A_1.z,this.E0=!0,this.E9.copyFrom(this.E_A),this.E9.normalize(),r.default.Cross(this.E_A,this.E8,this.Ey),this.Ey.normalize(),this.E_R=!0)}swingVertical(t){this.E_S&&(this.E5.identity(),this.E5.appendRotation(t*a.default.MATH_PI_OVER_180,this.Ey),this.E_A.x=this.A_1.x-this.E7.x,this.E_A.y=this.A_1.y-this.E7.y,this.E_A.z=this.A_1.z-this.E7.z,this.E5.transformVectorSelf(this.E_A),this.A_1.x=this.E_A.x+this.E7.x,this.A_1.y=this.E_A.y+this.E7.y,this.A_1.z=this.E_A.z+this.E7.z,this.E_A.x=this.E7.x-this.A_1.x,this.E_A.y=this.E7.y-this.A_1.y,this.E_A.z=this.E7.z-this.A_1.z,this.E0=!0,this.E9.copyFrom(this.E_A),this.E9.normalize(),r.default.Cross(this.Ey,this.E_A,this.E8),this.E8.normalize(),this.Ez.copyFrom(this.E8),this.E_R=!0)}setPosition(t){if(this.E_S){r.default.Cross(this.E_A,this.E8,this.Ew);let e=this.Ew.dot(this.Ez);this.Ex.copyFrom(this.Ez),this.Ex.scaleBy(e),this.Ew.subtractBy(this.Ex),this.A_1.copyFrom(t),this.E_A.x=this.E7.x-this.A_1.x,this.E_A.y=this.E7.y-this.A_1.y,this.E_A.z=this.E7.z-this.A_1.z,this.E9.copyFrom(this.E_A),this.E9.normalize(),r.default.Cross(this.Ew,this.E_A,this.E8),this.E8.normalize(),this.E_R=!0}}setPositionXYZ(t,e,s){if(this.E_S){r.default.Cross(this.E_A,this.E8,this.Ew);var i=this.Ew.dot(this.Ez);this.Ex.copyFrom(this.Ez),this.Ex.scaleBy(i),this.Ew.subtractBy(this.Ex),this.A_1.setTo(t,e,s),this.E_A.x=this.E7.x-this.A_1.x,this.E_A.y=this.E7.y-this.A_1.y,this.E_A.z=this.E7.z-this.A_1.z,this.E9.copyFrom(this.E_A),this.E9.normalize(),r.default.Cross(this.Ew,this.E_A,this.E8),this.E8.normalize(),this.E_R=!0}}setLookPosXYZFixUp(t,e,s){this.E_S&&(this.E7.setTo(t,e,s),this.E_A.x=this.E7.x-this.A_1.x,this.E_A.y=this.E7.y-this.A_1.y,this.E_A.z=this.E7.z-this.A_1.z,this.E0=!0,this.E9.copyFrom(this.E_A),this.E9.normalize(),r.default.Cross(this.E_A,this.E8,this.Ey),this.Ey.normalize(),this.E_R=!0)}setPositionXYZFixUp(t,e,s){this.E_S&&(this.A_1.setTo(t,e,s),this.E_A.x=this.E7.x-this.A_1.x,this.E_A.y=this.E7.y-this.A_1.y,this.E_A.z=this.E7.z-this.A_1.z,this.E0=!0,this.E9.copyFrom(this.E_A),this.E9.normalize(),r.default.Cross(this.E_A,this.E8,this.Ey),this.Ey.normalize(),this.E_R=!0)}setPositionFixUp(t){this.E_S&&(this.A_1.copyFrom(t),this.E_A.x=this.E7.x-this.A_1.x,this.E_A.y=this.E7.y-this.A_1.y,this.E_A.z=this.E7.z-this.A_1.z,this.E0=!0,this.E9.copyFrom(this.E_A),this.E9.normalize(),r.default.Cross(this.E_A,this.E8,this.Ey),this.Ey.normalize(),this.E_R=!0)}copyFrom(t){let e=t.getPosition();this.A_1.copyFrom(e),e=t.getLookAtPosition(),this.E7.copyFrom(e),this.setZNear(t.getZNear()),this.setZFar(t.getZFar()),this.setNearPlaneWidth(t.getNearPlaneWidth()),this.setNearPlaneHeight(t.getNearPlaneHeight()),this.setPerspectiveEnabled(t.getPerspectiveEnabled()),this.E3.copyFrom(t.getViewInvMatrix())}getNV(){return this.E_T.copyFrom(this.E9),this.E_T}getUV(){return this.E_U.copyFrom(this.E8),this.E_U}getRV(){return this.E_V.copyFrom(this.Ey),this.E_V}getPosition(){return this.E_W.copyFrom(this.A_1),this.E_W}getLookAtPosition(){return this.E_X.copyFrom(this.E7),this.E_X}setLookAtPosition(t){this.E_S&&(this.E7.copyFrom(t),this.E_A.x=this.E7.x-this.A_1.x,this.E_A.y=this.E7.y-this.A_1.y,this.E_A.z=this.E7.z-this.A_1.z,this.E9.copyFrom(this.E_A),this.E9.normalize(),this.E_R=!0)}setLookAtXYZ(t,e,s){this.E_S&&(this.E7.setTo(t,e,s),this.E_A.x=this.E7.x-this.A_1.x,this.E_A.y=this.E7.y-this.A_1.y,this.E_A.z=this.E7.z-this.A_1.z,this.E9.copyFrom(this.E_A),this.E9.normalize(),this.E_R=!0)}getPerspectiveEnabled(){return this.Cs}setPerspectiveEnabled(t){this.Cs=t}appendRotationByAxis(t,e,s=null){this.E_S&&(this.E_Y=t,this.E_R=!0,this.E_Z.copyFrom(e),this.E_a=s,this.E_b=!0)}setRotationX(t){this.E_P.x=t,this.E_R=!0,this.E_b=!1}getRotationX(){return this.E_P.x}setRotationY(t){this.E_P.y=t,this.E_R=!0,this.E_b=!1}getRotationY(){return this.E_P.y}setRotationZ(t){this.E_P.z=t,this.E_R=!0,this.E_b=!1}getRotationZ(){return this.E_P.z}setRotationXYZ(t,e,s){this.E_S&&(this.E_P.setXYZ(t,e,s),this.E_R=!0,this.E_b=!1)}screenXYToViewXYZ(t,e,s){t-=this.B,e-=this.C,this.Cs&&(t=this.E_B*(t-this.E_D)/this.E_D,e=this.E_C*(this.E_E-e)/this.E_E),s.setTo(t,e,-this.E_H)}screenXYToWorldXYZ(t,e,s){t-=this.B,e-=this.C,this.Cs&&(t=.5*this.E_B*(t-this.E_D)/this.E_D,e=.5*this.E_C*(this.E_E-e)/this.E_E),s.setTo(t,e,-this.E_H),s.w=1,this.E3.transformVectorSelf(s)}getWorldPickingRayByScreenXY(t,e,s,i){t-=this.B,e-=this.C,this.Cs?(t=.5*this.E_B*(t-this.E_D)/this.E_D,e=.5*this.E_C*(e-this.E_E)/this.E_E,s.setTo(t,e,-this.E_H),s.w=1,this.E3.transformVectorSelf(s),i.copyFrom(s),i.subtractBy(this.A_1),i.normalize()):(t-=this.E_D,e-=this.E_E,s.setTo(t,e,-this.E_H),s.w=1,this.E3.transformVectorSelf(s),i.copyFrom(this.E9))}calcScreenNormalizeXYByWorldPos(t,e){e.copyFrom(t),this.E4.transformVectorSelf(e),e.x/=e.w,e.y/=e.w}worldPosToScreen(t){this.E2.transformVector3Self(t),this.E6.transformVectorSelf(t),t.x/=t.w,t.y/=t.w,t.x*=this.E_D,t.y*=this.E_E,t.x+=this.B,t.y+=this.C}calcViewRectByWorldSphere(t,e,s){this.E2.transformVector3Self(t),e*=1.15,s.x=t.x-e,s.y=t.y-e,s.z=t.z,t.x+=e,t.y+=e,this.E6.transformPerspV4Self(s),this.E6.transformPerspV4Self(t),t.z=1/t.w,s.z=t.x*t.z,s.w=t.y*t.z,s.z*=this.E_D,s.w*=this.E_E,s.x*=t.z,s.y*=t.z,s.x*=this.E_D,s.y*=this.E_E,s.z=s.z-s.x,s.w=s.w-s.y,s.x+=this.B,s.y+=this.C}calcScreenRectByWorldSphere(t,e,s){this.E2.transformVector3Self(t),e*=1.15,s.x=t.x-e,s.y=t.y-e,t.x+=e,t.y+=e,this.E6.transformPerspV4Self(s),this.E6.transformPerspV4Self(t),t.z=1/t.w,s.z=t.x*t.z,s.w=t.y*t.z,s.x*=t.z,s.y*=t.z,s.z=s.z-s.x,s.w=s.w-s.y}getInvertViewMatrix(){return this.E_d}getZNear(){return this.E_H}setZNear(t){this.E_H=t}getZFar(){return this.E_I}setZFar(t){this.E_I=t}getNearPlaneWidth(){return this.E_B}setNearPlaneWidth(t){this.E_B=t}getNearPlaneHeight(){return this.E_C}setNearPlaneHeight(t){this.E_C=t}getFov(){return this.E_F}__calcTestParam(){null==this.E_d&&(this.E_d=new n.default),this.E_d.copyFrom(this.E2),this.E_d.invert();let t=null,e=this.E_E,s=this.E_D,i=this.E_E,a=this.E_D;if(this.Cs){let t=Math.tan(.5*this.E_F);e=this.E_H*t,s=e*this.E_G,i=this.E_I*t,a=i*this.E_G}this.E_e=s,this.E_f=e,this.E_g.setTo(0,0,-this.E_H),this.E_h.setTo(0,0,-this.E_I),this.E_d.transformVectorSelf(this.E_g),this.E_d.transformVectorSelf(this.E_h),this.E_i.x=this.E_h.x-this.E_g.x,this.E_i.y=this.E_h.y-this.E_g.y,this.E_i.z=this.E_h.z-this.E_g.z,this.E_i.normalize(),t=this.E_k[0],t.nv.copyFrom(this.E_i),t.distance=t.nv.dot(this.E_h),t.position.copyFrom(this.E_h),t=this.E_k[1],t.nv.copyFrom(this.E_k[0].nv),t.distance=t.nv.dot(this.E_g),t.position.copyFrom(this.E_g),this.E_j[8]=this.E_g,this.E_j[9]=this.E_h,this.E_j[11]=this.E_i,this.E_j[0].setTo(-a,-i,-this.E_I),this.E_j[1].setTo(a,-i,-this.E_I),this.E_j[2].setTo(a,i,-this.E_I),this.E_j[3].setTo(-a,i,-this.E_I),this.E_j[4].setTo(-s,-e,-this.E_H),this.E_j[5].setTo(s,-e,-this.E_H),this.E_j[6].setTo(s,e,-this.E_H),this.E_j[7].setTo(-s,e,-this.E_H),this.E_d.transformVectorSelf(this.E_j[0]),this.E_d.transformVectorSelf(this.E_j[1]),this.E_d.transformVectorSelf(this.E_j[2]),this.E_d.transformVectorSelf(this.E_j[3]),this.E_d.transformVectorSelf(this.E_j[4]),this.E_d.transformVectorSelf(this.E_j[5]),this.E_d.transformVectorSelf(this.E_j[6]),this.E_d.transformVectorSelf(this.E_j[7]),this.E_c.max.setTo(-9999999,-9999999,-9999999),this.E_c.min.setTo(9999999,9999999,9999999);for(let r=0;r<8;++r)this.E_c.addPosition(this.E_j[r]);this.E_c.updateFast();let h=this.E_j[0],l=this.E_j[4];this.Ew.x=h.x-l.x,this.Ew.y=h.y-l.y,this.Ew.z=h.z-l.z,h=this.E_j[1],l=this.E_j[5],this.Ex.x=h.x-l.x,this.Ex.y=h.y-l.y,this.Ex.z=h.z-l.z,t=this.E_k[3],r.default.Cross(this.Ex,this.Ew,t.nv),t.nv.normalize(),t.distance=t.nv.dot(h),t.position.copyFrom(h),h=this.E_j[3],l=this.E_j[7],this.Ew.x=h.x-l.x,this.Ew.y=h.y-l.y,this.Ew.z=h.z-l.z,h=this.E_j[2],l=this.E_j[6],this.Ex.x=h.x-l.x,this.Ex.y=h.y-l.y,this.Ex.z=h.z-l.z,t=this.E_k[2],r.default.Cross(this.Ex,this.Ew,t.nv),t.nv.normalize(),t.distance=t.nv.dot(h),t.position.copyFrom(h),h=this.E_j[0],l=this.E_j[4],this.Ew.x=h.x-l.x,this.Ew.y=h.y-l.y,this.Ew.z=h.z-l.z,h=this.E_j[3],l=this.E_j[7],this.Ex.x=h.x-l.x,this.Ex.y=h.y-l.y,this.Ex.z=h.z-l.z,t=this.E_k[4],r.default.Cross(this.Ew,this.Ex,t.nv),t.nv.normalize(),t.distance=t.nv.dot(h),t.position.copyFrom(h),h=this.E_j[1],l=this.E_j[5],this.Ew.x=h.x-l.x,this.Ew.y=h.y-l.y,this.Ew.z=h.z-l.z,h=this.E_j[2],l=this.E_j[6],this.Ex.x=h.x-l.x,this.Ex.y=h.y-l.y,this.Ex.z=h.z-l.z,t=this.E_k[5],r.default.Cross(this.Ew,this.Ex,t.nv),t.nv.normalize(),t.distance=t.nv.dot(h),t.position.copyFrom(h),this.E_l[0].copyFrom(this.E_k[0].nv),this.E_l[1].copyFrom(this.E_k[1].nv),this.E_l[1].scaleBy(-1),this.E_l[2].copyFrom(this.E_k[2].nv),this.E_l[3].copyFrom(this.E_k[3].nv),this.E_l[3].scaleBy(-1),this.E_l[4].copyFrom(this.E_k[4].nv),this.E_l[4].scaleBy(-1),this.E_l[5].copyFrom(this.E_k[5].nv),this.E_m[0]=this.E_k[0].distance,this.E_m[1]=-this.E_k[1].distance,this.E_m[2]=this.E_k[2].distance,this.E_m[3]=-this.E_k[3].distance,this.E_m[4]=-this.E_k[4].distance,this.E_m[5]=this.E_k[5].distance}getWordFrustumWAABB(){return this.E_c}getWordFrustumWAABBCenter(){return this.E_c.center}getWordFrustumVtxArr(){return this.E_j}getWordFrustumPlaneArr(){return this.E_k}visiTestSphere2(t,e){let s=this.E_l[0].dot(t)-this.E_m[0]-e>a.default.MATH_MIN_POSITIVE;return!s&&(s=this.E_l[1].dot(t)-this.E_m[1]-e>a.default.MATH_MIN_POSITIVE,!s&&(s=this.E_l[2].dot(t)-this.E_m[2]-e>a.default.MATH_MIN_POSITIVE,!s&&(s=this.E_l[3].dot(t)-this.E_m[3]-e>a.default.MATH_MIN_POSITIVE,!s&&(s=this.E_l[4].dot(t)-this.E_m[4]-e>a.default.MATH_MIN_POSITIVE,!s&&(s=this.E_l[5].dot(t)-this.E_m[5]-e>a.default.MATH_MIN_POSITIVE,!s)))))}visiTestSphere3(t,e,s){let i=this.E_l[0].dot(t)-this.E_m[0]+s-e>a.default.MATH_MIN_POSITIVE;return!i&&(i=this.E_l[1].dot(t)-this.E_m[1]-e>a.default.MATH_MIN_POSITIVE,!i&&(i=this.E_l[2].dot(t)-this.E_m[2]-e>a.default.MATH_MIN_POSITIVE,!i&&(i=this.E_l[3].dot(t)-this.E_m[3]-e>a.default.MATH_MIN_POSITIVE,!i&&(i=this.E_l[4].dot(t)-this.E_m[4]-e>a.default.MATH_MIN_POSITIVE,!i&&(i=this.E_l[5].dot(t)-this.E_m[5]-e>a.default.MATH_MIN_POSITIVE,!i)))))}visiTestPosition(t){let e=this.E_l[0].dot(t)-this.E_m[0]>a.default.MATH_MIN_POSITIVE;return!e&&(e=this.E_l[1].dot(t)-this.E_m[1]>a.default.MATH_MIN_POSITIVE,!e&&(e=this.E_l[2].dot(t)-this.E_m[2]>a.default.MATH_MIN_POSITIVE,!e&&(e=this.E_l[3].dot(t)-this.E_m[3]>a.default.MATH_MIN_POSITIVE,!e&&(e=this.E_l[4].dot(t)-this.E_m[4]>a.default.MATH_MIN_POSITIVE,!e&&(e=this.E_l[5].dot(t)-this.E_m[5]>a.default.MATH_MIN_POSITIVE,!e)))))}visiTestPlane(t,e){let s=t.dot(this.E_k[0].position)-e,i=s*(t.dot(this.E_k[1].position)-e);return i<a.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.E_k[2].position)-e),i<a.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.E_k[3].position)-e),i<a.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.E_k[4].position)-e),i<a.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.E_k[5].position)-e),i<a.default.MATH_MIN_POSITIVE))))}visiTestSphere(t,e){let s=this.E_c.sphereIntersect(t,e);if(s){let s=this.E_k[0].intersectSphere(t,e),i=this.E_k[1].intersectSphere(t,e);return!(s*i>=0&&!this.E_k[0].intersectBoo&&!this.E_k[1].intersectBoo)&&(s=this.E_k[2].intersectSphere(t,e),i=this.E_k[3].intersectSphere(t,e),!(s*i>=0&&!this.E_k[2].intersectBoo&&!this.E_k[3].intersectBoo)&&(s=this.E_k[4].intersectSphere(t,e),i=this.E_k[5].intersectSphere(t,e),!(s*i>=0&&!this.E_k[4].intersectBoo&&!this.E_k[5].intersectBoo)))}return!1}visiTestAABB(t){let e=t.center,s=t.radius,i=this.E_c.sphereIntersect(e,s);if(i){let t=this.E_k[0].intersectSphere(e,s),i=this.E_k[1].intersectSphere(e,s);return!(t*i>=0&&!this.E_k[0].intersectBoo&&!this.E_k[1].intersectBoo)&&(t=this.E_k[2].intersectSphere(e,s),i=this.E_k[3].intersectSphere(e,s),!(t*i>=0&&!this.E_k[2].intersectBoo&&!this.E_k[3].intersectBoo)&&(t=this.E_k[4].intersectSphere(e,s),i=this.E_k[5].intersectSphere(e,s),!(t*i>=0&&!this.E_k[4].intersectBoo&&!this.E_k[5].intersectBoo)))}return!1}setViewMatrix(t){this.E_n=t,this.E_R=!0}update(){this.E_R&&(this.version++,this.E_R=!1,null==this.E_n?(this.E_b?this.E1.appendRotationPivot(this.E_Y*a.default.MATH_PI_OVER_180,this.E_Z,this.E_a):(this.E1.identity(),this.E1.appendRotationEulerAngle(this.E_P.x*a.default.MATH_PI_OVER_180,this.E_P.y*a.default.MATH_PI_OVER_180,this.E_P.z*a.default.MATH_PI_OVER_180)),this.E0?this.E2.lookAtRH(this.A_1,this.E7,this.E8):this.E2.lookAtLH(this.A_1,this.E7,this.E8),this.E2.append(this.E1)):this.E2.copyFrom(this.E_n),this.E_N?(this.E_B=this.E_H*Math.tan(.5*this.E_F)*2,this.E_C=this.E_B/this.E_G):(this.E_C=this.E_H*Math.tan(.5*this.E_F)*2,this.E_B=this.E_G*this.E_C),this.E3.copyFrom(this.E2),this.E3.invert(),this.E4.identity(),this.E4.copyFrom(this.E2),this.E4.append(this.E6),this.__calcTestParam(),this.updateUniformData())}updateCamMatToUProbe(t){t.isEnabled()&&(t.update(),t.getFS32At(0).set(this.E2.getLocalFS32(),0),t.getFS32At(1).set(this.E6.getLocalFS32(),0))}updateUniformData(){this.uniformEnabled&&(this.updateCamMatToUProbe(this.matUProbe),this.ufrustumProbe.setVec4DataAt(0,this.E_H,this.E_I,this.E_e,this.E_f),this.ufrustumProbe.update(),this.ucameraPosProbe.setVec4DataAt(0,this.A_1.x,this.A_1.y,this.A_1.z,1),this.ucameraPosProbe.update())}destroy(){}lookRHEnabled(){return this.E0}lookLHEnabled(){return!this.E0}getVPMatrix(){return this.E4}getViewMatrix(){return this.E2}getViewInvMatrix(){return this.E3}getProjectMatrix(){return this.E6}}e.default=o},c62b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("e08e"),r=s("7c63"),n=i(s("29ef"));class h{constructor(){this.uid=-1,this.value=-1,this.__$rpuid=-1,this.__$rprouid=-1,this.shader=null,this.pos=null,this.bounds=null,this.ibufType=0,this.ibufStep=2,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.drawOffset=0,this.partTotal=0,this.partGroup=null,this.trisNumber=0,this.visible=!0,this.drawEnabled=!0,this.drawMode=0,this.renderState=0,this.rcolorMask=0,this.drawFlag=0,this.vro=null,this.transUniform=null,this.uniform=null,this.shdUid=-1,this.vtxUid=-1,this.tro=null,this.texMid=-1,this.ubo=null,this.polygonOffset=null}testDrawFlag(){this.shader.drawFlag!=this.drawFlag&&(this.shader.drawFlag=this.drawFlag,r.RenderStateObject.UseRenderState(this.renderState),r.RenderColorMask.UseRenderState(this.rcolorMask))}getUid(){return this.uid}getRPOUid(){return this.__$rpuid}getRPROUid(){return this.__$rprouid}getShaderUid(){return this.shdUid}setIvsParam(t,e){this.ivsIndex=t,this.ivsCount=e,this.drawOffset=t*this.ibufStep,this.drawEnabled=this.visible&&this.ivsCount>0}setVisible(t){this.visible=t,this.drawEnabled=t&&this.ivsCount>0}setDrawFlag(t,e){this.renderState=t,this.rcolorMask=e,this.drawFlag=(e<<10)+t}drawThis(t){++n.default.DrawCallTimes,n.default.DrawTrisNumber+=this.trisNumber;let e=this.indicesRes.getVTCount();switch(this.ivsCount<=e&&(e=this.ivsCount),null!=this.polygonOffset?t.setPolygonOffset(this.polygonOffset[0],this.polygonOffset[1]):t.resetPolygonOffset(),this.drawMode){case a.RenderDrawMode.ELEMENTS_TRIANGLES:t.RContext.drawElements(t.TRIANGLES,e,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ELEMENTS_LINES:t.RContext.drawElements(t.LINES,e,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:t.RContext.drawElements(t.TRIANGLE_STRIP,e,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:t.RContext.drawElementsInstanced(t.TRIANGLES,e,this.ibufType,this.drawOffset,this.insCount);break;case a.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:t.RContext.drawElements(t.TRIANGLE_FAN,e,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ARRAYS_LINES:t.RContext.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case a.RenderDrawMode.ARRAYS_LINE_STRIP:t.RContext.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}drawPart(t){++n.default.DrawCallTimes,n.default.DrawTrisNumber+=this.trisNumber;let e=this.indicesRes.getVTCount();this.ivsCount<=e&&(e=this.ivsCount),null!=this.polygonOffset?t.setPolygonOffset(this.polygonOffset[0],this.polygonOffset[1]):t.resetPolygonOffset();let s=0,i=t.RContext;switch(this.drawMode){case a.RenderDrawMode.ELEMENTS_TRIANGLES:for(;s<this.partTotal;)i.drawElements(t.TRIANGLES,this.partGroup[s++],this.ibufType,this.partGroup[s++]);break;case a.RenderDrawMode.ELEMENTS_LINES:for(;s<this.partTotal;)i.drawElements(t.LINES,this.partGroup[s++],this.ibufType,this.partGroup[s++]);break;case a.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:i.drawElements(t.TRIANGLE_STRIP,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:i.drawElementsInstanced(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset,this.insCount);break;case a.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:i.drawElements(t.TRIANGLE_FAN,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ARRAYS_LINES:i.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case a.RenderDrawMode.ARRAYS_LINE_STRIP:i.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}run2(t){null!=this.ubo&&this.ubo.run(t),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}run(t){null!=this.ubo&&this.ubo.run(t),this.vro.run(),this.tro.run(),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}runLockMaterial2(t){this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(null==t?this.uniform:t,this.transUniform)}runLockMaterial(){this.vro.run(),this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(this.uniform,this.transUniform)}reset(){this.indicesRes=null,this.polygonOffset=null,this.vro.__$detachThis(),this.vro=null,this.tro.__$detachThis(),this.tro=null,this.texMid=-1,this.__$rprouid=-1,this.ubo=null,this.shdUid=-1,this.vtxUid=-1,this.uniform=null,this.transUniform=null,this.partGroup=null,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.partTotal=0,this.drawMode=0,this.drawFlag=0,this.renderState=0,this.rcolorMask=0,this.drawEnabled=!0,this.shader=null,this.bounds=null,this.pos=null}destroy(){this.reset()}toString(){return"[RPOUnit(uid = "+this.uid+")]"}}e.default=h},c70f:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("ab73")),r=i(s("7279"));class n{constructor(){}geNames(){return[]}createGlobalUinform(t){let e=new r.default;return e.uniformNameList=this.geNames(),e.copyDataFromProbe(t),t.update(),e}}class h extends n{constructor(){super()}geNames(){return[a.default.EnvLightParams.name]}use(t,e=1){t.addFragUniformParam(a.default.EnvLightParams)}}e.GlobalEnvLightUniformParam=h;class l extends n{constructor(){super()}geNames(){return[a.default.ShadowMatrix.name,a.default.ShadowVSMParams.name]}use(t,e=1){t.addFragUniformParam(a.default.ShadowVSMParams),t.addVertUniformParam(a.default.ShadowMatrix)}}e.GlobalVSMShadowUniformParam=l;class o extends n{constructor(){super()}geNames(){return[a.default.GlobalLight.positionName,a.default.GlobalLight.colorName]}use(t,e=1,s=1){t.uniform.useCameraPosition(!1,!0),t.addFragUniform(a.default.GlobalLight.type,a.default.GlobalLight.positionName,e),t.addFragUniform(a.default.GlobalLight.type,a.default.GlobalLight.colorName,s)}}e.GlobalLightUniformParam=o},c711:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("6e01")),r=i(s("8e17")),n=i(s("fecb")),h=i(s("c120"));class l{constructor(){this.B_6=null,this.A_i=null,this.De=null,this.Df=null,this.Dg=new Uint8Array(256),this.Dh=null,this.Di=null,this.Dj=0,this.Dk=0,this.Dl=new r.default,this.Dm=new r.default,this.B_x=null,this.B_y=null,this.Dn=new Uint8Array(4),this.Do=new r.default,this.Dp=new r.default,this.Dq=[null,null],this.Dr=!1}setRenderer(t){this.B_6=t}setRayTestMode(t){this.Dk=t}setRay(t,e){this.B_x=t,this.B_y=e}getRay(t,e){t.copyFrom(this.B_x),e.copyFrom(this.B_y)}setCamera(t){this.A_i=t}setCullingNodeHead(t){if(this.De=t,null==this.Dh){this.Dh=[];let t=0;for(;t<256;++t)this.Dh.push(new h.default)}}getSelectedNode(){return this.Di}getSelectedNodes(){return this.Dh}getSelectedNodesTotal(){return this.Dj}sorting(t,e){let s=this.Dh;this.Df=s[t];while(t<e){while(t<e&&s[e].dis>=this.Df.dis)--e;s[t]=s[e];while(t<e&&s[t].dis<=this.Df.dis)++t;s[e]=s[t]}return s[t]=this.Df,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}run(){let t=this.De;if(null!=t){let e=0,s=this.B_y,i=this.B_x,h=this.Dp,l=null,o=0;Math.abs(s.x)>a.default.MATH_MIN_POSITIVE?this.Do.x=1/s.x:this.Do.x=a.default.MATH_MAX_POSITIVE,Math.abs(s.y)>a.default.MATH_MIN_POSITIVE?this.Do.y=1/s.y:this.Do.y=a.default.MATH_MAX_POSITIVE,Math.abs(s.z)>a.default.MATH_MIN_POSITIVE?this.Do.z=1/s.z:this.Do.z=a.default.MATH_MAX_POSITIVE,this.Do.x<0?this.Dn[0]=1:this.Dn[0]=0,this.Do.y<0?this.Dn[1]=1:this.Dn[1]=0,this.Do.z<0?this.Dn[2]=1:this.Dn[2]=0;while(null!=t)t.drawEnabled&&t.entity.mouseEnabled&&(h.x=t.bounds.center.x-i.x,h.y=t.bounds.center.y-i.y,h.z=t.bounds.center.z-i.z,e=h.dot(s),h.x-=e*s.x,h.y-=e*s.y,h.z-=e*s.z,h.getLengthSquared()<=t.bounds.radius2&&t.rayTestState<1&&(this.Dq[0]=t.bounds.min,this.Dq[1]=t.bounds.max,n.default.IntersectionRL3(this.Dq,this.Dn,this.Do,s,i,h)&&(l=this.Dh[o],l.entity=t.entity,l.dis=this.Do.w,l.wpv.copyFrom(h),++o))),t=t.next;this.Di=null;let _=0;if(o>0){let t=this.Dl,e=this.Dm,n=null,l=0,m=0,u=null,d=null;if(o>1){let c=!this.Dr;for(_=0;_<o;++_)d=this.Dh[_],d.dis=a.default.MATH_MAX_POSITIVE,d.flag=0,n=this.Dh[_].entity,n.isPolyhedral()?c?(u=n.getInvMatrix(),u.transformOutVector3(i,t),u.deltaTransformOutVector(s,e),e.normalize(),l=n.testRay(t,e,h,!0)):l=0:(u=n.getInvMatrix(),u.transformOutVector3(i,t),u.deltaTransformOutVector(s,e),e.normalize(),l=n.testRay(t,e,h,!0)),l>0?(d.flag=l,d.lpv.copyFrom(h),n.getMatrix().transformOutVector3(h,d.wpv),d.dis=r.default.Distance(d.wpv,i),this.Dg[m]=_,++m):l<0&&(this.Dg[m]=_,++m);for(this.snsort(0,o-1),_=0;_<o;++_)if(this.Dh[_].flag>0){this.Di=this.Dh[_];break}}else d=this.Dh[0],d.dis=a.default.MATH_MAX_POSITIVE,n=this.Dh[0].entity,u=n.getInvMatrix(),u.transformOutVector3(i,t),u.deltaTransformOutVector(s,e),e.normalize(),l=n.testRay(t,e,h,!0),l>0?(d.lpv.copyFrom(h),n.getMatrix().transformOutVector3(h,d.wpv),d.dis=r.default.Distance(d.wpv,i),this.Di=d):l<0&&(this.Di=d)}for(_=o;_<this.Dj;++_)this.Di!=this.Dh[_]&&(this.Dh[_].entity=null);this.Dj=o}}clear(){this.Di=null}}e.default=l},c8c5:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("29ef")),r=i(s("402a")),n=i(s("ba5e")),h=i(s("76b0")),l=s("cc48");class o extends r.default{constructor(){super(),this.Ea=0,this.Eb=0,this.Ec=0,this.Ed=0,this.A1=0,this.EW=null,this.flipVerticalUV=!1}setUVScale(t,e){null!=this.EW&&this.EW.setUVScale(t,e)}setUVTranslation(t,e){null!=this.EW&&this.EW.setUVTranslation(t,e)}setRGB3f(t,e,s){null!=this.EW&&this.EW.setRGB3f(t,e,s)}setRGBA4f(t,e,s,i){null!=this.EW&&this.EW.setRGBA4f(t,e,s,i)}createMaterial(t){null==this.getMaterial()?(this.EW=new n.default,this.EW.setTextureList(t),this.setMaterial(this.EW)):this.getMaterial().setTextureList(t)}showDoubleFace(t=!1,e=!0){t?e?this.setRenderState(a.default.NONE_CULLFACE_NORMAL_ALWAYS_STATE):this.setRenderState(a.default.BACK_NORMAL_ALWAYS_STATE):e?this.setRenderState(a.default.NONE_CULLFACE_NORMAL_STATE):this.setRenderState(a.default.NORMAL_STATE)}toTransparentBlend(t=!1,e=!1){t?e?this.setRenderState(a.default.NONE_TRANSPARENT_ALWAYS_STATE):this.setRenderState(a.default.BACK_TRANSPARENT_ALWAYS_STATE):e?this.setRenderState(a.default.NONE_TRANSPARENT_STATE):this.setRenderState(a.default.BACK_TRANSPARENT_STATE)}toBrightnessBlend(t=!1,e=!1){t?e?this.setRenderState(a.default.NONE_ADD_ALWAYS_STATE):this.setRenderState(a.default.BACK_ADD_ALWAYS_STATE):e?this.setRenderState(a.default.NONE_ADD_BLENDSORT_STATE):this.setRenderState(a.default.BACK_ADD_BLENDSORT_STATE)}initialize(t,e,s,i,a=null){this.Ea=t,this.Eb=e,this.Ec=s,this.Ed=i,this.A1=0,this.spaceCullMask=l.SpaceCullingMask.NONE,this.createMaterial(a),this.activeDisplay()}__activeMesh(t){if(null==this.getMesh()){let e=new h.default;e.flipVerticalUV=this.flipVerticalUV,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.axisFlag=0,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.Ea,this.Eb,this.Ec,this.Ed),this.setMesh(e)}}destroy(){super.destroy(),this.EW=null}toString(){return"[ScreenFixedAlignPlaneEntity]"}}e.default=o},ca2f:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}downloadBinFile(t,e,s="vrd"){var i,a;i=function(t,e,s){var i,r;i=new Blob([t],{type:s}),r=window.URL.createObjectURL(i),a(r,e),setTimeout((function(){return window.URL.revokeObjectURL(r)}),1e3)},a=function(t,e){var s;s=document.createElement("a"),s.href=t,s.download=e,document.body.appendChild(s),s.style="display: none",s.click(),s.remove()},i(t,e+"."+s,"application/octet-stream")}}e.FileIO=i},ca6c:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static PushThreeBitValueToInt(t,e){return(t<<3)+e}static PopThreeBitValueFromInt(t){return i.value=7&t,t>>3}static ContainsBit(t,e){return(e&t)>0}static RemoveBit(t,e){return~e&t}static AddBit(t,e){return e|t}static AssembleFromIntArray(t){let e=0,s=0,i=t.length;for(;e<i;++e)t[e]>0&&(s|=1<<e);return s}}i.BIT_ZERO=0,i.BIT_ONE_0=1,i.BIT_ONE_1=2,i.BIT_ONE_2=4,i.BIT_ONE_3=8,i.BIT_ONE_4=16,i.BIT_ONE_5=32,i.BIT_ONE_6=64,i.BIT_ONE_7=128,i.BIT_ONE_8=256,i.BIT_ONE_9=512,i.BIT_ONE_10=1024,i.BIT_ONE_11=2048,i.value=0,e.default=i},cb29:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8a0a")),r=s("8a0a"),n=i(s("e7d2")),h=s("e08e");class l{constructor(t=a.default.VTX_STATIC_DRAW){this.E_o=0,this.D_X=0,this.Ba=null,this.Bb=null,this.BZ=null,this.E_p=null,this.E_q=null,this.E_r=null,this.forceUpdateIVS=!1,this.wireframe=!1,this.bounds=null,this.normalType=r.VtxNormalType.GOURAND,this.normalScale=1,this.vtxTotal=0,this.trisNumber=0,this.drawMode=h.RenderDrawMode.ELEMENTS_TRIANGLES,this.vtCount=0,this.vbWholeDataEnabled=!1,this.drawInsBeginIndex=0,this.drawInsStride=0,this.drawInsTotal=0,this.c=0,this.E_o=t}updateWireframeIvs(){if(this.drawMode=h.RenderDrawMode.ELEMENTS_TRIANGLES,this.wireframe&&null!==this.BZ){let t,e,s,i,a=this.BZ,r=2*a.length;t=r<65535?new Uint16Array(r):new Uint32Array(r);let n=0;for(let h=0,l=a.length;h<l;h+=3)e=a[h+0],s=a[h+1],i=a[h+2],t[n]=e,t[n+1]=s,t[n+2]=s,t[n+3]=i,t[n+4]=i,t[n+5]=e,n+=6;this.drawMode=h.RenderDrawMode.ELEMENTS_LINES}}buildEnd(){this.E_p=n.default.BufDataList,this.E_q=n.default.BufDataStepList,this.E_r=n.default.BufStatusList}setTransformMatrix(t){this.Ba=t}getTransformMatrix(){return this.Ba}isPolyhedral(){return!0}setPolyhedral(t){}testRay(t,e,s,i){return-1}rebuild(){if(null==this.Bb&&null!=this.E_p){n.default.Reset();let t=0,e=this.E_p.length;for(;t<e;++t)n.default.AddFloat32Data(this.E_p[t],this.E_q[t],this.E_r[t]);this.Bb=n.default.CreateBySaveData(this.getBufDataUsage()),null!=this.BZ&&(this.Bb.setUintIVSData(this.BZ),this.vtCount=this.BZ.length)}}__$attachVBuf(){return null==this.Bb&&this.rebuild(),n.default.__$$AttachAt(this.Bb.getUid()),this.Bb}__$detachVBuf(t){if(this.Bb!=t)throw Error("Fatal Error!");n.default.__$$DetachAt(this.Bb.getUid())}isGeomDynamic(){return this.E_o}getBufDataUsage(){return this.E_o}getVS(){return null}getUVS(){return null}getNVS(){return null}getCVS(){return null}getIVS(){return this.BZ}setBufSortFormat(t){this.D_X=t}getBufSortFormat(){return this.D_X}isVBufEnabledAt(t){return(t&this.D_X)>0}__$attachThis(){++this.c}__$detachThis(){1==this.c?(--this.c,this.__$dispose()):--this.c,this.c<1&&(this.c=0)}getAttachCount(){return this.c}__$dispose(){this.getAttachCount()<1&&null!=this.Bb&&(n.default.__$$DetachAt(this.Bb.getUid()),this.Bb=null)}isEnabled(){return null!=this.Bb}isResFree(){return this.getAttachCount()<1&&null==this.Bb}__$destroy(){this.isResFree()&&(this.BZ=null,this.E_p=null,this.E_q=null,this.E_r=null,this.trisNumber=0,this.Ba=null)}toString(){return"[MeshBase()]"}}e.default=l},cc48:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["NONE"]=0]="NONE",t[t["CAMERA"]=1]="CAMERA",t[t["POV"]=2]="POV",t[t["INNER_POV_PASS"]=3]="INNER_POV_PASS",t[t["CAMERA_AND_POV"]=4]="CAMERA_AND_POV"}(i||(i={})),e.SpaceCullingMask=i},cc55:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.vert="",this.vert_head="",this.vert_body="",this.frag="",this.frag_head="",this.frag_body="",this.uuid=""}}e.ShaderCodeObject=i},ccdf:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("8d98"),r=i(s("cfaf")),n=i(s("acaa")),h=i(s("85b6")),l=i(s("3b73"));class o{constructor(t){this.d=null,this.E_s=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.E_t=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.E_u=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.E_v=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.d=t}getRenderProxy(){return this.d}createWrapperTex(t,e,s=!1){let i=new h.default(t,e,s);return i}createRTTTex2D(t,e,s=!1){let i=new r.default(t,e,s);return i}createDepthTex2D(t,e,s=!1){let i=new n.default(t,e,s);return i}getCubeRTTTextureAt(t){return null!=this.E_t[t]?(this.E_t[t].__$setRenderProxy(this.d),this.E_t[t]):(this.E_t[t]=this.createRTTTex2D(32,32),this.E_t[t].toCubeTexture(),this.E_t[t].name="sys_cube_rttTex_"+t,this.E_t[t].minFilter=a.TextureConst.LINEAR,this.E_t[t].magFilter=a.TextureConst.LINEAR,this.E_t[t].__$setRenderProxy(this.d),this.E_t[t])}createCubeRTTTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.E_t[t]?(this.E_t[t].__$setRenderProxy(this.d),this.E_t[t]):(this.E_t[t]=this.createRTTTex2D(e,s),this.E_t[t].toCubeTexture(),this.E_t[t].name="sys_cube_rttTex_"+t,this.E_t[t].minFilter=a.TextureConst.LINEAR,this.E_t[t].magFilter=a.TextureConst.LINEAR,this.E_t[t].__$setRenderProxy(this.d),this.E_t[t])}getRTTTextureAt(t){return null!=this.E_s[t]?(this.E_s[t].__$setRenderProxy(this.d),this.E_s[t]):(this.E_s[t]=this.createRTTTex2D(32,32),this.E_s[t].to2DTexture(),this.E_s[t].name="sys_rttTex_"+t,this.E_s[t].minFilter=a.TextureConst.LINEAR,this.E_s[t].magFilter=a.TextureConst.LINEAR,this.E_s[t].__$setRenderProxy(this.d),this.E_s[t])}createRTTTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.E_s[t]?(this.E_s[t].__$setRenderProxy(this.d),this.E_s[t]):(this.E_s[t]=this.createRTTTex2D(e,s),this.E_s[t].to2DTexture(),this.E_s[t].name="sys_rttTex_"+t,this.E_s[t].minFilter=a.TextureConst.LINEAR,this.E_s[t].magFilter=a.TextureConst.LINEAR,this.E_s[t].__$setRenderProxy(this.d),this.E_s[t])}getDepthTextureAt(t){return null!=this.E_v[t]?(this.E_v[t].__$setRenderProxy(this.d),this.E_v[t]):(this.E_v[t]=this.createDepthTex2D(64,64),this.E_v[t].to2DTexture(),this.E_v[t].name="sys_depthTex_"+t,this.E_v[t].minFilter=a.TextureConst.NEAREST,this.E_v[t].magFilter=a.TextureConst.NEAREST,this.E_v[t].__$setRenderProxy(this.d),this.E_v[t])}createDepthTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.E_v[t]?(this.E_v[t].__$setRenderProxy(this.d),this.E_v[t]):(this.E_v[t]=this.createDepthTex2D(e,s),this.E_v[t].to2DTexture(),this.E_v[t].name="sys_depthTex_"+t,this.E_v[t].__$setRenderProxy(this.d),this.E_v[t])}getRTTFloatTextureAt(t){if(null!=this.E_u[t])return this.E_u[t].__$setRenderProxy(this.d),this.E_u[t];let e=this.createRTTTex2D(64,64);return e.to2DTexture(),this.E_u[t]=e,this.E_u[t].name="sys_rttFloatTex_"+t,e.internalFormat=a.TextureFormat.RGBA16F,e.srcFormat=a.TextureFormat.RGBA,e.dataType=a.TextureDataType.FLOAT,e.minFilter=a.TextureConst.NEAREST,e.magFilter=a.TextureConst.NEAREST,l.default.IsWebGL1()&&(e.dataType=a.TextureDataType.HALF_FLOAT_OES),this.E_u[t].__$setRenderProxy(this.d),e}createRTTFloatTextureAt(t,e,s){if(e=e>1?e:1,s=s>1?s:1,null!=this.E_u[t])return this.E_u[t].__$setRenderProxy(this.d),this.E_u[t];let i=this.createRTTTex2D(e,s);return i.to2DTexture(),this.E_u[t]=i,this.E_u[t].name="sys_rttFloatTex_"+t,i.internalFormat=a.TextureFormat.RGBA16F,i.srcFormat=a.TextureFormat.RGBA,i.dataType=a.TextureDataType.FLOAT,i.minFilter=a.TextureConst.NEAREST,i.magFilter=a.TextureConst.NEAREST,l.default.IsWebGL1()&&(i.dataType=a.TextureDataType.HALF_FLOAT_OES),this.E_u[t].__$setRenderProxy(this.d),i}}e.RTTTextureStore=o,e.default=o},cf91:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("faa5")),r=i(s("b3bd")),n=i(s("0fc4")),h=i(s("6e01")),l=i(s("1ea6")),o=s("f3a2");class _ extends a.default{constructor(){super(),this.decorator=null,this.texturesTotal=0,this.vertUniform=null}initialize(t){t=this.texturesTotal>0,super.initialize(t),this.adaptationShaderVersion=!1}buildShader(){null!=this.vertUniform&&this.vertUniform.use(this.A_R),this.decorator.buildShader()}getShaderCodeObjectUUID(){return o.ShaderCodeUUID.PBR}getUniqueShaderName(){return null!=this.vertUniform?this.decorator.getUniqueShaderName()+this.vertUniform.getUniqueNSKeyString():this.decorator.getUniqueShaderName()}toString(){return"[PBRShaderBuffer()]"}static GetInstance(){return _.F_0}}_.F_0=new _;class m extends n.default{constructor(){super(),this.E_w=128,this.E_x=128,this.E_y=new Float32Array([0,0,1,.02,1,.1,1,1,.1,.1,.1,1,1,1,1,.07]),this.EJ=null,this.EG=null,this.E_z=new Float32Array([0,0,-1,1,1,.3,0,0]),this.decorator=null,this.vertUniform=null}buildBuf(){let t=_.GetInstance(),e=this.decorator;t.lightEnabled=e.lightEnabled,t.shadowReceiveEnabled=e.shadowReceiveEnabled,t.fogEnabled=e.fogEnabled,t.glossinessEnabeld=e.glossinessEnabeld,t.buildPipelineParams(),t.decorator=e,t.vertUniform=this.vertUniform,t.decorator.codeBuilder=t.getShaderCodeBuilder(),null==this.EJ&&this.initializeLocalData();let s=e.createTextureList();null!=this.vertUniform&&this.vertUniform.getTextures(t.getShaderCodeBuilder(),s),t.getTexturesFromPipeline(s),super.setTextureList(s),t.texturesTotal=s.length}getCodeBuf(){return _.GetInstance()}initializeLocalData(){null!=this.vertUniform&&this.vertUniform.initialize();let t=this.decorator;t.fragLocalParamsTotal=2,t.parallaxParamIndex=2,null!=t.parallaxMap&&(t.fragLocalParamsTotal+=1),this.EJ=new Float32Array(4*t.fragLocalParamsTotal),this.EJ.set([0,0,0,1,.2,.2,.2,0],0),null!=t.parallaxMap&&(this.EG=this.EJ.subarray(4*t.parallaxParamIndex,4*(t.parallaxParamIndex+1)),this.EG.set([1,10,2,.1]))}copyFrom(t){this.setMaterialPipeline(t.l_),null==this.decorator&&(this.decorator=new l.default),this.decorator.copyFrom(t.decorator),this.vertUniform=t.vertUniform,null==this.E_y||this.E_y.length!=t.E_y.length?this.E_y=t.E_y.slice():this.E_y.set(t.E_y),null==this.EJ||this.EJ.length!=t.EJ.length?this.EJ=t.EJ.slice():this.EJ.set(t.EJ),null==this.E_z||this.E_z.length!=t.E_z.length?this.E_z=t.E_z.slice():this.E_z.set(t.E_z)}setTextureList(t){}clone(){let t=new m;return t.copyFrom(this),t}seNormalMapIntensity(t){t=Math.min(Math.max(t,0),1),this.EJ[4]=t}setPixelNormalNoiseIntensity(t){t=Math.min(Math.max(t,0),2),this.E_y[3]=t}getPixelNormalNoiseIntensity(){return this.E_y[3]}setMirrorViewNV(t){this.E_z[0]=t.x,this.E_z[1]=t.y,this.E_z[2]=t.z}setMirrorPlaneNV(t){}setMirrorMapLodLevel(t){this.E_z[3]=t}setMirrorIntensity(t){this.E_z[4]=Math.min(Math.max(t,.01),2)}setMirrorMixFactor(t){this.E_z[5]=Math.min(Math.max(t,.01),2)}setEnvMapLodMipMapLevel(t,e=0){t=Math.min(Math.max(t,0),14),e=Math.min(Math.max(e,-7),12),this.E_y[15]=.01*Math.round(t)+e}setEnvMapLodMipMapLevelWithSize(t,e,s=0){this.E_w=t,this.E_x=e,s=Math.min(Math.max(s,-7),12),this.E_y[15]=.01*h.default.GetMaxMipMapLevel(t,e)+s}setScatterIntensity(t){this.E_y[11]=Math.min(Math.max(t,.01),512)}getScatterIntensity(){return this.E_y[11]}setToneMapingExposure(t){this.E_y[4]=Math.min(Math.max(t,.1),128)}getToneMapingExposure(){return this.E_y[4]}setReflectionIntensity(t){this.E_y[5]=Math.min(Math.max(t,.001),1)}getReflectionIntensity(){return this.E_y[5]}setSurfaceIntensity(t){this.E_y[6]=Math.min(Math.max(t,.001),32)}getSurfaceIntensity(){return this.E_y[6]}setSideIntensity(t){this.E_y[7]=Math.min(Math.max(t,.001),32)}getSideIntensity(){return this.E_y[7]}setEnvSpecularColorFactor(t,e,s){this.E_y[12]=t,this.E_y[13]=e,this.E_y[14]=s}getEnvSpecularColorFactor(t){t.r=this.E_y[12],t.g=this.E_y[13],t.b=this.E_y[14]}setAmbientFactor(t,e,s){this.E_y[8]=t,this.E_y[9]=e,this.E_y[10]=s}getAmbientFactor(t){t.r=this.E_y[8],t.g=this.E_y[9],t.b=this.E_y[10]}setMetallic(t){this.E_y[0]=Math.min(Math.max(t,.05),1)}getMetallic(){return this.E_y[0]}setRoughness(t){this.E_y[1]=Math.min(Math.max(t,.05),1)}getRoughness(){return this.E_y[1]}setAO(t){this.E_y[2]=t}getAO(){return this.E_y[2]}setF0(t,e,s){this.EJ[0]=t,this.EJ[1]=e,this.EJ[2]=s}getF0(t){t.r=this.EJ[0],t.g=this.EJ[1],t.b=this.EJ[2]}setAlbedoColor(t,e,s){this.EJ[4]=t,this.EJ[5]=e,this.EJ[6]=s}getAlbedoColor(t){t.r=this.EJ[4],t.g=this.EJ[5],t.b=this.EJ[6]}setParallaxParams(t=1,e=10,s=2,i=.1){null!=this.EG&&(this.EG[0]=t,this.EG[1]=e,this.EG[2]=s,this.EG[3]=i)}createSelfUniformData(){let t=new r.default;return t.uniformNameList=["u_pbrParams","u_fragLocalParams","u_mirrorParams"],t.dataList=[this.E_y,this.EJ,this.E_z],null!=this.vertUniform&&this.vertUniform.buildShaderUniformData(t),t}destroy(){this.vertUniform=null,this.E_y=null,this.EJ=null,this.E_z=null,super.destroy()}}e.default=m},cfaf:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("8d98"),r=i(s("0851"));class n extends r.default{constructor(t,e,s=!1){super(t,e,s),this.n=a.TextureProxyType.RTT,this.minFilter=a.TextureConst.NEAREST,this.magFilter=a.TextureConst.NEAREST}to2DTexture(){this.k=a.TextureTarget.TEXTURE_2D}enableMipmap(){this.minFilter=a.TextureConst.LINEAR_MIPMAP_LINEAR,this.magFilter=a.TextureConst.LINEAR,this.mipmapEnabled=!0}disableMipmap(){this.minFilter=a.TextureConst.NEAREST,this.magFilter=a.TextureConst.NEAREST,this.mipmapEnabled=!1}toCubeTexture(){this.k=a.TextureTarget.TEXTURE_CUBE}setSize(t,e){this.g=t,this.h=e}uploadFromFbo(t,e,s){let i=t.getRC(),r=this.mipmapEnabled;this.mipmapEnabled=!1,t.hasResUid(this.getResUid())?this.getBufWidth()==e&&this.getBufHeight()==s||(t.bindToGpu(this.getResUid()),this.bindTexture(i,e,s),this.g=e,this.h=s,this.__$buildParam(i)):(this.l=a.TextureTarget.GetValue(i,this.k),this.createTexBuf(t),t.bindToGpu(this.getResUid()),this.bindTexture(i,e,s),this.m=!0,this.g=e,this.h=s,this.__$buildParam(i)),this.mipmapEnabled=r}bindTexture(t,e,s){let i=a.TextureFormat.ToGL(t,this.internalFormat),r=a.TextureFormat.ToGL(t,this.srcFormat),n=a.TextureDataType.ToGL(t,this.dataType);switch(this.k){case a.TextureTarget.TEXTURE_2D:t.texImage2D(t.TEXTURE_2D,0,i,e,s,0,r,n,null);break;case a.TextureTarget.TEXTURE_CUBE:for(let a=0;a<6;++a)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,i,e,s,0,r,n,null);break;case a.TextureTarget.TEXTURE_SHADOW_2D:t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT16,e,s,0,t.DEPTH_COMPONENT,t.FLOAT,null);break;default:break}}toString(){return"[RTTTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},d1a0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("6e01"));class r{static PlaneCalcIntersectSphere(t,e,s,i){r.IntersectBoo=!1,r.IntersectSatus=0,e=t.dot(s)-e,e>a.default.MATH_MIN_POSITIVE?(r.IntersectBoo=e<=i,r.IntersectSatus=1):e<a.default.MATH_MAX_NEGATIVE&&(r.IntersectBoo=-e<=i,r.IntersectSatus=-1)}static CalcPVCloseV(t,e,s,i){let a=e-s.dot(t);i.setTo(a*t.x,a*t.y,a*t.z),i.addBy(s)}static CalcPVCloseV2(t,e,s,i){let a=e-s.dot(t);i.setTo(a*t.x,a*t.y,a*t.z),i.addBy(s)}static IntersectionSLV2(t,e,s,i,r){let n=t.dot(i);if(n>a.default.MATH_MIN_POSITIVE||n<a.default.MATH_MAX_NEGATIVE){let a=t.dot(s)-e;return r.x=1e5*i.x+s.x,r.y=1e5*i.y+s.y,r.z=1e5*i.z+s.z,n=t.dot(r)-e,n=a/(a-n),r.subtractBy(s),r.scaleBy(n),r.addBy(s),1}return n=t.dot(s)-e,n<=a.default.MATH_MIN_POSITIVE||n>=a.default.MATH_MAX_NEGATIVE?(r.copyFrom(s),2):0}}r.IntersectBoo=!1,r.IntersectSatus=0,e.default=r},d314:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("8d98"),r=i(s("0851"));class n extends r.default{constructor(t,e){super(t,e,!1),this.B_n=null,this.k=a.TextureTarget.TEXTURE_CUBE,this.n=a.TextureProxyType.ImageCube,this.internalFormat=a.TextureFormat.RGBA,this.srcFormat=a.TextureFormat.RGBA,this.dataType=a.TextureDataType.UNSIGNED_BYTE,this.mipmapEnabled=!0}setDataFromImageToFaceAt(t,e,s=0){null!=e&&(null==this.B_n&&(this.B_n=[null,null,null,null,null,null]),e.width>0&&e.height>0&&(0==t&&(this.g=e.width,this.h=e.height,this.f=s),this.B_n[t]={imgData:e,miplevel:s},this.m=null!=this.B_n[t]))}uploadData(t){let e=t.getRC(),s=null;for(let i=0;i<6;++i)s=this.B_n[i],e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,this.f,a.TextureFormat.ToGL(e,this.internalFormat),a.TextureFormat.ToGL(e,this.srcFormat),a.TextureDataType.ToGL(e,this.dataType),s.imgData)}toString(){return"[ImageCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.B_n)for(let t=0;t<6;++t)null!=this.B_n[t]&&(this.B_n[t].imgData=null);super.__$destroy()}}}e.default=n},d53d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uns="",this.program=null,this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataSizeList=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,s=e.length;for(let i=0;i<s;++i)if(t==e[i])return this.dataList[i]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let s=this.uniformNameList,i=s.length;for(let a=0;a<i;++a)if(t==s[a]){this.dataList[a]=e;break}}}copyDataFromProbe(t){this.types=[],this.dataSizeList=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]),this.dataSizeList.push(t.dataSizeList[e]);this.uniformSize=t.uniformsTotal}useByLocation(t,e,s,i){}useByShd(t,e){}use(t){}updateData(){}destroy(){}}e.ShaderUniform=i;class a extends i{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV1(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e])}useByLocation(t,e,s,i){t.useUniformV1(s,e,this.dataList[i],this.dataSizeList[i])}useByShd(t,e){let s=0;for(;s<this.uniformSize;++s)t.useUniformV1(e.getUniformLocationByNS(this.uniformNameList[s]),this.types[s],this.dataList[s],this.dataSizeList[s])}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let s=0;s<t;++s)e=this.calcModels[s],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null}}e.ShaderUniformV1=a;class r extends i{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV2(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e],0)}useByLocation(t,e,s,i){t.useUniformV2(s,e,this.dataList[i],this.dataSizeList[i],0)}useByShd(t,e){let s=0;for(;s<this.uniformSize;++s)t.useUniformV2(e.getUniformLocationByNS(this.uniformNameList[s]),this.types[s],this.dataList[s],this.dataSizeList[s],0)}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let s=0;s<t;++s)e=this.calcModels[s],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null,this.program=null}}e.ShaderUniformV2=r;class n extends i{constructor(){super()}use(t){t.useUniformMat4(this.locations[0],this.dataList[0])}useByLocation(t,e,s,i){t.useUniformMat4(s,this.dataList[0])}useByShd(t,e){t.useUniformMat4(e.getUniformLocationByNS(this.uniformNameList[0]),this.dataList[0])}destroy(){this.dataList[0]=null,this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null}}e.ShaderMat4Uniform=n,e.default=i},d7e2:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17"));class r{constructor(t){this.Aj=null,this.Aj=t}sortRODisplay(t,e){let s=this.Aj.getCamera().getPosition();for(let i=0;i<e;++i)t[i].value=-a.default.DistanceSquared(t[i].bounds.center,s);return 0}}e.default=r},d846:function(t,e,s){"use strict";s.r(e),s.d(e,"VSMShaderCode",(function(){return r}));var i="vec4 pack2HalfToRGBA( vec2 v ) {\r\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\r\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\r\n}\r\nvec2 unpackRGBATo2Half( vec4 v ) {\r\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\r\n}\r\n\r\nvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\r\n\r\n    return unpackRGBATo2Half( VOX_Texture2D( shadow, uv ) );\r\n\r\n}\r\n#ifdef VOX_USE_SHADOW\r\nfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ) {\r\n\r\n    float occlusion = 1.0;\r\n\r\n    vec2 distribution = texture2DDistribution( shadow, uv );\r\n\r\n    float hard_shadow = step( compare , distribution.x ); // Hard Shadow\r\n\r\n    if (hard_shadow != 1.0 ) {\r\n\r\n        float distance = compare - distribution.x ;\r\n        float variance = max( 0.0, distribution.y * distribution.y );\r\n        float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\r\n        softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\r\n        occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\r\n\r\n    }\r\n    return occlusion;\r\n\r\n}\r\nfloat getVSMShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\r\n\r\n    //float shadow = 1.0;\r\n    \r\n    shadowCoord.xyz /= shadowCoord.w;\r\n    shadowCoord.z += shadowBias;\r\n    \r\n    // if ( something && something ) breaks ATI OpenGL shader compiler\r\n    // if ( all( something, something ) ) using this instead\r\n\r\n    bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\r\n    bool inFrustum = all( inFrustumVec );\r\n\r\n    bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\r\n\r\n    bool frustumTest = all( frustumTestVec );\r\n\r\n    return frustumTest ? VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z ) : 1.0;\r\n    // if ( frustumTest ) {\r\n    //     shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\r\n    // }\r\n    // return shadow;\r\n}\r\nfloat getVSMShadowFactor(in vec4 shadowPos) {\r\n    \r\n    float shadow = getVSMShadow( VOX_VSM_SHADOW_MAP, u_vsmParams[1].xy, u_vsmParams[0].x, u_vsmParams[0].z, shadowPos );\r\n    float shadowIntensity = 1.0 - u_vsmParams[0].w;\r\n    shadow = clamp(shadow, 0.0, 1.0) * (1.0 - shadowIntensity) + shadowIntensity;\r\n    float f = clamp(dot(worldNormal,u_vsmParams[2].xyz),0.001,1.0);\r\n    shadow = f > 0.0001 ? min(shadow,clamp(f, shadowIntensity,1.0)) : shadowIntensity;\r\n    f = u_vsmParams[1].z;\r\n    return shadow * (1.0 - f) + f;\r\n}\r\nvoid useVSMShadow(inout vec4 color) {\r\n    \r\n    float factor = getVSMShadowFactor(v_shadowPos);\r\n    color.xyz *= vec3(factor);\r\n}\r\n#endif";let a="\nvoid calcShadowPos(in vec4 wpos) {\n    v_shadowPos = u_shadowMat * wpos;\n}\n";const r={vert:"",vert_head:a,vert_body:"\n#ifdef VOX_USE_SHADOW\n    // if use real worldPosition , it maybe make shadow calculation error.\n    calcShadowPos( oWorldPosition );\n#endif\n",frag:"",frag_head:i,frag_body:"\n#ifdef VOX_USE_SHADOW\nuseVSMShadow( FragColor0 );\n#endif\n"}},d958:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("11e6")),r=i(s("36cb")),n=i(s("c497")),h=i(s("3c81")),l=i(s("1e15")),o=i(s("0e01")),_=s("eca0"),m=i(s("442e")),u=i(s("1264"));class d{constructor(){this.___$$$$$$$Author="VilyLei(vily313@126.com)",this.T=-1,this.E_0=null,this.E_1=[],this.E_2=0,this.E_3=[],this.E_4=0,this.d=null,this.f_=null,this.AY=null,this.E_5=null,this.Be=!0,this.E_6=!0,this.AX=new _.RPOUnitBuilder,this.Bc=new m.default,this.AZ=new h.default,this.BL=null,this.A_h=null,this.E_7=null,this.T=d.F_j++,this.E_5=new o.default(this.T)}__$setStage3D(t){null!=t&&null==this.A_h&&(this.A_h=t)}getUid(){return this.T}getRCUid(){return this.T}getRPONodeBuilder(){return this.Bc}getDataBuilder(){return this.AY}getRendererContext(){return this.E_5}getRenderProxy(){return null!=this.d||(this.d=this.E_5.getRenderProxy()),this.d}getStage3D(){return this.d.getStage3D()}getViewX(){return this.f_.getViewportX()}getViewY(){return this.f_.getViewportY()}getViewWidth(){return this.f_.getViewportWidth()}getViewHeight(){return this.f_.getViewportHeight()}getCamera(){return this.E_5.getCamera()}createCamera(){return null}useCamera(t,e=!1){}useMainCamera(){}updateCamera(){null!=this.d&&this.d.updateCamera()}initialize(t=null,e=null){null==this.AY&&null!=e&&(null==t&&(t=new n.default),this.Be=t.batchEnabled,this.E_6=t.processFixedState,this.d=this.E_5.getRenderProxy(),this.AY=new r.default,this.BL=new l.default,this.E_5.setCameraParam(t.camProjParam.x,t.camProjParam.y,t.camProjParam.z),this.E_5.initialize(t,e,this.A_h,this.AY,this.BL),this.f_=this.d.getRenderAdapter(),this.T=this.d.getUid(),this.AY.initialize(this.d,this.AX,this.AZ,this.BL),this.E_5.initManager(this.AY),this.E_0=new u.default(this.T,this.AY,this.AX,this.AZ),this.E_7=this.createSeparatedProcess(),this.appendProcess(this.Be,this.E_6))}getRendererStatus(){return this.E_0.version}update(){this.d.Texture.update(),this.d.Vertex.update(),this.E_0.update()}updateAllProcess(){for(let t=0;t<this.E_2;++t)this.E_1[t].update()}updateProcessAt(t){t>-1&&t<this.E_2&&this.E_1[t].update()}setEntityManaListener(t){this.E_0.setListener(t)}addEntity(t,e=0,s=!0){null!=t&&t.__$testRendererEnabled()&&e>-1&&e<this.E_2&&this.E_0.addEntity(t,this.E_1[e].getUid(),s)}addEntityToProcess(t,e,s=!0){null!=e&&null!=t&&t.__$testRendererEnabled()&&e.getRCUid()==this.T&&this.E_0.addEntity(t,e.getUid(),s)}moveEntityToProcessAt(t,e){if(null!=t&&t.getRendererUid()==this.T&&t.isInRendererProcess()&&e>-1&&e<this.E_2){let s=t.getDisplay().__$$runit.getRPROUid(),i=this.AZ.getNodeByUid(s),r=this.E_1[e];i!=r&&(i.removeDispUnit(t.getDisplay()),t.__$rseFlag=r.getSortEnabled()?a.default.AddSortEnabled(t.__$rseFlag):a.default.RemoveSortEnabled(t.__$rseFlag),r.addDisp(t.getDisplay()))}}moveEntityToProcess(t,e){if(null!=e&&null!=t&&t.getRendererUid()==this.T&&t.isInRendererProcess()){let s=t.getDisplay().__$$runit.getRPROUid(),i=this.AZ.getNodeByUid(s);if(i!=e){let s=e;i.removeDispUnit(t.getDisplay()),t.__$rseFlag=e.getSortEnabled()?a.default.AddSortEnabled(t.__$rseFlag):a.default.RemoveSortEnabled(t.__$rseFlag),s.addDisp(t.getDisplay())}}}removeEntity(t){null!=t&&t.getRendererUid()==this.T&&(this.E_0.removeEntity(t),t.__$setRenderProxy(null))}removeEntityFromProcess(t,e){null!=e&&e.getRCUid()==this.T&&null!=t&&t.getRendererUid()==this.T&&(e.removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}removeEntityByProcessIndex(t,e){e>=0&&e<this.E_2&&null!=t&&t.getRendererUid()==this.T&&(this.E_1[e].removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}setProcessSortEnabledAt(t,e){t>=0&&t<this.E_2&&this.E_1[t].setSortEnabled(e)}setProcessSortEnabled(t,e){if(null!=t&&t.getRCUid()==this.T){let s=t;s.setSortEnabled(e)}}getRenderProcessAt(t){return this.E_1[t]}appendProcess(t=!0,e=!1){this.AZ.setCreateParams(this.AY.getRenderShader(),this.Bc,this.AX,this.d.Vertex,t,e);let s=this.AZ.create();return this.E_1.push(s),s.setRendererParam(this.d,this.E_2),++this.E_2,s}createSeparatedProcess(t=!0,e=!1){this.AZ.setCreateParams(this.AY.getRenderShader(),this.Bc,this.AX,this.d.Vertex,t,e);let s=this.AZ.create();return this.E_3.push(s),s.setRendererParam(this.d,this.E_4),s}setRendererProcessParam(t,e,s){t>-1&&t<this.E_2&&this.E_1[t].setRenderParam(e,s)}getProcessAt(t){return t>-1&&t<this.E_2?this.E_1[t]:null}showInfoAt(t){t>-1&&t<this.E_2&&this.E_1[t].showInfo()}getProcessesTotal(){return this.E_2}updateMaterialUniformToCurrentShd(t){this.AY.getRenderShader().useUniformToCurrentShd(t.__$uniform)}drawEntityByLockMaterial(t,e=!1,s=!0){null!=t&&t.getVisible()&&t.getRendererUid()==this.T&&!this.d.isContextLost()&&this.E_7.drawLockMaterialByDisp(t.getDisplay(),e,s)}drawEntity(t,e=!1,s=!0){null!=t&&t.getVisible()&&!this.d.isContextLost()&&(t.getRendererUid()==this.T?this.E_7.drawDisp(t.getDisplay(),e,s):t.__$testRendererEnabled()&&this.E_0.addEntity(t,this.E_7.getUid(),!1))}runAt(t){this.d.isContextLost()||this.E_1[t].run()}runProcess(t){t.getRCUid()!=this.T||this.d.isContextLost()||t.run()}runFromIndexTo(t){if(!this.d.isContextLost())for(let e=t;e<this.E_2;++e)this.E_1[e].run()}run(){if(this.E_0.isHaveEntity()&&!this.d.isContextLost())for(let t=0;t<this.E_2;++t)this.E_1[t].run()}getRenderUnitsTotal(){let t=0;for(let e=0;e<this.E_2;++e)t+=this.E_1[e].getUnitsTotal();return t}renderflush(){this.d.flush()}toString(){return"[RendererInstance(uid = "+this.T+")]"}}d.F_j=0,e.RendererInstance=d,e.default=d},da6a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){if(this.u_=null,this.E_8=null,this.E_9=0,this.E_=new Map,this.C7=new Map,this.FA=0,this.FB=[],null!=i.F_n)throw Error("This Class is a singleton class!!!");i.F_n=null}static GetInstance(){return null!=i.F_n||(i.F_n=new i),i.F_n}getFreeUid(){if(this.FB.length>0)return this.FB.pop();let t=this.FA++;return t}__$$addTexture(t){null==t||this.E_.has(t.getUid())||(this.E_.set(t.getUid(),t),this.E_9++)}getTextureByUid(t){return this.E_.get(t)}hasTextureByUid(t){return this.E_.has(t)}removeTextureByUid(t){if(this.E_.has(t)){let e=this.E_.get(t);if(e.getAttachCount()<1)return this.C7.has(t)&&this.C7.delete(t),e.__$destroy(),e.__$$removeFromSlot(),this.E_.delete(t),this.FB.push(t),this.E_9--,e}return null}getTextureTotal(){return this.E_9}setRenderProxy(t){this.u_=t.Texture}setBufferUpdater(t){this.E_8=t}getFreeResUidMap(){return this.C7}isGpuEnabledByResUid(t){return this.u_.hasResUid(t)}addRenderBuffer(t,e){null!=this.E_8&&this.E_8.__$addBuf(t,e)}addFreeUid(t){this.C7.set(t,0)}removeFreeUid(t){this.C7.has(t)&&this.C7.delete(t)}}i.F_n=null,e.default=i},da82:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("f444")),r=i(s("a46e")),n=i(s("8e17")),h=i(s("53ea"));class l{constructor(){this.Al=null,this.stageDragCtrl=new a.default,this.cameraZoomController=new r.default,this.zoomLookAtPosition=null,this.zoomMinDistance=30,this.viewRay=new h.default,this.cameraCtrlEnabled=!0}initialize(t){null==this.Al&&(this.Al=t,this.viewRay.bindCameraAndStage(t.getCamera(),t.getStage3D()),this.viewRay.setPlaneParam(new n.default(0,1,0),0),t.enableMouseEvent(!0),this.stageDragCtrl.initialize(t.getStage3D(),t.getCamera()),this.cameraZoomController.bindCamera(t.getCamera()),this.cameraZoomController.initialize(t.getStage3D()),this.cameraZoomController.setLookAtCtrlEnabled(!1))}run(){this.cameraCtrlEnabled&&(this.cameraZoomController.run(this.zoomLookAtPosition,this.zoomMinDistance),this.stageDragCtrl.runWithYAxis())}}e.UserInteraction=l},dc2b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("e08e"),r=i(s("29ef"));class n{constructor(){this.T=0,this.A0=null,this.FC=null,this.name="RODisplay",this.visible=!0,this.ivsIndex=0,this.ivsCount=0,this.trisNumber=0,this.insCount=0,this.drawMode=a.RenderDrawMode.ELEMENTS_TRIANGLES,this.vbuf=null,this.renderState=r.default.NORMAL_STATE,this.rcolorMask=r.default.COLOR_MASK_ALL_TRUE,this.mouseEnabled=!1,this.FD=null,this.FE=null,this.__$ruid=-1,this.__$rpuid=-1,this.__$$rsign=a.DisplayRenderSign.NOT_IN_RENDERER,this.__$$runit=null,this.T=n.F_j++}getPartGroup(){return this.FD}createPartGroup(t){t<1&&(t=1),this.FD=new Uint16Array(2*t)}setDrawPartAt(t,e,s){t*=2,this.FD[t]=s,this.FD[++t]=e}getUid(){return this.T}setTransform(t){this.FE=t,this.FC=t.getLocalFS32()}getTransform(){return this.FE}getMatrixFS32(){return this.FC}enableDrawInstanced(t,e){this.drawMode=a.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES,this.ivsIndex=t,this.insCount=e}disableDrawInstanced(){this.drawMode=a.RenderDrawMode.ELEMENTS_TRIANGLES}getMaterial(){return this.A0}setMaterial(t){null!=this.A0&&this.A0!=t&&(this.A0.__$detachThis(),null!=t&&t.__$attachThis()),this.A0=t}copyFrom(t){this.vbuf=t.vbuf,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.setMaterial(t.getMaterial())}toString(){return"RODisplay(name="+this.name+",uid="+this.getUid()+", __$ruid="+this.__$ruid+")"}destroy(){null!=this.A0&&(this.A0.__$detachThis(),this.A0.destroy(),this.A0=null),this.FC=null,this.vbuf=null,this.__$ruid=-1,this.__$rpuid=-1,this.__$$rsign=a.DisplayRenderSign.NOT_IN_RENDERER,this.ivsIndex=0,this.ivsCount=0,this.FD=null,this.__$$runit=null}static GetFreeId(){return n.X_.length>0?n.X_.pop():-1}static GetByUid(t){return n.Y_[t]}static IsEnabledByUid(t){return n.Z_[t]==n.S_FLAG_BUSY}static Create(){let t=null,e=n.GetFreeId();return e>=0?(t=n.Y_[e],n.Z_[e]=n.S_FLAG_BUSY):(t=new n,n.Y_.push(t),n.Z_.push(n.S_FLAG_BUSY),n.a_++),t}static Restore(t){if(null!=t&&n.Z_[t.getUid()]==n.S_FLAG_BUSY){let e=t.getUid();n.X_.push(e),n.Z_[e]=n.S_FLAG_FREE,t.destroy()}}}n.F_j=0,n.S_FLAG_BUSY=1,n.S_FLAG_FREE=0,n.Z_=[],n.a_=0,n.Y_=[],n.X_=[],e.default=n},de9d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("722e")),r=i(s("8333")),n=i(s("6e01")),h=i(s("8e17")),l=s("7c63"),o=i(s("090c")),_=i(s("1216")),m=i(s("56c5")),u=i(s("030e")),d=i(s("74c3")),c=i(s("984e")),f=i(s("29ef")),p=i(s("3077"));class g{constructor(t){this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.RState=null,this.Vertex=null,this.Texture=null,this.VtxBufUpdater=null,this.MaterialUpdater=null,this.adapter=null,this.T=0,this.FF=null,this.f_=null,this.FG=new o.default,this.Aj=null,this.Cs=!0,this.B=0,this.C=0,this.D=800,this.E=600,this.h_=.1,this.i_=5e3,this.j_=45,this.D_=2,this.FH=2,this.A_i=null,this.FI=!1,this.FJ=!0,this.FK=!0,this.T=t}getRC(){return this.Aj}getUid(){return this.T}getRCUid(){return this.T}isAutoSynViewAndStage(){return this.FJ}enableSynViewAndStage(){this.FJ=!0}lockViewport(){this.f_.lockViewport()}unlockViewport(){this.f_.unlockViewport()}getDiv(){return this.f_.getDiv()}getCanvas(){return this.f_.getCanvas()}cameraLock(){this.A_i.lock()}cameraUnlock(){this.A_i.unlock()}getCamera(){return this.A_i}updateCamera(){return this.A_i.update()}createCameraUBO(t){}updateCameraDataFromCamera(t){null!=t&&(this.FI||t!=this.A_i)&&(this.FI=t!=this.A_i,t.updateCamMatToUProbe(this.A_i.matUProbe),null!=this.FF&&(this.FF.setSubDataArrAt(0,t.matUProbe.getFS32At(0)),this.FF.setSubDataArrAt(16,t.matUProbe.getFS32At(1))))}useCameraData(){null!=this.FF&&this.FF.run()}getActiveAttachmentTotal(){return this.f_.getActiveAttachmentTotal()}drawInstanced(t,e,s){2==this.FH?this.Aj.drawElementsInstanced(this.TRIANGLES,t,this.UNSIGNED_SHORT,e,s):u.default.ANGLE_instanced_arrays.drawElementsInstancedANGLE(this.TRIANGLES,t,e,s)}createUBOBufferByBytesCount(t){let e=this.Aj.createBuffer();return this.Aj.bindBuffer(this.Aj.UNIFORM_BUFFER,e),this.Aj.bufferData(this.Aj.UNIFORM_BUFFER,t,this.Aj.DYNAMIC_DRAW),e}createUBOBufferByDataArray(t){let e=this.Aj.createBuffer();return this.Aj.bindBuffer(this.Aj.UNIFORM_BUFFER,e),this.Aj.bufferData(this.Aj.UNIFORM_BUFFER,t,this.Aj.DYNAMIC_DRAW),e}bindUBOBuffer(t){this.Aj.bindBuffer(this.Aj.UNIFORM_BUFFER,t)}deleteUBOBuffer(t){this.Aj.deleteBuffer(t)}bufferDataUBOBuffer(t){this.Aj.bufferData(this.Aj.UNIFORM_BUFFER,t,this.Aj.STATIC_DRAW)}bindBufferBaseUBOBuffer(t,e){this.Aj.bindBufferBase(this.Aj.UNIFORM_BUFFER,t,e)}setWebGLMaxVersion(t){1!=t&&2!=t||(this.D_=t)}getContext(){return this.FG}getStage3D(){return this.FG.getStage()}getRenderAdapter(){return this.f_}getRenderContext(){return this.f_.getRenderContext()}setCameraParam(t,e,s){this.j_=t,this.h_=e,this.i_=s}getMouseXYWorldRay(t,e){let s=this.FG.getStage();this.A_i.getWorldPickingRayByScreenXY(s.mouseX,s.mouseY,t,e)}testViewPortChanged(t,e,s,i){return this.B!=t||this.C!=e||this.D!=s||this.E!=i}testRCViewPortChanged(t,e,s,i){return this.FG.testViewPortChanged(t,e,s,i)}getViewX(){return this.B}getViewY(){return this.C}getViewWidth(){return this.D}getViewHeight(){return this.E}setViewPort(t,e,s,i){this.FJ=!1,this.B=t,this.C=e,this.D=s,this.E=i;let a=this.FG.getStage();null!=a&&(a.setViewPort(s,e,s,i),null!=this.A_i&&(this.A_i.setViewXY(this.B,this.C),this.A_i.setViewSize(this.D,this.E))),this.FG.setViewport(this.B,this.C,this.D,this.E)}setRCViewPort(t,e,s,i,a=!1){this.FJ=a,this.FG.setViewport(t,e,s,i)}reseizeRCViewPort(){this.f_.unlockViewport(),this.f_.reseizeViewPort()}resizeCallback(){this.FJ&&(this.B=0,this.C=0,this.D=this.FG.getRCanvasWidth(),this.E=this.FG.getRCanvasHeight(),this.createMainCamera(),this.FG.setViewport(this.B,this.C,this.D,this.E),this.A_i.setViewXY(this.B,this.C),this.A_i.setViewSize(this.D,this.E))}createMainCamera(){this.FK&&(this.FK=!1,this.A_i.uniformEnabled=!0,this.Cs?this.A_i.perspectiveRH(n.default.DegreeToRadian(this.j_),this.D/this.E,this.h_,this.i_):this.A_i.orthoRH(this.h_,this.i_,-.5*this.E,.5*this.E,-.5*this.D,.5*this.D),this.A_i.setViewXY(this.B,this.C),this.A_i.setViewSize(this.D,this.E))}readPixels(t,e,s,i,a,r,n){this.f_.readPixels(t,e,s,i,a,r,n)}getGLVersion(){return this.FH}initialize(t,e,s,i,n,l){if(null!=this.Aj)return;this.A_i=e,null==e.matUProbe&&(e.matUProbe=new p.default,e.matUProbe.bindSlotAt(this.T),e.matUProbe.addMat4Data(new Float32Array(16),1),e.matUProbe.addMat4Data(new Float32Array(16),1)),null==e.ufrustumProbe&&(e.ufrustumProbe=new p.default,e.ufrustumProbe.bindSlotAt(this.T),e.ufrustumProbe.addVec4Data(new Float32Array([e.getZNear(),e.getZFar(),.5*e.getNearPlaneWidth(),.5*e.getNearPlaneHeight()]),1)),null==e.ucameraPosProbe&&(e.ucameraPosProbe=new p.default,e.ucameraPosProbe.bindSlotAt(this.T),e.ucameraPosProbe.addVec4Data(new Float32Array([500,500,500,1]),1));let o=t.camPosition,g=t.camLookAtPos,v=t.camUpDirect;null==o&&(o=new h.default(500,500,500)),null==g&&(g=new h.default(0,0,0)),null==v&&(v=new h.default(0,1,0)),this.Cs=t.cameraPerspectiveEnabled,this.FG.autoSyncRenderBufferAndWindowSize=t.autoSyncRenderBufferAndWindowSize,this.FG.setResizeCallback(this,this.resizeCallback),this.FG.setWebGLMaxVersion(this.D_),this.FG.initialize(this.T,s,t.getDiv(),t.getRenderContextAttri()),this.FH=this.FG.getWebGLVersion(),this.Aj=this.FG.getRC(),f.default.Initialize(),f.default.Rstate.setRenderContext(this.FG);let x=this,T=this.Aj,E=new d.default(this.T,T,l),y=new c.default(this.T,T);if(this.BM=E,x.Vertex=E,x.Texture=y,x.MaterialUpdater=i,x.VtxBufUpdater=n,this.D=this.FG.getViewportWidth(),this.E=this.FG.getViewportHeight(),this.f_=new _.default(this.T,y),this.f_.initialize(this.FG,t,f.default.Rstate),x.adapter=this.f_,this.FJ){let t=this.FG.getStage();null!=t&&(this.D=t.stageWidth,this.E=t.stageHeight)}this.createMainCamera(),this.FG.setViewport(this.B,this.C,this.D,this.E),this.A_i.lookAtRH(o,g,v),this.A_i.update(),this.f_.bgColor.setRGB3f(0,0,0),x.RGBA=T.RGBA,x.UNSIGNED_BYTE=T.UNSIGNED_BYTE,x.TRIANGLE_STRIP=T.TRIANGLE_STRIP,x.TRIANGLE_FAN=T.TRIANGLE_FAN,x.TRIANGLES=T.TRIANGLES,x.LINES=this.Aj.LINES,x.LINE_STRIP=T.LINE_STRIP,x.UNSIGNED_SHORT=T.UNSIGNED_SHORT,x.UNSIGNED_INT=T.UNSIGNED_INT,x.COLOR=T.COLOR,x.DEPTH=T.DEPTH,x.STENCIL=T.STENCIL,x.DEPTH_STENCIL=T.DEPTH_STENCIL,this.FH>1?(x.MIN=T.MIN,x.MAX=T.MAX):(x.MIN=u.default.EXT_blend_minmax.MIN_EXT,x.MAX=u.default.EXT_blend_minmax.MAX_EXT);let S=a.default;S.NEAREST=T.NEAREST,S.LINEAR=T.LINEAR,S.LINEAR_MIPMAP_LINEAR=T.LINEAR_MIPMAP_LINEAR,S.NEAREST_MIPMAP_NEAREST=T.NEAREST_MIPMAP_NEAREST,S.LINEAR_MIPMAP_NEAREST=T.LINEAR_MIPMAP_NEAREST,S.NEAREST_MIPMAP_LINEAR=T.NEAREST_MIPMAP_LINEAR;let b=r.default;b.COLOR_BUFFER_BIT=T.COLOR_BUFFER_BIT,b.DEPTH_BUFFER_BIT=T.DEPTH_BUFFER_BIT,b.STENCIL_BUFFER_BIT=T.STENCIL_BUFFER_BIT,m.default.SetRenderer(this.FG),x.RState=f.default.Rstate,x.RContext=this.Aj}flush(){this.Aj.flush()}setClearRGBColor3f(t,e,s){this.f_.bgColor.setRGB3f(t,e,s)}setClearColor(t){this.f_.bgColor.copyFrom(t)}setClearUint24Color(t,e){this.f_.bgColor.setRGBUint24(t),this.f_.bgColor.a=e}setClearRGBAColor4f(t,e,s,i){this.f_.bgColor.setRGBA4f(t,e,s,i)}getClearRGBAColor4f(t){t.copyFrom(this.f_.bgColor)}getViewportWidth(){return this.f_.getViewportWidth()}getViewportHeight(){return this.f_.getViewportHeight()}setRenderToBackBuffer(){this.f_.setRenderToBackBuffer()}clearBackBuffer(){this.f_.clear()}renderBegin(){this.A_i.update(),this.f_.renderBegin()}renderEnd(){}useRenderStateByName(t){l.RenderStateObject.UseRenderStateByName(t)}setScissorEnabled(t){this.FG.setScissorEnabled(t)}setScissorRect(t,e,s,i){this.FG.setScissorRect(t,e,s,i)}useRenderColorMask(t){l.RenderColorMask.UseRenderState(t)}unlockRenderColorMask(){l.RenderColorMask.Unlock()}lockRenderColorMask(){l.RenderColorMask.Lock()}useRenderState(t){l.RenderStateObject.UseRenderState(t)}unlockRenderState(){l.RenderStateObject.Unlock()}lockRenderState(){l.RenderStateObject.Lock()}setVtxUpdateTimesTotal(t){this.BM.setVtxUpdateTimesTotal(t)}setFrontFaceFlipped(t){this.f_.setFrontFaceFlipped(t)}enabledPolygonOffset(){this.f_.enabledPolygonOffset()}disabledPolygonOffset(){this.f_.disabledPolygonOffset()}setPolygonOffset(t,e=0){this.f_.setPolygonOffset(t,e)}resetPolygonOffset(){this.f_.resetPolygonOffset()}loseContext(){this.f_.loseContext()}isContextLost(){return this.f_.isContextLost()}setViewProbeValue(t,e,s,i){this.f_.setViewProbeValue(t,e,s,i)}toString(){return"[Object RenderProxy()]"}}e.default=g},debe:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("3221");class a extends i.UniformComp{constructor(){super(),this.FL=null,this.FM=null,this.FN=null,this.FO=-1,this.FP=-1,this.FQ=-1,this.uvTransformEnabled=!1,this.curveMoveMap=null,this.displacementMap=null}initialize(){if(null==this.A_w){this.A_s="";let t=0;if(this.uvTransformEnabled&&(this.FO=t,t++,this.A_s+="UV"),null!=this.curveMoveMap&&(this.FP=t,t++,this.A_s+="CM"),null!=this.displacementMap&&(this.FQ=t,t++,this.A_s+="DC"),t>0){this.A_w=new Float32Array(4*t);let e=this.FO;e>=0&&(this.FL=this.A_w.subarray(4*e,4*(e+1)),this.FL.set([1,1,0,0])),e=this.FP,e>=0&&(this.FM=this.A_w.subarray(4*e,4*(e+1))),e=this.FQ,e>=0&&(this.FN=this.A_w.subarray(4*e,4*(e+1)),this.FN.set([10,0,0,0]))}}}use(t){this.getParamsTotal()>0&&(t.addVertUniform("vec4","u_vertLocalParams",this.getParamsTotal()),this.FP>=0&&t.addVertLayout("vec4","a_vs"),this.FO>=0&&t.addDefine("VOX_VTX_TRANSFORM_PARAM_INDEX",""+this.FO))}reset(){}destroy(){}getTextures(t,e=null){return this.getParamsTotal()>0?(null==e&&(e=[]),this.FP>=0&&(e.push(this.curveMoveMap),t.uniform.add2DMap("VTX_CURVE_MOVE_MAP",!1,!1,!0),t.addDefine("VOX_VTX_CURVE_MOVE_PARAM_INDEX",""+this.FP)),this.FQ>=0&&(e.push(this.displacementMap),t.uniform.addDisplacementMap(this.FQ)),e):null}setCurveMoveParam(t,e){null!=this.FM&&(this.FM[0]=1/t,this.FM[2]=e)}setCurveMoveDistance(t){null!=this.FM&&(this.FM[1]=t)}setUVScale(t,e){null!=this.FL&&(this.FL[0]=t,this.FL[1]=e)}getUVScale(t){null!=this.FL&&(t.x=this.FL[0],t.y=this.FL[1])}setUVTranslation(t,e){null!=this.FL&&(this.FL[2]=t,this.FL[3]=e)}setDisplacementParams(t,e){null!=this.FN&&(this.FN[0]=t,this.FN[1]=e)}clone(){let t=new a;return t.uvTransformEnabled=this.uvTransformEnabled,t.displacementMap=this.displacementMap,t.curveMoveMap=this.curveMoveMap,t}buildShaderUniformData(t){this.getParamsTotal()>0&&(t.uniformNameList.push("u_vertLocalParams"),t.dataList.push(this.getParams()))}}e.VertUniformComp=a},df25:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("8d98"),r=i(s("68aa")),n=i(s("0851"));class h extends n.default{constructor(t,e,s=!1){super(t,e,s),this.B_1=null,this.FR=null,this.CA=0,this.B_9=null,this.B_=null,this.minFilter=a.TextureConst.LINEAR}setDataFromBytes(t,e=0,s=-1,i=-1,a=0,n=0,h=!1){if(null!=t&&s>0&&i>0){e<0&&(e=0),e>15&&(e=15),e>=this.CA&&(this.CA=e+1),this.m=!0;let l=this.B_9;null!=l?this.B_9.miplevel!=e&&(null==this.B_&&(this.B_=[this.B_9,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),l=this.B_[e],null==l&&(l=r.default.Create(),l.miplevel=e,h=!0,this.B_[e]=l)):(this.B_9=l=r.default.Create(),l.miplevel=e,h=!0),l.data==t&&l.offsetx==a&&l.offsety==n||(0==e&&(this.g=s,this.h=i,this.B_1=t),l.data=t,l.status=0,(l.width<s||l.height<i||h)&&(l.width=s,l.height=i,l.status=1),l.offsetx=a,l.offsety=n),this.version++}}uploadData(t){null!=this.B_9&&this.dataUploadToGpu(t.getRC(),this.B_9,this.B_,!0)}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())){let e=t.getRC(),s=null!=this.FR?this.FR.length:0;if(this.__$updateToGpuBegin(t),s>0){let t=0,i=null,n=a.TextureFormat.ToGL(e,this.internalFormat),h=a.TextureFormat.ToGL(e,this.srcFormat),l=a.TextureDataType.ToGL(e,this.dataType);for(;t<s;++t)i=this.FR.pop(),i.updateToGpu(e,this.l,n,h,l,!1),r.default.Restore(i)}null!=this.B_9&&(this.dataUploadToGpu(e,this.B_9,this.B_),this.__$buildParam(e),this.o=!0),this.__$updateToGpuEnd(e)}}setPartDataFromeBytes(t,e,s,i,a,n=0){null==this.FR&&(this.FR=[]);let h=r.default.Create();h.data=t,h.status=0,h.miplevel=n,h.offsetx=e,h.offsety=s,h.width=i,h.height=a,this.FR.push(h),this.version++}getPixels(t,e,s,i,r){if(null!=this.B_1&&null!=r){let n=this.unpackAlignment,h=s*i*n;if(r.length==h){let l=e,o=t,_=l+i,m=o+s,u=0;switch(this.srcFormat){case a.TextureFormat.ALPHA:for(;l<_;++l)for(o=t;o<m;++o)h=l*this.g+o,r[u]=this.B_1[h],u++;break;case a.TextureFormat.RGBA:for(;l<_;++l)for(o=t;o<m;++o)h=(l*this.g+o)*n,r[u]=this.B_1[h],r[u+1]=this.B_1[h+1],r[u+2]=this.B_1[h+2],r[u+3]=this.B_1[h+3],u++;break;case a.TextureFormat.RGB:for(;l<_;++l)for(o=t;o<m;++o)h=(l*this.g+o)*n,r[u]=this.B_1[h],r[u+1]=this.B_1[h+1],r[u+2]=this.B_1[h+2],u++;break;default:break}}}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.B_){for(let t=0;t<this.CA;++t)r.default.Restore(this.B_[t]);this.CA=0,this.B_=null,this.B_9=null}null!=this.B_9&&(r.default.Restore(this.B_9),this.B_9=null),this.B_1=null,super.__$destroy()}}toString(){return"[RawDataTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=h},df9d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.T=-1,this.A_Y=null,this.A_Z=null,this.FS=new Map,this.FT=new Map,this.FU=1,this.FV=0,this.FW=[],this.FX=[],this.FY=[],this.FZ=[],this.Fa=0,this.Fb=[],this.Fc=[],this.Fd=[],this.q_=[],this.r_=0,this.T=i.F_j++}getFreeVtxId(){return this.FY.length>0?this.FY.pop():-1}getVtxIndex(){let t=-1,e=this.getFreeVtxId();return e>=0?(t=e,this.FZ[e]=0,this.FW[e]=this.FU):(t=this.Fa,this.FZ.push(0),this.FX.push(this.FV),this.FW.push(this.FU),this.Fa++),t}restoreVtxIndex(t){this.FW[t]==this.FU&&(this.FY.push(t),this.FW[t]=this.FV,this.FZ[t]=0)}attachVtxAt(t){++this.FZ[t]}detachVtxAt(t){this.FZ[t]>0&&(--this.FZ[t],this.FZ[t]<1&&this.restoreVtxIndex(t))}getVtxTotalAt(t){return this.FZ[t]}getFreeTexId(){return this.Fd.length>0?this.Fd.pop():-1}getTexIndex(){let t=-1,e=this.getFreeTexId();return e>=0?(t=e,this.q_[e]=0,this.Fb[e]=this.FU):(t=this.r_,this.q_.push(0),this.Fc.push(this.FV),this.Fb.push(this.FU),this.r_++),t}restoreTexIndex(t){this.Fb[t]==this.FU&&(this.Fd.push(t),this.Fb[t]=this.FV,this.q_[t]=0)}attachTexAt(t){++this.q_[t]}detachTexAt(t){this.q_[t]>0&&(--this.q_[t],this.q_[t]<1&&this.restoreTexIndex(t))}getTexTotalAt(t){return this.q_[t]}destroy(){this.clear()}clear(){this.A_Y=this.A_Z=null,this.FS=new Map,this.FT=new Map,this.FW=[],this.FX=[],this.FZ=[],this.FY=[],this.Fa=0,this.Fb=[],this.Fc=[],this.q_=[],this.Fd=[],this.r_=0}getBegin(){return this.A_Y}containsNode(t){let e=this.FS.get(t.vtxUid);if(null!=e){let s=131*(31+e.rvroI);return s*=s+e.texMid,t.rtokey==s}return!1}addNodeAndSort(t){let e=this.FS.get(t.vtxUid);if(null==e){this.FS.set(t.vtxUid,t),t.rvroI=this.getVtxIndex(),this.attachVtxAt(t.rvroI);let e=131*(31+t.rvroI);e*=e+t.texMid,t.rtokey=e,t.rtroI=this.getTexIndex(),this.FT.set(e,t.rtroI),this.attachTexAt(t.rtroI)}else{t.rvroI=e.rvroI,this.attachVtxAt(t.rvroI);let s=131*(31+t.rvroI);if(s*=s+t.texMid,this.FT.has(s)?t.rtroI=this.FT.get(s):(t.rtroI=this.getTexIndex(),this.FT.set(s,t.rtroI)),t.rtokey=s,this.attachTexAt(t.rtroI),e!=this.A_Z)if(e.texMid==t.texMid)e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;else while(null!=e){if(e.vtxUid!=t.vtxUid){e=e.prev,e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.texMid==t.texMid){e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.next==this.A_Z){this.A_Z.vtxUid!=t.vtxUid?(e.next.prev=t,t.next=e.next,t.prev=e,e.next=t):e=null;break}e=e.next}else e=null}null==e&&(null==this.A_Y?this.A_Z=this.A_Y=t:null!=this.A_Z.prev?(this.A_Z.next=t,t.prev=this.A_Z,this.A_Z=t):(this.A_Y.next=t,t.prev=this.A_Z,this.A_Z=t),this.A_Z.next=null)}showInfo(){let t=this.getBegin();if(null!=t){let e="",s="",i="";while(null!=t)e+=t.vtxUid+",",s+=t.texMid+",",i+=t.ivsCount+",",t=t.next}}removeNodeAndSort(t){let e=this.FS.get(t.vtxUid);e!=t?e=null:(this.FS.set(t.vtxUid,null),null!=t.next&&t.next.vtxUid==t.vtxUid?this.FS.set(t.vtxUid,t.next):null!=t.prev&&t.prev.vtxUid==t.vtxUid?this.FS.set(t.vtxUid,t.prev):this.FS.delete(t.vtxUid)),t==this.A_Y?t==this.A_Z?this.A_Y=this.A_Z=null:(this.A_Y=t.next,this.A_Y.prev=null):t==this.A_Z?(this.A_Z=t.prev,this.A_Z.next=null):(t.next.prev=t.prev,t.prev.next=t.next),this.detachVtxAt(t.rvroI),this.detachTexAt(t.rtroI),t.prev=null,t.next=null}addNode(t){null==this.A_Y?this.A_Z=this.A_Y=t:null!=this.A_Z.prev?(this.A_Z.next=t,t.prev=this.A_Z,this.A_Z=t):(this.A_Y.next=t,t.prev=this.A_Z,this.A_Z=t),this.A_Z.next=null}removeNode(t){t==this.A_Y?t==this.A_Z?this.A_Y=this.A_Z=null:(this.A_Y=t.next,this.A_Y.prev=null):t==this.A_Z?(this.A_Z=t.prev,this.A_Z.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}i.F_j=0,e.default=i},e08e:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.ELEMENTS_TRIANGLES=1,i.ELEMENTS_TRIANGLE_STRIP=2,i.ELEMENTS_TRIANGLE_FAN=3,i.ELEMENTS_INSTANCED_TRIANGLES=4,i.ARRAYS_LINES=5,i.ARRAYS_LINE_STRIP=6,i.ARRAYS_POINTS=7,i.ELEMENTS_LINES=8,i.DISABLE=0,e.RenderDrawMode=i;class a{}a.NORMAL=1,a.OPAQUE=1,a.TRANSPARENT=2,a.ALPHA_ADD=3,a.ADD=4,a.ADD_LINEAR=5,a.INVERSE_ALPHA=6,a.BLAZE=7,a.OVERLAY=8,a.OVERLAY2=8,a.DISABLE=0,e.RenderBlendMode=a;class r{}r.NEVER=1,r.LESS=1,r.EQUAL=1,r.GREATER=1,r.NOTEQUAL=1,r.GEQUAL=1,r.ALWAYS=1,e.GLStencilFunc=r;class n{}n.KEEP=1,n.ZERO=1,n.REPLACE=1,n.INCR=1,n.INCR_WRAP=1,n.DECR=1,n.DECR_WRAP=1,n.INVERT=1,e.GLStencilOp=n;class h{}h.ZERO=1,h.ONE=1,h.SRC_COLOR=1,h.DST_COLOR=1,h.SRC_ALPHA=1,h.DST_ALPHA=1,h.ONE_MINUS_SRC_ALPHA=1,e.GLBlendMode=h;class l{}l.FUNC_ADD=1,l.FUNC_SUBTRACT=1,l.FUNC_REVERSE_SUBTRACT=1,l.MIN_EXT=1,l.MAX_EXT=1,l.MIN=1,l.MAX=1,e.GLBlendEquation=l;class o{}o.BACK=1,o.FRONT=2,o.FRONT_AND_BACK=3,o.NONE=0,o.DISABLE=0,e.CullFaceMode=o;class _{}_.NEVER=1,_.ALWAYS=2,_.SKY=3,_.TRUE_LESS_EQUAL=3,_.OPAQUE=4,_.TRUE_LESS=4,_.OPAQUE_OVERHEAD=5,_.FALSE_EQUAL=5,_.FALSE_LESS=6,_.BLEND=6,_.BLEND_SORT=6,_.TRANSPARENT_SORT=6,_.TRUE_LEQUAL=7,_.WIRE_FRAME=7,_.FALSE_LEQUAL=8,_.DECALS=8,_.NEXT_LAYER=11,_.WIRE_FRAME_NEXT=12,_.TRUE_EQUAL=13,_.TRUE_GREATER=14,_.TRUE_GEQUAL=15,_.DISABLE=0,e.DepthTestMode=_;class m{}m.SCENE_RO_FILTER_BEGIN=1<<19,m.SCENE_RO_FILTER_FINISH=2<<19,m.SCENE_RO_ERASE=0,e.RenderConst=m,function(t){t[t["NOT_IN_RENDERER"]=-1]="NOT_IN_RENDERER",t[t["GO_TO_RENDERER"]=1]="GO_TO_RENDERER",t[t["LIVE_IN_RENDERER"]=2]="LIVE_IN_RENDERER"}(e.DisplayRenderSign||(e.DisplayRenderSign={}))},e214:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("6e01")),r=i(s("8e17")),n=i(s("f48d")),h=i(s("81c4"));class l extends n.default{constructor(){super(...arguments),this.nv=new r.default(0,1,0),this.distance=0,this.intersectBoo=!1}intersectStraightLinePos(t,e){let s=this.nv.dot(t.tv);if(s>a.default.MATH_MIN_POSITIVE||s<a.default.MATH_MAX_NEGATIVE){let i=this.nv.dot(t.position)-this.distance;return e.x=1e5*t.tv.x+t.position.x,e.y=1e5*t.tv.y+t.position.y,e.z=1e5*t.tv.z+t.position.z,s=this.nv.dot(e)-this.distance,s=i/(i-s),e.subtractBy(t.position),e.scaleBy(s),e.addBy(t.position),1}return s=this.nv.dot(t.position)-this.distance,s<=a.default.MATH_MIN_POSITIVE||s>=a.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),2):0}intersectStraightLinePos2(t,e,s){let i=this.nv.dot(e);if(i>a.default.MATH_MIN_POSITIVE||i<a.default.MATH_MAX_NEGATIVE){let a=this.nv.dot(t)-this.distance;return s.x=1e5*e.x+t.x,s.y=1e5*e.y+t.y,s.z=1e5*e.z+t.z,i=this.nv.dot(s)-this.distance,i=a/(a-i),s.subtractBy(t),s.scaleBy(i),s.addBy(t),1}return i=this.nv.dot(t)-this.distance,i<=a.default.MATH_MIN_POSITIVE||i>=a.default.MATH_MAX_NEGATIVE?(s.copyFrom(t),2):0}intersectRadialLinePos(t,e){let s=this.nv.dot(t.position)-this.distance;if(s>a.default.MATH_MIN_POSITIVE){let s=this.nv.dot(t.tv);if(s<0)return this.intersectStraightLinePos2(t.position,t.tv,e)}else{if(!(s<a.default.MATH_MAX_NEGATIVE)){let s=this.nv.dot(t.tv);return s>a.default.MATH_MIN_POSITIVE||s<a.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),1):(e.copyFrom(t.position),2)}{let s=this.nv.dot(t.tv);if(s>0)return this.intersectStraightLinePos2(t.position,t.tv,e)}}return-1}intersectRadialLinePos2(t,e,s){let i=this.nv.dot(t)-this.distance;if(i>a.default.MATH_MIN_POSITIVE){let i=this.nv.dot(e);if(i<0)return this.intersectStraightLinePos2(t,e,s)}else{if(!(i<a.default.MATH_MAX_NEGATIVE)){let i=this.nv.dot(e);return i>a.default.MATH_MIN_POSITIVE||i<a.default.MATH_MAX_NEGATIVE?(s.copyFrom(t),1):(s.copyFrom(t),2)}{let i=this.nv.dot(e);if(i>0)return this.intersectStraightLinePos2(t,e,s)}}return-1}containsPoint(t){let e=this.nv.dot(t)-this.distance;return e>a.default.MATH_MIN_POSITIVE?1:e<a.default.MATH_MAX_NEGATIVE?-1:0}intersectSphere(t,e){this.intersectBoo=!1;let s=this.nv.dot(t)-this.distance;return s>a.default.MATH_MIN_POSITIVE?(this.intersectBoo=s<=e,1):s<a.default.MATH_MAX_NEGATIVE?(this.intersectBoo=-s<=e,-1):0}intersectAABB(t,e){this.intersectBoo=!1;let s=n.default.__tV0;s.setXYZ(e.x,t.y,e.z);let i=this.containsPoint(s);return s.setXYZ(e.x,t.y,t.z),i+=this.containsPoint(s),s.setXYZ(t.x,t.y,t.z),i+=this.containsPoint(s),s.setXYZ(t.x,t.y,e.z),i+=this.containsPoint(s),s.setXYZ(e.x,e.y,e.z),i+=this.containsPoint(s),s.setXYZ(e.x,e.y,t.z),i+=this.containsPoint(s),s.setXYZ(t.x,e.y,t.z),i+=this.containsPoint(s),s.setXYZ(t.x,e.y,e.z),i+=this.containsPoint(s),this.intersectBoo=i<8,i<-7?-1:i>7?1:0}intersectSphNegSpace(t,e){this.intersectBoo=Math.abs(this.nv.dot(t)-this.distance)<e}update(){this.nv.normalize()}updateFast(){this.nv.normalize()}static PlaneIntersectSphere(t,e,s,i){l.IntersectBoo=!1,l.IntersectSatus=0,e=t.dot(s)-e,e>a.default.MATH_MIN_POSITIVE?(l.IntersectBoo=e<=i,l.IntersectSatus=1):e<a.default.MATH_MAX_NEGATIVE&&(l.IntersectBoo=-e<=i,l.IntersectSatus=-1)}static CalcPVCloseV(t,e,s){let i=t.distance-e.dot(t.nv);s.setTo(i*t.nv.x,i*t.nv.y,i*t.nv.z),s.addBy(e)}static CalcPVCloseV2(t,e,s,i){let a=e-s.dot(t);i.setTo(a*t.x,a*t.y,a*t.z),i.addBy(s)}static IntersectionSLV2(t,e,s,i,r){let n=t.dot(i);if(n>a.default.MATH_MIN_POSITIVE||n<a.default.MATH_MAX_NEGATIVE){let a=t.dot(s)-e;return r.x=1e5*i.x+s.x,r.y=1e5*i.y+s.y,r.z=1e5*i.z+s.z,n=t.dot(r)-e,n=a/(a-n),r.subtractBy(s),r.scaleBy(n),r.addBy(s),1}return n=t.dot(s)-e,n<=a.default.MATH_MIN_POSITIVE||n>=a.default.MATH_MAX_NEGATIVE?(r.copyFrom(s),2):0}toString(){return"Plane(position="+this.position.toString()+", nv="+this.nv.toString()+")"}}l.IntersectBoo=!1,l.IntersectSatus=0;class o extends l{constructor(){super(...arguments),this.v0=new r.default(100,0,0),this.v1=new r.default(0,0,-100),this.v2=new r.default(0,0,0),this.ls01=new h.default,this.ls12=new h.default,this.ls20=new h.default,this.radiusSquared=100}getRandomPosition(t){let e=this.ls01.length*Math.random();t.x=this.ls01.position.x+e*this.ls01.tv.x,t.y=this.ls01.position.y+e*this.ls01.tv.y,t.z=this.ls01.position.z+e*this.ls01.tv.z,e=this.ls12.length*Math.random(),t.x+=this.ls12.position.x+e*this.ls12.tv.x,t.y+=this.ls12.position.y+e*this.ls12.tv.y,t.z+=this.ls12.position.z+e*this.ls12.tv.z,e=this.ls20.length*Math.random(),t.x+=this.ls20.position.x+e*this.ls20.tv.x,t.y+=this.ls20.position.y+e*this.ls20.tv.y,t.z+=this.ls20.position.z+e*this.ls20.tv.z,t.x*=.33333,t.y*=.33333,t.z*=.33333}triIntersectStraightLinePos(t,e){let s=this.intersectStraightLinePos(t,e);return 1==s&&(s=this.triContainsPoint(e),s>0)?1:-1}triIntersectRadialLinePos(t,e){let s=this.intersectRadialLinePos(t,e);return 1==s&&(s=this.triContainsPoint(e),s>0)?1:-1}triIntersectStraightLinePos2(t,e,s){let i=this.intersectStraightLinePos2(t,e,s);return 1==i&&(i=this.triContainsPoint(s),i>0)?1:-1}triIntersectRadialLinePos2(t,e,s){let i=this.intersectStraightLinePos2(t,e,s);return 1==i&&(i=this.triContainsPoint(s),i>0)?1:-1}triContainsPoint(t){let e=this.nv.dot(t)-this.distance;return e>a.default.MATH_MIN_POSITIVE||e<a.default.MATH_MAX_NEGATIVE?-1:(n.default.__tV0.x=t.x-this.v0.x,n.default.__tV0.y=t.y-this.v0.y,n.default.__tV0.z=t.z-this.v0.z,r.default.Cross(this.ls01.tv,n.default.__tV0,n.default.__tV1),this.nv.dot(n.default.__tV1)<0?-1:(n.default.__tV0.x=t.x-this.v1.x,n.default.__tV0.y=t.y-this.v1.y,n.default.__tV0.z=t.z-this.v1.z,r.default.Cross(this.ls12.tv,n.default.__tV0,n.default.__tV1),this.nv.dot(n.default.__tV1)<0?-1:(n.default.__tV0.x=t.x-this.v2.x,n.default.__tV0.y=t.y-this.v2.y,n.default.__tV0.z=t.z-this.v2.z,r.default.Cross(this.ls20.tv,n.default.__tV0,n.default.__tV1),this.nv.dot(n.default.__tV1)<0?-1:1)))}update(){let t=1/3;this.position.x=t*(this.v0.x+this.v1.x+this.v2.x),this.position.y=t*(this.v0.y+this.v1.y+this.v2.y),this.position.z=t*(this.v0.z+this.v1.z+this.v2.z),this.nv.x=this.position.x-this.v0.x,this.nv.y=this.position.y-this.v0.y,this.nv.z=this.position.z-this.v0.z,this.radiusSquared=this.nv.getLengthSquared(),this.ls01.position.copyFrom(this.v0),this.ls01.anotherPosition.copyFrom(this.v1),this.ls12.position.copyFrom(this.v1),this.ls12.anotherPosition.copyFrom(this.v2),this.ls20.position.copyFrom(this.v2),this.ls20.anotherPosition.copyFrom(this.v0),this.ls01.update(),this.ls12.update(),this.ls20.update(),r.default.Cross(this.ls01.tv,this.ls12.tv,this.nv),this.nv.normalize(),this.distance=this.nv.dot(this.v0)}updateFast(){this.update()}}e.Triangle=o,e.default=l},e2fe:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t=0,e=0,s=100,i=100){this.Fe=100,this.Ff=100,this.x=0,this.y=0,this.width=100,this.height=100,this.x=t,this.y=e,this.width=s,this.height=i,this.update()}copyFrom(t){this.x=t.x,this.y=t.y,this.Fe=t.Fe,this.Ff=t.Ff,this.width=t.width,this.height=t.height}clone(){return new i(this.x,this.y,this.width,this.height)}containsXY(t,e){return!(t<this.x||t>this.Fe)&&!(e<this.y||e>this.Ff)}contains(t){return t.x>=this.x&&t.Fe<=this.Fe&&t.y>=this.y&&(t.Ff,this.Ff),!0}intersect(t){return!(t.x>this.Fe)&&(!(t.Fe<this.x)&&(!(t.y>this.Ff)&&!(t.Ff<this.y)))}setTo(t,e,s,i){this.x=t,this.y=e,this.width=s,this.height=i,this.Fe=this.width+this.x,this.Ff=this.height+this.y}setSize(t,e){this.width=t,this.height=e,this.Fe=this.width+this.x,this.Ff=this.height+this.y}update(){this.Fe=this.width+this.x,this.Ff=this.height+this.y}flipY(t){this.y=this.y,this.Fe=this.width+this.x,this.Ff=this.height+this.y}getX(){return this.x}getY(){return this.y}getRight(){return this.Fe}getTop(){return this.Ff}}e.default=i},e439:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17")),r=i(s("bd6f")),n=i(s("c51d")),h=i(s("9bb7")),l=i(s("e8e6")),o=i(s("b498")),_=i(s("29ef")),m=i(s("829f"));class u{constructor(t){this.Al=null,this.Fg=null,this.A_x=null,this.Fh=null,this.Fi=null,this.Fj=null,this.Fk=null,this.Fl=null,this.A_1=new a.default(600,800,-600),this.Fm=-5e-4,this.Fn=2,this.Fo=.8,this.Fp=.1,this.Fq=128,this.Fr=128,this.AG=1300,this.AH=1300,this.A_4=.01,this.A_5=3e3,this.Fs=null,this.Ft=null,this.AA=0,this.A_=null,this.BA=-1,this.BB=-1,this.Fu=!1,this.Fv=-1,this.Fw=120,this.force=!0,this.AA=t}initialize(t,e,s=120,i=!1){null==this.Al&&(this.Al=t,this.Fw=s,this.A_=e.slice(0),this.initConfig(e,!1))}setMapSize(t,e){this.Fq=t,this.Fr=e}setCameraPosition(t){this.A_1.copyFrom(t)}setCameraNear(t){this.A_4=t}setCameraFar(t){this.A_5=t}setCameraViewSize(t,e){this.AG=t,this.AH=e}setShadowRadius(t){this.Fn=t}setShadowBias(t){this.Fm=t}setShadowIntensity(t){this.Fo=t,null!=this.Fg&&this.Fg.setShadowIntensity(this.Fo)}setColorIntensity(t){this.Fp=t,null!=this.Fg&&this.Fg.setColorIntensity(this.Fp)}getShadowMap(){return null!=this.Fl?this.Fl.getDstTexture():this.Fs}getVSMData(){return this.Fg}getCamera(){return this.A_x}setRendererProcessIDList(t){null!=this.Fh&&(this.A_=t.slice(0),this.Fh.setRProcessIDList(t))}initConfig(t,e=!1){let s;this.Fg=new o.default,this.Fg.initialize(),this.Fg.setShadowIntensity(this.Fo),this.Fh=this.Al.createFBOInstance(),this.Fh.asynFBOSizeWithViewport(),this.Fh.setClearRGBAColor4f(1,1,1,1),this.Fh.createFBOAt(this.AA,this.Fq,this.Fr,!0,!1),this.Fs=this.Fh.setRenderToRGBATexture(null,0),this.Fh.setRProcessIDList(t),this.Fh.setGlobalRenderState(_.default.NORMAL_STATE),this.Fh.setGlobalMaterial(new h.default),this.Fi=this.Al.createFBOInstance(),this.Fi.asynFBOSizeWithViewport(),this.Fi.setClearRGBAColor4f(1,1,1,1),this.Fi.createFBOAt(this.AA,this.Fq,this.Fr,!0,!1),this.Ft=this.Fi.setRenderToRGBATexture(null,0),s=new l.default(!1),s.setShadowRadius(this.Fn);let i=new r.default;i.setMaterial(s),i.initializeXOY(-1,-1,2,2,[this.Fs]),this.Fj=i,s=new l.default(!0),s.setShadowRadius(this.Fn);let a=new r.default;a.copyMeshFrom(i),a.setMaterial(s),a.initializeXOY(-1,-1,2,2,[this.Ft]),this.Fk=a,this.Fu=e,e&&(this.Fl=new m.default(this.Al.getRenderer()),this.Fl.setBlurCount(2),this.Fl.setSyncViewSizeEnabled(!1),this.Fl.setFBOSize(this.Fq,this.Fr),this.Fl.setBlurDensity(1),this.Fl.bindDrawEntity(this.Fj),this.Fl.setBackbufferVisible(!1)),this.A_x=new n.default,this.Fg.setShadowMap(this.getShadowMap()),this.updateData()}updateData(){if(null!=this.A_x){let t=this.AG,e=this.AH;this.A_x.lookAtRH(this.A_1,a.default.ZERO,a.default.Z_AXIS),this.A_x.orthoRH(this.A_4,this.A_5,-.5*e,.5*e,-.5*t,.5*t),this.A_x.setViewXY(0,0),this.A_x.setViewSize(t,e),this.A_x.update()}null!=this.Fg&&(this.Fh.resizeFBO(this.Fq,this.Fr),this.Fi.resizeFBO(this.Fq,this.Fr),this.Fu&&this.Fl.setFBOSize(this.Fq,this.Fr),this.Fg.updateShadowCamera(this.A_x),this.Fg.setShadowRadius(this.Fn),this.Fg.setShadowBias(this.Fm),this.Fg.setShadowSize(this.Fq,this.Fr),this.Fg.update())}upate(){this.Fw=32,this.Fv=this.A_x.version,this.updateData()}getRendererProcessStatus(){let t=31;for(let e=0;e<this.A_.length;++e)t+=t*this.Al.getRenderProcessAt(e).getStatus();return t}run(){this.A_x.version!=this.Fv&&(this.Fv=this.A_x.version,this.Fg.updateShadowCamera(this.A_x),this.Fg.update());let t=this.force;if(t)this.buildShadow();else{if(this.BA!=this.Al.getRendererStatus()){let e=this.getRendererProcessStatus();this.BB!=e&&(this.BB=e,t=!0),this.BA=this.Al.getRendererStatus()}this.Fw>0&&(this.Fw%15==0&&(t=!0),this.Fw--),t&&this.buildShadow()}this.force=!1}buildShadow(){this.Fh.useCamera(this.A_x),this.Fh.run(!0,!0),this.Fh.useMainCamera(),this.Fi.setRenderToRGBATexture(this.Ft,0),this.Fi.runBegin(),this.Fi.drawEntity(this.Fj),this.Fi.runEnd(),this.Fi.setRenderToRGBATexture(this.Fs,0),this.Fi.runBegin(),this.Fi.drawEntity(this.Fk),this.Fi.runEnd(),null!=this.Fl&&this.Fl.run(),this.Fi.setRenderToBackBuffer()}}e.ShadowVSMModule=u,e.default=u},e753:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("ab73")),r=i(s("3077")),n=s("5216"),h=s("c70f"),l=i(s("6e01")),o=s("8602"),_=s("6a30"),m=s("f043");class u{constructor(t=0){this.T=-1,this.C_f=new h.GlobalLightUniformParam,this.C_g=null,this.C_h=null,this.C_j=0,this.Fx=null,this.Fy=null,this.Fz=0,this.F0=0,this.F1=null,this.F2=null,this.F3=null,this.C_j=t,this.T=u.F_j++}getUid(){return this.T}getPointLightsTotal(){return null!=this.F1?this.F1.length:0}getDirecLightsTotal(){return null!=this.F2?this.F2.length:0}getSpotLightsTotal(){return null!=this.F3?this.F3.length:0}getPointLightAt(t){return null!=this.F1&&t>=0&&t<this.F1.length?this.F1[t]:null}getDirectionLightAt(t){return null!=this.F2&&t>=0&&t<this.F2.length?this.F2[t]:null}getSpotLightAt(t){return null!=this.F3&&t>=0&&t<this.F3.length?this.F3[t]:null}appendPointLight(){null==this.F1&&(this.F1=[]);let t=new o.PointLight;return this.F1.push(t),this.F0++,t}appendDirectionLight(){null==this.F2&&(this.F2=[]);let t=new _.DirectionLight;return this.F2.push(t),this.F0++,t}appendSpotLight(){null==this.F3&&(this.F3=[]);let t=new m.SpotLight;return this.F3.push(t),this.F0++,t}updatePointLightData(){if(null!=this.F1){let t,e=this.Fx,s=this.Fy,i=0;for(let a=0;a<this.F1.length;++a)t=this.F1[a],i=4*a,e[i]=t.position.x,e[i+1]=t.position.y,e[i+2]=t.position.z,e[i+3]=t.attenuationFactor1,s[i]=t.color.r,s[i+1]=t.color.g,s[i+2]=t.color.b,s[i+3]=t.attenuationFactor2}}updateDirecLighttData(){if(null!=this.F2){let t,e=this.Fx,s=this.Fy,i=0,a=null!=this.F1?this.F1.length:0;a*=4;for(let r=0;r<this.F2.length;++r)t=this.F2[r],i=a+4*r,e[i]=t.direction.x,e[i+1]=t.direction.y,e[i+2]=t.direction.z,e[i+3]=t.attenuationFactor1,s[i]=t.color.r,s[i+1]=t.color.g,s[i+2]=t.color.b,s[i+3]=t.attenuationFactor2}}updateSpotLighttData(){if(null!=this.F3){let t,e=this.Fx,s=this.Fy,i=0,a=null!=this.F1?this.F1.length:0;a+=null!=this.F2?this.F2.length:0,a*=4;for(let r=0;r<this.F3.length;++r)t=this.F3[r],i=a+4*r,e[i]=t.position.x,e[i+1]=t.position.y,e[i+2]=t.position.z,e[i+3]=t.attenuationFactor1,s[i]=t.color.r,s[i+1]=t.color.g,s[i+2]=t.color.b,s[i+3]=t.attenuationFactor2;a+=4*this.F3.length;for(let r=0;r<this.F3.length;++r){t=this.F3[r];let s=90-l.default.Clamp(t.angleDegree,0,90);s=Math.cos(l.default.DegreeToRadian(s)),i=a+4*r,e[i]=t.direction.x,e[i+1]=t.direction.y,e[i+2]=t.direction.z,e[i+3]=s}}}buildData(){if(null==this.C_g){let t=this.F0,e=this.F0,s=4*t;this.Fz=this.F0,null==this.F3||(s+=4*this.F3.length,this.Fz+=this.F3.length),null==this.Fx&&(this.Fx=new Float32Array(s)),null==this.Fy&&(this.Fy=new Float32Array(4*e)),this.C_g=new r.default,this.C_g.bindSlotAt(this.C_j),this.C_g.addVec4Data(this.Fx,this.Fz),this.C_g.addVec4Data(this.Fy,e),this.C_h=this.C_f.createGlobalUinform(this.C_g)}this.updatePointLightData(),this.updateDirecLighttData(),this.updateSpotLighttData()}update(){this.buildData(),this.C_g.update()}showInfo(){}resetPipe(){}getTextures(t,e,s){return null}useShaderPipe(t,e){if(null!=this.C_g){t.normalEnabled=!0;let e=this.getPointLightsTotal()+this.getDirecLightsTotal()+this.getSpotLightsTotal();e>0?(t.addDefine("VOX_LIGHTS_TOTAL",""+e),this.getPointLightsTotal()>0?t.addDefine("VOX_POINT_LIGHTS_TOTAL",""+this.getPointLightsTotal()):t.addDefine("VOX_POINT_LIGHTS_TOTAL","0"),this.getDirecLightsTotal()>0?t.addDefine("VOX_DIRECTION_LIGHTS_TOTAL",""+this.getDirecLightsTotal()):t.addDefine("VOX_DIRECTION_LIGHTS_TOTAL","0"),this.getSpotLightsTotal()>0?t.addDefine("VOX_SPOT_LIGHTS_TOTAL",""+this.getSpotLightsTotal()):t.addDefine("VOX_SPOT_LIGHTS_TOTAL","0")):t.addDefine("VOX_LIGHTS_TOTAL","0"),this.C_f.use(t,this.Fz,this.F0)}}getPipeTypes(){return[n.MaterialPipeType.GLOBAL_LIGHT]}getPipeKey(t){switch(t){case n.MaterialPipeType.GLOBAL_LIGHT:let e="";if(this.getPointLightsTotal()>0&&(e=""+this.getPointLightsTotal()),this.getDirecLightsTotal()>0&&(e+=""+this.getDirecLightsTotal()),this.getSpotLightsTotal()>0&&(e+=""+this.getSpotLightsTotal()),""!=e)return"["+t+":"+e+"]";break;default:break}return""}useUniforms(t){null!=this.C_g&&(t.addFragUniform(a.default.GlobalLight.type,a.default.GlobalLight.positionName,this.Fz),t.addFragUniform(a.default.GlobalLight.type,a.default.GlobalLight.colorName,this.F0))}getGlobalUinform(){return this.C_h.clone()}}u.F_j=0,e.LightModule=u},e7ce:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("faa5")),r=i(s("b3bd")),n=i(s("0fc4"));class h extends a.default{constructor(){super(),this.Ak=""}initialize(t){this.Ak="PixelPickIndexShd"}getFragShaderCode(){let t="#version 300 es\nprecision highp float;\nuniform vec4 u_param;\nin vec3 v_viewPos;\n//in float v_length;\nlayout(location = 0) out vec4 FragColor0;\nvoid main()\n{\nvec4 p = vec4(length(v_viewPos.xyz));\np.x = floor(p.x)/256.0;\np.y = floor(fract(p.x) * 256.0)/255.0;\np.x = floor(p.x) / 255.0;\np.z = fract(p.z);\nFragColor0 = vec4(p.xyz,u_param.w);\n}\n";return t}getVertShaderCode(){let t="#version 300 es\nprecision highp float;\nlayout(location = 0) in vec3 a_vs;\nuniform mat4 u_objMat;\nuniform mat4 u_viewMat;\nuniform mat4 u_projMat;\nout vec3 v_viewPos;\n//out float v_length;\nvoid main(){\nmat4 viewMat4 = u_viewMat * u_objMat;\nvec4 viewPos = viewMat4 * vec4(a_vs, 1.0);\nv_viewPos = viewPos.xyz;\n//v_length = length(viewPos.xyz);\ngl_Position = u_projMat * viewPos;\n}\n";return t}getUniqueShaderName(){return this.Ak}toString(){return"[PixelPickIndexShaderBuffer()]"}static GetInstance(){return h.F_0}}h.F_0=new h,e.PixelPickIndexShaderBuffer=h;class l extends n.default{constructor(){super(),this.F4=new Float32Array([1,1,1,1]),this.F5=1/255}getCodeBuf(){return h.GetInstance()}setIndex(t){this.F4[3]=t*this.F5}getIndex(){return this.F4[3]/this.F5}createSelfUniformData(){let t=new r.default;return t.uniformNameList=["u_param"],t.dataList=[this.F4],t}}e.default=l},e7d2:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8a0a")),r=i(s("710f")),n=i(s("f0f0")),h=i(s("7a04")),l=s("e08e");class o{constructor(t=a.default.VTX_STATIC_DRAW){this.T=0,this.F6=null,this.BZ=null,this.E_o=0,this.F7=2,this.layoutBit=0,this.vertexVer=0,this.indicesVer=0,this.version=0,this.drawMode=l.RenderDrawMode.ELEMENTS_TRIANGLES,this.bufData=null,this.T=o.F_j++,this.E_o=t}setVtxBuf(t){t!=this&&(this.F6=t,null!=t&&(t.layoutBit=this.layoutBit))}getUid(){return this.T}getType(){return this.F6.getType()}getIBufStep(){return this.F7}getBufDataUsage(){return this.E_o}setBufDataUsage(t){this.E_o=t}getBuffersTotal(){return this.F6.getBuffersTotal()}getAttribsTotal(){return this.F6.getAttribsTotal()}getF32DataAt(t){return this.F6.getF32DataAt(t)}getIvsData(){return this.BZ}setF32DataAt(t,e,s,i){this.F6.setF32DataAt(t,e,s,i),this.vertexVer++}setUintIVSData(t,e=a.default.VTX_STATIC_DRAW){if(t instanceof Uint16Array)this.F7=2;else{if(!(t instanceof Uint32Array))return;this.F7=4}this.BZ=t,null!=t&&this.indicesVer++}setData4fAt(t,e,s,i,a,r){null!=this.F6&&(this.F6.setData4fAt(t,e,s,i,a,r),this.vertexVer++)}setData3fAt(t,e,s,i,a){null!=this.F6&&(this.F6.setData3fAt(t,e,s,i,a),this.vertexVer++)}setData2fAt(t,e,s,i){null!=this.F6&&(this.F6.setData2fAt(t,e,s,i),this.vertexVer++)}destroy(){}__$destroy(){this.F6.destroy(),this.F6.getType()<1?o.G2.push(this.F6):o.G3.push(this.F6),this.F6=null,this.BZ=null,this.bufData=null}toString(){return"ROVertexBuffer(uid = "+this.T+")"}static GetFreeId(){return o.Gl.length>0?o.Gl.pop():-1}static GetVtxByUid(t){return o.Gm[t]}static Create(t=a.default.VTX_STATIC_DRAW){let e=null,s=o.GetFreeId();return s>=0?(e=o.Gm[s],e.setBufDataUsage(t),o.Gn[s]=o.S_FLAG_BUSY):(e=new o(t),o.Gm.push(e),o.Gn.push(o.S_FLAG_BUSY),o.Go++),e.vertexVer=0,e.indicesVer=0,e.version++,o.G4.__$attachAt(e.getUid()),e}static __$Restore(t){if(null!=t&&o.Gn[t.getUid()]==o.S_FLAG_BUSY){let e=t.getUid();o.Gl.push(e),o.Gn[e]=o.S_FLAG_FREE,t.__$destroy()}}static __$$AttachAt(t){o.G4.__$attachAt(t)}static __$$DetachAt(t){o.G4.__$detachAt(t)}static Reset(){o.BufDataList=[],o.G5=0,o.BufStatusList=[],o.BufDataStepList=[],o.vtxFS32=null,o.vbWholeDataEnabled=!1,o.dynBufSegEnabled=!1,o.useBufByIndexEnabled=!1}static AddFloat32Data(t,e,s=a.default.VTX_STATIC_DRAW){o.BufDataList.push(t),o.BufDataStepList.push(e),o.BufStatusList.push(s),o.G5+=e}static CreateBySaveData(t=a.default.VTX_STATIC_DRAW,e=0){let s=0,i=0,r=0,h=o.BufDataStepList.length,l=[];for(;s<h;s++)l.push(r),r+=o.BufDataStepList[s];let _=o.BufDataList[0].length/o.BufDataStepList[0],m=new Float32Array(r*_),u=0,d=0,c=null,f=null;for(s=0;s<_;++s)for(i=s*r,u=0;u<h;++u)d=o.BufDataStepList[u],c=o.BufDataList[u],f=c.subarray(s*d,(s+1)*d),m.set(f,i),i+=d;let p=o.Create(t);if(p.layoutBit=e,o.G2.length>0){let t=o.G2.pop();p.setVtxBuf(t)}else p.setVtxBuf(new n.default(p.getBufDataUsage()));return p.setF32DataAt(0,m,r,l),p}static CreateVtxCombinedBuf(t,e,s=a.default.VTX_STATIC_DRAW,i=0){let r=0,h=0,l=e.length,_=[];for(;r<l;r++)_.push(h),h+=e[r];let m=o.Create(s);if(m.layoutBit=i,o.G2.length>0){let t=o.G2.pop();m.setVtxBuf(t)}else m.setVtxBuf(new n.default(m.getBufDataUsage()));return m.setF32DataAt(0,t,h,_),m}static UpdateBufData(t){let e=0,s=0,i=0,a=o.BufDataStepList.length,r=o.BufDataList[0].length/o.BufDataStepList[0],n=t.getF32DataAt(0),h=o.G5*r!=n.length,l=null;if(h)for(l=[],n=new Float32Array(o.G5*r);e<a;e++)l.push(i),i+=o.BufDataStepList[e];else i=o.G5;let _=0,m=0,u=null,d=null;for(e=0;e<r;++e)for(s=e*i,_=0;_<a;++_)m=o.BufDataStepList[_],u=o.BufDataList[_],d=u.subarray(e*m,(e+1)*m),n.set(d,s),s+=m;h?t.setF32DataAt(0,n,i,l):t.setF32DataAt(0,n,i,null)}static CreateByBufDataSeparate(t,e=a.default.VTX_STATIC_DRAW,s=0){let i=0,r=0,n=t.getAttributesTotal(),l=new Array(n);l.fill(0);let _=o.Create(e);if(_.layoutBit=s,o.G3.length>0){let t=o.G3.pop();_.setVtxBuf(t)}else _.setVtxBuf(new h.default);for(i=0;i<n;i++)_.setF32DataAt(i,t.getAttributeDataAt(i,0),r,l);return _.setUintIVSData(t.getIndexDataAt(0)),_.bufData=t,_}static CreateBySaveDataSeparate(t=a.default.VTX_STATIC_DRAW){let e=0,s=0,i=o.BufDataStepList.length,r=new Array(i);r.fill(0);let n=o.Create(t);if(o.G3.length>0){let t=o.G3.pop();n.setVtxBuf(t)}else n.setVtxBuf(new h.default);for(e=0;e<i;e++)n.setF32DataAt(e,o.BufDataList[e],s,r);return n}static GetVtxAttachCountAt(t){return o.G4.getAttachCountAt(t)}static GetVtxAttachAllCount(){return o.G4.getAttachAllCount()}static ClearTest(){if(--o.G6,o.G6<1){o.G6=128;let t=o.G4;if(t.__$getRemovedListLen()>0){let e=t.__$getRemovedList(),s=e.length,i=0,a=0,r=null,n=32;for(s=s>n?n:s;i<s;++i)a=e.shift(),t.getAttachCountAt(a)<1&&(r=o.GetVtxByUid(a),o.__$Restore(r))}}}}o.F_j=0,o.G2=[],o.G3=[],o.S_FLAG_BUSY=1,o.S_FLAG_FREE=0,o.Gn=[],o.Go=0,o.Gm=[],o.Gl=[],o.G4=new r.default,o.G5=0,o.BufDataList=null,o.BufDataStepList=null,o.BufStatusList=null,o.vtxDataFS32=null,o.vbWholeDataEnabled=!1,o.dynBufSegEnabled=!1,o.useBufByIndexEnabled=!1,o.vtxFS32=null,o.G6=128,e.default=o},e87b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("ab73")),r=i(s("7279"));class n{create(t,e){let s=null,i=a.default.ViewportParam;return e.hasUniformByName(i.name)&&(s=new r.default,s.uns=i.name,s.uniformNameList=[i.name],s.copyDataFromProbe(t.getRenderAdapter().uViewProbe)),s}getIDNS(){return"ViewParamUniformBuilder"}}e.default=n},e8e6:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("faa5")),r=i(s("b3bd")),n=i(s("0fc4"));class h extends a.default{constructor(){super(),this.Ak="",this.Dz=!1,this.horizonal=!0}initialize(t){this.Ak="OccBlurShd",this.Dz=t,t&&(this.Ak+="_tex")}buildThisCode(){let t=this.A_R;this.horizonal&&t.addDefine("HORIZONAL_PASS"),t.addDefine("SAMPLE_RATE","0.25"),t.addDefine("HALF_SAMPLE_RATE","0.125"),t.addTextureSample2D("",!1),t.uniform.useViewPort(!1,!0),t.addFragUniform("vec4","u_param")}getFragShaderCode(){this.buildThisCode();let t=this.A_R;return t.addFragMainCode("\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n    vec4 r = vec4( fract( v * PackFactors ), v );\n    r.yzw -= r.xyz * ShiftRight8; // tidy overflow\n    return r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n    return dot( v, UnpackFactors );\n}\n\nvec4 pack2HalfToRGBA( vec2 v ) {\n    vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n    return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n    return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nvoid main() {\n\n    float mean = 0.0;\n    float squared_mean = 0.0;\n    \n    vec2 resolution = u_viewParam.zw;\n    \n    float radius = u_param[3];\n    // This seems totally useless but it's a crazy work around for a Adreno compiler bug\n    float depth = unpackRGBAToDepth( VOX_Texture2D( u_sampler0, ( gl_FragCoord.xy ) / resolution ) );\n\n    for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\n        #ifdef HORIZONAL_PASS\n\n            vec2 distribution = unpackRGBATo2Half( VOX_Texture2D( u_sampler0, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n            mean += distribution.x;\n            squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\n        #else\n\n            float depth = unpackRGBAToDepth( VOX_Texture2D( u_sampler0, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n            mean += depth;\n            squared_mean += depth * depth;\n\n        #endif\n\n    }\n\n    mean = mean * HALF_SAMPLE_RATE;\n    squared_mean = squared_mean * HALF_SAMPLE_RATE;\n\n    float std_dev = sqrt( squared_mean - mean * mean );\n\n    FragColor0 = pack2HalfToRGBA( vec2( mean, std_dev ) );\n\n}\n"),this.A_R.buildFragCode()}getVertShaderCode(){let t=this.A_R;return t.addVertMainCode("\nvoid main() {\n    gl_Position =  vec4(a_vs,1.0);\n}\n"),this.A_R.buildVertCode()}getUniqueShaderName(){return this.Ak+(this.horizonal?"_h":"_v")}toString(){return"[OccBlurShaderBuffer()]"}static GetInstance(){return null!=h.F_0||(h.F_0=new h),h.F_0}}h.F_0=null;class l extends n.default{constructor(t){super(),this.F8=!0,this.D0=new Float32Array([1,1,1,4]),this.F8=t}getCodeBuf(){let t=h.GetInstance();return t.horizonal=this.F8,t}setShadowRadius(t){this.D0[3]=t}createSelfUniformData(){let t=new r.default;return t.uniformNameList=["u_param"],t.dataList=[this.D0],t}}e.default=l},e9f0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("3b73")),r=i(s("61d7"));class n extends r.default{constructor(t,e,s,i,a=!1,r=!1){super(e,s),this.r=null,this.B_r=null,this.Al=null,this.F9=null,this.F_A=!1,this.F_B=null;let n=document.createElement("canvas");n.width=e,n.height=s,n.style.display="bolck",n.style.left="0px",n.style.top="0px",n.style.position="absolute",n.style.pointerEvents="none",this.F_A=a,a&&(n.style.backgroundColor="transparent"),this.F_B=i,this.Al=t,this.r=n,this.B_r=n.getContext("2d"),this.B_r.fillStyle=a?i.getCSSDecRGBAColor():i.getCSSHeXRGBColor(),this.B_r.fillRect(0,0,e,s),this.CJ=!0,this.F9=this.Al.textureBlock.createImageTex2D(32,32),this.F9.__$setRenderProxy(this.Al.getRenderProxy()),this.F9.setDataFromImage(this.r),this.F9.premultiplyAlpha=!0,this.F9.__$attachThis()}clone(){let t=new n(this.Al,this.B_v,this.B_w,this.F_B,this.F_A);return t}getTexture(){return this.F9}getCanvas(){return this.r}addSubImage(t,e){let s=this.getAreaByName(t);if(null!=s)return s;if(s=this.addSubTexArea(t,e.width,e.height),null!=s){let t=s.texRect;this.B_r.drawImage(e,t.x,t.y,t.width,t.height),this.F9.setDataFromImage(this.r),this.F9.updateDataToGpu()}return s}static CreateCharsTexture(t,e,s="rgba(255,255,255,1.0)",i="rgba(64,0,64,1.0)"){if(null==t||""==t||e<8)return null;let r=t+"_"+e+"_"+s+"_"+i;if(n.F_o.has(r))return n.F_o.get(r);let h=e,l=e+2;t.length>1&&(h=e*t.length);let o=document.createElement("canvas");o.width=h,o.height=l,o.style.display="bolck",o.style.left="0px",o.style.top="0px",o.style.position="absolute",o.style.backgroundColor="transparent";let _=o.getContext("2d");_.font=e-4+"px Verdana",_.textBaseline="top";var m=_.measureText(t);let u=m.width;return t.length>1&&(h=Math.round(u+8),o.width=h,_=o.getContext("2d"),_.font=e-4+"px Verdana",_.textBaseline="top"),_.fillStyle=i,_.fillRect(0,0,h,l),_.textAlign="left",_.fillStyle=s,a.default.IsMobileWeb()&&a.default.IsIOS()?_.fillText(t,.5*(h-u),-4):_.fillText(t,.5*(h-u),4),n.F_o.set(r,o),o}}n.F_o=new Map,e.default=n},eaee:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("8d98"),r=i(s("0851"));class n extends r.default{constructor(t,e){super(t,e,!1),this.B_n=null,this.k=a.TextureTarget.TEXTURE_CUBE,this.n=a.TextureProxyType.FloatCube,this.internalFormat=a.TextureFormat.RGBA16F,this.dataType=a.TextureDataType.FLOAT,this.mipmapEnabled=!0}toRGBFormat(){this.unpackAlignment=1,this.srcFormat=a.TextureFormat.RGB,this.internalFormat=a.TextureFormat.RGB16F,this.minFilter=a.TextureConst.NEAREST,this.magFilter=a.TextureConst.NEAREST,this.mipmapEnabled=!1}toRGBFormatFloat32F(){this.unpackAlignment=1,this.srcFormat=a.TextureFormat.RGB,this.internalFormat=a.TextureFormat.RGB32F,this.minFilter=a.TextureConst.NEAREST,this.magFilter=a.TextureConst.NEAREST,this.mipmapEnabled=!1}toRGBAFormat(){this.unpackAlignment=4,this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA16F}toRGBAFormatFloat32F(){this.unpackAlignment=4,this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA32F}toRGBAFormatHalfFloat(){this.unpackAlignment=1,this.srcFormat=a.TextureFormat.RGBA,this.dataType=a.TextureDataType.HALF_FLOAT,this.internalFormat=a.TextureFormat.RGBA16F}setDataFromBytesToFaceAt(t,e,s,i,a=0){if(null==this.B_n&&(this.B_n=[null,null,null,null,null,null]),s>0&&i>0){0==t&&a<1&&(this.g=s,this.h=i,this.f=a),null==this.B_n[t]&&(this.B_n[t]=new Array(16));let r=this.B_n[t];r[a]={width:s,height:i,imgData:e,miplevel:a},this.m=null!=r[a].imgData}}uploadData(t){let e,s,i=t.getRC(),r=null,n=this.getWidth(),h=this.getHeight();for(let l=0;l<6;++l){let t=this.B_n[l];if(this.mipmapEnabled&&this.o)r=t[0],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,a.TextureFormat.ToGL(i,this.internalFormat),n,h,0,a.TextureFormat.ToGL(i,this.srcFormat),a.TextureDataType.ToGL(i,this.dataType),r.imgData);else{e=n,s=h;let o=0;for(;e>0||s>0;)null!=t[o]&&(r=t[o],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,o,a.TextureFormat.ToGL(i,this.internalFormat),e,s,0,a.TextureFormat.ToGL(i,this.srcFormat),a.TextureDataType.ToGL(i,this.dataType),r.imgData)),e>0&&(e>>=1),s>0&&(s>>=1),++o}}this.version=0}toString(){return"[FloatCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.B_n)for(let t=0;t<6;++t)null!=this.B_n[t]&&(this.B_n[t].imgData=null);super.__$destroy()}}}e.default=n},eca0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("2be1")),r=i(s("c62b"));class n{constructor(){this.idsFlag=0,this.count=0,this.rprocessUid=-1}reset(){this.idsFlag=0}}n.RenerProcessMaxTotal=16,e.RCRPObj=n;class h extends a.default{constructor(){super(...arguments),this.F_C=[]}createNode(){let t=new n;return t.reset(),this.F_C.push(t),new r.default}restoreUid(t){this.F_C[t].reset()}testRPNodeExists(t,e){return(this.F_C[t].idsFlag&1<<e)>0}testRPNodeNotExists(t,e){return(this.F_C[t].idsFlag&1<<e)<1}setRPNodeParam(t,e,s){let i=this.F_C[t],a=1<<e;return s>-1?(i.idsFlag&a)<1&&(++i.count,i.rprocessUid=e,i.idsFlag=i.idsFlag|a):(i.idsFlag&a)>0&&(--i.count,i.idsFlag=i.idsFlag&~a),i.count}getRCRPObj(t){return this.F_C[t]}}e.RPOUnitBuilder=h},ee5a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.type=0,this.F_D=[],this.F_E=[],this.F_F=[]}addListener(t,e,s){let i=this.F_E.length-1;for(;i>=0;--i)if(t===this.F_E[i])break;i<0&&(this.F_E.push(t),this.F_D.push(e),this.F_F.push(s))}removeListener(t,e){let s=this.F_E.length-1;for(;s>=0;--s)if(t===this.F_E[s]){this.F_E.splice(s,1),this.F_D.splice(s,1),this.F_F.splice(s,1);break}}dispatch(t){let e=0,s=this.F_E.length;for(let i=0;i<s;++i)(this.F_F[i]<1||t.phase==this.F_F[i])&&(this.F_D[i].call(this.F_E[i],t),e=1);return e}passTestEvt(t){let e=this.F_E.length;for(let s=0;s<e;++s)if(this.F_F[s]<1||t.phase==this.F_F[s])return 1;return 0}passTestPhase(t){let e=this.F_E.length;for(let s=0;s<e;++s)if(this.F_F[s]<1||t==this.F_F[s])return 1;return 0}destroy(){this.F_E=[],this.F_D=[],this.F_F=[]}}e.default=i},f043:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17")),r=i(s("3930"));class n{constructor(){this.position=new a.default(0,100,0),this.direction=new a.default(0,-1,0,0),this.color=new r.default(1,1,1,1),this.angleDegree=30,this.attenuationFactor1=1e-4,this.attenuationFactor2=5e-4}}e.SpotLight=n},f044:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static CreateNewID(){return i.__s_uid++}}i.__s_uid=0,e.default=i},f0f0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("f044"));class r{constructor(t){this.T=-1,this.B_o=0,this.layoutBit=0,this.B3=null,this.F_G=null,this.F_H=0,this.T=a.default.CreateNewID()}getUid(){return this.T}getType(){return 0}getBuffersTotal(){return 1}getAttribsTotal(){return this.B3.length}getF32DataAt(t){return this.F_G}setF32DataAt(t,e,s,i){null!=i&&(this.B3=i),this.F_H=s,this.F_G=e}setData4fAt(t,e,s,i,a,r){t=this.F_H*t+this.B3[e],this.F_G[t++]=s,this.F_G[t++]=i,this.F_G[t++]=a,this.F_G[t++]=r}setData3fAt(t,e,s,i,a){t=this.F_H*t+this.B3[e],this.F_G[t++]=s,this.F_G[t++]=i,this.F_G[t++]=a}setData2fAt(t,e,s,i){t=this.F_H*t+this.B3[e],this.F_G[t++]=s,this.F_G[t++]=i}destroy(){this.B3=null,this.F_G=null}toString(){return"VtxCombinedBuf(uid = "+this.T+")"}}e.default=r},f152:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17")),r=i(s("38de")),n=i(s("fecb")),h=i(s("35fa")),l=i(s("8a0a")),o=i(s("e7d2")),_=i(s("5282")),m=i(s("cb29"));class u extends m.default{constructor(t=l.default.VTX_STATIC_DRAW){super(t),this.EP=10,this.EQ=10,this.EO=50,this.BV=null,this.BW=null,this.BX=null,this.BY=null,this.inverseUV=!1,this.uvScale=1}getVS(){return this.BV}getUVS(){return this.BW}getNVS(){return this.BX}getCVS(){return this.BY}getIVS(){return this.BZ}initialize(t,e,s,i){if(this.vtxTotal<1){if(t<.01)return;this.bounds=new n.default,this.bounds.min.setXYZ(-t,-t,-t),this.bounds.max.setXYZ(t,t,t),this.bounds.updateFast(),e<2&&(e=2),s<2&&(s=2),this.EO=Math.abs(t),this.EP=e,this.EQ=s,(this.EQ+1)%2==0&&(this.EQ+=1),(this.EP=this.EQ)&&(this.EP+=1);let a=1,r=0,m=0,u=0,d=0,c=0,f=0,p=new _.default(0,-this.EO,0,m),g=[],v=[];v.push([]);let x=v[0],T=this.inverseUV?1:.5;p.u=p.v=T,p.nx=0,p.ny=-1,p.nz=0,x.push(p.cloneVertex()),g.push(x[0]);let E=0,y=(this.EO,0),S=1/this.EO;Math.PI,this.EO,this.EO;for(a=0;a<this.EQ;++a){d=Math.PI*a/this.EQ,c=Math.sin(d),f=Math.cos(d),p.y=-this.EO*f,E=this.EO*c,y=this.inverseUV?Math.abs(d/Math.PI-.5):.5-Math.abs(d/Math.PI-.5),y*=this.uvScale,v.push([]);let t=v[a];for(r=0;r<this.EP;++r)u=2*Math.PI*r/this.EP,++m,c=Math.sin(u),f=Math.cos(u),p.x=c*E,p.z=f*E,p.index=m,p.u=.5+c*y,p.v=.5+f*y,p.nx=p.x*S,p.ny=p.y*S,p.nz=p.z*S,t.push(p.cloneVertex()),g.push(t[r]);t.push(t[0])}++m,p.index=m,p.x=0,p.y=this.EO,p.z=0,p.u=p.v=T,p.nx=0,p.ny=1,p.nz=0,v.push([]);let b=v[this.EQ];b.push(p.cloneVertex()),g.push(b[0]);let M=null,A=[],R=null,L=null;for(a=1;a<=this.EQ;++a)for(R=v[a-1],L=v[a],r=1;r<=this.EP;++r)1==a?(A.push(R[0].index),A.push(L[r].index),A.push(L[r-1].index)):a==this.EQ?(A.push(R[r].index),A.push(L[0].index),A.push(R[r-1].index)):(A.push(R[r].index),A.push(L[r-1].index),A.push(R[r-1].index),A.push(R[r].index),A.push(L[r].index),A.push(L[r-1].index));for(this.vtxTotal=g.length,i?(this.BZ=new Uint16Array(2*A.length),this.BZ.set(A,0),A.reverse(),this.BZ.set(A,A.length)):this.BZ=new Uint16Array(A),this.BV=new Float32Array(3*this.vtxTotal),a=0,r=0;r<this.vtxTotal;++r)M=g[r],this.BV[a]=M.x,this.BV[a+1]=M.y,this.BV[a+2]=M.z,a+=3;if(o.default.Reset(),o.default.AddFloat32Data(this.BV,3),this.isVBufEnabledAt(l.default.VBUF_UVS_INDEX)){for(this.BW=new Float32Array(2*this.vtxTotal),a=0,r=0;r<this.vtxTotal;++r)M=g[r],this.BW[a]=M.u,this.BW[a+1]=M.v,a+=2;o.default.AddFloat32Data(this.BW,2)}if(this.isVBufEnabledAt(l.default.VBUF_NVS_INDEX)){for(this.BX=new Float32Array(3*this.vtxTotal),a=0,r=0;r<this.vtxTotal;++r)M=g[r],this.BX[a]=M.nx,this.BX[a+1]=M.ny,this.BX[a+2]=M.nz,a+=3;o.default.AddFloat32Data(this.BX,3)}if(this.isVBufEnabledAt(l.default.VBUF_CVS_INDEX)){for(this.BY=new Float32Array(3*this.vtxTotal),a=0,r=0;r<this.vtxTotal;++r)this.BY[a]=1,this.BY[a+1]=1,this.BY[a+2]=1,a+=3;o.default.AddFloat32Data(this.BY,3)}if(this.isVBufEnabledAt(l.default.VBUF_TVS_INDEX)){let t=this.BZ.length/3,e=new Float32Array(this.BV.length),s=new Float32Array(this.BV.length);h.default.ClacTrisTangent(this.BV,this.BV.length,this.BW,this.BX,t,this.BZ,e,s),o.default.AddFloat32Data(e,3),o.default.AddFloat32Data(s,3)}this.updateWireframeIvs(),o.default.vbWholeDataEnabled=this.vbWholeDataEnabled,null==this.Bb?(this.Bb=o.default.CreateBySaveData(this.getBufDataUsage()),this.Bb.setUintIVSData(this.BZ)):(this.forceUpdateIVS&&this.Bb.setUintIVSData(this.BZ),o.default.UpdateBufData(this.Bb)),this.vtCount=this.BZ.length,this.trisNumber=this.vtCount/3}}__$destroy(){this.isResFree()&&(this.bounds=null,this.BV=null,this.BW=null,this.BX=null,this.BY=null,super.__$destroy())}testRay(t,e,s,i){return r.default.IntersectioNearSphere2(t,e,a.default.ZERO,this.EO,s)}toString(){return"Sphere3DMesh()"}}e.default=u},f208:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.info=""}}e.default=i},f367:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("29ef")),r=i(s("402a")),n=i(s("25cf")),h=i(s("8910"));class l extends r.default{constructor(t=null){super(t),this.A_T=!0,this.A_U=!1,this.EW=null,this.flipVerticalUV=!1,this.flip90UV=!1,this.setRenderState(a.default.BACK_ADD_BLENDSORT_STATE)}createMaterial(t){null==this.getMaterial()?(this.EW=new n.default(this.A_T,this.A_U),this.EW.setTextureList(t),this.setMaterial(this.EW)):(this.EW=this.getMaterial(),this.EW.setTextureList(t))}showDoubleFace(t=!0){t?this.setRenderState(a.default.NONE_CULLFACE_NORMAL_STATE):this.setRenderState(a.default.NORMAL_STATE)}toTransparentBlend(t=!1){this.A_T=!1,this.A_U=!0,t?this.setRenderState(a.default.BACK_TRANSPARENT_STATE):this.setRenderState(a.default.BACK_TRANSPARENT_ALWAYS_STATE)}toBrightnessBlend(t=!1){this.A_T=!0,this.A_U=!1,this.setRenderState(a.default.BACK_ADD_BLENDSORT_STATE)}setRGB3f(t,e,s){null!=this.EW&&this.EW.setRGB3f(t,e,s)}setRGBOffset3f(t,e,s){null!=this.EW&&this.EW.setRGBOffset3f(t,e,s)}setFadeFactor(t){null!=this.EW&&this.EW.setFadeFactor(t)}getFadeFactor(){return this.EW.getFadeFactor()}setBeginAndEndPos(t,e){if(null!=this.EW)return this.EW.setBeginAndEndPos(t,e)}setBeginPos(t){if(null!=this.EW)return this.EW.setBeginPos(t)}setEndPos(t){if(null!=this.EW)return this.EW.setEndPos(t)}setLineWidth(t){if(null!=this.EW)return this.EW.setLineWidth(t)}getLineWidth(){return null!=this.EW?this.EW.getLineWidth():0}setUVParam(t,e,s,i){if(null!=this.EW)return this.EW.setUVParam(t,e,s,i)}setUVScale(t,e){if(null!=this.EW)return this.EW.setUVScale(t,e)}setUVOffset(t,e){if(null!=this.EW)return this.EW.setUVOffset(t,e)}setFadeRange(t,e){if(null!=this.EW)return this.EW.setFadeRange(t,e)}setUVRotation(t){if(null!=this.EW)return this.EW.setUVRotation(t)}initialize(t=null){this.createMaterial(t),this.activeDisplay()}__activeMesh(t){if(null==this.getMesh()){let e=new h.default;e.flipVerticalUV=this.flipVerticalUV,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.flip90UV=this.flip90UV,e.setBufSortFormat(t.getBufSortFormat()),e.initializeBill(),this.setMesh(e)}}toString(){return"[BillboardLine3DEntity]"}}e.default=l},f3a2:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["None"]="",t["Default"]="pbr",t["Lambert"]="lambert",t["PBR"]="pbr"}(i||(i={})),e.ShaderCodeUUID=i},f444:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("1710")),r=s("bcac"),n=s("278e");class h{constructor(){this.A_h=null,this.F_I=new r.CameraDragSwinger,this.F_J=new n.CameraDragSlide,this.F_K=!0}initialize(t,e){null==this.A_h&&(this.A_h=t,this.F_I.initialize(t,e),this.F_J.initialize(t,e),t.addEventListener(a.default.MOUSE_BG_DOWN,this,this.mouseDownListener,!0,!1),t.addEventListener(a.default.MOUSE_UP,this,this.mouseUpListener,!1,!0))}setSlideSpeed(t){this.F_J.slideSpeed=t}enableSwing(){this.F_K=!0}enableSlide(){this.F_K=!1}mouseDownListener(t){this.F_I.attach(),this.F_J.attach()}mouseUpListener(t){this.F_I.detach(),this.F_J.detach()}detach(){this.F_I.detach(),this.F_J.detach()}runWithYAxis(){this.F_K?this.F_I.runWithYAxis():this.F_J.run()}runWithZAxis(){this.F_K?this.F_I.runWithZAxis():this.F_J.run()}}e.default=h},f48d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("8e17"));class r{constructor(){this.id=-1,this.position=new a.default}update(){}updateFast(){}}r.__tV0=new a.default,r.__tV1=new a.default,r.__tV2=new a.default,e.AbsGeomBase=r,e.default=r},f63b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("6e01")),r=s("8d98"),n=i(s("3b73"));function h(t,e,s){var i=document.createElement("canvas");i.width=e,i.height=s,i.style.backgroundColor="transparent",i.style.display="block",i.style.left="0px",i.style.top="0px",i.style.position="absolute";let a=i.getContext("2d");return a.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height),{canvas:i,ctx2d:a}}function l(t,e,s){var i=document.createElement("canvas");i.width=e,i.height=s,i.style.backgroundColor="transparent",i.style.display="block",i.style.left="0px",i.style.top="0px",i.style.position="absolute";let a=i.getContext("2d");return a.globalCompositeOperation="destination-atop",a.fillStyle="rgba(255, 255, 255, 1.0)",a.rect(0,0,i.width,i.height),a.fill(),a.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height),{canvas:i,ctx2d:a}}class o{constructor(t,e){this.F_L="",this.F_M=null,this.F_N=!1,this.F_O=0,this.texture=null,this.bytesTex=null,this.powerOf2Fix=!1,this.offsetTex=null,this.premultipliedAlpha=!0,this.F_L=t,this.F_O=e}startLoad(){if(null==this.F_M){let t=this;this.F_M=new Image,this.F_M.onload=function(e){t.F_N=!0,t.buildTex()},this.F_M.addEventListener("error",e=>{t.F_L}),this.F_M.crossOrigin="",this.F_M.src=this.F_L}}buildTex(){let t=this.F_M;if(null!=t&&this.F_N){let e=this.texture,s=this.offsetTex,i=this.bytesTex,r=null,o=a.default.IsPowerOf2(t.width)&&a.default.IsPowerOf2(t.height),_=this.powerOf2Fix;if(n.default.IsWebGL1()&&(_=!0),!o&&_){let o=a.default.CalcCeilPowerOfTwo(t.width),_=a.default.CalcCeilPowerOfTwo(t.height);o>n.default.MAX_TEXTURE_SIZE&&(o=n.default.MAX_TEXTURE_SIZE),_>n.default.MAX_TEXTURE_SIZE&&(o=n.default.MAX_TEXTURE_SIZE);let m=h(t,o,_),u=this.F_O;if(null!=e&&(e.setDataFromImage(m.canvas,u),e.name=this.F_M.src,null!=s&&(m=l(t,o,_),s.setDataFromImage(m.canvas,u))),null!=i)if(this.premultipliedAlpha)r=m.ctx2d.getImageData(0,0,m.canvas.width,m.canvas.height),i.setDataFromBytes(r.data,u,m.canvas.width,m.canvas.height),i.name=this.F_M.src;else{r=m.ctx2d.getImageData(0,0,m.canvas.width,m.canvas.height);let e=r.data,s=l(t,o,_);r=s.ctx2d.getImageData(0,0,s.canvas.width,s.canvas.height);let a=r.data,n=0,h=0,d=0;for(;n<_;++n)for(h=0;h<o;++h)e[d]+=255-a[d],e[d+1]+=255-a[d+1],e[d+2]+=255-a[d+2],d+=4;i.setDataFromBytes(e,u,m.canvas.width,m.canvas.height),i.name=this.F_M.src}}else if(null!=e)this.powerOf2Fix,e.setDataFromImage(t,this.F_O),e.name=this.F_M.src;else if(null!=i){let e=a.default.CalcNearestCeilPow2(t.width),s=a.default.CalcNearestCeilPow2(t.height);e>2048&&(e=2048),s>2048&&(e=2048);let n=h(t,e,s),l=this.F_O;r=n.ctx2d.getImageData(0,0,n.canvas.width,n.canvas.height),i.setDataFromBytes(r.data,l,n.canvas.width,n.canvas.height),i.name=this.F_M.src}this.F_N=!0}}getURL(){return this.F_L}getImage(){return this.F_M}isLoaded(){return this.F_N}destroy(){this.F_N=!1,this.F_L="",this.texture=null,this.F_M.src="",this.F_M=null}}class _{constructor(t){this.F_P=null,this.F_Q=[],this.Ek=0,this.F_N=!1,this.q_=[],this.F_R=[],this.F_P=t;var e=this;let s=0,i=null;for(;s<6;++s)i=new Image,i.onload=function(t){if(e.Ek++,e.Ek>=6){let t=0;for(t=0;t<6;++t)e.q_[0].setDataFromImageToFaceAt(t,e.F_Q[t],e.F_R[0]);e.q_[0].name=e.F_Q.src}},i.crossOrigin="",i.src=e.F_P[s],e.F_Q.push(i)}addTex(t,e){this.q_.push(t),this.F_R.push(e)}getURLAt(t){return this.F_P[0]}getTexAt(t){return this.q_[t]}isLoaded(){return this.F_N}destroy(){}}class m{constructor(t){this.F_S=new Map,this.C6=new Map,this.F_T=[],this.F_U=[],this.F_V=[],this.F_W=5,this.F_X=17,this.F_Y=17,this.F_Z=512,this.F_a=512,this.F_b=null,this.Cu=0,this.F_b=t,null!=t&&t.addTexLoader(this)}getTexByUrl(t,e=!0,s=!0,i=!1){let a=this.getImageTexByUrl(t,0,!1,i);return a.mipmapEnabled=s,e&&a.setWrap(r.TextureConst.WRAP_REPEAT),a}getBytesNoPremultipliedAlphaTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.C6.get(t);if(null==s){s=new o(t,e),s.premultipliedAlpha=!1,this.C6.set(t,s);let i=this.F_b.createBytesTex(1,1);return i.name=t,s.bytesTex=i,this.F_U.push(s),i}return s.bytesTex.isDestroyed()&&(s.bytesTex=this.F_b.createBytesTex(1,1)),s.bytesTex}getBytesTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.C6.get(t);if(null==s){s=new o(t,e),this.C6.set(t,s);let i=this.F_b.createBytesTex(1,1);return i.name=t,s.bytesTex=i,this.F_U.push(s),i}return s.bytesTex.isDestroyed()&&(s.bytesTex=this.F_b.createBytesTex(1,1)),s.bytesTex}getImageOffsetTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.C6.get(t);return null!=s?s.offsetTex:null}getImageTexByUrl(t,e=0,s=!1,i=!1){if(""==t)return null;e<0&&(e=0);let a=this.C6.get(t);if(null==a){a=new o(t,e),a.powerOf2Fix=i,s&&(a.offsetTex=this.F_b.createImageTex2D(1,1)),this.C6.set(t,a);let r=this.F_b.createImageTex2D(1,1);return r.name=t,a.texture=r,this.F_U.push(a),r}return a.texture.isDestroyed()&&(a.texture=this.F_b.createImageTex2D(1,1)),a.texture}getCubeTexAndLoadImg(t,e,s=0){if(""==t||null==e||e.length<6)return null;s<0&&(s=0);let i=this.F_S.get(t);if(null==i){i=new _(e),this.F_S.set(t,i);let a=this.F_b.createImageCubeTex(8,8);return i.addTex(a,s),a}return i.getTexAt(0)}setRunFlag(t){this.Cu=t}getRunFlag(){return this.Cu}isRunning(){return!0}isStopped(){return!1}run(){let t=0,e=null;if(--this.F_X,this.F_X<1){this.F_X=this.F_Y;let s=this.F_V.length;if(s>0)for(;t<s;++t)this.F_V[t].isLoaded()&&(this.F_T.push(this.F_V[t]),this.F_V.splice(t,1),--t,--s);let i=this.F_U.length;if(i>0&&s<this.F_W)for(t=s;t<this.F_W;++t){if(!(this.F_U.length>0))break;e=this.F_U.pop(),this.F_V.push(e),e.startLoad()}}if(--this.F_Z,this.F_Z<1){this.F_Z=this.F_a;let s=null,i=this.F_T.length;for(t=0;t<i;++t)e=this.F_T[t],s=null!=e.texture?e.texture:e.bytesTex,s.isDestroyed()&&(this.C6.delete(e.getURL()),this.F_T.splice(t,1),e.destroy(),--t,--i)}}getWaitTotal(){return this.F_U.length}isLoadedAll(){return this.F_U.length<1}}e.default=m},f63e:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("b3bd")),r=i(s("0fc4")),n=i(s("faa5"));class h extends n.default{constructor(){super(),this.Ak="",this.normalEnabled=!1}initialize(t){super.initialize(t),this.Ak="VOX_Default3DShd",this.F_d&&(this.Ak+="_tex"),this.vertColorEnabled&&(this.Ak+="_vtxColor"),this.premultiplyAlpha&&(this.Ak+="_preMulAlpha"),this.adaptationShaderVersion=!1}buildShader(){let t=this.A_R;t.addVertLayout("vec3","a_vs"),t.addFragUniform("vec4","u_color"),t.useVertSpaceMats(!0,!0,!0),this.F_d&&(this.A_S.addDiffuseMap(),t.addVertLayout("vec2","a_uvs"),t.addVarying("vec2","v_uv")),this.normalEnabled&&(t.addVertLayout("vec3","a_nvs"),t.addVarying("vec3","v_nv")),this.vertColorEnabled&&(t.addVertLayout("vec3","a_cvs"),t.addVarying("vec3","v_cv")),t.addFragOutput("vec4","FragColor0"),t.addFragMainCode("\n    FragColor0 = vec4(1.0);\n    #ifdef VOX_USE_2D_MAP\n        //  FragColor0 *= VOX_Texture2D(VOX_DIFFUSE_MAP, vec2(v_uv[0],v_uv[1]));\n        FragColor0 *= VOX_Texture2D(VOX_DIFFUSE_MAP, v_uv.xy);\n    #endif\n    #ifdef VOX_USE_VTX_COLOR\n        FragColor0.xyz *= v_cv.xyz;\n    #endif\n    #ifdef VOX_PREMULTIPLY_ALPHA\n        FragColor0.rgb *= u_color.xyz;\n        FragColor0.a *= u_color.w;\n        FragColor0.rgb *= u_color.aaa;\n    #else\n        FragColor0 *= u_color;\n    #endif\n    #ifdef VOX_USE_NORMAL\n        FragColor0.xyz *= abs(v_nv.xyz);\n    #endif\n"),t.addVertMainCode("\n    localPosition = vec4(a_vs.xyz,1.0);\n    worldPosition = u_objMat * localPosition;\n    oWorldPosition = worldPosition;\n    viewPosition = u_viewMat * worldPosition;\n    gl_Position = u_projMat * viewPosition;\n\n    #ifdef VOX_USE_2D_MAP\n        v_uv = a_uvs.xy;\n    #endif\n    #ifdef VOX_USE_NORMAL\n        v_nv = a_nvs.xyz;\n    #endif\n    #ifdef VOX_USE_VTX_COLOR\n        v_cv = a_cvs.xyz;\n    #endif\n")}getUniqueShaderName(){return this.Ak}}class l extends r.default{constructor(){super(),this.BJ=new Float32Array([1,1,1,1]),this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.normalEnabled=!1,null==l.G7&&(l.G7=new h)}buildBuf(){let t=l.G7;t.getShaderCodeBuilder().normalEnabled=this.normalEnabled,t.vertColorEnabled=this.vertColorEnabled,t.premultiplyAlpha=this.premultiplyAlpha,t.normalEnabled=this.normalEnabled}getCodeBuf(){return l.G7}setRGB3f(t,e,s){this.BJ[0]=t,this.BJ[1]=e,this.BJ[2]=s}getRGB3f(t){let e=this.BJ;t.setRGB3f(e[0],e[1],e[2])}setRGBA4f(t,e,s,i){this.BJ[0]=t,this.BJ[1]=e,this.BJ[2]=s,this.BJ[3]=i}getRGBA4f(t){let e=this.BJ;t.setRGBA4f(e[0],e[1],e[2],e[3])}setAlpha(t){this.BJ[3]=t}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_color"],t.dataList=[this.BJ],t}}l.G7=null,e.default=l},f928:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("8d98"),r=i(s("df25"));class n extends r.default{constructor(t,e,s=!1){super(t,e,s),this.n=a.TextureProxyType.Float,this.minFilter=a.TextureConst.LINEAR,this.internalFormat=a.TextureFormat.RGBA16F,this.dataType=a.TextureDataType.FLOAT,this.unpackAlignment=4}toAlphaFormat(){this.srcFormat=a.TextureFormat.ALPHA,this.internalFormat=a.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=a.TextureFormat.RED,this.internalFormat=a.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=a.TextureFormat.RGB,this.internalFormat=a.TextureFormat.RGB16F,this.unpackAlignment=1}toRGBAFormat(){this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA,this.unpackAlignment=4}toRGBAFloatFormat(){this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA16F,this.unpackAlignment=4}setDataFromBytes(t,e=0,s=-1,i=-1,a=0,r=0,n=!1){super.setDataFromBytes(t,e,s,i,a,r,n)}setPartDataFromeBytes(t,e,s,i,a,r=0){super.setPartDataFromeBytes(t,e,s,i,a,r)}getPixels(t,e,s,i,a){super.getPixels(t,e,s,i,a)}toString(){return"[FloatTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},fa60:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("919c"));class r extends a.default{constructor(){super(),this.vao=null,this.T=r.F_j++}run(){this.Aj.testVROUid(this.T)&&(this.Aj.bindVertexArray(this.vao),(this.Aj.testRIOUid(this.Bx)||a.default.Gq!=this.DS)&&(a.default.Gq=this.DS,this.Aj.bindEleBuf(this.ibuf)))}__$destroy(){a.default.Gk.delete(this.DS),this.DS=0,this.Bx=-1,this.ibuf=null,this.vao=null,this.Aj=null}restoreThis(){null!=this.vao&&this.Aj.deleteVertexArray(this.vao),r.Restore(this)}toString(){return"VaoVertexRenderObj(uid = "+this.T+", type="+this.DS+")"}static HasMid(t){return a.default.Gk.has(t)}static GetByMid(t){return a.default.Gk.get(t)}static GetFreeId(){return r.Gl.length>0?r.Gl.pop():-1}static Create(t,e,s){let i=null,n=r.GetFreeId();return n>=0?(i=r.Gm[n],r.Gn[n]=r.S_FLAG_BUSY,i.setMidAndBufUid(e,s)):(i=new r,i.setMidAndBufUid(e,s),r.Gm.push(i),r.Gn.push(r.S_FLAG_BUSY),r.Go++),i.setRC(t),a.default.Gk.set(e,i),i}static Restore(t){if(null!=t&&t.c<1&&r.Gn[t.getUid()]==r.S_FLAG_BUSY){let e=t.getUid();r.Gl.push(e),r.Gn[e]=r.S_FLAG_FREE,t.__$destroy()}}}r.F_j=0,r.S_FLAG_BUSY=1,r.S_FLAG_FREE=0,r.Gn=[],r.Go=0,r.Gm=[],r.Gl=[],e.default=r},faa5:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("f3a2"),r=i(s("4a54")),n=s("5216"),h=s("3113");class l{constructor(){this.A_R=null,this.F_c=null,this.q_=null,this.F_d=!0,this.pipeline=null,this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.shadowReceiveEnabled=!1,this.lightEnabled=!1,this.fogEnabled=!1,this.envAmbientLightEnabled=!1,this.brightnessOverlayEnabeld=!1,this.glossinessEnabeld=!0,this.pipeTypes=null,this.keysString="",this.adaptationShaderVersion=!0,null==l.G9&&(l.G8=new h.ShaderCodeUniform,l.G9=new r.default(l.G8),l.G8.__$setCodeBuilder(l.G9))}reset(){this.A_R=l.G9,this.A_S=l.G8,this.F9=this.A_S,this.A_R.reset(),this.q_=null,this.pipeTypes=null,this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.shadowReceiveEnabled=!1,this.lightEnabled=!1,this.fogEnabled=!1,this.envAmbientLightEnabled=!1,this.brightnessOverlayEnabeld=!1,this.glossinessEnabeld=!0,this.keysString=""}clear(){this.A_R=null}setShaderCodeObject(t){this.F_c=t}getShaderCodeObject(){return this.F_c}getShaderCodeObjectUUID(){return a.ShaderCodeUUID.None}getShaderCodeBuilder(){return l.G9}static GetPreCompileInfo(){return l.G9.getPreCompileInfo()}initialize(t){null!=l.__$s_csBuf&&l.__$s_csBuf!=this&&l.__$s_csBuf.initialize(t),this.F_d=t,this.bufInitWithPipeline()}buildDefine(){this.premultiplyAlpha&&(this.A_R.addDefine("VOX_PREMULTIPLY_ALPHA"),this.keysString+="A"),this.vertColorEnabled&&(this.A_R.addDefine("VOX_USE_VTX_COLOR"),this.keysString+="UVC"),this.brightnessOverlayEnabeld&&(this.A_R.addDefine("VOX_USE_BRIGHTNESS_OVERLAY_COLOR"),this.keysString+="UBOC"),this.glossinessEnabeld&&(this.A_R.addDefine("VOX_USE_GLOSSINESS"),this.keysString+="UG")}buildPipelineParams(){null!=this.pipeline&&null==this.pipeTypes&&(this.pipeTypes=[],this.lightEnabled&&this.pipeTypes.push(n.MaterialPipeType.GLOBAL_LIGHT),this.shadowReceiveEnabled&&this.pipeTypes.push(n.MaterialPipeType.VSM_SHADOW),this.fogEnabled&&this.pipeTypes.push(n.MaterialPipeType.FOG_EXP2),this.envAmbientLightEnabled&&this.pipeTypes.push(n.MaterialPipeType.ENV_AMBIENT_LIGHT))}getTexturesFromPipeline(t){null!=this.pipeline&&this.pipeline.getTextures(this.A_R,t,this.pipeTypes)}bufInitWithPipeline(){null!=this.pipeline&&(this.buildPipelineParams(),this.pipeline.buildSharedUniforms(this.pipeTypes),this.pipeline.createKeys(this.pipeTypes),this.keysString+=this.pipeline.getKeysString())}isTexEanbled(){return this.F_d}setIRenderTextureList(t){this.q_=t}getIRenderTextureList(){return this.q_}buildShader(){}getFragShaderCode(){return l.__$s_csBuf!=this?l.__$s_csBuf.getFragShaderCode():this.A_R.buildFragCode()}getVertShaderCode(){return l.__$s_csBuf!=this?l.__$s_csBuf.getVertShaderCode():this.A_R.buildVertCode()}getUniqueShaderName(){if(l.__$s_csBuf!=this)return l.__$s_csBuf.getUniqueShaderName()}toString(){return"[ShaderCodeBuffer()]"}static UseShaderBuffer(t){null!=l.__$s_csBuf&&l.__$s_csBuf.clear(),l.__$s_csBuf=t}}l.__$s_csBuf=null,e.default=l},fae3:function(t,e,s){"use strict";s.r(e);s("1eb2");var i=s("b88e");for(var a in i)["default"].indexOf(a)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(a)},fc07:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("3b73")),r=i(s("2e8a")),n=i(s("78e9"));class h{constructor(){this.F_e=new Map,this.attriNSList=null,this.attriSizeList=null,this.uniformNameListStr="",this.texUniformNameListStr="",this.attributes=[null,null,null,null,null,null,null,null,null,null,null,null],this.uniforms=null,this.texTotal=0,this.fragOutputTotal=0}reset(){this.attriNSList=null,this.uniformNameListStr="",this.texUniformNameListStr="";let t=0;for(;t<12;++t)this.attributes[t]=null;this.uniforms=null,this.F_e.clear(),this.texTotal=0}parseVShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let s="\n",i=t.indexOf(s),a=0,h=[],l="",o="",_=new RegExp(" ","g");while(i>=0)l=t.slice(a,i),l.length>0&&(o=l.replace(_,""),0!=o.indexOf("//")&&h.push(l)),a=i+1,i=t.indexOf(s,a);l=t.slice(a,t.length),l.length>0&&(o=l.replace(_,""),0!=o.indexOf("//")&&h.push(l));let m="uniform ",u=h.length,d=null;for(i=0;i<12;++i)this.attributes[i]=null;this.attriNSList=[],this.attriSizeList=[];let c=null;null==this.uniforms&&(this.uniforms=[]),i=0;let f=!1,p=!1;while(i<u)l=h[i],f=l.indexOf("layout")>=0,p=l.indexOf("attribute ")>=0,f&&l.indexOf("location")>0||p?(d=new r.default,d.layoutEnabled=f,d.parseCode(l),this.attributes[d.attriType]=d,this.attriNSList.push(d.name),this.attriSizeList.push(d.typeSize)):l.indexOf(m)>=0&&(c=new n.default,c.parseCode(l)&&(this.uniforms.push(c),this.uniformNameListStr+=c.name+",",c.isTex&&!this.F_e.has(c.name)&&(this.F_e.set(c.name,1),this.texUniformNameListStr+=c.name+",",this.texTotal++))),++i}parseFShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let s="\n",i=t.indexOf(s),r=0,h=[],l="",o="",_=new RegExp(" ","g");while(i>=0)l=t.slice(r,i),l.length>0&&(o=l.replace(_,""),0!=o.indexOf("//")&&h.push(l)),r=i+1,i=t.indexOf(s,r);l=t.slice(r,t.length),l.length>0&&(o=o.replace(_,""),0!=o.indexOf("//")&&h.push(l));let m="uniform ",u=h.length,d=null;null==this.uniforms&&(this.uniforms=[]),i=0;while(i<u)l=h[i],l.indexOf(m)>=0&&this.uniformNameListStr.indexOf(m)<0&&(d=new n.default,d.parseCode(l)&&(this.uniforms.push(d),this.uniformNameListStr+=d.name+",",d.isTex&&!this.F_e.has(d.name)&&(this.F_e.set(d.name,1),this.texUniformNameListStr+=d.name+",",this.texTotal++))),++i;let c="layout";a.default.IsWebGL1()&&(c="gl_FragData"),i=t.indexOf(c),this.fragOutputTotal=0;while(i>0)this.fragOutputTotal++,i=t.indexOf(c,i+2);this.fragOutputTotal<1&&(this.fragOutputTotal=1)}}e.default=h},fe7f:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=s("8d98"),r=i(s("df25"));class n extends r.default{constructor(t,e,s=!1){super(t,e,s),this.n=a.TextureProxyType.Bytes}toAlphaFormat(){this.srcFormat=a.TextureFormat.ALPHA,this.internalFormat=a.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=a.TextureFormat.RED,this.internalFormat=a.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=a.TextureFormat.RGB,this.internalFormat=a.TextureFormat.RGB,this.unpackAlignment=3}toRGBAFormat(){this.srcFormat=a.TextureFormat.RGBA,this.internalFormat=a.TextureFormat.RGBA,this.unpackAlignment=4}setDataFromBytes(t,e=0,s=-1,i=-1,a=0,r=0,n=!1){super.setDataFromBytes(t,e,s,i,a,r,n)}setPartDataFromeBytes(t,e,s,i,a,r=0){super.setPartDataFromeBytes(t,e,s,i,a,r)}getPixels(t,e,s,i,a){super.getPixels(t,e,s,i,a)}toString(){return"[BytesTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},fecb:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const a=i(s("6e01")),r=i(s("8e17"));class n{constructor(){this.min=new r.default(a.default.MATH_MAX_POSITIVE,a.default.MATH_MAX_POSITIVE,a.default.MATH_MAX_POSITIVE),this.max=new r.default(a.default.MATH_MIN_NEGATIVE,a.default.MATH_MIN_NEGATIVE,a.default.MATH_MIN_NEGATIVE),this.version=-1,this.radius=50,this.radius2=2500,this.center=new r.default(0,0,0),this.F_f=100,this.B_v=100,this.B_w=100,this.F_g=50,this.F_h=50,this.F_i=50,this.Ew=new r.default}getLong(){return this.F_f}getWidth(){return this.B_v}getHeight(){return this.B_w}reset(){this.min.setXYZ(a.default.MATH_MAX_POSITIVE,a.default.MATH_MAX_POSITIVE,a.default.MATH_MAX_POSITIVE),this.max.setXYZ(a.default.MATH_MIN_NEGATIVE,a.default.MATH_MIN_NEGATIVE,a.default.MATH_MIN_NEGATIVE)}equals(t){return this.min.equalsXYZ(t.min)&&this.max.equalsXYZ(t.max)}setVolume(t,e,s){this.B_v=t,this.B_w=e,this.F_f=s,this.F_g=.5*this.F_f,this.F_h=.5*this.B_v,this.F_i=.5*this.B_w,this.max.x=this.center.x+this.F_h,this.max.y=this.center.y+this.F_i,this.max.z=this.center.z+this.F_g,this.min.x=this.center.x-this.F_h,this.min.y=this.center.y-this.F_i,this.min.z=this.center.z-this.F_g,this.radius2=this.F_h*this.F_h+this.F_i*this.F_i+this.F_g*this.F_g,this.radius=Math.sqrt(this.radius2)}union(t){this.addPosition(t.min),this.addPosition(t.max)}addPosition(t){this.min.x>t.x&&(this.min.x=t.x),this.min.y>t.y&&(this.min.y=t.y),this.min.z>t.z&&(this.min.z=t.z),this.max.x<t.x&&(this.max.x=t.x),this.max.y<t.y&&(this.max.y=t.y),this.max.z<t.z&&(this.max.z=t.z)}addXYZ(t,e,s){this.min.x>t&&(this.min.x=t),this.min.y>e&&(this.min.y=e),this.min.z>s&&(this.min.z=s),this.max.x<t&&(this.max.x=t),this.max.y<e&&(this.max.y=e),this.max.z<s&&(this.max.z=s)}addXYZFloat32Arr(t,e=3){let s=t.length,i=0,a=0,r=0;for(let n=0;n<s;)i=t[n],a=t[n+1],r=t[n+2],n+=e,this.min.x>i&&(this.min.x=i),this.min.y>a&&(this.min.y=a),this.min.z>r&&(this.min.z=r),this.max.x<i&&(this.max.x=i),this.max.y<a&&(this.max.y=a),this.max.z<r&&(this.max.z=r)}addXYZFloat32AndIndicesArr(t,e){let s,i=e.length,a=0,r=0,n=0;for(let h=0;h<i;h++)s=3*h,a=t[s++],r=t[s++],n=t[s],this.min.x>a&&(this.min.x=a),this.min.y>r&&(this.min.y=r),this.min.z>n&&(this.min.z=n),this.max.x<a&&(this.max.x=a),this.max.y<r&&(this.max.y=r),this.max.z<n&&(this.max.z=n)}getClosePosition(t,e,s=0){e.copyFrom(t),e.x<this.min.x?e.x=this.min.x+s:e.x>this.max.x&&(e.x=this.max.x-s),e.y<this.min.y?e.y=this.min.y+s:e.y>this.max.y&&(e.y=this.max.y-s),e.z<this.min.z?e.z=this.min.z+s:e.z>this.max.z&&(e.z=this.max.z-s)}containsV(t){return!(t.x<this.max.x||t.x>this.max.x)&&(!(t.y<this.max.y||t.y>this.max.y)&&!(t.z<this.max.z||t.z>this.max.z))}containsXY(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.y||e>this.max.y)}containsXZ(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.z||e>this.max.z)}containsYZ(t,e){return!(t<this.min.y||t>this.max.y)&&!(e<this.min.z||e>this.max.z)}update(){this.B_v=this.max.x,this.min.x>this.max.x&&(this.max.x=this.min.x,this.min.x=this.B_v),this.B_v=this.max.x-this.min.x,this.B_w=this.max.y,this.min.y>this.max.y&&(this.max.y=this.min.y,this.min.y=this.B_w),this.B_w=this.max.y-this.min.y,this.F_f=this.max.z,this.min.z>this.max.z&&(this.max.z=this.min.z,this.min.z=this.F_f),this.F_f=this.max.z-this.min.z,this.center.x=.5*this.B_v,this.center.y=.5*this.B_w,this.center.z=.5*this.F_f,this.F_g=this.center.z,this.F_h=this.center.x,this.F_i=this.center.y,this.radius2=this.F_h*this.F_h+this.F_i*this.F_i+this.F_g*this.F_g,this.radius=Math.sqrt(this.radius2),this.center.x+=this.min.x,this.center.y+=this.min.y,this.center.z+=this.min.z,++this.version}updateVolume(){this.B_v=this.max.x-this.min.x,this.B_w=this.max.y-this.min.y,this.F_f=this.max.z-this.min.z,this.F_g=.5*this.F_f,this.F_h=.5*this.B_v,this.F_i=.5*this.B_w,++this.version}copyFrom(t){this.radius=t.radius,this.radius2=t.radius2,this.min.copyFrom(t.min),this.max.copyFrom(t.max),this.center.copyFrom(t.center),this.updateVolume()}updateFast(){this.B_v=this.max.x-this.min.x,this.B_w=this.max.y-this.min.y,this.F_f=this.max.z-this.min.z,this.center.x=.5*this.B_v,this.center.y=.5*this.B_w,this.center.z=.5*this.F_f,this.F_g=this.center.z,this.F_h=this.center.x,this.F_i=this.center.y,this.radius2=this.F_h*this.F_h+this.F_i*this.F_i+this.F_g*this.F_g,this.radius=Math.sqrt(this.radius2),this.center.x+=this.min.x,this.center.y+=this.min.y,this.center.z+=this.min.z,++this.version}toString(){return"[AABB(min->"+this.min+",size("+this.B_v+","+this.B_w+","+this.F_f+"))]"}sphereIntersect(t,e){this.Ew.x=this.center.x-t.x,this.Ew.y=this.center.y-t.y,this.Ew.z=this.center.z-t.z;let s=this.Ew.getLengthSquared();return s<this.radius2||(e+=this.radius,e*=e,e>=s)}intersectRL(t,e){let s=0,i=(this.min.x-e.x)/t.x,a=(this.max.x-e.x)/t.x;i>a&&(s=a,a=i,i=s);let r=(this.min.y-e.y)/t.y,n=(this.max.y-e.y)/t.y;if(r>n&&(s=n,n=r,r=s),i>n||r>a)return!1;r>i&&(i=r),n<a&&(a=n);let h=(this.min.z-e.z)/t.z,l=(this.max.z-e.z)/t.z;return h>l&&(s=l,l=h,h=s),!(i>l||h>a)&&(h>i&&(i=h),l<a&&(a=l),!0)}static IntersectionRL3(t,e,s,i,a,r){return s.w=(t[e[0]].x-a.x)*s.x,i.w=(t[1-e[0]].x-a.x)*s.x,r.x=(t[e[1]].y-a.y)*s.y,r.y=(t[1-e[1]].y-a.y)*s.y,!(s.w>r.y||r.x>i.w)&&(r.x>s.w&&(s.w=r.x),r.y<i.w&&(i.w=r.y),r.x=(t[e[2]].z-a.z)*s.z,r.y=(t[1-e[2]].z-a.z)*s.z,!(s.w>r.y||r.x>i.w)&&(r.x>s.w&&(s.w=r.x),r.y<i.w&&(i.w=r.y),r.copyFrom(i),r.scaleBy(s.w),r.addBy(a),i.w=1,!0))}static IntersectionRL1(t,e,s,i){let a=0,r=(s.min.x-e.x)/t.x,n=(s.max.x-e.x)/t.x;r>n&&(a=n,n=r,r=a);let h=(s.min.y-e.y)/t.y,l=(s.max.y-e.y)/t.y;if(h>l&&(a=l,l=h,h=a),r>l||h>n)return!1;h>r&&(r=h),l<n&&(n=l);let o=(s.min.z-e.z)/t.z,_=(s.max.z-e.z)/t.z;return o>_&&(a=_,_=o,o=a),!(r>_||o>n)&&(o>r&&(r=o),_<n&&(n=_),i.copyFrom(t),i.scaleBy(r),i.addBy(e),!0)}static IntersectionRL2(t,e,s,i){i.x=s.center.x-e.x,i.y=s.center.y-e.y,i.z=s.center.z-e.z;let a=i.dot(t);if(i.x-=a*t.x,i.y-=a*t.y,i.z-=a*t.z,i.getLengthSquared()>s.radius2)return!1;if(s.containsV(e))return i.copyFrom(e),!0;if(e.x<s.min.x){if(t.x>0&&(a=(s.min.x-e.x)/t.x,i.copyFrom(t),i.scaleBy(a),i.addBy(e),s.containsYZ(i.y,i.z)))return!0}else if(e.x>s.max.x&&t.x<0&&(a=(s.max.x-e.x)/t.x,i.copyFrom(t),i.scaleBy(a),i.addBy(e),s.containsYZ(i.y,i.z)))return!0;if(e.y<s.min.y){if(t.y>0&&(a=(s.min.y-e.y)/t.y,i.copyFrom(t),i.scaleBy(a),i.addBy(e),s.containsXZ(i.x,i.z)))return!0}else if(e.y>s.max.y&&t.y<0&&(a=s.max.y,a=(s.max.y-e.y)/t.y,i.copyFrom(t),i.scaleBy(a),i.addBy(e),s.containsXZ(i.x,i.z)))return!0;if(e.z<s.min.z){if(t.z>0&&(a=(s.min.z-e.z)/t.z,i.copyFrom(t),i.scaleBy(a),i.addBy(e),s.containsXY(i.x,i.y)))return!0}else if(e.z>s.max.z&&t.z<0&&(a=(s.max.z-e.z)/t.z,i.copyFrom(t),i.scaleBy(a),i.addBy(e),s.containsXY(i.x,i.y)))return!0;return!1}}n.___pnV=new r.default,e.default=n}})}));