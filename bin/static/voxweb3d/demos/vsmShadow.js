(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["VoxApp"]=e():t["VoxApp"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s="fae3")}({"0236":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("a996")),a=i(s("1710")),n=i(s("7045")),h=i(s("3024")),o=i(s("badb"));class l{constructor(t,e){this.m_rcuid=0,this.pixelRatio=1,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.m_viewX=0,this.m_viewY=0,this.m_viewW=1,this.m_viewH=1,this.m_mouseEvtDispatcher=new o.default,this.m_resize_listener=[],this.m_resize_ers=[],this.m_enterFrame_listener=[],this.m_enterFrame_ers=[],this.m_keyDown_listener=[],this.m_keyDown_ers=[],this.m_keyUp_listener=[],this.m_keyUp_ers=[],this.uProbe=null,this.m_preStageWidth=0,this.m_preStageHeight=0,this.m_mouseEvt=new a.default,this.m_autoSynViewAndStageSize=!0,this.m_enterFrameEvt=new r.default,this.m_rcuid=t}getRCUid(){return this.m_rcuid}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.m_viewX}getViewY(){return this.m_viewY}getViewWidth(){return this.m_viewW}getViewHeight(){return this.m_viewH}setViewPort(t,e,s,i){this.m_autoSynViewAndStageSize=!1,this.m_viewX=t,this.m_viewY=e,s==this.m_viewW&&i==this.m_viewH||(this.m_viewW=s,this.m_viewH=i,this.updateViewUData())}updateViewUData(){null==this.uProbe&&(this.uProbe=new h.default(1),this.uProbe.bindSlotAt(this.m_rcuid)),this.uProbe.setVec4Data(2/(this.m_viewW*this.pixelRatio),2/(this.m_viewH*this.pixelRatio),this.m_viewW*this.pixelRatio,this.m_viewH*this.pixelRatio),this.uProbe.update(),this.m_preStageWidth=this.m_viewW,this.m_preStageHeight=this.m_viewH}update(){this.m_preStageWidth==this.stageWidth&&this.m_preStageHeight==this.stageHeight||(this.m_autoSynViewAndStageSize&&(this.m_viewW=this.stageWidth,this.m_viewH=this.stageHeight,this.updateViewUData()),this.stageHalfWidth=.5*this.stageWidth,this.stageHalfHeight=.5*this.stageHeight)}mouseDown(t=1){this.m_mouseEvt.type=a.default.MOUSE_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseUp(t=1){this.m_mouseEvt.phase=1,this.m_mouseEvt.type=a.default.MOUSE_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseClick(){this.m_mouseEvt.type=a.default.MOUSE_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseDoubleClick(){this.m_mouseEvt.type=a.default.MOUSE_DOUBLE_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightDown(t=1){this.m_mouseEvt.type=a.default.MOUSE_RIGHT_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightUp(t=1){this.m_mouseEvt.type=a.default.MOUSE_RIGHT_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseBgDown(){this.m_mouseEvt.type=a.default.MOUSE_BG_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseBgUp(){this.m_mouseEvt.type=a.default.MOUSE_BG_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightClick(){this.m_mouseEvt.type=a.default.MOUSE_RIGHT_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMove(){this.m_mouseEvt.type=a.default.MOUSE_MOVE,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseWheel(t){this.m_mouseEvt.type=a.default.MOUSE_WHEEL,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.wheelDeltaY=t.wheelDeltaY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseCancel(){this.m_mouseEvt.type=a.default.MOUSE_CANCEL,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiDown(t){this.m_mouseEvt.type=a.default.MOUSE_MULTI_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiUp(t){this.m_mouseEvt.type=a.default.MOUSE_MULTI_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiMove(t){this.m_mouseEvt.type=a.default.MOUSE_MULTI_MOVE,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseWindowUp(t=1){}mouseWindowRightUp(t=1){}enterFrame(){this.m_enterFrameEvt.type=r.default.ENTER_FRAME;let t=this.m_enterFrame_listener.length;for(var e=0;e<t;++e)this.m_enterFrame_listener[e].call(this.m_enterFrame_ers[e],this.m_enterFrameEvt)}addEventListener(t,e,s,i=!0,a=!0){if(null!=s&&null!=e){let h=0;switch(t){case r.default.RESIZE:break;case r.default.ENTER_FRAME:for(h=this.m_enterFrame_listener.length-1;h>=0;--h)if(e===this.m_enterFrame_ers[h])break;h<0&&(this.m_enterFrame_ers.push(e),this.m_enterFrame_listener.push(s));break;case n.default.KEY_DOWN:break;case n.default.KEY_UP:break;default:this.m_mouseEvtDispatcher.addEventListener(t,e,s,i,a);break}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=0;switch(t){case r.default.RESIZE:for(i=this.m_resize_listener.length-1;i>=0;--i)if(e===this.m_resize_ers[i]){this.m_resize_ers.splice(i,1),this.m_resize_listener.splice(i,1);break}break;case r.default.ENTER_FRAME:for(i=this.m_enterFrame_listener.length-1;i>=0;--i)if(e===this.m_enterFrame_ers[i]){this.m_enterFrame_ers.splice(i,1),this.m_enterFrame_listener.splice(i,1);break}break;case n.default.KEY_DOWN:for(i=this.m_keyDown_listener.length-1;i>=0;--i)if(e===this.m_keyDown_ers[i]){this.m_keyDown_ers.splice(i,1),this.m_keyDown_listener.splice(i,1);break}break;case n.default.KEY_UP:for(i=this.m_keyUp_listener.length-1;i>=0;--i)if(e===this.m_keyUp_ers[i]){this.m_keyUp_ers.splice(i,1),this.m_keyUp_listener.splice(i,1);break}break;default:this.m_mouseEvtDispatcher.removeEventListener(t,e,s);break}}}}e.default=l},"030e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Initialize(t,e){let s=this;1==t?(s.OES_standard_derivatives=e.getExtension("OES_standard_derivatives"),s.OES_standard_derivatives,s.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),s.EXT_shader_texture_lod,s.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),s.WEBGL_draw_buffers,s.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),s.OES_vertex_array_object,s.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),s.ANGLE_instanced_arrays,s.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),s.EXT_color_buffer_float,s.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),s.EXT_color_buffer_half_float,s.OES_texture_half_float=e.getExtension("OES_texture_half_float"),s.OES_texture_half_float,s.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),s.OES_texture_half_float_linear,s.OES_texture_float=e.getExtension("OES_texture_float"),s.OES_texture_float,s.OES_element_index_uint=e.getExtension("OES_element_index_uint"),s.OES_element_index_uint,s.EXT_blend_minmax=e.getExtension("EXT_blend_minmax"),s.EXT_blend_minmax):(s.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),s.EXT_shader_texture_lod,s.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),s.EXT_color_buffer_half_float,s.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),s.OES_texture_half_float_linear,s.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),s.EXT_color_buffer_float),s.OES_texture_float_linear=e.getExtension("OES_texture_float_linear"),s.OES_texture_float_linear,s.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),s.WEBGL_depth_texture,s.WEBGL_debug_renderer_info=e.getExtension("WEBGL_debug_renderer_info"),s.WEBGL_debug_renderer_info}}i.OES_standard_derivatives=null,i.EXT_shader_texture_lod=null,i.WEBGL_draw_buffers=null,i.OES_vertex_array_object=null,i.ANGLE_instanced_arrays=null,i.EXT_color_buffer_float=null,i.EXT_color_buffer_half_float=null,i.OES_texture_float_linear=null,i.OES_texture_half_float_linear=null,i.OES_texture_half_float=null,i.OES_texture_float=null,i.OES_element_index_uint=null,i.EXT_blend_minmax=null,i.WEBGL_depth_texture=null,i.WEBGL_debug_renderer_info=null,e.default=i},"0644":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("2139"));class h{constructor(){this.m_matrix=n.default.GetMatrix(),this.m_position=new a.default,this.m_direction=new a.default,this.m_angle=0,this.m_updateEnabled=!1,this.m_camera=null}destroy(){this.m_camera=null}bindCamera(t){this.m_camera=t,null!=t&&(this.m_direction.copyFrom(this.m_camera.getPosition()),this.m_direction.subtractBy(this.m_camera.getLookAtPosition()))}update(){null!=this.m_camera&&this.m_updateEnabled&&(this.m_updateEnabled=!1)}rotationOffsetAngleWorldY(t){this.m_angle=t,this.m_updateEnabled=!0,this.m_direction.copyFrom(this.m_camera.getPosition()),this.m_direction.subtractBy(this.m_camera.getLookAtPosition()),this.m_matrix.identity(),this.m_matrix.appendRotationY(this.m_angle*r.default.MATH_PI_OVER_180),this.m_position.copyFrom(this.m_direction),this.m_matrix.transformVectorSelf(this.m_position),this.m_position.addBy(this.m_camera.getLookAtPosition()),this.m_camera.lookAtRH(this.m_position,this.m_camera.getLookAtPosition(),a.default.Y_AXIS)}rotationOffsetAngleWordX(t){this.m_angle=t,this.m_updateEnabled=!0,this.m_direction.copyFrom(this.m_camera.getPosition()),this.m_direction.subtractBy(this.m_camera.getLookAtPosition()),this.m_matrix.identity(),this.m_matrix.appendRotationX(this.m_angle*r.default.MATH_PI_OVER_180),this.m_position.copyFrom(this.m_direction),this.m_matrix.transformVectorSelf(this.m_position),this.m_position.addBy(this.m_camera.getLookAtPosition()),this.m_camera.lookAtRH(this.m_position,this.m_camera.getLookAtPosition(),a.default.X_AXIS)}rotationOffsetAngleWordZ(t){this.m_angle=t,this.m_updateEnabled=!0,this.m_direction.copyFrom(this.m_camera.getPosition()),this.m_direction.subtractBy(this.m_camera.getLookAtPosition()),this.m_matrix.identity(),this.m_matrix.appendRotationZ(this.m_angle*r.default.MATH_PI_OVER_180),this.m_position.copyFrom(this.m_direction),this.m_matrix.transformVectorSelf(this.m_position),this.m_position.addBy(this.m_camera.getLookAtPosition()),this.m_camera.lookAtRH(this.m_position,this.m_camera.getLookAtPosition(),a.default.Z_AXIS)}}e.default=h},"0714":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_shaderCode=null,this.m_pipeMap=new Map,this.m_keys=[],this.m_sharedUniforms=null,this.m_texList=null}setTextureList(t){this.m_texList=t}getTextureList(){return this.m_texList}getTextureTotal(){return null!=this.m_texList?this.m_texList.length:0}addShaderCode(t){this.m_shaderCode=t}hasShaderCode(){return null!=this.m_shaderCode}addPipe(t){let e=t.getPipeTypes();for(let s=0;s<e.length;++s)this.m_pipeMap.has(e[s])||this.m_pipeMap.set(e[s],t)}getPipeByType(t){return this.m_pipeMap.get(t)}hasPipeByType(t){return this.m_pipeMap.has(t)}createKeys(t){if(this.m_sharedUniforms=[],this.m_keys=[],null!=t){let e,s,i=t;for(let t=0;t<i.length;++t)s=i[t],this.m_pipeMap.has(s)&&(e=this.m_pipeMap.get(s),this.m_keys.push(e.getPipeKey(s)))}}build(t,e){if(null!=this.m_shaderCode&&t.addShaderObject(this.m_shaderCode),this.m_sharedUniforms=[],null!=e){let s,i,r=e;for(let e=0;e<r.length;++e)i=r[e],this.m_pipeMap.has(i)&&(s=this.m_pipeMap.get(i),s.useShaderPipe(t,i),this.m_sharedUniforms.push(s.getGlobalUinform()))}}getSharedUniforms(){return this.m_sharedUniforms}getSelfUniformData(){return null}getKeys(){return this.m_keys}getKeysString(){let t="";for(let e=0;e<this.m_keys.length;++e)t+=this.m_keys[e];return t}reset(){this.m_texList=null}clear(){this.m_pipeMap=new Map,this.m_keys=[],this.m_sharedUniforms=null,this.m_shaderCode=null}}e.MaterialPipeline=i},"0851":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("6e01")),n=i(s("da6a"));class h{constructor(t,e,s=!1){this.m_uid=-1,this.m_attachCount=0,this.m_renderProxy=null,this.m_slot=null,this.m_miplevel=-1,this.m_texWidth=128,this.m_texHeight=128,this.m_texBufW=128,this.m_texBufH=128,this.m_texTarget=r.TextureTarget.TEXTURE_2D,this.m_sampler=-1,this.m_haveRData=!1,this.m_type=r.TextureProxyType.Default,this.m_generateMipmap=!0,this.name="TextureProxy",this.internalFormat=r.TextureFormat.RGBA,this.srcFormat=r.TextureFormat.RGBA,this.dataType=r.TextureDataType.UNSIGNED_BYTE,this.wrap_s=r.TextureConst.WRAP_CLAMP_TO_EDGE,this.wrap_t=r.TextureConst.WRAP_CLAMP_TO_EDGE,this.wrap_r=r.TextureConst.WRAP_CLAMP_TO_EDGE,this.mipmapEnabled=!1,this.flipY=!1,this.premultiplyAlpha=!1,this.unpackAlignment=4,this.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,this.magFilter=r.TextureConst.LINEAR,this.version=0,this.m_slot=n.default.GetInstance(),this.m_uid=this.m_slot.getFreeUid(),t<1&&(t=128),e<1&&(e=128),s?(this.m_texWidth=a.default.CalcNearestCeilPow2(t),this.m_texHeight=a.default.CalcNearestCeilPow2(e)):(this.m_texWidth=t,this.m_texHeight=e),this.m_slot.__$$addTexture(this)}__$$use(t){t.bindToGpu(this.getResUid())}__$setRenderProxy(t){null!=this.m_slot||(this.m_slot=n.default.GetInstance(),this.m_uid=this.m_slot.getFreeUid(),this.m_slot.__$$addTexture(this)),this.m_renderProxy=t}__$attachThis(){-1==this.m_attachCount&&(this.m_slot.removeFreeUid(this.getUid()),this.m_attachCount=0),++this.m_attachCount}__$detachThis(){this.m_attachCount>0&&(--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=-1,this.m_slot.addFreeUid(this.getUid())))}getAttachCount(){return this.m_attachCount}isDirect(){return!0}getType(){return this.m_type}getResUid(){return this.m_uid}getUid(){return this.m_uid}setWrap(t){this.wrap_s=this.wrap_t=this.wrap_r=t}isGpuEnabled(){return null!=this.m_renderProxy&&this.m_renderProxy.Texture.hasResUid(this.getResUid())}getSampler(){return this.m_sampler}getTargetType(){return this.m_texTarget}getBufWidth(){return this.m_texBufW}getBufHeight(){return this.m_texBufH}getWidth(){return this.m_texWidth}getHeight(){return this.m_texHeight}isDataEnough(){return this.m_haveRData}uploadFromFbo(t,e,s){}__$buildParam(t){this.m_texBufW=this.m_texWidth,this.m_texBufH=this.m_texHeight,t.texParameteri(this.m_sampler,t.TEXTURE_WRAP_S,r.TextureConst.GetConst(t,this.wrap_s)),t.texParameteri(this.m_sampler,t.TEXTURE_WRAP_T,r.TextureConst.GetConst(t,this.wrap_t)),t.texParameteri(this.m_sampler,t.TEXTURE_MIN_FILTER,r.TextureConst.GetConst(t,this.minFilter)),t.texParameteri(this.m_sampler,t.TEXTURE_MAG_FILTER,r.TextureConst.GetConst(t,this.magFilter)),this.m_texTarget==r.TextureTarget.TEXTURE_3D&&(t.texParameteri(this.m_sampler,t.TEXTURE_WRAP_R,r.TextureConst.GetConst(t,this.wrap_r)),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_BASE_LEVEL,0),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MAX_LEVEL,Math.log2(this.m_texWidth))),this.mipmapEnabled&&this.m_generateMipmap&&t.generateMipmap(this.m_sampler)}generateMipmap(t){if(this.mipmapEnabled&&this.m_generateMipmap){let e=t.getRC();t.bindToGpu(this.getResUid()),this.__$buildParam(e)}}uploadData(t){}__$updateToGpu(t){}updateDataToGpu(t=null,e=!0){null!=t&&(this.m_renderProxy=t),null!=this.m_renderProxy&&this.m_renderProxy.MaterialUpdater.updateTextureData(this,e)}createTexBuf(t){return!t.hasResUid(this.getResUid())&&(this.m_sampler=r.TextureTarget.GetValue(t.getRC(),this.m_texTarget),t.createResByParams3(this.getResUid(),this.getWidth(),this.getHeight(),this.m_sampler),!0)}__$$upload(t){if(this.m_haveRData&&null!=this.m_slot){let e=this.createTexBuf(t);e&&(this.__$updateToGpuBegin(t),this.uploadData(t),this.__$buildParam(t.getRC()),this.m_generateMipmap=!0)}}dataUploadToGpu(t,e,s,i=!1){this.version=0;let a=r.TextureFormat.ToGL(t,this.internalFormat),n=r.TextureFormat.ToGL(t,this.srcFormat),h=r.TextureDataType.ToGL(t,this.dataType),o=e;if(null==s)(o.status>-1||i)&&o.updateToGpu(t,this.m_sampler,a,n,h,i);else{let e=s;for(let s=0,r=e.length;s<r;++s)o=e[s],null!=o&&(o.status>-1||i)&&o.updateToGpu(t,this.m_sampler,a,n,h,i);this.m_generateMipmap=!1}}__$updateToGpuBegin(t){let e=t.getRC();t.bindToGpu(this.getResUid()),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,this.unpackAlignment)}__$updateToGpuEnd(t){}isDestroyed(){return this.m_attachCount<-1}__$destroy(){this.getAttachCount()<1&&(this.m_attachCount=-2,this.m_haveRData=!1,this.m_texWidth=1,this.m_texHeight=1,this.m_renderProxy=null)}__$$removeFromSlot(){null!=this.m_slot&&-2==this.getAttachCount()&&(this.m_slot=null,this.m_renderProxy=null,this.m_uid=-1)}toString(){return"[TextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.TextureProxy=h,e.default=h},"0890":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("1710")),a=s("bcac");class n{constructor(){this.m_stage3D=null,this.m_dragSwinger=new a.CameraDragSwinger}initialize(t,e){null==this.m_stage3D&&(this.m_stage3D=t,this.m_dragSwinger.initialize(t,e),t.addEventListener(r.default.MOUSE_BG_DOWN,this,this.mouseDownListener,!0,!1),t.addEventListener(r.default.MOUSE_UP,this,this.mouseUpListener,!1,!0))}mouseDownListener(t){this.m_dragSwinger.attach()}mouseUpListener(t){this.m_dragSwinger.detach()}detach(){this.m_dragSwinger.detach()}runWithYAxis(){this.m_dragSwinger.runWithYAxis()}runWithZAxis(){this.m_dragSwinger.runWithZAxis()}}e.default=n},"090c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3bda")),a=i(s("030e")),n=i(s("3b73")),h=i(s("b0ef")),o=i(s("0c85")),l=s("e08e");class _{constructor(){this.m_uid=_.s_uid++,this.m_mouseEvtDisplather=new o.default,this.m_div=null,this.m_canvas=null,this.m_document=null,this.m_scissorEnabled=!1,this.m_depthTestEnabled=!0,this.m_stencilTestEnabled=!0,this.m_offcanvas=null,this.m_gl=null,this.m_stage=null,this.m_viewX=0,this.m_viewY=0,this.m_viewWidth=800,this.m_viewHeight=600,this.m_maxWebGLVersion=2,this.m_webGLVersion=2,this.m_devicePixelRatio=1,this.m_viewEle=new h.default,this.autoSyncRenderBufferAndWindowSize=!0,this.offscreenRenderEnabled=!1,this.m_WEBGL_lose_context=null,this.m_displayWidth=0,this.m_displayHeight=0,this.m_rcanvasWidth=0,this.m_rcanvasHeight=0,this.m_resizeCallback=null,this.m_resizeCallbackTarget=null}contextrestoredHandler(t){}contextlostHandler(t){}setWebGLMaxVersion(t){1!=t&&2!=t||(this.m_maxWebGLVersion=t)}getWebGLVersion(){return this.m_webGLVersion}getDiv(){return this.m_div}setDivStyleLeftAndTop(t,e){this.m_viewEle.setDivStyleLeftAndTop(t,e)}setDivStyleSize(t,e){this.m_viewEle.setDivStyleSize(t,e)}getCanvas(){return this.m_canvas}isDepthTestEnabled(){return this.m_depthTestEnabled}isStencilTestEnabled(){return this.m_stencilTestEnabled}initialize(t,e,s,i=null){this.m_stage=e;var h=null,o=null;try{void 0!=document&&(h=document,o=window)}catch(u){}if(null!=h){this.m_viewEle.setDiv(s),this.m_viewEle.createViewEle(h,this.autoSyncRenderBufferAndWindowSize),this.m_div=s=this.m_viewEle.getDiv();let u=this.m_canvas=this.m_viewEle.getCanvas();this.m_devicePixelRatio=window.devicePixelRatio,this.m_mouseEvtDisplather.dpr=this.m_devicePixelRatio;let m=i;null==i?m={depth:this.m_depthTestEnabled,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:this.m_stencilTestEnabled,preserveDrawingBuffer:!0,powerPreference:"default"}:(this.m_depthTestEnabled=m.depth,this.m_stencilTestEnabled=m.stencil);let d=null;if(this.offscreenRenderEnabled&&(d=u.transferControlToOffscreen()),this.m_offcanvas=d,2==this.m_maxWebGLVersion&&(this.m_gl=null==d?u.getContext("webgl2",m):d.getContext("webgl2",m),null!=this.m_gl&&(this.m_webGLVersion=2)),null==this.m_gl&&(this.m_gl=null==d?u.getContext("webgl",m)||u.getContext("experimental-webgl",m):d.getContext("webgl",m)||d.getContext("experimental-webgl",m),null!=this.m_gl&&(this.m_webGLVersion=1)),!this.m_gl)throw this.m_webGLVersion=-1,alert("Unable to initialize WebGL. Your browser or machine may not support it."),Error("WebGL initialization failure.");let c=this.m_gl;c.rcuid=t;let f=l.GLStencilFunc;f.NEVER=c.NEVER,f.LESS=c.LESS,f.EQUAL=c.EQUAL,f.GREATER=c.GREATER,f.NOTEQUAL=c.NOTEQUAL,f.GEQUAL=c.GEQUAL,f.ALWAYS=c.ALWAYS;let p=l.GLStencilOp;p.KEEP=c.KEEP,p.ZERO=c.ZERO,p.REPLACE=c.REPLACE,p.INCR=c.INCR,p.INCR_WRAP=c.INCR_WRAP,p.DECR=c.DECR,p.DECR_WRAP=c.DECR_WRAP,p.INVERT=c.INVERT;let g=l.GLBlendMode;g.ZERO=c.ZERO,g.ONE=c.ONE,g.SRC_COLOR=c.SRC_COLOR,g.DST_COLOR=c.DST_COLOR,g.SRC_ALPHA=c.SRC_ALPHA,g.DST_ALPHA=c.DST_ALPHA,g.ONE_MINUS_SRC_ALPHA=c.ONE_MINUS_SRC_ALPHA;let v=l.GLBlendEquation;v.FUNC_ADD=c.FUNC_ADD,v.FUNC_SUBTRACT=c.FUNC_SUBTRACT,v.FUNC_REVERSE_SUBTRACT=c.FUNC_REVERSE_SUBTRACT,v.MIN_EXT=c.MIN_EXT,v.MAX_EXT=c.MAX_EXT,v.MIN=c.MIN,v.MAX=c.MAX;let x=l.CullFaceMode;x.BACK=c.BACK,x.FRONT=c.FRONT,x.FRONT_AND_BACK=c.FRONT_AND_BACK;let y=n.default;y.MAX_TEXTURE_SIZE=this.m_gl.getParameter(this.m_gl.MAX_TEXTURE_SIZE),y.MAX_RENDERBUFFER_SIZE=this.m_gl.getParameter(this.m_gl.MAX_RENDERBUFFER_SIZE);let T=this.m_gl.getParameter(this.m_gl.MAX_VIEWPORT_DIMS);y.MAX_VIEWPORT_WIDTH=T[0],y.MAX_VIEWPORT_HEIGHT=T[1],a.default.Initialize(this.m_webGLVersion,this.m_gl),n.default.Initialize([this.m_webGLVersion]),null!=e&&this.m_mouseEvtDisplather.initialize(u,s,e);let b=a.default.WEBGL_debug_renderer_info;if(null!=b){let t=this.m_gl.getParameter(b.UNMASKED_VENDOR_WEBGL),e=this.m_gl.getParameter(b.UNMASKED_RENDERER_WEBGL);y.GPU_VENDOR=t,y.GPU_RENDERER=t,r.default.ShowLog("webgl_vendor: "+t),r.default.ShowLog("webgl_renderer: "+e)}var _=this;o.onresize=function(t){_.autoSyncRenderBufferAndWindowSize&&_.updateRenderBufferSize()},u.addEventListener("webglcontextrestored",this.contextrestoredHandler,!1),u.addEventListener("webglcontextlost",this.contextlostHandler,!1),this.updateRenderBufferSize()}}loseContext(){null==this.m_WEBGL_lose_context&&(this.m_WEBGL_lose_context=this.m_gl.getExtension("WEBGL_lose_context")),null==this.m_WEBGL_lose_context&&this.m_WEBGL_lose_context.loseContext()}isContextLost(){return this.m_gl.isContextLost()}getRC(){return this.m_gl}setScissorEnabled(t){t?this.m_scissorEnabled||(this.m_scissorEnabled=!0,this.m_gl.enable(this.m_gl.SCISSOR_TEST)):this.m_scissorEnabled&&(this.m_scissorEnabled=!1,this.m_gl.disable(this.m_gl.SCISSOR_TEST))}setScissorRect(t,e,s,i){this.m_gl.scissor(t,e,s,i)}setResizeCallback(t,e){this.m_resizeCallbackTarget=t,this.m_resizeCallback=e}getDevicePixelRatio(){return this.m_devicePixelRatio}resizeBufferSize(t,e){t=Math.floor(t),e=Math.floor(e);let s=window.devicePixelRatio,i=Math.abs(s-this.m_devicePixelRatio)>.02;this.m_devicePixelRatio=s,this.m_mouseEvtDisplather.dpr=s,n.default.SetDevicePixelRatio(this.m_devicePixelRatio),(this.m_displayWidth!=t||this.m_displayHeight!=e||i)&&(this.m_displayWidth=t,this.m_displayHeight=e,this.m_rcanvasWidth=Math.floor(t*s),this.m_rcanvasHeight=Math.floor(e*s),null==this.m_offcanvas?(this.m_canvas.width=this.m_rcanvasWidth,this.m_canvas.height=this.m_rcanvasHeight):(this.m_offcanvas.width=this.m_rcanvasWidth,this.m_offcanvas.height=this.m_rcanvasHeight),this.m_canvas.style.width=this.m_displayWidth+"px",this.m_canvas.style.height=this.m_displayHeight+"px",null!=this.m_stage&&(this.m_stage.stageWidth=this.m_rcanvasWidth,this.m_stage.stageHeight=this.m_rcanvasHeight,this.m_stage.viewWidth=this.m_displayWidth,this.m_stage.viewHeight=this.m_displayHeight,this.m_stage.pixelRatio=s,this.m_stage.update()),null!=this.m_resizeCallback&&this.m_resizeCallback.call(this.m_resizeCallbackTarget))}getStage(){return this.m_stage}getStageWidth(){return this.m_stage.stageWidth}getStageHeight(){return this.m_stage.stageHeight}getDisplayWidth(){return this.m_displayWidth}getDisplayHeight(){return this.m_displayHeight}setViewport(t,e,s,i){let r=this.m_viewX!=t||this.m_viewY!=e;(this.m_viewWidth!=s||this.m_viewHeight!=i||r)&&(this.m_viewX=t,this.m_viewY=e,this.m_viewWidth=s,this.m_viewHeight=i)}setViewportSize(t,e){this.m_viewWidth==t&&this.m_viewHeight==e||(this.m_viewWidth=t,this.m_viewHeight=e)}testViewPortChanged(t,e,s,i){return this.m_viewX!=t||this.m_viewY!=e||this.m_viewWidth!=s||this.m_viewHeight!=i}getViewportX(){return this.m_viewX}getViewportY(){return this.m_viewY}getViewportWidth(){return this.m_viewWidth}getViewportHeight(){return this.m_viewHeight}getFBOWidth(){return this.m_viewWidth<n.default.MAX_RENDERBUFFER_SIZE?this.m_viewWidth:n.default.MAX_RENDERBUFFER_SIZE}getFBOHeight(){return this.m_viewHeight<n.default.MAX_RENDERBUFFER_SIZE?this.m_viewHeight:n.default.MAX_RENDERBUFFER_SIZE}getRCanvasWidth(){return this.m_rcanvasWidth}getRCanvasHeight(){return this.m_rcanvasHeight}updateRenderBufferSize(){let t=this.m_div.getBoundingClientRect();this.resizeBufferSize(t.width,t.height)}}_.s_uid=0,e.default=_},"0929":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("2139")),n=i(s("9156"));class h{constructor(){this.m_uid=0,this.m_fs32=new Float32Array(16),this.m_invMatEnabled=!1,this.m_rotFlag=!1,this.updatedStatus=h.UPDATE_POSITION,this.updateStatus=h.UPDATE_TRANSFORM,this.m_omat=null,this.m_localMat=null,this.m_parentMat=null,this.m_toParentMat=null,this.m_toParentMatFlag=!0,this.m_invOmat=null,this.m_uid=h.s_uid++}getUid(){return this.m_uid}getRotationFlag(){return this.m_rotFlag}getX(){return this.m_fs32[12]}getY(){return this.m_fs32[13]}getZ(){return this.m_fs32[14]}setX(t){this.updateStatus|=1,this.updatedStatus|=1,this.m_fs32[12]=t}setY(t){this.updateStatus|=1,this.updatedStatus|=1,this.m_fs32[13]=t}setZ(t){this.updateStatus|=1,this.updatedStatus|=1,this.m_fs32[14]=t}setXYZ(t,e,s){this.m_fs32[12]=t,this.m_fs32[13]=e,this.m_fs32[14]=s,this.updateStatus|=1,this.updatedStatus|=1}offsetPosition(t){this.m_fs32[12]+=t.x,this.m_fs32[13]+=t.y,this.m_fs32[14]+=t.z,this.updateStatus|=1,this.updatedStatus|=1}setPosition(t){this.m_fs32[12]=t.x,this.m_fs32[13]=t.y,this.m_fs32[14]=t.z,this.updateStatus|=1,this.updatedStatus|=1}getPosition(t){t.x=this.m_fs32[12],t.y=this.m_fs32[13],t.z=this.m_fs32[14]}copyPositionFrom(t){null!=t&&(this.m_fs32[12]=t.m_fs32[12],this.m_fs32[13]=t.m_fs32[13],this.m_fs32[14]=t.m_fs32[14],this.updateStatus|=h.UPDATE_POSITION,this.updatedStatus|=h.UPDATE_POSITION)}getRotationX(){return this.m_fs32[1]}getRotationY(){return this.m_fs32[6]}getRotationZ(){return this.m_fs32[9]}setRotationX(t){this.m_fs32[1]=t,this.m_rotFlag=!0,this.updateStatus|=h.UPDATE_ROTATION,this.updatedStatus|=h.UPDATE_ROTATION}setRotationY(t){this.m_fs32[6]=t,this.m_rotFlag=!0,this.updateStatus|=h.UPDATE_ROTATION,this.updatedStatus|=h.UPDATE_ROTATION}setRotationZ(t){this.m_fs32[9]=t,this.m_rotFlag=!0,this.updateStatus|=h.UPDATE_ROTATION,this.updatedStatus|=h.UPDATE_ROTATION}setRotationXYZ(t,e,s){this.m_fs32[1]=t,this.m_fs32[6]=e,this.m_fs32[9]=s,this.updateStatus|=h.UPDATE_ROTATION,this.updatedStatus|=h.UPDATE_ROTATION,this.m_rotFlag=!0}getScaleX(){return this.m_fs32[0]}getScaleY(){return this.m_fs32[5]}getScaleZ(){return this.m_fs32[10]}setScaleX(t){this.m_fs32[0]=t,this.updateStatus|=h.UPDATE_SCALE,this.updatedStatus|=h.UPDATE_SCALE}setScaleY(t){this.m_fs32[5]=t,this.updateStatus|=h.UPDATE_SCALE,this.updatedStatus|=h.UPDATE_SCALE}setScaleZ(t){this.m_fs32[10]=t,this.updateStatus|=h.UPDATE_SCALE,this.updatedStatus|=h.UPDATE_SCALE}setScaleXYZ(t,e,s){this.m_fs32[0]=t,this.m_fs32[5]=e,this.m_fs32[10]=s,this.updateStatus|=h.UPDATE_SCALE,this.updatedStatus|=h.UPDATE_SCALE}setScale(t){this.m_fs32[0]=t,this.m_fs32[5]=t,this.m_fs32[10]=t,this.updateStatus|=h.UPDATE_SCALE,this.updatedStatus|=h.UPDATE_SCALE}getRotationXYZ(t){t.x=this.m_fs32[1],t.y=this.m_fs32[6],t.z=this.m_fs32[9]}getScaleXYZ(t){t.x=this.m_fs32[0],t.y=this.m_fs32[5],t.z=this.m_fs32[10]}localToGlobal(t){this.getMatrix().transformVectorSelf(t)}globalToLocal(t){this.getInvMatrix().transformVectorSelf(t)}getInvMatrix(){return null!=this.m_invOmat?this.m_invMatEnabled&&(this.m_invOmat.copyFrom(this.m_omat),this.m_invOmat.invert()):(this.m_invOmat=a.default.GetMatrix(),this.m_invOmat.copyFrom(this.m_omat),this.m_invOmat.invert()),this.m_invMatEnabled=!1,this.m_invOmat}getLocalMatrix(){return this.updateStatus>0&&this.update(),this.m_localMat}getMatrix(t=!0){return this.updateStatus>0&&t&&this.update(),this.m_omat}getToParentMatrix(){return null!=this.m_toParentMat?this.m_toParentMat:this.m_omat}setParentMatrix(t){this.m_parentMat=t,this.m_invMatEnabled=!0,null!=this.m_parentMat&&(this.m_localMat==this.m_omat?(this.updateStatus=h.UPDATE_TRANSFORM,this.updatedStatus=this.updateStatus,this.m_localMat=a.default.GetMatrix()):(this.updateStatus|=h.UPDATE_PARENT_MAT,this.updatedStatus=this.updateStatus))}updateMatrixData(t){null!=t&&(this.updateStatus=h.UPDATE_NONE,this.m_invMatEnabled=!0,this.m_omat.copyFrom(t))}__$setMatrix(t){null!=t&&(this.updateStatus=h.UPDATE_NONE,this.m_invMatEnabled=!0,this.m_localMat==this.m_omat&&(this.m_localMat=t),null!=this.m_omat&&(n.default.RemoveTransUniform(this.m_omat),a.default.RetrieveMatrix(this.m_omat)),this.m_omat=t)}destroy(){null!=this.m_invOmat&&a.default.RetrieveMatrix(this.m_invOmat),null!=this.m_localMat&&(this.m_omat==this.m_localMat&&n.default.RemoveTransUniform(this.m_omat),a.default.RetrieveMatrix(this.m_localMat)),null!=this.m_omat&&this.m_omat!=this.m_localMat&&(n.default.RemoveTransUniform(this.m_omat),a.default.RetrieveMatrix(this.m_omat)),this.m_invOmat=null,this.m_localMat=null,this.m_omat=null,this.m_parentMat=null,this.updateStatus=h.UPDATE_TRANSFORM}copyFrom(t){this.m_fs32.set(t.m_fs32,0),this.updatedStatus|=1,this.updateStatus|=h.UPDATE_TRANSFORM,this.m_rotFlag=t.m_rotFlag}update(){this.updateStatus>0&&(this.m_invMatEnabled=!0,this.updateStatus=this.updateStatus|this.updatedStatus,(this.updateStatus&h.UPDATE_TRANSFORM)>0&&(this.m_localMat.getLocalFS32().set(this.m_fs32,0),this.m_rotFlag&&this.m_localMat.setRotationEulerAngle(this.m_fs32[1]*r.default.MATH_PI_OVER_180,this.m_fs32[6]*r.default.MATH_PI_OVER_180,this.m_fs32[9]*r.default.MATH_PI_OVER_180),null!=this.m_parentMat&&(this.updateStatus=this.updateStatus|h.UPDATE_PARENT_MAT)),this.m_omat!=this.m_localMat&&this.m_omat.copyFrom(this.m_localMat),(this.updateStatus&h.UPDATE_PARENT_MAT)==h.UPDATE_PARENT_MAT&&(null!=this.m_toParentMat||(this.m_toParentMat=a.default.GetMatrix()),this.m_toParentMat.copyFrom(this.m_omat),this.m_toParentMatFlag=!0,this.m_omat.append(this.m_parentMat)),this.updateStatus=h.UPDATE_NONE)}getMatrixFS32(){return this.getMatrix().getLocalFS32()}toString(){return"[ROTransform(uid = "+this.m_uid+")]"}static GetFreeId(){return h.m_freeIdList.length>0?h.m_freeIdList.pop():-1}static Create(t=null){let e=null,s=h.GetFreeId();return s>=0?(e=h.m_unitList[s],h.m_unitFlagList[s]=h.S_FLAG_BUSY):(e=new h,h.m_unitList.push(e),h.m_unitFlagList.push(h.S_FLAG_BUSY),h.m_unitListLen++),e.m_omat=null==t?a.default.GetMatrix():t,e.m_localMat=e.m_omat,e.m_fs32.set(h.s_initData,0),e}static Restore(t){if(null!=t&&h.m_unitFlagList[t.getUid()]==h.S_FLAG_BUSY){let e=t.getUid();h.m_freeIdList.push(e),h.m_unitFlagList[e]=h.S_FLAG_FREE,t.destroy()}}}h.s_uid=0,h.s_initData=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),h.UPDATE_NONE=0,h.UPDATE_POSITION=1,h.UPDATE_ROTATION=2,h.UPDATE_SCALE=4,h.UPDATE_TRANSFORM=7,h.UPDATE_PARENT_MAT=8,h.S_FLAG_BUSY=1,h.S_FLAG_FREE=0,h.m_unitFlagList=[],h.m_unitListLen=0,h.m_unitList=[],h.m_freeIdList=[],e.default=h},"0a1c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.wapperStr=null,this.wasmBin=null,this.m_loaded_callback=null,this.m_loaded_callback_target=null}load(t,e){this.m_loaded_callback=t,this.m_loaded_callback_target=e;let s="static/extern/draco/w.md",i="static/extern/draco/d.md",r=new XMLHttpRequest;r.open("GET",s,!0),r.responseType="text",r.onload=()=>{this.wapperStr=r.response,this.loadedRes()},r.send(null);let a=new XMLHttpRequest;a.open("GET",i,!0),a.responseType="arraybuffer",a.onload=()=>{this.wasmBin=a.response,this.loadedRes()},a.send(null)}loadedRes(){null!=this.wasmBin&&null!=this.wapperStr&&this.m_loaded_callback.call(this.m_loaded_callback_target,{wapper:this.wapperStr,wasm:this.wasmBin})}}e.default=i},"0c85":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73"));class a{constructor(){this.m_singleDown=!1,this.dpr=1}initMobile(t,e,s){var i=null;try{void 0!=document&&(i=document)}catch(a){}if(null!=i){let t=this;if(e.addEventListener("touchstart",t=>{let e=t.targetTouches,i=0,r=0;if(e.length<2)i=0|this.dpr*t.targetTouches[0].pageX,r=0|this.dpr*t.targetTouches[0].pageY,s.mouseX=i,s.mouseY=s.stageHeight-r,s.mouseViewX=i,s.mouseViewY=r,this.m_singleDown=!0,s.mouseDown(1);else{let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiDown(a),this.m_singleDown=!1}t.preventDefault(),t.stopPropagation()},!1),e.addEventListener("touchend",t=>{this.m_singleDown=!1;let e=t.targetTouches,i=0,r=0;if(e.length<1)s.mouseUp(1);else{let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiUp(a)}t.preventDefault()},!1),e.addEventListener("touchcancel",e=>{t.m_singleDown=!1;e.targetTouches;s.mouseCancel(),e.preventDefault()},!1),e.addEventListener("touchmove",t=>{t.preventDefault();let e=t.targetTouches,i=0,r=0;if(this.m_singleDown&&(i=0|this.dpr*e[0].pageX,r=0|this.dpr*e[0].pageY,s.mouseViewX=i,s.mouseViewY=r,s.mouseX=i,s.mouseY=s.stageHeight-r,s.mouseMove()),e.length>1){let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiMove(a)}},{passive:!1},!1),r.default.IsIpadOS()){let t=document.createElement("meta");t.name="viewport",t.content="width=device-width,initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no",document.getElementsByTagName("head")[0].appendChild(t)}}}initialize(t,e,s){r.default.IsMobileWeb()||r.default.IsIpadOS()||this.initPC(t,e,s),this.initMobile(t,e,s)}initPC(t,e,s){var i=null;try{void 0!=document&&(i=document)}catch(r){}if(null!=i){if(void 0==t.onmousewheel&&void 0!=t.addEventListener){let e=function(t){t.wheelDeltaY=-t.detail,s.mouseWheel(t)};t.addEventListener("DOMMouseScroll",e,!1)}t.onmousewheel=t=>{t.preventDefault(),t.stopPropagation(),s.mouseWheel(t)},t.onmousedown=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,0==t.button?s.mouseDown(1):2==t.button&&s.mouseRightDown(1)},t.onmouseup=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,0==t.button?s.mouseUp(1):2==t.button&&s.mouseRightUp(1)},document.onmouseup=t=>{0==t.button?s.mouseWindowUp(1):2==t.button&&s.mouseWindowRightUp(1)},t.onmousemove=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,s.mouseMove()},t.onclick=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,0==t.button?s.mouseClick():2==t.button&&s.mouseRightClick()},t.ondblclick=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,0==t.button?s.mouseDoubleClick():t.button}}}}e.default=a},"0e01":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("baae")),a=i(s("5326")),n=i(s("29ef")),h=i(s("de9d")),o=i(s("4f27")),l=i(s("7499"));class _{constructor(t){this.m_adapter=null,this.m_renderProxy=null,this.m_materialProxy=null,this.m_cameraNear=.1,this.m_cameraFar=5e3,this.m_cameraFov=45,this.m_rcuid=0,this.m_rcuid=t,this.m_renderProxy=new h.default(t)}getRCUid(){return this.m_rcuid}getDiv(){return this.m_adapter.getDiv()}getCanvas(){return this.m_adapter.getCanvas()}getRenderAdapter(){return this.m_adapter}getRenderMaterialProxy(){return this.m_materialProxy}getRenderProxy(){return this.m_renderProxy}getTextureResTotal(){return this.m_renderProxy.Texture.getTextureResTotal()}getTextureAttachTotal(){return this.m_renderProxy.Texture.getAttachTotal()}getDevicePixelRatio(){return this.m_adapter.getDevicePixelRatio()}getStage3D(){return this.m_renderProxy.getStage3D()}getCamera(){return null!=this.m_renderProxy?this.m_renderProxy.getCamera():null}cameraLock(){this.m_renderProxy.cameraLock()}cameraUnlock(){this.m_renderProxy.cameraUnlock()}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}updateCameraDataFromCamera(t){null!=this.m_renderProxy&&this.m_renderProxy.updateCameraDataFromCamera(t)}lockRenderColorMask(){null!=this.m_renderProxy&&this.m_renderProxy.lockRenderState()}unlockColorMask(){null!=this.m_renderProxy&&this.m_renderProxy.unlockRenderState()}useGlobalColorMask(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderColorMask(),this.m_renderProxy.useRenderColorMask(t),this.m_renderProxy.lockRenderColorMask())}useGlobalRenderColorMaskByName(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderColorMask(),this.m_renderProxy.useRenderColorMask(n.default.GetRenderColorMaskByName(t)),this.m_renderProxy.lockRenderColorMask())}lockRenderState(){null!=this.m_renderProxy&&this.m_renderProxy.lockRenderState()}unlockRenderState(){null!=this.m_renderProxy&&this.m_renderProxy.unlockRenderState()}useGlobalRenderState(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderState(),this.m_renderProxy.useRenderState(t),this.m_renderProxy.lockRenderState())}useGlobalRenderStateByName(t){null!=this.m_renderProxy&&(this.m_renderProxy.unlockRenderState(),this.m_renderProxy.useRenderState(n.default.GetRenderStateByName(t)),this.m_renderProxy.lockRenderState())}getRenderStateByName(t){return n.default.GetRenderStateByName(t)}lockMaterial(){null!=this.m_materialProxy&&this.m_materialProxy.lockMaterial()}unlockMaterial(){null!=this.m_materialProxy&&this.m_materialProxy.unlockMaterial()}isUnlockMaterial(){return this.m_materialProxy.isUnlockMatrial()}useGlobalMaterial(t,e=!1){null!=this.m_materialProxy&&(this.m_materialProxy.unlockMaterial(),e?this.m_materialProxy.unlockTexture():this.m_materialProxy.lockTexture(),this.m_materialProxy.useGlobalMaterial(t),this.m_materialProxy.lockMaterial())}clearBackBuffer(){this.m_renderProxy.clearBackBuffer()}setScissorRect(t,e,s,i){this.m_adapter.setScissorRect(t,e,s,i)}setScissorEnabled(t){this.m_adapter.setScissorEnabled(t)}setViewPort(t,e,s,i){this.m_renderProxy.setViewPort(t,e,s,i)}synFBOSizeWithViewport(){this.m_adapter.synFBOSizeWithViewport()}asynFBOSizeWithViewport(){this.m_adapter.asynFBOSizeWithViewport()}setFBOSizeFactorWithViewPort(t){this.m_adapter.setFBOSizeFactorWithViewPort(t)}createFBOAt(t,e,s,i,r=!1,a=!1,n=0){this.m_adapter.createFBOAt(t,e,s,i,r,a,n)}bindFBOAt(t,e){this.m_adapter.bindFBOAt(t,e)}setRenderToTexture(t,e=!1,s=!1,i=0){this.m_adapter.setRenderToTexture(t,e,s,i)}useFBO(t=!1,e=!1,s=!1){this.m_adapter.useFBO(t,e,s)}resetFBOAttachmentMask(t){this.m_adapter.resetFBOAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){this.m_adapter.setFBOAttachmentMaskAt(t,e)}setRenderToBackBuffer(){null!=this.m_adapter&&(this.m_adapter.setRenderToBackBuffer(r.default.FRAMEBUFFER),this.m_materialProxy.renderBegin())}lockViewport(){this.m_adapter.lockViewport()}unlockViewport(){this.m_adapter.unlockViewport()}setClearDepth(t){this.m_adapter.setClearDepth(t)}getClearDepth(){return this.m_adapter.getClearDepth()}getViewportX(){return this.m_adapter.getViewportX()}getViewportY(){return this.m_adapter.getViewportY()}getViewportWidth(){return this.m_adapter.getViewportWidth()}getViewportHeight(){return this.m_adapter.getViewportHeight()}setContextViewSize(t,e){this.m_adapter.setContextViewSize(t,e)}setCameraParam(t,e,s){this.m_cameraFov=t,this.m_cameraNear=e,this.m_cameraFar=s,null!=this.m_renderProxy&&this.m_renderProxy.setCameraParam(t,e,s)}initialize(t,e,s,i,r){if(null==this.m_adapter){a.default.Initialize(this.m_renderProxy.getUid()),this.m_renderProxy.setCameraParam(this.m_cameraFov,this.m_cameraNear,this.m_cameraFar),this.m_renderProxy.setWebGLMaxVersion(t.maxWebGLVersion),this.m_renderProxy.initialize(t,e,s,i,i,r),this.m_rcuid=this.m_renderProxy.getRCUid(),r.initialize(this.m_rcuid,this.m_renderProxy.getRC(),this.m_renderProxy.getGLVersion()),this.m_adapter=this.m_renderProxy.getRenderAdapter(),this.m_adapter.bgColor.setRGBA4f(0,0,0,1);let n=this.m_renderProxy.getContext();n.setViewport(0,0,n.getRCanvasWidth(),n.getRCanvasHeight()),o.default.Initialize()}}initManager(t){null==this.m_materialProxy&&(this.m_materialProxy=new l.default,this.m_materialProxy.setDispBuilder(t))}setClearRGBColor3f(t,e,s){this.m_renderProxy.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.m_renderProxy.setClearRGBAColor4f(t,e,s,i)}getClearRGBAColor4f(t){t.copyFrom(this.m_adapter.bgColor)}updateRenderBufferSize(){this.m_adapter.updateRenderBufferSize()}vertexRenderBegin(){this.m_renderProxy.Vertex.renderBegin()}renderBegin(t=!0){null!=this.m_adapter&&(this.m_adapter.unlockViewport(),this.m_adapter.setClearDepth(1),this.m_renderProxy.Vertex.renderBegin(),this.m_materialProxy.renderBegin(),this.m_adapter.update(),this.m_adapter.setClearMaskClearAll(),this.m_adapter.renderBegin(),n.default.ResetInfo(),n.default.Reset(this.m_renderProxy.getRenderContext()),t&&(this.m_renderProxy.useCameraData(),this.m_renderProxy.updateCameraDataFromCamera(this.m_renderProxy.getCamera())))}resetState(){n.default.ResetState(),this.m_materialProxy.renderBegin()}resetmaterial(){this.m_materialProxy.renderBegin()}resetUniform(){this.m_materialProxy.resetUniform()}runEnd(){}}e.default=_},"0fc4":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("9666")),a=i(s("faa5"));class n{constructor(){this.m_sharedUniforms=null,this.m_shaderUniformData=null,this.m_pipeLine=null,this.m_shduns="",this.m_shdData=null,this.__$troMid=-1,this.__$uniform=null,this.m_texList=null,this.m_texListLen=0,this.m_texDataEnabled=!1,this.m_attachCount=0}setMaterialPipeline(t){this.m_pipeLine=t}getMaterialPipeline(){return this.m_pipeLine}getShdUniqueName(){return this.m_shduns}initializeByUniqueName(t){if(null==this.getShaderData()){let e=r.default.FindData(t);null!=e&&(this.m_shdData=e)}return null!=this.getShaderData()}initialize(t,e,s,i=!0){if(null==this.getShaderData()){a.default.UseShaderBuffer(null);let n=r.default.FindData(t);null==n&&(n=r.default.CreateShdData(t,e,s,i,a.default.GetPreCompileInfo())),this.m_shduns=t,this.m_shdData=n}}getCodeBuf(){return null!=n.s_codeBuffer||(n.s_codeBuffer=new a.default),n.s_codeBuffer}hasShaderData(){if(null!=this.m_shdData){if(!this.m_shdData.haveTexture())return!0;if(this.texDataEnabled())return!0}return!1}initializeByCodeBuf(t=!1){if(null==this.m_shdData){let e=this.getCodeBuf();if(null!=e){e.reset(),e.pipeline=this.m_pipeLine,null!=e.pipeline&&(e.pipeline.reset(),this.buildBuf(),e.pipeline.getTextureTotal()>0&&this.setTextureList(e.pipeline.getTextureList())),null==n.s_codeBuffer&&(n.s_codeBuffer=new a.default),a.default.UseShaderBuffer(e),n.s_codeBuffer.initialize(t);let s=n.s_codeBuffer.getUniqueShaderName();this.m_shduns=s,this.__$initShd(this.m_shduns);let i=r.default.FindData(s);if(null==i){n.s_codeBuffer.buildShader();let t=n.s_codeBuffer.getFragShaderCode(),h=n.s_codeBuffer.getVtxShaderCode();i=r.default.CreateShdData(s,h,t,e.adaptationShaderVersion,a.default.GetPreCompileInfo())}null!=this.m_pipeLine&&(this.m_sharedUniforms=this.m_pipeLine.getSharedUniforms()),a.default.UseShaderBuffer(null),this.m_shdData=i}}}buildBuf(){}__$initShd(t){}getShaderData(){return this.m_shdData}setTextureList(t){if(this.m_texList!=t){this.m_texDataEnabled=!1,this.m_texListLen=null!=t?t.length:0;let e=0;if(null!=this.m_texList)for(;e<this.m_texList.length;++e)this.m_texList[e].__$detachThis();if(this.m_texDataEnabled=!0,this.m_texList=t,null!=this.m_texList){let t=31;for(e=0;e<this.m_texList.length;++e)t=131*t+this.m_texList[e].getUid(),this.m_texList[e].__$attachThis(),this.m_texList[e].isDataEnough()||(this.m_texDataEnabled=!1);this.__$troMid=t}}}setTextureAt(t,e){if(t>=0&&null!=e){let s=this.m_texList,i=s.length;if(null!=s&&s[t]!=e&&t<i&&i>0){s=s.slice(0),s[t].__$detachThis(),s[t]=e,this.m_texDataEnabled=e.isDataEnough(),e.__$attachThis();let r=31;for(let t=0;t<i;++t)r=131*r+s[t].getUid();this.__$troMid=r,this.m_texList=s}}}getTextureList(){return this.m_texList}getTextureAt(t){return this.m_texList[t]}getTextureTotal(){return this.m_texListLen}getShdTexTotal(){return null!=this.m_shdData?this.m_shdData.getTexTotal():0}texDataEnabled(){if(null!=this.m_texList){if(this.m_texDataEnabled)return!0;let t=!0,e=this.m_texList;for(let s=0;s<this.m_texListLen;++s)if(!e[s].isDataEnough()){t=!1;break}return this.m_texDataEnabled=t,t}return null!=this.m_shdData&&this.m_shdData.getTexTotal(),!1}createSharedUniforms(){return this.m_sharedUniforms}createSharedUniformsData(){return null}createSelfUniformData(){return this.m_shaderUniformData}updateSelfData(t){}hasTexture(){return this.m_shdData.haveTexture()}getBufSortFormat(){return null!=this.m_shdData?this.m_shdData.getLayoutBit():0}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}getAttachCount(){return this.m_attachCount}destroy(){if(this.m_sharedUniforms=null,this.m_shaderUniformData=null,this.getAttachCount()<1){if(null!=this.m_texList)for(let t=0;t<this.m_texList.length;++t)this.m_texList[t].__$detachThis();this.m_shdData=null,this.m_texList=null,this.m_texDataEnabled=!1,this.__$troMid=0,null!=this.__$uniform&&(this.__$uniform.destroy(),this.__$uniform=null)}}toString(){return"[MaterialBase()]"}}n.s_codeBuffer=null,e.default=n},"11e6":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static AddContainerFlag(t){return 2147483648|t}static RemoveContainerFlag(t){return-2147483649&t}static AddSpaceUid(t,e){return-1048576&t|e}static RemoveSpaceUid(t){return-1048576&t}static GetSpaceUid(t){return 1048575&t}static AddRendererUid(t,e){return-133169153&t|e<<20}static RemoveRendererUid(t){return 133169152|t}static GetRendererUid(t){return(133169152&t)>>20}static AddSortEnabled(t){return 1073741824|t}static RemoveSortEnabled(t){return-1073741825&t}static TestSortEnabled(t){return 1073741824==(1073741824&t)}static AddRendererLoad(t){return 805306368|t}static RemoveRendererLoad(t){return-805306369&t}static TestSpaceContains(t){return(1048575&t)>0}static TestSpaceEnabled(t){return(1048575&t)<1}static TestSpaceEnabled2(t){return(1048575&t)<1&&2147483648!=(2147483648&t)}static TestContainerEnabled(t){return 133169152==(133169152&t)&&2147483648!=(2147483648&t)}static TestRendererEnabled(t){return 133169152==(938475520&t)&&2147483648!=(2147483648&t)}}i.DEFAULT=133169152,i.CONTAINER_FLAG=2147483648,i.CONTAINER_NOT_FLAG=-2147483649,i.SPACE_FLAT=1048575,i.SPACE_NOT_FLAT=-1048576,i.RENDERER_UID_FLAT=133169152,i.RENDERER_UID_NOT_FLAT=-133169153,i.SORT_FLAT=1073741824,i.SORT_NOT_FLAT=-1073741825,i.RENDERER_LOAD_FLAT=805306368,i.RENDERER_LOAD_NOT_FLAT=-805306369,i.RENDERER_ADN_LOAD_FLAT=938475520,e.default=i},1216:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("3930")),n=i(s("baae")),h=i(s("722e")),o=i(s("8333")),l=i(s("6d49")),_=s("e08e"),u=s("8d98"),m=s("7c63"),d=i(s("29ef")),c=i(s("3024"));class f{constructor(t,e){this.m_uid=f.s_uid++,this.m_rcuid=0,this.m_texResource=null,this.m_gl=null,this.m_fontFaceFlipped=!1,this.m_colorMask={mr:!0,mg:!0,mb:!0,ma:!0},this.m_rcontext=null,this.m_clearMask=0,this.m_fboBuf=null,this.m_fboIndex=0,this.m_fboType=n.default.FRAMEBUFFER,this.m_fboBufList=[null,null,null,null,null,null,null,null],this.m_fboClearBoo=!0,this.m_fboViewRectBoo=!1,this.m_viewX=0,this.m_viewY=0,this.m_viewWidth=800,this.m_viewHeight=600,this.m_clearDepth=1,this.m_preDepth=0,this.m_fboViewSize=new r.default(0,0,800,600),this.m_fboSizeFactor=1,this.m_clearStencil=0,this.m_fboBiltRect=new Uint16Array(8),this.m_fboViewRect=new Uint16Array(4),this.m_activeAttachmentTotal=1,this.m_scissorEnabled=!1,this.m_rState=null,this.m_webglVer=2,this.bgColor=new a.default,this.uViewProbe=null,this.m_polygonOffset=!1,this.m_devPRatio=1,this.m_viewportUnlock=!0,this.m_synFBOSizeWithViewport=!1,this.m_texResource=e,this.m_rcuid=t}initialize(t,e,s){if(null==this.m_rcontext&&(this.m_webglVer=t.getWebGLVersion(),this.m_rState=s,this.m_rcontext=t,this.m_gl=t.getRC(),this.m_gl.disable(this.m_gl.SCISSOR_TEST),t.isDepthTestEnabled()?this.m_gl.enable(this.m_gl.DEPTH_TEST):this.m_gl.disable(this.m_gl.DEPTH_TEST),t.isStencilTestEnabled()?this.m_gl.enable(this.m_gl.STENCIL_TEST):this.m_gl.disable(this.m_gl.STENCIL_TEST),this.m_gl.enable(this.m_gl.CULL_FACE),this.m_gl.cullFace(this.m_gl.BACK),this.m_gl.enable(this.m_gl.BLEND),e.getDitherEanbled()?this.m_gl.enable(this.m_gl.DITHER):this.m_gl.disable(this.m_gl.DITHER),this.m_gl.frontFace(this.m_gl.CCW),e.getPolygonOffsetEanbled()?this.m_gl.enable(this.m_gl.POLYGON_OFFSET_FILL):this.m_gl.disable(this.m_gl.POLYGON_OFFSET_FILL),this.m_clearMask=this.m_gl.COLOR_BUFFER_BIT|this.m_gl.DEPTH_BUFFER_BIT|this.m_gl.STENCIL_BUFFER_BIT,null==this.uViewProbe)){let t=this;t.uViewProbe=new c.default(1),this.uViewProbe.bindSlotAt(this.m_rcuid),this.uViewProbe.setVec4DataWithArr4([this.m_viewX,this.m_viewY,this.m_viewWidth,this.m_viewHeight])}}setFrontFaceFlipped(t){this.m_fontFaceFlipped!=t&&(t?this.m_gl.frontFace(this.m_gl.CW):this.m_gl.frontFace(this.m_gl.CCW),this.m_fontFaceFlipped=t)}setPolygonOffset(t,e=0){this.m_gl.polygonOffset(t,e),this.m_polygonOffset=!0}resetPolygonOffset(){this.m_polygonOffset&&(this.m_gl.polygonOffset(0,0),this.m_polygonOffset=!1)}getDiv(){return this.m_rcontext.getDiv()}getCanvas(){return this.m_rcontext.getCanvas()}setClearDepth(t){this.m_clearDepth=t}getClearDepth(){return this.m_clearDepth}setContextViewSize(t,e){this.m_rcontext.autoSyncRenderBufferAndWindowSize=!1,this.m_rcontext.resizeBufferSize(t,e)}getViewportX(){return this.m_rcontext.getViewportX()}getViewportY(){return this.m_rcontext.getViewportY()}getViewportWidth(){return this.m_rcontext.getViewportWidth()}getViewportHeight(){return this.m_rcontext.getViewportHeight()}getFBOFitWidth(){return this.m_rcontext.getFBOWidth()}getFBOFitHeight(){return this.m_rcontext.getFBOHeight()}getRCanvasWidth(){return this.m_rcontext.getRCanvasWidth()}getRCanvasHeight(){return this.m_rcontext.getRCanvasHeight()}setColorMask(t,e,s,i){this.m_colorMask.mr=t,this.m_colorMask.mg=e,this.m_colorMask.mb=s,this.m_colorMask.ma=i}setClearMaskClearAll(){this.m_clearMask=this.m_gl.COLOR_BUFFER_BIT|this.m_gl.DEPTH_BUFFER_BIT|this.m_gl.STENCIL_BUFFER_BIT}setClearMaskClearOnlyColor(){this.m_clearMask=this.m_gl.COLOR_BUFFER_BIT}setClearMaskClearOnlyDepthAndStencil(){this.m_clearMask=this.m_gl.DEPTH_BUFFER_BIT|this.m_gl.STENCIL_BUFFER_BIT}setScissorRect(t,e,s,i){this.m_scissorEnabled&&this.m_gl.scissor(t,e,s,i)}setScissorEnabled(t){t?this.m_scissorEnabled||(this.m_scissorEnabled=!0,this.m_gl.enable(this.m_gl.SCISSOR_TEST)):this.m_scissorEnabled&&(this.m_scissorEnabled=!1,this.m_gl.disable(this.m_gl.SCISSOR_TEST))}clear(){this.m_preDepth!==this.m_clearDepth&&(this.m_preDepth=this.m_clearDepth,this.m_gl.clearDepth(this.m_clearDepth)),this.m_rcontext.isStencilTestEnabled()&&this.m_gl.clearStencil(this.m_clearStencil),this.m_gl.clearColor(this.bgColor.r,this.bgColor.g,this.bgColor.b,this.bgColor.a),this.m_gl.clear(this.m_clearMask)}reset(){this.m_rState.setCullFaceMode(_.CullFaceMode.BACK),this.m_rState.setDepthTestMode(_.DepthTestMode.OPAQUE),d.default.Reset(this.m_gl)}getRenderContext(){return this.m_rcontext}renderBegin(){null!=this.m_rcontext&&(this.m_fboSizeFactor=1,this.reseizeViewPort(),m.RenderStateObject.Unlock(),m.RenderStateObject.UseRenderState(d.default.NORMAL_STATE),m.RenderColorMask.Unlock(),m.RenderColorMask.UseRenderState(m.RenderColorMask.ALL_TRUE_COLOR_MASK),this.clear())}reseizeViewPort(){if(this.m_viewportUnlock){let t=this.m_rcontext.getDevicePixelRatio(),e=this.m_viewX!=this.m_rcontext.getViewportX()||this.m_viewY!=this.m_rcontext.getViewportY();e=e||this.m_viewWidth!=this.m_rcontext.getViewportWidth(),e=e||this.m_viewHeight!=this.m_rcontext.getViewportHeight(),e=e||Math.abs(this.m_devPRatio-t)>.01,e&&(this.m_devPRatio=t,this.m_viewX=this.m_rcontext.getViewportX(),this.m_viewY=this.m_rcontext.getViewportY(),this.m_viewWidth=this.m_rcontext.getViewportWidth(),this.m_viewHeight=this.m_rcontext.getViewportHeight(),this.uViewProbe.setVec4Data(this.m_viewX,this.m_viewY,this.m_viewWidth,this.m_viewHeight),this.uViewProbe.update(),this.m_gl.viewport(this.m_viewX,this.m_viewY,this.m_viewWidth,this.m_viewHeight))}}reseizeFBOViewPort(){if(this.m_viewportUnlock){let t=this.m_rcontext.getDevicePixelRatio(),e=this.m_viewX!=this.m_fboViewSize.x||this.m_viewY!=this.m_fboViewSize.y;e=e||this.m_viewWidth!=this.m_fboViewSize.z,e=e||this.m_viewHeight!=this.m_fboViewSize.w,e=e||Math.abs(this.m_devPRatio-t)>.01,e&&(this.m_devPRatio=t,this.m_viewX=this.m_fboViewSize.x,this.m_viewY=this.m_fboViewSize.y,this.m_viewWidth=this.m_fboViewSize.z,this.m_viewHeight=this.m_fboViewSize.w,this.uViewProbe.setVec4Data(this.m_viewX,this.m_viewY,this.m_viewWidth,this.m_viewHeight),this.uViewProbe.update(),this.m_gl.viewport(this.m_viewX,this.m_viewY,this.m_viewWidth,this.m_viewHeight))}}setViewProbeValue(t,e,s,i){this.uViewProbe.setVec4Data(t,e,s,i),this.uViewProbe.update()}lockViewport(){this.m_viewportUnlock=!1}unlockViewport(){this.m_viewportUnlock=!0}renderEnd(){}update(){}updateRenderBufferSize(){this.m_rcontext.updateRenderBufferSize()}destroy(){this.m_rcontext=null,this.m_rState=null}getDevicePixelRatio(){return this.m_rcontext.getDevicePixelRatio()}loseContext(){this.m_rcontext.loseContext()}isContextLost(){return this.m_rcontext.isContextLost()}readPixels(t,e,s,i,r,a,n){this.m_gl.readPixels(t,e,s,i,u.TextureFormat.ToGL(this.m_gl,r),u.TextureDataType.ToGL(this.m_gl,a),n)}setFBOViewRect(t,e,s,i){this.m_fboViewRect[0]=t,this.m_fboViewRect[1]=e,this.m_fboViewRect[2]=s,this.m_fboViewRect[3]=i,this.m_fboViewRectBoo=!0}createFBOAt(t,e,s,i,r=!1,a=!1,n=0){null==this.m_fboBufList[t]&&(t>7&&(t=7),this.m_fboType=e,this.m_fboBuf=new l.default(this.m_rcuid,this.m_texResource,this.m_fboType),this.m_fboBuf.multisampleEnabled=n>0,this.m_fboBuf.multisampleLevel=n,this.m_fboBuf.writeDepthEnabled=r,this.m_fboBuf.writeStencilEnabled=a,this.m_fboBuf.initialize(this.m_gl,s,i),this.m_fboBufList[t]=this.m_fboBuf,this.m_fboBuf.sizeFixed=!0)}resizeFBOAt(t,e,s){t>7?t=7:t<0&&(t=0),null!=this.m_fboBufList[this.m_fboIndex]&&this.m_fboBufList[this.m_fboIndex].resize(e,s)}getFBOWidthAt(t){return null!=this.m_fboBufList[t]?this.m_fboBufList[t].getWidth():0}getFBOHeightAt(t){return null!=this.m_fboBufList[t]?this.m_fboBufList[t].getHeight():0}synFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!0}asynFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!1}setFBOSizeFactorWithViewPort(t){this.m_fboSizeFactor=t}bindFBOAt(t,e){if(t>7?t=7:t<0&&(t=0),this.m_fboBuf=this.m_fboBufList[t],null==this.m_fboBuf)throw Error("Fatal Error!!! this.m_fboBuf == null.");this.m_fboIndex=t,this.m_fboType=e,this.m_fboBuf.bind(e),this.m_fboClearBoo=!0}resetFBOAttachmentMask(t){null!=this.m_fboBuf&&this.m_fboBuf.resetAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){null!=this.m_fboBuf&&this.m_fboBuf.setAttachmentMaskAt(t,e)}getFBOAttachmentTotal(){return null!=this.m_fboBuf?this.m_fboBuf.getAttachmentTotal():0}setRenderToTexture(t,e=!1,s=!1,i=0){(i<0||i>=8)&&(i=0),null==t&&0==i?this.setRenderToBackBuffer(n.default.FRAMEBUFFER):(0==i&&(null!=this.m_fboBuf&&(this.m_synFBOSizeWithViewport?this.m_fboBuf.initialize(this.m_gl,Math.floor(this.m_rcontext.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rcontext.getFBOHeight()*this.m_fboSizeFactor)):this.m_fboViewRectBoo?this.m_fboBuf.initialize(this.m_gl,this.m_fboViewRect[2],this.m_fboViewRect[3]):this.m_fboBuf.sizeFixed||this.m_fboBuf.initialize(this.m_gl,t.getWidth(),t.getHeight())),this.m_fboIndex>=0&&null==this.m_fboBuf&&(this.m_fboBuf=new l.default(this.m_rcuid,this.m_texResource,this.m_fboType),this.m_fboBufList[this.m_fboIndex]=this.m_fboBuf,this.m_fboBuf.writeDepthEnabled=e,this.m_fboBuf.writeStencilEnabled=s,this.m_synFBOSizeWithViewport?this.m_fboBuf.initialize(this.m_gl,Math.floor(this.m_rcontext.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rcontext.getFBOHeight()*this.m_fboSizeFactor)):this.m_fboViewRectBoo?this.m_fboBuf.initialize(this.m_gl,this.m_fboViewRect[2],this.m_fboViewRect[3]):this.m_fboBuf.initialize(this.m_gl,t.getWidth(),t.getHeight()))),null!=this.m_fboBuf&&this.m_fboBuf.renderToTexAt(this.m_gl,t,i),this.m_fboClearBoo=!0)}getActiveAttachmentTotal(){return this.m_activeAttachmentTotal}getAttachmentTotal(){return this.m_activeAttachmentTotal}useFBO(t=!1,e=!1,s=!1){null!=this.m_fboBuf&&this.m_fboClearBoo&&(this.m_fboClearBoo=!1,this.m_fboBuf.use(this.m_gl),this.m_activeAttachmentTotal=this.m_fboBuf.getActiveAttachmentTotal(),t&&this.m_fboBuf.clearOnlyColor(this.bgColor),this.m_fboBuf.writeDepthEnabled?this.m_fboBuf.writeStencilEnabled?e&&s?this.m_fboBuf.clearOnlyDepthAndStencil(this.m_clearDepth,4294967295):e?this.m_fboBuf.clearOnlyDepth(this.m_clearDepth):s&&this.m_fboBuf.clearOnlyStencil(255):e&&this.m_fboBuf.clearOnlyDepth(this.m_clearDepth):s&&this.m_fboBuf.writeStencilEnabled&&this.m_fboBuf.clearOnlyStencil(255),1==this.m_webglVer&&this.m_gl.clear(this.m_clearMask),this.m_fboBiltRect[4]=this.m_fboBiltRect[0]=this.m_viewX,this.m_fboBiltRect[5]=this.m_fboBiltRect[1]=this.m_viewY,this.m_fboBiltRect[6]=this.m_fboBiltRect[2]=this.m_viewX+this.m_viewWidth,this.m_fboBiltRect[7]=this.m_fboBiltRect[3]=this.m_viewY+this.m_viewHeight,this.m_fboViewRectBoo?(this.m_fboViewRectBoo=!1,this.m_fboViewSize.setTo(this.m_fboViewRect[0],this.m_fboViewRect[1],this.m_fboViewRect[2],this.m_fboViewRect[3]),this.reseizeFBOViewPort()):(this.m_synFBOSizeWithViewport?this.m_fboViewSize.setTo(0,0,Math.floor(this.m_rcontext.getFBOWidth()*this.m_fboSizeFactor),Math.floor(this.m_rcontext.getFBOHeight()*this.m_fboSizeFactor)):(this.m_fboBuf.isSizeChanged()&&this.m_fboBuf.initialize(this.m_gl,this.m_fboBuf.getWidth(),this.m_fboBuf.getHeight()),this.m_fboViewSize.setTo(0,0,this.m_fboBuf.getWidth(),this.m_fboBuf.getHeight())),this.reseizeFBOViewPort()))}setRenderToBackBuffer(t=n.default.FRAMEBUFFER){this.m_activeAttachmentTotal=1,l.default.BindToBackbuffer(this.m_gl,t),this.reseizeViewPort()}bindFBOToDraw(){null!=this.m_fboBuf&&this.m_fboBuf.bind(n.default.DRAW_FRAMEBUFFER)}bindFBOToWrite(){null!=this.m_fboBuf&&this.m_fboBuf.bind(n.default.READ_FRAMEBUFFER)}setBlitFboSrcRect(t,e,s,i){this.m_fboBiltRect[0]=t,this.m_fboBiltRect[1]=e,this.m_fboBiltRect[2]=t+s,this.m_fboBiltRect[3]=e+i}setBlitFboDstRect(t,e,s,i){this.m_fboBiltRect[4]=t,this.m_fboBiltRect[5]=e,this.m_fboBiltRect[6]=t+s,this.m_fboBiltRect[7]=e+i}blitFBO(t=0,e=0,s=o.default.COLOR_BUFFER_BIT,i=h.default.NEAREST,r=0,a=0,_=null){t>7&&(t=7),e>7&&(e=7),t>=0&&null!=this.m_fboBufList[t]?this.m_fboBufList[t].bind(n.default.READ_FRAMEBUFFER):l.default.BindToBackbuffer(this.m_gl,n.default.READ_FRAMEBUFFER),e>=0&&null!=this.m_fboBufList[e]?this.m_fboBufList[e].bind(n.default.DRAW_FRAMEBUFFER):l.default.BindToBackbuffer(this.m_gl,n.default.DRAW_FRAMEBUFFER),r>0&&(a<0&&(a=0),null==_&&(_=[0,0,0,1]),this.m_gl.clearBufferfv(r,a,_));let u=this.m_fboBiltRect;this.m_gl.blitFramebuffer(u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],s,i)}}f.s_uid=0,e.default=f},1264:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=s("e08e"),n=s("eca0");class h{constructor(t,e,s,i){this.m_rpoUnitBuilder=null,this.m_dataBuilder=null,this.m_processBuider=null,this.m_waitList=[],this.m_processUidList=[],this.m_rendererUid=-1,this.m_existencetotal=0,this.m_rprocess=null,this.entityManaListener=null,this.m_rendererUid=t,this.m_dataBuilder=e,this.m_rpoUnitBuilder=s,this.m_processBuider=i}isEmpty(){return this.m_existencetotal<1}isHaveEntity(){return this.m_existencetotal>0}removeEntity(t){this.m_existencetotal--;let e=t.getDisplay();if(null!=e&&null!=e.__$$runit){let t=e.__$ruid,s=this.m_rpoUnitBuilder.getRCRPObj(t);if(null!=s){if(s.count>0)if(s.count<2)s.rprocessUid>-1&&(this.m_rprocess=this.m_processBuider.getNodeByUid(s.rprocessUid),this.m_rprocess.removeDisp(e),s.rprocessUid=-1);else{let t=n.RCRPObj.RenerProcessMaxTotal;for(let i=0;i<t;++i)(s.idsFlag&1<<i)>0&&(this.m_rprocess=this.m_processBuider.getNodeByUid(i),this.m_rprocess.removeDisp(e))}}else this.m_rprocess=this.m_processBuider.getNodeByUid(e.__$$runit.getRPROUid()),this.m_rprocess.removeDisp(e);0==s.count&&(e.__$$rsign,a.DisplayRenderSign.LIVE_IN_WORLD,e.__$$rsign=a.DisplayRenderSign.NOT_IN_WORLD,this.m_rpoUnitBuilder.restoreByUid(t))}t.__$rseFlag=r.default.RemoveRendererUid(t.__$rseFlag),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.RemoveSortEnabled(t.__$rseFlag),null!=this.entityManaListener&&this.entityManaListener.removeFromWorld(t,this.m_rendererUid,-1)}addEntity(t,e,s=!1){if(null!=t){let i=t.getDisplay();if(null!=i){if(i.__$$rsign==a.DisplayRenderSign.LIVE_IN_WORLD&&!this.m_rpoUnitBuilder.testRPNodeNotExists(i.__$ruid,e))return;this.m_rprocess=this.m_processBuider.getNodeByUid(e),t.__$rseFlag=this.m_rprocess.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),s?(i.__$$rsign==a.DisplayRenderSign.NOT_IN_WORLD&&(i.__$$rsign=a.DisplayRenderSign.GO_TO_WORLD),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid),this.m_waitList.push(t),this.m_processUidList.push(e)):this.testValidData(t)?this.ensureAdd(t,i,e):(i.__$$rsign==a.DisplayRenderSign.NOT_IN_WORLD&&(i.__$$rsign=a.DisplayRenderSign.GO_TO_WORLD),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),this.m_waitList.push(t),this.m_processUidList.push(e))}else t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid)}return!1}testValidData(t){if(null!=t.getMaterial()&&t.hasMesh()){if(t.getMaterial().hasShaderData())return!0;null!=t.getMaterial().getCodeBuf()&&t.activeDisplay()}return!1}ensureAdd(t,e,s){t.update(),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.m_rendererUid),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$setRenderProxy(this.m_dataBuilder.getRenderProxy()),this.m_existencetotal++,e.__$$rsign==a.DisplayRenderSign.NOT_IN_WORLD&&(e.__$$rsign=a.DisplayRenderSign.GO_TO_WORLD),this.m_rprocess=this.m_processBuider.getNodeByUid(s),(e.__$ruid>-1||this.m_dataBuilder.buildGpuDisp(e))&&this.m_rprocess.addDisp(e),null!=this.entityManaListener&&this.entityManaListener.addToWorld(t,this.m_rendererUid,s),t.update()}updateWaitList(){let t=this.m_waitList.length,e=null,s=null;for(let i=0;i<t;++i)if(e=this.m_waitList[i],(r.default.RENDERER_LOAD_FLAT&e.__$rseFlag)==r.default.RENDERER_LOAD_FLAT){if(this.testValidData(e)){if(s=e.getDisplay(),s.__$$rsign==a.DisplayRenderSign.LIVE_IN_WORLD&&!this.m_rpoUnitBuilder.testRPNodeNotExists(s.__$ruid,this.m_processUidList[i])){this.m_waitList.splice(i,1),this.m_processUidList.splice(i,1),--t,--i;continue}this.ensureAdd(e,s,this.m_processUidList[i]),this.m_waitList.splice(i,1),this.m_processUidList.splice(i,1),--t,--i}}else s=e.getDisplay(),null!=s&&s.__$$rsign==a.DisplayRenderSign.GO_TO_WORLD&&(s.__$$rsign=a.DisplayRenderSign.NOT_IN_WORLD),e.__$rseFlag=r.default.RemoveRendererLoad(e.__$rseFlag),e.__$rseFlag=r.default.RemoveRendererUid(e.__$rseFlag),e.__$rseFlag=r.default.RemoveSortEnabled(e.__$rseFlag),this.m_waitList.splice(i,1),this.m_processUidList.splice(i,1),--t,--i,null!=this.entityManaListener&&this.entityManaListener.removeFromWorld(e,this.m_rendererUid,-1)}update(){this.m_waitList.length>0&&this.updateWaitList(),this.m_dataBuilder.update()}}e.default=h},1710:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("a996"));class n extends a.default{constructor(){super(),this.phase=0,this.type=0,this.target=null,this.lpos=new r.default,this.wpos=new r.default,this.raytv=new r.default(1,0,0),this.raypv=new r.default(0,0,0),this.mouseX=0,this.mouseY=0,this.mouseViewX=0,this.mouseViewY=0,this.posArray=null,this.wheelDeltaY=0}static GetMouseEvtTypeValueBase(){return 5001}static GetMouseEvtTypeValuesTotal(){return 17}getClassType(){return n.EventClassType}toString(){return"[MouseEvent]"}}n.EventClassType=1002,n.MOUSE_DOWN=5001,n.MOUSE_UP=5002,n.MOUSE_RIGHT_UP=5003,n.MOUSE_RIGHT_DOWN=5004,n.MOUSE_MOVE=5005,n.MOUSE_WHEEL=5006,n.MOUSE_OVER=5007,n.MOUSE_OUT=5008,n.MOUSE_CLICK=5009,n.MOUSE_RIGHT_CLICK=5010,n.MOUSE_DOUBLE_CLICK=5011,n.MOUSE_CANCEL=5012,n.MOUSE_MULTI_DOWN=5013,n.MOUSE_MULTI_UP=5014,n.MOUSE_MULTI_MOVE=5015,n.MOUSE_BG_DOWN=5016,n.MOUSE_BG_UP=5017,e.default=n},"18c7":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("abdb"));class h{constructor(t=null,e=0){this.m_uid=-1,this.m_index=0,this.m_fs32=null,this.m_localFS32=null,this.m_index=e,null!=t?(this.m_uid=h.s_uid++,this.m_fs32=t,this.m_localFS32=this.m_fs32.subarray(e,e+16)):(this.m_uid=h.s_isolatedUid++,this.m_fs32=new Float32Array(16),this.m_fs32.set(h.s_InitData,0),this.m_localFS32=this.m_fs32)}setData(t){16==t.length&&this.m_localFS32.set(t)}getCapacity(){return 16}GetMaxUid(){return h.s_uid}getUid(){return this.m_uid}getLocalFS32(){return this.m_localFS32}getFS32(){return this.m_fs32}getFSIndex(){return this.m_index}identity(){this.m_localFS32.set(h.s_InitData,0)}determinant(){return(this.m_localFS32[0]*this.m_localFS32[5]-this.m_localFS32[4]*this.m_localFS32[1])*(this.m_localFS32[10]*this.m_localFS32[15]-this.m_localFS32[14]*this.m_localFS32[11])-(this.m_localFS32[0]*this.m_localFS32[9]-this.m_localFS32[8]*this.m_localFS32[1])*(this.m_localFS32[6]*this.m_localFS32[15]-this.m_localFS32[14]*this.m_localFS32[7])+(this.m_localFS32[0]*this.m_localFS32[13]-this.m_localFS32[12]*this.m_localFS32[1])*(this.m_localFS32[6]*this.m_localFS32[11]-this.m_localFS32[10]*this.m_localFS32[7])+(this.m_localFS32[4]*this.m_localFS32[9]-this.m_localFS32[8]*this.m_localFS32[5])*(this.m_localFS32[2]*this.m_localFS32[15]-this.m_localFS32[14]*this.m_localFS32[3])-(this.m_localFS32[4]*this.m_localFS32[13]-this.m_localFS32[12]*this.m_localFS32[5])*(this.m_localFS32[2]*this.m_localFS32[11]-this.m_localFS32[10]*this.m_localFS32[3])+(this.m_localFS32[8]*this.m_localFS32[13]-this.m_localFS32[12]*this.m_localFS32[9])*(this.m_localFS32[2]*this.m_localFS32[7]-this.m_localFS32[6]*this.m_localFS32[3])}append(t){let e=t.getLocalFS32(),s=this.m_localFS32,i=s[0],r=s[4],a=s[8],n=s[12],h=s[1],o=s[5],l=s[9],_=s[13],u=s[2],m=s[6],d=s[10],c=s[14],f=s[3],p=s[7],g=s[11],v=s[15],x=e[0],y=e[4],T=e[8],b=e[12],S=e[1],E=e[5],A=e[9],w=e[13],R=e[2],M=e[6],D=e[10],F=e[14],L=e[3],B=e[7],P=e[11],C=e[15];s[0]=i*x+h*y+u*T+f*b,s[1]=i*S+h*E+u*A+f*w,s[2]=i*R+h*M+u*D+f*F,s[3]=i*L+h*B+u*P+f*C,s[4]=r*x+o*y+m*T+p*b,s[5]=r*S+o*E+m*A+p*w,s[6]=r*R+o*M+m*D+p*F,s[7]=r*L+o*B+m*P+p*C,s[8]=a*x+l*y+d*T+g*b,s[9]=a*S+l*E+d*A+g*w,s[10]=a*R+l*M+d*D+g*F,s[11]=a*L+l*B+d*P+g*C,s[12]=n*x+_*y+c*T+v*b,s[13]=n*S+_*E+c*A+v*w,s[14]=n*R+_*M+c*D+v*F,s[15]=n*L+_*B+c*P+v*C}append3x3(t){let e=t.getLocalFS32(),s=this.m_localFS32,i=s[0],r=s[4],a=s[8],n=s[1],h=s[5],o=s[9],l=s[2],_=s[6],u=s[10],m=e[0],d=e[4],c=e[8],f=e[1],p=e[5],g=e[9],v=e[2],x=e[6],y=e[10];s[0]=i*m+n*d+l*c,s[1]=i*f+n*p+l*g,s[2]=i*v+n*x+l*y,s[4]=r*m+h*d+_*c,s[5]=r*f+h*p+_*g,s[6]=r*v+h*x+_*y,s[8]=a*m+o*d+u*c,s[9]=a*f+o*p+u*g,s[10]=a*v+o*x+u*y}appendRotationPivot(t,e,s=null){null==s&&(s=a.default.Z_AXIS),h.s_tMat4.identity(),h.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),h.s_tMat4.appendTranslationXYZ(s.x,s.y,s.z),this.append(h.s_tMat4)}appendRotation(t,e){h.s_tMat4.identity(),h.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),this.append(h.s_tMat4)}appendRotationX(t){h.s_tMat4.rotationX(t),this.append3x3(h.s_tMat4)}appendRotationY(t){h.s_tMat4.rotationY(t),this.append3x3(h.s_tMat4)}appendRotationZ(t){h.s_tMat4.rotationZ(t),this.append3x3(h.s_tMat4)}appendRotationEulerAngle(t,e,s){h.s_tMat4.rotationY(e),this.append3x3(h.s_tMat4),h.s_tMat4.rotationX(t),this.append3x3(h.s_tMat4),h.s_tMat4.rotationZ(s),this.append3x3(h.s_tMat4)}setScaleXYZ(t,e,s){let i=this.m_localFS32;i[0]=t,i[5]=e,i[10]=s}setRotationEulerAngle(t,e,s){let i=this.m_localFS32,r=Math.cos(t),a=Math.sin(t),n=Math.cos(e),h=Math.sin(e),o=Math.cos(s),l=Math.sin(s),_=o*h,u=l*h,m=n*i[0],d=a*i[5],c=r*i[5],f=r*i[10],p=a*i[10];i[1]=l*m,i[2]=-h*i[0],i[0]=o*m,i[4]=_*d-l*c,i[8]=_*f+l*p,i[5]=u*d+o*c,i[9]=u*f-o*p,i[6]=n*d,i[10]=n*f}setRotationEulerAngle2(t,e,s,i,r,a){let n=this.m_localFS32,h=r*i,o=a*i,l=s*n[0],_=e*n[5],u=t*n[5],m=t*n[10],d=e*n[10];n[1]=a*l,n[2]=-i*n[0],n[0]=r*l,n[4]=h*_-a*u,n[8]=h*m+a*d,n[5]=o*_+r*u,n[9]=o*m-r*d,n[6]=s*_,n[10]=s*m}setTranslationXYZ(t,e,s){this.m_localFS32[12]=t,this.m_localFS32[13]=e,this.m_localFS32[14]=s}setTranslation(t){this.m_localFS32[12]=t.x,this.m_localFS32[13]=t.y,this.m_localFS32[14]=t.z}appendScaleXYZ(t,e,s){let i=this.m_localFS32;i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=e,i[5]*=e,i[6]*=e,i[7]*=e,i[8]*=s,i[9]*=s,i[10]*=s,i[11]*=s}appendScaleXY(t,e){this.m_localFS32[0]*=t,this.m_localFS32[1]*=t,this.m_localFS32[2]*=t,this.m_localFS32[3]*=t,this.m_localFS32[4]*=e,this.m_localFS32[5]*=e,this.m_localFS32[6]*=e,this.m_localFS32[7]*=e}appendTranslationXYZ(t,e,s){this.m_localFS32[12]+=t,this.m_localFS32[13]+=e,this.m_localFS32[14]+=s}appendTranslation(t){this.m_localFS32[12]+=t.x,this.m_localFS32[13]+=t.y,this.m_localFS32[14]+=t.z}copyColumnFrom(t,e){switch(t){case 0:this.m_localFS32[0]=e.x,this.m_localFS32[1]=e.y,this.m_localFS32[2]=e.z,this.m_localFS32[3]=e.w;break;case 1:this.m_localFS32[4]=e.x,this.m_localFS32[5]=e.y,this.m_localFS32[6]=e.z,this.m_localFS32[7]=e.w;break;case 2:this.m_localFS32[8]=e.x,this.m_localFS32[9]=e.y,this.m_localFS32[10]=e.z,this.m_localFS32[11]=e.w;break;case 3:this.m_localFS32[12]=e.x,this.m_localFS32[13]=e.y,this.m_localFS32[14]=e.z,this.m_localFS32[15]=e.w;break;default:break}}copyColumnTo(t,e){t<<=2,e.x=this.m_localFS32[t],e.y=this.m_localFS32[1+t],e.z=this.m_localFS32[2+t],e.w=this.m_localFS32[3+t]}setF32ArrAndIndex(t,e=0){null!=t&&e>=0&&(this.m_fs32=t,this.m_index=e,this.m_localFS32=this.m_fs32.subarray(e,e+16))}setF32ArrIndex(t=0){t>=0&&(this.m_index=t,this.m_localFS32=this.m_fs32.subarray(t,t+16))}setF32Arr(t){null!=t&&(this.m_fs32=t)}copyFromF32Arr(t,e=0){let s=0;for(let i=e+16;e<i;e++)this.m_localFS32[s]=t[e],++s}copyToF32Arr(t,e=0){t.set(this.m_localFS32,e)}copyFrom(t){this.m_localFS32.set(t.m_localFS32,0)}copyTo(t){t.m_localFS32.set(this.m_localFS32,0)}copyRawDataFrom(t,e=16,s=0,i=!1){i&&this.transpose(),e-=s;let r=0;while(r<e)this.m_fs32[this.m_index+r]=t[r+s],++r;i&&this.transpose()}copyRawDataTo(t,e=16,s=0,i=!1){i&&this.transpose();let r=0;while(r<e)t[r+s]=this.m_fs32[this.m_index+r],++r;i&&this.transpose()}copyRowFrom(t,e){switch(t){case 0:this.m_localFS32[0]=e.x,this.m_localFS32[4]=e.y,this.m_localFS32[8]=e.z,this.m_localFS32[12]=e.w;break;case 1:this.m_localFS32[1]=e.x,this.m_localFS32[5]=e.y,this.m_localFS32[9]=e.z,this.m_localFS32[13]=e.w;break;case 2:this.m_localFS32[2]=e.x,this.m_localFS32[6]=e.y,this.m_localFS32[10]=e.z,this.m_localFS32[14]=e.w;break;case 3:this.m_localFS32[3]=e.x,this.m_localFS32[7]=e.y,this.m_localFS32[11]=e.z,this.m_localFS32[15]=e.w;break;default:break}}copyRowTo(t,e){e.x=this.m_localFS32[t],e.y=this.m_localFS32[4+t],e.z=this.m_localFS32[8+t],e.w=this.m_localFS32[12+t]}decompose(t){let e=[],s=h.s_tMat4,i=s.getFS32();s.copyFrom(this);let o=new a.default(i[12],i[13],i[14]),l=new a.default;l.x=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),l.y=Math.sqrt(i[4]*i[4]+i[5]*i[5]+i[6]*i[6]),l.z=Math.sqrt(i[8]*i[8]+i[9]*i[9]+i[10]*i[10]),i[0]*(i[5]*i[10]-i[6]*i[9])-i[1]*(i[4]*i[10]-i[6]*i[8])+i[2]*(i[4]*i[9]-i[5]*i[8])<0&&(l.z=-l.z),i[0]/=l.x,i[1]/=l.x,i[2]/=l.x,i[4]/=l.y,i[5]/=l.y,i[6]/=l.y,i[8]/=l.z,i[9]/=l.z,i[10]/=l.z;let _=new a.default;switch(t){case n.default.AXIS_ANGLE:{_.w=r.default.SafeACos((i[0]+i[5]+i[10]-1)/2);let t=Math.sqrt((i[6]-i[9])*(i[6]-i[9])+(i[8]-i[2])*(i[8]-i[2])+(i[1]-i[4])*(i[1]-i[4]));t>r.default.MATH_MIN_POSITIVE?(_.x=(i[6]-i[9])/t,_.y=(i[8]-i[2])/t,_.z=(i[1]-i[4])/t):_.x=_.y=_.z=0}break;case n.default.QUATERNION:{let t=i[0]+i[5]+i[10];t>0?(_.w=Math.sqrt(1+t)/2,_.x=(i[6]-i[9])/(4*_.w),_.y=(i[8]-i[2])/(4*_.w),_.z=(i[1]-i[4])/(4*_.w)):i[0]>i[5]&&i[0]>i[10]?(_.x=Math.sqrt(1+i[0]-i[5]-i[10])/2,_.w=(i[6]-i[9])/(4*_.x),_.y=(i[1]+i[4])/(4*_.x),_.z=(i[8]+i[2])/(4*_.x)):i[5]>i[10]?(_.y=Math.sqrt(1+i[5]-i[0]-i[10])/2,_.x=(i[1]+i[4])/(4*_.y),_.w=(i[8]-i[2])/(4*_.y),_.z=(i[6]+i[9])/(4*_.y)):(_.z=Math.sqrt(1+i[10]-i[0]-i[5])/2,_.x=(i[8]+i[2])/(4*_.z),_.y=(i[6]+i[9])/(4*_.z),_.w=(i[1]-i[4])/(4*_.z))}break;case n.default.EULER_ANGLES:_.y=Math.asin(-i[2]),1!=i[2]&&-1!=i[2]?(_.x=Math.atan2(i[6],i[10]),_.z=Math.atan2(i[1],i[0])):(_.z=0,_.x=Math.atan2(i[4],i[5]));break;default:break}return e.push(o),e.push(_),e.push(l),s=null,e}invert(){let t=this.determinant(),e=Math.abs(t)>r.default.MATH_MIN_POSITIVE;if(e){let e=this.m_localFS32;t=1/t;let s=e[0],i=e[4],r=e[8],a=e[12],n=e[1],h=e[5],o=e[9],l=e[13],_=e[2],u=e[6],m=e[10],d=e[14],c=e[3],f=e[7],p=e[11],g=e[15];e[0]=t*(h*(m*g-d*p)-o*(u*g-d*f)+l*(u*p-m*f)),e[1]=-t*(n*(m*g-d*p)-o*(_*g-d*c)+l*(_*p-m*c)),e[2]=t*(n*(u*g-d*f)-h*(_*g-d*c)+l*(_*f-u*c)),e[3]=-t*(n*(u*p-m*f)-h*(_*p-m*c)+o*(_*f-u*c)),e[4]=-t*(i*(m*g-d*p)-r*(u*g-d*f)+a*(u*p-m*f)),e[5]=t*(s*(m*g-d*p)-r*(_*g-d*c)+a*(_*p-m*c)),e[6]=-t*(s*(u*g-d*f)-i*(_*g-d*c)+a*(_*f-u*c)),e[7]=t*(s*(u*p-m*f)-i*(_*p-m*c)+r*(_*f-u*c)),e[8]=t*(i*(o*g-l*p)-r*(h*g-l*f)+a*(h*p-o*f)),e[9]=-t*(s*(o*g-l*p)-r*(n*g-l*c)+a*(n*p-o*c)),e[10]=t*(s*(h*g-l*f)-i*(n*g-l*c)+a*(n*f-h*c)),e[11]=-t*(s*(h*p-o*f)-i*(n*p-o*c)+r*(n*f-h*c)),e[12]=-t*(i*(o*d-l*m)-r*(h*d-l*u)+a*(h*m-o*u)),e[13]=t*(s*(o*d-l*m)-r*(n*d-l*_)+a*(n*m-o*_)),e[14]=-t*(s*(h*d-l*u)-i*(n*d-l*_)+a*(n*u-h*_)),e[15]=t*(s*(h*m-o*u)-i*(n*m-o*_)+r*(n*u-h*_))}return e}pointAt(t,e,s){null!=e&&void 0!=e||(e=new a.default(0,0,-1)),null!=s&&void 0!=s||(s=new a.default(0,-1,0));let i=e.subtract(t),n=new a.default(s.x,s.y,s.z);i.normalize(),n.normalize();let h=new a.default(i.x,i.y,i.z);h.scaleBy(n.dot(i)),n.subtractBy(h),n.getLength()>r.default.MATH_MIN_POSITIVE?n.normalize():0!=i.x?n.setTo(-i.y,i.x,0):n.setTo(1,0,0);let o=n.crossProduct(i);o.normalize();let l=this.m_localFS32;l[0]=o.x,l[4]=o.y,l[8]=o.z,l[12]=0,l[1]=n.x,l[5]=n.y,l[9]=n.z,l[13]=0,l[2]=i.x,l[6]=i.y,l[10]=i.z,l[14]=0,l[3]=t.x,l[7]=t.y,l[11]=t.z,l[15]=1}prepend(t){let e=t.getLocalFS32(),s=this.m_localFS32,i=e[0],r=e[4],a=e[8],n=e[12],h=e[1],o=e[5],l=e[9],_=e[13],u=e[2],m=e[6],d=e[10],c=e[14],f=e[3],p=e[7],g=e[11],v=e[15],x=s[0],y=s[4],T=s[8],b=s[12],S=s[1],E=s[5],A=s[9],w=s[13],R=s[2],M=s[6],D=s[10],F=s[14],L=s[3],B=s[7],P=s[11],C=s[15];s[0]=i*x+h*y+u*T+f*b,s[1]=i*S+h*E+u*A+f*w,s[2]=i*R+h*M+u*D+f*F,s[3]=i*L+h*B+u*P+f*C,s[4]=r*x+o*y+m*T+p*b,s[5]=r*S+o*E+m*A+p*w,s[6]=r*R+o*M+m*D+p*F,s[7]=r*L+o*B+m*P+p*C,s[8]=a*x+l*y+d*T+g*b,s[9]=a*S+l*E+d*A+g*w,s[10]=a*R+l*M+d*D+g*F,s[11]=a*L+l*B+d*P+g*C,s[12]=n*x+_*y+c*T+v*b,s[13]=n*S+_*E+c*A+v*w,s[14]=n*R+_*M+c*D+v*F,s[15]=n*L+_*B+c*P+v*C}prepend3x3(t){let e=t.getLocalFS32(),s=this.m_localFS32,i=e[0],r=e[4],a=e[8],n=e[1],h=e[5],o=e[9],l=e[2],_=e[6],u=e[10],m=s[0],d=s[4],c=s[8],f=s[1],p=s[5],g=s[9],v=s[2],x=s[6],y=s[10];s[0]=i*m+n*d+l*c,s[1]=i*f+n*p+l*g,s[2]=i*v+n*x+l*y,s[4]=r*m+h*d+_*c,s[5]=r*f+h*p+_*g,s[6]=r*v+h*x+_*y,s[8]=a*m+o*d+u*c,s[9]=a*f+o*p+u*g,s[10]=a*v+o*x+u*y}prependRotationPivot(t,e,s){h.s_tMat4.identity(),h.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),h.s_tMat4.appendTranslationXYZ(s.x,s.y,s.z),this.prepend(h.s_tMat4)}prependRotation(t,e){h.s_tMat4.identity(),h.s_tMat4.getAxisRotation(e.x,e.y,e.z,t),this.prepend(h.s_tMat4)}prependRotationX(t){h.s_tMat4.rotationX(t),this.prepend3x3(h.s_tMat4)}prependRotationY(t){h.s_tMat4.rotationY(t),this.prepend3x3(h.s_tMat4)}prependRotationZ(t){h.s_tMat4.rotationZ(t),this.prepend3x3(h.s_tMat4)}prependRotationEulerAngle(t,e,s){h.s_tMat4.rotationY(e),this.prepend3x3(h.s_tMat4),h.s_tMat4.rotationX(t),this.prepend3x3(h.s_tMat4),h.s_tMat4.rotationZ(s),this.prepend3x3(h.s_tMat4)}prependScale(t,e,s){let i=this.m_localFS32;i[0]*=t,i[1]*=e,i[2]*=s,i[4]*=t,i[5]*=e,i[6]*=s,i[8]*=t,i[9]*=e,i[10]*=s,i[12]*=t,i[13]*=e,i[14]*=s}prependScaleXY(t,e){this.m_localFS32[0]*=t,this.m_localFS32[1]*=e,this.m_localFS32[4]*=t,this.m_localFS32[5]*=e,this.m_localFS32[8]*=t,this.m_localFS32[9]*=e,this.m_localFS32[12]*=t,this.m_localFS32[13]*=e}prependTranslationXYZ(t,e,s){h.s_tMat4.identity(),this.prepend(h.s_tMat4)}prependTranslation(t){h.s_tMat4.identity(),this.prepend(h.s_tMat4)}recompose(t,e){if(t.length<3||0==t[2].x||0==t[2].y||0==t[2].z)return!1;this.identity();let s=h.s_tMat4.getFS32();s[0]=s[1]=s[2]=t[2].x,s[4]=s[5]=s[6]=t[2].y,s[8]=s[9]=s[10]=t[2].z;let i=this.m_localFS32;switch(e){case n.default.EULER_ANGLES:{let e=Math.cos(t[1].x),r=Math.cos(t[1].y),a=Math.cos(t[1].z),n=Math.sin(t[1].x),h=Math.sin(t[1].y),o=Math.sin(t[1].z);i[0]=r*a*s[0],i[1]=r*o*s[1],i[2]=-h*s[2],i[3]=0,i[4]=(n*h*a-e*o)*s[4],i[5]=(n*h*o+e*a)*s[5],i[6]=n*r*s[6],i[7]=0,i[8]=(e*h*a+n*o)*s[8],i[9]=(e*h*o-n*a)*s[9],i[10]=e*r*s[10],i[11]=0,i[12]=t[0].x,i[13]=t[0].y,i[14]=t[0].z,i[15]=1}break;default:{let r=t[1].x,a=t[1].y,h=t[1].z,o=t[1].w;if(e==n.default.AXIS_ANGLE){let t=.5*o;r*=Math.sin(t),a*=Math.sin(t),h*=Math.sin(t),o=Math.cos(t)}i[0]=(1-2*a*a-2*h*h)*s[0],i[1]=(2*r*a+2*o*h)*s[1],i[2]=(2*r*h-2*o*a)*s[2],i[3]=0,i[4]=(2*r*a-2*o*h)*s[4],i[5]=(1-2*r*r-2*h*h)*s[5],i[6]=(2*a*h+2*o*r)*s[6],i[7]=0,i[8]=(2*r*h+2*o*a)*s[8],i[9]=(2*a*h-2*o*r)*s[9],i[10]=(1-2*r*r-2*a*a)*s[10],i[11]=0,i[12]=t[0].x,i[13]=t[0].y,i[14]=t[0].z,i[15]=1}break}return 0==t[2].x&&(this.m_localFS32[0]=0),0==t[2].y&&(this.m_localFS32[5]=0),0==t[2].z&&(this.m_localFS32[10]=0),s=null,!0}setThreeAxes(t,e,s){let i=this.m_localFS32;i[0]=t.x,i[1]=t.y,i[2]=t.z,i[4]=e.x,i[5]=e.y,i[6]=e.z,i[8]=s.x,i[9]=s.y,i[10]=s.z}deltaTransformVector(t){let e=t.x,s=t.y,i=t.z;return new a.default(e*this.m_localFS32[0]+s*this.m_localFS32[4]+i*this.m_localFS32[8],e*this.m_localFS32[1]+s*this.m_localFS32[5]+i*this.m_localFS32[9],e*this.m_localFS32[2]+s*this.m_localFS32[6]+i*this.m_localFS32[10],0)}deltaTransformVectorSelf(t){let e=this.m_localFS32,s=t.x,i=t.y,r=t.z;t.x=s*e[0]+i*e[4]+r*e[8],t.y=s*e[1]+i*e[5]+r*e[9],t.z=s*e[2]+i*e[6]+r*e[10]}deltaTransformOutVector(t,e){let s=this.m_localFS32;e.x=t.x*s[0]+t.y*s[4]+t.z*s[8],e.y=t.x*s[1]+t.y*s[5]+t.z*s[9],e.z=t.x*s[2]+t.y*s[6]+t.z*s[10]}transformVector(t){let e=this.m_localFS32,s=t.x,i=t.y,r=t.z;return new a.default(s*e[0]+i*e[4]+r*e[8]+e[12],s*e[1]+i*e[5]+r*e[9]+e[13],s*e[2]+i*e[6]+r*e[10]+e[14],s*e[3]+i*e[7]+r*e[11]+e[15])}transformOutVector(t,e){let s=t.x,i=t.y,r=t.z,a=this.m_localFS32;e.setTo(s*a[0]+i*a[4]+r*a[8]+a[12],s*a[1]+i*a[5]+r*a[9]+a[13],s*a[2]+i*a[6]+r*a[10]+a[14],s*a[3]+i*a[7]+r*a[11]+a[15])}transformOutVector3(t,e){let s=this.m_localFS32;e.x=t.x*s[0]+t.y*s[4]+t.z*s[8]+s[12],e.y=t.x*s[1]+t.y*s[5]+t.z*s[9]+s[13],e.z=t.x*s[2]+t.y*s[6]+t.z*s[10]+s[14]}transformVector3Self(t){let e=t.x,s=t.y,i=t.z,r=this.m_localFS32;t.x=e*r[0]+s*r[4]+i*r[8]+r[12],t.y=e*r[1]+s*r[5]+i*r[9]+r[13],t.z=e*r[2]+s*r[6]+i*r[10]+r[14]}transformVectorSelf(t){let e=t.x,s=t.y,i=t.z,r=this.m_localFS32;t.setTo(e*r[0]+s*r[4]+i*r[8]+r[12],e*r[1]+s*r[5]+i*r[9]+r[13],e*r[2]+s*r[6]+i*r[10]+r[14],e*r[3]+s*r[7]+i*r[11]+r[15])}transformVectors(t,e,s){let i,r,a,n=0,h=this.m_localFS32;e-=3;while(n<=e)i=t[n],r=t[n+1],a=t[n+2],s[n]=i*h[0]+r*h[4]+a*h[8]+h[12],s[n+1]=i*h[1]+r*h[5]+a*h[9]+h[13],s[n+2]=i*h[2]+r*h[6]+a*h[10]+h[14],n+=3}transformVectorsSelf(t,e){let s,i,r,a=0,n=this.m_localFS32;e-=3;while(a<=e)s=t[a],i=t[a+1],r=t[a+2],t[a]=s*n[0]+i*n[4]+r*n[8]+n[12],t[a+1]=s*n[1]+i*n[5]+r*n[9]+n[13],t[a+2]=s*n[2]+i*n[6]+r*n[10]+n[14],a+=3}transformVectorsRangeSelf(t,e,s){let i,r,a,n=e,h=this.m_localFS32;s-=3;while(n<=s)i=t[n],r=t[n+1],a=t[n+2],t[n]=i*h[0]+r*h[4]+a*h[8]+h[12],t[n+1]=i*h[1]+r*h[5]+a*h[9]+h[13],t[n+2]=i*h[2]+r*h[6]+a*h[10]+h[14],n+=3}transpose(){h.s_tMat4.copyFrom(this);let t=h.s_tMat4.getFS32(),e=this.m_localFS32;e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11]}interpolateTo(t,e){let s=t.getFS32(),i=t.getFSIndex(),r=0,a=this.m_index;while(r<16)this.m_fs32[a]+=(s[i+r]-this.m_fs32[a])*e,++a,++r}getAxisRotation(t,e,s,i){i=-i;let r=this.m_localFS32,a=Math.sin(i),n=Math.cos(i),h=1-n;r[0]=n+t*t*h,r[5]=n+e*e*h,r[10]=n+s*s*h;let o=t*e*h,l=s*a;r[4]=o+l,r[1]=o-l,o=t*s*h,l=e*a,r[8]=o-l,r[2]=o+l,o=e*s*h,l=t*a,r[9]=o+l,r[6]=o-l}rotationX(t){let e=Math.sin(t),s=Math.cos(t);this.m_localFS32[0]=1,this.m_localFS32[1]=0,this.m_localFS32[2]=0,this.m_localFS32[4]=0,this.m_localFS32[5]=s,this.m_localFS32[6]=e,this.m_localFS32[8]=0,this.m_localFS32[9]=-e,this.m_localFS32[10]=s}rotationY(t){let e=Math.sin(t),s=Math.cos(t);this.m_localFS32[0]=s,this.m_localFS32[1]=0,this.m_localFS32[2]=-e,this.m_localFS32[4]=0,this.m_localFS32[5]=1,this.m_localFS32[6]=0,this.m_localFS32[8]=e,this.m_localFS32[9]=0,this.m_localFS32[10]=s}rotationZ(t){let e=Math.sin(t),s=Math.cos(t);this.m_localFS32[0]=s,this.m_localFS32[1]=e,this.m_localFS32[2]=0,this.m_localFS32[4]=-e,this.m_localFS32[5]=s,this.m_localFS32[6]=0,this.m_localFS32[8]=0,this.m_localFS32[9]=0,this.m_localFS32[10]=1}toString(){let t="\n"+this.m_localFS32[0]+","+this.m_localFS32[1]+","+this.m_localFS32[2]+","+this.m_localFS32[3]+"\n";return t+=this.m_localFS32[4]+","+this.m_localFS32[5]+","+this.m_localFS32[6]+","+this.m_localFS32[7]+"\n",t+=this.m_localFS32[8]+","+this.m_localFS32[9]+","+this.m_localFS32[10]+","+this.m_localFS32[11]+"\n",t+=this.m_localFS32[12]+","+this.m_localFS32[13]+","+this.m_localFS32[14]+","+this.m_localFS32[15]+"\n",t}transformPerspV4Self(t){t.w=t.z,t.x*=this.m_localFS32[0],t.y*=this.m_localFS32[5],t.z*=this.m_localFS32[10],t.z+=this.m_localFS32[14],t.w*=this.m_localFS32[11],t.w+=this.m_localFS32[15]}perspectiveRH(t,e,s,i){let r=Math.tan(.5*t);this.identity(),this.m_localFS32[0]=1/(e*r),this.m_localFS32[5]=1/r,this.m_localFS32[10]=-(i+s)/(i-s),this.m_localFS32[11]=-1,this.m_localFS32[14]=-2*i*s/(i-s)}perspectiveRH2(t,e,s,i,r){let a=e/Math.tan(.5*t),n=a/e,h=a/s,o=-r/(r-i),l=-i*o;this.identity(),this.m_localFS32[0]=n,this.m_localFS32[5]=h,this.m_localFS32[10]=o,this.m_localFS32[11]=-1,this.m_localFS32[14]=l}orthoRH(t,e,s,i,r,a){this.identity(),this.m_localFS32[0]=2/(i-s),this.m_localFS32[5]=2/(e-t),this.m_localFS32[10]=-2/(a-r),this.m_localFS32[12]=-(i+s)/(i-s),this.m_localFS32[13]=-(e+t)/(e-t),this.m_localFS32[14]=-(a+r)/(a-r),this.m_localFS32[15]=1}perspectiveLH(t,e,s,i){let r=Math.tan(.5*t);this.identity(),this.m_localFS32[0]=1/(e*r),this.m_localFS32[5]=1/r,this.m_localFS32[10]=(i+s)/(i-s),this.m_localFS32[11]=1,this.m_localFS32[14]=2*i*s/(i-s)}orthoLH(t,e,s,i,r,a){this.identity(),this.m_localFS32[0]=2/(i-s),this.m_localFS32[5]=2/(e-t),this.m_localFS32[10]=2/(a-r),this.m_localFS32[12]=-(i+s)/(i-s),this.m_localFS32[13]=-(e+t)/(e-t),this.m_localFS32[14]=-(a+r)/(a-r),this.m_localFS32[15]=1}lookAtRH(t,e,s){this.identity();let i=e.subtract(t);i.normalize();let r=i.crossProduct(s);r.normalize();let a=r.crossProduct(i);r.w=-r.dot(t),a.w=-a.dot(t),i.w=i.dot(t),i.negate(),this.copyRowFrom(0,r),this.copyRowFrom(1,a),this.copyRowFrom(2,i)}lookAtLH(t,e,s){this.identity();let i=e.subtract(t);i.normalize();let r=i.crossProduct(s);r.normalize();let a=r.crossProduct(i);r.w=-r.dot(t),a.w=-a.dot(t),i.w=-i.dot(t),this.copyRowFrom(0,r),this.copyRowFrom(1,a),this.copyRowFrom(2,i)}destroy(){this.m_localFS32=null,this.m_fs32=null,this.m_index=-1}}h.s_InitData=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),h.s_uid=0,h.s_isolatedUid=327679,h.s_tMat4=new h,e.default=h},"1e15":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("030e"));class n{constructor(){this.m_rcuid=0,this.m_glVer=2,this.m_rc=null,this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.vroUid=0,this.rioUid=0}getRC(){return this.m_rc}getRCUid(){return this.m_rcuid}createBuf(){return this.m_rc.createBuffer()}deleteBuf(t){this.m_rc.deleteBuffer(t)}bindArrBuf(t){this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,t)}bindEleBuf(t){this.m_rc.bindBuffer(this.m_rc.ELEMENT_ARRAY_BUFFER,t)}arrBufSubData(t,e){this.m_rc.bufferSubData(this.m_rc.ARRAY_BUFFER,e,t)}arrBufData(t,e){this.m_rc.bufferData(this.m_rc.ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}eleBufSubData(t,e){this.m_rc.bufferSubData(this.m_rc.ELEMENT_ARRAY_BUFFER,e,t)}eleBufData(t,e){this.m_rc.bufferData(this.m_rc.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}arrBufDataMem(t,e){this.m_rc.bufferData(this.m_rc.ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}eleBufDataMem(t,e){this.m_rc.bufferData(this.m_rc.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.m_rc,e))}useVtxAttribsPtrTypeFloat(t,e,s,i,r,a){this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,e);for(let n=0;n<i;++n)t.vertexAttribPointerTypeFloat(s[n],a,r[n])}useVtxAttribsPtrTypeFloatMulti(t,e,s,i,r,a){for(let n=0;n<i;++n)this.m_rc.bindBuffer(this.m_rc.ARRAY_BUFFER,e[n]),t.vertexAttribPointerTypeFloat(s[n],a,r[n])}createVertexArray(){let t=null;return t=2==this.m_glVer?this.m_rc.createVertexArray():a.default.OES_vertex_array_object.createVertexArrayOES(),t}bindVertexArray(t){return 2==this.m_glVer?this.m_rc.bindVertexArray(t):a.default.OES_vertex_array_object.bindVertexArrayOES(t),t}deleteVertexArray(t){2==this.m_glVer?this.m_rc.deleteVertexArray(t):a.default.OES_vertex_array_object.deleteVertexArrayOES(t)}testVROUid(t){return this.vroUid!=t&&(this.vroUid=t,!0)}testRIOUid(t){return this.rioUid!=t&&(this.rioUid=t,!0)}initialize(t,e,s){this.m_rc=e,this.m_rcuid=t,this.m_glVer=s;let i=this;i.RGBA=e.RGBA,i.UNSIGNED_BYTE=e.UNSIGNED_BYTE,i.TRIANGLE_STRIP=e.TRIANGLE_STRIP,i.TRIANGLE_FAN=e.TRIANGLE_FAN,i.TRIANGLES=e.TRIANGLES,i.LINES=this.m_rc.LINES,i.LINE_STRIP=e.LINE_STRIP,i.UNSIGNED_SHORT=e.UNSIGNED_SHORT,i.UNSIGNED_INT=e.UNSIGNED_INT,i.COLOR=e.COLOR,i.DEPTH=e.DEPTH,i.STENCIL=e.STENCIL,i.DEPTH_STENCIL=e.DEPTH_STENCIL,this.m_glVer>1?(i.MIN=e.MIN,i.MAX=e.MAX):(i.MIN=a.default.EXT_blend_minmax.MIN_EXT,i.MAX=a.default.EXT_blend_minmax.MAX_EXT),i.RContext=e}renderBegin(){this.vroUid=-2,this.rioUid=-3}toString(){return"[Object ROVtxBuilder()]"}}e.default=n},"1e50":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("845e")),a=i(s("77ef")),n=i(s("e903")),h=i(s("0a1c")),o=i(s("3b73"));class l{constructor(){this.m_listener=null,this.m_wasmLoader=null,this.m_dracoTask=null,this.m_threadsTotal=1,this.multiBuffers=!0,this.zipParseEnabled=!1,this.m_meshBuffer=null,this.m_segs=[],this.m_dracoParserStr='\nfunction DracoParser() {\n\n    this.parser = null;\n\n    this.verbosity = 1;\n    this.drawMode = 0;\n    this.vsScale = 1.0;\n    \n    this.attNSMap = {\n        position: "POSITION",\n        normal: "NORMAL",\n        color: "COLOR",\n        uv: "TEX_COORD",\n        generic: "GENERIC"\n    };\n    this.attMap = null;\n    this.attOpts = null;\n    \n    let selfT = this;\n    this.getAttributeOptions = function (ns) {\n        if (typeof selfT.attOpts[ns] === "undefined") selfT.attOpts[ns] = {};\n        return selfT.attOpts[ns];\n    }\n    const PARSER_TriangleStripDrawMode = 1;\n    const PARSER_TriangleFanDrawMode = 21;\n    this.addAttributeToGeometry = function (dracoDecoder, decoder, dracoGeometry, ns, attribute, geometryBuffer) {\n        if (attribute.ptr === 0) {\n            let errorMsg = "DracoParser: No attribute " + ns;\n            console.error(errorMsg);\n            throw new Error(errorMsg);\n        }\n        let numComponents = attribute.num_components();\n        let attributeData = new dracoDecoder.DracoFloat32Array();\n        decoder.GetAttributeFloatForAllPoints(dracoGeometry, attribute, attributeData);\n        let numPoints = dracoGeometry.num_points();\n        let numValues = numPoints * numComponents;\n        let fs32 = new Float32Array(numValues + 1);\n        fs32[0] = numComponents;\n        \n        for (let i = 0; i < numValues; i++) {\n            fs32[i + 1] = attributeData.GetValue(i);\n        }\n        geometryBuffer[ns] = fs32;\n        dracoDecoder.destroy(attributeData);\n    }\n    this.decodeGeomData = function (dracoDecoder, decoder, geometryType, buffer) {\n        if (selfT.getAttributeOptions("position").skipDequantization === true) {\n            decoder.SkipAttributeTransform(dracoDecoder.POSITION);\n        }\n        let dracoGeometry;\n        let decodingStatus;\n\n        if (geometryType === dracoDecoder.TRIANGULAR_MESH) {\n            dracoGeometry = new dracoDecoder.Mesh();\n            decodingStatus = decoder.DecodeBufferToMesh(buffer, dracoGeometry);\n        }\n        else {\n            dracoGeometry = new dracoDecoder.PointCloud();\n            decodingStatus = decoder.DecodeBufferToPointCloud(buffer, dracoGeometry);\n        }\n        if (!decodingStatus.ok() || dracoGeometry.ptr == 0) {\n            let errorMsg = "DracoParser: Decoding failed: ";\n            errorMsg += decodingStatus.error_msg();\n            console.error(errorMsg);\n            dracoDecoder.destroy(decoder);\n            dracoDecoder.destroy(dracoGeometry);\n            throw new Error(errorMsg);\n        }\n        dracoDecoder.destroy(buffer);\n        let numFaces;\n        if (geometryType == dracoDecoder.TRIANGULAR_MESH) {\n            numFaces = dracoGeometry.num_faces();\n        }\n        else {\n            numFaces = 0;\n        }\n        let posAttId = decoder.GetAttributeId(dracoGeometry, dracoDecoder.POSITION);\n        if (posAttId == -1) {\n            let errorMsg = "DracoParser: No position attribute found.";\n            console.error(errorMsg);\n            dracoDecoder.destroy(decoder);\n            dracoDecoder.destroy(dracoGeometry);\n            throw new Error(errorMsg);\n        }\n        let geometryBuffer = {};\n        for (let ns in selfT.attNSMap) {\n            if (selfT.attMap[ns] === undefined) {\n                let attId = decoder.GetAttributeId(dracoGeometry, dracoDecoder[selfT.attNSMap[ns]]);\n                if (attId !== -1) {\n                    if (selfT.verbosity > 0) {\n                        // console.log(\'Loaded \' + ns + \' attribute.\');\n                    }\n                    let attribute = decoder.GetAttribute(dracoGeometry, attId);\n                    selfT.addAttributeToGeometry(dracoDecoder, decoder, dracoGeometry, ns, attribute, geometryBuffer);\n                }\n            }\n        }\n        for (let ns in selfT.attMap) {\n            let attributeId = selfT.attMap[ns];\n            let attribute = decoder.GetAttributeByUniqueId(dracoGeometry, attributeId);\n            selfT.addAttributeToGeometry(dracoDecoder, decoder, dracoGeometry, ns, attribute, geometryBuffer);\n        }\n        if (geometryType == dracoDecoder.TRIANGULAR_MESH) {\n            if (selfT.drawMode === PARSER_TriangleStripDrawMode) {\n                let stripsArray = new dracoDecoder.DracoInt32Array();\n                geometryBuffer.indices = new Uint32Array(stripsArray.size());\n                for (let i = 0; i < stripsArray.size(); ++i) {\n                    geometryBuffer.indices[i] = stripsArray.GetValue(i);\n                }\n                dracoDecoder.destroy(stripsArray);\n            } else {\n                let numIndices = numFaces * 3;\n                geometryBuffer.indices = new Uint32Array(numIndices);\n                let ia = new dracoDecoder.DracoInt32Array();\n                for (let i = 0; i < numFaces; ++i) {\n                    decoder.GetFaceFromMesh(dracoGeometry, i, ia);\n                    let index = i * 3;\n                    geometryBuffer.indices[index] = ia.GetValue(0);\n                    geometryBuffer.indices[index + 1] = ia.GetValue(1);\n                    geometryBuffer.indices[index + 2] = ia.GetValue(2);\n                }\n                dracoDecoder.destroy(ia);\n            }\n        }\n        if (geometryType != dracoDecoder.TRIANGULAR_MESH) {\n            geometryBuffer.indices = null;\n        }\n        dracoDecoder.destroy(decoder);\n        dracoDecoder.destroy(dracoGeometry);\n        return geometryBuffer;\n    }\n    this.parseData = function (bufData, beginI, endI, status) {\n        let dracoDecoder = selfT.parser;\n        let buffer = new dracoDecoder.DecoderBuffer();\n        let bufLen = endI - beginI;\n        if (status < 1) {\n            buffer.Init(new Int8Array(bufData.buffer).subarray(0, bufLen), bufLen);\n        }\n        else {\n            buffer.Init(new Int8Array(bufData.buffer).subarray(beginI, endI), bufLen);\n        }\n        let decoder = new dracoDecoder.Decoder();\n        /*\n            * Determine what type is this file: mesh or point cloud.\n            */\n        let geometryType = decoder.GetEncodedGeometryType(buffer);\n        if (geometryType == dracoDecoder.TRIANGULAR_MESH) {\n            if (selfT.verbosity > 0) {\n                // console.log("Loaded a mesh segment.");\n            }\n        } else if (geometryType == dracoDecoder.POINT_CLOUD) {\n            if (selfT.verbosity > 0) {\n                // console.log("Loaded a point cloud.");\n            }\n        } else {\n            let errorMsg = "DracoParser: Unknown geometry type.";\n            console.error(errorMsg);\n            throw new Error(errorMsg);\n        }\n\n        //console.log("worker parseData, geometryType: "+geometryType);\n        return this.decodeGeomData(dracoDecoder, decoder, geometryType, buffer);\n    }\n\n    this.transformVS = function (vsScale, matfs, f32vs, vinLength) {\n        let i = 0;\n        let x = y = z = 0.0;\n        let matX = vsScale * matfs[12];\n        let matY = vsScale * matfs[13];\n        let matZ = vsScale * matfs[14];\n        while ((i + 3) <= vinLength) {\n            x = f32vs[i];\n            y = f32vs[i + 1];\n            z = f32vs[i + 2];\n            f32vs[i] = x * matfs[0] + y * matfs[4] + z * matfs[8] + matX;\n            f32vs[i + 1] = x * matfs[1] + y * matfs[5] + z * matfs[9] + matY;\n            f32vs[i + 2] = x * matfs[2] + y * matfs[6] + z * matfs[10] + matZ;\n            i += 3;\n        }\n    }\n    this.getParseData = function (bufData, errorFlag) {\n        let tarr = null;\n        if (bufData != null) {\n            tarr = [];\n            let fvs32 = null;\n            for (let key in bufData) {\n                if (bufData[key] != null) {\n                    tarr.push(bufData[key].buffer);\n                }\n            }\n            if (fvs32 != null) {\n                let atrribSize = fvs32[0];\n                let min_x = fvs32[1];\n                let min_y = fvs32[2];\n                let min_z = fvs32[3];\n                let max_x = min_x;\n                let max_y = min_y;\n                let max_z = min_z;\n                let px;\n                let py;\n                let pz;\n                for (let i = 1, len = fvs32.length; i < len; i += atrribSize) {\n                    px = fvs32[i];\n                    py = fvs32[i + 1];\n                    pz = fvs32[i + 2];\n                    if (px < min_x) min_x = px;\n                    else if (px > max_x) max_x = px;\n                    if (py < min_y) min_y = py;\n                    else if (py > max_y) max_y = py;\n                    if (pz < min_z) min_z = pz;\n                    else if (pz > max_z) max_z = pz;\n                }\n                bufData.min = { x: min_x, y: min_y, z: min_z };\n                bufData.max = { x: max_x, y: max_y, z: max_z };\n            }\n        }\n        return { data: bufData, transfers: tarr, errorFlag: errorFlag };\n    }\n    this.receiveCall = function (data) {\n        \n        let pdata = data.data;\n        selfT.drawMode = 0;\n        selfT.vsScale = 1.0;\n\n        selfT.attMap = {};\n        selfT.attOpts = { position: {} };\n        let errorFlag = 0;\n        let dataObj = null;\n        if (pdata != null) {\n            if (data.endI > data.beginI) {\n                let u8arr = new Uint8Array(pdata);\n                try {\n                    dataObj = selfT.parseData(u8arr, data.beginI, data.endI, data.status);\n                } catch (err) {\n                    errorFlag = -1;\n                    dataObj = null;\n                    console.error(err);\n                }\n            }\n        }\n        else {\n            errorFlag = -2;\n            console.error("pdata is null.");\n        }\n        return selfT.getParseData(dataObj, errorFlag);\n    }\n}\n',this.m_dracoThreadStr='\nfunction ThreadDraco() {\n    console.log("ThreadDraco instance init run ... from code str");\n\n    let m_dataIndex = 0;\n    let m_srcuid = 0;\n    this.threadIndex = 0;\n    let selfT = this;\n\n    this.parser = null;\n    this.decoder = { wasmBinary: null };\n    let dracoParser = new DracoParser();\n    function postDataMessage(data, transfers) {\n        let sendData =\n        {\n            cmd: data.cmd,\n            taskCmd: data.taskCmd,\n            threadIndex: selfT.threadIndex,\n            taskclass: selfT.getTaskClass(),\n            srcuid: m_srcuid,\n            dataIndex: m_dataIndex,\n            data: data.data\n        };\n        postMessage(sendData, transfers);\n    }\n    function initDecoder(data) {\n        selfT.decoder["wasmBinary"] = data.data;\n        selfT.decoder["onModuleLoaded"] = function (module) {\n            selfT.parser = module;\n            dracoParser.parser = module;\n            console.log("draco init finish...");\n            postDataMessage(data, [data.data]);\n        };\n        DracoDecoderModule(selfT.decoder);\n    }\n    this.receiveData = function (data) {\n        m_srcuid = data.srcuid;\n        m_dataIndex = data.dataIndex;\n        //console.log("ThreadDraco::receiveData(), data: ", data);\n\n        //console.log("data.taskCmd: ", data.taskCmd);\n        switch (data.taskCmd) {\n            case "DRACO_PARSE":\n                let parseData = dracoParser.receiveCall(data);\n                //console.log("XXXXXXXXXXXXXXXX parseData: ", parseData);\n                //return { data: bufData, transfers: tarr, errorFlag: errorFlag };\n                data.data = {module: parseData.data, errorFlag: parseData.errorFlag};\n                postDataMessage(data, parseData.transfers);\n                break;\n            case "DRACO_INIT":\n                initDecoder(data);\n                break;\n            default:\n                //postDataMessage(data);\n                break;\n        }\n    }\n    this.getTaskClass = function () {\n        return 0;\n    }\n}\n'}setListener(t){this.m_listener=t,null!=this.m_dracoTask&&this.m_dracoTask.setListener(t)}initialize(t=1){null==this.m_wasmLoader&&(this.m_threadsTotal=t>0?t:1,o.default.IsWebGL1(),this.m_wasmLoader=new h.default,this.m_wasmLoader.load(this.onWasmLoaded,this))}load(t){null!=this.m_dracoTask&&this.m_dracoTask.reset(),this.loadMeshFile(t)}loadMeshFile(t){let e=new n.default;e.multiBuffers=this.multiBuffers,e.zipParseEnabled=this.zipParseEnabled,e.load(t,(t,e)=>{this.m_meshBuffer=t;let s=e.split(","),i=Math.floor(s.length/2);this.m_segs=[];for(let r=0;r<i;++r)this.m_segs.push(parseInt(s[2*r]),parseInt(s[2*r+1]));this.m_dracoTask.parseSrcData(this.m_meshBuffer,this.m_segs)})}onWasmLoaded(t){this.m_dracoTask=new a.default(this.m_threadsTotal),r.default.Initialize(this.m_threadsTotal,t.wapper),r.default.InitTaskByCodeStr(this.m_dracoParserStr+this.m_dracoThreadStr,0,"ThreadDraco"),this.m_dracoTask.setListener(this.m_listener),this.m_dracoTask.initTask(this.m_wasmLoader.wasmBin)}run(){r.default.Run()}}e.DracoMeshBuilder=l,e.default=l},"1eb2":function(t,e,s){"use strict";if("undefined"!==typeof window){var i=window.document.currentScript,r=s("8875");i=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var a=i&&i.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(s.p=a[1])}},"1fb5":function(t,e,s){"use strict";e.byteLength=_,e.toByteArray=m,e.fromByteArray=f;for(var i=[],r=[],a="undefined"!==typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,o=n.length;h<o;++h)i[h]=n[h],r[n.charCodeAt(h)]=h;function l(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var s=t.indexOf("=");-1===s&&(s=e);var i=s===e?0:4-s%4;return[s,i]}function _(t){var e=l(t),s=e[0],i=e[1];return 3*(s+i)/4-i}function u(t,e,s){return 3*(e+s)/4-s}function m(t){var e,s,i=l(t),n=i[0],h=i[1],o=new a(u(t,n,h)),_=0,m=h>0?n-4:n;for(s=0;s<m;s+=4)e=r[t.charCodeAt(s)]<<18|r[t.charCodeAt(s+1)]<<12|r[t.charCodeAt(s+2)]<<6|r[t.charCodeAt(s+3)],o[_++]=e>>16&255,o[_++]=e>>8&255,o[_++]=255&e;return 2===h&&(e=r[t.charCodeAt(s)]<<2|r[t.charCodeAt(s+1)]>>4,o[_++]=255&e),1===h&&(e=r[t.charCodeAt(s)]<<10|r[t.charCodeAt(s+1)]<<4|r[t.charCodeAt(s+2)]>>2,o[_++]=e>>8&255,o[_++]=255&e),o}function d(t){return i[t>>18&63]+i[t>>12&63]+i[t>>6&63]+i[63&t]}function c(t,e,s){for(var i,r=[],a=e;a<s;a+=3)i=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),r.push(d(i));return r.join("")}function f(t){for(var e,s=t.length,r=s%3,a=[],n=16383,h=0,o=s-r;h<o;h+=n)a.push(c(t,h,h+n>o?o:h+n));return 1===r?(e=t[s-1],a.push(i[e>>2]+i[e<<4&63]+"==")):2===r&&(e=(t[s-2]<<8)+t[s-1],a.push(i[e>>10]+i[e>>4&63]+i[e<<2&63]+"=")),a.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},"20ef":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("8a0a"));class n{constructor(t){this.m_shdData=null,this.m_uid=-1,this.m_program=null,this.m_rcuid=-1,this.m_gl=null,this.m_shdUniqueName="",this.m_texTotal=0,this.m_aLocations=null,this.m_aLocationTypes=null,this.m_aLocationSizes=null,this.m_uLocations=null,this.m_texLocations=null,this.m_attribLIndexList=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.m_attribTypeSizeList=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.m_attriSizeList=null,this.m_uniformDict=new Map,this.m_uLocationDict=new Map,this.m_vtxShd=null,this.m_frgShd=null,this.dataUniformEnabled=!1,this.m_attrid=0,this.m_attridIndex=0,this.m_uLc=null,this.m_uIndex=0,this.m_uid=t}setShdData(t){this.m_shdData=t,this.m_shdUniqueName=t.getUniqueShaderName()}getUid(){return this.m_uid}getTexTotal(){return this.m_shdData.getTexTotal()}useTexLocation(){for(let t=0;t<this.m_texTotal;t++)this.m_gl.uniform1i(this.m_texLocations[t],t)}haveTexture(){return this.m_shdData.haveTexture()}createLocations(){let t=0,e=0,s=this.m_shdData.getAttriNSList();if(null!=s&&s.length>0&&null==this.m_aLocations){this.dataUniformEnabled=!1;let i=this.m_shdData.getAttriSizeList();this.m_aLocations=[],this.m_aLocationTypes=[],this.m_aLocationSizes=[],e=s.length;let n=0,h=0;while(t<e)h=this.m_gl.getAttribLocation(this.m_program,s[t]),this.m_aLocations.push(h),n=a.default.GetVBufAttributeTypeByNS(s[t]),this.m_aLocationTypes.push(n),this.m_aLocationSizes.push(i[t]),this.m_attribLIndexList[n]=h,this.m_attribTypeSizeList[n]=i[t],this.dataUniformEnabled=!0,++t;for(this.m_attriSizeList=[],t=0;t<this.m_attribTypeSizeList.length;++t)this.m_attribTypeSizeList[t]>0&&this.m_attriSizeList.push(this.m_attribTypeSizeList[t]);r.default.SHADERCODE_TRACE_ENABLED}if(this.m_shdData.haveCommonUniform()&&null==this.m_uLocations){let s=this.m_shdData.getUniforms();this.m_uLocations=[],e=s.length,t=0;let i=null,a="";while(t<e)s[t].isTex||(a=s[t].name,i=this.m_gl.getUniformLocation(this.m_program,a),r.default.SHADERCODE_TRACE_ENABLED,null!=i?(i.uniformName=a,i.uniqueName=this.m_shdUniqueName,s[t].location=i,this.m_uniformDict.set(a,s[t]),this.m_uLocationDict.set(a,i),this.m_uLocations.push(i),this.dataUniformEnabled=!0):r.default.SHADERCODE_TRACE_ENABLED),++t}if(this.m_texTotal=this.m_shdData.getTexTotal(),this.m_texTotal>0){this.m_texLocations=new Array(this.m_texTotal);let e=this.m_shdData.getTexUniformNames();for(t=0;t<this.m_texTotal;++t)e[t]="u_sampler"+t,this.m_texLocations[t]=this.m_gl.getUniformLocation(this.m_program,e[t])}}getLayoutBit(){return this.m_shdData.getLayoutBit()}getMid(){return this.m_shdData.getMid()}getFragOutputTotal(){return this.m_shdData.getFragOutputTotal()}getLocationsTotal(){return this.m_aLocationTypes.length}getLocationTypeByIndex(t){return this.m_aLocationTypes[t]}getLocationSizeByIndex(t){return this.m_aLocationSizes[t]}testVertexAttribPointerOffset(t){let e=!1;if(null!=t&&null!=this.m_attriSizeList&&t.length>=this.m_attriSizeList.length){let s=0,i=0;for(;i<this.m_attriSizeList.length;++i){if(s!=t[i])break;s+=4*this.m_attriSizeList[i]}e=i>=this.m_attriSizeList.length}if(!e)throw Error("Shader program vertx attributes layout can not match float attribute vertex data !!!");return e}vertexAttribPointerType(t,e,s,i,r,a){this.m_attrid=this.m_attribLIndexList[t],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,this.m_attribTypeSizeList[t],s,i,r,a))}vertexAttribPointerTypeFloat(t,e,s){this.m_attrid=this.m_attribLIndexList[t],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,this.m_attribTypeSizeList[t],this.m_gl.FLOAT,!1,e,s))}testVertexAttribPointerType(t){return this.m_attribLIndexList[t]>-1}getVertexAttribByTpye(t){return this.m_attribLIndexList[t]}vertexAttribPointerAt(t,e,s,i,r,a){this.m_attridIndex=t,this.m_attrid=this.m_aLocations[t],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,e,s,i,r,a))}vertexAttribPointerNext(t,e,s,i,r){this.m_attrid=this.m_aLocations[this.m_attridIndex],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,t,e,s,i,r)),this.m_attridIndex++}vertexAttribPointerFirst(t,e,s,i,r){this.m_attridIndex=1,this.m_attrid=this.m_aLocations[0],this.m_attrid>-1&&(this.m_gl.enableVertexAttribArray(this.m_attrid),this.m_gl.vertexAttribPointer(this.m_attrid,t,e,s,i,r))}getUniformLocationAt(t){return this.m_uIndex=t+1,this.m_uLocations[t]}getUniformLocationNext(){return this.m_uLc=this.m_uLocations[this.m_uIndex++],this.m_uLc}getUniformLocationFirst(){return this.m_uIndex=1,this.m_uLocations[0]}getUniformLocationByNS(t){return this.m_uLocationDict.get(t)}getUniformTypeNameByNS(t){return this.m_uniformDict.has(t)?this.m_uniformDict.get(t).typeName:""}getUniformTypeByNS(t){return this.m_uniformDict.has(t)?this.m_uniformDict.get(t).type:0}hasUniformByName(t){return this.m_uniformDict.has(t)}getUniformLengthByNS(t){return this.m_uniformDict.has(t)?this.m_uniformDict.get(t).arrLength:0}initShdProgram(){let t,e=this.m_shdData.getVSCodeStr(),s=this.m_shdData.getFSCodeStr();r.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(e.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),e=e.replace(t," highp ")),e.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),e=e.replace(t," highp "))),r.default.SHADERCODE_TRACE_ENABLED;let i=this.loadShader(this.m_gl.VERTEX_SHADER,e);r.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(s.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),s=s.replace(t," highp ")),s.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),s=s.replace(t," highp "))),r.default.SHADERCODE_TRACE_ENABLED;let a=this.loadShader(this.m_gl.FRAGMENT_SHADER,s),n=this.m_gl.createProgram();return this.m_gl.attachShader(n,a),this.m_gl.attachShader(n,i),this.m_gl.linkProgram(n),this.m_gl.getProgramParameter(n,this.m_gl.LINK_STATUS)?(this.m_vtxShd=i,this.m_frgShd=a,n):(r.default.SHADERCODE_TRACE_ENABLED,null)}loadShader(t,e){let s=this.m_gl.createShader(t);return this.m_gl.shaderSource(s,e),this.m_gl.compileShader(s),this.m_gl.getShaderParameter(s,this.m_gl.COMPILE_STATUS)?s:(r.default.SHADERCODE_TRACE_ENABLED,this.m_gl.deleteShader(s),null)}getUniqueShaderName(){return this.m_shdUniqueName}enabled(){return null!=this.m_program}upload(t,e){null==this.m_program&&(this.m_rcuid=e,this.m_gl=t,this.m_program=this.initShdProgram(),this.m_program.uniqueName=this.m_shdUniqueName,null!=this.m_program&&this.createLocations())}getRCUid(){return this.m_rcuid}uniformBlockBinding(t,e){this.m_gl.uniformBlockBinding(this.m_program,this.m_gl.getUniformBlockIndex(this.m_program,t),e)}toString(){return"[ShdProgram(uniqueName = "+this.m_shdUniqueName+")]"}getGPUProgram(){return this.m_program}destroy(){this.m_aLocations=null,this.m_attriSizeList=null,this.m_texTotal>0&&(this.m_texLocations.fill(null),this.m_texTotal=0),null!=this.m_program&&(this.m_gl.deleteShader(this.m_vtxShd),this.m_gl.deleteShader(this.m_frgShd),this.m_vtxShd=null,this.m_frgShd=null,this.m_gl.deleteProgram(this.m_program),this.m_program=null),this.m_gl=null,this.m_shdData=null}}e.default=n},2139:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("18c7"));class a{static GetMatTotal(){return a.s_mtotal}static GetFS32Arr(){return a.s_mfs32Arr}static SetFS32Arr(t){a.s_mfs32Arr=t;let e=a.s_mtotal,s=a.s_matList;for(let i=0;i<e;++i)s[i].setF32Arr(t)}static GetFreeId(){return a.m_freeIdList.length>0?a.m_freeIdList.pop():-1}static Allocate(t){if(t<1024&&(t=1024),a.s_mtotal<1){a.s_mtotal=t,a.s_mfs32Arr=new Float32Array(16*t);let e=0,s=new r.default(a.s_mfs32Arr,16*e),i=s.getUid();for(a.s_baseUid=i,a.s_maxUid=i+t;e<i;++e)a.s_matList.push(null),a.s_matFlagList.push(a.S_FLAG_FREE);for(a.s_matList.push(s),a.s_matFlagList.push(a.S_FLAG_FREE),a.m_freeIdList.push(s.getUid()),e=1;e<t;++e)s=new r.default(a.s_mfs32Arr,16*e),a.s_matList.push(s),a.s_matFlagList.push(a.S_FLAG_FREE),a.m_freeIdList.push(s.getUid())}}static GetMatrix(){let t=null,e=a.GetFreeId()-a.s_baseUid;return e>=0?(t=a.s_matList[e],t.identity(),a.s_matFlagList[e]=a.S_FLAG_BUSY):t=new r.default,t}static RetrieveMatrix(t){if(null!=t){let e=t.getUid();e>=a.s_baseUid&&e<a.s_maxUid&&a.s_matFlagList[e-a.s_baseUid]==a.S_FLAG_BUSY&&(a.m_freeIdList.push(e),a.s_matFlagList[e-a.s_baseUid]=a.S_FLAG_FREE)}}}a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.s_matList=[],a.s_matFlagList=[],a.m_freeIdList=[],a.s_mfs32Arr=null,a.s_baseUid=0,a.s_maxUid=0,a.s_mtotal=0,e.default=a},"250c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("81ce")),n=i(s("f208")),h=i(s("c164"));class o{constructor(){this.m_versionDeclare="#version 300 es\n",this.m_preciousCode="\nprecision mediump float;\n",this.m_mainBeginCode="\n\nvoid main(){\n",this.m_mainEndCode="\n}\n",this.m_fragExt=[],this.m_vertExt=[],this.m_defineNames=[],this.m_defineValues=[],this.m_vertLayoutNames=[],this.m_vertLayoutTypes=[],this.m_fragOutputPrecises=[],this.m_fragOutputNames=[],this.m_fragOutputTypes=[],this.m_vertUniformNames=[],this.m_vertUniformTypes=[],this.m_fragUniformNames=[],this.m_fragUniformTypes=[],this.m_varyingNames=[],this.m_varyingTypes=[],this.m_fragFunctionBlocks=[],this.m_vertFunctionBlocks=[],this.m_textureSampleTypes=[],this.m_texturePrecises=[],this.m_textureMacroNames=[],this.m_texturePrecise="",this.m_textureFlags=[],this.m_vertObjMat=!1,this.m_vertViewMat=!1,this.m_vertProjMat=!1,this.m_fragObjMat=!1,this.m_fragViewMat=!1,this.m_fragProjMat=!1,this.m_vertHeadCode="",this.m_vertMainCode="",this.m_vertMainCodeAppend="",this.m_vertMainCodePrepend="",this.m_fragHeadCode="",this.m_fragMainCode="",this.m_fragMainCodeAppend="",this.m_fragMainCodePrepend="",this.m_use2DMap=!1,this.m_preCompileInfo=null,this.normalMapEanbled=!1,this.mapLodEnabled=!1,this.derivatives=!1,this.vertMatrixInverseEnabled=!1,this.fragMatrixInverseEnabled=!1}reset(){this.m_vertObjMat=!0,this.m_vertViewMat=!0,this.m_vertProjMat=!0,this.m_fragObjMat=!1,this.m_fragViewMat=!1,this.m_fragProjMat=!1,this.m_use2DMap=!1,this.m_vertHeadCode="",this.m_vertMainCode="",this.m_vertMainCodeAppend="",this.m_vertMainCodePrepend="",this.m_fragHeadCode="",this.m_fragMainCode="",this.m_fragMainCodeAppend="",this.m_fragMainCodePrepend="",this.m_vertExt=[],this.m_fragExt=[],this.m_vertLayoutNames=[],this.m_vertLayoutTypes=[],this.m_fragOutputPrecises=[],this.m_fragOutputNames=[],this.m_fragOutputTypes=[],this.m_varyingNames=[],this.m_varyingTypes=[],this.m_vertUniformNames=[],this.m_vertUniformTypes=[],this.m_fragUniformNames=[],this.m_fragUniformTypes=[],this.m_fragFunctionBlocks=[],this.m_vertFunctionBlocks=[],this.m_defineNames=[],this.m_defineValues=[],this.m_textureSampleTypes=[],this.m_texturePrecises=[],this.m_textureMacroNames=[],this.m_textureFlags=[],this.m_texturePrecise="",this.normalMapEanbled=!1,this.mapLodEnabled=!1,this.vertMatrixInverseEnabled=!1,this.fragMatrixInverseEnabled=!1,this.m_preCompileInfo=null}getPreCompileInfo(){let t=this.m_preCompileInfo;return this.m_preCompileInfo=null,t}useHighPrecious(){this.m_preciousCode="precision highp float;"}useMediumPrecious(){this.m_preciousCode="precision mediump float;"}useLowPrecious(){this.m_preciousCode="precision lowp float;"}addDefine(t,e="1"){this.m_defineNames.push(t),this.m_defineValues.push(e)}addVertLayout(t,e){this.m_vertLayoutNames.push(e),this.m_vertLayoutTypes.push(t)}addFragOutputHighp(t,e){this.m_fragOutputPrecises.push("highp"),this.m_fragOutputNames.push(e),this.m_fragOutputTypes.push(t)}addFragOutput(t,e){this.m_fragOutputPrecises.push(""),this.m_fragOutputNames.push(e),this.m_fragOutputTypes.push(t)}addVarying(t,e){this.m_varyingNames.push(e),this.m_varyingTypes.push(t)}addVertUniform(t,e,s=0){this.m_vertUniformNames.includes(e)||(s>0?this.m_vertUniformNames.push(e+"["+s+"]"):this.m_vertUniformNames.push(e),this.m_vertUniformTypes.push(t))}addVertUniformParam(t){this.addVertUniform(t.type,t.name,t.arrayLength)}addFragUniform(t,e,s=0){this.m_fragUniformNames.includes(e)||(s>0?this.m_fragUniformNames.push(e+"["+s+"]"):this.m_fragUniformNames.push(e),this.m_fragUniformTypes.push(t))}addFragUniformParam(t){this.addFragUniform(t.type,t.name,t.arrayLength)}addFragFunction(t){this.m_fragFunctionBlocks.push(t)}addVertFunction(t){this.m_vertFunctionBlocks.push(t)}useTexturePreciseHighp(){this.m_texturePrecise="highp"}addTextureSample2D(t="",e=!0,s=!0,i=!1){this.m_textureSampleTypes.push("sampler2D"),this.m_textureMacroNames.push(t),this.m_texturePrecises.push(this.m_texturePrecise);let r=0;s&&(r|=2),i&&(r|=4),this.m_textureFlags.push(r),this.m_texturePrecise="",e&&(this.m_use2DMap=!0)}addTextureSampleCube(t="",e=!0,s=!1){this.m_textureSampleTypes.push("samplerCube"),this.m_textureMacroNames.push(t),this.m_texturePrecises.push(this.m_texturePrecise);let i=0;e&&(i|=2),s&&(i|=4),this.m_textureFlags.push(i),this.m_texturePrecise=""}addTextureSample3D(t="",e=!0,s=!1){this.m_textureSampleTypes.push("sampler3D"),this.m_textureMacroNames.push(t),this.m_texturePrecises.push(this.m_texturePrecise);let i=0;e&&(i|=2),s&&(i|=4),this.m_textureFlags.push(i),this.m_texturePrecise=""}isHaveTexture(){return this.m_textureSampleTypes.length>0}isHaveTexture2D(){return this.m_use2DMap}useVertSpaceMats(t=!0,e=!0,s=!0){this.m_vertObjMat=t,this.m_vertViewMat=e,this.m_vertProjMat=s}useFragSpaceMats(t=!0,e=!0,s=!0){this.m_fragObjMat=t,this.m_fragViewMat=e,this.m_fragProjMat=s}addVertExtend(t){this.m_vertExt.push(t)}addFragExtend(t){this.m_fragExt.push(t)}addVertHeadCode(t){""!=t&&(this.m_vertHeadCode+="\n"+t)}addVertMainCode(t){""!=t&&(this.m_vertMainCode+="\n"+t)}addFragHeadCode(t){""!=t&&(this.m_fragHeadCode+="\n"+t)}addFragMainCode(t){""!=t&&(this.m_fragMainCode+="\n"+t)}addShaderObject(t){this.addFragHeadCode(t.frag_head),this.addFragMainCode(t.frag_body),this.addVertHeadCode(t.vert_head),this.addVertMainCode(t.vert_body)}addShaderObjectHead(t){this.addFragHeadCode(t.frag_head),this.addVertMainCode(t.vert_head)}buildFragCode(){let t=0,e=0,s="";for((r.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED||r.default.IsMobileWeb())&&this.useHighPrecious(),r.default.IsWebGL2()&&(s+=this.m_versionDeclare),this.m_preCompileInfo=new n.default,this.m_preCompileInfo.info="\n//##COMPILE_INFO_BEGIN",this.m_preCompileInfo.info+="\n//##COMPILE_INFO_END",t=0,e=this.m_fragExt.length;t<e;t++)s+="\n"+this.m_fragExt[t];for(r.default.IsWebGL1()&&(this.m_fragOutputNames.length>1&&(s+="\n#extension GL_EXT_draw_buffers: require"),(this.normalMapEanbled||this.derivatives)&&(s+="\n#extension GL_OES_standard_derivatives : enable"),this.mapLodEnabled&&(s+="\n#extension GL_EXT_shader_texture_lod : enable")),r.default.IsWebGL2()?(s+="\n#define VOX_IN in",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureLod",s+="\n#define VOX_Texture2DLod textureLod"),s+="\n#define VOX_Texture2D texture",s+="\n#define VOX_TextureCube texture"):(s+="\n#define VOX_IN varying",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureCubeLodEXT",s+="\n#define VOX_Texture2DLod texture2DLodEXT"),s+="\n#define VOX_TextureCube textureCube",s+="\n#define VOX_Texture2D texture2D"),r.default.IsMobileWeb()?s+="\nprecision highp float;":s+="\n"+this.m_preciousCode,s+=h.default.FragPredefined,e=this.m_defineNames.length,t=0;t<e;t++)""!=this.m_defineValues[t]?s+="\n#define "+this.m_defineNames[t]+" "+this.m_defineValues[t]:s+="\n#define "+this.m_defineNames[t]+" 1";for(t=0,e=this.m_textureMacroNames.length;t<e;t++)""!=this.m_textureMacroNames[t]&&0!=(2&this.m_textureFlags[t])&&(s+="\n#define "+this.m_textureMacroNames[t]+" u_sampler"+t);for(this.m_use2DMap&&(s+="\n#define VOX_USE_2D_MAP 1"),t=0,e=this.m_textureSampleTypes.length;t<e;t++)0!=(2&this.m_textureFlags[t])&&(""==this.m_texturePrecises[t]?s+="\nuniform "+this.m_textureSampleTypes[t]+" u_sampler"+t+";":s+="\nuniform "+this.m_texturePrecises[t]+" "+this.m_textureSampleTypes[t]+" u_sampler"+t+";");for(t=0,e=this.m_fragUniformTypes.length;t<e;t++)s+="\nuniform "+this.m_fragUniformTypes[t]+" "+this.m_fragUniformNames[t]+";";if(this.m_fragObjMat&&(s+="\nuniform mat4 u_objMat;"),this.m_fragViewMat&&(s+="\nuniform mat4 u_viewMat;"),this.m_fragProjMat&&(s+="\nuniform mat4 u_projMat;"),e=this.m_varyingNames.length,r.default.IsWebGL2())for(t=0;t<e;t++)s+="\nin "+this.m_varyingTypes[t]+" "+this.m_varyingNames[t]+";";else for(t=0;t<e;t++)s+="\nvarying "+this.m_varyingTypes[t]+" "+this.m_varyingNames[t]+";";for(s+=h.default.FragDefined,this.fragMatrixInverseEnabled&&r.default.IsWebGL1()&&(this.addVertFunction(a.default.__glslInverseMat3),this.addVertFunction(a.default.__glslInverseMat4)),s+=this.m_fragHeadCode,t=0,e=this.m_fragFunctionBlocks.length;t<e;t++)s+="\n"+this.m_fragFunctionBlocks[t];if(t=0,e=this.m_fragOutputNames.length,r.default.IsWebGL2())for(;t<e;t++)""!=this.m_fragOutputPrecises[t]?s+="\nlayout(location = "+t+") out "+this.m_fragOutputPrecises[t]+" "+this.m_fragOutputTypes[t]+" "+this.m_fragOutputNames[t]+";":s+="\nlayout(location = "+t+") out "+this.m_fragOutputTypes[t]+" "+this.m_fragOutputNames[t]+";";else 1==e&&(s+="\n#define "+this.m_fragOutputNames[t]+" gl_FragColor");let i=!1,o=this.m_fragMainCode.indexOf("{");if(o>0){let t=this.m_fragMainCode.slice(0,o);i=t.indexOf(" main")>0,i||(i=this.m_fragMainCode.indexOf(" main")>0)}if(i?s+=this.m_fragMainCode:(s+="\nvoid main() {\n",s+=this.m_fragMainCode,s+="\n}\n"),e=this.m_fragOutputNames.length,r.default.IsWebGL1()&&e>1)for(t=0;t<e;t++){let e=new RegExp(this.m_fragOutputNames[t],"g");s=s.replace(e,"gl_FragData["+t+"]")}return s}buildVertCode(){let t=0,e=0,s="";for(r.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&this.useHighPrecious(),r.default.IsWebGL2()&&(s+=this.m_versionDeclare),t=0,e=this.m_vertExt.length;t<e;t++)s+="\n"+this.m_vertExt[t];for(r.default.IsWebGL2()?(s+="\n#define VOX_IN in",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureLod",s+="\n#define VOX_Texture2DLod textureLod"),s+="\n#define VOX_Texture2D texture",s+="\n#define VOX_TextureCube texture"):(s+="\n#define VOX_IN varying",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureCubeLodEXT",s+="\n#define VOX_Texture2DLod texture2DLodEXT"),s+="\n#define VOX_TextureCube textureCube",s+="\n#define VOX_Texture2D texture2D"),r.default.IsMobileWeb()?s+="\nprecision highp float;":s+="\n"+this.m_preciousCode,r.default.IsWebGL2()?s+="\n#define VOX_OUT out":s+="\n#define VOX_OUT varying",s+=h.default.VertPredefined,e=this.m_defineNames.length,t=0;t<e;t++)""!=this.m_defineValues[t]?s+="\n#define "+this.m_defineNames[t]+" "+this.m_defineValues[t]:s+="\n#define "+this.m_defineNames[t];for(t=0,e=this.m_textureMacroNames.length;t<e;t++)""!=this.m_textureMacroNames[t]&&0!=(4&this.m_textureFlags[t])&&(s+="\n#define "+this.m_textureMacroNames[t]+" u_sampler"+t);for(this.m_use2DMap&&(s+="\n#define VOX_USE_2D_MAP 1"),t=0,e=this.m_textureSampleTypes.length;t<e;t++)0!=(4&this.m_textureFlags[t])&&(""==this.m_texturePrecises[t]?s+="\nuniform "+this.m_textureSampleTypes[t]+" u_sampler"+t+";":s+="\nuniform "+this.m_texturePrecises[t]+" "+this.m_textureSampleTypes[t]+" u_sampler"+t+";");if(e=this.m_vertLayoutNames.length,r.default.IsWebGL2())for(t=0;t<e;t++)s+="\nlayout(location = "+t+") in "+this.m_vertLayoutTypes[t]+" "+this.m_vertLayoutNames[t]+";";else for(t=0;t<e;t++)s+="\nattribute "+this.m_vertLayoutTypes[t]+" "+this.m_vertLayoutNames[t]+";";for(e=this.m_vertUniformTypes.length,t=0;t<e;t++)s+="\nuniform "+this.m_vertUniformTypes[t]+" "+this.m_vertUniformNames[t]+";";if(this.m_vertObjMat&&(s+="\nuniform mat4 u_objMat;"),this.m_vertViewMat&&(s+="\nuniform mat4 u_viewMat;"),this.m_vertProjMat&&(s+="\nuniform mat4 u_projMat;"),e=this.m_varyingNames.length,r.default.IsWebGL2())for(t=0;t<e;t++)s+="\nout "+this.m_varyingTypes[t]+" "+this.m_varyingNames[t]+";";else for(t=0;t<e;t++)s+="\nvarying "+this.m_varyingTypes[t]+" "+this.m_varyingNames[t]+";";for(s+=h.default.VertDefined,this.vertMatrixInverseEnabled&&r.default.IsWebGL1()&&(this.addVertFunction(a.default.__glslInverseMat3),this.addVertFunction(a.default.__glslInverseMat4)),s+=this.m_vertHeadCode,t=0,e=this.m_vertFunctionBlocks.length;t<e;t++)s+="\n"+this.m_vertFunctionBlocks[t];let i=!1,n=this.m_vertMainCode.indexOf("{");if(n>0){let t=this.m_vertMainCode.slice(0,n);i=t.indexOf(" main")>0,i||(i=this.m_vertMainCode.indexOf(" main")>0)}return i?s+=this.m_vertMainCode:(s+="\nvoid main() {\n",s+=this.m_vertMainCode,s+="\n}\n"),s}}e.default=o},2514:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("faa5")),a=i(s("b3bd")),n=i(s("0fc4")),h=s("5216");class o extends r.default{constructor(){super(),this.m_uniqueName=""}initialize(t){super.initialize(t),this.m_uniqueName="ShadowVSMShd",this.adaptationShaderVersion=!1}buildThisCode(){let t=this.m_coder;if(t.addVertLayout("vec3","a_vs"),t.addVertLayout("vec2","a_uvs"),t.addVertLayout("vec3","a_nvs"),t.addTextureSample2D("VOX_VSM_MAP"),t.addTextureSample2D(),t.addVarying("vec2","v_uv"),t.addVarying("vec3","v_worldNormal"),t.addFragOutput("vec4","FragColor0"),t.addFragUniform("vec4","u_color"),t.useVertSpaceMats(!0,!0,!0),t.vertMatrixInverseEnabled=!0,this.m_coder.addFragMainCode("\n            \n    vec4 color = VOX_Texture2D( u_sampler1, v_uv );\n\n    worldNormal = v_worldNormal;\n    color.xyz *= u_color.xyz;\n\n    FragColor0 = vec4(color.xyz, 1.0);\n    \n"),this.m_coder.addVertMainCode("            \n    worldPosition = u_objMat * vec4(a_vs, 1.0);\n    viewPosition = u_viewMat * worldPosition;\n    gl_Position =  u_projMat * viewPosition;\n    v_uv = a_uvs.xy;\n    v_worldNormal = normalize(a_nvs * inverse(mat3(u_objMat)));\n    //worldPosition.xyz += a_nvs.xyz * 0.05;\n"),null!=this.pipeline){let t=[];t.push(h.MaterialPipeType.VSM_SHADOW),t.push(h.MaterialPipeType.FOG_EXP2),this.pipeline.build(this.m_coder,t)}}getFragShaderCode(){return this.buildThisCode(),this.m_coder.buildFragCode()}getVtxShaderCode(){return this.m_coder.buildVertCode()}getUniqueShaderName(){return this.m_uniqueName}toString(){return"[ShadowVSMShaderBuffer()]"}static GetInstance(){return o.s_instance}}o.s_instance=new o;class l extends n.default{constructor(){super(),this.m_colorData=new Float32Array([1,1,1,1])}getCodeBuf(){let t=o.GetInstance();return t}setRGB3f(t,e,s){this.m_colorData[0]=t,this.m_colorData[1]=e,this.m_colorData[2]=s}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_color"],t.dataList=[this.m_colorData],t}}e.default=l},2560:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279"));class n{create(t,e){let s=null,i=t.getCamera();return e.hasUniformByName(r.default.CameraViewMatUNS)&&e.hasUniformByName(r.default.CameraProjectiveMatUNS)?(s=new a.default,s.uns="u_viewAndProjMat",s.uniformNameList=[r.default.CameraViewMatUNS,r.default.CameraProjectiveMatUNS],s.copyDataFromProbe(i.matUProbe)):e.hasUniformByName(r.default.CameraViewMatUNS)?(s=new a.default,s.uns="u_viewMat",s.uniformNameList=[r.default.CameraViewMatUNS],s.copyDataFromProbeAt(0,i.matUProbe)):e.hasUniformByName(r.default.CameraProjectiveMatUNS)&&(s=new a.default,s.uns="u_projMat",s.uniformNameList=[r.default.CameraProjectiveMatUNS],s.copyDataFromProbeAt(1,i.matUProbe)),s}getIDNS(){return"CameraUniformBuilder"}}e.default=n},"264c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.m_begin=null,this.m_end=null,this.m_next=null,this.m_node=null,this.m_nodes=[],this.m_nodesTotal=0,this.m_shader=null,this.m_renderTotal=0,this.m_sorter=null,this.sortEnabled=!0,this.m_shader=t}setSorter(t){this.m_sorter=t}showInfo(){let t="",e=this.m_begin;while(null!=e)t+=e.unit.value+",",e=e.next}clear(){if(null!=this.m_shader){this.m_nodes.length>0&&(this.m_nodes=[]);let t=this.m_begin,e=null;while(null!=t)e=t,t=t.next,e.prev=null,e.next=null;this.m_begin=this.m_end=null,this.m_nodesTotal=0,this.m_renderTotal=0,this.sortEnabled=!0,this.m_shader=null}this.m_sorter=null}update(){this.sortEnabled&&this.sort()}run(t){this.m_shader.resetUniform();let e=null,s=this.m_nodes;for(let i=0;i<this.m_renderTotal;++i)e=s[i],this.m_shader.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t)}runLockMaterial(t){this.m_shader.resetUniform();let e=null,s=this.m_nodes;for(let i=0;i<this.m_renderTotal;++i)e=s[i],this.m_shader.bindToGpu(e.shdUid),e.vro.run(),e.runLockMaterial2(null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}sort(){if(this.m_nodesTotal>0){let t=this.m_begin;this.m_nodes.length<this.m_nodesTotal&&(this.m_nodes=new Array(Math.round(1.1*this.m_nodesTotal)+1));let e=0;while(null!=t)t.drawEnabled&&t.unit.drawEnabled&&(this.m_nodes[e]=t.unit,++e),t=t.next;this.m_renderTotal=e;let s=0;null!=this.m_sorter&&(s=this.m_sorter.sortRODisplay(this.m_nodes,e)),s<1&&this.snsort(0,e-1)}}sorting(t,e){let s=this.m_nodes;this.m_node=s[t];let i=this.m_node.value;while(t<e){while(t<e&&s[e].value>=i)--e;s[t]=s[e];while(t<e&&s[t].value<=i)++t;s[e]=s[t]}return s[t]=this.m_node,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}getNodesTotal(){return this.m_nodesTotal}getBegin(){return this.m_next=this.m_begin,this.m_begin}getNext(){return null!=this.m_next&&(this.m_next=this.m_next.next),this.m_next}isEmpty(){return this.m_nodesTotal<1}addNode(t){null==t.prev&&null==t.next&&(null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null,this.m_nodesTotal++)}removeNode(t){null==t.prev&&null==t.next&&t!=this.m_begin||(t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null,this.m_nodesTotal--)}}e.default=i},"265e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.__$ruid=-1,this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.prev=null,this.next=null,this.unit=null,this.vro=null,this.tro=null,this.rvroI=-1,this.rtroI=-1}setValue(t){this.unit.value=t}isVsible(){return null==this.unit||this.unit.drawEnabled}updateData(){let t=this.unit;this.drawMode=t.drawMode,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,this.vtxUid=t.vtxUid,this.vro=t.vro,this.shdUid=t.shdUid,this.texMid=t.texMid,this.tro=t.tro}reset(){this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.unit=null,this.vro=null,this.tro=null,this.prev=null,this.next=null}toString(){return"[Object RPONode(uid = "+this.uid+", index = "+this.index+", shdUid = "+this.shdUid+", vtxUid = "+this.vtxUid+")]"}}e.default=i},"29ef":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("7c63"),r=s("e08e");class a{static Initialize(){if(a.s_initBoo){a.s_initBoo=!1;let t=a;t.Rstate=new i.RODrawState,i.RenderColorMask.Rstate=a.Rstate,i.RenderStateObject.Rstate=a.Rstate,t.COLOR_MASK_ALL_TRUE=i.RenderColorMask.Create("all_true",!0,!0,!0,!0),t.COLOR_MASK_ALL_FALSE=i.RenderColorMask.Create("all_false",!1,!1,!1,!1);let e=i.RenderStateObject,s=r.RenderBlendMode;s.NORMAL=e.CreateBlendMode("NORMAL",r.GLBlendMode.ONE,r.GLBlendMode.ZERO,r.GLBlendEquation.FUNC_ADD),s.OPAQUE=e.CreateBlendMode("OPAQUE",r.GLBlendMode.ONE,r.GLBlendMode.ZERO,r.GLBlendEquation.FUNC_ADD),s.TRANSPARENT=e.CreateBlendMode("TRANSPARENT",r.GLBlendMode.SRC_ALPHA,r.GLBlendMode.ONE_MINUS_SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),s.ALPHA_ADD=e.CreateBlendMode("ALPHA_ADD",r.GLBlendMode.ONE,r.GLBlendMode.ONE_MINUS_SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),s.ADD=e.CreateBlendMode("ADD",r.GLBlendMode.SRC_ALPHA,r.GLBlendMode.ONE,r.GLBlendEquation.FUNC_ADD),s.ADD_LINEAR=e.CreateBlendMode("ADD_LINEAR",r.GLBlendMode.ONE,r.GLBlendMode.ONE,r.GLBlendEquation.FUNC_ADD),s.INVERSE_ALPHA=e.CreateBlendMode("INVERSE_ALPHA",r.GLBlendMode.ONE,r.GLBlendMode.SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),s.BLAZE=e.CreateBlendMode("BLAZE",r.GLBlendMode.SRC_COLOR,r.GLBlendMode.ONE,r.GLBlendEquation.FUNC_ADD),s.OVERLAY=e.CreateBlendMode("OVERLAY",r.GLBlendMode.DST_COLOR,r.GLBlendMode.DST_ALPHA,r.GLBlendEquation.FUNC_ADD),s.OVERLAY2=e.CreateBlendMode("OVERLAY2",r.GLBlendMode.DST_COLOR,r.GLBlendMode.SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),t.NORMAL_STATE=e.Create("normal",r.CullFaceMode.BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.BACK_CULLFACE_NORMAL_STATE=t.NORMAL_STATE,t.FRONT_CULLFACE_NORMAL_STATE=e.Create("front_normal",r.CullFaceMode.FRONT,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.NONE_CULLFACE_NORMAL_STATE=e.Create("none_normal",r.CullFaceMode.NONE,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.ALL_CULLFACE_NORMAL_STATE=e.Create("all_cull_normal",r.CullFaceMode.FRONT_AND_BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.BACK_NORMAL_ALWAYS_STATE=e.Create("back_normal_always",r.CullFaceMode.BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.ALWAYS),t.BACK_TRANSPARENT_STATE=e.Create("back_transparent",r.CullFaceMode.BACK,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.TRANSPARENT_SORT),t.BACK_TRANSPARENT_ALWAYS_STATE=e.Create("back_transparent_always",r.CullFaceMode.BACK,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.ALWAYS),t.NONE_TRANSPARENT_STATE=e.Create("none_transparent",r.CullFaceMode.NONE,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.TRANSPARENT_SORT),t.NONE_TRANSPARENT_ALWAYS_STATE=e.Create("none_transparent_always",r.CullFaceMode.NONE,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.ALWAYS),t.FRONT_CULLFACE_GREATER_STATE=e.Create("front_greater",r.CullFaceMode.FRONT,r.RenderBlendMode.NORMAL,r.DepthTestMode.TRUE_GREATER),t.BACK_ADD_BLENDSORT_STATE=e.Create("back_add_blendSort",r.CullFaceMode.BACK,r.RenderBlendMode.ADD,r.DepthTestMode.TRANSPARENT_SORT),t.BACK_ADD_ALWAYS_STATE=e.Create("back_add_always",r.CullFaceMode.BACK,r.RenderBlendMode.ADD,r.DepthTestMode.ALWAYS),t.BACK_ALPHA_ADD_ALWAYS_STATE=e.Create("back_alpha_add_always",r.CullFaceMode.BACK,r.RenderBlendMode.ALPHA_ADD,r.DepthTestMode.ALWAYS),t.NONE_ADD_ALWAYS_STATE=e.Create("none_add_always",r.CullFaceMode.NONE,r.RenderBlendMode.ADD,r.DepthTestMode.ALWAYS),t.NONE_ADD_BLENDSORT_STATE=e.Create("none_add_blendSort",r.CullFaceMode.NONE,r.RenderBlendMode.ADD,r.DepthTestMode.TRANSPARENT_SORT),t.NONE_ALPHA_ADD_ALWAYS_STATE=e.Create("none_alpha_add_always",r.CullFaceMode.NONE,r.RenderBlendMode.ALPHA_ADD,r.DepthTestMode.ALWAYS),t.FRONT_ADD_ALWAYS_STATE=e.Create("front_add_always",r.CullFaceMode.FRONT,r.RenderBlendMode.ADD,r.DepthTestMode.ALWAYS),t.FRONT_TRANSPARENT_STATE=e.Create("front_transparent",r.CullFaceMode.FRONT,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.TRANSPARENT_SORT),t.FRONT_TRANSPARENT_ALWAYS_STATE=e.Create("front_transparent_always",r.CullFaceMode.FRONT,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.ALWAYS),t.NONE_CULLFACE_NORMAL_ALWAYS_STATE=e.Create("none_normal_always",r.CullFaceMode.NONE,r.RenderBlendMode.NORMAL,r.DepthTestMode.ALWAYS),t.BACK_ALPHA_ADD_BLENDSORT_STATE=e.Create("back_alpha_add_blendSort",r.CullFaceMode.BACK,r.RenderBlendMode.ALPHA_ADD,r.DepthTestMode.TRANSPARENT_SORT)}}static CreateBlendMode(t,e,s,r=0){return i.RenderStateObject.CreateBlendMode(t,e,s,r)}static CreateBlendModeSeparate(t,e,s,r=0,a=0,n=0){return i.RenderStateObject.CreateBlendModeSeparate(t,e,s,r,a,n)}static CreateRenderState(t,e,s,r){return i.RenderStateObject.Create(t,e,s,r)}static CreateRenderColorMask(t,e,s,r,a){return i.RenderColorMask.Create(t,e,s,r,a)}static GetRenderStateByName(t){return i.RenderStateObject.GetRenderStateByName(t)}static GetRenderColorMaskByName(t){return i.RenderColorMask.GetColorMaskByName(t)}static UnlockBlendMode(){i.RenderStateObject.UnlockBlendMode()}static LockBlendMode(t){i.RenderStateObject.LockBlendMode(t)}static UnlockDepthTestMode(){i.RenderStateObject.UnlockDepthTestMode()}static LockDepthTestMode(t){i.RenderStateObject.LockDepthTestMode(t)}static ResetState(){i.RenderColorMask.Reset(),i.RenderStateObject.Reset(),a.Rstate.reset()}static Reset(t){i.RenderColorMask.Reset(),i.RenderStateObject.Reset(),a.Rstate.setRenderContext(t),a.Rstate.reset()}static ResetInfo(){a.DrawCallTimes=0,a.DrawTrisNumber=0,a.POVNumber=0}static SetDepthTestEnable(t){a.Rstate.setDepthTestEnable(t)}static SetBlendEnable(t){a.Rstate.setBlendEnable(t)}static SetStencilFunc(t,e,s){a.Rstate.setStencilFunc(t,e,s)}static SetStencilMask(t){a.Rstate.setStencilMask(t)}static SetStencilOp(t,e,s){a.Rstate.setStencilOp(t,e,s)}}a.s_initBoo=!0,a.Rstate=null,a.DrawCallTimes=0,a.DrawTrisNumber=0,a.POVNumber=0,a.COLOR_MASK_ALL_TRUE=0,a.COLOR_MASK_ALL_FALSE=1,a.NORMAL_STATE=0,a.BACK_CULLFACE_NORMAL_STATE=0,a.FRONT_CULLFACE_NORMAL_STATE=1,a.NONE_CULLFACE_NORMAL_STATE=2,a.ALL_CULLFACE_NORMAL_STATE=3,a.BACK_NORMAL_ALWAYS_STATE=4,a.BACK_TRANSPARENT_STATE=5,a.BACK_TRANSPARENT_ALWAYS_STATE=6,a.NONE_TRANSPARENT_STATE=7,a.NONE_TRANSPARENT_ALWAYS_STATE=8,a.FRONT_CULLFACE_GREATER_STATE=9,a.BACK_ADD_BLENDSORT_STATE=10,a.BACK_ADD_ALWAYS_STATE=11,a.BACK_ALPHA_ADD_ALWAYS_STATE=12,a.NONE_ADD_ALWAYS_STATE=13,a.NONE_ADD_BLENDSORT_STATE=14,a.NONE_ALPHA_ADD_ALWAYS_STATE=15,a.FRONT_ADD_ALWAYS_STATE=16,a.FRONT_TRANSPARENT_STATE=17,a.FRONT_TRANSPARENT_ALWAYS_STATE=18,a.NONE_CULLFACE_NORMAL_ALWAYS_STATE=19,a.BACK_ALPHA_ADD_BLENDSORT_STATE=20,e.default=a},"2be1":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_nodesTotal=0,this.m_nodes=[],this.m_flags=[],this.m_freeIdList=[]}createNode(){return null}restoreUid(t){}getFreeId(){return this.m_freeIdList.length>0?this.m_freeIdList.pop():-1}getNodeByUid(t){return this.m_nodes[t]}create(){let t=null,e=this.getFreeId();return e>=0?(t=this.m_nodes[e],t.uid=e,this.m_flags[e]=i.S_BUSY):(t=this.createNode(),this.m_nodes.push(t),this.m_flags.push(i.S_BUSY),t.uid=this.m_nodesTotal,this.m_nodesTotal++),t}restore(t){return null!=t&&t.uid>=0&&this.m_flags[t.uid]==i.S_BUSY&&(this.restoreUid(t.uid),this.m_freeIdList.push(t.uid),this.m_flags[t.uid]=i.S_FREE,t.reset(),!0)}restoreByUid(t){return t>=0&&t<this.m_nodesTotal&&this.m_flags[t]==i.S_BUSY&&(this.restoreUid(t),this.m_freeIdList.push(t),this.m_flags[t]=i.S_FREE,this.m_nodes[t].reset(),!0)}}i.S_BUSY=1,i.S_FREE=0,e.default=i},"2ddb":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){if(this.m_uid=-1,this.m_parseIndex=0,this.m_parseTotal=0,null==i.s_freeList){i.s_taskList=new Array(i.s_maxTasksTotal),i.s_freeList=new Array(i.s_maxTasksTotal);for(let t=0,e=i.s_freeList.length;t<e;++t)i.s_freeList[t]=t}if(!(i.s_freeList.length>0))throw Error("Create ThreadTask too much !!!");this.m_uid=i.s_freeList.pop(),i.s_taskList[this.m_uid]=this}static GetTaskByUid(t){return t<i.s_maxTasksTotal&&t>=0?i.s_taskList[t]:null}static AttachTask(t){return t.m_uid<0&&i.s_freeList.length>0&&(t.m_uid=i.s_freeList.pop(),i.s_taskList[t.m_uid]=t,!0)}static DetachTask(t){t.m_uid>=0&&(i.s_taskList[t.m_uid]=null,i.s_freeList.push(t.m_uid),t.m_uid=-1)}reset(){this.m_parseIndex=0}setParseTotal(t){this.m_parseTotal=t}isFinished(){return this.m_parseIndex>=this.m_parseTotal}getParsedTotal(){return this.m_parseIndex>=this.m_parseTotal?this.m_parseTotal:this.m_parseIndex+1}getParseTotal(){return this.m_parseTotal}getParsedIndex(){return this.m_parseIndex}getUid(){return this.m_uid}parseDone(t,e){throw Error("function parseDone(), Need Override !")}nomalizeData(t){if(!(this.m_uid>=0))throw Error("Need attach this task !");t.srcuid=this.m_uid,t.taskclass=this.getTaskClass()}addData(t){if(!(this.m_uid>=0))throw Error("Need attach this task !");t.srcuid=this.m_uid,t.taskclass=this.getTaskClass()}getWorkerSendDataAt(t){throw Error("function getWorkerSendDataAt(), Need Override !")}getTaskClass(){throw Error("function getTaskClass(), Need Override !")}destroy(){i.DetachTask(this)}}i.s_maxTasksTotal=512,i.s_taskList=null,i.s_freeList=null,e.default=i},"2e8a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("644c"));class n{constructor(){this.type=-1,this.attriType=-1,this.typeSize=3,this.typeName="",this.name="",this.layoutEnabled=!0}parseCode(t){const e=";",s=" ";t=t.replace(/^\s*|\s*$/g,"");let i=t.indexOf(e);i>0&&(t=t.slice(0,i));let n=t.split(s);this.typeName=n[n.length-2],this.name=n[n.length-1],this.type=a.default.GetTypeByTypeNS(this.typeName),this.typeSize=parseInt(this.typeName.slice(this.typeName.length-1)),this.attriType=r.default.GetVBufAttributeTypeByNS(this.name)}}e.default=n},3024:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3077"));class a extends r.default{constructor(t){super(),this.m_datafs=null,this.m_vec4Total=1,t<1&&(t=1),this.m_vec4Total=t,this.m_datafs=new Float32Array(4*t)}bindSlotAt(t){super.bindSlotAt(t),this.addVec4Data(this.m_datafs,this.m_vec4Total)}destroy(){super.destroy(),this.m_datafs=null}}e.default=a},3077:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("644c")),a=i(s("5326"));class n{constructor(){this.m_slot=null,this.m_fsList=null,this.m_fsIndex=0,this.m_slotBeginIndex=-1,this.rst=-1,this.uniformsTotal=0,this.uniformTypes=null,this.dataSizeList=null}getSlotBeginIndex(){return this.m_slotBeginIndex}getSlotUid(){return this.m_slot.getUid()}getFS32At(t){return this.m_fsList[t]}setFS32At(t,e){this.m_fsList[e]=t}setVec4DataAt(t,e,s,i,r){let a=this.m_fsList[t];a[0]=e,a[1]=s,a[2]=i,a[3]=r}setVec4Data(t,e,s,i){let r=this.m_fsList[0];r[0]=t,r[1]=e,r[2]=s,r[3]=i}setVec4DataAtWithArr4(t,e){this.m_fsList[t].set(e,0)}setVec4DataWithArr4(t){this.m_fsList[0].set(t,0)}addVec4Data(t,e){t.length,this.m_fsList.push(t),this.uniformTypes.push(r.default.SHADER_VEC4),this.dataSizeList.push(e),this.m_slot.dataList[this.m_fsIndex]=t,this.m_fsIndex++,this.uniformsTotal++,this.m_slot.index++}addMat4Data(t,e){this.m_fsList.push(t),this.uniformTypes.push(r.default.SHADER_MAT4),this.dataSizeList.push(e),this.m_slot.dataList[this.m_fsIndex]=t,this.m_fsIndex++,this.uniformsTotal++,this.m_slot.index++}isEnabled(){return this.rst>=0}bindSlotAt(t){let e=a.default.GetSlotAt(t);this.rst>=0&&this.reset(),null==this.m_fsList&&(this.m_fsList=[],this.uniformTypes=[],this.dataSizeList=[]),this.m_slot=e,this.rst=1,this.m_slotBeginIndex=e.index,this.m_fsIndex=e.index}update(){if(this.rst++,this.uniformsTotal<2)this.m_slot.flagList[this.m_slotBeginIndex]=this.rst;else for(let t=this.m_slotBeginIndex;t<=this.m_fsIndex;++t)this.m_slot.flagList[t]=this.rst}reset(){this.rst=-1,this.m_slotBeginIndex=-1,this.uniformsTotal=0,this.m_fsIndex=0,null!=this.m_fsList&&(this.m_fsList=null,this.uniformTypes=null,this.dataSizeList=null),this.m_slot=null}destroy(){this.reset()}}e.default=n},"32cc":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("b3bd")),a=i(s("faa5")),n=i(s("0fc4"));class h extends a.default{constructor(){super(),this.m_uniqueName="",this.dynColorEnabled=!1}initialize(t){this.m_uniqueName="Line3DShd",this.dynColorEnabled&&(this.m_uniqueName+="_dynColor")}buildThisCode(){this.m_coder.addVertLayout("vec3","a_vs"),this.dynColorEnabled?(this.m_coder.addDefine("DYNAMIC_COLOR"),this.m_coder.addFragUniform("vec4","u_color")):(this.m_coder.addVertLayout("vec3","a_cvs"),this.m_coder.addVarying("vec3","v_color")),this.m_coder.addFragOutputHighp("vec4","FragColor0"),this.m_coder.addFragMainCode("\nvoid main(){\n    #ifndef DYNAMIC_COLOR\n        FragColor0 = vec4(v_color, 1.0);\n    #else\n        FragColor0 = u_color;\n    #endif\n\n}\n            "),this.m_coder.addVertMainCode("\nvoid main()\n{\n    vec4 pv = u_projMat * u_viewMat * u_objMat * vec4(a_vs,1.0);\n    // pixels move offset, and no perspective error.\n    //  pv.xy = (pv.xy/pv.w - vec2(0.5)) * pv.w;\n    #ifndef DYNAMIC_COLOR\n        v_color = a_cvs;\n    #endif\n    gl_Position = pv;\n}\n            "),this.pipeline}getFragShaderCode(){return this.buildThisCode(),this.m_coder.buildFragCode()}getVtxShaderCode(){return this.m_coder.buildVertCode()}getUniqueShaderName(){return this.m_uniqueName}toString(){return"[Line3DShaderBuffer()]"}static GetInstance(){return null!=h.s_instance||(h.s_instance=new h),h.s_instance}}h.s_instance=null;class o extends n.default{constructor(t=!1){if(super(),this.m_dynColorEnabled=!1,this.m_colorArray=null,t&&(this.m_colorArray=new Float32Array([1,1,1,1]),this.m_dynColorEnabled)){let t=new r.default;t.uniformNameList=["u_color"],t.dataList=[this.m_colorArray],this.m_shaderUniformData=t}this.m_dynColorEnabled=t}getCodeBuf(){return h.GetInstance().dynColorEnabled=this.m_dynColorEnabled,h.GetInstance()}setRGB3f(t,e,s){null!=this.m_colorArray&&(this.m_colorArray[0]=t,this.m_colorArray[1]=e,this.m_colorArray[2]=s)}}e.default=o},"32fa":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("29ef")),a=i(s("725b")),n=i(s("617e")),h=i(s("3b73"));class o{constructor(){this.m_fps=60,this.m_lastTime=0,this.m_times=60,this.m_dealytime=0}getFPS(){return this.m_fps}getFPSStr(){return this.m_fps>60?"60":this.m_fps<10?"0"+this.m_fps:""+this.m_fps}updateFPS(){let t=Date.now();this.m_lastTime>0&&(--this.m_times,this.m_times<1&&(this.m_fps=Math.round(6e4/this.m_dealytime),this.m_dealytime=0,this.m_times=60),this.m_dealytime+=t-this.m_lastTime),this.m_lastTime=t}}class l{constructor(){this.m_rprocess=null,this.m_renderer=null,this.m_fpsInfo=new o,this.m_textFPSNS=null,this.m_textFPS=null,this.m_fps=60,this.m_drawCallNS=null,this.m_drawCall=null,this.m_drawCalls=0,this.m_drawTrisNS=null,this.m_drawTri=null,this.m_drawTris=0,this.m_povNS=null,this.m_pov=null,this.m_povNumber=0}initialize(t,e){if(null==this.m_renderer){let s=18;a.default.GetInstance().isEnabled()||(a.default.GetInstance().setRenderProxy(t.getRenderProxy()),a.default.GetInstance().initialize("fontTex",s,512,512,!1,!1)),this.m_renderer=t,this.m_rprocess=e;let i=a.default.GetInstance().getFontSize()+2,r=2,o=100;h.default.IsMobileWeb()&&(o*=a.default.GetInstance().getFontSize()/s);let l=o-10,_=null;_=new n.default,_.initialize("FPS:"),_.setXY(l-_.getWidth(),r),this.m_renderer.addEntityToProcess(_,this.m_rprocess),this.m_textFPSNS=_;let u=_.getWidth();_=new n.default,_.__$setRenderProxy(t.getRenderProxy()),_.initialize("60"),_.setXY(o,2),this.m_renderer.addEntityToProcess(_,this.m_rprocess),this.m_textFPS=_,r+=i,_=new n.default,_.initialize("DrawCall:"),_.setXY(l-_.getWidth(),r),this.m_renderer.addEntityToProcess(_,this.m_rprocess),this.m_drawCallNS=_,u=_.getWidth(),_=new n.default,_.__$setRenderProxy(t.getRenderProxy()),_.initialize("00"),_.setXY(o,r),this.m_renderer.addEntityToProcess(_,this.m_rprocess),this.m_drawCall=_,r+=i,_=new n.default,_.initialize("DrawTris:"),_.setXY(l-_.getWidth(),r),this.m_renderer.addEntityToProcess(_,this.m_rprocess),this.m_drawTrisNS=_,u=_.getWidth(),_=new n.default,_.__$setRenderProxy(t.getRenderProxy()),_.initialize("00"),_.setXY(o,r),this.m_renderer.addEntityToProcess(_,this.m_rprocess),this.m_drawTri=_,r+=i,_=new n.default,_.initialize("POV:"),_.setXY(l-_.getWidth(),r),this.m_renderer.addEntityToProcess(_,this.m_rprocess),this.m_povNS=_,u=_.getWidth(),_=new n.default,_.__$setRenderProxy(t.getRenderProxy()),_.initialize("00"),_.setXY(o,r),this.m_renderer.addEntityToProcess(_,this.m_rprocess),this.m_pov=_}}getFPS(){return this.m_fpsInfo.getFPS()}run(t){if(this.m_fpsInfo.updateFPS(),this.m_fps!=this.m_fpsInfo.getFPS()&&(this.m_fps=this.m_fpsInfo.getFPS(),this.m_textFPS.setText(this.m_fpsInfo.getFPSStr()),this.m_textFPS.updateMeshToGpu(),this.m_textFPS.update()),this.m_drawCalls!=r.default.DrawCallTimes){let t=r.default.DrawCallTimes+"";this.m_drawCalls=r.default.DrawCallTimes,this.m_drawCall.setText(t),this.m_drawCall.updateMeshToGpu(),this.m_drawCall.update()}if(this.m_drawTris!=r.default.DrawTrisNumber){let t=r.default.DrawTrisNumber+"";this.m_drawTris=r.default.DrawTrisNumber,this.m_drawTri.setText(t),this.m_drawTri.updateMeshToGpu(),this.m_drawTri.update()}if(this.m_povNumber!=r.default.POVNumber){let t=r.default.POVNumber+"";this.m_povNumber=r.default.POVNumber,this.m_pov.setText(t),this.m_pov.updateMeshToGpu(),this.m_pov.update()}t&&this.m_renderer.getRenderProxy().setViewPort(0,0,this.m_renderer.getViewWidth(),this.m_renderer.getViewHeight())}toString(){return"[RendererStatus]"}}e.default=l},"35fa":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{static ClacTriNormal(t,e,s,i){r.default.Subtract(e,t,a.s_temp_vb),r.default.Subtract(s,e,a.s_temp_vc),r.default.Cross(a.s_temp_vb,a.s_temp_vc,i),i.normalize()}static ClacTriNormalByVS(t,e,s){let i=9*e;a.s_temp_va.setTo(t[i],t[i+1],t[i+2]),s.setTo(t[i+3],t[i+4],t[i+5]),a.s_temp_vc.setTo(t[i+6],t[i+7],t[i+8]),s.subtractBy(a.s_temp_va),a.s_temp_vc.subtractBy(a.s_temp_va),s.crossBy(a.s_temp_vc),s.normalize()}static ClacTriNormalByIVS(t,e,s,i){let r=3*e,n=3*s[r];a.s_temp_va.setTo(t[n],t[n+1],t[n+2]),n=3*s[r+1],i.setTo(t[n],t[n+1],t[n+2]),n=3*s[r+2],a.s_temp_vc.setTo(t[n],t[n+1],t[n+2]),i.subtractBy(a.s_temp_va),a.s_temp_vc.subtractBy(a.s_temp_va),i.crossBy(a.s_temp_vc),i.normalize()}static ClacTrisNormal(t,e,s,i,n){let h=new r.default,o=0,l=0,_=0;for(_=0;_<e;++_)n[_]=0;for(_=0;_<s;++_)a.ClacTriNormalByIVS(t,_,i,h),o=3*_,l=3*i[o],n[l]+=h.x,n[l+1]+=h.y,n[l+2]+=h.z,l=3*i[o+1],n[l]+=h.x,n[l+1]+=h.y,n[l+2]+=h.z,l=3*i[o+2],n[l]+=h.x,n[l+1]+=h.y,n[l+2]+=h.z;for(_=0;_<e;_+=3)a.s_temp_va.setTo(n[_],n[_+1],n[_+2]),a.s_temp_va.normalize(),n[_]=a.s_temp_va.x,n[_+1]=a.s_temp_va.y,n[_+2]=a.s_temp_va.z}static ClacTriTangent(t,e,s,i,r,n,h){let o=3*i,l=3*r[o];a.s_temp_va.setTo(s[l],s[l+1],s[l+2]),a.s_temp_va.setTo(t[l],t[l+1],t[l+2]),l=3*r[o+1],a.s_temp_vb.setTo(t[l],t[l+1],t[l+2]),l=3*r[o+2],a.s_temp_vc.setTo(t[l],t[l+1],t[l+2]),l=2*r[o],a.s_temp_vd.setTo(e[l],e[l+1],0),l=2*r[o+1],a.s_temp_ve.setTo(e[l],e[l+1],0),l=2*r[o+2],a.s_temp_vf.setTo(e[l],e[l+1],0),a.s_temp_vb.subtractBy(a.s_temp_va),a.s_temp_vc.subtractBy(a.s_temp_va),a.s_temp_ve.subtractBy(a.s_temp_vd),a.s_temp_vf.subtractBy(a.s_temp_vd);let _=1/(a.s_temp_ve.x*a.s_temp_vf.y-a.s_temp_ve.y*a.s_temp_vf.x);n.copyFrom(a.s_temp_vb),n.scaleBy(a.s_temp_vf.y),a.s_temp_va.copyFrom(a.s_temp_vc),a.s_temp_va.scaleBy(a.s_temp_ve.y),n.subtractBy(a.s_temp_va),n.scaleBy(_),n.normalize(),h.copyFrom(a.s_temp_vc),h.scaleBy(a.s_temp_ve.x),a.s_temp_va.copyFrom(a.s_temp_vb),a.s_temp_va.scaleBy(a.s_temp_vf.x),h.subtractBy(a.s_temp_va),h.scaleBy(_),h.normalize()}static ClacTrisTangent(t,e,s,i,n,h,o,l){let _=new r.default,u=new r.default,m=0,d=0,c=0;for(c=0;c<e;++c)o[c]=0,l[c]=0;for(c=0;c<n;++c)a.ClacTriTangent(t,s,i,c,h,_,u),m=3*c,d=3*h[m],o[d]=_.x,o[d+1]=_.y,o[d+2]=_.z,l[d]=u.x,l[d+1]=u.y,l[d+2]=u.z,d=3*h[m+1],o[d]=_.x,o[d+1]=_.y,o[d+2]=_.z,l[d]=u.x,l[d+1]=u.y,l[d+2]=u.z,d=3*h[m+2],o[d]=_.x,o[d+1]=_.y,o[d+2]=_.z,l[d]=u.x,l[d+1]=u.y,l[d+2]=u.z;for(c=0;c<e;c+=3)a.s_temp_vd.setTo(o[c],o[c+1],o[c+2]),a.s_temp_vd.normalize(),a.s_temp_vb.setTo(l[c],l[c+1],l[c+2]),a.s_temp_vb.normalize(),a.s_temp_vc.setTo(i[c],i[c+1],i[c+2]),a.s_temp_va.copyFrom(a.s_temp_vc),a.s_temp_vc.scaleBy(a.s_temp_vc.dot(a.s_temp_vd)),a.s_temp_vd.subtractBy(a.s_temp_vc),a.s_temp_vd.normalize(),a.s_temp_vc.setTo(i[c],i[c+1],i[c+2]),a.s_temp_vc.scaleBy(a.s_temp_vb.dot(a.s_temp_vc)),a.s_temp_vb.subtractBy(a.s_temp_vc),a.s_temp_vb.normalize(),a.s_temp_va.crossBy(a.s_temp_vd),a.s_temp_va.dot(a.s_temp_vb)<0&&a.s_temp_vd.scaleBy(-1),o[c]=a.s_temp_vd.x,o[c+1]=a.s_temp_vd.y,o[c+2]=a.s_temp_vd.z,a.s_temp_vb.setTo(i[c],i[c+1],i[c+2]),a.s_temp_vb.crossBy(a.s_temp_vd),a.s_temp_vb.normalize(),l[c]=a.s_temp_vb.x,l[c+1]=a.s_temp_vb.y,l[c+2]=a.s_temp_vb.z}}a.s_temp_va=new r.default,a.s_temp_vb=new r.default,a.s_temp_vc=new r.default,a.s_temp_vd=new r.default,a.s_temp_ve=new r.default,a.s_temp_vf=new r.default,a.s_temp_vg=new r.default,e.default=a},"36cb":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("e08e"),a=i(s("ab73")),n=s("b02c"),h=i(s("4f27")),o=i(s("b30a")),l=i(s("9156")),_=s("74c3");class u{constructor(){this.m_emptyTRO=null,this.m_shader=null,this.m_rpoUnitBuilder=null,this.m_processBuider=null,this.m_roVtxBuild=null,this.m_rc=null,this.m_vtxRes=null,this.m_texRes=null,this.m_deferredVbufs=[],this.m_deferredTROs=[],this.m_deferredTextures=[],this.m_haveDeferredUpdate=!1}initialize(t,e,s,i){null==this.m_shader&&(this.m_rc=t,this.m_vtxRes=t.Vertex,this.m_texRes=t.Texture,this.m_shader=new o.default(t.getRCUid(),t.getRC(),t.getRenderAdapter()),this.m_rpoUnitBuilder=e,this.m_processBuider=s,this.m_roVtxBuild=i,this.m_emptyTRO=new n.EmptyTexRenderObj(this.m_texRes))}getRenderProxy(){return this.m_rc}getRenderShader(){return this.m_shader}getTextureResource(){return this.m_texRes}updateTextureData(t,e){this.m_texRes.hasResUid(t.getResUid())&&(e?(this.m_deferredTextures.push(t),this.m_haveDeferredUpdate=!0):t.__$updateToGpu(this.m_texRes))}updateDispTRO(t,e){t.__$ruid>-1&&(e?(this.m_deferredTROs.push(t),this.m_haveDeferredUpdate=!0):this.updateTextureTRO(t))}createTRO(t,e){if(null!=t){for(let e=0;e<t.length;++e)null!=t[e]&&t[e].__$setRenderProxy(this.m_rc);return n.TextureRenderObj.Create(this.m_texRes,t,e)}return null}updateTextureTRO(t){if(null!=t.__$$runit){let e=t.getMaterial();if(null!=e){let s=this.m_texRes,i=t.__$$runit,r=n.TextureRenderObj.GetByMid(s.getRCUid(),e.__$troMid);if(null!=i.tro&&(null==r||i.tro.getMid()!=r.getMid())){let t=this.m_shader.findShdProgramByShdData(e.getShaderData());null!=t&&(t.getTexTotal()>0?(null==r&&(r=this.createTRO(e.getTextureList(),t.getTexTotal())),i.tro!=r&&(null!=i.tro&&i.tro.__$detachThis(),i.tro=r,r.__$attachThis(),i.texMid=i.tro.getMid(),this.m_processBuider.rejoinRunitForTro(i),e.__$troMid=i.tro.getMid())):i.tro!=this.m_emptyTRO&&(null!=i.tro&&i.tro.__$detachThis(),i.tro=this.m_emptyTRO,i.texMid=i.tro.getMid(),this.m_processBuider.rejoinRunitForTro(i),e.__$troMid=i.texMid))}}}}updateDispMaterial(t,e){let s=null;if(e.__$ruid>=0){let i=this.m_rc,r=e.getMaterial();if(null!=r){if(null==r.getShaderData()){let t=r.getTextureList(),e=null!=t&&null!=t&&t.length>0;r.initializeByCodeBuf(e)}s=this.m_shader.create(r.getShaderData()),s.upload(i.RContext,i.getUid()),t.shdUid=s.getUid();let n=null;if(s.getTexTotal()>0?(n=this.createTRO(r.getTextureList(),s.getTexTotal()),t.tro!=n&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=n,n.__$attachThis(),t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.m_processBuider.rejoinRunitForTro(t),r.__$troMid=t.tro.getMid())):t.tro!=this.m_emptyTRO&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=this.m_emptyTRO,t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.m_processBuider.rejoinRunitForTro(t),r.__$troMid=t.texMid),null==this.m_shader.getSharedUniformByShd(s)){let t=this.createsharedMList(r,s);if(null!=t)for(let e=0;e<t.length;++e)t[e].program=s.getGPUProgram();this.m_shader.setSharedUniformByShd(s,h.default.BuildShared(t,i,s))}let o=s.hasUniformByName(a.default.LocalTransformMatUNS);null==r.__$uniform&&(r.__$uniform=h.default.BuildLocalFromData(r.createSelfUniformData(),s)),o&&null!=e.getTransform()&&(t.transUniform=l.default.GetTransUniform(e.getTransform())),null==t.transUniform?(t.transUniform=h.default.BuildLocalFromTransformV(o?e.getMatrixFS32():null,s),l.default.SetTransUniform(e.getTransform(),t.transUniform)):t.transUniform=h.default.UpdateLocalFromTransformV(t.transUniform,o?e.getMatrixFS32():null,s),t.uniform=r.__$uniform}}return s}updateVtxDataToGpuByUid(t,e){this.m_vtxRes.updateDataToGpu(t,e)}updateDispVbuf(t,e){if(t.__$ruid>-1)if(e)this.m_deferredVbufs.push(t),this.m_haveDeferredUpdate=!0;else{let e=t.__$$runit;if(null!=e&&e.vtxUid!=t.vbuf.getUid()){let s=e.vtxUid,i=this.m_vtxRes;i.hasResUid(s)&&i.__$detachRes(s),e.vro.__$detachThis(),this.buildVtxRes(t,e,this.m_shader.findShdProgramByUid(e.shdUid)),e.__$rprouid>=0&&this.m_processBuider.rejoinRunitForVro(e)}}}buildVtxRes(t,e,s){if(null!=t.vbuf){let i=this.m_vtxRes;e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,e.visible=t.visible,e.setVisible(t.visible),e.drawMode=t.drawMode,e.renderState=t.renderState,e.rcolorMask=t.rcolorMask,e.trisNumber=t.trisNumber;let r,a=t.vbuf.getUid(),n=!0;i.hasResUid(a)?(r=i.getVertexRes(a),n=r.version!=t.vbuf.version,n&&(i.destroyRes(a),r.rcuid=i.getRCUid(),r.resUid=a)):(r=new _.GpuVtxObect,r.rcuid=i.getRCUid(),r.resUid=a,i.addVertexRes(r)),n&&(r.indices.ibufStep=t.vbuf.getIBufStep(),r.indices.initialize(this.m_roVtxBuild,t.vbuf),r.vertex.initialize(this.m_roVtxBuild,s,t.vbuf),r.version=t.vbuf.version),i.__$attachRes(a),e.vro=r.createVRO(this.m_roVtxBuild,s,!0),e.vro.__$attachThis(),e.vtxUid=t.vbuf.getUid(),e.ibufStep=e.vro.ibufStep,e.ibufType=4!=e.ibufStep?this.m_rc.UNSIGNED_SHORT:this.m_rc.UNSIGNED_INT}}buildGpuDisp(t){if(t.__$ruid<0&&null!=t.getMaterial()){t.__$$rsign=r.DisplayRenderSign.LIVE_IN_WORLD;let e=this.m_rpoUnitBuilder.create();if(t.__$ruid=e.uid,t.__$$runit=e,null!=t.getPartGroup()){e.partGroup=t.getPartGroup().slice(0),e.partTotal=e.partGroup.length;let s=e.partGroup;for(let t=0,i=e.partTotal;t<i;)t++,s[t++]*=e.ibufStep}return e.setDrawFlag(t.renderState,t.rcolorMask),this.buildVtxRes(t,e,this.updateDispMaterial(e,t)),!0}return!1}update(){if(this.m_haveDeferredUpdate){this.m_haveDeferredUpdate=!1;let t=this.m_deferredVbufs.length,e=0;if(t>0){for(;e<t;++e)this.updateDispVbuf(this.m_deferredVbufs[e],!1);this.m_deferredVbufs=[]}if(t=this.m_deferredTROs.length,t>0){for(e=0;e<t;++e)this.updateTextureTRO(this.m_deferredTROs[e]);this.m_deferredTROs=[]}if(t=this.m_deferredTextures.length,t>0){for(e=0;e<t;++e)this.m_deferredTextures[e].__$updateToGpu(this.m_texRes);this.m_deferredTextures=[]}}}createsharedMList(t,e){let s=t.createSharedUniforms();if(null==s){let i=t.createSharedUniformsData();if(null!=i&&i.length>0){s=[];for(let t=0;t<i.length;++t)if(null!=i[t]){let r=h.default.BuildLocalFromData(i[t],e);s.push(r)}s.length<1&&(s=null)}}return s}updateGlobalMaterial(t){if(null!=t){let e=this.m_rc,s=null,i=null,r=null,a=!1;null==t.getShaderData()?(r=t.getTextureList(),a=null!=r&&r.length>0,t.initializeByCodeBuf(a)):r=t.getTextureList(),i=this.m_shader.create(t.getShaderData()),i.upload(e.RContext,e.getUid());let n=i.getTexTotal();if(n>0&&(s=this.createTRO(r,n)),null==this.m_shader.getSharedUniformByShd(i)){let s=this.createsharedMList(t,i);if(null!=s)for(let t=0;t<s.length;++t)s[t].program=i.getGPUProgram();this.m_shader.setSharedUniformByShd(i,h.default.BuildShared(s,e,i))}null==t.__$uniform&&(t.__$uniform=h.default.BuildLocalFromData(t.createSelfUniformData(),i)),this.m_shader.__$globalUniform=t.__$uniform,this.m_shader.bindToGpu(i.getUid()),null!=s&&s.run()}}reset(){this.m_deferredVbufs=[],this.m_deferredTROs=[]}}e.default=u},3806:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("a996")),a=i(s("1710")),n=i(s("7045")),h=i(s("9260")),o=i(s("3024")),l=i(s("badb"));class _{constructor(t,e){this.m_rcuid=0,this.uProbe=null,this.pixelRatio=1,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.m_viewX=0,this.m_viewY=0,this.m_viewW=1,this.m_viewH=1,this.m_mouseEvtDispatcher=new l.default,this.m_resize_listener=[],this.m_resize_ers=[],this.m_enterFrame_listener=[],this.m_enterFrame_ers=[],this.m_keyEvt=new n.default,this.m_keyDown_listener=[],this.m_keyDown_ers=[],this.m_keyUp_listener=[],this.m_keyUp_ers=[],this.m_preStageWidth=0,this.m_preStageHeight=0,this.m_mouseEvt=new a.default,this.m_baseEvt=new r.default,this.m_autoSynViewAndStageSize=!0,this.m_enterFrameEvt=new r.default,this.m_rcuid=t,null==_.s_document&&(_.s_document=e,e.onkeydown=function(t){h.default.KeyDown(t)},e.onkeyup=function(t){h.default.KeyUp(t)}),h.default.AddEventListener(n.default.KEY_DOWN,this,this.keyDown),h.default.AddEventListener(n.default.KEY_UP,this,this.keyUp)}getRCUid(){return this.m_rcuid}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.m_viewX}getViewY(){return this.m_viewY}getViewWidth(){return this.m_viewW}getViewHeight(){return this.m_viewH}setViewPort(t,e,s,i){this.m_autoSynViewAndStageSize=!1,this.m_viewX=t,this.m_viewY=e,s==this.m_viewW&&i==this.m_viewH||(this.m_viewW=s,this.m_viewH=i,this.updateViewUData())}updateViewUData(){null==this.uProbe&&(this.uProbe=new o.default(1),this.uProbe.bindSlotAt(this.m_rcuid)),this.uProbe.setVec4Data(2/this.stageWidth,2/this.stageHeight,this.stageWidth,this.stageHeight),this.uProbe.update(),this.m_preStageWidth=this.m_viewW,this.m_preStageHeight=this.m_viewH}update(){this.m_preStageWidth==this.stageWidth&&this.m_preStageHeight==this.stageHeight||(this.m_autoSynViewAndStageSize&&(this.m_viewW=this.stageWidth,this.m_viewH=this.stageHeight,this.updateViewUData()),this.stageHalfWidth=.5*this.stageWidth,this.stageHalfHeight=.5*this.stageHeight,this.m_baseEvt.target=this,this.m_baseEvt.type=r.default.RESIZE,this.m_baseEvt.phase=1,this.sendResizeEvt(this.m_baseEvt))}keyDown(t){this.m_keyEvt.phase=1,this.m_keyEvt.type=n.default.KEY_DOWN,this.m_keyEvt.altKey=t.altKey,this.m_keyEvt.ctrlKey=t.ctrlKey,this.m_keyEvt.shiftKey=t.shiftKey,this.m_keyEvt.repeat=t.repeat,this.m_keyEvt.key=t.key,this.m_keyEvt.keyCode=t.keyCode,this.m_keyEvt.location=t.location;let e=this.m_keyDown_listener.length;for(var s=0;s<e;++s)this.m_keyDown_listener[s].call(this.m_keyDown_ers[s],this.m_keyEvt)}keyUp(t){this.m_keyEvt.phase=1,this.m_keyEvt.type=n.default.KEY_UP,this.m_keyEvt.altKey=t.altKey,this.m_keyEvt.ctrlKey=t.ctrlKey,this.m_keyEvt.shiftKey=t.shiftKey,this.m_keyEvt.repeat=t.repeat,this.m_keyEvt.key=t.key,this.m_keyEvt.keyCode=t.keyCode,this.m_keyEvt.location=t.location,this.m_keyEvt.target=this;let e=this.m_keyUp_listener.length;for(var s=0;s<e;++s)this.m_keyUp_listener[s].call(this.m_keyUp_ers[s],this.m_keyEvt)}sendResizeEvt(t){let e=this.m_resize_listener.length;for(var s=0;s<e;++s)this.m_resize_listener[s].call(this.m_resize_ers[s],t)}mouseDown(t=1){this.m_mouseEvt.type=a.default.MOUSE_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseUp(t=1){this.m_mouseEvt.phase=1,this.m_mouseEvt.type=a.default.MOUSE_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseClick(){this.m_mouseEvt.type=a.default.MOUSE_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseDoubleClick(){this.m_mouseEvt.type=a.default.MOUSE_DOUBLE_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightDown(t=1){this.m_mouseEvt.type=a.default.MOUSE_RIGHT_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightUp(t=1){this.m_mouseEvt.type=a.default.MOUSE_RIGHT_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseBgDown(){this.m_mouseEvt.type=a.default.MOUSE_BG_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseBgUp(){this.m_mouseEvt.type=a.default.MOUSE_BG_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseRightClick(){this.m_mouseEvt.type=a.default.MOUSE_RIGHT_CLICK,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMove(){this.m_mouseEvt.type=a.default.MOUSE_MOVE,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseWheel(t){this.m_mouseEvt.type=a.default.MOUSE_WHEEL,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.wheelDeltaY=t.wheelDeltaY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseCancel(){this.m_mouseEvt.type=a.default.MOUSE_CANCEL,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiDown(t){this.m_mouseEvt.type=a.default.MOUSE_MULTI_DOWN,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiUp(t){this.m_mouseEvt.type=a.default.MOUSE_MULTI_UP,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseMultiMove(t){this.m_mouseEvt.type=a.default.MOUSE_MULTI_MOVE,this.m_mouseEvt.mouseX=this.mouseX,this.m_mouseEvt.mouseY=this.mouseY,this.m_mouseEvt.target=this,this.m_mouseEvt.phase=1,this.m_mouseEvt.posArray=t,this.m_mouseEvtDispatcher.dispatchEvt(this.m_mouseEvt)}mouseWindowUp(t=1){}mouseWindowRightUp(t=1){}enterFrame(){this.m_enterFrameEvt.type=r.default.ENTER_FRAME;let t=this.m_enterFrame_listener.length;for(var e=0;e<t;++e)this.m_enterFrame_listener[e].call(this.m_enterFrame_ers[e],this.m_enterFrameEvt)}addEventListener(t,e,s,i=!0,a=!0){if(null!=s&&null!=e){let h=0;switch(t){case r.default.RESIZE:for(h=this.m_resize_listener.length-1;h>=0;--h)if(e===this.m_resize_ers[h])break;h<0&&(this.m_resize_ers.push(e),this.m_resize_listener.push(s));break;case r.default.ENTER_FRAME:for(h=this.m_enterFrame_listener.length-1;h>=0;--h)if(e===this.m_enterFrame_ers[h])break;h<0&&(this.m_enterFrame_ers.push(e),this.m_enterFrame_listener.push(s));break;case n.default.KEY_DOWN:for(h=this.m_keyDown_listener.length-1;h>=0;--h)if(e===this.m_keyDown_ers[h])break;h<0&&(this.m_keyDown_ers.push(e),this.m_keyDown_listener.push(s));break;case n.default.KEY_UP:for(h=this.m_keyUp_listener.length-1;h>=0;--h)if(e===this.m_keyUp_ers[h])break;h<0&&(this.m_keyUp_ers.push(e),this.m_keyUp_listener.push(s));break;default:this.m_mouseEvtDispatcher.addEventListener(t,e,s,i,a);break}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=0;switch(t){case r.default.RESIZE:for(i=this.m_resize_listener.length-1;i>=0;--i)if(e===this.m_resize_ers[i]){this.m_resize_ers.splice(i,1),this.m_resize_listener.splice(i,1);break}break;case r.default.ENTER_FRAME:for(i=this.m_enterFrame_listener.length-1;i>=0;--i)if(e===this.m_enterFrame_ers[i]){this.m_enterFrame_ers.splice(i,1),this.m_enterFrame_listener.splice(i,1);break}break;case n.default.KEY_DOWN:for(i=this.m_keyDown_listener.length-1;i>=0;--i)if(e===this.m_keyDown_ers[i]){this.m_keyDown_ers.splice(i,1),this.m_keyDown_listener.splice(i,1);break}break;case n.default.KEY_UP:for(i=this.m_keyUp_listener.length-1;i>=0;--i)if(e===this.m_keyUp_ers[i]){this.m_keyUp_ers.splice(i,1),this.m_keyUp_listener.splice(i,1);break}break;default:this.m_mouseEvtDispatcher.removeEventListener(t,e,s);break}}}}_.s_document=null,e.default=_},"38de":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("f48d"));class h extends n.default{constructor(){super(...arguments),this.tv=new a.default(1,0,0)}update(){this.tv.normalize()}updateFast(){this.tv.normalize()}static IntersectionTri(t,e,s,i,r,a){return 0}static IntersectionLS(t,e,s,i,r,o=1){let l=h.__tAv;if(l.copyFrom(i),l.subtractBy(s),l.normalize(),a.default.Cross(e,l,r),r.normalize(),l.w=r.dot(t)-r.dot(i),Math.abs(l.w)<=o){r.crossBy(e),r.normalize(),r.w=r.dot(t),l.w=(r.w-r.dot(s))/l.dot(r),r.copyFrom(l),r.scaleBy(l.w),r.addBy(s),l.copyFrom(r),l.subtractBy(s);let a=n.default.__tV1;if(a.copyFrom(r),a.subtractBy(i),l.dot(a)<=0)return 1}return 0}static IntersectioNearSphere2(t,e,s,i,a){let n=h.__tAv;if(n.x=s.x-t.x,n.y=s.y-t.y,n.z=s.z-t.z,n.w=n.dot(e),i*=i,n.w>r.default.MATH_MIN_POSITIVE){if(a.copyFrom(e),a.scaleBy(n.w),a.subtractBy(n),n.x=a.getLengthSquared(),n.x<=i)return n.w-=Math.sqrt(i-n.x),a.copyFrom(e),a.scaleBy(n.w),a.addBy(t),a.w=1,1}else if(n.getLengthSquared()<=i&&(a.copyFrom(e),a.scaleBy(n.w),a.subtractBy(n),n.x=a.getLengthSquared(),n.x<=i))return n.w+=Math.sqrt(i-n.x),a.copyFrom(e),a.scaleBy(n.w),a.addBy(t),a.w=1,1;return 0}static IntersectioNearSphere(t,e,s,i,a){let n=h.__tAv;if(n.x=s.x-t.x,n.y=s.y-t.y,n.z=s.z-t.z,n.w=n.dot(e),n.w>r.default.MATH_MIN_POSITIVE){if(a.x=n.x-n.w*e.x,a.y=n.y-n.w*e.y,a.z=n.z-n.w*e.z,a.x=a.getLengthSquared(),a.w=i*i,a.x<=a.w)return a.x=n.getLengthSquared(),a.z=a.w-a.x,n.normalize(),a.y=n.dot(e)*Math.sqrt(a.x),n.w=.5*(-a.y+Math.sqrt(a.y*a.y+4*a.z)),a.copyFrom(e),a.scaleBy(n.w),a.addBy(t),a.w=1,1}else if(a.x=n.getLengthSquared(),a.w=i*i,a.x<=a.w)return a.z=a.w-a.x,n.normalize(),a.y=n.dot(e)*Math.sqrt(a.x),n.w=.5*(-a.y+Math.sqrt(a.y*a.y+4*a.z)),a.copyFrom(e),a.scaleBy(n.w),a.addBy(t),a.w=1,1;return 0}static IntersectSphere(t,e,s,i){let a=h.__tAv;return a.x=s.x-t.x,a.y=s.y-t.y,a.z=s.z-t.z,a.w=a.dot(e),a.w<r.default.MATH_MIN_POSITIVE||(a.x-=a.w*e.x,a.y-=a.w*e.y,a.z-=a.w*e.z),a.getLengthSquared()<=i*i}}h.__tAv=new a.default,e.default=h},3930:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{constructor(t=1,e=1,s=1,i=1){this.r=1,this.g=1,this.b=1,this.a=1,this.r=t,this.g=e,this.b=s,this.a=i}setRGB3Bytes(t,e,s){this.r=t/255,this.g=e/255,this.b=s/255}setRGB3f(t,e,s){this.r=t,this.g=e,this.b=s}setRGBUint24(t){this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255}setRGBA4f(t,e,s,i){this.r=t,this.g=e,this.b=s,this.a=i}copyFrom(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}scaleBy(t){this.r*=t,this.g*=t,this.b*=t}inverseRGB(){this.r=1-this.r,this.g=1-this.g,this.b=1-this.b}randomRGB(t=1){this.r=Math.random()*t,this.g=Math.random()*t,this.b=Math.random()*t}normalizeRandom(t=1){this.r=Math.random(),this.g=Math.random(),this.b=Math.random();let e=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);e>r.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/e,this.g=t*this.g/e,this.b=t*this.b/e)}normalize(t){void 0==t&&(t=1);let e=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);e>r.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/e,this.g=t*this.g/e,this.b=t*this.b/e)}getCSSDecRGBAColor(){return"rgba("+Math.floor(255*this.r)+","+Math.floor(255*this.g)+","+Math.floor(255*this.b)+","+this.a.toFixed(4)+")"}getCSSHeXRGBColor(){let t="#",e=Math.floor(255*this.r);return t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.g),t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.b),t+=e<15?"0"+e.toString(16):""+e.toString(16),t}toString(){return"[Color4(r="+this.r+", g="+this.g+",b="+this.b+",a="+this.a+")]"}}e.default=a},"3b73":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetLanguage(t){i.s_language=t}static GetLanguage(){return""!=i.s_language||(i.s_language=navigator.language),i.s_language}static SetThreadEnabled(t){i.s_threadEnabled=t}static GetThreadEnabled(){return i.s_threadEnabled}static GetDebugEnabled(){return i.s_debugEnabled}static SetDebugEnabled(t){i.s_debugEnabled=t}static SetDevicePixelRatio(t){i.s_devicePixelRatio=t}static GetDevicePixelRatio(){return i.s_devicePixelRatio}static Initialize(t){i.s_inited&&(i.s_inited=!1,i.s_WEBGL_VER=t[0],i.TestMobileWeb(),i.s_language=navigator.language+"")}static IsWebGL1(){return 1==i.s_WEBGL_VER}static IsWebGL2(){return 2==i.s_WEBGL_VER}static IsMobileWeb(){return i.s_mobileFlag>0?2==i.s_mobileFlag:i.TestMobileWeb()}static IsIOS(){if(i.s_IOS_Flag>0)return 2==i.s_IOS_Flag;let t=!1;return t=!!/iPad|iPhone|iPod/.test(navigator.platform)||void 0!=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),i.s_IOS_Flag=t?2:1,t}static IsIpadOS(){if(i.s_IPad_Flag>0)return 2==i.s_IPad_Flag;let t=navigator.maxTouchPoints>0&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform);return!t&&/iPod|iPad|iPadPro|iPodPro/i.test(navigator.userAgent)&&(t=!0),i.s_IPad_Flag=t?2:1,t}static IsAndroidOS(){if(i.s_Android_Flag>0)return 2==i.s_Android_Flag;let t=i.TestMobileWeb();return t=!(!t||!/Android|Linux/i.test(navigator.userAgent)),i.s_Android_Flag=t?2:1,t}static TestMobileWeb(){return i.s_mobileFlag>0?2==i.s_mobileFlag:/mobile/.test(location.href)?(i.s_mobileFlag=2,2==i.s_mobileFlag):/Android/i.test(navigator.userAgent)?/Mobile/i.test(navigator.userAgent)?(i.s_mobileFlag=2,2==i.s_mobileFlag):(i.s_mobileFlag=1,2==i.s_mobileFlag):/webOS|iPhone|iPod|iPad|iPodPro|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(i.s_mobileFlag=2,2==i.s_mobileFlag):(i.s_mobileFlag=1,2==i.s_mobileFlag)}}i.s_inited=!0,i.s_WEBGL_VER=2,i.s_devicePixelRatio=1,i.s_mobileFlag=0,i.s_Android_Flag=0,i.s_IOS_Flag=0,i.s_IPad_Flag=0,i.s_language="",i.s_debugEnabled=!0,i.GPU_VENDOR="unknown",i.GPU_RENDERER="unknown",i.MAX_TEXTURE_SIZE=4096,i.MAX_RENDERBUFFER_SIZE=4096,i.MAX_VIEWPORT_WIDTH=4096,i.MAX_VIEWPORT_HEIGHT=4096,i.SHOWLOG_ENABLED=!1,i.SHADERCODE_TRACE_ENABLED=!1,i.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,i.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,i.s_threadEnabled=!0,e.default=i},"3bda":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetDebugEnabled(t){i.s_debugEanbled=t}static ShowLog(t){i.s_debugEanbled&&(i.s_logStr.length>0?i.s_logStr+="<br/>"+t:i.s_logStr=t,i.UpdateDivText())}static GetLog(){return i.s_logStr}static ShowLogOnce(t){i.s_debugEanbled&&(i.s_logStr=t,i.UpdateDivText())}static ClearLog(t=""){i.s_debugEanbled&&(i.s_logStr=t,i.UpdateDivText())}static UpdateDivText(){if(i.s_debugEanbled)if(null!=i.s_infoDiv)i.s_infoDiv.innerHTML=i.s_logStr;else{var t=document.createElement("div");t.style.color="";var e=t;e.width=128,e.height=64,e.style.backgroundColor="#aa0033",e.style.left="0px",e.style.top="128px",e.style.position="absolute",document.body.appendChild(e),i.s_infoDiv=e,e.innerHTML=i.s_logStr}}}i.s_logStr="",i.s_infoDiv=null,i.s_debugEanbled=!1,e.default=i},"3bfb":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("35fa")),n=i(s("8a0a")),h=i(s("e7d2")),o=s("8a0a"),l=i(s("fecb")),_=i(s("cb29"));class u extends _.default{constructor(t=n.default.VTX_STATIC_DRAW){super(t),this.m_posList=[null,null,null,null,null,null,null,null],this.normalType=o.VtxNormalType.FLAT,this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,this.flipVerticalUV=!1,this.uvPartsNumber=0,this.uScale=1,this.vScale=1}getVS(){return this.m_vs}getUVS(){return this.m_uvs}getNVS(){return this.m_nvs}getCVS(){return this.m_cvs}setPositionAt(t,e){if(t>=0&&t<8&&null!=this.m_vs){let s=this.m_posList[t];s[0]=e.x,s[1]=e.y,s[2]=e.z}}getPositionAt(t,e){if(t>=0&&t<8&&null!=this.m_vs){let s=this.m_posList[t];e.x=s[0],e.y=s[1],e.z=s[2]}}setEdgeAt(t,e,s){if(t>=0&&t<8&&null!=this.m_vs){let i=this.m_posList[t];t++,3==t?t=0:7==t&&(t=4);let r=this.m_posList[t];i[0]=e.x,i[1]=e.y,i[2]=e.z,r[0]=s.x,r[1]=s.y,r[2]=s.z}}getEdgeAt(t,e,s){if(t>=0&&t<8&&null!=this.m_vs){let i=this.m_posList[t];t++,3==t?t=0:7==t&&(t=4);let r=this.m_posList[t];e.x=i[0],e.y=i[1],e.z=i[2],s.x=r[0],s.y=r[1],s.z=r[2]}}setFaceAt(t,e,s,i,r){if(t>=0&&t<8&&null!=this.m_vs){t*=4;let a,n,h=[e,s,i,r],o=u.s_facePosIds,l=this.m_posList;for(let e=t+4,s=0;t<e;++t)a=l[o[t]],n=h[s++],a[0]=n.x,a[1]=n.y,a[2]=n.z}}getFaceAt(t,e,s,i,r){if(t>=0&&t<8&&null!=this.m_vs){t*=4;let a,n,h=[e,s,i,r],o=u.s_facePosIds,l=this.m_posList;for(let e=t+4,s=0;t<e;++t)a=l[o[t]],n=h[s++],n.x=a[0],n.y=a[1],n.z=a[2]}}getFaceCenterAt(t,e){if(t>=0&&t<8&&null!=this.m_vs){t*=4;let s,i=u.s_facePosIds,r=this.m_posList;e.setXYZ(0,0,0);for(let a=t+4;t<a;++t)s=r[i[t]],e.x+=s[0],e.y+=s[1],e.z+=s[2];e.scaleBy(.33333)}}transformFaceAt(t,e){if(t>=0&&t<8&&null!=this.m_vs){t*=4;let s=u.s_facePosIds,i=this.m_posList;for(let r=t+4;t<r;++t)e.transformVectorsSelf(i[s[t]],3)}}initializeWithYFace(t,e,s,i){let r=t,a=e,n=.5*(r.y+a.y);this.m_posList[0]=[a.x,n,a.z],this.m_posList[1]=[a.x,n,r.z],this.m_posList[2]=[r.x,n,r.z],this.m_posList[3]=[r.x,n,a.z],r=s,a=i;let h=.5*(r.y+a.y);this.m_posList[4]=[a.x,h,a.z],this.m_posList[5]=[a.x,h,r.z],this.m_posList[6]=[r.x,h,r.z],this.m_posList[7]=[r.x,h,a.z],this.initData(this.m_posList)}initialize(t,e){this.m_posList[0]=[e.x,t.y,e.z],this.m_posList[1]=[e.x,t.y,t.z],this.m_posList[2]=[t.x,t.y,t.z],this.m_posList[3]=[t.x,t.y,e.z],this.m_posList[4]=[e.x,e.y,e.z],this.m_posList[5]=[e.x,e.y,t.z],this.m_posList[6]=[t.x,e.y,t.z],this.m_posList[7]=[t.x,e.y,e.z],this.initData(this.m_posList)}scaleUVFaceAt(t,e,s,i,r){if(null!=this.m_uvs&&t>=0&&t<6){let a=8*t,n=a+8,h=this.m_uvs;for(;a<n;a+=2)h[a]=e+h[a]*i,h[a+1]=s+h[a+1]*r}}reinitialize(){this.initData(this.m_posList)}initData(t){this.vtxTotal=24;let e=0,s=0,i=0,_=null==this.m_ivs;if(_){this.m_vs=new Float32Array(72),this.m_ivs=new Uint16Array(36);let t=[3,2,3,3,2,2];for(e=0;e<6;++e)3==t[e]?(this.m_ivs[i]=s+3,this.m_ivs[i+1]=s+2,this.m_ivs[i+2]=s+1,this.m_ivs[i+3]=s+3,this.m_ivs[i+4]=s+1,this.m_ivs[i+5]=s):(this.m_ivs[i]=s+2,this.m_ivs[i+1]=s+3,this.m_ivs[i+2]=s,this.m_ivs[i+3]=s+2,this.m_ivs[i+4]=s,this.m_ivs[i+5]=s+1),i+=6,s+=4}let m,d=u.s_facePosIds,c=this.m_posList,f=this.m_vs;for(s=0,e=0;e<this.vtxTotal;++e)m=c[d[e]],f.set(m,s),s+=3;this.bounds=new l.default,null!=this.m_transMatrix?(this.m_transMatrix.transformVectorsSelf(this.m_vs,this.m_vs.length),this.bounds.addXYZFloat32Arr(this.m_vs)):this.bounds.addXYZFloat32Arr(this.m_vs),this.bounds.updateFast(),h.default.Reset(),h.default.AddFloat32Data(this.m_vs,3);let p=6;if(this.isVBufEnabledAt(n.default.VBUF_UVS_INDEX)){if(null==this.m_uvs&&(this.m_uvs=new Float32Array(48),this.initUVData(2*this.vtxTotal),4==this.uvPartsNumber?(this.scaleUVFaceAt(0,.5,.5,.5,.5),this.scaleUVFaceAt(1,0,0,.5,.5),this.scaleUVFaceAt(2,.5,0,.5,.5),this.scaleUVFaceAt(3,0,.5,.5,.5),this.scaleUVFaceAt(4,.5,0,.5,.5),this.scaleUVFaceAt(5,0,.5,.5,.5)):6==this.uvPartsNumber&&(this.scaleUVFaceAt(0,0,0,.25,.5),this.scaleUVFaceAt(1,.25,0,.25,.5),this.scaleUVFaceAt(2,.5,0,.25,.5),this.scaleUVFaceAt(3,.75,0,.25,.5),this.scaleUVFaceAt(4,0,.5,.25,.5),this.scaleUVFaceAt(5,.25,.5,.25,.5)),this.isVBufEnabledAt(n.default.VBUF_TVS_INDEX))){i=0;while(i<6){switch(i){case 0:e=0,this.m_uvs[e]=0,this.m_uvs[e+1]=1,this.m_uvs[e+2]=1,this.m_uvs[e+3]=1,this.m_uvs[e+4]=1,this.m_uvs[e+5]=0,this.m_uvs[e+6]=0,this.m_uvs[e+7]=0;break;case 3:e=24,this.m_uvs[e]=0,this.m_uvs[e+1]=1,this.m_uvs[e+2]=1,this.m_uvs[e+3]=1,this.m_uvs[e+4]=1,this.m_uvs[e+5]=0,this.m_uvs[e+6]=0,this.m_uvs[e+7]=0;break;case 5:e=32,this.m_uvs[e]=0,this.m_uvs[e+1]=1,this.m_uvs[e+2]=1,this.m_uvs[e+3]=1,this.m_uvs[e+4]=1,this.m_uvs[e+5]=0,this.m_uvs[e+6]=0,this.m_uvs[e+7]=0;break;default:break}++i}}h.default.AddFloat32Data(this.m_uvs,2)}if(this.isVBufEnabledAt(n.default.VBUF_NVS_INDEX)){this.m_nvs=new Float32Array(72),i=0;let t=0,s=0,a=0;if(this.normalType==o.VtxNormalType.FLAT)while(i<p){switch(t=0,s=0,a=0,i){case 0:s=-1;break;case 1:s=1;break;case 2:t=1;break;case 3:a=-1;break;case 4:t=-1;break;case 5:a=1;break;default:break}e=12*i,t*=this.normalScale,s*=this.normalScale,a*=this.normalScale,this.m_nvs[e]=t,this.m_nvs[e+1]=s,this.m_nvs[e+2]=a,this.m_nvs[e+3]=t,this.m_nvs[e+4]=s,this.m_nvs[e+5]=a,this.m_nvs[e+6]=t,this.m_nvs[e+7]=s,this.m_nvs[e+8]=a,this.m_nvs[e+9]=t,this.m_nvs[e+10]=s,this.m_nvs[e+11]=a,++i}else{let n=this.bounds.center,h=0;while(i<this.vtxTotal)e=3*i,t=this.m_vs[e]-n.x,s=this.m_vs[e+1]-n.y,a=this.m_vs[e+2]-n.z,h=Math.sqrt(t*t+s*s+a*a),h>r.default.MATH_MIN_POSITIVE&&(this.m_nvs[e]=t/h,this.m_nvs[e+1]=s/h,this.m_nvs[e+2]=a/h),++i}h.default.AddFloat32Data(this.m_nvs,3)}if(this.isVBufEnabledAt(n.default.VBUF_CVS_INDEX)){this.m_cvs=new Float32Array(72),i=0;let t=1,s=1,r=1;while(i<p)e=12*i,this.m_cvs[e]=t,this.m_cvs[e+1]=s,this.m_cvs[e+2]=r,this.m_cvs[e+3]=t,this.m_cvs[e+4]=s,this.m_cvs[e+5]=r,this.m_cvs[e+6]=t,this.m_cvs[e+7]=s,this.m_cvs[e+8]=r,this.m_cvs[e+9]=t,this.m_cvs[e+10]=s,this.m_cvs[e+11]=r,++i;h.default.AddFloat32Data(this.m_cvs,3)}if(this.isVBufEnabledAt(n.default.VBUF_TVS_INDEX)){let t=12,e=new Float32Array(this.m_nvs.length),s=new Float32Array(this.m_nvs.length);a.default.ClacTrisTangent(this.m_vs,this.m_vs.length,this.m_uvs,this.m_nvs,t,this.m_ivs,e,s),h.default.AddFloat32Data(e,3),h.default.AddFloat32Data(s,3)}h.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.wireframe&&this.updateWireframeIvs(),_?(this.m_vbuf=h.default.CreateBySaveData(this.getBufDataUsage()),this.m_vbuf.setUint16IVSData(this.m_ivs),this.vtCount=this.m_ivs.length,this.trisNumber=12,this.buildEnd()):h.default.UpdateBufData(this.m_vbuf)}setFaceUVSAt(t,e,s=0){if(null!=this.m_uvs)if(s<1)this.m_uvs.set(e,8*t);else{t*=8,s<0&&(s=0);for(let i=0;i<4;++i)this.m_uvs[t++]=e[2*s],this.m_uvs[t++]=e[2*s+1],s++,s%=4}}initUVData(t){let e=this.uScale,s=this.vScale,i=0;if(this.flipVerticalUV)while(i<t)this.m_uvs[i]=1*e,this.m_uvs[i+1]=1*s,this.m_uvs[i+2]=0*e,this.m_uvs[i+3]=1*s,this.m_uvs[i+4]=0*e,this.m_uvs[i+5]=0*s,this.m_uvs[i+6]=1*e,this.m_uvs[i+7]=0*s,i+=8;else while(i<t)this.m_uvs[i]=0*e,this.m_uvs[i+1]=0*s,this.m_uvs[i+2]=1*e,this.m_uvs[i+3]=0*s,this.m_uvs[i+4]=1*e,this.m_uvs[i+5]=1*s,this.m_uvs[i+6]=0*e,this.m_uvs[i+7]=1*s,i+=8}toString(){return"Box3DMesh()"}__$destroy(){this.isResFree()&&(this.bounds=null,this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,super.__$destroy())}}u.s_facePosIds=[0,1,2,3,4,5,6,7,4,5,1,0,5,6,2,1,7,6,2,3,4,7,3,0],e.default=u},"3c81":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("7696"));class n extends r.default{setCreateParams(t,e,s,i,r,a){this.m_shader=t,this.m_rpoNodeBuilder=e,this.m_rpoUnitBuilder=s,this.m_vtxResource=i,this.m_batchEnabled=r,this.m_fixedState=a}createNode(){return new a.default(this.m_shader,this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_vtxResource,this.m_batchEnabled,this.m_fixedState)}rejoinRunitForTro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForTro(t)}rejoinRunitForVro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForVro(t)}}e.default=n},"402a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=i(s("8e17")),n=i(s("fecb")),h=i(s("1710")),o=i(s("29ef")),l=i(s("0929")),_=s("cc48"),u=i(s("dc2b"));class m{constructor(t=null){this.m_uid=0,this.m_transfrom=null,this.m_mouseEvtDispatcher=null,this.m_visible=!0,this.m_drawEnabled=!0,this.m_rcolorMask=o.default.COLOR_MASK_ALL_TRUE,this.m_renderState=o.default.BACK_CULLFACE_NORMAL_STATE,this.m_display=null,this.m_mesh=null,this.m_globalBounds=null,this.m_parent=null,this.m_renderProxy=null,this.__$rseFlag=r.default.DEFAULT,this.name="DisplayEntity",this.spaceCullMask=_.SpaceCullingMask.CAMERA,this.drawEnabled=!1,this.mouseEnabled=!1,this.vbWholeDataEnabled=!0,this.m_texChanged=!1,this.m_meshChanged=!1,this.m_transStatus=l.default.UPDATE_TRANSFORM,this.m_uid=m.s_uid++,this.m_transfrom=null==t?l.default.Create():t,this.createBounds()}createBounds(){this.m_globalBounds=new n.default}__$setRenderProxy(t){this.m_renderProxy=t}__$setParent(t){this.m_parent,this.m_parent=t}__$getParent(){return this.m_parent}__$testSpaceEnabled(){return r.default.TestSpaceEnabled2(this.__$rseFlag)}__$testContainerEnabled(){return r.default.TestContainerEnabled(this.__$rseFlag)}__$testRendererEnabled(){return r.default.TestRendererEnabled(this.__$rseFlag)}getRendererUid(){return r.default.GetRendererUid(this.__$rseFlag)}isFree(){return this.__$rseFlag==r.default.DEFAULT}dispatchEvt(t){t.getClassType()==h.default.EventClassType&&null!=this.m_mouseEvtDispatcher&&this.m_mouseEvtDispatcher.dispatchEvt(t)}getEvtDispatcher(t){return this.m_mouseEvtDispatcher}setEvtDispatcher(t){this.m_mouseEvtDispatcher=t}getGlobalBounds(){return this.m_globalBounds}getLocalBounds(){return this.m_mesh.bounds}getGlobalBoundsVer(){return null!=this.m_globalBounds?this.m_globalBounds.version:-1}__$setDrawEnabled(t){this.m_drawEnabled!=t&&(this.m_drawEnabled=t,null!=this.m_display&&(this.m_display.visible=this.m_visible&&t,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setVisible(this.m_display.visible)))}isDrawEnabled(){return this.m_drawEnabled}updateMeshToGpu(t=null,e=!0){null!=t&&(this.m_renderProxy=t),null!=this.m_renderProxy&&null!=this.m_display&&this.m_display.__$ruid>-1&&(this.m_meshChanged?(this.m_meshChanged=!1,this.m_renderProxy.VtxBufUpdater.updateDispVbuf(this.m_display,e)):this.m_renderProxy.VtxBufUpdater.updateVtxDataToGpuByUid(this.m_display.vbuf.getUid(),e))}updateMaterialToGpu(t=null,e=!0){null!=t&&(this.m_renderProxy=t),null!=this.m_renderProxy&&null!=this.m_display&&this.m_display.__$ruid>-1&&this.m_texChanged&&(this.m_texChanged=!1,this.m_renderProxy.MaterialUpdater.updateDispTRO(this.m_display,e))}setTextureList(t){null!=this.m_display&&this.m_display.__$ruid>-1&&null!=this.m_display.getMaterial()&&(this.m_display.getMaterial().setTextureList(t),this.m_texChanged=!0)}setTextureAt(t,e){null!=this.m_display&&this.m_display.__$ruid>-1&&null!=this.m_display.getMaterial()&&(this.m_display.getMaterial().setTextureAt(t,e),this.m_texChanged=!0)}setSortValue(t){null!=this.m_display&&null!=this.m_display.__$$runit&&(this.m_display.__$$runit.value=t)}setVisible(t){this.m_visible!=t&&(this.m_visible=t,null!=this.m_display&&(this.m_display.visible=t&&this.m_drawEnabled,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setVisible(this.m_display.visible)))}getVisible(){return this.m_visible}getTransform(){return this.m_transfrom}copyPositionFrom(t){null!=t&&this.m_transfrom.copyPositionFrom(t.getTransform())}copyMeshFrom(t){null!=t&&this.setMesh(t.getMesh())}copyMaterialFrom(t){null!=t&&this.setMaterial(t.getMaterial())}copyTransformFrom(t){let e=t;null!=e&&this.m_transfrom.copyFrom(e.m_transfrom)}initDisplay(t){this.m_display.vbuf=t.__$attachVBuf(),this.m_display.ivsIndex=0,this.m_display.ivsCount=t.vtCount,this.m_display.drawMode=t.drawMode,this.m_display.trisNumber=t.trisNumber,this.m_display.visible=this.m_visible&&this.m_drawEnabled}setMesh(t){null==this.m_mesh?null!=t&&(t.isEnabled()||t.rebuild(),t.isEnabled()&&(this.m_mesh=t,t.__$attachThis(),null==this.m_display&&this.createDisplay(),null!=this.m_display&&(this.m_display.setTransform(this.m_transfrom.getMatrix()),this.initDisplay(t)),null!=this.m_globalBounds&&this.m_globalBounds.copyFrom(t.bounds),this.updateMesh())):null!=this.m_display&&this.m_display.__$ruid>-1&&this.m_mesh!=t&&null!=t&&(this.m_transfrom.updatedStatus|=2,this.m_mesh.__$detachVBuf(this.m_display.vbuf),this.m_mesh.__$detachThis(),t.__$attachThis(),this.m_mesh=t,this.initDisplay(t),this.m_meshChanged=!0,this.updateMesh())}updateMesh(){}getIvsIndex(){return this.m_display.ivsIndex}getIvsCount(){return this.m_display.ivsCount}setIvsParam(t,e){null!=this.m_display&&(this.m_display.ivsIndex=t,this.m_display.ivsCount=e,this.m_display.__$ruid>-1&&this.m_display.__$$runit.setIvsParam(t,e))}getMesh(){return this.m_mesh}hasMesh(){return null!=this.m_mesh}isPolyhedral(){return null==this.m_mesh||this.m_mesh.isPolyhedral()}testRay(t,e,s,i){return this.m_mesh.testRay(t,e,s,i)}setMaterial(t){null!=t&&(null==this.m_display&&(this.m_display=u.default.Create(),this.m_display.setTransform(this.m_transfrom.getMatrix()),this.m_display.visible=this.m_visible&&this.m_drawEnabled),this.m_display.getMaterial()!=t&&(r.default.RENDERER_UID_FLAT&this.__$rseFlag)==r.default.RENDERER_UID_FLAT&&this.m_display.__$ruid<0&&(this.m_display.renderState=this.m_renderState,this.m_display.rcolorMask=this.m_rcolorMask,this.m_display.setMaterial(t)))}getMaterial(){return null!=this.m_display?this.m_display.getMaterial():null}getDisplay(){return this.m_display}getInvMatrix(){return this.m_transfrom.getInvMatrix()}getMatrix(){return this.m_transfrom.getMatrix()}getToParentMatrix(){return this.m_transfrom.getToParentMatrix()}setRenderColorMask(t){this.m_rcolorMask=t,null!=this.m_display&&(this.m_display.rcolorMask=this.m_rcolorMask,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setDrawFlag(this.m_renderState,this.m_rcolorMask))}setRenderColorMaskByName(t){this.m_rcolorMask=o.default.GetRenderColorMaskByName(t),null!=this.m_display&&(this.m_display.rcolorMask=this.m_rcolorMask,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setDrawFlag(this.m_renderState,this.m_rcolorMask))}setRenderState(t){this.m_renderState=t,null!=this.m_display&&(this.m_display.renderState=this.m_renderState,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setDrawFlag(this.m_renderState,this.m_rcolorMask))}setRenderStateByName(t){this.m_renderState=o.default.GetRenderStateByName(t),null!=this.m_display&&(this.m_display.renderState=this.m_renderState,null!=this.m_display.__$$runit&&this.m_display.__$$runit.setDrawFlag(this.m_renderState,this.m_rcolorMask))}createDisplay(){this.m_display=u.default.Create()}activeDisplay(){if(null!=this.m_display){let t=this.m_display.getMaterial();if(null!=t){if(null==t.getShaderData()&&null!=t.getCodeBuf()&&null==t.getShaderData()){let e=t.getTextureList(),s=null!=e&&e.length>0;t.initializeByCodeBuf(s)}null==this.getMesh()&&(this.__activeMesh(t),this.m_display.name=this.name)}}}__activeMesh(t){}getUid(){return this.m_uid}setXYZ(t,e,s){this.m_transfrom.setXYZ(t,e,s)}offsetPosition(t){this.m_transfrom.offsetPosition(t)}setPosition(t){this.m_transfrom.setPosition(t)}getPosition(t){this.m_transfrom.getPosition(t)}setRotationXYZ(t,e,s){this.m_transfrom.setRotationXYZ(t,e,s)}setScaleXYZ(t,e,s){this.m_transfrom.setScaleXYZ(t,e,s)}getRotationXYZ(t){this.m_transfrom.getRotationXYZ(t)}getScaleXYZ(t){this.m_transfrom.getScaleXYZ(t)}destroy(){null!=this.m_mouseEvtDispatcher&&(this.m_mouseEvtDispatcher.destroy(),this.m_mouseEvtDispatcher=null),null!=this.m_transfrom&&this.isFree()&&(null!=this.m_display&&(this.m_mesh.__$detachVBuf(this.m_display.vbuf),u.default.Restore(this.m_display),this.m_display=null),l.default.Restore(this.m_transfrom),this.m_transfrom=null,null!=this.m_mesh&&(this.m_mesh.__$detachThis(),this.m_mesh=null),this.__$setParent(null),this.m_visible=!0,this.m_drawEnabled=!0,this.m_renderProxy=null,this.__$rseFlag=r.default.DEFAULT)}isInRenderer(){return(this.__$rseFlag&r.default.RENDERER_UID_FLAT)!=r.default.RENDERER_UID_FLAT}isRenderEnabled(){return null!=this.m_display&&this.m_display.__$ruid>-1}updateBounds(){null!=this.m_transfrom&&(this.m_transStatus=l.default.UPDATE_TRANSFORM,this.update())}updateGlobalBounds(){if(this.m_transStatus>l.default.UPDATE_POSITION){this.m_transfrom.update();let t=this.m_mesh.bounds.min,e=this.m_mesh.bounds.max,s=m.s_boundsInVS;s[0]=t.x,s[1]=t.y,s[2]=t.z,s[3]=e.x,s[4]=t.y,s[5]=t.z,s[6]=t.x,s[7]=t.y,s[8]=e.z,s[9]=e.x,s[10]=t.y,s[11]=e.z,s[12]=t.x,s[13]=e.y,s[14]=t.z,s[15]=e.x,s[16]=e.y,s[17]=t.z,s[18]=t.x,s[19]=e.y,s[20]=e.z,s[21]=e.x,s[22]=e.y,s[23]=e.z,this.m_transfrom.getMatrix().transformVectors(s,24,m.s_boundsOutVS),this.m_globalBounds.reset(),this.m_globalBounds.addXYZFloat32Arr(m.s_boundsOutVS),this.m_globalBounds.update()}else{m.s_prePos.setXYZ(0,0,0),m.s_pos.setXYZ(0,0,0);let t=this.m_transfrom.getMatrix(!1);t.transformVector3Self(m.s_prePos),this.m_transfrom.update(),t=this.m_transfrom.getMatrix(!1),t.transformVector3Self(m.s_pos),m.s_pos.subtractBy(m.s_prePos);let e=this.m_globalBounds;e.min.addBy(m.s_pos),e.max.addBy(m.s_pos),e.center.addBy(m.s_pos),++this.m_globalBounds.version}}update(){this.m_transfrom.updatedStatus>this.m_transStatus&&(this.m_transStatus=this.m_transfrom.updatedStatus),this.m_transStatus!=l.default.UPDATE_NONE&&(null!=this.m_mesh&&null!=this.m_globalBounds?this.updateGlobalBounds():this.m_transfrom.update(),this.m_transStatus=l.default.UPDATE_NONE,this.m_transfrom.updatedStatus=this.m_transStatus),null!=this.m_display&&null!=this.m_display.__$$runit&&(this.m_display.__$$runit.bounds=this.m_globalBounds,this.m_transfrom.getPosition(this.m_display.__$$runit.pos))}toString(){return"DisplayEntity(name="+this.name+",uid = "+this.m_uid+", rseFlag = "+this.__$rseFlag+")"}}m.s_uid=0,m.s_boundsInVS=new Float32Array(24),m.s_boundsOutVS=new Float32Array(24),m.s_pos=new a.default,m.s_prePos=new a.default,e.default=m},"427c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.m_indexList=[],this.m_attriList=null,this.m_attriBytesList=null,this.m_attriStepsList=null,this.m_attriTotalList=null,this.m_attriLenTotalList=null,this.m_indexBytesTotal=0,this.m_indexLengthsTotal=0,this.m_attributesTotal=0,this.m_attributesTotal=t,this.m_attriList=new Array(t),this.m_attriBytesList=new Array(t),this.m_attriStepsList=new Array(t),this.m_attriTotalList=new Array(t),this.m_attriLenTotalList=new Array(t),this.m_attriBytesList.fill(0),this.m_attriStepsList.fill(0),this.m_attriTotalList.fill(0),this.m_attriLenTotalList.fill(0);for(let e=0;e<this.m_attributesTotal;++e)this.m_attriList[e]=[]}addAttributeDataAt(t,e,s){this.m_attriList[t].push(e),this.m_attriBytesList[t]+=e.byteLength,this.m_attriStepsList[t]=s,this.m_attriTotalList[t]+=1,this.m_attriLenTotalList[t]+=e.length}addAttributeDataStepAt(t){return this.m_attriStepsList[t]}getVerticesTotal(){return this.m_attriLenTotalList[0]/this.m_attriStepsList[0]}getAttributesTotal(){return this.m_attriList.length}getAttributeDataAt(t,e){return this.m_attriList[t][e]}getAttributeDataTotalAt(t){return this.m_attriTotalList[t]}getAttributeDataTotalBytesAt(t){return this.m_attriBytesList[t]}getAttributeStepAt(t){return this.m_attriStepsList[t]}addIndexData(t){this.m_indexBytesTotal+=t.byteLength,this.m_indexLengthsTotal+=t.length,this.m_indexList.push(t)}getIndexDataTotal(){return this.m_indexList.length}getIndexDataLengthTotal(){return this.m_indexLengthsTotal}getTrianglesTotal(){return this.m_indexLengthsTotal/3}getIndexDataAt(t){return this.m_indexList[t]}getIndexDataTotalBytes(){return this.m_indexBytesTotal}destroy(){if(null!=this.m_indexList){let t=0,e=0,s=null;for(let i=0;i<this.m_attributesTotal;++i){for(s=this.m_attriList[i],e=s.length,t=0;t<e;++t)s[t]=null;this.m_attriList[i]=null}for(s=this.m_indexList,e=s.length,t=0;t<e;++t)s[t]=null;this.m_indexList=null}}}e.default=i},"442e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("265e"));class n extends r.default{createNode(){return new a.default}}e.default=n},4835:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("faa5")),n=i(s("b3bd")),h=i(s("0fc4"));class o extends a.default{constructor(){super(),this.m_uniqueName="",this.m_hasTex=!1}initialize(t){this.m_uniqueName="Text2DShd",this.m_hasTex=t,t&&(this.m_uniqueName+="_tex")}getFragShaderCode(){let t="#version 300 es\nprecision mediump float;\nin vec4 v_color;\n";return this.m_hasTex&&(t+="uniform sampler2D u_sampler0;\nin vec2 v_texUV;\nlayout(location = 0) out vec4 FragColor;\n"),t+="void main()\n{\n",this.m_hasTex?t+="float pa = pow(texture(u_sampler0, v_texUV).a,0.8);\nFragColor = vec4(v_color.xyz, min(v_color.w * pa,1.0));\n":t+="FragColor = v_color;\n",t+="}\n",t}getVtxShaderCode(){let t="#version 300 es\nprecision mediump float;\nlayout(location = 0) in vec2 a_vs;\nuniform vec4 u_stageParam;\nuniform vec4 u_params[3];\nout vec4 v_color;\n";return this.m_hasTex&&(t+="layout(location = 1) in vec2 a_uvs;\nout vec2 v_texUV;\n"),t+="void main()\n{\nvec4 pv4 = vec4(a_vs.xy,0.0,1.0);\npv4.xy *= u_params[1].xy;\nfloat cosv = cos(u_params[1].w);\nfloat sinv = sin(u_params[1].w);\npv4.xy = vec2(pv4.x * cosv - pv4.y * sinv, pv4.x * sinv + pv4.y * cosv);\npv4.xy += u_params[0].xy;\npv4.xy *= u_stageParam.xy;\npv4.xy += -1.0;\ngl_Position = pv4;\n",this.m_hasTex&&(t+="v_texUV = a_uvs.xy;\n"),t+="v_color = u_params[2];\n}\n",t}getUniqueShaderName(){return this.m_uniqueName}toString(){return"[Text2DShaderBuffer()]"}static GetInstance(){return null!=o.s_instance||(o.s_instance=new o),o.s_instance}}o.s_instance=null;class l extends h.default{constructor(){super(),this.m_rotation=0,this.m_r=0,this.m_g=0,this.m_b=0,this.m_brightness=1,this.m_paramArray=new Float32Array([0,0,0,0,1,1,0,0,1,1,1,1])}getCodeBuf(){return o.GetInstance()}setXY(t,e){this.m_paramArray[0]=t,this.m_paramArray[1]=e}setX(t){this.m_paramArray[0]=t}setY(t){this.m_paramArray[1]=t}getX(){return this.m_paramArray[0]}getY(){return this.m_paramArray[1]}setScale(t){this.m_paramArray[4]=t,this.m_paramArray[5]=t}setScaleXY(t,e){this.m_paramArray[4]=t,this.m_paramArray[5]=e}setScaleX(t){this.m_paramArray[4]=t}setScaleY(t){this.m_paramArray[5]=t}getScaleX(){return this.m_paramArray[4]}getScaleY(){return this.m_paramArray[5]}setRotation(t){this.m_rotation=t,this.m_paramArray[7]=r.default.MATH_PI_OVER_180*t}getRotation(){return this.m_rotation}setRGB3f(t,e,s){this.m_r=t,this.m_g=e,this.m_b=s,this.m_paramArray[8]=t*this.m_brightness,this.m_paramArray[9]=e*this.m_brightness,this.m_paramArray[10]=s*this.m_brightness}setRGBA4f(t,e,s,i){this.m_r=t,this.m_g=e,this.m_b=s,this.m_paramArray[8]=t*this.m_brightness,this.m_paramArray[9]=e*this.m_brightness,this.m_paramArray[10]=s*this.m_brightness,this.m_paramArray[11]=i}setAlpha(t){this.m_paramArray[11]=t}getAlpha(){return this.m_paramArray[6]}setBrightness(t){this.m_brightness=t,this.m_paramArray[4]=this.m_r*t,this.m_paramArray[5]=this.m_g*t,this.m_paramArray[6]=this.m_b*t}getBrightness(){return this.m_brightness}createSelfUniformData(){let t=new n.default;return t.uniformNameList=["u_params"],t.dataList=[this.m_paramArray],t}}e.default=l},"4cf7":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98");class r{constructor(){this.m_imgTexList=[],this.m_bytesTexList=[],this.m_floatTexList=[],this.m_wrapperTexList=[]}addTexture(t){switch(t.getType()){case i.TextureProxyType.Image:this.m_imgTexList.push(t);break;case i.TextureProxyType.Bytes:this.m_bytesTexList.push(t);break;case i.TextureProxyType.Float:this.m_floatTexList.push(t);break;case i.TextureProxyType.Wrapper:this.m_wrapperTexList.push(t);break;default:break}}getTexture(t){switch(t){case i.TextureProxyType.Image:if(this.m_imgTexList.length>0)return this.m_imgTexList.pop();break;case i.TextureProxyType.Bytes:if(this.m_bytesTexList.length>0)return this.m_bytesTexList.pop();break;case i.TextureProxyType.Float:if(this.m_floatTexList.length>0)return this.m_floatTexList.pop();break;case i.TextureProxyType.Wrapper:if(this.m_wrapperTexList.length>0)return this.m_wrapperTexList.pop();break;default:break}return null}}e.TexturePool=r,e.default=r},"4f27":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=s("d53d"),n=i(s("2560")),h=i(s("83d1")),o=i(s("a7ed")),l=i(s("857b")),_=i(s("e87b"));class u extends a.ShaderUniform{use(t){}useByLocation(t,e,s,i){}useByShd(t,e){}updateData(){}destroy(){}}u.EmptyUniform=new u;class m{static appendUniformBuilder(t){m.s_uniformDict.has(t.getIDNS())||(m.s_builders.push(t),m.s_uniformDict.set(t.getIDNS(),t),m.s_buildersTot=m.s_builders.length)}static Initialize(){m.s_initBoo&&(m.s_initBoo=!1,m.appendUniformBuilder(new n.default),m.appendUniformBuilder(new o.default),m.appendUniformBuilder(new l.default),m.appendUniformBuilder(new h.default),m.appendUniformBuilder(new _.default))}static AddSharedUniformBuilder(t){null==t||m.s_uniformDict.has(t.getIDNS())||(m.s_builders.push(t),m.s_uniformDict.set(t.getIDNS(),t),++m.s_buildersTot)}static removeSharedUniformBuilder(t){if(null!=t&&m.s_uniformDict.has(t.getIDNS())){for(let e=0;e<m.s_buildersTot;++e)if(t==m.s_builders[e]){m.s_builders.splice(e,1),--m.s_buildersTot;break}m.s_uniformDict.delete(t.getIDNS())}}static removeSharedUniformBuilderByName(t){if(m.s_uniformDict.has(t)){let e=m.s_uniformDict.get(t);for(let t=0;t<m.s_buildersTot;++t)if(e==m.s_builders[t]){m.s_builders.splice(t,1),--m.s_buildersTot;break}m.s_uniformDict.delete(t)}}static BuildShared(t,e,s){let i,r=null,a=null,n=m.s_builders,h=0,o=m.s_buildersTot,l=null;for(;h<o;++h)l=n[h].create(e,s),null!=l&&(null!=a?a.next=l:null==r&&(r=l),a=l);if(null==t)i=r;else if(null!=r){for(let e=0;e<t.length;++e)a.next=t[e],a=a.next;i=r}if(null==i)i=u.EmptyUniform;else{let t=i,e=0;while(null!=t){if(null!=t.uniformNameList&&null==t.locations)for(t.types=[],t.locations=[],t.uniformSize=t.uniformNameList.length,e=0;e<t.uniformSize;++e)t.types.push(s.getUniformTypeByNS(t.uniformNameList[e])),t.locations.push(s.getUniformLocationByNS(t.uniformNameList[e]));t=t.next}}return i}static BuildLocalFromTransformV(t,e){if(null!=t){let s;return s=new a.ShaderMat4Uniform,s.uniformSize=0,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize+=1,s.uniformNameList.push("u_objMat"),s.types.push(e.getUniformTypeByNS("u_objMat")),s.locations.push(e.getUniformLocationByNS("u_objMat")),s.dataList.push(t),s.dataSizeList.push(1),s}return m.s_emptyUniform}static UpdateLocalFromTransformV(t,e,s){if(null!=e){let i,r=t;return null==r?(r=new a.ShaderMat4Uniform,i=r,i.uniformSize=0,i.uniformNameList=[],i.types=[],i.locations=[],i.dataList=[],i.dataSizeList=[],i.uniformSize+=1,i.uniformNameList.push("u_objMat"),i.types.push(s.getUniformTypeByNS("u_objMat")),i.locations.push(s.getUniformLocationByNS("u_objMat")),i.dataList.push(e),i.dataSizeList.push(1)):(i=r,i.locations=[],i.locations.push(s.getUniformLocationByNS("u_objMat"))),i}return m.s_emptyUniform}static BuildLocalFromData(t,e){if(null!=t){let s;s=r.default.IsWebGL1()?new a.ShaderUniformV1:new a.ShaderUniformV2,s.uns=t.uns,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize=0;let i=t,n=0;while(null!=i){if(null!=i.uniformNameList&&null==i.locations)for(s.uniformSize+=i.uniformNameList.length,n=0;n<s.uniformSize;++n)s.uniformNameList.push(i.uniformNameList[n]),s.types.push(e.getUniformTypeByNS(i.uniformNameList[n])),s.locations.push(e.getUniformLocationByNS(i.uniformNameList[n])),s.dataList.push(i.dataList[n]),s.dataSizeList.push(e.getUniformLengthByNS(i.uniformNameList[n]));i=i.next}return s}return u.EmptyUniform}static BuildLocal(t,e){let s=new a.ShaderUniform;s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize=0;let i=t,r=0;while(null!=i){if(null!=i.uniformNameList&&null==i.locations)for(s.uniformSize+=i.uniformNameList.length,r=0;r<s.uniformSize;++r)s.uniformNameList.push(i.uniformNameList[r]),s.types.push(e.getUniformTypeByNS(i.uniformNameList[r])),s.locations.push(e.getUniformLocationByNS(i.uniformNameList[r])),s.dataList.push(i.dataList[r]),s.dataSizeList.push(e.getUniformLengthByNS(i.uniformNameList[r]));i=i.next}return s}}m.s_initBoo=!0,m.s_uniformDict=new Map,m.s_builders=[],m.s_buildersTot=0,m.s_emptyUniform=new a.ShaderUniform,e.default=m},"51f0":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("5fee")),a=i(s("2ddb"));class n{constructor(){this.m_uid=-1,this.m_worker=null,this.m_initTasks=[],this.m_taskfs=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.m_free=!1,this.m_enabled=!1,this.m_initBoo=!0,this.autoSendData=!1,this.pool=null,this.unlock=!0,this.m_uid=n.s_uid++}getUid(){return this.m_uid}isEnabled(){return this.m_enabled}isFree(){return this.m_free&&this.unlock}thisSendDataTo(){this.pool.sendDataTo(this)}sendDataTo(t){this.m_free&&this.m_taskfs[t.taskclass]>0&&(t.buildThis(!0),t.sendData.cmd=r.default.DATA_PARSE,null!=t.transfers?this.m_worker.postMessage(t.sendData,t.transfers):this.m_worker.postMessage(t.sendData),t.sendStatus=1,this.m_free=!1)}initTaskByURL(t,e,s){if(e>=0&&e<this.m_taskfs.length&&this.m_taskfs[e]<0){this.m_taskfs[e]=0;let i={taskName:t,taskclass:e,inited:!1,type:0,moduleName:s};this.m_initTasks.push(i)}}initTaskByCodeStr(t,e,s){if(e>=0&&e<this.m_taskfs.length&&this.m_taskfs[e]<0){this.m_taskfs[e]=0;let i={srccode:t,taskclass:e,inited:!1,type:2,moduleName:s};this.m_initTasks.push(i)}}updateInitTask(){if(this.m_initTasks.length>0){this.m_free=!1;let t=this.m_initTasks.pop();this.m_worker.postMessage({cmd:r.default.INIT_TASK,threadIndex:this.getUid(),param:t})}}receiveData(t){this.m_free=!0;let e=a.default.GetTaskByUid(t.srcuid),s=!0;null!=e&&(s=e.parseDone(t,-1)),this.updateInitTask(),this.autoSendData&&this.thisSendDataTo()}initialize(t){if(this.m_initBoo&&null!=t&&null==this.m_worker){this.m_initBoo=!1;let e=new Worker(URL.createObjectURL(t));this.m_worker=e;let s=this;this.m_worker.onmessage=function(t){let i=t.data;switch(i.cmd){case r.default.DATA_PARSE:s.receiveData(i);break;case r.default.THREAD_INIT:e.postMessage({cmd:r.default.INIT_PARAM,threadIndex:s.getUid()});break;case r.default.INIT_TASK:s.m_taskfs[i.taskclass]=1,s.m_free=!0,s.updateInitTask();break;case r.default.INIT_PARAM:s.m_free=!0,s.m_enabled=!0,s.updateInitTask();break;default:break}}}}}n.s_uid=0,e.default=n},5216:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["ENV_LIGHT_PARAM"]=0]="ENV_LIGHT_PARAM",t[t["FOG"]=1]="FOG",t[t["FOG_EXP2"]=2]="FOG_EXP2",t[t["VSM_SHADOW"]=3]="VSM_SHADOW",t[t["GLOBAL_LIGHT"]=4]="GLOBAL_LIGHT"}(i||(i={})),e.MaterialPipeType=i},5282:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t=0,e=0,s=0,i=0){this.x=0,this.y=0,this.z=0,this.u=0,this.v=1,this.nx=0,this.ny=0,this.nz=0,this.index=0,this.x=t,this.y=e,this.z=s,this.index=i}cloneVertex(){let t=new i(this.x,this.y,this.z,this.index);return t.nx=this.nx,t.ny=this.ny,t.nz=this.nz,t.u=this.u,t.v=this.v,t}copyFrom(t){this.x=t.x,this.y=t.y,this.z=t.z,this.u=t.u,this.v=t.v,this.nx=t.nx,this.ny=t.ny,this.nz=t.nz,this.index=t.index}}e.default=i},"52e0":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class n extends a.default{constructor(t,e){super(t,e,!1),this.m_imgDataList=null,this.m_texTarget=r.TextureTarget.TEXTURE_CUBE,this.mipmapEnabled=!0,this.m_type=r.TextureProxyType.BytesCube}toAlphaFormat(){this.srcFormat=r.TextureFormat.ALPHA,this.internalFormat=r.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=r.TextureFormat.RED,this.internalFormat=r.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB,this.unpackAlignment=1}toRGBAFormat(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4}setDataFromBytesToFaceAt(t,e,s,i,r=0){if(null==this.m_imgDataList&&(this.m_imgDataList=[null,null,null,null,null,null]),s>0&&i>0){0==t&&r<1&&(this.m_texWidth=s,this.m_texHeight=i,this.m_miplevel=r),null==this.m_imgDataList[t]&&(this.m_imgDataList[t]=new Array(16));let a=this.m_imgDataList[t];a[r]={width:s,height:i,imgData:e,miplevel:r},this.m_haveRData=null!=a[r].imgData}}uploadData(t){let e,s,i=t.getRC(),a=null,n=this.getWidth(),h=this.getHeight();for(let o=0;o<6;++o){let t=this.m_imgDataList[o];if(this.mipmapEnabled&&this.m_generateMipmap)a=t[0],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,r.TextureFormat.ToGL(i,this.internalFormat),n,h,0,r.TextureFormat.ToGL(i,this.srcFormat),r.TextureDataType.ToGL(i,this.dataType),a.imgData);else{e=n,s=h;let l=0;for(;e>0||s>0;)null!=t[l]&&(a=t[l],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+o,l,r.TextureFormat.ToGL(i,this.internalFormat),e,s,0,r.TextureFormat.ToGL(i,this.srcFormat),r.TextureDataType.ToGL(i,this.dataType),a.imgData)),e>0&&(e>>=1),s>0&&(s>>=1),++l}}this.version=0}toString(){return"[BytesCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.m_imgDataList)for(let t=0;t<6;++t)null!=this.m_imgDataList[t]&&(this.m_imgDataList[t].imgData=null);super.__$destroy()}}}e.default=n},5326:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.m_total=256,this.m_uid=0,this.index=0,this.dataList=[],this.flagList=null,this.m_uid=t}getUid(){return this.m_uid}static GetSlotAt(t){return i.s_slots[t]}static Initialize(t){let e=i.s_slots[t];if(null==e&&(e=new i(t),i.s_slots[t]=e),null==e.flagList){e.flagList=new Uint16Array(e.m_total);for(let t=0;t<e.m_total;++t)e.dataList.push(null),e.flagList[t]=0}}}i.s_slots=new Array(16),e.default=i},5336:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_lastTime=0,this.m_fps=60,this.m_canvas2D=null,this.m_ctx2D=null,this.m_delayTime=10,this.m_preWidth=128,this.m_width=128,this.m_height=70,this.delayTime=40,this.statusInfo="",this.statusEnbled=!0}initialize(){var t=null;try{void 0!=document&&(t=document)}catch(e){}if(null!=t){this.m_preWidth=window.innerWidth;let t=this.m_preWidth-20;this.createCanvas(t)}}createCanvas(t){null==this.m_canvas2D&&(this.m_canvas2D=document.createElement("canvas"),document.body.appendChild(this.m_canvas2D),this.m_canvas2D.style.display="bolck",this.m_canvas2D.style.left="0px",this.m_canvas2D.style.top="0px",this.m_canvas2D.style.position="absolute",this.m_canvas2D.style.backgroundColor="transparent",this.m_canvas2D.style.pointerEvents="none",this.m_canvas2D.height=this.m_height),t=t<10?10:t,this.m_canvas2D.width=t,this.m_ctx2D=this.m_canvas2D.getContext("2d"),this.m_ctx2D.font="50px Verdana",this.m_ctx2D.fillStyle="red",this.m_ctx2D.textAlign="left",this.m_width=this.m_canvas2D.width}getFPS(){return this.m_fps}getFPSStr(){return this.m_fps>60?"FPS: 60":this.m_fps<10?"FPS: 0"+this.m_fps:"FPS: "+this.m_fps}render(){if(this.m_preWidth!=window.innerWidth){this.m_preWidth=window.innerWidth;let t=this.m_preWidth-20;this.createCanvas(t)}this.statusEnbled&&(this.m_ctx2D.clearRect(0,0,this.m_width,this.m_height),this.m_ctx2D.fillText("FPS:"+this.m_fps+this.statusInfo,5,50))}update(t=!0){if(this.m_delayTime>0)--this.m_delayTime,this.m_lastTime=Date.now();else{if(null!=this.m_ctx2D){let e=Date.now();this.m_lastTime>0&&(this.m_lastTime=e-this.m_lastTime,this.m_fps=Math.round(1e3/this.m_lastTime),t&&this.render()),this.m_lastTime=e}this.m_delayTime=this.delayTime}}}e.default=i},"557f":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class n extends a.default{constructor(t,e,s=1,i=!1){super(t,e,i),this.m_bytes=null,this.m_tex3DDepth=1,this.internalFormat=r.TextureFormat.R8,this.srcFormat=r.TextureFormat.RED,this.m_tex3DDepth=s,this.m_texTarget=r.TextureTarget.TEXTURE_3D,this.m_type=r.TextureProxyType.Texture3D,this.unpackAlignment=1}getDepth(){return this.m_tex3DDepth}uploadFromTypedArray(t,e=0){this.isGpuEnabled()||(this.m_bytes=t,this.m_miplevel=e,this.m_haveRData=!0)}uploadData(t){if(null!=this.m_bytes){let e=t.getRC();e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage3D(e.TEXTURE_3D,0,r.TextureFormat.ToGL(e,this.internalFormat),this.m_texWidth,this.m_texHeight,this.m_tex3DDepth,0,r.TextureFormat.ToGL(e,this.srcFormat),e.UNSIGNED_BYTE,this.m_bytes),e.pixelStorei(e.UNPACK_ALIGNMENT,4)}}__$destroy(){this.getAttachCount()<1&&(this.m_bytes=null,super.__$destroy())}toString(){return"[Texture3DProxy(width="+this.getWidth()+",height="+this.getHeight()+",depth="+this.getDepth()+")]"}}e.default=n},"56c5":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("030e"));class a{static SetRenderer(t){a.m_rc=t.getRC(),a.m_webGLVer=t.getWebGLVersion();let e=a;1==a.m_webGLVer&&null!=r.default.WEBGL_draw_buffers?e.COLOR_ATTACHMENT0=r.default.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL:e.COLOR_ATTACHMENT0=a.m_rc.COLOR_ATTACHMENT0}static DrawBuffers(t){2==a.m_webGLVer?a.m_rc.drawBuffers(t):null!=r.default.WEBGL_draw_buffers&&r.default.WEBGL_draw_buffers.drawBuffersWEBGL(t)}}a.m_rc=null,a.m_webGLVer=2,a.COLOR_ATTACHMENT0=0,e.default=a},"5d04":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("4cf7")),n=i(s("5e78")),h=i(s("fe7f")),o=i(s("9f3e")),l=i(s("f928")),_=i(s("eaee")),u=i(s("52e0")),m=i(s("d314")),d=i(s("557f")),c=i(s("cfaf")),f=i(s("85b6")),p=i(s("da6a")),g=i(s("ccdf"));class v{constructor(){this.m_texPool=new a.default,this.m_rttStore=null,this.m_renderer=null,this.m_texLoaders=[],this.m_clearDelay=128}addTexLoader(t){if(null!=t){let e=0,s=this.m_texLoaders.length;for(;e<s;++e)if(t==this.m_texLoaders[e])break;e>=s&&this.m_texLoaders.push(t)}}removeTexLoader(t){if(null!=t){let e=0,s=this.m_texLoaders.length;for(;e<s;++e)if(t==this.m_texLoaders[e]){this.m_texLoaders.slice(e,1);break}}}setRenderer(t){this.m_renderer=t,p.default.GetInstance().setRenderProxy(t.getRenderProxy()),null==this.m_rttStore&&null!=t&&(this.m_rttStore=new g.default(t.getRenderProxy()))}getRTTStrore(){return this.m_rttStore}createWrapperTex(t,e,s=!1){let i=new f.default(t,e,s);return i.__$setRenderProxy(this.m_renderer.getRenderProxy()),i}createRTTTex2D(t,e,s=!1){let i=new c.default(t,e,s);return i.__$setRenderProxy(this.m_renderer.getRenderProxy()),i}createImageTex2D(t,e,s=!1){let i=this.m_texPool.getTexture(r.TextureProxyType.Image);return null==i&&(i=new n.default(t,e,s)),i.__$setRenderProxy(this.m_renderer.getRenderProxy()),i.mipmapEnabled=!0,i.setWrap(r.TextureConst.WRAP_REPEAT),i}createHalfFloatTex2D(t,e,s=!1){let i=this.m_texPool.getTexture(r.TextureProxyType.Float);return null==i&&(i=new l.default(t,e,s)),i.__$setRenderProxy(this.m_renderer.getRenderProxy()),i.srcFormat=r.TextureFormat.RGBA,i.dataType=r.TextureDataType.HALF_FLOAT_OES,i}createFloatTex2D(t,e,s=!1){let i=this.m_texPool.getTexture(r.TextureProxyType.Float);return null==i&&(i=new l.default(t,e,s)),i.__$setRenderProxy(this.m_renderer.getRenderProxy()),i}createUint16Tex2D(t,e,s=!1){return new o.default(t,e,s)}createFloatCubeTex(t,e,s=!1){return new _.default(t,e)}createBytesTex(t,e){let s=this.m_texPool.getTexture(r.TextureProxyType.Bytes);return null==s&&(s=new h.default(t,e)),s.__$setRenderProxy(this.m_renderer.getRenderProxy()),s}createBytesCubeTex(t,e){let s=new u.default(t,e);return s.__$setRenderProxy(this.m_renderer.getRenderProxy()),s}createImageCubeTex(t,e){let s=new m.default(t,e);return s.__$setRenderProxy(this.m_renderer.getRenderProxy()),s}createTex3D(t,e,s=1){s<1&&(s=1);let i=new d.default(t,e,s);return i.__$setRenderProxy(this.m_renderer.getRenderProxy()),i}createRGBATex2D(t,e,s){t=t>1?t:1,e=e>1?e:1;let i=t*e,r=this.createBytesTex(t,e),a=new Uint8Array(4*i),n=Math.round(255*s.r),h=Math.round(255*s.g),o=Math.round(255*s.b),l=Math.round(255*s.a),_=0,u=[n,h,o,l];for(let m=0;m<i;++m)a.set(u,_),_+=4;return r.setDataFromBytes(a,0,t,e),r.__$setRenderProxy(this.m_renderer.getRenderProxy()),r}createAlphaTex2D(t,e,s){t=t>1?t:1,e=e>1?e:1;let i=t*e,r=this.createBytesTex(t,e);r.toAlphaFormat();let a=new Uint8Array(i),n=Math.round(255*s);return a.fill(n,0,i),r.setDataFromBytes(a,0,t,e),r.__$setRenderProxy(this.m_renderer.getRenderProxy()),r}createAlphaTexBytes2D(t,e,s){let i=this.createBytesTex(t,e);return i.setDataFromBytes(s,0,t,e),i.toAlphaFormat(),i.__$setRenderProxy(this.m_renderer.getRenderProxy()),i}getCubeRTTTextureAt(t){return this.m_rttStore.getCubeRTTTextureAt(t)}createCubeRTTTextureAt(t,e,s){return this.m_rttStore.createCubeRTTTextureAt(t,e,s)}getRTTTextureAt(t){return this.m_rttStore.getRTTTextureAt(t)}createRTTTextureAt(t,e,s){return this.m_rttStore.createRTTTextureAt(t,e,s)}getDepthTextureAt(t){return this.m_rttStore.getDepthTextureAt(t)}createDepthTextureAt(t,e,s){return this.m_rttStore.createDepthTextureAt(t,e,s)}getRTTFloatTextureAt(t){return this.m_rttStore.getRTTFloatTextureAt(t)}createRTTFloatTextureAt(t,e,s){return this.m_rttStore.createRTTFloatTextureAt(t,e,s)}run(){let t=0,e=this.m_texLoaders.length;for(;t<e;++t)this.m_texLoaders[t].run();if(this.m_clearDelay<1){let t;this.m_clearDelay=128;let e=p.default.GetInstance().getFreeResUidMap(),s=32;for(const[i,r]of e){if(s<1)break;s--,r>2?(e.delete(i),t=p.default.GetInstance().removeTextureByUid(i),null!=t&&this.m_texPool.addTexture(t)):e.set(i,r+1)}}this.m_clearDelay--}}e.TextureBlock=v,e.default=v},"5e78":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("7181")),n=i(s("0851"));class h extends n.default{constructor(t,e,s=!1){super(t,e,s),this.m_texData=null,this.m_texDatas=null,this.m_texDatasLen=0,this.mipmapEnabled=!0,this.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,this.m_type=r.TextureProxyType.Image}getTexData(){return this.m_texData}setDataFromImage(t,e=0,s=0,i=0,r=!1){if(null!=t&&t.width>0&&t.height>0){this.m_haveRData=!0,e<0&&(e=0),e>15&&(e=15),e>=this.m_texDatasLen&&(this.m_texDatasLen=e+1);let n=this.m_texData;null!=n?this.m_texData.miplevel!=e?(null==this.m_texDatas&&(this.m_texDatas=[this.m_texData,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),n=this.m_texDatas[e],null==n&&(n=a.default.Create(),n.miplevel=e,r=!0,this.m_texDatas[e]=n)):this.isGpuEnabled()&&(n.status=0):(n=this.m_texData=a.default.Create(),n.miplevel=e,r=!0,this.m_texWidth=t.width,this.m_texHeight=t.height),n.data==t&&n.offsetx==s&&n.offsety==i||(0==e&&(this.m_texWidth=t.width,this.m_texHeight=t.height),n.data=t,n.status=0,(n.width<t.width||n.height<t.height||r)&&(n.width=t.width,n.height=t.height,n.status=1),n.offsetx=s,n.offsety=i),this.version++}}uploadData(t){null!=this.m_texData&&this.dataUploadToGpu(t.getRC(),this.m_texData,this.m_texDatas,!0),this.version=0}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())&&null!=this.m_texData){let e=t.getRC();this.__$updateToGpuBegin(t),this.dataUploadToGpu(e,this.m_texData,this.m_texDatas),this.__$buildParam(e),this.m_generateMipmap=!0}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.m_texDatas){for(let t=0;t<this.m_texDatasLen;++t)a.default.Restore(this.m_texDatas[t]);this.m_texDatasLen=0,this.m_texDatas=null,this.m_texData=null}null!=this.m_texData&&(a.default.Restore(this.m_texData),this.m_texData=null),super.__$destroy()}}toString(){return"[ImageTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=h},"5f3c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("df9d")),n=s("7c63");class h{constructor(t){this.m_uid=-1,this.m_nodeLinker=new a.default,this.index=-1,this.shdUid=-1,this.procuid=-1,this.batchEnabled=!0,this.fixedState=!0,this.runMode=0,this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null,this.m_shader=null,this.m_shader=t,this.m_uid=h.__s_uid++}showInfo(){this.m_nodeLinker.showInfo()}addNode(t){this.m_nodeLinker.addNodeAndSort(t)}rejoinNode(t){this.m_nodeLinker.containsNode(t)&&(this.m_nodeLinker.removeNodeAndSort(t),this.m_nodeLinker.addNodeAndSort(t))}removeNode(t){this.m_nodeLinker.removeNodeAndSort(t)}isEmpty(){return null==this.m_nodeLinker.getBegin()}run(t){switch(this.runMode){case 2:this.run2(t);break;case 1:this.run1(t);break;case 0:this.run0(t);break;default:break}}run0(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let s=null;while(null!=e)e.drawEnabled&&(s=e.unit,s.drawEnabled&&(s.run(t),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}run1(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let s=null,i=this.m_nodeLinker.getVtxTotalAt(e.rvroI),r=this.m_nodeLinker.getTexTotalAt(e.rtroI),a=i>0,n=r>0;while(null!=e)i<1&&(i=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=!0),i--,r<1&&(r=this.m_nodeLinker.getTexTotalAt(e.rtroI),n=!0),r--,e.drawEnabled&&(s=e.unit,s.drawEnabled&&(a&&(e.vro.run(),a=!1),n&&(e.tro.run(),n=!1),s.run2(t),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}run2(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let s=null;n.RenderStateObject.UseRenderState(e.unit.renderState),n.RenderColorMask.UseRenderState(e.unit.rcolorMask);let i=this.m_nodeLinker.getVtxTotalAt(e.rvroI),r=this.m_nodeLinker.getTexTotalAt(e.rtroI),a=i>0,h=r>0;while(null!=e)i<0&&(i=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=!0),i--,r<0&&(r=this.m_nodeLinker.getTexTotalAt(e.rtroI),h=!0),r--,e.drawEnabled&&(s=e.unit,s.drawEnabled&&(a&&(e.vro.run(),a=!1),h&&(e.tro.run(),h=!1),null!=s.ubo&&s.ubo.run(t),this.m_shader.useTransUniform(s.transUniform),this.m_shader.useUniform(s.uniform),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}runLockMaterial(t){let e=this.m_nodeLinker.getBegin();if(null!=e){this.m_shader.bindToGpu(this.shdUid),this.m_shader.resetUniform();let s=this.m_shader.isTextureUnLocked();t.Texture.unlocked=s;let i=null;if(this.batchEnabled){let r=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=r>0;while(null!=e)r<1&&(r=this.m_nodeLinker.getVtxTotalAt(e.rvroI),a=!0),r--,i=e.unit,e.drawEnabled&&i.drawEnabled&&(a&&(e.vro.run(),a=!1),s&&e.tro.run(),i.runLockMaterial2(null),i.partTotal<1?i.drawThis(t):i.drawPart(t)),e=e.next}else while(null!=e)i=e.unit,e.drawEnabled&&i.drawEnabled&&(i.runLockMaterial(),s&&e.tro.run(),i.partTotal<1?i.drawThis(t):i.drawPart(t)),e=e.next;t.Texture.unlocked=!1}}drawUnit(t,e,s){e.drawEnabled&&(this.m_shader.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t))}drawLockMaterialByUnit(t,e,s,i,a){if(e.drawEnabled){if(a&&this.m_shader.resetUniform(),r.default.IsMobileWeb()){let t=this.vtxResource.getVROByResUid(s.vbuf.getUid(),this.m_shader.getCurrentShd(),!0);t.run()}else e.vro.run();e.runLockMaterial2(i?this.m_shader.__$globalUniform:null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}}reset(){let t=this.m_nodeLinker.getBegin(),e=null;if(null!=t){let s;while(null!=t)e=t,t=t.next,this.rpoUnitBuilder.setRPNodeParam(e.__$ruid,this.procuid,-1),e.reset(),s=e.unit,this.rpoNodeBuilder.restore(e)&&this.rpoUnitBuilder.restore(s)}this.index=-1,this.shdUid=-1,this.procuid=-1,this.m_nodeLinker.clear(),this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null}destroy(){this.reset()}getUid(){return this.m_uid}toString(){return"[RPOBlock(uid = "+this.m_uid+", index = "+this.index+", shdUid = "+this.shdUid+")]"}}h.__s_uid=0,e.default=h},"5fee":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.DATA_PARSE=3501,i.THREAD_INIT=3601,i.INIT_TASK=3701,i.INIT_PARAM=3801,e.default=i},"617e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("29ef")),a=i(s("402a")),n=i(s("4835")),h=i(s("efce")),o=i(s("725b")),l=s("cc48");class _ extends a.default{constructor(t=!0){super(),this.m_dynamicEnbaled=!0,this.m_currMaterial=null,this.m_currMesh=null,this.m_charsStr="",this.m_alignFactorX=.5,this.m_alignFactorY=.5,this.flipVerticalUV=!1,this.m_dynamicEnbaled=t}setAlignFactor(t,e){this.m_alignFactorX=t,this.m_alignFactorY=e,null!=this.m_currMesh&&this.m_currMesh.updateCharStr(this.m_charsStr)}alignLeftTop(){this.setAlignFactor(0,0)}alignCenter(){this.setAlignFactor(.5,.5)}alignLeftCenter(){this.setAlignFactor(0,.5)}setText(t){null!=this.m_currMesh&&(this.m_charsStr=t,this.m_currMesh.alignFactorX=this.m_alignFactorX,this.m_currMesh.alignFactorY=this.m_alignFactorY,this.m_currMesh.updateCharStr(t),this.update())}setRGBA4f(t,e,s,i){null!=this.m_currMaterial&&this.m_currMaterial.setRGBA4f(t,e,s,i)}setRGB3f(t,e,s){null!=this.m_currMaterial&&this.m_currMaterial.setRGB3f(t,e,s)}setAlpha(t){this.m_currMaterial.setAlpha(t)}getAlpha(){return this.m_currMaterial.getAlpha()}setBrightness(t){this.m_currMaterial.setBrightness(t)}getBrightness(){return this.m_currMaterial.getBrightness()}getWidth(){return this.m_currMesh.getWidth()*this.m_currMaterial.getScaleX()}getHeight(){return this.m_currMesh.getHeight()*this.m_currMaterial.getScaleY()}setXYZ(t,e,s){null!=this.m_currMaterial&&this.m_currMaterial.setXY(t,e)}setXY(t,e){null!=this.m_currMaterial&&this.m_currMaterial.setXY(t,e)}setX(t){null!=this.m_currMaterial&&this.m_currMaterial.setX(t)}setY(t){null!=this.m_currMaterial&&this.m_currMaterial.setY(t)}getX(){return null!=this.m_currMaterial?this.m_currMaterial.getX():0}getY(){return null!=this.m_currMaterial?this.m_currMaterial.getY():0}setScale(t){null!=this.m_currMaterial&&this.m_currMaterial.setScale(t)}getScaleX(){return this.m_currMaterial.getScaleX()}getScaleY(){return this.m_currMaterial.getScaleY()}setScaleX(t){this.m_currMaterial.setScaleX(t)}setScaleY(t){this.m_currMaterial.setScaleY(t)}setScaleXY(t,e){this.m_currMaterial.setScaleXY(t,e)}createMaterial(t){null==this.getMaterial()?(this.m_currMaterial=new n.default,this.m_currMaterial.setTextureList(t),this.setMaterial(this.m_currMaterial)):this.m_currMaterial.setTextureList(t)}initialize(t,e=null){this.m_charsStr=t,this.spaceCullMask=l.SpaceCullingMask.NONE,this.spaceCullMask=0,this.m_alignFactorX=0,this.m_alignFactorY=0,null==e?this.createMaterial([o.default.GetInstance().getTextureAt(0)]):this.createMaterial(e),this.activeDisplay(),this.setRenderState(r.default.BACK_TRANSPARENT_ALWAYS_STATE)}createBounds(){}__activeMesh(t){if(null==this.getMesh()){let e=new h.default;e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.alignFactorX=this.m_alignFactorX,e.alignFactorY=this.m_alignFactorY,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.m_charsStr),this.setMesh(e),this.m_currMesh=e}}update(){this.m_dynamicEnbaled&&this.m_mesh.isGeomDynamic()&&this.setIvsParam(0,this.m_mesh.vtCount),this.m_transfrom.update()}toString(){return"Text2DEntity(uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=_},"644c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}static GetTypeByTypeNS(t){switch(t){case"mat4":return i.SHADER_MAT4;case"mat3":return i.SHADER_MAT3;case"mat2":return i.SHADER_MAT2;case"float":return i.SHADER_FLOAT;case"int":return i.SHADER_INT;case"vec4":return i.SHADER_VEC4;case"vec3":return i.SHADER_VEC3;case"vec2":return i.SHADER_VEC2;case"vec4[]":return i.SHADER_VEC4FV;case"vec3[]":return i.SHADER_VEC3FV;case"vec2[]":return i.SHADER_VEC2FV;case"sampler2D":return i.SHADER_SAMPLER2D;case"sampler3D":return i.SHADER_SAMPLER3D;case"samplerCube":return i.SHADER_SAMPLERCUBE;default:break}return i.SHADER_UNDEFINED}static GetTypeNSByType(t){switch(t){case i.SHADER_MAT4:return"mat4";case i.SHADER_MAT3:return"mat3";case i.SHADER_MAT2:return"mat2";case i.SHADER_FLOAT:return"float";case i.SHADER_VEC4:return"vec4";case i.SHADER_VEC3:return"vec3";case i.SHADER_VEC2:return"vec2";case i.SHADER_SAMPLER2D:return"sampler2D";case i.SHADER_SAMPLER3D:return"sampler3D";case i.SHADER_SAMPLERCUBE:return"samplerCube";case i.SHADER_UNDEFINED:return"undefined";default:break}return""}}i.ATTRINS_VTX_VS="a_vs",i.ATTRINS_VTX_UVS="a_uvs",i.ATTRINS_VTX_NVS="a_nvs",i.ATTRINS_VTX_CVS="a_cvs",i.UNIFORMNS_OBJ_MAT_NS="u_objMat",i.UNIFORMNS_VIEW_MAT_NS="u_viewMat",i.UNIFORMNS_PROJ_MAT_NS="u_projMat",i.SHADER_UNDEFINED=3010,i.SHADER_VEC2=3011,i.SHADER_VEC3=3012,i.SHADER_VEC4=3013,i.SHADER_VEC2FV=3014,i.SHADER_VEC3FV=3015,i.SHADER_VEC4FV=3016,i.SHADER_MAT2=3017,i.SHADER_MAT3=3018,i.SHADER_MAT4=3019,i.SHADER_FLOAT=3020,i.SHADER_INT=3021,i.SHADER_MAT2FV=3022,i.SHADER_MAT3FV=3023,i.SHADER_MAT4FV=3024,i.SHADER_SAMPLER2D=3031,i.SHADER_SAMPLERCUBE=3032,i.SHADER_SAMPLER3D=3033,i.SHADER_PRECISION_LOWP=3101,i.SHADER_PRECISION_MEDIUMP=3111,i.SHADER_PRECISION_HIGHP=3121,i.UNIFORM_TEX_SAMPLER2D="sampler2D",i.UNIFORM_TEX_SAMPLERCUBE="samplerCube",i.UNIFORM_TEX_SAMPLER3D="sampler3D",i.UNIFORMNS_TEX_SAMPLER_0="u_sampler0",i.UNIFORMNS_TEX_SAMPLER_1="u_sampler1",i.UNIFORMNS_TEX_SAMPLER_2="u_sampler2",i.UNIFORMNS_TEX_SAMPLER_3="u_sampler3",i.UNIFORMNS_TEX_SAMPLER_4="u_sampler4",i.UNIFORMNS_TEX_SAMPLER_5="u_sampler5",i.UNIFORMNS_TEX_SAMPLER_6="u_sampler6",i.UNIFORMNS_TEX_SAMPLER_7="u_sampler7",i.UNIFORMNS_TEX_SAMPLER_LIST=[i.UNIFORMNS_TEX_SAMPLER_0,i.UNIFORMNS_TEX_SAMPLER_1,i.UNIFORMNS_TEX_SAMPLER_2,i.UNIFORMNS_TEX_SAMPLER_3,i.UNIFORMNS_TEX_SAMPLER_4,i.UNIFORMNS_TEX_SAMPLER_5,i.UNIFORMNS_TEX_SAMPLER_6,i.UNIFORMNS_TEX_SAMPLER_7],e.default=i},6661:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("faa5")),n=i(s("b3bd")),h=i(s("0fc4"));class o extends a.default{constructor(){super(),this.m_uniqueName=""}initialize(t){this.m_uniqueName="PingpongHBlurBlurShd"}getFragShaderCode(){let t="";return t=r.default.IsWebGL2()?"#version 300 es\nprecision mediump float;\nfloat weight[5] = float[] (0.227027, 0.1945946, 0.1216216, 0.054054, 0.016216);\nuniform vec4 u_texSize;\nuniform sampler2D u_sampler0;\nin vec2 v_uvs;\nout vec4 FragColor;\nvoid main()\n{\n    vec2 tex_offset = u_texSize.w / u_texSize.xy;\n    float dx = tex_offset.x;\n    tex_offset.y = 0.0;\n    vec4 result = texture(u_sampler0, v_uvs) * weight[0];\n    for(int i = 1; i < 5; ++i)\n    {\n        tex_offset.x = dx * float(i);\n        result += texture(u_sampler0, v_uvs + tex_offset) * weight[i];\n        result += texture(u_sampler0, v_uvs - tex_offset) * weight[i];\n    }\n    FragColor = result;\n}\n":"\nprecision mediump float;\nuniform vec4 u_texSize;\nuniform sampler2D u_sampler0;\nin vec2 v_uvs;\nout vec4 FragColor;\nvoid main()\n{\n    vec2 tex_offset = u_texSize.w / u_texSize.xy;\n    float dx = tex_offset.x;\n    tex_offset.y = 0.0;\n    vec4 result = texture2D(u_sampler0, v_uvs) * 0.227027;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.1945946;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.1945946;\n    tex_offset.x = dx * 2.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.1216216;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.1216216;\n    tex_offset.x = dx * 3.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.054054;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.054054;\n    tex_offset.x = dx * 4.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.016216;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.016216;\n    FragColor = result;\n}\n",t}getVtxShaderCode(){let t="#version 300 es\nprecision mediump float;\nlayout(location = 0) in vec3 a_vs;\nlayout(location = 1) in vec2 a_uvs;\nout vec2 v_uvs;\nvoid main()\n{\n    gl_Position = vec4(a_vs, 1.0);\n    v_uvs = vec2(a_uvs.x, a_uvs.y);\n}\n";return t}getUniqueShaderName(){return this.m_uniqueName}toString(){return"[PingpongHBlurShaderBuffer()]"}static GetInstance(){return o.s_instance}}o.s_instance=new o;class l extends a.default{constructor(){super(),this.m_uniqueName=""}initialize(t){this.m_uniqueName="PingpongVBlurBlurShd"}getFragShaderCode(){let t="";return t=r.default.IsWebGL2()?"#version 300 es\nprecision mediump float;\nfloat weight[5] = float[] (0.227027, 0.1945946, 0.1216216, 0.054054, 0.016216);\nuniform vec4 u_texSize;\nuniform sampler2D u_sampler0;\nin vec2 v_uvs;\nout vec4 FragColor;\nvoid main()\n{\n    //vec2 tex_offset = u_texSize.w / vec2(textureSize(u_sampler0, 0));\n    vec2 tex_offset = u_texSize.w / u_texSize.xy;\n    float dy = tex_offset.y;\n    tex_offset.x = 0.0;\n    vec4 result = texture(u_sampler0, v_uvs) * weight[0];\n    for(int i = 1; i < 5; ++i)\n    {\n        tex_offset.y = dy * float(i);\n        result += texture(u_sampler0, v_uvs + tex_offset) * weight[i];\n        result += texture(u_sampler0, v_uvs - tex_offset) * weight[i];\n    }\n    FragColor = result;\n}\n":"\nprecision mediump float;\nuniform vec4 u_texSize;\nuniform sampler2D u_sampler0;\nin vec2 v_uvs;\nout vec4 FragColor;\nvoid main()\n{\n    vec2 tex_offset = u_texSize.w / u_texSize.xy;\n    float dy = tex_offset.y;\n    tex_offset.x = 0.0;\n    vec4 result = texture2D(u_sampler0, v_uvs) * 0.227027;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.1945946;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.1945946;\n    tex_offset.y = dy * 2.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.1216216;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.1216216;\n    tex_offset.y = dy * 3.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.054054;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.054054;\n    tex_offset.y = dy * 4.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.016216;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.016216;\n\n    FragColor = result;\n}\n",t}getVtxShaderCode(){let t="#version 300 es\nprecision mediump float;\nlayout(location = 0) in vec3 a_vs;\nlayout(location = 1) in vec2 a_uvs;\nout vec2 v_uvs;\nvoid main()\n{\n    gl_Position = vec4(a_vs, 1.0);\n    v_uvs = vec2(a_uvs.x, a_uvs.y);\n}\n";return t}getUniqueShaderName(){return this.m_uniqueName}toString(){return"[PingpongVBlurShaderBuffer()]"}static GetInstance(){return l.s_instance}}l.s_instance=new l,e.PingpongVBlurShaderBuffer=l;class _ extends h.default{constructor(t=0){super(),this.m_blurType=0,this.m_texSizeArray=new Float32Array([800,600,0,0]),this.m_blurType=t}setTexSize(t,e){this.m_texSizeArray[0]=t,this.m_texSizeArray[1]=e}setBlurDensity(t){this.m_texSizeArray[3]=t}getCodeBuf(){return this.m_blurType>0?l.GetInstance():o.GetInstance()}createSelfUniformData(){let t=new n.default;return t.uniformNameList=["u_texSize"],t.dataList=[this.m_texSizeArray],t}}e.default=_},"68aa":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,s,i,r,a){1==this.status||a?t.texImage2D(e,this.miplevel,s,this.width,this.height,0,i,r,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,this.width,this.height,i,r,this.data),this.status=-1}static Create(){return i.s_list.length>0?i.s_list.pop():new i}static Restore(t){null!=t&&(t.data=null,i.s_list.push(t))}}i.s_list=[],e.default=i},"6d49":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("baae")),n=s("8d98"),h=i(s("56c5"));class o{constructor(t,e,s){this.m_uid=-1,this.m_rcuid=0,this.m_COLOR_ATTACHMENT0=0,this.m_fbo=null,this.m_depthStencilRBO=null,this.m_depthRBO=null,this.m_colorRBO=null,this.m_width=512,this.m_height=512,this.m_bufferLType=0,this.m_gl=null,this.m_fboTarget=0,this.m_texTargetTypes=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.m_attachmentMaskList=[!0,!0,!0,!0,!0,!0,!0,!0],this.m_preAttachTotal=0,this.m_preAttachIndex=0,this.m_activeAttachmentTotal=0,this.m_attachmentIndex=0,this.m_clearDepthArr=new Float32Array(1),this.m_clearColorArr=new Float32Array(4),this.m_stencilValueArr=new Int16Array(4),this.m_fboSizeChanged=!1,this.textureLevel=0,this.sizeFixed=!1,this.writeDepthEnabled=!0,this.writeStencilEnabled=!1,this.multisampleEnabled=!1,this.multisampleLevel=0,this.m_preAttachments=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.m_preTragets=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.m_preFTIndex=0,this.m_haveDepthTex=!1,this.m_resizeW=2,this.m_resizeH=2,this.m_rcuid=t,this.m_texRes=e,this.m_bufferLType=s,this.m_uid=o.s_uid++}getUid(){return this.m_uid}resetAttachmentMask(t){let e=this.m_attachmentMaskList.length-1;while(e>=0)this.m_attachmentMaskList[e]=t,--e}setAttachmentMaskAt(t,e){this.m_attachmentMaskList[t]=e}getActiveAttachmentTotal(){return this.m_haveDepthTex?this.m_activeAttachmentTotal-1:this.m_activeAttachmentTotal}getAttachmentTotal(){return this.m_attachmentMaskList.length}bindToBackbuffer(t){switch(t){case a.default.DRAW_FRAMEBUFFER:this.m_gl.bindFramebuffer(this.m_gl.DRAW_FRAMEBUFFER,null);break;case a.default.READ_FRAMEBUFFER:this.m_gl.indFramebuffer(this.m_gl.READ_FRAMEBUFFER,null);break;default:this.m_gl.bindFramebuffer(this.m_gl.FRAMEBUFFER,null)}}bind(t){if(null!=this.m_fbo)switch(t){case a.default.DRAW_FRAMEBUFFER:this.m_gl.bindFramebuffer(this.m_gl.DRAW_FRAMEBUFFER,this.m_fbo);break;case a.default.READ_FRAMEBUFFER:this.m_gl.bindFramebuffer(this.m_gl.READ_FRAMEBUFFER,this.m_fbo);break;default:this.m_gl.bindFramebuffer(this.m_gl.FRAMEBUFFER,this.m_fbo)}}getFBO(){return this.m_fbo}getDepthStencilRBO(){return this.m_depthStencilRBO}getDepthRBO(){return this.m_depthRBO}getWidth(){return this.m_width}getHeight(){return this.m_height}getFramebufferType(){return this.m_bufferLType}renderToTexAt(t,e,s){let i=null!=e?e.internalFormat:-1;this.m_gl=t,0==s&&(this.m_preFTIndex=0,this.m_haveDepthTex=!1,this.m_gl.bindFramebuffer(this.m_fboTarget,this.m_fbo),i!=n.TextureFormat.DEPTH_COMPONENT&&i!=n.TextureFormat.DEPTH_STENCIL&&(this.m_activeAttachmentTotal=0,this.m_attachmentIndex=0));let r=-1,a=null;null!=e?(r=e.getTargetType(),a=this.m_texRes.getGpuBuffer(e.getResUid()),e.uploadFromFbo(this.m_texRes,this.m_width,this.m_height)):r=this.m_texTargetTypes[this.m_activeAttachmentTotal],this.framebufferTextureBind(t,r,i,a)}glFramebufferTex2D(t,e){let s=this.m_gl;s.framebufferTexture2D(this.m_fboTarget,t,s.TEXTURE_2D,e,0),this.m_preAttachments[this.m_preFTIndex]=t,this.m_preTragets[this.m_preFTIndex]=s.TEXTURE_2D,this.m_preFTIndex++}glFramebufferTexCube(t,e,s){let i=this.m_gl;i.framebufferTexture2D(this.m_fboTarget,t,i.TEXTURE_CUBE_MAP_POSITIVE_X+e,s,0),this.m_preAttachments[this.m_preFTIndex]=t,this.m_preTragets[this.m_preFTIndex]=i.TEXTURE_CUBE_MAP_POSITIVE_X+e,this.m_preFTIndex++}framebufferTexture2D(t,e,s,i){let r=-1;switch(s){case n.TextureFormat.DEPTH_COMPONENT:this.m_haveDepthTex=!0,r=this.m_gl.DEPTH_ATTACHMENT;break;case n.TextureFormat.DEPTH_STENCIL:this.m_haveDepthTex=!0,r=this.m_gl.DEPTH_STENCIL_ATTACHMENT;break;default:r=this.m_COLOR_ATTACHMENT0+this.m_attachmentIndex;break}r>0&&(this.m_attachmentMaskList[this.m_activeAttachmentTotal]?(this.glFramebufferTex2D(r,i),++this.m_attachmentIndex,this.m_texTargetTypes[this.m_activeAttachmentTotal]=null!=i?e:0):this.m_texTargetTypes[this.m_activeAttachmentTotal]=0,++this.m_activeAttachmentTotal)}framebufferTextureBind(t,e,s,i){switch(e){case n.TextureTarget.TEXTURE_2D:this.framebufferTexture2D(t,e,s,i);break;case n.TextureTarget.TEXTURE_CUBE:let r=0;for(let t=0;t<6;++t)this.m_attachmentMaskList[t]?(this.glFramebufferTexCube(this.m_COLOR_ATTACHMENT0+this.m_attachmentIndex,t,i),++this.m_attachmentIndex,this.m_texTargetTypes[this.m_activeAttachmentTotal+t]=null!=i?e:0,r++):this.m_texTargetTypes[this.m_activeAttachmentTotal+t]=0;r=r>0?r:6,this.m_activeAttachmentTotal+=r;break;case n.TextureTarget.TEXTURE_SHADOW_2D:this.m_attachmentMaskList[this.m_activeAttachmentTotal]?(this.glFramebufferTex2D(this.m_gl.DEPTH_ATTACHMENT,i),this.m_texTargetTypes[this.m_activeAttachmentTotal]=null!=i?e:0):this.m_texTargetTypes[this.m_activeAttachmentTotal]=0,++this.m_activeAttachmentTotal;break;default:break}}reset(){this.m_preAttachTotal=-1,this.m_preAttachIndex=-1}use(t){if(this.m_gl=t,null!=this.m_fbo){if(this.m_activeAttachmentTotal>1){if(this.m_preAttachIndex!=this.m_attachmentIndex){let t=[],e=0;for(;e<this.m_attachmentIndex;++e)t.push(this.m_COLOR_ATTACHMENT0+e);if(this.m_preAttachIndex>this.m_attachmentIndex)for(;e<this.m_preAttachIndex;++e)this.m_gl.framebufferTexture2D(this.m_fboTarget,this.m_preAttachments[e],this.m_preTragets[e],null,0);h.default.DrawBuffers(t),this.m_preAttachIndex=this.m_attachmentIndex}}else if(this.m_preAttachIndex!=this.m_attachmentIndex){if(this.m_preAttachIndex>this.m_attachmentIndex)for(let e=1;e<this.m_preAttachIndex;++e)this.m_gl.framebufferTexture2D(this.m_fboTarget,this.m_preAttachments[e],this.m_preTragets[e],null,0);let t=[this.m_COLOR_ATTACHMENT0];h.default.DrawBuffers(t),this.m_preAttachIndex=this.m_attachmentIndex}this.m_preAttachTotal=this.m_activeAttachmentTotal}}clearOnlyColor(t){if(null!=this.m_fbo)if(r.default.IsWebGL2())if(this.m_clearColorArr[0]=t.r,this.m_clearColorArr[1]=t.g,this.m_clearColorArr[2]=t.b,this.m_clearColorArr[3]=t.a,this.m_preAttachTotal>1)for(let e=0;e<this.m_preAttachTotal;++e)this.m_gl.clearBufferfv(this.m_gl.COLOR,e,this.m_clearColorArr);else this.m_gl.clearBufferfv(this.m_gl.COLOR,0,this.m_clearColorArr);else this.m_gl.clearColor(t.r,t.g,t.b,t.a)}clearOnlyDepth(t=1){r.default.IsWebGL2()?(this.m_clearDepthArr[0]=t,this.m_gl.clearBufferfv(this.m_gl.DEPTH,0,this.m_clearDepthArr)):this.m_gl.clearDepth(t)}clearOnlyStencil(t){this.m_stencilValueArr[0]=t,this.m_gl.clearBufferuiv(this.m_gl.STENCIL,0,this.m_stencilValueArr)}clearOnlyDepthAndStencil(t,e){this.m_gl.clearBufferfi(this.m_gl.DEPTH_STENCIL,0,t,e)}invalidateFramebuffer(){}resize(t,e){this.m_resizeW==t&&this.m_resizeH==e||(this.m_fboSizeChanged=!0,this.m_resizeW=t,this.m_resizeH=e)}initialize(t,e,s){this.m_gl=t,this.m_COLOR_ATTACHMENT0=h.default.COLOR_ATTACHMENT0,this.m_fboSizeChanged&&(e=this.m_resizeW,s=this.m_resizeH),null==this.m_fbo?this.createNewFBO(t,e,s):this.m_width==e&&this.m_height==s||this.createNewFBO(t,e,s),this.m_fboSizeChanged=!1}isSizeChanged(){return this.m_fboSizeChanged}destroy(t){null!=this.m_fbo&&(null!=this.m_depthStencilRBO&&(t.deleteFramebuffer(this.m_depthStencilRBO),this.m_depthStencilRBO=null),null!=this.m_depthRBO&&(t.deleteFramebuffer(this.m_depthRBO),this.m_depthRBO=null),null!=this.m_colorRBO&&(t.deleteFramebuffer(this.m_colorRBO),this.m_colorRBO=null),t.deleteFramebuffer(this.m_fbo),this.m_fbo=null),this.m_gl=null,this.m_fboTarget=0,this.m_fboSizeChanged=!1}buildDepthStencilRBO(t,e,s){null==this.m_depthStencilRBO&&(this.m_depthStencilRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_STENCIL,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO))}buildDepthRBO(t,e,s){null==this.m_depthRBO&&(this.m_depthRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_COMPONENT24,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.m_depthRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthRBO),r.default.IsWebGL2()?t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT24,e,s):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.m_depthRBO))}buildStencilRBO(t,e,s){null==this.m_depthStencilRBO&&(null==this.m_depthStencilRBO&&(this.m_depthStencilRBO=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.STENCIL_INDEX8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO),null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO)):(t.bindRenderbuffer(t.RENDERBUFFER,this.m_depthStencilRBO),t.renderbufferStorage(t.RENDERBUFFER,t.STENCIL_INDEX8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.m_depthStencilRBO)))}buildColorRBO(t,e,s){this.multisampleEnabled&&(null==this.m_colorRBO&&(this.m_colorRBO=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.m_colorRBO),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.m_fboTarget,this.m_COLOR_ATTACHMENT0,t.RENDERBUFFER,this.m_colorRBO))}createNewFBO(t,e,s){let i=null==this.m_fbo;switch(this.m_preAttachTotal=this.m_activeAttachmentTotal=0,this.m_preAttachIndex=this.m_attachmentIndex=0,this.m_width=e,this.m_height=s,this.m_resizeW=e,this.m_resizeH=s,i&&(this.m_fbo=t.createFramebuffer()),this.m_bufferLType){case a.default.DRAW_FRAMEBUFFER:this.m_fboTarget=t.DRAW_FRAMEBUFFER;break;case a.default.READ_FRAMEBUFFER:this.m_fboTarget=t.READ_FRAMEBUFFER;break;default:this.m_fboTarget=t.FRAMEBUFFER;break}if(t.bindFramebuffer(this.m_fboTarget,this.m_fbo),this.writeDepthEnabled?this.writeStencilEnabled?null==this.m_depthStencilRBO&&this.buildDepthStencilRBO(t,e,s):this.buildDepthRBO(t,e,s):this.writeStencilEnabled?this.buildStencilRBO(t,e,s):this.buildColorRBO(t,e,s),i){t.checkFramebufferStatus(this.m_fboTarget);t.FRAMEBUFFER_COMPLETE}o.BindToBackbuffer(t,this.m_bufferLType)}static BindToBackbuffer(t,e){switch(e){case a.default.DRAW_FRAMEBUFFER:t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null);break;case a.default.READ_FRAMEBUFFER:t.indFramebuffer(t.READ_FRAMEBUFFER,null);break;default:t.bindFramebuffer(t.FRAMEBUFFER,null);break}}}o.s_uid=0,e.default=o},"6e01":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Clamp(t,e,s){return Math.max(Math.min(t,s),e)}static IsPowerOf2(t){return 0==(t&t-1)}static CalcCeilPowerOfTwo(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}static CalcNearestCeilPow2(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}static CalcFloorCeilPow2(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}static DegreeToRadian(t){return i.MATH_PI_OVER_180*t}static Log2(t){return Math.log(t)/Math.LN2}static GetMaxMipMapLevel(t,e){return Math.round(i.Log2(Math.max(t,e))+1)}static SafeACos(t){return t<=-1?i.MATH_PI:t>=1?0:Math.acos(t)}static GetNearestCeilPow2(t){let e=1;while(e<t)e<<=1;return e}static GetMinRadian(t,e){return e%=i.MATH_2PI,t%=i.MATH_2PI,e<t?(e=i.MATH_2PI-t+e,e>i.MATH_PI?e-i.MATH_2PI:e):e>t?(t=i.MATH_2PI-e+t,t>i.MATH_PI?i.MATH_2PI-t:-t):0}static GetMinDegree(t,e){let s=0;return e>=270&&t<90?s=(e-(t+360))%180:e<=90&&t>=270?s=(e+360-t)%180:(s=e-t,s>180?(s-=360,s%=360):s<-180&&(s+=360,s%=360)),s}static GetDegreeByXY(t,e){if(Math.abs(t)<1e-5)return e>=0?270:90;let s=180*Math.atan(e/t)/Math.PI;return t>=0?s:180+s}static GetRadianByXY(t,e){if(Math.abs(t)<i.MATH_MIN_POSITIVE)return e>=0?i.MATH_1PER2PI:i.MATH_3PER2PI;let s=Math.atan(e/t);return t>=0?s:i.MATH_PI+s}static GetRadianByCos(t,e,s){var r=Math.acos(t);return e>=0?r:i.MATH_PI+r}}i.MATH_MIN_POSITIVE=1e-5,i.MATH_MAX_NEGATIVE=-1e-5,i.MATH_MAX_POSITIVE=268435454,i.MATH_MIN_NEGATIVE=-268435454,i.MATH_1_OVER_255=1/255,i.MATH_PI=Math.PI,i.MATH_2PI=2*i.MATH_PI,i.MATH_3PER2PI=1.5*i.MATH_PI,i.MATH_1PER2PI=.5*i.MATH_PI,i.MATH_1_OVER_PI=1/i.MATH_PI,i.MATH_1_OVER_360=1/360,i.MATH_1_OVER_180=1/180,i.MATH_180_OVER_PI=180/i.MATH_PI,i.MATH_PI_OVER_180=i.MATH_PI/180,i.MATH_LN2=.6931471805599453,e.default=i},"6ee0":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_dataList=[],this.m_waitList=[],this.m_dataTotal=0,this.m_dataHaveTotal=0,this.m_startupFlag=0}sendDataTo(t){if(this.m_dataTotal>0){let e=null,s=this.m_waitList.length;if(s>0&&(e=this.m_waitList[0],t.sendDataTo(e),1==e.sendStatus))return this.m_dataTotal--,s--,this.m_waitList.shift(),!0;if(s=this.m_dataTotal-s,s>0){if(e=this.m_dataList.shift(),t.sendDataTo(e),1==e.sendStatus)return this.m_dataTotal--,!0;this.m_waitList.push(e)}}return!1}addData(t){t.sendStatus<0&&(t.sendStatus=0,this.m_dataTotal++,this.m_dataHaveTotal++,this.m_startupFlag=1,this.m_dataList.push(t))}getDataTotal(){return this.m_dataTotal}isEnabled(){return this.m_dataTotal*this.m_startupFlag>0}isStartup(){return this.m_startupFlag>0}}e.default=i},7045:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.phase=0,this.type=i.KEY_DOWN,this.target=null,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.repeat=!1,this.key="",this.keyCode=0,this.location=0}getClassType(){return i.EventClassType}toString(){return"[KeyboardEvent]"}}i.EventClassType=1003,i.KEY_DOWN=6001,i.KEY_UP=6002,e.default=i},"70f2":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("0236")),h=i(s("c51d")),o=i(s("af68")),l=i(s("a80a")),_=i(s("a446")),u=i(s("c711")),m=i(s("955e")),d=i(s("765c")),c=i(s("af29"));class f{constructor(t,e,s){this.m_uid=-1,this.m_adapter=null,this.m_renderProxy=null,this.m_rcontext=null,this.m_renderer=null,this.m_parent=null,this.m_processids=new Uint8Array(128),this.m_processidsLen=0,this.m_rspace=null,this.m_mouse_rltv=new a.default,this.m_mouse_rlpv=new a.default,this.m_evtFlowEnabled=!1,this.m_evt3DCtr=null,this.m_mouseEvtEnabled=!0,this.m_camera=null,this.m_viewX=0,this.m_viewY=0,this.m_viewW=800,this.m_viewH=800,this.m_nodeWaitLinker=null,this.m_nodeWaitQueue=null,this.m_perspectiveEnabled=!0,this.m_rparam=null,this.m_stage3D=null,this.m_shader=null,this.m_runFlag=-1,this.m_autoRunning=!0,this.m_currStage3D=null,this.textureBlock=null,this.m_children=[],this.m_childrenTotal=0,this.m_mouseTestBoo=!0,this.m_cullingTestBoo=!0,this.m_rayTestFlag=!0,this.m_rayTestEnabled=!0,this.m_evtFlowEnabled=s,this.m_parent=t,this.m_renderer=e,this.m_shader=e.getDataBuilder().getRenderShader(),this.m_uid=1024+f.__s_uid++}getUid(){return this.m_uid}getRPONodeBuilder(){return null}getRenderProxy(){return this.m_renderProxy}setViewPort(t,e,s,i){null!=this.m_renderProxy&&(this.m_viewX=t,this.m_viewY=e,this.m_viewW=s,this.m_viewH=i)}reseizeViewPort(){this.m_renderProxy.reseizeRCViewPort()}getRendererAdapter(){return this.m_adapter}getRenderer(){return this.m_renderer}getRendererContext(){return this.m_rcontext}getStage3D(){return this.m_renderProxy.getStage3D()}getCurrentStage3D(){return this.m_currStage3D}getCamera(){return this.m_camera}getMouseXYWorldRay(t,e){this.m_camera.getWorldPickingRayByScreenXY(this.m_stage3D.mouseX,this.m_stage3D.mouseY,t,e)}createCamera(){return new h.default}createFBOInstance(){return new c.default(this,this.textureBlock.getRTTStrore())}setEvt3DController(t){null!=t&&(null==this.m_currStage3D&&(this.m_currStage3D=new n.default(this.m_renderProxy.getRCUid(),null)),t.initialize(this.getStage3D(),this.m_currStage3D),t.setRaySelector(this.m_rspace.getRaySelector())),this.m_evt3DCtr=t}isRayPickSelected(){return null!=this.m_evt3DCtr&&this.m_evt3DCtr.isSelected()}enableMouseEvent(t=!0){null==this.m_evt3DCtr&&(t?this.m_rspace.setRaySelector(new m.default):this.m_rspace.setRaySelector(new u.default),this.setEvt3DController(new d.default)),this.m_mouseEvtEnabled=!0}disableMouseEvent(){this.m_mouseEvtEnabled=!1}getEvt3DController(){return this.m_evt3DCtr}getSpace(){return this.m_rspace}getDevicePixelRatio(){return this.m_adapter.getDevicePixelRatio()}addEventListener(t,e,s,i=!0,r=!1){this.m_currStage3D.addEventListener(t,e,s,i,r)}removeEventListener(t,e,s){this.m_currStage3D.removeEventListener(t,e,s)}initialize(t,e=3,s=!0){if(null==this.m_renderProxy){e<1&&(e=1),e>8&&(e=8),this.m_rparam=t,this.m_perspectiveEnabled=t.cameraPerspectiveEnabled;let i=null;for(;e>=0;)i=this.m_renderer.appendProcess(t.batchEnabled,t.processFixedState),this.m_processids[this.m_processidsLen]=i.getRPIndex(),this.m_processidsLen++,--e;this.m_rcontext=this.m_renderer.getRendererContext(),this.m_renderProxy=this.m_rcontext.getRenderProxy(),this.m_adapter=this.m_renderProxy.getRenderAdapter(),this.m_stage3D=this.m_renderProxy.getStage3D(),this.m_viewX=this.m_stage3D.getViewX(),this.m_viewY=this.m_stage3D.getViewY(),this.m_viewW=this.m_stage3D.getViewWidth(),this.m_viewH=this.m_stage3D.getViewHeight(),s?this.createMainCamera():this.m_camera=this.m_renderProxy.getCamera(),null==this.m_rspace&&(this.m_rspace=new _.default,this.m_rspace.initialize(this.m_renderer,this.m_camera))}}createMainCamera(){this.m_camera=new h.default,this.m_camera.setViewXY(this.m_viewX,this.m_viewY),this.m_camera.setViewSize(this.m_viewW,this.m_viewH);let t=this.m_rparam.camProjParam;this.m_perspectiveEnabled?this.m_camera.perspectiveRH(r.default.DegreeToRadian(t.x),this.m_viewW/this.m_viewH,t.y,t.z):this.m_camera.orthoRH(t.y,t.z,-.5*this.m_viewH,.5*this.m_viewH,-.5*this.m_viewW,.5*this.m_viewW),this.m_camera.lookAtRH(this.m_rparam.camPosition,this.m_rparam.camLookAtPos,this.m_rparam.camUpDirect),this.m_camera.update()}cameraLock(){this.m_camera.lock()}cameraUnlock(){this.m_camera.unlock()}updateRenderBufferSize(){this.m_adapter.updateRenderBufferSize()}setRendererProcessParam(t,e,s){this.m_renderer.setRendererProcessParam(this.m_processids[t],e,s)}appendARendererProcess(t=!0,e=!1){let s=this.m_renderer.appendProcess(t,e);this.m_processids[this.m_processidsLen]=s.getRPIndex(),this.m_processidsLen++}addContainer(t,e=0){if(e<0&&(e=0),null!=t&&t.__$wuid<0&&t.__$contId<1){let s=0;for(;s<this.m_childrenTotal;++s)if(this.m_children[s]==t)return;s>=this.m_childrenTotal&&(t.__$wuid=this.m_uid,t.wprocuid=e,t.__$setRenderer(this),this.m_children.push(t),this.m_childrenTotal++)}}removeContainer(t){if(null!=t&&t.__$wuid==this.m_uid&&t.getRenderer()==this.m_renderer){let e=0;for(;e<this.m_childrenTotal;++e)if(this.m_children[e]==t){t.__$wuid=-1,t.wprocuid=-1,t.__$setRenderer(null),this.m_children.splice(e,1),--this.m_childrenTotal;break}}}setAutoRunningEnabled(t){this.m_autoRunning=t}moveEntityTo(t,e){this.m_renderer.moveEntityToProcessAt(t,this.m_processids[e])}drawEntity(t,e=!0){e&&this.m_rcontext.resetUniform(),this.m_renderer.drawEntity(t)}addEntity(t,e=0,s=!0){if(t.__$testSpaceEnabled())if(t.isPolyhedral())if(t.hasMesh())this.m_renderer.addEntity(t,this.m_processids[e],s),null!=this.m_rspace&&this.m_rspace.addEntity(t);else{null==this.m_nodeWaitLinker&&(this.m_nodeWaitLinker=new l.default,this.m_nodeWaitQueue=new o.default);let s=this.m_nodeWaitQueue.addEntity(t);s.rstatus=e,this.m_nodeWaitLinker.addNode(s)}else this.m_renderer.addEntity(t,this.m_processids[e],s),null!=this.m_rspace&&this.m_rspace.addEntity(t)}removeEntity(t){let e=null;if(null!=this.m_nodeWaitLinker){let e=this.m_nodeWaitQueue.getNodeByEntity(t);null!=e&&(this.m_nodeWaitLinker.removeNode(e),this.m_nodeWaitQueue.removeEntity(t))}null==e&&(this.m_renderer.removeEntity(t),null!=this.m_rspace&&this.m_rspace.removeEntity(t))}updateMaterialUniformToCurrentShd(t){this.m_renderer.updateMaterialUniformToCurrentShd(t)}drawEntityByLockMaterial(t){this.m_renderer.drawEntityByLockMaterial(t)}showInfoAt(t){this.m_renderer.showInfoAt(t)}updateCameraData(t){this.m_rcontext.updateCameraDataFromCamera(this.m_renderProxy.getCamera())}renderBegin(t=!1){t&&this.m_rcontext.renderBegin(),this.m_renderProxy.getCamera()!=this.m_camera&&(this.m_renderProxy.isAutoSynViewAndStage()&&(this.m_viewX=this.m_renderProxy.getViewX(),this.m_viewY=this.m_renderProxy.getViewY(),this.m_viewW=this.m_renderProxy.getViewWidth(),this.m_viewH=this.m_renderProxy.getViewHeight()),this.m_camera.setViewXY(this.m_viewX,this.m_viewY),this.m_camera.setViewSize(this.m_viewW,this.m_viewH),this.m_renderProxy.setRCViewPort(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH,this.m_renderProxy.isAutoSynViewAndStage()),this.m_renderProxy.reseizeRCViewPort()),this.m_camera.update(),this.m_rcontext.updateCameraDataFromCamera(this.m_camera),this.m_shader.renderBegin()}runBegin(t=!0,e=!1){t&&this.m_autoRunning&&(this.m_runFlag>=0&&this.runEnd(),this.m_runFlag=0),this.renderBegin(e),null!=this.m_rspace&&(this.m_rspace.setCamera(this.m_camera),this.m_rspace.runBegin())}setRayTestEanbled(t){this.m_rayTestEnabled=t}runMouseTest(t,e){let s=-1;if(null!=this.m_evt3DCtr&&this.m_mouseEvtEnabled){if(this.m_rayTestFlag&&this.m_evt3DCtr.getEvtType()>0){let t=this.m_rspace.getRaySelector();if(null!=t){this.m_rayTestEnabled?this.mouseRayTest():t.clear();let e=t.getSelectedNodesTotal();if(e>1){let s=0,i=t.getSelectedNodes(),r=null;for(;s<e;++s)r=i[s],r.entity.isPolyhedral()}}this.m_rayTestFlag=!1}s=this.m_evt3DCtr.run(t,e)}return this.m_mouseTestBoo=!1,s}update(t=!0,e=!0){if(this.m_currStage3D.enterFrame(),t&&this.m_autoRunning&&(0!=this.m_runFlag&&this.runBegin(),this.m_runFlag=1),this.m_mouseTestBoo=!0,this.m_cullingTestBoo=!0,this.m_rayTestFlag=!0,null!=this.m_nodeWaitLinker){let t=this.m_nodeWaitLinker.getBegin();if(null!=t){let e,s,i;while(null!=t)t.entity.hasMesh()?(e=t,t=t.next,s=e.entity,i=e.rstatus,this.m_nodeWaitLinker.removeNode(e),this.m_nodeWaitQueue.removeEntity(e.entity),this.addEntity(s,i)):t=t.next}}let s=0;for(;s<this.m_childrenTotal;++s)this.m_children[s].update();null!=this.m_rspace&&this.m_rspace.update(),null!=this.m_rspace&&this.m_cullingTestBoo&&(null==this.m_evt3DCtr&&null==this.m_rspace.getRaySelector()||this.m_rspace.run()),this.m_mouseTestBoo&&!this.m_evtFlowEnabled&&(e?this.runMouseTest(1,0):null!=this.m_evt3DCtr&&this.m_evt3DCtr.mouseOutEventTarget())}cullingTest(){null!=this.m_rspace&&this.m_rspace.run(),this.m_cullingTestBoo=!1}mouseRayTest(){null!=this.m_rspace&&(this.getMouseXYWorldRay(this.m_mouse_rlpv,this.m_mouse_rltv),this.m_rspace.rayTest(this.m_mouse_rlpv,this.m_mouse_rltv))}run(t=!1){t&&this.m_autoRunning&&(1!=this.m_runFlag&&this.update(),this.m_runFlag=2);for(let e=0;e<this.m_processidsLen;++e)this.m_renderer.runAt(this.m_processids[e]);t&&this.runEnd()}runAt(t){this.m_renderer.runAt(this.m_processids[t])}runEnd(){null!=this.m_evt3DCtr&&this.m_evt3DCtr.runEnd(),null!=this.m_rspace&&this.m_rspace.runEnd(),this.m_autoRunning&&(this.m_runFlag=-1)}useCamera(t,e=!1){this.m_parent.useCamera(t,e)}useMainCamera(){this.m_parent.useMainCamera()}updateCamera(){null!=this.m_camera&&this.m_camera.update()}setClearUint24Color(t,e=1){this.m_renderProxy.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,s){this.m_renderProxy.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.m_renderProxy.setClearRGBAColor4f(t,e,s,i)}setClearColor(t){this.m_renderProxy.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.m_renderProxy.setRenderToBackBuffer()}toString(){return"[RendererSubScene(uid = "+this.m_uid+")]"}}f.__s_uid=0,e.default=f},"710f":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){if(this.m_useidList=[],this.m_removeidList=[],null!=i.s_ins)throw Error("ROVtxBufUidStore is a singleton class!!");i.s_ins=this}static GetInstance(){return i.s_ins}__$getRemovedListLen(){return this.m_removeidList.length}__$getRemovedList(){return this.m_removeidList}__$attachAt(t){if(t<this.m_useidList.length)++this.m_useidList[t];else{let e=this.m_useidList.length;for(;e<=t;++e)this.m_useidList.push(0);++this.m_useidList[t]}}__$detachAt(t){--this.m_useidList[t],this.m_useidList[t]<1&&(this.m_useidList[t]=0,this.m_removeidList.push(t))}getAttachCountAt(t){return t<this.m_useidList.length?this.m_useidList[t]:0}getAttachAllCount(){let t=0,e=0,s=this.m_useidList.length;for(;e<s;++e)this.m_useidList[e]>0&&(t+=this.m_useidList[e]);return t}}i.s_ins=null,e.default=i},7181:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,s,i,r,a){1==this.status||a?t.texImage2D(e,this.miplevel,s,i,r,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,i,r,this.data),this.status=-1}static Create(){return i.s_list.length>0?i.s_list.pop():new i}static Restore(t){null!=t&&(t.data=null,i.s_list.push(t))}}i.s_list=[],e.default=i},"722e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.NEAREST=4001,i.LINEAR=4002,i.LINEAR_MIPMAP_LINEAR=4003,i.NEAREST_MIPMAP_NEAREST=4004,i.LINEAR_MIPMAP_NEAREST=4005,i.NEAREST_MIPMAP_LINEAR=4006,e.default=i},"725b":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("fe7f")),n=i(s("3b73"));class h{constructor(){this.width=4,this.height=4,this.x=0,this.y=0,this.uvs=new Float32Array(8)}toString(){return"FontTexCharGrid(x="+this.x+",y="+this.y+",width="+this.width+",height="+this.height+")"}}class o{constructor(){this.m_texWidth=512,this.m_texHeight=256,this.m_gridMp=new Map,this.layoutDataStr="",this.m_minX=0,this.m_minY=0,this.m_maxX=0,this.m_maxY=0}initialize(t,e){this.m_texWidth=t,this.m_texHeight=e}addCharsByRawData(t,e){let s=0,i=0,r=e.split(","),a=r.length/4;for(;s<a;++s)i=4*s,this.addUV8RawDataFromChar(t.charAt(s),parseInt(r[i]),parseInt(r[i+1]),parseInt(r[i+2]),parseInt(r[i+3]))}addUV8RawDataFromChar(t,e,s,i,r){if(null==this.m_gridMp.get(t)){let a=new h,n=a.uvs,o=this.m_texWidth,l=this.m_texHeight;this.m_minX=e/o,this.m_minY=s/l,this.m_maxX=(e+i)/o,this.m_maxY=(s+r)/l,n[0]=this.m_minX,n[1]=this.m_maxY,n[2]=this.m_maxX,n[3]=this.m_maxY,n[4]=this.m_maxX,n[5]=this.m_minY,n[6]=this.m_minX,n[7]=this.m_minY,a.x=e,a.y=s,a.width=i,a.height=r,this.m_gridMp.set(t,a)}}getGridByChar(t){return this.m_gridMp.get(t)}getUV8FromChar(t,e,s=0){let i=this.m_gridMp.get(t);null==i&&(i=this.m_gridMp.get("?")),e.set(i.uvs,s)}getVtxFromChar(t,e,s=0){let i=this.m_gridMp.get(t);null==i&&(i=this.m_gridMp.get("?"));let r=[0,0,0,i.width,0,0,i.width,i.height,0,0,i.height,0];e.set(r,s)}getUV8AndVtxFromChar(t,e,s,i=0,r=0){let a=this.m_gridMp.get(t);null==a&&(a=this.m_gridMp.get("?")),e.set(a.uvs,i);let n=[0,0,0,a.width,0,0,a.width,a.height,0,0,a.height,0];s.set(n,r)}getUV8AndSizeFromChar(t,e,s,i=0){let r=this.m_gridMp.get(t);null==r&&(r=this.m_gridMp.get("?")),e.set(r.uvs,i),s[0]=r.width,s[1]=r.height}getUV8AndOffsetXYVtxFromChar(t,e,s,i=0,r=0,a=0,n=0){let h=this.m_gridMp.get(t);null==h&&(h=this.m_gridMp.get("?")),e.set(h.uvs,a);let o=[i,r,0,i+h.width,r,0,i+h.width,r+h.height,0,i,r+h.height,0];s.set(o,n)}}e.FontTexCharTable=o;class l{constructor(){this.m_currPosX=0,this.m_currPosY=0,this.m_texText="",this.m_fontCharTable=null,this.pixMinPos={x:0,y:0},this.pixMaxPos={x:0,y:0},this.canvas=null,this.ctx2d=null,this.m_py=0,this.charTexWidth=0,this.px=0,this.py=0,this.ph=0,this.linedis=2,this.charHDis=1,this.tx=0,this.char="",this.meao=null}setFontCharTable(t){this.m_fontCharTable=t}textFilte(t){let e=t.length,s="",i="";for(let r=0;r<e;++r)i=t.charAt(r),this.m_texText.indexOf(i)<0&&s.indexOf(i)<0&&(s+=i);return s}crateTextUVData(t,e,s,i=18){this.m_texText+=t;let r=this.ctx2d;this.m_currPosY<2&&(this.m_currPosY=i),this.charTexWidth=0,r.textAlign="left",r.fillStyle="white",r.font=i+"px Arial";let a=t.length;this.pixMinPos.x=2e4,this.pixMinPos.y=2e4,this.pixMaxPos.x=-2e4,this.pixMaxPos.y=-2e4,this.ph=i+8;for(let n=0;n<a;n++)this.char=t.charAt(n),this.meao=r.measureText(this.char),this.charTexWidth=Math.floor(this.meao.width)+1,this.tx=this.m_currPosX+this.charTexWidth,this.tx<e?(r.fillText(this.char,this.m_currPosX,this.m_currPosY),this.m_py=this.m_currPosY-i,this.pixMinPos.x>this.m_currPosX&&(this.pixMinPos.x=this.m_currPosX),this.pixMinPos.y>this.m_py&&(this.pixMinPos.y=this.m_py),this.px=this.m_currPosX+this.charTexWidth,this.py=this.m_py+this.ph,this.pixMaxPos.x<this.px&&(this.pixMaxPos.x=this.px),this.pixMaxPos.y<this.py&&(this.pixMaxPos.y=this.py),this.m_fontCharTable.addUV8RawDataFromChar(this.char,this.m_currPosX,this.m_py+1,this.charTexWidth,this.ph),this.m_currPosX=this.tx+this.charHDis):(this.m_currPosX=0,this.m_currPosY+=this.ph+this.linedis,r.fillText(this.char,this.m_currPosX,this.m_currPosY),this.m_py=this.m_currPosY-i,this.pixMinPos.x>this.m_currPosX&&(this.pixMinPos.x=this.m_currPosX),this.pixMinPos.y>this.m_py&&(this.pixMinPos.y=this.m_py),this.px=this.m_currPosX+this.charTexWidth,this.py=this.m_py+this.ph,this.pixMaxPos.x<this.px&&(this.pixMaxPos.x=this.px),this.pixMaxPos.y<this.py&&(this.pixMaxPos.y=this.py),this.m_fontCharTable.addUV8RawDataFromChar(this.char,this.m_currPosX,this.m_py+1,this.charTexWidth,this.ph),this.m_currPosX+=this.charTexWidth)}}e.FontTexDataBuilder=l;class _{constructor(){this.m_texWidth=512,this.m_texHeight=256,this.m_canvas=null,this.m_ctx2D=null,this.m_texBase=null,this.m_fontSize=18,this.m_fontCharTable=new o,this.m_fontTexDataBuilder=new l,this.m_renderProxy=null,this.m_preSW=0,this.m_preSH=0,this.m_areaBytes=null}setRenderProxy(t){null!=t&&(this.m_renderProxy=t,null!=this.m_texBase&&this.m_texBase.__$setRenderProxy(t))}isEnabled(){return null!=this.m_canvas}getFontSize(){return this.m_fontSize}initialize(t,e=10,s=512,i=512,h=!1,o=!1){if(n.default.IsMobileWeb()&&(e*=2,s=i*=2),null==this.m_canvas){s<32&&(s=32),i<32&&(i=32),this.m_texWidth=s,this.m_texHeight=i,e<10&&(e=10),this.m_fontSize=e;var l=null;try{void 0!=document&&(l=document)}catch(_){}this.m_canvas=l.getElementById(t),null==this.m_canvas&&(this.m_canvas=document.createElement("canvas"),this.m_canvas.style.width="128px",this.m_canvas.style.height="128px",this.m_canvas.style.display="bolck",this.m_canvas.style.overflow="hidden",this.m_canvas.style.left="0px",this.m_canvas.style.top="0px",this.m_canvas.style.position="absolute",this.m_canvas.style.backgroundColor="transparent",this.m_canvas.style.pointerEvents="none"),this.m_canvas.width=s,this.m_canvas.height=i,h?(document.body.appendChild(this.m_canvas),this.m_canvas.style.visibility="visible"):this.m_canvas.style.visibility="hidden",this.m_ctx2D=this.m_canvas.getContext("2d"),this.m_fontTexDataBuilder.canvas=this.m_canvas,this.m_fontTexDataBuilder.ctx2d=this.m_ctx2D,this.m_fontTexDataBuilder.setFontCharTable(this.m_fontCharTable),this.m_fontCharTable.initialize(this.m_texWidth,this.m_texHeight),this.m_texBase=new a.default(this.m_texWidth,this.m_texHeight),this.m_texBase.__$setRenderProxy(this.m_renderProxy),this.m_texBase.toAlphaFormat(),this.m_texBase.mipmapEnabled=o,this.m_texBase.minFilter=r.TextureConst.LINEAR,this.m_texBase.magFilter=r.TextureConst.NEAREST,this.createInitTexAndChars()}}setStyleSize(t,e){null!=this.m_canvas&&(this.m_preSW==t&&this.m_preSH==e||(this.m_preSW=t,this.m_preSH=e,this.m_canvas.style.width=t+"px",this.m_canvas.style.height=e+"px"))}setCanvasVisible(t){this.m_canvas.style.visibility=t?"visible":"hidden"}getUV8FromChar(t,e,s=0){this.m_fontCharTable.getUV8FromChar(t,e,s)}getCharTable(){return this.m_fontCharTable}createCharsTexFromStr(t){if(t=this.m_fontTexDataBuilder.textFilte(t),t.length<1)return;let e=t;this.m_fontTexDataBuilder.crateTextUVData(e,this.m_texWidth,this.m_texHeight,this.m_fontSize);let s=0,i=0,r=0,a=0,n=0,h=this.m_fontTexDataBuilder.pixMaxPos.x-this.m_fontTexDataBuilder.pixMinPos.x,o=this.m_fontTexDataBuilder.pixMaxPos.y-this.m_fontTexDataBuilder.pixMinPos.y,l=this.m_ctx2D.getImageData(this.m_fontTexDataBuilder.pixMinPos.x,this.m_fontTexDataBuilder.pixMinPos.y,h,o),_=l.data,u=new Uint8Array(h*o),m=this.m_fontTexDataBuilder.pixMinPos.x,d=this.m_fontTexDataBuilder.pixMinPos.y;for(i=0;i<o;++i)for(r=0;r<h;++r)n=(i+d)*this.m_texWidth+(m+r),s=4*(i*h+r),this.m_areaBytes[n]=_[s+3],u[a]=this.m_areaBytes[n],a++;this.m_texBase.setPartDataFromeBytes(u,this.m_fontTexDataBuilder.pixMinPos.x,this.m_fontTexDataBuilder.pixMinPos.y,h,o),this.m_texBase.updateDataToGpu()}createInitTexAndChars(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890~`!@#$%^&*()_+-={}[]:\";\\|'<>,.?/\n ",e=t;this.m_fontTexDataBuilder.crateTextUVData(e,this.m_texWidth,this.m_texHeight,this.m_fontSize);let s=this.m_ctx2D.getImageData(0,0,this.m_texWidth,this.m_texHeight),i=s.data,r=0,a=0,n=0;this.m_areaBytes=new Uint8Array(this.m_texWidth*this.m_texHeight);let h=0;for(r=0;r<this.m_texHeight;++r)for(a=0;a<this.m_texWidth;++a)n=4*(r*this.m_texWidth+a),this.m_areaBytes[h]=i[n+3],h++;this.m_texBase.setDataFromBytes(this.m_areaBytes,0,this.m_texWidth,this.m_texHeight)}getTextureAt(t=0){return this.m_texBase}static GetInstance(){return null!=_.s_ins||(_.s_ins=new _),_.s_ins}}_.s_ins=null,e.default=_},7279:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("5326")),a=i(s("3b73")),n=i(s("d53d"));class h extends n.default{constructor(){super(),this.slotId=0,this.slotIndex=0,this.uniformsTotal=0,this.locationIndexList=null,this.locations=null,this.rst=0,this.always=!1}clone(){let t=new h;return t.types=this.types.slice(0),t.uniformNameList=this.uniformNameList.slice(0),t.dataSizeList=this.dataSizeList.slice(0),t.slotIndex=this.slotIndex,t.uniformsTotal=this.uniformsTotal,t.slotId=this.slotId,t.always=this.always,t.rst=this.rst,t}copyDataFromProbe(t){this.types=t.uniformTypes.slice(0),this.dataSizeList=t.dataSizeList.slice(0),this.slotIndex=t.getSlotBeginIndex(),this.uniformsTotal=t.uniformsTotal,this.slotId=t.getSlotUid()}copyDataFromProbeAt(t,e){null==this.types&&(this.types=[],this.dataSizeList=[]),this.slotIndex=e.getSlotBeginIndex()+t,this.uniformsTotal=1,this.slotId=e.getSlotUid(),this.types[0]=e.uniformTypes[t],this.dataSizeList[0]=e.dataSizeList[t]}use(t){let e=r.default.GetSlotAt(t.getRCUid());if(this.always||this.rst!=e.flagList[this.slotIndex]){this.rst=e.flagList[this.slotIndex];let s=0;if(a.default.IsWebGL1())for(;s<this.uniformsTotal;++s)t.useUniformV1(this.locations[s],this.types[s],e.dataList[this.slotIndex+s],this.dataSizeList[s]);else for(;s<this.uniformsTotal;++s)t.useUniformV2(this.locations[s],this.types[s],e.dataList[this.slotIndex+s],this.dataSizeList[s],0)}}destroy(){this.types=null,this.dataSizeList=null,this.slotIndex=-1,this.uniformsTotal=0}}e.default=h},7499:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_dispBuilder=null,this.m_shader=null,this.m_texRes=null}setDispBuilder(t){null==this.m_dispBuilder&&(this.m_dispBuilder=t,this.m_shader=t.getRenderShader(),this.m_texRes=t.getTextureResource())}unlockMaterial(){this.m_shader.unlock(),this.m_texRes.unlocked=!0}lockMaterial(){this.m_shader.lock(),this.m_texRes.unlocked=!1}isUnlockMatrial(){return this.m_texRes.unlocked}unlockTexture(){this.m_shader.textureUnlock()}lockTexture(){this.m_shader.textureLock()}renderBegin(){this.m_shader.renderBegin(),this.m_texRes.renderBegin()}resetUniform(){this.m_shader.resetUniform()}useGlobalMaterial(t){this.m_dispBuilder.updateGlobalMaterial(t)}}e.default=i},"74c3":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8def")),a=i(s("fa60"));class n{constructor(){this.m_vtx=null,this.m_vtxUid=-1,this.m_gpuBufs=[],this.m_gpuBufsTotal=0,this.m_type=0,this.m_attribsTotal=0,this.m_wholeStride=0,this.m_typeList=null,this.m_offsetList=null,this.m_sizeList=null,this.m_vroList=[],this.m_vroListLen=0}updateToGpu(t){let e=this.m_gpuBufs.length;if(e>0){let s=this.m_vtx;if(this.version!=s.vertexVer){let i,r=s.getBufDataUsage(),a=this.m_sizeList;for(let n=0;n<e;++n)i=s.getF32DataAt(n),a[n]>=i.length?(t.bindArrBuf(this.m_gpuBufs[n]),t.arrBufSubData(i,0)):(t.bindArrBuf(this.m_gpuBufs[n]),t.arrBufData(i,r),a[n]=i.length);this.version=s.vertexVer}}}uploadCombined(t,e){let s=this.m_vtx,i=s.getF32DataAt(0);if(this.m_gpuBufs.push(t.createBuf()),t.bindArrBuf(this.m_gpuBufs[0]),t.arrBufData(i,s.getBufDataUsage()),this.m_gpuBufsTotal=1,this.m_sizeList=[i.length],null==this.m_typeList){this.m_wholeStride=0,this.m_typeList=new Array(this.m_attribsTotal),this.m_offsetList=new Array(this.m_attribsTotal);for(let t=0;t<this.m_attribsTotal;++t)this.m_offsetList[t]=this.m_wholeStride,this.m_wholeStride+=4*e.getLocationSizeByIndex(t),this.m_typeList[t]=e.getLocationTypeByIndex(t)}}uploadSeparated(t,e){let s=this.m_vtx,i=0,r=null,a=s.getBufDataUsage();if(this.m_gpuBufsTotal=this.m_vtx.getBuffersTotal(),this.m_sizeList=new Array(this.m_attribsTotal),null==s.bufData)for(;i<this.m_attribsTotal;++i)r=t.createBuf(),this.m_gpuBufs.push(r),t.bindArrBuf(r),t.arrBufData(s.getF32DataAt(i),a),this.m_sizeList[i]=s.getF32DataAt(i).length;else{let e=null,n=0,h=0,o=0,l=0;for(;i<this.m_attribsTotal;++i){for(r=t.createBuf(),this.m_gpuBufs.push(r),t.bindArrBuf(r),t.arrBufDataMem(s.bufData.getAttributeDataTotalBytesAt(i),a),o=0,l=0,h=s.bufData.getAttributeDataTotalAt(i),n=0;n<h;++n)e=s.bufData.getAttributeDataAt(i,n),l+=e.length,t.arrBufSubData(e,o),o+=e.byteLength;this.m_sizeList[i]=l}}if(null==this.m_typeList){this.m_typeList=new Array(this.m_attribsTotal),this.m_offsetList=new Array(this.m_attribsTotal);for(let t=0;t<this.m_attribsTotal;++t)this.m_offsetList[t]=this.m_wholeStride,this.m_wholeStride+=4*e.getLocationSizeByIndex(t),this.m_typeList[t]=e.getLocationTypeByIndex(t);this.m_wholeStride=0}}initialize(t,e,s){this.m_gpuBufs.length<1&&null!=s&&(this.version=s.vertexVer,this.m_vtx=s,this.m_vtxUid=s.getUid(),this.m_type=s.getType(),this.m_attribsTotal=e.getLocationsTotal(),this.m_type<1?this.uploadCombined(t,e):this.uploadSeparated(t,e))}getVROMid(t,e,s,i){let r=(131+t.getRCUid())*this.m_vtxUid;return s?(r=131*r+e.getMid(),r=131*r+3):r=131*r+e.getMid(),r=131*r+e.getLocationsTotal(),r=131*r+i,r}createVRO(t,e,s,i,n){let h=e.getLocationsTotal();if(this.m_attribsTotal*h>0&&h<=this.m_attribsTotal){let o=this.getVROMid(t,e,s,n),l=0,_=a.default.GetByMid(o);if(null!=_)return _;e.testVertexAttribPointerOffset(this.m_offsetList);if(s){let s=a.default.Create(t,o,this.m_vtx.getUid());if(s.vao=t.createVertexArray(),t.bindVertexArray(s.vao),this.m_type<1)for(t.bindArrBuf(this.m_gpuBufs[0]),l=0;l<h;++l)e.vertexAttribPointerTypeFloat(this.m_typeList[l],this.m_wholeStride,this.m_offsetList[l]);else for(l=0;l<h;++l)t.bindArrBuf(this.m_gpuBufs[l]),e.vertexAttribPointerTypeFloat(this.m_typeList[l],0,0);_=s,s.ibuf=i,t.bindVertexArray(null)}else{let s=r.default.Create(t,o,this.m_vtx.getUid());for(s.shdp=e,s.attribTypes=[],s.wholeOffsetList=[],s.wholeStride=this.m_wholeStride,this.m_type<1?s.vbuf=this.m_gpuBufs[0]:s.vbufs=this.m_gpuBufs,l=0;l<h;++l)e.testVertexAttribPointerType(this.m_typeList[l])&&(s.attribTypes.push(this.m_typeList[l]),s.wholeOffsetList.push(0));s.attribTypesLen=s.attribTypes.length,s.ibuf=i,_=s}return this.m_vroList.push(_),++this.m_vroListLen,_}return null}destroy(t){if(this.m_gpuBufs.length>0){this.m_type=-1;let e=0,s=null;for(;e<this.m_vroListLen;++e)s=this.m_vroList.pop(),s.restoreThis(),this.m_vroList[e]=null;for(this.m_vroListLen=0,e=0;e<this.m_attribsTotal;++e)t.deleteBuf(this.m_gpuBufs[e]),this.m_gpuBufs[e]=null;this.m_attribsTotal=0,this.m_gpuBufs=[]}}}class h{constructor(){this.m_uid=0,this.m_vtx=null,this.m_vtxUid=0,this.m_gpuBuf=null,this.m_ivsSize=0,this.ibufStep=0,this.m_uid=h.s_uid+1}getUid(){return this.m_uid}getVtxUid(){return this.m_vtxUid}getGpuBuf(){return this.m_gpuBuf}updateToGpu(t){if(null!=this.m_gpuBuf&&this.m_ivsSize>0){let e=this.m_vtx;this.version!=e.indicesVer&&(this.m_ivs=e.getIvsData(),t.bindEleBuf(this.m_gpuBuf),this.m_ivsSize>=this.m_ivs.length?t.eleBufSubData(this.m_ivs,e.getBufDataUsage()):t.eleBufData(this.m_ivs,e.getBufDataUsage()),this.m_ivsSize=this.m_ivs.length,this.version=e.indicesVer)}}initialize(t,e){if(null==this.m_gpuBuf&&null!=e.getIvsData())if(this.version=e.indicesVer,this.m_vtx=e,this.m_vtxUid=e.getUid(),this.m_ivs=e.getIvsData(),this.m_gpuBuf=t.createBuf(),t.bindEleBuf(this.m_gpuBuf),null==e.bufData)t.eleBufData(this.m_ivs,e.getBufDataUsage()),this.m_ivsSize=this.m_ivs.length;else{t.eleBufDataMem(e.bufData.getIndexDataTotalBytes(),e.getBufDataUsage());let s=null,i=0;this.m_ivsSize=0;for(let r=0,a=e.bufData.getIndexDataTotal();r<a;++r)s=e.bufData.getIndexDataAt(r),t.eleBufSubData(s,i),i+=s.byteLength,this.m_ivsSize+=s.length}}destroy(t){null!=this.m_gpuBuf&&(this.m_vtx=null,t.deleteBuf(this.m_gpuBuf),this.m_gpuBuf=null,this.m_ivs=null,this.m_ivsSize=0)}}h.s_uid=0;class o{constructor(){this.version=-1,this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.vertex=new n,this.indices=new h,this.m_attachCount=0}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}getAttachCount(){return this.m_attachCount}createVRO(t,e,s){let i=this.vertex.createVRO(t,e,s,this.indices.getGpuBuf(),this.indices.getUid());return i.ibufStep=this.indices.ibufStep,i}updateToGpu(t){this.indices.updateToGpu(t),this.vertex.updateToGpu(t)}destroy(t){this.getAttachCount()<1&&this.resUid>=0&&(this.vertex.destroy(t),this.indices.destroy(t),this.resUid=-1)}}e.GpuVtxObect=o;class l{constructor(t,e,s){this.m_resMap=new Map,this.m_freeMap=new Map,this.m_updateIds=[],this.m_vtxResTotal=0,this.m_attachTotal=0,this.m_delay=128,this.m_haveDeferredUpdate=!1,this.m_rcuid=0,this.m_gl=null,this.m_vtxBuilder=null,this.unlocked=!0,this.m_rcuid=t,this.m_gl=e,this.m_vtxBuilder=s}createResByParams3(t,e,s,i){return!1}getRCUid(){return this.m_rcuid}getRC(){return this.m_gl}hasResUid(t){return this.m_resMap.has(t)}bindToGpu(t){}getGpuBuffer(t){return null}renderBegin(){this.m_vtxBuilder.renderBegin()}getVertexResTotal(){return this.m_vtxResTotal}updateDataToGpu(t,e){e?(this.m_updateIds.push(t),this.m_haveDeferredUpdate=!0):this.m_resMap.has(t)&&this.m_resMap.get(t).updateToGpu(this.m_vtxBuilder)}addVertexRes(t){this.m_resMap.has(t.resUid)||(t.waitDelTimes=0,this.m_resMap.set(t.resUid,t),this.m_vtxResTotal++)}getVertexRes(t){return this.m_resMap.get(t)}destroyRes(t){this.m_resMap.has(t)&&this.m_resMap.get(t).destroy(this.m_vtxBuilder)}__$attachRes(t){if(this.m_resMap.has(t)){this.m_attachTotal++;let e=this.m_resMap.get(t);e.getAttachCount()<1&&this.m_freeMap.has(t)&&this.m_freeMap.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.m_resMap.has(t)&&this.m_resMap.has(t)){let e=this.m_resMap.get(t);e.getAttachCount()>0&&(this.m_attachTotal--,e.__$detachThis(),e.getAttachCount()<1&&this.m_freeMap.set(t,e))}}getVROByResUid(t,e,s){let i=this.m_resMap.get(t);return null!=i?i.createVRO(this.m_vtxBuilder,e,s):null}update(){if(this.m_haveDeferredUpdate){this.m_haveDeferredUpdate=!1;let t,e=this.m_updateIds.length;e=e>16?16:e;for(let s=0;s<e;++s)t=this.m_updateIds.shift(),this.m_resMap.has(t)&&this.m_resMap.get(t).updateToGpu(this.m_vtxBuilder)}if(this.m_delay--,this.m_delay<1){this.m_delay=128;for(const[t,e]of this.m_freeMap)e.waitDelTimes++,e.getAttachCount()<1?e.waitDelTimes>5&&(this.m_resMap.delete(e.resUid),this.m_freeMap.delete(e.resUid),e.destroy(this.m_vtxBuilder),this.m_vtxResTotal--):this.m_freeMap.delete(e.resUid)}}}e.ROVertexResource=l,e.default=l},"765c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("1710"));class a{constructor(){this.m_mainStage=null,this.m_currStage=null,this.m_raySelector=null,this.m_unlockBoo=!0,this.m_uid=0,this.m_mouseEvt=new r.default,this.m_mouseOverEvt=new r.default,this.m_mouseOutEvt=new r.default,this.m_evtTarget=null,this.m_evtTypes=new Float32Array(64),this.m_evtXList=new Float32Array(64),this.m_evtYList=new Float32Array(64),this.m_evtWheelDeltaYs=new Float32Array(64),this.m_evtTotal=0,this.m_evtFlowPhase=-1,this.m_uid=a.s_uid++}initialize(t,e){null==this.m_mainStage&&(this.m_mainStage=t,this.m_currStage=e,t.addEventListener(r.default.MOUSE_DOWN,this,this.mouseDownListener,!0,!1),t.addEventListener(r.default.MOUSE_UP,this,this.mouseUpListener,!0,!1),t.addEventListener(r.default.MOUSE_CLICK,this,this.mouseClickListener,!0,!1),t.addEventListener(r.default.MOUSE_MOVE,this,this.mouseMoveListener,!0,!1),t.addEventListener(r.default.MOUSE_WHEEL,this,this.mouseWheeelListener,!0,!1))}setRaySelector(t){this.m_raySelector=t}mouseWheeelListener(t){null!=this.m_currStage&&(this.m_currStage.mouseX=this.m_mainStage.mouseX,this.m_currStage.mouseY=this.m_mainStage.mouseY),this.m_evtTypes[this.m_evtTotal]=t.type,this.m_evtXList[this.m_evtTotal]=t.mouseX,this.m_evtYList[this.m_evtTotal]=t.mouseY,this.m_evtWheelDeltaYs[this.m_evtTotal]=t.wheelDeltaY,this.m_mouseEvt.type=t.type,this.m_evtTotal++}mouseMoveListener(t){null!=this.m_currStage&&(this.m_currStage.mouseX=this.m_mainStage.mouseX,this.m_currStage.mouseY=this.m_mainStage.mouseY),this.m_evtTypes[this.m_evtTotal]=t.type,this.m_evtXList[this.m_evtTotal]=t.mouseX,this.m_evtYList[this.m_evtTotal]=t.mouseY,this.m_evtWheelDeltaYs[this.m_evtTotal]=0,this.m_mouseEvt.type=t.type,this.m_evtTotal++}mouseDownListener(t){null!=this.m_currStage&&(this.m_currStage.mouseX=this.m_mainStage.mouseX,this.m_currStage.mouseY=this.m_mainStage.mouseY),a.s_unlockMouseEvt&&(this.m_evtTypes[this.m_evtTotal]=t.type,this.m_evtXList[this.m_evtTotal]=t.mouseX,this.m_evtYList[this.m_evtTotal]=t.mouseY,this.m_evtWheelDeltaYs[this.m_evtTotal]=0,this.m_mouseEvt.type=t.type,this.m_evtTotal++)}mouseUpListener(t){null!=this.m_currStage&&(this.m_currStage.mouseX=this.m_mainStage.mouseX,this.m_currStage.mouseY=this.m_mainStage.mouseY),a.s_unlockMouseEvt&&(this.m_evtTypes[this.m_evtTotal]=t.type,this.m_evtXList[this.m_evtTotal]=t.mouseX,this.m_evtYList[this.m_evtTotal]=t.mouseY,this.m_evtWheelDeltaYs[this.m_evtTotal]=0,this.m_mouseEvt.type=t.type,this.m_evtTotal++)}mouseClickListener(t){null!=this.m_currStage&&(this.m_currStage.mouseX=this.m_mainStage.mouseX,this.m_currStage.mouseY=this.m_mainStage.mouseY),a.s_unlockMouseEvt&&(this.m_evtTypes[this.m_evtTotal]=t.type,this.m_evtXList[this.m_evtTotal]=t.mouseX,this.m_evtYList[this.m_evtTotal]=t.mouseY,this.m_evtWheelDeltaYs[this.m_evtTotal]=0,this.m_mouseEvt.type=t.type,this.m_evtTotal++)}mouseOutEventTarget(){if(null!=this.m_currStage&&(this.m_currStage.mouseX=this.m_mainStage.mouseX,this.m_currStage.mouseY=this.m_mainStage.mouseY),null!=this.m_evtTarget){let t=this.m_evtTarget.getEvtDispatcher(r.default.EventClassType);if(null!=t)return this.m_mouseOutEvt.phase=this.m_evtFlowPhase,this.m_mouseOutEvt.type=r.default.MOUSE_OUT,this.m_mouseOutEvt.mouseX=this.m_mouseEvt.mouseX,this.m_mouseOutEvt.mouseY=this.m_mouseEvt.mouseY,this.m_mouseOutEvt.target=this.m_evtTarget,this.m_raySelector.getRay(this.m_mouseOutEvt.raypv,this.m_mouseOutEvt.raytv),this.m_evtTarget=null,t.dispatchEvt(this.m_mouseOutEvt);this.m_evtTarget=null}return 0}run(t,e){let s=-1;if(this.m_unlockBoo){this.m_evtFlowPhase=t;let i=0;s=this.m_evtTotal>0?0:-1;let n,h,o,l=null;if(s>-1){if(this.m_currStage!=this.m_mainStage&&null!=this.m_currStage){for(a.s_unlockMouseEvt=!1,i=0;i<this.m_evtTotal;i++)switch(this.m_evtTypes[i]){case r.default.MOUSE_DOWN:this.m_currStage.mouseDown(1);break;case r.default.MOUSE_UP:this.m_currStage.mouseUp(1);break;case r.default.MOUSE_MOVE:this.m_currStage.mouseMove();break;default:break}a.s_unlockMouseEvt=!0}if(n=e<1?this.m_raySelector.getSelectedNode():null,null!=n){h=n.lpv,o=n.wpv;let e=n.entity;l=e.getEvtDispatcher(r.default.EventClassType);for(let i=0;i<this.m_evtTotal;i++)this.m_mouseEvt.type=this.m_evtTypes[i],this.m_mouseEvt.mouseX=this.m_evtXList[i],this.m_mouseEvt.mouseY=this.m_evtYList[i],this.m_mouseEvt.wheelDeltaY=this.m_evtWheelDeltaYs[i],this.m_mouseEvt.type>0&&null!=n&&null!=l&&(this.m_mouseEvt.target=e,this.m_mouseEvt.phase=t,this.m_mouseEvt.lpos.copyFrom(h),this.m_mouseEvt.wpos.copyFrom(o),this.m_raySelector.getRay(this.m_mouseEvt.raypv,this.m_mouseEvt.raytv),this.m_evtTarget!=e&&(this.m_mouseOverEvt.phase=t,this.m_mouseOverEvt.type=r.default.MOUSE_OVER,this.m_mouseOverEvt.mouseX=this.m_mouseEvt.mouseX,this.m_mouseOverEvt.mouseY=this.m_mouseEvt.mouseY,this.m_mouseOverEvt.target=e,this.m_mouseOverEvt.lpos.copyFrom(h),this.m_mouseOverEvt.wpos.copyFrom(o),this.m_raySelector.getRay(this.m_mouseOverEvt.raypv,this.m_mouseOverEvt.raytv),s+=l.dispatchEvt(this.m_mouseOverEvt)),s+=l.dispatchEvt(this.m_mouseEvt),null!=this.m_evtTarget&&this.m_evtTarget!=e&&(l=this.m_evtTarget.getEvtDispatcher(r.default.EventClassType),null!=l&&(this.m_mouseOutEvt.phase=t,this.m_mouseOutEvt.type=r.default.MOUSE_OUT,this.m_mouseOutEvt.mouseX=this.m_mouseEvt.mouseX,this.m_mouseOutEvt.mouseY=this.m_mouseEvt.mouseY,this.m_mouseOutEvt.target=this.m_evtTarget,this.m_mouseOutEvt.lpos.copyFrom(h),this.m_mouseOutEvt.wpos.copyFrom(o),this.m_raySelector.getRay(this.m_mouseOutEvt.raypv,this.m_mouseOutEvt.raytv),s+=l.dispatchEvt(this.m_mouseOutEvt))),this.m_evtTarget=e)}else if(s+=this.mouseOutEventTarget(),null!=this.m_currStage)for(i=0;i<this.m_evtTotal;i++)switch(this.m_evtTypes[i]){case r.default.MOUSE_DOWN:this.m_currStage.mouseBgDown();break;case r.default.MOUSE_UP:this.m_currStage.mouseBgUp();break;default:break}if(null!=this.m_currStage){for(a.s_unlockMouseEvt=!1,i=0;i<this.m_evtTotal;i++)switch(this.m_evtTypes[i]){case r.default.MOUSE_DOWN:this.m_currStage.mouseDown(2);break;case r.default.MOUSE_UP:this.m_currStage.mouseUp(2);break;default:break}a.s_unlockMouseEvt=!0}}0==s&&null!=l&&(s=l.passTestPhase(t))}return s>0?1:0}runEnd(){this.m_evtTotal=0,this.m_mouseEvt.type=0}reset(){this.m_evtTotal=0}getEvtType(){return this.m_mouseEvt.type}isSelected(){return null!=this.m_raySelector.getSelectedNode()}lock(){this.m_unlockBoo=!1}unlock(){this.m_unlockBoo=!0}isUnlock(){return this.m_unlockBoo}}a.s_uid=0,a.s_unlockMouseEvt=!0,e.default=a},7696:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("264c")),a=i(s("5f3c"));class n{constructor(t,e,s,i,r,a){this.m_rcuid=-1,this.m_rpIndex=-1,this.m_nodesLen=0,this.m_enabled=!0,this.m_blockList=[],this.m_blockListLen=0,this.m_blockFList=new Int8Array(n.s_max_shdTotal),this.m_blockFListLen=n.s_max_shdTotal,this.m_shader=null,this.m_rpoNodeBuilder=null,this.m_rpoUnitBuilder=null,this.m_vtxResource=null,this.m_fixBlock=null,this.m_sortBlock=null,this.m_sorter=null,this.m_batchEnabled=!0,this.m_fixedState=!0,this.m_sortEnabled=!1,this.uid=-1,this.m_shader=t,this.m_rpoNodeBuilder=e,this.m_rpoUnitBuilder=s,this.m_vtxResource=i,this.m_fixBlock=this.createBlock(),this.m_batchEnabled=r,this.m_fixedState=a;for(let n=0;n<this.m_blockFListLen;++n)this.m_blockFList[n]=-1}createBlock(){let t=new a.default(this.m_shader);return t.rpoNodeBuilder=this.m_rpoNodeBuilder,t.rpoUnitBuilder=this.m_rpoUnitBuilder,t.vtxResource=this.m_vtxResource,t}setRenderParam(t,e){this.m_blockListLen<1&&(this.m_batchEnabled=t,this.m_fixedState=e)}setRendererParam(t,e){this.m_rc=t,this.m_rcuid=t.getRCUid(),this.m_rpIndex=e}getUid(){return this.uid}getRCUid(){return this.m_rcuid}getRPIndex(){return this.m_rpIndex}hasSorter(){return null!=this.m_sorter}setSorter(t){this.m_sorter=t,null!=this.m_sortBlock&&this.m_sortBlock.setSorter(t)}setSortEnabled(t){this.m_nodesLen<1?this.m_sortEnabled=t:null!=this.m_sortBlock&&(this.m_sortBlock.sortEnabled=t)}getSortEnabled(){return this.m_sortEnabled}getUnitsTotal(){return this.m_nodesLen}addNodeToBlock(t){let e=null;if(t.shdUid>=n.s_max_shdTotal)throw Error("Shader uid >= "+n.s_max_shdTotal);this.m_blockFList[t.shdUid]<0?(e=this.createBlock(),e.batchEnabled=this.m_batchEnabled,e.fixedState=this.m_fixedState,e.batchEnabled?e.fixedState?e.runMode=2:e.runMode=1:e.runMode=0,e.shdUid=t.shdUid,e.index=this.m_blockListLen,e.procuid=this.m_rpIndex,this.m_blockList.push(e),this.m_blockFList[t.shdUid]=this.m_blockListLen,++this.m_blockListLen):e=this.m_blockList[this.m_blockFList[t.shdUid]],t.index=e.index,e.addNode(t)}rejoinRunitForTro(t){let e=this.m_rpoNodeBuilder.getNodeByUid(t.__$rpuid);null!=e&&(e.tro=t.tro,e.texMid=e.unit.texMid,this.m_blockList[e.index].rejoinNode(e))}rejoinRunitForVro(t){let e=this.m_rpoNodeBuilder.getNodeByUid(t.__$rpuid);null!=e&&(e.drawMode=t.drawMode,e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,e.vtxUid=t.vtxUid,e.vro=t.vro,this.m_blockList[e.index].rejoinNode(e))}addDisp(t){if(null!=t&&null!=t.__$$runit&&t.__$$runit.getRPROUid()<0&&t.__$$runit.getRPROUid()!=this.uid){let e=this.m_rpoNodeBuilder.create();e.unit=this.m_rpoUnitBuilder.getNodeByUid(t.__$ruid),e.unit.shader=this.m_shader,e.unit.__$rprouid=this.uid,t.__$rpuid=e.uid,e.__$ruid=t.__$ruid,e.unit.__$rpuid=e.uid,e.updateData(),++this.m_nodesLen,this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.getUid(),e.uid),this.m_sortEnabled?(null!=this.m_sortBlock||(this.m_sortBlock=new r.default(this.m_shader),this.m_sortBlock.setSorter(this.m_sorter)),this.m_sortBlock.addNode(e)):this.addNodeToBlock(e)}}updateDispMateiral(t){if(null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),s=this.m_rpoNodeBuilder.getNodeByUid(e);s.shdUid=s.unit.shdUid,s.texMid=s.unit.texMid,s.tro=s.unit.tro;let i=this.m_blockList[s.index];i.removeNode(s),this.addNodeToBlock(s)}}removeDisp(t){if(null!=t&&null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),s=this.m_rpoNodeBuilder.getNodeByUid(e);if(null!=s){if(null==this.m_sortBlock){let t=this.m_blockList[s.index];t.removeNode(s)}else this.m_sortBlock.removeNode(s);this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.getUid(),-1),--this.m_nodesLen;let e=s.unit;this.m_rpoNodeBuilder.restore(s)&&this.m_rpoUnitBuilder.restore(e),this.m_vtxResource.__$detachRes(t.vbuf.getUid()),t.__$$runit=null,t.__$ruid=-1}}}removeDispUnit(t){if(null!=t&&t.__$ruid>-1){let e=t.__$$runit.getRPOUid(),s=this.m_rpoNodeBuilder.getNodeByUid(e);if(null!=s){if(null==this.m_sortBlock){let t=this.m_blockList[s.index];t.removeNode(s)}else this.m_sortBlock.removeNode(s);this.m_rpoUnitBuilder.setRPNodeParam(t.__$ruid,this.m_rpIndex,-1),s.unit.__$rprouid=-1,--this.m_nodesLen,this.m_rpoNodeBuilder.restore(s)}}}update(){this.m_enabled&&this.m_nodesLen>0&&null!=this.m_sortBlock&&this.m_sortBlock.update()}run(){if(this.m_enabled&&this.m_nodesLen>0){let t=this.m_rc;if(null==this.m_sortBlock)if(this.m_shader.isUnLocked())for(let e=0;e<this.m_blockListLen;++e)this.m_blockList[e].run(t);else for(let e=0;e<this.m_blockListLen;++e)this.m_blockList[e].runLockMaterial(t);else this.m_shader.isUnLocked()?this.m_sortBlock.run(t):this.m_sortBlock.runLockMaterial(t)}}drawDisp(t,e=!1,s=!0){if(null!=t){let i=t.__$$runit;null!=i&&(this.m_shader.isUnLocked()?(s&&this.m_shader.resetUniform(),this.m_fixBlock.drawUnit(this.m_rc,i,t)):this.m_fixBlock.drawLockMaterialByUnit(this.m_rc,i,t,e,s))}}drawLockMaterialByDisp(t,e=!1,s=!0){if(null!=t){let i=t.__$$runit;null!=i&&this.m_fixBlock.drawLockMaterialByUnit(this.m_rc,i,t,e,s)}}reset(){this.m_sortEnabled=!1,this.m_nodesLen=0,this.uid=-1,this.m_rpIndex=-1,this.m_rcuid=-1,this.m_rpIndex=-1;let t=0;for(;t<this.m_blockListLen;++t)this.m_blockList[t].reset();this.m_blockListLen=0,this.m_blockList=[],this.m_rpoNodeBuilder=null,this.m_rpoUnitBuilder=null,this.m_vtxResource=null,this.m_rc=null,null!=this.m_sortBlock&&(this.m_sortBlock.clear(),this.m_sortBlock=null)}showInfo(){let t=0;for(;t<this.m_blockListLen;++t)this.m_blockList[t].showInfo()}destroy(){this.reset()}setEnabled(t){this.m_enabled=t}getEnabled(){return this.m_enabled}toString(){return"[RenderProcess(uid = "+this.m_rpIndex+")]"}}n.s_max_shdTotal=1024,e.default=n},"76b0":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("d1a0")),n=i(s("35fa")),h=i(s("8a0a")),o=i(s("fecb")),l=i(s("cb29")),_=i(s("e7d2")),u=s("e08e"),m=i(s("3930"));class d extends l.default{constructor(t=h.default.VTX_STATIC_DRAW){super(t),this.color0=new m.default,this.color1=new m.default,this.color2=new m.default,this.color3=new m.default,this.offsetU=0,this.offsetV=0,this.uScale=1,this.vScale=1,this.flipVerticalUV=!1,this.axisFlag=0,this.m_polyhedralBoo=!0,this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,this.m_tvs=null,this.m_btvs=null,this.vsFloat32=null,this.dataStepList=null}getVS(){return this.m_vs}getUVS(){return this.m_uvs}setUVS(t){null!=t&&8==t.length&&(null==this.m_uvs?this.m_uvs=t.slice(0):this.m_uvs.set(t))}getNVS(){return this.m_nvs}getCVS(){return this.m_cvs}initialize(t,e,s,i){if(null!=this.m_vs)return;let r=t,a=e,l=t+s,m=e+i,d=0;switch(this.m_ivs=new Uint16Array([0,1,2,0,2,3]),this.axisFlag){case 0:this.m_vs=new Float32Array([r,a,d,l,a,d,l,m,d,r,m,d]);break;case 1:this.m_vs=new Float32Array([l,d,a,r,d,a,r,d,m,l,d,m]);break;case 2:this.m_vs=new Float32Array([d,r,a,d,l,a,d,l,m,d,r,m]);break;default:break}if(null==this.bounds&&(this.bounds=new o.default),this.bounds.addXYZFloat32Arr(this.m_vs),this.bounds.updateFast(),_.default.Reset(),_.default.AddFloat32Data(this.m_vs,3),null==this.m_uvs&&this.isVBufEnabledAt(h.default.VBUF_UVS_INDEX)&&(this.flipVerticalUV?this.m_uvs=new Float32Array([this.offsetU+0*this.uScale,this.offsetV+1*this.vScale,this.offsetU+1*this.uScale,this.offsetV+1*this.vScale,this.offsetU+1*this.uScale,this.offsetV+0*this.vScale,this.offsetU+0*this.uScale,this.offsetV+0*this.vScale]):this.m_uvs=new Float32Array([this.offsetU+0*this.uScale,this.offsetV+0*this.vScale,this.offsetU+1*this.uScale,this.offsetV+0*this.vScale,this.offsetU+1*this.uScale,this.offsetV+1*this.vScale,this.offsetU+0*this.uScale,this.offsetV+1*this.vScale])),this.isVBufEnabledAt(h.default.VBUF_NVS_INDEX))switch(this.axisFlag){case 0:this.m_nvs=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]);break;case 1:this.m_nvs=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0]);break;case 2:this.m_nvs=new Float32Array([1,0,0,1,0,0,1,0,0,1,0,0]);break;default:break}if(this.isVBufEnabledAt(h.default.VBUF_CVS_INDEX)&&(this.m_cvs=new Float32Array([this.color0.r,this.color0.g,this.color0.b,this.color1.r,this.color1.g,this.color1.b,this.color2.r,this.color2.g,this.color2.b,this.color3.r,this.color3.g,this.color3.b])),this.isVBufEnabledAt(h.default.VBUF_TVS_INDEX)){let t=2;this.m_tvs=new Float32Array(12),this.m_btvs=new Float32Array(12),n.default.ClacTrisTangent(this.m_vs,this.m_vs.length,this.m_uvs,this.m_nvs,t,this.m_ivs,this.m_tvs,this.m_btvs)}this.drawMode=u.RenderDrawMode.ELEMENTS_TRIANGLES,this.buildVbuf(),this.vtxTotal=4,this.trisNumber=2,this.buildEnd()}reinitialize(){this.buildVbuf()}buildVbuf(){_.default.Reset(),_.default.AddFloat32Data(this.m_vs,3),this.isVBufEnabledAt(h.default.VBUF_UVS_INDEX)&&_.default.AddFloat32Data(this.m_uvs,2),this.isVBufEnabledAt(h.default.VBUF_NVS_INDEX)&&_.default.AddFloat32Data(this.m_nvs,3),this.isVBufEnabledAt(h.default.VBUF_CVS_INDEX)&&_.default.AddFloat32Data(this.m_cvs,3),this.isVBufEnabledAt(h.default.VBUF_TVS_INDEX)&&(_.default.AddFloat32Data(this.m_tvs,3),_.default.AddFloat32Data(this.m_btvs,3)),_.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.wireframe&&this.updateWireframeIvs(),this.vtCount=this.m_ivs.length,null!=this.m_vbuf?_.default.UpdateBufData(this.m_vbuf):this.m_vbuf=_.default.CreateBySaveData(this.getBufDataUsage(),this.getBufSortFormat()),this.m_vbuf.setUintIVSData(this.m_ivs),this.buildEnd()}isPolyhedral(){return this.m_polyhedralBoo}setPolyhedral(t){this.m_polyhedralBoo=t}testRay(t,e,s,i){if(this.m_polyhedralBoo)return-1;if(i){switch(this.axisFlag){case 0:a.default.IntersectionSLV2(r.default.Z_AXIS,0,t,e,s);break;case 1:a.default.IntersectionSLV2(r.default.Y_AXIS,0,t,e,s);break;case 2:a.default.IntersectionSLV2(r.default.X_AXIS,0,t,e,s);break;default:break}return 1}return-1}toString(){return"[RectPlaneMesh()]"}__$destroy(){this.isResFree()&&(this.bounds=null,this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,super.__$destroy())}}e.default=d},"77cf":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279")),n=i(s("3077")),h=s("5216"),o=s("a9bf");class l{constructor(t=0){this.m_uid=-1,this.m_uProbe=null,this.m_suo=null,this.m_dirty=!1,this.m_uslotIndex=0,this.m_uslotIndex=t,this.m_uid=l.s_uid++}getUid(){return this.m_uid}setAmbientColorRGB3f(t,e,s){let i=r.default.EnvLightParams.data;i[0]=t,i[1]=e,i[2]=s,this.m_dirty=!0}setFogColorRGB3f(t,e,s){let i=r.default.EnvLightParams.data;i[8]=t,i[9]=e,i[10]=s,this.m_dirty=!0}setFogDensity(t){r.default.EnvLightParams.data[11]=t,this.m_dirty=!0}setFogNear(t){r.default.EnvLightParams.data[6]=t,this.m_dirty=!0}setFogFar(t){r.default.EnvLightParams.data[7]=t,this.m_dirty=!0}setFogAreaSize(t,e){r.default.EnvLightParams.data[14]=t,r.default.EnvLightParams.data[15]=t,this.m_dirty=!0}setFogAreaOffset(t,e){r.default.EnvLightParams.data[12]=t,r.default.EnvLightParams.data[13]=e,this.m_dirty=!0}useShaderPipe(t,e){if(null!=this.m_uProbe)switch(e){case h.MaterialPipeType.ENV_LIGHT_PARAM:case h.MaterialPipeType.FOG:case h.MaterialPipeType.FOG_EXP2:t.addFragUniformParam(r.default.EnvLightParams),e!=h.MaterialPipeType.ENV_LIGHT_PARAM&&this.useFogData(t,e==h.MaterialPipeType.FOG_EXP2,!0);break;default:break}}getPipeTypes(){return[h.MaterialPipeType.ENV_LIGHT_PARAM,h.MaterialPipeType.FOG,h.MaterialPipeType.FOG_EXP2]}getPipeKey(t){switch(t){case h.MaterialPipeType.ENV_LIGHT_PARAM:case h.MaterialPipeType.FOG:case h.MaterialPipeType.FOG_EXP2:return"["+t+"]";default:break}return""}useUniforms(t){null!=this.m_uProbe&&t.addFragUniformParam(r.default.EnvLightParams)}useFogData(t,e,s){t.addDefine("VOX_USE_FOG","1"),e&&t.addDefine("VOX_FOG_EXP2","1"),t.addVarying("float","v_fogDepth"),s?t.addShaderObject(o.EnvShaderCode):t.addShaderObjectHead(o.EnvShaderCode)}useUniformsForFog(t,e=!0){null!=this.m_uProbe&&(t.addFragUniformParam(r.default.EnvLightParams),this.useFogData(t,e,!1))}initialize(){null==this.m_uProbe&&(this.m_uProbe=new n.default,this.m_uProbe.bindSlotAt(this.m_uslotIndex),this.m_uProbe.addVec4Data(r.default.EnvLightParams.data,r.default.EnvLightParams.arrayLength),this.m_suo=new a.default,this.m_suo.uniformNameList=[r.default.EnvLightParams.name],this.m_suo.copyDataFromProbe(this.m_uProbe),this.m_uProbe.update())}update(){null!=this.m_uProbe&&this.m_dirty&&(this.m_dirty=!1,this.m_uProbe.update())}getGlobalUinform(){return this.m_suo.clone()}}l.s_uid=0,e.default=l},"77ef":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2ddb")),a=i(s("845e"));class n{constructor(){this.data=null,this.beginI=0,this.endI=0,this.taskclass=-1,this.srcuid=-1,this.dataIndex=-1,this.sendData=null,this.transfers=null,this.sendStatus=-1}buildThis(t){null!=this.sendData?(this.sendData.taskCmd=this.taskCmd,this.sendData.taskclass=this.taskclass,this.sendData.srcuid=this.srcuid,this.sendData.dataIndex=this.dataIndex,this.sendData.data=this.data,this.sendData.beginI=this.beginI,this.sendData.endI=this.endI):this.sendData={taskCmd:this.taskCmd,taskclass:this.taskclass,srcuid:this.srcuid,dataIndex:this.dataIndex,data:this.data,beginI:this.beginI,endI:this.endI},t&&null!=this.data&&(this.transfers=[this.data])}reset(){this.transfers=null,null!=this.sendData&&(this.sendData.data=null),this.data=null,this.sendStatus=-1}static GetFreeId(){return n.m_freeIdList.length>0?n.m_freeIdList.pop():-1}static Create(){let t=null,e=n.GetFreeId();return e>=0?(t=n.m_unitList[e],t.dataIndex=e,n.m_unitFlagList[e]=n.S_FLAG_BUSY):(t=new n,n.m_unitList.push(t),n.m_unitFlagList.push(n.S_FLAG_BUSY),t.dataIndex=n.m_unitListLen,n.m_unitListLen++),t}static Restore(t){if(null!=t&&n.m_unitFlagList[t.dataIndex]==n.S_FLAG_BUSY){let e=t.dataIndex;n.m_freeIdList.push(e),n.m_unitFlagList[e]=n.S_FLAG_FREE,t.reset()}}static RestoreByUid(t){t>=0&&n.m_unitFlagList[t]==n.S_FLAG_BUSY&&(n.m_freeIdList.push(t),n.m_unitFlagList[t]=n.S_FLAG_FREE,n.m_unitList[t].reset())}}n.S_FLAG_BUSY=1,n.S_FLAG_FREE=0,n.m_unitFlagList=[],n.m_unitListLen=0,n.m_unitList=[],n.m_freeIdList=[];class h extends r.default{constructor(t){super(),this.m_enabled=!0,this.m_listener=null,this.m_modules=[],this.m_srcBuf=null,this.m_segs=null,this.m_segIndex=0,h.s_taskTotal=t}reset(){super.reset(),this.m_modules=[],this.m_segIndex=0}setListener(t){this.m_listener=t}initCurrTask(t,e=0){let s=n.Create();s.taskCmd="DRACO_INIT",s.data=t,this.nomalizeData(s),this.m_enabled=!1,a.default.SendDataToWorkerAt(e,s)}initTask(t){null!=t&&!h.s_inited&&this.m_enabled&&this.initCurrTask(t)}parseData(t,e,s){if(null!=t&&h.s_inited){let i=n.Create();i.taskCmd="DRACO_PARSE",i.data=t,i.beginI=e,i.endI=s,this.addData(i),a.default.AddData(i)}}parseNextSeg(){if(h.s_inited&&this.m_enabled&&null!=this.m_segs&&this.m_segIndex<this.m_segs.length)for(let t=0;t<h.s_taskTotal;t++){if(!(this.m_segIndex<this.m_segs.length))break;{let t=this.m_srcBuf.slice(this.m_segs[this.m_segIndex],this.m_segs[this.m_segIndex+1]);this.parseData(t,0,t.byteLength),this.m_segIndex+=2}}}parseSrcData(t,e){null!=t&&null!=e&&(this.m_segIndex=0,this.m_srcBuf=t,this.m_segs=e,this.setParseTotal(e.length/2),this.parseNextSeg())}parseDone(t,e){switch(n.RestoreByUid(t.dataIndex),t.taskCmd){case"DRACO_INIT":this.m_enabled=!0,h.s_inited=!0,h.s_initedTaskTotal>=h.s_taskTotal?(this.m_wasmBin=t.data,0==this.m_segIndex&&null!=this.m_segs&&this.m_segs.length>0&&this.parseNextSeg()):this.initCurrTask(t.data,h.s_initedTaskTotal),h.s_initedTaskTotal++;break;case"DRACO_PARSE":this.m_enabled=!0,this.m_parseIndex++,this.m_modules.push(t.data.module),null!=this.m_listener&&(this.isFinished()?this.m_listener.dracoParseFinish(this.m_modules,this.getParseTotal()):(this.parseNextSeg(),this.m_listener.dracoParse(t.data.module,this.getParsedIndex(),this.getParseTotal())));break;default:break}return!0}getWorkerSendDataAt(t){return null}destroy(){this.getUid()>0&&super.destroy()}getTaskClass(){return 0}}h.s_inited=!1,h.s_taskTotal=1,h.s_initedTaskTotal=1,e.default=h},"78e9":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("644c"));class a{constructor(){this.type=-1,this.typeName="",this.name="",this.isArray=!1,this.arrLength=0,this.isTex=!1,this.location=null}parseCode(t){const e=";";let s=t.indexOf(e);if(s<0)return!1;const i=" ";t=t.replace(/^\s*|\s*$/g,""),s>0&&(t=t.slice(0,s));let a=t.split(i);return this.typeName=a[a.length-2],this.name=a[a.length-1],s=this.name.indexOf("["),this.isArray=s>0,this.arrLength=0,this.isArray&&(this.arrLength=parseInt(this.name.slice(s+1,this.name.indexOf("]",s+1))),this.name=this.name.slice(0,s),this.typeName+="[]"),this.type=r.default.GetTypeByTypeNS(this.typeName),!(this.type<0)&&(this.isTex=this.type==r.default.SHADER_SAMPLER2D||this.type==r.default.SHADER_SAMPLERCUBE||this.type==r.default.SHADER_SAMPLER3D,!0)}}e.default=a},"79d6":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("9c3c")),a=i(s("402a")),n=i(s("32cc")),h=i(s("3930"));class o extends a.default{constructor(){super(),this.m_currMaterial=null,this.m_posarr=null,this.m_colorarr=null,this.m_ids=[0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7],this.m_cameraVersion=-1,this.m_camera=null}setRGB3f(t,e,s){this.m_currMaterial.setRGB3f(t,e,s)}createMaterial(){null==this.getMaterial()&&(this.m_currMaterial=new n.default(!1),this.setMaterial(this.m_currMaterial))}__activeMesh(t){if(null==this.getMesh()){let e=new r.default;e.vbWholeDataEnabled=!1,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.m_posarr,this.m_colorarr),this.setMesh(e)}}initiazlize(t,e=null,s=null,i=null,r=null){let a=t.getWordFrustumVtxArr();null==this.m_posarr&&(this.m_posarr=new Array(72)),null==this.m_colorarr&&(this.m_colorarr=new Array(72));let n=this.m_ids;null==e&&(e=new h.default(1,0,1,1)),null==s&&(s=new h.default(0,.5,1)),null==i&&(i=new h.default(0,.9,0)),null==r&&(r=new h.default(0,.9,.9));let o,l,_=[e,e,e,e,e,e,e,e,s,s,s,s,s,s,s,s,i,i,i,i,r,r,r,r],u=0;for(let h=0;h<n.length;h++)o=a[n[h]],l=_[h],this.m_posarr[u]=o.x,this.m_posarr[u+1]=o.y,this.m_posarr[u+2]=o.z,this.m_colorarr[u]=l.r,this.m_colorarr[u+1]=l.g,this.m_colorarr[u+2]=l.b,u+=3;this.createMaterial(),this.activeDisplay()}updateFrame(t){if(this.m_camera!=t&&(this.m_camera=t,this.m_cameraVersion=-1),null!=t&&this.m_cameraVersion!=t.version){this.m_cameraVersion=t.version;let e=this.getMesh();if(null!=e){let s,i=t.getWordFrustumVtxArr(),r=this.m_ids;for(let t=0;t<r.length;t++)s=i[r[t]],e.setVSXYZAt(t,s.x,s.y,s.z);return!0}}return!1}destroy(){this.m_camera=null}toString(){return"FrustrumFrame3DEntity(name="+this.name+",uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=o},"7a04":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("f044"));class a{constructor(){this.m_uid=-1,this.m_total=0,this.layoutBit=0,this.m_fOffsetList=null,this.m_f32List=null,this.m_f32SizeList=null,this.m_f32PreSizeList=null,this.m_f32ChangedList=null,this.m_f32Bufs=null,this.m_stepFloatsTotal=0,this.m_uid=r.default.CreateNewID()}getUid(){return this.m_uid}getType(){return 1}getBuffersTotal(){return this.m_f32List.length}getF32DataAt(t){return this.m_f32List[t]}setF32DataAt(t,e,s,i){null==this.m_f32List&&(this.m_f32List=[null,null,null,null,null,null,null,null],this.m_f32ChangedList=[!1,!1,!1,!1,!1,!1,!1,!1],this.m_f32SizeList=[0,0,0,0,0,0,0,0],this.m_f32PreSizeList=[0,0,0,0,0,0,0,0]),this.m_f32List[t]=e,null!=this.m_f32Bufs&&null!=e&&(this.m_f32ChangedList[t]=!0),null!=i&&(this.m_fOffsetList=i),this.m_stepFloatsTotal=s,null!=e&&(this.m_f32SizeList[t]=e.length)}setData4fAt(t,e,s,i,r,a){t*=this.m_fOffsetList[e],this.m_f32List[e][t++]=s,this.m_f32List[e][t++]=i,this.m_f32List[e][t++]=r,this.m_f32List[e][t++]=a}setData3fAt(t,e,s,i,r){t*=this.m_fOffsetList[e],this.m_f32List[e][t++]=s,this.m_f32List[e][t++]=i,this.m_f32List[e][t++]=r}setData2fAt(t,e,s,i){t*=this.m_fOffsetList[e],this.m_f32List[e][t++]=s,this.m_f32List[e][t++]=i}destroy(){this.m_f32List=null,this.m_f32ChangedList=null,this.m_f32SizeList=null,this.m_f32PreSizeList=null,this.m_f32List=null}toString(){return"VtxSeparatedBuf(uid = "+this.m_uid+")"}}e.default=a},"7b0e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("bbf4"));class a{constructor(){this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rayTestState=0,this.rpoNode=null,this.spaceId=-1,this.camVisiSt=0,this.camVisi=r.default.CAMERA_VISIBLE_ENABLE}reset(){this.rayTestState=0,this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rpoNode=null,this.spaceId=-1,this.camVisi=0}static GetFreeId(){return a.m_freeIdList.length>0?a.m_freeIdList.pop():-1}static GetByUid(t){return t>-1&&t<a.m_nodeListLen?a.m_nodeList[t]:null}static SetCamVisiByUid(t,e){a.m_nodeList[t].camVisi=e}static GetCamVisiByUid(t){return a.m_nodeList[t].camVisi}static Create(){let t=null,e=a.GetFreeId();return e>=0?(t=a.m_nodeList[e],t.uid=e,a.m_nodeFlagList[e]=a.S_FLAG_BUSY):(t=new a,a.m_nodeList.push(t),a.m_nodeFlagList.push(a.S_FLAG_BUSY),t.uid=a.m_nodeListLen,a.m_nodeListLen++),t}static Restore(t){null!=t&&t.uid>=0&&a.m_nodeFlagList[t.uid]==a.S_FLAG_BUSY&&(a.m_freeIdList.push(t.uid),a.m_nodeFlagList[t.uid]=a.S_FLAG_FREE,t.reset())}}a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.m_nodeListLen=0,a.m_nodeList=[],a.m_nodeFlagList=[],a.m_freeIdList=[],e.default=a},"7c63":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("e08e");class r{constructor(t,e,s,i){this.m_uid=-1,this.m_rBoo=!0,this.m_gBoo=!0,this.m_bBoo=!0,this.m_aBoo=!0,this.m_uid=r.s_uid++,this.m_rBoo=t,this.m_gBoo=e,this.m_bBoo=s,this.m_aBoo=i}getUid(){return this.m_uid}getR(){return this.m_rBoo}getG(){return this.m_gBoo}getB(){return this.m_bBoo}getA(){return this.m_aBoo}use(){r.s_state!=this.m_uid&&(r.Rstate.setColorMask(this.m_rBoo,this.m_gBoo,this.m_bBoo,this.m_aBoo),r.s_state=this.m_uid)}static Create(t,e,s,i,a){if(r.s_stsNameMap.has(t)){let e=r.s_stsNameMap.get(t);return e.getUid()}let n=(e?64:32)|(s?16:8)|(i?4:2)|(a?1:0);if(r.s_stsMap.has(n)){let t=r.s_stsMap.get(n);n=t.getUid()}else{let h=new r(e,s,i,a);n=h.getUid(),r.s_stsMap.set(n,h),r.s_stsNameMap.set(t,h),r.s_states.push(h),++r.s_statesLen}return n}static GetColorMaskByName(t){if(r.s_stsNameMap.has(t)){let e=r.s_stsNameMap.get(t);return e.getUid()}return-1}static UseRenderState(t){r.s_unlocked&&r.Rstate.roColorMask!=t&&t>-1&&t<r.s_statesLen&&r.s_states[t].use()}static UseColorMaskByName(t){let e=r.GetColorMaskByName(t);r.s_unlocked&&r.Rstate.roColorMask!=e&&e>-1&&e<r.s_statesLen&&r.s_states[e].use()}static Lock(){r.s_unlocked=!1}static Unlock(){r.s_unlocked=!0}static Reset(){r.s_state=-1}}r.s_uid=0,r.s_state=-1,r.s_states=[],r.s_statesLen=1,r.s_stsMap=new Map,r.s_stsNameMap=new Map,r.s_unlocked=!0,r.ALL_TRUE_COLOR_MASK=0,r.ALL_FALSE_COLOR_MASK=1,r.Rstate=null,e.RenderColorMask=r;class a{constructor(t,e,s){this.m_uid=-1,this.m_cullFaceMode=0,this.m_blendMode=0,this.m_depthTestMode=0,this.m_shadowMode=0,this.m_uid=a.s_uid++,this.m_cullFaceMode=t,this.m_blendMode=e,this.m_depthTestMode=s}getUid(){return this.m_uid}getCullFaceMode(){return this.m_cullFaceMode}getDepthTestMode(){return this.m_depthTestMode}getBlendMode(){return this.m_blendMode}use(){if(a.s_state!=this.m_uid){a.Rstate.setCullFaceMode(this.m_cullFaceMode);a.s_blendModes[a.m_blendMode];a.m_blendMode<0?a.Rstate.setBlendMode(this.m_blendMode,a.s_blendModes[this.m_blendMode]):a.Rstate.setBlendMode(a.m_blendMode,a.s_blendModes[a.m_blendMode]),a.s_depthTestMode<0?a.Rstate.setDepthTestMode(this.m_depthTestMode):a.Rstate.setDepthTestMode(a.s_depthTestMode),a.s_state=this.m_uid}}static CreateBlendModeSeparate(t,e,s,r,n,h=0,o=0){if(null!=t&&""!=t){let l;if(a.s_blendModeNameMap.has(t))return l=a.s_blendModeNameMap.get(t),a.s_blendModeIndexMap.get(l);h<1&&(h=i.GLBlendEquation.FUNC_ADD),o<1&&(o=i.GLBlendEquation.FUNC_ADD);let _=1;if(l=31,l=131*l+e,l=131*l+s,r>0&&n>0&&(l=131*l+r,l=131*l+n,_=1),a.s_blendModeIndexMap.has(l))return a.s_blendModeNameMap.set(t,l),a.s_blendModeIndexMap.get(l);let u=++a.s_blendModeIndex;a.s_blendModeNameMap.set(t,l),a.s_blendModeIndexMap.set(l,u);let m=[_,h,o,e,s,r,n];return a.s_blendModes[u]=m,u}return 0}static CreateBlendMode(t,e,s,r=0){if(null!=t&&""!=t){let n;if(a.s_blendModeNameMap.has(t))return n=a.s_blendModeNameMap.get(t),a.s_blendModeIndexMap.get(n);r<1&&(r=i.GLBlendEquation.FUNC_ADD);let h=0;if(n=31,n=131*n+e,n=131*n+s,a.s_blendModeIndexMap.has(n))return a.s_blendModeIndexMap.get(n);let o=++a.s_blendModeIndex;a.s_blendModeNameMap.set(t,n),a.s_blendModeIndexMap.set(n,o);let l=[h,r,0,e,s,0,0];return a.s_blendModes[o]=l,o}return 0}static Create(t,e,s,i){if(a.s_stsNameMap.has(t)){let e=a.s_stsNameMap.get(t);return e.getUid()}let r=31;if(r=131*r+i,r=131*r+s,r=131*r+e,a.s_stsMap.has(r)){let t=a.s_stsMap.get(r);r=t.getUid()}else{let n=new a(e,s,i);r=n.getUid(),a.s_stsMap.set(r,n),a.s_stsNameMap.set(t,n),a.s_states.push(n),++a.s_statesLen}return r}static GetRenderStateByName(t){if(a.s_stsNameMap.has(t)){let e=a.s_stsNameMap.get(t);return e.getUid()}return-1}static UseRenderState(t){a.s_unlocked&&a.s_state!=t&&t>-1&&t<a.s_statesLen&&a.s_states[t].use()}static UseRenderStateByName(t){if(a.s_unlocked){let e=a.GetRenderStateByName(t);a.s_state!=e&&e>-1&&e<a.s_statesLen&&a.s_states[e].use()}}static UnlockBlendMode(){a.m_blendMode=a.s_preBlendMode}static LockBlendMode(t){a.s_preBlendMode=a.m_blendMode,a.m_blendMode=t}static UnlockDepthTestMode(){a.s_depthTestMode=a.s_preDepthTestMode}static LockDepthTestMode(t){a.s_preDepthTestMode=a.s_depthTestMode,a.s_depthTestMode=t}static Lock(){a.s_unlocked=!1}static Unlock(){a.s_unlocked=!0}static Reset(){a.s_state=-1}}a.s_uid=0,a.s_state=-1,a.s_states=[],a.s_statesLen=1,a.m_blendMode=-1,a.s_depthTestMode=-1,a.s_stsMap=new Map,a.s_stsNameMap=new Map,a.s_blendModeNameMap=new Map,a.s_blendModeIndexMap=new Map,a.s_blendModeIndex=0,a.s_blendModes=new Array(256),a.s_unlocked=!0,a.Rstate=null,a.s_preBlendMode=-1,a.s_preDepthTestMode=-1,e.RenderStateObject=a;class n{constructor(){this.stencilMask=-1}}class h{constructor(){this.m_units=new Array(128),this.m_unit=null,this.m_blendMode=i.RenderBlendMode.NORMAL,this.m_cullMode=i.CullFaceMode.NONE,this.m_depthTestType=i.DepthTestMode.DISABLE,this.m_cullDisabled=!0,this.m_context=null,this.m_gl=null,this.roColorMask=-11}reset(){this.roColorMask=-11}setRenderContext(t){this.m_context=t,this.m_gl=t.getRC();let e=this.m_gl.rcuid;this.m_unit=this.m_units[e],null==this.m_unit&&(this.m_unit=this.m_units[e]=new n)}setColorMask(t,e,s,i){this.m_gl.colorMask(t,e,s,i)}setStencilFunc(t,e,s){this.m_gl.stencilFunc(t,e,s)}setStencilMask(t){this.m_unit.stencilMask!=t&&t>=0&&(this.m_unit.stencilMask=t,this.m_gl.stencilMask(t))}setStencilOp(t,e,s){this.m_gl.stencilOp(t,e,s)}setDepthTestEnable(t){t?this.m_gl.enable(this.m_gl.DEPTH_TEST):this.m_gl.disable(this.m_gl.DEPTH_TEST)}setCullFaceEnable(t){t?this.m_gl.enable(this.m_gl.CULL_FACE):this.m_gl.disable(this.m_gl.CULL_FACE)}setBlendEnable(t){t?this.m_gl.enable(this.m_gl.BLEND):this.m_gl.disable(this.m_gl.BLEND)}setCullFaceMode(t){this.m_cullMode!=t&&(this.m_cullMode=t,t!=i.CullFaceMode.NONE?(this.m_cullDisabled&&(this.m_cullDisabled=!1,this.m_gl.enable(this.m_gl.CULL_FACE)),this.m_gl.cullFace(t)):this.m_cullDisabled||(this.m_cullDisabled=!0,this.m_gl.disable(this.m_gl.CULL_FACE)))}setBlendMode(t,e){this.m_blendMode!=t&&(this.m_blendMode=t,t>0?e[0]<1?(this.m_gl.blendEquation(this.m_gl.FUNC_ADD),this.m_gl.blendFunc(this.m_gl.ONE,this.m_gl.ZERO),this.m_gl.blendEquation(e[1]),this.m_gl.blendFunc(e[3],e[4])):(this.m_gl.blendEquationSeparate(e[1],e[2]),this.m_gl.blendFuncSeparate(e[3],e[4],e[5],e[6])):this.m_gl.disable(this.m_gl.BLEND))}setDepthTestMode(t){if(this.m_depthTestType!=t)switch(this.m_depthTestType=t,t){case i.DepthTestMode.ALWAYS:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.ALWAYS);break;case i.DepthTestMode.SKY:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.LEQUAL);break;case i.DepthTestMode.OPAQUE:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.LESS);break;case i.DepthTestMode.OPAQUE_OVERHEAD:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.EQUAL);break;case i.DepthTestMode.DECALS:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.LEQUAL);break;case i.DepthTestMode.BLEND:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.LESS);break;case i.DepthTestMode.WIRE_FRAME:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.LEQUAL);break;case i.DepthTestMode.NEXT_LAYER:this.m_gl.depthMask(!1),this.m_gl.depthFunc(this.m_gl.ALWAYS);break;case i.DepthTestMode.TRUE_EQUAL:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.EQUAL);break;case i.DepthTestMode.TRUE_GREATER:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.GREATER);break;case i.DepthTestMode.TRUE_GEQUAL:this.m_gl.depthMask(!0),this.m_gl.depthFunc(this.m_gl.GEQUAL);break;case i.DepthTestMode.WIRE_FRAME_NEXT:break;default:break}}}e.RODrawState=h},"81c4":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("f48d")),n=i(s("d1a0"));class h extends a.default{constructor(){super(...arguments),this.radiusSquared=2500,this.tv=new r.default(1,0,0),this.center=new r.default(50,0,0),this.anotherPosition=new r.default(100,0,0),this.length=100}intersectionCopSLV2(t,e,s){r.default.Cross(this.tv,e,a.default.__tV1),r.default.Cross(this.tv,a.default.__tV1,a.default.__tV2),a.default.__tV2.normalize(),n.default.IntersectionSLV2(a.default.__tV2,a.default.__tV2.dot(this.position),t,e,s),a.default.__tV2.x=s.x-this.position.x,a.default.__tV2.y=s.y-this.position.y,a.default.__tV2.z=s.z-this.position.z;let i=a.default.__tV2.dot(this.tv);i<0?s.copyFrom(this.position):i>this.length&&s.copyFrom(this.anotherPosition)}update(){this.tv.x=this.anotherPosition.x-this.position.x,this.tv.y=this.anotherPosition.y-this.position.y,this.tv.z=this.anotherPosition.z-this.position.z,this.length=this.tv.getLength(),this.tv.x*=.5,this.tv.y*=.5,this.tv.z*=.5,this.center.x=this.position.x+this.tv.x,this.center.y=this.position.y+this.tv.y,this.center.z=this.position.z+this.tv.z,this.radiusSquared=this.tv.getLengthSquared(),this.tv.normalize()}updateFast(){this.update()}}e.default=h},"81ce":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Es2VtxShderToES3(t){let e=t;const s="attribute",i="varying ";let r=e.indexOf(s),a=0;while(r>=0)e=e.slice(0,r)+"layout(location="+a+") in"+e.slice(r+9),r=e.indexOf(s),a++;let n=new RegExp(i,"g");return e=e.replace(n,"out "),"#version 300 es\n"+e}static Es2FragShderToES3(t){let e=t;const s="gl_FragColor",i="varying ";let r=e.indexOf(s),a=0,n="FragColorOut_"+a;r>=0&&(e=e.slice(0,r)+n+e.slice(r+12)),r=e.indexOf("void "),e=e.slice(0,r)+"out vec4 "+n+";\n"+e.slice(r);let h=new RegExp(i,"g");return e=e.replace(h,"in "),h=new RegExp(" texture2D","g"),e=e.replace(h," texture"),h=new RegExp(" textureCube","g"),e=e.replace(h," texture"),"#version 300 es\n"+e}static Es3VtxShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const s=/\blayout\b.+\bin\b/g;t=t.replace(s,"attribute");const r=/\bout\b/g;t=t.replace(r,"varying");const a=/\btexture\b/g;t=t.replace(a,"texture2D"),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version"));let n=0,h=0,o=t.indexOf("inverse(");o<0&&(o=t.indexOf("inverse ("));let l="",_=!1,u=!1;while(o>3){if(n=t.indexOf(")",o+2),l=t.slice(o+2,n),l.indexOf("mat3")>0)_=!0;else if(l=l.replace(/\s+/g,""),n=l.indexOf("("),l=l.slice(n+1),n=t.indexOf(l,1),h=t.lastIndexOf("mat",n),h>0)switch(l=t.slice(h,n),l=l.replace(/\s+/g,""),l){case"mat3":_=!0;break;case"mat4":u=!0;break}if(o=t.indexOf("inverse(",o+5),o<0&&(o=t.indexOf("inverse (",o+5)),_&&u)break}n=0,o=t.indexOf("transpose("),o<0&&(o=t.indexOf("transpose (")),l="";let m=!1,d=!1;while(o>3){if(n=t.indexOf(")",o+2),l=t.slice(o+2,n+1),l.indexOf("mat3")>0)m=!0;else if(l=l.replace(/\s+/g,""),n=l.indexOf("("),l=l.slice(n+1),n=t.indexOf(l,1),h=t.lastIndexOf("mat",n),h>0)switch(l=t.slice(h,n),l=l.replace(/\s+/g,""),l){case"mat3":m=!0;break;case"mat4":d=!0;break}if(o=t.indexOf("transpose(",o+5),o<0&&(o=t.indexOf("transpose (",o+5)),m&&d)break}return(_||u)&&(o=t.indexOf("void "),o>10&&(_&&u?t=t.slice(0,o)+i.__glslInverseMat3+i.__glslInverseMat4+t.slice(o):_?t=t.slice(0,o)+i.__glslInverseMat3+t.slice(o):u&&(t=t.slice(0,o)+i.__glslInverseMat4+t.slice(o)))),(m||d)&&(o=t.indexOf("void "),o>10&&(m&&d?t=t.slice(0,o)+i.__glslTransposeMat3+i.__glslTransposeMat4+t.slice(o):m?t=t.slice(0,o)+i.__glslTransposeMat3+t.slice(o):d&&(t=t.slice(0,o)+i.__glslTransposeMat4+t.slice(o)))),t}static Es3FragShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const s=new RegExp(" in ","g");t=t.replace(s,"_fref_");const i=/\bin\b/g;t=t.replace(i,"varying");const r=new RegExp("_fref_","g");t=t.replace(r," in ");const a=/\btexture\b/g;t=t.replace(a,"texture2D");const n=/" "/g;let h=t;const o=";",l="layout";let _=h.indexOf(l),u=0,m=0,d="",c="",f=0,p=null,g=[],v=[];while(_>=0)u=h.indexOf(o,_+1),d=h.slice(_+1,u),c=d.slice(d.lastIndexOf(" ")+1),f=d.indexOf(")"),_=d.lastIndexOf("=",f)+1,d=d.slice(_+1,f),f=parseInt(d.replace(n,"")),g.push(c),v.push(f),_=h.indexOf(l,u);let x=g.length;if(x>0)if(p=/layout/g,t=t.replace(p,"//layout"),x>1){_=0;while(_<x)p=new RegExp(g[_],"g"),t=t.replace(p,"gl_FragData["+v[_]+"]"),++_}else p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor");else _=h.indexOf("out "),_>0&&(u=h.indexOf(o,_+1),d=h.slice(_+1,u),c=d.slice(d.lastIndexOf(" ")+1),p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor"),p=/\bout\b/g,t=t.replace(p,"//out"));x>1&&(t="#extension GL_EXT_draw_buffers: require\n"+t),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version")),_=0;for(let y=0;y<16;++y){if(_=t.indexOf("samplerCube ",_),!(_>0))break;{u=t.indexOf(";",_),d=h.slice(_+12,u),c="";let e=d.split(" ");for(let t=0;t<16;++t)if(""!=e[t]){c=e[t];break}for(x=0;x<16;++x){if(u=t.indexOf(c,u+1),!(u>0))break;if(m=t.lastIndexOf("texture2D",u-1),m<0)break;d=t.slice(m,u),t=t.slice(0,m)+"textureCube("+t.slice(u),u+=2}}_+=4}return t}}i.__glslTransposeMat3="\n    mat3 transpose(mat3 m) {\n        return mat3(m[0][0],m[1][0],m[2][0],\n            m[0][1],m[1][1],m[2][1],\n            m[0][2],m[1][2],m[2][2]);\n    }\n    ",i.__glslTransposeMat4="\n    mat4 transpose(mat4 m) {\n        return mat4(m[0][0],m[1][0],m[2][0],m[3][0],\n            m[0][1],m[1][1],m[2][1],m[3][1],\n            m[0][2],m[1][2],m[2][2],m[3][2],\n            m[0][3],m[1][3],m[2][3],m[3][3]);\n    }\n    ",i.__glslInverseMat3="\n    mat3 inverse(mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];  \n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;  \n        float det = a00 * b01 + a01 * b11 + a02 * b21;  \n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n    ",i.__glslInverseMat4="\n    mat4 inverse(mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n        }\n    ",e.default=i},"829f":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("cfaf")),a=i(s("bd6f")),n=i(s("6661")),h=i(s("29ef")),o=i(s("85b6")),l=i(s("baae"));class _{constructor(t,e=2){if(this.m_blurMode=2,this.m_renderer=null,this.m_plane0=null,this.m_plane1=null,this.m_hMaterial=null,this.m_vMaterial=null,this.m_texs=[null,null],this.m_wrapperTexs=null,this.m_backbufferVisible=!1,this.m_blurCount=6,this.m_blurDensity=2,this.m_srcProcessId=-1,this.m_syncViewSizeEnabled=!0,this.m_fboWidth=0,this.m_fboHeight=0,this.m_drawEntity=null,this.m_renderer=t,e>=0&&e<3&&(this.m_blurMode=e),null==this.m_wrapperTexs){this.m_wrapperTexs=[null,null];let t=new o.default(32,32,!0);t.__$setRenderProxy(this.m_renderer.getRenderProxy());let e=new o.default(32,32,!0);e.__$setRenderProxy(this.m_renderer.getRenderProxy()),this.m_wrapperTexs[0]=t,this.m_wrapperTexs[1]=e,this.m_texs=[new r.default(32,32),new r.default(32,32)],t.attachTex(this.m_texs[0]),e.attachTex(this.m_texs[1])}}bindSrcProcessId(t){this.m_srcProcessId=t}bindSrcProcess(t){this.m_srcProcessId=t.getRPIndex()}bindDrawEntity(t){this.m_drawEntity=t}setBackbufferVisible(t){this.m_backbufferVisible=t}setSyncViewSizeEnabled(t){this.m_syncViewSizeEnabled=t}setBlurCount(t){t<1&&(t=1),this.m_blurCount=t}setBlurDensity(t){this.m_blurDensity=t}setFBOSize(t,e){(Math.abs(this.m_fboWidth-t)>.1||Math.abs(this.m_fboHeight-e))&&(this.m_fboWidth=t,this.m_fboHeight=e,this.m_syncViewSizeEnabled=!1,null!=this.m_texs[0]&&this.m_texs[0].setSize(t,e),null!=this.m_texs[1]&&this.m_texs[1].setSize(t,e))}getDstTexture(){return this.getTextureAt(this.m_blurCount%2)}swapTextureAt(t,e){t>0&&t<2&&null!=e&&e!=this.m_texs[t]&&(this.m_texs[t]=e,this.m_wrapperTexs[t].attachTex(e))}getTextureAt(t){return null!=this.m_texs[t]?(this.m_fboWidth*this.m_fboHeight>0?this.m_texs[t].setSize(this.m_fboWidth,this.m_fboHeight):this.m_texs[t].setSize(this.m_renderer.getViewWidth(),this.m_renderer.getViewHeight()),this.m_texs[t]):null}updateState(t){if(null==this.m_plane0){let t=0,e=1;switch(this.m_blurMode){case _.HORIZONTAL:e=0;break;case _.VERTICAL:t=1;break;default:break}this.m_vMaterial=new n.default(e),this.m_vMaterial.setBlurDensity(this.m_blurDensity);let s=new a.default;s.setMaterial(this.m_vMaterial),s.initializeXOY(-1,-1,2,2,[this.m_wrapperTexs[0]]),s.setRenderState(h.default.BACK_NORMAL_ALWAYS_STATE),this.m_plane0=s,this.m_hMaterial=new n.default(t),this.m_hMaterial.setBlurDensity(this.m_blurDensity),s=new a.default,s.setMaterial(this.m_hMaterial),s.copyMeshFrom(this.m_plane0),s.initializeXOY(-1,-1,2,2,[this.m_wrapperTexs[1]]),s.setRenderState(h.default.BACK_NORMAL_ALWAYS_STATE),this.m_plane1=s}let e=t.getFBOFitWidth(),s=t.getFBOFitHeight();this.m_fboWidth*this.m_fboHeight>0&&(e=this.m_fboWidth,s=this.m_fboHeight),this.m_vMaterial.setTexSize(e,s),this.m_hMaterial.setTexSize(e,s)}run(t=-1){let e=this.m_renderer.getRenderProxy(),s=e.getRenderAdapter();this.m_syncViewSizeEnabled?s.synFBOSizeWithViewport():s.asynFBOSizeWithViewport(),t<0&&(t=this.m_srcProcessId),this.updateState(s),s.setRenderToTexture(this.getTextureAt(0),!0,!1,0),s.useFBO(!0,!0,!1),null!=this.m_drawEntity&&this.m_renderer.drawEntity(this.m_drawEntity),t>=0&&this.m_renderer.runAt(t);let i=0;for(;i<this.m_blurCount;++i)s.setRenderToTexture(this.getTextureAt(1-i%2),!0,!1,0),s.useFBO(!0,!0,!1),i%2==0?this.m_renderer.drawEntity(this.m_plane0):this.m_renderer.drawEntity(this.m_plane1);this.m_backbufferVisible&&(s.setRenderToBackBuffer(l.default.FRAMEBUFFER),e.unlockRenderState(),i%2==0?this.m_renderer.drawEntity(this.m_plane0):this.m_renderer.drawEntity(this.m_plane1))}destroy(){null!=this.m_renderer&&(this.m_renderer.removeEntity(this.m_plane0),this.m_renderer.removeEntity(this.m_plane1),this.m_plane0.destroy(),this.m_plane1.destroy(),this.m_plane0=null,this.m_plane1=null,this.m_hMaterial=null,this.m_vMaterial=null,this.m_texs[0]=null,this.m_texs[1]=null,this.m_renderer=null)}}_.HORIZONTAL=0,_.VERTICAL=1,_.DEFALUT=2,e.default=_},8333:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.COLOR_BUFFER_BIT=131,i.DEPTH_BUFFER_BIT=132,i.STENCIL_BUFFER_BIT=133,e.default=i},"83d1":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279"));class n{create(t,e){let s=null,i=r.default.StageParam;return e.hasUniformByName(i.name)&&(s=new a.default,s.uns=i.name,s.uniformNameList=[i.name],s.copyDataFromProbe(t.getStage3D().uProbe)),s}getIDNS(){return"StageParamUniformBuilder"}}e.default=n},"845e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("ecf9")),n=i(s("6ee0")),h=i(s("51f0"));class o{static SendDataToWorkerAt(t,e){t>=0&&t<o.s_maxThreadsTotal&&(t>=o.s_threadsTotal&&o.CreateThread(),null!=e&&e.sendStatus<0&&(e.sendStatus=0,o.s_threads[t].isFree()?o.s_threads[t].sendDataTo(e):(o.s_specList.push(e),o.s_specIndices.push(t))))}static HasData(){return o.s_pool.isEnabled()}static Run(){if(o.GetThreadEnabled()){let t=o.s_specList,e=t.length,s=o.s_threadsTotal,i=0;for(;i<e;++i){let r=o.s_specIndices[i];if(o.s_threads[r].isFree()&&(o.s_threads[r].sendDataTo(t[i]),t.splice(i,1),o.s_specIndices.splice(i,1),i--,e--,s--),s<1)break}if(o.s_pool.isEnabled()){for(e=0,i=0;i<o.s_threadsTotal;++i)o.s_pool.isEnabled()&&(o.s_threads[i].isFree()&&o.s_pool.sendDataTo(o.s_threads[i]),o.s_threads[i].isFree()&&++e);e<1&&o.s_pool.isEnabled()&&o.CreateThread()}}}static AddData(t){null!=t&&t.srcuid>=0&&o.s_pool.addData(t)}static LockThreadAt(t){o.s_threads[t].unlock=!1}static UnlockThreadAt(t){o.s_threads[t].unlock=!0}static GetAFreeThread(){for(let t=0;t<o.s_threadsTotal;++t)if(o.s_threads[t].isFree())return o.s_threads[t];return null}static GetMaxThreadsTotal(){return o.s_maxThreadsTotal}static SetThreadEnabled(t){o.s_thrSupportFlag>0&&(o.s_thrSupportFlag=t?2:1),r.default.SetThreadEnabled(t)}static GetThreadEnabled(){return r.default.GetThreadEnabled()}static IsSupported(){if(o.s_thrSupportFlag>0)return 2==o.s_thrSupportFlag;let t="undefined"!==typeof Worker&&"undefined"!==typeof Blob;return o.s_thrSupportFlag=t?2:1,r.default.SetThreadEnabled(t),t}static CreateThread(){if(o.s_threadsTotal<o.s_maxThreadsTotal){let t,e=new h.default;e.pool=o.s_pool,e.initialize(o.s_codeBlob),o.s_threads[o.s_threadsTotal]=e,o.s_threadsTotal++;for(let s=0,i=o.s_tasks.length;s<i;++s)if(t=o.s_tasks[s],null!=t)switch(t.type){case 0:e.initTaskByURL(t.taskName,t.taskclass,t.moduleName);break;case 2:e.initTaskByCodeStr(t.srccode,t.taskclass,t.moduleName);break;default:break}}}static InitTaskByURL(t,e,s=""){if(""!=t&&e>=0&&e<o.s_tasks.length){let i=o.s_tasks[e];if(null==i){i={taskName:t,taskclass:e,type:0,threads:[],moduleName:s},o.s_tasks[e]=i;for(let i=0;i<o.s_threadsTotal;++i)o.s_threads[i].initTaskByURL(t,e,s)}}}static InitTaskByCodeStr(t,e,s=""){if(""!=t&&e>=0&&e<o.s_tasks.length){let i=o.s_tasks[e];if(null==i){i={srccode:t,type:2,taskclass:e,threads:[],moduleName:s},o.s_tasks[e]=i;for(let i=0;i<o.s_threadsTotal;++i)o.s_threads[i].initTaskByCodeStr(t,e,s)}}}static Initialize(t,e=""){if(o.s_initBoo){if(o.GetThreadEnabled()&&o.IsSupported()){let s=new Blob([e+a.default.CodeStr]);t<1&&(t=1),o.s_codeBlob=s,o.s_maxThreadsTotal=t,o.CreateThread()}o.s_initBoo=!1}}}o.s_initBoo=!0,o.s_maxThreadsTotal=0,o.s_thrSupportFlag=-1,o.s_codeBlob=null,o.s_tasks=[null,null,null,null,null,null,null,null],o.s_threads=[null,null,null,null,null,null,null,null],o.s_threadsTotal=0,o.s_pool=new n.default,o.s_specList=[],o.s_specIndices=[],e.default=o},"857b":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279"));class n{create(t,e){let s=null,i=r.default.CameraPosParam;return e.hasUniformByName(i.name)&&(s=new a.default,s.uns=i.name,s.uniformNameList=[i.name],s.copyDataFromProbe(t.getCamera().ucameraPosProbe)),s}getIDNS(){return"CameraPosUniformBuilder"}}e.default=n},"85b6":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class n extends a.default{constructor(t,e,s=!1){super(t,e,s),this.m_tex=null,this.m_type=r.TextureProxyType.Wrapper}getResUid(){return this.m_tex.getResUid()}getBufWidth(){return this.m_tex.getBufWidth()}getBufHeight(){return this.m_tex.getBufHeight()}getWidth(){return this.m_tex.getWidth()}getHeight(){return this.m_tex.getHeight()}isDirect(){return!1}attachTex(t){null!=t&&t!=this&&(this.m_tex!=t&&t.__$attachThis(),this.m_tex=t)}detachTex(){null!=this.m_tex&&this.m_tex.__$detachThis(),this.m_tex=null}__$attachThis(){super.__$attachThis(),null!=this.m_tex&&this.m_tex.__$attachThis()}__$detachThis(){super.__$detachThis(),null!=this.m_tex&&this.m_tex.__$detachThis()}__$$use(t){this.m_tex.__$$use(t)}isGpuEnabled(){return this.m_tex.isGpuEnabled()}getSampler(){return this.m_tex.getSampler()}__$updateToGpu(t){this.m_tex.__$updateToGpu(t)}__$$upload(t){this.m_tex.__$$upload(t)}__$destroy(){this.getAttachCount()<1&&(null!=this.m_tex&&this.m_tex.__$detachThis(),this.m_tex=null,super.__$destroy())}isDataEnough(){return this.m_tex.isDataEnough()}getTargetType(){return this.m_tex.getTargetType()}toString(){return"[WrapperTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},8875:function(t,e,s){var i,r,a;(function(s,n){r=[],i=n,a="function"===typeof i?i.apply(e,r):i,void 0===a||(t.exports=a)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(d){var s,i,r,a=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,n=/@([^@]*):(\d+):(\d+)\s*$/gi,h=a.exec(d.stack)||n.exec(d.stack),o=h&&h[1]||!1,l=h&&h[2]||!1,_=document.location.href.replace(document.location.hash,""),u=document.getElementsByTagName("script");o===_&&(s=document.documentElement.outerHTML,i=new RegExp("(?:[^\\n]+?\\n){0,"+(l-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=s.replace(i,"$1").trim());for(var m=0;m<u.length;m++){if("interactive"===u[m].readyState)return u[m];if(u[m].src===o)return u[m];if(o===_&&u[m].innerHTML&&u[m].innerHTML.trim()===r)return u[m]}return null}}return t}))},"899a":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}static Reset(){i.Flag_0=0}}i.Flag_0=0,e.default=i},"8a0a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ca6c"));class a{static ToGL(t,e){switch(e){case a.VTX_STATIC_DRAW:return t.STATIC_DRAW;case a.VTX_DYNAMIC_DRAW:return t.DYNAMIC_DRAW;case a.VTX_STREAM_DRAW:return t.STREAM_DRAW;case a.VTX_STATIC_READ:return t.STATIC_READ;case a.VTX_DYNAMIC_READ:return t.DYNAMIC_READ;case a.VTX_STREAM_READ:return t.STREAM_READ;case a.VTX_STATIC_COPY:return t.STATIC_COPY;case a.VTX_DYNAMIC_COPY:return t.DYNAMIC_COPY;case a.VTX_STREAM_COPY:return t.STREAM_COPY;default:break}return t.STATIC_DRAW}static GetVBufTypeByNS(t){switch(t){case a.VBUF_VS_NS:return a.VBUF_VS;case a.VBUF_UVS_NS:return a.VBUF_UVS;case a.VBUF_NVS_NS:return a.VBUF_NVS;case a.VBUF_CVS_NS:return a.VBUF_CVS;case a.VBUF_VS2_NS:return a.VBUF_VS2;case a.VBUF_UVS2_NS:return a.VBUF_UVS2;case a.VBUF_NVS2_NS:return a.VBUF_NVS2;case a.VBUF_CVS2_NS:return a.VBUF_CVS2;case a.VBUF_TVS_NS:return a.VBUF_TVS;case a.VBUF_TVS2_NS:return a.VBUF_TVS2;default:}return-1}static GetVBufNSByType(t){switch(t){case a.VBUF_VS:return a.VBUF_VS_NS;case a.VBUF_UVS:return a.VBUF_UVS_NS;case a.VBUF_NVS:return a.VBUF_NVS_NS;case a.VBUF_CVS:return a.VBUF_CVS_NS;case a.VBUF_VS2:return a.VBUF_VS2_NS;case a.VBUF_UVS2:return a.VBUF_UVS2_NS;case a.VBUF_NVS2:return a.VBUF_NVS2_NS;case a.VBUF_CVS2:return a.VBUF_CVS2_NS;case a.VBUF_TVS:return a.VBUF_TVS_NS;case a.VBUF_TVS2:return a.VBUF_TVS2_NS;default:}return""}static GetVBufAttributeTypeByNS(t){return a.GetVBufTypeByNS(t)-3e3}}a.VTXTYPE_GL_POINTS=101,a.VTXTYPE_GL_LINES=102,a.VTXTYPE_GL_LINE_STRIP=103,a.VTXTYPE_GL_TRIANGLES=111,a.VTX_STATIC_DRAW=0,a.VTX_DYNAMIC_DRAW=1,a.VTX_STREAM_DRAW=2,a.VTX_STATIC_READ=3,a.VTX_DYNAMIC_READ=4,a.VTX_STREAM_READ=5,a.VTX_STATIC_COPY=6,a.VTX_DYNAMIC_COPY=7,a.VTX_STREAM_COPY=8,a.VBUF_VS=3001,a.VBUF_UVS=3002,a.VBUF_NVS=3003,a.VBUF_CVS=3004,a.VBUF_TVS=3005,a.VBUF_VS2=3006,a.VBUF_UVS2=3007,a.VBUF_NVS2=3008,a.VBUF_CVS2=3009,a.VBUF_TVS2=3010,a.VBUF_VS_INDEX=r.default.BIT_ONE_0,a.VBUF_UVS_INDEX=r.default.BIT_ONE_1,a.VBUF_NVS_INDEX=r.default.BIT_ONE_2,a.VBUF_CVS_INDEX=r.default.BIT_ONE_3,a.VBUF_TVS_INDEX=r.default.BIT_ONE_4,a.VBUF_VS2_INDEX=r.default.BIT_ONE_5,a.VBUF_UVS2_INDEX=r.default.BIT_ONE_6,a.VBUF_NVS2_INDEX=r.default.BIT_ONE_7,a.VBUF_CVS2_INDEX=r.default.BIT_ONE_8,a.VBUF_TVS2_INDEX=r.default.BIT_ONE_9,a.VBUF_VS_NS="a_vs",a.VBUF_VS2_NS="a_vs2",a.VBUF_UVS_NS="a_uvs",a.VBUF_UVS2_NS="a_uvs2",a.VBUF_NVS_NS="a_nvs",a.VBUF_NVS2_NS="a_nvs2",a.VBUF_CVS_NS="a_cvs",a.VBUF_CVS2_NS="a_cvs2",a.VBUF_TVS_NS="a_tvs",a.VBUF_TVS2_NS="a_tvs2";class n{}n.FLAT=210,n.GOURAND=310,e.VtxNormalType=n,e.default=a},"8d98":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("030e"));class n{static ToGL(t,e){switch(e){case n.RGBA:break;case n.R8:return t.R8;case n.RGB:return t.RGB;case n.RGB8:return t.RGB8;case n.RGBA8:return t.RGBA8;case n.ALPHA:return t.ALPHA;case n.RGB16F:return r.default.IsWebGL2()?t.RGB16F:t.RGB;case n.RGBA16F:return r.default.IsWebGL2()?t.RGBA16F:t.RGBA;case n.RGB32F:return r.default.IsWebGL2()&&t.RGB32F,t.RGB;case n.RGBA32F:return r.default.IsWebGL2()&&t.RGBA32F,t.RGBA;case n.RED:return t.RED;case n.DEPTH_COMPONENT:return t.DEPTH_COMPONENT;case n.DEPTH_STENCIL:return t.DEPTH_STENCIL;default:break}return t.RGBA}}n.R8=101,n.RGB=110,n.RED=111,n.RGBA=121,n.RGB8=122,n.RGBA8=123,n.ALPHA=132,n.RGB16F=331,n.RGBA16F=332,n.RGB32F=341,n.RGBA32F=342,n.DEPTH_COMPONENT=351,n.DEPTH_STENCIL=352,e.TextureFormat=n;class h{static ToGL(t,e){switch(e){case h.UNSIGNED_BYTE:return t.UNSIGNED_BYTE;case h.BYTE:return t.BYTE;case h.FLOAT:return t.FLOAT;case h.HALF_FLOAT:return t.HALF_FLOAT;case h.HALF_FLOAT_OES:return null!=a.default.OES_texture_half_float?a.default.OES_texture_half_float.HALF_FLOAT_OES:t.FLOAT;case h.UNSIGNED_SHORT:return t.UNSIGNED_SHORT;case h.UNSIGNED_INT:return t.UNSIGNED_INT;case h.UNSIGNED_SHORT_5_6_5:return t.UNSIGNED_SHORT_5_6_5;case h.UNSIGNED_SHORT_4_4_4_4:return t.UNSIGNED_SHORT_4_4_4_4;case h.UNSIGNED_SHORT_5_5_5_1:return t.UNSIGNED_SHORT_5_5_5_1;case h.UNSIGNED_INT_24_8_WEBGL:return a.default.WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL;default:break}return t.UNSIGNED_BYTE}}h.UNSIGNED_BYTE=1108,h.UNSIGNED_SHORT=1109,h.UNSIGNED_INT=1110,h.BYTE=1111,h.FLOAT=1211,h.HALF_FLOAT=1212,h.HALF_FLOAT_OES=1213,h.UNSIGNED_SHORT_5_6_5=1214,h.UNSIGNED_SHORT_4_4_4_4=1215,h.UNSIGNED_SHORT_5_5_5_1=1216,h.UNSIGNED_INT_24_8_WEBGL=1217,e.TextureDataType=h;class o{static GetValue(t,e){switch(e){case o.TEXTURE_2D:return t.TEXTURE_2D;case o.TEXTURE_2D_ARRAY:return t.TEXTURE_2D_ARRAY;case o.TEXTURE_CUBE:return t.TEXTURE_CUBE_MAP;case o.TEXTURE_3D:return t.TEXTURE_3D;default:break}return t.TEXTURE_2D}}o.TEXTURE_2D=20,o.TEXTURE_2D_ARRAY=22,o.TEXTURE_SHADOW_2D=23,o.TEXTURE_CUBE=25,o.TEXTURE_3D=30,e.TextureTarget=o,function(t){t[t["Default"]=0]="Default",t[t["Depth"]=1]="Depth",t[t["Wrapper"]=2]="Wrapper",t[t["RTT"]=3]="RTT",t[t["Image"]=4]="Image",t[t["Float"]=5]="Float",t[t["Uint16"]=6]="Uint16",t[t["FloatCube"]=7]="FloatCube",t[t["Bytes"]=8]="Bytes",t[t["BytesCube"]=9]="BytesCube",t[t["ImageCube"]=10]="ImageCube",t[t["Texture3D"]=11]="Texture3D"}(e.TextureProxyType||(e.TextureProxyType={}));class l{static GetConst(t,e){switch(e){case l.NEAREST:return t.NEAREST;case l.LINEAR:return t.LINEAR;case l.LINEAR_MIPMAP_LINEAR:return t.LINEAR_MIPMAP_LINEAR;case l.NEAREST_MIPMAP_NEAREST:return t.NEAREST_MIPMAP_NEAREST;case l.LINEAR_MIPMAP_NEAREST:return t.LINEAR_MIPMAP_NEAREST;case l.NEAREST_MIPMAP_LINEAR:return t.NEAREST_MIPMAP_LINEAR;case l.WRAP_REPEAT:return t.REPEAT;case l.WRAP_CLAMP_TO_EDGE:return t.CLAMP_TO_EDGE;case l.WRAP_MIRRORED_REPEAT:return t.MIRRORED_REPEAT;default:break}return-1}}l.WRAP_REPEAT=3001,l.WRAP_CLAMP_TO_EDGE=3002,l.WRAP_MIRRORED_REPEAT=3003,l.NEAREST=4001,l.LINEAR=4002,l.LINEAR_MIPMAP_LINEAR=4003,l.NEAREST_MIPMAP_NEAREST=4004,l.LINEAR_MIPMAP_NEAREST=4005,l.NEAREST_MIPMAP_LINEAR=4006,e.TextureConst=l},"8def":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("919c"));class a extends r.default{constructor(){super(),this.shdp=null,this.vbufs=null,this.vbuf=null,this.attribTypes=null,this.wholeOffsetList=null,this.attribTypesLen=0,this.updateUnlocked=!0,this.wholeStride=0,this.m_uid=a.s_uid++}run(){this.m_rc.testVROUid(this.m_uid)&&(null!=this.vbuf?this.m_rc.useVtxAttribsPtrTypeFloat(this.shdp,this.vbuf,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride):this.m_rc.useVtxAttribsPtrTypeFloatMulti(this.shdp,this.vbufs,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride),this.m_rc.testRIOUid(this.m_vtxUid)&&this.m_rc.bindEleBuf(this.ibuf))}__$destroy(){r.default.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.m_rc=null,this.shdp=null,this.vbufs=null,this.vbuf=null,this.ibuf=null,this.attribTypes=null,this.attribTypesLen=0,this.wholeStride=0}restoreThis(){a.Restore(this)}toString(){return"VertexRenderObj(uid = "+this.m_uid+", type="+this.m_mid+")"}static HasMid(t){return r.default.s_midMap.has(t)}static GetByMid(t){return r.default.s_midMap.get(t)}static GetFreeId(){return a.s_freeIdList.length>0?a.s_freeIdList.pop():-1}static Create(t,e,s){let i=null,n=a.GetFreeId();return n>=0?(i=a.s_unitList[n],a.s_unitFlagList[n]=a.S_FLAG_BUSY,i.setMidAndBufUid(e,s)):(i=new a,i.setMidAndBufUid(e,s),a.s_unitList.push(i),a.s_unitFlagList.push(a.S_FLAG_BUSY),a.s_unitListLen++),i.setRC(t),r.default.s_midMap.set(e,i),i}static Restore(t){if(null!=t&&t.m_attachCount<1&&a.s_unitFlagList[t.getUid()]==a.S_FLAG_BUSY){let e=t.getUid();a.s_freeIdList.push(e),a.s_unitFlagList[e]=a.S_FLAG_FREE,t.__$destroy()}}}a.s_uid=0,a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.s_unitFlagList=[],a.s_unitListLen=0,a.s_unitList=[],a.s_freeIdList=[],e.default=a},"8e17":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{constructor(t=0,e=0,s=0,i=1){this.x=0,this.y=0,this.z=0,this.w=0,this.x=t,this.y=e,this.z=s,this.w=i}clone(){return new a(this.x,this.y,this.z,this.w)}setTo(t,e,s,i=1){this.x=t,this.y=e,this.z=s,this.w=i}setXYZ(t,e,s){this.x=t,this.y=e,this.z=s}copyFrom(t){this.x=t.x,this.y=t.y,this.z=t.z}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}multBy(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);t>r.default.MATH_MIN_POSITIVE&&(this.x/=t,this.y/=t,this.z/=t)}normalizeTo(t){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);e>r.default.MATH_MIN_POSITIVE?(t.x=this.x/e,t.y=this.y/e,t.z=this.z/e):(t.x=this.x,t.y=this.y,t.z=this.z)}scaleVector(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}scaleBy(t){this.x*=t,this.y*=t,this.z*=t}negate(){this.x=-this.x,this.y=-this.y,this.z=-this.z}equalsXYZ(t){return Math.abs(this.x-t.x)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.y-t.y)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.z-t.z)<r.default.MATH_MIN_POSITIVE}equalsAll(t){return Math.abs(this.x-t.x)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.y-t.y)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.z-t.z)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.w-t.w)<r.default.MATH_MIN_POSITIVE}project(){let t=1/this.w;this.x*=t,this.y*=t,this.z*=t}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getLengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}addBy(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}subtractBy(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}subtract(t){return new a(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new a(this.x+t.x,this.y+t.y,this.z+t.z)}crossProduct(t){return new a(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}crossBy(t){let e=this.y*t.z-this.z*t.y,s=this.z*t.x-this.x*t.z,i=this.x*t.y-this.y*t.x;this.x=e,this.y=s,this.z=i}reflectBy(t){let e=2*(this.x*t.x+this.y*t.y+this.z*t.z);this.x=this.x-e*t.x,this.y=this.y-e*t.y,this.z=this.z-e*t.z}scaleVecTo(t,e){this.x=t.x*e,this.y=t.y*e,this.z=t.z*e}subVecsTo(t,e){this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z}addVecsTo(t,e){this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z}crossVecsTo(t,e){this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x}toString(){return"Vector3D("+this.x+this.y+this.z+")"}static Cross(t,e,s){s.x=t.y*e.z-t.z*e.y,s.y=t.z*e.x-t.x*e.z,s.z=t.x*e.y-t.y*e.x}static CrossSubtract(t,e,s,i,r){a.__vtor3Stv0.x=e.x-t.x,a.__vtor3Stv0.y=e.y-t.y,a.__vtor3Stv0.z=e.z-t.z,a.__vtor3Stv1.x=i.x-s.x,a.__vtor3Stv1.y=i.y-s.y,a.__vtor3Stv1.z=i.z-s.z,t=a.__vtor3Stv0,s=a.__vtor3Stv1,r.x=t.y*s.z-t.z*s.y,r.y=t.z*s.x-t.x*s.z,r.z=t.x*s.y-t.y*s.x}static Subtract(t,e,s){s.x=t.x-e.x,s.y=t.y-e.y,s.z=t.z-e.z}static DistanceSquared(t,e){return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,a.__vtor3Stv0.getLengthSquared()}static DistanceXYZ(t,e,s,i,r,n){return a.__vtor3Stv0.x=t-i,a.__vtor3Stv0.y=e-r,a.__vtor3Stv0.z=s-n,a.__vtor3Stv0.getLength()}static Distance(t,e){return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,a.__vtor3Stv0.getLength()}static AngleBetween(t,e){return t.normalizeTo(a.__vtor3Stv0),e.normalizeTo(a.__vtor3Stv1),Math.acos(a.__vtor3Stv0.dot(a.__vtor3Stv1))*r.default.MATH_180_OVER_PI}static RadianBetween(t,e){return t.normalizeTo(a.__vtor3Stv0),e.normalizeTo(a.__vtor3Stv1),Math.acos(a.__vtor3Stv0.dot(a.__vtor3Stv1))}static RadianBetween2(t,e){let s=t.getLengthSquared(),i=e.getLengthSquared();return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,Math.acos((s+i-a.__vtor3Stv0.getLengthSquared())/(2*Math.sqrt(s)*Math.sqrt(i)))}static Reflect(t,e,s){let i=2*(t.x*e.x+t.y*e.y+t.z*e.z);s.x=t.x-i*e.x,s.y=t.y-i*e.y,s.z=t.z-i*e.z}}a.X_AXIS=new a(1,0,0),a.Y_AXIS=new a(0,1,0),a.Z_AXIS=new a(0,0,1),a.__vtor3Stv0=new a,a.__vtor3Stv1=new a,a.ZERO=new a,e.default=a},9152:function(t,e){e.read=function(t,e,s,i,r){var a,n,h=8*r-i-1,o=(1<<h)-1,l=o>>1,_=-7,u=s?r-1:0,m=s?-1:1,d=t[e+u];for(u+=m,a=d&(1<<-_)-1,d>>=-_,_+=h;_>0;a=256*a+t[e+u],u+=m,_-=8);for(n=a&(1<<-_)-1,a>>=-_,_+=i;_>0;n=256*n+t[e+u],u+=m,_-=8);if(0===a)a=1-l;else{if(a===o)return n?NaN:1/0*(d?-1:1);n+=Math.pow(2,i),a-=l}return(d?-1:1)*n*Math.pow(2,a-i)},e.write=function(t,e,s,i,r,a){var n,h,o,l=8*a-r-1,_=(1<<l)-1,u=_>>1,m=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:a-1,c=i?1:-1,f=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(h=isNaN(e)?1:0,n=_):(n=Math.floor(Math.log(e)/Math.LN2),e*(o=Math.pow(2,-n))<1&&(n--,o*=2),e+=n+u>=1?m/o:m*Math.pow(2,1-u),e*o>=2&&(n++,o/=2),n+u>=_?(h=0,n=_):n+u>=1?(h=(e*o-1)*Math.pow(2,r),n+=u):(h=e*Math.pow(2,u-1)*Math.pow(2,r),n=0));r>=8;t[s+d]=255&h,d+=c,h/=256,r-=8);for(n=n<<r|h,l+=r;l>0;t[s+d]=255&n,d+=c,n/=256,l-=8);t[s+d-c]|=128*f}},9156:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetTransUniform(t,e){i.s_transMap.set(t.getUid(),e)}static GetTransUniform(t){if(t.getUid()<0)throw Error("mat.getUid() < 0");return i.s_transMap.has(t.getUid())?i.s_transMap.get(t.getUid()):null}static HasTransUniform(t){return i.s_transMap.has(t.getUid())}static RemoveTransUniform(t){i.s_transMap.delete(t.getUid())}}i.s_transMap=new Map,e.default=i},"919c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_uid=0,this.m_mid=0,this.m_vtxUid=0,this.m_rc=null,this.ibuf=null,this.ibufStep=2,this.m_attachCount=0}setRC(t){this.m_rc=t}setMidAndBufUid(t,e){this.m_mid=t,this.m_vtxUid=e,this.m_attachCount=0}getUid(){return this.m_uid}getVtxUid(){return this.m_vtxUid}getMid(){return this.m_mid}run(){}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}__$destroy(){i.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.ibuf=null,this.m_rc=null}restoreThis(){}static HasMid(t){return i.s_midMap.has(t)}static GetByMid(t){return i.s_midMap.get(t)}}i.s_midMap=new Map,e.default=i},"91e2":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("29ef")),n=i(s("402a")),h=i(s("f63e")),o=s("8a0a"),l=i(s("3bfb"));class _ extends n.default{constructor(t=null){super(t),this.m_normalType=o.VtxNormalType.FLAT,this.m_minV=null,this.m_maxV=null,this.m_transMatrix=null,this.m_currMesh=null,this.uScale=1,this.vScale=1,this.normalScale=1,this.uvPartsNumber=0,this.wireframe=!1}setVtxTransformMatrix(t){this.m_transMatrix=t}useFlatNormal(){this.m_normalType=o.VtxNormalType.FLAT}useGourandNormal(){this.m_normalType=o.VtxNormalType.GOURAND}createMaterial(t){if(null==this.getMaterial()){let e=new h.default;e.setTextureList(t),this.setMaterial(e)}else this.getMaterial().setTextureList(t)}showBackFace(){this.setRenderState(a.default.BACK_CULLFACE_NORMAL_STATE)}showFrontFace(){this.setRenderState(a.default.FRONT_CULLFACE_NORMAL_STATE)}showAllFace(){this.setRenderState(a.default.NONE_CULLFACE_NORMAL_STATE)}scaleUVFaceAt(t,e,s,i,r){let a=this.getMesh();null!=a&&a.scaleUVFaceAt(t,e,s,i,r)}scaleUVSFaceAt(t,e){let s=this.getMesh();null!=s&&s.setFaceUVSAt(t,e)}reinitializeMesh(){null!=this.m_currMesh&&this.m_currMesh.reinitialize()}initialize(t,e,s=null){this.m_minV=t,this.m_maxV=e,this.createMaterial(s),this.activeDisplay()}initializeCube(t,e=null){t*=.5,this.m_minV=new r.default(-t,-t,-t),this.m_maxV=new r.default(t,t,t),this.createMaterial(e),this.activeDisplay()}initializeSizeXYZ(t,e,s,i=null){this.m_minV=new r.default(.5*-t,.5*-e,.5*-s),this.m_maxV=new r.default(.5*t,.5*e,.5*s),this.createMaterial(i),this.activeDisplay()}__activeMesh(t){if(this.m_currMesh=this.getMesh(),null==this.m_currMesh&&(this.m_currMesh=new l.default),null!=this.m_currMesh){let e=this.m_currMesh;null!=this.m_transMatrix&&e.setTransformMatrix(this.m_transMatrix),e.uScale=this.uScale,e.vScale=this.vScale,e.wireframe=this.wireframe,e.normalType=this.m_normalType,e.normalScale=this.normalScale,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.uvPartsNumber=this.uvPartsNumber,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.m_minV,this.m_maxV),this.m_minV=null,this.m_maxV=null,this.setMesh(e),e.setTransformMatrix(null)}this.m_transMatrix=null}updateMesh(){this.m_currMesh=this.getMesh()}setFaceUVSAt(t,e,s=0){null!=this.m_currMesh&&this.m_currMesh.setFaceUVSAt(t,e,s)}transformFaceAt(t,e){null!=this.m_currMesh&&this.m_currMesh.transformFaceAt(t,e)}getFaceCenterAt(t,e){null!=this.m_currMesh&&this.m_currMesh.getFaceCenterAt(t,e)}toString(){return"[Box3DEntity(uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=_},9260:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("7045"));class a{static KeyDown(t){for(var e=a.m_down_listener.length,s=0;s<e;++s)a.m_down_listener[s].call(a.m_down_ers[s],t)}static KeyUp(t){let e=a.m_up_listener.length;for(let s=0;s<e;++s)a.m_up_listener[s].call(a.m_up_ers[s],t)}static RemoveEventListener(t,e){if(null!=e){let s;switch(t){case r.default.KEY_DOWN:for(s=a.m_down_listener.length-1;s>=0;--s)if(e===a.m_down_listener[s]){a.m_down_ers.splice(s,1),a.m_down_listener.splice(s,1);break}break;case r.default.KEY_UP:for(s=a.m_up_listener.length-1;s>=0;--s)if(e===a.m_up_listener[s]){a.m_up_ers.splice(s,1),a.m_up_listener.splice(s,1);break}break;default:break}}}}a.m_down_ers=[],a.m_down_listener=[],a.m_up_ers=[],a.m_up_listener=[],a.AddEventListener=function(t,e,s){if(null!=s){let i=0;switch(t){case r.default.KEY_DOWN:for(i=a.m_down_listener.length-1;i>=0;--i)if(s===a.m_down_listener[i])break;i<0&&(a.m_down_ers.push(e),a.m_down_listener.push(s));break;case r.default.KEY_UP:for(i=a.m_up_listener.length-1;i>=0;--i)if(s===a.m_up_listener[i])break;i<0&&(a.m_up_ers.push(e),a.m_up_listener.push(s));break;default:break}}},e.default=a},"955e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("fecb")),h=i(s("c120")),o=s("e08e"),l=i(s("29ef")),_=i(s("3930")),u=i(s("e7ce"));class m{constructor(){this.m_initColor=new _.default,this.m_indexMaterial=new u.default,this.m_renderer=null,this.m_camera=null,this.m_headNode=null,this.m_rsn=null,this.m_hitList=new Uint8Array(256),this.m_rsnList=null,this.m_selectedNode=null,this.m_selectedTotal=0,this.m_testMode=0,this.m_invpv=new a.default,this.m_invtv=new a.default,this.m_rlpv=null,this.m_rltv=null,this.m_rlsiv=new Uint8Array(4),this.m_rlinvtv=new a.default,this.m_outv=new a.default,this.m_vecs=[null,null],this.m_gpuTestEnabled=!0,this.m_uintArray=new Uint8Array(4),this.m_uintList=new Uint8Array(256)}setRenderer(t){this.m_renderer=t}setRayTestMode(t){this.m_testMode=t}setRay(t,e){this.m_rlpv=t,this.m_rltv=e}getRay(t,e){t.copyFrom(this.m_rlpv),e.copyFrom(this.m_rltv)}setCamera(t){this.m_camera=t}setCullingNodeHead(t){if(this.m_headNode=t,null==this.m_rsnList){this.m_rsnList=[];let t=0;for(;t<256;++t)this.m_rsnList.push(new h.default)}}getSelectedNode(){return this.m_selectedNode}getSelectedNodes(){return this.m_rsnList}getSelectedNodesTotal(){return this.m_selectedTotal}sorting(t,e){let s=this.m_rsnList;this.m_rsn=s[t];while(t<e){while(t<e&&s[e].dis>=this.m_rsn.dis)--e;s[t]=s[e];while(t<e&&s[t].dis<=this.m_rsn.dis)++t;s[e]=s[t]}return s[t]=this.m_rsn,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}run(){let t=this.m_headNode;if(null!=t){let e=0,s=this.m_rltv,i=this.m_rlpv,a=this.m_outv,h=null,o=0;Math.abs(s.x)>r.default.MATH_MIN_POSITIVE?this.m_rlinvtv.x=1/s.x:this.m_rlinvtv.x=r.default.MATH_MAX_POSITIVE,Math.abs(s.y)>r.default.MATH_MIN_POSITIVE?this.m_rlinvtv.y=1/s.y:this.m_rlinvtv.y=r.default.MATH_MAX_POSITIVE,Math.abs(s.z)>r.default.MATH_MIN_POSITIVE?this.m_rlinvtv.z=1/s.z:this.m_rlinvtv.z=r.default.MATH_MAX_POSITIVE,this.m_rlinvtv.x<0?this.m_rlsiv[0]=1:this.m_rlsiv[0]=0,this.m_rlinvtv.y<0?this.m_rlsiv[1]=1:this.m_rlsiv[1]=0,this.m_rlinvtv.z<0?this.m_rlsiv[2]=1:this.m_rlsiv[2]=0;while(null!=t)t.drawEnabled&&t.entity.mouseEnabled&&(a.x=t.bounds.center.x-i.x,a.y=t.bounds.center.y-i.y,a.z=t.bounds.center.z-i.z,e=a.dot(s),a.x-=e*s.x,a.y-=e*s.y,a.z-=e*s.z,a.getLengthSquared()<=t.bounds.radius2&&t.rayTestState<1&&(this.m_vecs[0]=t.bounds.min,this.m_vecs[1]=t.bounds.max,n.default.IntersectionRL3(this.m_vecs,this.m_rlsiv,this.m_rlinvtv,s,i,a)&&(h=this.m_rsnList[o],h.entity=t.entity,h.dis=this.m_rlinvtv.w,h.wpv.copyFrom(a),++o))),t=t.next;this.m_selectedNode=null;let l=0;if(o>0){let t=this.m_invpv,e=this.m_invtv,r=null,n=0,h=0,_=null,u=null,m=s.dot(i),d=0,c=!this.m_gpuTestEnabled,f=0;if(o>1){for(this.snsort(0,o-1),l=0;l<o;++l){if(u=this.m_rsnList[l],r=this.m_rsnList[l].entity,r.isPolyhedral()?c?(_=r.getInvMatrix(),_.transformOutVector3(i,t),_.deltaTransformOutVector(s,e),n=r.testRay(t,e,a,!0)):(++f,n=0):(_=r.getInvMatrix(),_.transformOutVector3(i,t),_.deltaTransformOutVector(s,e),n=r.testRay(t,e,a,!0)),n>0){if(u.lpv.copyFrom(a),r.getMatrix().transformOutVector3(a,u.wpv),u.dis=s.dot(u.wpv)-m,this.m_hitList[h]=l,++h,u.dis>d){this.m_selectedNode=u;break}}else if(n<0&&(this.m_hitList[h]=l,++h,u.dis>d)){this.m_selectedNode=u;break}d=u.dis}null==this.m_selectedNode&&h>0&&(this.m_selectedNode=this.m_rsnList[this.m_hitList[0]])}else u=this.m_rsnList[0],r=this.m_rsnList[0].entity,_=r.getInvMatrix(),_.transformOutVector3(i,t),_.deltaTransformOutVector(s,e),r.isPolyhedral()?c?n=r.testRay(t,e,a,!0):(++f,n=0):n=r.testRay(t,e,a,!0),n>0?(u.lpv.copyFrom(a),r.getMatrix().transformOutVector3(a,u.wpv),u.dis=s.dot(u.wpv)-m,this.m_selectedNode=u):n<0&&(this.m_selectedNode=u);f>0&&(this.m_testMode<1||null==this.m_selectedNode||this.m_selectedNode.entity.isPolyhedral())&&this.gpuPick(o)}for(l=o;l<this.m_selectedTotal;++l)this.m_selectedNode!=this.m_rsnList[l]&&(this.m_rsnList[l].entity=null);this.m_selectedTotal=o}}gpuPick(t){let e=this.m_renderer.getRendererContext(),s=this.m_renderer.getRenderProxy(),i=s.getStage3D().mouseX,r=s.getStage3D().mouseY;e.vertexRenderBegin(),e.getClearRGBAColor4f(this.m_initColor),e.setClearRGBAColor4f(0,0,0,0),e.setScissorEnabled(!0),e.setScissorRect(i,r,1,1),e.clearBackBuffer(),this.m_uintArray[3]=0,l.default.LockBlendMode(o.RenderBlendMode.OPAQUE),l.default.LockDepthTestMode(o.DepthTestMode.OPAQUE),e.unlockMaterial(),e.unlockRenderState(),e.useGlobalMaterial(this.m_indexMaterial,!1);let a=null,n=null,h=-1,_=0;for(;_<t;++_)a=this.m_rsnList[_],n=this.m_rsnList[_].entity,n.isPolyhedral()&&(++h,this.m_indexMaterial.setIndex(h+2),this.m_uintList[h]=_,this.m_renderer.updateMaterialUniformToCurrentShd(this.m_indexMaterial),this.m_renderer.drawEntity(n,!1,!0));if(h>-1&&s.readPixels(i,r,1,1,s.RGBA,s.UNSIGNED_BYTE,this.m_uintArray),l.default.UnlockBlendMode(),l.default.UnlockDepthTestMode(),this.m_uintArray[3]>1){_=this.m_uintList[this.m_uintArray[3]-2],a=this.m_rsnList[_];let t=(this.m_uintArray[0]<<8)+this.m_uintArray[1]+this.m_uintArray[2]/255;if(null!=this.m_selectedNode){let e=this.m_selectedNode.entity;this.m_selectedNode==a||e.isPolyhedral()||this.m_selectedNode.dis<t&&(_=-1)}_>-1&&(a.dis=t,this.getWorldPosByRayDistance(t,this.m_rltv,this.m_camera.getPosition(),a.wpv),this.m_selectedNode=a)}e.setScissorEnabled(!1),e.unlockMaterial(),e.unlockRenderState(),l.default.UnlockBlendMode(),l.default.UnlockDepthTestMode(),e.setClearRGBAColor4f(this.m_initColor.r,this.m_initColor.g,this.m_initColor.b,this.m_initColor.a),e.resetState()}clear(){this.m_selectedNode=null}getWorldPosByRayDistance(t,e,s,i){i.x=e.x*t+s.x,i.y=e.y*t+s.y,i.z=e.z*t+s.z}}e.default=m},9666:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("acfe"));class n{static CreateShdData(t,e,s,i,h){if(n.s_shdDataDict.has(t))return n.s_shdDataDict.get(t);let o=new a.default;return o.adaptationShaderVersion=i,o.preCompileInfo=h,o.initialize(t,e,s),n.s_shdDataList[o.getUid()]=o,++n.s_shdDataListLen,n.s_shdDataDict.set(t,o),r.default.SHADERCODE_TRACE_ENABLED,o}static FindData(t){return n.s_shdDataDict.has(t)?n.s_shdDataDict.get(t):null}}n.s_shdDataDict=new Map,n.s_shdDataList=[],n.s_shdDataListLen=0,e.default=n},"984e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.width=0,this.height=0,this.depth=0,this.sampler=0,this.texBuf=null,this.m_attachCount=0}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}bindToGpu(t){t.bindTexture(this.sampler,this.texBuf)}getAttachCount(){return this.m_attachCount}}class r{constructor(t,e){this.m_resMap=new Map,this.m_freeMap=new Map,this.m_texResTotal=0,this.m_attachTotal=0,this.m_delay=128,this.m_rcuid=0,this.m_gl=null,this.texMid=-1,this.unlocked=!0,this.m_rcuid=t,this.m_gl=e}createBuf(){return this.m_gl.createTexture()}createResByParams3(t,e,s,r){if(!this.m_resMap.has(t)){let a=new i;return a.rcuid=this.getRCUid(),a.resUid=t,a.width=e,a.height=s,a.sampler=r,a.texBuf=this.createBuf(),a.texBuf.resUid=t,this.addTextureRes(a),!0}return!1}getRCUid(){return this.m_rcuid}getRC(){return this.m_gl}hasResUid(t){return this.m_resMap.has(t)}renderBegin(){this.texMid=-1}getTextureResTotal(){return this.m_texResTotal}addTextureRes(t){this.m_resMap.has(t.resUid)||(t.waitDelTimes=0,this.m_resMap.set(t.resUid,t),this.m_texResTotal++)}getGpuBuffer(t){return this.m_resMap.has(t)?this.m_resMap.get(t).texBuf:null}bindToGpu(t){this.m_resMap.has(t)&&this.m_resMap.get(t).bindToGpu(this.m_gl)}getAttachTotal(){return this.m_attachTotal}__$attachRes(t){if(this.m_resMap.has(t)){this.m_attachTotal++;let e=this.m_resMap.get(t);e.getAttachCount()<1&&this.m_freeMap.has(t)&&this.m_freeMap.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.m_resMap.has(t)&&this.m_resMap.has(t)){let e=this.m_resMap.get(t);e.getAttachCount()>0&&(this.m_attachTotal--,e.__$detachThis(),e.getAttachCount()<1&&this.m_freeMap.set(t,e))}}update(){if(this.m_delay--,this.m_delay<1){this.m_delay=128;for(const[t,e]of this.m_freeMap)e.waitDelTimes++,e.waitDelTimes>5&&(this.m_resMap.delete(e.resUid),this.m_freeMap.delete(e.resUid),this.m_gl.deleteTexture(e.texBuf),e.texBuf=null,this.m_texResTotal--)}}}e.default=r},"9bb7":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("faa5")),a=i(s("250c")),n=i(s("0fc4"));class h extends r.default{constructor(){super(),this.m_codeBuilder=new a.default,this.m_uniqueName=""}initialize(t){super.initialize(t),this.m_uniqueName="DepthShd",this.adaptationShaderVersion=!1}buildThisCode(){let t=this.m_codeBuilder;t.reset(),t.addVertLayout("vec3","a_vs"),t.addVarying("vec4","v_pos"),t.addFragOutput("vec4","FragColor0"),t.useVertSpaceMats(!0,!0,!0),t.addFragFunction("\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\n\treturn r * PackUpscale;\n}\n")}getFragShaderCode(){return this.buildThisCode(),this.m_codeBuilder.addFragMainCode("\nvoid main() {\n    // Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\n    float fragCoordZ = 0.5 * v_pos[2] / v_pos[3] + 0.5;\n    FragColor0 = packDepthToRGBA( fragCoordZ );\n}\n"),this.m_codeBuilder.buildFragCode()}getVtxShaderCode(){return this.m_codeBuilder.addVertMainCode("\nvoid main() {\n    vec4 wpos = u_objMat * vec4(a_vs, 1.0);\n    vec4 viewPos = u_viewMat * wpos;\n    gl_Position =  u_projMat * viewPos;\n    v_pos = gl_Position;\n}\n"),this.m_codeBuilder.buildVertCode()}getUniqueShaderName(){return this.m_uniqueName}toString(){return"[DepthShaderBuffer()]"}static GetInstance(){return h.s_instance}}h.s_instance=new h;class o extends n.default{constructor(){super()}getCodeBuf(){return h.GetInstance()}createSelfUniformData(){return null}}e.default=o},"9c3c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("38de")),n=i(s("fecb")),h=i(s("8a0a")),o=i(s("cb29")),l=i(s("e7d2")),_=s("e08e");class u extends o.default{constructor(t=h.default.VTX_STATIC_DRAW){super(t),this.m_vs=null,this.m_cvs=null,this.m_lsTotal=0,this.rayTestRadius=2}getVS(){return this.m_vs}getCVS(){return this.m_vs}initialize(t,e){t.length>=6&&(this.vtCount=Math.floor(t.length/3),this.m_lsTotal=Math.floor(this.vtCount/2),this.m_vs=new Float32Array(t),null==this.bounds&&(this.bounds=new n.default),this.bounds.addXYZFloat32Arr(this.m_vs),this.bounds.updateFast(),l.default.Reset(),l.default.AddFloat32Data(this.m_vs,3),this.isVBufEnabledAt(h.default.VBUF_CVS_INDEX)&&(this.m_cvs=new Float32Array(e),l.default.AddFloat32Data(this.m_cvs,3)),l.default.vbWholeDataEnabled=this.vbWholeDataEnabled,null!=this.m_vbuf?l.default.UpdateBufData(this.m_vbuf):this.m_vbuf=l.default.CreateBySaveData(this.getBufDataUsage()),this.drawMode=_.RenderDrawMode.ARRAYS_LINES,this.buildEnd())}setVSXYZAt(t,e,s,i){null!=this.m_vbuf&&this.m_vbuf.setData3fAt(t,0,e,s,i)}toString(){return"DashedLineMesh()"}isPolyhedral(){return!1}testRay(t,e,s,i){let r=0,n=this.m_vs,h=0,o=this.rayTestRadius;for(let l=0;l<this.m_lsTotal;++l){if(u.s_pv0.setXYZ(n[r],n[r+1],n[r+2]),u.s_pv1.setXYZ(n[r+3],n[r+4],n[r+5]),h=a.default.IntersectionLS(t,e,u.s_pv0,u.s_pv1,s,o),h>0)return 1;r+=6}return 0}__$destroy(){this.isResFree()&&(this.bounds=null,this.m_vs=null,this.m_cvs=null,super.__$destroy())}}u.s_pv0=new r.default,u.s_pv1=new r.default,e.default=u},"9c4d":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.prev=null,this.next=null,this.flag=0,this.target=null}reset(){this.flag=0,this.target=null}}class r{constructor(){this.m_begin=null,this.m_end=null}destroy(){this.clear()}clear(){this.m_begin=this.m_end=null}getBegin(){return this.m_begin}isEmpty(){return this.m_begin==this.m_end&&null==this.m_end}addNode(t){null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null}removeNode(t){t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}class a{constructor(){this.m_linker=new r,this.m_freeIds=[],this.m_runners=[new i]}getFreeId(){if(this.m_freeIds.length>0)return this.m_freeIds.pop();let t=new i;return t.flag=this.m_runners.length,this.m_runners.push(t),t.flag}addRunner(t){if(null!=t&&t.getRunFlag()<1){let e=this.getFreeId(),s=this.m_runners[e];s.flag=e,s.target=t,t.setRunFlag(e),this.m_linker.addNode(s)}}removeRunner(t){if(null!=t&&t.getRunFlag()>0){let e=t.getRunFlag();this.m_freeIds.push(e);let s=this.m_runners[e];s.flag=e,s.target=null,t.setRunFlag(0),this.m_linker.removeNode(s)}}run(){let t=this.m_linker.getBegin(),e=t;while(null!=e)t=e,e=t.next,t.target.isRunning()&&t.target.run()}}e.default=a},"9f3e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("df25"));class n extends a.default{constructor(t,e,s=!1){super(t,e,s),this.m_type=r.TextureProxyType.Uint16,this.minFilter=r.TextureConst.LINEAR,this.dataType=r.TextureDataType.UNSIGNED_SHORT}toHalfFloatOes(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4,this.dataType=r.TextureDataType.HALF_FLOAT_OES}toUShort565(){this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB,this.unpackAlignment=3,this.dataType=r.TextureDataType.UNSIGNED_SHORT_5_6_5}toUShort4444(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4,this.dataType=r.TextureDataType.UNSIGNED_SHORT_4_4_4_4}toUShort5551(){this.unpackAlignment=4,this.dataType=r.TextureDataType.UNSIGNED_SHORT_5_5_5_1}toUShort(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.dataType=r.TextureDataType.UNSIGNED_SHORT}toAlphaFormat(){this.dataType==r.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=r.TextureFormat.ALPHA,this.internalFormat=r.TextureFormat.ALPHA,this.unpackAlignment=1)}toRedFormat(){this.dataType==r.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=r.TextureFormat.RED,this.internalFormat=r.TextureFormat.RED,this.unpackAlignment=1)}toRGBFormat(){this.dataType==r.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB,this.unpackAlignment=3)}toRGBAFormat(){this.dataType==r.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4)}uploadFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,n=!1){super.setDataFromBytes(t,e,s,i,r,a,n)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[Uint16TextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},a254:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("faa5")),a=i(s("b3bd")),n=i(s("0fc4")),h=i(s("250c"));class o extends r.default{constructor(){super(),this.m_codeBuilder=new h.default,this.m_uniqueName="",this.m_hasTex=!1,this.mapLodEnabled=!1}initialize(t){this.m_uniqueName="ScreenPlaneShd",this.m_hasTex=t,t&&(this.m_uniqueName+="_tex",this.mapLodEnabled&&(this.m_uniqueName+="Lod"))}buildThisCode(){let t=this.m_codeBuilder;t.reset(),t.addVertLayout("vec3","a_vs"),this.m_hasTex?(t.mapLodEnabled=this.mapLodEnabled,t.addVertLayout("vec2","a_uvs"),t.addTextureSample2D(),t.addVarying("vec2","v_uv")):t.mapLodEnabled=!1,t.addFragOutput("vec4","FragColor0"),t.addFragUniform("vec4","u_param",3),t.useVertSpaceMats(!0,!1,!1),t.addFragFunction("")}getFragShaderCode(){return this.buildThisCode(),this.m_hasTex?this.m_codeBuilder.addFragMainCode("\nvoid main() {\n    #ifdef VOX_Texture2DLod\n    vec4 color4 = VOX_Texture2DLod(u_sampler0, v_uv, u_param[2].w);\n    #else\n    vec4 color4 = VOX_Texture2D(u_sampler0, v_uv);\n    #endif\n    color4 *= u_param[0];\n    color4 += u_param[1];\n    FragColor0 = color4;\n}\n"):this.m_codeBuilder.addFragMainCode("\nvoid main() {\n    FragColor0 = u_param[0] + u_param[1];\n}\n"),this.m_codeBuilder.buildFragCode()}getVtxShaderCode(){return this.m_hasTex?this.m_codeBuilder.addVertMainCode("\nvoid main() {\n    gl_Position = u_objMat * vec4(a_vs,1.0);\n    v_uv = a_uvs.xy;\n}\n"):this.m_codeBuilder.addVertMainCode("\nvoid main() {\n    gl_Position = u_objMat * vec4(a_vs,1.0);\n}\n"),this.m_codeBuilder.buildVertCode()}getUniqueShaderName(){return this.m_uniqueName}toString(){return"[ScreenPlaneShaderBuffer()]"}static GetInstance(){return null!=o.s_instance||(o.s_instance=new o),o.s_instance}}o.s_instance=null;class l extends n.default{constructor(){super(),this.mapLodEnabled=!1,this.m_param=new Float32Array([1,1,1,1,0,0,0,0,0,0,0,0])}getCodeBuf(){let t=o.GetInstance();return t.mapLodEnabled=this.mapLodEnabled,t}setRGB3f(t,e,s){this.m_param[0]=t,this.m_param[1]=e,this.m_param[2]=s}setRGBA4f(t,e,s,i){this.m_param[0]=t,this.m_param[1]=e,this.m_param[2]=s,this.m_param[3]=i}setOffsetRGB3f(t,e,s){this.m_param[0]=t,this.m_param[1]=e,this.m_param[2]=s}setOffsetRGBA4f(t,e,s,i){this.m_param[0]=t,this.m_param[1]=e,this.m_param[2]=s,this.m_param[3]=i}setTextureLodLevel(t){this.m_param[11]=t}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_param"],t.dataList=[this.m_param],t}}e.default=l},a446:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=s("cc48"),n=i(s("265e")),h=i(s("af68")),o=i(s("a80a"));class l{constructor(){this.m_uid=-1,this.m_renderer=null,this.m_camera=null,this.m_stage3d=null,this.m_emptyRPONode=new n.default,this.m_rpoNodeBuilder=null,this.m_nodeQueue=new h.default,this.m_nodeWLinker=new o.default,this.m_nodeSLinker=new o.default,this.m_cullingor=null,this.m_raySelector=null,this.m_entitysTotal=0,this.m_uid=l.s_uid++,this.m_nodeQueue.initialize(1)}getUid(){return this.m_uid}initialize(t,e=null){null==this.m_renderer&&(this.m_renderer=t,this.m_stage3d=t.getStage3D(),this.m_camera=e,this.m_rpoNodeBuilder=t.getRPONodeBuilder())}getStage3D(){return this.m_stage3d}setCamera(t){this.m_camera=t}getCamera(){return this.m_camera}getMouseXYWorldRay(t,e){this.m_camera.getWorldPickingRayByScreenXY(this.m_stage3d.mouseX,this.m_stage3d.mouseY,t,e)}setSpaceCullingor(t){this.m_cullingor=t}setRaySelector(t){this.m_raySelector=t,this.m_raySelector.setRenderer(this.m_renderer)}getRaySelector(){return this.m_raySelector}addEntity(t){if(null!=t.getGlobalBounds()&&t.spaceCullMask>a.SpaceCullingMask.NONE&&r.default.TestSpaceEnabled(t.__$rseFlag)){t.update(),++this.m_entitysTotal;let e=this.m_nodeQueue.addEntity(t);e.bounds=t.getGlobalBounds(),e.pcoEnabled=(t.spaceCullMask&a.SpaceCullingMask.POV)==a.SpaceCullingMask.POV;let s=t.isRenderEnabled()||null==t.getMaterial();s&&(t.spaceCullMask&a.SpaceCullingMask.POV)==a.SpaceCullingMask.POV?(e.rstatus=1,null==t.getMaterial()&&(e.rpoNode=this.m_emptyRPONode),null==e.rpoNode&&(e.rpoNode=this.m_rpoNodeBuilder.getNodeByUid(t.getDisplay().__$rpuid)),this.m_nodeSLinker.addNode(e)):null==t.getMaterial()?(e.rstatus=1,e.rpoNode=this.m_emptyRPONode,this.m_nodeSLinker.addNode(e)):(e.rstatus=0,this.m_nodeWLinker.addNode(e))}}removeEntity(t){if(null!=t&&r.default.TestSpaceContains(t.__$rseFlag)){let e=this.m_nodeQueue.getNodeByEntity(t);null!=e&&(e.rstatus>0?this.m_nodeSLinker.removeNode(e):this.m_nodeWLinker.removeNode(e),this.m_nodeQueue.removeEntity(t),--this.m_entitysTotal)}}updateEntity(t){}update(){}runBegin(){}run(){let t=this.m_nodeWLinker.getBegin();if(null!=t){let e=null;while(null!=t)t.entity.isRenderEnabled()?(e=t,e.rstatus=1,t=t.next,this.m_nodeWLinker.removeNode(e),this.m_nodeSLinker.addNode(e),null==e.rpoNode&&(e.rpoNode=this.m_rpoNodeBuilder.getNodeByUid(e.entity.getDisplay().__$rpuid))):t=t.next}if(t=this.m_nodeSLinker.getBegin(),null!=t)if(null!=this.m_cullingor)this.m_cullingor.setCamera(this.m_camera),this.m_cullingor.setCullingNodeHead(t),this.m_cullingor.run();else{let e=null,s=this.m_camera;while(null!=t)t.rpoNode.isVsible()&&t.entity.isDrawEnabled()?(e=t.bounds,t.drawEnabled=s.visiTestSphere2(e.center,e.radius),t.entity.drawEnabled=t.drawEnabled,t.rpoNode.drawEnabled=t.drawEnabled):(t.drawEnabled=!1,t.entity.drawEnabled=!1,t.rpoNode.drawEnabled=!1),t=t.next}}rayTest(t,e){null!=this.m_raySelector&&(this.m_raySelector.setCamera(this.m_camera),this.m_raySelector.setCullingNodeHead(this.m_nodeSLinker.getBegin()),this.m_raySelector.setRay(t,e),this.m_raySelector.run())}runEnd(){}getCullingNodeHead(){return this.m_nodeSLinker.getBegin()}toString(){return"[RendererSpace(uid = "+this.m_uid+")]"}}l.s_uid=0,e.default=l},a46e:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("1710"));class n{constructor(){this.m_camera=null,this.m_touchZoomBoo=!1,this.m_preDis=0,this.m_touchZoomSpd=2,this.m_slideSpd=1,this.m_mouseWheelZoomSpd=.5,this.m_tempa=new r.default,this.m_tempb=new r.default,this.m_preva=new r.default,this.m_prevb=new r.default,this.m_va=new r.default,this.m_vb=new r.default,this.m_lookAt=new r.default,this.m_fowardDis=0,this.m_initBoo=!0,this.m_lookAtCtrlEnabled=!0,this.m_flagDrag=0,this.m_flagZoom=0,this.m_flagType=2}setMobileZoomSpeed(t){this.m_touchZoomSpd=t}seSlideSpeed(t){this.m_slideSpd=t}setMouseWheelZoomSpd(t){this.m_mouseWheelZoomSpd=t}bindCamera(t){this.m_camera=t}initialize(t){this.m_initBoo&&(this.m_initBoo=!1,t.addEventListener(a.default.MOUSE_WHEEL,this,this.mouseWheelListener,!0,!0),t.addEventListener(a.default.MOUSE_MULTI_MOVE,this,this.mouseMultiMoveListener,!0,!0),t.addEventListener(a.default.MOUSE_MULTI_UP,this,this.mouseMultiUpListener,!0,!0))}setLookAtCtrlEnabled(t){this.m_lookAtCtrlEnabled=t}mouseWheelListener(t){this.m_fowardDis=t.wheelDeltaY*this.m_mouseWheelZoomSpd}mouseMultiMoveListener(t){this.setTouchPosArray(t.posArray)}mouseMultiUpListener(t){this.setTouchPosArray(t.posArray)}resetState(){this.m_flagDrag=0,this.m_flagZoom=0,this.m_flagType=0}setTouchPosArray(t){if(null!=t&&t.length>1){let e=0;if(this.m_va.setXYZ(t[0].x,t[0].y,0),this.m_vb.setXYZ(t[1].x,t[1].y,0),this.m_touchZoomBoo){e=r.default.Distance(this.m_va,this.m_vb),this.m_flagType<1?(this.m_tempa.copyFrom(this.m_va),this.m_tempb.copyFrom(this.m_vb),this.m_tempa.subVecsTo(this.m_va,this.m_preva),this.m_tempb.subVecsTo(this.m_vb,this.m_prevb),this.m_tempa.normalize(),this.m_tempb.normalize(),this.m_tempa.dot(this.m_tempb)>.9?this.m_flagDrag++:this.m_flagZoom++,(this.m_flagDrag>3||this.m_flagZoom>3)&&(this.m_flagType=this.m_flagDrag>this.m_flagZoom?1:2)):this.m_tempa.subVecsTo(this.m_va,this.m_preva);let t=Math.abs(this.m_preDis-e);t>.1&&(this.m_fowardDis=(e-this.m_preDis)*this.m_touchZoomSpd,this.m_preDis=e)}else this.m_touchZoomBoo=!0,this.m_preDis=r.default.Distance(this.m_va,this.m_vb),this.resetState()}else this.resetState(),this.m_touchZoomBoo=!1;this.m_preva.copyFrom(this.m_va),this.m_prevb.copyFrom(this.m_vb)}run(t,e){let s=this.m_lookAtCtrlEnabled;null==t&&(t=this.m_lookAt),null!=this.m_camera&&(2==this.m_flagType?this.m_fowardDis>0?(r.default.Distance(this.m_camera.getPosition(),this.m_camera.getLookAtPosition())>e&&(this.m_camera.forward(this.m_fowardDis),s&&this.m_camera.setLookPosXYZFixUp(t.x,t.y,t.z)),this.m_fowardDis=0):this.m_fowardDis<-.001&&(this.m_camera.forward(this.m_fowardDis),s&&this.m_camera.setLookPosXYZFixUp(t.x,t.y,t.z),this.m_fowardDis=0):1==this.m_flagType&&this.m_camera.slideViewOffsetXY(-this.m_tempa.x*this.m_slideSpd,this.m_tempa.y*this.m_slideSpd))}}e.default=n},a7ed:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279"));class n{create(t,e){let s=null,i=r.default.FrustumParam;return e.hasUniformByName(i.name)&&(s=new a.default,s.uns=i.name,s.uniformNameList=[i.name],s.copyDataFromProbe(t.getCamera().ufrustumProbe)),s}getIDNS(){return"FrustumUniformBuilder"}}e.default=n},a80a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_begin=null,this.m_end=null}destroy(){this.clear()}clear(){this.m_begin=this.m_end=null}getBegin(){return this.m_begin}isEmpty(){return this.m_begin==this.m_end&&null==this.m_end}addNode(t){null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null}removeNode(t){t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}e.default=i},a996:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uuid="",this.phase=0,this.type=i.RESIZE,this.target=null,this.data=null,this.__$preventBoo=!1}getClassType(){return i.EventClassType}preventDefault(){this.__$preventBoo=!0}reset(){this.__$preventBoo=!1}toString(){return"[EventBase]"}}i.EventClassType=1001,i.RESIZE=3001,i.ENTER_FRAME=3002,e.default=i},a9bf:function(t,e,s){"use strict";s.r(e),s.d(e,"EnvShaderCode",(function(){return h}));var i="#ifdef VOX_USE_FOG\r\n    vec3 fogEnvColor = vec3(1.0);\r\n    vec4 getFogColorFromTexture2D(sampler2D tex) {\r\n        vec4 color = VOX_Texture2D(tex, (u_envLightParams[3].xy + worldPosition.xz) / u_envLightParams[3].zw);\r\n        fogEnvColor = color.xyz;\r\n        return color;\r\n    }\r\n    void useFog(inout vec3 color) {\r\n        vec3 fogColor = u_envLightParams[2].xyz * fogEnvColor;\r\n        #ifdef VOX_FOG_EXP2\r\n            float fogDensity = u_envLightParams[2].w;\r\n            float fogFactor = 1.0 - exp( - fogDensity * fogDensity * v_fogDepth * v_fogDepth );\r\n        #else\r\n            float fogNear = u_envLightParams[1].z;\r\n            float fogFar = u_envLightParams[1].w;\r\n            float fogFactor = smoothstep( fogNear, fogFar, v_fogDepth );\r\n        #endif\r\n        color = mix( color.rgb, fogColor, fogFactor );\r\n    }\r\n#endif",r="void calcFogDepth(in vec4 viewPos) {\r\n    v_fogDepth = -viewPosition.z;\r\n}",a="#ifdef VOX_FOG_COLOR_MAP\r\n    getFogColorFromTexture2D( VOX_FOG_COLOR_MAP );\r\n#endif\r\n\r\n#ifdef VOX_USE_FOG\r\n    useFog( FragColor0.rgb );\r\n#endif ",n="#ifdef VOX_USE_FOG\r\n\r\ncalcFogDepth(viewPosition);\r\n\r\n#endif";const h={vert:"",vert_head:r,vert_body:n,frag:"",frag_head:i,frag_body:a}},ab73:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.type="vec4",this.data=null,this.name="u_vsmParams",this.arrayLength=3}}class r{constructor(){this.type="vec4",this.data=new Float32Array([.1,.1,.1,1,1,.1,600,3500,.3,0,.9,5e-4,0,0,800,800]),this.name="u_envLightParams",this.arrayLength=4}}class a{constructor(){this.type="mat4",this.data=null,this.name="u_shadowMat",this.arrayLength=0}}class n{constructor(){this.type="vec4",this.data=null,this.name="u_stageParam",this.arrayLength=0}}class h{constructor(){this.type="vec4",this.data=null,this.name="u_viewParam",this.arrayLength=0}}class o{constructor(){this.type="vec4",this.data=null,this.name="u_frustumParam",this.arrayLength=0}}class l{constructor(){this.type="vec4",this.data=null,this.name="u_cameraPosition",this.arrayLength=0}}class _{constructor(){this.type="vec4",this.positionName="u_lightPositions",this.colorName="u_lightColors"}}class u{}u.LocalTransformMatUNS="u_objMat",u.CameraViewMatUNS="u_viewMat",u.CameraProjectiveMatUNS="u_projMat",u.FrustumParam=new o,u.CameraPosParam=new l,u.StageParam=new n,u.ViewParam=new h,u.ShadowMatrix=new a,u.ShadowVSMParams=new i,u.GlobalLight=new _,u.EnvLightParams=new r,e.default=u},abdb:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.AXIS_ANGLE=0,i.QUATERNION=1,i.EULER_ANGLES=2,e.default=i},acaa:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("cfaf"));class n extends a.default{constructor(t,e,s=!1){super(t,e,s),this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.srcFormat=r.TextureFormat.DEPTH_COMPONENT,this.internalFormat=r.TextureFormat.DEPTH_COMPONENT,this.dataType=r.TextureDataType.UNSIGNED_SHORT,this.m_generateMipmap=!1,this.m_haveRData=!0,this.mipmapEnabled=!1,this.m_type=r.TextureProxyType.Depth}toDepthUnsignedInt(){this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.srcFormat=r.TextureFormat.DEPTH_COMPONENT,this.internalFormat=r.TextureFormat.DEPTH_COMPONENT,this.dataType=r.TextureDataType.UNSIGNED_INT,this.m_generateMipmap=!1,this.m_haveRData=!0,this.mipmapEnabled=!1}toDepthUnsignedShort(){this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.srcFormat=r.TextureFormat.DEPTH_COMPONENT,this.internalFormat=r.TextureFormat.DEPTH_COMPONENT,this.dataType=r.TextureDataType.UNSIGNED_SHORT,this.m_generateMipmap=!1,this.m_haveRData=!0,this.mipmapEnabled=!1}toDepthAndStencil(){this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.srcFormat=r.TextureFormat.DEPTH_STENCIL,this.internalFormat=r.TextureFormat.DEPTH_STENCIL,this.dataType=r.TextureDataType.UNSIGNED_INT_24_8_WEBGL,this.m_generateMipmap=!1,this.mipmapEnabled=!1,this.m_haveRData=!0}uploadData(t){let e=t.getRC();e.texImage2D(this.m_sampler,0,r.TextureFormat.ToGL(e,this.internalFormat),this.m_texWidth,this.m_texHeight,0,r.TextureFormat.ToGL(e,this.srcFormat),r.TextureDataType.ToGL(e,this.dataType),null)}toString(){return"[DepthTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},acfe:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ca6c")),a=i(s("8a0a")),n=i(s("3b73")),h=i(s("81ce")),o=i(s("fc07"));class l{constructor(){this.m_uid=-1,this.adaptationShaderVersion=!0,this.preCompileInfo=null,this.m_vshdCode="",this.m_fshdCode="",this.m_shdUniqueName="",this.m_texTotal=0,this.m_uniforms=null,this.m_useTex=!1,this.m_attriNSList=null,this.m_attriSizeList=null,this.m_aLocationTypes=null,this.m_uniformDict=new Map,this.m_haveCommonUniform=!1,this.m_layoutBit=0,this.m_mid=0,this.m_fragOutputTotal=1,this.m_texUniformNames=null,this.dataUniformEnabled=!1,this.m_uid=l.s_uid++}getVSCodeStr(){return this.m_vshdCode}getFSCodeStr(){return this.m_fshdCode}getLayoutBit(){return this.m_layoutBit}getMid(){return this.m_mid}getFragOutputTotal(){return this.m_fragOutputTotal}parseCode(t,e){l.s_codeParser.reset(),l.s_codeParser.parseVShaderCode(t),l.s_codeParser.parseFShaderCode(e),this.m_fragOutputTotal=l.s_codeParser.fragOutputTotal,this.m_uniforms=l.s_codeParser.m_uniforms}initialize(t,e,s){this.m_shdUniqueName=t,this.adaptationShaderVersion&&null==this.preCompileInfo&&n.default.IsWebGL1()&&(e=h.default.Es3VtxShaderToES2(e),s=h.default.Es3FragShaderToES2(s)),this.preCompileInfo,this.parseCode(e,s);let i=l.s_codeParser.attributes,o=0,_=i.length,u=null;this.m_attriNSList=[],this.m_attriSizeList=[],this.m_layoutBit=0;let m=31;while(o<_){if(u=i[o],null!=u)switch(this.m_attriNSList.push(u.name),this.m_attriSizeList.push(u.typeSize),a.default.GetVBufTypeByNS(u.name)){case a.default.VBUF_VS:m+=131*m+1,this.m_layoutBit|=r.default.BIT_ONE_0;break;case a.default.VBUF_UVS:m+=131*m+2,this.m_layoutBit|=r.default.BIT_ONE_1;break;case a.default.VBUF_NVS:m+=131*m+3,this.m_layoutBit|=r.default.BIT_ONE_2;break;case a.default.VBUF_CVS:m+=131*m+4,this.m_layoutBit|=r.default.BIT_ONE_3;break;case a.default.VBUF_TVS:m+=131*m+5,this.m_layoutBit|=r.default.BIT_ONE_4;break;case a.default.VBUF_VS2:m+=131*m+6,this.m_layoutBit|=r.default.BIT_ONE_5;break;case a.default.VBUF_UVS2:m+=131*m+7,this.m_layoutBit|=r.default.BIT_ONE_6;break;case a.default.VBUF_NVS2:m+=131*m+8,this.m_layoutBit|=r.default.BIT_ONE_7;break;case a.default.VBUF_CVS2:m+=131*m+9,this.m_layoutBit|=r.default.BIT_ONE_8;break;case a.default.VBUF_TVS2:m+=131*m+11,this.m_layoutBit|=r.default.BIT_ONE_9;break;default:break}++o}this.m_mid=m,this.m_texTotal=l.s_codeParser.texTotal,this.m_useTex=this.m_texTotal>0,this.m_useTex&&(this.m_texUniformNames=l.s_codeParser.texUniformNameListStr.split(",")),this.m_haveCommonUniform=this.m_texTotal<this.m_uniforms.length,this.m_vshdCode=e,this.m_fshdCode=s,this.m_shdUniqueName=t}getAttriSizeList(){return this.m_attriSizeList}getTexUniformNames(){return this.m_texUniformNames}getUniforms(){return this.m_uniforms}haveCommonUniform(){return this.m_haveCommonUniform}getAttriNSList(){return this.m_attriNSList}getUid(){return this.m_uid}getTexTotal(){return this.m_texTotal}haveTexture(){return this.m_useTex}getLocationsTotal(){return this.m_aLocationTypes.length}getUniformTypeNameByNS(t){let e=this.m_uniformDict.get(t);return null!=e?e.typeName:""}getUniformTypeByNS(t){let e=this.m_uniformDict.get(t);return null!=e?e.type:0}hasUniformByName(t){return this.m_uniformDict.has(t)}getUniformLengthByNS(t){return this.m_uniformDict.has(t)&&this.m_uniformDict.get(t).arrLength,0}getUniqueShaderName(){return this.m_shdUniqueName}destroy(){this.m_texTotal=0}}l.s_uid=0,l.s_codeParser=new o.default,e.default=l},af29:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("722e")),a=i(s("8333")),n=s("8d98"),h=i(s("cfaf")),o=i(s("3930")),l=i(s("baae"));class _{constructor(t,e){this.m_backBufferColor=new o.default,this.m_adapter=null,this.m_renderProxy=null,this.m_rcontext=null,this.m_bgColor=new o.default,this.m_render=null,this.m_runFlag=!0,this.m_fboIndex=-1,this.m_fboType=-1,this.m_initW=128,this.m_initH=128,this.m_enableDepth=!0,this.m_enableStencil=!1,this.m_multisampleLevel=0,this.m_gMateiral=null,this.m_gRState=-1,this.m_rindexs=[],this.m_texs=[null,null,null,null,null,null,null,null],this.m_texStore=null,this.m_texsTot=0,this.m_synFBOSizeWithViewport=!0,this.m_fboSizeFactor=1,this.m_clearDepth=256,this.m_clearColorBoo=!0,this.m_clearDepthBoo=!0,this.m_clearStencilBoo=!1,this.m_viewportLock=!1,this.m_texUnlock=!1,this.m_render=t,this.m_texStore=e,this.m_renderProxy=t.getRenderProxy(),this.m_adapter=this.m_renderProxy.getRenderAdapter(),this.m_rcontext=t.getRendererContext()}getFBOUid(){return this.m_fboIndex}setRProcessIDList(t){if(t.length<1)throw Error("list.length < 1, but must: list.length >= 1");this.m_rindexs=t}setRProcessList(t){if(t.length<1)throw Error("list.length < 1, but must: list.length >= 1");this.m_rindexs=new Array(t.length);for(let e=0;e<t.length;++e)this.m_rindexs[e]=t[e].getRPIndex()}getRProcessIDAt(t){return this.m_rindexs[t]}getStage3D(){return this.m_renderProxy.getStage3D()}getCamera(){return null!=this.m_renderProxy?this.m_renderProxy.getCamera():null}lockViewport(){this.m_viewportLock=!0}unlockViewport(){this.m_viewportLock=!1}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}updateCameraDataFromCamera(t){null!=this.m_renderProxy&&this.m_renderProxy.updateCameraDataFromCamera(t)}useGlobalRenderState(t){this.m_rcontext.useGlobalRenderState(t)}useGlobalRenderStateByName(t){this.m_rcontext.useGlobalRenderStateByName(t)}setGlobalRenderState(t){this.m_gRState=t}setGlobalRenderStateByName(t){this.m_gRState=this.m_rcontext.getRenderStateByName(t)}lockRenderState(){this.m_gRState>=0?this.m_rcontext.useGlobalRenderState(this.m_gRState):this.m_renderProxy.lockRenderState()}unlockRenderState(){this.m_renderProxy.unlockRenderState()}useGlobalMaterial(t,e=!1){this.m_texUnlock=e,this.m_rcontext.useGlobalMaterial(t,this.m_texUnlock)}setGlobalMaterial(t,e=!1){this.m_texUnlock=e,this.m_gMateiral!=t&&(null!=this.m_gMateiral&&this.m_gMateiral.__$detachThis(),null!=t&&t.__$attachThis()),this.m_gMateiral=t}lockMaterial(){null!=this.m_gMateiral?this.m_rcontext.useGlobalMaterial(this.m_gMateiral,this.m_texUnlock):this.m_rcontext.lockMaterial()}unlockMaterial(){this.m_rcontext.unlockMaterial()}synFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!0}asynFBOSizeWithViewport(){this.m_synFBOSizeWithViewport=!1}setFBOSizeFactorWithViewPort(t){this.m_fboSizeFactor=t}createViewportSizeFBOAt(t,e=!1,s=!1,i=0){this.m_fboIndex<0&&(this.m_fboIndex=t,this.m_fboType=l.default.FRAMEBUFFER,this.m_initW=this.m_adapter.getViewportWidth(),this.m_initH=this.m_adapter.getViewportHeight(),this.m_enableDepth=e,this.m_enableStencil=s,this.m_multisampleLevel=i,this.m_adapter.createFBOAt(t,this.m_fboType,this.m_initW,this.m_initH,e,s,i))}createFBO(t,e,s=0){this.m_enableDepth=t,this.m_enableStencil=e,this.m_multisampleLevel=s,this.m_adapter.createFBOAt(this.m_fboIndex,this.m_fboType,this.m_initW,this.m_initH,t,e,s)}createAutoSizeFBOAt(t,e=!1,s=!1,i=0){t>=0&&this.m_fboIndex<0&&(this.m_fboType=l.default.FRAMEBUFFER,this.m_initW=512,this.m_initH=512,this.m_fboIndex=t,this.createFBO(e,s,i))}createFBOAt(t,e,s,i=!1,r=!1,a=0){t>=0&&this.m_fboIndex<0&&(this.m_fboType=l.default.FRAMEBUFFER,this.m_initW=e,this.m_initH=s,this.m_fboIndex=t,this.m_initW<1&&(this.m_initW=this.m_adapter.getRCanvasWidth()),this.m_initH<1&&(this.m_initH=this.m_adapter.getRCanvasHeight()),this.createFBO(i,r,a))}createReadFBOAt(t,e,s,i=!1,r=!1,a=0){t>=0&&this.m_fboIndex<0&&(this.m_fboType=l.default.READ_FRAMEBUFFER,this.m_initW=e,this.m_initH=s,this.m_fboIndex=t,this.m_initW<1&&(this.m_initW=this.m_adapter.getRCanvasWidth()),this.m_initH<1&&(this.m_initH=this.m_adapter.getRCanvasHeight()),this.createFBO(i,r,a))}createDrawFBOAt(t,e,s,i=!1,r=!1,a=0){t>=0&&this.m_fboIndex<0&&(this.m_fboType=l.default.DRAW_FRAMEBUFFER,this.m_initW=e,this.m_initH=s,this.m_fboIndex=t,this.m_initW<1&&(this.m_initW=this.m_adapter.getRCanvasWidth()),this.m_initH<1&&(this.m_initH=this.m_adapter.getRCanvasHeight()),this.createFBO(i,r,a))}resizeFBOAt(t,e,s){t>=0&&this.m_fboIndex<0&&this.m_adapter.resizeFBOAt(t,e,s)}resizeFBO(t,e){this.m_adapter.resizeFBOAt(this.m_fboIndex,t,e)}getRTTAt(t){return this.m_texs[t]}enableMipmapRTTAt(t){this.m_texs[t].enableMipmap()}generateMipmapTextureAt(t){this.m_texs[t].generateMipmap(this.m_renderProxy.Texture)}setRenderToTexture(t,e=0){return 0==e?this.m_texsTot=1:this.m_texsTot<e+1&&(this.m_texsTot=e+1),this.m_texs[e]=t,t}setRenderToRTTTextureAt(t,e=0){this.setRenderToTexture(this.m_texStore.getRTTTextureAt(t),e)}setRenderToFloatTextureAt(t,e=0){this.setRenderToTexture(this.m_texStore.getRTTFloatTextureAt(t),e)}setRenderToHalfFloatTexture(t,e=0){return null==t&&(t=new h.default(128,128),t.__$setRenderProxy(this.m_renderProxy),t.internalFormat=n.TextureFormat.RGBA16F,t.srcFormat=n.TextureFormat.RGBA,t.dataType=n.TextureDataType.FLOAT,t.minFilter=n.TextureConst.LINEAR,t.magFilter=n.TextureConst.LINEAR,t.__$setRenderProxy(this.m_renderProxy)),this.setRenderToTexture(t,e)}setRenderToRGBATexture(t,e=0){return null==t&&(t=new h.default(32,32),t.internalFormat=n.TextureFormat.RGBA,t.srcFormat=n.TextureFormat.RGBA,t.dataType=n.TextureDataType.UNSIGNED_BYTE,t.minFilter=n.TextureConst.LINEAR,t.magFilter=n.TextureConst.LINEAR,t.__$setRenderProxy(this.m_renderProxy)),this.setRenderToTexture(t,e)}setRenderToDepthTextureAt(t,e=0){return this.setRenderToTexture(this.m_texStore.getDepthTextureAt(t),e)}setClearState(t,e,s=!1){this.m_clearColorBoo=t,this.m_clearDepthBoo=e,this.m_clearStencilBoo=s}setRenderToBackBuffer(){this.m_renderProxy.setClearColor(this.m_backBufferColor),this.m_rcontext.setRenderToBackBuffer()}setClearDepth(t){this.m_clearDepth=t}getClearDepth(){return this.m_adapter.getClearDepth()}getViewX(){return this.m_adapter.getViewportX()}getViewY(){return this.m_adapter.getViewportY()}getViewWidth(){return this.m_adapter.getViewportWidth()}getViewHeight(){return this.m_adapter.getViewportHeight()}getFBOWidth(){return this.m_adapter.getFBOWidthAt(this.m_fboIndex)}getFBOHeight(){return this.m_adapter.getFBOHeightAt(this.m_fboIndex)}resetAttachmentMask(t){this.m_adapter.resetFBOAttachmentMask(t)}setAttachmentMaskAt(t,e){this.m_adapter.setFBOAttachmentMaskAt(t,e)}setClearRGBColor3f(t,e,s){this.m_bgColor.setRGB3f(t,e,s)}setClearColorEnabled(t){this.m_clearColorBoo=t}setClearDepthEnabled(t){this.m_clearDepthBoo=t}setClearStencilEnabled(t){this.m_clearStencilBoo=t}setClearUint24Color(t,e=1){this.m_bgColor.setRGBUint24(t),this.m_bgColor.a=e}setClearRGBAColor4f(t,e,s,i){this.m_bgColor.setRGBA4f(t,s,e,i)}blitFrom(t,e=a.default.COLOR_BUFFER_BIT,s=r.default.NEAREST,i=-1,n=0,h=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,e,s,i,n,h))}blitColorFrom(t,e=r.default.NEAREST,s=-1,i=0,n=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,a.default.COLOR_BUFFER_BIT,e,s,i,n))}blitDepthFrom(t,e=r.default.NEAREST,s=-1,i=0,n=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,a.default.COLOR_BUFFER_BIT|a.default.DEPTH_BUFFER_BIT,e,s,i,n))}blitColorAndDepthFrom(t,e=r.default.NEAREST,s=-1,i=0,n=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,a.default.COLOR_BUFFER_BIT|a.default.DEPTH_BUFFER_BIT,e,s,i,n))}blitStencilFrom(t,e=r.default.NEAREST,s=-1,i=0,n=null){this.m_fboIndex>=0&&(this.m_adapter.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.m_adapter.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.m_adapter.blitFBO(t.getFBOUid(),this.m_fboIndex,a.default.STENCIL_BUFFER_BIT,e,s,i,n))}renderToTextureAt(t,e=0){this.m_adapter.setRenderToTexture(this.m_texs[t],this.m_enableDepth,this.m_enableStencil,e),this.m_adapter.useFBO(this.m_clearColorBoo,this.m_clearDepthBoo,this.m_clearStencilBoo)}runBeginDo(){if(this.m_runFlag){this.m_runFlag=!1,this.m_renderProxy.getClearRGBAColor4f(this.m_backBufferColor),this.m_viewportLock?this.m_adapter.lockViewport():this.m_adapter.unlockViewport(),this.m_adapter.bindFBOAt(this.m_fboIndex,this.m_fboType),this.m_synFBOSizeWithViewport?(this.m_adapter.synFBOSizeWithViewport(),this.m_adapter.setFBOSizeFactorWithViewPort(this.m_fboSizeFactor)):this.m_adapter.asynFBOSizeWithViewport(),this.m_clearDepth<128&&this.m_adapter.setClearDepth(this.m_clearDepth),this.m_renderProxy.setClearColor(this.m_bgColor);let t=0;for(;t<this.m_texsTot;++t)this.m_adapter.setRenderToTexture(this.m_texs[t],this.m_enableDepth,this.m_enableStencil,t);this.m_adapter.useFBO(this.m_clearColorBoo,this.m_clearDepthBoo,this.m_clearStencilBoo),null!=this.m_gMateiral?this.m_rcontext.useGlobalMaterial(this.m_gMateiral,this.m_texUnlock):this.m_rcontext.unlockMaterial()}}run(t=!1,e=!1,s=!0,i=!0){if(t&&this.lockRenderState(),e&&!i&&this.lockMaterial(),this.m_fboIndex>=0&&null!=this.m_rindexs){i&&this.runBeginDo();for(let t=0,e=this.m_rindexs.length;t<e;++t)this.m_render.runAt(this.m_rindexs[t])}this.m_runFlag=!0,t&&this.unlockRenderState(),e&&this.unlockMaterial(),s&&this.runEnd()}runAt(t,e=!0){this.m_fboIndex>=0&&null!=this.m_rindexs&&(0==t&&e?this.runBeginDo():this.m_runFlag=!0,this.m_render.runAt(this.m_rindexs[t]))}drawEntity(t,e=!1,s=!0){this.m_runFlag||this.m_render.drawEntity(t,e,s)}runBegin(){this.m_fboIndex>=0&&null!=this.m_rindexs&&(this.m_runFlag=!0,this.runBeginDo())}runEnd(){this.m_renderProxy.setClearColor(this.m_backBufferColor),this.m_runFlag=!0,this.m_viewportLock&&this.m_adapter.unlockViewport()}useCamera(t,e=!1){this.m_render.useCamera(t,e)}useMainCamera(){this.m_render.useMainCamera()}reset(){let t=0;for(;t<this.m_texsTot;++t)this.m_texs[t]=null;this.m_runFlag=!1,this.m_fboIndex=-1,this.m_texsTot=0,this.m_rindexs=[],null!=this.m_gMateiral&&(this.m_gMateiral.__$detachThis(),this.m_gMateiral=null)}clone(){let t=new _(this.m_render,this.m_texStore);t.m_fboSizeFactor=this.m_fboSizeFactor,t.m_bgColor.copyFrom(this.m_bgColor),t.m_fboIndex=this.m_fboIndex,t.m_fboType=this.m_fboType,t.m_clearDepth=this.m_clearDepth,t.m_texsTot=this.m_texsTot,t.m_enableDepth=this.m_enableDepth,t.m_enableStencil=this.m_enableStencil,t.m_synFBOSizeWithViewport=this.m_synFBOSizeWithViewport,t.m_initW=this.m_initW,t.m_initH=this.m_initH,t.m_multisampleLevel=this.m_multisampleLevel;let e=0;for(;e<this.m_texsTot;++e)t.m_texs[e]=t.m_texs[e];if(null!=this.m_rindexs){let s=this.m_rindexs.length,i=new Array(s);for(e=0;e<s;++e)i[e]=this.m_rindexs[e];t.setRProcessIDList(i)}return t}}e.default=_},af68:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=i(s("7b0e"));class n{constructor(){this.m_nodeListLen=0,this.m_nodeIdList=[],this.m_nodeList=[],this.m_entityList=[],this.m_nodeFlagList=[],this.m_freeIdList=[]}getFreeId(){return this.m_freeIdList.length>0?this.m_freeIdList.pop():-1}createNode(){let t=this.getFreeId();if(t>=0)return this.m_nodeFlagList[t]=1,this.m_nodeList[t];{t=this.m_nodeListLen;let e=a.default.Create();return this.m_nodeList.push(e),this.m_entityList.push(null),e.spaceId=t,this.m_nodeFlagList.push(1),this.m_nodeIdList.push(t),this.m_nodeFlagList.push(1),this.m_nodeListLen++,e}}restoreId(t){t>0&&1==this.m_nodeFlagList[t]&&(this.m_freeIdList.push(t),this.m_nodeFlagList[t]=0,this.m_entityList[t]=null)}addEntity(t){let e=this.createNode();return this.m_entityList[e.spaceId]=t,e.entity=t,t.__$rseFlag=r.default.AddSpaceUid(t.__$rseFlag,e.spaceId),e}initialize(t){if(t>0)for(let e=0;e<t;e++){let t=this.createNode();this.m_entityList[t.spaceId]=null}}getNodeByEntity(t){if(r.default.TestSpaceContains(t.__$rseFlag)){let e=r.default.GetSpaceUid(t.__$rseFlag);if(this.m_entityList[e]==t)return this.m_nodeList[e]}return null}removeEntity(t){if(r.default.TestSpaceContains(t.__$rseFlag)){let e=r.default.GetSpaceUid(t.__$rseFlag);this.m_entityList[e]==t&&(this.m_nodeList[e].entity=null,this.restoreId(e),t.__$rseFlag=r.default.RemoveSpaceUid(t.__$rseFlag))}}toString(){return"[EntityNodeQueue()]"}}e.default=n},b02c:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{constructor(t,e){this.m_uid=-1,this.m_mid=-1,this.m_texTotal=0,this.m_gtexList=null,this.m_samplers=null,this.m_texList=null,this.m_rcuid=0,this.m_texRes=null,this.direct=!0,this.m_attachCount=0,this.m_rcuid=t,this.m_uid=a.s_uid++,this.m_mid=e}__$setParam(t,e){this.m_rcuid=t,this.m_mid=e}getRCUid(){return this.m_rcuid}getMid(){return this.m_mid}getTexTotal(){return this.m_texTotal}collectTexList(t,e,s){this.m_texRes=t;let i=0;if(this.direct)if(this.m_texTotal<1&&e.length>0){let a,n=r.default.GetNearestCeilPow2(e.length);this.m_samplers=new Uint16Array(n),this.m_gtexList=new Array(n),this.m_texList=e;while(i<s)a=e[i],a.__$attachThis(),a.__$$upload(t),this.m_samplers[i]=a.getSampler(),this.m_gtexList[i]=this.m_texRes.getGpuBuffer(a.getResUid()),this.m_texRes.__$attachRes(a.getResUid()),i++;this.m_texTotal=i}else this.m_texTotal=0;else this.m_texTotal=s;while(i<e.length)e[i++].__$attachThis()}run(){if(this.m_texRes.unlocked&&this.m_texRes.texMid!=this.m_mid){this.m_texRes.texMid=this.m_mid;let t=this.m_texRes.getRC(),e=t.TEXTURE0;if(this.direct)for(let s=0;s<this.m_texTotal;++s)t.activeTexture(e++),t.bindTexture(this.m_samplers[s],this.m_gtexList[s]);else{let s=this.m_texList;for(let i=0;i<this.m_texTotal;++i)t.activeTexture(e++),s[i].__$$use(this.m_texRes)}}}getUid(){return this.m_uid}__$attachThis(){++this.m_attachCount}__$detachThis(){--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0,a.Restore(this))}reset(){if(null!=this.m_texList)for(let t=0,e=this.m_texList.length;t<e;++t)this.m_texList[t].__$detachThis(),this.m_texRes.__$detachRes(this.m_texList[t].getResUid()),this.m_gtexList[t]=null;this.m_texTotal=0,this.m_texList=null,this.m_texRes=null}toString(){return"TextureRenderObj(uid = "+this.m_uid+", mid="+this.m_mid+")"}static Create(t,e,s){let i=e.length;if(i>0&&s>0){if(i<s)throw Error("There are fewer textures than in the shader : (need "+s+",but only have "+i+") !!!");let r=31,n=0,h=!0;while(n<s)r=131*r+e[n].getUid(),e[n].isDirect()||(h=!1),++n;let o=a.s_troMaps[t.getRCUid()],l=null;return o.has(r)?l=o.get(r):(l=a.s_freeTROList.length<1?new a(t.getRCUid(),r):a.s_freeTROList.pop(),l.collectTexList(t,e,s),o.set(r,l)),l.__$setParam(t.getRCUid(),r),l.direct=h,l}return null}static Restore(t){t.getMid()>-1&&(a.s_troMaps[t.getRCUid()].delete(t.getMid()),t.__$setParam(0,0),a.s_freeTROList.push(t),t.reset())}static GetByMid(t,e){return a.s_troMaps[t].get(e)}}a.s_uid=0,a.s_troMaps=[new Map,new Map,new Map,new Map,new Map,new Map,new Map,new Map],a.s_freeTROList=[],a.s_unloacked=!0,a.s_preMid=-1,e.TextureRenderObj=a;class n{constructor(t){this.m_texRes=null,this.m_texRes=t}run(){this.m_texRes.renderBegin()}getMid(){return 1}__$attachThis(){}__$detachThis(){}}e.EmptyTexRenderObj=n,e.default=a},b0ef:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_canvas=null,this.m_div=null,this.m_divW=-1,this.m_divH=-1,this.resized=!0}setDiv(t){this.m_div=t}createViewEle(t,e){null==this.m_div&&(this.m_div=t.createElement("div"),this.m_div.style.width="400px",this.m_div.style.height="300px",document.body.appendChild(this.m_div)),this.m_div.style.display="bolck",this.m_div.style.position="absolute",""==this.m_div.style.left&&(this.m_div.style.left="0px",this.m_div.style.top="0px"),e&&(this.m_div.style.width="100%",this.m_div.style.height="100%"),null==this.m_canvas&&(this.m_canvas=document.createElement("canvas"),this.m_div.appendChild(this.m_canvas),this.m_canvas.width=800,this.m_canvas.height=600,this.m_canvas.style.display="bolck",this.m_canvas.style.left="0px",this.m_canvas.style.top="0px",this.m_canvas.style.position="absolute")}setDivStyleLeftAndTop(t,e){this.m_div.style.left=t+"px",this.m_div.style.top=e+"px"}setDivStyleSize(t,e){this.m_divW==t&&this.m_divH==e||(this.m_div.style.width=t+"px",this.m_div.style.height=e+"px",this.resized=!0)}getDiv(){return this.m_div}getCanvas(){return this.m_canvas}}e.default=i},b161:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("3806")),n=i(s("c51d")),h=i(s("c497")),o=i(s("af68")),l=i(s("a80a")),_=i(s("9c4d")),u=i(s("d958")),m=i(s("5d04")),d=i(s("a446")),c=i(s("c711")),f=i(s("955e")),p=i(s("765c")),g=i(s("af29")),v=i(s("d7e2")),x=i(s("70f2")),y=i(s("2139"));class T{constructor(){this.m_uid=-1,this.m_adapter=null,this.m_renderProxy=null,this.m_shader=null,this.m_rcontext=null,this.m_renderer=null,this.m_processids=new Uint8Array(128),this.m_processidsLen=0,this.m_rspace=null,this.m_mouse_rltv=new r.default,this.m_mouse_rlpv=new r.default,this.m_evtFlowEnabled=!1,this.m_evt3DCtr=null,this.m_mouseEvtEnabled=!0,this.m_viewX=0,this.m_viewY=0,this.m_viewW=800,this.m_viewH=800,this.m_nodeWaitLinker=null,this.m_nodeWaitQueue=null,this.m_camDisSorter=null,this.m_subscList=[],this.m_subscListLen=0,this.m_runFlag=-1,this.m_autoRunning=!0,this.m_processUpdate=!1,this.m_tickId=-1,this.m_rparam=null,this.runnableQueue=new _.default,this.textureBlock=new m.default,this.stage3D=null,this.m_children=[],this.m_childrenTotal=0,this.m_currCamera=null,this.m_mouseTestBoo=!0,this.m_cullingTestBoo=!0,this.m_rayTestFlag=!0,this.m_rayTestEnabled=!0,this.m_uid=T.s_uid++}tickUpdate(){this.m_tickId>-1&&clearTimeout(this.m_tickId),this.m_tickId=setTimeout(this.tickUpdate.bind(this),this.m_rparam.getTickUpdateTime()),this.textureBlock.run()}getUid(){return this.m_uid}getDiv(){return this.m_renderProxy.getDiv()}getCanvas(){return this.m_renderProxy.getCanvas()}getRPONodeBuilder(){return null}getRenderProxy(){return this.m_renderProxy}setViewPort(t,e,s,i){null!=this.m_renderProxy&&(this.m_viewX=t,this.m_viewY=e,this.m_viewW=s,this.m_viewH=i,this.m_renderProxy.setViewPort(t,e,s,i))}setViewPortFromCamera(t){null!=this.m_renderProxy&&null!=t&&(this.m_viewX=t.getViewX(),this.m_viewY=t.getViewY(),this.m_viewW=t.getViewWidth(),this.m_viewH=t.getViewHeight(),this.m_renderProxy.setViewPort(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH))}reseizeViewPort(){this.m_renderProxy.reseizeRCViewPort()}lockViewport(){this.m_adapter.lockViewport()}unlockViewport(){this.m_adapter.unlockViewport()}getRendererAdapter(){return this.m_adapter}getRenderer(){return this.m_renderer}getRendererContext(){return this.m_rcontext}getStage3D(){return this.m_renderProxy.getStage3D()}getViewWidth(){return this.m_renderProxy.getStage3D().viewWidth}getViewHeight(){return this.m_renderProxy.getStage3D().viewHeight}getCamera(){return this.m_renderProxy.getCamera()}asynFBOSizeWithViewport(){this.m_rcontext.asynFBOSizeWithViewport()}synFBOSizeWithViewport(){this.m_rcontext.synFBOSizeWithViewport()}cameraLock(){this.m_renderProxy.cameraLock()}cameraUnlock(){this.m_renderProxy.cameraUnlock()}getMouseXYWorldRay(t,e){this.m_renderProxy.getMouseXYWorldRay(t,e)}createCamera(){return new n.default}createFBOInstance(){return new g.default(this,this.textureBlock.getRTTStrore())}setClearUint24Color(t,e=1){this.m_renderProxy.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,s){this.m_renderProxy.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.m_renderProxy.setClearRGBAColor4f(t,e,s,i)}setClearColor(t){this.m_renderProxy.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.m_rcontext.setRenderToBackBuffer()}drawBackBufferToCanvas(t){let e=this.getCanvas();var s=t.getContext("2d");s.drawImage(e,0,0,t.width,t.height)}updateRenderBufferSize(){this.m_adapter.updateRenderBufferSize()}setEvt3DController(t){null!=t&&(t.initialize(this.getStage3D(),this.getStage3D()),t.setRaySelector(this.m_rspace.getRaySelector())),this.m_evt3DCtr=t}isRayPickSelected(){return null!=this.m_evt3DCtr&&this.m_evt3DCtr.isSelected()}enableMouseEvent(t=!0){null==this.m_evt3DCtr&&(t?this.m_rspace.setRaySelector(new f.default):this.m_rspace.setRaySelector(new c.default),this.setEvt3DController(new p.default)),this.m_mouseEvtEnabled=!0}disableMouseEvent(){this.m_mouseEvtEnabled=!1}getEvt3DController(){return this.m_evt3DCtr}getSpace(){return this.m_rspace}getDevicePixelRatio(){return this.m_adapter.getDevicePixelRatio()}createSubScene(){if(null!=this.m_renderer){let t=new x.default(this,this.m_renderer,this.m_evtFlowEnabled);this.m_subscList.push(t),this.m_subscListLen++;let e=t;return e.textureBlock=this.textureBlock,t}return null}addEventListener(t,e,s,i=!0,r=!1){this.stage3D.addEventListener(t,e,s,i,r)}removeEventListener(t,e,s){this.stage3D.removeEventListener(t,e,s)}initialize(t=null,e=3){if(null==this.m_renderer){null==t&&(t=new h.default),this.m_rparam=t;let s=this;s.stage3D=new a.default(this.getUid(),document),e<1&&(e=1),e>8&&(e=8),this.m_evtFlowEnabled=t.evtFlowEnabled,this.m_renderer=new u.default,this.m_renderer.__$setStage3D(this.stage3D),y.default.Allocate(t.getMatrix4AllocateSize());let i=new n.default;this.m_renderer.initialize(t,i),this.m_processids[0]=0,this.m_processidsLen++;let r=null;for(;e>=0;)r=this.m_renderer.appendProcess(t.batchEnabled,t.processFixedState),this.m_processids[this.m_processidsLen]=r.getRPIndex(),this.m_processidsLen++,--e;this.m_rcontext=this.m_renderer.getRendererContext(),this.m_renderProxy=this.m_rcontext.getRenderProxy(),this.m_adapter=this.m_renderProxy.getRenderAdapter();let o=this.m_renderProxy.getStage3D();if(this.m_viewW=o.stageWidth,this.m_viewH=o.stageHeight,this.m_shader=this.m_renderer.getDataBuilder().getRenderShader(),this.textureBlock.setRenderer(this.m_renderer),this.m_camDisSorter=new v.default(this.m_renderProxy),null==this.m_rspace){let t=new d.default;t.initialize(this.m_renderer,this.m_renderProxy.getCamera()),this.m_rspace=t}this.tickUpdate()}}setRendererProcessParam(t,e,s){this.m_renderer.setRendererProcessParam(this.m_processids[t],e,s)}appendARendererProcess(t=!0,e=!1){let s=this.m_renderer.appendProcess(t,e);this.m_processids[this.m_processidsLen]=s.getRPIndex(),this.m_processidsLen++}addContainer(t,e=0){if(e<0&&(e=0),null!=t&&t.__$wuid<0&&t.__$contId<1){let s=0;for(;s<this.m_childrenTotal;++s)if(this.m_children[s]==t)return;s>=this.m_childrenTotal&&(t.__$wuid=this.m_uid,t.wprocuid=e,t.__$setRenderer(this),this.m_children.push(t),this.m_childrenTotal++)}}removeContainer(t){if(null!=t&&t.__$wuid==this.m_uid&&t.getRenderer()==this.m_renderer){let e=0;for(;e<this.m_childrenTotal;++e)if(this.m_children[e]==t){t.__$wuid=-1,t.wprocuid=-1,t.__$setRenderer(null),this.m_children.splice(e,1),--this.m_childrenTotal;break}}}setAutoRunningEnabled(t){this.m_autoRunning=t}setAutoRenderingSort(t){this.m_processUpdate=t}setProcessSortEnabledAt(t,e,s=null){if(this.m_renderer.setProcessSortEnabledAt(t,e),e){let e=this.m_renderer.getProcessAt(t);s=null!=s?s:this.m_camDisSorter,null!=e&&e.setSorter(s)}}setProcessSortEnabled(t,e,s=null){this.m_renderer.setProcessSortEnabled(t,e),e&&null!=t&&!t.hasSorter()&&(s=null!=s?s:this.m_camDisSorter,t.setSorter(s))}moveEntityTo(t,e){this.m_renderer.moveEntityToProcessAt(t,this.m_processids[e])}drawEntity(t,e=!1,s=!0){this.m_renderer.drawEntity(t,e,s)}addEntity(t,e=0,s=!0){if(t.__$testSpaceEnabled())if(t.isPolyhedral())if(t.hasMesh())this.m_renderer.addEntity(t,this.m_processids[e],s),null!=this.m_rspace&&this.m_rspace.addEntity(t);else{null==this.m_nodeWaitLinker&&(this.m_nodeWaitLinker=new l.default,this.m_nodeWaitQueue=new o.default);let s=this.m_nodeWaitQueue.addEntity(t);s.rstatus=e,this.m_nodeWaitLinker.addNode(s)}else this.m_renderer.addEntity(t,this.m_processids[e],s),null!=this.m_rspace&&this.m_rspace.addEntity(t)}removeEntity(t){let e=null;if(null!=this.m_nodeWaitLinker){let e=this.m_nodeWaitQueue.getNodeByEntity(t);null!=e&&(this.m_nodeWaitLinker.removeNode(e),this.m_nodeWaitQueue.removeEntity(t))}null==e&&(this.m_renderer.removeEntity(t),null!=this.m_rspace&&this.m_rspace.removeEntity(t))}updateMaterialUniformToCurrentShd(t){this.m_renderer.updateMaterialUniformToCurrentShd(t)}showInfoAt(t){this.m_renderer.showInfoAt(t)}getRenderUnitsTotal(){return this.m_renderer.getRenderUnitsTotal()}useCamera(t,e=!1){this.m_currCamera=t,e&&(this.m_renderProxy.setRCViewPort(t.getViewX(),t.getViewY(),t.getViewWidth(),t.getViewHeight(),!0),this.m_renderProxy.reseizeRCViewPort()),t.update(),this.m_rcontext.resetUniform(),this.m_renderProxy.updateCameraDataFromCamera(t)}useMainCamera(){this.m_currCamera=null;let t=this.m_renderProxy.getCamera();this.m_renderProxy.setRCViewPort(t.getViewX(),t.getViewY(),t.getViewWidth(),t.getViewHeight(),!0),this.m_renderProxy.reseizeRCViewPort(),this.m_renderProxy.updateCamera(),this.m_rcontext.resetUniform(),this.m_renderProxy.updateCameraDataFromCamera(this.m_renderProxy.getCamera())}updateCameraDataFromCamera(t){this.m_renderProxy.updateCameraDataFromCamera(t)}resetState(){this.m_rcontext.resetState()}resetUniform(){this.m_rcontext.resetUniform()}enableSynViewAndStage(){this.m_renderProxy.enableSynViewAndStage()}renderBegin(t=!0){if(null==this.m_currCamera){if(this.m_adapter.unlockViewport(),this.m_renderProxy.isAutoSynViewAndStage()){let t=this.m_renderProxy.testViewPortChanged(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH);this.m_viewX=this.m_renderProxy.getViewX(),this.m_viewY=this.m_renderProxy.getViewY(),this.m_viewW=this.m_renderProxy.getViewWidth(),this.m_viewH=this.m_renderProxy.getViewHeight(),t&&(this.m_renderProxy.setRCViewPort(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH,!0),this.m_renderProxy.reseizeRCViewPort())}else this.m_renderProxy.setViewPort(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH);this.m_renderProxy.updateCamera(),this.m_renderProxy.updateCameraDataFromCamera(this.m_renderProxy.getCamera())}this.m_shader.renderBegin(),t&&this.m_rcontext.renderBegin(null==this.m_currCamera),this.m_currCamera=null}runBegin(t=!0,e=!0){t&&this.m_autoRunning&&(this.m_runFlag>=0&&this.runEnd(),this.m_runFlag=0);let s=this.m_currCamera,i=null==s;this.renderBegin(e),null!=this.m_rspace&&(this.m_rspace.setCamera(i?this.m_renderProxy.getCamera():s),this.m_rspace.runBegin())}renderContextBegin(){this.m_rcontext.renderBegin()}setRayTestEanbled(t){this.m_rayTestEnabled=t}runMouseTest(t,e){let s=-1;if(null!=this.m_evt3DCtr&&this.m_mouseEvtEnabled){if(this.m_rayTestFlag&&this.m_evt3DCtr.getEvtType()>0){let t=this.m_rspace.getRaySelector();if(null!=t){this.m_rayTestEnabled?this.mouseRayTest():t.clear();let e=t.getSelectedNodesTotal();if(e>1){let s=0,i=t.getSelectedNodes(),r=null;for(;s<e;++s)r=i[s],r.entity.isPolyhedral()}}this.m_rayTestFlag=!1}s=this.m_evt3DCtr.run(t,e)}return this.m_mouseTestBoo=!1,s}update(t=!0,e=!0){if(this.stage3D.enterFrame(),t&&this.m_autoRunning&&(0!=this.m_runFlag&&this.runBegin(),this.m_runFlag=1),this.m_mouseTestBoo=!0,this.m_cullingTestBoo=!0,this.m_rayTestFlag=!0,null!=this.m_nodeWaitLinker){let t=this.m_nodeWaitLinker.getBegin();if(null!=t){let e,s,i;while(null!=t)t.entity.hasMesh()?(e=t,t=t.next,s=e.entity,i=e.rstatus,this.m_nodeWaitLinker.removeNode(e),this.m_nodeWaitQueue.removeEntity(e.entity),this.addEntity(s,i)):t=t.next}}let s=0;for(;s<this.m_childrenTotal;++s)this.m_children[s].update();this.m_renderer.update(),null!=this.m_rspace&&(this.m_rspace.update(),this.m_cullingTestBoo&&(null!=this.m_evt3DCtr||this.m_processUpdate||null!=this.m_rspace.getRaySelector())&&this.m_rspace.run()),this.m_processUpdate&&this.m_renderer.updateAllProcess(),this.m_mouseTestBoo&&!this.m_evtFlowEnabled&&(e?this.runMouseTest(1,0):null!=this.m_evt3DCtr&&this.m_evt3DCtr.mouseOutEventTarget())}cullingTest(){null!=this.m_rspace&&this.m_rspace.run(),this.m_cullingTestBoo=!1}mouseRayTest(){null!=this.m_rspace&&(this.m_renderProxy.getMouseXYWorldRay(this.m_mouse_rlpv,this.m_mouse_rltv),this.m_rspace.rayTest(this.m_mouse_rlpv,this.m_mouse_rltv))}run(t=!0){if(t&&this.m_autoRunning&&(1!=this.m_runFlag&&this.update(),this.m_runFlag=2),this.runnableQueue.run(),this.m_subscListLen>0)for(let e=0;e<this.m_processidsLen;++e)this.m_renderer.runAt(this.m_processids[e]);else this.m_renderer.run();t&&this.runEnd()}runAt(t){this.m_renderer.runAt(this.m_processids[t])}runEnd(){null!=this.m_evt3DCtr&&this.m_evt3DCtr.runEnd(),this.m_rcontext.runEnd(),null!=this.m_rspace&&this.m_rspace.runEnd(),this.m_autoRunning&&(this.m_runFlag=-1)}renderFlush(){null!=this.m_renderProxy&&this.m_renderProxy.flush()}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}toString(){return"[RendererScene(uid = "+this.m_uid+")]"}}T.s_uid=0,e.default=T},b168:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("427c")),n=i(s("e7d2")),h=i(s("fecb")),o=i(s("cb29")),l=s("e08e"),_=i(s("35fa")),u=i(s("3bda"));class m extends o.default{constructor(t=r.default.VTX_STATIC_DRAW){super(t),this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.moduleScale=1}getVS(){return this.m_vs}getUVS(){return this.m_uvs}getNVS(){return this.m_nvs}initialize(t,e=!1){if(null!=t){let e=t[0],s=e["position"],i=e["uv"],o=e["normal"],d=e["indices"];s=s.subarray(1),i=i.subarray(1),void 0==o?(o=new Float32Array(s.length),_.default.ClacTrisNormal(s,s.length,d.length/3,d,o)):o=o.subarray(1),this.m_vs=s,this.m_uvs=i,this.m_nvs=o,this.m_ivs=d,null==this.bounds&&(this.bounds=new h.default),this.drawMode=l.RenderDrawMode.ELEMENTS_TRIANGLES,this.isVBufEnabledAt(r.default.VBUF_UVS_INDEX);let c=null,f=1;this.isVBufEnabledAt(r.default.VBUF_UVS_INDEX)&&f++,this.isVBufEnabledAt(r.default.VBUF_NVS_INDEX)&&f++,c=new a.default(f);let p=t.length,g=0,v=0,x=0;for(let a=0;a<p;++a){e=t[a];let s=e["position"],i=e["uv"],n=e["normal"],h=e["indices"];if(s=s.subarray(1),i=i.subarray(1),void 0==n?(n=new Float32Array(s.length),_.default.ClacTrisNormal(s,s.length,h.length/3,h,n)):n=n.subarray(1),x=h.length,this.bounds.addXYZFloat32Arr(s),g>0)for(v=0;v<x;++v)h[v]+=g;g+=s.length/3,c.addAttributeDataAt(0,s,3),this.isVBufEnabledAt(r.default.VBUF_UVS_INDEX)&&c.addAttributeDataAt(1,i,2),this.isVBufEnabledAt(r.default.VBUF_NVS_INDEX)&&c.addAttributeDataAt(2,n,3),c.addIndexData(h)}this.bounds.update(),this.m_vbuf=n.default.CreateByBufDataSeparate(c,this.getBufDataUsage()),this.vtCount=c.getIndexDataLengthTotal(),this.vtxTotal=c.getVerticesTotal(),this.trisNumber=c.getTrianglesTotal(),u.default.ShowLog("listLen: "+p+",this.trisNumber: "+this.trisNumber),m.s_dracoVtxTotal+=this.vtxTotal,m.s_dracoTriTotal+=this.trisNumber,this.buildEnd()}}initialize2(t,e=!1){let s=t.attributes;this.m_vs=s["position"],this.m_uvs=s["uv"],this.m_nvs=s["normal"],this.m_ivs=t["index"],null==this.bounds&&(this.bounds=new h.default),this.bounds.addXYZFloat32Arr(this.m_vs),this.bounds.updateFast(),n.default.Reset(),n.default.AddFloat32Data(this.m_vs,3),n.default.AddFloat32Data(this.m_uvs,2),n.default.AddFloat32Data(this.m_nvs,3),n.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.m_vbuf=n.default.CreateBySaveDataSeparate(this.getBufDataUsage()),this.m_vbuf.setUintIVSData(this.m_ivs),this.vtCount=this.m_ivs.length,this.vtxTotal=this.vtCount/3,this.trisNumber=this.vtCount/3,this.drawMode=l.RenderDrawMode.ELEMENTS_TRIANGLES,this.buildEnd()}toString(){return"DracoMesh()"}__$destroy(){this.isResFree()&&(this.bounds=null,this.m_vs=null,this.m_uvs=null,this.m_nvs=null,super.__$destroy())}}m.s_dracoVtxTotal=0,m.s_dracoTriTotal=0,e.default=m},b30a:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("644c")),n=i(s("20ef"));class h{constructor(t,e,s){this.m_shdDict=new Map,this.m_shdList=[],this.m_shdListLen=0,this.m_sharedUniformList=[],this.m_unlocked=!0,this.m_texUnlocked=!1,this.m_preuid=-1,this.m_currShd=null,this.m_fragOutputTotal=1,this.m_rcuid=-1,this.m_rc=null,this.m_gpuProgram=null,this.m_adapter=null,this.m_guniform=null,this.m_uniform=null,this.m_transformUniform=null,this.drawFlag=-1,this.__$globalUniform=null,this.m_rcuid=t,this.m_adapter=s,this.m_rc=e}createResByParams3(t,e,s,i){return!1}getRC(){return this.m_rc}getGPUProgram(){return this.m_gpuProgram}getRCUid(){return this.m_rcuid}useTransUniform(t){this.m_transformUniform!=t&&(this.m_transformUniform=t,t.use(this))}useUniform(t){this.m_uniform!=t&&(this.m_uniform=t,t.use(this))}create(t){let e=t.getUniqueShaderName();if(this.m_shdDict.has(e))return this.m_shdDict.get(e);let s=new n.default(this.m_shdListLen);return s.setShdData(t),this.m_shdList[s.getUid()]=s,this.m_sharedUniformList[s.getUid()]=null,++this.m_shdListLen,this.m_shdDict.set(e,s),r.default.SHADERCODE_TRACE_ENABLED,s}findShdProgramByUid(t){return this.m_shdList[t]}findShdProgram(t){return this.m_shdDict.has(t)?this.m_shdDict.get(t):null}findShdProgramByShdData(t){return null!=t&&this.m_shdDict.has(t.getUniqueShaderName())?this.m_shdDict.get(t.getUniqueShaderName()):null}unlock(){this.m_unlocked=!0,this.__$globalUniform=null}isUnLocked(){return this.m_unlocked}lock(){this.m_unlocked=!1}textureUnlock(){this.m_texUnlocked=!0}isTextureUnLocked(){return this.m_texUnlocked}textureLock(){this.m_texUnlocked=!1}setSharedUniformByShd(t,e){this.m_sharedUniformList[t.getUid()]=e}getSharedUniformByShd(t){return this.m_sharedUniformList[t.getUid()]}getCurrFragOutputTotal(){return this.m_fragOutputTotal}hasResUid(t){return null!=this.m_shdList[t]}bindToGpu(t){if(this.m_unlocked&&t>-1&&t<this.m_shdListLen)if(this.m_preuid!=t){this.m_preuid=t;let e=this.m_shdList[t];this.m_fragOutputTotal=e.getFragOutputTotal(),this.m_fragOutputTotal,this.getActiveAttachmentTotal(),this.m_gpuProgram=e.getGPUProgram(),this.m_rc.useProgram(this.m_gpuProgram),e.useTexLocation();let s=this.m_sharedUniformList[e.getUid()];this.m_guniform=s;while(null!=s)s.use(this),s=s.next;this.m_currShd=e}else if(null==this.m_guniform&&null!=this.m_currShd){let t=this.m_sharedUniformList[this.m_currShd.getUid()];this.m_guniform=t;while(null!=t)t.use(this),t=t.next}}getGpuBuffer(t){return null}getCurrentShd(){return this.m_currShd}getCurrentShdUid(){return this.m_preuid}resetUniform(){this.m_uniform=null,this.m_transformUniform=null,this.m_guniform=null}renderBegin(){this.m_fragOutputTotal=1,this.m_preuid=-1,this.m_currShd=null,this.drawFlag=-1}update(){}destroy(){this.m_rc=null,this.m_adapter=null}useUniformToCurrentShd(t){this.m_uniform!=t&&(this.m_uniform,t.useByShd(this,this.m_currShd))}useUniform2ToCurrentShd(t,e){this.m_uniform!=t&&(this.m_uniform,t.useByShd(this,this.m_currShd)),this.m_transformUniform!=e&&(this.m_transformUniform,e.useByShd(this,this.m_currShd))}useUniformMat4(t,e){this.m_rc.uniformMatrix4fv(t,!1,e)}useUniformV2(t,e,s,i,r){switch(e){case a.default.SHADER_MAT4:r<1?this.m_rc.uniformMatrix4fv(t,!1,s):this.m_rc.uniformMatrix4fv(t,!1,s,r,16*i);break;case a.default.SHADER_MAT3:this.m_rc.uniformMatrix3fv(t,!1,s,0,9*i);break;case a.default.SHADER_VEC4FV:this.m_rc.uniform4fv(t,s,r,4*i);break;case a.default.SHADER_VEC3FV:this.m_rc.uniform3fv(t,s,r,3*i);break;case a.default.SHADER_VEC4:this.m_rc.uniform4f(t,s[0],s[1],s[2],s[3]);break;case a.default.SHADER_VEC3:this.m_rc.uniform3f(t,s[0],s[1],s[2]);break;case a.default.SHADER_VEC2:this.m_rc.uniform2f(t,s[0],s[1]);break;default:break}}useUniformV1(t,e,s,i){switch(e){case a.default.SHADER_MAT4:this.m_rc.uniformMatrix4fv(t,!1,s);break;case a.default.SHADER_MAT3:this.m_rc.uniformMatrix3fv(t,!1,s);break;case a.default.SHADER_VEC4FV:this.m_rc.uniform4fv(t,s,4*i);break;case a.default.SHADER_VEC3FV:this.m_rc.uniform3fv(t,s,3*i);break;case a.default.SHADER_VEC4:this.m_rc.uniform4f(t,s[0],s[1],s[2],s[3]);break;case a.default.SHADER_VEC3:this.m_rc.uniform3f(t,s[0],s[1],s[2]);break;case a.default.SHADER_VEC2:this.m_rc.uniform2f(t,s[0],s[1]);break;default:break}}getActiveAttachmentTotal(){return this.m_adapter.getActiveAttachmentTotal()}}e.default=h},b3bd:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uns="",this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,s=e.length;for(let i=0;i<s;++i)if(t==e[i])return this.dataList[i]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let s=this.uniformNameList,i=s.length;for(let r=0;r<i;++r)if(t==s[r]){this.dataList[r]=e;break}}}copyDataFromProbe(t){this.types=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]);this.uniformSize=t.uniformsTotal}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.calcModels=null}}e.default=i},b498:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("18c7")),a=i(s("ab73")),n=i(s("7279")),h=i(s("3077")),o=s("5216"),l=s("d846");class _{constructor(t=0){this.m_uProbe=null,this.m_suo=null,this.m_direcMatrix=null,this.m_params=null,this.m_offetMatrix=null,this.m_camVersion=-1,this.m_dirty=!1,this.m_uslotIndex=0,this.m_uslotIndex=t}useShaderPipe(t,e){null!=this.m_uProbe&&(t.addDefine("VOX_USE_SHADOW","1"),t.addVarying("vec4","v_shadowPos"),t.addFragUniformParam(a.default.ShadowVSMParams),t.addVertUniformParam(a.default.ShadowMatrix),t.addShaderObject(l.VSMShaderCode))}getPipeTypes(){return[o.MaterialPipeType.VSM_SHADOW]}getPipeKey(t){switch(t){case o.MaterialPipeType.VSM_SHADOW:return"["+t+"]";default:break}return""}useUniforms(t){null!=this.m_uProbe&&(t.addDefine("VOX_USE_SHADOW","1"),t.addFragUniformParam(a.default.ShadowVSMParams),t.addVertUniformParam(a.default.ShadowMatrix),t.addFragFunction(l.VSMShaderCode.frag_head),t.addVertFunction(l.VSMShaderCode.vert_head),t.addVarying("vec4","v_shadowPos"))}initialize(){null==this.m_uProbe&&(this.m_direcMatrix=new r.default,this.m_offetMatrix=new r.default,this.m_offetMatrix.identity(),this.m_offetMatrix.setScaleXYZ(.5,.5,.5),this.m_offetMatrix.setTranslationXYZ(.5,.5,.5),this.m_params=new Float32Array([-5e-4,0,4,.8,512,512,.1,0,1,1,1,0]),this.m_uProbe=new h.default,this.m_uProbe.bindSlotAt(this.m_uslotIndex),this.m_uProbe.addMat4Data(this.m_direcMatrix.getLocalFS32(),1),this.m_uProbe.addVec4Data(this.m_params,a.default.ShadowVSMParams.arrayLength),this.m_suo=new n.default,this.m_suo.uniformNameList=[a.default.ShadowMatrix.name,a.default.ShadowVSMParams.name],this.m_suo.copyDataFromProbe(this.m_uProbe),this.m_uProbe.update())}getGlobalUinform(){return this.m_suo.clone()}getGlobalUinformAt(t){let e=new n.default;return e.copyDataFromProbeAt(t,this.m_uProbe),e}updateShadowCamera(t){this.m_camVersion!=t.version&&(this.m_camVersion=t.version,this.m_direcMatrix.copyFrom(t.getVPMatrix()),this.m_direcMatrix.append(this.m_offetMatrix),this.setDirec(t.getNV()),this.m_dirty=!0)}setShadowParam(t,e,s){this.m_params[0]=t,this.m_params[1]=e,this.m_params[2]=s,this.m_dirty=!0}setShadowIntensity(t){this.m_params[3]=t,this.m_dirty=!0}setColorIntensity(t){this.m_params[6]=t,this.m_dirty=!0}setShadowRadius(t){this.m_params[2]=t,this.m_dirty=!0}setShadowBias(t){this.m_params[0]=t,this.m_dirty=!0}setShadowSize(t,e){this.m_params[4]=t,this.m_params[5]=e,this.m_dirty=!0}setDirec(t){this.m_params[8]=-t.x,this.m_params[9]=-t.y,this.m_params[10]=-t.z,this.m_dirty=!0}upadate(){this.m_dirty&&null!=this.m_uProbe&&(this.m_dirty=!1,this.m_uProbe.update())}}e.default=_},b639:function(t,e,s){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var i=s("1fb5"),r=s("9152"),a=s("e3db");function n(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"===typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(e){return!1}}function h(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(t,e){if(h()<e)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e),t.__proto__=l.prototype):(null===t&&(t=new l(e)),t.length=e),t}function l(t,e,s){if(!l.TYPED_ARRAY_SUPPORT&&!(this instanceof l))return new l(t,e,s);if("number"===typeof t){if("string"===typeof e)throw new Error("If encoding is specified then the first argument must be a string");return d(this,t)}return _(this,t,e,s)}function _(t,e,s,i){if("number"===typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&e instanceof ArrayBuffer?p(t,e,s,i):"string"===typeof e?c(t,e,s):g(t,e)}function u(t){if("number"!==typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function m(t,e,s,i){return u(e),e<=0?o(t,e):void 0!==s?"string"===typeof i?o(t,e).fill(s,i):o(t,e).fill(s):o(t,e)}function d(t,e){if(u(e),t=o(t,e<0?0:0|v(e)),!l.TYPED_ARRAY_SUPPORT)for(var s=0;s<e;++s)t[s]=0;return t}function c(t,e,s){if("string"===typeof s&&""!==s||(s="utf8"),!l.isEncoding(s))throw new TypeError('"encoding" must be a valid string encoding');var i=0|y(e,s);t=o(t,i);var r=t.write(e,s);return r!==i&&(t=t.slice(0,r)),t}function f(t,e){var s=e.length<0?0:0|v(e.length);t=o(t,s);for(var i=0;i<s;i+=1)t[i]=255&e[i];return t}function p(t,e,s,i){if(e.byteLength,s<0||e.byteLength<s)throw new RangeError("'offset' is out of bounds");if(e.byteLength<s+(i||0))throw new RangeError("'length' is out of bounds");return e=void 0===s&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,s):new Uint8Array(e,s,i),l.TYPED_ARRAY_SUPPORT?(t=e,t.__proto__=l.prototype):t=f(t,e),t}function g(t,e){if(l.isBuffer(e)){var s=0|v(e.length);return t=o(t,s),0===t.length?t:(e.copy(t,0,0,s),t)}if(e){if("undefined"!==typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!==typeof e.length||et(e.length)?o(t,0):f(t,e);if("Buffer"===e.type&&a(e.data))return f(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function v(t){if(t>=h())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+h().toString(16)+" bytes");return 0|t}function x(t){return+t!=t&&(t=0),l.alloc(+t)}function y(t,e){if(l.isBuffer(t))return t.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!==typeof t&&(t=""+t);var s=t.length;if(0===s)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return s;case"utf8":case"utf-8":case void 0:return q(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*s;case"hex":return s>>>1;case"base64":return J(t).length;default:if(i)return q(t).length;e=(""+e).toLowerCase(),i=!0}}function T(t,e,s){var i=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===s||s>this.length)&&(s=this.length),s<=0)return"";if(s>>>=0,e>>>=0,s<=e)return"";t||(t="utf8");while(1)switch(t){case"hex":return U(this,e,s);case"utf8":case"utf-8":return B(this,e,s);case"ascii":return N(this,e,s);case"latin1":case"binary":return I(this,e,s);case"base64":return L(this,e,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,e,s);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}function b(t,e,s){var i=t[e];t[e]=t[s],t[s]=i}function S(t,e,s,i,r){if(0===t.length)return-1;if("string"===typeof s?(i=s,s=0):s>2147483647?s=2147483647:s<-2147483648&&(s=-2147483648),s=+s,isNaN(s)&&(s=r?0:t.length-1),s<0&&(s=t.length+s),s>=t.length){if(r)return-1;s=t.length-1}else if(s<0){if(!r)return-1;s=0}if("string"===typeof e&&(e=l.from(e,i)),l.isBuffer(e))return 0===e.length?-1:E(t,e,s,i,r);if("number"===typeof e)return e&=255,l.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,s):Uint8Array.prototype.lastIndexOf.call(t,e,s):E(t,[e],s,i,r);throw new TypeError("val must be string, number or Buffer")}function E(t,e,s,i,r){var a,n=1,h=t.length,o=e.length;if(void 0!==i&&(i=String(i).toLowerCase(),"ucs2"===i||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return-1;n=2,h/=2,o/=2,s/=2}function l(t,e){return 1===n?t[e]:t.readUInt16BE(e*n)}if(r){var _=-1;for(a=s;a<h;a++)if(l(t,a)===l(e,-1===_?0:a-_)){if(-1===_&&(_=a),a-_+1===o)return _*n}else-1!==_&&(a-=a-_),_=-1}else for(s+o>h&&(s=h-o),a=s;a>=0;a--){for(var u=!0,m=0;m<o;m++)if(l(t,a+m)!==l(e,m)){u=!1;break}if(u)return a}return-1}function A(t,e,s,i){s=Number(s)||0;var r=t.length-s;i?(i=Number(i),i>r&&(i=r)):i=r;var a=e.length;if(a%2!==0)throw new TypeError("Invalid hex string");i>a/2&&(i=a/2);for(var n=0;n<i;++n){var h=parseInt(e.substr(2*n,2),16);if(isNaN(h))return n;t[s+n]=h}return n}function w(t,e,s,i){return tt(q(e,t.length-s),t,s,i)}function R(t,e,s,i){return tt(K(e),t,s,i)}function M(t,e,s,i){return R(t,e,s,i)}function D(t,e,s,i){return tt(J(e),t,s,i)}function F(t,e,s,i){return tt(Q(e,t.length-s),t,s,i)}function L(t,e,s){return 0===e&&s===t.length?i.fromByteArray(t):i.fromByteArray(t.slice(e,s))}function B(t,e,s){s=Math.min(t.length,s);var i=[],r=e;while(r<s){var a,n,h,o,l=t[r],_=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u<=s)switch(u){case 1:l<128&&(_=l);break;case 2:a=t[r+1],128===(192&a)&&(o=(31&l)<<6|63&a,o>127&&(_=o));break;case 3:a=t[r+1],n=t[r+2],128===(192&a)&&128===(192&n)&&(o=(15&l)<<12|(63&a)<<6|63&n,o>2047&&(o<55296||o>57343)&&(_=o));break;case 4:a=t[r+1],n=t[r+2],h=t[r+3],128===(192&a)&&128===(192&n)&&128===(192&h)&&(o=(15&l)<<18|(63&a)<<12|(63&n)<<6|63&h,o>65535&&o<1114112&&(_=o))}null===_?(_=65533,u=1):_>65535&&(_-=65536,i.push(_>>>10&1023|55296),_=56320|1023&_),i.push(_),r+=u}return C(i)}e.Buffer=l,e.SlowBuffer=x,e.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:n(),e.kMaxLength=h(),l.poolSize=8192,l._augment=function(t){return t.__proto__=l.prototype,t},l.from=function(t,e,s){return _(null,t,e,s)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(t,e,s){return m(null,t,e,s)},l.allocUnsafe=function(t){return d(null,t)},l.allocUnsafeSlow=function(t){return d(null,t)},l.isBuffer=function(t){return!(null==t||!t._isBuffer)},l.compare=function(t,e){if(!l.isBuffer(t)||!l.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var s=t.length,i=e.length,r=0,a=Math.min(s,i);r<a;++r)if(t[r]!==e[r]){s=t[r],i=e[r];break}return s<i?-1:i<s?1:0},l.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(t,e){if(!a(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return l.alloc(0);var s;if(void 0===e)for(e=0,s=0;s<t.length;++s)e+=t[s].length;var i=l.allocUnsafe(e),r=0;for(s=0;s<t.length;++s){var n=t[s];if(!l.isBuffer(n))throw new TypeError('"list" argument must be an Array of Buffers');n.copy(i,r),r+=n.length}return i},l.byteLength=y,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)b(this,e,e+1);return this},l.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)b(this,e,e+3),b(this,e+1,e+2);return this},l.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)b(this,e,e+7),b(this,e+1,e+6),b(this,e+2,e+5),b(this,e+3,e+4);return this},l.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?B(this,0,t):T.apply(this,arguments)},l.prototype.equals=function(t){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===l.compare(this,t)},l.prototype.inspect=function(){var t="",s=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,s).match(/.{2}/g).join(" "),this.length>s&&(t+=" ... ")),"<Buffer "+t+">"},l.prototype.compare=function(t,e,s,i,r){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===s&&(s=t?t.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),e<0||s>t.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&e>=s)return 0;if(i>=r)return-1;if(e>=s)return 1;if(e>>>=0,s>>>=0,i>>>=0,r>>>=0,this===t)return 0;for(var a=r-i,n=s-e,h=Math.min(a,n),o=this.slice(i,r),_=t.slice(e,s),u=0;u<h;++u)if(o[u]!==_[u]){a=o[u],n=_[u];break}return a<n?-1:n<a?1:0},l.prototype.includes=function(t,e,s){return-1!==this.indexOf(t,e,s)},l.prototype.indexOf=function(t,e,s){return S(this,t,e,s,!0)},l.prototype.lastIndexOf=function(t,e,s){return S(this,t,e,s,!1)},l.prototype.write=function(t,e,s,i){if(void 0===e)i="utf8",s=this.length,e=0;else if(void 0===s&&"string"===typeof e)i=e,s=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(s)?(s|=0,void 0===i&&(i="utf8")):(i=s,s=void 0)}var r=this.length-e;if((void 0===s||s>r)&&(s=r),t.length>0&&(s<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var a=!1;;)switch(i){case"hex":return A(this,t,e,s);case"utf8":case"utf-8":return w(this,t,e,s);case"ascii":return R(this,t,e,s);case"latin1":case"binary":return M(this,t,e,s);case"base64":return D(this,t,e,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,t,e,s);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var P=4096;function C(t){var e=t.length;if(e<=P)return String.fromCharCode.apply(String,t);var s="",i=0;while(i<e)s+=String.fromCharCode.apply(String,t.slice(i,i+=P));return s}function N(t,e,s){var i="";s=Math.min(t.length,s);for(var r=e;r<s;++r)i+=String.fromCharCode(127&t[r]);return i}function I(t,e,s){var i="";s=Math.min(t.length,s);for(var r=e;r<s;++r)i+=String.fromCharCode(t[r]);return i}function U(t,e,s){var i=t.length;(!e||e<0)&&(e=0),(!s||s<0||s>i)&&(s=i);for(var r="",a=e;a<s;++a)r+=Z(t[a]);return r}function O(t,e,s){for(var i=t.slice(e,s),r="",a=0;a<i.length;a+=2)r+=String.fromCharCode(i[a]+256*i[a+1]);return r}function k(t,e,s){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>s)throw new RangeError("Trying to access beyond buffer length")}function V(t,e,s,i,r,a){if(!l.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<a)throw new RangeError('"value" argument is out of bounds');if(s+i>t.length)throw new RangeError("Index out of range")}function z(t,e,s,i){e<0&&(e=65535+e+1);for(var r=0,a=Math.min(t.length-s,2);r<a;++r)t[s+r]=(e&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function G(t,e,s,i){e<0&&(e=4294967295+e+1);for(var r=0,a=Math.min(t.length-s,4);r<a;++r)t[s+r]=e>>>8*(i?r:3-r)&255}function H(t,e,s,i,r,a){if(s+i>t.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("Index out of range")}function W(t,e,s,i,a){return a||H(t,e,s,4,34028234663852886e22,-34028234663852886e22),r.write(t,e,s,i,23,4),s+4}function X(t,e,s,i,a){return a||H(t,e,s,8,17976931348623157e292,-17976931348623157e292),r.write(t,e,s,i,52,8),s+8}l.prototype.slice=function(t,e){var s,i=this.length;if(t=~~t,e=void 0===e?i:~~e,t<0?(t+=i,t<0&&(t=0)):t>i&&(t=i),e<0?(e+=i,e<0&&(e=0)):e>i&&(e=i),e<t&&(e=t),l.TYPED_ARRAY_SUPPORT)s=this.subarray(t,e),s.__proto__=l.prototype;else{var r=e-t;s=new l(r,void 0);for(var a=0;a<r;++a)s[a]=this[a+t]}return s},l.prototype.readUIntLE=function(t,e,s){t|=0,e|=0,s||k(t,e,this.length);var i=this[t],r=1,a=0;while(++a<e&&(r*=256))i+=this[t+a]*r;return i},l.prototype.readUIntBE=function(t,e,s){t|=0,e|=0,s||k(t,e,this.length);var i=this[t+--e],r=1;while(e>0&&(r*=256))i+=this[t+--e]*r;return i},l.prototype.readUInt8=function(t,e){return e||k(t,1,this.length),this[t]},l.prototype.readUInt16LE=function(t,e){return e||k(t,2,this.length),this[t]|this[t+1]<<8},l.prototype.readUInt16BE=function(t,e){return e||k(t,2,this.length),this[t]<<8|this[t+1]},l.prototype.readUInt32LE=function(t,e){return e||k(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},l.prototype.readUInt32BE=function(t,e){return e||k(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},l.prototype.readIntLE=function(t,e,s){t|=0,e|=0,s||k(t,e,this.length);var i=this[t],r=1,a=0;while(++a<e&&(r*=256))i+=this[t+a]*r;return r*=128,i>=r&&(i-=Math.pow(2,8*e)),i},l.prototype.readIntBE=function(t,e,s){t|=0,e|=0,s||k(t,e,this.length);var i=e,r=1,a=this[t+--i];while(i>0&&(r*=256))a+=this[t+--i]*r;return r*=128,a>=r&&(a-=Math.pow(2,8*e)),a},l.prototype.readInt8=function(t,e){return e||k(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},l.prototype.readInt16LE=function(t,e){e||k(t,2,this.length);var s=this[t]|this[t+1]<<8;return 32768&s?4294901760|s:s},l.prototype.readInt16BE=function(t,e){e||k(t,2,this.length);var s=this[t+1]|this[t]<<8;return 32768&s?4294901760|s:s},l.prototype.readInt32LE=function(t,e){return e||k(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},l.prototype.readInt32BE=function(t,e){return e||k(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},l.prototype.readFloatLE=function(t,e){return e||k(t,4,this.length),r.read(this,t,!0,23,4)},l.prototype.readFloatBE=function(t,e){return e||k(t,4,this.length),r.read(this,t,!1,23,4)},l.prototype.readDoubleLE=function(t,e){return e||k(t,8,this.length),r.read(this,t,!0,52,8)},l.prototype.readDoubleBE=function(t,e){return e||k(t,8,this.length),r.read(this,t,!1,52,8)},l.prototype.writeUIntLE=function(t,e,s,i){if(t=+t,e|=0,s|=0,!i){var r=Math.pow(2,8*s)-1;V(this,t,e,s,r,0)}var a=1,n=0;this[e]=255&t;while(++n<s&&(a*=256))this[e+n]=t/a&255;return e+s},l.prototype.writeUIntBE=function(t,e,s,i){if(t=+t,e|=0,s|=0,!i){var r=Math.pow(2,8*s)-1;V(this,t,e,s,r,0)}var a=s-1,n=1;this[e+a]=255&t;while(--a>=0&&(n*=256))this[e+a]=t/n&255;return e+s},l.prototype.writeUInt8=function(t,e,s){return t=+t,e|=0,s||V(this,t,e,1,255,0),l.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},l.prototype.writeUInt16LE=function(t,e,s){return t=+t,e|=0,s||V(this,t,e,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):z(this,t,e,!0),e+2},l.prototype.writeUInt16BE=function(t,e,s){return t=+t,e|=0,s||V(this,t,e,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):z(this,t,e,!1),e+2},l.prototype.writeUInt32LE=function(t,e,s){return t=+t,e|=0,s||V(this,t,e,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):G(this,t,e,!0),e+4},l.prototype.writeUInt32BE=function(t,e,s){return t=+t,e|=0,s||V(this,t,e,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):G(this,t,e,!1),e+4},l.prototype.writeIntLE=function(t,e,s,i){if(t=+t,e|=0,!i){var r=Math.pow(2,8*s-1);V(this,t,e,s,r-1,-r)}var a=0,n=1,h=0;this[e]=255&t;while(++a<s&&(n*=256))t<0&&0===h&&0!==this[e+a-1]&&(h=1),this[e+a]=(t/n>>0)-h&255;return e+s},l.prototype.writeIntBE=function(t,e,s,i){if(t=+t,e|=0,!i){var r=Math.pow(2,8*s-1);V(this,t,e,s,r-1,-r)}var a=s-1,n=1,h=0;this[e+a]=255&t;while(--a>=0&&(n*=256))t<0&&0===h&&0!==this[e+a+1]&&(h=1),this[e+a]=(t/n>>0)-h&255;return e+s},l.prototype.writeInt8=function(t,e,s){return t=+t,e|=0,s||V(this,t,e,1,127,-128),l.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},l.prototype.writeInt16LE=function(t,e,s){return t=+t,e|=0,s||V(this,t,e,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):z(this,t,e,!0),e+2},l.prototype.writeInt16BE=function(t,e,s){return t=+t,e|=0,s||V(this,t,e,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):z(this,t,e,!1),e+2},l.prototype.writeInt32LE=function(t,e,s){return t=+t,e|=0,s||V(this,t,e,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):G(this,t,e,!0),e+4},l.prototype.writeInt32BE=function(t,e,s){return t=+t,e|=0,s||V(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):G(this,t,e,!1),e+4},l.prototype.writeFloatLE=function(t,e,s){return W(this,t,e,!0,s)},l.prototype.writeFloatBE=function(t,e,s){return W(this,t,e,!1,s)},l.prototype.writeDoubleLE=function(t,e,s){return X(this,t,e,!0,s)},l.prototype.writeDoubleBE=function(t,e,s){return X(this,t,e,!1,s)},l.prototype.copy=function(t,e,s,i){if(s||(s=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<s&&(i=s),i===s)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-s&&(i=t.length-e+s);var r,a=i-s;if(this===t&&s<e&&e<i)for(r=a-1;r>=0;--r)t[r+e]=this[r+s];else if(a<1e3||!l.TYPED_ARRAY_SUPPORT)for(r=0;r<a;++r)t[r+e]=this[r+s];else Uint8Array.prototype.set.call(t,this.subarray(s,s+a),e);return a},l.prototype.fill=function(t,e,s,i){if("string"===typeof t){if("string"===typeof e?(i=e,e=0,s=this.length):"string"===typeof s&&(i=s,s=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==i&&"string"!==typeof i)throw new TypeError("encoding must be a string");if("string"===typeof i&&!l.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"===typeof t&&(t&=255);if(e<0||this.length<e||this.length<s)throw new RangeError("Out of range index");if(s<=e)return this;var a;if(e>>>=0,s=void 0===s?this.length:s>>>0,t||(t=0),"number"===typeof t)for(a=e;a<s;++a)this[a]=t;else{var n=l.isBuffer(t)?t:q(new l(t,i).toString()),h=n.length;for(a=0;a<s-e;++a)this[a+e]=n[a%h]}return this};var Y=/[^+\/0-9A-Za-z-_]/g;function $(t){if(t=j(t).replace(Y,""),t.length<2)return"";while(t.length%4!==0)t+="=";return t}function j(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function Z(t){return t<16?"0"+t.toString(16):t.toString(16)}function q(t,e){var s;e=e||1/0;for(var i=t.length,r=null,a=[],n=0;n<i;++n){if(s=t.charCodeAt(n),s>55295&&s<57344){if(!r){if(s>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(n+1===i){(e-=3)>-1&&a.push(239,191,189);continue}r=s;continue}if(s<56320){(e-=3)>-1&&a.push(239,191,189),r=s;continue}s=65536+(r-55296<<10|s-56320)}else r&&(e-=3)>-1&&a.push(239,191,189);if(r=null,s<128){if((e-=1)<0)break;a.push(s)}else if(s<2048){if((e-=2)<0)break;a.push(s>>6|192,63&s|128)}else if(s<65536){if((e-=3)<0)break;a.push(s>>12|224,s>>6&63|128,63&s|128)}else{if(!(s<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(s>>18|240,s>>12&63|128,s>>6&63|128,63&s|128)}}return a}function K(t){for(var e=[],s=0;s<t.length;++s)e.push(255&t.charCodeAt(s));return e}function Q(t,e){for(var s,i,r,a=[],n=0;n<t.length;++n){if((e-=2)<0)break;s=t.charCodeAt(n),i=s>>8,r=s%256,a.push(r),a.push(i)}return a}function J(t){return i.toByteArray($(t))}function tt(t,e,s,i){for(var r=0;r<i;++r){if(r+s>=e.length||r>=t.length)break;e[r+s]=t[r]}return r}function et(t){return t!==t}}).call(this,s("c8ba"))},b88e:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("d096");document.title="Vox APP";let r=new i.DemoVSMModule,a=r;if(void 0!=a.runBegin){function n(){function t(e){a.runBegin(),a.run(),a.runEnd(),window.requestAnimationFrame(t)}a.initialize(),window.requestAnimationFrame(t)}n()}else{function h(){function t(e){r.run(),window.requestAnimationFrame(t)}r.initialize(),window.requestAnimationFrame(t)}h()}},b8ff:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("402a")),a=i(s("f63e")),n=i(s("f152")),h=i(s("29ef"));class o extends r.default{constructor(t=null){super(t),this.doubleTriFaceEnabled=!1,this.wireframe=!1,this.m_radius=50,this.m_longitudeNumSegments=10,this.m_latitudeNumSegments=10}showBackFace(){this.setRenderState(h.default.NORMAL_STATE)}showFrontFace(){this.setRenderState(h.default.FRONT_CULLFACE_NORMAL_STATE)}showDoubleFace(t=!1,e=!0){t?e?this.setRenderState(h.default.NONE_CULLFACE_NORMAL_ALWAYS_STATE):this.setRenderState(h.default.BACK_NORMAL_ALWAYS_STATE):e?this.setRenderState(h.default.NONE_CULLFACE_NORMAL_STATE):this.setRenderState(h.default.NORMAL_STATE)}toTransparentBlend(t=!1,e=!1){t?e?this.setRenderState(h.default.NONE_TRANSPARENT_ALWAYS_STATE):this.setRenderState(h.default.BACK_TRANSPARENT_ALWAYS_STATE):e?this.setRenderState(h.default.NONE_TRANSPARENT_STATE):this.setRenderState(h.default.BACK_TRANSPARENT_STATE)}toBrightnessBlend(t=!1,e=!1){t?e?this.setRenderState(h.default.NONE_ADD_ALWAYS_STATE):this.setRenderState(h.default.BACK_ADD_ALWAYS_STATE):e?this.setRenderState(h.default.NONE_ADD_BLENDSORT_STATE):this.setRenderState(h.default.BACK_ADD_BLENDSORT_STATE)}createMaterial(t){if(null==this.getMaterial()){let e=new a.default;e.setTextureList(t),this.setMaterial(e)}else null!=t&&this.getMaterial().setTextureList(t)}initializeFrom(t,e=null){this.copyMeshFrom(t),this.copyMaterialFrom(t),this.createMaterial(e),this.activeDisplay()}initialize(t,e,s,i=null){this.m_radius=t,this.m_longitudeNumSegments=e,this.m_latitudeNumSegments=s,this.createMaterial(i),this.activeDisplay()}__activeMesh(t){if(null==this.getMesh()){let e=new n.default;e.wireframe=this.wireframe,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.m_radius,this.m_longitudeNumSegments,this.m_latitudeNumSegments,this.doubleTriFaceEnabled),this.setMesh(e)}}toString(){return"[Sphere3DEntity(uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")]"}}e.default=o},b9b5:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("9c3c")),a=i(s("402a")),n=i(s("3930")),h=i(s("32cc"));class o extends a.default{constructor(){super(),this.rayTestRadius=8,this.colorX=new n.default(1,0,0,1),this.colorY=new n.default(0,1,0,1),this.colorZ=new n.default(0,0,1,1),this.m_posarr=[0,0,0,100,0,0,0,0,0,0,100,0,0,0,0,0,0,100]}setLineWidth(t){}createMaterial(){if(null==this.getMaterial()){let t=new h.default;this.setMaterial(t)}}__activeMesh(t){if(null==this.getMesh()){let e=[this.colorX.r,this.colorX.g,this.colorX.b,this.colorX.r,this.colorX.g,this.colorX.b,this.colorY.r,this.colorY.g,this.colorY.b,this.colorY.r,this.colorY.g,this.colorY.b,this.colorZ.r,this.colorZ.g,this.colorZ.b,this.colorZ.r,this.colorZ.g,this.colorZ.b],s=new r.default;s.rayTestRadius=this.rayTestRadius,s.vbWholeDataEnabled=!1,s.setBufSortFormat(t.getBufSortFormat()),s.initialize(this.m_posarr,e),this.setMesh(s)}}initialize(t=100){t<2&&(t=2),this.m_posarr[3]=t,this.m_posarr[10]=t,this.m_posarr[17]=t,this.createMaterial(),this.activeDisplay()}initializeSizeXYZ(t,e,s){this.m_posarr[3]=t,this.m_posarr[10]=e,this.m_posarr[17]=s,this.createMaterial(),this.activeDisplay()}initializeCorssSizeXYZ(t,e,s){t*=.5,e*=.5,s*=.5,this.m_posarr[0]=-t,this.m_posarr[7]=-e,this.m_posarr[14]=-s,this.m_posarr[3]=t,this.m_posarr[10]=e,this.m_posarr[17]=s,this.createMaterial(),this.activeDisplay()}initializeCross(t=100){t<2&&(t=2),t*=.5,this.m_posarr[0]=-t,this.m_posarr[7]=-t,this.m_posarr[14]=-t,this.m_posarr[3]=t,this.m_posarr[10]=t,this.m_posarr[17]=t,this.createMaterial(),this.activeDisplay()}toString(){return"Axis3DEntity(name="+this.name+",uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=o},baae:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.FRAMEBUFFER=71,i.DRAW_FRAMEBUFFER=72,i.READ_FRAMEBUFFER=73,e.default=i},badb:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("1710")),a=i(s("ee5a"));class n{constructor(){this.m_evtNodes=null,this.m_evtNodesLen=17,this.m_evtNodesLen=r.default.GetMouseEvtTypeValueBase(),this.m_evtNodes=new Array(this.m_evtNodesLen)}getClassType(){return r.default.EventClassType}destroy(){for(let t=0;t<this.m_evtNodesLen;++t)this.m_evtNodes[t].destroy()}dispatchEvt(t){if(null!=t){let e=t.type-r.default.GetMouseEvtTypeValueBase();if(e>=0&&e<r.default.GetMouseEvtTypeValuesTotal()&&null!=this.m_evtNodes[e])return this.m_evtNodes[e].dispatch(t)}return 0}passTestEvt(t){if(null!=t){let e=t.type-r.default.GetMouseEvtTypeValueBase();if(e>=0&&e<r.default.GetMouseEvtTypeValuesTotal())return this.m_evtNodes[e].passTestEvt(t)}return 0}passTestPhase(t){let e=r.default.GetMouseEvtTypeValuesTotal();for(let s=0;s<e;++s)if(null!=this.m_evtNodes[s]&&1==this.m_evtNodes[s].passTestPhase(t))return 1;return 0}addEventListener(t,e,s,i=!0,n=!1){if(null!=s&&null!=e){let h=t-r.default.GetMouseEvtTypeValueBase();if(h>=0&&h<r.default.GetMouseEvtTypeValuesTotal()){let t=0;i!=n&&(t=i?1:2),null!=this.m_evtNodes[h]||(this.m_evtNodes[h]=new a.default),this.m_evtNodes[h].addListener(e,s,t)}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=t-r.default.GetMouseEvtTypeValueBase();i>=0&&i<r.default.GetMouseEvtTypeValuesTotal()&&null!=this.m_evtNodes[i]&&this.m_evtNodes[i].removeListener(e,s)}}}e.default=n},bbf4:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.CAMERA_VISIBLE_ENABLE=0,i.CAMERA_VISIBLE_DISABLE=1,e.default=i},bcac:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(){this.m_stage3D=null,this.m_camera=null,this.m_mouseX=0,this.m_mouseY=0,this.m_enabled=!1}initialize(t,e){null==this.m_stage3D&&(this.m_stage3D=t,this.m_camera=e)}attach(){this.m_mouseX=this.m_stage3D.mouseX,this.m_mouseY=this.m_stage3D.mouseY,this.m_enabled=!0}detach(){this.m_enabled=!1}runWithYAxis(){if(this.m_enabled){let t=this.m_mouseX-this.m_stage3D.mouseX,e=this.m_mouseY-this.m_stage3D.mouseY,s=Math.abs(t),i=Math.abs(e);s>i?s>.5&&this.m_camera.swingHorizontalWithAxis(.2*t,r.default.Y_AXIS):i>.5&&this.m_camera.swingVertical(-.2*e),this.m_mouseX=this.m_stage3D.mouseX,this.m_mouseY=this.m_stage3D.mouseY}}runWithZAxis(){if(this.m_enabled){let t=this.m_mouseX-this.m_stage3D.mouseX,e=this.m_mouseY-this.m_stage3D.mouseY,s=Math.abs(t),i=Math.abs(e);s>i?s>.5&&this.m_camera.swingHorizontalWithAxis(.2*t,r.default.Y_AXIS):i>.5&&this.m_camera.swingVertical(-.2*e),this.m_mouseX=this.m_stage3D.mouseX,this.m_mouseY=this.m_stage3D.mouseY}}}e.CameraDragSwinger=a},bd6f:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("29ef")),a=i(s("402a")),n=i(s("f63e")),h=i(s("a254")),o=i(s("76b0")),l=i(s("3930"));class _ extends a.default{constructor(t=null){super(t),this.m_startX=0,this.m_startZ=0,this.m_pwidth=0,this.m_plong=0,this.m_flag=0,this.m_screenAlignEnabled=!1,this.color0=new l.default,this.color1=new l.default,this.color2=new l.default,this.color3=new l.default,this.offsetU=0,this.offsetV=0,this.uScale=1,this.vScale=1,this.wireframe=!1,this.uvs=null,this.flipVerticalUV=!1,this.vtxColorEnabled=!1,this.premultiplyAlpha=!1}setScreenAlignEnable(t){this.m_screenAlignEnabled=t}createMaterial(t){if(null==this.getMaterial())if(this.m_screenAlignEnabled){let e=new h.default;e.setTextureList(t),this.setMaterial(e)}else{let e=new n.default;e.vtxColorEnabled=this.vtxColorEnabled,e.premultiplyAlpha=this.premultiplyAlpha,e.setTextureList(t),this.setMaterial(e)}else null!=t&&this.getMaterial().getTextureTotal()<1&&this.getMaterial().setTextureList(t)}showDoubleFace(t=!1,e=!0){t?e?this.setRenderState(r.default.NONE_CULLFACE_NORMAL_ALWAYS_STATE):this.setRenderState(r.default.BACK_NORMAL_ALWAYS_STATE):e?this.setRenderState(r.default.NONE_CULLFACE_NORMAL_STATE):this.setRenderState(r.default.NORMAL_STATE)}toTransparentBlend(t=!1,e=!1){t?e?this.setRenderState(r.default.NONE_TRANSPARENT_ALWAYS_STATE):this.setRenderState(r.default.BACK_TRANSPARENT_ALWAYS_STATE):e?this.setRenderState(r.default.NONE_TRANSPARENT_STATE):this.setRenderState(r.default.BACK_TRANSPARENT_STATE)}toBrightnessBlend(t=!1,e=!1){t?e?this.setRenderState(r.default.NONE_ADD_ALWAYS_STATE):this.setRenderState(r.default.BACK_ADD_ALWAYS_STATE):e?this.setRenderState(r.default.NONE_ADD_BLENDSORT_STATE):this.setRenderState(r.default.BACK_ADD_BLENDSORT_STATE)}initializeFixScreen(t=null){this.initializeXOY(-1,-1,2,2,t)}initializeXOY(t,e,s,i,r=null){this.m_startX=t,this.m_startZ=e,this.m_pwidth=s,this.m_plong=i,this.m_flag=0,this.createMaterial(r),this.activeDisplay()}initializeXOYSquare(t,e=null){this.m_startX=-.5*t,this.m_startZ=-.5*t,this.m_pwidth=t,this.m_plong=t,this.m_flag=0,this.createMaterial(e),this.activeDisplay()}initializeXOZ(t,e,s,i,r=null){this.m_flag=1,this.m_startX=t,this.m_startZ=e,this.m_pwidth=s,this.m_plong=i,this.createMaterial(r),this.activeDisplay()}initializeYOZ(t,e,s,i,r=null){this.m_flag=2,this.m_startX=t,this.m_startZ=e,this.m_pwidth=s,this.m_plong=i,this.createMaterial(r),this.activeDisplay()}initializeXOZSquare(t,e=null){this.m_flag=1,this.m_startX=-.5*t,this.m_startZ=-.5*t,this.m_pwidth=t,this.m_plong=t,this.createMaterial(e),this.activeDisplay()}__activeMesh(t){if(null==this.getMesh()){let e=new o.default;e.color0.copyFrom(this.color0),e.color1.copyFrom(this.color1),e.color2.copyFrom(this.color2),e.color3.copyFrom(this.color3),e.setUVS(this.uvs),this.uvs=null,e.uScale=this.uScale,e.vScale=this.vScale,e.offsetU=this.offsetU,e.offsetV=this.offsetV,e.wireframe=this.wireframe,e.flipVerticalUV=this.flipVerticalUV,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.axisFlag=this.m_flag,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.m_startX,this.m_startZ,this.m_pwidth,this.m_plong),this.setMesh(e)}}setUVS(t){let e=this.getMesh();null!=e&&e.setUVS(t)}reinitializeMesh(){let t=this.getMesh();null!=t&&t.reinitialize()}toString(){return"[Plane3DEntity]"}}e.default=_},c120:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(){this.entity=null,this.lpv=new r.default,this.wpv=new r.default,this.dis=0}}e.default=a},c164:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}}i.FragPredefined="",i.FragDefined="\nvec4 worldPosition = vec4(0.0);\nvec3 worldNormal = vec3(0.0);\n",i.VertPredefined="",i.VertDefined="\nvec4 localPosition = vec4(0.0,0.0,0.0,1.0);\nvec4 worldPosition = vec4(0.0,0.0,0.0,1.0);\n// view space position\nvec4 viewPosition = vec4(0.0,0.0,0.0,1.0);\n",e.default=i},c497:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(t=null){this.m_matrix4AllocateSize=8192,this.m_mainDiv=null,this.m_renderContextAttri={depth:!0,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:!1,preserveDrawingBuffer:!0,powerPreference:"high-performance"},this.m_tickUpdateTime=20,this.m_polygonOffsetEnabled=!0,this.m_ditherEnabled=!1,this.autoSyncRenderBufferAndWindowSize=!0,this.maxWebGLVersion=2,this.cameraPerspectiveEnabled=!0,this.evtFlowEnabled=!1,this.camProjParam=new r.default(45,10,5e3),this.camPosition=new r.default(2e3,2e3,2e3),this.camLookAtPos=new r.default(0,0,0),this.camUpDirect=new r.default(0,1,0),this.batchEnabled=!0,this.processFixedState=!1,this.m_mainDiv=t}setTickUpdateTime(t){t=Math.round(t),this.m_tickUpdateTime=t>5?t:5}getTickUpdateTime(){return this.m_tickUpdateTime}setPolygonOffsetEanbled(t){this.m_polygonOffsetEnabled=t}getPolygonOffsetEanbled(){return this.m_polygonOffsetEnabled}setDitherEanbled(t){this.m_ditherEnabled=t}getDitherEanbled(){return this.m_ditherEnabled}getDiv(){return this.m_mainDiv}getRenderContextAttri(){return this.m_renderContextAttri}setAttriDepth(t){this.m_renderContextAttri.depth=t}setAttriStencil(t){this.m_renderContextAttri.stencil=t}setAttriAlpha(t){this.m_renderContextAttri.alpha=t}setAttriPremultipliedAlpha(t){this.m_renderContextAttri.premultipliedAlpha=t}setAttriAntialias(t){this.m_renderContextAttri.antialias=t}setAttripreserveDrawingBuffer(t){this.m_renderContextAttri.preserveDrawingBuffer=t}setAttriHightPowerPreference(t){this.m_renderContextAttri.powerPreference=t?"high-performance":"default"}setMatrix4AllocateSize(t){t<1024&&(t=1024),this.m_matrix4AllocateSize=t}getMatrix4AllocateSize(){return this.m_matrix4AllocateSize}setCamProject(t,e,s){if(e>=s)throw Error("Error Camera cear > far !!!");this.camProjParam.setTo(t,e,s)}setCamPosition(t,e,s){this.camPosition.setTo(t,e,s)}setCamLookAtPos(t,e,s){this.camLookAtPos.setTo(t,e,s)}setCamUpDirect(t,e,s){this.camUpDirect.setTo(t,e,s)}}e.default=a},c4e3:function(t,e,s){(function(e,s){var i;!function(e){t.exports=e()}((function(){return function t(e,s,r){function a(h,o){if(!s[h]){if(!e[h]){var l="function"==typeof i&&i;if(!o&&l)return i(h,!0);if(n)return n(h,!0);var _=new Error("Cannot find module '"+h+"'");throw _.code="MODULE_NOT_FOUND",_}var u=s[h]={exports:{}};e[h][0].call(u.exports,(function(t){var s=e[h][1][t];return a(s||t)}),u,u.exports,t,e,s,r)}return s[h].exports}for(var n="function"==typeof i&&i,h=0;h<r.length;h++)a(r[h]);return a}({1:[function(t,e,s){"use strict";var i=t("./utils"),r=t("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(t){for(var e,s,r,n,h,o,l,_=[],u=0,m=t.length,d=m,c="string"!==i.getTypeOf(t);u<t.length;)d=m-u,r=c?(e=t[u++],s=u<m?t[u++]:0,u<m?t[u++]:0):(e=t.charCodeAt(u++),s=u<m?t.charCodeAt(u++):0,u<m?t.charCodeAt(u++):0),n=e>>2,h=(3&e)<<4|s>>4,o=1<d?(15&s)<<2|r>>6:64,l=2<d?63&r:64,_.push(a.charAt(n)+a.charAt(h)+a.charAt(o)+a.charAt(l));return _.join("")},s.decode=function(t){var e,s,i,n,h,o,l=0,_=0,u="data:";if(t.substr(0,u.length)===u)throw new Error("Invalid base64 input, it looks like a data url.");var m,d=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(t.charAt(t.length-1)===a.charAt(64)&&d--,t.charAt(t.length-2)===a.charAt(64)&&d--,d%1!=0)throw new Error("Invalid base64 input, bad content length.");for(m=r.uint8array?new Uint8Array(0|d):new Array(0|d);l<t.length;)e=a.indexOf(t.charAt(l++))<<2|(n=a.indexOf(t.charAt(l++)))>>4,s=(15&n)<<4|(h=a.indexOf(t.charAt(l++)))>>2,i=(3&h)<<6|(o=a.indexOf(t.charAt(l++))),m[_++]=e,64!==h&&(m[_++]=s),64!==o&&(m[_++]=i);return m}},{"./support":30,"./utils":32}],2:[function(t,e,s){"use strict";var i=t("./external"),r=t("./stream/DataWorker"),a=t("./stream/DataLengthProbe"),n=t("./stream/Crc32Probe");function h(t,e,s,i,r){this.compressedSize=t,this.uncompressedSize=e,this.crc32=s,this.compression=i,this.compressedContent=r}a=t("./stream/DataLengthProbe"),h.prototype={getContentWorker:function(){var t=new r(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),e=this;return t.on("end",(function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),t},getCompressedWorker:function(){return new r(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(t,e,s){return t.pipe(new n).pipe(new a("uncompressedSize")).pipe(e.compressWorker(s)).pipe(new a("compressedSize")).withStreamInfo("compression",e)},e.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,s){"use strict";var i=t("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(t){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},s.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,s){"use strict";var i=t("./utils"),r=function(){for(var t,e=[],s=0;s<256;s++){t=s;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[s]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?"string"!==i.getTypeOf(t)?function(t,e,s,i){var a=r,n=i+s;t^=-1;for(var h=i;h<n;h++)t=t>>>8^a[255&(t^e[h])];return-1^t}(0|e,t,t.length,0):function(t,e,s,i){var a=r,n=i+s;t^=-1;for(var h=i;h<n;h++)t=t>>>8^a[255&(t^e.charCodeAt(h))];return-1^t}(0|e,t,t.length,0):0}},{"./utils":32}],5:[function(t,e,s){"use strict";s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(t,e,s){"use strict";var i=null;i="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:i}},{lie:37}],7:[function(t,e,s){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,r=t("pako"),a=t("./utils"),n=t("./stream/GenericWorker"),h=i?"uint8array":"array";function o(t,e){n.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}s.magic="\b\0",a.inherits(o,n),o.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(a.transformTo(h,t.data),!1)},o.prototype.flush=function(){n.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},o.prototype.cleanUp=function(){n.prototype.cleanUp.call(this),this._pako=null},o.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},s.compressWorker=function(t){return new o("Deflate",t)},s.uncompressWorker=function(){return new o("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,s){"use strict";function i(t,e){var s,i="";for(s=0;s<e;s++)i+=String.fromCharCode(255&t),t>>>=8;return i}function r(t,e,s,r,n,_){var u,m,d=t.file,c=t.compression,f=_!==h.utf8encode,p=a.transformTo("string",_(d.name)),g=a.transformTo("string",h.utf8encode(d.name)),v=d.comment,x=a.transformTo("string",_(v)),y=a.transformTo("string",h.utf8encode(v)),T=g.length!==d.name.length,b=y.length!==v.length,S="",E="",A="",w=d.dir,R=d.date,M={crc32:0,compressedSize:0,uncompressedSize:0};e&&!s||(M.crc32=t.crc32,M.compressedSize=t.compressedSize,M.uncompressedSize=t.uncompressedSize);var D=0;e&&(D|=8),f||!T&&!b||(D|=2048);var F=0,L=0;w&&(F|=16),"UNIX"===n?(L=798,F|=function(t,e){var s=t;return t||(s=e?16893:33204),(65535&s)<<16}(d.unixPermissions,w)):(L=20,F|=function(t){return 63&(t||0)}(d.dosPermissions)),u=R.getUTCHours(),u<<=6,u|=R.getUTCMinutes(),u<<=5,u|=R.getUTCSeconds()/2,m=R.getUTCFullYear()-1980,m<<=4,m|=R.getUTCMonth()+1,m<<=5,m|=R.getUTCDate(),T&&(E=i(1,1)+i(o(p),4)+g,S+="up"+i(E.length,2)+E),b&&(A=i(1,1)+i(o(x),4)+y,S+="uc"+i(A.length,2)+A);var B="";return B+="\n\0",B+=i(D,2),B+=c.magic,B+=i(u,2),B+=i(m,2),B+=i(M.crc32,4),B+=i(M.compressedSize,4),B+=i(M.uncompressedSize,4),B+=i(p.length,2),B+=i(S.length,2),{fileRecord:l.LOCAL_FILE_HEADER+B+p+S,dirRecord:l.CENTRAL_FILE_HEADER+i(L,2)+B+i(x.length,2)+"\0\0\0\0"+i(F,4)+i(r,4)+p+S+x}}var a=t("../utils"),n=t("../stream/GenericWorker"),h=t("../utf8"),o=t("../crc32"),l=t("../signature");function _(t,e,s,i){n.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=s,this.encodeFileName=i,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(_,n),_.prototype.push=function(t){var e=t.meta.percent||0,s=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,n.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:s?(e+100*(s-i-1))/s:100}}))},_.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var s=r(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:s.fileRecord,meta:{percent:0}})}else this.accumulate=!0},_.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,s=r(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(s.dirRecord),e)this.push({data:function(t){return l.DATA_DESCRIPTOR+i(t.crc32,4)+i(t.compressedSize,4)+i(t.uncompressedSize,4)}(t),meta:{percent:100}});else for(this.push({data:s.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},_.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var s=this.bytesWritten-t,r=function(t,e,s,r,n){var h=a.transformTo("string",n(r));return l.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(t,2)+i(t,2)+i(e,4)+i(s,4)+i(h.length,2)+h}(this.dirRecords.length,s,t,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},_.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},_.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()})),t.on("error",(function(t){e.error(t)})),this},_.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},_.prototype.error=function(t){var e=this._sources;if(!n.prototype.error.call(this,t))return!1;for(var s=0;s<e.length;s++)try{e[s].error(t)}catch(t){}return!0},_.prototype.lock=function(){n.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=_},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,s){"use strict";var i=t("../compressions"),r=t("./ZipFileWorker");s.generateWorker=function(t,e,s){var a=new r(e.streamFiles,s,e.platform,e.encodeFileName),n=0;try{t.forEach((function(t,s){n++;var r=function(t,e){var s=t||e,r=i[s];if(!r)throw new Error(s+" is not a valid compression method !");return r}(s.options.compression,e.compression),h=s.options.compressionOptions||e.compressionOptions||{},o=s.dir,l=s.date;s._compressWorker(r,h).withStreamInfo("file",{name:t,dir:o,date:l,comment:s.comment||"",unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions}).pipe(a)})),a.entriesCount=n}catch(t){a.error(t)}return a}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,s){"use strict";function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var t=new i;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(i.prototype=t("./object")).loadAsync=t("./load"),i.support=t("./support"),i.defaults=t("./defaults"),i.version="3.5.0",i.loadAsync=function(t,e){return(new i).loadAsync(t,e)},i.external=t("./external"),e.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,s){"use strict";var i=t("./utils"),r=t("./external"),a=t("./utf8"),n=(i=t("./utils"),t("./zipEntries")),h=t("./stream/Crc32Probe"),o=t("./nodejsUtils");function l(t){return new r.Promise((function(e,s){var i=t.decompressed.getContentWorker().pipe(new h);i.on("error",(function(t){s(t)})).on("end",(function(){i.streamInfo.crc32!==t.decompressed.crc32?s(new Error("Corrupted zip : CRC32 mismatch")):e()})).resume()}))}e.exports=function(t,e){var s=this;return e=i.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),o.isNode&&o.isStream(t)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then((function(t){var s=new n(e);return s.load(t),s})).then((function(t){var s=[r.Promise.resolve(t)],i=t.files;if(e.checkCRC32)for(var a=0;a<i.length;a++)s.push(l(i[a]));return r.Promise.all(s)})).then((function(t){for(var i=t.shift(),r=i.files,a=0;a<r.length;a++){var n=r[a];s.file(n.fileNameStr,n.decompressed,{binary:!0,optimizedBinaryString:!0,date:n.date,dir:n.dir,comment:n.fileCommentStr.length?n.fileCommentStr:null,unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions,createFolders:e.createFolders})}return i.zipComment.length&&(s.comment=i.zipComment),s}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,s){"use strict";var i=t("../utils"),r=t("../stream/GenericWorker");function a(t,e){r.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}i.inherits(a,r),a.prototype._bindStream=function(t){var e=this;(this._stream=t).pause(),t.on("data",(function(t){e.push({data:t,meta:{percent:0}})})).on("error",(function(t){e.isPaused?this.generatedError=t:e.error(t)})).on("end",(function(){e.isPaused?e._upstreamEnded=!0:e.end()}))},a.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,s){"use strict";var i=t("readable-stream").Readable;function r(t,e,s){i.call(this,e),this._helper=t;var r=this;t.on("data",(function(t,e){r.push(t)||r._helper.pause(),s&&s(e)})).on("error",(function(t){r.emit("error",t)})).on("end",(function(){r.push(null)}))}t("../utils").inherits(r,i),r.prototype._read=function(){this._helper.resume()},e.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,s,i){"use strict";s.exports={isNode:"undefined"!=typeof e,newBufferFrom:function(t,s){if(e.from&&e.from!==Uint8Array.from)return e.from(t,s);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new e(t,s)},allocBuffer:function(t){if(e.alloc)return e.alloc(t);var s=new e(t);return s.fill(0),s},isBuffer:function(t){return e.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,s){"use strict";function i(t,e,s){var i,r=a.getTypeOf(e),h=a.extend(s||{},o);h.date=h.date||new Date,null!==h.compression&&(h.compression=h.compression.toUpperCase()),"string"==typeof h.unixPermissions&&(h.unixPermissions=parseInt(h.unixPermissions,8)),h.unixPermissions&&16384&h.unixPermissions&&(h.dir=!0),h.dosPermissions&&16&h.dosPermissions&&(h.dir=!0),h.dir&&(t=f(t)),h.createFolders&&(i=c(t))&&p.call(this,i,!0);var u="string"===r&&!1===h.binary&&!1===h.base64;s&&void 0!==s.binary||(h.binary=!u),(e instanceof l&&0===e.uncompressedSize||h.dir||!e||0===e.length)&&(h.base64=!1,h.binary=!0,e="",h.compression="STORE",r="string");var g=null;g=e instanceof l||e instanceof n?e:m.isNode&&m.isStream(e)?new d(t,e):a.prepareContent(t,e,h.binary,h.optimizedBinaryString,h.base64);var v=new _(t,g,h);this.files[t]=v}var r=t("./utf8"),a=t("./utils"),n=t("./stream/GenericWorker"),h=t("./stream/StreamHelper"),o=t("./defaults"),l=t("./compressedObject"),_=t("./zipObject"),u=t("./generate"),m=t("./nodejsUtils"),d=t("./nodejs/NodejsStreamInputAdapter"),c=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return 0<e?t.substring(0,e):""},f=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},p=function(t,e){return e=void 0!==e?e:o.createFolders,t=f(t),this.files[t]||i.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function g(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,s,i;for(e in this.files)this.files.hasOwnProperty(e)&&(i=this.files[e],(s=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(s,i))},filter:function(t){var e=[];return this.forEach((function(s,i){t(s,i)&&e.push(i)})),e},file:function(t,e,s){if(1!==arguments.length)return t=this.root+t,i.call(this,t,e,s),this;if(g(t)){var r=t;return this.filter((function(t,e){return!e.dir&&r.test(t)}))}var a=this.files[this.root+t];return a&&!a.dir?a:null},folder:function(t){if(!t)return this;if(g(t))return this.filter((function(e,s){return s.dir&&t.test(e)}));var e=this.root+t,s=p.call(this,e),i=this.clone();return i.root=s.name,i},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var s=this.filter((function(e,s){return s.name.slice(0,t.length)===t})),i=0;i<s.length;i++)delete this.files[s[i].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,s={};try{if((s=a.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=s.type.toLowerCase(),s.compression=s.compression.toUpperCase(),"binarystring"===s.type&&(s.type="string"),!s.type)throw new Error("No output type specified.");a.checkSupport(s.type),"darwin"!==s.platform&&"freebsd"!==s.platform&&"linux"!==s.platform&&"sunos"!==s.platform||(s.platform="UNIX"),"win32"===s.platform&&(s.platform="DOS");var i=s.comment||this.comment||"";e=u.generateWorker(this,s,i)}catch(t){(e=new n("error")).error(t)}return new h(e,s.type||"string",s.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,s){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,s){"use strict";var i=t("./DataReader");function r(t){i.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(r,i),r.prototype.byteAt=function(t){return this.data[this.zero+t]},r.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),s=t.charCodeAt(1),i=t.charCodeAt(2),r=t.charCodeAt(3),a=this.length-4;0<=a;--a)if(this.data[a]===e&&this.data[a+1]===s&&this.data[a+2]===i&&this.data[a+3]===r)return a-this.zero;return-1},r.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),s=t.charCodeAt(1),i=t.charCodeAt(2),r=t.charCodeAt(3),a=this.readData(4);return e===a[0]&&s===a[1]&&i===a[2]&&r===a[3]},r.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,e,s){"use strict";var i=t("../utils");function r(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,s=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)s=(s<<8)+this.byteAt(e);return this.index+=t,s},readString:function(t){return i.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=r},{"../utils":32}],19:[function(t,e,s){"use strict";var i=t("./Uint8ArrayReader");function r(t){i.call(this,t)}t("../utils").inherits(r,i),r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,s){"use strict";var i=t("./DataReader");function r(t){i.call(this,t)}t("../utils").inherits(r,i),r.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},r.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},r.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,e,s){"use strict";var i=t("./ArrayReader");function r(t){i.call(this,t)}t("../utils").inherits(r,i),r.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,s){"use strict";var i=t("../utils"),r=t("../support"),a=t("./ArrayReader"),n=t("./StringReader"),h=t("./NodeBufferReader"),o=t("./Uint8ArrayReader");e.exports=function(t){var e=i.getTypeOf(t);return i.checkSupport(e),"string"!==e||r.uint8array?"nodebuffer"===e?new h(t):r.uint8array?new o(i.transformTo("uint8array",t)):new a(i.transformTo("array",t)):new n(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,s){"use strict";s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e,s){"use strict";var i=t("./GenericWorker"),r=t("../utils");function a(t){i.call(this,"ConvertWorker to "+t),this.destType=t}r.inherits(a,i),a.prototype.processChunk=function(t){this.push({data:r.transformTo(this.destType,t.data),meta:t.meta})},e.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,s){"use strict";var i=t("./GenericWorker"),r=t("../crc32");function a(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(a,i),a.prototype.processChunk=function(t){this.streamInfo.crc32=r(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,s){"use strict";var i=t("../utils"),r=t("./GenericWorker");function a(t){r.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}i.inherits(a,r),a.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}r.prototype.processChunk.call(this,t)},e.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,s){"use strict";var i=t("../utils"),r=t("./GenericWorker");function a(t){r.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then((function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=i.getTypeOf(t),e.isPaused||e._tickAndRepeat()}),(function(t){e.error(t)}))}i.inherits(a,r),a.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,s){"use strict";function i(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var s=0;s<this._listeners[t].length;s++)this._listeners[t][s].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.end()})),t.on("error",(function(t){e.error(t)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=i},{}],29:[function(t,s,i){"use strict";var r=t("../utils"),a=t("./ConvertWorker"),n=t("./GenericWorker"),h=t("../base64"),o=t("../support"),l=t("../external"),_=null;if(o.nodestream)try{_=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function u(t,s){return new l.Promise((function(i,a){var n=[],o=t._internalType,l=t._outputType,_=t._mimeType;t.on("data",(function(t,e){n.push(t),s&&s(e)})).on("error",(function(t){n=[],a(t)})).on("end",(function(){try{var t=function(t,e,s){switch(t){case"blob":return r.newBlob(r.transformTo("arraybuffer",e),s);case"base64":return h.encode(e);default:return r.transformTo(t,e)}}(l,function(t,s){var i,r=0,a=null,n=0;for(i=0;i<s.length;i++)n+=s[i].length;switch(t){case"string":return s.join("");case"array":return Array.prototype.concat.apply([],s);case"uint8array":for(a=new Uint8Array(n),i=0;i<s.length;i++)a.set(s[i],r),r+=s[i].length;return a;case"nodebuffer":return e.concat(s);default:throw new Error("concat : unsupported type '"+t+"'")}}(o,n),_);i(t)}catch(t){a(t)}n=[]})).resume()}))}function m(t,e,s){var i=e;switch(e){case"blob":case"arraybuffer":i="uint8array";break;case"base64":i="string"}try{this._internalType=i,this._outputType=e,this._mimeType=s,r.checkSupport(i),this._worker=t.pipe(new a(i)),t.lock()}catch(t){this._worker=new n("error"),this._worker.error(t)}}m.prototype={accumulate:function(t){return u(this,t)},on:function(t,e){var s=this;return"data"===t?this._worker.on(t,(function(t){e.call(s,t.data,t.meta)})):this._worker.on(t,(function(){r.delay(e,arguments,s)})),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(r.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new _(this,{objectMode:"nodebuffer"!==this._outputType},t)}},s.exports=m},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,s,i){"use strict";if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer="undefined"!=typeof e,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var r=new ArrayBuffer(0);try{i.blob=0===new Blob([r],{type:"application/zip"}).size}catch(t){try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(r),i.blob=0===a.getBlob("application/zip").size}catch(t){i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch(t){i.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,s){"use strict";for(var i=t("./utils"),r=t("./support"),a=t("./nodejsUtils"),n=t("./stream/GenericWorker"),h=new Array(256),o=0;o<256;o++)h[o]=252<=o?6:248<=o?5:240<=o?4:224<=o?3:192<=o?2:1;function l(){n.call(this,"utf-8 decode"),this.leftOver=null}function _(){n.call(this,"utf-8 encode")}h[254]=h[254]=1,s.utf8encode=function(t){return r.nodebuffer?a.newBufferFrom(t,"utf-8"):function(t){var e,s,i,a,n,h=t.length,o=0;for(a=0;a<h;a++)55296==(64512&(s=t.charCodeAt(a)))&&a+1<h&&56320==(64512&(i=t.charCodeAt(a+1)))&&(s=65536+(s-55296<<10)+(i-56320),a++),o+=s<128?1:s<2048?2:s<65536?3:4;for(e=r.uint8array?new Uint8Array(o):new Array(o),a=n=0;n<o;a++)55296==(64512&(s=t.charCodeAt(a)))&&a+1<h&&56320==(64512&(i=t.charCodeAt(a+1)))&&(s=65536+(s-55296<<10)+(i-56320),a++),s<128?e[n++]=s:(s<2048?e[n++]=192|s>>>6:(s<65536?e[n++]=224|s>>>12:(e[n++]=240|s>>>18,e[n++]=128|s>>>12&63),e[n++]=128|s>>>6&63),e[n++]=128|63&s);return e}(t)},s.utf8decode=function(t){return r.nodebuffer?i.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,s,r,a,n=t.length,o=new Array(2*n);for(e=s=0;e<n;)if((r=t[e++])<128)o[s++]=r;else if(4<(a=h[r]))o[s++]=65533,e+=a-1;else{for(r&=2===a?31:3===a?15:7;1<a&&e<n;)r=r<<6|63&t[e++],a--;1<a?o[s++]=65533:r<65536?o[s++]=r:(r-=65536,o[s++]=55296|r>>10&1023,o[s++]=56320|1023&r)}return o.length!==s&&(o.subarray?o=o.subarray(0,s):o.length=s),i.applyFromCharCode(o)}(t=i.transformTo(r.uint8array?"uint8array":"array",t))},i.inherits(l,n),l.prototype.processChunk=function(t){var e=i.transformTo(r.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var a=e;(e=new Uint8Array(a.length+this.leftOver.length)).set(this.leftOver,0),e.set(a,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var n=function(t,e){var s;for((e=e||t.length)>t.length&&(e=t.length),s=e-1;0<=s&&128==(192&t[s]);)s--;return s<0||0===s?e:s+h[t[s]]>e?s:e}(e),o=e;n!==e.length&&(r.uint8array?(o=e.subarray(0,n),this.leftOver=e.subarray(n,e.length)):(o=e.slice(0,n),this.leftOver=e.slice(n,e.length))),this.push({data:s.utf8decode(o),meta:t.meta})},l.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=l,i.inherits(_,n),_.prototype.processChunk=function(t){this.push({data:s.utf8encode(t.data),meta:t.meta})},s.Utf8EncodeWorker=_},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,s){"use strict";var i=t("./support"),r=t("./base64"),a=t("./nodejsUtils"),n=t("set-immediate-shim"),h=t("./external");function o(t){return t}function l(t,e){for(var s=0;s<t.length;++s)e[s]=255&t.charCodeAt(s);return e}s.newBlob=function(e,i){s.checkSupport("blob");try{return new Blob([e],{type:i})}catch(t){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return r.append(e),r.getBlob(i)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var _={stringifyByChunk:function(t,e,s){var i=[],r=0,a=t.length;if(a<=s)return String.fromCharCode.apply(null,t);for(;r<a;)"array"===e||"nodebuffer"===e?i.push(String.fromCharCode.apply(null,t.slice(r,Math.min(r+s,a)))):i.push(String.fromCharCode.apply(null,t.subarray(r,Math.min(r+s,a)))),r+=s;return i.join("")},stringifyByChar:function(t){for(var e="",s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return e},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&1===String.fromCharCode.apply(null,a.allocBuffer(1)).length}catch(t){return!1}}()}};function u(t){var e=65536,i=s.getTypeOf(t),r=!0;if("uint8array"===i?r=_.applyCanBeUsed.uint8array:"nodebuffer"===i&&(r=_.applyCanBeUsed.nodebuffer),r)for(;1<e;)try{return _.stringifyByChunk(t,i,e)}catch(t){e=Math.floor(e/2)}return _.stringifyByChar(t)}function m(t,e){for(var s=0;s<t.length;s++)e[s]=t[s];return e}s.applyFromCharCode=u;var d={};d.string={string:o,array:function(t){return l(t,new Array(t.length))},arraybuffer:function(t){return d.string.uint8array(t).buffer},uint8array:function(t){return l(t,new Uint8Array(t.length))},nodebuffer:function(t){return l(t,a.allocBuffer(t.length))}},d.array={string:u,array:o,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return a.newBufferFrom(t)}},d.arraybuffer={string:function(t){return u(new Uint8Array(t))},array:function(t){return m(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:o,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return a.newBufferFrom(new Uint8Array(t))}},d.uint8array={string:u,array:function(t){return m(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:o,nodebuffer:function(t){return a.newBufferFrom(t)}},d.nodebuffer={string:u,array:function(t){return m(t,new Array(t.length))},arraybuffer:function(t){return d.nodebuffer.uint8array(t).buffer},uint8array:function(t){return m(t,new Uint8Array(t.length))},nodebuffer:o},s.transformTo=function(t,e){if(e=e||"",!t)return e;s.checkSupport(t);var i=s.getTypeOf(e);return d[i][t](e)},s.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":i.nodebuffer&&a.isBuffer(t)?"nodebuffer":i.uint8array&&t instanceof Uint8Array?"uint8array":i.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(t){if(!i[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(t){var e,s,i="";for(s=0;s<(t||"").length;s++)i+="\\x"+((e=t.charCodeAt(s))<16?"0":"")+e.toString(16).toUpperCase();return i},s.delay=function(t,e,s){n((function(){t.apply(s||null,e||[])}))},s.inherits=function(t,e){function s(){}s.prototype=e.prototype,t.prototype=new s},s.extend=function(){var t,e,s={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===s[e]&&(s[e]=arguments[t][e]);return s},s.prepareContent=function(t,e,a,n,o){return h.Promise.resolve(e).then((function(t){return i.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new h.Promise((function(e,s){var i=new FileReader;i.onload=function(t){e(t.target.result)},i.onerror=function(t){s(t.target.error)},i.readAsArrayBuffer(t)})):t})).then((function(e){var _=s.getTypeOf(e);return _?("arraybuffer"===_?e=s.transformTo("uint8array",e):"string"===_&&(o?e=r.decode(e):a&&!0!==n&&(e=function(t){return l(t,i.uint8array?new Uint8Array(t.length):new Array(t.length))}(e))),e):h.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(t,e,s){"use strict";var i=t("./reader/readerFor"),r=t("./utils"),a=t("./signature"),n=t("./zipEntry"),h=(t("./utf8"),t("./support"));function o(t){this.files=[],this.loadOptions=t}o.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(e)+", expected "+r.pretty(t)+")")}},isSignature:function(t,e){var s=this.reader.index;this.reader.setIndex(t);var i=this.reader.readString(4)===e;return this.reader.setIndex(s),i},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=h.uint8array?"uint8array":"array",s=r.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(s)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,s,i=this.zip64EndOfCentralSize-44;0<i;)t=this.reader.readInt(2),e=this.reader.readInt(4),s=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:s}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(t=new n({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(t<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(t);var e=t;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var s=this.centralDirOffset+this.centralDirSize;this.zip64&&(s+=20,s+=12+this.zip64EndOfCentralSize);var i=e-s;if(0<i)this.isSignature(e,a.CENTRAL_FILE_HEADER)||(this.reader.zero=i);else if(i<0)throw new Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")},prepareReader:function(t){this.reader=i(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=o},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e,s){"use strict";var i=t("./reader/readerFor"),r=t("./utils"),a=t("./compressedObject"),n=t("./crc32"),h=t("./utf8"),o=t("./compressions"),l=t("./support");function _(t,e){this.options=t,this.loadOptions=e}_.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,s;if(t.skip(22),this.fileNameLength=t.readInt(2),s=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(s),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in o)if(o.hasOwnProperty(e)&&o[e].magic===t)return o[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==t&&(this.dosPermissions=63&this.externalFileAttributes),3==t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=i(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,s,i,r=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index+4<r;)e=t.readInt(2),s=t.readInt(2),i=t.readData(s),this.extraFields[e]={id:e,length:s,value:i};t.setIndex(r)},handleUTF8:function(){var t=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var s=r.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(s)}var i=this.findExtraFieldUnicodeComment();if(null!==i)this.fileCommentStr=i;else{var a=r.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(a)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=i(t.value);return 1!==e.readInt(1)||n(this.fileName)!==e.readInt(4)?null:h.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=i(t.value);return 1!==e.readInt(1)||n(this.fileComment)!==e.readInt(4)?null:h.utf8decode(e.readData(t.length-5))}return null}},e.exports=_},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,s){"use strict";function i(t,e,s){this.name=t,this.dir=s.dir,this.date=s.date,this.comment=s.comment,this.unixPermissions=s.unixPermissions,this.dosPermissions=s.dosPermissions,this._data=e,this._dataBinary=s.binary,this.options={compression:s.compression,compressionOptions:s.compressionOptions}}var r=t("./stream/StreamHelper"),a=t("./stream/DataWorker"),n=t("./utf8"),h=t("./compressedObject"),o=t("./stream/GenericWorker");i.prototype={internalStream:function(t){var e=null,s="string";try{if(!t)throw new Error("No output type specified.");var i="string"===(s=t.toLowerCase())||"text"===s;"binarystring"!==s&&"text"!==s||(s="string"),e=this._decompressWorker();var a=!this._dataBinary;a&&!i&&(e=e.pipe(new n.Utf8EncodeWorker)),!a&&i&&(e=e.pipe(new n.Utf8DecodeWorker))}catch(t){(e=new o("error")).error(t)}return new r(e,s,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof h&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var s=this._decompressWorker();return this._dataBinary||(s=s.pipe(new n.Utf8EncodeWorker)),h.createWorkerFrom(s,t,e)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof o?this._data:new a(this._data)}};for(var l=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],_=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<l.length;u++)i.prototype[l[u]]=_;e.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,i){(function(t){"use strict";var s,i,r=t.MutationObserver||t.WebKitMutationObserver;if(r){var a=0,n=new r(_),h=t.document.createTextNode("");n.observe(h,{characterData:!0}),s=function(){h.data=a=++a%2}}else if(t.setImmediate||void 0===t.MessageChannel)s="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){_(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(_,0)};else{var o=new t.MessageChannel;o.port1.onmessage=_,s=function(){o.port2.postMessage(0)}}var l=[];function _(){var t,e;i=!0;for(var s=l.length;s;){for(e=l,l=[],t=-1;++t<s;)e[t]();s=l.length}i=!1}e.exports=function(t){1!==l.push(t)||i||s()}}).call(this,"undefined"!=typeof s?s:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,s){"use strict";var i=t("immediate");function r(){}var a={},n=["REJECTED"],h=["FULFILLED"],o=["PENDING"];function l(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=o,this.queue=[],this.outcome=void 0,t!==r&&d(this,t)}function _(t,e,s){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof s&&(this.onRejected=s,this.callRejected=this.otherCallRejected)}function u(t,e,s){i((function(){var i;try{i=e(s)}catch(i){return a.reject(t,i)}i===t?a.reject(t,new TypeError("Cannot resolve promise with itself")):a.resolve(t,i)}))}function m(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function d(t,e){var s=!1;function i(e){s||(s=!0,a.reject(t,e))}function r(e){s||(s=!0,a.resolve(t,e))}var n=c((function(){e(r,i)}));"error"===n.status&&i(n.value)}function c(t,e){var s={};try{s.value=t(e),s.status="success"}catch(t){s.status="error",s.value=t}return s}(e.exports=l).prototype.finally=function(t){if("function"!=typeof t)return this;var e=this.constructor;return this.then((function(s){return e.resolve(t()).then((function(){return s}))}),(function(s){return e.resolve(t()).then((function(){throw s}))}))},l.prototype.catch=function(t){return this.then(null,t)},l.prototype.then=function(t,e){if("function"!=typeof t&&this.state===h||"function"!=typeof e&&this.state===n)return this;var s=new this.constructor(r);return this.state!==o?u(s,this.state===h?t:e,this.outcome):this.queue.push(new _(s,t,e)),s},_.prototype.callFulfilled=function(t){a.resolve(this.promise,t)},_.prototype.otherCallFulfilled=function(t){u(this.promise,this.onFulfilled,t)},_.prototype.callRejected=function(t){a.reject(this.promise,t)},_.prototype.otherCallRejected=function(t){u(this.promise,this.onRejected,t)},a.resolve=function(t,e){var s=c(m,e);if("error"===s.status)return a.reject(t,s.value);var i=s.value;if(i)d(t,i);else{t.state=h,t.outcome=e;for(var r=-1,n=t.queue.length;++r<n;)t.queue[r].callFulfilled(e)}return t},a.reject=function(t,e){t.state=n,t.outcome=e;for(var s=-1,i=t.queue.length;++s<i;)t.queue[s].callRejected(e);return t},l.resolve=function(t){return t instanceof this?t:a.resolve(new this(r),t)},l.reject=function(t){var e=new this(r);return a.reject(e,t)},l.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var s=t.length,i=!1;if(!s)return this.resolve([]);for(var n=new Array(s),h=0,o=-1,l=new this(r);++o<s;)_(t[o],o);return l;function _(t,r){e.resolve(t).then((function(t){n[r]=t,++h!==s||i||(i=!0,a.resolve(l,n))}),(function(t){i||(i=!0,a.reject(l,t))}))}},l.race=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var s=t.length,i=!1;if(!s)return this.resolve([]);for(var n,h=-1,o=new this(r);++h<s;)n=t[h],e.resolve(n).then((function(t){i||(i=!0,a.resolve(o,t))}),(function(t){i||(i=!0,a.reject(o,t))}));return o}},{immediate:36}],38:[function(t,e,s){"use strict";var i={};(0,t("./lib/utils/common").assign)(i,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,s){"use strict";var i=t("./zlib/deflate"),r=t("./utils/common"),a=t("./utils/strings"),n=t("./zlib/messages"),h=t("./zlib/zstream"),o=Object.prototype.toString,l=0,_=-1,u=0,m=8;function d(t){if(!(this instanceof d))return new d(t);this.options=r.assign({level:_,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},t||{});var e=this.options;e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var s=i.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(s!==l)throw new Error(n[s]);if(e.header&&i.deflateSetHeader(this.strm,e.header),e.dictionary){var c;if(c="string"==typeof e.dictionary?a.string2buf(e.dictionary):"[object ArrayBuffer]"===o.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(s=i.deflateSetDictionary(this.strm,c))!==l)throw new Error(n[s]);this._dict_set=!0}}function c(t,e){var s=new d(e);if(s.push(t,!0),s.err)throw s.msg||n[s.err];return s.result}d.prototype.push=function(t,e){var s,n,h=this.strm,_=this.options.chunkSize;if(this.ended)return!1;n=e===~~e?e:!0===e?4:0,"string"==typeof t?h.input=a.string2buf(t):"[object ArrayBuffer]"===o.call(t)?h.input=new Uint8Array(t):h.input=t,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new r.Buf8(_),h.next_out=0,h.avail_out=_),1!==(s=i.deflate(h,n))&&s!==l)return this.onEnd(s),!(this.ended=!0);0!==h.avail_out&&(0!==h.avail_in||4!==n&&2!==n)||("string"===this.options.to?this.onData(a.buf2binstring(r.shrinkBuf(h.output,h.next_out))):this.onData(r.shrinkBuf(h.output,h.next_out)))}while((0<h.avail_in||0===h.avail_out)&&1!==s);return 4===n?(s=i.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===l):2!==n||(this.onEnd(l),!(h.avail_out=0))},d.prototype.onData=function(t){this.chunks.push(t)},d.prototype.onEnd=function(t){t===l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},s.Deflate=d,s.deflate=c,s.deflateRaw=function(t,e){return(e=e||{}).raw=!0,c(t,e)},s.gzip=function(t,e){return(e=e||{}).gzip=!0,c(t,e)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,s){"use strict";var i=t("./zlib/inflate"),r=t("./utils/common"),a=t("./utils/strings"),n=t("./zlib/constants"),h=t("./zlib/messages"),o=t("./zlib/zstream"),l=t("./zlib/gzheader"),_=Object.prototype.toString;function u(t){if(!(this instanceof u))return new u(t);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var s=i.inflateInit2(this.strm,e.windowBits);if(s!==n.Z_OK)throw new Error(h[s]);this.header=new l,i.inflateGetHeader(this.strm,this.header)}function m(t,e){var s=new u(e);if(s.push(t,!0),s.err)throw s.msg||h[s.err];return s.result}u.prototype.push=function(t,e){var s,h,o,l,u,m,d=this.strm,c=this.options.chunkSize,f=this.options.dictionary,p=!1;if(this.ended)return!1;h=e===~~e?e:!0===e?n.Z_FINISH:n.Z_NO_FLUSH,"string"==typeof t?d.input=a.binstring2buf(t):"[object ArrayBuffer]"===_.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new r.Buf8(c),d.next_out=0,d.avail_out=c),(s=i.inflate(d,n.Z_NO_FLUSH))===n.Z_NEED_DICT&&f&&(m="string"==typeof f?a.string2buf(f):"[object ArrayBuffer]"===_.call(f)?new Uint8Array(f):f,s=i.inflateSetDictionary(this.strm,m)),s===n.Z_BUF_ERROR&&!0===p&&(s=n.Z_OK,p=!1),s!==n.Z_STREAM_END&&s!==n.Z_OK)return this.onEnd(s),!(this.ended=!0);d.next_out&&(0!==d.avail_out&&s!==n.Z_STREAM_END&&(0!==d.avail_in||h!==n.Z_FINISH&&h!==n.Z_SYNC_FLUSH)||("string"===this.options.to?(o=a.utf8border(d.output,d.next_out),l=d.next_out-o,u=a.buf2string(d.output,o),d.next_out=l,d.avail_out=c-l,l&&r.arraySet(d.output,d.output,o,l,0),this.onData(u)):this.onData(r.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(p=!0)}while((0<d.avail_in||0===d.avail_out)&&s!==n.Z_STREAM_END);return s===n.Z_STREAM_END&&(h=n.Z_FINISH),h===n.Z_FINISH?(s=i.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===n.Z_OK):h!==n.Z_SYNC_FLUSH||(this.onEnd(n.Z_OK),!(d.avail_out=0))},u.prototype.onData=function(t){this.chunks.push(t)},u.prototype.onEnd=function(t){t===n.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},s.Inflate=u,s.inflate=m,s.inflateRaw=function(t,e){return(e=e||{}).raw=!0,m(t,e)},s.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,s){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;s.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var s=e.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(var i in s)s.hasOwnProperty(i)&&(t[i]=s[i])}}return t},s.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,s,i,r){if(e.subarray&&t.subarray)t.set(e.subarray(s,s+i),r);else for(var a=0;a<i;a++)t[r+a]=e[s+a]},flattenChunks:function(t){var e,s,i,r,a,n;for(e=i=0,s=t.length;e<s;e++)i+=t[e].length;for(n=new Uint8Array(i),e=r=0,s=t.length;e<s;e++)a=t[e],n.set(a,r),r+=a.length;return n}},a={arraySet:function(t,e,s,i,r){for(var a=0;a<i;a++)t[r+a]=e[s+a]},flattenChunks:function(t){return[].concat.apply([],t)}};s.setTyped=function(t){t?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,r)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,a))},s.setTyped(i)},{}],42:[function(t,e,s){"use strict";var i=t("./common"),r=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){a=!1}for(var n=new i.Buf8(256),h=0;h<256;h++)n[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function o(t,e){if(e<65537&&(t.subarray&&a||!t.subarray&&r))return String.fromCharCode.apply(null,i.shrinkBuf(t,e));for(var s="",n=0;n<e;n++)s+=String.fromCharCode(t[n]);return s}n[254]=n[254]=1,s.string2buf=function(t){var e,s,r,a,n,h=t.length,o=0;for(a=0;a<h;a++)55296==(64512&(s=t.charCodeAt(a)))&&a+1<h&&56320==(64512&(r=t.charCodeAt(a+1)))&&(s=65536+(s-55296<<10)+(r-56320),a++),o+=s<128?1:s<2048?2:s<65536?3:4;for(e=new i.Buf8(o),a=n=0;n<o;a++)55296==(64512&(s=t.charCodeAt(a)))&&a+1<h&&56320==(64512&(r=t.charCodeAt(a+1)))&&(s=65536+(s-55296<<10)+(r-56320),a++),s<128?e[n++]=s:(s<2048?e[n++]=192|s>>>6:(s<65536?e[n++]=224|s>>>12:(e[n++]=240|s>>>18,e[n++]=128|s>>>12&63),e[n++]=128|s>>>6&63),e[n++]=128|63&s);return e},s.buf2binstring=function(t){return o(t,t.length)},s.binstring2buf=function(t){for(var e=new i.Buf8(t.length),s=0,r=e.length;s<r;s++)e[s]=t.charCodeAt(s);return e},s.buf2string=function(t,e){var s,i,r,a,h=e||t.length,l=new Array(2*h);for(s=i=0;s<h;)if((r=t[s++])<128)l[i++]=r;else if(4<(a=n[r]))l[i++]=65533,s+=a-1;else{for(r&=2===a?31:3===a?15:7;1<a&&s<h;)r=r<<6|63&t[s++],a--;1<a?l[i++]=65533:r<65536?l[i++]=r:(r-=65536,l[i++]=55296|r>>10&1023,l[i++]=56320|1023&r)}return o(l,i)},s.utf8border=function(t,e){var s;for((e=e||t.length)>t.length&&(e=t.length),s=e-1;0<=s&&128==(192&t[s]);)s--;return s<0||0===s?e:s+n[t[s]]>e?s:e}},{"./common":41}],43:[function(t,e,s){"use strict";e.exports=function(t,e,s,i){for(var r=65535&t|0,a=t>>>16&65535|0,n=0;0!==s;){for(s-=n=2e3<s?2e3:s;a=a+(r=r+e[i++]|0)|0,--n;);r%=65521,a%=65521}return r|a<<16|0}},{}],44:[function(t,e,s){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,s){"use strict";var i=function(){for(var t,e=[],s=0;s<256;s++){t=s;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[s]=t}return e}();e.exports=function(t,e,s,r){var a=i,n=r+s;t^=-1;for(var h=r;h<n;h++)t=t>>>8^a[255&(t^e[h])];return-1^t}},{}],46:[function(t,e,s){"use strict";var i,r=t("../utils/common"),a=t("./trees"),n=t("./adler32"),h=t("./crc32"),o=t("./messages"),l=0,_=4,u=0,m=-2,d=-1,c=4,f=2,p=8,g=9,v=286,x=30,y=19,T=2*v+1,b=15,S=3,E=258,A=E+S+1,w=42,R=113,M=1,D=2,F=3,L=4;function B(t,e){return t.msg=o[e],e}function P(t){return(t<<1)-(4<t?9:0)}function C(t){for(var e=t.length;0<=--e;)t[e]=0}function N(t){var e=t.state,s=e.pending;s>t.avail_out&&(s=t.avail_out),0!==s&&(r.arraySet(t.output,e.pending_buf,e.pending_out,s,t.next_out),t.next_out+=s,e.pending_out+=s,t.total_out+=s,t.avail_out-=s,e.pending-=s,0===e.pending&&(e.pending_out=0))}function I(t,e){a._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,N(t.strm)}function U(t,e){t.pending_buf[t.pending++]=e}function O(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function k(t,e){var s,i,r=t.max_chain_length,a=t.strstart,n=t.prev_length,h=t.nice_match,o=t.strstart>t.w_size-A?t.strstart-(t.w_size-A):0,l=t.window,_=t.w_mask,u=t.prev,m=t.strstart+E,d=l[a+n-1],c=l[a+n];t.prev_length>=t.good_match&&(r>>=2),h>t.lookahead&&(h=t.lookahead);do{if(l[(s=e)+n]===c&&l[s+n-1]===d&&l[s]===l[a]&&l[++s]===l[a+1]){a+=2,s++;do{}while(l[++a]===l[++s]&&l[++a]===l[++s]&&l[++a]===l[++s]&&l[++a]===l[++s]&&l[++a]===l[++s]&&l[++a]===l[++s]&&l[++a]===l[++s]&&l[++a]===l[++s]&&a<m);if(i=E-(m-a),a=m-E,n<i){if(t.match_start=e,h<=(n=i))break;d=l[a+n-1],c=l[a+n]}}}while((e=u[e&_])>o&&0!=--r);return n<=t.lookahead?n:t.lookahead}function V(t){var e,s,i,a,o,l,_,u,m,d,c=t.w_size;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=c+(c-A)){for(r.arraySet(t.window,t.window,c,c,0),t.match_start-=c,t.strstart-=c,t.block_start-=c,e=s=t.hash_size;i=t.head[--e],t.head[e]=c<=i?i-c:0,--s;);for(e=s=c;i=t.prev[--e],t.prev[e]=c<=i?i-c:0,--s;);a+=c}if(0===t.strm.avail_in)break;if(l=t.strm,_=t.window,u=t.strstart+t.lookahead,m=a,d=void 0,d=l.avail_in,m<d&&(d=m),s=0===d?0:(l.avail_in-=d,r.arraySet(_,l.input,l.next_in,d,u),1===l.state.wrap?l.adler=n(l.adler,_,d,u):2===l.state.wrap&&(l.adler=h(l.adler,_,d,u)),l.next_in+=d,l.total_in+=d,d),t.lookahead+=s,t.lookahead+t.insert>=S)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+S-1])&t.hash_mask,t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<S)););}while(t.lookahead<A&&0!==t.strm.avail_in)}function z(t,e){for(var s,i;;){if(t.lookahead<A){if(V(t),t.lookahead<A&&e===l)return M;if(0===t.lookahead)break}if(s=0,t.lookahead>=S&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==s&&t.strstart-s<=t.w_size-A&&(t.match_length=k(t,s)),t.match_length>=S)if(i=a._tr_tally(t,t.strstart-t.match_start,t.match_length-S),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=S){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else i=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(I(t,!1),0===t.strm.avail_out))return M}return t.insert=t.strstart<S-1?t.strstart:S-1,e===_?(I(t,!0),0===t.strm.avail_out?F:L):t.last_lit&&(I(t,!1),0===t.strm.avail_out)?M:D}function G(t,e){for(var s,i,r;;){if(t.lookahead<A){if(V(t),t.lookahead<A&&e===l)return M;if(0===t.lookahead)break}if(s=0,t.lookahead>=S&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=S-1,0!==s&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-A&&(t.match_length=k(t,s),t.match_length<=5&&(1===t.strategy||t.match_length===S&&4096<t.strstart-t.match_start)&&(t.match_length=S-1)),t.prev_length>=S&&t.match_length<=t.prev_length){for(r=t.strstart+t.lookahead-S,i=a._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-S),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+S-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=S-1,t.strstart++,i&&(I(t,!1),0===t.strm.avail_out))return M}else if(t.match_available){if((i=a._tr_tally(t,0,t.window[t.strstart-1]))&&I(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return M}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=a._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<S-1?t.strstart:S-1,e===_?(I(t,!0),0===t.strm.avail_out?F:L):t.last_lit&&(I(t,!1),0===t.strm.avail_out)?M:D}function H(t,e,s,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=s,this.max_chain=i,this.func=r}function W(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=p,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*T),this.dyn_dtree=new r.Buf16(2*(2*x+1)),this.bl_tree=new r.Buf16(2*(2*y+1)),C(this.dyn_ltree),C(this.dyn_dtree),C(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(b+1),this.heap=new r.Buf16(2*v+1),C(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*v+1),C(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function X(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=f,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?w:R,t.adler=2===e.wrap?0:1,e.last_flush=l,a._tr_init(e),u):B(t,m)}function Y(t){var e=X(t);return e===u&&function(t){t.window_size=2*t.w_size,C(t.head),t.max_lazy_match=i[t.level].max_lazy,t.good_match=i[t.level].good_length,t.nice_match=i[t.level].nice_length,t.max_chain_length=i[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=S-1,t.match_available=0,t.ins_h=0}(t.state),e}function $(t,e,s,i,a,n){if(!t)return m;var h=1;if(e===d&&(e=6),i<0?(h=0,i=-i):15<i&&(h=2,i-=16),a<1||g<a||s!==p||i<8||15<i||e<0||9<e||n<0||c<n)return B(t,m);8===i&&(i=9);var o=new W;return(t.state=o).strm=t,o.wrap=h,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+S-1)/S),o.window=new r.Buf8(2*o.w_size),o.head=new r.Buf16(o.hash_size),o.prev=new r.Buf16(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new r.Buf8(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=e,o.strategy=n,o.method=s,Y(t)}i=[new H(0,0,0,0,(function(t,e){var s=65535;for(s>t.pending_buf_size-5&&(s=t.pending_buf_size-5);;){if(t.lookahead<=1){if(V(t),0===t.lookahead&&e===l)return M;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+s;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,I(t,!1),0===t.strm.avail_out))return M;if(t.strstart-t.block_start>=t.w_size-A&&(I(t,!1),0===t.strm.avail_out))return M}return t.insert=0,e===_?(I(t,!0),0===t.strm.avail_out?F:L):(t.strstart>t.block_start&&(I(t,!1),t.strm.avail_out),M)})),new H(4,4,8,4,z),new H(4,5,16,8,z),new H(4,6,32,32,z),new H(4,4,16,16,G),new H(8,16,32,32,G),new H(8,16,128,128,G),new H(8,32,128,256,G),new H(32,128,258,1024,G),new H(32,258,258,4096,G)],s.deflateInit=function(t,e){return $(t,e,p,15,8,0)},s.deflateInit2=$,s.deflateReset=Y,s.deflateResetKeep=X,s.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?m:(t.state.gzhead=e,u):m},s.deflate=function(t,e){var s,r,n,o;if(!t||!t.state||5<e||e<0)return t?B(t,m):m;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||666===r.status&&e!==_)return B(t,0===t.avail_out?-5:m);if(r.strm=t,s=r.last_flush,r.last_flush=e,r.status===w)if(2===r.wrap)t.adler=0,U(r,31),U(r,139),U(r,8),r.gzhead?(U(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),U(r,255&r.gzhead.time),U(r,r.gzhead.time>>8&255),U(r,r.gzhead.time>>16&255),U(r,r.gzhead.time>>24&255),U(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),U(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(U(r,255&r.gzhead.extra.length),U(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=h(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(U(r,0),U(r,0),U(r,0),U(r,0),U(r,0),U(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),U(r,3),r.status=R);else{var d=p+(r.w_bits-8<<4)<<8;d|=(2<=r.strategy||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(d|=32),d+=31-d%31,r.status=R,O(r,d),0!==r.strstart&&(O(r,t.adler>>>16),O(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(n=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>n&&(t.adler=h(t.adler,r.pending_buf,r.pending-n,n)),N(t),n=r.pending,r.pending!==r.pending_buf_size));)U(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>n&&(t.adler=h(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(t.adler=h(t.adler,r.pending_buf,r.pending-n,n)),N(t),n=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,U(r,o)}while(0!==o);r.gzhead.hcrc&&r.pending>n&&(t.adler=h(t.adler,r.pending_buf,r.pending-n,n)),0===o&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(t.adler=h(t.adler,r.pending_buf,r.pending-n,n)),N(t),n=r.pending,r.pending===r.pending_buf_size)){o=1;break}o=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,U(r,o)}while(0!==o);r.gzhead.hcrc&&r.pending>n&&(t.adler=h(t.adler,r.pending_buf,r.pending-n,n)),0===o&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&N(t),r.pending+2<=r.pending_buf_size&&(U(r,255&t.adler),U(r,t.adler>>8&255),t.adler=0,r.status=R)):r.status=R),0!==r.pending){if(N(t),0===t.avail_out)return r.last_flush=-1,u}else if(0===t.avail_in&&P(e)<=P(s)&&e!==_)return B(t,-5);if(666===r.status&&0!==t.avail_in)return B(t,-5);if(0!==t.avail_in||0!==r.lookahead||e!==l&&666!==r.status){var c=2===r.strategy?function(t,e){for(var s;;){if(0===t.lookahead&&(V(t),0===t.lookahead)){if(e===l)return M;break}if(t.match_length=0,s=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,s&&(I(t,!1),0===t.strm.avail_out))return M}return t.insert=0,e===_?(I(t,!0),0===t.strm.avail_out?F:L):t.last_lit&&(I(t,!1),0===t.strm.avail_out)?M:D}(r,e):3===r.strategy?function(t,e){for(var s,i,r,n,h=t.window;;){if(t.lookahead<=E){if(V(t),t.lookahead<=E&&e===l)return M;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=S&&0<t.strstart&&(i=h[r=t.strstart-1])===h[++r]&&i===h[++r]&&i===h[++r]){n=t.strstart+E;do{}while(i===h[++r]&&i===h[++r]&&i===h[++r]&&i===h[++r]&&i===h[++r]&&i===h[++r]&&i===h[++r]&&i===h[++r]&&r<n);t.match_length=E-(n-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=S?(s=a._tr_tally(t,1,t.match_length-S),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(s=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),s&&(I(t,!1),0===t.strm.avail_out))return M}return t.insert=0,e===_?(I(t,!0),0===t.strm.avail_out?F:L):t.last_lit&&(I(t,!1),0===t.strm.avail_out)?M:D}(r,e):i[r.level].func(r,e);if(c!==F&&c!==L||(r.status=666),c===M||c===F)return 0===t.avail_out&&(r.last_flush=-1),u;if(c===D&&(1===e?a._tr_align(r):5!==e&&(a._tr_stored_block(r,0,0,!1),3===e&&(C(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),N(t),0===t.avail_out))return r.last_flush=-1,u}return e!==_?u:r.wrap<=0?1:(2===r.wrap?(U(r,255&t.adler),U(r,t.adler>>8&255),U(r,t.adler>>16&255),U(r,t.adler>>24&255),U(r,255&t.total_in),U(r,t.total_in>>8&255),U(r,t.total_in>>16&255),U(r,t.total_in>>24&255)):(O(r,t.adler>>>16),O(r,65535&t.adler)),N(t),0<r.wrap&&(r.wrap=-r.wrap),0!==r.pending?u:1)},s.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==w&&69!==e&&73!==e&&91!==e&&103!==e&&e!==R&&666!==e?B(t,m):(t.state=null,e===R?B(t,-3):u):m},s.deflateSetDictionary=function(t,e){var s,i,a,h,o,l,_,d,c=e.length;if(!t||!t.state)return m;if(2===(h=(s=t.state).wrap)||1===h&&s.status!==w||s.lookahead)return m;for(1===h&&(t.adler=n(t.adler,e,c,0)),s.wrap=0,c>=s.w_size&&(0===h&&(C(s.head),s.strstart=0,s.block_start=0,s.insert=0),d=new r.Buf8(s.w_size),r.arraySet(d,e,c-s.w_size,s.w_size,0),e=d,c=s.w_size),o=t.avail_in,l=t.next_in,_=t.input,t.avail_in=c,t.next_in=0,t.input=e,V(s);s.lookahead>=S;){for(i=s.strstart,a=s.lookahead-(S-1);s.ins_h=(s.ins_h<<s.hash_shift^s.window[i+S-1])&s.hash_mask,s.prev[i&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=i,i++,--a;);s.strstart=i,s.lookahead=S-1,V(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=S-1,s.match_available=0,t.next_in=l,t.input=_,t.avail_in=o,s.wrap=h,u},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,s){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,e,s){"use strict";e.exports=function(t,e){var s,i,r,a,n,h,o,l,_,u,m,d,c,f,p,g,v,x,y,T,b,S,E,A,w;s=t.state,i=t.next_in,A=t.input,r=i+(t.avail_in-5),a=t.next_out,w=t.output,n=a-(e-t.avail_out),h=a+(t.avail_out-257),o=s.dmax,l=s.wsize,_=s.whave,u=s.wnext,m=s.window,d=s.hold,c=s.bits,f=s.lencode,p=s.distcode,g=(1<<s.lenbits)-1,v=(1<<s.distbits)-1;t:do{c<15&&(d+=A[i++]<<c,c+=8,d+=A[i++]<<c,c+=8),x=f[d&g];e:for(;;){if(d>>>=y=x>>>24,c-=y,0===(y=x>>>16&255))w[a++]=65535&x;else{if(!(16&y)){if(0==(64&y)){x=f[(65535&x)+(d&(1<<y)-1)];continue e}if(32&y){s.mode=12;break t}t.msg="invalid literal/length code",s.mode=30;break t}T=65535&x,(y&=15)&&(c<y&&(d+=A[i++]<<c,c+=8),T+=d&(1<<y)-1,d>>>=y,c-=y),c<15&&(d+=A[i++]<<c,c+=8,d+=A[i++]<<c,c+=8),x=p[d&v];s:for(;;){if(d>>>=y=x>>>24,c-=y,!(16&(y=x>>>16&255))){if(0==(64&y)){x=p[(65535&x)+(d&(1<<y)-1)];continue s}t.msg="invalid distance code",s.mode=30;break t}if(b=65535&x,c<(y&=15)&&(d+=A[i++]<<c,(c+=8)<y&&(d+=A[i++]<<c,c+=8)),o<(b+=d&(1<<y)-1)){t.msg="invalid distance too far back",s.mode=30;break t}if(d>>>=y,c-=y,(y=a-n)<b){if(_<(y=b-y)&&s.sane){t.msg="invalid distance too far back",s.mode=30;break t}if(E=m,(S=0)===u){if(S+=l-y,y<T){for(T-=y;w[a++]=m[S++],--y;);S=a-b,E=w}}else if(u<y){if(S+=l+u-y,(y-=u)<T){for(T-=y;w[a++]=m[S++],--y;);if(S=0,u<T){for(T-=y=u;w[a++]=m[S++],--y;);S=a-b,E=w}}}else if(S+=u-y,y<T){for(T-=y;w[a++]=m[S++],--y;);S=a-b,E=w}for(;2<T;)w[a++]=E[S++],w[a++]=E[S++],w[a++]=E[S++],T-=3;T&&(w[a++]=E[S++],1<T&&(w[a++]=E[S++]))}else{for(S=a-b;w[a++]=w[S++],w[a++]=w[S++],w[a++]=w[S++],2<(T-=3););T&&(w[a++]=w[S++],1<T&&(w[a++]=w[S++]))}break}}break}}while(i<r&&a<h);i-=T=c>>3,d&=(1<<(c-=T<<3))-1,t.next_in=i,t.next_out=a,t.avail_in=i<r?r-i+5:5-(i-r),t.avail_out=a<h?h-a+257:257-(a-h),s.hold=d,s.bits=c}},{}],49:[function(t,e,s){"use strict";var i=t("../utils/common"),r=t("./adler32"),a=t("./crc32"),n=t("./inffast"),h=t("./inftrees"),o=1,l=2,_=0,u=-2,m=1,d=852,c=592;function f(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function p(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function g(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=m,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new i.Buf32(d),e.distcode=e.distdyn=new i.Buf32(c),e.sane=1,e.back=-1,_):u}function v(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,g(t)):u}function x(t,e){var s,i;return t&&t.state?(i=t.state,e<0?(s=0,e=-e):(s=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?u:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=s,i.wbits=e,v(t))):u}function y(t,e){var s,i;return t?(i=new p,(t.state=i).window=null,(s=x(t,e))!==_&&(t.state=null),s):u}var T,b,S=!0;function E(t){if(S){var e;for(T=new i.Buf32(512),b=new i.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(h(o,t.lens,0,288,T,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;h(l,t.lens,0,32,b,0,t.work,{bits:5}),S=!1}t.lencode=T,t.lenbits=9,t.distcode=b,t.distbits=5}function A(t,e,s,r){var a,n=t.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new i.Buf8(n.wsize)),r>=n.wsize?(i.arraySet(n.window,e,s-n.wsize,n.wsize,0),n.wnext=0,n.whave=n.wsize):(r<(a=n.wsize-n.wnext)&&(a=r),i.arraySet(n.window,e,s-r,a,n.wnext),(r-=a)?(i.arraySet(n.window,e,s-r,r,0),n.wnext=r,n.whave=n.wsize):(n.wnext+=a,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=a))),0}s.inflateReset=v,s.inflateReset2=x,s.inflateResetKeep=g,s.inflateInit=function(t){return y(t,15)},s.inflateInit2=y,s.inflate=function(t,e){var s,d,c,p,g,v,x,y,T,b,S,w,R,M,D,F,L,B,P,C,N,I,U,O,k=0,V=new i.Buf8(4),z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return u;12===(s=t.state).mode&&(s.mode=13),g=t.next_out,c=t.output,x=t.avail_out,p=t.next_in,d=t.input,v=t.avail_in,y=s.hold,T=s.bits,b=v,S=x,I=_;t:for(;;)switch(s.mode){case m:if(0===s.wrap){s.mode=13;break}for(;T<16;){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}if(2&s.wrap&&35615===y){V[s.check=0]=255&y,V[1]=y>>>8&255,s.check=a(s.check,V,2,0),T=y=0,s.mode=2;break}if(s.flags=0,s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&y)<<8)+(y>>8))%31){t.msg="incorrect header check",s.mode=30;break}if(8!=(15&y)){t.msg="unknown compression method",s.mode=30;break}if(T-=4,N=8+(15&(y>>>=4)),0===s.wbits)s.wbits=N;else if(N>s.wbits){t.msg="invalid window size",s.mode=30;break}s.dmax=1<<N,t.adler=s.check=1,s.mode=512&y?10:12,T=y=0;break;case 2:for(;T<16;){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}if(s.flags=y,8!=(255&s.flags)){t.msg="unknown compression method",s.mode=30;break}if(57344&s.flags){t.msg="unknown header flags set",s.mode=30;break}s.head&&(s.head.text=y>>8&1),512&s.flags&&(V[0]=255&y,V[1]=y>>>8&255,s.check=a(s.check,V,2,0)),T=y=0,s.mode=3;case 3:for(;T<32;){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}s.head&&(s.head.time=y),512&s.flags&&(V[0]=255&y,V[1]=y>>>8&255,V[2]=y>>>16&255,V[3]=y>>>24&255,s.check=a(s.check,V,4,0)),T=y=0,s.mode=4;case 4:for(;T<16;){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}s.head&&(s.head.xflags=255&y,s.head.os=y>>8),512&s.flags&&(V[0]=255&y,V[1]=y>>>8&255,s.check=a(s.check,V,2,0)),T=y=0,s.mode=5;case 5:if(1024&s.flags){for(;T<16;){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}s.length=y,s.head&&(s.head.extra_len=y),512&s.flags&&(V[0]=255&y,V[1]=y>>>8&255,s.check=a(s.check,V,2,0)),T=y=0}else s.head&&(s.head.extra=null);s.mode=6;case 6:if(1024&s.flags&&(v<(w=s.length)&&(w=v),w&&(s.head&&(N=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Array(s.head.extra_len)),i.arraySet(s.head.extra,d,p,w,N)),512&s.flags&&(s.check=a(s.check,d,w,p)),v-=w,p+=w,s.length-=w),s.length))break t;s.length=0,s.mode=7;case 7:if(2048&s.flags){if(0===v)break t;for(w=0;N=d[p+w++],s.head&&N&&s.length<65536&&(s.head.name+=String.fromCharCode(N)),N&&w<v;);if(512&s.flags&&(s.check=a(s.check,d,w,p)),v-=w,p+=w,N)break t}else s.head&&(s.head.name=null);s.length=0,s.mode=8;case 8:if(4096&s.flags){if(0===v)break t;for(w=0;N=d[p+w++],s.head&&N&&s.length<65536&&(s.head.comment+=String.fromCharCode(N)),N&&w<v;);if(512&s.flags&&(s.check=a(s.check,d,w,p)),v-=w,p+=w,N)break t}else s.head&&(s.head.comment=null);s.mode=9;case 9:if(512&s.flags){for(;T<16;){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}if(y!==(65535&s.check)){t.msg="header crc mismatch",s.mode=30;break}T=y=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=12;break;case 10:for(;T<32;){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}t.adler=s.check=f(y),T=y=0,s.mode=11;case 11:if(0===s.havedict)return t.next_out=g,t.avail_out=x,t.next_in=p,t.avail_in=v,s.hold=y,s.bits=T,2;t.adler=s.check=1,s.mode=12;case 12:if(5===e||6===e)break t;case 13:if(s.last){y>>>=7&T,T-=7&T,s.mode=27;break}for(;T<3;){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}switch(s.last=1&y,T-=1,3&(y>>>=1)){case 0:s.mode=14;break;case 1:if(E(s),s.mode=20,6!==e)break;y>>>=2,T-=2;break t;case 2:s.mode=17;break;case 3:t.msg="invalid block type",s.mode=30}y>>>=2,T-=2;break;case 14:for(y>>>=7&T,T-=7&T;T<32;){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}if((65535&y)!=(y>>>16^65535)){t.msg="invalid stored block lengths",s.mode=30;break}if(s.length=65535&y,T=y=0,s.mode=15,6===e)break t;case 15:s.mode=16;case 16:if(w=s.length){if(v<w&&(w=v),x<w&&(w=x),0===w)break t;i.arraySet(c,d,p,w,g),v-=w,p+=w,x-=w,g+=w,s.length-=w;break}s.mode=12;break;case 17:for(;T<14;){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}if(s.nlen=257+(31&y),y>>>=5,T-=5,s.ndist=1+(31&y),y>>>=5,T-=5,s.ncode=4+(15&y),y>>>=4,T-=4,286<s.nlen||30<s.ndist){t.msg="too many length or distance symbols",s.mode=30;break}s.have=0,s.mode=18;case 18:for(;s.have<s.ncode;){for(;T<3;){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}s.lens[z[s.have++]]=7&y,y>>>=3,T-=3}for(;s.have<19;)s.lens[z[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,U={bits:s.lenbits},I=h(0,s.lens,0,19,s.lencode,0,s.work,U),s.lenbits=U.bits,I){t.msg="invalid code lengths set",s.mode=30;break}s.have=0,s.mode=19;case 19:for(;s.have<s.nlen+s.ndist;){for(;F=(k=s.lencode[y&(1<<s.lenbits)-1])>>>16&255,L=65535&k,!((D=k>>>24)<=T);){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}if(L<16)y>>>=D,T-=D,s.lens[s.have++]=L;else{if(16===L){for(O=D+2;T<O;){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}if(y>>>=D,T-=D,0===s.have){t.msg="invalid bit length repeat",s.mode=30;break}N=s.lens[s.have-1],w=3+(3&y),y>>>=2,T-=2}else if(17===L){for(O=D+3;T<O;){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}T-=D,N=0,w=3+(7&(y>>>=D)),y>>>=3,T-=3}else{for(O=D+7;T<O;){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}T-=D,N=0,w=11+(127&(y>>>=D)),y>>>=7,T-=7}if(s.have+w>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=30;break}for(;w--;)s.lens[s.have++]=N}}if(30===s.mode)break;if(0===s.lens[256]){t.msg="invalid code -- missing end-of-block",s.mode=30;break}if(s.lenbits=9,U={bits:s.lenbits},I=h(o,s.lens,0,s.nlen,s.lencode,0,s.work,U),s.lenbits=U.bits,I){t.msg="invalid literal/lengths set",s.mode=30;break}if(s.distbits=6,s.distcode=s.distdyn,U={bits:s.distbits},I=h(l,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,U),s.distbits=U.bits,I){t.msg="invalid distances set",s.mode=30;break}if(s.mode=20,6===e)break t;case 20:s.mode=21;case 21:if(6<=v&&258<=x){t.next_out=g,t.avail_out=x,t.next_in=p,t.avail_in=v,s.hold=y,s.bits=T,n(t,S),g=t.next_out,c=t.output,x=t.avail_out,p=t.next_in,d=t.input,v=t.avail_in,y=s.hold,T=s.bits,12===s.mode&&(s.back=-1);break}for(s.back=0;F=(k=s.lencode[y&(1<<s.lenbits)-1])>>>16&255,L=65535&k,!((D=k>>>24)<=T);){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}if(F&&0==(240&F)){for(B=D,P=F,C=L;F=(k=s.lencode[C+((y&(1<<B+P)-1)>>B)])>>>16&255,L=65535&k,!(B+(D=k>>>24)<=T);){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}y>>>=B,T-=B,s.back+=B}if(y>>>=D,T-=D,s.back+=D,s.length=L,0===F){s.mode=26;break}if(32&F){s.back=-1,s.mode=12;break}if(64&F){t.msg="invalid literal/length code",s.mode=30;break}s.extra=15&F,s.mode=22;case 22:if(s.extra){for(O=s.extra;T<O;){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}s.length+=y&(1<<s.extra)-1,y>>>=s.extra,T-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=23;case 23:for(;F=(k=s.distcode[y&(1<<s.distbits)-1])>>>16&255,L=65535&k,!((D=k>>>24)<=T);){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}if(0==(240&F)){for(B=D,P=F,C=L;F=(k=s.distcode[C+((y&(1<<B+P)-1)>>B)])>>>16&255,L=65535&k,!(B+(D=k>>>24)<=T);){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}y>>>=B,T-=B,s.back+=B}if(y>>>=D,T-=D,s.back+=D,64&F){t.msg="invalid distance code",s.mode=30;break}s.offset=L,s.extra=15&F,s.mode=24;case 24:if(s.extra){for(O=s.extra;T<O;){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}s.offset+=y&(1<<s.extra)-1,y>>>=s.extra,T-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=30;break}s.mode=25;case 25:if(0===x)break t;if(w=S-x,s.offset>w){if((w=s.offset-w)>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=30;break}R=w>s.wnext?(w-=s.wnext,s.wsize-w):s.wnext-w,w>s.length&&(w=s.length),M=s.window}else M=c,R=g-s.offset,w=s.length;for(x<w&&(w=x),x-=w,s.length-=w;c[g++]=M[R++],--w;);0===s.length&&(s.mode=21);break;case 26:if(0===x)break t;c[g++]=s.length,x--,s.mode=21;break;case 27:if(s.wrap){for(;T<32;){if(0===v)break t;v--,y|=d[p++]<<T,T+=8}if(S-=x,t.total_out+=S,s.total+=S,S&&(t.adler=s.check=s.flags?a(s.check,c,S,g-S):r(s.check,c,S,g-S)),S=x,(s.flags?y:f(y))!==s.check){t.msg="incorrect data check",s.mode=30;break}T=y=0}s.mode=28;case 28:if(s.wrap&&s.flags){for(;T<32;){if(0===v)break t;v--,y+=d[p++]<<T,T+=8}if(y!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=30;break}T=y=0}s.mode=29;case 29:I=1;break t;case 30:I=-3;break t;case 31:return-4;case 32:default:return u}return t.next_out=g,t.avail_out=x,t.next_in=p,t.avail_in=v,s.hold=y,s.bits=T,(s.wsize||S!==t.avail_out&&s.mode<30&&(s.mode<27||4!==e))&&A(t,t.output,t.next_out,S-t.avail_out)?(s.mode=31,-4):(b-=t.avail_in,S-=t.avail_out,t.total_in+=b,t.total_out+=S,s.total+=S,s.wrap&&S&&(t.adler=s.check=s.flags?a(s.check,c,S,t.next_out-S):r(s.check,c,S,t.next_out-S)),t.data_type=s.bits+(s.last?64:0)+(12===s.mode?128:0)+(20===s.mode||15===s.mode?256:0),(0==b&&0===S||4===e)&&I===_&&(I=-5),I)},s.inflateEnd=function(t){if(!t||!t.state)return u;var e=t.state;return e.window&&(e.window=null),t.state=null,_},s.inflateGetHeader=function(t,e){var s;return t&&t.state?0==(2&(s=t.state).wrap)?u:((s.head=e).done=!1,_):u},s.inflateSetDictionary=function(t,e){var s,i=e.length;return t&&t.state?0!==(s=t.state).wrap&&11!==s.mode?u:11===s.mode&&r(1,e,i,0)!==s.check?-3:A(t,e,i,i)?(s.mode=31,-4):(s.havedict=1,_):u},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,s){"use strict";var i=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],n=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,s,o,l,_,u,m){var d,c,f,p,g,v,x,y,T,b=m.bits,S=0,E=0,A=0,w=0,R=0,M=0,D=0,F=0,L=0,B=0,P=null,C=0,N=new i.Buf16(16),I=new i.Buf16(16),U=null,O=0;for(S=0;S<=15;S++)N[S]=0;for(E=0;E<o;E++)N[e[s+E]]++;for(R=b,w=15;1<=w&&0===N[w];w--);if(w<R&&(R=w),0===w)return l[_++]=20971520,l[_++]=20971520,m.bits=1,0;for(A=1;A<w&&0===N[A];A++);for(R<A&&(R=A),S=F=1;S<=15;S++)if(F<<=1,(F-=N[S])<0)return-1;if(0<F&&(0===t||1!==w))return-1;for(I[1]=0,S=1;S<15;S++)I[S+1]=I[S]+N[S];for(E=0;E<o;E++)0!==e[s+E]&&(u[I[e[s+E]]++]=E);if(v=0===t?(P=U=u,19):1===t?(P=r,C-=257,U=a,O-=257,256):(P=n,U=h,-1),S=A,g=_,D=E=B=0,f=-1,p=(L=1<<(M=R))-1,1===t&&852<L||2===t&&592<L)return 1;for(;;){for(x=S-D,T=u[E]<v?(y=0,u[E]):u[E]>v?(y=U[O+u[E]],P[C+u[E]]):(y=96,0),d=1<<S-D,A=c=1<<M;l[g+(B>>D)+(c-=d)]=x<<24|y<<16|T|0,0!==c;);for(d=1<<S-1;B&d;)d>>=1;if(0!==d?(B&=d-1,B+=d):B=0,E++,0==--N[S]){if(S===w)break;S=e[s+u[E]]}if(R<S&&(B&p)!==f){for(0===D&&(D=R),g+=A,F=1<<(M=S-D);M+D<w&&!((F-=N[M+D])<=0);)M++,F<<=1;if(L+=1<<M,1===t&&852<L||2===t&&592<L)return 1;l[f=B&p]=R<<24|M<<16|g-_|0}}return 0!==B&&(l[g+B]=S-D<<24|64<<16|0),m.bits=R,0}},{"../utils/common":41}],51:[function(t,e,s){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,s){"use strict";var i=t("../utils/common"),r=0,a=1;function n(t){for(var e=t.length;0<=--e;)t[e]=0}var h=0,o=29,l=256,_=l+1+o,u=30,m=19,d=2*_+1,c=15,f=16,p=7,g=256,v=16,x=17,y=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],b=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],E=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],A=new Array(2*(_+2));n(A);var w=new Array(2*u);n(w);var R=new Array(512);n(R);var M=new Array(256);n(M);var D=new Array(o);n(D);var F,L,B,P=new Array(u);function C(t,e,s,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=s,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}function N(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function I(t){return t<256?R[t]:R[256+(t>>>7)]}function U(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function O(t,e,s){t.bi_valid>f-s?(t.bi_buf|=e<<t.bi_valid&65535,U(t,t.bi_buf),t.bi_buf=e>>f-t.bi_valid,t.bi_valid+=s-f):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=s)}function k(t,e,s){O(t,s[2*e],s[2*e+1])}function V(t,e){for(var s=0;s|=1&t,t>>>=1,s<<=1,0<--e;);return s>>>1}function z(t,e,s){var i,r,a=new Array(c+1),n=0;for(i=1;i<=c;i++)a[i]=n=n+s[i-1]<<1;for(r=0;r<=e;r++){var h=t[2*r+1];0!==h&&(t[2*r]=V(a[h]++,h))}}function G(t){var e;for(e=0;e<_;e++)t.dyn_ltree[2*e]=0;for(e=0;e<u;e++)t.dyn_dtree[2*e]=0;for(e=0;e<m;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*g]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function H(t){8<t.bi_valid?U(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function W(t,e,s,i){var r=2*e,a=2*s;return t[r]<t[a]||t[r]===t[a]&&i[e]<=i[s]}function X(t,e,s){for(var i=t.heap[s],r=s<<1;r<=t.heap_len&&(r<t.heap_len&&W(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!W(e,i,t.heap[r],t.depth));)t.heap[s]=t.heap[r],s=r,r<<=1;t.heap[s]=i}function Y(t,e,s){var i,r,a,n,h=0;if(0!==t.last_lit)for(;i=t.pending_buf[t.d_buf+2*h]<<8|t.pending_buf[t.d_buf+2*h+1],r=t.pending_buf[t.l_buf+h],h++,0===i?k(t,r,e):(k(t,(a=M[r])+l+1,e),0!==(n=T[a])&&O(t,r-=D[a],n),k(t,a=I(--i),s),0!==(n=b[a])&&O(t,i-=P[a],n)),h<t.last_lit;);k(t,g,e)}function $(t,e){var s,i,r,a=e.dyn_tree,n=e.stat_desc.static_tree,h=e.stat_desc.has_stree,o=e.stat_desc.elems,l=-1;for(t.heap_len=0,t.heap_max=d,s=0;s<o;s++)0!==a[2*s]?(t.heap[++t.heap_len]=l=s,t.depth[s]=0):a[2*s+1]=0;for(;t.heap_len<2;)a[2*(r=t.heap[++t.heap_len]=l<2?++l:0)]=1,t.depth[r]=0,t.opt_len--,h&&(t.static_len-=n[2*r+1]);for(e.max_code=l,s=t.heap_len>>1;1<=s;s--)X(t,a,s);for(r=o;s=t.heap[1],t.heap[1]=t.heap[t.heap_len--],X(t,a,1),i=t.heap[1],t.heap[--t.heap_max]=s,t.heap[--t.heap_max]=i,a[2*r]=a[2*s]+a[2*i],t.depth[r]=(t.depth[s]>=t.depth[i]?t.depth[s]:t.depth[i])+1,a[2*s+1]=a[2*i+1]=r,t.heap[1]=r++,X(t,a,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){var s,i,r,a,n,h,o=e.dyn_tree,l=e.max_code,_=e.stat_desc.static_tree,u=e.stat_desc.has_stree,m=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,p=e.stat_desc.max_length,g=0;for(a=0;a<=c;a++)t.bl_count[a]=0;for(o[2*t.heap[t.heap_max]+1]=0,s=t.heap_max+1;s<d;s++)p<(a=o[2*o[2*(i=t.heap[s])+1]+1]+1)&&(a=p,g++),o[2*i+1]=a,l<i||(t.bl_count[a]++,n=0,f<=i&&(n=m[i-f]),h=o[2*i],t.opt_len+=h*(a+n),u&&(t.static_len+=h*(_[2*i+1]+n)));if(0!==g){do{for(a=p-1;0===t.bl_count[a];)a--;t.bl_count[a]--,t.bl_count[a+1]+=2,t.bl_count[p]--,g-=2}while(0<g);for(a=p;0!==a;a--)for(i=t.bl_count[a];0!==i;)l<(r=t.heap[--s])||(o[2*r+1]!==a&&(t.opt_len+=(a-o[2*r+1])*o[2*r],o[2*r+1]=a),i--)}}(t,e),z(a,l,t.bl_count)}function j(t,e,s){var i,r,a=-1,n=e[1],h=0,o=7,l=4;for(0===n&&(o=138,l=3),e[2*(s+1)+1]=65535,i=0;i<=s;i++)r=n,n=e[2*(i+1)+1],++h<o&&r===n||(h<l?t.bl_tree[2*r]+=h:0!==r?(r!==a&&t.bl_tree[2*r]++,t.bl_tree[2*v]++):h<=10?t.bl_tree[2*x]++:t.bl_tree[2*y]++,a=r,l=(h=0)===n?(o=138,3):r===n?(o=6,3):(o=7,4))}function Z(t,e,s){var i,r,a=-1,n=e[1],h=0,o=7,l=4;for(0===n&&(o=138,l=3),i=0;i<=s;i++)if(r=n,n=e[2*(i+1)+1],!(++h<o&&r===n)){if(h<l)for(;k(t,r,t.bl_tree),0!=--h;);else 0!==r?(r!==a&&(k(t,r,t.bl_tree),h--),k(t,v,t.bl_tree),O(t,h-3,2)):h<=10?(k(t,x,t.bl_tree),O(t,h-3,3)):(k(t,y,t.bl_tree),O(t,h-11,7));a=r,l=(h=0)===n?(o=138,3):r===n?(o=6,3):(o=7,4)}}n(P);var q=!1;function K(t,e,s,r){O(t,(h<<1)+(r?1:0),3),function(t,e,s,r){H(t),r&&(U(t,s),U(t,~s)),i.arraySet(t.pending_buf,t.window,e,s,t.pending),t.pending+=s}(t,e,s,!0)}s._tr_init=function(t){q||(function(){var t,e,s,i,r,a=new Array(c+1);for(i=s=0;i<o-1;i++)for(D[i]=s,t=0;t<1<<T[i];t++)M[s++]=i;for(M[s-1]=i,i=r=0;i<16;i++)for(P[i]=r,t=0;t<1<<b[i];t++)R[r++]=i;for(r>>=7;i<u;i++)for(P[i]=r<<7,t=0;t<1<<b[i]-7;t++)R[256+r++]=i;for(e=0;e<=c;e++)a[e]=0;for(t=0;t<=143;)A[2*t+1]=8,t++,a[8]++;for(;t<=255;)A[2*t+1]=9,t++,a[9]++;for(;t<=279;)A[2*t+1]=7,t++,a[7]++;for(;t<=287;)A[2*t+1]=8,t++,a[8]++;for(z(A,_+1,a),t=0;t<u;t++)w[2*t+1]=5,w[2*t]=V(t,5);F=new C(A,T,l+1,_,c),L=new C(w,b,0,u,c),B=new C(new Array(0),S,0,m,p)}(),q=!0),t.l_desc=new N(t.dyn_ltree,F),t.d_desc=new N(t.dyn_dtree,L),t.bl_desc=new N(t.bl_tree,B),t.bi_buf=0,t.bi_valid=0,G(t)},s._tr_stored_block=K,s._tr_flush_block=function(t,e,s,i){var n,h,o=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,s=4093624447;for(e=0;e<=31;e++,s>>>=1)if(1&s&&0!==t.dyn_ltree[2*e])return r;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return a;for(e=32;e<l;e++)if(0!==t.dyn_ltree[2*e])return a;return r}(t)),$(t,t.l_desc),$(t,t.d_desc),o=function(t){var e;for(j(t,t.dyn_ltree,t.l_desc.max_code),j(t,t.dyn_dtree,t.d_desc.max_code),$(t,t.bl_desc),e=m-1;3<=e&&0===t.bl_tree[2*E[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),n=t.opt_len+3+7>>>3,(h=t.static_len+3+7>>>3)<=n&&(n=h)):n=h=s+5,s+4<=n&&-1!==e?K(t,e,s,i):4===t.strategy||h===n?(O(t,2+(i?1:0),3),Y(t,A,w)):(O(t,4+(i?1:0),3),function(t,e,s,i){var r;for(O(t,e-257,5),O(t,s-1,5),O(t,i-4,4),r=0;r<i;r++)O(t,t.bl_tree[2*E[r]+1],3);Z(t,t.dyn_ltree,e-1),Z(t,t.dyn_dtree,s-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),Y(t,t.dyn_ltree,t.dyn_dtree)),G(t),i&&H(t)},s._tr_tally=function(t,e,s){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&s,t.last_lit++,0===e?t.dyn_ltree[2*s]++:(t.matches++,e--,t.dyn_ltree[2*(M[s]+l+1)]++,t.dyn_dtree[2*I(e)]++),t.last_lit===t.lit_bufsize-1},s._tr_align=function(t){O(t,2,3),k(t,g,A),function(t){16===t.bi_valid?(U(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":41}],53:[function(t,e,s){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,e,s){"use strict";e.exports="function"==typeof setImmediate?setImmediate:function(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)}},{}]},{},[10])(10)}))}).call(this,s("b639").Buffer,s("c8ba"))},c51d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("18c7")),h=i(s("e214")),o=i(s("fecb"));class l{constructor(){this.version=0,this.matUProbe=null,this.ufrustumProbe=null,this.uniformEnabled=!1,this.name="Camera",this.m_tempV=new a.default,this.m_tempV1=new a.default,this.m_initRV=new a.default,this.m_initUP=new a.default,this.m_lookRHEnabled=!0,this.m_matrix=new n.default,this.m_viewMat=new n.default,this.m_viewInvertMat=new n.default,this.m_vpMat=new n.default,this.m_tempMat=new n.default,this.m_projMat=new n.default,this.m_camPos=new a.default,this.m_lookAtPos=new a.default,this.m_up=new a.default,this.m_lookDirectNV=new a.default,this.m_lookAtDirec=new a.default,this.m_nearPlaneWidth=1,this.m_nearPlaneHeight=1,this.m_viewX=0,this.m_viewY=0,this.m_viewW=800,this.m_viewH=600,this.m_viewHalfW=400,this.m_viewHalfH=300,this.m_fovRadian=0,this.m_aspect=1,this.m_zNear=.1,this.m_zFar=1e3,this.m_b=0,this.m_t=0,this.m_l=0,this.m_r=0,this.m_perspectiveEnabled=!1,this.m_project2Enabled=!1,this.m_rightHandEnabled=!0,this.m_rotV=new a.default(0,0,0),this.m_viewFieldZoom=1,this.m_changed=!0,this.m_unlock=!0,this.m_tempNV=new a.default,this.m_tempUPV=new a.default,this.m_tempRV=new a.default,this.m_tempCamPos=new a.default,this.m_tempLookAtPos=new a.default,this.m_rotDegree=0,this.m_rotAxis=new a.default,this.m_rotPivotPoint=null,this.m_axisRotEnabled=!1,this.m_frustumWAABB=new o.default,this.m_invViewMat=null,this.m_nearPlaneHalfW=.5,this.m_nearPlaneHalfH=.5,this.m_nearWCV=new a.default,this.m_farWCV=new a.default,this.m_wNV=new a.default,this.m_wFrustumVtxArr=[new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,null,null,null],this.m_wFruPlaneList=[new h.default,new h.default,new h.default,new h.default,new h.default,new h.default],this.m_fpNVArr=[new a.default,new a.default,new a.default,new a.default,new a.default,new a.default],this.m_fpDisArr=[0,0,0,0,0,0],this.m_viewMatrix=null}lock(){this.m_unlock=!1}unlock(){this.m_unlock=!0}lookAtLH(t,e,s){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtPos.copyFrom(e),this.m_up.copyFrom(s),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!1,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_initUP.copyFrom(s),this.m_initUP.normalize(),a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}lookAtRH(t,e,s){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtPos.copyFrom(e),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_lookAtDirec,s,this.m_initRV),a.default.Cross(this.m_initRV,this.m_lookAtDirec,this.m_initUP),this.m_initUP.normalize(),this.m_initRV.normalize(),this.m_up.copyFrom(this.m_initUP),this.m_changed=!0)}getLookAtLHToCamera(t){t.lookAtLH(this.m_camPos,this.m_lookAtPos,this.m_up)}getLookAtRHToCamera(t){t.lookAtRH(this.m_camPos,this.m_lookAtPos,this.m_up)}perspectiveLH(t,e,s,i){this.m_unlock&&(this.m_project2Enabled=!1,this.m_aspect=e,this.m_fovRadian=t,this.m_zNear=s,this.m_zFar=i,this.m_projMat.perspectiveLH(t,e,s,i),this.m_viewFieldZoom=Math.tan(.5*t),this.m_perspectiveEnabled=!0,this.m_rightHandEnabled=!1,this.m_changed=!0)}perspectiveRH(t,e,s,i){this.m_unlock&&(this.m_aspect=e,this.m_fovRadian=t,this.m_zNear=s,this.m_zFar=i,this.m_projMat.perspectiveRH(t,e,s,i),this.m_viewFieldZoom=Math.tan(.5*t),this.m_project2Enabled=!1,this.m_perspectiveEnabled=!0,this.m_rightHandEnabled=!0,this.m_changed=!0)}perspectiveRH2(t,e,s,i,r){this.m_unlock&&(this.m_aspect=e/s,this.m_fovRadian=t,this.m_zNear=i,this.m_zFar=r,this.m_projMat.perspectiveRH2(t,e,s,i,r),this.m_viewFieldZoom=Math.tan(.5*t),this.m_perspectiveEnabled=!0,this.m_project2Enabled=!0,this.m_rightHandEnabled=!0,this.m_changed=!0)}getAspect(){return this.m_aspect}getViewFieldZoom(){return this.m_viewFieldZoom}orthoRH(t,e,s,i,r,a){this.m_unlock&&(this.m_zNear=t,this.m_zFar=e,this.m_b=s,this.m_t=i,this.m_l=r,this.m_r=a,this.m_projMat.orthoRH(s,i,r,a,t,e),this.m_perspectiveEnabled=!1,this.m_rightHandEnabled=!0,this.m_changed=!0)}orthoLH(t,e,s,i,r,a){this.m_unlock&&(this.m_zNear=t,this.m_zFar=e,this.m_b=s,this.m_t=i,this.m_l=r,this.m_r=a,this.m_projMat.orthoLH(s,i,r,a,t,e),this.m_perspectiveEnabled=!1,this.m_rightHandEnabled=!1,this.m_changed=!0)}isPerspectiveEnabled(){return this.m_perspectiveEnabled}isRightHandEnabled(){return this.m_rightHandEnabled}setViewXY(t,e){this.m_unlock&&(this.m_viewX=t,this.m_viewY=e)}setViewSize(t,e){this.m_unlock&&(t==this.m_viewW&&e==this.m_viewH||(this.m_viewW=t,this.m_viewH=e,this.m_viewHalfW=.5*t,this.m_viewHalfH=.5*e,this.m_perspectiveEnabled?this.m_project2Enabled?this.m_rightHandEnabled&&this.perspectiveRH2(this.m_fovRadian,t,e,this.m_zNear,this.m_zFar):this.m_rightHandEnabled?this.perspectiveRH(this.m_fovRadian,t/e,this.m_zNear,this.m_zFar):this.perspectiveLH(this.m_fovRadian,t/e,this.m_zNear,this.m_zFar):this.orthoRH(this.m_zNear,this.m_zFar,-.5*e,.5*e,-.5*t,.5*t)))}getViewX(){return this.m_viewX}getViewY(){return this.m_viewY}getViewWidth(){return this.m_viewW}getViewHeight(){return this.m_viewH}translation(t){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtPos.x=t.x+this.m_lookAtDirec.x,this.m_lookAtPos.y=t.y+this.m_lookAtDirec.y,this.m_lookAtPos.z=t.z+this.m_lookAtDirec.z,this.m_changed=!0)}translationXYZ(t,e,s){this.m_tempV.setXYZ(t,e,s),this.m_unlock&&a.default.DistanceSquared(this.m_camPos,this.m_tempV)>1e-5&&(this.m_camPos.setTo(t,e,s),this.m_lookAtPos.x=t+this.m_lookAtDirec.x,this.m_lookAtPos.y=e+this.m_lookAtDirec.y,this.m_lookAtPos.z=s+this.m_lookAtDirec.z,this.m_changed=!0)}forward(t){this.m_unlock&&(this.m_camPos.x+=this.m_lookDirectNV.x*t,this.m_camPos.y+=this.m_lookDirectNV.y*t,this.m_camPos.z+=this.m_lookDirectNV.z*t,this.m_lookAtPos.x=this.m_camPos.x+this.m_lookAtDirec.x,this.m_lookAtPos.y=this.m_camPos.y+this.m_lookAtDirec.y,this.m_lookAtPos.z=this.m_camPos.z+this.m_lookAtDirec.z,this.m_changed=!0)}slideViewOffsetXY(t,e){if(this.m_unlock){this.m_tempV.setXYZ(t,e,0),this.m_invViewMat.transformVectorSelf(this.m_tempV),t=this.m_tempV.x-this.m_camPos.x,e=this.m_tempV.y-this.m_camPos.y;let s=this.m_tempV.z-this.m_camPos.z;this.m_camPos.x+=t,this.m_camPos.y+=e,this.m_camPos.z+=s,this.m_lookAtPos.x+=t,this.m_lookAtPos.y+=e,this.m_lookAtPos.z+=s,this.m_changed=!0}}forwardFixPos(t,e){this.m_unlock&&(this.m_camPos.x=e.x+this.m_lookDirectNV.x*t,this.m_camPos.y=e.y+this.m_lookDirectNV.y*t,this.m_camPos.z=e.z+this.m_lookDirectNV.z*t,this.m_lookAtPos.x=this.m_camPos.x+this.m_lookAtDirec.x,this.m_lookAtPos.y=this.m_camPos.y+this.m_lookAtDirec.y,this.m_lookAtPos.z=this.m_camPos.z+this.m_lookAtDirec.z,this.m_changed=!0)}swingHorizontalWithAxis(t,e){this.m_unlock&&(this.m_tempMat.identity(),null!=e?this.m_tempMat.appendRotation(t*r.default.MATH_PI_OVER_180,e):this.m_tempMat.appendRotation(t*r.default.MATH_PI_OVER_180,a.default.Y_AXIS),this.m_lookAtDirec.x=this.m_camPos.x-this.m_lookAtPos.x,this.m_lookAtDirec.y=this.m_camPos.y-this.m_lookAtPos.y,this.m_lookAtDirec.z=this.m_camPos.z-this.m_lookAtPos.z,this.m_tempMat.transformVectorSelf(this.m_lookAtDirec),this.m_camPos.x=this.m_lookAtDirec.x+this.m_lookAtPos.x,this.m_camPos.y=this.m_lookAtDirec.y+this.m_lookAtPos.y,this.m_camPos.z=this.m_lookAtDirec.z+this.m_lookAtPos.z,this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_tempMat.transformVectorSelf(this.m_initRV),this.m_initRV.normalize(),a.default.Cross(this.m_initRV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_changed=!0)}swingHorizontal(t){this.m_unlock&&(this.m_tempMat.identity(),this.m_tempMat.appendRotation(t*r.default.MATH_PI_OVER_180,this.m_up),this.m_lookAtDirec.x=this.m_camPos.x-this.m_lookAtPos.x,this.m_lookAtDirec.y=this.m_camPos.y-this.m_lookAtPos.y,this.m_lookAtDirec.z=this.m_camPos.z-this.m_lookAtPos.z,this.m_tempMat.transformVectorSelf(this.m_lookAtDirec),this.m_camPos.x=this.m_lookAtDirec.x+this.m_lookAtPos.x,this.m_camPos.y=this.m_lookAtDirec.y+this.m_lookAtPos.y,this.m_camPos.z=this.m_lookAtDirec.z+this.m_lookAtPos.z,this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}swingVertical(t){this.m_unlock&&(this.m_tempMat.identity(),this.m_tempMat.appendRotation(t*r.default.MATH_PI_OVER_180,this.m_initRV),this.m_lookAtDirec.x=this.m_camPos.x-this.m_lookAtPos.x,this.m_lookAtDirec.y=this.m_camPos.y-this.m_lookAtPos.y,this.m_lookAtDirec.z=this.m_camPos.z-this.m_lookAtPos.z,this.m_tempMat.transformVectorSelf(this.m_lookAtDirec),this.m_camPos.x=this.m_lookAtDirec.x+this.m_lookAtPos.x,this.m_camPos.y=this.m_lookAtDirec.y+this.m_lookAtPos.y,this.m_camPos.z=this.m_lookAtDirec.z+this.m_lookAtPos.z,this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_initRV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_initUP.copyFrom(this.m_up),this.m_changed=!0)}setPosition(t){if(this.m_unlock){a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_tempV);let e=this.m_tempV.dot(this.m_initUP);this.m_tempV1.copyFrom(this.m_initUP),this.m_tempV1.scaleBy(e),this.m_tempV.subtractBy(this.m_tempV1),this.m_camPos.copyFrom(t),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_tempV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_changed=!0}}setPositionXYZ(t,e,s){if(this.m_unlock){a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_tempV);var i=this.m_tempV.dot(this.m_initUP);this.m_tempV1.copyFrom(this.m_initUP),this.m_tempV1.scaleBy(i),this.m_tempV.subtractBy(this.m_tempV1),this.m_camPos.setTo(t,e,s),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_tempV,this.m_lookAtDirec,this.m_up),this.m_up.normalize(),this.m_changed=!0}}setLookPosXYZFixUp(t,e,s){this.m_unlock&&(this.m_lookAtPos.setTo(t,e,s),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}setPositionXYZFixUp(t,e,s){this.m_unlock&&(this.m_camPos.setTo(t,e,s),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}setPositionFixUp(t){this.m_unlock&&(this.m_camPos.copyFrom(t),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookRHEnabled=!0,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),a.default.Cross(this.m_lookAtDirec,this.m_up,this.m_initRV),this.m_initRV.normalize(),this.m_changed=!0)}copyFrom(t){let e=t.getPosition();this.m_camPos.copyFrom(e),e=t.getLookAtPosition(),this.m_lookAtPos.copyFrom(e),this.setZNear(t.getZNear()),this.setZFar(t.getZFar()),this.setNearPlaneWidth(t.getNearPlaneWidth()),this.setNearPlaneHeight(t.getNearPlaneHeight()),this.setPerspectiveEnabled(t.getPerspectiveEnabled()),this.m_viewInvertMat.copyFrom(t.getViewInvMatrix())}getNV(){return this.m_tempNV.copyFrom(this.m_lookDirectNV),this.m_tempNV}getUV(){return this.m_tempUPV.copyFrom(this.m_up),this.m_tempUPV}getRV(){return this.m_tempRV.copyFrom(this.m_initRV),this.m_tempRV}getPosition(){return this.m_tempCamPos.copyFrom(this.m_camPos),this.m_tempCamPos}getLookAtPosition(){return this.m_tempLookAtPos.copyFrom(this.m_lookAtPos),this.m_tempLookAtPos}setLookAtPosition(t,e,s){this.m_unlock&&(this.m_lookAtPos.setTo(t,e,s),this.m_lookAtDirec.x=this.m_lookAtPos.x-this.m_camPos.x,this.m_lookAtDirec.y=this.m_lookAtPos.y-this.m_camPos.y,this.m_lookAtDirec.z=this.m_lookAtPos.z-this.m_camPos.z,this.m_lookDirectNV.copyFrom(this.m_lookAtDirec),this.m_lookDirectNV.normalize(),this.m_changed=!0)}getPerspectiveEnabled(){return this.m_perspectiveEnabled}setPerspectiveEnabled(t){this.m_perspectiveEnabled=t}appendRotationByAxis(t,e,s=null){this.m_unlock&&(this.m_rotDegree=t,this.m_changed=!0,this.m_rotAxis.copyFrom(e),this.m_rotPivotPoint=s,this.m_axisRotEnabled=!0)}setRotationX(t){this.m_rotV.x=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getRotationX(){return this.m_rotV.x}setRotationY(t){this.m_rotV.y=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getRotationY(){return this.m_rotV.y}setRotationZ(t){this.m_rotV.z=t,this.m_changed=!0,this.m_axisRotEnabled=!1}getRotationZ(){return this.m_rotV.z}setRotationXYZ(t,e,s){this.m_unlock&&(this.m_rotV.setXYZ(t,e,s),this.m_changed=!0,this.m_axisRotEnabled=!1)}screenXYToViewXYZ(t,e,s){t-=this.m_viewX,e-=this.m_viewY,this.m_perspectiveEnabled&&(t=this.m_nearPlaneWidth*(t-this.m_viewHalfW)/this.m_viewHalfW,e=this.m_nearPlaneHeight*(this.m_viewHalfH-e)/this.m_viewHalfH),s.setTo(t,e,-this.m_zNear)}screenXYToWorldXYZ(t,e,s){t-=this.m_viewX,e-=this.m_viewY,this.m_perspectiveEnabled&&(t=.5*this.m_nearPlaneWidth*(t-this.m_viewHalfW)/this.m_viewHalfW,e=.5*this.m_nearPlaneHeight*(this.m_viewHalfH-e)/this.m_viewHalfH),s.setTo(t,e,-this.m_zNear),s.w=1,this.m_viewInvertMat.transformVectorSelf(s)}getWorldPickingRayByScreenXY(t,e,s,i){t-=this.m_viewX,e-=this.m_viewY,this.m_perspectiveEnabled?(t=.5*this.m_nearPlaneWidth*(t-this.m_viewHalfW)/this.m_viewHalfW,e=.5*this.m_nearPlaneHeight*(e-this.m_viewHalfH)/this.m_viewHalfH,s.setTo(t,e,-this.m_zNear),s.w=1,this.m_viewInvertMat.transformVectorSelf(s),i.copyFrom(s),i.subtractBy(this.m_camPos),i.normalize()):(t-=this.m_viewHalfW,e-=this.m_viewHalfH,s.setTo(t,e,-this.m_zNear),s.w=1,this.m_viewInvertMat.transformVectorSelf(s),i.copyFrom(this.m_lookDirectNV))}calcScreenNormalizeXYByWorldPos(t,e){e.copyFrom(t),this.m_vpMat.transformVectorSelf(e),e.x/=e.w,e.y/=e.w}worldPosToScreen(t){this.m_viewMat.transformVector3Self(t),this.m_projMat.transformVectorSelf(t),t.x/=t.w,t.y/=t.w,t.x*=this.m_viewHalfW,t.y*=this.m_viewHalfH,t.x+=this.m_viewX,t.y+=this.m_viewY}calcViewRectByWorldSphere(t,e,s){this.m_viewMat.transformVector3Self(t),e*=1.15,s.x=t.x-e,s.y=t.y-e,s.z=t.z,t.x+=e,t.y+=e,this.m_projMat.transformPerspV4Self(s),this.m_projMat.transformPerspV4Self(t),t.z=1/t.w,s.z=t.x*t.z,s.w=t.y*t.z,s.z*=this.m_viewHalfW,s.w*=this.m_viewHalfH,s.x*=t.z,s.y*=t.z,s.x*=this.m_viewHalfW,s.y*=this.m_viewHalfH,s.z=s.z-s.x,s.w=s.w-s.y,s.x+=this.m_viewX,s.y+=this.m_viewY}calcScreenRectByWorldSphere(t,e,s){this.m_viewMat.transformVector3Self(t),e*=1.15,s.x=t.x-e,s.y=t.y-e,t.x+=e,t.y+=e,this.m_projMat.transformPerspV4Self(s),this.m_projMat.transformPerspV4Self(t),t.z=1/t.w,s.z=t.x*t.z,s.w=t.y*t.z,s.x*=t.z,s.y*=t.z,s.z=s.z-s.x,s.w=s.w-s.y}getInvertViewMatrix(){return this.m_invViewMat}getZNear(){return this.m_zNear}setZNear(t){this.m_zNear=t}getZFar(){return this.m_zFar}setZFar(t){this.m_zFar=t}getNearPlaneWidth(){return this.m_nearPlaneWidth}setNearPlaneWidth(t){this.m_nearPlaneWidth=t}getNearPlaneHeight(){return this.m_nearPlaneHeight}setNearPlaneHeight(t){this.m_nearPlaneHeight=t}getFov(){return this.m_fovRadian}__calcTestParam(){null==this.m_invViewMat&&(this.m_invViewMat=new n.default),this.m_invViewMat.copyFrom(this.m_viewMat),this.m_invViewMat.invert();let t=null,e=this.m_viewHalfH,s=this.m_viewHalfW,i=this.m_viewHalfH,r=this.m_viewHalfW;if(this.m_perspectiveEnabled){let t=Math.tan(.5*this.m_fovRadian);e=this.m_zNear*t,s=e*this.m_aspect,i=this.m_zFar*t,r=i*this.m_aspect}this.m_nearPlaneHalfW=s,this.m_nearPlaneHalfH=e,this.m_nearWCV.setTo(0,0,-this.m_zNear),this.m_farWCV.setTo(0,0,-this.m_zFar),this.m_invViewMat.transformVectorSelf(this.m_nearWCV),this.m_invViewMat.transformVectorSelf(this.m_farWCV),this.m_wNV.x=this.m_farWCV.x-this.m_nearWCV.x,this.m_wNV.y=this.m_farWCV.y-this.m_nearWCV.y,this.m_wNV.z=this.m_farWCV.z-this.m_nearWCV.z,this.m_wNV.normalize(),t=this.m_wFruPlaneList[0],t.nv.copyFrom(this.m_wNV),t.distance=t.nv.dot(this.m_farWCV),t.position.copyFrom(this.m_farWCV),t=this.m_wFruPlaneList[1],t.nv.copyFrom(this.m_wFruPlaneList[0].nv),t.distance=t.nv.dot(this.m_nearWCV),t.position.copyFrom(this.m_nearWCV),this.m_wFrustumVtxArr[8]=this.m_nearWCV,this.m_wFrustumVtxArr[9]=this.m_farWCV,this.m_wFrustumVtxArr[11]=this.m_wNV,this.m_wFrustumVtxArr[0].setTo(-r,-i,-this.m_zFar),this.m_wFrustumVtxArr[1].setTo(r,-i,-this.m_zFar),this.m_wFrustumVtxArr[2].setTo(r,i,-this.m_zFar),this.m_wFrustumVtxArr[3].setTo(-r,i,-this.m_zFar),this.m_wFrustumVtxArr[4].setTo(-s,-e,-this.m_zNear),this.m_wFrustumVtxArr[5].setTo(s,-e,-this.m_zNear),this.m_wFrustumVtxArr[6].setTo(s,e,-this.m_zNear),this.m_wFrustumVtxArr[7].setTo(-s,e,-this.m_zNear),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[0]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[1]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[2]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[3]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[4]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[5]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[6]),this.m_invViewMat.transformVectorSelf(this.m_wFrustumVtxArr[7]),this.m_frustumWAABB.max.setTo(-9999999,-9999999,-9999999),this.m_frustumWAABB.min.setTo(9999999,9999999,9999999);for(let a=0;a<8;++a)this.m_frustumWAABB.addPosition(this.m_wFrustumVtxArr[a]);this.m_frustumWAABB.updateFast();let h=this.m_wFrustumVtxArr[0],o=this.m_wFrustumVtxArr[4];this.m_tempV.x=h.x-o.x,this.m_tempV.y=h.y-o.y,this.m_tempV.z=h.z-o.z,h=this.m_wFrustumVtxArr[1],o=this.m_wFrustumVtxArr[5],this.m_tempV1.x=h.x-o.x,this.m_tempV1.y=h.y-o.y,this.m_tempV1.z=h.z-o.z,t=this.m_wFruPlaneList[3],a.default.Cross(this.m_tempV1,this.m_tempV,t.nv),t.nv.normalize(),t.distance=t.nv.dot(h),t.position.copyFrom(h),h=this.m_wFrustumVtxArr[3],o=this.m_wFrustumVtxArr[7],this.m_tempV.x=h.x-o.x,this.m_tempV.y=h.y-o.y,this.m_tempV.z=h.z-o.z,h=this.m_wFrustumVtxArr[2],o=this.m_wFrustumVtxArr[6],this.m_tempV1.x=h.x-o.x,this.m_tempV1.y=h.y-o.y,this.m_tempV1.z=h.z-o.z,t=this.m_wFruPlaneList[2],a.default.Cross(this.m_tempV1,this.m_tempV,t.nv),t.nv.normalize(),t.distance=t.nv.dot(h),t.position.copyFrom(h),h=this.m_wFrustumVtxArr[0],o=this.m_wFrustumVtxArr[4],this.m_tempV.x=h.x-o.x,this.m_tempV.y=h.y-o.y,this.m_tempV.z=h.z-o.z,h=this.m_wFrustumVtxArr[3],o=this.m_wFrustumVtxArr[7],this.m_tempV1.x=h.x-o.x,this.m_tempV1.y=h.y-o.y,this.m_tempV1.z=h.z-o.z,t=this.m_wFruPlaneList[4],a.default.Cross(this.m_tempV,this.m_tempV1,t.nv),t.nv.normalize(),t.distance=t.nv.dot(h),t.position.copyFrom(h),h=this.m_wFrustumVtxArr[1],o=this.m_wFrustumVtxArr[5],this.m_tempV.x=h.x-o.x,this.m_tempV.y=h.y-o.y,this.m_tempV.z=h.z-o.z,h=this.m_wFrustumVtxArr[2],o=this.m_wFrustumVtxArr[6],this.m_tempV1.x=h.x-o.x,this.m_tempV1.y=h.y-o.y,this.m_tempV1.z=h.z-o.z,t=this.m_wFruPlaneList[5],a.default.Cross(this.m_tempV,this.m_tempV1,t.nv),t.nv.normalize(),t.distance=t.nv.dot(h),t.position.copyFrom(h),this.m_fpNVArr[0].copyFrom(this.m_wFruPlaneList[0].nv),this.m_fpNVArr[1].copyFrom(this.m_wFruPlaneList[1].nv),this.m_fpNVArr[1].scaleBy(-1),this.m_fpNVArr[2].copyFrom(this.m_wFruPlaneList[2].nv),this.m_fpNVArr[3].copyFrom(this.m_wFruPlaneList[3].nv),this.m_fpNVArr[3].scaleBy(-1),this.m_fpNVArr[4].copyFrom(this.m_wFruPlaneList[4].nv),this.m_fpNVArr[4].scaleBy(-1),this.m_fpNVArr[5].copyFrom(this.m_wFruPlaneList[5].nv),this.m_fpDisArr[0]=this.m_wFruPlaneList[0].distance,this.m_fpDisArr[1]=-this.m_wFruPlaneList[1].distance,this.m_fpDisArr[2]=this.m_wFruPlaneList[2].distance,this.m_fpDisArr[3]=-this.m_wFruPlaneList[3].distance,this.m_fpDisArr[4]=-this.m_wFruPlaneList[4].distance,this.m_fpDisArr[5]=this.m_wFruPlaneList[5].distance}getWordFrustumWAABB(){return this.m_frustumWAABB}getWordFrustumWAABBCenter(){return this.m_frustumWAABB.center}getWordFrustumVtxArr(){return this.m_wFrustumVtxArr}getWordFrustumPlaneArr(){return this.m_wFruPlaneList}visiTestSphere2(t,e){let s=this.m_fpNVArr[0].dot(t)-this.m_fpDisArr[0]-e>r.default.MATH_MIN_POSITIVE;return!s&&(s=this.m_fpNVArr[1].dot(t)-this.m_fpDisArr[1]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[2].dot(t)-this.m_fpDisArr[2]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[3].dot(t)-this.m_fpDisArr[3]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[4].dot(t)-this.m_fpDisArr[4]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.m_fpNVArr[5].dot(t)-this.m_fpDisArr[5]-e>r.default.MATH_MIN_POSITIVE,!s)))))}visiTestSphere3(t,e,s){let i=this.m_fpNVArr[0].dot(t)-this.m_fpDisArr[0]+s-e>r.default.MATH_MIN_POSITIVE;return!i&&(i=this.m_fpNVArr[1].dot(t)-this.m_fpDisArr[1]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.m_fpNVArr[2].dot(t)-this.m_fpDisArr[2]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.m_fpNVArr[3].dot(t)-this.m_fpDisArr[3]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.m_fpNVArr[4].dot(t)-this.m_fpDisArr[4]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.m_fpNVArr[5].dot(t)-this.m_fpDisArr[5]-e>r.default.MATH_MIN_POSITIVE,!i)))))}visiTestPosition(t){let e=this.m_fpNVArr[0].dot(t)-this.m_fpDisArr[0]>r.default.MATH_MIN_POSITIVE;return!e&&(e=this.m_fpNVArr[1].dot(t)-this.m_fpDisArr[1]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[2].dot(t)-this.m_fpDisArr[2]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[3].dot(t)-this.m_fpDisArr[3]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[4].dot(t)-this.m_fpDisArr[4]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.m_fpNVArr[5].dot(t)-this.m_fpDisArr[5]>r.default.MATH_MIN_POSITIVE,!e)))))}visiTestPlane(t,e){let s=t.dot(this.m_wFruPlaneList[0].position)-e,i=s*(t.dot(this.m_wFruPlaneList[1].position)-e);return i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.m_wFruPlaneList[2].position)-e),i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.m_wFruPlaneList[3].position)-e),i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.m_wFruPlaneList[4].position)-e),i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.m_wFruPlaneList[5].position)-e),i<r.default.MATH_MIN_POSITIVE))))}visiTestSphere(t,e){let s=this.m_frustumWAABB.sphereIntersect(t,e);if(s){let s=this.m_wFruPlaneList[0].intersectSphere(t,e),i=this.m_wFruPlaneList[1].intersectSphere(t,e);return!(s*i>=0&&!this.m_wFruPlaneList[0].intersectBoo&&!this.m_wFruPlaneList[1].intersectBoo)&&(s=this.m_wFruPlaneList[2].intersectSphere(t,e),i=this.m_wFruPlaneList[3].intersectSphere(t,e),!(s*i>=0&&!this.m_wFruPlaneList[2].intersectBoo&&!this.m_wFruPlaneList[3].intersectBoo)&&(s=this.m_wFruPlaneList[4].intersectSphere(t,e),i=this.m_wFruPlaneList[5].intersectSphere(t,e),!(s*i>=0&&!this.m_wFruPlaneList[4].intersectBoo&&!this.m_wFruPlaneList[5].intersectBoo)))}return!1}visiTestAABB(t){let e=t.center,s=t.radius,i=this.m_frustumWAABB.sphereIntersect(e,s);if(i){let t=this.m_wFruPlaneList[0].intersectSphere(e,s),i=this.m_wFruPlaneList[1].intersectSphere(e,s);return!(t*i>=0&&!this.m_wFruPlaneList[0].intersectBoo&&!this.m_wFruPlaneList[1].intersectBoo)&&(t=this.m_wFruPlaneList[2].intersectSphere(e,s),i=this.m_wFruPlaneList[3].intersectSphere(e,s),!(t*i>=0&&!this.m_wFruPlaneList[2].intersectBoo&&!this.m_wFruPlaneList[3].intersectBoo)&&(t=this.m_wFruPlaneList[4].intersectSphere(e,s),i=this.m_wFruPlaneList[5].intersectSphere(e,s),!(t*i>=0&&!this.m_wFruPlaneList[4].intersectBoo&&!this.m_wFruPlaneList[5].intersectBoo)))}return!1}setViewMatrix(t){this.m_viewMatrix=t,this.m_changed=!0}update(){this.m_changed&&(this.version++,this.m_changed=!1,null==this.m_viewMatrix?(this.m_axisRotEnabled?this.m_matrix.appendRotationPivot(this.m_rotDegree*r.default.MATH_PI_OVER_180,this.m_rotAxis,this.m_rotPivotPoint):(this.m_matrix.identity(),this.m_matrix.appendRotationEulerAngle(this.m_rotV.x*r.default.MATH_PI_OVER_180,this.m_rotV.y*r.default.MATH_PI_OVER_180,this.m_rotV.z*r.default.MATH_PI_OVER_180)),this.m_lookRHEnabled?this.m_viewMat.lookAtRH(this.m_camPos,this.m_lookAtPos,this.m_up):this.m_viewMat.lookAtLH(this.m_camPos,this.m_lookAtPos,this.m_up),this.m_viewMat.append(this.m_matrix)):this.m_viewMat.copyFrom(this.m_viewMatrix),this.m_project2Enabled?(this.m_nearPlaneWidth=this.m_zNear*Math.tan(.5*this.m_fovRadian)*2,this.m_nearPlaneHeight=this.m_nearPlaneWidth/this.m_aspect):(this.m_nearPlaneHeight=this.m_zNear*Math.tan(.5*this.m_fovRadian)*2,this.m_nearPlaneWidth=this.m_aspect*this.m_nearPlaneHeight),this.m_viewInvertMat.copyFrom(this.m_viewMat),this.m_viewInvertMat.invert(),this.m_vpMat.identity(),this.m_vpMat.copyFrom(this.m_viewMat),this.m_vpMat.append(this.m_projMat),this.__calcTestParam(),this.updateUniformData())}updateCamMatToUProbe(t){t.isEnabled()&&(t.update(),t.getFS32At(0).set(this.m_viewMat.getLocalFS32(),0),t.getFS32At(1).set(this.m_projMat.getLocalFS32(),0))}updateUniformData(){this.uniformEnabled&&(this.updateCamMatToUProbe(this.matUProbe),this.ufrustumProbe.setVec4DataAt(0,this.m_zNear,this.m_zFar,this.m_nearPlaneHalfW,this.m_nearPlaneHalfH),this.ufrustumProbe.update(),this.ucameraPosProbe.setVec4DataAt(0,this.m_camPos.x,this.m_camPos.y,this.m_camPos.z,1),this.ucameraPosProbe.update())}destroy(){}lookRHEnabled(){return this.m_lookRHEnabled}lookLHEnabled(){return!this.m_lookRHEnabled}getVPMatrix(){return this.m_vpMat}getViewMatrix(){return this.m_viewMat}getViewInvMatrix(){return this.m_viewInvertMat}getProjectMatrix(){return this.m_projMat}}e.default=l},c62b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=s("e08e"),n=s("7c63"),h=i(s("29ef"));class o{constructor(){this.uid=-1,this.value=-1,this.__$rpuid=-1,this.__$rprouid=-1,this.shader=null,this.pos=new r.default,this.bounds=null,this.ibufType=0,this.ibufStep=2,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.drawOffset=0,this.partTotal=0,this.partGroup=null,this.trisNumber=0,this.visible=!0,this.drawEnabled=!0,this.drawMode=0,this.renderState=0,this.rcolorMask=0,this.drawFlag=0,this.vro=null,this.transUniform=null,this.uniform=null,this.shdUid=-1,this.vtxUid=-1,this.tro=null,this.texMid=-1,this.ubo=null}testDrawFlag(){this.shader.drawFlag!=this.drawFlag&&(this.shader.drawFlag=this.drawFlag,n.RenderStateObject.UseRenderState(this.renderState),n.RenderColorMask.UseRenderState(this.rcolorMask))}getUid(){return this.uid}getRPOUid(){return this.__$rpuid}getRPROUid(){return this.__$rprouid}getShaderUid(){return this.shdUid}setIvsParam(t,e){this.ivsIndex=t,this.ivsCount=e,this.drawOffset=t*this.ibufStep,this.drawEnabled=this.visible&&this.ivsCount>0}setVisible(t){this.visible=t,this.drawEnabled=t&&this.ivsCount>0}setDrawFlag(t,e){this.renderState=t,this.rcolorMask=e,this.drawFlag=(e<<10)+t}drawThis(t){switch(++h.default.DrawCallTimes,h.default.DrawTrisNumber+=this.trisNumber,this.drawMode){case a.RenderDrawMode.ELEMENTS_TRIANGLES:t.RContext.drawElements(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ELEMENTS_LINES:t.RContext.drawElements(t.LINES,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:t.RContext.drawElements(t.TRIANGLE_STRIP,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:t.RContext.drawElementsInstanced(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset,this.insCount);break;case a.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:t.RContext.drawElements(t.TRIANGLE_FAN,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ARRAYS_LINES:t.RContext.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case a.RenderDrawMode.ARRAYS_LINE_STRIP:t.RContext.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}drawPart(t){++h.default.DrawCallTimes,h.default.DrawTrisNumber+=this.trisNumber;let e=0,s=t.RContext;switch(this.drawMode){case a.RenderDrawMode.ELEMENTS_TRIANGLES:for(;e<this.partTotal;)s.drawElements(t.TRIANGLES,this.partGroup[e++],this.ibufType,this.partGroup[e++]);break;case a.RenderDrawMode.ELEMENTS_LINES:for(;e<this.partTotal;)s.drawElements(t.LINES,this.partGroup[e++],this.ibufType,this.partGroup[e++]);break;case a.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:s.drawElements(t.TRIANGLE_STRIP,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:s.drawElementsInstanced(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset,this.insCount);break;case a.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:s.drawElements(t.TRIANGLE_FAN,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ARRAYS_LINES:s.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case a.RenderDrawMode.ARRAYS_LINE_STRIP:s.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}run2(t){null!=this.ubo&&this.ubo.run(t),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}run(t){null!=this.ubo&&this.ubo.run(t),this.vro.run(),this.tro.run(),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}runLockMaterial2(t){this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(null==t?this.uniform:t,this.transUniform)}runLockMaterial(){this.vro.run(),this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(this.uniform,this.transUniform)}reset(){this.vro.__$detachThis(),this.vro=null,this.tro.__$detachThis(),this.tro=null,this.texMid=-1,this.__$rprouid=-1,this.ubo=null,this.shdUid=-1,this.vtxUid=-1,this.uniform=null,this.transUniform=null,this.partGroup=null,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.partTotal=0,this.drawMode=0,this.drawFlag=0,this.renderState=0,this.rcolorMask=0,this.drawEnabled=!0,this.shader=null,this.bounds=null}destroy(){this.reset()}toString(){return"[RPOUnit(uid = "+this.uid+")]"}}e.default=o},c711:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("fecb")),h=i(s("c120"));class o{constructor(){this.m_renderer=null,this.m_camera=null,this.m_headNode=null,this.m_rsn=null,this.m_hitList=new Uint8Array(256),this.m_rsnList=null,this.m_selectedNode=null,this.m_selectedTotal=0,this.m_testMode=0,this.m_invpv=new a.default,this.m_invtv=new a.default,this.m_rlpv=null,this.m_rltv=null,this.m_rlsiv=new Uint8Array(4),this.m_rlinvtv=new a.default,this.m_outv=new a.default,this.m_vecs=[null,null],this.m_gpuTestEnabled=!1}setRenderer(t){this.m_renderer=t}setRayTestMode(t){this.m_testMode=t}setRay(t,e){this.m_rlpv=t,this.m_rltv=e}getRay(t,e){t.copyFrom(this.m_rlpv),e.copyFrom(this.m_rltv)}setCamera(t){this.m_camera=t}setCullingNodeHead(t){if(this.m_headNode=t,null==this.m_rsnList){this.m_rsnList=[];let t=0;for(;t<256;++t)this.m_rsnList.push(new h.default)}}getSelectedNode(){return this.m_selectedNode}getSelectedNodes(){return this.m_rsnList}getSelectedNodesTotal(){return this.m_selectedTotal}sorting(t,e){let s=this.m_rsnList;this.m_rsn=s[t];while(t<e){while(t<e&&s[e].dis>=this.m_rsn.dis)--e;s[t]=s[e];while(t<e&&s[t].dis<=this.m_rsn.dis)++t;s[e]=s[t]}return s[t]=this.m_rsn,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}run(){let t=this.m_headNode;if(null!=t){let e=0,s=this.m_rltv,i=this.m_rlpv,a=this.m_outv,h=null,o=0;Math.abs(s.x)>r.default.MATH_MIN_POSITIVE?this.m_rlinvtv.x=1/s.x:this.m_rlinvtv.x=r.default.MATH_MAX_POSITIVE,Math.abs(s.y)>r.default.MATH_MIN_POSITIVE?this.m_rlinvtv.y=1/s.y:this.m_rlinvtv.y=r.default.MATH_MAX_POSITIVE,Math.abs(s.z)>r.default.MATH_MIN_POSITIVE?this.m_rlinvtv.z=1/s.z:this.m_rlinvtv.z=r.default.MATH_MAX_POSITIVE,this.m_rlinvtv.x<0?this.m_rlsiv[0]=1:this.m_rlsiv[0]=0,this.m_rlinvtv.y<0?this.m_rlsiv[1]=1:this.m_rlsiv[1]=0,this.m_rlinvtv.z<0?this.m_rlsiv[2]=1:this.m_rlsiv[2]=0;while(null!=t)t.drawEnabled&&t.entity.mouseEnabled&&(a.x=t.bounds.center.x-i.x,a.y=t.bounds.center.y-i.y,a.z=t.bounds.center.z-i.z,e=a.dot(s),a.x-=e*s.x,a.y-=e*s.y,a.z-=e*s.z,a.getLengthSquared()<=t.bounds.radius2&&t.rayTestState<1&&(this.m_vecs[0]=t.bounds.min,this.m_vecs[1]=t.bounds.max,n.default.IntersectionRL3(this.m_vecs,this.m_rlsiv,this.m_rlinvtv,s,i,a)&&(h=this.m_rsnList[o],h.entity=t.entity,h.dis=this.m_rlinvtv.w,h.wpv.copyFrom(a),++o))),t=t.next;this.m_selectedNode=null;let l=0;if(o>0){let t=this.m_invpv,e=this.m_invtv,r=null,n=0,h=0,_=null,u=null,m=s.dot(i),d=0;if(o>1){this.snsort(0,o-1);let c=!this.m_gpuTestEnabled;for(l=0;l<o;++l){if(u=this.m_rsnList[l],r=this.m_rsnList[l].entity,r.isPolyhedral()?c?(_=r.getInvMatrix(),_.transformOutVector3(i,t),_.deltaTransformOutVector(s,e),n=r.testRay(t,e,a,!0)):n=0:(_=r.getInvMatrix(),_.transformOutVector3(i,t),_.deltaTransformOutVector(s,e),n=r.testRay(t,e,a,!0)),n>0){if(u.lpv.copyFrom(a),r.getMatrix().transformOutVector3(a,u.wpv),u.dis=s.dot(u.wpv)-m,this.m_hitList[h]=l,++h,u.dis>d){this.m_selectedNode=u;break}}else if(n<0&&(this.m_hitList[h]=l,++h,u.dis>d)){this.m_selectedNode=u;break}d=u.dis}null==this.m_selectedNode&&h>0&&(this.m_selectedNode=this.m_rsnList[this.m_hitList[0]])}else u=this.m_rsnList[0],r=this.m_rsnList[0].entity,_=r.getInvMatrix(),_.transformOutVector3(i,t),_.deltaTransformOutVector(s,e),n=r.testRay(t,e,a,!0),n>0?(u.lpv.copyFrom(a),r.getMatrix().transformOutVector3(a,u.wpv),u.dis=s.dot(u.wpv)-m,this.m_selectedNode=u):n<0&&(this.m_selectedNode=u)}for(l=o;l<this.m_selectedTotal;++l)this.m_selectedNode!=this.m_rsnList[l]&&(this.m_rsnList[l].entity=null);this.m_selectedTotal=o}}clear(){this.m_selectedNode=null}}e.default=o},c8ba:function(t,e){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch(i){"object"===typeof window&&(s=window)}t.exports=s},ca6c:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static PushThreeBitValueToInt(t,e){return(t<<3)+e}static PopThreeBitValueFromInt(t){return i.value=7&t,t>>3}static ContainsBit(t,e){return(e&t)>0}static RemoveBit(t,e){return~e&t}static AddBit(t,e){return e|t}static AssembleFromIntArray(t){let e=0,s=0,i=t.length;for(;e<i;++e)t[e]>0&&(s|=1<<e);return s}}i.BIT_ZERO=0,i.BIT_ONE_0=1,i.BIT_ONE_1=2,i.BIT_ONE_2=4,i.BIT_ONE_3=8,i.BIT_ONE_4=16,i.BIT_ONE_5=32,i.BIT_ONE_6=64,i.BIT_ONE_7=128,i.BIT_ONE_8=256,i.BIT_ONE_9=512,i.BIT_ONE_10=1024,i.BIT_ONE_11=2048,i.value=0,e.default=i},cb29:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=s("8a0a"),n=i(s("e7d2")),h=s("e08e");class o{constructor(t=r.default.VTX_STATIC_DRAW){this.m_bufDataUsage=0,this.m_layoutBit=0,this.m_transMatrix=null,this.m_vbuf=null,this.m_ivs=null,this.m_bufDataList=null,this.m_bufDataStepList=null,this.m_bufStatusList=null,this.wireframe=!1,this.bounds=null,this.normalType=a.VtxNormalType.GOURAND,this.normalScale=1,this.vtxTotal=0,this.trisNumber=0,this.drawMode=h.RenderDrawMode.ELEMENTS_TRIANGLES,this.vtCount=0,this.vbWholeDataEnabled=!1,this.drawInsBeginIndex=0,this.drawInsStride=0,this.drawInsTotal=0,this.m_attachCount=0,this.m_bufDataUsage=t}updateWireframeIvs(){if(null!==this.m_ivs){const t=this.m_ivs;let e,s=[];for(let i=0,r=t.length;i<r;i+=3){const e=t[i+0],r=t[i+1],a=t[i+2];s.push(e,r,r,a,a,e)}e=s.length<65535?new Uint16Array(s):new Uint32Array(s),this.m_ivs=e,this.drawMode=h.RenderDrawMode.ELEMENTS_LINES}}buildEnd(){this.m_bufDataList=n.default.BufDataList,this.m_bufDataStepList=n.default.BufDataStepList,this.m_bufStatusList=n.default.BufStatusList}setTransformMatrix(t){this.m_transMatrix=t}getTransformMatrix(){return this.m_transMatrix}isPolyhedral(){return!0}setPolyhedral(t){}testRay(t,e,s,i){return-1}rebuild(){if(null==this.m_vbuf&&null!=this.m_bufDataList){n.default.Reset();let t=0,e=this.m_bufDataList.length;for(;t<e;++t)n.default.AddFloat32Data(this.m_bufDataList[t],this.m_bufDataStepList[t],this.m_bufStatusList[t]);this.m_vbuf=n.default.CreateBySaveData(this.getBufDataUsage()),null!=this.m_ivs&&(this.m_vbuf.setUint16IVSData(this.m_ivs),this.vtCount=this.m_ivs.length)}}__$attachVBuf(){return null==this.m_vbuf&&this.rebuild(),n.default.__$$AttachAt(this.m_vbuf.getUid()),this.m_vbuf}__$detachVBuf(t){if(this.m_vbuf!=t)throw Error("Fatal Error!");n.default.__$$DetachAt(this.m_vbuf.getUid())}isGeomDynamic(){return this.m_bufDataUsage}getBufDataUsage(){return this.m_bufDataUsage}getVS(){return null}getIVS(){return this.m_ivs}setBufSortFormat(t){this.m_layoutBit=t}getBufSortFormat(){return this.m_layoutBit}isVBufEnabledAt(t){return(t&this.m_layoutBit)>0}__$attachThis(){++this.m_attachCount}__$detachThis(){1==this.m_attachCount?(--this.m_attachCount,this.__$dispose()):--this.m_attachCount,this.m_attachCount<1&&(this.m_attachCount=0)}getAttachCount(){return this.m_attachCount}__$dispose(){this.getAttachCount()<1&&null!=this.m_vbuf&&(n.default.__$$DetachAt(this.m_vbuf.getUid()),this.m_vbuf=null)}isEnabled(){return null!=this.m_vbuf}isResFree(){return this.getAttachCount()<1&&null==this.m_vbuf}__$destroy(){this.isResFree()&&(this.m_ivs=null,this.m_bufDataList=null,this.m_bufDataStepList=null,this.m_bufStatusList=null,this.trisNumber=0,this.m_transMatrix=null)}toString(){return"[MeshBase()]"}}e.default=o},cc48:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["NONE"]=0]="NONE",t[t["CAMERA"]=1]="CAMERA",t[t["POV"]=2]="POV",t[t["INNER_POV_PASS"]=3]="INNER_POV_PASS",t[t["CAMERA_AND_POV"]=4]="CAMERA_AND_POV"}(i||(i={})),e.SpaceCullingMask=i},ccdf:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("cfaf")),n=i(s("acaa")),h=i(s("85b6")),o=i(s("3b73"));class l{constructor(t){this.m_renderProxy=null,this.m_rttTexs=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.m_rttCubeTexs=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.m_rttFloatTexs=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.m_rttDepthTexs=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.m_renderProxy=t}getRenderProxy(){return this.m_renderProxy}createWrapperTex(t,e,s=!1){let i=new h.default(t,e,s);return i}createRTTTex2D(t,e,s=!1){let i=new a.default(t,e,s);return i}createDepthTex2D(t,e,s=!1){let i=new n.default(t,e,s);return i}getCubeRTTTextureAt(t){return null!=this.m_rttCubeTexs[t]?(this.m_rttCubeTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttCubeTexs[t]):(this.m_rttCubeTexs[t]=this.createRTTTex2D(32,32),this.m_rttCubeTexs[t].toCubeTexture(),this.m_rttCubeTexs[t].name="sys_cube_rttTex_"+t,this.m_rttCubeTexs[t].minFilter=r.TextureConst.LINEAR,this.m_rttCubeTexs[t].magFilter=r.TextureConst.LINEAR,this.m_rttCubeTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttCubeTexs[t])}createCubeRTTTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.m_rttCubeTexs[t]?(this.m_rttCubeTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttCubeTexs[t]):(this.m_rttCubeTexs[t]=this.createRTTTex2D(e,s),this.m_rttCubeTexs[t].toCubeTexture(),this.m_rttCubeTexs[t].name="sys_cube_rttTex_"+t,this.m_rttCubeTexs[t].minFilter=r.TextureConst.LINEAR,this.m_rttCubeTexs[t].magFilter=r.TextureConst.LINEAR,this.m_rttCubeTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttCubeTexs[t])}getRTTTextureAt(t){return null!=this.m_rttTexs[t]?(this.m_rttTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttTexs[t]):(this.m_rttTexs[t]=this.createRTTTex2D(32,32),this.m_rttTexs[t].to2DTexture(),this.m_rttTexs[t].name="sys_rttTex_"+t,this.m_rttTexs[t].minFilter=r.TextureConst.LINEAR,this.m_rttTexs[t].magFilter=r.TextureConst.LINEAR,this.m_rttTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttTexs[t])}createRTTTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.m_rttTexs[t]?(this.m_rttTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttTexs[t]):(this.m_rttTexs[t]=this.createRTTTex2D(e,s),this.m_rttTexs[t].to2DTexture(),this.m_rttTexs[t].name="sys_rttTex_"+t,this.m_rttTexs[t].minFilter=r.TextureConst.LINEAR,this.m_rttTexs[t].magFilter=r.TextureConst.LINEAR,this.m_rttTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttTexs[t])}getDepthTextureAt(t){return null!=this.m_rttDepthTexs[t]?(this.m_rttDepthTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttDepthTexs[t]):(this.m_rttDepthTexs[t]=this.createDepthTex2D(64,64),this.m_rttDepthTexs[t].to2DTexture(),this.m_rttDepthTexs[t].name="sys_depthTex_"+t,this.m_rttDepthTexs[t].minFilter=r.TextureConst.NEAREST,this.m_rttDepthTexs[t].magFilter=r.TextureConst.NEAREST,this.m_rttDepthTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttDepthTexs[t])}createDepthTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.m_rttDepthTexs[t]?(this.m_rttDepthTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttDepthTexs[t]):(this.m_rttDepthTexs[t]=this.createDepthTex2D(e,s),this.m_rttDepthTexs[t].to2DTexture(),this.m_rttDepthTexs[t].name="sys_depthTex_"+t,this.m_rttDepthTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttDepthTexs[t])}getRTTFloatTextureAt(t){if(null!=this.m_rttFloatTexs[t])return this.m_rttFloatTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttFloatTexs[t];let e=this.createRTTTex2D(64,64);return e.to2DTexture(),this.m_rttFloatTexs[t]=e,this.m_rttFloatTexs[t].name="sys_rttFloatTex_"+t,e.internalFormat=r.TextureFormat.RGBA16F,e.srcFormat=r.TextureFormat.RGBA,e.dataType=r.TextureDataType.FLOAT,e.minFilter=r.TextureConst.NEAREST,e.magFilter=r.TextureConst.NEAREST,o.default.IsWebGL1()&&(e.dataType=r.TextureDataType.HALF_FLOAT_OES),this.m_rttFloatTexs[t].__$setRenderProxy(this.m_renderProxy),e}createRTTFloatTextureAt(t,e,s){if(e=e>1?e:1,s=s>1?s:1,null!=this.m_rttFloatTexs[t])return this.m_rttFloatTexs[t].__$setRenderProxy(this.m_renderProxy),this.m_rttFloatTexs[t];let i=this.createRTTTex2D(e,s);return i.to2DTexture(),this.m_rttFloatTexs[t]=i,this.m_rttFloatTexs[t].name="sys_rttFloatTex_"+t,i.internalFormat=r.TextureFormat.RGBA16F,i.srcFormat=r.TextureFormat.RGBA,i.dataType=r.TextureDataType.FLOAT,i.minFilter=r.TextureConst.NEAREST,i.magFilter=r.TextureConst.NEAREST,o.default.IsWebGL1()&&(i.dataType=r.TextureDataType.HALF_FLOAT_OES),this.m_rttFloatTexs[t].__$setRenderProxy(this.m_renderProxy),i}}e.RTTTextureStore=l,e.default=l},cfaf:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class n extends a.default{constructor(t,e,s=!1){super(t,e,s),this.m_type=r.TextureProxyType.RTT,this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST}to2DTexture(){this.m_texTarget=r.TextureTarget.TEXTURE_2D}enableMipmap(){this.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,this.magFilter=r.TextureConst.LINEAR,this.mipmapEnabled=!0}disableMipmap(){this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.mipmapEnabled=!1}toCubeTexture(){this.m_texTarget=r.TextureTarget.TEXTURE_CUBE}setSize(t,e){this.m_texWidth=t,this.m_texHeight=e}uploadFromFbo(t,e,s){let i=t.getRC(),a=this.mipmapEnabled;this.mipmapEnabled=!1,t.hasResUid(this.getResUid())?this.getBufWidth()==e&&this.getBufHeight()==s||(t.bindToGpu(this.getResUid()),this.bindTexture(i,e,s),this.m_texWidth=e,this.m_texHeight=s,this.__$buildParam(i)):(this.m_sampler=r.TextureTarget.GetValue(i,this.m_texTarget),this.createTexBuf(t),t.bindToGpu(this.getResUid()),this.bindTexture(i,e,s),this.m_haveRData=!0,this.m_texWidth=e,this.m_texHeight=s,this.__$buildParam(i)),this.mipmapEnabled=a}bindTexture(t,e,s){let i=r.TextureFormat.ToGL(t,this.internalFormat),a=r.TextureFormat.ToGL(t,this.srcFormat),n=r.TextureDataType.ToGL(t,this.dataType);switch(this.m_texTarget){case r.TextureTarget.TEXTURE_2D:t.texImage2D(t.TEXTURE_2D,0,i,e,s,0,a,n,null);break;case r.TextureTarget.TEXTURE_CUBE:for(let r=0;r<6;++r)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,i,e,s,0,a,n,null);break;case r.TextureTarget.TEXTURE_SHADOW_2D:t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT16,e,s,0,t.DEPTH_COMPONENT,t.FLOAT,null);break;default:break}}toString(){return"[RTTTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},d096:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("3b73")),n=i(s("c497")),h=i(s("5336")),o=i(s("bd6f")),l=i(s("91e2")),_=i(s("b9b5")),u=i(s("79d6")),m=s("8d98"),d=i(s("1710")),c=i(s("f63b")),f=i(s("0644")),p=i(s("b161")),g=i(s("e943")),v=i(s("0890")),x=i(s("a46e")),y=i(s("2514")),T=i(s("e439")),b=i(s("899a")),S=i(s("f240")),E=i(s("b8ff")),A=i(s("77cf")),w=i(s("b168")),R=i(s("1e50")),M=i(s("845e")),D=i(s("402a")),F=s("0714");class L{constructor(){this.m_rscene=null,this.m_texLoader=null,this.m_camTrack=null,this.m_statusDisp=new h.default,this.m_profileInstance=new g.default,this.m_stageDragSwinger=new v.default,this.m_cameraZoomController=new x.default,this.m_dracoMeshLoader=new R.default,this.m_reflectPlaneY=0,this.m_materialPipeline=null,this.m_posList=[new r.default(0,200,0)],this.m_modules=["static/assets/modules/longxiaPincer.rawmd"],this.m_scale=1,this.m_pos=null,this.m_scales=[100],this.m_sphPos=new r.default,this.m_timeoutId=-1}getImageTexByUrl(t,e=!0,s=!0){let i=this.m_texLoader.getImageTexByUrl(t);return i.mipmapEnabled=s,e&&i.setWrap(m.TextureConst.WRAP_REPEAT),i}initialize(){if(null==this.m_rscene){a.default.SHADERCODE_TRACE_ENABLED=!0;let t=new n.default;t.setCamProject(45,10,8e3),t.setAttriStencil(!0),t.setAttriAntialias(!0),t.setCamPosition(1e3,1e3,1e3),this.m_rscene=new p.default,this.m_rscene.initialize(t,3),this.m_rscene.updateCamera(),this.m_texLoader=new c.default(this.m_rscene.textureBlock),this.m_rscene.enableMouseEvent(!0),this.m_cameraZoomController.bindCamera(this.m_rscene.getCamera()),this.m_cameraZoomController.initialize(this.m_rscene.getStage3D()),this.m_stageDragSwinger.initialize(this.m_rscene.getStage3D(),this.m_rscene.getCamera()),this.m_camTrack=new f.default,this.m_camTrack.bindCamera(this.m_rscene.getCamera()),this.m_statusDisp.initialize(),this.m_rscene.addEventListener(d.default.MOUSE_DOWN,this,this.mouseDown);let e=new _.default;e.initialize(300),this.m_rscene.addEntity(e,1),this.m_rscene.setClearRGBColor3f(.1,.2,.1),this.m_envData=new A.default,this.m_envData.initialize(),this.m_envData.setFogColorRGB3f(0,.8,.1),this.m_vsmModule=new T.default(0),this.m_vsmModule.seetCameraPosition(new r.default(120,800,120)),this.m_vsmModule.setCameraNear(10),this.m_vsmModule.setCameraFar(3e3),this.m_vsmModule.setMapSize(512,512),this.m_vsmModule.setCameraViewSize(4e3,4e3),this.m_vsmModule.setShadowRadius(2),this.m_vsmModule.setShadowBias(-5e-4),this.m_vsmModule.initialize(this.m_rscene,[0],3e3),this.m_vsmModule.setShadowIntensity(.8),this.m_vsmModule.setColorIntensity(.3),this.m_materialPipeline=new F.MaterialPipeline,this.m_materialPipeline.addPipe(this.m_envData),this.m_materialPipeline.addPipe(this.m_vsmModule.getVSMData()),this.m_dracoMeshLoader.initialize(2),this.m_dracoMeshLoader.setListener(this),this.initSceneObjs(),this.update()}}loadNext(){this.m_modules.length>0&&(this.m_pos=this.m_posList.pop(),this.m_scale=this.m_scales.pop(),this.m_dracoMeshLoader.load(this.m_modules.pop()))}dracoParse(t,e,s){}dracoParseFinish(t,e){let s=this.m_vsmModule.getShadowMap(),i=(Math.random(),new y.default);i.setMaterialPipeline(this.m_materialPipeline),i.initializeByCodeBuf(!0),i.setTextureList([s,this.getImageTexByUrl("static/assets/brickwall_big.jpg")]);let a=new w.default;a.setBufSortFormat(i.getBufSortFormat()),a.initialize(t);let n=this.m_scale,h=new D.default;h.setMaterial(i),h.setMesh(a),h.setScaleXYZ(n,n,n),this.m_rscene.addEntity(h);let o=new r.default;h.getPosition(o);let l=h.getGlobalBounds().min;o.y+=this.m_reflectPlaneY-l.y+370,h.setPosition(o),h.update()}useMaterial(t){let e=new y.default;e.setMaterialPipeline(this.m_materialPipeline),t.setMaterial(e)}initSceneObjs(){this.loadNext();let t=new u.default;t.initiazlize(this.m_vsmModule.getCamera()),this.m_rscene.addEntity(t,1);let e=this.m_vsmModule.getShadowMap(),s=new o.default;this.useMaterial(s),s.initializeXOZ(-600,-600,1200,1200,[e,this.getImageTexByUrl("static/assets/brickwall_big.jpg")]),s.setXYZ(0,-1,0),this.m_rscene.addEntity(s);let i=new l.default;this.useMaterial(i),i.showAllFace(),i.initializeCube(4e3,[e,this.getImageTexByUrl("static/assets/metal_02.jpg")]),this.m_rscene.addEntity(i);let r=new l.default;this.useMaterial(r),r.initializeCube(200,[e,this.getImageTexByUrl("static/assets/metal_02.jpg")]),this.m_rscene.addEntity(r),r.setRotationXYZ(100,-60,0),r.setXYZ(230,100,0),r.update();let a=new S.default;this.useMaterial(a),a.initialize(80,200,20,[e,this.getImageTexByUrl("static/assets/noise.jpg")]),this.m_rscene.addEntity(a),a.setXYZ(-230,100,0);let n=new E.default;this.useMaterial(n),n.initialize(80,20,20,[e,this.getImageTexByUrl("static/assets/metal_02.jpg")]),this.m_rscene.addEntity(n),n.setXYZ(-230,300,-200),this.m_sphEntity=n,n.getPosition(this.m_sphPos),n=new E.default,this.useMaterial(n),n.initialize(80,20,20,[e,this.getImageTexByUrl("static/assets/metal_08.jpg")]),n.setScaleXYZ(1.2,1.2,1.2),n.setXYZ(-40,100,-180),this.m_rscene.addEntity(n)}mouseDown(t){b.default.Flag_0=1}update(){this.m_timeoutId>-1&&clearTimeout(this.m_timeoutId),this.m_timeoutId=setTimeout(this.update.bind(this),40),this.m_statusDisp.render(),M.default.Run()}run(){this.m_sphPos.x=300*Math.sin(this.m_sphPos.w),this.m_sphPos.w+=.05,this.m_sphEntity.setPosition(this.m_sphPos),this.m_sphEntity.update(),this.m_statusDisp.update(!1),this.m_stageDragSwinger.runWithYAxis(),this.m_cameraZoomController.run(r.default.ZERO,30),this.m_rscene.update(!0),this.m_vsmModule.force=!0,this.m_vsmModule.run(),this.m_rscene.run(!1),this.m_rscene.runEnd()}}e.DemoVSMModule=L,e.default=L},d1a0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{static PlaneCalcIntersectSphere(t,e,s,i){a.IntersectBoo=!1,a.IntersectSatus=0,e=t.dot(s)-e,e>r.default.MATH_MIN_POSITIVE?(a.IntersectBoo=e<=i,a.IntersectSatus=1):e<r.default.MATH_MAX_NEGATIVE&&(a.IntersectBoo=-e<=i,a.IntersectSatus=-1)}static CalcPVCloseV(t,e,s,i){let r=e-s.dot(t);i.setTo(r*t.x,r*t.y,r*t.z),i.addBy(s)}static CalcPVCloseV2(t,e,s,i){let r=e-s.dot(t);i.setTo(r*t.x,r*t.y,r*t.z),i.addBy(s)}static IntersectionSLV2(t,e,s,i,a){let n=t.dot(i);if(n>r.default.MATH_MIN_POSITIVE||n<r.default.MATH_MAX_NEGATIVE){let r=t.dot(s)-e;return a.x=1e5*i.x+s.x,a.y=1e5*i.y+s.y,a.z=1e5*i.z+s.z,n=t.dot(a)-e,n=r/(r-n),a.subtractBy(s),a.scaleBy(n),a.addBy(s),1}return n=t.dot(s)-e,n<=r.default.MATH_MIN_POSITIVE||n>=r.default.MATH_MAX_NEGATIVE?(a.copyFrom(s),2):0}}a.IntersectBoo=!1,a.IntersectSatus=0,e.default=a},d314:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class n extends a.default{constructor(t,e){super(t,e,!1),this.m_imgDataList=null,this.m_texTarget=r.TextureTarget.TEXTURE_CUBE,this.m_type=r.TextureProxyType.ImageCube,this.internalFormat=r.TextureFormat.RGBA,this.srcFormat=r.TextureFormat.RGBA,this.dataType=r.TextureDataType.UNSIGNED_BYTE,this.mipmapEnabled=!0}setDataFromImageToFaceAt(t,e,s=0){null!=e&&(null==this.m_imgDataList&&(this.m_imgDataList=[null,null,null,null,null,null]),e.width>0&&e.height>0&&(0==t&&(this.m_texWidth=e.width,this.m_texHeight=e.height,this.m_miplevel=s),this.m_imgDataList[t]={imgData:e,miplevel:s},this.m_haveRData=null!=this.m_imgDataList[t]))}uploadData(t){let e=t.getRC(),s=null;for(let i=0;i<6;++i)s=this.m_imgDataList[i],e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,this.m_miplevel,r.TextureFormat.ToGL(e,this.internalFormat),r.TextureFormat.ToGL(e,this.srcFormat),r.TextureDataType.ToGL(e,this.dataType),s.imgData)}toString(){return"[ImageCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.m_imgDataList)for(let t=0;t<6;++t)null!=this.m_imgDataList[t]&&(this.m_imgDataList[t].imgData=null);super.__$destroy()}}}e.default=n},d53d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uns="",this.program=null,this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataSizeList=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,s=e.length;for(let i=0;i<s;++i)if(t==e[i])return this.dataList[i]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let s=this.uniformNameList,i=s.length;for(let r=0;r<i;++r)if(t==s[r]){this.dataList[r]=e;break}}}copyDataFromProbe(t){this.types=[],this.dataSizeList=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]),this.dataSizeList.push(t.dataSizeList[e]);this.uniformSize=t.uniformsTotal}useByLocation(t,e,s,i){}useByShd(t,e){}use(t){}updateData(){}destroy(){}}e.ShaderUniform=i;class r extends i{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV1(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e])}useByLocation(t,e,s,i){t.useUniformV1(s,e,this.dataList[i],this.dataSizeList[i])}useByShd(t,e){let s=0;for(;s<this.uniformSize;++s)t.useUniformV1(e.getUniformLocationByNS(this.uniformNameList[s]),this.types[s],this.dataList[s],this.dataSizeList[s])}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let s=0;s<t;++s)e=this.calcModels[s],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null}}e.ShaderUniformV1=r;class a extends i{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV2(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e],0)}useByLocation(t,e,s,i){t.useUniformV2(s,e,this.dataList[i],this.dataSizeList[i],0)}useByShd(t,e){let s=0;for(;s<this.uniformSize;++s)t.useUniformV2(e.getUniformLocationByNS(this.uniformNameList[s]),this.types[s],this.dataList[s],this.dataSizeList[s],0)}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let s=0;s<t;++s)e=this.calcModels[s],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null,this.program=null}}e.ShaderUniformV2=a;class n extends i{constructor(){super()}use(t){t.useUniformMat4(this.locations[0],this.dataList[0])}useByLocation(t,e,s,i){t.useUniformMat4(s,this.dataList[0])}useByShd(t,e){t.useUniformMat4(e.getUniformLocationByNS(this.uniformNameList[0]),this.dataList[0])}destroy(){this.dataList[0]=null,this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null}}e.ShaderMat4Uniform=n,e.default=i},d7e2:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(t){this.m_rc=null,this.m_rc=t}sortRODisplay(t,e){let s=this.m_rc.getCamera().getPosition();for(let i=0;i<e;++i)t[i].value=-r.default.DistanceSquared(t[i].bounds.center,s);return 0}}e.default=a},d846:function(t,e,s){"use strict";s.r(e),s.d(e,"VSMShaderCode",(function(){return a}));var i="vec4 pack2HalfToRGBA( vec2 v ) {\r\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\r\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\r\n}\r\nvec2 unpackRGBATo2Half( vec4 v ) {\r\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\r\n}\r\n\r\nvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\r\n\r\n    return unpackRGBATo2Half( VOX_Texture2D( shadow, uv ) );\r\n\r\n}\r\n#ifdef VOX_USE_SHADOW\r\nfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ) {\r\n\r\n    float occlusion = 1.0;\r\n\r\n    vec2 distribution = texture2DDistribution( shadow, uv );\r\n\r\n    float hard_shadow = step( compare , distribution.x ); // Hard Shadow\r\n\r\n    if (hard_shadow != 1.0 ) {\r\n\r\n        float distance = compare - distribution.x ;\r\n        float variance = max( 0.0, distribution.y * distribution.y );\r\n        float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\r\n        softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\r\n        occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\r\n\r\n    }\r\n    return occlusion;\r\n\r\n}\r\nfloat getVSMShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\r\n\r\n    float shadow = 1.0;\r\n    \r\n    shadowCoord.xyz /= shadowCoord.w;\r\n    shadowCoord.z += shadowBias;\r\n    \r\n    // if ( something && something ) breaks ATI OpenGL shader compiler\r\n    // if ( all( something, something ) ) using this instead\r\n\r\n    bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\r\n    bool inFrustum = all( inFrustumVec );\r\n\r\n    bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\r\n\r\n    bool frustumTest = all( frustumTestVec );\r\n\r\n    if ( frustumTest ) {\r\n        shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\r\n    }\r\n    return shadow;\r\n}\r\nfloat getVSMShadowFactor(vec4 shadowPos) {\r\n    \r\n    float shadow = getVSMShadow( VOX_VSM_MAP, u_vsmParams[1].xy, u_vsmParams[0].x, u_vsmParams[0].z, shadowPos );\r\n    float shadowIntensity = 1.0 - u_vsmParams[0].w;\r\n    shadow = clamp(shadow, 0.0, 1.0) * (1.0 - shadowIntensity) + shadowIntensity;\r\n    float f = clamp(dot(worldNormal,u_vsmParams[2].xyz),0.0,1.0);\r\n    shadow = f > 0.0001 ? min(shadow,clamp(f, shadowIntensity,1.0)) : shadowIntensity;\r\n    f = u_vsmParams[1].z;\r\n    return shadow * (1.0 - f) + f;\r\n}\r\nvoid useVSMShadow(inout vec4 color) {\r\n    float factor = getVSMShadowFactor(v_shadowPos);\r\n    color.xyz *= vec3(factor);\r\n}\r\n#endif";let r="\nvoid calcShadowPos(in vec4 wpos) {\n    v_shadowPos = u_shadowMat * wpos;\n}\n";const a={vert:"",vert_head:r,vert_body:"\n#ifdef VOX_USE_SHADOW\ncalcShadowPos( worldPosition );\n#endif\n",frag:"",frag_head:i,frag_body:"\n#ifdef VOX_USE_SHADOW\nuseVSMShadow( FragColor0 );\n#endif\n"}},d958:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=i(s("36cb")),n=i(s("c497")),h=i(s("3c81")),o=i(s("1e15")),l=i(s("0e01")),_=s("eca0"),u=i(s("442e")),m=i(s("1264"));class d{constructor(){this.___$$$$$$$Author="VilyLei(vily313@126.com)",this.m_uid=-1,this.m_entity3DMana=null,this.m_processes=[],this.m_processesLen=0,this.m_sprocesses=[],this.m_sprocessesLen=0,this.m_renderProxy=null,this.m_adapter=null,this.m_dataBuilder=null,this.m_renderInsContext=null,this.m_batchEnabled=!0,this.m_processFixedState=!0,this.m_rpoUnitBuilder=new _.RPOUnitBuilder,this.m_rpoNodeBuilder=new u.default,this.m_processBuider=new h.default,this.m_roVtxBuild=null,this.m_stage3D=null,this.m_fixProcess=null,this.m_uid=d.s_uid++,this.m_renderInsContext=new l.default(this.m_uid)}__$setStage3D(t){null!=t&&null==this.m_stage3D&&(this.m_stage3D=t)}getUid(){return this.m_uid}getRCUid(){return this.m_uid}getRPONodeBuilder(){return this.m_rpoNodeBuilder}getDataBuilder(){return this.m_dataBuilder}getRendererContext(){return this.m_renderInsContext}getRenderProxy(){return null!=this.m_renderProxy||(this.m_renderProxy=this.m_renderInsContext.getRenderProxy()),this.m_renderProxy}getStage3D(){return this.m_renderProxy.getStage3D()}getViewX(){return this.m_adapter.getViewportX()}getViewY(){return this.m_adapter.getViewportY()}getViewWidth(){return this.m_adapter.getViewportWidth()}getViewHeight(){return this.m_adapter.getViewportHeight()}getCamera(){return this.m_renderInsContext.getCamera()}createCamera(){return null}useCamera(t,e=!1){}useMainCamera(){}updateCamera(){null!=this.m_renderProxy&&this.m_renderProxy.updateCamera()}initialize(t=null,e=null){null==this.m_dataBuilder&&null!=e&&(null==t&&(t=new n.default),this.m_batchEnabled=t.batchEnabled,this.m_processFixedState=t.processFixedState,this.m_renderProxy=this.m_renderInsContext.getRenderProxy(),this.m_dataBuilder=new a.default,this.m_roVtxBuild=new o.default,this.m_renderInsContext.setCameraParam(t.camProjParam.x,t.camProjParam.y,t.camProjParam.z),this.m_renderInsContext.initialize(t,e,this.m_stage3D,this.m_dataBuilder,this.m_roVtxBuild),this.m_adapter=this.m_renderProxy.getRenderAdapter(),this.m_uid=this.m_renderProxy.getUid(),this.m_dataBuilder.initialize(this.m_renderProxy,this.m_rpoUnitBuilder,this.m_processBuider,this.m_roVtxBuild),this.m_renderInsContext.initManager(this.m_dataBuilder),this.m_entity3DMana=new m.default(this.m_uid,this.m_dataBuilder,this.m_rpoUnitBuilder,this.m_processBuider),this.m_fixProcess=this.createSeparatedProcess(),this.appendProcess(this.m_batchEnabled,this.m_processFixedState))}update(){this.m_renderProxy.Texture.update(),this.m_renderProxy.Vertex.update(),this.m_entity3DMana.update()}updateAllProcess(){for(let t=0;t<this.m_processesLen;++t)this.m_processes[t].update()}updateProcessAt(t){t>-1&&t<this.m_processesLen&&this.m_processes[t].update()}setEntityManaListener(t){this.m_entity3DMana.entityManaListener=t}addEntity(t,e=0,s=!0){null!=t&&t.__$testRendererEnabled()&&e>-1&&e<this.m_processesLen&&this.m_entity3DMana.addEntity(t,this.m_processes[e].getUid(),s)}addEntityToProcess(t,e,s=!0){null!=e&&null!=t&&t.__$testRendererEnabled()&&e.getRCUid()==this.m_uid&&this.m_entity3DMana.addEntity(t,e.getUid(),s)}moveEntityToProcessAt(t,e){if(null!=t&&t.getRendererUid()==this.m_uid&&t.isRenderEnabled()&&e>-1&&e<this.m_processesLen){let s=t.getDisplay().__$$runit.getRPROUid(),i=this.m_processBuider.getNodeByUid(s),a=this.m_processes[e];i!=a&&(i.removeDispUnit(t.getDisplay()),t.__$rseFlag=a.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),a.addDisp(t.getDisplay()))}}moveEntityToProcess(t,e){if(null!=e&&null!=t&&t.getRendererUid()==this.m_uid&&t.isRenderEnabled()){let s=t.getDisplay().__$$runit.getRPROUid(),i=this.m_processBuider.getNodeByUid(s);if(i!=e){let s=e;i.removeDispUnit(t.getDisplay()),t.__$rseFlag=e.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),s.addDisp(t.getDisplay())}}}removeEntity(t){null!=t&&t.getRendererUid()==this.m_uid&&(this.m_entity3DMana.removeEntity(t),t.__$setRenderProxy(null))}removeEntityFromProcess(t,e){null!=e&&e.getRCUid()==this.m_uid&&null!=t&&t.getRendererUid()==this.m_uid&&(e.removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}removeEntityByProcessIndex(t,e){e>=0&&e<this.m_processesLen&&null!=t&&t.getRendererUid()==this.m_uid&&(this.m_processes[e].removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}setProcessSortEnabledAt(t,e){t>=0&&t<this.m_processesLen&&this.m_processes[t].setSortEnabled(e)}setProcessSortEnabled(t,e){if(null!=t&&t.getRCUid()==this.m_uid){let s=t;s.setSortEnabled(e)}}appendProcess(t=!0,e=!1){this.m_processBuider.setCreateParams(this.m_dataBuilder.getRenderShader(),this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_renderProxy.Vertex,t,e);let s=this.m_processBuider.create();return this.m_processes.push(s),s.setRendererParam(this.m_renderProxy,this.m_processesLen),++this.m_processesLen,s}createSeparatedProcess(t=!0,e=!1){this.m_processBuider.setCreateParams(this.m_dataBuilder.getRenderShader(),this.m_rpoNodeBuilder,this.m_rpoUnitBuilder,this.m_renderProxy.Vertex,t,e);let s=this.m_processBuider.create();return this.m_sprocesses.push(s),s.setRendererParam(this.m_renderProxy,this.m_sprocessesLen),s}setRendererProcessParam(t,e,s){t>-1&&t<this.m_processesLen&&this.m_processes[t].setRenderParam(e,s)}getProcessAt(t){return t>-1&&t<this.m_processesLen?this.m_processes[t]:null}showInfoAt(t){t>-1&&t<this.m_processesLen&&this.m_processes[t].showInfo()}getProcessesTotal(){return this.m_processesLen}updateMaterialUniformToCurrentShd(t){this.m_dataBuilder.getRenderShader().useUniformToCurrentShd(t.__$uniform)}drawEntityByLockMaterial(t,e=!1,s=!0){null!=t&&t.getVisible()&&t.getRendererUid()==this.m_uid&&!this.m_renderProxy.isContextLost()&&this.m_fixProcess.drawLockMaterialByDisp(t.getDisplay(),e,s)}drawEntity(t,e=!1,s=!0){null!=t&&t.getVisible()&&!this.m_renderProxy.isContextLost()&&(t.getRendererUid()==this.m_uid?this.m_fixProcess.drawDisp(t.getDisplay(),e,s):t.__$testRendererEnabled()&&this.m_entity3DMana.addEntity(t,this.m_fixProcess.getUid(),!1))}runAt(t){this.m_renderProxy.isContextLost()||this.m_processes[t].run()}runProcess(t){t.getRCUid()!=this.m_uid||this.m_renderProxy.isContextLost()||t.run()}runFromIndexTo(t){if(!this.m_renderProxy.isContextLost())for(let e=t;e<this.m_processesLen;++e)this.m_processes[e].run()}run(){if(this.m_entity3DMana.isHaveEntity()&&!this.m_renderProxy.isContextLost())for(let t=0;t<this.m_processesLen;++t)this.m_processes[t].run()}getRenderUnitsTotal(){let t=0;for(let e=0;e<this.m_processesLen;++e)t+=this.m_processes[e].getUnitsTotal();return t}renderflush(){this.m_renderProxy.flush()}toString(){return"[RendererInstance(uid = "+this.m_uid+")]"}}d.s_uid=0,e.RendererInstance=d,e.default=d},da6a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){if(this.m_texResource=null,this.m_bufferUpdater=null,this.m_textureTotal=0,this.m_textureMap=new Map,this.m_freeMap=new Map,this.m_texUid=0,this.m_freeUids=[],null!=i.s_ins)throw Error("This Class is a singleton class!!!");i.s_ins=null}static GetInstance(){return null!=i.s_ins||(i.s_ins=new i),i.s_ins}getFreeUid(){if(this.m_freeUids.length>0)return this.m_freeUids.pop();let t=this.m_texUid++;return t}__$$addTexture(t){null==t||this.m_textureMap.has(t.getUid())||(this.m_textureMap.set(t.getUid(),t),this.m_textureTotal++)}getTextureByUid(t){return this.m_textureMap.get(t)}hasTextureByUid(t){return this.m_textureMap.has(t)}removeTextureByUid(t){if(this.m_textureMap.has(t)){let e=this.m_textureMap.get(t);if(e.getAttachCount()<1)return this.m_freeMap.has(t)&&this.m_freeMap.delete(t),e.__$destroy(),e.__$$removeFromSlot(),this.m_textureMap.delete(t),this.m_freeUids.push(t),this.m_textureTotal--,e}return null}getTextureTotal(){return this.m_textureTotal}setRenderProxy(t){this.m_texResource=t.Texture}setBufferUpdater(t){this.m_bufferUpdater=t}getFreeResUidMap(){return this.m_freeMap}isGpuEnabledByResUid(t){return this.m_texResource.hasResUid(t)}addRenderBuffer(t,e){null!=this.m_bufferUpdater&&this.m_bufferUpdater.__$addBuf(t,e)}addFreeUid(t){this.m_freeMap.set(t,0)}removeFreeUid(t){this.m_freeMap.has(t)&&this.m_freeMap.delete(t)}}i.s_ins=null,e.default=i},dc2b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("e08e"),a=i(s("29ef"));class n{constructor(){this.m_uid=0,this.m_material=null,this.m_matFS32=null,this.name="RODisplay",this.visible=!0,this.ivsIndex=0,this.ivsCount=0,this.trisNumber=0,this.insCount=0,this.drawMode=r.RenderDrawMode.ELEMENTS_TRIANGLES,this.vbuf=null,this.renderState=a.default.NORMAL_STATE,this.rcolorMask=a.default.COLOR_MASK_ALL_TRUE,this.mouseEnabled=!1,this.m_partGroup=null,this.m_trans=null,this.__$ruid=-1,this.__$rpuid=-1,this.__$$rsign=r.DisplayRenderSign.NOT_IN_WORLD,this.__$$runit=null,this.m_uid=n.s_uid++}getPartGroup(){return this.m_partGroup}createPartGroup(t){t<1&&(t=1),this.m_partGroup=new Uint16Array(2*t)}setDrawPartAt(t,e,s){t*=2,this.m_partGroup[t]=s,this.m_partGroup[++t]=e}getUid(){return this.m_uid}setTransform(t){this.m_trans=t,this.m_matFS32=t.getLocalFS32()}getTransform(){return this.m_trans}getMatrixFS32(){return this.m_matFS32}enableDrawInstanced(t,e){this.drawMode=r.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES,this.ivsIndex=t,this.insCount=e}disableDrawInstanced(){this.drawMode=r.RenderDrawMode.ELEMENTS_TRIANGLES}getMaterial(){return this.m_material}setMaterial(t){null!=this.m_material&&this.m_material!=t&&(this.m_material.__$detachThis(),null!=t&&t.__$attachThis()),this.m_material=t}copyFrom(t){this.vbuf=t.vbuf,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.setMaterial(t.getMaterial())}toString(){return"RODisplay(name="+this.name+",uid="+this.getUid()+", __$ruid="+this.__$ruid+")"}destroy(){null!=this.m_material&&(this.m_material.__$detachThis(),this.m_material.destroy(),this.m_material=null),this.m_matFS32=null,this.vbuf=null,this.__$ruid=-1,this.__$rpuid=-1,this.__$$rsign=r.DisplayRenderSign.NOT_IN_WORLD,this.ivsIndex=0,this.ivsCount=0,this.m_partGroup=null,this.__$$runit=null}static GetFreeId(){return n.m_freeIdList.length>0?n.m_freeIdList.pop():-1}static GetByUid(t){return n.m_unitList[t]}static IsEnabledByUid(t){return n.m_unitFlagList[t]==n.S_FLAG_BUSY}static Create(){let t=null,e=n.GetFreeId();return e>=0?(t=n.m_unitList[e],n.m_unitFlagList[e]=n.S_FLAG_BUSY):(t=new n,n.m_unitList.push(t),n.m_unitFlagList.push(n.S_FLAG_BUSY),n.m_unitListLen++),t}static Restore(t){if(null!=t&&n.m_unitFlagList[t.getUid()]==n.S_FLAG_BUSY){let e=t.getUid();n.m_freeIdList.push(e),n.m_unitFlagList[e]=n.S_FLAG_FREE,t.destroy()}}}n.s_uid=0,n.S_FLAG_BUSY=1,n.S_FLAG_FREE=0,n.m_unitFlagList=[],n.m_unitListLen=0,n.m_unitList=[],n.m_freeIdList=[],e.default=n},dc6d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("35fa")),a=i(s("8a0a")),n=i(s("e7d2")),h=i(s("fecb")),o=i(s("5282")),l=i(s("cb29"));class _ extends l.default{constructor(t=a.default.VTX_STATIC_DRAW){super(t),this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,this.inverseUV=!1,this.uScale=1,this.vScale=1}getVS(){return this.m_vs}getUVS(){return this.m_uvs}getNVS(){return this.m_nvs}getCVS(){return this.m_cvs}getIVS(){return this.m_ivs}initialize(t,e,s,i,l=1,_=-.5){if(this.vtxTotal<1){if(t<.01)return;s<2&&(s=2),i=3;let u=Math.abs(t),m=Math.abs(e),d=s,c=i,f=1,p=0,g=0,v=0,x=0,y=0,T=_*m;this.bounds=new h.default,this.bounds.min.setXYZ(-t,T,-t),this.bounds.max.setXYZ(t,T+m,t),this.bounds.updateFast();let b=new o.default;b.y=T;let S=[],E=[];E.push([]);let A=E[0];for(b.u=.5,b.v=.5,b.nx=0,b.ny=-1,b.nz=0,A.push(b.cloneVertex()),S.push(A[0]);f<c;++f){b.y=T+m*(f-1),E.push([]);let t=E[f];for(p=0;p<d;++p)v=2*Math.PI*p/d,++g,x=Math.sin(v),y=Math.cos(v),b.x=x*u,b.z=y*u,b.index=g,x*=.495,y*=.495,b.u=.5+x,b.v=.5+y,f<2?(b.nx=0,b.ny=-1,b.nz=0):(b.nx=0,b.ny=1,b.nz=0),t.push(b.cloneVertex()),S.push(t[p]);t.push(t[0])}++g,b.index=g,b.x=0,b.y=T+m,b.z=0,b.u=.5,b.v=.5,b.nx=0,b.ny=1,b.nz=0,E.push([]);let w=E[3];w.push(b.cloneVertex()),S.push(w[0]);let R=1/u;for(f=0;f<2;++f){let t=E[f+1];E.push([]);let e=E[E.length-1];for(p=0;p<=d;++p)++g,b.copyFrom(t[p]),b.index=g,l<1?(b.v=f<1?0:this.vScale,b.u=this.uScale*(p/d)):(b.u=f<1?0:this.uScale,b.v=this.vScale*(p/d)),b.ny=0,b.nx=b.x*R,b.nz=b.z*R,e.push(b.cloneVertex()),S.push(e[p])}let M=null,D=[];f=1;let F=null,L=null;for(;f<=c;++f)for(F=E[f-1],L=E[f],p=1;p<=d;++p)1==f?(D.push(F[0].index),D.push(L[p].index),D.push(L[p-1].index)):f==c&&(D.push(F[p].index),D.push(L[0].index),D.push(F[p-1].index));for(F=E[E.length-2],L=E[E.length-1],p=1;p<=d;++p)D.push(F[p].index),D.push(L[p-1].index),D.push(F[p-1].index),D.push(F[p].index),D.push(L[p].index),D.push(L[p-1].index);for(this.vtxTotal=S.length,this.m_vs=new Float32Array(3*this.vtxTotal),f=0,p=0;p<this.vtxTotal;++p)M=S[p],this.m_vs[f]=M.x,this.m_vs[f+1]=M.y,this.m_vs[f+2]=M.z,f+=3;if(null!=this.m_transMatrix&&(this.m_transMatrix.transformVectorsSelf(this.m_vs,this.m_vs.length),this.bounds.addXYZFloat32Arr(this.m_vs),this.bounds.updateFast()),n.default.Reset(),n.default.AddFloat32Data(this.m_vs,3),this.m_ivs=new Uint16Array(D),this.isVBufEnabledAt(a.default.VBUF_UVS_INDEX)){for(this.m_uvs=new Float32Array(2*this.vtxTotal),f=0,p=0;p<this.vtxTotal;++p)M=S[p],this.m_uvs[f]=M.u,this.m_uvs[f+1]=M.v,f+=2;n.default.AddFloat32Data(this.m_uvs,2)}if(this.isVBufEnabledAt(a.default.VBUF_NVS_INDEX)){for(this.m_nvs=new Float32Array(3*this.vtxTotal),f=0,p=0;p<this.vtxTotal;++p)M=S[p],this.m_nvs[f]=M.nx,this.m_nvs[f+1]=M.ny,this.m_nvs[f+2]=M.nz,f+=3;n.default.AddFloat32Data(this.m_nvs,3)}if(this.isVBufEnabledAt(a.default.VBUF_TVS_INDEX)){let t=this.m_ivs.length/3,e=new Float32Array(this.m_vs.length),s=new Float32Array(this.m_vs.length);r.default.ClacTrisTangent(this.m_vs,this.m_vs.length,this.m_uvs,this.m_nvs,t,this.m_ivs,e,s),n.default.AddFloat32Data(e,3),n.default.AddFloat32Data(s,3)}this.wireframe&&this.updateWireframeIvs(),n.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.m_vbuf=n.default.CreateBySaveData(this.getBufDataUsage()),this.m_vbuf.setUint16IVSData(this.m_ivs),this.vtCount=this.m_ivs.length,this.trisNumber=this.vtCount/3,this.buildEnd()}}__$destroy(){this.isResFree()&&(this.bounds=null,this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,super.__$destroy())}toString(){return"Cylinder3DMesh()"}}e.default=_},de9d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("722e")),a=i(s("8333")),n=i(s("6e01")),h=i(s("8e17")),o=s("7c63"),l=i(s("090c")),_=i(s("1216")),u=i(s("56c5")),m=i(s("030e")),d=i(s("74c3")),c=i(s("984e")),f=i(s("29ef")),p=i(s("3077"));class g{constructor(t){this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.RState=null,this.Vertex=null,this.Texture=null,this.VtxBufUpdater=null,this.MaterialUpdater=null,this.m_uid=0,this.m_camUBO=null,this.m_adapter=null,this.m_adapterContext=new l.default,this.m_rc=null,this.m_perspectiveEnabled=!0,this.m_viewX=0,this.m_viewY=0,this.m_viewW=800,this.m_viewH=600,this.m_cameraNear=.1,this.m_cameraFar=5e3,this.m_cameraFov=45,this.m_maxWebGLVersion=2,this.m_WEBGL_VER=2,this.m_camera=null,this.m_camSwitched=!1,this.m_autoSynViewAndStage=!0,this.m_initMainCamera=!0,this.m_uid=t}getRC(){return this.m_rc}getUid(){return this.m_uid}getRCUid(){return this.m_uid}isAutoSynViewAndStage(){return this.m_autoSynViewAndStage}enableSynViewAndStage(){this.m_autoSynViewAndStage=!0}lockViewport(){this.m_adapter.lockViewport()}unlockViewport(){this.m_adapter.unlockViewport()}getDiv(){return this.m_adapter.getDiv()}getCanvas(){return this.m_adapter.getCanvas()}cameraLock(){this.m_camera.lock()}cameraUnlock(){this.m_camera.unlock()}getCamera(){return this.m_camera}updateCamera(){return this.m_camera.update()}createCameraUBO(t){}updateCameraDataFromCamera(t){null!=t&&(this.m_camSwitched||t!=this.m_camera)&&(this.m_camSwitched=t!=this.m_camera,t.updateCamMatToUProbe(this.m_camera.matUProbe),null!=this.m_camUBO&&(this.m_camUBO.setSubDataArrAt(0,t.matUProbe.getFS32At(0)),this.m_camUBO.setSubDataArrAt(16,t.matUProbe.getFS32At(1))))}useCameraData(){null!=this.m_camUBO&&this.m_camUBO.run()}getActiveAttachmentTotal(){return this.m_adapter.getActiveAttachmentTotal()}drawInstanced(t,e,s){2==this.m_WEBGL_VER?this.m_rc.drawElementsInstanced(this.TRIANGLES,t,this.UNSIGNED_SHORT,e,s):m.default.ANGLE_instanced_arrays.drawElementsInstancedANGLE(this.TRIANGLES,t,e,s)}createUBOBufferByBytesCount(t){let e=this.m_rc.createBuffer();return this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,e),this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.DYNAMIC_DRAW),e}createUBOBufferByDataArray(t){let e=this.m_rc.createBuffer();return this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,e),this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.DYNAMIC_DRAW),e}bindUBOBuffer(t){this.m_rc.bindBuffer(this.m_rc.UNIFORM_BUFFER,t)}deleteUBOBuffer(t){this.m_rc.deleteBuffer(t)}bufferDataUBOBuffer(t){this.m_rc.bufferData(this.m_rc.UNIFORM_BUFFER,t,this.m_rc.STATIC_DRAW)}bindBufferBaseUBOBuffer(t,e){this.m_rc.bindBufferBase(this.m_rc.UNIFORM_BUFFER,t,e)}setWebGLMaxVersion(t){1!=t&&2!=t||(this.m_maxWebGLVersion=t)}getContext(){return this.m_adapterContext}getStage3D(){return this.m_adapterContext.getStage()}getRenderAdapter(){return this.m_adapter}getRenderContext(){return this.m_adapter.getRenderContext()}setCameraParam(t,e,s){this.m_cameraFov=t,this.m_cameraNear=e,this.m_cameraFar=s}getMouseXYWorldRay(t,e){let s=this.m_adapterContext.getStage();this.m_camera.getWorldPickingRayByScreenXY(s.mouseX,s.mouseY,t,e)}testViewPortChanged(t,e,s,i){return this.m_viewX!=t||this.m_viewY!=e||this.m_viewW!=s||this.m_viewH!=i}testRCViewPortChanged(t,e,s,i){return this.m_adapterContext.testViewPortChanged(t,e,s,i)}getViewX(){return this.m_viewX}getViewY(){return this.m_viewY}getViewWidth(){return this.m_viewW}getViewHeight(){return this.m_viewH}setViewPort(t,e,s,i){this.m_autoSynViewAndStage=!1,this.m_viewX=t,this.m_viewY=e,this.m_viewW=s,this.m_viewH=i;let r=this.m_adapterContext.getStage();null!=r&&(r.setViewPort(s,e,s,i),null!=this.m_camera&&(this.m_camera.setViewXY(this.m_viewX,this.m_viewY),this.m_camera.setViewSize(this.m_viewW,this.m_viewH))),this.m_adapterContext.setViewport(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH)}setRCViewPort(t,e,s,i,r=!1){this.m_autoSynViewAndStage=r,this.m_adapterContext.setViewport(t,e,s,i)}reseizeRCViewPort(){this.m_adapter.unlockViewport(),this.m_adapter.reseizeViewPort()}resizeCallback(){this.m_autoSynViewAndStage&&(this.m_viewX=0,this.m_viewY=0,this.m_viewW=this.m_adapterContext.getRCanvasWidth(),this.m_viewH=this.m_adapterContext.getRCanvasHeight(),this.createMainCamera(),this.m_adapterContext.setViewport(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH),this.m_camera.setViewXY(this.m_viewX,this.m_viewY),this.m_camera.setViewSize(this.m_viewW,this.m_viewH))}createMainCamera(){this.m_initMainCamera&&(this.m_initMainCamera=!1,this.m_camera.uniformEnabled=!0,this.m_perspectiveEnabled?this.m_camera.perspectiveRH(n.default.DegreeToRadian(this.m_cameraFov),this.m_viewW/this.m_viewH,this.m_cameraNear,this.m_cameraFar):this.m_camera.orthoRH(this.m_cameraNear,this.m_cameraFar,-.5*this.m_viewH,.5*this.m_viewH,-.5*this.m_viewW,.5*this.m_viewW),this.m_camera.setViewXY(this.m_viewX,this.m_viewY),this.m_camera.setViewSize(this.m_viewW,this.m_viewH))}readPixels(t,e,s,i,r,a,n){this.m_adapter.readPixels(t,e,s,i,r,a,n)}getGLVersion(){return this.m_WEBGL_VER}initialize(t,e,s,i,n,o){if(null!=this.m_rc)return;this.m_camera=e,null==e.matUProbe&&(e.matUProbe=new p.default,e.matUProbe.bindSlotAt(this.m_uid),e.matUProbe.addMat4Data(new Float32Array(16),1),e.matUProbe.addMat4Data(new Float32Array(16),1)),null==e.ufrustumProbe&&(e.ufrustumProbe=new p.default,e.ufrustumProbe.bindSlotAt(this.m_uid),e.ufrustumProbe.addVec4Data(new Float32Array([e.getZNear(),e.getZFar(),.5*e.getNearPlaneWidth(),.5*e.getNearPlaneHeight()]),1)),null==e.ucameraPosProbe&&(e.ucameraPosProbe=new p.default,e.ucameraPosProbe.bindSlotAt(this.m_uid),e.ucameraPosProbe.addVec4Data(new Float32Array([500,500,500,1]),1));let l=t.camPosition,g=t.camLookAtPos,v=t.camUpDirect;null==l&&(l=new h.default(500,500,500)),null==g&&(g=new h.default(0,0,0)),null==v&&(v=new h.default(0,1,0)),this.m_perspectiveEnabled=t.cameraPerspectiveEnabled,this.m_adapterContext.autoSyncRenderBufferAndWindowSize=t.autoSyncRenderBufferAndWindowSize,this.m_adapterContext.setResizeCallback(this,this.resizeCallback),this.m_adapterContext.setWebGLMaxVersion(this.m_maxWebGLVersion),this.m_adapterContext.initialize(this.m_uid,s,t.getDiv(),t.getRenderContextAttri()),this.m_WEBGL_VER=this.m_adapterContext.getWebGLVersion(),this.m_rc=this.m_adapterContext.getRC(),f.default.Initialize(),f.default.Rstate.setRenderContext(this.m_adapterContext);let x=this,y=this.m_rc,T=new d.default(this.m_uid,y,o),b=new c.default(this.m_uid,y);if(x.Vertex=T,x.Texture=b,x.MaterialUpdater=i,x.VtxBufUpdater=n,this.m_viewW=this.m_adapterContext.getViewportWidth(),this.m_viewH=this.m_adapterContext.getViewportHeight(),this.m_adapter=new _.default(this.m_uid,b),this.m_adapter.initialize(this.m_adapterContext,t,f.default.Rstate),this.m_autoSynViewAndStage){let t=this.m_adapterContext.getStage();null!=t&&(this.m_viewW=t.stageWidth,this.m_viewH=t.stageHeight)}this.createMainCamera(),this.m_adapterContext.setViewport(this.m_viewX,this.m_viewY,this.m_viewW,this.m_viewH),this.m_camera.lookAtRH(l,g,v),this.m_camera.update(),this.m_adapter.bgColor.setRGB3f(0,0,0),x.RGBA=y.RGBA,x.UNSIGNED_BYTE=y.UNSIGNED_BYTE,x.TRIANGLE_STRIP=y.TRIANGLE_STRIP,x.TRIANGLE_FAN=y.TRIANGLE_FAN,x.TRIANGLES=y.TRIANGLES,x.LINES=this.m_rc.LINES,x.LINE_STRIP=y.LINE_STRIP,x.UNSIGNED_SHORT=y.UNSIGNED_SHORT,x.UNSIGNED_INT=y.UNSIGNED_INT,x.COLOR=y.COLOR,x.DEPTH=y.DEPTH,x.STENCIL=y.STENCIL,x.DEPTH_STENCIL=y.DEPTH_STENCIL,this.m_WEBGL_VER>1?(x.MIN=y.MIN,x.MAX=y.MAX):(x.MIN=m.default.EXT_blend_minmax.MIN_EXT,x.MAX=m.default.EXT_blend_minmax.MAX_EXT);let S=r.default;S.NEAREST=y.NEAREST,S.LINEAR=y.LINEAR,S.LINEAR_MIPMAP_LINEAR=y.LINEAR_MIPMAP_LINEAR,S.NEAREST_MIPMAP_NEAREST=y.NEAREST_MIPMAP_NEAREST,S.LINEAR_MIPMAP_NEAREST=y.LINEAR_MIPMAP_NEAREST,S.NEAREST_MIPMAP_LINEAR=y.NEAREST_MIPMAP_LINEAR;let E=a.default;E.COLOR_BUFFER_BIT=y.COLOR_BUFFER_BIT,E.DEPTH_BUFFER_BIT=y.DEPTH_BUFFER_BIT,E.STENCIL_BUFFER_BIT=y.STENCIL_BUFFER_BIT,u.default.SetRenderer(this.m_adapterContext),x.RState=f.default.Rstate,x.RContext=this.m_rc}flush(){this.m_rc.flush()}setClearRGBColor3f(t,e,s){this.m_adapter.bgColor.setRGB3f(t,e,s)}setClearColor(t){this.m_adapter.bgColor.copyFrom(t)}setClearUint24Color(t,e){this.m_adapter.bgColor.setRGBUint24(t),this.m_adapter.bgColor.a=e}setClearRGBAColor4f(t,e,s,i){this.m_adapter.bgColor.setRGBA4f(t,e,s,i)}getClearRGBAColor4f(t){t.copyFrom(this.m_adapter.bgColor)}getViewportWidth(){return this.m_adapter.getViewportWidth()}getViewportHeight(){return this.m_adapter.getViewportHeight()}setRenderToBackBuffer(){this.m_adapter.setRenderToBackBuffer()}clearBackBuffer(){this.m_adapter.clear()}renderBegin(){this.m_camera.update(),this.m_adapter.renderBegin()}renderEnd(){}useRenderStateByName(t){o.RenderStateObject.UseRenderStateByName(t)}setScissorEnabled(t){this.m_adapterContext.setScissorEnabled(t)}setScissorRect(t,e,s,i){this.m_adapterContext.setScissorRect(t,e,s,i)}useRenderColorMask(t){o.RenderColorMask.UseRenderState(t)}unlockRenderColorMask(){o.RenderColorMask.Unlock()}lockRenderColorMask(){o.RenderColorMask.Lock()}useRenderState(t){o.RenderStateObject.UseRenderState(t)}unlockRenderState(){o.RenderStateObject.Unlock()}lockRenderState(){o.RenderStateObject.Lock()}setFrontFaceFlipped(t){this.m_adapter.setFrontFaceFlipped(t)}setPolygonOffset(t,e=0){this.m_adapter.setPolygonOffset(t,e)}resetPolygonOffset(){this.m_adapter.resetPolygonOffset()}loseContext(){this.m_adapter.loseContext()}isContextLost(){return this.m_adapter.isContextLost()}setViewProbeValue(t,e,s,i){this.m_adapter.setViewProbeValue(t,e,s,i)}toString(){return"[Object RenderProxy()]"}}e.default=g},df25:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("68aa")),n=i(s("0851"));class h extends n.default{constructor(t,e,s=!1){super(t,e,s),this.m_bytes=null,this.m_subDataList=null,this.m_texDatasLen=0,this.m_texData=null,this.m_texDatas=null,this.minFilter=r.TextureConst.LINEAR}setDataFromBytes(t,e=0,s=-1,i=-1,r=0,n=0,h=!1){if(null!=t&&s>0&&i>0){e<0&&(e=0),e>15&&(e=15),e>=this.m_texDatasLen&&(this.m_texDatasLen=e+1),this.m_haveRData=!0;let o=this.m_texData;null!=o?this.m_texData.miplevel!=e&&(null==this.m_texDatas&&(this.m_texDatas=[this.m_texData,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),o=this.m_texDatas[e],null==o&&(o=a.default.Create(),o.miplevel=e,h=!0,this.m_texDatas[e]=o)):(this.m_texData=o=a.default.Create(),o.miplevel=e,h=!0),o.data==t&&o.offsetx==r&&o.offsety==n||(0==e&&(this.m_texWidth=s,this.m_texHeight=i,this.m_bytes=t),o.data=t,o.status=0,(o.width<s||o.height<i||h)&&(o.width=s,o.height=i,o.status=1),o.offsetx=r,o.offsety=n),this.version++}}uploadData(t){null!=this.m_texData&&this.dataUploadToGpu(t.getRC(),this.m_texData,this.m_texDatas,!0)}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())){let e=t.getRC(),s=null!=this.m_subDataList?this.m_subDataList.length:0;if(this.__$updateToGpuBegin(t),s>0){let t=0,i=null,n=r.TextureFormat.ToGL(e,this.internalFormat),h=r.TextureFormat.ToGL(e,this.srcFormat),o=r.TextureDataType.ToGL(e,this.dataType);for(;t<s;++t)i=this.m_subDataList.pop(),i.updateToGpu(e,this.m_sampler,n,h,o,!1),a.default.Restore(i)}null!=this.m_texData&&(this.dataUploadToGpu(e,this.m_texData,this.m_texDatas),this.__$buildParam(e),this.m_generateMipmap=!0),this.__$updateToGpuEnd(e)}}setPartDataFromeBytes(t,e,s,i,r,n=0){null==this.m_subDataList&&(this.m_subDataList=[]);let h=a.default.Create();h.data=t,h.status=0,h.miplevel=n,h.offsetx=e,h.offsety=s,h.width=i,h.height=r,this.m_subDataList.push(h),this.version++}getPixels(t,e,s,i,a){if(null!=this.m_bytes&&null!=a){let n=this.unpackAlignment,h=s*i*n;if(a.length==h){let o=e,l=t,_=o+i,u=l+s,m=0;switch(this.srcFormat){case r.TextureFormat.ALPHA:for(;o<_;++o)for(l=t;l<u;++l)h=o*this.m_texWidth+l,a[m]=this.m_bytes[h],m++;break;case r.TextureFormat.RGBA:for(;o<_;++o)for(l=t;l<u;++l)h=(o*this.m_texWidth+l)*n,a[m]=this.m_bytes[h],a[m+1]=this.m_bytes[h+1],a[m+2]=this.m_bytes[h+2],a[m+3]=this.m_bytes[h+3],m++;break;case r.TextureFormat.RGB:for(;o<_;++o)for(l=t;l<u;++l)h=(o*this.m_texWidth+l)*n,a[m]=this.m_bytes[h],a[m+1]=this.m_bytes[h+1],a[m+2]=this.m_bytes[h+2],m++;break;default:break}}}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.m_texDatas){for(let t=0;t<this.m_texDatasLen;++t)a.default.Restore(this.m_texDatas[t]);this.m_texDatasLen=0,this.m_texDatas=null,this.m_texData=null}null!=this.m_texData&&(a.default.Restore(this.m_texData),this.m_texData=null),this.m_bytes=null,super.__$destroy()}}toString(){return"[RawDataTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=h},df9d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m_uid=-1,this.m_begin=null,this.m_end=null,this.m_unitMap=new Map,this.m_unitTexMap=new Map,this.m_FLAG_BUSY=1,this.m_FLAG_FREE=0,this.m_vtxFlagList=[],this.m_vtxIndexFlagList=[],this.m_vtxfreeIList=[],this.m_vtxList=[],this.m_vtxListLen=0,this.m_texFlagList=[],this.m_texIndexFlagList=[],this.m_texfreeIList=[],this.m_texList=[],this.m_texListLen=0,this.m_uid=i.s_uid++}getFreeVtxId(){return this.m_vtxfreeIList.length>0?this.m_vtxfreeIList.pop():-1}getVtxIndex(){let t=-1,e=this.getFreeVtxId();return e>=0?(t=e,this.m_vtxList[e]=0,this.m_vtxFlagList[e]=this.m_FLAG_BUSY):(t=this.m_vtxListLen,this.m_vtxList.push(0),this.m_vtxIndexFlagList.push(this.m_FLAG_FREE),this.m_vtxFlagList.push(this.m_FLAG_BUSY),this.m_vtxListLen++),t}restoreVtxIndex(t){this.m_vtxFlagList[t]==this.m_FLAG_BUSY&&(this.m_vtxfreeIList.push(t),this.m_vtxFlagList[t]=this.m_FLAG_FREE,this.m_vtxList[t]=0)}attachVtxAt(t){++this.m_vtxList[t]}detachVtxAt(t){this.m_vtxList[t]>0&&(--this.m_vtxList[t],this.m_vtxList[t]<1&&this.restoreVtxIndex(t))}getVtxTotalAt(t){return this.m_vtxList[t]}getFreeTexId(){return this.m_texfreeIList.length>0?this.m_texfreeIList.pop():-1}getTexIndex(){let t=-1,e=this.getFreeTexId();return e>=0?(t=e,this.m_texList[e]=0,this.m_texFlagList[e]=this.m_FLAG_BUSY):(t=this.m_texListLen,this.m_texList.push(0),this.m_texIndexFlagList.push(this.m_FLAG_FREE),this.m_texFlagList.push(this.m_FLAG_BUSY),this.m_texListLen++),t}restoreTexIndex(t){this.m_texFlagList[t]==this.m_FLAG_BUSY&&(this.m_texfreeIList.push(t),this.m_texFlagList[t]=this.m_FLAG_FREE,this.m_texList[t]=0)}attachTexAt(t){++this.m_texList[t]}detachTexAt(t){this.m_texList[t]>0&&(--this.m_texList[t],this.m_texList[t]<1&&this.restoreTexIndex(t))}getTexTotalAt(t){return this.m_texList[t]}destroy(){this.clear()}clear(){this.m_begin=this.m_end=null,this.m_unitMap=new Map,this.m_unitTexMap=new Map,this.m_vtxFlagList=[],this.m_vtxIndexFlagList=[],this.m_vtxList=[],this.m_vtxfreeIList=[],this.m_vtxListLen=0,this.m_texFlagList=[],this.m_texIndexFlagList=[],this.m_texList=[],this.m_texfreeIList=[],this.m_texListLen=0}getBegin(){return this.m_begin}containsNode(t){let e=this.m_unitMap.get(t.vtxUid);if(null!=e){let s=131*(31+e.rvroI);return s*=s+e.texMid,t.rtokey==s}return!1}addNodeAndSort(t){let e=this.m_unitMap.get(t.vtxUid);if(null==e){this.m_unitMap.set(t.vtxUid,t),t.rvroI=this.getVtxIndex(),this.attachVtxAt(t.rvroI);let e=131*(31+t.rvroI);e*=e+t.texMid,t.rtokey=e,t.rtroI=this.getTexIndex(),this.m_unitTexMap.set(e,t.rtroI),this.attachTexAt(t.rtroI)}else{t.rvroI=e.rvroI,this.attachVtxAt(t.rvroI);let s=131*(31+t.rvroI);if(s*=s+t.texMid,this.m_unitTexMap.has(s)?t.rtroI=this.m_unitTexMap.get(s):(t.rtroI=this.getTexIndex(),this.m_unitTexMap.set(s,t.rtroI)),t.rtokey=s,this.attachTexAt(t.rtroI),e!=this.m_end)if(e.texMid==t.texMid)e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;else while(null!=e){if(e.vtxUid!=t.vtxUid){e=e.prev,e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.texMid==t.texMid){e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.next==this.m_end){this.m_end.vtxUid!=t.vtxUid?(e.next.prev=t,t.next=e.next,t.prev=e,e.next=t):e=null;break}e=e.next}else e=null}null==e&&(null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null)}showInfo(){let t=this.getBegin();if(null!=t){let e="",s="",i="";while(null!=t)e+=t.vtxUid+",",s+=t.texMid+",",i+=t.ivsCount+",",t=t.next}}removeNodeAndSort(t){let e=this.m_unitMap.get(t.vtxUid);e!=t?e=null:(this.m_unitMap.set(t.vtxUid,null),null!=t.next&&t.next.vtxUid==t.vtxUid?this.m_unitMap.set(t.vtxUid,t.next):null!=t.prev&&t.prev.vtxUid==t.vtxUid?this.m_unitMap.set(t.vtxUid,t.prev):this.m_unitMap.delete(t.vtxUid)),t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),this.detachVtxAt(t.rvroI),this.detachTexAt(t.rtroI),t.prev=null,t.next=null}addNode(t){null==this.m_begin?this.m_end=this.m_begin=t:null!=this.m_end.prev?(this.m_end.next=t,t.prev=this.m_end,this.m_end=t):(this.m_begin.next=t,t.prev=this.m_end,this.m_end=t),this.m_end.next=null}removeNode(t){t==this.m_begin?t==this.m_end?this.m_begin=this.m_end=null:(this.m_begin=t.next,this.m_begin.prev=null):t==this.m_end?(this.m_end=t.prev,this.m_end.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}i.s_uid=0,e.default=i},e08e:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.ELEMENTS_TRIANGLES=1,i.ELEMENTS_TRIANGLE_STRIP=2,i.ELEMENTS_TRIANGLE_FAN=3,i.ELEMENTS_INSTANCED_TRIANGLES=4,i.ARRAYS_LINES=5,i.ARRAYS_LINE_STRIP=6,i.ARRAYS_POINTS=7,i.ELEMENTS_LINES=8,i.DISABLE=0,e.RenderDrawMode=i;class r{}r.NORMAL=1,r.OPAQUE=1,r.TRANSPARENT=2,r.ALPHA_ADD=3,r.ADD=4,r.ADD_LINEAR=5,r.INVERSE_ALPHA=6,r.BLAZE=7,r.OVERLAY=8,r.OVERLAY2=8,r.DISABLE=0,e.RenderBlendMode=r;class a{}a.NEVER=1,a.LESS=1,a.EQUAL=1,a.GREATER=1,a.NOTEQUAL=1,a.GEQUAL=1,a.ALWAYS=1,e.GLStencilFunc=a;class n{}n.KEEP=1,n.ZERO=1,n.REPLACE=1,n.INCR=1,n.INCR_WRAP=1,n.DECR=1,n.DECR_WRAP=1,n.INVERT=1,e.GLStencilOp=n;class h{}h.ZERO=1,h.ONE=1,h.SRC_COLOR=1,h.DST_COLOR=1,h.SRC_ALPHA=1,h.DST_ALPHA=1,h.ONE_MINUS_SRC_ALPHA=1,e.GLBlendMode=h;class o{}o.FUNC_ADD=1,o.FUNC_SUBTRACT=1,o.FUNC_REVERSE_SUBTRACT=1,o.MIN_EXT=1,o.MAX_EXT=1,o.MIN=1,o.MAX=1,e.GLBlendEquation=o;class l{}l.BACK=1,l.FRONT=2,l.FRONT_AND_BACK=3,l.NONE=0,l.DISABLE=0,e.CullFaceMode=l;class _{}_.NEVER=1,_.ALWAYS=2,_.SKY=3,_.TRUE_LESS_EQUAL=3,_.OPAQUE=4,_.TRUE_LESS=4,_.OPAQUE_OVERHEAD=5,_.FALSE_EQUAL=5,_.FALSE_LESS=6,_.BLEND=6,_.BLEND_SORT=6,_.TRANSPARENT_SORT=6,_.TRUE_LEQUAL=7,_.WIRE_FRAME=7,_.FALSE_LEQUAL=8,_.DECALS=8,_.NEXT_LAYER=11,_.WIRE_FRAME_NEXT=12,_.TRUE_EQUAL=13,_.TRUE_GREATER=14,_.TRUE_GEQUAL=15,_.DISABLE=0,e.DepthTestMode=_;class u{}u.SCENE_RO_FILTER_BEGIN=1<<19,u.SCENE_RO_FILTER_FINISH=2<<19,u.SCENE_RO_ERASE=0,e.RenderConst=u,function(t){t[t["NOT_IN_WORLD"]=-1]="NOT_IN_WORLD",t[t["GO_TO_WORLD"]=1]="GO_TO_WORLD",t[t["LIVE_IN_WORLD"]=2]="LIVE_IN_WORLD"}(e.DisplayRenderSign||(e.DisplayRenderSign={}))},e214:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),n=i(s("f48d")),h=i(s("81c4"));class o extends n.default{constructor(){super(...arguments),this.nv=new a.default(0,1,0),this.distance=0,this.intersectBoo=!1}intersectStraightLinePos(t,e){let s=this.nv.dot(t.tv);if(s>r.default.MATH_MIN_POSITIVE||s<r.default.MATH_MAX_NEGATIVE){let i=this.nv.dot(t.position)-this.distance;return e.x=1e5*t.tv.x+t.position.x,e.y=1e5*t.tv.y+t.position.y,e.z=1e5*t.tv.z+t.position.z,s=this.nv.dot(e)-this.distance,s=i/(i-s),e.subtractBy(t.position),e.scaleBy(s),e.addBy(t.position),1}return s=this.nv.dot(t.position)-this.distance,s<=r.default.MATH_MIN_POSITIVE||s>=r.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),2):0}intersectStraightLinePos2(t,e,s){let i=this.nv.dot(e);if(i>r.default.MATH_MIN_POSITIVE||i<r.default.MATH_MAX_NEGATIVE){let r=this.nv.dot(t)-this.distance;return s.x=1e5*e.x+t.x,s.y=1e5*e.y+t.y,s.z=1e5*e.z+t.z,i=this.nv.dot(s)-this.distance,i=r/(r-i),s.subtractBy(t),s.scaleBy(i),s.addBy(t),1}return i=this.nv.dot(t)-this.distance,i<=r.default.MATH_MIN_POSITIVE||i>=r.default.MATH_MAX_NEGATIVE?(s.copyFrom(t),2):0}intersectRadialLinePos(t,e){let s=this.nv.dot(t.position)-this.distance;if(s>r.default.MATH_MIN_POSITIVE){let s=this.nv.dot(t.tv);if(s<0)return this.intersectStraightLinePos2(t.position,t.tv,e)}else{if(!(s<r.default.MATH_MAX_NEGATIVE)){let s=this.nv.dot(t.tv);return s>r.default.MATH_MIN_POSITIVE||s<r.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),1):(e.copyFrom(t.position),2)}{let s=this.nv.dot(t.tv);if(s>0)return this.intersectStraightLinePos2(t.position,t.tv,e)}}return-1}intersectRadialLinePos2(t,e,s){let i=this.nv.dot(t)-this.distance;if(i>r.default.MATH_MIN_POSITIVE){let i=this.nv.dot(e);if(i<0)return this.intersectStraightLinePos2(t,e,s)}else{if(!(i<r.default.MATH_MAX_NEGATIVE)){let i=this.nv.dot(e);return i>r.default.MATH_MIN_POSITIVE||i<r.default.MATH_MAX_NEGATIVE?(s.copyFrom(t),1):(s.copyFrom(t),2)}{let i=this.nv.dot(e);if(i>0)return this.intersectStraightLinePos2(t,e,s)}}return-1}containsPoint(t){let e=this.nv.dot(t)-this.distance;return e>r.default.MATH_MIN_POSITIVE?1:e<r.default.MATH_MAX_NEGATIVE?-1:0}intersectSphere(t,e){this.intersectBoo=!1;let s=this.nv.dot(t)-this.distance;return s>r.default.MATH_MIN_POSITIVE?(this.intersectBoo=s<=e,1):s<r.default.MATH_MAX_NEGATIVE?(this.intersectBoo=-s<=e,-1):0}intersectSphNegSpace(t,e){this.intersectBoo=Math.abs(this.nv.dot(t)-this.distance)<e}update(){this.nv.normalize()}updateFast(){this.nv.normalize()}static PlaneIntersectSphere(t,e,s,i){o.IntersectBoo=!1,o.IntersectSatus=0,e=t.dot(s)-e,e>r.default.MATH_MIN_POSITIVE?(o.IntersectBoo=e<=i,o.IntersectSatus=1):e<r.default.MATH_MAX_NEGATIVE&&(o.IntersectBoo=-e<=i,o.IntersectSatus=-1)}static CalcPVCloseV(t,e,s){let i=t.distance-e.dot(t.nv);s.setTo(i*t.nv.x,i*t.nv.y,i*t.nv.z),s.addBy(e)}static CalcPVCloseV2(t,e,s,i){let r=e-s.dot(t);i.setTo(r*t.x,r*t.y,r*t.z),i.addBy(s)}static IntersectionSLV2(t,e,s,i,a){let n=t.dot(i);if(n>r.default.MATH_MIN_POSITIVE||n<r.default.MATH_MAX_NEGATIVE){let r=t.dot(s)-e;return a.x=1e5*i.x+s.x,a.y=1e5*i.y+s.y,a.z=1e5*i.z+s.z,n=t.dot(a)-e,n=r/(r-n),a.subtractBy(s),a.scaleBy(n),a.addBy(s),1}return n=t.dot(s)-e,n<=r.default.MATH_MIN_POSITIVE||n>=r.default.MATH_MAX_NEGATIVE?(a.copyFrom(s),2):0}toString(){return"Plane(position="+this.position.toString()+", nv="+this.nv.toString()+")"}}o.IntersectBoo=!1,o.IntersectSatus=0;class l extends o{constructor(){super(...arguments),this.v0=new a.default(100,0,0),this.v1=new a.default(0,0,-100),this.v2=new a.default(0,0,0),this.ls01=new h.default,this.ls12=new h.default,this.ls20=new h.default,this.radiusSquared=100}getRandomPosition(t){let e=this.ls01.length*Math.random();t.x=this.ls01.position.x+e*this.ls01.tv.x,t.y=this.ls01.position.y+e*this.ls01.tv.y,t.z=this.ls01.position.z+e*this.ls01.tv.z,e=this.ls12.length*Math.random(),t.x+=this.ls12.position.x+e*this.ls12.tv.x,t.y+=this.ls12.position.y+e*this.ls12.tv.y,t.z+=this.ls12.position.z+e*this.ls12.tv.z,e=this.ls20.length*Math.random(),t.x+=this.ls20.position.x+e*this.ls20.tv.x,t.y+=this.ls20.position.y+e*this.ls20.tv.y,t.z+=this.ls20.position.z+e*this.ls20.tv.z,t.x*=.33333,t.y*=.33333,t.z*=.33333}triIntersectStraightLinePos(t,e){let s=this.intersectStraightLinePos(t,e);return 1==s&&(s=this.triContainsPoint(e),s>0)?1:-1}triIntersectRadialLinePos(t,e){let s=this.intersectRadialLinePos(t,e);return 1==s&&(s=this.triContainsPoint(e),s>0)?1:-1}triIntersectStraightLinePos2(t,e,s){let i=this.intersectStraightLinePos2(t,e,s);return 1==i&&(i=this.triContainsPoint(s),i>0)?1:-1}triIntersectRadialLinePos2(t,e,s){let i=this.intersectStraightLinePos2(t,e,s);return 1==i&&(i=this.triContainsPoint(s),i>0)?1:-1}triContainsPoint(t){let e=this.nv.dot(t)-this.distance;return e>r.default.MATH_MIN_POSITIVE||e<r.default.MATH_MAX_NEGATIVE?-1:(n.default.__tV0.x=t.x-this.v0.x,n.default.__tV0.y=t.y-this.v0.y,n.default.__tV0.z=t.z-this.v0.z,a.default.Cross(this.ls01.tv,n.default.__tV0,n.default.__tV1),this.nv.dot(n.default.__tV1)<0?-1:(n.default.__tV0.x=t.x-this.v1.x,n.default.__tV0.y=t.y-this.v1.y,n.default.__tV0.z=t.z-this.v1.z,a.default.Cross(this.ls12.tv,n.default.__tV0,n.default.__tV1),this.nv.dot(n.default.__tV1)<0?-1:(n.default.__tV0.x=t.x-this.v2.x,n.default.__tV0.y=t.y-this.v2.y,n.default.__tV0.z=t.z-this.v2.z,a.default.Cross(this.ls20.tv,n.default.__tV0,n.default.__tV1),this.nv.dot(n.default.__tV1)<0?-1:1)))}update(){let t=1/3;this.position.x=t*(this.v0.x+this.v1.x+this.v2.x),this.position.y=t*(this.v0.y+this.v1.y+this.v2.y),this.position.z=t*(this.v0.z+this.v1.z+this.v2.z),this.nv.x=this.position.x-this.v0.x,this.nv.y=this.position.y-this.v0.y,this.nv.z=this.position.z-this.v0.z,this.radiusSquared=this.nv.getLengthSquared(),this.ls01.position.copyFrom(this.v0),this.ls01.anotherPosition.copyFrom(this.v1),this.ls12.position.copyFrom(this.v1),this.ls12.anotherPosition.copyFrom(this.v2),this.ls20.position.copyFrom(this.v2),this.ls20.anotherPosition.copyFrom(this.v0),this.ls01.update(),this.ls12.update(),this.ls20.update(),a.default.Cross(this.ls01.tv,this.ls12.tv,this.nv),this.nv.normalize(),this.distance=this.nv.dot(this.v0)}updateFast(){this.update()}}e.Triangle=l,e.default=o},e3db:function(t,e){var s={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==s.call(t)}},e439:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("bd6f")),n=i(s("c51d")),h=i(s("9bb7")),o=i(s("e8e6")),l=i(s("b498")),_=i(s("29ef")),u=i(s("829f"));class m{constructor(t){this.m_rscene=null,this.m_vsmData=null,this.m_direcCamera=null,this.m_fboDepth=null,this.m_fboOccBlur=null,this.m_verOccBlurPlane=null,this.m_horOccBlurPlane=null,this.m_blurModule=null,this.m_camPos=new r.default(600,800,-600),this.m_shadowBias=-5e-4,this.m_shadowRadius=2,this.m_shadowIntensity=.8,this.m_colorIntensity=.1,this.m_shadowMapW=128,this.m_shadowMapH=128,this.m_viewWidth=1300,this.m_viewHeight=1300,this.m_near=.01,this.m_far=3e3,this.m_depthRtt=null,this.m_occBlurRtt=null,this.m_fboIndex=0,this.m_shadowCamVersion=-1,this.m_buildShadowDelay=120,this.force=!0,this.m_fboIndex=t}initialize(t,e,s=120,i=!1){null==this.m_rscene&&(this.m_rscene=t,this.m_buildShadowDelay=s,this.initConfig(e,!1))}setMapSize(t,e){this.m_shadowMapW=t,this.m_shadowMapH=e}seetCameraPosition(t){this.m_camPos.copyFrom(t)}setCameraNear(t){this.m_near=t}setCameraFar(t){this.m_far=t}setCameraViewSize(t,e){this.m_viewWidth=t,this.m_viewHeight=e}setShadowRadius(t){this.m_shadowRadius=t}setShadowBias(t){this.m_shadowBias=t}setShadowIntensity(t){this.m_shadowIntensity=t,null!=this.m_vsmData&&this.m_vsmData.setShadowIntensity(this.m_shadowIntensity)}setColorIntensity(t){this.m_colorIntensity=t,null!=this.m_vsmData&&this.m_vsmData.setColorIntensity(this.m_colorIntensity)}getShadowMap(){return null!=this.m_blurModule?this.m_blurModule.getDstTexture():this.m_depthRtt}getVSMData(){return this.m_vsmData}getCamera(){return this.m_direcCamera}initConfig(t,e=!1){let s;this.m_vsmData=new l.default,this.m_vsmData.initialize(),this.m_vsmData.setShadowIntensity(this.m_shadowIntensity),this.m_fboDepth=this.m_rscene.createFBOInstance(),this.m_fboDepth.asynFBOSizeWithViewport(),this.m_fboDepth.setClearRGBAColor4f(1,1,1,1),this.m_fboDepth.createFBOAt(this.m_fboIndex,this.m_shadowMapW,this.m_shadowMapH,!0,!1),this.m_depthRtt=this.m_fboDepth.setRenderToRGBATexture(null,0),this.m_fboDepth.setRProcessIDList(t),this.m_fboDepth.setGlobalRenderState(_.default.NORMAL_STATE),this.m_fboDepth.setGlobalMaterial(new h.default),this.m_fboOccBlur=this.m_rscene.createFBOInstance(),this.m_fboOccBlur.asynFBOSizeWithViewport(),this.m_fboOccBlur.setClearRGBAColor4f(1,1,1,1),this.m_fboOccBlur.createFBOAt(this.m_fboIndex,this.m_shadowMapW,this.m_shadowMapH,!0,!1),this.m_occBlurRtt=this.m_fboOccBlur.setRenderToRGBATexture(null,0),s=new o.default(!1),s.setShadowRadius(this.m_shadowRadius);let i=new a.default;i.setMaterial(s),i.initializeXOY(-1,-1,2,2,[this.m_depthRtt]),this.m_verOccBlurPlane=i,s=new o.default(!0),s.setShadowRadius(this.m_shadowRadius);let m=new a.default;m.copyMeshFrom(i),m.setMaterial(s),m.initializeXOY(-1,-1,2,2,[this.m_occBlurRtt]),this.m_horOccBlurPlane=m,e&&(this.m_blurModule=new u.default(this.m_rscene.getRenderer()),this.m_blurModule.setBlurCount(2),this.m_blurModule.setSyncViewSizeEnabled(!1),this.m_blurModule.setFBOSize(this.m_shadowMapW,this.m_shadowMapH),this.m_blurModule.setBlurDensity(1),this.m_blurModule.bindDrawEntity(this.m_verOccBlurPlane),this.m_blurModule.setBackbufferVisible(!1));let d=this.m_viewWidth,c=this.m_viewHeight;this.m_direcCamera=new n.default,this.m_direcCamera.lookAtRH(this.m_camPos,new r.default(0,0,0),new r.default(0,1,0)),this.m_direcCamera.orthoRH(this.m_near,this.m_far,-.5*c,.5*c,-.5*d,.5*d),this.m_direcCamera.setViewXY(0,0),this.m_direcCamera.setViewSize(d,c),this.m_direcCamera.update(),this.m_vsmData.updateShadowCamera(this.m_direcCamera),this.m_vsmData.setShadowRadius(this.m_shadowRadius),this.m_vsmData.setShadowBias(this.m_shadowBias),this.m_vsmData.setShadowSize(this.m_shadowMapW,this.m_shadowMapH),this.m_vsmData.upadate()}upateData(){this.m_buildShadowDelay=32,this.m_shadowCamVersion=this.m_direcCamera.version,this.m_vsmData.upadate()}run(){this.m_direcCamera.version!=this.m_shadowCamVersion&&(this.m_shadowCamVersion=this.m_direcCamera.version,this.m_vsmData.updateShadowCamera(this.m_direcCamera),this.m_vsmData.upadate()),(this.m_buildShadowDelay>0||this.force)&&((this.m_buildShadowDelay%15==0||this.force)&&this.buildShadow(),this.m_buildShadowDelay--),this.force=!1}buildShadow(){this.m_fboDepth.useCamera(this.m_direcCamera),this.m_fboDepth.run(!0,!0),this.m_fboDepth.useMainCamera(),this.m_fboOccBlur.setRenderToRGBATexture(this.m_occBlurRtt,0),this.m_fboOccBlur.runBegin(),this.m_fboOccBlur.drawEntity(this.m_verOccBlurPlane),this.m_fboOccBlur.runEnd(),this.m_fboOccBlur.setRenderToRGBATexture(this.m_depthRtt,0),this.m_fboOccBlur.runBegin(),this.m_fboOccBlur.drawEntity(this.m_horOccBlurPlane),this.m_fboOccBlur.runEnd(),null!=this.m_blurModule&&this.m_blurModule.run(),this.m_fboOccBlur.setRenderToBackBuffer()}}e.ShadowVSMModule=m,e.default=m},e7ce:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("faa5")),a=i(s("b3bd")),n=i(s("0fc4"));class h extends r.default{constructor(){super(),this.m_uniqueName=""}initialize(t){this.m_uniqueName="PixelPickIndexShd"}getFragShaderCode(){let t="#version 300 es\nprecision highp float;\nuniform vec4 u_param;\nin vec3 v_viewPos;\n//in float v_length;\nlayout(location = 0) out vec4 FragColor0;\nvoid main()\n{\nvec4 p = vec4(length(v_viewPos.xyz));\np.x = floor(p.x)/256.0;\np.y = floor(fract(p.x) * 256.0)/255.0;\np.x = floor(p.x) / 255.0;\np.z = fract(p.z);\nFragColor0 = vec4(p.xyz,u_param.w);\n}\n";return t}getVtxShaderCode(){let t="#version 300 es\nprecision highp float;\nlayout(location = 0) in vec3 a_vs;\nuniform mat4 u_objMat;\nuniform mat4 u_viewMat;\nuniform mat4 u_projMat;\nout vec3 v_viewPos;\n//out float v_length;\nvoid main(){\nmat4 viewMat4 = u_viewMat * u_objMat;\nvec4 viewPos = viewMat4 * vec4(a_vs, 1.0);\nv_viewPos = viewPos.xyz;\n//v_length = length(viewPos.xyz);\ngl_Position = u_projMat * viewPos;\n}\n";return t}getUniqueShaderName(){return this.m_uniqueName}toString(){return"[PixelPickIndexShaderBuffer()]"}static GetInstance(){return h.s_instance}}h.s_instance=new h,e.PixelPickIndexShaderBuffer=h;class o extends n.default{constructor(){super(),this.m_paramArray=new Float32Array([1,1,1,1]),this.m_1over255=1/255}getCodeBuf(){return h.GetInstance()}setIndex(t){this.m_paramArray[3]=t*this.m_1over255}getIndex(){return this.m_paramArray[3]/this.m_1over255}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_param"],t.dataList=[this.m_paramArray],t}}e.default=o},e7d2:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("710f")),n=i(s("f0f0")),h=i(s("7a04")),o=s("e08e");class l{constructor(t=r.default.VTX_STATIC_DRAW){this.m_uid=0,this.m_vtxBuf=null,this.m_ivs=null,this.m_bufDataUsage=0,this.m_ibufStep=2,this.layoutBit=0,this.vertexVer=0,this.indicesVer=0,this.version=0,this.drawMode=o.RenderDrawMode.ELEMENTS_TRIANGLES,this.bufData=null,this.m_uid=l.s_uid++,this.m_bufDataUsage=t}setVtxBuf(t){t!=this&&(this.m_vtxBuf=t,null!=t&&(t.layoutBit=this.layoutBit))}getUid(){return this.m_uid}getType(){return this.m_vtxBuf.getType()}getIBufStep(){return this.m_ibufStep}getBufDataUsage(){return this.m_bufDataUsage}setBufDataUsage(t){this.m_bufDataUsage=t}getBuffersTotal(){return this.m_vtxBuf.getBuffersTotal()}getF32DataAt(t){return this.m_vtxBuf.getF32DataAt(t)}getIvsData(){return this.m_ivs}setF32DataAt(t,e,s,i){this.m_vtxBuf.setF32DataAt(t,e,s,i),this.vertexVer++}setUintIVSData(t,e=r.default.VTX_STATIC_DRAW){if(t instanceof Uint16Array)this.m_ibufStep=2;else{if(!(t instanceof Uint32Array))return;this.m_ibufStep=4}this.m_ivs=t,null!=t&&this.indicesVer++}setUint16IVSData(t,e=r.default.VTX_STATIC_DRAW){t instanceof Uint16Array&&(this.m_ivs=t,this.indicesVer++,this.m_ibufStep=2)}setUint32IVSData(t,e=r.default.VTX_STATIC_DRAW){t instanceof Uint32Array&&(this.m_ivs=t,this.indicesVer++,this.m_ibufStep=4)}setData4fAt(t,e,s,i,r,a){null!=this.m_vtxBuf&&(this.m_vtxBuf.setData4fAt(t,e,s,i,r,a),this.vertexVer++)}setData3fAt(t,e,s,i,r){null!=this.m_vtxBuf&&(this.m_vtxBuf.setData3fAt(t,e,s,i,r),this.vertexVer++)}setData2fAt(t,e,s,i){null!=this.m_vtxBuf&&(this.m_vtxBuf.setData2fAt(t,e,s,i),this.vertexVer++)}destroy(){}__$destroy(){this.m_vtxBuf.destroy(),this.m_vtxBuf.getType()<1?l.s_combinedBufs.push(this.m_vtxBuf):l.s_separatedBufs.push(this.m_vtxBuf),this.m_vtxBuf=null,this.m_ivs=null,this.bufData=null}toString(){return"ROVertexBuffer(uid = "+this.m_uid+")"}static GetFreeId(){return l.s_freeIdList.length>0?l.s_freeIdList.pop():-1}static GetVtxByUid(t){return l.s_unitList[t]}static Create(t=r.default.VTX_STATIC_DRAW){let e=null,s=l.GetFreeId();return s>=0?(e=l.s_unitList[s],e.setBufDataUsage(t),l.s_unitFlagList[s]=l.S_FLAG_BUSY):(e=new l(t),l.s_unitList.push(e),l.s_unitFlagList.push(l.S_FLAG_BUSY),l.s_unitListLen++),e.vertexVer=0,e.indicesVer=0,e.version++,l.s_vtxStore.__$attachAt(e.getUid()),e}static __$Restore(t){if(null!=t&&l.s_unitFlagList[t.getUid()]==l.S_FLAG_BUSY){let e=t.getUid();l.s_freeIdList.push(e),l.s_unitFlagList[e]=l.S_FLAG_FREE,t.__$destroy()}}static __$$AttachAt(t){l.s_vtxStore.__$attachAt(t)}static __$$DetachAt(t){l.s_vtxStore.__$detachAt(t)}static Reset(){l.BufDataList=[],l.s_stride=0,l.BufStatusList=[],l.BufDataStepList=[],l.vtxFS32=null,l.vbWholeDataEnabled=!1,l.dynBufSegEnabled=!1,l.useBufByIndexEnabled=!1}static AddFloat32Data(t,e,s=r.default.VTX_STATIC_DRAW){l.BufDataList.push(t),l.BufDataStepList.push(e),l.BufStatusList.push(s),l.s_stride+=e}static CreateBySaveData(t=r.default.VTX_STATIC_DRAW,e=0){let s=0,i=0,a=0,h=l.BufDataStepList.length,o=[];for(;s<h;s++)o.push(a),a+=l.BufDataStepList[s];let _=l.BufDataList[0].length/l.BufDataStepList[0],u=new Float32Array(a*_),m=0,d=0,c=null,f=null;for(s=0;s<_;++s)for(i=s*a,m=0;m<h;++m)d=l.BufDataStepList[m],c=l.BufDataList[m],f=c.subarray(s*d,(s+1)*d),u.set(f,i),i+=d;let p=l.Create(t);if(p.layoutBit=e,l.s_combinedBufs.length>0){let t=l.s_combinedBufs.pop();p.setVtxBuf(t)}else p.setVtxBuf(new n.default(p.getBufDataUsage()));return p.setF32DataAt(0,u,a,o),p}static UpdateBufData(t){let e=0,s=0,i=0,r=l.BufDataStepList.length,a=l.BufDataList[0].length/l.BufDataStepList[0],n=t.getF32DataAt(0),h=l.s_stride*a!=n.length,o=null;if(h)for(o=[],n=new Float32Array(l.s_stride*a);e<r;e++)o.push(i),i+=l.BufDataStepList[e];else i=l.s_stride;let _=0,u=0,m=null,d=null;for(e=0;e<a;++e)for(s=e*i,_=0;_<r;++_)u=l.BufDataStepList[_],m=l.BufDataList[_],d=m.subarray(e*u,(e+1)*u),n.set(d,s),s+=u;h?t.setF32DataAt(0,n,i,o):t.setF32DataAt(0,n,i,null)}static CreateByBufDataSeparate(t,e=r.default.VTX_STATIC_DRAW,s=0){let i=0,a=0,n=t.getAttributesTotal(),o=new Array(n);o.fill(0);let _=l.Create(e);if(_.layoutBit=s,l.s_separatedBufs.length>0){let t=l.s_separatedBufs.pop();_.setVtxBuf(t)}else _.setVtxBuf(new h.default);for(i=0;i<n;i++)_.setF32DataAt(i,t.getAttributeDataAt(i,0),a,o);return _.setUintIVSData(t.getIndexDataAt(0)),_.bufData=t,_}static CreateBySaveDataSeparate(t=r.default.VTX_STATIC_DRAW){let e=0,s=0,i=l.BufDataStepList.length,a=new Array(i);a.fill(0);let n=l.Create(t);if(l.s_separatedBufs.length>0){let t=l.s_separatedBufs.pop();n.setVtxBuf(t)}else n.setVtxBuf(new h.default);for(e=0;e<i;e++)n.setF32DataAt(e,l.BufDataList[e],s,a);return n}static GetVtxAttachCountAt(t){return l.s_vtxStore.getAttachCountAt(t)}static GetVtxAttachAllCount(){return l.s_vtxStore.getAttachAllCount()}static ClearTest(){if(--l.s_timeDelay,l.s_timeDelay<1){l.s_timeDelay=128;let t=l.s_vtxStore;if(t.__$getRemovedListLen()>0){let e=t.__$getRemovedList(),s=e.length,i=0,r=0,a=null,n=32;for(s=s>n?n:s;i<s;++i)r=e.shift(),t.getAttachCountAt(r)<1&&(a=l.GetVtxByUid(r),l.__$Restore(a))}}}}l.s_uid=0,l.s_combinedBufs=[],l.s_separatedBufs=[],l.S_FLAG_BUSY=1,l.S_FLAG_FREE=0,l.s_unitFlagList=[],l.s_unitListLen=0,l.s_unitList=[],l.s_freeIdList=[],l.s_vtxStore=new a.default,l.s_stride=0,l.BufDataList=null,l.BufDataStepList=null,l.BufStatusList=null,l.vtxDataFS32=null,l.vbWholeDataEnabled=!1,l.dynBufSegEnabled=!1,l.useBufByIndexEnabled=!1,l.vtxFS32=null,l.s_timeDelay=128,e.default=l},e87b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279"));class n{create(t,e){let s=null,i=r.default.ViewParam;return e.hasUniformByName(i.name)&&(s=new a.default,s.uns=i.name,s.uniformNameList=[i.name],s.copyDataFromProbe(t.getRenderAdapter().uViewProbe)),s}getIDNS(){return"ViewParamUniformBuilder"}}e.default=n},e8e6:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("250c")),a=i(s("faa5")),n=i(s("b3bd")),h=i(s("0fc4"));class o extends a.default{constructor(){super(),this.m_codeBuilder=new r.default,this.m_uniqueName="",this.m_hasTex=!1,this.horizonal=!0}initialize(t){this.m_uniqueName="OccBlurShd",this.m_hasTex=t,t&&(this.m_uniqueName+="_tex")}buildThisCode(){let t=this.m_codeBuilder;t.reset(),this.horizonal&&t.addDefine("HORIZONAL_PASS"),t.addDefine("SAMPLE_RATE","0.25"),t.addDefine("HALF_SAMPLE_RATE","0.125"),t.addVertLayout("vec3","a_vs"),t.addTextureSample2D(),t.addFragOutput("vec4","FragColor0"),t.addFragUniform("vec4","u_viewParam"),t.addFragUniform("vec4","u_param")}getFragShaderCode(){this.buildThisCode();let t=this.m_codeBuilder;return t.addFragMainCode("\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n    vec4 r = vec4( fract( v * PackFactors ), v );\n    r.yzw -= r.xyz * ShiftRight8; // tidy overflow\n    return r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n    return dot( v, UnpackFactors );\n}\n\nvec4 pack2HalfToRGBA( vec2 v ) {\n    vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n    return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n    return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nvoid main() {\n\n    float mean = 0.0;\n    float squared_mean = 0.0;\n    \n    vec2 resolution = u_viewParam.zw;\n    \n    float radius = u_param[3];\n    // This seems totally useless but it's a crazy work around for a Adreno compiler bug\n    float depth = unpackRGBAToDepth( VOX_Texture2D( u_sampler0, ( gl_FragCoord.xy ) / resolution ) );\n\n    for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\n        #ifdef HORIZONAL_PASS\n\n            vec2 distribution = unpackRGBATo2Half( VOX_Texture2D( u_sampler0, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n            mean += distribution.x;\n            squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\n        #else\n\n            float depth = unpackRGBAToDepth( VOX_Texture2D( u_sampler0, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n            mean += depth;\n            squared_mean += depth * depth;\n\n        #endif\n\n    }\n\n    mean = mean * HALF_SAMPLE_RATE;\n    squared_mean = squared_mean * HALF_SAMPLE_RATE;\n\n    float std_dev = sqrt( squared_mean - mean * mean );\n\n    FragColor0 = pack2HalfToRGBA( vec2( mean, std_dev ) );\n\n}\n"),this.m_codeBuilder.buildFragCode()}getVtxShaderCode(){let t=this.m_codeBuilder;return t.addVertMainCode("\nvoid main() {\n    gl_Position =  vec4(a_vs,1.0);\n}\n"),this.m_codeBuilder.buildVertCode()}getUniqueShaderName(){return this.m_uniqueName+(this.horizonal?"_h":"_v")}toString(){return"[OccBlurShaderBuffer()]"}static GetInstance(){return null!=o.s_instance||(o.s_instance=new o),o.s_instance}}o.s_instance=null;class l extends h.default{constructor(t){super(),this.m_horizonal=!0,this.m_param=new Float32Array([1,1,1,4]),this.m_horizonal=t}getCodeBuf(){let t=o.GetInstance();return t.horizonal=this.m_horizonal,t}setShadowRadius(t){this.m_param[3]=t}createSelfUniformData(){let t=new n.default;return t.uniformNameList=["u_param"],t.dataList=[this.m_param],t}}e.default=l},e903:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("c4e3"));class a{constructor(){this.m_info="",this.m_buffer=null,this.m_loadStatus=0,this.paramSuffix=".pmd",this.multiBuffers=!0,this.zipParseEnabled=!1}load(t,e){let s=this;if(this.multiBuffers){let s=t.lastIndexOf("."),i=t.slice(0,s)+this.paramSuffix;this.loadParam(i,e)}else++s.m_loadStatus;const i=new FileReader;i.onload=t=>{++s.m_loadStatus,s.m_buffer=i.result,s.m_loadStatus>1&&(this.zipParseEnabled?this.parseBufferZip(s.m_buffer).then(t=>{this.multiBuffers||(s.m_info="0,"+t.byteLength),e(t,s.m_info)}):(this.multiBuffers||(s.m_info="0,"+s.m_buffer.byteLength),e(s.m_buffer,s.m_info)))};const r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="blob",r.onload=()=>{i.readAsArrayBuffer(r.response)},r.send()}parseBufferZip(t){return new Promise((e,s)=>{let i=new r.default;i.loadAsync(t).then(t=>{let s=[];t.forEach(t=>{s.push(t)});let i=s[0];t.file(i).async("uint8array").then(t=>{e(t.buffer)})})})}loadParam(t,e){let s=this,i=new XMLHttpRequest;i.open("GET",t),i.onload=function(t){++s.m_loadStatus,s.m_info=i.responseText,s.m_loadStatus>1&&e(s.m_buffer,s.m_info)},i.send()}}e.default=a},e943:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("32fa"));class a{constructor(){this.m_rprocess=null,this.m_renderer=null,this.m_status=null}initialize(t){null==this.m_renderer&&(this.m_renderer=t,this.m_rprocess=this.m_renderer.createSeparatedProcess(),this.m_status=new r.default,this.m_status.initialize(this.m_renderer,this.m_rprocess))}getFPS(){return this.m_status.getFPS()}run(t=!1){null!=this.m_renderer&&(this.m_status.run(t),this.m_renderer.runProcess(this.m_rprocess))}toString(){return"[ProfileInstance]"}}e.default=a},eaee:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class n extends a.default{constructor(t,e){super(t,e,!1),this.m_imgDataList=null,this.m_texTarget=r.TextureTarget.TEXTURE_CUBE,this.m_type=r.TextureProxyType.FloatCube,this.internalFormat=r.TextureFormat.RGBA16F,this.dataType=r.TextureDataType.FLOAT,this.mipmapEnabled=!0}toRGBFormat(){this.unpackAlignment=1,this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB16F,this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.mipmapEnabled=!1}toRGBFormatFloat32F(){this.unpackAlignment=1,this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB32F,this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.mipmapEnabled=!1}toRGBAFormat(){this.unpackAlignment=4,this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA16F}toRGBAFormatFloat32F(){this.unpackAlignment=4,this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA32F}toRGBAFormatHalfFloat(){this.unpackAlignment=1,this.srcFormat=r.TextureFormat.RGBA,this.dataType=r.TextureDataType.HALF_FLOAT,this.internalFormat=r.TextureFormat.RGBA16F}setDataFromBytesToFaceAt(t,e,s,i,r=0){if(null==this.m_imgDataList&&(this.m_imgDataList=[null,null,null,null,null,null]),s>0&&i>0){0==t&&r<1&&(this.m_texWidth=s,this.m_texHeight=i,this.m_miplevel=r),null==this.m_imgDataList[t]&&(this.m_imgDataList[t]=new Array(16));let a=this.m_imgDataList[t];a[r]={width:s,height:i,imgData:e,miplevel:r},this.m_haveRData=null!=a[r].imgData}}uploadData(t){let e,s,i=t.getRC(),a=null,n=this.getWidth(),h=this.getHeight();for(let o=0;o<6;++o){let t=this.m_imgDataList[o];if(this.mipmapEnabled&&this.m_generateMipmap)a=t[0],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,r.TextureFormat.ToGL(i,this.internalFormat),n,h,0,r.TextureFormat.ToGL(i,this.srcFormat),r.TextureDataType.ToGL(i,this.dataType),a.imgData);else{e=n,s=h;let l=0;for(;e>0||s>0;)null!=t[l]&&(a=t[l],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+o,l,r.TextureFormat.ToGL(i,this.internalFormat),e,s,0,r.TextureFormat.ToGL(i,this.srcFormat),r.TextureDataType.ToGL(i,this.dataType),a.imgData)),e>0&&(e>>=1),s>0&&(s>>=1),++l}}this.version=0}toString(){return"[FloatCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.m_imgDataList)for(let t=0;t<6;++t)null!=this.m_imgDataList[t]&&(this.m_imgDataList[t].imgData=null);super.__$destroy()}}}e.default=n},eca0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("c62b"));class n{constructor(){this.idsFlag=0,this.count=0,this.rprocessUid=-1}reset(){this.idsFlag=0}}n.RenerProcessMaxTotal=16,e.RCRPObj=n;class h extends r.default{constructor(){super(...arguments),this.m_rcpoList=[]}createNode(){let t=new n;return t.reset(),this.m_rcpoList.push(t),new a.default}restoreUid(t){this.m_rcpoList[t].reset()}testRPNodeExists(t,e){return(this.m_rcpoList[t].idsFlag&1<<e)>0}testRPNodeNotExists(t,e){return(this.m_rcpoList[t].idsFlag&1<<e)<1}setRPNodeParam(t,e,s){let i=this.m_rcpoList[t],r=1<<e;return s>-1?(i.idsFlag&r)<1&&(++i.count,i.rprocessUid=e,i.idsFlag=i.idsFlag|r):(i.idsFlag&r)>0&&(--i.count,i.idsFlag=i.idsFlag&~r),i.count}getRCRPObj(t){return this.m_rcpoList[t]}}e.RPOUnitBuilder=h},ecf9:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.CodeStr='\nlet scriptDir = "";\nlet ENV_IS_WORKER = typeof importScripts === \'function\';\nif (ENV_IS_WORKER) {\n    scriptDir = self.location.href;\n}\nvar baseUrl = scriptDir.slice(0, scriptDir.lastIndexOf("/") + 1);\nvar k = baseUrl.indexOf("http://");\nif (k < 0) {\n    k = baseUrl.indexOf("https://");\n}\nif (k < 0) k = 0;\nbaseUrl = baseUrl.slice(k);\nself.__$TaskSlot = new Array(512);\nself.__$TaskSlot.fill(null);\nself.TaskSTList = new Array(512);\nself.TaskSTList.fill(0);\nlet taskSlot = self.__$TaskSlot;\nlet taskSTList = self.TaskSTList;\n\nfunction initializeExternModule(ext_module) {\n    if(ext_module != null && ext_module.getTaskClass != undefined) {\n        self.__$TaskSlot[ext_module.getTaskClass()] = ext_module;\n        const INIT_TASK = 3701;\n        postMessage({cmd:INIT_TASK,taskclass:ext_module.getTaskClass()});\n    }\n}\n\nfunction ThreadCore() {\n    let m_initBoo = true;\n    let m_threadIndex = 0;\n    this.isWorker = typeof (postMessage) !== "undefined";\n\n    let selfT = this;\n\n    const DATA_PARSE = 3501;\n    const THREAD_INIT = 3601;\n    const INIT_TASK = 3701;\n    const INIT_PARAM = 3801;\n    this.receiveData = function (evt) {\n        /////////////////////////////////////////////////// receive data from Main Worker ///////////////////////////////////\n        //console.log("receive main data in worker,data: ",evt.data);\n        let data = evt.data;\n        switch (data.cmd) {\n            case DATA_PARSE:\n                // taskclass\n                data.threadIndex = m_threadIndex;\n                let ins = taskSlot[data.taskclass];\n                if (ins) {\n                    ins.receiveData(data);\n                }\n                break;\n            case INIT_TASK:\n                let param = data.param;\n                //console.log("worker INIT_TASK param.type: ", param.type);\n                switch (param.type) {\n                    case 0:\n                        if (taskSTList[param.taskclass] < 1) {\n                            taskSTList[param.taskclass] = 1;\n                            let js_url = param.taskName;\n                            let urlEnabled = param.moduleName != undefined && param.moduleName != "";\n                            if(!urlEnabled) {\n                                let si = param.taskName.lastIndexOf(".");\n                                if(si > 0) {\n                                    param.taskName = param.taskName.slice(0,si);\n                                }\n                                js_url = baseUrl + param.taskName + ".js";\n                            }\n                            //console.log("importScripts worker js_url: " + js_url);\n                            importScripts(js_url);\n                        }\n                        break;\n                    case 1:\n                        if (taskSTList[param.taskclass] < 1) {\n                            taskSTList[param.taskclass] = 1;\n                            // build code from block\n                        }\n                        break;\n                    case 2:\n                        if (taskSTList[param.taskclass] < 1) {\n                            taskSTList[param.taskclass] = 1;\n                            // build code from string\n                            eval(param.srccode);\n                            if (param.moduleName != undefined && param.moduleName != "") {\n                                var mins = "workerIns_" + param.moduleName;\n                                var tmcodeStr = "var " + mins + " = new " + param.moduleName + "();";\n                                tmcodeStr += "\\ninitializeExternModule(" + mins + ");";\n                                eval(tmcodeStr);\n                                //  let blob = new Blob([tmcodeStr]);\n                                //  importScripts(URL.createObjectURL(blob));\n                            }\n                        }\n                        break;\n                    default:\n                        break;\n                }\n                if (data.type < 1) {\n                    if (taskSTList[param.taskclass] < 1) {\n                        taskSTList[param.taskclass] = 1;\n                        let js_url = baseUrl + param.taskName + ".js";\n                        console.log("worker js_url: " + js_url);\n                        importScripts(js_url);\n                    }\n                }\n                else {\n                    if (taskSTList[param.taskclass] < 1) {\n                        taskSTList[param.taskclass] = 1;\n                    }\n                }\n                break;\n            case INIT_PARAM:\n                if (m_initBoo) {\n                    m_threadIndex = data.threadIndex;\n\n                    console.log("thread init data.threadIndex: " + m_threadIndex);\n                    m_initBoo = false;\n                    postMessage({ cmd: INIT_PARAM, threadIndex: m_threadIndex });\n                }\n                break;\n            default:\n                break;\n        }\n    }\n    this.initialize = function () {\n        console.log("###worker ThreadCore::initialize()...");\n        //console.log("self.__$TaskSlot: ",self.__$TaskSlot);\n        if (typeof (postMessage) !== "undefined") {\n            self.addEventListener(\n                "message",\n                selfT.receiveData,\n                false\n            );\n            const THREAD_INIT = 3601;\n            postMessage({ cmd: THREAD_INIT });\n        }\n    }\n}\n//  console.log("worker run begin ...");\n//  console.log("scriptDir: " + scriptDir);\n//  console.log("baseUrl: " + baseUrl);\nlet thrCore = new ThreadCore();\nthrCore.initialize();\n',e.default=i},ee5a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.type=0,this.m_listeners=[],this.m_hosts=[],this.m_phases=[]}addListener(t,e,s){let i=this.m_hosts.length-1;for(;i>=0;--i)if(t===this.m_hosts[i])break;i<0&&(this.m_hosts.push(t),this.m_listeners.push(e),this.m_phases.push(s))}removeListener(t,e){let s=this.m_hosts.length-1;for(;s>=0;--s)if(t===this.m_hosts[s]){this.m_hosts.splice(s,1),this.m_listeners.splice(s,1),this.m_phases.splice(s,1);break}}dispatch(t){let e=0,s=this.m_hosts.length;for(let i=0;i<s;++i)(this.m_phases[i]<1||t.phase==this.m_phases[i])&&(this.m_listeners[i].call(this.m_hosts[i],t),e=1);return e}passTestEvt(t){let e=this.m_hosts.length;for(let s=0;s<e;++s)if(this.m_phases[s]<1||t.phase==this.m_phases[s])return 1;return 0}passTestPhase(t){let e=this.m_hosts.length;for(let s=0;s<e;++s)if(this.m_phases[s]<1||t==this.m_phases[s])return 1;return 0}destroy(){this.m_hosts=[],this.m_listeners=[],this.m_phases=[]}}e.default=i},efce:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("e7d2")),a=i(s("8a0a")),n=i(s("fecb")),h=i(s("cb29")),o=i(s("725b"));class l extends h.default{constructor(t=a.default.VTX_DYNAMIC_DRAW){super(t),this.m_vs=null,this.m_uvs=null,this.m_width=0,this.m_height=0,this.m_charsTotal=0,this.m_charsStr="",this.flipVerticalUV=!1,this.vtxUVEnabled=!0,this.vtxColorEnabled=!1,this.alignFactorX=.5,this.alignFactorY=.5}getWidth(){return this.m_width}getHeight(){return this.m_height}createStrData(t){this.m_charsStr=t;let e=t.length;this.m_charsTotal=e;let s=!1;if(e>0){o.default.GetInstance().createCharsTexFromStr(t),this.m_width=-1,this.m_height=0;let i=l.s_sizeArr,a=0,h=0,_=0,u=0,m=0;if(s=null!=this.m_vs&&8*e>this.m_vs.length,s){let s=l.s_currIvs;for(s.set(l.s_initIvs,0),this.m_ivs=new Uint16Array(6*e),this.m_uvs=new Float32Array(8*e),this.m_vs=new Float32Array(8*e);a<e;++a)this.m_ivs.set(s,6*a),s[0]+=4,s[1]+=4,s[2]+=4,s[3]+=4,s[4]+=4,s[5]+=4,o.default.GetInstance().getCharTable().getUV8AndSizeFromChar(t.charAt(a),this.m_uvs,i,8*a),this.m_height<i[1]&&(this.m_height=i[1]),this.m_vs[8*a]=i[0],this.m_width+=i[0]}else for(null==this.m_vs&&(this.m_uvs=new Float32Array(8*e),this.m_vs=new Float32Array(8*e));a<e;++a)o.default.GetInstance().getCharTable().getUV8AndSizeFromChar(t.charAt(a),this.m_uvs,i,8*a),this.m_height<i[1]&&(this.m_height=i[1]),this.m_vs[8*a]=i[0],this.m_width+=i[0];let d=1;this.m_width+=e*d,u=-this.alignFactorX*this.m_width,m=-this.alignFactorY*this.m_height,_=m+this.m_height,null==this.bounds&&(this.bounds=new n.default),this.bounds.min.setXYZ(u,m,0),this.bounds.max.setXYZ(u+this.m_width,_,0);let c=0;for(a=0;a<e;++a)h=u+this.m_vs[c],this.m_vs[c]=u,this.m_vs[c+1]=m,this.m_vs[c+2]=h,this.m_vs[c+3]=m,this.m_vs[c+4]=h,this.m_vs[c+5]=_,this.m_vs[c+6]=u,this.m_vs[c+7]=_,u=h+d,c+=8;r.default.Reset(),r.default.AddFloat32Data(this.m_vs,2),r.default.AddFloat32Data(this.m_uvs,2)}s&&this.m_vbuf.setUint16IVSData(this.m_ivs),this.vtCount=6*e,this.vtxTotal=4*e,this.trisNumber=2*e}initialize(t){let e=t.length,s=l.s_currIvs;s.set(l.s_initIvs,0),null==this.m_ivs&&(this.m_ivs=new Uint16Array(6*e));for(let i=0;i<e;++i)this.m_ivs.set(s,6*i),s[0]+=4,s[1]+=4,s[2]+=4,s[3]+=4,s[4]+=4,s[5]+=4;this.createStrData(t),r.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.m_vbuf=r.default.CreateBySaveData(this.getBufDataUsage()),this.m_vbuf.setUint16IVSData(this.m_ivs),this.buildEnd()}updateCharStr(t){null!=this.m_vbuf&&this.m_charsStr!=t&&(this.createStrData(t),this.buildEnd(),r.default.UpdateBufData(this.m_vbuf))}__$destroy(){this.isResFree()&&(this.bounds=null,this.m_vs=null,this.m_uvs=null,super.__$destroy())}}l.s_initIvs=new Uint8Array([0,1,2,0,2,3]),l.s_currIvs=new Uint8Array([0,1,2,0,2,3]),l.s_sizeArr=[0,0],e.default=l},f044:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static CreateNewID(){return i.__s_uid++}}i.__s_uid=0,e.default=i},f0f0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("f044"));class a{constructor(t){this.m_uid=-1,this.m_total=0,this.layoutBit=0,this.m_offsetList=null,this.m_f32=null,this.m_f32Stride=0,this.m_uid=r.default.CreateNewID()}getUid(){return this.m_uid}getType(){return 0}getBuffersTotal(){return 1}getF32DataAt(t){return this.m_f32}setF32DataAt(t,e,s,i){null!=i&&(this.m_offsetList=i),this.m_f32Stride=s,this.m_f32=e}setData4fAt(t,e,s,i,r,a){t=this.m_f32Stride*t+this.m_offsetList[e],this.m_f32[t++]=s,this.m_f32[t++]=i,this.m_f32[t++]=r,this.m_f32[t++]=a}setData3fAt(t,e,s,i,r){t=this.m_f32Stride*t+this.m_offsetList[e],this.m_f32[t++]=s,this.m_f32[t++]=i,this.m_f32[t++]=r}setData2fAt(t,e,s,i){t=this.m_f32Stride*t+this.m_offsetList[e],this.m_f32[t++]=s,this.m_f32[t++]=i}destroy(){this.m_offsetList=null,this.m_f32=null}toString(){return"VtxCombinedBuf(uid = "+this.m_uid+")"}}e.default=a},f152:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("38de")),n=i(s("fecb")),h=i(s("35fa")),o=i(s("8a0a")),l=i(s("e7d2")),_=i(s("5282")),u=i(s("cb29"));class m extends u.default{constructor(t=o.default.VTX_STATIC_DRAW){super(t),this.m_longitudeNumSegments=10,this.m_latitudeNumSegments=10,this.m_radius=50,this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,this.inverseUV=!1}getVS(){return this.m_vs}getUVS(){return this.m_uvs}getNVS(){return this.m_nvs}getCVS(){return this.m_cvs}getIVS(){return this.m_ivs}initialize(t,e,s,i){if(this.vtxTotal<1){if(t<.01)return;this.bounds=new n.default,this.bounds.min.setXYZ(-t,-t,-t),this.bounds.max.setXYZ(t,t,t),this.bounds.updateFast(),e<2&&(e=2),s<2&&(s=2),this.m_radius=Math.abs(t),this.m_longitudeNumSegments=e,this.m_latitudeNumSegments=s,(this.m_latitudeNumSegments+1)%2==0&&(this.m_latitudeNumSegments+=1),(this.m_longitudeNumSegments=this.m_latitudeNumSegments)&&(this.m_longitudeNumSegments+=1);let r=1,a=0,u=0,m=0,d=0,c=0,f=new _.default(0,-this.m_radius,0,u),p=[],g=[];g.push([]);let v=g[0];f.u=.5,f.v=.5,f.nx=0,f.ny=-1,f.nz=0,v.push(f.cloneVertex()),p.push(v[0]);let x=0,y=2.01*this.m_radius,T=0,b=1/this.m_radius;for(;r<this.m_latitudeNumSegments;++r){m=Math.PI*r/this.m_latitudeNumSegments,d=Math.sin(m),c=Math.cos(m),f.y=-this.m_radius*c,x=this.m_radius*d,T=f.y,T<0&&(T=-T),this.inverseUV||(T=this.m_radius-T),T/=y,g.push([]);let t=g[r];for(a=0;a<this.m_longitudeNumSegments;++a)m=2*Math.PI*a/this.m_longitudeNumSegments,++u,d=Math.sin(m),c=Math.cos(m),f.x=d*x,f.z=c*x,f.index=u,d*=T,c*=T,f.u=.5+d,f.v=.5+c,f.nx=f.x*b,f.ny=f.y*b,f.nz=f.z*b,t.push(f.cloneVertex()),p.push(t[a]);t.push(t[0])}++u,f.index=u,f.x=0,f.y=this.m_radius,f.z=0,f.u=.5,f.v=.5,f.nx=0,f.ny=1,f.nz=0,g.push([]);let S=g[this.m_latitudeNumSegments];S.push(f.cloneVertex()),p.push(S[0]);let E=null,A=[],w=null,R=null;for(r=1;r<=this.m_latitudeNumSegments;++r)for(w=g[r-1],R=g[r],a=1;a<=this.m_longitudeNumSegments;++a)1==r?(A.push(w[0].index),A.push(R[a].index),A.push(R[a-1].index)):r==this.m_latitudeNumSegments?(A.push(w[a].index),A.push(R[0].index),A.push(w[a-1].index)):(A.push(w[a].index),A.push(R[a-1].index),A.push(w[a-1].index),A.push(w[a].index),A.push(R[a].index),A.push(R[a-1].index));for(this.vtxTotal=p.length,i?(this.m_ivs=new Uint16Array(2*A.length),this.m_ivs.set(A,0),A.reverse(),this.m_ivs.set(A,A.length)):this.m_ivs=new Uint16Array(A),this.m_vs=new Float32Array(3*this.vtxTotal),r=0,a=0;a<this.vtxTotal;++a)E=p[a],this.m_vs[r]=E.x,this.m_vs[r+1]=E.y,this.m_vs[r+2]=E.z,r+=3;if(l.default.Reset(),l.default.AddFloat32Data(this.m_vs,3),this.isVBufEnabledAt(o.default.VBUF_UVS_INDEX)){for(this.m_uvs=new Float32Array(2*this.vtxTotal),r=0,a=0;a<this.vtxTotal;++a)E=p[a],this.m_uvs[r]=E.u,this.m_uvs[r+1]=E.v,r+=2;l.default.AddFloat32Data(this.m_uvs,2)}if(this.isVBufEnabledAt(o.default.VBUF_NVS_INDEX)){for(this.m_nvs=new Float32Array(3*this.vtxTotal),r=0,a=0;a<this.vtxTotal;++a)E=p[a],this.m_nvs[r]=E.nx,this.m_nvs[r+1]=E.ny,this.m_nvs[r+2]=E.nz,r+=3;l.default.AddFloat32Data(this.m_nvs,3)}if(this.isVBufEnabledAt(o.default.VBUF_CVS_INDEX)){for(this.m_cvs=new Float32Array(3*this.vtxTotal),r=0,a=0;a<this.vtxTotal;++a)this.m_cvs[r]=1,this.m_cvs[r+1]=1,this.m_cvs[r+2]=1,r+=3;l.default.AddFloat32Data(this.m_cvs,3)}if(this.isVBufEnabledAt(o.default.VBUF_TVS_INDEX)){let t=this.m_ivs.length/3,e=new Float32Array(this.m_vs.length),s=new Float32Array(this.m_vs.length);h.default.ClacTrisTangent(this.m_vs,this.m_vs.length,this.m_uvs,this.m_nvs,t,this.m_ivs,e,s),l.default.AddFloat32Data(e,3),l.default.AddFloat32Data(s,3)}this.wireframe&&this.updateWireframeIvs(),l.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.m_vbuf=l.default.CreateBySaveData(this.getBufDataUsage()),this.m_vbuf.setUint16IVSData(this.m_ivs),this.vtCount=this.m_ivs.length,this.trisNumber=this.vtCount/3}}__$destroy(){this.isResFree()&&(this.bounds=null,this.m_vs=null,this.m_uvs=null,this.m_nvs=null,this.m_cvs=null,super.__$destroy())}testRay(t,e,s,i){return a.default.IntersectioNearSphere2(t,e,r.default.ZERO,this.m_radius,s)}toString(){return"Sphere3DMesh()"}}e.default=m},f208:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.info=""}}e.default=i},f240:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("402a")),a=i(s("f63e")),n=i(s("dc6d"));class h extends r.default{constructor(t=null){super(t),this.m_plongitudeNumSegments=10,this.m_uvType=1,this.m_alignYRatio=-.5,this.m_transMatrix=null,this.uScale=1,this.vScale=1,this.wireframe=!1,this.m_radius=50,this.m_height=100}setVtxTransformMatrix(t){this.m_transMatrix=t}createMaterial(t){if(null==this.getMaterial()){let e=new a.default;e.setTextureList(t),this.setMaterial(e)}else this.getMaterial().setTextureList(t)}initialize(t,e,s,i=null,r=1,a=-.5){this.m_radius=t,this.m_height=e,this.m_plongitudeNumSegments=s,this.m_uvType=r,this.m_alignYRatio=a,this.createMaterial(i),this.activeDisplay()}__activeMesh(t){if(null==this.getMesh()){let e=new n.default;null!=this.m_transMatrix&&e.setTransformMatrix(this.m_transMatrix),e.uScale=this.uScale,e.vScale=this.vScale,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.wireframe=this.wireframe,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.m_radius,this.m_height,this.m_plongitudeNumSegments,2,this.m_uvType,this.m_alignYRatio),this.setMesh(e),e.setTransformMatrix(null)}this.m_transMatrix=null}toString(){return"[Cylinder3DEntity(uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")]"}}e.default=h},f48d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(){this.id=-1,this.position=new r.default}update(){}updateFast(){}}a.__tV0=new r.default,a.__tV1=new r.default,a.__tV2=new r.default,e.AbsGeomBase=a,e.default=a},f63b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=s("8d98"),n=i(s("3b73"));function h(t,e,s){var i=document.createElement("canvas");i.width=e,i.height=s,i.style.backgroundColor="transparent",i.style.display="block",i.style.left="0px",i.style.top="0px",i.style.position="absolute";let r=i.getContext("2d");return r.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height),{canvas:i,ctx2d:r}}function o(t,e,s){var i=document.createElement("canvas");i.width=e,i.height=s,i.style.backgroundColor="transparent",i.style.display="block",i.style.left="0px",i.style.top="0px",i.style.position="absolute";let r=i.getContext("2d");return r.globalCompositeOperation="destination-atop",r.fillStyle="rgba(255, 255, 255, 1.0)",r.rect(0,0,i.width,i.height),r.fill(),r.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height),{canvas:i,ctx2d:r}}class l{constructor(t,e){this.m_url="",this.m_img=null,this.m_loaded=!1,this.m_mipLv=0,this.texture=null,this.bytesTex=null,this.powerOf2Fix=!1,this.offsetTex=null,this.premultipliedAlpha=!0,this.m_url=t,this.m_mipLv=e}startLoad(){if(null==this.m_img){let t=this;this.m_img=new Image,this.m_img.onload=function(e){t.m_loaded=!0,t.buildTex()},this.m_img.addEventListener("error",e=>{t.m_url}),this.m_img.crossOrigin="",this.m_img.src=this.m_url}}buildTex(){let t=this.m_img;if(null!=t&&this.m_loaded){let e=this.texture,s=this.offsetTex,i=this.bytesTex,a=null,l=r.default.IsPowerOf2(t.width)&&r.default.IsPowerOf2(t.height),_=this.powerOf2Fix;if(n.default.IsWebGL1()&&(_=!0),!l&&_){let l=r.default.CalcCeilPowerOfTwo(t.width),_=r.default.CalcCeilPowerOfTwo(t.height);l>n.default.MAX_TEXTURE_SIZE&&(l=n.default.MAX_TEXTURE_SIZE),_>n.default.MAX_TEXTURE_SIZE&&(l=n.default.MAX_TEXTURE_SIZE);let u=h(t,l,_),m=this.m_mipLv;if(null!=e&&(e.setDataFromImage(u.canvas,m),e.name=this.m_img.src,null!=s&&(u=o(t,l,_),s.setDataFromImage(u.canvas,m))),null!=i)if(this.premultipliedAlpha)a=u.ctx2d.getImageData(0,0,u.canvas.width,u.canvas.height),i.setDataFromBytes(a.data,m,u.canvas.width,u.canvas.height),i.name=this.m_img.src;else{a=u.ctx2d.getImageData(0,0,u.canvas.width,u.canvas.height);let e=a.data,s=o(t,l,_);a=s.ctx2d.getImageData(0,0,s.canvas.width,s.canvas.height);let r=a.data,n=0,h=0,d=0;for(;n<_;++n)for(h=0;h<l;++h)e[d]+=255-r[d],e[d+1]+=255-r[d+1],e[d+2]+=255-r[d+2],d+=4;i.setDataFromBytes(e,m,u.canvas.width,u.canvas.height),i.name=this.m_img.src}}else if(null!=e)this.powerOf2Fix,e.setDataFromImage(t,this.m_mipLv),e.name=this.m_img.src;else if(null!=i){let e=r.default.CalcNearestCeilPow2(t.width),s=r.default.CalcNearestCeilPow2(t.height);e>2048&&(e=2048),s>2048&&(e=2048);let n=h(t,e,s),o=this.m_mipLv;a=n.ctx2d.getImageData(0,0,n.canvas.width,n.canvas.height),i.setDataFromBytes(a.data,o,n.canvas.width,n.canvas.height),i.name=this.m_img.src}this.m_loaded=!0}}getURL(){return this.m_url}getImage(){return this.m_img}isLoaded(){return this.m_loaded}destroy(){this.m_loaded=!1,this.m_url="",this.texture=null,this.m_img.src="",this.m_img=null}}class _{constructor(t){this.m_urls=null,this.m_imgs=[],this.m_loadedTotal=0,this.m_loaded=!1,this.m_texList=[],this.m_mLvList=[],this.m_urls=t;var e=this;let s=0,i=null;for(;s<6;++s)i=new Image,i.onload=function(t){if(e.m_loadedTotal++,e.m_loadedTotal>=6){let t=0;for(t=0;t<6;++t)e.m_texList[0].setDataFromImageToFaceAt(t,e.m_imgs[t],e.m_mLvList[0]);e.m_texList[0].name=e.m_imgs.src}},i.crossOrigin="",i.src=e.m_urls[s],e.m_imgs.push(i)}addTex(t,e){this.m_texList.push(t),this.m_mLvList.push(e)}getURLAt(t){return this.m_urls[0]}getTexAt(t){return this.m_texList[t]}isLoaded(){return this.m_loaded}destroy(){}}class u{constructor(t){this.m_cubeDict=new Map,this.m_resMap=new Map,this.m_loadedList=[],this.m_waitLoadList=[],this.m_loadingList=[],this.m_loadingQueueMaxLength=5,this.m_loadDelay=17,this.m_loadDelayTime=17,this.m_testDelay=512,this.m_testDelayTime=512,this.m_texBlock=null,this.m_runFlag=0,this.m_texBlock=t,null!=t&&t.addTexLoader(this)}getTexByUrl(t,e=!0,s=!0,i=!1){let r=this.getImageTexByUrl(t,0,!1,i);return r.mipmapEnabled=s,e&&r.setWrap(a.TextureConst.WRAP_REPEAT),r}getBytesNoPremultipliedAlphaTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.m_resMap.get(t);if(null==s){s=new l(t,e),s.premultipliedAlpha=!1,this.m_resMap.set(t,s);let i=this.m_texBlock.createBytesTex(1,1);return i.name=t,s.bytesTex=i,this.m_waitLoadList.push(s),i}return s.bytesTex.isDestroyed()&&(s.bytesTex=this.m_texBlock.createBytesTex(1,1)),s.bytesTex}getBytesTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.m_resMap.get(t);if(null==s){s=new l(t,e),this.m_resMap.set(t,s);let i=this.m_texBlock.createBytesTex(1,1);return i.name=t,s.bytesTex=i,this.m_waitLoadList.push(s),i}return s.bytesTex.isDestroyed()&&(s.bytesTex=this.m_texBlock.createBytesTex(1,1)),s.bytesTex}getImageOffsetTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.m_resMap.get(t);return null!=s?s.offsetTex:null}getImageTexByUrl(t,e=0,s=!1,i=!1){if(""==t)return null;e<0&&(e=0);let r=this.m_resMap.get(t);if(null==r){r=new l(t,e),r.powerOf2Fix=i,s&&(r.offsetTex=this.m_texBlock.createImageTex2D(1,1)),this.m_resMap.set(t,r);let a=this.m_texBlock.createImageTex2D(1,1);return a.name=t,r.texture=a,this.m_waitLoadList.push(r),a}return r.texture.isDestroyed()&&(r.texture=this.m_texBlock.createImageTex2D(1,1)),r.texture}getCubeTexAndLoadImg(t,e,s=0){if(""==t||null==e||e.length<6)return null;s<0&&(s=0);let i=this.m_cubeDict.get(t);if(null==i){i=new _(e),this.m_cubeDict.set(t,i);let r=this.m_texBlock.createImageCubeTex(8,8);return i.addTex(r,s),r}return i.getTexAt(0)}setRunFlag(t){this.m_runFlag=t}getRunFlag(){return this.m_runFlag}isRunning(){return!0}isStopped(){return!1}run(){let t=0,e=null;if(--this.m_loadDelay,this.m_loadDelay<1){this.m_loadDelay=this.m_loadDelayTime;let s=this.m_loadingList.length;if(s>0)for(;t<s;++t)this.m_loadingList[t].isLoaded()&&(this.m_loadedList.push(this.m_loadingList[t]),this.m_loadingList.splice(t,1),--t,--s);let i=this.m_waitLoadList.length;if(i>0&&s<this.m_loadingQueueMaxLength)for(t=s;t<this.m_loadingQueueMaxLength;++t){if(!(this.m_waitLoadList.length>0))break;e=this.m_waitLoadList.pop(),this.m_loadingList.push(e),e.startLoad()}}if(--this.m_testDelay,this.m_testDelay<1){this.m_testDelay=this.m_testDelayTime;let s=null,i=this.m_loadedList.length;for(t=0;t<i;++t)e=this.m_loadedList[t],s=null!=e.texture?e.texture:e.bytesTex,s.isDestroyed()&&(this.m_resMap.delete(e.getURL()),this.m_loadedList.splice(t,1),e.destroy(),--t,--i)}}}e.default=u},f63e:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("b3bd")),a=i(s("0fc4"));class n extends a.default{constructor(){super(),this.m_colorArray=new Float32Array([1,1,1,1]),this.vtxColorEnabled=!1,this.premultiplyAlpha=!1}getCodeBuf(){let t=super.getCodeBuf();return t.vtxColorEnabled=this.vtxColorEnabled,t.premultiplyAlpha=this.premultiplyAlpha,t}setRGB3f(t,e,s){this.m_colorArray[0]=t,this.m_colorArray[1]=e,this.m_colorArray[2]=s}getRGB3f(t){let e=this.m_colorArray;t.setRGB3f(e[0],e[1],e[2])}setRGBA4f(t,e,s,i){this.m_colorArray[0]=t,this.m_colorArray[1]=e,this.m_colorArray[2]=s,this.m_colorArray[3]=i}getRGBA4f(t){let e=this.m_colorArray;t.setRGBA4f(e[0],e[1],e[2],e[3])}setAlpha(t){this.m_colorArray[3]=t}createSelfUniformData(){let t=new r.default;return t.uniformNameList=["u_color"],t.dataList=[this.m_colorArray],t}}e.default=n},f928:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("df25"));class n extends a.default{constructor(t,e,s=!1){super(t,e,s),this.m_type=r.TextureProxyType.Float,this.minFilter=r.TextureConst.LINEAR,this.internalFormat=r.TextureFormat.RGBA16F,this.dataType=r.TextureDataType.FLOAT,this.unpackAlignment=4}toAlphaFormat(){this.srcFormat=r.TextureFormat.ALPHA,this.internalFormat=r.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=r.TextureFormat.RED,this.internalFormat=r.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB16F,this.unpackAlignment=1}toRGBAFormat(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4}toRGBAFloatFormat(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA16F,this.unpackAlignment=4}setDataFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,n=!1){super.setDataFromBytes(t,e,s,i,r,a,n)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[FloatTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},fa60:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("919c"));class a extends r.default{constructor(){super(),this.vao=null,this.m_uid=a.s_uid++}run(){this.m_rc.testVROUid(this.m_uid)&&(this.m_rc.bindVertexArray(this.vao),this.m_rc.testRIOUid(this.m_vtxUid)&&this.m_rc.bindEleBuf(this.ibuf))}__$destroy(){r.default.s_midMap.delete(this.m_mid),this.m_mid=0,this.m_vtxUid=-1,this.ibuf=null,this.vao=null,this.m_rc=null}restoreThis(){null!=this.vao&&this.m_rc.deleteVertexArray(this.vao),a.Restore(this)}toString(){return"VaoVertexRenderObj(uid = "+this.m_uid+", type="+this.m_mid+")"}static HasMid(t){return r.default.s_midMap.has(t)}static GetByMid(t){return r.default.s_midMap.get(t)}static GetFreeId(){return a.s_freeIdList.length>0?a.s_freeIdList.pop():-1}static Create(t,e,s){let i=null,n=a.GetFreeId();return n>=0?(i=a.s_unitList[n],a.s_unitFlagList[n]=a.S_FLAG_BUSY,i.setMidAndBufUid(e,s)):(i=new a,i.setMidAndBufUid(e,s),a.s_unitList.push(i),a.s_unitFlagList.push(a.S_FLAG_BUSY),a.s_unitListLen++),i.setRC(t),r.default.s_midMap.set(e,i),i}static Restore(t){if(null!=t&&t.m_attachCount<1&&a.s_unitFlagList[t.getUid()]==a.S_FLAG_BUSY){let e=t.getUid();a.s_freeIdList.push(e),a.s_unitFlagList[e]=a.S_FLAG_FREE,t.__$destroy()}}}a.s_uid=0,a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.s_unitFlagList=[],a.s_unitListLen=0,a.s_unitList=[],a.s_freeIdList=[],e.default=a},faa5:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("250c"));class a{constructor(){this.m_coder=null,this.m_texList=null,this.m_texEnabled=!0,this.pipeline=null,this.vtxColorEnabled=!1,this.premultiplyAlpha=!1,this.adaptationShaderVersion=!0}reset(){this.m_coder=a.s_coder,this.m_coder.reset()}clear(){this.m_coder=null}getShaderCodeBuilder(){return a.s_coder}static GetPreCompileInfo(){return a.s_coder.getPreCompileInfo()}initialize(t){null!=a.___s_csBuf&&a.___s_csBuf!=this&&a.___s_csBuf.initialize(t),this.m_texEnabled=t}isTexEanbled(){return this.m_texEnabled}setIRenderTextureList(t){this.m_texList=t}getIRenderTextureList(){return this.m_texList}buildShader(){}buildDefaultCode(){let t=this.m_coder;t.addVertLayout("vec3","a_vs"),t.addFragUniform("vec4","u_color"),t.useVertSpaceMats(!0,!0,!0),this.premultiplyAlpha&&t.addDefine("VOX_PREMULTIPLY_ALPHA","1"),this.m_texEnabled&&(t.addTextureSample2D(),t.addVertLayout("vec2","a_uvs"),t.addVarying("vec2","v_uv")),this.vtxColorEnabled&&(t.addDefine("VOX_USE_VTX_COLOR","1"),t.addVertLayout("vec3","a_cvs"),t.addVarying("vec3","v_cv")),t.addFragOutput("vec4","FragColor0"),t.addFragMainCode("\n    FragColor0 = vec4(1.0);\n    #ifdef VOX_USE_2D_MAP\n        //  FragColor0 *= VOX_Texture2D(u_sampler0, vec2(v_uv[0],v_uv[1]));\n        FragColor0 *= VOX_Texture2D(u_sampler0, v_uv.xy);\n    #endif\n    #ifdef VOX_USE_VTX_COLOR\n        FragColor0 *= vec4(v_cv.xyz,1.0);\n    #endif\n    #ifdef VOX_PREMULTIPLY_ALPHA\n        FragColor0.rgb *= u_color.xyz;\n        FragColor0.a *= u_color.w;\n        FragColor0.rgb *= u_color.aaa;\n    #else\n        FragColor0 *= u_color;\n    #endif\n"),t.addVertMainCode("\n    vec4 localPosition = vec4(a_vs.xyz,1.0);\n    vec4 wpos = u_objMat * localPosition;\n    gl_Position = u_projMat * u_viewMat * wpos;\n\n    #ifdef VOX_USE_2D_MAP\n        v_uv = a_uvs.xy;\n    #endif\n    #ifdef VOX_USE_VTX_COLOR\n        v_cv = a_cvs.xyz;\n    #endif\n"),this.pipeline}getFragShaderCode(){return a.___s_csBuf!=this?a.___s_csBuf.getFragShaderCode():(this.buildDefaultCode(),this.m_coder.buildFragCode())}getVtxShaderCode(){return a.___s_csBuf!=this?a.___s_csBuf.getVtxShaderCode():this.m_coder.buildVertCode()}getUniqueShaderName(){if(a.___s_csBuf!=this)return a.___s_csBuf.getUniqueShaderName();let t="vox_default_shd";return this.m_texEnabled&&(t+="_tex"),this.vtxColorEnabled&&(t+="_vtxColor"),this.premultiplyAlpha&&(t+="_preMulAlpha"),t}toString(){return"[ShaderCodeBuffer()]"}static UseShaderBuffer(t){null!=a.___s_csBuf&&a.___s_csBuf.clear(),a.___s_csBuf=t}}a.___s_csBuf=null,a.s_coder=new r.default,e.default=a},fae3:function(t,e,s){"use strict";s.r(e);s("1eb2");var i=s("b88e");for(var r in i)["default"].indexOf(r)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(r)},fc07:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("2e8a")),n=i(s("78e9"));class h{constructor(){this.m_useTex=!1,this.m_texNSMap=new Map,this.m_attriNSList=null,this.m_attriSizeList=null,this.uniformNameListStr="",this.texUniformNameListStr="",this.attributes=[null,null,null,null,null,null,null,null,null,null,null,null],this.m_uniforms=null,this.texTotal=0,this.fragOutputTotal=0}reset(){this.m_useTex=!1,this.m_attriNSList=null,this.uniformNameListStr="",this.texUniformNameListStr="";let t=0;for(;t<12;++t)this.attributes[t]=null;this.m_uniforms=null,this.m_texNSMap.clear(),this.texTotal=0}parseVShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let s="\n",i=t.indexOf(s),r=0,h=[],o="",l="",_=new RegExp(" ","g");while(i>=0)o=t.slice(r,i),o.length>0&&(l=o.replace(_,""),0!=l.indexOf("//")&&h.push(o)),r=i+1,i=t.indexOf(s,r);o=t.slice(r,t.length),o.length>0&&(l=o.replace(_,""),0!=l.indexOf("//")&&h.push(o));let u="uniform ",m=h.length,d=null;for(i=0;i<12;++i)this.attributes[i]=null;this.m_attriNSList=[],this.m_attriSizeList=[];let c=null;null==this.m_uniforms&&(this.m_uniforms=[]),i=0;let f=!1,p=!1;while(i<m)o=h[i],f=o.indexOf("layout")>=0,p=o.indexOf("attribute ")>=0,f&&o.indexOf("location")>0||p?(d=new a.default,d.layoutEnabled=f,d.parseCode(o),this.attributes[d.attriType]=d,this.m_attriNSList.push(d.name),this.m_attriSizeList.push(d.typeSize)):o.indexOf(u)>=0&&(c=new n.default,c.parseCode(o)&&(this.m_uniforms.push(c),this.uniformNameListStr+=c.name+",",c.isTex&&!this.m_texNSMap.has(c.name)&&(this.m_texNSMap.set(c.name,1),this.texUniformNameListStr+=c.name+",",this.texTotal++))),++i}parseFShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let s="\n",i=t.indexOf(s),a=0,h=[],o="",l="",_=new RegExp(" ","g");while(i>=0)o=t.slice(a,i),o.length>0&&(l=o.replace(_,""),0!=l.indexOf("//")&&h.push(o)),a=i+1,i=t.indexOf(s,a);o=t.slice(a,t.length),o.length>0&&(l=l.replace(_,""),0!=l.indexOf("//")&&h.push(o));let u="uniform ",m=h.length,d=null;null==this.m_uniforms&&(this.m_uniforms=[]),i=0;while(i<m)o=h[i],o.indexOf(u)>=0&&this.uniformNameListStr.indexOf(u)<0&&(d=new n.default,d.parseCode(o)&&(this.m_uniforms.push(d),this.uniformNameListStr+=d.name+",",d.isTex&&!this.m_texNSMap.has(d.name)&&(this.m_texNSMap.set(d.name,1),this.texUniformNameListStr+=d.name+",",this.texTotal++))),++i;let c="layout";r.default.IsWebGL1()&&(c="gl_FragData"),i=t.indexOf(c),this.fragOutputTotal=0;while(i>0)this.fragOutputTotal++,i=t.indexOf(c,i+2);this.fragOutputTotal<1&&(this.fragOutputTotal=1)}}e.default=h},fe7f:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("df25"));class n extends a.default{constructor(t,e,s=!1){super(t,e,s),this.m_type=r.TextureProxyType.Bytes}toAlphaFormat(){this.srcFormat=r.TextureFormat.ALPHA,this.internalFormat=r.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=r.TextureFormat.RED,this.internalFormat=r.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB,this.unpackAlignment=3}toRGBAFormat(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4}setDataFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,n=!1){super.setDataFromBytes(t,e,s,i,r,a,n)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[BytesTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},fecb:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17"));class n{constructor(){this.min=new a.default(r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE),this.max=new a.default(r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE),this.version=-1,this.radius=50,this.radius2=2500,this.center=new a.default(0,0,0),this.m_long=100,this.m_width=100,this.m_height=100,this.m_halfLong=50,this.m_halfWidth=50,this.m_halfHeight=50,this.m_tempV=new a.default}getLong(){return this.m_long}getWidth(){return this.m_width}getHeight(){return this.m_height}reset(){this.min.setXYZ(r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE),this.max.setXYZ(r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE)}equals(t){return this.min.equalsXYZ(t.min)&&this.max.equalsXYZ(t.max)}setVolume(t,e,s){this.m_width=t,this.m_height=e,this.m_long=s,this.m_halfLong=.5*this.m_long,this.m_halfWidth=.5*this.m_width,this.m_halfHeight=.5*this.m_height,this.max.x=this.center.x+this.m_halfWidth,this.max.y=this.center.y+this.m_halfHeight,this.max.z=this.center.z+this.m_halfLong,this.min.x=this.center.x-this.m_halfWidth,this.min.y=this.center.y-this.m_halfHeight,this.min.z=this.center.z-this.m_halfLong,this.radius2=this.m_halfWidth*this.m_halfWidth+this.m_halfHeight*this.m_halfHeight+this.m_halfLong*this.m_halfLong,this.radius=Math.sqrt(this.radius2)}union(t){this.addPosition(t.min),this.addPosition(t.max)}addPosition(t){this.min.x>t.x&&(this.min.x=t.x),this.min.y>t.y&&(this.min.y=t.y),this.min.z>t.z&&(this.min.z=t.z),this.max.x<t.x&&(this.max.x=t.x),this.max.y<t.y&&(this.max.y=t.y),this.max.z<t.z&&(this.max.z=t.z)}addXYZ(t,e,s){this.min.x>t&&(this.min.x=t),this.min.y>e&&(this.min.y=e),this.min.z>s&&(this.min.z=s),this.max.x<t&&(this.max.x=t),this.max.y<e&&(this.max.y=e),this.max.z<s&&(this.max.z=s)}addXYZFloat32Arr(t){let e=t.length,s=0,i=0,r=0;for(let a=0;a<e;)s=t[a],++a,i=t[a],++a,r=t[a],++a,this.min.x>s&&(this.min.x=s),this.min.y>i&&(this.min.y=i),this.min.z>r&&(this.min.z=r),this.max.x<s&&(this.max.x=s),this.max.y<i&&(this.max.y=i),this.max.z<r&&(this.max.z=r)}containsV(t){return!(t.x<this.max.x||t.x>this.max.x)&&(!(t.y<this.max.y||t.y>this.max.y)&&!(t.z<this.max.z||t.z>this.max.z))}containsXY(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.y||e>this.max.y)}containsXZ(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.z||e>this.max.z)}containsYZ(t,e){return!(t<this.min.y||t>this.max.y)&&!(e<this.min.z||e>this.max.z)}update(){this.m_width=this.max.x,this.min.x>this.max.x&&(this.max.x=this.min.x,this.min.x=this.m_width),this.m_width=this.max.x-this.min.x,this.m_height=this.max.y,this.min.y>this.max.y&&(this.max.y=this.min.y,this.min.y=this.m_height),this.m_height=this.max.y-this.min.y,this.m_long=this.max.z,this.min.z>this.max.z&&(this.max.z=this.min.z,this.min.z=this.m_long),this.m_long=this.max.z-this.min.z,this.center.x=.5*this.m_width,this.center.y=.5*this.m_height,this.center.z=.5*this.m_long,this.m_halfLong=this.center.z,this.m_halfWidth=this.center.x,this.m_halfHeight=this.center.y,this.radius2=this.m_halfWidth*this.m_halfWidth+this.m_halfHeight*this.m_halfHeight+this.m_halfLong*this.m_halfLong,this.radius=Math.sqrt(this.radius2),this.center.x+=this.min.x,this.center.y+=this.min.y,this.center.z+=this.min.z,++this.version}updateVolume(){this.m_width=this.max.x-this.min.x,this.m_height=this.max.y-this.min.y,this.m_long=this.max.z-this.min.z,this.m_halfLong=.5*this.m_long,this.m_halfWidth=.5*this.m_width,this.m_halfHeight=.5*this.m_height}copyFrom(t){this.radius=t.radius,this.radius2=t.radius2,this.min.copyFrom(t.min),this.max.copyFrom(t.max),this.center.copyFrom(t.center),this.updateVolume()}updateFast(){this.m_width=this.max.x-this.min.x,this.m_height=this.max.y-this.min.y,this.m_long=this.max.z-this.min.z,this.center.x=.5*this.m_width,this.center.y=.5*this.m_height,this.center.z=.5*this.m_long,this.m_halfLong=this.center.z,this.m_halfWidth=this.center.x,this.m_halfHeight=this.center.y,this.radius2=this.m_halfWidth*this.m_halfWidth+this.m_halfHeight*this.m_halfHeight+this.m_halfLong*this.m_halfLong,this.radius=Math.sqrt(this.radius2),this.center.x+=this.min.x,this.center.y+=this.min.y,this.center.z+=this.min.z,++this.version}toString(){return"[AABB(min->"+this.min+",size("+this.m_width+","+this.m_height+","+this.m_long+"))]"}sphereIntersect(t,e){this.m_tempV.x=this.center.x-t.x,this.m_tempV.y=this.center.y-t.y,this.m_tempV.z=this.center.z-t.z;let s=this.m_tempV.getLengthSquared();return s<this.radius2||(e+=this.radius,e*=e,e>=s)}intersectRL(t,e){let s=0,i=(this.min.x-e.x)/t.x,r=(this.max.x-e.x)/t.x;i>r&&(s=r,r=i,i=s);let a=(this.min.y-e.y)/t.y,n=(this.max.y-e.y)/t.y;if(a>n&&(s=n,n=a,a=s),i>n||a>r)return!1;a>i&&(i=a),n<r&&(r=n);let h=(this.min.z-e.z)/t.z,o=(this.max.z-e.z)/t.z;return h>o&&(s=o,o=h,h=s),!(i>o||h>r)&&(h>i&&(i=h),o<r&&(r=o),!0)}static IntersectionRL3(t,e,s,i,r,a){return s.w=(t[e[0]].x-r.x)*s.x,i.w=(t[1-e[0]].x-r.x)*s.x,a.x=(t[e[1]].y-r.y)*s.y,a.y=(t[1-e[1]].y-r.y)*s.y,!(s.w>a.y||a.x>i.w)&&(a.x>s.w&&(s.w=a.x),a.y<i.w&&(i.w=a.y),a.x=(t[e[2]].z-r.z)*s.z,a.y=(t[1-e[2]].z-r.z)*s.z,!(s.w>a.y||a.x>i.w)&&(a.x>s.w&&(s.w=a.x),a.y<i.w&&(i.w=a.y),a.copyFrom(i),a.scaleBy(s.w),a.addBy(r),i.w=1,!0))}static IntersectionRL1(t,e,s,i){let r=0,a=(s.min.x-e.x)/t.x,n=(s.max.x-e.x)/t.x;a>n&&(r=n,n=a,a=r);let h=(s.min.y-e.y)/t.y,o=(s.max.y-e.y)/t.y;if(h>o&&(r=o,o=h,h=r),a>o||h>n)return!1;h>a&&(a=h),o<n&&(n=o);let l=(s.min.z-e.z)/t.z,_=(s.max.z-e.z)/t.z;return l>_&&(r=_,_=l,l=r),!(a>_||l>n)&&(l>a&&(a=l),_<n&&(n=_),i.copyFrom(t),i.scaleBy(a),i.addBy(e),!0)}static IntersectionRL2(t,e,s,i){i.x=s.center.x-e.x,i.y=s.center.y-e.y,i.z=s.center.z-e.z;let r=i.dot(t);if(i.x-=r*t.x,i.y-=r*t.y,i.z-=r*t.z,i.getLengthSquared()>s.radius2)return!1;if(s.containsV(e))return i.copyFrom(e),!0;if(e.x<s.min.x){if(t.x>0&&(r=(s.min.x-e.x)/t.x,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsYZ(i.y,i.z)))return!0}else if(e.x>s.max.x&&t.x<0&&(r=(s.max.x-e.x)/t.x,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsYZ(i.y,i.z)))return!0;if(e.y<s.min.y){if(t.y>0&&(r=(s.min.y-e.y)/t.y,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXZ(i.x,i.z)))return!0}else if(e.y>s.max.y&&t.y<0&&(r=s.max.y,r=(s.max.y-e.y)/t.y,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXZ(i.x,i.z)))return!0;if(e.z<s.min.z){if(t.z>0&&(r=(s.min.z-e.z)/t.z,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXY(i.x,i.y)))return!0}else if(e.z>s.max.z&&t.z<0&&(r=(s.max.z-e.z)/t.z,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXY(i.x,i.y)))return!0;return!1}}n.___pnV=new a.default,e.default=n}})}));