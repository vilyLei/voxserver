(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["CoSpace"]=e():t["CoSpace"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="fae3")}({1389:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_tipEntity=null}initialize(t,e=2){if(null==this.m_tipEntity){this.m_uiscene=t;let i=CoUI.createRectTextTip();i.initialize(t,e),this.m_tipEntity=i}}getTipEntity(t){return this.m_tipEntity}addTipsTarget(t,e){this.m_tipEntity.addEntity(t)}removeTipsTarget(t,e){this.m_tipEntity.removeEntity(t)}destroy(){}}e.TipsSystem=s},"1dd7":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("b0fb");class n extends s.UIEntityBase{constructor(){super(),this.m_pw=10,this.m_ph=10,this.m_sx=1,this.m_sy=1,this.m_material=null,this.m_tex=null,this.m_fontSize=24,this.m_text=""}initialize(t,e,i=24){if(""!=t&&this.isIniting()){i<12&&(i=12),this.init(),this.m_text=t,this.m_uiScene=e;let s=CoEntity.createDisplayEntity();this.m_fontColor=CoMaterial.createColor4(),this.m_bgColor=CoMaterial.createColor4(1,1,1,0);let n=this.m_uiScene.texAtlas.createCharsImage(this.m_text,this.m_fontSize,this.m_fontColor,this.m_bgColor);this.m_tex=e.rscene.textureBlock.createImageTex2D(n.width,n.height),this.m_tex.setDataFromImage(n),this.m_tex.flipY=!0,this.m_tex.premultiplyAlpha=!0,this.m_tex.minFilter=CoRScene.TextureConst.LINEAR,this.m_tex.magFilter=CoRScene.TextureConst.NEAREST;let l=this.createMaterial(this.m_tex);l.setColor(this.m_fontColor),CoMesh.plane.setBufSortFormat(l.getBufSortFormat());let a=CoMesh.plane.createXOY(0,0,1,1);this.m_pw=n.width,this.m_ph=n.height,s.setMaterial(l),s.setMesh(a),this.m_entities.push(s),this.applyRST(s),super.setScaleXY(this.m_sx*this.m_pw,this.m_sy*this.m_ph),this.update()}}setScaleXY(t,e){this.m_sx=t,this.m_sy=e,super.setScaleXY(t*this.m_pw,e*this.m_ph)}setScaleX(t){this.m_sx=t,super.setScaleX(t*this.m_pw)}setScaleY(t){this.m_sy=t,super.setScaleX(t*this.m_ph)}getScaleX(){return this.m_sx}getScaleY(){return this.m_sy}setText(t){if(null!=this.m_tex&&""!=t&&this.m_text!=t){this.m_text=t;let e=this.m_uiScene.texAtlas.createCharsImage(t,this.m_fontSize,this.m_fontColor,this.m_bgColor);this.m_tex.setDataFromImage(e,0,0,0,!0),this.m_tex.updateDataToGpu(),this.m_pw=e.width,this.m_ph=e.height,super.setScaleXY(this.m_sx*this.m_pw,this.m_sy*this.m_ph),this.update()}}getText(){return this.m_text}setColor(t){return this.m_fontColor.copyFrom(t),null!=this.m_material&&this.m_material.setColor(t),this}getColor(){return this.m_fontColor}destroy(){super.destroy(),this.m_material=null,this.m_uiScene=null,this.m_tex=null}}e.TextLabel=n},"1eb2":function(t,e,i){"use strict";if("undefined"!==typeof window){var s=window.document.currentScript,n=i("8875");s=n(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:n});var l=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);l&&(i.p=l[1])}},2564:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e=null,i=null){this.m_uid=s.s_uid++,this.m_urlChecker=null,this.m_oneTimes=!0,this.m_loaderMap=null,this.m_callback=e,this.m_times=t,this.m_urlChecker=i}setUrlChecker(t=null){this.m_urlChecker=t}getUrlChecker(){return this.m_urlChecker}getUid(){return this.m_uid}setCallback(t){return this.m_callback=t,this}addLoader(t){if(null!=t&&t!=this)if(this.isFinished())t.use();else{null==this.m_loaderMap&&(this.m_loaderMap=new Map);let e=this.m_loaderMap;e.has(t.getUid())||e.set(t.getUid(),t)}return this}isFinished(){return 0==this.m_times}useOnce(){this.m_oneTimes&&(this.m_oneTimes=!1,this.use())}use(){if(this.m_times>0&&(this.m_times--,this.isFinished()&&null!=this.m_callback&&(this.m_callback(),this.m_callback=null,null!=this.m_loaderMap))){for(let[t,e]of this.m_loaderMap)e.use();this.m_loaderMap=null}}hasModuleByUrl(t){return s.loadedMap.has(t)}load(t){if(""==t)return this;null!=this.m_urlChecker&&(t=this.m_urlChecker(t));let e=s.loadedMap;if(e.has(t))return void this.use();let i=s.loadingMap;if(!i.has(t))return i.set(t,[this]),this.loadData(t),this;{let e=i.get(t);for(let t=0;t<e.length;++t)if(e[t]==this)return;e.push(this)}}loadData(t){let e=new XMLHttpRequest;e.open("GET",t,!0),e.onerror=function(t){},e.onload=e=>{this.loadedUrl(t)},e.send(null)}loadedData(t,e){}loadedUrl(t){let e=s.loadedMap,i=s.loadingMap;e.set(t,1);let n=i.get(t);for(let s=0;s<n.length;++s)n[s].use();i.delete(t)}getDataByUrl(t){return null}clearAllData(){}destroy(){this.m_urlChecker=null}}s.s_uid=0,s.loadedMap=new Map,s.loadingMap=new Map,e.PackedLoader=s},"259d":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_entities=null,this.m_rect=CoMath.createAABB2D()}query(t,e){if(this.m_entities=[],e>0){let i=this.m_entities;const s=this.m_rect;let n=CoMath.createVec3(),l=this.m_rscene.getCamera(),a=this.m_rscene.getStage3D();for(let r=0;r<e;++r)if(t[r].mouseEnabled){let e=t[r].getGlobalBounds();n.copyFrom(e.center),l.worldPosToScreen(n),n.x+=a.stageHalfWidth,n.y+=a.stageHalfHeight,s.containsXY(n.x,n.y)&&i.push(t[r])}}}initialize(t){null==this.m_rscene&&(this.m_rscene=t)}getEntities(t,e){const i=this.m_rect;if(i.setTo(t.x,t.y,e.x-t.x,e.y-t.y),i.width*i.height>0){let t=this.m_rscene;return t.getSpace().renderingEntitySet.query(this),this.m_entities}return null}}e.NVRectFrameQuery=s},"268d":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.EDIT_BEGIN=20001,s.EDIT_END=20002,e.UserEditEvent=s},2870:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("3914"),n=i("bb62"),l=i("eb56");class a{static crateCurrTextBtn(t,e,i,a,r,o){if(null!==r.text&&""!=r.text&&null!=o){let h=new n.ClipColorLabel;h.initializeWithoutTex(t,e,4),h.setColors(o);let m=new s.ClipLabel;m.depthTest=!0,m.transparent=!0,m.premultiplyAlpha=!0,m.initialize(a,[r.text]),m.setColor(r.textColor);let c=new l.Button;return c.uuid=i,c.addLabel(m),c.initializeWithLable(h),c}return null}static createTextButton(t,e,i,s,n,l){let r=n,o=s.createCharsCanvasFixSize(t,e,r.text,r.fontSize,CoMaterial.createColor4(),CoMaterial.createColor4(1,1,1,0));return s.addImageToAtlas(r.text,o),a.crateCurrTextBtn(t,e,i,s,n,l)}}e.ButtonBuilder=a},"2a2b":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("75f5");class n extends s.ModuleLoader{constructor(t,e=null){super(t,e,null);let i=t=>{if(t.indexOf(".artvily.")>0)return t;let e=window.location.href;if(t=t.trim(),e.indexOf(".artvily.")>0){let i=t.lastIndexOf("/"),s=t.indexOf(".",i);e="http://www.artvily.com:9090/";let n=t.slice(i,s).toLocaleLowerCase(),l=e+t.slice(0,i)+n+".js";return l}return t};this.setUrlChecker(i)}}e.CoModuleLoader=n},3120:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_rsc=null,this.m_editUIRenderer=null,this.m_uirsc=null,this.m_coUIScene=null,this.m_navBtns=[],this.m_bgLabel=null}initialize(t,e,i){null==this.m_coUIScene&&(this.m_rsc=t,this.m_editUIRenderer=e,this.m_coUIScene=i,this.init())}init(){this.m_editUIRenderer;this.initUI()}initUI(){this.m_uirsc=this.m_coUIScene.rscene,this.initNavigationUI()}resize(t){let e=this.m_coUIScene.getStage();this.m_bgLabel.setScaleX(e.stageWidth/this.m_bgLabelW),this.m_bgLabel.setY(e.stageHeight-this.m_bgLabelH),this.m_bgLabel.update()}initNavigationUI(){let t=this.m_coUIScene,e=t.transparentTexAtlas,i=0,s=0,n=90,l=40,a=this.m_coUIScene.getStage();this.m_bgLabelW=a.stageWidth,this.m_bgLabelH=l;let r=CoUI.createColorLabel();r.initialize(this.m_bgLabelW,this.m_bgLabelH),r.setY(a.stageHeight-l),r.setColor(r.getColor().setRGB3Bytes(40,40,40)),t.addEntity(r),this.m_bgLabel=r;let o=CoRScene.EventBase;t.getStage().addEventListener(o.RESIZE,this,this.resize);let h=["file","edit","model","normal","texture","material","light","animation","particle","rendering","physics","help"],m=["文件","编辑","模型","法线","纹理","材质","灯光","动画","粒子","渲染","物理","帮助"],c=["File system operations.","Editing operations.","Geometry model operations.","Normal data operations.","Texture data operations.","Material system operations.","Light system operations.","Animation system operations.","Paiticle system operations.","Rendering system operations.","Physics system operations.","Help infomation."];h=h.slice(0,2),m=m.slice(0,2),c=c.slice(0,2),h.push("help"),m.push("帮助"),c.push("Help infomation");let u=t.layout.createLeftTopLayouter(),d=CoMaterial.createColor4().setRGB3Bytes(170,170,170),_=CoMaterial.createColor4(1,1,1,0);for(let p=0;p<m.length;++p){let t=e.createCharsCanvasFixSize(n,l,m[p],30,d,_);e.addImageToAtlas(m[p],t)}i=0,s=a.stageHeight-l;for(let p=0;p<m.length;++p){let t=this.crateBtn(m,n,l,i+n*p,s,p,h[p],c[p]);this.m_coUIScene.tips.addTipsTarget(t),this.m_navBtns.push(t),u.addUIEntity(t)}this.m_coUIScene.prompt.setPromptListener(()=>{},()=>{})}crateBtn(t,e,i,s,n,l,a,r){let o=CoUI.createClipColorLabel();o.initializeWithoutTex(e,i,4),o.getColorAt(0).setRGB3Bytes(40,40,40),o.getColorAt(1).setRGB3Bytes(50,50,50),o.getColorAt(2).setRGB3Bytes(40,40,60);let h=this.m_coUIScene.transparentTexAtlas,m=CoUI.createClipLabel();m.transparent=!0,m.premultiplyAlpha=!0,m.initialize(h,[t[l]]);let c=CoUI.createButton();return c.uuid=a,c.info=CoUI.createTipInfo().alignBottom().setContent(r),c.addLabel(m),c.initializeWithLable(o),c.setXY(s,n),this.m_coUIScene.addEntity(c,1),c.addEventListener(CoRScene.MouseEvent.MOUSE_UP,this,this.btnMouseUpListener),c}btnMouseUpListener(t){let e=t.uuid;switch(e){case"file":case"edit":case"model":case"normal":case"texture":case"material":case"light":case"animation":case"particle":this.m_coUIScene.prompt.showPrompt("It can't be used now!");break;case"help":this.toHelp();break;default:break}}toHelp(){let t=document.createElement("a");t.href="https://blog.csdn.net/vily_lei/article/details/127544595?spm=1001.2014.3001.5501",t.target="_blank",document.body.appendChild(t),t.style="display: none",t.click(),t.remove()}run(){}}e.NVNavigationUI=s},3347:function(t,e,i){"use strict";var s,n,l;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["ctmParser"]="ctmGeomParser",t["objParser"]="objGeomParser",t["dracoParser"]="dracoGeomParser",t["pngParser"]="pngParser",t["fbxFastParser"]="fbxFastParser",t["threadCore"]="threadCore",t["coSpaceApp"]="coSpaceApp"}(s||(s={})),e.CoModuleNS=s,function(t){t["Undefined"]="undefined-format",t["CTM"]="ctm",t["Draco"]="draco",t["OBJ"]="obj",t["FBX"]="fbx",t["GLB"]="glb",t["Jpg"]="jpg",t["Png"]="png",t["Gif"]="gif"}(n||(n={})),e.CoDataFormat=n,function(t){t["JS"]="js-text",t["Binasy"]="binary"}(l||(l={})),e.CoModuleFileType=l},3914:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("67d8");class n extends s.ClipLabelBase{constructor(){super(),this.m_material=null}createMesh(t,e){let i=4,s=[0,1,2,0,2,3];const n=this.m_total;let l=new Uint16Array(6*n),a=new Float32Array(12*n),r=new Float32Array(8*n);this.m_sizes=new Array(2*n);let o=0;for(let m=0;m<n;++m){const n=t.getTexObjFromAtlas(e[m]);l.set(s,m*s.length),a.set(this.createVS(0,0,n.getWidth(),n.getHeight()),12*m),r.set(n.uvs,8*m);for(let t=0;t<s.length;++t)s[t]+=i;this.m_sizes[o++]=n.getWidth(),this.m_sizes[o++]=n.getHeight()}let h=CoMesh.createRawMesh();return h.reset(),h.setIVS(l),h.addFloat32Data(a,3),h.addFloat32Data(r,2),h.initialize(),h}hasTexture(){return!0}initialize(t,e){if(this.isIniting()&&null!=t&&null!=e&&e.length>0){this.init(),this.m_pos=CoMath.createVec3(),this.m_total=e.length;let i=t.getTexObjFromAtlas(e[0]),s=this.createMesh(t,e);this.m_vtCount=s.vtCount,this.m_material=this.createMaterial(i.texture);let n=CoEntity.createDisplayEntity();n.setMaterial(this.m_material),n.setMesh(s),n.setIvsParam(0,this.m_step),this.m_entities.push(n),this.applyRST(n),this.setClipIndex(0)}}initializeWithLable(t){if(this.isIniting()&&null!=t&&t!=this){if(t.getClipsTotal()<1)throw Error("Error: srcLable.getClipsTotal() < 1");this.init();let e=t.getREntities();for(let i=0;i<e.length;++i){let s=e[i],n=s.getMesh();this.m_pos=CoMath.createVec3();let l=s.getMaterial().getTextureAt(0),a=this.m_total=t.getClipsTotal();this.m_sizes=new Array(2*a);let r=0;for(let e=0;e<a;++e)this.m_sizes[r++]=t.getClipWidthAt(e),this.m_sizes[r++]=t.getClipHeightAt(e);this.m_vtCount=n.vtCount,this.m_material=this.createMaterial(l);let o=CoEntity.createDisplayEntity();o.setMaterial(this.m_material),o.setMesh(n),o.setIvsParam(0,this.m_step),this.m_entities.push(o),this.applyRST(o)}this.setClipIndex(0)}}displaceFromLable(t){if(null!=t&&t!=this&&t.getClipsTotal()<1)throw Error("Error: srcLable.getClipsTotal() < 1")}setColor(t){null!=this.m_material&&this.m_material.setColor(t)}getColor(t){null!=this.m_material&&this.m_material.getColor(t)}setClipIndex(t){if(t>=0&&t<this.m_total){this.m_index=t;let e=this.m_entities;for(let i=0;i<e.length;++i)e[i].setIvsParam(t*this.m_step,this.m_step);t<<=1,this.m_width=this.m_sizes[t],this.m_height=this.m_sizes[t+1]}}}e.ClipLabel=n},"3f49":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("b0fb");class n extends s.UIEntityBase{constructor(){super(),this.m_color=null,this.m_material=null}createMesh(t){let e=new Uint16Array([0,1,2,0,2,3]),i=new Float32Array(this.createVS(0,0,this.m_width,this.m_height)),s=CoMesh.createRawMesh();return s.reset(),s.setBufSortFormat(t.getBufSortFormat()),s.setIVS(e),s.addFloat32Data(i,3),s.initialize(),s}initialize(t,e){if(this.isIniting()){this.init(),this.m_width=t,this.m_height=e;let i=CoMaterial.createDefaultMaterial();i.initializeByCodeBuf(!1),this.m_color=CoMaterial.createColor4();let s=this.createMesh(i),n=CoEntity.createDisplayEntity();n.setMaterial(i),n.setMesh(s),this.applyRST(n),this.m_entities.push(n),this.m_material=i}}setColor(t){return this.m_color.copyFrom(t),null!=this.m_material&&this.m_material.setColor(t),t}getColor(){return this.m_color}destroy(){super.destroy(),this.m_material=null}}e.ColorLabel=n},"3f7d":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("ccfe");class n{constructor(){this.m_promptPanel=null}initialize(t,e=3){if(null==this.m_promptPanel){this.m_uiscene=t;let i=new s.PromptPanel;i.initialize(this.m_uiscene,e,300,200,120,50),i.setZ(3),i.setBGColor(CoMaterial.createColor4(.2,.2,.2)),this.m_promptPanel=i}}setPromptListener(t,e,i=0){null!=this.m_promptPanel&&this.m_promptPanel.setListener(t,e)}showPrompt(t,e=0){null!=this.m_promptPanel&&(this.m_promptPanel.setPrompt(t),this.m_promptPanel.open())}setPromptTextColor(t,e=0){null!=this.m_promptPanel&&this.m_promptPanel.setPromptTextColor(t)}setPromptBGColor(t,e=0){null!=this.m_promptPanel&&this.m_promptPanel.setBGColor(t)}getPromptPanel(t=0){return this.m_promptPanel}}e.PromptSystem=n},"43c4":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("bb26");class n{constructor(){this.m_normalFlip=!1,this.m_showDifference=!1,this.m_normalScale=1,this.m_normalScale0=1,this.m_uid=-1,this.groupUid=-1,this.entity=null,this.m_normalLine=null}setLineVisible(t){t&&this.createNormalLine(),null!=this.m_normalLine&&this.m_normalLine.setVisible(t)}getLineVisible(){return null!=this.m_normalLine&&this.m_normalLine.getVisible()}setVisible(t){this.setLineVisible(t),this.entity.setVisible(t)}getUid(){return this.m_uid}showLocalNormal(){this.m_entityMaterial.applyLocalNormal(),this.m_entityMaterial.applyNormalColor()}showGlobalNormal(){this.m_entityMaterial.applyGlobalNormal(),this.m_entityMaterial.applyNormalColor()}showModelColor(t){t?this.m_entityMaterial.applyModelColor():this.m_entityMaterial.applyNormalColor()}showDifference(t=!0){this.m_showDifference=t,this.m_entityMaterial.applyDifference(t)}isShowDifference(){return this.m_showDifference}setEntityModel(t,e=null){if(null!=this.entity)return this.entity;let i=n.s_entityBuilder,s=i.createNormalEntity(t,e);return this.m_entityMaterial=i.getEntityMaterial(),this.rsc.addEntity(s),this.readyCreateNormalLine(t),this.entity=s,this.m_uid=this.entity.getUid(),this.applyEvt(this.entity),this.entity}select(){this.m_normalScale0=this.m_normalScale}applyNormalLineScale(t){t*=this.m_normalScale0,this.m_normalScale=t,null!=this.m_normalMaterial&&this.m_normalMaterial.setLength(t)}flipNormal(t){this.m_normalFlip=t;let e=t?-1:1;null!=this.m_normalMaterial&&this.m_normalMaterial.setScale(e),this.m_entityMaterial.setNormalScale(e)}isNormalFlipping(){return this.m_normalFlip}setNormalLineColor(t){null!=this.m_normalMaterial&&this.m_normalMaterial.setColor(t)}readyCreateNormalLine(t){this.m_model=t}createNormalLine(t=5){if(null==this.m_normalLine){let e=this.m_model,i=n.s_entityBuilder;this.m_normalLine=i.createNormalLineEntity(this.entity,e.vertices,e.normals,t),this.m_normalMaterial=i.getNormalLineMaterial(),this.m_normalScale=i.getNormalLineScale(),null!=this.m_normalLine.getMesh()&&this.rsc.addEntity(this.m_normalLine)}}applyEvt(t){let e=CoRScene.MouseEvent;t.addEventListener(e.MOUSE_OVER,this,this.mouseOverTargetListener),t.addEventListener(e.MOUSE_OUT,this,this.mouseOutTargetListener),t.addEventListener(e.MOUSE_DOWN,this,this.mouseDownTargetListener)}mouseOverTargetListener(t){this.m_entityMaterial.setRGB3f(.8,.8,.8)}mouseOutTargetListener(t){this.m_entityMaterial.setRGB3f(.7,.7,.7)}mouseDownTargetListener(t){let e=t.target;this.transUI.selectEntities([e])}setPosition(t){null!=this.entity&&this.entity.setPosition(t)}getPosition(t){return null!=this.entity?this.entity.getPosition(t):t}update(){null!=this.entity&&this.entity.update()}destroy(){this.rsc=null,null!=this.entity&&(this.rsc.removeEntity(this.entity),this.rsc.removeEntity(this.m_normalLine),this.entity.destroy(),this.m_normalLine.destroy(),this.entity=null,this.m_normalLine=null)}}n.s_entityBuilder=new s.NormalEntityBuilder,e.NormalEntityNode=n},4709:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_entity=null,this.m_pz=0,this.m_flag=!1,this.m_prePos=CoMath.createVec3(),this.m_currPos=CoMath.createVec3(),this.m_enabled=!1,this.bounds=CoMath.createAABB()}initialize(t){if(null==this.m_entity){this.m_rscene=t,this.m_entity=CoEntity.createDisplayEntity(),CoMesh.line.dynColorEnabled=!0;let e=CoMaterial.createLineMaterial(CoMesh.line.dynColorEnabled);CoMesh.line.setBufSortFormat(e.getBufSortFormat());let i=CoMesh.line.createRectXOY(0,0,1,1);this.m_entity.setMaterial(e),this.m_entity.setMesh(i),t.addEntity(this.m_entity),this.disable()}}enable(){this.m_enabled=!0}disable(){this.m_enabled=!1,this.setVisible(!1)}isEnabled(){return this.m_enabled}isSelectEnabled(){return this.m_flag&&this.m_enabled&&CoMath.Vector3D.Distance(this.m_prePos,this.m_currPos)>.98}setVisible(t){null!=this.m_entity&&this.m_entity.setVisible(t)}isVisible(){return null!=this.m_entity&&this.m_entity.getVisible()}setZ(t){this.m_pz=t}begin(t,e){this.m_flag=!0,this.m_enabled&&(this.m_prePos.setXYZ(t,e,this.m_pz),this.move(t,e))}end(t,e){this.m_enabled&&this.setVisible(!1),this.m_flag=!1}move(t,e){const i=this.m_prePos;if(this.m_enabled&&this.m_flag&&CoMath.Vector3D.DistanceXYZ(i.x,i.y,0,t,e,0)>1&&null!=this.m_entity){this.m_currPos.setXYZ(t,e,0),this.setVisible(!0);let i=this.bounds;i.reset(),i.addPosition(this.m_prePos),i.addXYZ(t,e,0),i.updateFast();let s=this.m_entity;s.setScaleXYZ(i.getWidth(),i.getHeight(),1),s.setPosition(i.min),s.update()}}}e.NVUIRectLine=s},"4cf3":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_scaleV=null,this.m_tempMat=null,this.m_currMat=null,this.m_aabb=null,this.m_sizeScale=1,this.rotationEnabled=!1}initialize(){this.m_scaleV=CoRScene.createVec3(),this.m_tempMat=CoRScene.createMat4(),this.m_currMat=CoRScene.createMat4(),this.m_aabb=CoRScene.createAABB(),this.m_scaleV=CoRScene.createVec3()}getAABB(){return this.m_aabb}calcAABB(t,e){this.m_tempMat,this.m_currMat;let i=this.m_aabb;for(let s=0;s<t.length;++s)t[s].update(),s>0?i.union(t[s].getGlobalBounds()):i.copyFrom(t[s].getGlobalBounds());return i.update(),i}fixToPosition(t,e,i,s=300){let n,l=this.m_tempMat,a=this.m_currMat,r=this.m_aabb;for(let d=0;d<t.length;++d)n=e[d],l.identity(),this.rotationEnabled&&l.setRotationEulerAngle(.5*Math.PI,0,0),null!=n?(a.copyFrom(n),a.append(l),t[d].getTransform().setParentMatrix(a)):(a.copyFrom(l),t[d].getTransform().setParentMatrix(a)),t[d].update(),d>0?r.union(t[d].getGlobalBounds()):r.copyFrom(t[d].getGlobalBounds());r.update();let o=s/r.getWidth(),h=s/r.getHeight(),m=s/r.getLong();o=Math.min(o,h,m),this.m_sizeScale=o,this.m_scaleV.setXYZ(o,o,o);let c=r.center,u=CoRScene.createVec3(i.x-c.x,i.y-c.y,i.z-c.z);u.scaleBy(o);for(let d=0;d<t.length;++d){n=e[d],l.identity(),l.setScale(this.m_scaleV),this.rotationEnabled&&l.setRotationEulerAngle(.5*Math.PI,0,0),l.setTranslation(u),null!=n?(a.copyFrom(n),a.append(l)):a.copyFrom(l);let i=a.decompose(CoMath.OrientationType.EULER_ANGLES);t[d].setScale3(i[2]),t[d].setRotation3(i[1]),t[d].setPosition(i[0]),t[d].getTransform().setParentMatrix(null),t[d].update(),d>0?r.union(t[d].getGlobalBounds()):r.copyFrom(t[d].getGlobalBounds())}r.update()}getSizeScale(){return this.m_sizeScale}}e.NormalEntityLayout=s},"4f1c":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("9737"),n=i("d755"),l=i("a23c"),a=i("8468");class r{constructor(t,e){this.m_uiscene=null,this.m_dropController=new n.DropModelFileController,this.m_groups=[],this.entityManager=new l.NormalEntityManager,this.exampleGroup=new a.NormalExampleGroup,this.m_uiscene=t,this.m_coapp=e}getUIScene(){return this.m_uiscene}initialize(t){this.rscene=t,this.entityManager.ctrPanel=this.ctrPanel,this.entityManager.transUI=this.transUI,this.entityManager.rsc=t,this.entityManager.initialize(),this.init(),this.entityManager.rsc=t,this.exampleGroup.entityManager=this.entityManager,this.exampleGroup.initialize(t,this.transUI);let e=this.rscene.getCanvas();this.m_dropController.initialize(e,this)}resetScene(){}initModel(){let t="static/private/",e=t+"obj/base.obj";e=t+"obj/base4.obj",e=t+"fbx/base4.fbx",this.loadModels([e])}loadModels(t,e=""){let i=new s.NormalEntityGroup(this.m_coapp);i.rsc=this.rscene,i.uiscene=this.m_uiscene,i.transUI=this.transUI,i.ctrPanel=this.ctrPanel,i.entityManager=this.entityManager,i.loadModels(t,e),this.m_groups.push(i),this.transUI.deselect(),this.exampleGroup.setEnabled(!1)}isDropEnabled(){return!0}initFileLoad(t){let e=1;if(t.length>0){let i="",s=[];for(let e=0;e<t.length;e++){0==e&&(i=t[e].name);const n=window.URL.createObjectURL(t[e]);s.push(n)}if(""!=i){i.toLocaleLowerCase();let t="";if(i.indexOf(".ctm")>1?t="ctm":i.indexOf(".fbx")>1?t="fbx":i.indexOf(".obj")>1?t="obj":i.indexOf(".drc")>1?t="drc":e=31,1==e){let e=this;e.loadModels(s,t)}}else e=31}else e=31;this.m_dropController.alertShow(e)}init(){}open(){}isOpen(){return!0}close(){}destroy(){this.entityManager.destroy()}update(){}}e.NormalEntityScene=r},5627:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_data=new Float32Array([1,1,1,1,0,0,1,1])}setNormalScale(t){this.m_data[6]=t}setRGB3f(t,e,i){this.m_data[0]=t,this.m_data[1]=e,this.m_data[2]=i}getRGB3f(t){let e=this.m_data;t.setRGB3f(e[0],e[1],e[2])}getRGBA4f(t){t.fromArray(this.m_data)}setLength(t){this.m_data[3]=t}getLegnth(){return this.m_data[3]}setColor(t){t.toArray3(this.m_data)}getColor(t){t.fromArray3(this.m_data)}applyLocalNormal(){this.m_data[7]=0}applyGlobalNormal(){this.m_data[7]=1}applyModelColor(){this.m_data[4]=1}applyNormalColor(){this.m_data[4]=0}applyDifference(t=!0){this.m_data[5]=t?1:0}create(){if(null==this.material){let t=!1,e=CoRScene.createShaderMaterial("normal_entity_material");e.addUniformDataAt("u_params",this.m_data),e.setShaderBuilder(t=>{let e=t.getShaderCodeBuilder();e.addVertLayout("vec3","a_uvs"),e.addVertLayout("vec3","a_nvs"),e.addVertUniform("vec4","u_params",2),e.addFragUniform("vec4","u_params",2),e.addVarying("vec4","v_nv"),e.addVarying("vec3","v_vnv"),e.addVarying("vec3","v_dv"),e.addFragOutputHighp("vec4","FragColor0"),e.addFragHeadCode("\n\t\t\t\tconst vec3 gama = vec3(1.0/2.2);\n\t\t\t\tconst vec3 direc0 = normalize(vec3(-0.3,-0.6,0.9));\n\t\t\t\tconst vec3 direc1 = normalize(vec3(0.3,0.6,0.9));\n\t\t\t\t\t"),e.addFragMainCode("\n\t\t\tbool facing = gl_FrontFacing;\n    \t\tvec2 dv = fract(gl_FragCoord.xy/vec2(5.0)) - vec2(0.5);\n    \t\tvec2 f2 = sign(dv);\n    \n    \t\tvec3 nv = normalize(v_nv.xyz);\n    \t\tvec3 color = pow(nv, gama);\n\n\t\t\tfloat nDotL0 = max(dot(v_vnv.xyz, direc0), 0.1);\n\t\t\tfloat nDotL1 = max(dot(v_vnv.xyz, direc1), 0.1);\n\t\t\tnDotL0 = 0.7 * (nDotL0 + nDotL1);\n\t\t\tvec3 modelColor = u_params[0].xyz * vec3(nDotL0);\n\t\t\tvec4 param = u_params[1];\n\n    \t\tvec3 frontColor = param.x > 0.5 ? modelColor : color.xyz;\n    \t\tvec3 backColor = param.y > 0.5 ? vec3(sign(f2.x * f2.y), 1.0, 1.0) : frontColor;\n    \t\tvec3 dstColor = facing ? frontColor : backColor;\n\t\t\t\n\t\t\tfrontColor = param.y > 0.5 ? dstColor : modelColor;\n\t\t\tdstColor = param.x > 0.5 ? frontColor : dstColor;\n\t\t\t\n\t\t\tfloat f = v_dv.x;\n\t\t\tf = f < 0.8 ? 1.0 : 0.0;\n\t\t\t// vec3 diffColor = vec3(1.0, 0.0, 0.0) * f + dstColor * (1.0 - f);\n\t\t\tfloat s = sign(f2.x * f2.y);\n\t\t\tvec3 diffColor = vec3(1.0, s, s) * f + dstColor * (1.0 - f);\n\t\t\tdstColor = param.y > 0.5 ? diffColor : dstColor;\n\n    \t\tFragColor0 = vec4(dstColor, 1.0);\n    \t\t// FragColor0 = vec4(u_params[0].xyz, 1.0);\n\t\t\t\t\t"),e.addVertMainCode("\n\t\t\tmat4 vmat = u_viewMat * u_objMat;\n\t\t\tviewPosition = vmat * vec4(a_vs,1.0);\n\t\t\tvec3 puvs = a_uvs;\n\t\t\tvec3 pnv = u_params[1].zzz * a_nvs;\n\t\t\tv_dv = vec3(dot(normalize(a_uvs), normalize( pnv )));\n\t\t\tvec4 pv = u_projMat * viewPosition;\t\t\t\n\t\t\tgl_Position = pv;\n\t\t\tv_vnv = normalize(pnv * inverse(mat3(vmat)));\n\t\t\tpnv = u_params[1].w < 0.5 ? pnv : normalize(pnv * inverse(mat3(u_objMat)));\n\t\t\tv_nv = vec4(pnv, 1.0);\n\t\t\t\t\t")}),e.initializeByCodeBuf(t),this.material=e}return this.material}}e.NormalEntityMaterial=s},"5dcb":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("268d"),n=i("4709"),l=i("259d");class a{constructor(){this.m_rsc=null,this.m_editUIRenderer=null,this.m_uirsc=null,this.m_coUIScene=null,this.m_outline=null,this.m_transCtr=null,this.m_selectFrame=null,this.m_transBtns=[],this.m_entityQuery=null,this.m_selectList=null,this.m_selectListeners=[]}setOutline(t){this.m_outline=t}initialize(t,e,i){null==this.m_coUIScene&&(this.m_rsc=t,this.m_editUIRenderer=e,this.m_coUIScene=i,this.init())}init(){this.m_rsc.addEventListener(CoRScene.KeyboardEvent.KEY_DOWN,this,this.keyDown),this.m_rsc.addEventListener(CoRScene.MouseEvent.MOUSE_BG_CLICK,this,this.mouseClickListener),this.m_rsc.addEventListener(CoRScene.MouseEvent.MOUSE_UP,this,this.mouseUpListener,!0,!0);let t=this.m_editUIRenderer;this.m_transCtr=CoEdit.createTransformController(),this.m_transCtr.initialize(t),this.m_transCtr.addEventListener(s.UserEditEvent.EDIT_BEGIN,this,this.editBegin),this.m_transCtr.addEventListener(s.UserEditEvent.EDIT_END,this,this.editEnd),this.m_prevPos=CoMath.createVec3(),this.m_currPos=CoMath.createVec3(),this.m_keyInterac=CoUIInteraction.createKeyboardInteraction(),this.m_keyInterac.initialize(this.m_rsc);let e=CoRScene.Keyboard,i=this.m_keyInterac.createKeysEventType([e.CTRL,e.Y]);this.m_keyInterac.addKeysDownListener(i,this,this.keyCtrlYDown),i=this.m_keyInterac.createKeysEventType([e.CTRL,e.Z]),this.m_keyInterac.addKeysDownListener(i,this,this.keyCtrlZDown),this.m_recoder=CoEdit.createTransformRecorder(),this.initUI()}keyCtrlZDown(t){this.m_recoder.undo();let e=this.m_recoder.getCurrList();this.selectEntities(e)}keyCtrlYDown(t){this.m_recoder.redo();let e=this.m_recoder.getCurrList();this.selectEntities(e)}getRecoder(){return this.m_recoder}editBegin(t){let e=this.m_rsc.getStage3D();this.m_prevPos.setXYZ(e.mouseX,e.mouseY,0)}editEnd(t){let e=this.m_rsc.getStage3D();if(this.m_currPos.setXYZ(e.mouseX,e.mouseY,0),CoMath.Vector3D.Distance(this.m_prevPos,this.m_currPos)>.5){let e=t.currentTarget.getTargetEntities();this.m_recoder.save(e)}}initUI(){this.m_uirsc=this.m_coUIScene.rscene,this.m_entityQuery=new l.NVRectFrameQuery,this.m_entityQuery.initialize(this.m_rsc);let t=this.m_uirsc;this.m_rsc.addEventListener(CoRScene.MouseEvent.MOUSE_BG_DOWN,this,this.uiMouseDownListener),t.addEventListener(CoRScene.MouseEvent.MOUSE_UP,this,this.uiMouseUpListener),t.addEventListener(CoRScene.MouseEvent.MOUSE_MOVE,this,this.uiMouseMoveListener),null==this.m_selectFrame&&(this.m_selectFrame=new n.NVUIRectLine,this.m_selectFrame.initialize(this.m_uirsc),this.m_selectFrame.setZ(-.5),this.m_selectFrame.enable()),this.initTransUI()}initTransUI(){this.m_btnGroup=CoUI.createSelectButtonGroup();let t=this.m_coUIScene,e=t.transparentTexAtlas,i=90,s=70,n=["框选","移动","旋转","缩放"],l=["select","move","rotate","scale"],a=["Select items using box selection.","Move selected items(W).","Rotate selected items(R).","Scale(resize) selected items(E)."],r=CoMaterial.createColor4().setRGB3Bytes(170,170,170),o=CoMaterial.createColor4(1,1,1,0);for(let c=0;c<n.length;++c){let t=e.createCharsCanvasFixSize(i,s,n[c],30,r,o);e.addImageToAtlas(n[c],t)}let h=5,m=4*(5+s);s=5+s;for(let c=0;c<n.length;++c){let t=this.crateBtn(n,i,s,h,m-s*c,c,l[c],a[c]);c>0&&(this.m_transBtns.push(t),this.m_btnGroup.addButton(t))}this.m_btnGroup.setSelectedFunction(t=>{let e;e=t.getLable(),e.getColorAt(0).setRGB3Bytes(71,114,179),e.setClipIndex(0),this.selectTrans(t.uuid)},t=>{let e;e=t.getLable(),e.getColorAt(0).setRGB3Bytes(40,40,40),e.setClipIndex(0)}),this.m_btnGroup.select(l[1])}uiMouseDownListener(t){this.m_selectFrame.begin(t.mouseX,t.mouseY)}uiMouseUpListener(t){if(this.m_selectFrame.isSelectEnabled()){let t=this.m_selectFrame.bounds,e=this.m_entityQuery.getEntities(t.min,t.max);this.selectEntities(e)}this.m_selectFrame.end(t.mouseX,t.mouseY)}uiMouseMoveListener(t){this.m_selectFrame.move(t.mouseX,t.mouseY)}crateBtn(t,e,i,s,n,l,a,r){let o=CoUI.createClipColorLabel();o.initializeWithoutTex(e,i,4),o.getColorAt(0).setRGB3Bytes(40,40,40),o.getColorAt(1).setRGB3Bytes(50,50,50),o.getColorAt(2).setRGB3Bytes(40,40,60);let h=this.m_coUIScene.transparentTexAtlas,m=CoUI.createClipLabel();m.transparent=!0,m.premultiplyAlpha=!0,m.initialize(h,[t[l]]);let c=CoUI.createButton();return c.uuid=a,c.info=CoUI.createTipInfo().alignRight().setContent(r),c.addLabel(m),c.initializeWithLable(o),c.setXY(s,n),this.m_coUIScene.addEntity(c,1),this.m_coUIScene.tips.addTipsTarget(c),c}selectTrans(t){switch(t){case"move":this.m_transCtr.toTranslation();break;case"scale":this.m_transCtr.toScale();break;case"rotate":this.m_transCtr.toRotation();break;default:break}null==this.m_selectList&&this.m_transCtr.disable()}keyDown(t){let e=CoRScene.Keyboard;switch(t.keyCode){case e.W:this.m_btnGroup.select(this.m_transBtns[0].uuid);break;case e.R:this.m_btnGroup.select(this.m_transBtns[1].uuid);break;case e.E:this.m_btnGroup.select(this.m_transBtns[2].uuid);break;default:break}}addSelectListener(t){null!=t&&this.m_selectListeners.push(t)}sendSelectList(t){let e=this.m_selectListeners,i=e.length;for(let s=0;s<i;++s)e[s](t)}selectEntities(t){if(this.m_selectList=t,null!=t&&t.length>0){let e=this.m_transCtr,i=CoMath.createVec3(),s=CoMath.createVec3();for(let n=0;n<t.length;++n)i.addBy(s.copyFrom(t[n].getGlobalBounds().center));i.scaleBy(1/t.length),null!=e&&(e.select(t,i),this.m_outline.select(t)),this.sendSelectList(t)}else this.sendSelectList(null)}mouseUpListener(t){null!=this.m_transCtr&&this.m_transCtr.decontrol()}mouseClickListener(t){this.deselect()}deselect(){this.m_selectList=null,null!=this.m_transCtr&&this.m_transCtr.disable(),this.m_outline.deselect(),this.sendSelectList(null)}run(){null!=this.m_transCtr&&this.m_transCtr.run()}}e.NVTransUI=a},"5e13":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("b0fb");class n extends s.UIEntityBase{constructor(){super(),this.m_uientities=[]}init(){this.isIniting()&&(super.init(),this.m_rcontainer=CoRScene.createDisplayEntityContainer())}addedEntity(t){}removedEntity(t){}addEntity(t){if(null!=t){let e=0;for(;e<this.m_uientities.length;++e)if(this.m_uientities[e]==t)break;if(e>=this.m_uientities.length){this.m_uientities.push(t),t.update();let e=t.getRContainer();null!=e&&this.m_rcontainer.addChild(e);let i=t.getREntities();for(let t=0;t<i.length;++t)this.m_rcontainer.addEntity(i[t]);this.addedEntity(t)}}}removeEntity(t){if(null!=t){let e=0;for(;e<this.m_uientities.length;++e)if(this.m_uientities[e]==t){this.m_uientities.splice(e,1);let i=t.getRContainer();null!=i&&this.m_rcontainer.removeChild(i);let s=t.getREntities();for(let t=0;t<s.length;++t)this.m_rcontainer.removeEntity(s[t]);this.removedEntity(t);break}}}globalToLocal(t){this.m_rcontainer.globalToLocal(t)}localToGlobal(t){this.m_rcontainer.localToGlobal(t)}getEneitysTotal(){return this.m_uientities.length}}e.UIEntityContainer=n},"67d8":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("b0fb");class n extends s.UIEntityBase{constructor(){super(),this.m_index=0,this.m_total=0,this.m_step=6,this.m_vtCount=0,this.m_sizes=null,this.uuid="label"}createVS(t,e,i,s){let n=t,l=e,a=t+i,r=e+s,o=0;return[n,l,o,a,l,o,a,r,o,n,r,o]}setClipIndex(t){}setCircleClipIndex(t){t%=this.m_total,t+=this.m_total,t%=this.m_total,this.setClipIndex(t)}getClipIndex(){return this.m_index}getClipsTotal(){return this.m_total}getClipWidthAt(t){return null==this.m_sizes?this.m_width:t>=0&&t<this.m_total?(t<<=1,this.m_sizes[t]):void 0}getClipHeightAt(t){return null==this.m_sizes?this.m_height:t>=0&&t<this.m_total?(t<<=1,this.m_sizes[t+1]):void 0}getClipWidth(){return this.m_width}getClipHeight(){return this.m_height}destroy(){this.m_sizes=null,this.m_total=0,super.destroy()}}e.ClipLabelBase=n},7435:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("ab2b"),n=i("4f1c");class l{constructor(){this.m_uiscene=null,this.m_ctrPanel=null,this.m_transUI=null}getUIScene(){return this.m_uiscene}initialize(t,e,i){null==this.m_uiscene&&(this.m_uiscene=t,this.m_coapp=e,this.m_transUI=i,this.entityScene=new n.NormalEntityScene(t,e),this.m_entityManager=this.entityScene.entityManager,this.initUI(),this.entityScene.transUI=i)}initUI(){let t=new s.NormalCtrlPanel;t.initialize(this.m_uiscene,0,310,390,50),t.setBGColor(CoMaterial.createColor4(.2,.2,.2)),t.addEventListener(CoRScene.SelectionEvent.SELECT,this,this.selectDisplay),t.addEventListener(CoRScene.ProgressDataEvent.PROGRESS,this,this.normalScale),this.m_ctrPanel=t,this.entityScene.ctrPanel=t}selectDisplay(t){let e=this.m_entityManager,i=t.uuid;switch(i){case"normal":case"model":case"difference":case"normalFlip":e.applyCtrlFlag(i,t.flag);break;case"local":case"global":case"modelColor":e.applyFeatureColor(i);break;case"normalScaleBtnSelect":e.normalScaleBtnSelect();break;case"normalLineColor":break;case"normalTest":this.m_uiscene.prompt.showPrompt("It can't be used now!");break;default:break}}normalScale(t){let e=this.m_entityManager;e.applyNormalScale(t.progress)}destroy(){this.m_uiscene=null,null!=this.m_ctrPanel&&(this.m_ctrPanel.destroy(),this.m_ctrPanel=null,this.entityScene.destroy(),this.entityScene=null)}open(t=null){null!=this.m_ctrPanel&&this.m_ctrPanel.open()}isOpen(){return!0}close(){null!=this.m_ctrPanel&&this.m_ctrPanel.close()}update(){}}e.NormalViewerScene=l},"75f5":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("2564");class n extends s.PackedLoader{constructor(t,e=null,i=null){super(t,e,i)}loadData(t){let e=new XMLHttpRequest;e.open("GET",t,!0),e.onerror=function(t){},e.onload=i=>{this.loadedData(e.response,t),this.loadedUrl(t)},e.send(null)}loadedData(t,e){let i=document.createElement("script");i.onerror=t=>{},i.type="text/javascript";try{i.innerHTML=t,document.head.appendChild(i)}catch(s){throw s}}}e.ModuleLoader=n},"7c62":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("3347"),n=i("2a2b");class l{constructor(){this.m_sysIniting=!0,this.m_initInsFlag=!0,this.m_initCalls=[]}initialize(t=null,e=!1){this.m_sysInitCallback=t,this.m_deferredInit=e;let i=[{url:"static/cospace/core/coapp/CoSpaceApp.umd.js",name:s.CoModuleNS.coSpaceApp,type:s.CoModuleFileType.JS},{url:"static/cospace/core/code/ThreadCore.umd.js",name:s.CoModuleNS.threadCore,type:s.CoModuleFileType.JS},{url:"static/cospace/modules/ctm/ModuleCTMGeomParser.umd.js",name:s.CoModuleNS.ctmParser,type:s.CoModuleFileType.JS},{url:"static/cospace/modules/obj/ModuleOBJGeomParser.umd.min.js",name:s.CoModuleNS.objParser,type:s.CoModuleFileType.JS},{url:"static/cospace/modules/png/ModulePNGParser.umd.js",name:s.CoModuleNS.pngParser,type:s.CoModuleFileType.JS},{url:"static/cospace/modules/fbxFast/ModuleFBXGeomFastParser.umd.js",name:s.CoModuleNS.fbxFastParser,type:s.CoModuleFileType.JS}];this.m_modules=i;let l={nodes:[{uniqueName:"dracoGeomParser",path:"static/cospace/modules/draco/ModuleDracoGeomParser.umd.js"},{uniqueName:"dracoWasmWrapper",path:"static/cospace/modules/dracoLib/w2.js"},{uniqueName:"ctmGeomParser",path:"static/cospace/modules/ctm/ModuleCTMGeomParser.umd.js"}],maps:[{uniqueName:"dracoGeomParser",includes:[1]}]};this.m_dependencyGraphObj=l;let a=new n.CoModuleLoader(1),r=a.getUrlChecker();if(null!=r){for(let e=0;e<i.length;++e)i[e].url=r(i[e].url);let t=l.nodes;for(let e=0;e<t.length;++e)t[e].path=r(t[e].path)}e||this.loadSys()}loadSys(){this.m_sysIniting&&(new n.CoModuleLoader(1,()=>{this.initCoSpaceSys()}).load(this.m_modules[0].url),this.m_sysIniting=!1)}getCPUDataByUrlAndCallback(t,e,i,s){if(null!=this.coappIns){let n=this.coappIns.getCPUDataByUrlAndCallback(t,e,i,s);if(this.m_deferredInit&&this.m_initInsFlag){this.m_initInsFlag=!1;let t=this.m_modules;this.coappIns.initialize(3,t[1].url,!0)}return n}return null}deferredInit(t){null==this.coappIns?(this.m_initCalls.push(t),this.loadSys()):null!=t&&t()}initCoSpaceSys(){if(null==this.coappIns&&"undefined"!==typeof CoSpaceApp){let t=CoSpaceApp.createInstance(),e=this.m_modules,i=JSON.stringify(this.m_dependencyGraphObj);t.setThreadDependencyGraphJsonString(i),t.setTaskModuleParams(e),this.m_deferredInit||t.initialize(3,e[1].url,!0);let s=this;s.coappIns=t;for(let n=0;n<this.m_initCalls.length;++n)null!=this.m_initCalls[n]&&this.m_initCalls[n]();this.m_initCalls=[]}null!=this.m_sysInitCallback&&this.m_sysInitCallback(),this.m_sysInitCallback=null}}e.CoDataModule=l,e.default=l},8468:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("43c4");class n{constructor(){this.m_rscene=null,this.m_visible=!0,this.m_nodes=[],this.m_nodeEntities=[],this.m_textEntities=[],this.m_pv=null,this.m_textHeight=130,this.m_enabled=!0,this.m_runFlag=-1}initialize(t,e){null==this.m_rscene&&(this.m_rscene=t,this.m_transUI=e,this.createNodes(),this.m_pv=CoRScene.createVec3(),t.runnableQueue.addRunner(this))}createNodes(){let t=this.m_rscene.entityBlock.unitBox.getMesh(),e={uvsList:[t.getUVS().slice(0)],vertices:t.getVS().slice(0),normals:t.getNVS().slice(0),indices:t.getIVS().slice(0)},i=e,s=i.vertices;for(let g=0;g<s.length;++g)s[g]*=75;let n={uvsList:i.uvsList,vertices:i.vertices,normals:null,indices:i.indices},l=0,a=24,r=i.normals.slice(0);for(let g=l;g<a;++g)r[g]=1;let o={uvsList:i.uvsList,vertices:i.vertices,normals:r,indices:i.indices};r=i.normals.slice(0);let h=i.indices.slice(0);this.flipTriWrap(0,h),this.flipTriWrap(1,h),this.flipTriWrap(2,h),this.flipTriWrap(3,h);let m={uvsList:i.uvsList,vertices:i.vertices,normals:r,indices:h},c=this.m_textHeight,u=CoText.createH5Text(this.m_rscene,"text_cv_01",22,512,512),d=this.entityManager,_=CoRScene.createVec3(),p=this.createEntityWithModel(e,_.setXYZ(-70,0,70));d.addNode(p),_.y+=c,this.createStaticText(_,"法线正确",u),p=this.createEntityWithModel(n,_.setXYZ(-200,0,200)),d.addNode(p),_.y+=c,this.createStaticText(_,"没有法线数据",u),p=this.createEntityWithModel(o,_.setXYZ(70,0,-70)),p.showDifference(),p.showModelColor(!0),d.addNode(p),_.y+=c,this.createStaticText(_,"法线错误倾斜",u),p=this.createEntityWithModel(m,_.setXYZ(200,0,-200),i.indices),p.showDifference(),p.showModelColor(!0),d.addNode(p),_.y+=c,this.createStaticText(_,"顶点绕序错误",u),this.m_transUI.getRecoder().save(this.m_nodeEntities)}flipTriWrap(t,e){let i=3*t,s=i+2,n=e[i];e[i]=e[s],e[s]=n}createEntityWithModel(t,e,i=null){let n=new s.NormalEntityNode;return n.rsc=this.m_rscene,n.transUI=this.m_transUI,n.setEntityModel(t,i),n.setPosition(e),n.update(),this.m_nodeEntities.push(n.entity),this.m_nodes.push(n),n}createStaticText(t,e,i){let s=CoText.createStaticTextEntity(e,i);s.setPosition(t),s.update();let n=s.getREntity();this.m_rscene.addEntity(n,1),this.m_textEntities.push(n)}setEnabled(t){if(this.m_enabled!==t){let e=this.entityManager,i=this.m_nodes,s=this.m_textEntities;if(t);else for(let t=0;t<i.length;++t)e.removeNode(i[t]),i[t].setVisible(!1),this.m_rscene.removeEntity(s[t]);this.m_enabled=t}}setVisible(t){this.m_visible=t}isVisible(){return this.m_visible}update(){}destroy(){if(this.entityManager=null,null!=this.m_rscene){let t=this.m_nodes,e=this.m_textEntities;if(null!=t&&t.length>0)for(let i=0;i<t.length;++i)this.entityManager.removeNode(t[i]),t[i].destroy(),this.m_rscene.removeEntity(e[i]),e[i].destroy();this.m_nodes=[],this.m_textEntities=[],this.entityManager=null,this.m_rscene=null,this.m_transUI=null}}setRunFlag(t){this.m_runFlag=t}getRunFlag(){return this.m_runFlag}isRunning(){return this.m_enabled}isStopped(){return!this.m_enabled}run(){let t=this.m_nodes,e=this.m_textEntities,i=this.m_pv;for(let s=0;s<t.length;++s){let n=t[s].entity,l=n.getTransform(),a=e[s].getTransform();a.version!=l.version&&(n.getPosition(i),i.y+=this.m_textHeight,a.version,l.version,e[s].setPosition(i),e[s].update(),a.version=l.version)}}}e.NormalExampleGroup=n},8875:function(t,e,i){var s,n,l;(function(i,a){n=[],s=a,l="function"===typeof s?s.apply(e,n):s,void 0===l||(t.exports=l)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(d){var i,s,n,l=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,a=/@([^@]*):(\d+):(\d+)\s*$/gi,r=l.exec(d.stack)||a.exec(d.stack),o=r&&r[1]||!1,h=r&&r[2]||!1,m=document.location.href.replace(document.location.hash,""),c=document.getElementsByTagName("script");o===m&&(i=document.documentElement.outerHTML,s=new RegExp("(?:[^\\n]+?\\n){0,"+(h-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),n=i.replace(s,"$1").trim());for(var u=0;u<c.length;u++){if("interactive"===c[u].readyState)return c[u];if(c[u].src===o)return c[u];if(o===m&&c[u].innerHTML&&c[u].innerHTML.trim()===n)return c[u]}return null}}return t}))},"89c1":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("2a2b");class n{constructor(t){this.m_rscene=t;let e="static/cospace/renderEffect/occPostOutline/OccPostOutlineModule.umd.js";new s.CoModuleLoader(1,()=>{this.m_postOutline=OccPostOutlineModule.create(),this.initOutline(),this.m_rscene.appendRenderNode(this)}).load(e)}initOutline(){this.m_postOutline.initialize(this.m_rscene,0,[0]),this.m_postOutline.setFBOSizeScaleRatio(.5),this.m_postOutline.setRGB3f(0,1,0),this.m_postOutline.setOutlineDensity(2),this.m_postOutline.setOcclusionDensity(.2)}select(t){null!=this.m_postOutline&&this.m_postOutline.setTargetList(t)}deselect(){null!=this.m_postOutline&&this.m_postOutline.setTargetList(null)}render(){null!=this.m_postOutline&&(this.m_postOutline.drawBegin(),this.m_postOutline.draw(),this.m_postOutline.drawEnd())}}e.CoPostOutline=n},9737:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("43c4"),n=i("3347"),l=i("4cf3");class a{constructor(t){this.m_uid=a.s_uid++,this.m_loadTotal=0,this.m_loadedTotal=0,this.m_nodes=[],this.m_transforms=[],this.m_transes=[],this.m_layoutor=null,this.m_coapp=t}getUid(){return this.m_uid}initialize(){}loadModels(t,e=""){if(null!=t&&t.length>0){let i=t.slice(0);this.m_coapp.deferredInit(()=>{for(let t=0;t<i.length;++t)this.loadModel(i[t],e)})}}loadModel(t,e=""){let i=e;if(""==e){let e=t.lastIndexOf(".")+1,s=t.lastIndexOf("?");i=s<0?t.slice(e):t.slice(e,s)}i=i.toLocaleLowerCase();let s=n.CoDataFormat.Undefined;switch(i){case"obj":s=n.CoDataFormat.OBJ;break;case"fbx":s=n.CoDataFormat.FBX;break;case"drc":s=n.CoDataFormat.Draco;break;case"ctm":s=n.CoDataFormat.CTM;break;default:break}s!=n.CoDataFormat.Undefined&&this.loadGeomModel(t,s)}loadGeomModel(t,e){let i=this.m_coapp;if(null!=i){this.uiscene.prompt.getPromptPanel().applyConfirmButton(),this.uiscene.prompt.showPrompt("Model loading!"),this.m_loadTotal++;let s=i.getCPUDataByUrlAndCallback(t,e,(t,i)=>{e!=n.CoDataFormat.FBX&&this.createEntityFromModels(t.data.models,t.data.transforms),this.createEntityFromUnit(t,i)},!0);e==n.CoDataFormat.FBX&&(s.data.modelReceiver=(t,e,i,s)=>{this.createEntityFromModels(t,e)})}}createEntityFromModels(t,e){let i=[],s=t.length,n=[];for(let l=0;l<s;++l){const s=this.addEntityWithModel(t[l],null!=e?e[l]:null);null!=s&&(this.entityManager.addNode(s),n.push(s),this.m_nodes.push(s),i.push(s.entity))}this.updateLayout(!1),this.transUI.getRecoder().save(i)}createEntityFromUnit(t,e=0){this.m_loadedTotal++,this.m_loadedTotal>=this.m_loadTotal&&(this.uiscene.prompt.getPromptPanel().applyConfirmButton(),this.uiscene.prompt.showPrompt("Model loaded finish!"))}addEntityWithModel(t,e){if(null!=t){let i=new s.NormalEntityNode;i.rsc=this.rsc,i.transUI=this.transUI;let n=i.setEntityModel(t),l=null!=e?CoRScene.createMat4(e):null;return this.m_transforms.push(l),this.m_transes.push(n),i}return null}updateLayout(t){null==this.m_layoutor&&(this.m_layoutor=new l.NormalEntityLayout,this.m_layoutor.initialize()),this.m_layoutor.rotationEnabled=t;for(let i=0;i<this.m_transes.length;++i){let t=this.m_transes[i];t.setXYZ(0,0,0),t.setScaleXYZ(1,1,1),t.setRotationXYZ(0,0,0)}let e=CoRScene.createVec3();this.m_layoutor.fixToPosition(this.m_transes,this.m_transforms,e,300)}destroy(){let t=this.m_nodes;if(null!=t&&t.length>0)for(let e=0;e<t.length;++e)this.entityManager.removeNode(t[e]),t[e].destroy();this.m_nodes=[],this.entityManager=null,this.uiscene=null,this.m_transforms=null,this.m_transes=null,this.m_layoutor=null,this.rsc=null}}a.s_uid=0,e.NormalEntityGroup=a},a176:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("e9fd");let n=new s.DemoVox3DEditor,l=n;function a(){function t(e){l.run(),window.requestAnimationFrame(t)}l.initialize(),window.requestAnimationFrame(t)}a()},a23c:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_map=new Map,this.m_selectEntities=null,this.m_scaleBase=1,this.m_visible=!1}initialize(){this.transUI.addSelectListener(t=>{this.setSelectedModelVisible(!0);let e=t;this.m_selectEntities=e,this.ctrPanel.setModelVisiFlag(null!=e&&e.length>0),this.testSelect()})}setVisible(t){if(this.m_visible!=t){this.m_visible=t;for(let[e,i]of this.m_map.entries())i.setVisible(t)}}testSelect(){let t=this.m_selectEntities;if(null!=t){let e=this.m_map,i=!1,s=!1,n=!1,l=this.ctrPanel,a=l.getNormalScale();for(let r=0;r<t.length;++r){const l=e.get(t[r].getUid());null!=l&&(l.getLineVisible()&&(i=!0),l.isShowDifference()&&(s=!0),l.isNormalFlipping()&&(n=!0),l.select())}this.m_scaleBase=a<.1?.1:a,l.setNormalFlag(i),l.setNormalFlipFlag(n),l.setDifferenceFlag(s)}}setSelectedNormalLineVisible(t){let e=this.m_selectEntities;if(null!=e){let i=this.m_map;for(let s=0;s<e.length;++s){const n=i.get(e[s].getUid());null!=n&&n.setLineVisible(t)}}}setSelectedModelVisible(t){let e=this.m_selectEntities;if(null!=e){let i=this.m_map;for(let s=0;s<e.length;++s){const n=i.get(e[s].getUid());null!=n&&n.entity.setVisible(t)}}}setModelColor(t){let e=this.m_selectEntities;if(null!=e){let i=this.m_map;for(let s=0;s<e.length;++s){const n=i.get(e[s].getUid());null!=n&&n.showModelColor(t)}}}showNormalLocalColor(){let t=this.m_selectEntities;if(null!=t){let e=this.m_map;for(let i=0;i<t.length;++i){const s=e.get(t[i].getUid());null!=s&&s.showLocalNormal()}}}showNormalGlobalColor(){let t=this.m_selectEntities;if(null!=t){let e=this.m_map;for(let i=0;i<t.length;++i){const s=e.get(t[i].getUid());null!=s&&s.showGlobalNormal()}}}showDifferenceColor(t=!0){let e=this.m_selectEntities;if(null!=e){let i=this.m_map;for(let s=0;s<e.length;++s){const n=i.get(e[s].getUid());null!=n&&n.showDifference(t)}}}flipNormalLine(t){let e=this.m_selectEntities;if(null!=e){let i=this.m_map;for(let s=0;s<e.length;++s){const n=i.get(e[s].getUid());null!=n&&n.flipNormal(t)}}}normalScaleBtnSelect(){let t=this.m_selectEntities;if(null!=t){let e=this.m_map;this.ctrPanel;for(let i=0;i<t.length;++i){const s=e.get(t[i].getUid());null!=s&&s.select()}}}applyFeatureColor(t){let e=this.m_selectEntities;if(null!=e&&e.length>0)switch(t){case"local":this.showNormalLocalColor();break;case"global":this.showNormalGlobalColor();break;case"modelColor":this.setModelColor(!0);break;case"normalTest":break;default:break}}applyCtrlFlag(t,e){let i=this.m_selectEntities;if(null!=i&&i.length>0)switch(t){case"normal":this.setSelectedNormalLineVisible(e);break;case"model":this.setSelectedModelVisible(e);break;case"difference":this.showDifferenceColor(e);break;case"normalFlip":this.flipNormalLine(e);break;default:break}}applyNormalScale(t){let e=this.m_selectEntities;if(null!=e&&e.length>0){let e=this.m_selectEntities;if(null!=e){let i=this.m_map;for(let s=0;s<e.length;++s){const n=i.get(e[s].getUid());null!=n&&n.applyNormalLineScale(t)}}}}addNode(t){if(null!=t){let e=this.m_map;t.getUid()>=0&&!e.has(t.getUid())&&e.set(t.getUid(),t)}}removeNode(t){if(null!=t){let e=this.m_map;t.getUid()>=0&&e.has(t.getUid())&&e.delete(t.getUid())}}destroy(){this.m_selectEntities=null,this.m_map.clear()}}e.NormalEntityManager=s},ab08:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){}calcRange(t,e=.7,i=.5){i<0?i=0:i>1&&(i=1),e<0?e=0:e>1&&(e=1);let s=t*(1-e),n=i*t,l=n+.5*s;l>t&&(l=t);let a=l-s;return[a,l]}avgLayout(t,e,i,s=-1){if(null!=t&&t.length>0){let n=t.length;switch(n){case 1:let n=.5*(i-e)+e;return[n-.5*t[0]];default:return this.calcAvgMulti(t,e,i,s)}}return null}calcAvgLayout(t,e,i=.7,s=.5){let n=this.calcRange(e,i,s);return this.avgLayout(t,n[0],n[1])}calcAvgFixLayout(t,e,i=10,s=.7,n=.5){let l=this.calcRange(e,s,n);return this.avgLayout(t,l[0],l[1],i)}calcAvgMulti(t,e,i,s=-1){let n=i-e,l=t.length,a=0;for(let o=0;o<l;o++)a+=t[o],s>0&&o>0&&(a+=s);let r=new Array(l);if(r[0]=e,r[l-1]=i-t[l-1],l>2)if(a<n){let e=(n-a)/(l-1);l--;for(let i=1;i<l;i++)r[i]=r[i-1]+t[i-1]+e}else if(s<=0){let e=r[0]+.5*t[0];n=r[l-1]+.5*t[l-1]-e;let i=n/(l-1);e+=i,l--;for(let t=1;t<l;t++)r[t]=e,e+=i}if(a>=n&&s>0){let i=.5*n+e-.5*(a+(l-1)*s);for(let e=0;e<l;e++)r[e]=i,i+=t[e]+s}return r}}e.AxisAlignCalc=s},ab2b:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_btnW=90,this.m_btnH=50,this.m_scene=null,this.m_panel=null,this.m_normalScale=0,this.autoLayout=!0,this.m_dragging=!1,this.m_dragMinX=0,this.m_dragMaxX=0,this.m_progressLen=0,this.m_proBaseLen=100}getScene(){return this.m_scene}setBGColor(t){null==this.m_panel&&(this.m_panel=CoUI.createUIPanel()),this.m_panel.autoLayout=!1,this.m_panel.setBGColor(t)}initialize(t,e,i,s,n){null==this.m_scene&&(this.m_scene=t,this.m_rpi=e,this.m_panelW=i,this.m_panelH=s,this.m_btnH=n,this.m_v0=CoRScene.createVec3(),null==this.m_panel&&(this.m_panel=CoUI.createUIPanel()),this.m_panel.autoLayout=!1,this.m_panel.setUIscene(t),this.m_panel.setSize(i,s),this.buildPanel(i,s))}destroy(){this.m_scene=null,null!=this.m_selectDispatcher&&(this.m_selectDispatcher.destroy(),this.m_progressDispatcher.destroy(),this.m_selectDispatcher=null,this.m_progressDispatcher=null),this.m_progressEvt=null,this.m_modelVisiBtn=null,this.m_normalVisiBtn=null,this.m_diffBtn=null,this.m_normalFlipBtn=null,null!=this.m_panel&&(this.m_panel.destroy(),this.m_panel=null)}open(t=null,e=-1){this.m_panel.open(t),this.autoLayout&&(this.addLayoutEvt(),this.layout())}isOpen(){return this.m_panel.isOpen()}close(){this.removeLayoutEvt(),this.m_panel.close()}addEventListener(t,e,i,s=!0,n=!1){t==CoRScene.SelectionEvent.SELECT?this.m_selectDispatcher.addEventListener(t,e,i,s,n):t==CoRScene.ProgressDataEvent.PROGRESS&&this.m_progressDispatcher.addEventListener(t,e,i,s,n)}removeEventListener(t,e,i){t==CoRScene.SelectionEvent.SELECT?this.m_selectDispatcher.removeEventListener(t,e,i):t==CoRScene.ProgressDataEvent.PROGRESS&&this.m_progressDispatcher.removeEventListener(t,e,i)}buildPanel(t,e){this.m_selectDispatcher=CoRScene.createEventBaseDispatcher(),this.m_progressDispatcher=CoRScene.createEventBaseDispatcher(),this.m_progressEvt=CoRScene.createProgressDataEvent();let i=this.m_scene,s=10,n=this.m_panelH-10-this.m_btnH,l=5,a=5,r=s,o=0;this.m_btnW=90;let h=i.transparentTexAtlas,m=CoRScene.MouseEvent,c={text:"Local",textColor:CoMaterial.createColor4(),fontSize:30,font:""},u=CoMaterial.createColor4,d=[u().setRGB3Bytes(80,80,80),u().setRGB3Bytes(110,110,110),u().setRGB3Bytes(90,90,90),u().setRGB3Bytes(110,110,110)],_=CoUI.createTextButton(this.m_btnW,this.m_btnH,"local",h,c,d);_.setXY(s,n),r=r+this.m_btnW+l,this.m_btnW=90,c.text="Global";let p=CoUI.createTextButton(this.m_btnW,this.m_btnH,"global",h,c,d);p.setXY(r,n),r=r+this.m_btnW+l,this.m_btnW=100,c.text="Color";let g=CoUI.createTextButton(this.m_btnW,this.m_btnH,"modelColor",h,c,d);g.setXY(r,n);let y=this.m_panel;y.addEntity(_),y.addEntity(p),y.addEntity(g);let f=28;o=n-this.m_btnH-a+20;let C=this.createText("Normal line visible",s+f+l,o);r=s,o=C.getY(),this.m_normalVisiBtn=this.createFlagBtn(f,r,o,"normal"),C=this.createText("Model visible",s+f+l,o-10),o=C.getY(),this.m_modelVisiBtn=this.createFlagBtn(f,r,o,"model"),C=this.createText("Normal difference",s+f+l,o-10),o=C.getY(),this.m_diffBtn=this.createFlagBtn(f,r,o,"difference"),C=this.createText("Normal flip",s+f+l,o-10),o=C.getY(),this.m_normalFlipBtn=this.createFlagBtn(f,r,o,"normalFlip"),C=this.createText("Normal line length:",s,o-15),r=s,o=C.getY(),this.m_dragBar=this.createProgressBtn(r+5,o-25,200),o=this.m_dragBar.getY(),C=this.createText("Normal line color:",s,o-10),r=s,o=C.getY();let b=[u().setRGB3Bytes(210,0,210),u().setRGB3Bytes(240,0,240),u().setRGB3Bytes(220,0,220),u().setRGB3Bytes(240,0,240)],v=this.createColorBtn(22,22,"normalLineColor",b);v.setXY(s+C.getWidth()+l,o),y.addEntity(v),r=s,o=C.getY()-a,this.m_btnW=90,c.text="Test";let S=CoUI.createTextButton(this.m_btnW,this.m_btnH,"normalTest",h,c,d);S.update(),S.setXY(r,o-S.getHeight()),y.addEntity(S),_.addEventListener(m.MOUSE_UP,this,this.normalDisplaySelect),p.addEventListener(m.MOUSE_UP,this,this.normalDisplaySelect),g.addEventListener(m.MOUSE_UP,this,this.normalDisplaySelect),S.addEventListener(m.MOUSE_UP,this,this.normalDisplaySelect),v.addEventListener(m.MOUSE_UP,this,this.normalLineColorSelect);let E=this.m_btnGroup=CoUI.createSelectButtonGroup();E.addButton(_),E.addButton(p),E.addButton(g),E.setSelectedFunction(t=>{let e;e=t.getLable(),e.getColorAt(0).setRGB3Bytes(71,114,179),e.setClipIndex(0)},t=>{let e;e=t.getLable(),e.getColorAt(0).setRGB3Bytes(80,80,80),e.setClipIndex(0)}),this.m_btnGroup.select(p.uuid)}normalDisplaySelect(t){this.sendSelectionEvt(t.uuid,!0)}normalLineColorSelect(t){}selectVisibleFunc(t){this.sendSelectionEvt(t.uuid,t.flag)}createFlagBtn(t,e,i,s="model"){let n=this.getScene(),l=CoUI.createFlagButton();return l.uuid=s,l.initializeWithSize(n.texAtlas,t,t),l.setXY(e,i),l.addEventListener(CoRScene.SelectionEvent.SELECT,this,this.selectVisibleFunc),this.m_panel.addEntity(l),l}getNormalScale(){return this.m_normalScale}setNormalFlag(t){this.m_normalVisiBtn.setFlag(t)}setModelVisiFlag(t){this.m_modelVisiBtn.setFlag(t)}setDifferenceFlag(t){this.m_diffBtn.setFlag(t)}setNormalFlipFlag(t){this.m_normalFlipBtn.setFlag(t)}sendProgressEvt(t,e){let i=this.m_progressEvt;i.target=this,i.status=2,i.type=CoRScene.ProgressDataEvent.PROGRESS,i.minValue=0,i.maxValue=1,i.value=e,i.progress=e,i.phase=1,i.uuid=t,this.m_progressDispatcher.dispatchEvt(i),i.target=null}sendSelectionEvt(t,e){let i=CoRScene.createSelectionEvent();i.uuid=t,i.target=this,i.type=CoRScene.SelectionEvent.SELECT,i.flag=e,i.phase=1,this.m_selectDispatcher.dispatchEvt(i),i.target=null}createText(t,e,i){let s=this.getScene(),n=CoUI.createTextLabel();return n.depthTest=!0,n.transparent=!0,n.premultiplyAlpha=!0,n.initialize(t,s),n.setXY(e,i-n.getHeight()),n.update(),this.m_panel.addEntity(n),n}createProgressBtn(t,e,i){let s=this.getScene(),n=(CoMaterial.createColor4(.1,.1,.1),CoUI.createClipColorLabel());n.initializeWithoutTex(i,10,4),n.getColorAt(0).setRGB3Bytes(70,70,70),n.getColorAt(1).setRGB3f(.3,.3,.3),n.getColorAt(2).setRGB3Bytes(70,70,70),n.getColorAt(3).setRGB3Bytes(70,70,70);let l=CoUI.createButton();l.initializeWithLable(n),l.setZ(-.05),l.setXY(t,e),this.m_panel.addEntity(l),this.m_dragBgBar=l,l.addEventListener(CoRScene.MouseEvent.MOUSE_DOWN,this,this.progressBgMouseDown),this.m_progressLen=i-16,this.m_proBaseLen=this.m_progressLen,this.m_dragMinX=t,this.m_dragMaxX=t+this.m_progressLen;let a=CoUI.createClipColorLabel();a.initializeWithoutTex(16,16,4),a.getColorAt(0).setRGB3Bytes(130,130,130),a.getColorAt(1).setRGB3f(.2,1,.2),a.getColorAt(2).setRGB3f(.2,1,1);let r=CoUI.createButton();return r.initializeWithLable(a),r.setXY(t,e-3),this.m_panel.addEntity(r),r.addEventListener(CoRScene.MouseEvent.MOUSE_DOWN,this,this.progressMouseDown),s.addEventListener(CoRScene.MouseEvent.MOUSE_UP,this,this.progressMouseUp),r}progressMouseDown(t){this.m_dragging=!0;let e=this.getScene();this.sendSelectionEvt("normalScaleBtnSelect",!0),e.addEventListener(CoRScene.MouseEvent.MOUSE_MOVE,this,this.progressMouseMove)}progressMouseUp(t){this.m_dragging=!1;let e=this.getScene();e.removeEventListener(CoRScene.MouseEvent.MOUSE_MOVE,this,this.progressMouseMove)}progressBgMouseDown(t){let e=t.mouseX,i=t.mouseY,s=this.m_v0;s.setXYZ(e,i,0),this.m_panel.globalToLocal(s),e=s.x,e<this.m_dragMinX?e=this.m_dragMinX:e>this.m_dragMaxX&&(e=this.m_dragMaxX),this.m_dragBar.setX(e),this.m_dragBar.update(),this.m_proBaseLen=e-this.m_dragMinX}progressMouseMove(t){let e=t.mouseX,i=t.mouseY,s=this.m_v0;s.setXYZ(e,i,0),this.m_panel.globalToLocal(s),e=s.x,e<this.m_dragMinX?e=this.m_dragMinX:e>this.m_dragMaxX&&(e=this.m_dragMaxX),this.m_dragBar.setX(e),this.m_dragBar.update();let n=(e-this.m_dragMinX)/this.m_proBaseLen;this.m_normalScale=n,this.sendProgressEvt("normalScale",n)}createColorBtn(t,e,i,s){let n=CoUI.createClipColorLabel();n.initializeWithoutTex(t,e,4),n.setColors(s);let l=CoUI.createButton();return l.uuid=i,l.initializeWithLable(n),l}addLayoutEvt(){if(this.autoLayout){let t=this.getScene();if(null!=t){let e=CoRScene.EventBase;t.addEventListener(e.RESIZE,this,this.resize)}}}removeLayoutEvt(){if(this.autoLayout){let t=this.getScene();if(null!=t){let e=CoRScene.EventBase;t.removeEventListener(e.RESIZE,this,this.resize)}}}resize(t){this.layout()}layout(){let t=this.getScene();if(null!=t){let e=this.getGlobalBounds().getWidth(),i=t.getRect(),s=i.width-e,n=i.y+.5*(i.height-this.getHeight());this.setXY(s,n),this.update()}}setZ(t){this.m_panel.setZ(t)}setXY(t,e){this.m_panel.setXY(t,e)}getGlobalBounds(){return this.m_panel.getGlobalBounds()}getWidth(){return this.m_panel.getWidth()}getHeight(){return this.m_panel.getHeight()}update(){this.m_panel.update()}}e.NormalCtrlPanel=s},af66:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("5e13"),n=i("3f49");class l extends s.UIEntityContainer{constructor(){super(),this.m_panelW=100,this.m_panelH=150,this.m_isOpen=!1,this.autoLayout=!0,this.m_openListener=null,this.m_closeListener=null,this.m_panelBuilding=!0}setSize(t,e){this.m_panelW=t,this.m_panelH=e}setBGColor(t){return null==this.m_bgColor&&(this.m_bgColor=CoMaterial.createColor4()),this.m_bgColor.copyFrom(t),null!=this.m_bgLabel&&this.m_bgLabel.setColor(t),this}init(){this.isIniting()&&(null==this.m_bgColor&&(this.m_bgColor=CoMaterial.createColor4()),super.init())}setUIscene(t,e=-1){null==this.m_scene&&null!=t&&(this.m_scene=t,e>=0&&(this.m_rpi=e),this.init())}openThis(){}closeThis(){}setOpenAndLoseListener(t,e){this.m_openListener=t,this.m_closeListener=e}open(t=null,e=-1){this.m_isOpen||(this.isIniting()&&this.init(),null!=t&&(this.m_scene=t),e>=0&&(this.m_rpi=e),this.m_scene.addEntity(this,this.m_rpi),this.m_isOpen=!0,this.setVisible(!0),this.openThis(),this.autoLayout&&(this.addLayoutEvt(),this.layout()),null!=this.m_openListener&&this.m_openListener())}isOpen(){return this.m_isOpen}close(){this.m_isOpen&&(this.m_scene.removeEntity(this),this.m_isOpen=!1,this.setVisible(!1),this.removeLayoutEvt(),this.closeThis(),null!=this.m_closeListener&&this.m_closeListener())}destroy(){super.destroy(),this.m_panelBuilding=!0,null!=this.m_bgLabel&&(this.m_bgLabel.destroy(),this.m_bgLabel=null),this.m_openListener=null,this.m_closeListener=null}buildPanel(t,e){}updateScene(){let t=this.getScene();if(null!=t&&this.m_panelBuilding&&null==this.m_bgLabel){this.m_panelBuilding=!1;let t=this.m_panelW,e=this.m_panelH,i=this.createBG(t,e);this.buildPanel(t,e),this.addEntity(i),this.setVisible(this.m_isOpen),this.m_isOpen&&(this.addLayoutEvt(),this.layout())}}addLayoutEvt(){if(this.autoLayout){let t=this.getScene();if(null!=t){let e=CoRScene.EventBase;t.addEventListener(e.RESIZE,this,this.resize)}}}removeLayoutEvt(){if(this.autoLayout){let t=this.getScene();if(null!=t){let e=CoRScene.EventBase;t.removeEventListener(e.RESIZE,this,this.resize)}}}createBG(t,e){let i=new n.ColorLabel;return i.depthTest=!0,i.initialize(t,e),i.setZ(-.1),i.setColor(this.m_bgColor),this.m_bgLabel=i,this.initializeEvent(i.getREntities()[0]),i}initializeEvent(t,e="uiPlane"){const i=CoRScene.MouseEvent;let s=CoRScene.createMouseEvt3DDispatcher();s.currentTarget=this,s.uuid=e,s.addEventListener(i.MOUSE_OVER,this,this.mouseOverListener),s.addEventListener(i.MOUSE_OUT,this,this.mouseOutListener),t.setEvtDispatcher(s),t.mouseEnabled=!0}mouseOverListener(t){}mouseOutListener(t){}resize(t){this.layout()}layout(){let t=this.getScene();if(null!=t){this.update();let e=t.getRect(),i=e.x+.5*(e.width-this.getWidth()),s=e.y+.5*(e.height-this.getHeight());this.setXY(i,s),this.update()}}}e.UIPanel=l},b0fb:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_sc=null,this.m_parent=null,this.m_rotation=0,this.m_visible=!0,this.m_entities=[],this.m_width=0,this.m_height=0,this.m_v0=null,this.m_bounds=null,this.m_rcontainer=null,this.premultiplyAlpha=!1,this.transparent=!1,this.info=null,this.depthTest=!1}init(){this.isIniting()&&(this.m_pos=CoMath.createVec3(),this.m_scaleV=CoMath.createVec3(1,1,1),this.m_v0=CoMath.createVec3(),this.m_bounds=CoMath.createAABB())}isIniting(){return null==this.m_bounds}createMaterial(t=null){let e=CoMaterial.createDefaultMaterial();return e.premultiplyAlpha=this.premultiplyAlpha,null!=t&&e.setTextureList([t]),e.initializeByCodeBuf(null!=t),e}applyRST(t){const e=CoRScene.RendererState;this.transparent?this.premultiplyAlpha?t.setRenderState(e.BACK_ALPHA_ADD_ALWAYS_STATE):this.depthTest?t.setRenderState(e.BACK_TRANSPARENT_STATE):t.setRenderState(e.BACK_TRANSPARENT_ALWAYS_STATE):this.depthTest?t.setRenderState(e.NORMAL_STATE):t.setRenderState(e.BACK_NORMAL_ALWAYS_STATE)}createVS(t,e,i,s){let n=t,l=e,a=t+i,r=e+s,o=0;return[n,l,o,a,l,o,a,r,o,n,r,o]}updateScene(){}updateParent(){}__$setScene(t){this.m_sc!=t&&(this.m_sc=t,this.updateScene())}getScene(){return this.m_sc}setParent(t){return t!=this&&(this.m_parent=t,this.updateParent()),this}getParent(){return this.m_parent}getGlobalBounds(){return this.m_bounds}setVisible(t){this.m_visible=t;let e=this.m_entities;for(let i=0;i<e.length;++i)e[i].setVisible(t);null!=this.m_rcontainer&&this.m_rcontainer.setVisible(t)}isVisible(){return this.m_visible}getWidth(){return this.m_bounds.getWidth()}getHeight(){return this.m_bounds.getHeight()}setPosition(t){this.m_pos.copyFrom(t)}setX(t){this.m_pos.x=t}setY(t){this.m_pos.y=t}setZ(t){this.m_pos.z=t}getX(){return this.m_pos.x}getY(){return this.m_pos.y}getZ(){return this.m_pos.z}setXY(t,e){this.m_pos.x=t,this.m_pos.y=e}getPosition(t){t.copyFrom(this.m_pos)}setRotation(t){this.m_rotation=t}getRotation(){return this.m_rotation}setScaleXYZ(t,e,i){this.m_scaleV.setXYZ(t,e,i)}setScaleXY(t,e){this.setScaleXYZ(t,e,1)}setScaleX(t){this.m_scaleV.x=t}setScaleY(t){this.m_scaleV.y=t}getScaleX(){return this.m_scaleV.x}getScaleY(){return this.m_scaleV.y}copyTransformFrom(t){if(null!=t){let e=t.getScaleX(),i=t.getScaleY(),s=t.getRotation();this.setScaleXY(e,i),this.setRotation(s),t.getPosition(this.m_v0),this.setPosition(this.m_v0)}}getREntities(){return this.m_entities.slice(0)}getRContainer(){return this.m_rcontainer}updateEntity(t){t.setPosition(this.m_pos),t.setScale3(this.m_scaleV),t.setRotationXYZ(0,0,this.m_rotation),t.update(),this.m_bounds.union(t.getGlobalBounds())}update(){let t=this.m_entities,e=this.m_bounds;this.m_bounds.reset();for(let i=0;i<t.length;++i)this.updateEntity(t[i]);null!=this.m_rcontainer&&this.updateEntity(this.m_rcontainer),e.updateFast()}destroy(){let t=this.m_sc;null!=t&&t.removeEntity(this),this.m_rcontainer=null,this.m_sc=null,this.m_parent=null,this.m_bounds=null;let e=this.m_entities;for(let i=0;i<e.length;++i)e[i].destroy();e=[]}}e.UIEntityBase=s},bb26:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("d460"),n=i("5627");class l{constructor(){this.m_normalLineScale=1}getEntityMaterial(){return this.m_entityMaterial}getNormalLineMaterial(){return this.m_normalLineMaterial}getNormalLineScale(){return this.m_normalLineScale}createNormalEntity(t,e=null){this.m_entityMaterial=new n.NormalEntityMaterial;let i=this.m_entityMaterial.create();i.initializeByCodeBuf(!1),this.m_entityMaterial.setRGB3f(.7,.7,.7);let s=t.vertices,l=t.indices,a=l.length/3,r=new Float32Array(s.length);CoAGeom.SurfaceNormal.ClacTrisNormal(s,s.length,a,null!=e?e:l,r);let o=t.normals;null==o&&(o=new Float32Array(s.length));let h=this.createEntityMesh(t.indices,t.vertices,r,o,i),m=CoRScene.createMouseEventEntity();return m.setMaterial(i),m.setMesh(h),m.setRenderState(CoRScene.RendererState.NONE_CULLFACE_NORMAL_STATE),m}createNormalLineEntity(t,e,i,n=5){let l=t.getMatrix(),a=l.decompose(CoMath.OrientationType.EULER_ANGLES),r=a[2].x;this.m_normalLineScale=n/r;let o=new s.NormalLineMaterial;if(o.setRGB3f(1,0,1),this.m_normalLineMaterial=o,this.m_normalLineMaterial.setLength(this.m_normalLineScale),null==i){let t=CoRScene.createDisplayEntity();return t.setVisible(!1),t}let h,m=CoMesh.line;m.dynColorEnabled=!0;let c=e,u=i,d=c.length/3,_=0,p=0,g=0,y=0,f=new Float32Array(6*d),C=new Float32Array(4*d),b=new Float32Array(6*d),v=CoRScene.createVec3(),S=CoRScene.createVec3();for(let s=0;s<d;++s){_=3*s,v.setXYZ(c[_],c[_+1],c[_+2]),S.setXYZ(u[_],u[_+1],u[_+2]),v.toArray(f,p),p+=3,v.toArray(f,p),p+=3,S.toArray(b,y),y+=3,S.toArray(b,y),y+=3;let t=g;C[t++]=0,C[t++]=0,C[t++]=1,C[t++]=1,g+=6}let E,M=o.create();return E=CoRScene.createDisplayEntity(t.getTransform()),h=this.createLineMesh(f,C,b,M),E.setMesh(h),E.setMaterial(M),E.setVisible(!1),E}createLineMesh(t,e,i,s){let n=CoMesh.createRawMesh();return n.ivsEnabled=!1,n.aabbEnabled=!0,n.reset(),n.setBufSortFormat(s.getBufSortFormat()),n.addFloat32Data(t,3),n.addFloat32Data(e,2),n.addFloat32Data(i,3),n.vbWholeDataEnabled=!1,n.initialize(),n.toArraysLines(),n.vtCount=Math.floor(t.length/3),n}createEntityMesh(t,e,i,s,n){let l=CoMesh.createRawMesh();return l.reset(),l.setBufSortFormat(n.getBufSortFormat()),l.setIVS(t),l.addFloat32Data(e,3),l.addFloat32Data(i,3),l.addFloat32Data(s,3),l.vbWholeDataEnabled=!1,l.initialize(),l}destroy(){this.m_entityMaterial=null,this.m_normalLineMaterial=null}}e.NormalEntityBuilder=l},bb62:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("67d8");class n extends s.ClipLabelBase{constructor(){super(...arguments),this.m_colors=null,this.m_material=null,this.m_fixSize=!0,this.m_hasTex=!1}createMesh(t,e){let i=new Uint16Array([0,1,2,0,2,3]),s=new Float32Array(this.createVS(0,0,this.m_width,this.m_height)),n=CoMesh.createRawMesh();if(n.reset(),n.setIVS(i),n.addFloat32Data(s,3),""!=e&&null!=t){let i=t.getTexObjFromAtlas(e),s=new Float32Array(i.uvs);n.addFloat32Data(s,2)}return n.initialize(),n}hasTexture(){return this.m_hasTex}initialize(t,e,i){if(this.isIniting()&&i>0){this.init(),this.m_hasTex=!1;let s=null;if(""!=e&&null!=t){let i=t.getTexObjFromAtlas(e);this.m_fixSize&&(this.m_width=i.getWidth(),this.m_height=i.getHeight()),this.m_hasTex=!0,s=i.texture}let n=this.createMaterial(s),l=this.createMesh(t,e),a=CoEntity.createDisplayEntity();a.setMaterial(n),a.setMesh(l),this.m_entities.push(a),this.m_material=n;let r=new Array(i);for(let t=0;t<i;++t)r[t]=CoMaterial.createColor4();this.m_colors=r,this.m_total=i,this.setClipIndex(0)}}initializeWithoutTex(t,e,i){this.m_width=t,this.m_height=e,this.m_fixSize=!1,this.initialize(null,"",i)}initializeWithSize(t,e,i,s,n){t>0&&e>0&&(this.m_width=t,this.m_height=e,this.m_fixSize=!1,this.initialize(i,s,n))}initializeWithLable(t){if(this.isIniting()&&null!=t&&t!=this){if(t.getClipsTotal()<1)throw Error("Error: srcLable.getClipsTotal() < 1");let e=t.getREntities();for(let i=0;i<e.length;++i){let s=e[i],n=s.getMesh(),l=s.getMaterial().getTextureAt(0),a=this.m_total=t.getClipsTotal(),r=t.getColors(),o=new Array(a);for(let t=0;t<a;++t)o[t]=CoMaterial.createColor4(),o[t].copyFrom(r[t]);this.m_colors=o,this.m_width=t.getWidth(),this.m_height=t.getHeight();let h=this.createMaterial(l),m=CoEntity.createDisplayEntity();m.setMaterial(h),m.setMesh(n),this.m_entities.push(m),null==this.m_material&&(this.m_material=h)}this.setClipIndex(0)}}displaceFromLable(t){if(null!=t&&t!=this&&t.getClipsTotal()<1)throw Error("Error: srcLable.getClipsTotal() < 1")}getColorAt(t){if(t>=0&&t<this.m_total)return this.m_colors[t]}setColorAt(t,e){t>=0&&t<this.m_total&&null!=e&&this.m_colors[t].copyFrom(e)}setColors(t){if(null!=t){let e=this.m_colors,i=t.length;i>e.length&&(i=e.length);for(let s=0;s<i;++s)e[s].copyFrom(t[s])}}setClipIndex(t){t>=0&&t<this.m_total&&(this.m_index=t,this.m_material.setColor(this.m_colors[t]))}getColors(){return this.m_colors}}e.ClipColorLabel=n},ccfe:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("1dd7"),n=i("af66"),l=i("2870"),a=i("ab08");class r extends n.UIPanel{constructor(){super(),this.m_promptLabel=null,this.m_prompt="Hi,Prompt Panel.",this.m_btnW=90,this.m_btnH=50,this.m_confirmFunc=null,this.m_cancelFunc=null,this.m_cancelBtnVis=!0,this.marginWidth=70,this.marginXFactor=.5,this.marginYFactor=.6,this.m_alignCalc=new a.AxisAlignCalc}initialize(t,e,i,s,n,l,a="Confirm",r="Cancel"){this.isIniting()&&(this.init(),this.m_scene=t,this.m_rpi=e,this.m_panelW=i,this.m_panelH=s,this.m_btnW=n,this.m_btnH=l,this.m_confirmNS=a,this.m_cancelNS=r,this.m_bgColor=CoMaterial.createColor4())}applyConfirmButton(){this.m_cancelBtnVis=!1;let t=this.m_cancelBtn;null==t||t.isVisible()||(this.m_cancelBtn.setVisible(!1),null!=this.m_confirmBtn&&this.isOpen()&&(this.layoutItems(),this.layout()))}applyAllButtons(){this.m_cancelBtnVis=!0,null!=this.m_cancelBtn&&this.m_cancelBtn.setVisible(!0)}setPrompt(t){if(""!=t&&this.m_prompt!=t){this.m_prompt=t;let e=this.m_promptLabel;if(null!=e){e.setText(t);let i=.5*(this.m_panelW-e.getWidth());e.setX(i),e.update(),null!=this.m_confirmBtn&&this.isOpen()&&(this.layoutItems(),this.layout())}}}setPromptTextColor(t){let e=this.m_promptLabel;null!=e&&e.setColor(t)}setListener(t,e){this.m_confirmFunc=t,this.m_cancelFunc=e}destroy(){super.destroy(),this.m_confirmFunc=null,this.m_cancelFunc=null,null!=this.m_confirmBtn&&(this.m_confirmBtn.destroy(),this.m_cancelBtn.destroy(),this.m_bgLabel.destroy(),this.m_confirmBtn=null,this.m_cancelBtn=null,this.m_bgLabel=null)}buildPanel(t,e){this.buildItems()}buildItems(){if(null!=this.m_confirmBtn)return;let t=this.getScene(),e=new s.TextLabel;e.depthTest=!0,e.transparent=!0,e.premultiplyAlpha=!0,e.initialize(this.m_prompt,t),this.m_promptLabel=e;let i=t.transparentTexAtlas,n=CoMaterial.createColor4,a=(CoRScene.MouseEvent,{text:this.m_confirmNS,textColor:n(),fontSize:30,font:""}),r=[n().setRGB3Bytes(80,80,80),n().setRGB3Bytes(110,110,110),n().setRGB3Bytes(90,90,90)],o=l.ButtonBuilder,h=o.createTextButton(this.m_btnW,this.m_btnH,"confirm",i,a,r);this.m_confirmBtn=h,a.text=this.m_cancelNS;let m=o.createTextButton(this.m_btnW,this.m_btnH,"cancel",i,a,r);this.m_cancelBtn=m,this.addEntity(m),this.addEntity(h),this.addEntity(e)}updateBgSize(){let t=this.m_panelW,e=this.m_promptLabel;e.update();let i=this.m_confirmBtn;i.update();let s=this.m_cancelBtn;s.update();let n=s.isVisible()?s.getWidth():0,l=i.getWidth()+n;n=l+Math.round(.2*l)+this.marginWidth;let a=e.getWidth()+this.marginWidth;a=n>a?n:a,t=this.m_panelW=a;let r=this.m_bgLabel;Math.abs(r.getWidth()-t)>.01&&(r.setScaleX(1),r.update(),a=r.getWidth(),r.setScaleX(t/a),r.update())}layoutItems(){this.m_cancelBtn.setVisible(this.m_cancelBtnVis),this.updateBgSize();let t=this.m_panelW,e=this.m_promptLabel,i=[this.m_btnH,e.getHeight()],s=this.m_alignCalc.calcAvgFixLayout(i,this.m_panelH,15,this.marginYFactor,.5),n=.5*(t-e.getWidth());e.setXY(n,s[1]),e.update(),this.m_cancelBtn.isVisible()?this.layoutButtons(n,s[0]):this.layoutOnlyConfirm(n,s[0])}layoutButtons(t,e){let i=[this.m_btnW,this.m_btnW],s=this.m_alignCalc.calcAvgFixLayout(i,this.m_panelW,10,this.marginXFactor,.5),n=this.m_confirmBtn,l=this.m_cancelBtn;n.setXY(s[0],e),n.update(),l.setXY(s[1],e),l.update()}layoutOnlyConfirm(t,e){let i=[this.m_btnW],s=this.m_alignCalc.calcAvgFixLayout(i,this.m_panelW,10,this.marginXFactor,.5),n=this.m_confirmBtn;n.setXY(s[0],e),n.update()}openThis(){let t=CoRScene.MouseEvent;null!=this.m_scene&&(this.m_scene.addEventListener(t.MOUSE_DOWN,this,this.stMouseDownListener),this.m_confirmBtn.addEventListener(t.MOUSE_UP,this,this.btnMouseUpListener),this.m_cancelBtn.addEventListener(t.MOUSE_UP,this,this.btnMouseUpListener),this.layoutItems())}closeThis(){this.m_cancelBtnVis=!0;let t=CoRScene.MouseEvent;null!=this.m_scene&&(this.m_scene.removeEventListener(t.MOUSE_DOWN,this,this.stMouseDownListener),this.m_confirmBtn.removeEventListener(t.MOUSE_UP,this,this.btnMouseUpListener),this.m_cancelBtn.removeEventListener(t.MOUSE_UP,this,this.btnMouseUpListener))}stMouseDownListener(t){let e=t.mouseX,i=t.mouseY,s=this.m_v0;s.setXYZ(e,i,0),this.globalToLocal(s),(s.x<0||s.x>this.m_panelW||s.y<0||s.y>this.m_panelH)&&this.close()}btnMouseUpListener(t){let e=t.uuid;switch(e){case"confirm":this.close(),null!=this.m_confirmFunc&&this.m_confirmFunc();break;case"cancel":this.close(),null!=this.m_cancelFunc&&this.m_cancelFunc();break;default:break}}}e.PromptPanel=r},d460:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_data=new Float32Array([1,1,1,1]),this.m_scale=1}setRGB3f(t,e,i){this.m_data[0]=t,this.m_data[1]=e,this.m_data[2]=i}getRGB3f(t){let e=this.m_data;t.setRGB3f(e[0],e[1],e[2])}getRGBA4f(t){t.fromArray(this.m_data)}setScale(t){this.m_scale=t}setLength(t){this.m_data[3]=this.m_scale*t}getLegnth(){return this.m_data[3]}setColor(t){t.toArray3(this.m_data)}getColor(t){t.fromArray3(this.m_data)}create(){if(null==this.material){let t=!1,e=CoRScene.createShaderMaterial("normal_dyn_line_material");e.addUniformDataAt("u_color",this.m_data),e.setShaderBuilder(t=>{let e=t.getShaderCodeBuilder();e.addVertLayout("vec2","a_uvs"),e.addVertLayout("vec3","a_nvs"),e.addVertUniform("vec4","u_color"),e.addFragUniform("vec4","u_color"),e.addFragOutputHighp("vec4","FragColor0"),e.addFragMainCode("\n\t\t\tFragColor0 = vec4(u_color.xyz, 1.0);\n\t\t\t\t\t"),e.addVertMainCode("\n\t\t\tviewPosition = u_viewMat * u_objMat * vec4(a_vs + u_color.www * a_nvs * a_uvs.xxx,1.0);\n\t\t\tvec4 pv = u_projMat * viewPosition;\n\t\t\t\n\t\t\tgl_Position = pv;\n\t\t\t\t\t")}),e.initializeByCodeBuf(t),this.material=e}return this.material}}e.NormalLineMaterial=s},d755:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_canvas=null,this.m_listener=null}initialize(t,e){null==this.m_canvas&&(this.m_canvas=t,this.m_listener=e,this.initDrop(this.m_canvas))}initDrop(t){t.addEventListener("dragenter",t=>{t.preventDefault(),t.stopPropagation()},!1),t.addEventListener("dragover",t=>{t.preventDefault(),t.stopPropagation()},!1),t.addEventListener("dragleave",t=>{t.preventDefault(),t.stopPropagation()},!1),t.addEventListener("drop",t=>{t.preventDefault(),t.stopPropagation(),this.receiveDropFile(t)},!1)}receiveDropFile(t){if(this.m_listener.isDropEnabled()){let e=t.dataTransfer,i=[],s=0,n=0;if(void 0!==e.items){let t=e.items;for(let e=0;e<t.length;e++){let l=t[e],a=l.webkitGetAsEntry();if(null!=a)if(a.isFile){let t=l.getAsFile();i.push(t),this.m_listener.initFileLoad(i),s=1}else if(a.isDirectory){let t=a.createReader();t.readEntries(t=>{s=t.length,s>0?t.forEach(t=>{t.isFile&&t.file(t=>{i.push(t),n++,s==n&&this.m_listener.initFileLoad(i)})}):this.alertShow(31)});break}if(s>0)break}}}}alertShow(t){switch(t){case 31:alert("没有找到对应的模型文件");break;default:break}}}e.DropModelFileController=s},d8b4:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("7435"),n=i("7c62");class l{constructor(){this.m_uiscene=null,this.m_codata=new n.CoDataModule,this.normalScene=null}getUIScene(){return this.m_uiscene}initialize(t,e){null==this.m_uiscene&&(this.m_codata.initialize(null,!0),this.m_uiscene=t,this.normalScene=new s.NormalViewerScene,this.normalScene.initialize(t,this.m_codata,e))}destroy(){this.m_uiscene=null,null!=this.normalScene&&(this.normalScene.destroy(),this.normalScene=null)}open(t=null){this.normalScene.open()}isOpen(){return!0}close(){this.normalScene.close()}update(){this.normalScene.update()}}e.NormalViewer=l},e9fd:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("89c1"),n=i("5dcb"),l=i("3120"),a=i("d8b4"),r=i("3f7d"),o=i("2a2b"),h=i("1389");class m{constructor(){this.m_bodyDiv=null,this.m_infoDiv=null}initUI(){document.body.style.background="#000000",null==this.m_bodyDiv&&(this.m_bodyDiv=document.createElement("div"),this.m_bodyDiv.style.width="100vw",this.m_bodyDiv.style.height="100vh",this.m_bodyDiv.style.zIndex="9999",this.elementCenter(this.m_bodyDiv),document.body.appendChild(this.m_bodyDiv),document.body.style.margin="0")}showInfo(t){null==this.m_infoDiv&&(this.m_infoDiv=document.createElement("div"),this.m_infoDiv.style.backgroundColor="rgba(255,255,255,0.1)",this.m_infoDiv.style.color="#00ee00",this.m_infoDiv.style.zIndex="10000",this.elementCenter(this.m_infoDiv),this.m_bodyDiv.appendChild(this.m_infoDiv)),this.m_infoDiv.innerHTML=t}showLoadProgressInfo(t){let e="loading "+Math.round(100*t)+"% ";this.showInfo(e)}showLoadStart(){this.showInfo("loading 0%")}showLoaded(){this.showInfo("100%")}loadFinish(t=0){null!=this.m_bodyDiv&&(this.m_bodyDiv.parentElement.removeChild(this.m_bodyDiv),this.m_bodyDiv=null)}elementCenter(t,e="50%",i="50%",s="absolute"){t.style.textAlign="center",t.style.display="flex",t.style.flexDirection="column",t.style.justifyContent="center",t.style.alignItems="center"}}class c{constructor(){}renderBegin(t){let e=t.getRenderProxy();e.clearDepth(1)}renderEnd(t){}}class u{constructor(){this.m_rsc=null,this.m_editUIRenderer=null,this.m_uirsc=null,this.m_coUIScene=null,this.m_interact=null,this.m_transUI=new n.NVTransUI,this.m_nvaUI=new l.NVNavigationUI,this.m_loadingUI=new m,this.m_viewer=null,this.m_graph=null}initialize(){document.oncontextmenu=function(t){t.preventDefault()},this.initEngineModule(),this.m_loadingUI.initUI(),this.m_loadingUI.showInfo("initializing rendering engine...")}initEngineModule(){let t="static/cospace/engine/uiInteract/CoUIInteraction.umd.js",e=new o.CoModuleLoader(2,()=>{this.initInteract()}),i="static/cospace/engine/renderer/CoRenderer.umd.js",s="static/cospace/engine/rscene/CoRScene.umd.js",n="static/cospace/math/CoMath.umd.js",l="static/cospace/ageom/CoAGeom.umd.js",a="static/cospace/coedit/CoEdit.umd.js",r="static/cospace/comesh/CoMesh.umd.js",h="static/cospace/coentity/CoEntity.umd.js",m="static/cospace/particle/CoParticle.umd.js",c="static/cospace/coMaterial/CoMaterial.umd.js",u="static/cospace/cotexture/CoTexture.umd.js",d="static/cospace/coui/CoUI.umd.js",_="static/cospace/cotext/CoText.umd.js";new o.CoModuleLoader(2,()=>{this.isEngineEnabled()&&(this.initRenderer(),this.initScene(),this.m_loadingUI.showInfo("initializing editor system..."),new o.CoModuleLoader(3,()=>{new o.CoModuleLoader(7,()=>{this.initEditUI(),this.m_loadingUI.loadFinish(0)}).load(l).load(a).load(h).load(m).load(u).load(d).load(_)}).load(n).load(r).load(c))}).addLoader(e).load(i).load(s),e.load(t)}initEditUI(){this.m_coUIScene=CoUI.createUIScene(),this.m_coUIScene.initialize(this.m_rsc,512,5),this.m_uirsc=this.m_coUIScene.rscene,this.m_graph.addScene(this.m_uirsc);let t=new r.PromptSystem;t.initialize(this.m_coUIScene),this.m_coUIScene.prompt=t;let e=new h.TipsSystem;e.initialize(this.m_coUIScene),this.m_coUIScene.tips=e,this.m_transUI.setOutline(this.m_outline),this.m_transUI.initialize(this.m_rsc,this.m_editUIRenderer,this.m_coUIScene),this.m_nvaUI.initialize(this.m_rsc,this.m_editUIRenderer,this.m_coUIScene);let i=CoMath.createVec3(-100,0,-100),s=i.clone().scaleBy(-1),n=10,l=CoEdit.createFloorLineGrid();l.initialize(this.m_rsc,0,i.scaleBy(n),s.scaleBy(n),30);let o=new a.NormalViewer;o.initialize(this.m_coUIScene,this.m_transUI),o.open(),this.m_viewer=o;let m=o.normalScene.entityScene;m.initialize(this.m_rsc)}initScene(){}isEngineEnabled(){return"undefined"!==typeof CoRenderer&&"undefined"!==typeof CoRScene}initInteract(){let t=this.m_rsc;null!=t&&null==this.m_interact&&"undefined"!==typeof CoUIInteraction&&(this.m_interact=CoUIInteraction.createMouseInteraction(),this.m_interact.initialize(this.m_rsc,2,!0),this.m_interact.setSyncLookAtEnabled(!0))}initRenderer(){if(null==this.m_rsc){let t=CoRScene.RendererDevice;t.SHADERCODE_TRACE_ENABLED=!1,t.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,t.SetWebBodyColor("#606060");let e=CoRScene.createRendererSceneParam();e.setAttriAntialias(!t.IsMobileWeb()),e.setCamPosition(1e3,1e3,1e3),e.setCamProject(45,20,9e3);let i=CoRScene.createRendererScene(e,3);i.setClearRGBColor3f(.23,.23,.23),i.addEventListener(CoRScene.MouseEvent.MOUSE_DOWN,this,this.mouseDownListener),this.m_rsc=i;let n=this.m_rsc.createSubScene(e,3,!1);n.enableMouseEvent(!0),n.setAccessor(new c),this.m_editUIRenderer=n,this.m_graph=CoRScene.createRendererSceneGraph(),this.m_graph.addScene(this.m_rsc),this.m_graph.addScene(this.m_editUIRenderer),this.m_outline=new s.CoPostOutline(i)}}mouseUpListener(t){}mouseDownListener(t){}keyDown(t){let e=CoRScene.Keyboard;switch(t.keyCode){case e.S:break;default:break}}run(){null!=this.m_graph&&(null!=this.m_interact&&(this.m_interact.setLookAtPosition(null),this.m_interact.run()),null!=this.m_transUI&&this.m_transUI.run(),this.m_graph.run())}}e.DemoVox3DEditor=u,e.default=u},eb56:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("3914"),n=i("b0fb");class l extends n.UIEntityBase{constructor(){super(),this.m_enabled=!0,this.m_lb=null,this.m_lbs=[],this.uuid="btn"}addLabel(t){this.m_lbs.push(t)}enable(){return null!=this.m_dp&&(this.m_dp.enabled=!0),this.m_enabled=!0,this}disable(){return null!=this.m_dp&&(this.m_dp.enabled=!1),this.m_enabled=!1,this}isEnabled(){return this.m_enabled}setMouseEnabled(t){null!=this.m_entities&&(this.m_entities[0].mouseEnabled=t)}isMouseEnabled(){return null!=this.m_entities&&this.m_entities[0].mouseEnabled}initialize(t,e=null){if(this.isIniting()&&null!=t&&null!=e){if(this.init(),4!=e.length)throw Error("Error: idnsList.length != 4");let i=new s.ClipLabel;i.initialize(t,e),this.m_lb=i,this.initializeEvent(),this.m_lb.setClipIndex(0)}return this}initializeWithLable(t){if(this.isIniting()){if(this.init(),t.getClipsTotal()<1)throw Error("Error: lable.getClipsTotal() < 1");this.m_lb=t,this.initializeEvent(),this.m_lb.setClipIndex(0)}return this}getLable(){return this.m_lb}initializeEvent(){if(null==this.m_dp){const t=CoRScene.MouseEvent;let e=CoRScene.createMouseEvt3DDispatcher();e.currentTarget=this,e.uuid=this.uuid,e.enabled=this.m_enabled,e.addEventListener(t.MOUSE_DOWN,this,this.mouseDownListener),e.addEventListener(t.MOUSE_UP,this,this.mouseUpListener),e.addEventListener(t.MOUSE_OVER,this,this.mouseOverListener),e.addEventListener(t.MOUSE_OUT,this,this.mouseOutListener),this.m_lb.getREntities()[0].setEvtDispatcher(e),this.m_dp=e}this.m_entities=this.m_lb.getREntities().slice(0),this.m_entities[0].mouseEnabled=!0}setVisible(t){super.setVisible(t);let e=this.m_lbs;for(let i=0;i<e.length;++i)e[i].setVisible(t)}addEventListener(t,e,i,s=!0,n=!1){return this.m_dp.addEventListener(t,e,i,s,n),this}removeEventListener(t,e,i){return this.m_dp.removeEventListener(t,e,i),this}mouseOverListener(t){if(this.m_enabled){this.m_lb.setClipIndex(1);let t=this.m_lbs;if(t.length>0)for(let e=0;e<t.length;++e)t[e].setClipIndex(1)}}mouseOutListener(t){if(this.m_enabled){this.m_lb.setClipIndex(0);let t=this.m_lbs;if(t.length>0)for(let e=0;e<t.length;++e)t[e].setClipIndex(0)}}mouseDownListener(t){if(this.m_enabled){this.m_lb.setClipIndex(2);let t=this.m_lbs;if(t.length>0)for(let e=0;e<t.length;++e)t[e].setClipIndex(2)}}mouseUpListener(t){if(this.m_enabled){this.m_lb.setClipIndex(3);let t=this.m_lbs;if(t.length>0)for(let e=0;e<t.length;++e)t[e].setClipIndex(3)}}setClipIndex(t){return this.m_lb.setClipIndex(t),this}copyTransformFrom(t){if(null!=t){let e=t.getScaleX(),i=t.getScaleY(),s=t.getRotation();this.setScaleXY(e,i),this.setRotation(s),t.getPosition(this.m_v0),this.setPosition(this.m_v0)}}getREntities(){let t=this.m_lb.getREntities(),e=this.m_lbs;if(e.length>0){for(let i=0;i<e.length;++i)t=t.concat(e[i].getREntities());return t}return t}getRContainer(){return null}update(){this.m_bounds.reset();let t=this.m_scaleV,e=this.m_lb;e.setRotation(this.m_rotation),e.setScaleXY(t.x,t.y),e.setPosition(this.m_pos),e.update(),this.m_bounds.union(e.getGlobalBounds());let i=this.m_lbs;if(i.length>0)for(let s=0;s<i.length;++s)i[s].copyTransformFrom(this.m_lb),i[s].update(),this.m_bounds.union(i[s].getGlobalBounds());this.m_bounds.updateFast()}destroy(){let t=this.m_lb;null!=t&&(t.destroy(),t=null);let e=this.m_lbs;if(e.length>0){for(let t=0;t<e.length;++t)e[t].destroy();this.m_lbs=[]}null!=this.m_dp&&(this.m_dp.destroy(),this.m_dp=null),super.destroy()}}e.Button=l},fae3:function(t,e,i){"use strict";i.r(e);i("1eb2");var s=i("a176");for(var n in s)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(n)}})}));