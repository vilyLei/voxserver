(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["CoSpace"]=e():t["CoSpace"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var l=e[s]={i:s,l:!1,exports:{}};return t[s].call(l.exports,l,l.exports,i),l.l=!0,l.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var l in t)i.d(s,l,function(e){return t[e]}.bind(null,l));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="fae3")}({"1c1e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("2756"),l=i("2a2b");class n{constructor(){this.m_jsonRawData="",this.m_jsonObj=null,this.m_globalColor=null,this.m_globalText=null}initialize(t,e){this.m_callback=e;let i=new l.CoModuleLoader(1).getUrlChecker();t=i(t);let n=new s.TextPackedLoader(1,()=>{this.m_jsonRawData=n.getDataByUrl(t),this.m_jsonObj=JSON.parse(this.m_jsonRawData),null!=this.m_callback&&(this.m_callback(),this.m_callback=null)}).load(t)}createColorByData(t){let e=CoRScene.createColor4();return e.fromBytesArray3(t),e}applyButtonGlobalColor(t,e){if(null!=t&&""!=e){let i=this.m_globalColor.button;if(null!=i){let s=i[e];if(void 0!=s){let e=t.getLable();this.applyButtonColor(e.getColors(),s),e.setClipIndex(0)}}}}applyButtonColor(t,e){const i=t.length;t[0].fromBytesArray3(e.out),t[1].fromBytesArray3(e.over),i>2&&t[2].fromBytesArray3(void 0!=e.down?e.down:e.out),i>3&&t[3].fromBytesArray3(void 0!=e.up?e.up:e.out)}getUIGlobalText(){if(null!=this.m_globalText)return this.m_globalText;let t=this.m_jsonObj;if(null!=t){let e=t["text"];if(void 0!==e)return this.m_globalText=e,this.m_globalText}return null}getUIGlobalColor(){if(null!=this.m_globalColor)return this.m_globalColor;let t=this.m_jsonObj;if(null!=t){let e=t["color"];if(void 0!==e)return this.m_globalColor=e,this.m_globalColor}return null}getUIModuleByName(t){if(""!=t){let e=this.m_jsonObj;if(null!=e){let i=e["uiModule"];if(void 0!==i){let e=i[t];if(void 0!==e)return e}}}return null}getUIPanelCfgByName(t){if(""!=t){let e=this.m_jsonObj;if(null!=e){let i=e["uiModule"];if(void 0!==i){let e=i[t];if(void 0!==e)return e}}}return null}destroy(){}}e.UIConfig=n},"1eb2":function(t,e,i){"use strict";if("undefined"!==typeof window){var s=window.document.currentScript,l=i("8875");s=l(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:l});var n=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(i.p=n[1])}},2564:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e=null,i=null){this.m_uid=s.s_uid++,this.m_urlChecker=null,this.m_oneTimes=!0,this.m_loaderMap=null,this.m_callback=e,this.m_times=t,this.m_urlChecker=i}setUrlChecker(t=null){return this.m_urlChecker=t,this}getUrlChecker(){return this.m_urlChecker}getUid(){return this.m_uid}setCallback(t){return this.m_callback=t,this}addLoader(t){if(null!=t&&t!=this)if(this.isFinished())t.use();else{null==this.m_loaderMap&&(this.m_loaderMap=new Map);let e=this.m_loaderMap;e.has(t.getUid())||e.set(t.getUid(),t)}return this}isFinished(){return 0==this.m_times}useOnce(){this.m_oneTimes&&(this.m_oneTimes=!1,this.use())}use(){if(this.m_times>0&&(this.m_times--,this.isFinished()&&null!=this.m_callback&&(this.m_callback(),this.m_callback=null,null!=this.m_loaderMap))){for(let[t,e]of this.m_loaderMap)e.use();this.m_loaderMap=null}}hasModuleByUrl(t){return s.loadedMap.has(t)}load(t){if(""==t)return this;null!=this.m_urlChecker&&(t=this.m_urlChecker(t));let e=s.loadedMap;if(e.has(t))return void this.use();let i=s.loadingMap;if(!i.has(t))return i.set(t,[this]),this.loadData(t),this;{let e=i.get(t);for(let t=0;t<e.length;++t)if(e[t]==this)return;e.push(this)}}loadData(t){let e=new XMLHttpRequest;e.open("GET",t,!0),e.onerror=function(t){},e.onload=e=>{this.loadedUrl(t)},e.send(null)}loadedData(t,e){}loadedUrl(t){let e=s.loadedMap,i=s.loadingMap;e.set(t,1);let l=i.get(t);for(let s=0;s<l.length;++s)l[s].use();i.delete(t)}getDataByUrl(t){return null}clearAllData(){}destroy(){this.m_urlChecker=null}}s.s_uid=0,s.loadedMap=new Map,s.loadingMap=new Map,e.PackedLoader=s},"259d":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_entities=null,this.m_rect=CoMath.createAABB2D()}query(t,e){if(this.m_entities=[],e>0){let i=this.m_entities;const s=this.m_rect;let l=CoMath.createVec3(),n=this.m_rscene.getCamera(),r=this.m_rscene.getStage3D();for(let a=0;a<e;++a)if(t[a].mouseEnabled){let e=t[a].getGlobalBounds();l.copyFrom(e.center),n.worldPosToScreen(l),l.x+=r.stageHalfWidth,l.y+=r.stageHalfHeight,s.containsXY(l.x,l.y)&&i.push(t[a])}}}initialize(t){null==this.m_rscene&&(this.m_rscene=t)}getEntities(t,e){const i=this.m_rect;if(i.setTo(t.x,t.y,e.x-t.x,e.y-t.y),i.width*i.height>0){let t=this.m_rscene;return t.getSpace().renderingEntitySet.query(this),this.m_entities}return null}}e.NVRectFrameQuery=s},"268d":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.EDIT_BEGIN=20001,s.EDIT_END=20002,e.UserEditEvent=s},2756:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("2564");class l extends s.PackedLoader{constructor(){super(...arguments),this.m_dataMap=new Map}loadData(t){let e=new XMLHttpRequest;e.open("GET",t,!0),e.onerror=function(t){},e.onload=i=>{this.m_dataMap.set(t,e.response),this.loadedUrl(t)},e.send(null)}getDataByUrl(t){return this.m_dataMap.get(t)}clearAllData(){this.m_dataMap.clear()}}e.TextPackedLoader=l},2870:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("3914"),l=i("bb62"),n=i("eb56");class r{static createCurrTextBtn(t,e,i,r,a,o=null){if(null!==a.text&&""!=a.text){let h=new l.ClipColorLabel;h.initializeWithoutTex(t,e,4),h.setColors(o);let m=new s.ClipLabel;m.depthTest=!0,m.transparent=!0,m.premultiplyAlpha=!0,m.initialize(r,[a.text]),m.setColor(a.textColor);let c=new n.Button;return c.uuid=i,c.addLabel(m),c.initializeWithLable(h),c}return null}static createTextButton(t,e,i,s,l,n){let a=l,o=s.createCharsCanvasFixSize(t,e,a.text,a.fontSize,CoMaterial.createColor4(),CoMaterial.createColor4(1,1,1,0));return s.addImageToAtlas(a.text,o),r.createCurrTextBtn(t,e,i,s,l,n)}static createPanelBtnWithCfg(t,e,i,s,l){let n=t.transparentTexAtlas,r=t.uiConfig,a=l.btnSize,o=a[0],h=a[1],m=l.btnNames,c=l.btnKeys,u=l.btnTips,d=l.btnTextFontFormat;n.setFontName(d.font);let _=CoMaterial.createColor4();_.fromBytesArray3(r.getUIGlobalColor().text);let p=CoMaterial.createColor4(1,1,1,0),g=n.createCharsCanvasFixSize(o,h,m[s],d.fontSize,_,p);n.addImageToAtlas(m[s],g);let y=CoUI.createClipColorLabel();y.initializeWithoutTex(o,h,4);let f=CoUI.createClipLabel();f.transparent=!0,f.premultiplyAlpha=!0,f.initialize(n,[m[s]]);let b=CoUI.createButton();b.uuid=c[s],b.addLabel(f),b.initializeWithLable(y);let C="right",v=l.buttonStyle;if(void 0!=v&&void 0!=v.globalColor&&(C=v.tipsAlign,r.applyButtonGlobalColor(b,v.globalColor)),u.length>s){t.tips.addTipsTarget(b);let e=CoUI.createTipInfo().setContent(u[s]);switch(C){case"top":b.info=e.alignTop();break;case"bottom":b.info=e.alignBottom();break;default:b.info=e.alignRight();break}}return b.setXY(e,i),b}}e.ButtonBuilder=r},"2a2b":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const l=s(i("75b9")),n=i("75f5");class r{constructor(t){this.m_infoObj=null,this.m_verMap=new Map,this.m_infoObj=t;const e=this.m_infoObj,i=this.m_verMap;let s=e.items;for(let l=0;l<s.length;++l){const t=s[l];if(i.set(t.name,t),t.type&&"dir"==t.type){let e=t.items;for(let t=0;t<e.length;++t){const s=e[t];i.set(s.name,s)}}}}filterUrl(t){let e=t.indexOf("/dracoLib/")>0;if(!e){let e=l.default.getFileName(t,!0);if(this.m_verMap.has(e)){let i=this.m_verMap.get(e);t+="?ver="+i.ver}}return t}}e.CoModuleVersion=r;class a extends n.ModuleLoader{constructor(t,e=null,i=null){super(t,e,null);let s=t=>{if(t.indexOf(".artvily.")>0)return t;let e=window.location.href;if(t=t.trim(),e.indexOf(".artvily.")>0){let s=t.lastIndexOf("/"),l=t.indexOf(".",s);e="http://www.artvily.com:9090/";let n=t.slice(s,l);return t.indexOf(".umd.")>0?(n=n.toLocaleLowerCase(),t=e+t.slice(0,s)+n+".js"):t=e+t,i&&(t=i.filterUrl(t)),t}return i&&(t=i.filterUrl(t)),t};this.setUrlChecker(s)}}e.CoModuleLoader=a},3120:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("2870");class l{constructor(){this.m_rsc=null,this.m_editUIRenderer=null,this.m_uirsc=null,this.m_coUIScene=null,this.viewer=null,this.m_navBtns=[],this.m_bgLabel=null}initialize(t,e,i){null==this.m_coUIScene&&(this.m_rsc=t,this.m_editUIRenderer=e,this.m_coUIScene=i,this.init())}init(){this.initUI()}initUI(){this.m_uirsc=this.m_coUIScene.rscene,this.initNavigationUI()}resize(t){let e=this.m_coUIScene.getStage();this.m_bgLabel.setScaleX(e.stageWidth/this.m_bgLabelW),this.m_bgLabel.setY(e.stageHeight-this.m_bgLabelH),this.m_bgLabel.update()}initNavigationUI(){let t=this.m_coUIScene,e=t.uiConfig,i=t.uiConfig.getUIPanelCfgByName("navigation"),l=0,n=0,r=i.btnTextAreaSize[0],a=i.btnTextAreaSize[1],o=this.m_coUIScene.getStage();this.m_btnGroup=CoUI.createSelectButtonGroup(),this.m_bgLabelW=o.stageWidth,this.m_bgLabelH=a;let h=CoUI.createColorLabel();h.initialize(this.m_bgLabelW,this.m_bgLabelH),h.setY(o.stageHeight-a),h.setColor(h.getColor().fromBytesArray3(i.bgColor)),t.addEntity(h),this.m_bgLabel=h;let m=CoRScene.EventBase;t.getStage().addEventListener(m.RESIZE,this,this.resize);let c=["file","edit","model","normal","texture","material","light","animation","particle","rendering","physics","help"],u=["文件","编辑","模型","法线","纹理","材质","灯光","动画","粒子","渲染","物理","帮助"],d=["File system operations.","Editing operations.","Geometry model operations.","Normal data operations.","Texture data operations.","Material system operations.","Light system operations.","Animation system operations.","Paiticle system operations.","Rendering system operations.","Physics system operations.","Help infomation."];u=i.btnNames,c=i.btnKeys,d=i.btnTips;let _=i.btnTypes;_||(_=new Array(c.length),_.fill(0));let p=t.layout.createLeftTopLayouter();l=0,n=o.stageHeight-a;for(let g=0;g<u.length;++g){const e=s.ButtonBuilder.createPanelBtnWithCfg(t,l+r*g,n,g,i);e.addEventListener(CoRScene.MouseEvent.MOUSE_UP,this,this.btnMouseUpListener),this.m_coUIScene.addEntity(e,1),this.m_navBtns.push(e),p.addUIEntity(e),1==_[g]&&this.m_btnGroup.addButton(e)}this.m_btnGroup.setSelectedFunction(t=>{e.applyButtonGlobalColor(t,"selected")},t=>{e.applyButtonGlobalColor(t,"common")}),this.m_coUIScene.prompt.setPromptListener(()=>{},()=>{}),this.m_coUIScene.updateLayout()}btnMouseUpListener(t){let e=t.uuid;switch(e){case"file":this.viewer.normalScene.entityScene.openDir();break;case"edit":case"model":case"texture":case"material":case"light":case"animation":case"particle":this.m_coUIScene.prompt.showPrompt("It can't be used now!");break;case"material":break;case"normal":let t=this.viewer.normalScene.normalCtrPanel;t.open();break;case"help":this.toHelp();break;default:break}}toHelp(){let t=document.createElement("a");t.href="https://blog.csdn.net/vily_lei/article/details/127544595?spm=1001.2014.3001.5501",t.target="_blank",document.body.appendChild(t),t.style="display: none",t.click(),t.remove()}run(){}}e.NVNavigationUI=l},3347:function(t,e,i){"use strict";var s,l,n;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["ctmParser"]="ctmGeomParser",t["objParser"]="objGeomParser",t["dracoParser"]="dracoGeomParser",t["pngParser"]="pngParser",t["fbxFastParser"]="fbxFastParser",t["threadCore"]="threadCore",t["coSpaceApp"]="coSpaceApp"}(s||(s={})),e.CoModuleNS=s,function(t){t["Undefined"]="undefined-format",t["CTM"]="ctm",t["Draco"]="draco",t["OBJ"]="obj",t["FBX"]="fbx",t["GLB"]="glb",t["Jpg"]="jpg",t["Png"]="png",t["Gif"]="gif"}(l||(l={})),e.CoDataFormat=l,function(t){t["JS"]="js-text",t["Binasy"]="binary"}(n||(n={})),e.CoModuleFileType=n},3914:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("67d8");class l extends s.ClipLabelBase{constructor(){super(),this.m_material=null}createMesh(t,e){let i=4,s=[0,1,2,0,2,3];const l=this.m_total;let n=new Uint16Array(6*l),r=new Float32Array(12*l),a=new Float32Array(8*l);this.m_sizes=new Array(2*l);let o=0;for(let m=0;m<l;++m){const l=t.getTexObjFromAtlas(e[m]);n.set(s,m*s.length),r.set(this.createVS(0,0,l.getWidth(),l.getHeight()),12*m),a.set(l.uvs,8*m);for(let t=0;t<s.length;++t)s[t]+=i;this.m_sizes[o++]=l.getWidth(),this.m_sizes[o++]=l.getHeight()}let h=CoMesh.createRawMesh();return h.reset(),h.setIVS(n),h.addFloat32Data(r,3),h.addFloat32Data(a,2),h.initialize(),h}hasTexture(){return!0}initialize(t,e){if(this.isIniting()&&null!=t&&null!=e&&e.length>0){this.init(),this.m_pos=CoMath.createVec3(),this.m_total=e.length;let i=t.getTexObjFromAtlas(e[0]),s=this.createMesh(t,e);this.m_vtCount=s.vtCount,this.m_material=this.createMaterial(i.texture),this.m_material.vtxInfo=CoRScene.createVtxDrawingInfo();let l=CoEntity.createDisplayEntity();l.setMaterial(this.m_material),l.setMesh(s),this.m_material.vtxInfo.setIvsParam(0,this.m_step),this.m_entities.push(l),this.applyRST(l),this.setClipIndex(0)}}initializeWithLable(t){if(this.isIniting()&&null!=t&&t!=this){if(t.getClipsTotal()<1)throw Error("Error: srcLable.getClipsTotal() < 1");this.init();let e=t.getREntities();for(let i=0;i<e.length;++i){let s=e[i],l=s.getMesh();this.m_pos=CoMath.createVec3();let n=s.getMaterial().getTextureAt(0),r=this.m_total=t.getClipsTotal();this.m_sizes=new Array(2*r);let a=0;for(let e=0;e<r;++e)this.m_sizes[a++]=t.getClipWidthAt(e),this.m_sizes[a++]=t.getClipHeightAt(e);this.m_vtCount=l.vtCount,this.m_material=this.createMaterial(n),this.m_material.vtxInfo=CoRScene.createVtxDrawingInfo();let o=CoEntity.createDisplayEntity();o.setMaterial(this.m_material),o.setMesh(l),this.m_material.vtxInfo.setIvsParam(0,this.m_step),this.m_entities.push(o),this.applyRST(o)}this.setClipIndex(0)}}displaceFromLable(t){if(null!=t&&t!=this&&t.getClipsTotal()<1)throw Error("Error: srcLable.getClipsTotal() < 1")}setColor(t){null!=this.m_material&&this.m_material.setColor(t)}getColor(t){null!=this.m_material&&this.m_material.getColor(t)}setClipIndex(t){if(t>=0&&t<this.m_total){this.m_index=t;let e=this.m_entities;for(let i=0;i<e.length;++i)e[i].getMaterial().vtxInfo.setIvsParam(t*this.m_step,this.m_step);t<<=1,this.m_width=this.m_sizes[t],this.m_height=this.m_sizes[t+1]}}}e.ClipLabel=l},"43c4":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("bb26");class l{constructor(){this.m_normalFlip=!1,this.m_showDifference=!1,this.m_color=null,this.m_normalScale=1,this.m_normalScale0=1,this.m_uid=-1,this.m_normalLine=null,this.groupUid=-1,this.entity=null}setLineVisible(t){t&&this.createNormalLine(),null!=this.m_normalLine&&this.m_normalLine.setVisible(t)}getLineVisible(){return null!=this.m_normalLine&&this.m_normalLine.getVisible()}setVisible(t){this.setLineVisible(t),this.entity.setVisible(t)}getUid(){return this.m_uid}getEntityMaterial(){return this.m_entityMaterial}showLocalNormal(){this.m_entityMaterial.applyLocalNormal(),this.m_entityMaterial.applyNormalColor()}showGlobalNormal(){this.m_entityMaterial.applyGlobalNormal(),this.m_entityMaterial.applyNormalColor()}showModelColor(t){t?this.m_entityMaterial.applyModelColor():this.m_entityMaterial.applyNormalColor()}showDifference(t=!0){this.m_showDifference=t,this.m_entityMaterial.applyDifference(t)}isShowDifference(){return this.m_showDifference}setEntityModel(t,e=null){if(null!=this.entity)return this.entity;this.m_color=CoRScene.createColor4();let i=l.s_entityBuilder,s=i.createNormalEntity(t,e);return this.m_entityMaterial=i.getEntityMaterial(),this.rsc.addEntity(s),this.readyCreateNormalLine(t),this.entity=s,this.m_uid=this.entity.getUid(),this.entity.mouseEnabled=!1,this.entity}select(){this.m_normalScale0=this.m_normalScale}applyNormalLineScale(t){t*=this.m_normalScale0,this.m_normalScale=t,null!=this.m_normalMaterial&&this.m_normalMaterial.setLength(t)}flipNormal(t){this.m_normalFlip=t;let e=t?-1:1;null!=this.m_normalMaterial&&this.m_normalMaterial.setScale(e),this.m_entityMaterial.setNormalScale(e)}isNormalFlipping(){return this.m_normalFlip}setNormalLineColor(t){null!=this.m_normalMaterial&&this.m_normalMaterial.setColor(t)}getNormalLineColor(){return this.m_color.setRGB3f(1,0,1),null!=this.m_normalMaterial&&this.m_normalMaterial.getColor(this.m_color),this.m_color}readyCreateNormalLine(t){this.m_model=t}createNormalLine(t=5){if(null==this.m_normalLine){let e=this.m_model,i=l.s_entityBuilder;this.m_normalLine=i.createNormalLineEntity(this.entity,e.vertices,e.normals,t),this.m_normalMaterial=i.getNormalLineMaterial(),this.m_normalScale=i.getNormalLineScale(),null!=this.m_normalLine.getMesh()&&this.rsc.addEntity(this.m_normalLine)}}applyEvent(){this.applyEvt(this.entity)}applyEvt(t){t.mouseEnabled=!0;let e=CoRScene.MouseEvent;t.addEventListener(e.MOUSE_OVER,this,this.mouseOverTargetListener),t.addEventListener(e.MOUSE_OUT,this,this.mouseOutTargetListener),t.addEventListener(e.MOUSE_DOWN,this,this.mouseDownTargetListener)}mouseClickTargetListener(t){}mouseDBClickTargetListener(t){}mouseOverTargetListener(t){this.m_entityMaterial.setRGB3f(.8,.8,.8)}mouseOutTargetListener(t){this.m_entityMaterial.setRGB3f(.7,.7,.7)}mouseDownTargetListener(t){let e=t.target;this.transUI.selectEntities([e])}setPosition(t){null!=this.entity&&this.entity.setPosition(t)}getPosition(t){return null!=this.entity?this.entity.getPosition(t):t}update(){null!=this.entity&&this.entity.update()}destroy(){this.rsc=null,null!=this.entity&&(this.rsc.removeEntity(this.entity),this.rsc.removeEntity(this.m_normalLine),this.entity.destroy(),this.m_normalLine.destroy(),this.entity=null,this.m_normalLine=null)}}l.s_entityBuilder=new s.NormalEntityBuilder,e.NormalEntityNode=l},4709:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_entity=null,this.m_pz=0,this.m_flag=!1,this.m_prePos=CoMath.createVec3(),this.m_currPos=CoMath.createVec3(),this.m_enabled=!1,this.bounds=CoMath.createAABB()}initialize(t){if(null==this.m_entity){this.m_rscene=t,this.m_entity=CoEntity.createDisplayEntity(),CoMesh.line.dynColorEnabled=!0;let e=CoMaterial.createLineMaterial(CoMesh.line.dynColorEnabled);CoMesh.line.setBufSortFormat(e.getBufSortFormat());let i=CoMesh.line.createRectXOY(0,0,1,1);this.m_entity.setMaterial(e),this.m_entity.setMesh(i),t.addEntity(this.m_entity),this.disable()}}enable(){this.m_enabled=!0}disable(){this.m_enabled=!1,this.setVisible(!1)}isEnabled(){return this.m_enabled}isSelectEnabled(){return this.m_flag&&this.m_enabled&&CoMath.Vector3D.Distance(this.m_prePos,this.m_currPos)>.98}setVisible(t){null!=this.m_entity&&this.m_entity.setVisible(t)}isVisible(){return null!=this.m_entity&&this.m_entity.getVisible()}setZ(t){this.m_pz=t}begin(t,e){this.m_flag=!0,this.m_enabled&&(this.m_prePos.setXYZ(t,e,this.m_pz),this.m_currPos.copyFrom(this.m_prePos),this.move(t,e))}end(t,e){this.m_enabled&&this.setVisible(!1),this.m_flag=!1}move(t,e){const i=this.m_prePos;if(this.m_enabled&&this.m_flag&&CoMath.Vector3D.DistanceXYZ(i.x,i.y,0,t,e,0)>1&&null!=this.m_entity){this.m_currPos.setXYZ(t,e,0),this.setVisible(!0);let i=this.bounds;i.reset(),i.addPosition(this.m_prePos),i.addXYZ(t,e,0),i.updateFast();let s=this.m_entity;s.setScaleXYZ(i.getWidth(),i.getHeight(),1),s.setPosition(i.min),s.update()}}}e.NVUIRectLine=s},"4f1c":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("9737"),l=i("a23c"),n=i("8468"),r=i("bb2b");class a{constructor(t,e){this.m_uiscene=null,this.m_dropController=new r.DropFileController,this.m_groups=[],this.entityManager=new l.NormalEntityManager,this.exampleGroup=new n.NormalExampleGroup,this.m_dropEnabled=!0,this.m_uiscene=t,this.m_coapp=e}getUIScene(){return this.m_uiscene}openDir(){const t=document.createElement("input");t.type="file",t.addEventListener("change",()=>{let e=Array.from(t.files);this.m_dropController.initFilesLoad(e)}),t.click()}initialize(t){this.rscene=t,this.entityManager.ctrPanel=this.ctrPanel,this.entityManager.transUI=this.transUI,this.entityManager.rsc=t,this.entityManager.initialize(),this.init(),this.entityManager.rsc=t,this.exampleGroup.entityManager=this.entityManager,this.exampleGroup.initialize(t,this.transUI);this.rscene.getCanvas();this.m_dropController.initialize(document.body,this)}resetScene(){}initModel(){let t="static/private/",e=t+"obj/base.obj";e=t+"obj/base4.obj",e=t+"fbx/base4.fbx",e=t+"fbx/hat_ok.fbx",this.loadModels([e])}loadModels(t,e=null){let i=new s.NormalEntityGroup(this.m_coapp);i.rsc=this.rscene,i.uiscene=this.m_uiscene,i.transUI=this.transUI,i.ctrPanel=this.ctrPanel,i.entityManager=this.entityManager,i.loadModels(t,e),this.m_groups.push(i),this.transUI.deselect(),this.exampleGroup.setEnabled(!1)}getAllEntities(){let t=this.m_groups,e=[];for(let i=0;i<t.length;++i)e=e.concat(t[i].getAllEntities());return e=e.concat(this.exampleGroup.getAllEntities()),e}initFileLoad(t){let e=[],i=[];for(let s=0;s<t.length;++s)t[s].resType==r.DropFileController.Geometry_Model_File&&(e.push(t[s].url),i.push(t[s].type));e.length>0&&this.loadModels(e,i)}isDropEnabled(){return this.m_dropEnabled}init(){}open(){}isOpen(){return!0}close(){}destroy(){this.entityManager.destroy()}update(){}}e.NormalEntityScene=a},5627:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_data=new Float32Array([1,1,1,1,0,0,1,1])}setNormalScale(t){this.m_data[6]=t}setRGB3f(t,e,i){this.m_data[0]=t,this.m_data[1]=e,this.m_data[2]=i}getRGB3f(t){let e=this.m_data;t.setRGB3f(e[0],e[1],e[2])}getRGBA4f(t){t.fromArray4(this.m_data)}setLength(t){this.m_data[3]=t}getLegnth(){return this.m_data[3]}setColor(t){t.toArray3(this.m_data)}getColor(t){t.fromArray3(this.m_data)}isApplyingLocalNormal(){return this.m_data[7]<.5}applyLocalNormal(){this.m_data[7]=0}isApplyingGlobalNormal(){return this.m_data[7]>.5}applyGlobalNormal(){this.m_data[7]=1}isApplyingModelColor(){return this.m_data[4]>=1}applyModelColor(){this.m_data[4]=1}applyNormalColor(){this.m_data[4]=0}applyDifference(t=!0){this.m_data[5]=t?1:0}create(){if(null==this.material){let t=!1,e=CoRScene.createShaderMaterial("normal_entity_material");e.addUniformDataAt("u_params",this.m_data),e.setShaderBuilder(t=>{let e=t.getShaderCodeBuilder();e.addVertLayout("vec2","a_uvs"),e.addVertLayout("vec3","a_nvs"),e.addVertLayout("vec3","a_nvs2"),e.addVertUniform("vec4","u_params",2),e.addFragUniform("vec4","u_params",2),e.addVarying("vec2","v_uv"),e.addVarying("vec4","v_nv"),e.addVarying("vec3","v_vnv"),e.addVarying("vec3","v_dv"),e.addFragOutputHighp("vec4","FragColor0"),e.addFragHeadCode("\n\t\t\t\tconst vec3 gama = vec3(1.0/2.2);\n\t\t\t\tconst vec3 direc0 = normalize(vec3(-0.3,-0.6,0.9));\n\t\t\t\tconst vec3 direc1 = normalize(vec3(0.3,0.6,0.9));\n\t\t\t\t\t"),e.addFragMainCode("\n\t\t\tbool facing = gl_FrontFacing;\n    \t\tvec2 dv = fract(gl_FragCoord.xy/vec2(5.0)) - vec2(0.5);\n    \t\tvec2 f2 = sign(dv);\n    \n    \t\tvec3 nv = normalize(v_nv.xyz);\n    \t\tvec3 color = nv;\n\n\t\t\tfloat nDotL0 = max(dot(v_vnv.xyz, direc0), 0.1);\n\t\t\tfloat nDotL1 = max(dot(v_vnv.xyz, direc1), 0.1);\n\t\t\t\n\t\t\tvec3 modelColor = u_params[0].xyz * vec3( 0.7 * (nDotL0 + nDotL1) );\n\t\t\tvec4 param = u_params[1];\n\n    \t\tvec3 frontColor = param.x > 0.5 ? modelColor : color.xyz;\n    \t\tvec3 backColor = param.y > 0.5 ? vec3(sign(f2.x * f2.y), 1.0, 1.0) : frontColor;\n    \t\tvec3 dstColor = facing ? frontColor : backColor;\n\t\t\t\n\t\t\tfrontColor = param.y > 0.5 ? dstColor : modelColor;\n\t\t\tdstColor = param.x > 0.5 ? frontColor : dstColor;\n\t\t\t\n\t\t\tfloat f = v_dv.x;\n\t\t\tf = f < 0.8 ? 1.0 : 0.0;\n\t\t\t// vec3 diffColor = vec3(1.0, 0.0, 0.0) * f + dstColor * (1.0 - f);\n\t\t\tfloat s = sign(f2.x * f2.y);\n\t\t\tvec3 diffColor = vec3(1.0, s, s) * f + dstColor * (1.0 - f);\n\t\t\tdstColor = param.y > 0.5 ? diffColor : dstColor;\n\t\t\t\n    \t\tFragColor0 = vec4(pow(dstColor, gama), 1.0);\n    \t\t// FragColor0 = vec4(u_params[0].xyz, 1.0);\n\t\t\t\t\t"),e.addVertMainCode("\n\t\t\tmat4 vmat = u_viewMat * u_objMat;\n\t\t\tviewPosition = vmat * vec4(a_vs,1.0);\n\t\t\tv_uv = a_uvs;\n\t\t\tvec3 pnv = u_params[1].zzz * a_nvs;\n\t\t\tv_dv = vec3(dot(normalize(a_nvs2), normalize( pnv )));\n\t\t\tvec4 pv = u_projMat * viewPosition;\t\t\t\n\t\t\tgl_Position = pv;\n\t\t\tv_vnv = normalize(pnv * inverse(mat3(vmat)));\n\t\t\tpnv = u_params[1].w < 0.5 ? pnv : normalize(pnv * inverse(mat3(u_objMat)));\n\t\t\tv_nv = vec4(pnv, 1.0);\n\t\t\t\t\t")}),e.initializeByCodeBuf(t),this.material=e}return this.material}}e.NormalEntityMaterial=s},"5b39":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.crossOrigin="anonymous"}setCrossOrigin(t){this.crossOrigin=t}async load(t,e,i=null,s=null,l="blob",n=""){if(null==e)throw Error("onload == null !!!");const r=new FileReader;r.onload=i=>{e&&e(r.result,t)};const a=new XMLHttpRequest;a.open("GET",t,!0),""!=n&&a.setRequestHeader("Range",n),a.responseType=l,a.onload=i=>{if(a.status<=206)switch(l){case"arraybuffer":case"blob":r.readAsArrayBuffer(a.response);break;case"json":e&&e(a.response,t);break;case"text":e&&e(a.response,t);break;default:e&&e(a.response,t);break}else s&&s(a.status,t)},null!=i&&(a.onprogress=e=>{let s=0;if(e.total>0||e.lengthComputable)s=Math.min(1,e.loaded/e.total);else{let t=parseInt(a.getResponseHeader("content-length"));t>0&&(t*=4,s=Math.min(1,e.loaded/t))}i(s,t)}),null!=s&&(a.onerror=e=>{s(a.status,t)}),a.send(null)}}e.HttpFileLoader=s},"5dcb":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("268d"),l=i("4709"),n=i("259d"),r=i("2870");class a{constructor(){this.m_rsc=null,this.m_editUIRenderer=null,this.m_uirsc=null,this.m_coUIScene=null,this.m_outline=null,this.m_transCtr=null,this.m_selectFrame=null,this.m_entityQuery=null,this.m_selectList=null,this.m_transBtns=[],this.entityScene=null,this.m_selectListeners=[],this.m_selectFilter=null}setOutline(t){this.m_outline=t}initialize(t,e,i){null==this.m_coUIScene&&(this.m_rsc=t,this.m_editUIRenderer=e,this.m_coUIScene=i,this.init())}getKeyInterac(){return this.m_keyInterac}getCoUIScene(){return this.m_coUIScene}init(){this.m_rsc.addEventListener(CoRScene.KeyboardEvent.KEY_DOWN,this,this.keyDown),this.m_rsc.addEventListener(CoRScene.MouseEvent.MOUSE_BG_CLICK,this,this.mouseClickListener),this.m_rsc.addEventListener(CoRScene.MouseEvent.MOUSE_UP,this,this.mouseUpListener,!0,!0);let t=this.m_editUIRenderer;this.m_transCtr=CoEdit.createTransformController(),this.m_transCtr.initialize(t),this.m_transCtr.addEventListener(s.UserEditEvent.EDIT_BEGIN,this,this.editBegin),this.m_transCtr.addEventListener(s.UserEditEvent.EDIT_END,this,this.editEnd),this.m_prevPos=CoMath.createVec3(),this.m_currPos=CoMath.createVec3(),this.m_keyInterac=CoUIInteraction.createKeyboardInteraction(),this.m_keyInterac.initialize(this.m_rsc),this.m_coUIScene.keyboardInteraction=this.m_keyInterac;let e=CoRScene.Keyboard,i=this.m_keyInterac.createKeysEventType([e.CTRL,e.Y]);this.m_keyInterac.addKeysDownListener(i,this,this.keyCtrlYDown),i=this.m_keyInterac.createKeysEventType([e.CTRL,e.Z]),this.m_keyInterac.addKeysDownListener(i,this,this.keyCtrlZDown),this.m_recoder=CoEdit.createTransformRecorder(),this.initUI()}keyCtrlZDown(t){this.m_recoder.undo();let e=this.m_recoder.getCurrList();if(null!=e){let t=!0;for(let i=0;i<e.length;++i)e[i].getVisible()||(t=!1);t&&this.selectEntities(e)}}keyCtrlYDown(t){this.m_recoder.redo();let e=this.m_recoder.getCurrList();this.selectEntities(e)}getRecoder(){return this.m_recoder}editBegin(t){let e=t.currentTarget.getTargetEntities(),i=this.m_rsc.getStage3D();this.m_prevPos.setXYZ(i.mouseX,i.mouseY,0),this.m_recoder.saveBegin(e)}editEnd(t){let e=this.m_rsc.getStage3D();if(this.m_currPos.setXYZ(e.mouseX,e.mouseY,0),CoMath.Vector3D.Distance(this.m_prevPos,this.m_currPos)>.5){let e=t.currentTarget.getTargetEntities();this.m_recoder.saveEnd(e)}else this.m_recoder.saveEnd(null)}initUI(){this.m_uirsc=this.m_coUIScene.rscene,this.m_entityQuery=new n.NVRectFrameQuery,this.m_entityQuery.initialize(this.m_rsc);let t=this.m_uirsc;this.m_rsc.addEventListener(CoRScene.MouseEvent.MOUSE_BG_DOWN,this,this.uiMouseDownListener),t.addEventListener(CoRScene.MouseEvent.MOUSE_UP,this,this.uiMouseUpListener),t.addEventListener(CoRScene.MouseEvent.MOUSE_MOVE,this,this.uiMouseMoveListener),null==this.m_selectFrame&&(this.m_selectFrame=new l.NVUIRectLine,this.m_selectFrame.initialize(this.m_uirsc),this.m_selectFrame.setZ(-.5),this.m_selectFrame.enable()),this.initTransUI()}initTransUI(){let t=this.m_coUIScene,e=t.uiConfig,i=e.getUIPanelCfgByName("transformCtrl");this.m_btnGroup=CoUI.createSelectButtonGroup();let s=i.btnTextAreaSize[0],l=i.btnTextAreaSize[1],n=i.btnNames,a=i.btnKeys,o=i.btnTypes;o||(o=new Array(a.length),o.fill(0));let h=5;s=i.btnSize[0],l=i.btnSize[1];let m=0,c="",u=CoUI.creatUIEntityContainer();u.initContainer();for(let _=0;_<n.length;++_){const e=r.ButtonBuilder.createPanelBtnWithCfg(t,h,m-l*_,_,i);u.addEntity(e),this.m_transBtns.push(e),1==o[_]?(""==c&&(c=a[_]),this.m_btnGroup.addButton(e)):e.addEventListener(CoRScene.MouseEvent.MOUSE_UP,this,this.btnMouseUpListener)}this.m_coUIScene.addEntity(u,1);let d=t.layout.createLeftTopLayouter();u.setY(t.getStage().stageHeight-5*l),d.addUIEntity(u),this.m_btnGroup.setSelectedFunction(t=>{e.applyButtonGlobalColor(t,"selected"),this.selectTrans(t.uuid)},t=>{e.applyButtonGlobalColor(t,"common")}),""!=c&&this.m_btnGroup.select(c)}btnMouseUpListener(t){switch(t.uuid){case"select_all":let t=this.entityScene.getAllEntities();this.selectEntities(t);break;case"select":break;default:break}}uiMouseDownListener(t){this.m_selectFrame.begin(t.mouseX,t.mouseY)}uiMouseUpListener(t){if(this.m_selectFrame.isSelectEnabled()){let t=this.m_selectFrame.bounds,e=this.m_entityQuery.getEntities(t.min,t.max);this.selectEntities(e)}this.m_selectFrame.end(t.mouseX,t.mouseY)}uiMouseMoveListener(t){this.m_selectFrame.move(t.mouseX,t.mouseY)}selectTrans(t){switch(t){case"move":this.m_transCtr.toTranslation();break;case"scale":this.m_transCtr.toScale();break;case"rotate":this.m_transCtr.toRotation();break;default:break}null==this.m_selectList&&this.m_transCtr.disable()}keyDown(t){let e=CoRScene.Keyboard;switch(t.keyCode){case e.W:this.m_btnGroup.select(this.m_transBtns[0].uuid);break;case e.R:this.m_btnGroup.select(this.m_transBtns[1].uuid);break;case e.E:this.m_btnGroup.select(this.m_transBtns[2].uuid);break;default:break}}addSelectFilter(t){this.m_selectFilter=t}addSelectListener(t){null!=t&&this.m_selectListeners.push(t)}sendSelectList(t){let e=this.m_selectListeners,i=e.length;for(let s=0;s<i;++s)e[s](t)}selectEntities(t){if(this.m_selectList=t,null!=t&&t.length>0){if(null!=this.m_selectFilter&&(t=this.m_selectFilter(t),this.m_selectList=t,null==t||t.length<1))return void(this.m_selectList=null);let e=this.m_transCtr,i=CoMath.createVec3(),s=CoMath.createVec3();for(let l=0;l<t.length;++l)i.addBy(s.copyFrom(t[l].getGlobalBounds().center));i.scaleBy(1/t.length),null!=e&&(e.select(t,i),this.m_outline.select(t)),this.sendSelectList(t)}else this.sendSelectList(null)}mouseUpListener(t){null!=this.m_transCtr&&this.m_transCtr.decontrol()}mouseClickListener(t){this.deselect()}deselect(){this.m_selectList=null,null!=this.m_transCtr&&this.m_transCtr.disable(),this.m_outline.deselect(),this.sendSelectList(null)}run(){null!=this.m_transCtr&&this.m_transCtr.run()}}e.NVTransUI=a},"67d8":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("b0fb");class l extends s.UIEntityBase{constructor(){super(),this.m_index=0,this.m_total=0,this.m_step=6,this.m_vtCount=0,this.m_sizes=null,this.uuid="label"}createVS(t,e,i,s){let l=t,n=e,r=t+i,a=e+s,o=0;return[l,n,o,r,n,o,r,a,o,l,a,o]}setClipIndex(t){}setCircleClipIndex(t){t%=this.m_total,t+=this.m_total,t%=this.m_total,this.setClipIndex(t)}getClipIndex(){return this.m_index}getClipsTotal(){return this.m_total}getClipWidthAt(t){return null==this.m_sizes?this.m_width:t>=0&&t<this.m_total?(t<<=1,this.m_sizes[t]):void 0}getClipHeightAt(t){return null==this.m_sizes?this.m_height:t>=0&&t<this.m_total?(t<<=1,this.m_sizes[t+1]):void 0}getClipWidth(){return this.m_width}getClipHeight(){return this.m_height}destroy(){this.m_sizes=null,this.m_total=0,super.destroy()}}e.ClipLabelBase=l},7228:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_entity=null,this.m_material=null}initializeWithAABB(t,e,i,s=null){this.initialize(t,e,i.min,i.max,s)}initialize(t,e,i,s,l=null){if(null==this.m_entity){e<0&&(e=0),null==l&&(l=CoMaterial.createColor4(.3,.3,.3,1)),this.m_rscene=t,this.m_entity=CoEntity.createDisplayEntity();let n=[i.x,i.y,i.z,i.x,i.y,s.z,i.x,i.y,i.z,s.x,i.y,i.z,i.x,i.y,s.z,s.x,i.y,s.z,s.x,i.y,i.z,s.x,i.y,s.z,i.x,i.y,i.z,i.x,s.y,i.z,i.x,i.y,s.z,i.x,s.y,s.z,s.x,i.y,i.z,s.x,s.y,i.z,s.x,i.y,s.z,s.x,s.y,s.z,i.x,s.y,i.z,i.x,s.y,s.z,i.x,s.y,i.z,s.x,s.y,i.z,i.x,s.y,s.z,s.x,s.y,s.z,s.x,s.y,i.z,s.x,s.y,s.z],r=new Float32Array(n);CoMesh.line.dynColorEnabled=!0,this.m_material=CoMaterial.createLineMaterial(CoMesh.line.dynColorEnabled),this.m_material.initializeByCodeBuf(!1),this.m_material.setColor(l),CoMesh.line.setBufSortFormat(this.m_material.getBufSortFormat());let a=CoMesh.line.createLinesWithFS32(r);this.m_entity.setMaterial(this.m_material),this.m_entity.setMesh(a),t.addEntity(this.m_entity,e)}}setVisible(t){null!=this.m_entity&&this.m_entity.setVisible(t)}isVisible(){return null!=this.m_entity&&this.m_entity.getVisible()}setPosition(t){null!=this.m_entity&&this.m_entity.setPosition(t)}setXYZ(t,e,i){null!=this.m_entity&&this.m_entity.setXYZ(t,e,i)}update(){null!=this.m_entity&&this.m_entity.update()}destroy(){null!=this.m_entity&&(this.m_entity.destroy(),this.m_entity=null),this.m_rscene=null}}e.BoxLine3D=s},7435:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("ab2b"),l=i("4f1c");class n{constructor(){this.m_uiscene=null,this.m_transUI=null,this.normalCtrPanel=null}getUIScene(){return this.m_uiscene}initialize(t,e,i){null==this.m_uiscene&&(this.m_uiscene=t,this.m_coapp=e,this.m_transUI=i,this.entityScene=new l.NormalEntityScene(t,e),i.entityScene=this.entityScene,this.m_entityManager=this.entityScene.entityManager,this.initUI(),this.entityScene.transUI=i)}initUI(){let t=this.m_uiscene.uiConfig,e=t.getUIPanelCfgByName("normalCtrlPanel"),i=e.panelSize,l=e.btnSize,n=new s.NormalCtrlPanel;n.initialize(this.m_uiscene,0,i[0],i[1],l[0],l[1]),n.setBGColor(t.createColorByData(e.bgColor)),n.addEventListener(CoRScene.SelectionEvent.SELECT,this,this.selectDisplay),n.addEventListener(CoRScene.ProgressDataEvent.PROGRESS,this,this.normalScale),this.normalCtrPanel=n,this.entityScene.ctrPanel=n}selectDisplay(t){let e=this.m_entityManager,i=t.uuid;switch(i){case"normal":case"model":case"difference":case"normalFlip":e.applyCtrlFlag(i,t.flag);break;case"local":case"global":case"modelColor":e.applyFeatureColor(i);break;case"normalScaleBtnSelect":e.normalScaleBtnSelect();break;case"normalLineColor":e.setNormalLineColor(t.data);break;case"normalTest":this.m_uiscene.prompt.showPrompt("It can't be used now!");break;default:break}}normalScale(t){let e=this.m_entityManager;e.applyNormalScale(t.progress)}destroy(){this.m_uiscene=null,null!=this.normalCtrPanel&&(this.normalCtrPanel.destroy(),this.normalCtrPanel=null,this.entityScene.destroy(),this.entityScene=null)}open(t=null){null!=this.normalCtrPanel&&this.normalCtrPanel.open()}isOpen(){return!0}close(){null!=this.normalCtrPanel&&this.normalCtrPanel.close()}update(){}}e.NormalViewerScene=n},"75b9":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static isEnabled(){let t=window.location.href;return t.indexOf(".artvily.com")>0}static filterUrl(t){if(t.indexOf("blob:")<0){let e=window.location.href;e.indexOf(".artvily.")>0&&(e="http://www.artvily.com:9090/",t=e+t)}return t}static getFileName(t,e=!1){if(t.indexOf("blob:")<0){let i=t.lastIndexOf("/");if(i<0)return"";let s=t.indexOf(".",i);if(s<0)return"";if(i+2<s){let l=t.slice(i+1,s);return e?l.toLocaleLowerCase():l}}return""}static getFileNameAndSuffixName(t,e=!1){if(t.indexOf("blob:")<0){let i=t.lastIndexOf("/"),s=t.indexOf(".",i);if(s<0)return"";let l=t.slice(i+1);return e?l.toLocaleLowerCase():l}return""}static getFileSuffixName(t,e=!1){if(t.indexOf("blob:")<0){let i=t.lastIndexOf("/"),s=t.indexOf(".",i);if(s<0)return"";let l=t.slice(s+1);return e?l.toLocaleLowerCase():l}return""}}e.default=s},"75f5":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("2564");class l extends s.PackedLoader{constructor(t,e=null,i=null){super(t,e,i)}loadData(t){let e=new XMLHttpRequest;e.open("GET",t,!0),e.onerror=function(t){},e.onload=i=>{this.loadedData(e.response,t),this.loadedUrl(t)},e.send(null)}loadedData(t,e){let i=document.createElement("script");i.onerror=t=>{},i.type="text/javascript";try{i.innerHTML=t,document.head.appendChild(i)}catch(s){throw s}}}e.ModuleLoader=l},"7c62":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("3347"),l=i("2a2b");class n{constructor(){this.m_init=!0,this.m_sysIniting=!0,this.m_initInsFlag=!0,this.m_initCalls=[]}initialize(t=null,e=!1){if(this.m_init){this.m_init=!1,this.m_sysInitCallback=t,this.m_deferredInit=e;let i=[{url:"static/cospace/core/coapp/CoSpaceApp.umd.js",name:s.CoModuleNS.coSpaceApp,type:s.CoModuleFileType.JS},{url:"static/cospace/core/code/ThreadCore.umd.js",name:s.CoModuleNS.threadCore,type:s.CoModuleFileType.JS},{url:"static/cospace/modules/ctm/ModuleCTMGeomParser.umd.js",name:s.CoModuleNS.ctmParser,type:s.CoModuleFileType.JS},{url:"static/cospace/modules/obj/ModuleOBJGeomParser.umd.js",name:s.CoModuleNS.objParser,type:s.CoModuleFileType.JS},{url:"static/cospace/modules/png/ModulePNGParser.umd.js",name:s.CoModuleNS.pngParser,type:s.CoModuleFileType.JS},{url:"static/cospace/modules/fbxFast/ModuleFBXGeomFastParser.umd.js",name:s.CoModuleNS.fbxFastParser,type:s.CoModuleFileType.JS}];this.m_modules=i;let n={nodes:[{uniqueName:"dracoGeomParser",path:"static/cospace/modules/draco/ModuleDracoGeomParser.umd.js"},{uniqueName:"dracoWasmWrapper",path:"static/cospace/modules/dracoLib/w2.js"},{uniqueName:"ctmGeomParser",path:"static/cospace/modules/ctm/ModuleCTMGeomParser.umd.js"}],maps:[{uniqueName:"dracoGeomParser",includes:[1]}]};this.m_dependencyGraphObj=n;let r=new l.CoModuleLoader(1),a=r.getUrlChecker();if(null!=a){for(let e=0;e<i.length;++e)i[e].url=a(i[e].url);let t=n.nodes;for(let e=0;e<t.length;++e)t[e].path=a(t[e].path)}e||this.loadSys()}}loadSys(){this.m_sysIniting&&(new l.CoModuleLoader(1,()=>{this.initCoSpaceSys()}).load(this.m_modules[0].url),this.m_sysIniting=!1)}getCPUDataByUrlAndCallback(t,e,i,s){if(null!=this.coappIns){let l=this.coappIns.getCPUDataByUrlAndCallback(t,e,i,s);if(this.m_deferredInit&&this.m_initInsFlag){this.m_initInsFlag=!1;let t=this.m_modules;this.coappIns.initialize(3,t[1].url,!0)}return l}return null}deferredInit(t){null==this.coappIns?(this.m_initCalls.push(t),this.loadSys()):null!=t&&t()}initCoSpaceSys(){if(null==this.coappIns&&"undefined"!==typeof CoSpaceApp){let t=CoSpaceApp.createInstance(),e=this.m_modules,i=JSON.stringify(this.m_dependencyGraphObj);t.setThreadDependencyGraphJsonString(i),t.setTaskModuleParams(e),this.m_deferredInit||t.initialize(3,e[1].url,!0);let s=this;s.coappIns=t;for(let l=0;l<this.m_initCalls.length;++l)null!=this.m_initCalls[l]&&this.m_initCalls[l]();this.m_initCalls=[]}null!=this.m_sysInitCallback&&this.m_sysInitCallback(),this.m_sysInitCallback=null}destroy(){}}e.CoDataModule=n,e.default=n},8468:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("43c4"),l=i("f953");class n extends l.NVEntityGroup{constructor(){super(),this.m_nodes=[],this.m_nodeEntities=[],this.m_textEntities=[],this.m_textHeight=130}createNodes(){let t=this.m_rscene.entityBlock.unitBox.getMesh(),e={uvsList:[t.getUVS().slice(0)],vertices:t.getVS().slice(0),normals:t.getNVS().slice(0),indices:t.getIVS().slice(0)},i=e,s=i.vertices;for(let b=0;b<s.length;++b)s[b]*=75;let l={uvsList:i.uvsList,vertices:i.vertices,normals:null,indices:i.indices},n=0,r=24,a=i.normals.slice(0);for(let b=n;b<r;++b)a[b]=1;let o={uvsList:i.uvsList,vertices:i.vertices,normals:a,indices:i.indices};a=i.normals.slice(0);let h=i.indices.slice(0);this.flipTriWrap(0,h),this.flipTriWrap(1,h),this.flipTriWrap(2,h),this.flipTriWrap(3,h);let m={uvsList:i.uvsList,vertices:i.vertices,normals:a,indices:h},c=this.m_transUI.getCoUIScene().uiConfig,u=c.getUIPanelCfgByName("exampleGroup"),d=u.items,_=this.m_textHeight,p=CoText.createH5Text(this.m_rscene,"text_cv_01",22,512,512),g=this.entityManager,y=CoRScene.createVec3(),f=this.createEntityWithModel(e,y.setXYZ(-70,0,70));g.addNode(f),y.y+=_,this.createStaticText(y,d[0].text,p),f=this.createEntityWithModel(l,y.setXYZ(-220,0,220)),g.addNode(f),y.y+=_,this.createStaticText(y,d[1].text,p),f=this.createEntityWithModel(o,y.setXYZ(70,0,-70)),f.showDifference(),f.showModelColor(!0),g.addNode(f),y.y+=_,this.createStaticText(y,d[2].text,p),f=this.createEntityWithModel(m,y.setXYZ(220,0,-220),i.indices),f.showDifference(),f.showModelColor(!0),g.addNode(f),y.y+=_,this.createStaticText(y,d[3].text,p)}flipTriWrap(t,e){let i=3*t,s=i+2,l=e[i];e[i]=e[s],e[s]=l}createEntityWithModel(t,e,i=null){let l=new s.NormalEntityNode;return l.rsc=this.m_rscene,l.transUI=this.m_transUI,l.setEntityModel(t,i),l.setPosition(e),l.update(),l.applyEvent(),this.m_nodeEntities.push(l.entity),this.m_nodes.push(l),l.groupUid=this.m_uid,l}createStaticText(t,e,i){let s=CoText.createStaticTextEntity(e,i);s.setPosition(t),s.update();let l=s.getREntity();this.m_rscene.addEntity(l,1),this.m_textEntities.push(l)}setEnabled(t){if(this.m_enabled!==t){let e=this.entityManager,i=this.m_nodes,s=this.m_textEntities;if(!t)for(let t=0;t<i.length;++t)e.removeNode(i[t]),i[t].setVisible(!1),this.m_rscene.removeEntity(s[t]);this.m_enabled=t}}getAllEntities(){let t=this.m_nodes,e=[];for(let i=0;i<t.length;++i)t[i].entity.isVisible()&&e.push(t[i].entity);return e}update(){}destroy(){if(this.entityManager=null,null!=this.m_rscene){let t=this.m_nodes,e=this.m_textEntities;if(null!=t&&t.length>0)for(let i=0;i<t.length;++i)this.entityManager.removeNode(t[i]),t[i].destroy(),this.m_rscene.removeEntity(e[i]),e[i].destroy();this.m_nodes=[],this.m_textEntities=[],this.entityManager=null,this.m_rscene=null,this.m_transUI=null}}run(){let t=this.m_nodes,e=this.m_textEntities,i=this.m_pv;for(let s=0;s<t.length;++s){let l=t[s].entity,n=l.getTransform(),r=e[s].getTransform();r.version!=n.version&&(l.getPosition(i),i.y+=this.m_textHeight,r.version,n.version,e[s].setPosition(i),e[s].update(),r.version=n.version)}}}e.NormalExampleGroup=n},8875:function(t,e,i){var s,l,n;(function(i,r){l=[],s=r,n="function"===typeof s?s.apply(e,l):s,void 0===n||(t.exports=n)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(d){var i,s,l,n=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,r=/@([^@]*):(\d+):(\d+)\s*$/gi,a=n.exec(d.stack)||r.exec(d.stack),o=a&&a[1]||!1,h=a&&a[2]||!1,m=document.location.href.replace(document.location.hash,""),c=document.getElementsByTagName("script");o===m&&(i=document.documentElement.outerHTML,s=new RegExp("(?:[^\\n]+?\\n){0,"+(h-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),l=i.replace(s,"$1").trim());for(var u=0;u<c.length;u++){if("interactive"===c[u].readyState)return c[u];if(c[u].src===o)return c[u];if(o===m&&c[u].innerHTML&&c[u].innerHTML.trim()===l)return c[u]}return null}}return t}))},"89c1":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("2a2b");class l{constructor(t,e=null){this.m_rscene=t;let i="static/cospace/renderEffect/occPostOutline/OccPostOutlineModule.umd.js";new s.CoModuleLoader(1,()=>{this.m_postOutline=OccPostOutlineModule.create(),this.initOutline(),this.m_rscene.appendRenderNode(this)},e).load(i)}initOutline(){this.m_postOutline.initialize(this.m_rscene,0,[0]),this.m_postOutline.setFBOSizeScaleRatio(.5),this.m_postOutline.setRGB3f(0,1,0),this.m_postOutline.setOutlineDensity(2),this.m_postOutline.setOcclusionDensity(.2)}select(t){null!=this.m_postOutline&&this.m_postOutline.setTargetList(t)}deselect(){null!=this.m_postOutline&&this.m_postOutline.setTargetList(null)}render(){null!=this.m_postOutline&&(this.m_postOutline.drawBegin(),this.m_postOutline.draw(),this.m_postOutline.drawEnd())}}e.CoPostOutline=l},9737:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("43c4"),l=i("3347"),n=i("f953"),r=i("7228"),a=i("ebc0");class o extends n.NVEntityGroup{constructor(t){super(),this.m_loadTotal=0,this.m_loadedTotal=0,this.m_nodes=[],this.m_layoutor=new a.CoEntityLayouter,this.m_coapp=t}initialize(t,e){}loadModels(t,e=null){if(null!=t&&t.length>0){let i=t.slice(0);this.m_coapp.deferredInit(()=>{for(let t=0;t<i.length;++t)this.loadModel(i[t],e?e[t]:"")})}}loadModel(t,e=""){let i=e;if(""==e){let e=t.lastIndexOf(".")+1,s=t.lastIndexOf("?");i=s<0?t.slice(e):t.slice(e,s)}i=i.toLocaleLowerCase();let s=l.CoDataFormat.Undefined;switch(i){case"obj":s=l.CoDataFormat.OBJ;break;case"fbx":s=l.CoDataFormat.FBX;break;case"drc":s=l.CoDataFormat.Draco;break;case"ctm":s=l.CoDataFormat.CTM;break;default:break}s!=l.CoDataFormat.Undefined&&this.loadGeomModel(t,s)}loadGeomModel(t,e){let i=this.m_coapp;if(null!=i){this.uiscene.prompt.getPromptPanel().applyConfirmButton(),this.uiscene.prompt.showPrompt("Model loading!"),this.m_loadTotal++;let s=i.getCPUDataByUrlAndCallback(t,e,(t,i)=>{e!=l.CoDataFormat.FBX&&this.createEntityFromModels(t.data.models,t.data.transforms),this.createEntityFromUnit(t,i)},!0);e==l.CoDataFormat.FBX&&(s.data.modelReceiver=(t,e,i,s)=>{this.createEntityFromModels(t,e)})}}createEntityFromModels(t,e){let i=[],s=t.length,l=[];for(let n=0;n<s;++n){const s=this.addEntityWithModel(t[n],null!=e?e[n]:null);null!=s&&(s.groupUid=this.getUid(),this.entityManager.addNode(s),l.push(s),this.m_nodes.push(s),i.push(s.entity))}this.updateLayout(!1)}getAllEntities(){let t=this.m_nodes,e=[];for(let i=0;i<t.length;++i)t[i].entity.isVisible()&&e.push(t[i].entity);return e}createEntityFromUnit(t,e=0){if(this.m_loadedTotal++,this.m_loadedTotal>=this.m_loadTotal){this.uiscene.prompt.getPromptPanel().applyConfirmButton(),this.uiscene.prompt.showPrompt("Model loading finish!");let t=this.m_nodes;for(let e=0;e<t.length;++e)t[e].applyEvent()}}buildBounds(){let t=this.m_nodes;for(let e=0;e<t.length;++e){let i=new r.BoxLine3D;i.initializeWithAABB(this.rsc,1,t[e].entity.getGlobalBounds(),CoMaterial.createColor4(1*Math.random()+.2,1*Math.random()+.2,1*Math.random()+.2))}}addEntityWithModel(t,e){if(null!=t){let i=new s.NormalEntityNode;i.rsc=this.rsc,i.transUI=this.transUI;let l=i.setEntityModel(t),n=null!=e?CoRScene.createMat4(e):null;return this.m_layoutor.layoutAppendItem(l,n),i}return null}updateLayout(t){this.m_layoutor.layoutUpdate(300,null,t)}destroy(){let t=this.m_nodes;if(null!=t&&t.length>0)for(let e=0;e<t.length;++e)this.entityManager.removeNode(t[e]),t[e].destroy();this.m_nodes=[],this.entityManager=null,this.uiscene=null,null!=this.m_layoutor&&(this.m_layoutor.layoutReset(),this.m_layoutor=null),this.rsc=null,null!=this.m_coapp&&(this.m_coapp=null)}}e.NormalEntityGroup=o},a23c:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_map=new Map,this.m_selectEntities=null,this.m_scaleBase=1,this.m_visible=!1}applyShiftKey(t){let e=this.m_map,i=null,s=t;for(let r=0;r<s.length;++r){const t=e.get(s[r].getUid());if(null!=t&&null==i){i=t;break}}if(null!=i){let s=i.groupUid;for(var[l,n]of(t=[],e.entries()))n.groupUid==s&&t.push(n.entity)}return t}applyCtrlKey(t){let e=t,i=null!=this.m_selectEntities?this.m_selectEntities:[];t=[];for(let s=0;s<e.length;++s){let l=0;for(;l<i.length;++l)if(e[s]==i[l])break;l>=i.length&&t.push(e[s])}for(let s=0;s<i.length;++s)t.push(i[s]);return t}initialize(){this.transUI.addSelectFilter(t=>{let e=this.transUI.getKeyInterac(),i=e.getCurrDownKeyCode();return 16==i?this.applyShiftKey(t):17==i?this.applyCtrlKey(t):t}),this.transUI.addSelectListener(t=>{this.setSelectedModelVisible(!0);let e=t;this.m_selectEntities=e,this.ctrPanel.setModelVisiFlag(null!=e&&e.length>0),this.testSelect()})}setVisible(t){if(this.m_visible!=t){this.m_visible=t;for(let[e,i]of this.m_map.entries())i.setVisible(t)}}testSelect(){let t=this.m_selectEntities;if(null!=t){let e=this.m_map,i=!1,s=!1,l=!1,n=this.ctrPanel,r=n.getNormalScale(),a=null,o=null;for(let h=0;h<t.length;++h){const n=e.get(t[h].getUid());null!=n&&(null==o&&(o=n),n.getLineVisible()&&(i=!0,null==a&&(a=n)),n.isShowDifference()&&(s=!0),n.isNormalFlipping()&&(l=!0),n.select())}if(this.m_scaleBase=r<.1?.1:r,n.setNormalFlag(i),n.setNormalFlipFlag(l),n.setDifferenceFlag(s),null!=a&&n.setNormalLineColor(a.getNormalLineColor()),null!=o){let t=o.getEntityMaterial();t.isApplyingModelColor()?n.setDisplayMode("modelColor"):t.isApplyingLocalNormal()?n.setDisplayMode("local"):n.setDisplayMode("global")}}}setSelectedNormalLineVisible(t){let e=this.m_selectEntities;if(null!=e){let i=this.ctrPanel,s=this.m_map,l=null;for(let n=0;n<e.length;++n){const i=s.get(e[n].getUid());null!=i&&(null==l&&(l=i),i.setLineVisible(t))}t&&i.setNormalLineColor(l.getNormalLineColor())}}setSelectedModelVisible(t){let e=this.m_selectEntities;if(null!=e){let i=this.m_map;for(let s=0;s<e.length;++s){const l=i.get(e[s].getUid());null!=l&&l.entity.setVisible(t)}}}setModelColor(t){let e=this.m_selectEntities;if(null!=e){let i=this.m_map;for(let s=0;s<e.length;++s){const l=i.get(e[s].getUid());null!=l&&l.showModelColor(t)}}}showNormalLocalColor(){let t=this.m_selectEntities;if(null!=t){let e=this.m_map;for(let i=0;i<t.length;++i){const s=e.get(t[i].getUid());null!=s&&s.showLocalNormal()}}}showNormalGlobalColor(){let t=this.m_selectEntities;if(null!=t){let e=this.m_map;for(let i=0;i<t.length;++i){const s=e.get(t[i].getUid());null!=s&&s.showGlobalNormal()}}}showDifferenceColor(t=!0){let e=this.m_selectEntities;if(null!=e){let i=this.m_map;for(let s=0;s<e.length;++s){const l=i.get(e[s].getUid());null!=l&&l.showDifference(t)}}}flipNormalLine(t){let e=this.m_selectEntities;if(null!=e){let i=this.m_map;for(let s=0;s<e.length;++s){const l=i.get(e[s].getUid());null!=l&&l.flipNormal(t)}}}normalScaleBtnSelect(){let t=this.m_selectEntities;if(null!=t){let e=this.m_map;this.ctrPanel;for(let i=0;i<t.length;++i){const s=e.get(t[i].getUid());null!=s&&s.select()}}}setNormalLineColor(t){let e=this.m_selectEntities;if(null!=e){let i=this.m_map;for(let s=0;s<e.length;++s){const l=i.get(e[s].getUid());null!=l&&l.setNormalLineColor(t)}}}applyFeatureColor(t){let e=this.m_selectEntities;if(null!=e&&e.length>0)switch(t){case"local":this.showNormalLocalColor();break;case"global":this.showNormalGlobalColor();break;case"modelColor":this.setModelColor(!0);break;case"normalTest":break;default:break}}applyCtrlFlag(t,e){let i=this.m_selectEntities;if(null!=i&&i.length>0)switch(t){case"normal":this.setSelectedNormalLineVisible(e);break;case"model":this.setSelectedModelVisible(e);break;case"difference":this.showDifferenceColor(e);break;case"normalFlip":this.flipNormalLine(e);break;default:break}}applyNormalScale(t){let e=this.m_selectEntities;if(null!=e&&e.length>0){let e=this.m_selectEntities;if(null!=e){let i=this.m_map;for(let s=0;s<e.length;++s){const l=i.get(e[s].getUid());null!=l&&l.applyNormalLineScale(t)}}}}addNode(t){if(null!=t){let e=this.m_map;t.getUid()>=0&&!e.has(t.getUid())&&e.set(t.getUid(),t)}}removeNode(t){if(null!=t){let e=this.m_map;t.getUid()>=0&&e.has(t.getUid())&&e.delete(t.getUid())}}destroy(){this.m_selectEntities=null,this.m_map.clear()}}e.NormalEntityManager=s},a889:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),document.demoState=1;class s{isEnabled(){return!0}}let l=window;l["VoxVerify"]=new s;const n=i("e9fd");let r=new n.DemoVox3DEditor,a=r;function o(){if(a.initialize(),a.run){function t(e){a.run(),window.requestAnimationFrame(t)}window.requestAnimationFrame(t)}}o()},ab2b:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("2870");class l{constructor(){this.m_btnW=90,this.m_btnH=50,this.m_normalScale=0,this.m_scene=null,this.m_panel=null,this.m_colorPickPanel=null,this.autoLayout=!0,this.m_dragging=!1,this.m_dragMinX=0,this.m_dragMaxX=0,this.m_progressLen=0,this.m_proBaseLen=100}getScene(){return this.m_scene}setBGColor(t){null==this.m_panel&&(this.m_panel=CoUI.createUIPanel()),this.m_panel.autoLayout=!1,this.m_panel.setBGColor(t)}initialize(t,e,i,s,l,n){null==this.m_scene&&(this.m_scene=t,this.m_rpi=e,this.m_panelW=i,this.m_panelH=s,this.m_btnW=l,this.m_btnH=n,this.m_v0=CoRScene.createVec3(),null==this.m_panel&&(this.m_panel=CoUI.createUIPanel()),this.m_panel.autoLayout=!1,this.m_panel.setUIscene(t),this.m_panel.setSize(i,s),this.buildPanel(i,s))}destroy(){this.m_scene=null,null!=this.m_selectDispatcher&&(this.m_selectDispatcher.destroy(),this.m_progressDispatcher.destroy(),this.m_selectDispatcher=null,this.m_progressDispatcher=null),this.m_progressEvt=null,this.m_modelVisiBtn=null,this.m_normalVisiBtn=null,this.m_diffBtn=null,this.m_normalFlipBtn=null,null!=this.m_panel&&(this.m_panel.destroy(),this.m_panel=null)}open(t=null,e=-1){this.m_panel.open(t),this.autoLayout&&(this.addLayoutEvt(),this.layout()),this.update()}isOpen(){return this.m_panel.isOpen()}close(){this.removeLayoutEvt(),this.m_panel.close(),null!=this.m_colorPickPanel&&(this.m_colorPickPanel.close(),this.m_colorPickPanel=null)}addEventListener(t,e,i,s=!0,l=!1){t==CoRScene.SelectionEvent.SELECT?this.m_selectDispatcher.addEventListener(t,e,i,s,l):t==CoRScene.ProgressDataEvent.PROGRESS&&this.m_progressDispatcher.addEventListener(t,e,i,s,l)}removeEventListener(t,e,i){t==CoRScene.SelectionEvent.SELECT?this.m_selectDispatcher.removeEventListener(t,e,i):t==CoRScene.ProgressDataEvent.PROGRESS&&this.m_progressDispatcher.removeEventListener(t,e,i)}buildPanel(t,e){this.m_selectDispatcher=CoRScene.createEventBaseDispatcher(),this.m_progressDispatcher=CoRScene.createEventBaseDispatcher(),this.m_progressEvt=CoRScene.createProgressDataEvent();let i=s.ButtonBuilder,l=this.m_scene,n=(l.transparentTexAtlas,CoMaterial.createColor4),r=this.m_scene.uiConfig,a=(r.getUIGlobalColor(),r.getUIPanelCfgByName("normalCtrlPanel")),o=(a.btnTextFontFormat,a.textFontFormat),h=a.items,m=10,c=this.m_panelH-10-this.m_btnH,u=5,d=5,_=m,p=0,g=CoRScene.MouseEvent,y=i.createPanelBtnWithCfg(l,m,c,0,a);_+=this.m_btnW;let f=i.createPanelBtnWithCfg(l,_,c,1,a);_+=this.m_btnW;let b=i.createPanelBtnWithCfg(l,_,c,2,a),C=this.m_panel;C.addEntity(y),C.addEntity(f),C.addEntity(b);let v=24;p=c-this.m_btnH-d+20;let M=this.createText(h[0].text,m+v+u,p,o);_=m,p=M.getY(),this.m_normalVisiBtn=this.createFlagBtn(v,_,p,"normal"),M=this.createText(h[1].text,m+v+u,p-10,o),p=M.getY(),this.m_modelVisiBtn=this.createFlagBtn(v,_,p,"model"),M=this.createText(h[2].text,m+v+u,p-10,o),p=M.getY(),this.m_diffBtn=this.createFlagBtn(v,_,p,"difference"),M=this.createText(h[3].text,m+v+u,p-10,o),p=M.getY(),this.m_normalFlipBtn=this.createFlagBtn(v,_,p,"normalFlip"),M=this.createText(h[4].text,m,p-15,o),_=m,p=M.getY(),this.m_dragBar=this.createProgressBtn(_+5,p-25,200),this.m_dragBar.setX(112),this.m_dragBar.update(),this.m_proBaseLen=97,p=this.m_dragBar.getY(),M=this.createText(h[5].text,m,p-10,o),_=m,p=M.getY();let S=[n().setRGB3Bytes(210,0,210),n().setRGB3Bytes(240,0,240),n().setRGB3Bytes(220,0,220),n().setRGB3Bytes(240,0,240)],E=this.createColorBtn(16,16,"normalLineColor",S);E.setXY(m+M.getWidth()+u,p+3),C.addEntity(E),_=m,p=M.getY()-d;let L=i.createPanelBtnWithCfg(l,_,p-y.getHeight(),3,a);C.addEntity(L),y.addEventListener(g.MOUSE_UP,this,this.normalDisplaySelect),f.addEventListener(g.MOUSE_UP,this,this.normalDisplaySelect),b.addEventListener(g.MOUSE_UP,this,this.normalDisplaySelect),L.addEventListener(g.MOUSE_UP,this,this.normalDisplaySelect),E.addEventListener(g.MOUSE_UP,this,this.normalLineColorSelect);let x=this.m_btnGroup=CoUI.createSelectButtonGroup();x.addButton(y),x.addButton(f),x.addButton(b),x.setSelectedFunction(t=>{r.applyButtonGlobalColor(t,"selected")},t=>{r.applyButtonGlobalColor(t,"light")}),this.m_btnGroup.select(f.uuid)}normalDisplaySelect(t){this.setDisplayMode(t.uuid,!0)}setDisplayMode(t,e=!1){e?this.sendSelectionEvt(t,e):this.m_btnGroup.select(t)}setNormalLineColor(t,e=!1){let i=t.clone().scaleBy(.9),s=t.clone().scaleBy(1.1);this.m_colorSelectLabel.setColors([i,s,i,i]),this.m_colorSelectLabel.setClipIndex(0),e&&this.sendSelectionEvt(this.m_normalLineColorBtn.uuid,!0,t.clone())}layoutPickColorPanel(){let t=this.m_colorPickPanel;if(null!=t&&t.isOpen()){this.m_normalLineColorBtn.update();let e=this.m_normalLineColorBtn.getGlobalBounds();t.setXY(e.max.x-t.getWidth(),e.max.y+2),t.setZ(this.getZ()+.3),t.update()}}normalLineColorSelect(t){let e=this.m_colorPickPanel;if(null!=e&&e.isOpen())e.close(),this.m_colorPickPanel=null;else{let t=this.m_scene.panel.getPanel("colorPickPanel");null!=t&&(t.isOpen()?t.close():(this.m_colorPickPanel=t,t.open(),this.layoutPickColorPanel(),t.setSelectColorCallback(t=>{this.setNormalLineColor(t,!0)})))}}selectVisibleFunc(t){this.sendSelectionEvt(t.uuid,t.flag)}createFlagBtn(t,e,i,s="model"){let l=this.getScene(),n=CoUI.createFlagButton();return n.uuid=s,n.initializeWithSize(l.texAtlas,t,t),n.setXY(e,i),n.addEventListener(CoRScene.SelectionEvent.SELECT,this,this.selectVisibleFunc),this.m_panel.addEntity(n),n}getNormalScale(){return this.m_normalScale}setNormalFlag(t){this.m_normalVisiBtn.setFlag(t)}setModelVisiFlag(t){this.m_modelVisiBtn.setFlag(t)}setDifferenceFlag(t){this.m_diffBtn.setFlag(t)}setNormalFlipFlag(t){this.m_normalFlipBtn.setFlag(t)}sendProgressEvt(t,e){let i=this.m_progressEvt;i.target=this,i.status=2,i.type=CoRScene.ProgressDataEvent.PROGRESS,i.minValue=0,i.maxValue=1,i.value=e,i.progress=e,i.phase=1,i.uuid=t,this.m_progressDispatcher.dispatchEvt(i),i.target=null}sendSelectionEvt(t,e,i=null){let s=CoRScene.createSelectionEvent();s.uuid=t,s.target=this,s.type=CoRScene.SelectionEvent.SELECT,s.flag=e,s.phase=1,s.data=i,this.m_selectDispatcher.dispatchEvt(s),s.target=null}createText(t,e,i,s){let l=this.getScene(),n=CoUI.createTextLabel();return n.depthTest=!0,n.transparent=!0,n.premultiplyAlpha=!0,n.initialize(t,l,s.fontSize),n.setColor(CoMaterial.createColor4().fromBytesArray3(s.fontColor)),n.setXY(e,i-n.getHeight()),n.update(),this.m_panel.addEntity(n),n}createProgressBtn(t,e,i){let s=this.getScene(),l=CoUI.createClipColorLabel();l.initializeWithoutTex(i,10,4),l.getColorAt(0).setRGB3Bytes(70,70,70),l.getColorAt(1).setRGB3f(.3,.3,.3),l.getColorAt(2).setRGB3Bytes(70,70,70),l.getColorAt(3).setRGB3Bytes(70,70,70);let n=CoUI.createButton();n.initializeWithLable(l),n.setZ(-.05),n.setXY(t,e),this.m_panel.addEntity(n),this.m_dragBgBar=n,n.addEventListener(CoRScene.MouseEvent.MOUSE_DOWN,this,this.progressBgMouseDown),this.m_progressLen=i-16,this.m_proBaseLen=this.m_progressLen,this.m_dragMinX=t,this.m_dragMaxX=t+this.m_progressLen;let r=CoUI.createClipColorLabel();r.initializeWithoutTex(16,16,4),r.getColorAt(0).setRGB3Bytes(130,130,130),r.getColorAt(1).setRGB3f(.2,1,.2),r.getColorAt(2).setRGB3f(.2,1,1);let a=CoUI.createButton();return a.initializeWithLable(r),a.setXY(t,e-3),this.m_panel.addEntity(a),a.addEventListener(CoRScene.MouseEvent.MOUSE_DOWN,this,this.progressMouseDown),s.addEventListener(CoRScene.MouseEvent.MOUSE_UP,this,this.progressMouseUp),a}progressMouseDown(t){this.m_dragging=!0;let e=this.getScene();this.sendSelectionEvt("normalScaleBtnSelect",!0),e.addEventListener(CoRScene.MouseEvent.MOUSE_MOVE,this,this.progressMouseMove)}progressMouseUp(t){this.m_dragging=!1;let e=this.getScene();e.removeEventListener(CoRScene.MouseEvent.MOUSE_MOVE,this,this.progressMouseMove)}progressBgMouseDown(t){let e=t.mouseX,i=t.mouseY,s=this.m_v0;s.setXYZ(e,i,0),this.m_panel.globalToLocal(s),e=s.x,e<this.m_dragMinX?e=this.m_dragMinX:e>this.m_dragMaxX&&(e=this.m_dragMaxX),this.m_dragBar.setX(e),this.m_dragBar.update(),this.m_proBaseLen=e-this.m_dragMinX}progressMouseMove(t){let e=t.mouseX,i=t.mouseY,s=this.m_v0;s.setXYZ(e,i,0),this.m_panel.globalToLocal(s),e=s.x,e<this.m_dragMinX?e=this.m_dragMinX:e>this.m_dragMaxX&&(e=this.m_dragMaxX),this.m_dragBar.setX(e),this.m_dragBar.update();let l=(e-this.m_dragMinX)/this.m_proBaseLen;this.m_normalScale=l,this.sendProgressEvt(t.uuid,l)}createColorBtn(t,e,i,s){let l=CoUI.createClipColorLabel();l.initializeWithoutTex(t,e,4),l.setColors(s),this.m_colorSelectLabel=l;let n=CoUI.createButton();return n.uuid=i,n.initializeWithLable(l),this.m_normalLineColorBtn=n,n}addLayoutEvt(){if(this.autoLayout){let t=this.getScene();if(null!=t){let e=CoRScene.EventBase;t.addEventListener(e.RESIZE,this,this.resize)}}}removeLayoutEvt(){if(this.autoLayout){let t=this.getScene();if(null!=t){let e=CoRScene.EventBase;t.removeEventListener(e.RESIZE,this,this.resize)}}}resize(t){this.layout()}layout(){let t=this.getScene();if(null!=t){let e=this.getGlobalBounds().getWidth(),i=t.getRect(),s=Math.round(i.width-e),l=Math.round(i.y+.5*(i.height-this.getHeight()));this.setXY(s,l),this.update(),this.layoutPickColorPanel()}}setZ(t){this.m_panel.setZ(t)}getZ(){return this.m_panel.getZ()}setXY(t,e){this.m_panel.setXY(t,e)}getGlobalBounds(){return this.m_panel.getGlobalBounds()}getWidth(){return this.m_panel.getWidth()}getHeight(){return this.m_panel.getHeight()}update(){this.m_panel.update()}}e.NormalCtrlPanel=l},b0fb:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_sc=null,this.m_parent=null,this.m_rotation=0,this.m_visible=!0,this.m_entities=[],this.m_width=0,this.m_height=0,this.m_v0=null,this.m_bounds=null,this.m_rcontainer=null,this.premultiplyAlpha=!1,this.transparent=!1,this.info=null,this.depthTest=!1}init(){this.isIniting()&&(this.m_pos=CoMath.createVec3(),this.m_scaleV=CoMath.createVec3(1,1,1),this.m_v0=CoMath.createVec3(),this.m_bounds=CoMath.createAABB())}isIniting(){return null==this.m_bounds}createMaterial(t=null){let e=CoMaterial.createDefaultMaterial();return e.premultiplyAlpha=this.premultiplyAlpha,null!=t&&e.setTextureList([t]),e.initializeByCodeBuf(null!=t),e}applyRST(t){const e=CoRScene.RendererState;this.transparent?this.premultiplyAlpha?t.setRenderState(e.BACK_ALPHA_ADD_ALWAYS_STATE):this.depthTest?t.setRenderState(e.BACK_TRANSPARENT_STATE):t.setRenderState(e.BACK_TRANSPARENT_ALWAYS_STATE):this.depthTest?t.setRenderState(e.NORMAL_STATE):t.setRenderState(e.BACK_NORMAL_ALWAYS_STATE)}createVS(t,e,i,s){let l=t,n=e,r=t+i,a=e+s,o=0;return[l,n,o,r,n,o,r,a,o,l,a,o]}updateScene(){}updateParent(){}__$setScene(t){this.m_sc!=t&&(this.m_sc=t,this.updateScene())}getScene(){return this.m_sc}setParent(t){return t!=this&&(this.m_parent=t,this.updateParent()),this}getParent(){return this.m_parent}getGlobalBounds(){return this.m_bounds}setVisible(t){this.m_visible=t;let e=this.m_entities;for(let i=0;i<e.length;++i)e[i].setVisible(t);null!=this.m_rcontainer&&this.m_rcontainer.setVisible(t)}isVisible(){return this.m_visible}getWidth(){return this.m_bounds.getWidth()}getHeight(){return this.m_bounds.getHeight()}setPosition(t){this.m_pos.copyFrom(t)}setX(t){this.m_pos.x=t}setY(t){this.m_pos.y=t}setZ(t){this.m_pos.z=t}getX(){return this.m_pos.x}getY(){return this.m_pos.y}getZ(){return this.m_pos.z}setXY(t,e){this.m_pos.x=t,this.m_pos.y=e}getPosition(t){return t.copyFrom(this.m_pos),t}setRotation(t){this.m_rotation=t}getRotation(){return this.m_rotation}setScaleXYZ(t,e,i){this.m_scaleV.setXYZ(t,e,i)}setScaleXY(t,e){this.setScaleXYZ(t,e,1)}setScaleX(t){this.m_scaleV.x=t}setScaleY(t){this.m_scaleV.y=t}getScaleX(){return this.m_scaleV.x}getScaleY(){return this.m_scaleV.y}copyTransformFrom(t){if(null!=t){let e=t.getScaleX(),i=t.getScaleY(),s=t.getRotation();this.setScaleXY(e,i),this.setRotation(s),t.getPosition(this.m_v0),this.setPosition(this.m_v0)}}getREntities(){return this.m_entities.slice(0)}getRContainer(){return this.m_rcontainer}updateEntity(t){t.setPosition(this.m_pos),t.setScale3(this.m_scaleV),t.setRotationXYZ(0,0,this.m_rotation),t.update(),this.m_bounds.union(t.getGlobalBounds())}update(){let t=this.m_entities,e=this.m_bounds;this.m_bounds.reset();for(let i=0;i<t.length;++i)this.updateEntity(t[i]);null!=this.m_rcontainer&&this.updateEntity(this.m_rcontainer),e.updateFast()}destroy(){let t=this.m_sc;null!=t&&t.removeEntity(this),this.m_rcontainer=null,this.m_sc=null,this.m_parent=null,this.m_bounds=null;let e=this.m_entities;for(let i=0;i<e.length;++i)e[i].destroy();e=[]}}e.UIEntityBase=s},bb26:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("d460"),l=i("5627");class n{constructor(){this.m_normalLineScale=1}getEntityMaterial(){return this.m_entityMaterial}getNormalLineMaterial(){return this.m_normalLineMaterial}getNormalLineScale(){return this.m_normalLineScale}createNormalEntity(t,e=null){this.m_entityMaterial=new l.NormalEntityMaterial;let i=this.m_entityMaterial.create();i.initializeByCodeBuf(!1),this.m_entityMaterial.setRGB3f(.7,.7,.7);let s=t.vertices,n=t.indices,r=n.length/3,a=new Float32Array(s.length);CoAGeom.SurfaceNormal.ClacTrisNormal(s,s.length,r,null!=e?e:n,a);let o=t.normals;null==o&&(o=new Float32Array(s.length));let h=this.createEntityMesh(t.indices,t.vertices,t.uvsList[0],o,a,i),m=CoRScene.createMouseEventEntity();return m.setMaterial(i),m.setMesh(h),m.setRenderState(CoRScene.RendererState.NONE_CULLFACE_NORMAL_STATE),m}createNormalLineEntity(t,e,i,l=5){let n=t.getMatrix(),r=n.decompose(CoMath.OrientationType.EULER_ANGLES),a=r[2].x;this.m_normalLineScale=l/a;let o=new s.NormalLineMaterial;if(o.setRGB3f(1,0,1),this.m_normalLineMaterial=o,this.m_normalLineMaterial.setLength(this.m_normalLineScale),null==i){let t=CoRScene.createDisplayEntity();return t.setVisible(!1),t}let h,m=CoMesh.line;m.dynColorEnabled=!0;let c=e,u=i,d=c.length/3,_=0,p=0,g=0,y=0,f=new Float32Array(6*d),b=new Float32Array(4*d),C=new Float32Array(6*d),v=CoRScene.createVec3(),M=CoRScene.createVec3();for(let s=0;s<d;++s){_=3*s,v.setXYZ(c[_],c[_+1],c[_+2]),M.setXYZ(u[_],u[_+1],u[_+2]),v.toArray(f,p),p+=3,v.toArray(f,p),p+=3,M.toArray(C,y),y+=3,M.toArray(C,y),y+=3;let t=g;b[t++]=0,b[t++]=0,b[t++]=1,b[t++]=1,g+=6}let S,E=o.create();return S=CoRScene.createDisplayEntity(t.getTransform()),h=this.createLineMesh(f,b,C,E),S.setMesh(h),S.setMaterial(E),S.setVisible(!1),S}createLineMesh(t,e,i,s){let l=CoMesh.createRawMesh();return l.ivsEnabled=!1,l.aabbEnabled=!0,l.reset(),l.setBufSortFormat(s.getBufSortFormat()),l.addFloat32Data(t,3),l.addFloat32Data(e,2),l.addFloat32Data(i,3),l.vbWholeDataEnabled=!1,l.initialize(),l.toArraysLines(),l.vtCount=Math.floor(t.length/3),l}createEntityMesh(t,e,i,s,l,n){let r=CoMesh.createRawMesh();return r.reset(),r.setBufSortFormat(n.getBufSortFormat()),r.setIVS(t),r.addFloat32Data(e,3),r.addFloat32Data(i,2),r.addFloat32Data(s,3),r.addFloat32Data(l,3),r.vbWholeDataEnabled=!1,r.initialize(),r}destroy(){this.m_entityMaterial=null,this.m_normalLineMaterial=null}}e.NormalEntityBuilder=n},bb2b:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_htmlObj=null,this.m_listener=null,this.m_files=null,this.imgKeys=["jpg","jpeg","png","gif","bmp","webp","jfif"],this.geomModelKeys=["obj","ctm","draco","drc","fbx"]}initialize(t,e){null==this.m_htmlObj&&(this.m_htmlObj=t,this.m_listener=e,this.initDrop(this.m_htmlObj))}initDrop(t){t.addEventListener("dragenter",t=>{t.preventDefault(),t.stopPropagation()},!1),t.addEventListener("dragover",t=>{t.preventDefault(),t.stopPropagation()},!1),t.addEventListener("dragleave",t=>{t.preventDefault(),t.stopPropagation()},!1),t.addEventListener("drop",t=>{t.preventDefault(),t.stopPropagation(),this.receiveDropFile(t)},!1)}receiveDropFile(t){if(this.m_files=null,this.m_listener.isDropEnabled()){let e=t.dataTransfer,i=[],s=0,l=0;if(void 0!==e.items){let t=e.items;for(let e=0;e<t.length;e++){let n=t[e],r=n.webkitGetAsEntry();if(null!=r)if(r.isFile){let t=n.getAsFile();i.push(t),this.initFilesLoad(i,"drop"),s=1}else if(r.isDirectory){let t=r.createReader();t.readEntries(t=>{s=t.length,s>0?t.forEach(t=>{t.isFile&&t.file(t=>{i.push(t),l++,s==l&&this.initFilesLoad(i,"drop")})}):this.alertShow(31)});break}if(s>0)break}this.m_files=i}}}alertShow(t){switch(t){case 31:alert("无法找到或无法识别对应的文件");break;default:break}}initFilesLoad(t,e="undefine"){this.m_files=null,this.m_listener&&(this.m_files=t,this.m_listener.initFileLoad(this.getFiles(),e))}testFile(t){let e=t.toLocaleLowerCase(),i="";return e.lastIndexOf(".")>0&&(i=e.slice(e.lastIndexOf(".")+1)),this.imgKeys.includes(i)?{name:t,type:i,resType:s.Image_File,url:""}:this.geomModelKeys.includes(i)?{name:t,type:i,resType:s.Geometry_Model_File,url:""}:null}getFiles(){let t=1,e=this.m_files;if(e){if(e.length>0){let t=[];for(let i=0;i<e.length;i++){let s=this.testFile(e[i].name);s&&(s.url=window.URL.createObjectURL(e[i]),t.push(s))}return t}t=31}return this.alertShow(t),null}}s.Image_File="image",s.Geometry_Model_File="geometryModel",e.DropFileController=s},bb62:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("67d8");class l extends s.ClipLabelBase{constructor(){super(...arguments),this.m_colors=null,this.m_material=null,this.m_fixSize=!0,this.m_hasTex=!1}createMesh(t,e){let i=new Uint16Array([0,1,2,0,2,3]),s=new Float32Array(this.createVS(0,0,this.m_width,this.m_height)),l=CoMesh.createRawMesh();if(l.reset(),l.setIVS(i),l.addFloat32Data(s,3),""!=e&&null!=t){let i=t.getTexObjFromAtlas(e),s=new Float32Array(i.uvs);l.addFloat32Data(s,2)}return l.initialize(),l}hasTexture(){return this.m_hasTex}initialize(t,e,i){if(this.isIniting()&&i>0){this.init(),this.m_hasTex=!1;let s=null;if(""!=e&&null!=t){let i=t.getTexObjFromAtlas(e);this.m_fixSize&&(this.m_width=i.getWidth(),this.m_height=i.getHeight()),this.m_hasTex=!0,s=i.texture}let l=this.createMaterial(s),n=this.createMesh(t,e),r=CoEntity.createDisplayEntity();r.setMaterial(l),r.setMesh(n),this.m_entities.push(r),this.m_material=l;let a=new Array(i);for(let t=0;t<i;++t)a[t]=CoMaterial.createColor4();this.m_colors=a,this.m_total=i,this.setClipIndex(0)}}initializeWithoutTex(t,e,i){this.m_width=t,this.m_height=e,this.m_fixSize=!1,this.initialize(null,"",i)}initializeWithSize(t,e,i,s,l){t>0&&e>0&&(this.m_width=t,this.m_height=e,this.m_fixSize=!1,this.initialize(i,s,l))}initializeWithLable(t){if(this.isIniting()&&null!=t&&t!=this){if(t.getClipsTotal()<1)throw Error("Error: srcLable.getClipsTotal() < 1");let e=t.getREntities();for(let i=0;i<e.length;++i){let s=e[i],l=s.getMesh(),n=s.getMaterial().getTextureAt(0),r=this.m_total=t.getClipsTotal(),a=t.getColors(),o=new Array(r);for(let t=0;t<r;++t)o[t]=CoMaterial.createColor4(),o[t].copyFrom(a[t]);this.m_colors=o,this.m_width=t.getWidth(),this.m_height=t.getHeight();let h=this.createMaterial(n),m=CoEntity.createDisplayEntity();m.setMaterial(h),m.setMesh(l),this.m_entities.push(m),null==this.m_material&&(this.m_material=h)}this.setClipIndex(0)}}displaceFromLable(t){if(null!=t&&t!=this&&t.getClipsTotal()<1)throw Error("Error: srcLable.getClipsTotal() < 1")}getColorAt(t){if(t>=0&&t<this.m_total)return this.m_colors[t]}setColorAt(t,e){t>=0&&t<this.m_total&&null!=e&&this.m_colors[t].copyFrom(e)}setColors(t){if(null!=t){let e=this.m_colors,i=t.length;i>e.length&&(i=e.length);for(let s=0;s<i;++s)e[s].copyFrom(t[s])}}setClipIndex(t){t>=0&&t<this.m_total&&(this.m_index=t,this.m_material.setColor(this.m_colors[t]))}getColors(){return this.m_colors}}e.ClipColorLabel=l},d460:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_data=new Float32Array([1,1,1,1]),this.m_scale=1}setRGB3f(t,e,i){this.m_data[0]=t,this.m_data[1]=e,this.m_data[2]=i}getRGB3f(t){let e=this.m_data;t.setRGB3f(e[0],e[1],e[2])}getRGBA4f(t){t.fromArray4(this.m_data)}setScale(t){this.m_scale=t}setLength(t){this.m_data[3]=this.m_scale*t}getLegnth(){return this.m_data[3]}setColor(t){t.toArray3(this.m_data)}getColor(t){t.fromArray3(this.m_data)}create(){if(null==this.material){let t=!1,e=CoRScene.createShaderMaterial("normal_dyn_line_material");e.addUniformDataAt("u_color",this.m_data),e.setShaderBuilder(t=>{let e=t.getShaderCodeBuilder();e.addVertLayout("vec2","a_uvs"),e.addVertLayout("vec3","a_nvs"),e.addVertUniform("vec4","u_color"),e.addFragUniform("vec4","u_color"),e.addFragOutputHighp("vec4","FragColor0"),e.addFragMainCode("\n\t\t\tFragColor0 = vec4(u_color.xyz, 1.0);\n\t\t\t\t\t"),e.addVertMainCode("\n\t\t\tviewPosition = u_viewMat * u_objMat * vec4(a_vs + u_color.www * a_nvs * a_uvs.xxx,1.0);\n\t\t\tvec4 pv = u_projMat * viewPosition;\n\t\t\t\n\t\t\tgl_Position = pv;\n\t\t\t\t\t")}),e.initializeByCodeBuf(t),this.material=e}return this.material}}e.NormalLineMaterial=s},d8b4:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("7435"),l=i("7c62");class n{constructor(){this.m_uiscene=null,this.m_codata=new l.CoDataModule,this.normalScene=null}getUIScene(){return this.m_uiscene}initialize(t,e){null==this.m_uiscene&&(this.m_codata.initialize(null,!0),this.m_uiscene=t,this.normalScene=new s.NormalViewerScene,this.normalScene.initialize(t,this.m_codata,e))}destroy(){this.m_uiscene=null,null!=this.normalScene&&(this.normalScene.destroy(),this.normalScene=null)}open(t=null){this.normalScene.open()}isOpen(){return!0}close(){this.normalScene.close()}update(){this.normalScene.update()}}e.NormalViewer=n},e9fd:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const l=i("89c1"),n=i("5dcb"),r=i("3120"),a=i("d8b4"),o=i("2a2b"),h=i("1c1e"),m=s(i("75b9")),c=i("5b39");class u{constructor(){this.m_bodyDiv=null,this.m_infoDiv=null}initUI(){document.body.style.background="#000000",null==this.m_bodyDiv&&(this.m_bodyDiv=document.createElement("div"),this.m_bodyDiv.style.width="100vw",this.m_bodyDiv.style.height="100vh",this.m_bodyDiv.style.zIndex="9999",this.elementCenter(this.m_bodyDiv),document.body.appendChild(this.m_bodyDiv),document.body.style.margin="0")}showInfo(t){null==this.m_infoDiv&&(this.m_infoDiv=document.createElement("div"),this.m_infoDiv.style.backgroundColor="rgba(255,255,255,0.1)",this.m_infoDiv.style.color="#00ee00",this.m_infoDiv.style.zIndex="10000",this.elementCenter(this.m_infoDiv),this.m_bodyDiv.appendChild(this.m_infoDiv)),this.m_infoDiv.innerHTML=t}showLoadProgressInfo(t){let e="loading "+Math.round(100*t)+"% ";this.showInfo(e)}showLoadStart(){this.showInfo("loading 0%")}showLoaded(){this.showInfo("100%")}loadFinish(t=0){null!=this.m_bodyDiv&&(this.m_bodyDiv.parentElement.removeChild(this.m_bodyDiv),this.m_bodyDiv=null)}elementCenter(t,e="50%",i="50%",s="absolute"){t.style.textAlign="center",t.style.display="flex",t.style.flexDirection="column",t.style.justifyContent="center",t.style.alignItems="center"}}class d{constructor(){}renderBegin(t){let e=t.getRenderProxy();e.clearDepth(1)}renderEnd(t){}}class _{constructor(){this.m_rsc=null,this.m_editUIRenderer=null,this.m_uirsc=null,this.m_coUIScene=null,this.m_interact=null,this.m_transUI=new n.NVTransUI,this.m_nvaUI=new r.NVNavigationUI,this.m_loadingUI=new u,this.m_viewer=null,this.m_verTool=null,this.m_graph=null}initialize(){document.oncontextmenu=function(t){t.preventDefault()},this.m_loadingUI.initUI(),this.m_loadingUI.showInfo("initializing rendering engine..."),this.loadInfo()}loadInfo(){let t="static/cospace/info.json";t=m.default.filterUrl(t);let e=new c.HttpFileLoader;e.load(t,(t,e)=>{this.m_verTool=new o.CoModuleVersion(t),this.initEngineModule()},null,null,"json")}initEngineModule(){let t="static/cospace/engine/uiInteract/CoUIInteraction.umd.js",e=new o.CoModuleLoader(2,()=>{this.initInteract()},this.m_verTool),i="static/cospace/engine/renderer/CoRenderer.umd.js",s="static/cospace/engine/rscene/CoRScene.umd.js",l="static/cospace/math/CoMath.umd.js",n="static/cospace/ageom/CoAGeom.umd.js",r="static/cospace/coedit/CoEdit.umd.js",a="static/cospace/comesh/CoMesh.umd.js",h="static/cospace/coentity/CoEntity.umd.js",m="static/cospace/particle/CoParticle.umd.js",c="static/cospace/coMaterial/CoMaterial.umd.js",u="static/cospace/cotexture/CoTexture.umd.js",d="static/cospace/coui/CoUI.umd.js",_="static/cospace/cotext/CoText.umd.js";new o.CoModuleLoader(2,()=>{this.isEngineEnabled()&&(this.initRenderer(),this.init3DScene(),this.m_loadingUI.showInfo("initializing editor system..."),new o.CoModuleLoader(3,()=>{new o.CoModuleLoader(7,()=>{this.initEditUI(),this.m_loadingUI.loadFinish(0)},this.m_verTool).load(n).load(r).load(h).load(m).load(u).load(d).load(_)},this.m_verTool).load(l).load(a).load(c))},this.m_verTool).addLoader(e).load(i).load(s),e.load(t)}initEditUI(){let t=new h.UIConfig,e="";CoRScene.RendererDevice.GetLanguage();e=CoRScene.RendererDevice.IsChineseLanguage()?"static/apps/normalViewer/ui/zh-CN/uicfg.json":"static/apps/normalViewer/ui/en-US/uicfg.json",t.initialize(e+"?ver="+Date.now(),()=>{this.m_coUIScene=CoUI.createUIScene(t,this.m_rsc,512,5);let e=this.m_coUIScene;this.m_uirsc=e.rscene,this.m_graph.addScene(this.m_uirsc),this.initEditSceneSys()})}initEditSceneSys(){let t=this.m_coUIScene;this.m_transUI.setOutline(this.m_outline),this.m_transUI.initialize(this.m_rsc,this.m_editUIRenderer,t),this.m_nvaUI.initialize(this.m_rsc,this.m_editUIRenderer,t);let e=CoMath.createVec3(-100,0,-100),i=e.clone().scaleBy(-1),s=10,l=CoEdit.createFloorLineGrid();l.initialize(this.m_rsc,0,e.scaleBy(s),i.scaleBy(s),30);let n=new a.NormalViewer;n.initialize(t,this.m_transUI),n.open(),this.m_viewer=n;let r=n.normalScene.entityScene;r.initialize(this.m_rsc),this.m_nvaUI.viewer=this.m_viewer}init3DScene(){}isEngineEnabled(){return"undefined"!==typeof CoRenderer&&"undefined"!==typeof CoRScene}initInteract(){let t=this.m_rsc;null!=t&&null==this.m_interact&&"undefined"!==typeof CoUIInteraction&&(this.m_interact=CoUIInteraction.createMouseInteraction(),this.m_interact.initialize(this.m_rsc,2,!0),this.m_interact.setSyncLookAtEnabled(!0))}initRenderer(){if(null==this.m_rsc){let t=CoRScene.RendererDevice;t.SHADERCODE_TRACE_ENABLED=!1,t.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,t.SetWebBodyColor("#606060");let e=CoRScene.createRendererSceneParam();e.setAttriAntialias(!t.IsMobileWeb()),e.setCamPosition(1e3,1e3,1e3),e.setCamProject(45,20,9e3);let i=CoRScene.createRendererScene(e,3);i.setClearRGBColor3f(.23,.23,.23),i.addEventListener(CoRScene.MouseEvent.MOUSE_DOWN,this,this.mouseDownListener),this.m_rsc=i;let s=this.m_rsc.createSubScene(e,3,!1);s.enableMouseEvent(!0),s.setAccessor(new d),this.m_editUIRenderer=s,this.m_graph=CoRScene.createRendererSceneGraph(),this.m_graph.addScene(this.m_rsc),this.m_graph.addScene(this.m_editUIRenderer),this.m_outline=new l.CoPostOutline(i,this.m_verTool),document.body.style.overflow="hidden"}}mouseUpListener(t){}mouseDownListener(t){}keyDown(t){let e=CoRScene.Keyboard;switch(t.keyCode){case e.S:break;default:break}}run(){null!=this.m_graph&&(null!=this.m_interact&&(this.m_interact.setLookAtPosition(null),this.m_interact.run()),null!=this.m_transUI&&this.m_transUI.run(),this.m_graph.run())}}e.DemoVox3DEditor=_,e.default=_},eb56:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("3914"),l=i("b0fb");class n extends l.UIEntityBase{constructor(){super(),this.m_enabled=!0,this.m_lb=null,this.m_lbs=[],this.uuid="btn"}addLabel(t){this.m_lbs.push(t)}enable(){return null!=this.m_dp&&(this.m_dp.enabled=!0),this.m_enabled=!0,this}disable(){return null!=this.m_dp&&(this.m_dp.enabled=!1),this.m_enabled=!1,this}isEnabled(){return this.m_enabled}setMouseEnabled(t){null!=this.m_entities&&(this.m_entities[0].mouseEnabled=t)}isMouseEnabled(){return null!=this.m_entities&&this.m_entities[0].mouseEnabled}initialize(t,e=null){if(this.isIniting()&&null!=t&&null!=e){if(this.init(),4!=e.length)throw Error("Error: idnsList.length != 4");let i=new s.ClipLabel;i.initialize(t,e),this.m_lb=i,this.initializeEvent(),this.m_lb.setClipIndex(0)}return this}initializeWithLable(t){if(this.isIniting()){if(this.init(),t.getClipsTotal()<1)throw Error("Error: lable.getClipsTotal() < 1");this.m_lb=t,this.initializeEvent(),this.m_lb.setClipIndex(0)}return this}getLable(){return this.m_lb}initializeEvent(){if(null==this.m_dp){const t=CoRScene.MouseEvent;let e=CoRScene.createMouseEvt3DDispatcher();e.currentTarget=this,e.uuid=this.uuid,e.enabled=this.m_enabled,e.addEventListener(t.MOUSE_DOWN,this,this.mouseDownListener),e.addEventListener(t.MOUSE_UP,this,this.mouseUpListener),e.addEventListener(t.MOUSE_OVER,this,this.mouseOverListener),e.addEventListener(t.MOUSE_OUT,this,this.mouseOutListener),this.m_lb.getREntities()[0].setEvtDispatcher(e),this.m_dp=e}this.m_entities=this.m_lb.getREntities().slice(0),this.m_entities[0].mouseEnabled=!0}setVisible(t){super.setVisible(t);let e=this.m_lbs;for(let i=0;i<e.length;++i)e[i].setVisible(t)}addEventListener(t,e,i,s=!0,l=!1){return this.m_dp.addEventListener(t,e,i,s,l),this}removeEventListener(t,e,i){return this.m_dp.removeEventListener(t,e,i),this}mouseOverListener(t){if(this.m_enabled){this.m_lb.setClipIndex(1);let t=this.m_lbs;if(t.length>0)for(let e=0;e<t.length;++e)t[e].setClipIndex(1)}}mouseOutListener(t){if(this.m_enabled){this.m_lb.setClipIndex(0);let t=this.m_lbs;if(t.length>0)for(let e=0;e<t.length;++e)t[e].setClipIndex(0)}}mouseDownListener(t){if(this.m_enabled){this.m_lb.setClipIndex(2);let t=this.m_lbs;if(t.length>0)for(let e=0;e<t.length;++e)t[e].setClipIndex(2)}}mouseUpListener(t){if(this.m_enabled){this.m_lb.setClipIndex(3);let t=this.m_lbs;if(t.length>0)for(let e=0;e<t.length;++e)t[e].setClipIndex(3)}}setClipIndex(t){return this.m_lb.setClipIndex(t),this}copyTransformFrom(t){if(null!=t){let e=t.getScaleX(),i=t.getScaleY(),s=t.getRotation();this.setScaleXY(e,i),this.setRotation(s),t.getPosition(this.m_v0),this.setPosition(this.m_v0)}}getREntities(){let t=this.m_lb.getREntities(),e=this.m_lbs;if(e.length>0){for(let i=0;i<e.length;++i)t=t.concat(e[i].getREntities());return t}return t}getRContainer(){return null}update(){this.m_bounds.reset();let t=this.m_scaleV,e=this.m_lb;e.setRotation(this.m_rotation),e.setScaleXY(t.x,t.y),e.setPosition(this.m_pos),e.update(),this.m_bounds.union(e.getGlobalBounds());let i=this.m_lbs;if(i.length>0)for(let s=0;s<i.length;++s)i[s].copyTransformFrom(this.m_lb),i[s].update(),this.m_bounds.union(i[s].getGlobalBounds());this.m_bounds.updateFast()}destroy(){let t=this.m_lb;null!=t&&(t.destroy(),t=null);let e=this.m_lbs;if(e.length>0){for(let t=0;t<e.length;++t)e[t].destroy();this.m_lbs=[]}null!=this.m_dp&&(this.m_dp.destroy(),this.m_dp=null),super.destroy()}}e.Button=n},ebc0:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_scaleV=null,this.m_tempMat=null,this.m_currMat=null,this.m_aabb=null,this.m_sizeScale=1,this.m_entities=[],this.m_transforms=[],this.rotationEnabled=!1}initialize(){null==this.m_scaleV&&(this.m_scaleV=CoRScene.createVec3(),this.m_tempMat=CoRScene.createMat4(),this.m_currMat=CoRScene.createMat4(),this.m_aabb=CoRScene.createAABB())}getAABB(){return this.m_aabb}layoutReset(){this.m_entities=[],this.m_transforms=[]}layoutAppendItem(t,e){this.m_entities.push(t),this.m_transforms.push(e)}layoutUpdate(t=300,e=null,i=!1){this.rotationEnabled=i;for(let s=0;s<this.m_entities.length;++s){let t=this.m_entities[s];t.setXYZ(0,0,0),t.setScaleXYZ(1,1,1),t.setRotationXYZ(0,0,0)}null==e&&(e=CoRScene.createVec3()),this.fixToPosition(this.m_entities,this.m_transforms,e,t)}calcAABB(t,e){this.initialize();let i=this.m_aabb;for(let s=0;s<t.length;++s)t[s].update(),s>0?i.union(t[s].getGlobalBounds()):i.copyFrom(t[s].getGlobalBounds());return i.update(),i}fixToPosition(t,e,i,s=300){this.initialize();let l,n=this.m_tempMat,r=this.m_currMat,a=this.m_aabb;for(let u=0;u<t.length;++u)l=e[u],n.identity(),this.rotationEnabled&&n.setRotationEulerAngle(.5*Math.PI,0,0),null!=l?(r.copyFrom(l),r.append(n),t[u].getTransform().setParentMatrix(r)):(r.copyFrom(n),t[u].getTransform().setParentMatrix(r)),t[u].update(),u>0?a.union(t[u].getGlobalBounds()):a.copyFrom(t[u].getGlobalBounds());a.update();let o=s/a.getWidth(),h=s/a.getHeight(),m=s/a.getLong();o=Math.min(o,h,m),this.m_sizeScale=o,this.m_scaleV.setXYZ(o,o,o),a.reset();for(let u=0;u<t.length;++u){l=e[u],n.identity(),n.setScale(this.m_scaleV),this.rotationEnabled&&n.setRotationEulerAngle(.5*Math.PI,0,0),null!=l?(r.copyFrom(l),r.append(n)):r.copyFrom(n);let i=r.decompose(CoMath.OrientationType.EULER_ANGLES);t[u].setScale3(i[2]),t[u].setRotation3(i[1]),t[u].setPosition(i[0]),t[u].getTransform().setParentMatrix(null),t[u].update(),u>0?a.union(t[u].getGlobalBounds()):a.copyFrom(t[u].getGlobalBounds())}a.update();let c=CoRScene.createVec3();c.subVecsTo(i,a.center),a.reset();for(let u=0;u<t.length;++u){let e=t[u].getPosition();e.addBy(c),t[u].setPosition(e),t[u].update(),u>0?a.union(t[u].getGlobalBounds()):a.copyFrom(t[u].getGlobalBounds())}a.update()}getSizeScale(){return this.m_sizeScale}}e.CoEntityLayouter=s},f953:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.m_uid=s.s_uid++,this.m_enabled=!0,this.m_pv=null,this.m_rscene=null,this.m_visible=!0,this.m_runFlag=-1}initialize(t,e){null==this.m_rscene&&(this.m_rscene=t,this.m_transUI=e,this.createNodes(),this.m_pv=CoRScene.createVec3(),t.runnableQueue.addRunner(this))}createNodes(){}getUid(){return this.m_uid}setVisible(t){this.m_visible=t}isVisible(){return this.m_visible}update(){}setRunFlag(t){this.m_runFlag=t}getRunFlag(){return this.m_runFlag}isRunning(){return this.m_enabled}isStopped(){return!this.m_enabled}run(){}}s.s_uid=0,e.NVEntityGroup=s},fae3:function(t,e,i){"use strict";i.r(e);i("1eb2");var s=i("a889");for(var l in s)["default"].indexOf(l)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(l)}})}));