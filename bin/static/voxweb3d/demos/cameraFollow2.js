(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["VoxApp"]=e():t["VoxApp"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s="fae3")}({"0236":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("a996")),a=i(s("1710")),h=i(s("7045")),n=i(s("3024")),l=i(s("badb"));class _{constructor(t,e){this.A=0,this.pixelRatio=1,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.B=0,this.C=0,this.D=1,this.E=1,this.F=new l.default,this.G=[],this.H=[],this.I=[],this.J=[],this.K=[],this.L=[],this.M=[],this.N=[],this.uProbe=null,this.O=0,this.P=0,this.Q=new a.default,this.R=!0,this.S=new r.default,this.A=t}getRCUid(){return this.A}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.B}getViewY(){return this.C}getViewWidth(){return this.D}getViewHeight(){return this.E}setViewPort(t,e,s,i){this.R=!1,this.B=t,this.C=e,s==this.D&&i==this.E||(this.D=s,this.E=i,this.updateViewUData())}updateViewUData(){null==this.uProbe&&(this.uProbe=new n.default(1),this.uProbe.bindSlotAt(this.A)),this.uProbe.setVec4Data(2/(this.D*this.pixelRatio),2/(this.E*this.pixelRatio),this.D*this.pixelRatio,this.E*this.pixelRatio),this.uProbe.update(),this.O=this.D,this.P=this.E}update(){this.O==this.stageWidth&&this.P==this.stageHeight||(this.R&&(this.D=this.stageWidth,this.E=this.stageHeight,this.updateViewUData()),this.stageHalfWidth=.5*this.stageWidth,this.stageHalfHeight=.5*this.stageHeight)}mouseDown(t=1){this.Q.type=a.default.MOUSE_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=t,this.F.dispatchEvt(this.Q)}mouseUp(t=1){this.Q.phase=1,this.Q.type=a.default.MOUSE_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=t,this.F.dispatchEvt(this.Q)}mouseClick(){this.Q.type=a.default.MOUSE_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseDoubleClick(){this.Q.type=a.default.MOUSE_DOUBLE_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightDown(t=1){this.Q.type=a.default.MOUSE_RIGHT_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightUp(t=1){this.Q.type=a.default.MOUSE_RIGHT_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgDown(){this.Q.type=a.default.MOUSE_BG_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgUp(){this.Q.type=a.default.MOUSE_BG_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightClick(){this.Q.type=a.default.MOUSE_RIGHT_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseMove(){this.Q.type=a.default.MOUSE_MOVE,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseWheel(t){this.Q.type=a.default.MOUSE_WHEEL,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.wheelDeltaY=t.wheelDeltaY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseCancel(){this.Q.type=a.default.MOUSE_CANCEL,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseMultiDown(t){this.Q.type=a.default.MOUSE_MULTI_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseMultiUp(t){this.Q.type=a.default.MOUSE_MULTI_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseMultiMove(t){this.Q.type=a.default.MOUSE_MULTI_MOVE,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseWindowUp(t=1){}mouseWindowRightUp(t=1){}enterFrame(){this.S.type=r.default.ENTER_FRAME;let t=this.I.length;for(var e=0;e<t;++e)this.I[e].call(this.J[e],this.S)}addEventListener(t,e,s,i=!0,a=!0){if(null!=s&&null!=e){let n=0;switch(t){case r.default.RESIZE:break;case r.default.ENTER_FRAME:for(n=this.I.length-1;n>=0;--n)if(e===this.J[n])break;n<0&&(this.J.push(e),this.I.push(s));break;case h.default.KEY_DOWN:break;case h.default.KEY_UP:break;default:this.F.addEventListener(t,e,s,i,a);break}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=0;switch(t){case r.default.RESIZE:for(i=this.G.length-1;i>=0;--i)if(e===this.H[i]){this.H.splice(i,1),this.G.splice(i,1);break}break;case r.default.ENTER_FRAME:for(i=this.I.length-1;i>=0;--i)if(e===this.J[i]){this.J.splice(i,1),this.I.splice(i,1);break}break;case h.default.KEY_DOWN:for(i=this.K.length-1;i>=0;--i)if(e===this.L[i]){this.L.splice(i,1),this.K.splice(i,1);break}break;case h.default.KEY_UP:for(i=this.M.length-1;i>=0;--i)if(e===this.N[i]){this.N.splice(i,1),this.M.splice(i,1);break}break;default:this.F.removeEventListener(t,e,s);break}}}}e.default=_},"030e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Initialize(t,e){let s=this;1==t?(s.OES_standard_derivatives=e.getExtension("OES_standard_derivatives"),s.OES_standard_derivatives,s.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),s.EXT_shader_texture_lod,s.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),s.WEBGL_draw_buffers,s.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),s.OES_vertex_array_object,s.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),s.ANGLE_instanced_arrays,s.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),s.EXT_color_buffer_float,s.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),s.EXT_color_buffer_half_float,s.OES_texture_half_float=e.getExtension("OES_texture_half_float"),s.OES_texture_half_float,s.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),s.OES_texture_half_float_linear,s.OES_texture_float=e.getExtension("OES_texture_float"),s.OES_texture_float,s.OES_element_index_uint=e.getExtension("OES_element_index_uint"),s.OES_element_index_uint,s.EXT_blend_minmax=e.getExtension("EXT_blend_minmax"),s.EXT_blend_minmax):(s.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),s.EXT_shader_texture_lod,s.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),s.EXT_color_buffer_half_float,s.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),s.OES_texture_half_float_linear,s.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),s.EXT_color_buffer_float),s.OES_texture_float_linear=e.getExtension("OES_texture_float_linear"),s.OES_texture_float_linear,s.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),s.WEBGL_depth_texture,s.WEBGL_debug_renderer_info=e.getExtension("WEBGL_debug_renderer_info"),s.WEBGL_debug_renderer_info}}i.OES_standard_derivatives=null,i.EXT_shader_texture_lod=null,i.WEBGL_draw_buffers=null,i.OES_vertex_array_object=null,i.ANGLE_instanced_arrays=null,i.EXT_color_buffer_float=null,i.EXT_color_buffer_half_float=null,i.OES_texture_float_linear=null,i.OES_texture_half_float_linear=null,i.OES_texture_half_float=null,i.OES_texture_float=null,i.OES_element_index_uint=null,i.EXT_blend_minmax=null,i.WEBGL_depth_texture=null,i.WEBGL_debug_renderer_info=null,e.default=i},"0644":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),h=i(s("2139"));class n{constructor(){this.T=h.default.GetMatrix(),this.U=new a.default,this.V=new a.default,this.W=0,this.X=!1,this.Y=null}destroy(){this.Y=null}bindCamera(t){this.Y=t,null!=t&&(this.V.copyFrom(this.Y.getPosition()),this.V.subtractBy(this.Y.getLookAtPosition()))}update(){null!=this.Y&&this.X&&(this.X=!1)}rotationOffsetAngleWorldY(t){this.W=t,this.X=!0,this.V.copyFrom(this.Y.getPosition()),this.V.subtractBy(this.Y.getLookAtPosition()),this.T.identity(),this.T.appendRotationY(this.W*r.default.MATH_PI_OVER_180),this.U.copyFrom(this.V),this.T.transformVectorSelf(this.U),this.U.addBy(this.Y.getLookAtPosition()),this.Y.lookAtRH(this.U,this.Y.getLookAtPosition(),a.default.Y_AXIS)}rotationOffsetAngleWordX(t){this.W=t,this.X=!0,this.V.copyFrom(this.Y.getPosition()),this.V.subtractBy(this.Y.getLookAtPosition()),this.T.identity(),this.T.appendRotationX(this.W*r.default.MATH_PI_OVER_180),this.U.copyFrom(this.V),this.T.transformVectorSelf(this.U),this.U.addBy(this.Y.getLookAtPosition()),this.Y.lookAtRH(this.U,this.Y.getLookAtPosition(),a.default.X_AXIS)}rotationOffsetAngleWordZ(t){this.W=t,this.X=!0,this.V.copyFrom(this.Y.getPosition()),this.V.subtractBy(this.Y.getLookAtPosition()),this.T.identity(),this.T.appendRotationZ(this.W*r.default.MATH_PI_OVER_180),this.U.copyFrom(this.V),this.T.transformVectorSelf(this.U),this.U.addBy(this.Y.getLookAtPosition()),this.Y.lookAtRH(this.U,this.Y.getLookAtPosition(),a.default.Z_AXIS)}}e.default=n},"065e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("402a")),a=i(s("29ef")),h=i(s("f63e")),n=i(s("e3f7"));class l extends r.default{constructor(t=null){super(t),this.Z=10,this.a=1,this.b=1,this.c=-.5,this.d=null,this.e=null,this.uScale=1,this.vScale=1,this.wireframe=!1,this.f=50,this.g=100}setVtxTransformMatrix(t){this.d=t}createMaterial(t){if(null==this.getMaterial()){let e=new h.default;e.setTextureList(t),this.setMaterial(e)}else null!=t&&this.getMaterial().getTextureTotal()<1&&this.getMaterial().setTextureList(t)}showDoubleFace(t=!0){t?this.setRenderState(a.default.NONE_CULLFACE_NORMAL_STATE):this.setRenderState(a.default.NORMAL_STATE)}toTransparentBlend(t=!1,e=!1){t?e?this.setRenderState(a.default.NONE_TRANSPARENT_ALWAYS_STATE):this.setRenderState(a.default.BACK_TRANSPARENT_ALWAYS_STATE):e?this.setRenderState(a.default.NONE_TRANSPARENT_STATE):this.setRenderState(a.default.BACK_TRANSPARENT_STATE)}toBrightnessBlend(t=!1,e=!1){t?e?this.setRenderState(a.default.NONE_ADD_ALWAYS_STATE):this.setRenderState(a.default.BACK_ADD_ALWAYS_STATE):e?this.setRenderState(a.default.NONE_ADD_BLENDSORT_STATE):this.setRenderState(a.default.BACK_ADD_BLENDSORT_STATE)}initialize(t,e,s,i,r=null,a=1,h=-.5){this.f=t,this.g=e,this.Z=s,this.a=i,this.b=a,this.c=h,this.createMaterial(r),this.activeDisplay()}__activeMesh(t){this.e=this.getMesh(),null==this.e&&(this.e=new n.default,null!=this.d&&this.e.setTransformMatrix(this.d),this.e.uScale=this.uScale,this.e.vScale=this.vScale,this.e.vbWholeDataEnabled=this.vbWholeDataEnabled,this.e.wireframe=this.wireframe,this.e.setBufSortFormat(t.getBufSortFormat()),this.e.initialize(this.f,this.g,this.Z,this.a,this.b,this.c),this.setMesh(this.e),this.e.setTransformMatrix(null)),this.d=null}reinitialize(){null!=this.e&&this.e.reinitialize()}getCircleCenterAt(t,e){null!=this.e&&this.e.getCircleCenterAt(t,e)}transformCircleAt(t,e){null!=this.e&&this.e.transformCircleAt(t,e)}toString(){return"[Pipe3DEntity(uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")]"}}e.default=l},"0706":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),h=s("6ba3"),n=s("200a");class l{constructor(){this.h=null,this.i=0,this.j=-30,this.U=new a.default,this.k=new a.default,this.l=new a.default,this.angleTweenY=new h.AngleDegreeTween,this.angleTweenZ=new h.AngleDegreeTween,this.posInterp=new n.PosInterpolation,this.angleTweenY.factor=.02,this.posInterp.minDis=200}updateView(){null!=this.h&&(this.h.setPosition(this.U),this.h.setRotationXYZ(this.j,this.i,0),this.h.update())}setCameraView(t){this.h=t}setViewPositionAndLookAt(t,e){this.U.copyFrom(t),this.k.copyFrom(e)}setViewParams(t,e,s){this.U.copyFrom(t),this.i=e,this.j=s,this.angleTweenY.setDegree(e),this.updateView()}moveToOnXOZ(t,e){this.posInterp.interpolate(t,this.U),this.l.subVecsTo(t,this.U),this.l.y=0,e=this.angleTweenY.calcDegree(360-r.default.GetDegreeByXY(this.l.x,this.l.z)),this.i=e,this.updateView()}}e.CameraViewFollower=l},"0714":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.m=null,this.n=new Map,this.o=[],this.p=null,this.q=null}setTextureList(t){this.q=t}getTextureList(){return this.q}getTextureTotal(){return null!=this.q?this.q.length:0}addShaderCode(t){this.m=t}hasShaderCode(){return null!=this.m}addPipe(t){let e=t.getPipeTypes();for(let s=0;s<e.length;++s)this.n.has(e[s])||this.n.set(e[s],t)}getPipeByType(t){return this.n.get(t)}hasPipeByType(t){return this.n.has(t)}createKeys(t){if(this.o=[],null!=t){let e,s,i=t;for(let t=0;t<i.length;++t)s=i[t],this.n.has(s)&&(e=this.n.get(s),this.o.push(e.getPipeKey(s)))}}buildSharedUniforms(t){if(this.p=[],null!=t){let e,s,i=t;for(let t=0;t<i.length;++t)s=i[t],this.n.has(s)&&(e=this.n.get(s),this.p.push(e.getGlobalUinform()))}}build(t,e){if(null!=this.m&&t.addShaderObject(this.m),null!=e){let s,i,r=e;for(let e=0;e<r.length;++e)i=r[e],this.n.has(i)&&(s=this.n.get(i),s.useShaderPipe(t,i))}}getSharedUniforms(){return this.p}getSelfUniformData(){return null}getKeys(){return this.o}getKeysString(){let t="";for(let e=0;e<this.o.length;++e)t+=this.o[e];return t}reset(){this.q=null}clear(){this.n=new Map,this.o=[],this.p=null,this.m=null}}e.MaterialPipeline=i},"0851":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("6e01")),h=i(s("da6a"));class n{constructor(t,e,s=!1){this.r=-1,this.s=0,this.t=null,this.u=null,this.v=-1,this.w=128,this.x=128,this.y=128,this.z=128,this.AA=r.TextureTarget.TEXTURE_2D,this.AB=-1,this.AC=!1,this.AD=r.TextureProxyType.Default,this.AE=!0,this.name="TextureProxy",this.internalFormat=r.TextureFormat.RGBA,this.srcFormat=r.TextureFormat.RGBA,this.dataType=r.TextureDataType.UNSIGNED_BYTE,this.wrap_s=r.TextureConst.WRAP_CLAMP_TO_EDGE,this.wrap_t=r.TextureConst.WRAP_CLAMP_TO_EDGE,this.wrap_r=r.TextureConst.WRAP_CLAMP_TO_EDGE,this.mipmapEnabled=!1,this.flipY=!1,this.premultiplyAlpha=!1,this.unpackAlignment=4,this.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,this.magFilter=r.TextureConst.LINEAR,this.version=0,this.u=h.default.GetInstance(),this.r=this.u.getFreeUid(),t<1&&(t=128),e<1&&(e=128),s?(this.w=a.default.CalcNearestCeilPow2(t),this.x=a.default.CalcNearestCeilPow2(e)):(this.w=t,this.x=e),this.u.__$$addTexture(this)}__$$use(t){t.bindToGpu(this.getResUid())}__$setRenderProxy(t){null!=this.u||(this.u=h.default.GetInstance(),this.r=this.u.getFreeUid(),this.u.__$$addTexture(this)),this.t=t}__$attachThis(){-1==this.s&&(this.u.removeFreeUid(this.getUid()),this.s=0),++this.s}__$detachThis(){this.s>0&&(--this.s,this.s<1&&(this.s=-1,this.u.addFreeUid(this.getUid())))}getAttachCount(){return this.s}isDirect(){return!0}getType(){return this.AD}getResUid(){return this.r}getUid(){return this.r}setWrap(t){this.wrap_s=this.wrap_t=this.wrap_r=t}isGpuEnabled(){return null!=this.t&&this.t.Texture.hasResUid(this.getResUid())}getSampler(){return this.AB}getTargetType(){return this.AA}getBufWidth(){return this.y}getBufHeight(){return this.z}getWidth(){return this.w}getHeight(){return this.x}isDataEnough(){return this.AC}uploadFromFbo(t,e,s){}__$buildParam(t){this.y=this.w,this.z=this.x,t.texParameteri(this.AB,t.TEXTURE_WRAP_S,r.TextureConst.GetConst(t,this.wrap_s)),t.texParameteri(this.AB,t.TEXTURE_WRAP_T,r.TextureConst.GetConst(t,this.wrap_t)),t.texParameteri(this.AB,t.TEXTURE_MIN_FILTER,r.TextureConst.GetConst(t,this.minFilter)),t.texParameteri(this.AB,t.TEXTURE_MAG_FILTER,r.TextureConst.GetConst(t,this.magFilter)),this.AA==r.TextureTarget.TEXTURE_3D&&(t.texParameteri(this.AB,t.TEXTURE_WRAP_R,r.TextureConst.GetConst(t,this.wrap_r)),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_BASE_LEVEL,0),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MAX_LEVEL,Math.log2(this.w))),this.mipmapEnabled&&this.AE&&t.generateMipmap(this.AB)}generateMipmap(t){if(this.mipmapEnabled&&this.AE){let e=t.getRC();t.bindToGpu(this.getResUid()),this.__$buildParam(e)}}uploadData(t){}__$updateToGpu(t){}updateDataToGpu(t=null,e=!0){null!=t&&(this.t=t),null!=this.t&&this.t.MaterialUpdater.updateTextureData(this,e)}createTexBuf(t){return!t.hasResUid(this.getResUid())&&(this.AB=r.TextureTarget.GetValue(t.getRC(),this.AA),t.createResByParams3(this.getResUid(),this.getWidth(),this.getHeight(),this.AB),!0)}__$$upload(t){if(this.AC&&null!=this.u){let e=this.createTexBuf(t);e&&(this.__$updateToGpuBegin(t),this.uploadData(t),this.__$buildParam(t.getRC()),this.AE=!0)}}dataUploadToGpu(t,e,s,i=!1){this.version=0;let a=r.TextureFormat.ToGL(t,this.internalFormat),h=r.TextureFormat.ToGL(t,this.srcFormat),n=r.TextureDataType.ToGL(t,this.dataType),l=e;if(null==s)(l.status>-1||i)&&l.updateToGpu(t,this.AB,a,h,n,i);else{let e=s;for(let s=0,r=e.length;s<r;++s)l=e[s],null!=l&&(l.status>-1||i)&&l.updateToGpu(t,this.AB,a,h,n,i);this.AE=!1}}__$updateToGpuBegin(t){let e=t.getRC();t.bindToGpu(this.getResUid()),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,this.unpackAlignment)}__$updateToGpuEnd(t){}isDestroyed(){return this.s<-1}__$destroy(){this.getAttachCount()<1&&(this.s=-2,this.AC=!1,this.w=1,this.x=1,this.t=null)}__$$removeFromSlot(){null!=this.u&&-2==this.getAttachCount()&&(this.u=null,this.t=null,this.r=-1)}toString(){return"[TextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.TextureProxy=n,e.default=n},"090c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3bda")),a=i(s("030e")),h=i(s("3b73")),n=i(s("b0ef")),l=i(s("0c85")),_=s("e08e");class m{constructor(){this.r=m.Kh++,this.AF=new l.default,this.AG=null,this.AH=null,this.AI=null,this.AJ=!1,this.AK=!0,this.AL=!0,this.AM=null,this.AN=null,this.AO=null,this.B=0,this.C=0,this.AP=800,this.AQ=600,this.AR=2,this.AS=2,this.AT=1,this.AU=new n.default,this.autoSyncRenderBufferAndWindowSize=!0,this.offscreenRenderEnabled=!1,this.AV=null,this.AW=0,this.AX=0,this.AY=0,this.AZ=0,this.Aa=null,this.Ab=null}contextrestoredHandler(t){}contextlostHandler(t){}setWebGLMaxVersion(t){1!=t&&2!=t||(this.AR=t)}getWebGLVersion(){return this.AS}getDiv(){return this.AG}setDivStyleLeftAndTop(t,e){this.AU.setDivStyleLeftAndTop(t,e)}setDivStyleSize(t,e){this.AU.setDivStyleSize(t,e)}getCanvas(){return this.AH}isDepthTestEnabled(){return this.AK}isStencilTestEnabled(){return this.AL}initialize(t,e,s,i=null){this.AO=e;var n=null,l=null;try{void 0!=document&&(n=document,l=window)}catch(o){}if(null!=n){this.AU.setDiv(s),this.AU.createViewEle(n,this.autoSyncRenderBufferAndWindowSize),this.AG=s=this.AU.getDiv();let o=this.AH=this.AU.getCanvas();this.AT=window.devicePixelRatio,this.AF.dpr=this.AT;let u=i;null==i?u={depth:this.AK,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:this.AL,preserveDrawingBuffer:!0,powerPreference:"default"}:(this.AK=u.depth,this.AL=u.stencil);let d=null;if(this.offscreenRenderEnabled&&(d=o.transferControlToOffscreen()),this.AM=d,2==this.AR&&(this.AN=null==d?o.getContext("webgl2",u):d.getContext("webgl2",u),null!=this.AN&&(this.AS=2)),null==this.AN&&(this.AN=null==d?o.getContext("webgl",u)||o.getContext("experimental-webgl",u):d.getContext("webgl",u)||d.getContext("experimental-webgl",u),null!=this.AN&&(this.AS=1)),!this.AN)throw this.AS=-1,alert("Unable to initialize WebGL. Your browser or machine may not support it."),Error("WebGL initialization failure.");let c=this.AN;c.rcuid=t;let f=_.GLStencilFunc;f.NEVER=c.NEVER,f.LESS=c.LESS,f.EQUAL=c.EQUAL,f.GREATER=c.GREATER,f.NOTEQUAL=c.NOTEQUAL,f.GEQUAL=c.GEQUAL,f.ALWAYS=c.ALWAYS;let p=_.GLStencilOp;p.KEEP=c.KEEP,p.ZERO=c.ZERO,p.REPLACE=c.REPLACE,p.INCR=c.INCR,p.INCR_WRAP=c.INCR_WRAP,p.DECR=c.DECR,p.DECR_WRAP=c.DECR_WRAP,p.INVERT=c.INVERT;let g=_.GLBlendMode;g.ZERO=c.ZERO,g.ONE=c.ONE,g.SRC_COLOR=c.SRC_COLOR,g.DST_COLOR=c.DST_COLOR,g.SRC_ALPHA=c.SRC_ALPHA,g.DST_ALPHA=c.DST_ALPHA,g.ONE_MINUS_SRC_ALPHA=c.ONE_MINUS_SRC_ALPHA;let T=_.GLBlendEquation;T.FUNC_ADD=c.FUNC_ADD,T.FUNC_SUBTRACT=c.FUNC_SUBTRACT,T.FUNC_REVERSE_SUBTRACT=c.FUNC_REVERSE_SUBTRACT,T.MIN_EXT=c.MIN_EXT,T.MAX_EXT=c.MAX_EXT,T.MIN=c.MIN,T.MAX=c.MAX;let v=_.CullFaceMode;v.BACK=c.BACK,v.FRONT=c.FRONT,v.FRONT_AND_BACK=c.FRONT_AND_BACK;let x=h.default;x.MAX_TEXTURE_SIZE=this.AN.getParameter(this.AN.MAX_TEXTURE_SIZE),x.MAX_RENDERBUFFER_SIZE=this.AN.getParameter(this.AN.MAX_RENDERBUFFER_SIZE);let E=this.AN.getParameter(this.AN.MAX_VIEWPORT_DIMS);x.MAX_VIEWPORT_WIDTH=E[0],x.MAX_VIEWPORT_HEIGHT=E[1],a.default.Initialize(this.AS,this.AN),h.default.Initialize([this.AS]),null!=e&&this.AF.initialize(o,s,e);let y=a.default.WEBGL_debug_renderer_info;if(null!=y){let t=this.AN.getParameter(y.UNMASKED_VENDOR_WEBGL),e=this.AN.getParameter(y.UNMASKED_RENDERER_WEBGL);x.GPU_VENDOR=t,x.GPU_RENDERER=t,r.default.ShowLog("webgl_vendor: "+t),r.default.ShowLog("webgl_renderer: "+e)}var m=this;l.onresize=function(t){m.autoSyncRenderBufferAndWindowSize&&m.updateRenderBufferSize()},o.addEventListener("webglcontextrestored",this.contextrestoredHandler,!1),o.addEventListener("webglcontextlost",this.contextlostHandler,!1),this.updateRenderBufferSize()}}loseContext(){null==this.AV&&(this.AV=this.AN.getExtension("WEBGL_lose_context")),null==this.AV&&this.AV.loseContext()}isContextLost(){return this.AN.isContextLost()}getRC(){return this.AN}setScissorEnabled(t){t?this.AJ||(this.AJ=!0,this.AN.enable(this.AN.SCISSOR_TEST)):this.AJ&&(this.AJ=!1,this.AN.disable(this.AN.SCISSOR_TEST))}setScissorRect(t,e,s,i){this.AN.scissor(t,e,s,i)}setResizeCallback(t,e){this.Ab=t,this.Aa=e}getDevicePixelRatio(){return this.AT}resizeBufferSize(t,e){t=Math.floor(t),e=Math.floor(e);let s=window.devicePixelRatio,i=Math.abs(s-this.AT)>.02;this.AT=s,this.AF.dpr=s,h.default.SetDevicePixelRatio(this.AT),(this.AW!=t||this.AX!=e||i)&&(this.AW=t,this.AX=e,this.AY=Math.floor(t*s),this.AZ=Math.floor(e*s),null==this.AM?(this.AH.width=this.AY,this.AH.height=this.AZ):(this.AM.width=this.AY,this.AM.height=this.AZ),this.AH.style.width=this.AW+"px",this.AH.style.height=this.AX+"px",null!=this.AO&&(this.AO.stageWidth=this.AY,this.AO.stageHeight=this.AZ,this.AO.viewWidth=this.AW,this.AO.viewHeight=this.AX,this.AO.pixelRatio=s,this.AO.update()),null!=this.Aa&&this.Aa.call(this.Ab))}getStage(){return this.AO}getStageWidth(){return this.AO.stageWidth}getStageHeight(){return this.AO.stageHeight}getDisplayWidth(){return this.AW}getDisplayHeight(){return this.AX}setViewport(t,e,s,i){let r=this.B!=t||this.C!=e;(this.AP!=s||this.AQ!=i||r)&&(this.B=t,this.C=e,this.AP=s,this.AQ=i)}setViewportSize(t,e){this.AP==t&&this.AQ==e||(this.AP=t,this.AQ=e)}testViewPortChanged(t,e,s,i){return this.B!=t||this.C!=e||this.AP!=s||this.AQ!=i}getViewportX(){return this.B}getViewportY(){return this.C}getViewportWidth(){return this.AP}getViewportHeight(){return this.AQ}getFBOWidth(){return this.AP<h.default.MAX_RENDERBUFFER_SIZE?this.AP:h.default.MAX_RENDERBUFFER_SIZE}getFBOHeight(){return this.AQ<h.default.MAX_RENDERBUFFER_SIZE?this.AQ:h.default.MAX_RENDERBUFFER_SIZE}getRCanvasWidth(){return this.AY}getRCanvasHeight(){return this.AZ}updateRenderBufferSize(){let t=this.AG.getBoundingClientRect();this.resizeBufferSize(t.width,t.height)}}m.Kh=0,e.default=m},"0929":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("2139")),h=i(s("9156"));class n{constructor(){this.r=0,this.Ac=new Float32Array(16),this.Ad=!1,this.Ae=!1,this.updatedStatus=n.UPDATE_POSITION,this.updateStatus=n.UPDATE_TRANSFORM,this.Af=null,this.Ag=null,this.Ah=null,this.Ai=null,this.Aj=!0,this.Ak=null,this.r=n.Kh++}getUid(){return this.r}getRotationFlag(){return this.Ae}getX(){return this.Ac[12]}getY(){return this.Ac[13]}getZ(){return this.Ac[14]}setX(t){this.updateStatus|=1,this.updatedStatus|=1,this.Ac[12]=t}setY(t){this.updateStatus|=1,this.updatedStatus|=1,this.Ac[13]=t}setZ(t){this.updateStatus|=1,this.updatedStatus|=1,this.Ac[14]=t}setXYZ(t,e,s){this.Ac[12]=t,this.Ac[13]=e,this.Ac[14]=s,this.updateStatus|=1,this.updatedStatus|=1}offsetPosition(t){this.Ac[12]+=t.x,this.Ac[13]+=t.y,this.Ac[14]+=t.z,this.updateStatus|=1,this.updatedStatus|=1}setPosition(t){this.Ac[12]=t.x,this.Ac[13]=t.y,this.Ac[14]=t.z,this.updateStatus|=1,this.updatedStatus|=1}getPosition(t){t.x=this.Ac[12],t.y=this.Ac[13],t.z=this.Ac[14]}copyPositionFrom(t){null!=t&&(this.Ac[12]=t.Ac[12],this.Ac[13]=t.Ac[13],this.Ac[14]=t.Ac[14],this.updateStatus|=n.UPDATE_POSITION,this.updatedStatus|=n.UPDATE_POSITION)}getRotationX(){return this.Ac[1]}getRotationY(){return this.Ac[6]}getRotationZ(){return this.Ac[9]}setRotationX(t){this.Ac[1]=t,this.Ae=!0,this.updateStatus|=n.UPDATE_ROTATION,this.updatedStatus|=n.UPDATE_ROTATION}setRotationY(t){this.Ac[6]=t,this.Ae=!0,this.updateStatus|=n.UPDATE_ROTATION,this.updatedStatus|=n.UPDATE_ROTATION}setRotationZ(t){this.Ac[9]=t,this.Ae=!0,this.updateStatus|=n.UPDATE_ROTATION,this.updatedStatus|=n.UPDATE_ROTATION}setRotationXYZ(t,e,s){this.Ac[1]=t,this.Ac[6]=e,this.Ac[9]=s,this.updateStatus|=n.UPDATE_ROTATION,this.updatedStatus|=n.UPDATE_ROTATION,this.Ae=!0}getScaleX(){return this.Ac[0]}getScaleY(){return this.Ac[5]}getScaleZ(){return this.Ac[10]}setScaleX(t){this.Ac[0]=t,this.updateStatus|=n.UPDATE_SCALE,this.updatedStatus|=n.UPDATE_SCALE}setScaleY(t){this.Ac[5]=t,this.updateStatus|=n.UPDATE_SCALE,this.updatedStatus|=n.UPDATE_SCALE}setScaleZ(t){this.Ac[10]=t,this.updateStatus|=n.UPDATE_SCALE,this.updatedStatus|=n.UPDATE_SCALE}setScaleXYZ(t,e,s){this.Ac[0]=t,this.Ac[5]=e,this.Ac[10]=s,this.updateStatus|=n.UPDATE_SCALE,this.updatedStatus|=n.UPDATE_SCALE}setScale(t){this.Ac[0]=t,this.Ac[5]=t,this.Ac[10]=t,this.updateStatus|=n.UPDATE_SCALE,this.updatedStatus|=n.UPDATE_SCALE}getRotationXYZ(t){t.x=this.Ac[1],t.y=this.Ac[6],t.z=this.Ac[9]}getScaleXYZ(t){t.x=this.Ac[0],t.y=this.Ac[5],t.z=this.Ac[10]}localToGlobal(t){this.getMatrix().transformVectorSelf(t)}globalToLocal(t){this.getInvMatrix().transformVectorSelf(t)}getInvMatrix(){return null!=this.Ak?this.Ad&&(this.Ak.copyFrom(this.Af),this.Ak.invert()):(this.Ak=a.default.GetMatrix(),this.Ak.copyFrom(this.Af),this.Ak.invert()),this.Ad=!1,this.Ak}getLocalMatrix(){return this.updateStatus>0&&this.update(),this.Ag}getMatrix(t=!0){return this.updateStatus>0&&t&&this.update(),this.Af}getToParentMatrix(){return null!=this.Ai?this.Ai:this.Af}setParentMatrix(t){this.Ah=t,this.Ad=!0,null!=this.Ah&&(this.Ag==this.Af?(this.updateStatus=n.UPDATE_TRANSFORM,this.updatedStatus=this.updateStatus,this.Ag=a.default.GetMatrix()):(this.updateStatus|=n.UPDATE_PARENT_MAT,this.updatedStatus=this.updateStatus))}updateMatrixData(t){null!=t&&(this.updateStatus=n.UPDATE_NONE,this.Ad=!0,this.Af.copyFrom(t))}__$setMatrix(t){null!=t&&(this.updateStatus=n.UPDATE_NONE,this.Ad=!0,this.Ag==this.Af&&(this.Ag=t),null!=this.Af&&(h.default.RemoveTransUniform(this.Af),a.default.RetrieveMatrix(this.Af)),this.Af=t)}destroy(){null!=this.Ak&&a.default.RetrieveMatrix(this.Ak),null!=this.Ag&&(this.Af==this.Ag&&h.default.RemoveTransUniform(this.Af),a.default.RetrieveMatrix(this.Ag)),null!=this.Af&&this.Af!=this.Ag&&(h.default.RemoveTransUniform(this.Af),a.default.RetrieveMatrix(this.Af)),this.Ak=null,this.Ag=null,this.Af=null,this.Ah=null,this.updateStatus=n.UPDATE_TRANSFORM}copyFrom(t){this.Ac.set(t.Ac,0),this.updatedStatus|=1,this.updateStatus|=n.UPDATE_TRANSFORM,this.Ae=t.Ae}update(){this.updateStatus>0&&(this.Ad=!0,this.updateStatus=this.updateStatus|this.updatedStatus,(this.updateStatus&n.UPDATE_TRANSFORM)>0&&(this.Ag.getLocalFS32().set(this.Ac,0),this.Ae&&this.Ag.setRotationEulerAngle(this.Ac[1]*r.default.MATH_PI_OVER_180,this.Ac[6]*r.default.MATH_PI_OVER_180,this.Ac[9]*r.default.MATH_PI_OVER_180),null!=this.Ah&&(this.updateStatus=this.updateStatus|n.UPDATE_PARENT_MAT)),this.Af!=this.Ag&&this.Af.copyFrom(this.Ag),(this.updateStatus&n.UPDATE_PARENT_MAT)==n.UPDATE_PARENT_MAT&&(null!=this.Ai||(this.Ai=a.default.GetMatrix()),this.Ai.copyFrom(this.Af),this.Aj=!0,this.Af.append(this.Ah)),this.updateStatus=n.UPDATE_NONE)}getMatrixFS32(){return this.getMatrix().getLocalFS32()}toString(){return"[ROTransform(uid = "+this.r+")]"}static GetFreeId(){return n.Al.length>0?n.Al.pop():-1}static Create(t=null){let e=null,s=n.GetFreeId();return s>=0?(e=n.Am[s],n.An[s]=n.S_FLAG_BUSY):(e=new n,n.Am.push(e),n.An.push(n.S_FLAG_BUSY),n.Ao++),e.Af=null==t?a.default.GetMatrix():t,e.Ag=e.Af,e.Ac.set(n.Ki,0),e}static Restore(t){if(null!=t&&n.An[t.getUid()]==n.S_FLAG_BUSY){let e=t.getUid();n.Al.push(e),n.An[e]=n.S_FLAG_FREE,t.destroy()}}}n.Kh=0,n.Ki=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),n.UPDATE_NONE=0,n.UPDATE_POSITION=1,n.UPDATE_ROTATION=2,n.UPDATE_SCALE=4,n.UPDATE_TRANSFORM=7,n.UPDATE_PARENT_MAT=8,n.S_FLAG_BUSY=1,n.S_FLAG_FREE=0,n.An=[],n.Ao=0,n.Am=[],n.Al=[],e.default=n},"0c85":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73"));class a{constructor(){this.Ap=!1,this.dpr=1}initMobile(t,e,s){var i=null;try{void 0!=document&&(i=document)}catch(a){}if(null!=i){let t=this;if(e.addEventListener("touchstart",t=>{let e=t.targetTouches,i=0,r=0;if(e.length<2)i=0|this.dpr*t.targetTouches[0].pageX,r=0|this.dpr*t.targetTouches[0].pageY,s.mouseX=i,s.mouseY=s.stageHeight-r,s.mouseViewX=i,s.mouseViewY=r,this.Ap=!0,s.mouseDown(1);else{let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiDown(a),this.Ap=!1}t.preventDefault(),t.stopPropagation()},!1),e.addEventListener("touchend",t=>{this.Ap=!1;let e=t.targetTouches,i=0,r=0;if(e.length<1)s.mouseUp(1);else{let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiUp(a)}t.preventDefault()},!1),e.addEventListener("touchcancel",e=>{t.Ap=!1;e.targetTouches;s.mouseCancel(),e.preventDefault()},!1),e.addEventListener("touchmove",t=>{t.preventDefault();let e=t.targetTouches,i=0,r=0;if(this.Ap&&(i=0|this.dpr*e[0].pageX,r=0|this.dpr*e[0].pageY,s.mouseViewX=i,s.mouseViewY=r,s.mouseX=i,s.mouseY=s.stageHeight-r,s.mouseMove()),e.length>1){let a=[];for(let s=0;s<e.length;++s)i=0|this.dpr*t.targetTouches[s].pageX,r=0|this.dpr*t.targetTouches[s].pageY,a.push({x:i,y:r});s.mouseMultiMove(a)}},{passive:!1},!1),r.default.IsIpadOS()){let t=document.createElement("meta");t.name="viewport",t.content="width=device-width,initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no",document.getElementsByTagName("head")[0].appendChild(t)}}}initialize(t,e,s){r.default.IsMobileWeb()||r.default.IsIpadOS()||this.initPC(t,e,s),this.initMobile(t,e,s)}initPC(t,e,s){var i=null;try{void 0!=document&&(i=document)}catch(r){}if(null!=i){if(void 0==t.onmousewheel&&void 0!=t.addEventListener){let e=function(t){t.wheelDeltaY=-t.detail,s.mouseWheel(t)};t.addEventListener("DOMMouseScroll",e,!1)}t.onmousewheel=t=>{t.preventDefault(),t.stopPropagation(),s.mouseWheel(t)},t.onmousedown=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,0==t.button?s.mouseDown(1):2==t.button&&s.mouseRightDown(1)},t.onmouseup=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,0==t.button?s.mouseUp(1):2==t.button&&s.mouseRightUp(1)},document.onmouseup=t=>{0==t.button?s.mouseWindowUp(1):2==t.button&&s.mouseWindowRightUp(1)},t.onmousemove=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,s.mouseMove()},t.onclick=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,0==t.button?s.mouseClick():2==t.button&&s.mouseRightClick()},t.ondblclick=t=>{let i=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-i.left),a=0|this.dpr*(t.clientY-i.top);s.mouseX=r,s.mouseY=s.stageHeight-a,s.mouseViewX=r,s.mouseViewY=a,0==t.button?s.mouseDoubleClick():t.button}}}}e.default=a},"0e01":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("baae")),a=i(s("5326")),h=i(s("29ef")),n=i(s("de9d")),l=i(s("4f27")),_=i(s("7499"));class m{constructor(t){this.Aq=null,this.t=null,this.Ar=null,this.As=.1,this.At=5e3,this.Au=45,this.A=0,this.A=t,this.t=new n.default(t)}getRCUid(){return this.A}getDiv(){return this.Aq.getDiv()}getCanvas(){return this.Aq.getCanvas()}getRenderAdapter(){return this.Aq}getRenderMaterialProxy(){return this.Ar}getRenderProxy(){return this.t}getTextureResTotal(){return this.t.Texture.getTextureResTotal()}getTextureAttachTotal(){return this.t.Texture.getAttachTotal()}getDevicePixelRatio(){return this.Aq.getDevicePixelRatio()}getStage3D(){return this.t.getStage3D()}getCamera(){return null!=this.t?this.t.getCamera():null}cameraLock(){this.t.cameraLock()}cameraUnlock(){this.t.cameraUnlock()}updateCamera(){null!=this.t&&this.t.updateCamera()}updateCameraDataFromCamera(t){null!=this.t&&this.t.updateCameraDataFromCamera(t)}lockRenderColorMask(){null!=this.t&&this.t.lockRenderState()}unlockColorMask(){null!=this.t&&this.t.unlockRenderState()}useGlobalColorMask(t){null!=this.t&&(this.t.unlockRenderColorMask(),this.t.useRenderColorMask(t),this.t.lockRenderColorMask())}useGlobalRenderColorMaskByName(t){null!=this.t&&(this.t.unlockRenderColorMask(),this.t.useRenderColorMask(h.default.GetRenderColorMaskByName(t)),this.t.lockRenderColorMask())}lockRenderState(){null!=this.t&&this.t.lockRenderState()}unlockRenderState(){null!=this.t&&this.t.unlockRenderState()}useGlobalRenderState(t){null!=this.t&&(this.t.unlockRenderState(),this.t.useRenderState(t),this.t.lockRenderState())}useGlobalRenderStateByName(t){null!=this.t&&(this.t.unlockRenderState(),this.t.useRenderState(h.default.GetRenderStateByName(t)),this.t.lockRenderState())}getRenderStateByName(t){return h.default.GetRenderStateByName(t)}lockMaterial(){null!=this.Ar&&this.Ar.lockMaterial()}unlockMaterial(){null!=this.Ar&&this.Ar.unlockMaterial()}isUnlockMaterial(){return this.Ar.isUnlockMatrial()}useGlobalMaterial(t,e=!1){null!=this.Ar&&(this.Ar.unlockMaterial(),e?this.Ar.unlockTexture():this.Ar.lockTexture(),this.Ar.useGlobalMaterial(t),this.Ar.lockMaterial())}clearBackBuffer(){this.t.clearBackBuffer()}setScissorRect(t,e,s,i){this.Aq.setScissorRect(t,e,s,i)}setScissorEnabled(t){this.Aq.setScissorEnabled(t)}setViewPort(t,e,s,i){this.t.setViewPort(t,e,s,i)}synFBOSizeWithViewport(){this.Aq.synFBOSizeWithViewport()}asynFBOSizeWithViewport(){this.Aq.asynFBOSizeWithViewport()}setFBOSizeFactorWithViewPort(t){this.Aq.setFBOSizeFactorWithViewPort(t)}createFBOAt(t,e,s,i,r=!1,a=!1,h=0){this.Aq.createFBOAt(t,e,s,i,r,a,h)}bindFBOAt(t,e){this.Aq.bindFBOAt(t,e)}setRenderToTexture(t,e=!1,s=!1,i=0){this.Aq.setRenderToTexture(t,e,s,i)}useFBO(t=!1,e=!1,s=!1){this.Aq.useFBO(t,e,s)}resetFBOAttachmentMask(t){this.Aq.resetFBOAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){this.Aq.setFBOAttachmentMaskAt(t,e)}setRenderToBackBuffer(){null!=this.Aq&&(this.Aq.setRenderToBackBuffer(r.default.FRAMEBUFFER),this.Ar.renderBegin())}lockViewport(){this.Aq.lockViewport()}unlockViewport(){this.Aq.unlockViewport()}setClearDepth(t){this.Aq.setClearDepth(t)}getClearDepth(){return this.Aq.getClearDepth()}getViewportX(){return this.Aq.getViewportX()}getViewportY(){return this.Aq.getViewportY()}getViewportWidth(){return this.Aq.getViewportWidth()}getViewportHeight(){return this.Aq.getViewportHeight()}setContextViewSize(t,e){this.Aq.setContextViewSize(t,e)}setCameraParam(t,e,s){this.Au=t,this.As=e,this.At=s,null!=this.t&&this.t.setCameraParam(t,e,s)}initialize(t,e,s,i,r){if(null==this.Aq){a.default.Initialize(this.t.getUid()),this.t.setCameraParam(this.Au,this.As,this.At),this.t.setWebGLMaxVersion(t.maxWebGLVersion),this.t.initialize(t,e,s,i,i,r),this.A=this.t.getRCUid(),r.initialize(this.A,this.t.getRC(),this.t.getGLVersion()),this.Aq=this.t.getRenderAdapter(),this.Aq.bgColor.setRGBA4f(0,0,0,1);let h=this.t.getContext();h.setViewport(0,0,h.getRCanvasWidth(),h.getRCanvasHeight()),l.default.Initialize()}}initManager(t){null==this.Ar&&(this.Ar=new _.default,this.Ar.setDispBuilder(t))}setClearRGBColor3f(t,e,s){this.t.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.t.setClearRGBAColor4f(t,e,s,i)}getClearRGBAColor4f(t){t.copyFrom(this.Aq.bgColor)}updateRenderBufferSize(){this.Aq.updateRenderBufferSize()}vertexRenderBegin(){this.t.Vertex.renderBegin()}renderBegin(t=!0){null!=this.Aq&&(this.Aq.unlockViewport(),this.Aq.setClearDepth(1),this.t.Vertex.renderBegin(),this.Ar.renderBegin(),this.Aq.update(),this.Aq.setClearMaskClearAll(),this.Aq.renderBegin(),h.default.ResetInfo(),h.default.Reset(this.t.getRenderContext()),t&&(this.t.useCameraData(),this.t.updateCameraDataFromCamera(this.t.getCamera())))}resetState(){h.default.ResetState(),this.Ar.renderBegin()}resetmaterial(){this.Ar.renderBegin()}resetUniform(){this.Ar.resetUniform()}runEnd(){}}e.default=m},"0fc4":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("9666")),a=i(s("faa5"));class h{constructor(){this.p=null,this.Av=null,this.Aw=null,this.Ax="",this.Ay=null,this.__$troMid=-1,this.__$uniform=null,this.q=null,this.Az=0,this.A0=!1,this.s=0}setMaterialPipeline(t){this.Aw=t}getMaterialPipeline(){return this.Aw}getShdUniqueName(){return this.Ax}initializeByUniqueName(t){if(null==this.getShaderData()){let e=r.default.FindData(t);null!=e&&(this.Ay=e)}return null!=this.getShaderData()}getCodeBuf(){return null!=h.Kj||(h.Kj=new a.default),h.Kj}hasShaderData(){if(null!=this.Ay){if(!this.Ay.haveTexture())return!0;if(this.texDataEnabled())return!0}return!1}initializeByCodeBuf(t=!1){if(null==this.Ay){let e=this.getCodeBuf();if(null!=e){e.reset(),e.pipeline=this.Aw,null!=e.pipeline&&(e.pipeline.reset(),this.buildBuf(),e.pipeline.getTextureTotal()>0&&this.setTextureList(e.pipeline.getTextureList())),null==h.Kj&&(h.Kj=new a.default),a.default.UseShaderBuffer(e),h.Kj.initialize(t);let s=h.Kj.getUniqueShaderName();this.Ax=s,this.__$initShd(this.Ax);let i=r.default.FindData(s);if(null==i){h.Kj.buildShader();let t=h.Kj.getFragShaderCode(),n=h.Kj.getVtxShaderCode();i=r.default.CreateShdData(s,n,t,e.adaptationShaderVersion,a.default.GetPreCompileInfo())}null!=this.Aw&&(this.p=this.Aw.getSharedUniforms()),a.default.UseShaderBuffer(null),this.Ay=i}}}buildBuf(){}__$initShd(t){}getShaderData(){return this.Ay}setTextureList(t){if(this.q!=t){this.A0=!1,this.Az=null!=t?t.length:0;let e=0;if(null!=this.q)for(;e<this.q.length;++e)this.q[e].__$detachThis();if(this.A0=!0,this.q=t,null!=this.q){let t=31;for(e=0;e<this.q.length;++e)t=131*t+this.q[e].getUid(),this.q[e].__$attachThis(),this.q[e].isDataEnough()||(this.A0=!1);this.__$troMid=t}}}setTextureAt(t,e){if(t>=0&&null!=e){let s=this.q,i=s.length;if(null!=s&&s[t]!=e&&t<i&&i>0){s=s.slice(0),s[t].__$detachThis(),s[t]=e,this.A0=e.isDataEnough(),e.__$attachThis();let r=31;for(let t=0;t<i;++t)r=131*r+s[t].getUid();this.__$troMid=r,this.q=s}}}getTextureList(){return this.q}getTextureAt(t){return this.q[t]}getTextureTotal(){return this.Az}getShdTexTotal(){return null!=this.Ay?this.Ay.getTexTotal():0}texDataEnabled(){if(null!=this.q){if(this.A0)return!0;let t=!0,e=this.q;for(let s=0;s<this.Az;++s)if(!e[s].isDataEnough()){t=!1;break}return this.A0=t,t}return null!=this.Ay&&this.Ay.getTexTotal(),!1}createSharedUniforms(){return this.p}createSharedUniformsData(){return null}createSelfUniformData(){return this.Av}updateSelfData(t){}hasTexture(){return this.Ay.haveTexture()}getBufSortFormat(){return null!=this.Ay?this.Ay.getLayoutBit():0}__$attachThis(){++this.s}__$detachThis(){--this.s,this.s<1&&(this.s=0)}getAttachCount(){return this.s}destroy(){if(this.p=null,this.Av=null,this.getAttachCount()<1){if(null!=this.q)for(let t=0;t<this.q.length;++t)this.q[t].__$detachThis();this.Ay=null,this.q=null,this.A0=!1,this.__$troMid=0,null!=this.__$uniform&&(this.__$uniform.destroy(),this.__$uniform=null)}}toString(){return"[MaterialBase()]"}}h.Kj=null,e.default=h},"11e6":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static AddContainerFlag(t){return 2147483648|t}static RemoveContainerFlag(t){return-2147483649&t}static AddSpaceUid(t,e){return-1048576&t|e}static RemoveSpaceUid(t){return-1048576&t}static GetSpaceUid(t){return 1048575&t}static AddRendererUid(t,e){return-133169153&t|e<<20}static RemoveRendererUid(t){return 133169152|t}static GetRendererUid(t){return(133169152&t)>>20}static AddSortEnabled(t){return 1073741824|t}static RemoveSortEnabled(t){return-1073741825&t}static TestSortEnabled(t){return 1073741824==(1073741824&t)}static AddRendererLoad(t){return 805306368|t}static RemoveRendererLoad(t){return-805306369&t}static TestSpaceContains(t){return(1048575&t)>0}static TestSpaceEnabled(t){return(1048575&t)<1}static TestSpaceEnabled2(t){return(1048575&t)<1&&2147483648!=(2147483648&t)}static TestContainerEnabled(t){return 133169152==(133169152&t)&&2147483648!=(2147483648&t)}static TestRendererEnabled(t){return 133169152==(938475520&t)&&2147483648!=(2147483648&t)}}i.DEFAULT=133169152,i.CONTAINER_FLAG=2147483648,i.CONTAINER_NOT_FLAG=-2147483649,i.SPACE_FLAT=1048575,i.SPACE_NOT_FLAT=-1048576,i.RENDERER_UID_FLAT=133169152,i.RENDERER_UID_NOT_FLAT=-133169153,i.SORT_FLAT=1073741824,i.SORT_NOT_FLAT=-1073741825,i.RENDERER_LOAD_FLAT=805306368,i.RENDERER_LOAD_NOT_FLAT=-805306369,i.RENDERER_ADN_LOAD_FLAT=938475520,e.default=i},1216:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("3930")),h=i(s("baae")),n=i(s("722e")),l=i(s("8333")),_=i(s("6d49")),m=s("e08e"),o=s("8d98"),u=s("7c63"),d=i(s("29ef")),c=i(s("3024"));class f{constructor(t,e){this.r=f.Kh++,this.A=0,this.A1=null,this.AN=null,this.A2=!1,this.A3={mr:!0,mg:!0,mb:!0,ma:!0},this.A4=null,this.A5=0,this.A6=null,this.A7=0,this.A8=h.default.FRAMEBUFFER,this.A9=[null,null,null,null,null,null,null,null],this.A_=!0,this.BA=!1,this.B=0,this.C=0,this.AP=800,this.AQ=600,this.BB=1,this.BC=0,this.BD=new r.default(0,0,800,600),this.BE=1,this.BF=0,this.BG=new Uint16Array(8),this.BH=new Uint16Array(4),this.BI=1,this.AJ=!1,this.BJ=null,this.BK=2,this.bgColor=new a.default,this.uViewProbe=null,this.BL=!1,this.BM=1,this.BN=!0,this.BO=!1,this.A1=e,this.A=t}initialize(t,e,s){if(null==this.A4&&(this.BK=t.getWebGLVersion(),this.BJ=s,this.A4=t,this.AN=t.getRC(),this.AN.disable(this.AN.SCISSOR_TEST),t.isDepthTestEnabled()?this.AN.enable(this.AN.DEPTH_TEST):this.AN.disable(this.AN.DEPTH_TEST),t.isStencilTestEnabled()?this.AN.enable(this.AN.STENCIL_TEST):this.AN.disable(this.AN.STENCIL_TEST),this.AN.enable(this.AN.CULL_FACE),this.AN.cullFace(this.AN.BACK),this.AN.enable(this.AN.BLEND),e.getDitherEanbled()?this.AN.enable(this.AN.DITHER):this.AN.disable(this.AN.DITHER),this.AN.frontFace(this.AN.CCW),e.getPolygonOffsetEanbled()?this.AN.enable(this.AN.POLYGON_OFFSET_FILL):this.AN.disable(this.AN.POLYGON_OFFSET_FILL),this.A5=this.AN.COLOR_BUFFER_BIT|this.AN.DEPTH_BUFFER_BIT|this.AN.STENCIL_BUFFER_BIT,null==this.uViewProbe)){let t=this;t.uViewProbe=new c.default(1),this.uViewProbe.bindSlotAt(this.A),this.uViewProbe.setVec4DataWithArr4([this.B,this.C,this.AP,this.AQ])}}setFrontFaceFlipped(t){this.A2!=t&&(t?this.AN.frontFace(this.AN.CW):this.AN.frontFace(this.AN.CCW),this.A2=t)}setPolygonOffset(t,e=0){this.AN.polygonOffset(t,e),this.BL=!0}resetPolygonOffset(){this.BL&&(this.AN.polygonOffset(0,0),this.BL=!1)}getDiv(){return this.A4.getDiv()}getCanvas(){return this.A4.getCanvas()}setClearDepth(t){this.BB=t}getClearDepth(){return this.BB}setContextViewSize(t,e){this.A4.autoSyncRenderBufferAndWindowSize=!1,this.A4.resizeBufferSize(t,e)}getViewportX(){return this.A4.getViewportX()}getViewportY(){return this.A4.getViewportY()}getViewportWidth(){return this.A4.getViewportWidth()}getViewportHeight(){return this.A4.getViewportHeight()}getFBOFitWidth(){return this.A4.getFBOWidth()}getFBOFitHeight(){return this.A4.getFBOHeight()}getRCanvasWidth(){return this.A4.getRCanvasWidth()}getRCanvasHeight(){return this.A4.getRCanvasHeight()}setColorMask(t,e,s,i){this.A3.mr=t,this.A3.mg=e,this.A3.mb=s,this.A3.ma=i}setClearMaskClearAll(){this.A5=this.AN.COLOR_BUFFER_BIT|this.AN.DEPTH_BUFFER_BIT|this.AN.STENCIL_BUFFER_BIT}setClearMaskClearOnlyColor(){this.A5=this.AN.COLOR_BUFFER_BIT}setClearMaskClearOnlyDepthAndStencil(){this.A5=this.AN.DEPTH_BUFFER_BIT|this.AN.STENCIL_BUFFER_BIT}setScissorRect(t,e,s,i){this.AJ&&this.AN.scissor(t,e,s,i)}setScissorEnabled(t){t?this.AJ||(this.AJ=!0,this.AN.enable(this.AN.SCISSOR_TEST)):this.AJ&&(this.AJ=!1,this.AN.disable(this.AN.SCISSOR_TEST))}clear(){this.BC!==this.BB&&(this.BC=this.BB,this.AN.clearDepth(this.BB)),this.A4.isStencilTestEnabled()&&this.AN.clearStencil(this.BF),this.AN.clearColor(this.bgColor.r,this.bgColor.g,this.bgColor.b,this.bgColor.a),this.AN.clear(this.A5)}reset(){this.BJ.setCullFaceMode(m.CullFaceMode.BACK),this.BJ.setDepthTestMode(m.DepthTestMode.OPAQUE),d.default.Reset(this.AN)}getRenderContext(){return this.A4}renderBegin(){null!=this.A4&&(this.BE=1,this.reseizeViewPort(),u.RenderStateObject.Unlock(),u.RenderStateObject.UseRenderState(d.default.NORMAL_STATE),u.RenderColorMask.Unlock(),u.RenderColorMask.UseRenderState(u.RenderColorMask.ALL_TRUE_COLOR_MASK),this.clear())}reseizeViewPort(){if(this.BN){let t=this.A4.getDevicePixelRatio(),e=this.B!=this.A4.getViewportX()||this.C!=this.A4.getViewportY();e=e||this.AP!=this.A4.getViewportWidth(),e=e||this.AQ!=this.A4.getViewportHeight(),e=e||Math.abs(this.BM-t)>.01,e&&(this.BM=t,this.B=this.A4.getViewportX(),this.C=this.A4.getViewportY(),this.AP=this.A4.getViewportWidth(),this.AQ=this.A4.getViewportHeight(),this.uViewProbe.setVec4Data(this.B,this.C,this.AP,this.AQ),this.uViewProbe.update(),this.AN.viewport(this.B,this.C,this.AP,this.AQ))}}reseizeFBOViewPort(){if(this.BN){let t=this.A4.getDevicePixelRatio(),e=this.B!=this.BD.x||this.C!=this.BD.y;e=e||this.AP!=this.BD.z,e=e||this.AQ!=this.BD.w,e=e||Math.abs(this.BM-t)>.01,e&&(this.BM=t,this.B=this.BD.x,this.C=this.BD.y,this.AP=this.BD.z,this.AQ=this.BD.w,this.uViewProbe.setVec4Data(this.B,this.C,this.AP,this.AQ),this.uViewProbe.update(),this.AN.viewport(this.B,this.C,this.AP,this.AQ))}}setViewProbeValue(t,e,s,i){this.uViewProbe.setVec4Data(t,e,s,i),this.uViewProbe.update()}lockViewport(){this.BN=!1}unlockViewport(){this.BN=!0}renderEnd(){}update(){}updateRenderBufferSize(){this.A4.updateRenderBufferSize()}destroy(){this.A4=null,this.BJ=null}getDevicePixelRatio(){return this.A4.getDevicePixelRatio()}loseContext(){this.A4.loseContext()}isContextLost(){return this.A4.isContextLost()}readPixels(t,e,s,i,r,a,h){this.AN.readPixels(t,e,s,i,o.TextureFormat.ToGL(this.AN,r),o.TextureDataType.ToGL(this.AN,a),h)}setFBOViewRect(t,e,s,i){this.BH[0]=t,this.BH[1]=e,this.BH[2]=s,this.BH[3]=i,this.BA=!0}createFBOAt(t,e,s,i,r=!1,a=!1,h=0){null==this.A9[t]&&(t>7&&(t=7),this.A8=e,this.A6=new _.default(this.A,this.A1,this.A8),this.A6.multisampleEnabled=h>0,this.A6.multisampleLevel=h,this.A6.writeDepthEnabled=r,this.A6.writeStencilEnabled=a,this.A6.initialize(this.AN,s,i),this.A9[t]=this.A6,this.A6.sizeFixed=!0)}resizeFBOAt(t,e,s){t>7?t=7:t<0&&(t=0),null!=this.A9[this.A7]&&this.A9[this.A7].resize(e,s)}getFBOWidthAt(t){return null!=this.A9[t]?this.A9[t].getWidth():0}getFBOHeightAt(t){return null!=this.A9[t]?this.A9[t].getHeight():0}synFBOSizeWithViewport(){this.BO=!0}asynFBOSizeWithViewport(){this.BO=!1}setFBOSizeFactorWithViewPort(t){this.BE=t}bindFBOAt(t,e){if(t>7?t=7:t<0&&(t=0),this.A6=this.A9[t],null==this.A6)throw Error("Fatal Error!!! this.A6 == null.");this.A7=t,this.A8=e,this.A6.bind(e),this.A_=!0}resetFBOAttachmentMask(t){null!=this.A6&&this.A6.resetAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){null!=this.A6&&this.A6.setAttachmentMaskAt(t,e)}getFBOAttachmentTotal(){return null!=this.A6?this.A6.getAttachmentTotal():0}setRenderToTexture(t,e=!1,s=!1,i=0){(i<0||i>=8)&&(i=0),null==t&&0==i?this.setRenderToBackBuffer(h.default.FRAMEBUFFER):(0==i&&(null!=this.A6&&(this.BO?this.A6.initialize(this.AN,Math.floor(this.A4.getFBOWidth()*this.BE),Math.floor(this.A4.getFBOHeight()*this.BE)):this.BA?this.A6.initialize(this.AN,this.BH[2],this.BH[3]):this.A6.sizeFixed||this.A6.initialize(this.AN,t.getWidth(),t.getHeight())),this.A7>=0&&null==this.A6&&(this.A6=new _.default(this.A,this.A1,this.A8),this.A9[this.A7]=this.A6,this.A6.writeDepthEnabled=e,this.A6.writeStencilEnabled=s,this.BO?this.A6.initialize(this.AN,Math.floor(this.A4.getFBOWidth()*this.BE),Math.floor(this.A4.getFBOHeight()*this.BE)):this.BA?this.A6.initialize(this.AN,this.BH[2],this.BH[3]):this.A6.initialize(this.AN,t.getWidth(),t.getHeight()))),null!=this.A6&&this.A6.renderToTexAt(this.AN,t,i),this.A_=!0)}getActiveAttachmentTotal(){return this.BI}getAttachmentTotal(){return this.BI}useFBO(t=!1,e=!1,s=!1){null!=this.A6&&this.A_&&(this.A_=!1,this.A6.use(this.AN),this.BI=this.A6.getActiveAttachmentTotal(),t&&this.A6.clearOnlyColor(this.bgColor),this.A6.writeDepthEnabled?this.A6.writeStencilEnabled?e&&s?this.A6.clearOnlyDepthAndStencil(this.BB,4294967295):e?this.A6.clearOnlyDepth(this.BB):s&&this.A6.clearOnlyStencil(255):e&&this.A6.clearOnlyDepth(this.BB):s&&this.A6.writeStencilEnabled&&this.A6.clearOnlyStencil(255),1==this.BK&&this.AN.clear(this.A5),this.BG[4]=this.BG[0]=this.B,this.BG[5]=this.BG[1]=this.C,this.BG[6]=this.BG[2]=this.B+this.AP,this.BG[7]=this.BG[3]=this.C+this.AQ,this.BA?(this.BA=!1,this.BD.setTo(this.BH[0],this.BH[1],this.BH[2],this.BH[3]),this.reseizeFBOViewPort()):(this.BO?this.BD.setTo(0,0,Math.floor(this.A4.getFBOWidth()*this.BE),Math.floor(this.A4.getFBOHeight()*this.BE)):(this.A6.isSizeChanged()&&this.A6.initialize(this.AN,this.A6.getWidth(),this.A6.getHeight()),this.BD.setTo(0,0,this.A6.getWidth(),this.A6.getHeight())),this.reseizeFBOViewPort()))}setRenderToBackBuffer(t=h.default.FRAMEBUFFER){this.BI=1,_.default.BindToBackbuffer(this.AN,t),this.reseizeViewPort()}bindFBOToDraw(){null!=this.A6&&this.A6.bind(h.default.DRAW_FRAMEBUFFER)}bindFBOToWrite(){null!=this.A6&&this.A6.bind(h.default.READ_FRAMEBUFFER)}setBlitFboSrcRect(t,e,s,i){this.BG[0]=t,this.BG[1]=e,this.BG[2]=t+s,this.BG[3]=e+i}setBlitFboDstRect(t,e,s,i){this.BG[4]=t,this.BG[5]=e,this.BG[6]=t+s,this.BG[7]=e+i}blitFBO(t=0,e=0,s=l.default.COLOR_BUFFER_BIT,i=n.default.NEAREST,r=0,a=0,m=null){t>7&&(t=7),e>7&&(e=7),t>=0&&null!=this.A9[t]?this.A9[t].bind(h.default.READ_FRAMEBUFFER):_.default.BindToBackbuffer(this.AN,h.default.READ_FRAMEBUFFER),e>=0&&null!=this.A9[e]?this.A9[e].bind(h.default.DRAW_FRAMEBUFFER):_.default.BindToBackbuffer(this.AN,h.default.DRAW_FRAMEBUFFER),r>0&&(a<0&&(a=0),null==m&&(m=[0,0,0,1]),this.AN.clearBufferfv(r,a,m));let o=this.BG;this.AN.blitFramebuffer(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],s,i)}}f.Kh=0,e.default=f},1264:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=s("e08e"),h=s("eca0");class n{constructor(t,e,s,i){this.BP=null,this.BQ=null,this.BR=null,this.BS=[],this.BT=[],this.BU=-1,this.BV=0,this.BW=null,this.entityManaListener=null,this.BU=t,this.BQ=e,this.BP=s,this.BR=i}isEmpty(){return this.BV<1}isHaveEntity(){return this.BV>0}removeEntity(t){this.BV--;let e=t.getDisplay();if(null!=e&&null!=e.__$$runit){let t=e.__$ruid,s=this.BP.getRCRPObj(t);if(null!=s){if(s.count>0)if(s.count<2)s.rprocessUid>-1&&(this.BW=this.BR.getNodeByUid(s.rprocessUid),this.BW.removeDisp(e),s.rprocessUid=-1);else{let t=h.RCRPObj.RenerProcessMaxTotal;for(let i=0;i<t;++i)(s.idsFlag&1<<i)>0&&(this.BW=this.BR.getNodeByUid(i),this.BW.removeDisp(e))}}else this.BW=this.BR.getNodeByUid(e.__$$runit.getRPROUid()),this.BW.removeDisp(e);0==s.count&&(e.__$$rsign,a.DisplayRenderSign.LIVE_IN_WORLD,e.__$$rsign=a.DisplayRenderSign.NOT_IN_WORLD,this.BP.restoreByUid(t))}t.__$rseFlag=r.default.RemoveRendererUid(t.__$rseFlag),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.RemoveSortEnabled(t.__$rseFlag),null!=this.entityManaListener&&this.entityManaListener.removeFromWorld(t,this.BU,-1)}addEntity(t,e,s=!1){if(null!=t){let i=t.getDisplay();if(null!=i){if(i.__$$rsign==a.DisplayRenderSign.LIVE_IN_WORLD&&!this.BP.testRPNodeNotExists(i.__$ruid,e))return;this.BW=this.BR.getNodeByUid(e),t.__$rseFlag=this.BW.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),s?(i.__$$rsign==a.DisplayRenderSign.NOT_IN_WORLD&&(i.__$$rsign=a.DisplayRenderSign.GO_TO_WORLD),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.BU),this.BS.push(t),this.BT.push(e)):this.testValidData(t)?this.ensureAdd(t,i,e):(i.__$$rsign==a.DisplayRenderSign.NOT_IN_WORLD&&(i.__$$rsign=a.DisplayRenderSign.GO_TO_WORLD),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),this.BS.push(t),this.BT.push(e))}else t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.BU)}return!1}testValidData(t){if(null!=t.getMaterial()&&t.hasMesh()){if(t.getMaterial().hasShaderData())return!0;null!=t.getMaterial().getCodeBuf()&&t.activeDisplay()}return!1}ensureAdd(t,e,s){t.update(),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.BU),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$setRenderProxy(this.BQ.getRenderProxy()),this.BV++,e.__$$rsign==a.DisplayRenderSign.NOT_IN_WORLD&&(e.__$$rsign=a.DisplayRenderSign.GO_TO_WORLD),this.BW=this.BR.getNodeByUid(s),(e.__$ruid>-1||this.BQ.buildGpuDisp(e))&&this.BW.addDisp(e),null!=this.entityManaListener&&this.entityManaListener.addToWorld(t,this.BU,s),t.update()}updateWaitList(){let t=this.BS.length,e=null,s=null;for(let i=0;i<t;++i)if(e=this.BS[i],(r.default.RENDERER_LOAD_FLAT&e.__$rseFlag)==r.default.RENDERER_LOAD_FLAT){if(this.testValidData(e)){if(s=e.getDisplay(),s.__$$rsign==a.DisplayRenderSign.LIVE_IN_WORLD&&!this.BP.testRPNodeNotExists(s.__$ruid,this.BT[i])){this.BS.splice(i,1),this.BT.splice(i,1),--t,--i;continue}this.ensureAdd(e,s,this.BT[i]),this.BS.splice(i,1),this.BT.splice(i,1),--t,--i}}else s=e.getDisplay(),null!=s&&s.__$$rsign==a.DisplayRenderSign.GO_TO_WORLD&&(s.__$$rsign=a.DisplayRenderSign.NOT_IN_WORLD),e.__$rseFlag=r.default.RemoveRendererLoad(e.__$rseFlag),e.__$rseFlag=r.default.RemoveRendererUid(e.__$rseFlag),e.__$rseFlag=r.default.RemoveSortEnabled(e.__$rseFlag),this.BS.splice(i,1),this.BT.splice(i,1),--t,--i,null!=this.entityManaListener&&this.entityManaListener.removeFromWorld(e,this.BU,-1)}update(){this.BS.length>0&&this.updateWaitList(),this.BQ.update()}}e.default=n},1710:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("a996"));class h extends a.default{constructor(){super(),this.phase=0,this.type=0,this.target=null,this.lpos=new r.default,this.wpos=new r.default,this.raytv=new r.default(1,0,0),this.raypv=new r.default(0,0,0),this.mouseX=0,this.mouseY=0,this.mouseViewX=0,this.mouseViewY=0,this.posArray=null,this.wheelDeltaY=0}static GetMouseEvtTypeValueBase(){return 5001}static GetMouseEvtTypeValuesTotal(){return 17}getClassType(){return h.EventClassType}toString(){return"[MouseEvent]"}}h.EventClassType=1002,h.MOUSE_DOWN=5001,h.MOUSE_UP=5002,h.MOUSE_RIGHT_UP=5003,h.MOUSE_RIGHT_DOWN=5004,h.MOUSE_MOVE=5005,h.MOUSE_WHEEL=5006,h.MOUSE_OVER=5007,h.MOUSE_OUT=5008,h.MOUSE_CLICK=5009,h.MOUSE_RIGHT_CLICK=5010,h.MOUSE_DOUBLE_CLICK=5011,h.MOUSE_CANCEL=5012,h.MOUSE_MULTI_DOWN=5013,h.MOUSE_MULTI_UP=5014,h.MOUSE_MULTI_MOVE=5015,h.MOUSE_BG_DOWN=5016,h.MOUSE_BG_UP=5017,e.default=h},"18c7":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),h=i(s("abdb"));class n{constructor(t=null,e=0){this.r=-1,this.BX=0,this.Ac=null,this.BY=null,this.BX=e,null!=t?(this.r=n.Kh++,this.Ac=t,this.BY=this.Ac.subarray(e,e+16)):(this.r=n.Km++,this.Ac=new Float32Array(16),this.Ac.set(n.Kl,0),this.BY=this.Ac)}setData(t){16==t.length&&this.BY.set(t)}getCapacity(){return 16}GetMaxUid(){return n.Kh}getUid(){return this.r}getLocalFS32(){return this.BY}getFS32(){return this.Ac}getFSIndex(){return this.BX}identity(){this.BY.set(n.Kl,0)}determinant(){return(this.BY[0]*this.BY[5]-this.BY[4]*this.BY[1])*(this.BY[10]*this.BY[15]-this.BY[14]*this.BY[11])-(this.BY[0]*this.BY[9]-this.BY[8]*this.BY[1])*(this.BY[6]*this.BY[15]-this.BY[14]*this.BY[7])+(this.BY[0]*this.BY[13]-this.BY[12]*this.BY[1])*(this.BY[6]*this.BY[11]-this.BY[10]*this.BY[7])+(this.BY[4]*this.BY[9]-this.BY[8]*this.BY[5])*(this.BY[2]*this.BY[15]-this.BY[14]*this.BY[3])-(this.BY[4]*this.BY[13]-this.BY[12]*this.BY[5])*(this.BY[2]*this.BY[11]-this.BY[10]*this.BY[3])+(this.BY[8]*this.BY[13]-this.BY[12]*this.BY[9])*(this.BY[2]*this.BY[7]-this.BY[6]*this.BY[3])}append(t){let e=t.getLocalFS32(),s=this.BY,i=s[0],r=s[4],a=s[8],h=s[12],n=s[1],l=s[5],_=s[9],m=s[13],o=s[2],u=s[6],d=s[10],c=s[14],f=s[3],p=s[7],g=s[11],T=s[15],v=e[0],x=e[4],E=e[8],y=e[12],S=e[1],A=e[5],b=e[9],R=e[13],M=e[2],F=e[6],L=e[10],D=e[14],w=e[3],B=e[7],P=e[11],C=e[15];s[0]=i*v+n*x+o*E+f*y,s[1]=i*S+n*A+o*b+f*R,s[2]=i*M+n*F+o*L+f*D,s[3]=i*w+n*B+o*P+f*C,s[4]=r*v+l*x+u*E+p*y,s[5]=r*S+l*A+u*b+p*R,s[6]=r*M+l*F+u*L+p*D,s[7]=r*w+l*B+u*P+p*C,s[8]=a*v+_*x+d*E+g*y,s[9]=a*S+_*A+d*b+g*R,s[10]=a*M+_*F+d*L+g*D,s[11]=a*w+_*B+d*P+g*C,s[12]=h*v+m*x+c*E+T*y,s[13]=h*S+m*A+c*b+T*R,s[14]=h*M+m*F+c*L+T*D,s[15]=h*w+m*B+c*P+T*C}append3x3(t){let e=t.getLocalFS32(),s=this.BY,i=s[0],r=s[4],a=s[8],h=s[1],n=s[5],l=s[9],_=s[2],m=s[6],o=s[10],u=e[0],d=e[4],c=e[8],f=e[1],p=e[5],g=e[9],T=e[2],v=e[6],x=e[10];s[0]=i*u+h*d+_*c,s[1]=i*f+h*p+_*g,s[2]=i*T+h*v+_*x,s[4]=r*u+n*d+m*c,s[5]=r*f+n*p+m*g,s[6]=r*T+n*v+m*x,s[8]=a*u+l*d+o*c,s[9]=a*f+l*p+o*g,s[10]=a*T+l*v+o*x}appendRotationPivot(t,e,s=null){null==s&&(s=a.default.Z_AXIS),n.Kk.identity(),n.Kk.getAxisRotation(e.x,e.y,e.z,t),n.Kk.appendTranslationXYZ(s.x,s.y,s.z),this.append(n.Kk)}appendRotation(t,e){n.Kk.identity(),n.Kk.getAxisRotation(e.x,e.y,e.z,t),this.append(n.Kk)}appendRotationX(t){n.Kk.rotationX(t),this.append3x3(n.Kk)}appendRotationY(t){n.Kk.rotationY(t),this.append3x3(n.Kk)}appendRotationZ(t){n.Kk.rotationZ(t),this.append3x3(n.Kk)}appendRotationEulerAngle(t,e,s){n.Kk.rotationY(e),this.append3x3(n.Kk),n.Kk.rotationX(t),this.append3x3(n.Kk),n.Kk.rotationZ(s),this.append3x3(n.Kk)}setScaleXYZ(t,e,s){let i=this.BY;i[0]=t,i[5]=e,i[10]=s}setRotationEulerAngle(t,e,s){let i=this.BY,r=Math.cos(t),a=Math.sin(t),h=Math.cos(e),n=Math.sin(e),l=Math.cos(s),_=Math.sin(s),m=l*n,o=_*n,u=h*i[0],d=a*i[5],c=r*i[5],f=r*i[10],p=a*i[10];i[1]=_*u,i[2]=-n*i[0],i[0]=l*u,i[4]=m*d-_*c,i[8]=m*f+_*p,i[5]=o*d+l*c,i[9]=o*f-l*p,i[6]=h*d,i[10]=h*f}setRotationEulerAngle2(t,e,s,i,r,a){let h=this.BY,n=r*i,l=a*i,_=s*h[0],m=e*h[5],o=t*h[5],u=t*h[10],d=e*h[10];h[1]=a*_,h[2]=-i*h[0],h[0]=r*_,h[4]=n*m-a*o,h[8]=n*u+a*d,h[5]=l*m+r*o,h[9]=l*u-r*d,h[6]=s*m,h[10]=s*u}setTranslationXYZ(t,e,s){this.BY[12]=t,this.BY[13]=e,this.BY[14]=s}setTranslation(t){this.BY[12]=t.x,this.BY[13]=t.y,this.BY[14]=t.z}appendScaleXYZ(t,e,s){let i=this.BY;i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=e,i[5]*=e,i[6]*=e,i[7]*=e,i[8]*=s,i[9]*=s,i[10]*=s,i[11]*=s}appendScaleXY(t,e){this.BY[0]*=t,this.BY[1]*=t,this.BY[2]*=t,this.BY[3]*=t,this.BY[4]*=e,this.BY[5]*=e,this.BY[6]*=e,this.BY[7]*=e}appendTranslationXYZ(t,e,s){this.BY[12]+=t,this.BY[13]+=e,this.BY[14]+=s}appendTranslation(t){this.BY[12]+=t.x,this.BY[13]+=t.y,this.BY[14]+=t.z}copyColumnFrom(t,e){switch(t){case 0:this.BY[0]=e.x,this.BY[1]=e.y,this.BY[2]=e.z,this.BY[3]=e.w;break;case 1:this.BY[4]=e.x,this.BY[5]=e.y,this.BY[6]=e.z,this.BY[7]=e.w;break;case 2:this.BY[8]=e.x,this.BY[9]=e.y,this.BY[10]=e.z,this.BY[11]=e.w;break;case 3:this.BY[12]=e.x,this.BY[13]=e.y,this.BY[14]=e.z,this.BY[15]=e.w;break;default:break}}copyColumnTo(t,e){t<<=2,e.x=this.BY[t],e.y=this.BY[1+t],e.z=this.BY[2+t],e.w=this.BY[3+t]}setF32ArrAndIndex(t,e=0){null!=t&&e>=0&&(this.Ac=t,this.BX=e,this.BY=this.Ac.subarray(e,e+16))}setF32ArrIndex(t=0){t>=0&&(this.BX=t,this.BY=this.Ac.subarray(t,t+16))}setF32Arr(t){null!=t&&(this.Ac=t)}copyFromF32Arr(t,e=0){let s=0;for(let i=e+16;e<i;e++)this.BY[s]=t[e],++s}copyToF32Arr(t,e=0){t.set(this.BY,e)}copyFrom(t){this.BY.set(t.BY,0)}copyTo(t){t.BY.set(this.BY,0)}copyRawDataFrom(t,e=16,s=0,i=!1){i&&this.transpose(),e-=s;let r=0;while(r<e)this.Ac[this.BX+r]=t[r+s],++r;i&&this.transpose()}copyRawDataTo(t,e=16,s=0,i=!1){i&&this.transpose();let r=0;while(r<e)t[r+s]=this.Ac[this.BX+r],++r;i&&this.transpose()}copyRowFrom(t,e){switch(t){case 0:this.BY[0]=e.x,this.BY[4]=e.y,this.BY[8]=e.z,this.BY[12]=e.w;break;case 1:this.BY[1]=e.x,this.BY[5]=e.y,this.BY[9]=e.z,this.BY[13]=e.w;break;case 2:this.BY[2]=e.x,this.BY[6]=e.y,this.BY[10]=e.z,this.BY[14]=e.w;break;case 3:this.BY[3]=e.x,this.BY[7]=e.y,this.BY[11]=e.z,this.BY[15]=e.w;break;default:break}}copyRowTo(t,e){e.x=this.BY[t],e.y=this.BY[4+t],e.z=this.BY[8+t],e.w=this.BY[12+t]}decompose(t){let e=[],s=n.Kk,i=s.getFS32();s.copyFrom(this);let l=new a.default(i[12],i[13],i[14]),_=new a.default;_.x=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]),_.y=Math.sqrt(i[4]*i[4]+i[5]*i[5]+i[6]*i[6]),_.z=Math.sqrt(i[8]*i[8]+i[9]*i[9]+i[10]*i[10]),i[0]*(i[5]*i[10]-i[6]*i[9])-i[1]*(i[4]*i[10]-i[6]*i[8])+i[2]*(i[4]*i[9]-i[5]*i[8])<0&&(_.z=-_.z),i[0]/=_.x,i[1]/=_.x,i[2]/=_.x,i[4]/=_.y,i[5]/=_.y,i[6]/=_.y,i[8]/=_.z,i[9]/=_.z,i[10]/=_.z;let m=new a.default;switch(t){case h.default.AXIS_ANGLE:{m.w=r.default.SafeACos((i[0]+i[5]+i[10]-1)/2);let t=Math.sqrt((i[6]-i[9])*(i[6]-i[9])+(i[8]-i[2])*(i[8]-i[2])+(i[1]-i[4])*(i[1]-i[4]));t>r.default.MATH_MIN_POSITIVE?(m.x=(i[6]-i[9])/t,m.y=(i[8]-i[2])/t,m.z=(i[1]-i[4])/t):m.x=m.y=m.z=0}break;case h.default.QUATERNION:{let t=i[0]+i[5]+i[10];t>0?(m.w=Math.sqrt(1+t)/2,m.x=(i[6]-i[9])/(4*m.w),m.y=(i[8]-i[2])/(4*m.w),m.z=(i[1]-i[4])/(4*m.w)):i[0]>i[5]&&i[0]>i[10]?(m.x=Math.sqrt(1+i[0]-i[5]-i[10])/2,m.w=(i[6]-i[9])/(4*m.x),m.y=(i[1]+i[4])/(4*m.x),m.z=(i[8]+i[2])/(4*m.x)):i[5]>i[10]?(m.y=Math.sqrt(1+i[5]-i[0]-i[10])/2,m.x=(i[1]+i[4])/(4*m.y),m.w=(i[8]-i[2])/(4*m.y),m.z=(i[6]+i[9])/(4*m.y)):(m.z=Math.sqrt(1+i[10]-i[0]-i[5])/2,m.x=(i[8]+i[2])/(4*m.z),m.y=(i[6]+i[9])/(4*m.z),m.w=(i[1]-i[4])/(4*m.z))}break;case h.default.EULER_ANGLES:m.y=Math.asin(-i[2]),1!=i[2]&&-1!=i[2]?(m.x=Math.atan2(i[6],i[10]),m.z=Math.atan2(i[1],i[0])):(m.z=0,m.x=Math.atan2(i[4],i[5]));break;default:break}return e.push(l),e.push(m),e.push(_),s=null,e}invert(){let t=this.determinant(),e=Math.abs(t)>r.default.MATH_MIN_POSITIVE;if(e){let e=this.BY;t=1/t;let s=e[0],i=e[4],r=e[8],a=e[12],h=e[1],n=e[5],l=e[9],_=e[13],m=e[2],o=e[6],u=e[10],d=e[14],c=e[3],f=e[7],p=e[11],g=e[15];e[0]=t*(n*(u*g-d*p)-l*(o*g-d*f)+_*(o*p-u*f)),e[1]=-t*(h*(u*g-d*p)-l*(m*g-d*c)+_*(m*p-u*c)),e[2]=t*(h*(o*g-d*f)-n*(m*g-d*c)+_*(m*f-o*c)),e[3]=-t*(h*(o*p-u*f)-n*(m*p-u*c)+l*(m*f-o*c)),e[4]=-t*(i*(u*g-d*p)-r*(o*g-d*f)+a*(o*p-u*f)),e[5]=t*(s*(u*g-d*p)-r*(m*g-d*c)+a*(m*p-u*c)),e[6]=-t*(s*(o*g-d*f)-i*(m*g-d*c)+a*(m*f-o*c)),e[7]=t*(s*(o*p-u*f)-i*(m*p-u*c)+r*(m*f-o*c)),e[8]=t*(i*(l*g-_*p)-r*(n*g-_*f)+a*(n*p-l*f)),e[9]=-t*(s*(l*g-_*p)-r*(h*g-_*c)+a*(h*p-l*c)),e[10]=t*(s*(n*g-_*f)-i*(h*g-_*c)+a*(h*f-n*c)),e[11]=-t*(s*(n*p-l*f)-i*(h*p-l*c)+r*(h*f-n*c)),e[12]=-t*(i*(l*d-_*u)-r*(n*d-_*o)+a*(n*u-l*o)),e[13]=t*(s*(l*d-_*u)-r*(h*d-_*m)+a*(h*u-l*m)),e[14]=-t*(s*(n*d-_*o)-i*(h*d-_*m)+a*(h*o-n*m)),e[15]=t*(s*(n*u-l*o)-i*(h*u-l*m)+r*(h*o-n*m))}return e}pointAt(t,e,s){null!=e&&void 0!=e||(e=new a.default(0,0,-1)),null!=s&&void 0!=s||(s=new a.default(0,-1,0));let i=e.subtract(t),h=new a.default(s.x,s.y,s.z);i.normalize(),h.normalize();let n=new a.default(i.x,i.y,i.z);n.scaleBy(h.dot(i)),h.subtractBy(n),h.getLength()>r.default.MATH_MIN_POSITIVE?h.normalize():0!=i.x?h.setTo(-i.y,i.x,0):h.setTo(1,0,0);let l=h.crossProduct(i);l.normalize();let _=this.BY;_[0]=l.x,_[4]=l.y,_[8]=l.z,_[12]=0,_[1]=h.x,_[5]=h.y,_[9]=h.z,_[13]=0,_[2]=i.x,_[6]=i.y,_[10]=i.z,_[14]=0,_[3]=t.x,_[7]=t.y,_[11]=t.z,_[15]=1}prepend(t){let e=t.getLocalFS32(),s=this.BY,i=e[0],r=e[4],a=e[8],h=e[12],n=e[1],l=e[5],_=e[9],m=e[13],o=e[2],u=e[6],d=e[10],c=e[14],f=e[3],p=e[7],g=e[11],T=e[15],v=s[0],x=s[4],E=s[8],y=s[12],S=s[1],A=s[5],b=s[9],R=s[13],M=s[2],F=s[6],L=s[10],D=s[14],w=s[3],B=s[7],P=s[11],C=s[15];s[0]=i*v+n*x+o*E+f*y,s[1]=i*S+n*A+o*b+f*R,s[2]=i*M+n*F+o*L+f*D,s[3]=i*w+n*B+o*P+f*C,s[4]=r*v+l*x+u*E+p*y,s[5]=r*S+l*A+u*b+p*R,s[6]=r*M+l*F+u*L+p*D,s[7]=r*w+l*B+u*P+p*C,s[8]=a*v+_*x+d*E+g*y,s[9]=a*S+_*A+d*b+g*R,s[10]=a*M+_*F+d*L+g*D,s[11]=a*w+_*B+d*P+g*C,s[12]=h*v+m*x+c*E+T*y,s[13]=h*S+m*A+c*b+T*R,s[14]=h*M+m*F+c*L+T*D,s[15]=h*w+m*B+c*P+T*C}prepend3x3(t){let e=t.getLocalFS32(),s=this.BY,i=e[0],r=e[4],a=e[8],h=e[1],n=e[5],l=e[9],_=e[2],m=e[6],o=e[10],u=s[0],d=s[4],c=s[8],f=s[1],p=s[5],g=s[9],T=s[2],v=s[6],x=s[10];s[0]=i*u+h*d+_*c,s[1]=i*f+h*p+_*g,s[2]=i*T+h*v+_*x,s[4]=r*u+n*d+m*c,s[5]=r*f+n*p+m*g,s[6]=r*T+n*v+m*x,s[8]=a*u+l*d+o*c,s[9]=a*f+l*p+o*g,s[10]=a*T+l*v+o*x}prependRotationPivot(t,e,s){n.Kk.identity(),n.Kk.getAxisRotation(e.x,e.y,e.z,t),n.Kk.appendTranslationXYZ(s.x,s.y,s.z),this.prepend(n.Kk)}prependRotation(t,e){n.Kk.identity(),n.Kk.getAxisRotation(e.x,e.y,e.z,t),this.prepend(n.Kk)}prependRotationX(t){n.Kk.rotationX(t),this.prepend3x3(n.Kk)}prependRotationY(t){n.Kk.rotationY(t),this.prepend3x3(n.Kk)}prependRotationZ(t){n.Kk.rotationZ(t),this.prepend3x3(n.Kk)}prependRotationEulerAngle(t,e,s){n.Kk.rotationY(e),this.prepend3x3(n.Kk),n.Kk.rotationX(t),this.prepend3x3(n.Kk),n.Kk.rotationZ(s),this.prepend3x3(n.Kk)}prependScale(t,e,s){let i=this.BY;i[0]*=t,i[1]*=e,i[2]*=s,i[4]*=t,i[5]*=e,i[6]*=s,i[8]*=t,i[9]*=e,i[10]*=s,i[12]*=t,i[13]*=e,i[14]*=s}prependScaleXY(t,e){this.BY[0]*=t,this.BY[1]*=e,this.BY[4]*=t,this.BY[5]*=e,this.BY[8]*=t,this.BY[9]*=e,this.BY[12]*=t,this.BY[13]*=e}prependTranslationXYZ(t,e,s){n.Kk.identity(),this.prepend(n.Kk)}prependTranslation(t){n.Kk.identity(),this.prepend(n.Kk)}recompose(t,e){if(t.length<3||0==t[2].x||0==t[2].y||0==t[2].z)return!1;this.identity();let s=n.Kk.getFS32();s[0]=s[1]=s[2]=t[2].x,s[4]=s[5]=s[6]=t[2].y,s[8]=s[9]=s[10]=t[2].z;let i=this.BY;switch(e){case h.default.EULER_ANGLES:{let e=Math.cos(t[1].x),r=Math.cos(t[1].y),a=Math.cos(t[1].z),h=Math.sin(t[1].x),n=Math.sin(t[1].y),l=Math.sin(t[1].z);i[0]=r*a*s[0],i[1]=r*l*s[1],i[2]=-n*s[2],i[3]=0,i[4]=(h*n*a-e*l)*s[4],i[5]=(h*n*l+e*a)*s[5],i[6]=h*r*s[6],i[7]=0,i[8]=(e*n*a+h*l)*s[8],i[9]=(e*n*l-h*a)*s[9],i[10]=e*r*s[10],i[11]=0,i[12]=t[0].x,i[13]=t[0].y,i[14]=t[0].z,i[15]=1}break;default:{let r=t[1].x,a=t[1].y,n=t[1].z,l=t[1].w;if(e==h.default.AXIS_ANGLE){let t=.5*l;r*=Math.sin(t),a*=Math.sin(t),n*=Math.sin(t),l=Math.cos(t)}i[0]=(1-2*a*a-2*n*n)*s[0],i[1]=(2*r*a+2*l*n)*s[1],i[2]=(2*r*n-2*l*a)*s[2],i[3]=0,i[4]=(2*r*a-2*l*n)*s[4],i[5]=(1-2*r*r-2*n*n)*s[5],i[6]=(2*a*n+2*l*r)*s[6],i[7]=0,i[8]=(2*r*n+2*l*a)*s[8],i[9]=(2*a*n-2*l*r)*s[9],i[10]=(1-2*r*r-2*a*a)*s[10],i[11]=0,i[12]=t[0].x,i[13]=t[0].y,i[14]=t[0].z,i[15]=1}break}return 0==t[2].x&&(this.BY[0]=0),0==t[2].y&&(this.BY[5]=0),0==t[2].z&&(this.BY[10]=0),s=null,!0}setThreeAxes(t,e,s){let i=this.BY;i[0]=t.x,i[1]=t.y,i[2]=t.z,i[4]=e.x,i[5]=e.y,i[6]=e.z,i[8]=s.x,i[9]=s.y,i[10]=s.z}deltaTransformVector(t){let e=t.x,s=t.y,i=t.z;return new a.default(e*this.BY[0]+s*this.BY[4]+i*this.BY[8],e*this.BY[1]+s*this.BY[5]+i*this.BY[9],e*this.BY[2]+s*this.BY[6]+i*this.BY[10],0)}deltaTransformVectorSelf(t){let e=this.BY,s=t.x,i=t.y,r=t.z;t.x=s*e[0]+i*e[4]+r*e[8],t.y=s*e[1]+i*e[5]+r*e[9],t.z=s*e[2]+i*e[6]+r*e[10]}deltaTransformOutVector(t,e){let s=this.BY;e.x=t.x*s[0]+t.y*s[4]+t.z*s[8],e.y=t.x*s[1]+t.y*s[5]+t.z*s[9],e.z=t.x*s[2]+t.y*s[6]+t.z*s[10]}transformVector(t){let e=this.BY,s=t.x,i=t.y,r=t.z;return new a.default(s*e[0]+i*e[4]+r*e[8]+e[12],s*e[1]+i*e[5]+r*e[9]+e[13],s*e[2]+i*e[6]+r*e[10]+e[14],s*e[3]+i*e[7]+r*e[11]+e[15])}transformOutVector(t,e){let s=t.x,i=t.y,r=t.z,a=this.BY;e.setTo(s*a[0]+i*a[4]+r*a[8]+a[12],s*a[1]+i*a[5]+r*a[9]+a[13],s*a[2]+i*a[6]+r*a[10]+a[14],s*a[3]+i*a[7]+r*a[11]+a[15])}transformOutVector3(t,e){let s=this.BY;e.x=t.x*s[0]+t.y*s[4]+t.z*s[8]+s[12],e.y=t.x*s[1]+t.y*s[5]+t.z*s[9]+s[13],e.z=t.x*s[2]+t.y*s[6]+t.z*s[10]+s[14]}transformVector3Self(t){let e=t.x,s=t.y,i=t.z,r=this.BY;t.x=e*r[0]+s*r[4]+i*r[8]+r[12],t.y=e*r[1]+s*r[5]+i*r[9]+r[13],t.z=e*r[2]+s*r[6]+i*r[10]+r[14]}transformVectorSelf(t){let e=t.x,s=t.y,i=t.z,r=this.BY;t.setTo(e*r[0]+s*r[4]+i*r[8]+r[12],e*r[1]+s*r[5]+i*r[9]+r[13],e*r[2]+s*r[6]+i*r[10]+r[14],e*r[3]+s*r[7]+i*r[11]+r[15])}transformVectors(t,e,s){let i,r,a,h=0,n=this.BY;e-=3;while(h<=e)i=t[h],r=t[h+1],a=t[h+2],s[h]=i*n[0]+r*n[4]+a*n[8]+n[12],s[h+1]=i*n[1]+r*n[5]+a*n[9]+n[13],s[h+2]=i*n[2]+r*n[6]+a*n[10]+n[14],h+=3}transformVectorsSelf(t,e){let s,i,r,a=0,h=this.BY;e-=3;while(a<=e)s=t[a],i=t[a+1],r=t[a+2],t[a]=s*h[0]+i*h[4]+r*h[8]+h[12],t[a+1]=s*h[1]+i*h[5]+r*h[9]+h[13],t[a+2]=s*h[2]+i*h[6]+r*h[10]+h[14],a+=3}transformVectorsRangeSelf(t,e,s){let i,r,a,h=e,n=this.BY;s-=3;while(h<=s)i=t[h],r=t[h+1],a=t[h+2],t[h]=i*n[0]+r*n[4]+a*n[8]+n[12],t[h+1]=i*n[1]+r*n[5]+a*n[9]+n[13],t[h+2]=i*n[2]+r*n[6]+a*n[10]+n[14],h+=3}transpose(){n.Kk.copyFrom(this);let t=n.Kk.getFS32(),e=this.BY;e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11]}interpolateTo(t,e){let s=t.getFS32(),i=t.getFSIndex(),r=0,a=this.BX;while(r<16)this.Ac[a]+=(s[i+r]-this.Ac[a])*e,++a,++r}getAxisRotation(t,e,s,i){i=-i;let r=this.BY,a=Math.sin(i),h=Math.cos(i),n=1-h;r[0]=h+t*t*n,r[5]=h+e*e*n,r[10]=h+s*s*n;let l=t*e*n,_=s*a;r[4]=l+_,r[1]=l-_,l=t*s*n,_=e*a,r[8]=l-_,r[2]=l+_,l=e*s*n,_=t*a,r[9]=l+_,r[6]=l-_}rotationX(t){let e=Math.sin(t),s=Math.cos(t);this.BY[0]=1,this.BY[1]=0,this.BY[2]=0,this.BY[4]=0,this.BY[5]=s,this.BY[6]=e,this.BY[8]=0,this.BY[9]=-e,this.BY[10]=s}rotationY(t){let e=Math.sin(t),s=Math.cos(t);this.BY[0]=s,this.BY[1]=0,this.BY[2]=-e,this.BY[4]=0,this.BY[5]=1,this.BY[6]=0,this.BY[8]=e,this.BY[9]=0,this.BY[10]=s}rotationZ(t){let e=Math.sin(t),s=Math.cos(t);this.BY[0]=s,this.BY[1]=e,this.BY[2]=0,this.BY[4]=-e,this.BY[5]=s,this.BY[6]=0,this.BY[8]=0,this.BY[9]=0,this.BY[10]=1}toString(){let t="\n"+this.BY[0]+","+this.BY[1]+","+this.BY[2]+","+this.BY[3]+"\n";return t+=this.BY[4]+","+this.BY[5]+","+this.BY[6]+","+this.BY[7]+"\n",t+=this.BY[8]+","+this.BY[9]+","+this.BY[10]+","+this.BY[11]+"\n",t+=this.BY[12]+","+this.BY[13]+","+this.BY[14]+","+this.BY[15]+"\n",t}transformPerspV4Self(t){t.w=t.z,t.x*=this.BY[0],t.y*=this.BY[5],t.z*=this.BY[10],t.z+=this.BY[14],t.w*=this.BY[11],t.w+=this.BY[15]}perspectiveRH(t,e,s,i){let r=Math.tan(.5*t);this.identity(),this.BY[0]=1/(e*r),this.BY[5]=1/r,this.BY[10]=-(i+s)/(i-s),this.BY[11]=-1,this.BY[14]=-2*i*s/(i-s)}perspectiveRH2(t,e,s,i,r){let a=e/Math.tan(.5*t),h=a/e,n=a/s,l=-r/(r-i),_=-i*l;this.identity(),this.BY[0]=h,this.BY[5]=n,this.BY[10]=l,this.BY[11]=-1,this.BY[14]=_}orthoRH(t,e,s,i,r,a){this.identity(),this.BY[0]=2/(i-s),this.BY[5]=2/(e-t),this.BY[10]=-2/(a-r),this.BY[12]=-(i+s)/(i-s),this.BY[13]=-(e+t)/(e-t),this.BY[14]=-(a+r)/(a-r),this.BY[15]=1}perspectiveLH(t,e,s,i){let r=Math.tan(.5*t);this.identity(),this.BY[0]=1/(e*r),this.BY[5]=1/r,this.BY[10]=(i+s)/(i-s),this.BY[11]=1,this.BY[14]=2*i*s/(i-s)}orthoLH(t,e,s,i,r,a){this.identity(),this.BY[0]=2/(i-s),this.BY[5]=2/(e-t),this.BY[10]=2/(a-r),this.BY[12]=-(i+s)/(i-s),this.BY[13]=-(e+t)/(e-t),this.BY[14]=-(a+r)/(a-r),this.BY[15]=1}lookAtRH(t,e,s){this.identity();let i=e.subtract(t);i.normalize();let r=i.crossProduct(s);r.normalize();let a=r.crossProduct(i);r.w=-r.dot(t),a.w=-a.dot(t),i.w=i.dot(t),i.negate(),this.copyRowFrom(0,r),this.copyRowFrom(1,a),this.copyRowFrom(2,i)}lookAtLH(t,e,s){this.identity();let i=e.subtract(t);i.normalize();let r=i.crossProduct(s);r.normalize();let a=r.crossProduct(i);r.w=-r.dot(t),a.w=-a.dot(t),i.w=-i.dot(t),this.copyRowFrom(0,r),this.copyRowFrom(1,a),this.copyRowFrom(2,i)}destroy(){this.BY=null,this.Ac=null,this.BX=-1}}n.Kl=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),n.Kh=0,n.Km=327679,n.Kk=new n,e.default=n},"196c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("fecb")),h=i(s("f610"));class n extends h.default{constructor(){super(),this.Z=0,this.a=0,this.uScale=1,this.vScale=1}getCircleCenterAt(t,e){if(t>=0&&t<=this.a&&null!=this.BZ){e.setXYZ(0,0,0);let s=this.BZ,i=(t+1)*(this.Z+1)*3;for(t=t*(this.Z+1)*3,i-=3;t<i;t+=3)e.x+=s[t],e.y+=s[t+1],e.z+=s[t+2];e.scaleBy(1/this.Z)}}transformCircleAt(t,e){if(t>=0&&t<=this.a){let s=this.BZ,i=(t+1)*(this.Z+1)*3;t=t*(this.Z+1)*3,e.transformVectorsRangeSelf(s,t,i)}}initialize(t,e,s,i,h=1,n=-.5){let l=0,_=0;t<.01&&(t=.01),s<2&&(s=2),i<1&&(i=1),this.Z=s,this.a=i;let m=Math.abs(t),o=Math.abs(e),u=0,d=0,c=0,f=n*o;this.bounds=new a.default,this.bounds.min.setXYZ(-t,f,-t),this.bounds.max.setXYZ(t,f+o,t),this.bounds.updateFast();let p,g=new r.default,T=[],v=2*Math.PI;for(l=0;l<1;++l){for(_=0;_<s;++_)u=v*_/s,d=Math.sin(u),c=Math.cos(u),g.x=d*m,g.z=c*m,p=new r.default(g.x,g.y,g.z,1),T.push(p);T.push(T[0])}this.vtxTotal=(s+1)*(i+1),this.BZ=new Float32Array(3*this.vtxTotal),this.Ba=new Float32Array(2*this.vtxTotal);let x=i,E=0,y=0;for(l=0;l<=x;++l)for(d=l/x,c=f+o*d,_=0;_<=s;++_)h<1?(this.Ba[y++]=this.uScale*(_/s),this.Ba[y++]=this.uScale*d):(this.Ba[y++]=this.uScale*d,this.Ba[y++]=this.uScale*(_/s)),this.BZ[E++]=T[_].x,this.BZ[E++]=c,this.BZ[E++]=T[_].z;let S=s+1,A=0,b=0;for(this.Bb=new Uint16Array(x*s*6),E=0,l=0;l<x;++l)for(A=l*S,b=(l+1)*S,_=1;_<=s;++_)this.Bb[E++]=A+_,this.Bb[E++]=b+_-1,this.Bb[E++]=A+_-1,this.Bb[E++]=A+_,this.Bb[E++]=b+_,this.Bb[E++]=b+_-1;this.vtCount=this.Bb.length,this.trisNumber=this.vtCount/3}toString(){return"PipeGeometry()"}}e.default=n},"1d72":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("34df"),a=i(s("8e17"));class h{constructor(){this.pathPosList=null,this.vs=null,this.uvs=null,this.ivs=null}}e.RoadPathData=h;class n{constructor(){this.Bc=new r.FileIO}savePathData(t,e=null){let s;return s=this.buildPathAndGeometry(t,e),this.Bc.downloadBinFile(s,"pathData"),s}parsePathDataFromFileBuffer(t){let e=new Uint32Array(t.buffer),s=(e[4],e[5],e[6]),i=e[7],r=e[8],n=new Float32Array(t.buffer);n=n.subarray(s);let l=i/3,_=new Array(l),m=0;for(let h=0;h<l;++h)_[h]=new a.default(n[m],n[m+1],n[m+2]),m+=3;let o=new h;if(o.pathPosList=_,7==r){let s=10,i=t.slice(e[s],e[s]+e[s+1]);s=12;let r=t.slice(e[s],e[s]+e[s+1]);s=14;let a=t.slice(e[s],e[s]+e[s+1]);o.vs=new Float32Array(i.buffer),o.uvs=new Float32Array(r.buffer),s=16,e[s]>65535?o.ivs=new Uint32Array(a.buffer):o.ivs=new Uint16Array(a.buffer)}return o}buildPathAndGeometry(t,e=null){let s,i,r,a,h,n,l=t.length,_=3*l,m=4*_,o=null!=e,u=128;u+=m,o&&(s=e.getVS(),i=e.getUVS(),r=e.getIVS(),a=u,u+=s.buffer.byteLength,h=u,u+=i.buffer.byteLength,n=u,u+=r.buffer.byteLength);let d="vrdgeom",c=new Uint8Array(u);for(let E=0;E<d.length;++E)c[E]=d.charCodeAt(E);let f=new Uint32Array(c.buffer),p=128,g=p>>2;f[4]=1,f[5]=2,f[6]=g,f[7]=_,o&&(f[8]=7,f[9]=7,f[10]=a,f[11]=s.buffer.byteLength,f[12]=h,f[13]=i.buffer.byteLength,f[14]=n,f[15]=r.buffer.byteLength,f[16]=r.length);let T,v=new Float32Array(c.buffer);v=v.subarray(g);let x=0;for(let E=0;E<l;++E)T=t[E],v[x]=T.x,v[x+1]=T.y,v[x+2]=T.z,x+=3;if(o){let t=new Uint8Array(s.buffer);c.set(t,a),t=new Uint8Array(i.buffer),c.set(t,h),t=new Uint8Array(r.buffer),c.set(t,n)}return c}}e.RoadFile=n},"1e15":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("030e"));class h{constructor(){this.A=0,this.Bd=2,this.Be=null,this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.vroUid=0,this.rioUid=0}getRC(){return this.Be}getRCUid(){return this.A}createBuf(){return this.Be.createBuffer()}deleteBuf(t){this.Be.deleteBuffer(t)}bindArrBuf(t){this.Be.bindBuffer(this.Be.ARRAY_BUFFER,t)}bindEleBuf(t){this.Be.bindBuffer(this.Be.ELEMENT_ARRAY_BUFFER,t)}arrBufSubData(t,e){this.Be.bufferSubData(this.Be.ARRAY_BUFFER,e,t)}arrBufData(t,e){this.Be.bufferData(this.Be.ARRAY_BUFFER,t,r.default.ToGL(this.Be,e))}eleBufSubData(t,e){this.Be.bufferSubData(this.Be.ELEMENT_ARRAY_BUFFER,e,t)}eleBufData(t,e){this.Be.bufferData(this.Be.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.Be,e))}arrBufDataMem(t,e){this.Be.bufferData(this.Be.ARRAY_BUFFER,t,r.default.ToGL(this.Be,e))}eleBufDataMem(t,e){this.Be.bufferData(this.Be.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.Be,e))}useVtxAttribsPtrTypeFloat(t,e,s,i,r,a){this.Be.bindBuffer(this.Be.ARRAY_BUFFER,e);for(let h=0;h<i;++h)t.vertexAttribPointerTypeFloat(s[h],a,r[h])}useVtxAttribsPtrTypeFloatMulti(t,e,s,i,r,a){for(let h=0;h<i;++h)this.Be.bindBuffer(this.Be.ARRAY_BUFFER,e[h]),t.vertexAttribPointerTypeFloat(s[h],a,r[h])}createVertexArray(){let t=null;return t=2==this.Bd?this.Be.createVertexArray():a.default.OES_vertex_array_object.createVertexArrayOES(),t}bindVertexArray(t){return 2==this.Bd?this.Be.bindVertexArray(t):a.default.OES_vertex_array_object.bindVertexArrayOES(t),t}deleteVertexArray(t){2==this.Bd?this.Be.deleteVertexArray(t):a.default.OES_vertex_array_object.deleteVertexArrayOES(t)}testVROUid(t){return this.vroUid!=t&&(this.vroUid=t,!0)}testRIOUid(t){return this.rioUid!=t&&(this.rioUid=t,!0)}initialize(t,e,s){this.Be=e,this.A=t,this.Bd=s;let i=this;i.RGBA=e.RGBA,i.UNSIGNED_BYTE=e.UNSIGNED_BYTE,i.TRIANGLE_STRIP=e.TRIANGLE_STRIP,i.TRIANGLE_FAN=e.TRIANGLE_FAN,i.TRIANGLES=e.TRIANGLES,i.LINES=this.Be.LINES,i.LINE_STRIP=e.LINE_STRIP,i.UNSIGNED_SHORT=e.UNSIGNED_SHORT,i.UNSIGNED_INT=e.UNSIGNED_INT,i.COLOR=e.COLOR,i.DEPTH=e.DEPTH,i.STENCIL=e.STENCIL,i.DEPTH_STENCIL=e.DEPTH_STENCIL,this.Bd>1?(i.MIN=e.MIN,i.MAX=e.MAX):(i.MIN=a.default.EXT_blend_minmax.MIN_EXT,i.MAX=a.default.EXT_blend_minmax.MAX_EXT),i.RContext=e}renderBegin(){this.vroUid=-2,this.rioUid=-3}toString(){return"[Object ROVtxBuilder()]"}}e.default=h},"1eb2":function(t,e,s){"use strict";if("undefined"!==typeof window){var i=window.document.currentScript,r=s("8875");i=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var a=i&&i.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(s.p=a[1])}},"200a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(){this.l=new r.default,this.minDis=50,this.factor=.3}interpolate(t,e){this.l.subVecsTo(t,e);let s=this.minDis;this.l.getLengthSquared()>s*s&&(s=this.l.getLength()-s,this.l.normalize(),this.l.scaleBy(s*this.factor),e.addBy(this.l))}}e.PosInterpolation=a},"20ef":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("8a0a"));class h{constructor(t){this.Ay=null,this.r=-1,this.Bf=null,this.A=-1,this.AN=null,this.Bg="",this.Bh=0,this.Bi=null,this.Bj=null,this.Bk=null,this.Bl=null,this.Bm=null,this.Bn=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.Bo=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.Bp=null,this.Bq=new Map,this.Br=new Map,this.Bs=null,this.Bt=null,this.dataUniformEnabled=!1,this.Bu=0,this.Bv=0,this.Bw=null,this.Bx=0,this.r=t}setShdData(t){this.Ay=t,this.Bg=t.getUniqueShaderName()}getUid(){return this.r}getTexTotal(){return this.Ay.getTexTotal()}useTexLocation(){for(let t=0;t<this.Bh;t++)this.AN.uniform1i(this.Bm[t],t)}haveTexture(){return this.Ay.haveTexture()}createLocations(){let t=0,e=0,s=this.Ay.getAttriNSList();if(null!=s&&s.length>0&&null==this.Bi){this.dataUniformEnabled=!1;let i=this.Ay.getAttriSizeList();this.Bi=[],this.Bj=[],this.Bk=[],e=s.length;let h=0,n=0;while(t<e)n=this.AN.getAttribLocation(this.Bf,s[t]),this.Bi.push(n),h=a.default.GetVBufAttributeTypeByNS(s[t]),this.Bj.push(h),this.Bk.push(i[t]),this.Bn[h]=n,this.Bo[h]=i[t],this.dataUniformEnabled=!0,++t;for(this.Bp=[],t=0;t<this.Bo.length;++t)this.Bo[t]>0&&this.Bp.push(this.Bo[t]);r.default.SHADERCODE_TRACE_ENABLED}if(this.Ay.haveCommonUniform()&&null==this.Bl){let s=this.Ay.getUniforms();this.Bl=[],e=s.length,t=0;let i=null,a="";while(t<e)s[t].isTex||(a=s[t].name,i=this.AN.getUniformLocation(this.Bf,a),r.default.SHADERCODE_TRACE_ENABLED,null!=i?(i.uniformName=a,i.uniqueName=this.Bg,s[t].location=i,this.Bq.set(a,s[t]),this.Br.set(a,i),this.Bl.push(i),this.dataUniformEnabled=!0):r.default.SHADERCODE_TRACE_ENABLED),++t}if(this.Bh=this.Ay.getTexTotal(),this.Bh>0){this.Bm=new Array(this.Bh);let e=this.Ay.getTexUniformNames();for(t=0;t<this.Bh;++t)e[t]="u_sampler"+t,this.Bm[t]=this.AN.getUniformLocation(this.Bf,e[t])}}getLayoutBit(){return this.Ay.getLayoutBit()}getMid(){return this.Ay.getMid()}getFragOutputTotal(){return this.Ay.getFragOutputTotal()}getLocationsTotal(){return this.Bj.length}getLocationTypeByIndex(t){return this.Bj[t]}getLocationSizeByIndex(t){return this.Bk[t]}testVertexAttribPointerOffset(t){let e=!1;if(null!=t&&null!=this.Bp&&t.length>=this.Bp.length){let s=0,i=0;for(;i<this.Bp.length;++i){if(s!=t[i])break;s+=4*this.Bp[i]}e=i>=this.Bp.length}if(!e)throw Error("Shader program vertx attributes layout can not match float attribute vertex data !!!");return e}vertexAttribPointerType(t,e,s,i,r,a){this.Bu=this.Bn[t],this.Bu>-1&&(this.AN.enableVertexAttribArray(this.Bu),this.AN.vertexAttribPointer(this.Bu,this.Bo[t],s,i,r,a))}vertexAttribPointerTypeFloat(t,e,s){this.Bu=this.Bn[t],this.Bu>-1&&(this.AN.enableVertexAttribArray(this.Bu),this.AN.vertexAttribPointer(this.Bu,this.Bo[t],this.AN.FLOAT,!1,e,s))}testVertexAttribPointerType(t){return this.Bn[t]>-1}getVertexAttribByTpye(t){return this.Bn[t]}vertexAttribPointerAt(t,e,s,i,r,a){this.Bv=t,this.Bu=this.Bi[t],this.Bu>-1&&(this.AN.enableVertexAttribArray(this.Bu),this.AN.vertexAttribPointer(this.Bu,e,s,i,r,a))}vertexAttribPointerNext(t,e,s,i,r){this.Bu=this.Bi[this.Bv],this.Bu>-1&&(this.AN.enableVertexAttribArray(this.Bu),this.AN.vertexAttribPointer(this.Bu,t,e,s,i,r)),this.Bv++}vertexAttribPointerFirst(t,e,s,i,r){this.Bv=1,this.Bu=this.Bi[0],this.Bu>-1&&(this.AN.enableVertexAttribArray(this.Bu),this.AN.vertexAttribPointer(this.Bu,t,e,s,i,r))}getUniformLocationAt(t){return this.Bx=t+1,this.Bl[t]}getUniformLocationNext(){return this.Bw=this.Bl[this.Bx++],this.Bw}getUniformLocationFirst(){return this.Bx=1,this.Bl[0]}getUniformLocationByNS(t){return this.Br.get(t)}getUniformTypeNameByNS(t){return this.Bq.has(t)?this.Bq.get(t).typeName:""}getUniformTypeByNS(t){return this.Bq.has(t)?this.Bq.get(t).type:0}hasUniformByName(t){return this.Bq.has(t)}getUniformLengthByNS(t){return this.Bq.has(t)?this.Bq.get(t).arrLength:0}initShdProgram(){let t,e=this.Ay.getVSCodeStr(),s=this.Ay.getFSCodeStr();r.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(e.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),e=e.replace(t," highp ")),e.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),e=e.replace(t," highp "))),r.default.SHADERCODE_TRACE_ENABLED;let i=this.loadShader(this.AN.VERTEX_SHADER,e);r.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(s.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),s=s.replace(t," highp ")),s.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),s=s.replace(t," highp "))),r.default.SHADERCODE_TRACE_ENABLED;let a=this.loadShader(this.AN.FRAGMENT_SHADER,s),h=this.AN.createProgram();return this.AN.attachShader(h,a),this.AN.attachShader(h,i),this.AN.linkProgram(h),this.AN.getProgramParameter(h,this.AN.LINK_STATUS)?(this.Bs=i,this.Bt=a,h):(r.default.SHADERCODE_TRACE_ENABLED,null)}loadShader(t,e){let s=this.AN.createShader(t);return this.AN.shaderSource(s,e),this.AN.compileShader(s),this.AN.getShaderParameter(s,this.AN.COMPILE_STATUS)?s:(r.default.SHADERCODE_TRACE_ENABLED,this.AN.deleteShader(s),null)}getUniqueShaderName(){return this.Bg}enabled(){return null!=this.Bf}upload(t,e){null==this.Bf&&(this.A=e,this.AN=t,this.Bf=this.initShdProgram(),this.Bf.uniqueName=this.Bg,null!=this.Bf&&this.createLocations())}getRCUid(){return this.A}uniformBlockBinding(t,e){this.AN.uniformBlockBinding(this.Bf,this.AN.getUniformBlockIndex(this.Bf,t),e)}toString(){return"[ShdProgram(uniqueName = "+this.Bg+")]"}getGPUProgram(){return this.Bf}destroy(){this.Bi=null,this.Bp=null,this.Bh>0&&(this.Bm.fill(null),this.Bh=0),null!=this.Bf&&(this.AN.deleteShader(this.Bs),this.AN.deleteShader(this.Bt),this.Bs=null,this.Bt=null,this.AN.deleteProgram(this.Bf),this.Bf=null),this.AN=null,this.Ay=null}}e.default=h},2139:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("18c7"));class a{static GetMatTotal(){return a.Kp}static GetFS32Arr(){return a.Kn}static SetFS32Arr(t){a.Kn=t;let e=a.Kp,s=a.Ko;for(let i=0;i<e;++i)s[i].setF32Arr(t)}static GetFreeId(){return a.Al.length>0?a.Al.pop():-1}static Allocate(t){if(t<1024&&(t=1024),a.Kp<1){a.Kp=t,a.Kn=new Float32Array(16*t);let e=0,s=new r.default(a.Kn,16*e),i=s.getUid();for(a.Kq=i,a.Kr=i+t;e<i;++e)a.Ko.push(null),a.Ks.push(a.S_FLAG_FREE);for(a.Ko.push(s),a.Ks.push(a.S_FLAG_FREE),a.Al.push(s.getUid()),e=1;e<t;++e)s=new r.default(a.Kn,16*e),a.Ko.push(s),a.Ks.push(a.S_FLAG_FREE),a.Al.push(s.getUid())}}static GetMatrix(){let t=null,e=a.GetFreeId()-a.Kq;return e>=0?(t=a.Ko[e],t.identity(),a.Ks[e]=a.S_FLAG_BUSY):t=new r.default,t}static RetrieveMatrix(t){if(null!=t){let e=t.getUid();e>=a.Kq&&e<a.Kr&&a.Ks[e-a.Kq]==a.S_FLAG_BUSY&&(a.Al.push(e),a.Ks[e-a.Kq]=a.S_FLAG_FREE)}}}a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.Ko=[],a.Ks=[],a.Al=[],a.Kn=null,a.Kq=0,a.Kr=0,a.Kp=0,e.default=a},"250c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("81ce")),h=i(s("f208")),n=i(s("c164"));class l{constructor(){this.By="#version 300 es\n",this.Bz="\nprecision mediump float;\n",this.B0="\n\nvoid main(){\n",this.B1="\n}\n",this.B2=[],this.B3=[],this.B4=[],this.B5=[],this.B6=[],this.B7=[],this.B8=[],this.B9=[],this.B_=[],this.CA=[],this.CB=[],this.CC=[],this.CD=[],this.CE=[],this.CF=[],this.CG=[],this.CH=[],this.CI=[],this.CJ=[],this.CK=[],this.CL="",this.CM=[],this.CN=!1,this.CO=!1,this.CP=!1,this.CQ=!1,this.CR=!1,this.CS=!1,this.CT="",this.CU="",this.CV="",this.CW="",this.CX="",this.CY="",this.CZ="",this.Ca="",this.Cb=!1,this.Cc=null,this.normalEanbled=!1,this.normalMapEanbled=!1,this.mapLodEnabled=!1,this.derivatives=!1,this.vertMatrixInverseEnabled=!1,this.fragMatrixInverseEnabled=!1}reset(){this.CN=!0,this.CO=!0,this.CP=!0,this.CQ=!1,this.CR=!1,this.CS=!1,this.Cb=!1,this.CT="",this.CU="",this.CV="",this.CW="",this.CX="",this.CY="",this.CZ="",this.Ca="",this.B3=[],this.B2=[],this.B6=[],this.B7=[],this.B8=[],this.B9=[],this.B_=[],this.CE=[],this.CF=[],this.CA=[],this.CB=[],this.CC=[],this.CD=[],this.CG=[],this.CH=[],this.B4=[],this.B5=[],this.CI=[],this.CJ=[],this.CK=[],this.CM=[],this.CL="",this.normalEanbled=!1,this.normalMapEanbled=!1,this.mapLodEnabled=!1,this.vertMatrixInverseEnabled=!1,this.fragMatrixInverseEnabled=!1,this.Cc=null}getPreCompileInfo(){let t=this.Cc;return this.Cc=null,t}useHighPrecious(){this.Bz="precision highp float;"}useMediumPrecious(){this.Bz="precision mediump float;"}useLowPrecious(){this.Bz="precision lowp float;"}addDefine(t,e="1"){this.B4.includes(t)||(this.B4.push(t),this.B5.push(e))}addVertLayout(t,e){this.B6.includes(e)||(this.B6.push(e),this.B7.push(t))}addFragOutputHighp(t,e){this.B9.includes(e)||(this.B8.push("highp"),this.B9.push(e),this.B_.push(t))}addFragOutput(t,e){this.B9.includes(e)||(this.B8.push(""),this.B9.push(e),this.B_.push(t))}addVarying(t,e){this.CE.includes(e)||(this.CE.push(e),this.CF.push(t))}addVertUniform(t,e,s=0){this.CA.includes(e)||(s>0?this.CA.push(e+"["+s+"]"):this.CA.push(e),this.CB.push(t))}addVertUniformParam(t){this.addVertUniform(t.type,t.name,t.arrayLength)}addFragUniform(t,e,s=0){this.CC.includes(e)||(s>0?this.CC.push(e+"["+s+"]"):this.CC.push(e),this.CD.push(t))}addFragUniformParam(t){this.addFragUniform(t.type,t.name,t.arrayLength)}addVertAndFragUniform(t,e,s=0){this.addVertUniform(t,e,s),this.addFragUniform(t,e,s)}addFragFunction(t){this.CG.push(t)}addVertFunction(t){this.CH.push(t)}useTexturePreciseHighp(){this.CL="highp"}addTextureSample2D(t="",e=!0,s=!0,i=!1){if(""==t||!this.CK.includes(t)){this.CI.push("sampler2D"),this.CK.push(t),this.CJ.push(this.CL);let r=0;s&&(r|=2),i&&(r|=4),this.CM.push(r),this.CL="",e&&(this.Cb=!0)}}addTextureSampleCube(t="",e=!0,s=!1){if(""==t||!this.CK.includes(t)){this.CI.push("samplerCube"),this.CK.push(t),this.CJ.push(this.CL);let i=0;e&&(i|=2),s&&(i|=4),this.CM.push(i),this.CL=""}}addTextureSample3D(t="",e=!0,s=!1){if(""==t||!this.CK.includes(t)){this.CI.push("sampler3D"),this.CK.push(t),this.CJ.push(this.CL);let i=0;e&&(i|=2),s&&(i|=4),this.CM.push(i),this.CL=""}}isHaveTexture(){return this.CI.length>0}isHaveTexture2D(){return this.Cb}useVertSpaceMats(t=!0,e=!0,s=!0){this.CN=t,this.CO=e,this.CP=s}useFragSpaceMats(t=!0,e=!0,s=!0){this.CQ=t,this.CR=e,this.CS=s}addVertExtend(t){this.B3.push(t)}addFragExtend(t){this.B2.push(t)}addVertHeadCode(t){""!=t&&(this.CT+="\n"+t)}addVertMainCode(t){""!=t&&(this.CU+="\n"+t)}addFragHeadCode(t){""!=t&&(this.CX+="\n"+t)}addFragMainCode(t){""!=t&&(this.CY+="\n"+t)}addShaderObject(t){this.addFragHeadCode(t.frag_head),this.addFragMainCode(t.frag_body),this.addVertHeadCode(t.vert_head),this.addVertMainCode(t.vert_body)}addShaderObjectHead(t){this.addFragHeadCode(t.frag_head),this.addVertMainCode(t.vert_head)}autoBuildHeadCode(){this.addVertLayout("vec3","a_vs"),this.Cb&&(this.addVertLayout("vec2","a_uvs"),this.addVarying("vec2","v_uv")),(this.normalEanbled||this.normalMapEanbled)&&(this.addVertLayout("vec3","a_nvs"),this.addVarying("vec3","v_worldNormal"),this.addVarying("vec3","v_worldPosition")),this.B9.length<1&&this.addFragOutput("vec4","FragColor0")}buildFragCode(){this.autoBuildHeadCode();let t=0,e=0,s="";for((r.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED||r.default.IsMobileWeb())&&this.useHighPrecious(),r.default.IsWebGL2()&&(s+=this.By),this.Cc=new h.default,this.Cc.info="\n//##COMPILE_INFO_BEGIN",this.Cc.info+="\n//##COMPILE_INFO_END",t=0,e=this.B2.length;t<e;t++)s+="\n"+this.B2[t];for(r.default.IsWebGL1()&&(this.B9.length>1&&(s+="\n#extension GL_EXT_draw_buffers: require"),(this.normalMapEanbled||this.derivatives)&&(s+="\n#extension GL_OES_standard_derivatives : enable"),this.mapLodEnabled&&(s+="\n#extension GL_EXT_shader_texture_lod : enable")),r.default.IsWebGL2()?(s+="\n#define VOX_IN in",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureLod",s+="\n#define VOX_Texture2DLod textureLod"),s+="\n#define VOX_Texture2D texture",s+="\n#define VOX_TextureCube texture"):(s+="\n#define VOX_IN varying",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureCubeLodEXT",s+="\n#define VOX_Texture2DLod texture2DLodEXT"),s+="\n#define VOX_TextureCube textureCube",s+="\n#define VOX_Texture2D texture2D"),r.default.IsMobileWeb()?s+="\nprecision highp float;":s+="\n"+this.Bz,s+=n.default.FragPredefined,e=this.B4.length,t=0;t<e;t++)""!=this.B5[t]?s+="\n#define "+this.B4[t]+" "+this.B5[t]:s+="\n#define "+this.B4[t]+" 1";for(t=0,e=this.CK.length;t<e;t++)""!=this.CK[t]&&0!=(2&this.CM[t])&&(s+="\n#define "+this.CK[t]+" u_sampler"+t);for(this.Cb&&(s+="\n#define VOX_USE_2D_MAP 1"),t=0,e=this.CI.length;t<e;t++)0!=(2&this.CM[t])&&(""==this.CJ[t]?s+="\nuniform "+this.CI[t]+" u_sampler"+t+";":s+="\nuniform "+this.CJ[t]+" "+this.CI[t]+" u_sampler"+t+";");for(t=0,e=this.CD.length;t<e;t++)s+="\nuniform "+this.CD[t]+" "+this.CC[t]+";";if(this.CQ&&(s+="\nuniform mat4 u_objMat;"),this.CR&&(s+="\nuniform mat4 u_viewMat;"),this.CS&&(s+="\nuniform mat4 u_projMat;"),e=this.CE.length,r.default.IsWebGL2())for(t=0;t<e;t++)s+="\nin "+this.CF[t]+" "+this.CE[t]+";";else for(t=0;t<e;t++)s+="\nvarying "+this.CF[t]+" "+this.CE[t]+";";for(s+=n.default.FragDefined,this.fragMatrixInverseEnabled&&r.default.IsWebGL1()&&(this.addVertFunction(a.default.__glslInverseMat3),this.addVertFunction(a.default.__glslInverseMat4)),s+=this.CX,t=0,e=this.CG.length;t<e;t++)s+="\n"+this.CG[t];if(t=0,e=this.B9.length,r.default.IsWebGL2())for(;t<e;t++)""!=this.B8[t]?s+="\nlayout(location = "+t+") out "+this.B8[t]+" "+this.B_[t]+" "+this.B9[t]+";":s+="\nlayout(location = "+t+") out "+this.B_[t]+" "+this.B9[t]+";";else 1==e&&(s+="\n#define "+this.B9[t]+" gl_FragColor");let i=!1,l=this.CY.indexOf("{");if(l>0){let t=this.CY.slice(0,l);i=t.indexOf(" main")>0,i||(i=this.CY.indexOf(" main")>0)}if(i?s+=this.CY:(s+="\nvoid main() {\n",s+=this.CY,s+="\n}\n"),e=this.B9.length,r.default.IsWebGL1()&&e>1)for(t=0;t<e;t++){let e=new RegExp(this.B9[t],"g");s=s.replace(e,"gl_FragData["+t+"]")}return s}buildVertCode(){let t=0,e=0,s="";for(r.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&this.useHighPrecious(),r.default.IsWebGL2()&&(s+=this.By),t=0,e=this.B3.length;t<e;t++)s+="\n"+this.B3[t];for(r.default.IsWebGL2()?(s+="\n#define VOX_IN in",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureLod",s+="\n#define VOX_Texture2DLod textureLod"),s+="\n#define VOX_Texture2D texture",s+="\n#define VOX_TextureCube texture"):(s+="\n#define VOX_IN varying",this.mapLodEnabled&&(s+="\n#define VOX_TextureCubeLod textureCubeLodEXT",s+="\n#define VOX_Texture2DLod texture2DLodEXT"),s+="\n#define VOX_TextureCube textureCube",s+="\n#define VOX_Texture2D texture2D"),r.default.IsMobileWeb()?s+="\nprecision highp float;":s+="\n"+this.Bz,r.default.IsWebGL2()?s+="\n#define VOX_OUT out":s+="\n#define VOX_OUT varying",s+=n.default.VertPredefined,e=this.B4.length,t=0;t<e;t++)""!=this.B5[t]?s+="\n#define "+this.B4[t]+" "+this.B5[t]:s+="\n#define "+this.B4[t];for(t=0,e=this.CK.length;t<e;t++)""!=this.CK[t]&&0!=(4&this.CM[t])&&(s+="\n#define "+this.CK[t]+" u_sampler"+t);for(this.Cb&&(s+="\n#define VOX_USE_2D_MAP 1"),t=0,e=this.CI.length;t<e;t++)0!=(4&this.CM[t])&&(""==this.CJ[t]?s+="\nuniform "+this.CI[t]+" u_sampler"+t+";":s+="\nuniform "+this.CJ[t]+" "+this.CI[t]+" u_sampler"+t+";");if(e=this.B6.length,r.default.IsWebGL2())for(t=0;t<e;t++)s+="\nlayout(location = "+t+") in "+this.B7[t]+" "+this.B6[t]+";";else for(t=0;t<e;t++)s+="\nattribute "+this.B7[t]+" "+this.B6[t]+";";for(e=this.CB.length,t=0;t<e;t++)s+="\nuniform "+this.CB[t]+" "+this.CA[t]+";";if(this.CN&&(s+="\nuniform mat4 u_objMat;"),this.CO&&(s+="\nuniform mat4 u_viewMat;"),this.CP&&(s+="\nuniform mat4 u_projMat;"),e=this.CE.length,r.default.IsWebGL2())for(t=0;t<e;t++)s+="\nout "+this.CF[t]+" "+this.CE[t]+";";else for(t=0;t<e;t++)s+="\nvarying "+this.CF[t]+" "+this.CE[t]+";";for(s+=n.default.VertDefined,this.vertMatrixInverseEnabled&&r.default.IsWebGL1()&&(this.addVertFunction(a.default.__glslInverseMat3),this.addVertFunction(a.default.__glslInverseMat4)),s+=this.CT,t=0,e=this.CH.length;t<e;t++)s+="\n"+this.CH[t];let i=!1,h=this.CU.indexOf("{");if(h>0){let t=this.CU.slice(0,h);i=t.indexOf(" main")>0,i||(i=this.CU.indexOf(" main")>0)}return i?s+=this.CU:(s+="\nvoid main() {\n",s+=this.CU,s+="\n}\n"),s}}e.default=l},2560:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279"));class h{create(t,e){let s=null,i=t.getCamera();return e.hasUniformByName(r.default.CameraViewMatUNS)&&e.hasUniformByName(r.default.CameraProjectiveMatUNS)?(s=new a.default,s.uns="u_viewAndProjMat",s.uniformNameList=[r.default.CameraViewMatUNS,r.default.CameraProjectiveMatUNS],s.copyDataFromProbe(i.matUProbe)):e.hasUniformByName(r.default.CameraViewMatUNS)?(s=new a.default,s.uns="u_viewMat",s.uniformNameList=[r.default.CameraViewMatUNS],s.copyDataFromProbeAt(0,i.matUProbe)):e.hasUniformByName(r.default.CameraProjectiveMatUNS)&&(s=new a.default,s.uns="u_projMat",s.uniformNameList=[r.default.CameraProjectiveMatUNS],s.copyDataFromProbeAt(1,i.matUProbe)),s}getIDNS(){return"CameraUniformBuilder"}}e.default=h},"264c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.Cd=null,this.Ce=null,this.Cf=null,this.Cg=null,this.Ch=[],this.Ci=0,this.Cj=null,this.Ck=0,this.Cl=null,this.sortEnabled=!0,this.Cj=t}setSorter(t){this.Cl=t}showInfo(){let t="",e=this.Cd;while(null!=e)t+=e.unit.value+",",e=e.next}clear(){if(null!=this.Cj){this.Ch.length>0&&(this.Ch=[]);let t=this.Cd,e=null;while(null!=t)e=t,t=t.next,e.prev=null,e.next=null;this.Cd=this.Ce=null,this.Ci=0,this.Ck=0,this.sortEnabled=!0,this.Cj=null}this.Cl=null}update(){this.sortEnabled&&this.sort()}run(t){this.Cj.resetUniform();let e=null,s=this.Ch;for(let i=0;i<this.Ck;++i)e=s[i],this.Cj.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t)}runLockMaterial(t){this.Cj.resetUniform();let e=null,s=this.Ch;for(let i=0;i<this.Ck;++i)e=s[i],this.Cj.bindToGpu(e.shdUid),e.vro.run(),e.runLockMaterial2(null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}sort(){if(this.Ci>0){let t=this.Cd;this.Ch.length<this.Ci&&(this.Ch=new Array(Math.round(1.1*this.Ci)+1));let e=0;while(null!=t)t.drawEnabled&&t.unit.drawEnabled&&(this.Ch[e]=t.unit,++e),t=t.next;this.Ck=e;let s=0;null!=this.Cl&&(s=this.Cl.sortRODisplay(this.Ch,e)),s<1&&this.snsort(0,e-1)}}sorting(t,e){let s=this.Ch;this.Cg=s[t];let i=this.Cg.value;while(t<e){while(t<e&&s[e].value>=i)--e;s[t]=s[e];while(t<e&&s[t].value<=i)++t;s[e]=s[t]}return s[t]=this.Cg,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}getNodesTotal(){return this.Ci}getBegin(){return this.Cf=this.Cd,this.Cd}getNext(){return null!=this.Cf&&(this.Cf=this.Cf.next),this.Cf}isEmpty(){return this.Ci<1}addNode(t){null==t.prev&&null==t.next&&(null==this.Cd?this.Ce=this.Cd=t:null!=this.Ce.prev?(this.Ce.next=t,t.prev=this.Ce,this.Ce=t):(this.Cd.next=t,t.prev=this.Ce,this.Ce=t),this.Ce.next=null,this.Ci++)}removeNode(t){null==t.prev&&null==t.next&&t!=this.Cd||(t==this.Cd?t==this.Ce?this.Cd=this.Ce=null:(this.Cd=t.next,this.Cd.prev=null):t==this.Ce?(this.Ce=t.prev,this.Ce.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null,this.Ci--)}}e.default=i},"265e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.__$ruid=-1,this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.prev=null,this.next=null,this.unit=null,this.vro=null,this.tro=null,this.rvroI=-1,this.rtroI=-1}setValue(t){this.unit.value=t}isVsible(){return null==this.unit||this.unit.drawEnabled}updateData(){let t=this.unit;this.drawMode=t.drawMode,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,this.vtxUid=t.vtxUid,this.vro=t.vro,this.shdUid=t.shdUid,this.texMid=t.texMid,this.tro=t.tro}reset(){this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.unit=null,this.vro=null,this.tro=null,this.prev=null,this.next=null}toString(){return"[Object RPONode(uid = "+this.uid+", index = "+this.index+", shdUid = "+this.shdUid+", vtxUid = "+this.vtxUid+")]"}}e.default=i},"278e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.Cm=null,this.Y=null,this.slideSpeed=2,this.Cn=0,this.Co=0,this.Cp=!1}initialize(t,e){null==this.Cm&&(this.Cm=t,this.Y=e)}attach(){this.Cn=this.Cm.mouseX,this.Co=this.Cm.mouseY,this.Cp=!0}detach(){this.Cp=!1}run(){if(this.Cp){let t=(this.Cn-this.Cm.mouseX)*this.slideSpeed,e=(this.Co-this.Cm.mouseY)*this.slideSpeed;this.Y.slideViewOffsetXY(t,e),this.Cn=this.Cm.mouseX,this.Co=this.Cm.mouseY}}}e.CameraDragSlide=i},"29ef":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("7c63"),r=s("e08e");class a{static Initialize(){if(a.Kt){a.Kt=!1;let t=a;t.Rstate=new i.RODrawState,i.RenderColorMask.Rstate=a.Rstate,i.RenderStateObject.Rstate=a.Rstate,t.COLOR_MASK_ALL_TRUE=i.RenderColorMask.Create("all_true",!0,!0,!0,!0),t.COLOR_MASK_ALL_FALSE=i.RenderColorMask.Create("all_false",!1,!1,!1,!1);let e=i.RenderStateObject,s=r.RenderBlendMode;s.NORMAL=e.CreateBlendMode("NORMAL",r.GLBlendMode.ONE,r.GLBlendMode.ZERO,r.GLBlendEquation.FUNC_ADD),s.OPAQUE=e.CreateBlendMode("OPAQUE",r.GLBlendMode.ONE,r.GLBlendMode.ZERO,r.GLBlendEquation.FUNC_ADD),s.TRANSPARENT=e.CreateBlendMode("TRANSPARENT",r.GLBlendMode.SRC_ALPHA,r.GLBlendMode.ONE_MINUS_SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),s.ALPHA_ADD=e.CreateBlendMode("ALPHA_ADD",r.GLBlendMode.ONE,r.GLBlendMode.ONE_MINUS_SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),s.ADD=e.CreateBlendMode("ADD",r.GLBlendMode.SRC_ALPHA,r.GLBlendMode.ONE,r.GLBlendEquation.FUNC_ADD),s.ADD_LINEAR=e.CreateBlendMode("ADD_LINEAR",r.GLBlendMode.ONE,r.GLBlendMode.ONE,r.GLBlendEquation.FUNC_ADD),s.INVERSE_ALPHA=e.CreateBlendMode("INVERSE_ALPHA",r.GLBlendMode.ONE,r.GLBlendMode.SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),s.BLAZE=e.CreateBlendMode("BLAZE",r.GLBlendMode.SRC_COLOR,r.GLBlendMode.ONE,r.GLBlendEquation.FUNC_ADD),s.OVERLAY=e.CreateBlendMode("OVERLAY",r.GLBlendMode.DST_COLOR,r.GLBlendMode.DST_ALPHA,r.GLBlendEquation.FUNC_ADD),s.OVERLAY2=e.CreateBlendMode("OVERLAY2",r.GLBlendMode.DST_COLOR,r.GLBlendMode.SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),t.NORMAL_STATE=e.Create("normal",r.CullFaceMode.BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.BACK_CULLFACE_NORMAL_STATE=t.NORMAL_STATE,t.FRONT_CULLFACE_NORMAL_STATE=e.Create("front_normal",r.CullFaceMode.FRONT,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.NONE_CULLFACE_NORMAL_STATE=e.Create("none_normal",r.CullFaceMode.NONE,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.ALL_CULLFACE_NORMAL_STATE=e.Create("all_cull_normal",r.CullFaceMode.FRONT_AND_BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.BACK_NORMAL_ALWAYS_STATE=e.Create("back_normal_always",r.CullFaceMode.BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.ALWAYS),t.BACK_TRANSPARENT_STATE=e.Create("back_transparent",r.CullFaceMode.BACK,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.TRANSPARENT_SORT),t.BACK_TRANSPARENT_ALWAYS_STATE=e.Create("back_transparent_always",r.CullFaceMode.BACK,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.ALWAYS),t.NONE_TRANSPARENT_STATE=e.Create("none_transparent",r.CullFaceMode.NONE,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.TRANSPARENT_SORT),t.NONE_TRANSPARENT_ALWAYS_STATE=e.Create("none_transparent_always",r.CullFaceMode.NONE,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.ALWAYS),t.FRONT_CULLFACE_GREATER_STATE=e.Create("front_greater",r.CullFaceMode.FRONT,r.RenderBlendMode.NORMAL,r.DepthTestMode.TRUE_GREATER),t.BACK_ADD_BLENDSORT_STATE=e.Create("back_add_blendSort",r.CullFaceMode.BACK,r.RenderBlendMode.ADD,r.DepthTestMode.TRANSPARENT_SORT),t.BACK_ADD_ALWAYS_STATE=e.Create("back_add_always",r.CullFaceMode.BACK,r.RenderBlendMode.ADD,r.DepthTestMode.ALWAYS),t.BACK_ALPHA_ADD_ALWAYS_STATE=e.Create("back_alpha_add_always",r.CullFaceMode.BACK,r.RenderBlendMode.ALPHA_ADD,r.DepthTestMode.ALWAYS),t.NONE_ADD_ALWAYS_STATE=e.Create("none_add_always",r.CullFaceMode.NONE,r.RenderBlendMode.ADD,r.DepthTestMode.ALWAYS),t.NONE_ADD_BLENDSORT_STATE=e.Create("none_add_blendSort",r.CullFaceMode.NONE,r.RenderBlendMode.ADD,r.DepthTestMode.TRANSPARENT_SORT),t.NONE_ALPHA_ADD_ALWAYS_STATE=e.Create("none_alpha_add_always",r.CullFaceMode.NONE,r.RenderBlendMode.ALPHA_ADD,r.DepthTestMode.ALWAYS),t.FRONT_ADD_ALWAYS_STATE=e.Create("front_add_always",r.CullFaceMode.FRONT,r.RenderBlendMode.ADD,r.DepthTestMode.ALWAYS),t.FRONT_TRANSPARENT_STATE=e.Create("front_transparent",r.CullFaceMode.FRONT,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.TRANSPARENT_SORT),t.FRONT_TRANSPARENT_ALWAYS_STATE=e.Create("front_transparent_always",r.CullFaceMode.FRONT,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.ALWAYS),t.NONE_CULLFACE_NORMAL_ALWAYS_STATE=e.Create("none_normal_always",r.CullFaceMode.NONE,r.RenderBlendMode.NORMAL,r.DepthTestMode.ALWAYS),t.BACK_ALPHA_ADD_BLENDSORT_STATE=e.Create("back_alpha_add_blendSort",r.CullFaceMode.BACK,r.RenderBlendMode.ALPHA_ADD,r.DepthTestMode.TRANSPARENT_SORT)}}static CreateBlendMode(t,e,s,r=0){return i.RenderStateObject.CreateBlendMode(t,e,s,r)}static CreateBlendModeSeparate(t,e,s,r=0,a=0,h=0){return i.RenderStateObject.CreateBlendModeSeparate(t,e,s,r,a,h)}static CreateRenderState(t,e,s,r){return i.RenderStateObject.Create(t,e,s,r)}static CreateRenderColorMask(t,e,s,r,a){return i.RenderColorMask.Create(t,e,s,r,a)}static GetRenderStateByName(t){return i.RenderStateObject.GetRenderStateByName(t)}static GetRenderColorMaskByName(t){return i.RenderColorMask.GetColorMaskByName(t)}static UnlockBlendMode(){i.RenderStateObject.UnlockBlendMode()}static LockBlendMode(t){i.RenderStateObject.LockBlendMode(t)}static UnlockDepthTestMode(){i.RenderStateObject.UnlockDepthTestMode()}static LockDepthTestMode(t){i.RenderStateObject.LockDepthTestMode(t)}static ResetState(){i.RenderColorMask.Reset(),i.RenderStateObject.Reset(),a.Rstate.reset()}static Reset(t){i.RenderColorMask.Reset(),i.RenderStateObject.Reset(),a.Rstate.setRenderContext(t),a.Rstate.reset()}static ResetInfo(){a.DrawCallTimes=0,a.DrawTrisNumber=0,a.POVNumber=0}static SetDepthTestEnable(t){a.Rstate.setDepthTestEnable(t)}static SetBlendEnable(t){a.Rstate.setBlendEnable(t)}static SetStencilFunc(t,e,s){a.Rstate.setStencilFunc(t,e,s)}static SetStencilMask(t){a.Rstate.setStencilMask(t)}static SetStencilOp(t,e,s){a.Rstate.setStencilOp(t,e,s)}}a.Kt=!0,a.Rstate=null,a.DrawCallTimes=0,a.DrawTrisNumber=0,a.POVNumber=0,a.COLOR_MASK_ALL_TRUE=0,a.COLOR_MASK_ALL_FALSE=1,a.NORMAL_STATE=0,a.BACK_CULLFACE_NORMAL_STATE=0,a.FRONT_CULLFACE_NORMAL_STATE=1,a.NONE_CULLFACE_NORMAL_STATE=2,a.ALL_CULLFACE_NORMAL_STATE=3,a.BACK_NORMAL_ALWAYS_STATE=4,a.BACK_TRANSPARENT_STATE=5,a.BACK_TRANSPARENT_ALWAYS_STATE=6,a.NONE_TRANSPARENT_STATE=7,a.NONE_TRANSPARENT_ALWAYS_STATE=8,a.FRONT_CULLFACE_GREATER_STATE=9,a.BACK_ADD_BLENDSORT_STATE=10,a.BACK_ADD_ALWAYS_STATE=11,a.BACK_ALPHA_ADD_ALWAYS_STATE=12,a.NONE_ADD_ALWAYS_STATE=13,a.NONE_ADD_BLENDSORT_STATE=14,a.NONE_ALPHA_ADD_ALWAYS_STATE=15,a.FRONT_ADD_ALWAYS_STATE=16,a.FRONT_TRANSPARENT_STATE=17,a.FRONT_TRANSPARENT_ALWAYS_STATE=18,a.NONE_CULLFACE_NORMAL_ALWAYS_STATE=19,a.BACK_ALPHA_ADD_BLENDSORT_STATE=20,e.default=a},"2a95":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("c497")),h=i(s("5336")),n=i(s("b9b5")),l=i(s("bd6f")),_=i(s("91e2")),m=i(s("f63b")),o=i(s("1710")),u=i(s("7045")),d=i(s("0644")),c=i(s("b161")),f=i(s("f444")),p=i(s("a46e")),g=i(s("8e17")),T=i(s("79d6")),v=i(s("c51d")),x=s("3e25"),E=i(s("6e01")),y=s("c77b"),S=i(s("53ea")),A=i(s("402a")),b=s("cc48"),R=i(s("2be0")),M=s("1d72"),F=i(s("519e")),L=i(s("6ef8")),D=i(s("8dce")),w=i(s("77cf")),B=s("0714"),P=i(s("af2e")),C=i(s("065e"));class N{constructor(){this.Cq=null,this.Cr=null,this.Cs=new h.default,this.Ct=null,this.Cu=0,this.Cv=new f.default,this.Cw=new p.default,this.Cx=new S.default,this.Cy=new B.MaterialPipeline,this.Cz=null,this.C0=!1,this.h=null,this.C1=null,this.C2=null,this.C3=null,this.C4=new y.PathMotionAction,this.C5=new g.default,this.C6=new g.default,this.C7=!0,this.C8=-1,this.C9=new g.default}initialize(){if(null==this.Cq){r.default.SHADERCODE_TRACE_ENABLED=!0,r.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0;let t=new a.default;t.setAttriAntialias(!r.default.IsMobileWeb()),t.setCamPosition(1800,1800,1800),t.setCamProject(45,20,9e3),this.Cq=new c.default,this.Cq.initialize(t,3),this.Cq.updateCamera(),this.Ct=new m.default(this.Cq.textureBlock),this.Cr=new d.default,this.Cr.bindCamera(this.Cq.getCamera()),this.Cs.initialize(),this.Cq.addEventListener(o.default.MOUSE_DOWN,this,this.mouseDown),this.Cq.addEventListener(u.default.KEY_DOWN,this,this.keyDown),this.Cx.bindCameraAndStage(this.Cq.getCamera(),this.Cq.getStage3D()),this.Cx.setPlaneParam(new g.default(0,1,0),0),this.Cq.enableMouseEvent(!0),this.Cw.bindCamera(this.Cq.getCamera()),this.Cw.initialize(this.Cq.getStage3D()),this.Cv.initialize(this.Cq.getStage3D(),this.Cq.getCamera()),this.Cw.setLookAtCtrlEnabled(!1),this.update(),this.initTerrain2(),this.loadRoadData()}}getImageTexByUrl(t){return this.Ct.getTexByUrl(t)}initTerrain2(){let t=new w.default;t.initialize(),t.setFogDensity(.003),t.setFogColorRGB3f(1,1,1),t.setFogAreaSize(2e3,2e3),t.setFogAreaOffset(-1e3,-1e3),this.Cy.addPipe(t);let e=new D.default;e.fogEnabled=!0,e.setMaterialPipeline(this.Cy),e.setTextureList([this.getImageTexByUrl("static/assets/moss_04.jpg"),this.getImageTexByUrl("static/assets/color_02.jpg"),this.getImageTexByUrl("static/assets/heightMap05.jpg")]),e.setRGB3f(1.2,1.2,1.2),e.initializeByCodeBuf(!0),e.setDisplacementParams(60,.1);let s=500,i=new P.default;i.normalEnabled=!0,i.initializeXOZPlane(new g.default(-.5*s,0,-.5*s),s,s,256,256);let r=new F.default;r.setBufSortFormat(e.getBufSortFormat()),r.initializeFromGeometry(i);let a=new A.default;a.setMaterial(e),a.setMesh(r),a.setScaleXYZ(4,12,4),a.setXYZ(0,-400,0),this.Cq.addEntity(a);let h=new L.default;h.setMaterialPipeline(this.Cy),h.setTextureList([this.getImageTexByUrl("static/assets/color_02.jpg"),this.getImageTexByUrl("static/assets/color_02.jpg")]),h.initializeByCodeBuf(!0);let n=new C.default;n.setMaterial(h),n.setRotationXYZ(0,45,0),n.showDoubleFace(),n.initialize(1400,1200,4,1),this.Cq.addEntity(n)}initTerrain(){let t=new w.default;t.initialize(),t.setFogDensity(.003),t.setFogColorRGB3f(1,1,1),t.setFogAreaSize(2e3,2e3),t.setFogAreaOffset(-1e3,-1e3),this.Cy.addPipe(t);let e=new l.default;e.uScale=5,e.vScale=5,e.initializeXOZSquare(1900,[this.Ct.getTexByUrl("static/assets/wood_02.jpg")]),e.setXYZ(0,-300,0),this.Cq.addEntity(e);let s=3700,i=new _.default;i.spaceCullMask=b.SpaceCullingMask.NONE,i.uScale=4,i.vScale=4,i.showFrontFace(),i.initialize(new g.default(-s,.5*-s,-s),new g.default(s,1.5*s,s),[this.Ct.getTexByUrl("static/assets/brickwall_big.jpg")]),i.setXYZ(0,0,0),this.Cq.addEntity(i)}loadRoadData(){let t=new R.default;t.uuid="road_vrd",t.load("static/assets/scene/pathData_03.vrd",this)}loaded(t,e){let s=new M.RoadFile;this.Cz=s.parsePathDataFromFileBuffer(new Uint8Array(t)),this.buildRoadEntity()}loadError(t,e){}buildRoadEntity(){let t=new L.default;t.setMaterialPipeline(this.Cy),t.setTextureList([this.getImageTexByUrl("static/assets/roadSurface04.jpg"),this.getImageTexByUrl("static/assets/color_02.jpg")]),t.initializeByCodeBuf(!0);let e=new F.default;e.vs=this.Cz.vs,e.uvs=this.Cz.uvs,e.setIVS(this.Cz.ivs),e.setBufSortFormat(t.getBufSortFormat()),e.initialize();let s=new A.default;s.setMesh(e),s.setMaterial(t),this.Cq.addEntity(s),this.initCamera(),this.initPathAct(this.Cz.pathPosList)}initCamera(){let t=new g.default(-500,300,0),e=new x.RHCameraView;e.setPosition(t),e.update(),this.h=e;let s=new v.default;s.setViewMatrix(e.getViewMatrix()),s.perspectiveRH(E.default.DegreeToRadian(45),800/600,80,500),s.update();let i=new T.default;i.initiazlize(s),this.Cq.addEntity(i),this.C1=s,this.C2=i,this.h.setCamera(this.C1)}initPathAct(t=null){let e=new n.default;if(e.initializeCross(70,new g.default(30,0,0)),this.Cq.addEntity(e),this.C3=e,null==t){let e,s;t=[new g.default(72.13681306524768,0,27.767672487209893),new g.default(232.57540440645494,0,70.43368422643721),new g.default(349.5954994160545,0,249.1118245856153),new g.default(469.0805206640016,0,506.1222026231883),new g.default(726.1962941671513,0,952.0773283474781),new g.default(797.282565704728,0,957.4895012832981),new g.default(886.988563966599,0,906.612424665302),new g.default(959.193382823809,0,799.1431026228652),new g.default(1002.9603798633241,0,635.8523626329904),new g.default(925.7715755056693,0,522.56229219789),new g.default(751.6705041578543,0,396.85277546175894),new g.default(485.7543244927572,0,379.48625494810153),new g.default(175.64026123332633,0,481.229817314442),new g.default(84.24498287944061,0,566.1330588516862),new g.default(-34.07380417008335,0,704.0486518930372),new g.default(-100.62421233657756,0,829.0974507141026),new g.default(-169.17457754402494,0,902.3925779858835),new g.default(-268.674786630811,0,940.5287682590804),new g.default(-338.2053026173978,0,905.7625526827653),new g.default(-391.53719551871154,0,840.8612850793324),new g.default(-391.66407835711743,0,746.2275974006964),new g.default(-432.8957923948808,0,667.3725334709904),new g.default(-405.75470117828195,0,494.0844385137923),new g.default(-415.09131983068073,0,416.58967648035605),new g.default(-399.0999233442824,0,232.400979310288),new g.default(-386.3711609536929,0,71.00287704532411),new g.default(-389.3674265096629,0,-84.03999101794761),new g.default(-305.5318818950261,0,-264.3926193617656),new g.default(-215.93783387524513,0,-335.41016026158377),new g.default(-27.871917976013947,0,-364.9410411045287),new g.default(127.75878095653206,0,-378.1144673662734),new g.default(267.35067660028494,0,-380.2834737923422),new g.default(425.22150173395266,0,-355.6636192834526),new g.default(502.7277634189411,0,-350.6417982930757),new g.default(638.2887470397126,0,-312.17181651928104),new g.default(735.3762145812532,0,-245.52681228216397),new g.default(787.4757858296327,0,-145.21537522179688),new g.default(799.1580428901602,0,-39.610758195229664),new g.default(815.6961859265716,0,43.95180160799532),new g.default(816.4167746077171,0,89.29229223297352),new g.default(784.1597197739072,0,147.72601461284648),new g.default(793.5147466678391,0,207.2704045083476),new g.default(825.3509903063741,0,254.2688982492782),new g.default(883.4564347189822,0,276.1537675979389),new g.default(938.0518532676846,0,294.61644742553995)];for(let i=0;i<t.length;++i){e=t[i];let r=new n.default;r.initializeCorssSizeXYZ(50,10,50),r.setXYZ(e.x,e.y,e.z),0==i?this.C5.subVecsTo(t[i+1],t[i]):i<t.length-1?(this.C5.subVecsTo(t[i],t[i-1]),this.C6.subVecsTo(t[i+1],t[i]),this.C5.addBy(this.C6)):this.C5.subVecsTo(t[i-1],t[i]),s=360-E.default.GetDegreeByXY(this.C5.x,this.C5.z),r.setRotationXYZ(0,s,0),this.Cq.addEntity(r)}}this.C4.cameraFollower.setCameraView(this.h),this.C4.bindTarget(this.C3),this.C4.setPathPosList(t,!0)}switchCamera(){null!=this.h&&(this.C7?this.h.setCamera(this.Cq.getCamera()):this.h.setCamera(this.C1),this.C7=!this.C7)}mouseDown(t){this.switchCamera(),this.Cx.intersectPlane();this.Cx.position}keyDown(t){this.C0=!this.C0,this.C0?this.Cv.enableSlide():this.Cv.enableSwing()}update(){this.C8>-1&&clearTimeout(this.C8),this.C8=setTimeout(this.update.bind(this),30),this.Cv.runWithYAxis(),this.Cw.run(null,30),this.Cs.render()}run(){this.C0,this.Cs.update(!1),null!=this.C2&&(this.C4.run(),this.C2.updateFrame(this.h.getCamera()),this.C2.updateMeshToGpu()),this.Cq.run()}}e.DemoCameraMotion=N,e.default=N},"2be0":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uuid="BinaryLoader"}async load(t,e,s=""){const i=new FileReader;i.onload=t=>{e.loaded(i.result,this.uuid)};const r=new XMLHttpRequest;r.open("GET",t,!0),""!=s&&r.setRequestHeader("Range",s),r.responseType="blob",r.onload=t=>{r.status<=206?i.readAsArrayBuffer(r.response):e.loadError(r.status,this.uuid)},r.onerror=t=>{e.loadError(r.status,this.uuid)},r.send()}}e.default=i},"2be1":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.Ci=0,this.Ch=[],this.C_=[],this.Al=[]}createNode(){return null}restoreUid(t){}getFreeId(){return this.Al.length>0?this.Al.pop():-1}getNodeByUid(t){return this.Ch[t]}create(){let t=null,e=this.getFreeId();return e>=0?(t=this.Ch[e],t.uid=e,this.C_[e]=i.S_BUSY):(t=this.createNode(),this.Ch.push(t),this.C_.push(i.S_BUSY),t.uid=this.Ci,this.Ci++),t}restore(t){return null!=t&&t.uid>=0&&this.C_[t.uid]==i.S_BUSY&&(this.restoreUid(t.uid),this.Al.push(t.uid),this.C_[t.uid]=i.S_FREE,t.reset(),!0)}restoreByUid(t){return t>=0&&t<this.Ci&&this.C_[t]==i.S_BUSY&&(this.restoreUid(t),this.Al.push(t),this.C_[t]=i.S_FREE,this.Ch[t].reset(),!0)}}i.S_BUSY=1,i.S_FREE=0,e.default=i},"2e8a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("644c"));class h{constructor(){this.type=-1,this.attriType=-1,this.typeSize=3,this.typeName="",this.name="",this.layoutEnabled=!0}parseCode(t){const e=";",s=" ";t=t.replace(/^\s*|\s*$/g,"");let i=t.indexOf(e);i>0&&(t=t.slice(0,i));let h=t.split(s);this.typeName=h[h.length-2],this.name=h[h.length-1],this.type=a.default.GetTypeByTypeNS(this.typeName),this.typeSize=parseInt(this.typeName.slice(this.typeName.length-1)),this.attriType=r.default.GetVBufAttributeTypeByNS(this.name)}}e.default=h},3024:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3077"));class a extends r.default{constructor(t){super(),this.DA=null,this.DB=1,t<1&&(t=1),this.DB=t,this.DA=new Float32Array(4*t)}bindSlotAt(t){super.bindSlotAt(t),this.addVec4Data(this.DA,this.DB)}destroy(){super.destroy(),this.DA=null}}e.default=a},3077:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("644c")),a=i(s("5326"));class h{constructor(){this.u=null,this.DC=null,this.DD=0,this.DE=-1,this.rst=-1,this.uniformsTotal=0,this.uniformTypes=null,this.dataSizeList=null}getSlotBeginIndex(){return this.DE}getSlotUid(){return this.u.getUid()}getFS32At(t){return this.DC[t]}setFS32At(t,e){this.DC[e]=t}setVec4DataAt(t,e,s,i,r){let a=this.DC[t];a[0]=e,a[1]=s,a[2]=i,a[3]=r}setVec4Data(t,e,s,i){let r=this.DC[0];r[0]=t,r[1]=e,r[2]=s,r[3]=i}setVec4DataAtWithArr4(t,e){this.DC[t].set(e,0)}setVec4DataWithArr4(t){this.DC[0].set(t,0)}addVec4Data(t,e){t.length,this.DC.push(t),this.uniformTypes.push(r.default.SHADER_VEC4),this.dataSizeList.push(e),this.u.dataList[this.DD]=t,this.DD++,this.uniformsTotal++,this.u.index++}addMat4Data(t,e){this.DC.push(t),this.uniformTypes.push(r.default.SHADER_MAT4),this.dataSizeList.push(e),this.u.dataList[this.DD]=t,this.DD++,this.uniformsTotal++,this.u.index++}isEnabled(){return this.rst>=0}bindSlotAt(t){let e=a.default.GetSlotAt(t);this.rst>=0&&this.reset(),null==this.DC&&(this.DC=[],this.uniformTypes=[],this.dataSizeList=[]),this.u=e,this.rst=1,this.DE=e.index,this.DD=e.index}update(){if(this.rst++,this.uniformsTotal<2)this.u.flagList[this.DE]=this.rst;else for(let t=this.DE;t<=this.DD;++t)this.u.flagList[t]=this.rst}reset(){this.rst=-1,this.DE=-1,this.uniformsTotal=0,this.DD=0,null!=this.DC&&(this.DC=null,this.uniformTypes=null,this.dataSizeList=null),this.u=null}destroy(){this.reset()}}e.default=h},"32cc":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("b3bd")),a=i(s("faa5")),h=i(s("0fc4"));class n extends a.default{constructor(){super(),this.DF="",this.dynColorEnabled=!1}initialize(t){this.DF="Line3DShd",this.dynColorEnabled&&(this.DF+="_dynColor")}buildThisCode(){this.DG.addVertLayout("vec3","a_vs"),this.dynColorEnabled?(this.DG.addDefine("DYNAMIC_COLOR"),this.DG.addFragUniform("vec4","u_color")):(this.DG.addVertLayout("vec3","a_cvs"),this.DG.addVarying("vec3","v_color")),this.DG.addFragOutputHighp("vec4","FragColor0"),this.DG.addFragMainCode("\nvoid main(){\n    #ifndef DYNAMIC_COLOR\n        FragColor0 = vec4(v_color, 1.0);\n    #else\n        FragColor0 = u_color;\n    #endif\n\n}\n            "),this.DG.addVertMainCode("\nvoid main()\n{\n    vec4 pv = u_projMat * u_viewMat * u_objMat * vec4(a_vs,1.0);\n    // pixels move offset, and no perspective error.\n    //  pv.xy = (pv.xy/pv.w - vec2(0.5)) * pv.w;\n    #ifndef DYNAMIC_COLOR\n        v_color = a_cvs;\n    #endif\n    gl_Position = pv;\n}\n            "),this.pipeline}getFragShaderCode(){return this.buildThisCode(),this.DG.buildFragCode()}getVtxShaderCode(){return this.DG.buildVertCode()}getUniqueShaderName(){return this.DF}toString(){return"[Line3DShaderBuffer()]"}static GetInstance(){return null!=n.Ku||(n.Ku=new n),n.Ku}}n.Ku=null;class l extends h.default{constructor(t=!1){if(super(),this.DH=!1,this.DI=null,t&&(this.DI=new Float32Array([1,1,1,1]),this.DH)){let t=new r.default;t.uniformNameList=["u_color"],t.dataList=[this.DI],this.Av=t}this.DH=t}getCodeBuf(){return n.GetInstance().dynColorEnabled=this.DH,n.GetInstance()}setRGB3f(t,e,s){null!=this.DI&&(this.DI[0]=t,this.DI[1]=e,this.DI[2]=s)}}e.default=l},"34df":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}downloadBinFile(t,e,s="vrd"){var i,r;i=function(t,e,s){var i,a;i=new Blob([t],{type:s}),a=window.URL.createObjectURL(i),r(a,e),setTimeout((function(){return window.URL.revokeObjectURL(a)}),1e3)},r=function(t,e){var s;s=document.createElement("a"),s.href=t,s.download=e,document.body.appendChild(s),s.style="display: none",s.click(),s.remove()},i(t,e+"."+s,"application/octet-stream")}}e.FileIO=i},"35fa":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{static ClacTriNormal(t,e,s,i){r.default.Subtract(e,t,a.Kx),r.default.Subtract(s,e,a.Kw),r.default.Cross(a.Kx,a.Kw,i),i.normalize()}static ClacTriNormalByVS(t,e,s){let i=9*e;a.Kv.setTo(t[i],t[i+1],t[i+2]),s.setTo(t[i+3],t[i+4],t[i+5]),a.Kw.setTo(t[i+6],t[i+7],t[i+8]),s.subtractBy(a.Kv),a.Kw.subtractBy(a.Kv),s.crossBy(a.Kw),s.normalize()}static ClacTriNormalByIVS(t,e,s,i){let r=3*e,h=3*s[r];a.Kv.setTo(t[h],t[h+1],t[h+2]),h=3*s[r+1],i.setTo(t[h],t[h+1],t[h+2]),h=3*s[r+2],a.Kw.setTo(t[h],t[h+1],t[h+2]),i.subtractBy(a.Kv),a.Kw.subtractBy(a.Kv),i.crossBy(a.Kw),i.normalize()}static ClacTrisNormal(t,e,s,i,h){let n=new r.default,l=0,_=0,m=0;for(m=0;m<e;++m)h[m]=0;for(m=0;m<s;++m)a.ClacTriNormalByIVS(t,m,i,n),l=3*m,_=3*i[l],h[_]+=n.x,h[_+1]+=n.y,h[_+2]+=n.z,_=3*i[l+1],h[_]+=n.x,h[_+1]+=n.y,h[_+2]+=n.z,_=3*i[l+2],h[_]+=n.x,h[_+1]+=n.y,h[_+2]+=n.z;for(m=0;m<e;m+=3)a.Kv.setTo(h[m],h[m+1],h[m+2]),a.Kv.normalize(),h[m]=a.Kv.x,h[m+1]=a.Kv.y,h[m+2]=a.Kv.z}static ClacTriTangent(t,e,s,i,r,h,n){let l=3*i,_=3*r[l];a.Kv.setTo(s[_],s[_+1],s[_+2]),a.Kv.setTo(t[_],t[_+1],t[_+2]),_=3*r[l+1],a.Kx.setTo(t[_],t[_+1],t[_+2]),_=3*r[l+2],a.Kw.setTo(t[_],t[_+1],t[_+2]),_=2*r[l],a.Ky.setTo(e[_],e[_+1],0),_=2*r[l+1],a.Kz.setTo(e[_],e[_+1],0),_=2*r[l+2],a.K0.setTo(e[_],e[_+1],0),a.Kx.subtractBy(a.Kv),a.Kw.subtractBy(a.Kv),a.Kz.subtractBy(a.Ky),a.K0.subtractBy(a.Ky);let m=1/(a.Kz.x*a.K0.y-a.Kz.y*a.K0.x);h.copyFrom(a.Kx),h.scaleBy(a.K0.y),a.Kv.copyFrom(a.Kw),a.Kv.scaleBy(a.Kz.y),h.subtractBy(a.Kv),h.scaleBy(m),h.normalize(),n.copyFrom(a.Kw),n.scaleBy(a.Kz.x),a.Kv.copyFrom(a.Kx),a.Kv.scaleBy(a.K0.x),n.subtractBy(a.Kv),n.scaleBy(m),n.normalize()}static ClacTrisTangent(t,e,s,i,h,n,l,_){let m=new r.default,o=new r.default,u=0,d=0,c=0;for(c=0;c<e;++c)l[c]=0,_[c]=0;for(c=0;c<h;++c)a.ClacTriTangent(t,s,i,c,n,m,o),u=3*c,d=3*n[u],l[d]=m.x,l[d+1]=m.y,l[d+2]=m.z,_[d]=o.x,_[d+1]=o.y,_[d+2]=o.z,d=3*n[u+1],l[d]=m.x,l[d+1]=m.y,l[d+2]=m.z,_[d]=o.x,_[d+1]=o.y,_[d+2]=o.z,d=3*n[u+2],l[d]=m.x,l[d+1]=m.y,l[d+2]=m.z,_[d]=o.x,_[d+1]=o.y,_[d+2]=o.z;for(c=0;c<e;c+=3)a.Ky.setTo(l[c],l[c+1],l[c+2]),a.Ky.normalize(),a.Kx.setTo(_[c],_[c+1],_[c+2]),a.Kx.normalize(),a.Kw.setTo(i[c],i[c+1],i[c+2]),a.Kv.copyFrom(a.Kw),a.Kw.scaleBy(a.Kw.dot(a.Ky)),a.Ky.subtractBy(a.Kw),a.Ky.normalize(),a.Kw.setTo(i[c],i[c+1],i[c+2]),a.Kw.scaleBy(a.Kx.dot(a.Kw)),a.Kx.subtractBy(a.Kw),a.Kx.normalize(),a.Kv.crossBy(a.Ky),a.Kv.dot(a.Kx)<0&&a.Ky.scaleBy(-1),l[c]=a.Ky.x,l[c+1]=a.Ky.y,l[c+2]=a.Ky.z,a.Kx.setTo(i[c],i[c+1],i[c+2]),a.Kx.crossBy(a.Ky),a.Kx.normalize(),_[c]=a.Kx.x,_[c+1]=a.Kx.y,_[c+2]=a.Kx.z}}a.Kv=new r.default,a.Kx=new r.default,a.Kw=new r.default,a.Ky=new r.default,a.Kz=new r.default,a.K0=new r.default,a.K1=new r.default,e.default=a},"36cb":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("e08e"),a=i(s("ab73")),h=s("b02c"),n=i(s("4f27")),l=i(s("b30a")),_=i(s("9156")),m=s("74c3");class o{constructor(){this.DJ=null,this.Cj=null,this.BP=null,this.BR=null,this.DK=null,this.Be=null,this.DL=null,this.DM=null,this.DN=[],this.DO=[],this.DP=[],this.DQ=!1}initialize(t,e,s,i){null==this.Cj&&(this.Be=t,this.DL=t.Vertex,this.DM=t.Texture,this.Cj=new l.default(t.getRCUid(),t.getRC(),t.getRenderAdapter()),this.BP=e,this.BR=s,this.DK=i,this.DJ=new h.EmptyTexRenderObj(this.DM))}getRenderProxy(){return this.Be}getRenderShader(){return this.Cj}getTextureResource(){return this.DM}updateTextureData(t,e){this.DM.hasResUid(t.getResUid())&&(e?(this.DP.push(t),this.DQ=!0):t.__$updateToGpu(this.DM))}updateDispTRO(t,e){t.__$ruid>-1&&(e?(this.DO.push(t),this.DQ=!0):this.updateTextureTRO(t))}createTRO(t,e){if(null!=t){for(let e=0;e<t.length;++e)null!=t[e]&&t[e].__$setRenderProxy(this.Be);return h.TextureRenderObj.Create(this.DM,t,e)}return null}updateTextureTRO(t){if(null!=t.__$$runit){let e=t.getMaterial();if(null!=e){let s=this.DM,i=t.__$$runit,r=h.TextureRenderObj.GetByMid(s.getRCUid(),e.__$troMid);if(null!=i.tro&&(null==r||i.tro.getMid()!=r.getMid())){let t=this.Cj.findShdProgramByShdData(e.getShaderData());null!=t&&(t.getTexTotal()>0?(null==r&&(r=this.createTRO(e.getTextureList(),t.getTexTotal())),i.tro!=r&&(null!=i.tro&&i.tro.__$detachThis(),i.tro=r,r.__$attachThis(),i.texMid=i.tro.getMid(),this.BR.rejoinRunitForTro(i),e.__$troMid=i.tro.getMid())):i.tro!=this.DJ&&(null!=i.tro&&i.tro.__$detachThis(),i.tro=this.DJ,i.texMid=i.tro.getMid(),this.BR.rejoinRunitForTro(i),e.__$troMid=i.texMid))}}}}updateDispMaterial(t,e){let s=null;if(e.__$ruid>=0){let i=this.Be,r=e.getMaterial();if(null!=r){if(null==r.getShaderData()){let t=r.getTextureList(),e=null!=t&&null!=t&&t.length>0;r.initializeByCodeBuf(e)}s=this.Cj.create(r.getShaderData()),s.upload(i.RContext,i.getUid()),t.shdUid=s.getUid();let h=null;if(s.getTexTotal()>0?(h=this.createTRO(r.getTextureList(),s.getTexTotal()),t.tro!=h&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=h,h.__$attachThis(),t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.BR.rejoinRunitForTro(t),r.__$troMid=t.tro.getMid())):t.tro!=this.DJ&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=this.DJ,t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.BR.rejoinRunitForTro(t),r.__$troMid=t.texMid),null==this.Cj.getSharedUniformByShd(s)){let t=this.createsharedMList(r,s);if(null!=t)for(let e=0;e<t.length;++e)t[e].program=s.getGPUProgram();this.Cj.setSharedUniformByShd(s,n.default.BuildShared(t,i,s))}let l=s.hasUniformByName(a.default.LocalTransformMatUNS);null==r.__$uniform&&(r.__$uniform=n.default.BuildLocalFromData(r.createSelfUniformData(),s)),l&&null!=e.getTransform()&&(t.transUniform=_.default.GetTransUniform(e.getTransform())),null==t.transUniform?(t.transUniform=n.default.BuildLocalFromTransformV(l?e.getMatrixFS32():null,s),_.default.SetTransUniform(e.getTransform(),t.transUniform)):t.transUniform=n.default.UpdateLocalFromTransformV(t.transUniform,l?e.getMatrixFS32():null,s),t.uniform=r.__$uniform}}return s}updateVtxDataToGpuByUid(t,e){this.DL.updateDataToGpu(t,e)}updateDispVbuf(t,e){if(t.__$ruid>-1)if(e)this.DN.push(t),this.DQ=!0;else{let e=t.__$$runit;if(null!=e&&e.vtxUid!=t.vbuf.getUid()){let s=e.vtxUid,i=this.DL;i.hasResUid(s)&&i.__$detachRes(s),e.vro.__$detachThis(),this.buildVtxRes(t,e,this.Cj.findShdProgramByUid(e.shdUid)),e.__$rprouid>=0&&this.BR.rejoinRunitForVro(e)}}}buildVtxRes(t,e,s){if(null!=t.vbuf){let i=this.DL;e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,e.visible=t.visible,e.setVisible(t.visible),e.drawMode=t.drawMode,e.renderState=t.renderState,e.rcolorMask=t.rcolorMask,e.trisNumber=t.trisNumber;let r,a=t.vbuf.getUid(),h=!0;i.hasResUid(a)?(r=i.getVertexRes(a),h=r.version!=t.vbuf.version,h&&(i.destroyRes(a),r.rcuid=i.getRCUid(),r.resUid=a)):(r=new m.GpuVtxObect,r.rcuid=i.getRCUid(),r.resUid=a,i.addVertexRes(r)),h&&(r.indices.ibufStep=t.vbuf.getIBufStep(),r.indices.initialize(this.DK,t.vbuf),r.vertex.initialize(this.DK,s,t.vbuf),r.version=t.vbuf.version),i.__$attachRes(a),e.vro=r.createVRO(this.DK,s,!0),e.vro.__$attachThis(),e.vtxUid=t.vbuf.getUid(),e.ibufStep=e.vro.ibufStep,e.ibufType=4!=e.ibufStep?this.Be.UNSIGNED_SHORT:this.Be.UNSIGNED_INT}}buildGpuDisp(t){if(t.__$ruid<0&&null!=t.getMaterial()){t.__$$rsign=r.DisplayRenderSign.LIVE_IN_WORLD;let e=this.BP.create();if(t.__$ruid=e.uid,t.__$$runit=e,null!=t.getPartGroup()){e.partGroup=t.getPartGroup().slice(0),e.partTotal=e.partGroup.length;let s=e.partGroup;for(let t=0,i=e.partTotal;t<i;)t++,s[t++]*=e.ibufStep}return e.setDrawFlag(t.renderState,t.rcolorMask),this.buildVtxRes(t,e,this.updateDispMaterial(e,t)),!0}return!1}update(){if(this.DQ){this.DQ=!1;let t=this.DN.length,e=0;if(t>0){for(;e<t;++e)this.updateDispVbuf(this.DN[e],!1);this.DN=[]}if(t=this.DO.length,t>0){for(e=0;e<t;++e)this.updateTextureTRO(this.DO[e]);this.DO=[]}if(t=this.DP.length,t>0){for(e=0;e<t;++e)this.DP[e].__$updateToGpu(this.DM);this.DP=[]}}}createsharedMList(t,e){let s=t.createSharedUniforms();if(null==s){let i=t.createSharedUniformsData();if(null!=i&&i.length>0){s=[];for(let t=0;t<i.length;++t)if(null!=i[t]){let r=n.default.BuildLocalFromData(i[t],e);s.push(r)}s.length<1&&(s=null)}}return s}updateGlobalMaterial(t){if(null!=t){let e=this.Be,s=null,i=null,r=null,a=!1;null==t.getShaderData()?(r=t.getTextureList(),a=null!=r&&r.length>0,t.initializeByCodeBuf(a)):r=t.getTextureList(),i=this.Cj.create(t.getShaderData()),i.upload(e.RContext,e.getUid());let h=i.getTexTotal();if(h>0&&(s=this.createTRO(r,h)),null==this.Cj.getSharedUniformByShd(i)){let s=this.createsharedMList(t,i);if(null!=s)for(let t=0;t<s.length;++t)s[t].program=i.getGPUProgram();this.Cj.setSharedUniformByShd(i,n.default.BuildShared(s,e,i))}null==t.__$uniform&&(t.__$uniform=n.default.BuildLocalFromData(t.createSelfUniformData(),i)),this.Cj.__$globalUniform=t.__$uniform,this.Cj.bindToGpu(i.getUid()),null!=s&&s.run()}}reset(){this.DN=[],this.DO=[]}}e.default=o},3806:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("a996")),a=i(s("1710")),h=i(s("7045")),n=i(s("9260")),l=i(s("3024")),_=i(s("badb"));class m{constructor(t,e){this.A=0,this.uProbe=null,this.pixelRatio=1,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.B=0,this.C=0,this.D=1,this.E=1,this.F=new _.default,this.G=[],this.H=[],this.I=[],this.J=[],this.DR=new h.default,this.K=[],this.L=[],this.M=[],this.N=[],this.O=0,this.P=0,this.Q=new a.default,this.DS=new r.default,this.R=!0,this.S=new r.default,this.A=t,null==m.K2&&(m.K2=e,e.onkeydown=function(t){n.default.KeyDown(t)},e.onkeyup=function(t){n.default.KeyUp(t)}),n.default.AddEventListener(h.default.KEY_DOWN,this,this.keyDown),n.default.AddEventListener(h.default.KEY_UP,this,this.keyUp)}getRCUid(){return this.A}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.B}getViewY(){return this.C}getViewWidth(){return this.D}getViewHeight(){return this.E}setViewPort(t,e,s,i){this.R=!1,this.B=t,this.C=e,s==this.D&&i==this.E||(this.D=s,this.E=i,this.updateViewUData())}updateViewUData(){null==this.uProbe&&(this.uProbe=new l.default(1),this.uProbe.bindSlotAt(this.A)),this.uProbe.setVec4Data(2/this.stageWidth,2/this.stageHeight,this.stageWidth,this.stageHeight),this.uProbe.update(),this.O=this.D,this.P=this.E}update(){this.O==this.stageWidth&&this.P==this.stageHeight||(this.R&&(this.D=this.stageWidth,this.E=this.stageHeight,this.updateViewUData()),this.stageHalfWidth=.5*this.stageWidth,this.stageHalfHeight=.5*this.stageHeight,this.DS.target=this,this.DS.type=r.default.RESIZE,this.DS.phase=1,this.sendResizeEvt(this.DS))}keyDown(t){this.DR.phase=1,this.DR.type=h.default.KEY_DOWN,this.DR.altKey=t.altKey,this.DR.ctrlKey=t.ctrlKey,this.DR.shiftKey=t.shiftKey,this.DR.repeat=t.repeat,this.DR.key=t.key,this.DR.keyCode=t.keyCode,this.DR.location=t.location;let e=this.K.length;for(var s=0;s<e;++s)this.K[s].call(this.L[s],this.DR)}keyUp(t){this.DR.phase=1,this.DR.type=h.default.KEY_UP,this.DR.altKey=t.altKey,this.DR.ctrlKey=t.ctrlKey,this.DR.shiftKey=t.shiftKey,this.DR.repeat=t.repeat,this.DR.key=t.key,this.DR.keyCode=t.keyCode,this.DR.location=t.location,this.DR.target=this;let e=this.M.length;for(var s=0;s<e;++s)this.M[s].call(this.N[s],this.DR)}sendResizeEvt(t){let e=this.G.length;for(var s=0;s<e;++s)this.G[s].call(this.H[s],t)}mouseDown(t=1){this.Q.type=a.default.MOUSE_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=t,this.F.dispatchEvt(this.Q)}mouseUp(t=1){this.Q.phase=1,this.Q.type=a.default.MOUSE_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=t,this.F.dispatchEvt(this.Q)}mouseClick(){this.Q.type=a.default.MOUSE_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseDoubleClick(){this.Q.type=a.default.MOUSE_DOUBLE_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightDown(t=1){this.Q.type=a.default.MOUSE_RIGHT_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightUp(t=1){this.Q.type=a.default.MOUSE_RIGHT_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgDown(){this.Q.type=a.default.MOUSE_BG_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgUp(){this.Q.type=a.default.MOUSE_BG_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightClick(){this.Q.type=a.default.MOUSE_RIGHT_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseMove(){this.Q.type=a.default.MOUSE_MOVE,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseWheel(t){this.Q.type=a.default.MOUSE_WHEEL,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.wheelDeltaY=t.wheelDeltaY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseCancel(){this.Q.type=a.default.MOUSE_CANCEL,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseMultiDown(t){this.Q.type=a.default.MOUSE_MULTI_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseMultiUp(t){this.Q.type=a.default.MOUSE_MULTI_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseMultiMove(t){this.Q.type=a.default.MOUSE_MULTI_MOVE,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseWindowUp(t=1){}mouseWindowRightUp(t=1){}enterFrame(){this.S.type=r.default.ENTER_FRAME;let t=this.I.length;for(var e=0;e<t;++e)this.I[e].call(this.J[e],this.S)}addEventListener(t,e,s,i=!0,a=!0){if(null!=s&&null!=e){let n=0;switch(t){case r.default.RESIZE:for(n=this.G.length-1;n>=0;--n)if(e===this.H[n])break;n<0&&(this.H.push(e),this.G.push(s));break;case r.default.ENTER_FRAME:for(n=this.I.length-1;n>=0;--n)if(e===this.J[n])break;n<0&&(this.J.push(e),this.I.push(s));break;case h.default.KEY_DOWN:for(n=this.K.length-1;n>=0;--n)if(e===this.L[n])break;n<0&&(this.L.push(e),this.K.push(s));break;case h.default.KEY_UP:for(n=this.M.length-1;n>=0;--n)if(e===this.N[n])break;n<0&&(this.N.push(e),this.M.push(s));break;default:this.F.addEventListener(t,e,s,i,a);break}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=0;switch(t){case r.default.RESIZE:for(i=this.G.length-1;i>=0;--i)if(e===this.H[i]){this.H.splice(i,1),this.G.splice(i,1);break}break;case r.default.ENTER_FRAME:for(i=this.I.length-1;i>=0;--i)if(e===this.J[i]){this.J.splice(i,1),this.I.splice(i,1);break}break;case h.default.KEY_DOWN:for(i=this.K.length-1;i>=0;--i)if(e===this.L[i]){this.L.splice(i,1),this.K.splice(i,1);break}break;case h.default.KEY_UP:for(i=this.M.length-1;i>=0;--i)if(e===this.N[i]){this.N.splice(i,1),this.M.splice(i,1);break}break;default:this.F.removeEventListener(t,e,s);break}}}}m.K2=null,e.default=m},"38de":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),h=i(s("f48d"));class n extends h.default{constructor(){super(...arguments),this.tv=new a.default(1,0,0)}update(){this.tv.normalize()}updateFast(){this.tv.normalize()}static IntersectionTri(t,e,s,i,r,a){return 0}static IntersectionLS(t,e,s,i,r,l=1){let _=n.__tAv;if(_.copyFrom(i),_.subtractBy(s),_.normalize(),a.default.Cross(e,_,r),r.normalize(),_.w=r.dot(t)-r.dot(i),Math.abs(_.w)<=l){r.crossBy(e),r.normalize(),r.w=r.dot(t),_.w=(r.w-r.dot(s))/_.dot(r),r.copyFrom(_),r.scaleBy(_.w),r.addBy(s),_.copyFrom(r),_.subtractBy(s);let a=h.default.__tV1;if(a.copyFrom(r),a.subtractBy(i),_.dot(a)<=0)return 1}return 0}static IntersectioNearSphere2(t,e,s,i,a){let h=n.__tAv;if(h.x=s.x-t.x,h.y=s.y-t.y,h.z=s.z-t.z,h.w=h.dot(e),i*=i,h.w>r.default.MATH_MIN_POSITIVE){if(a.copyFrom(e),a.scaleBy(h.w),a.subtractBy(h),h.x=a.getLengthSquared(),h.x<=i)return h.w-=Math.sqrt(i-h.x),a.copyFrom(e),a.scaleBy(h.w),a.addBy(t),a.w=1,1}else if(h.getLengthSquared()<=i&&(a.copyFrom(e),a.scaleBy(h.w),a.subtractBy(h),h.x=a.getLengthSquared(),h.x<=i))return h.w+=Math.sqrt(i-h.x),a.copyFrom(e),a.scaleBy(h.w),a.addBy(t),a.w=1,1;return 0}static IntersectioNearSphere(t,e,s,i,a){let h=n.__tAv;if(h.x=s.x-t.x,h.y=s.y-t.y,h.z=s.z-t.z,h.w=h.dot(e),h.w>r.default.MATH_MIN_POSITIVE){if(a.x=h.x-h.w*e.x,a.y=h.y-h.w*e.y,a.z=h.z-h.w*e.z,a.x=a.getLengthSquared(),a.w=i*i,a.x<=a.w)return a.x=h.getLengthSquared(),a.z=a.w-a.x,h.normalize(),a.y=h.dot(e)*Math.sqrt(a.x),h.w=.5*(-a.y+Math.sqrt(a.y*a.y+4*a.z)),a.copyFrom(e),a.scaleBy(h.w),a.addBy(t),a.w=1,1}else if(a.x=h.getLengthSquared(),a.w=i*i,a.x<=a.w)return a.z=a.w-a.x,h.normalize(),a.y=h.dot(e)*Math.sqrt(a.x),h.w=.5*(-a.y+Math.sqrt(a.y*a.y+4*a.z)),a.copyFrom(e),a.scaleBy(h.w),a.addBy(t),a.w=1,1;return 0}static IntersectSphere(t,e,s,i){let a=n.__tAv;return a.x=s.x-t.x,a.y=s.y-t.y,a.z=s.z-t.z,a.w=a.dot(e),a.w<r.default.MATH_MIN_POSITIVE||(a.x-=a.w*e.x,a.y-=a.w*e.y,a.z-=a.w*e.z),a.getLengthSquared()<=i*i}}n.__tAv=new a.default,e.default=n},3930:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{constructor(t=1,e=1,s=1,i=1){this.r=1,this.g=1,this.b=1,this.a=1,this.r=t,this.g=e,this.b=s,this.a=i}setRGB3Bytes(t,e,s){this.r=t/255,this.g=e/255,this.b=s/255}setRGB3f(t,e,s){this.r=t,this.g=e,this.b=s}setRGBUint24(t){this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255}setRGBA4f(t,e,s,i){this.r=t,this.g=e,this.b=s,this.a=i}copyFrom(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}scaleBy(t){this.r*=t,this.g*=t,this.b*=t}inverseRGB(){this.r=1-this.r,this.g=1-this.g,this.b=1-this.b}randomRGB(t=1){this.r=Math.random()*t,this.g=Math.random()*t,this.b=Math.random()*t}normalizeRandom(t=1){this.r=Math.random(),this.g=Math.random(),this.b=Math.random();let e=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);e>r.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/e,this.g=t*this.g/e,this.b=t*this.b/e)}normalize(t){void 0==t&&(t=1);let e=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);e>r.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/e,this.g=t*this.g/e,this.b=t*this.b/e)}getCSSDecRGBAColor(){return"rgba("+Math.floor(255*this.r)+","+Math.floor(255*this.g)+","+Math.floor(255*this.b)+","+this.a.toFixed(4)+")"}getCSSHeXRGBColor(){let t="#",e=Math.floor(255*this.r);return t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.g),t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.b),t+=e<15?"0"+e.toString(16):""+e.toString(16),t}toString(){return"[Color4(r="+this.r+", g="+this.g+",b="+this.b+",a="+this.a+")]"}}e.default=a},"3b73":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetLanguage(t){i.K3=t}static GetLanguage(){return""!=i.K3||(i.K3=navigator.language),i.K3}static SetThreadEnabled(t){i.K4=t}static GetThreadEnabled(){return i.K4}static GetDebugEnabled(){return i.K5}static SetDebugEnabled(t){i.K5=t}static SetDevicePixelRatio(t){i.K6=t}static GetDevicePixelRatio(){return i.K6}static Initialize(t){i.K7&&(i.K7=!1,i.K8=t[0],i.TestMobileWeb(),i.K3=navigator.language+"")}static IsWebGL1(){return 1==i.K8}static IsWebGL2(){return 2==i.K8}static IsMobileWeb(){return i.LB>0?2==i.LB:i.TestMobileWeb()}static IsIOS(){if(i.K9>0)return 2==i.K9;let t=!1;return t=!!/iPad|iPhone|iPod/.test(navigator.platform)||void 0!=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),i.K9=t?2:1,t}static IsIpadOS(){if(i.K_>0)return 2==i.K_;let t=navigator.maxTouchPoints>0&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform);return!t&&/iPod|iPad|iPadPro|iPodPro/i.test(navigator.userAgent)&&(t=!0),i.K_=t?2:1,t}static IsAndroidOS(){if(i.LA>0)return 2==i.LA;let t=i.TestMobileWeb();return t=!(!t||!/Android|Linux/i.test(navigator.userAgent)),i.LA=t?2:1,t}static TestMobileWeb(){return i.LB>0?2==i.LB:/mobile/.test(location.href)?(i.LB=2,2==i.LB):/Android/i.test(navigator.userAgent)?/Mobile/i.test(navigator.userAgent)?(i.LB=2,2==i.LB):(i.LB=1,2==i.LB):/webOS|iPhone|iPod|iPad|iPodPro|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(i.LB=2,2==i.LB):(i.LB=1,2==i.LB)}}i.K7=!0,i.K8=2,i.K6=1,i.LB=0,i.LA=0,i.K9=0,i.K_=0,i.K3="",i.K5=!0,i.GPU_VENDOR="unknown",i.GPU_RENDERER="unknown",i.MAX_TEXTURE_SIZE=4096,i.MAX_RENDERBUFFER_SIZE=4096,i.MAX_VIEWPORT_WIDTH=4096,i.MAX_VIEWPORT_HEIGHT=4096,i.SHOWLOG_ENABLED=!1,i.SHADERCODE_TRACE_ENABLED=!1,i.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,i.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,i.K4=!0,e.default=i},"3bda":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetDebugEnabled(t){i.LC=t}static ShowLog(t){i.LC&&(i.LD.length>0?i.LD+="<br/>"+t:i.LD=t,i.UpdateDivText())}static GetLog(){return i.LD}static ShowLogOnce(t){i.LC&&(i.LD=t,i.UpdateDivText())}static ClearLog(t=""){i.LC&&(i.LD=t,i.UpdateDivText())}static UpdateDivText(){if(i.LC)if(null!=i.LE)i.LE.innerHTML=i.LD;else{var t=document.createElement("div");t.style.color="";var e=t;e.width=128,e.height=64,e.style.backgroundColor="#aa0033",e.style.left="0px",e.style.top="128px",e.style.position="absolute",document.body.appendChild(e),i.LE=e,e.innerHTML=i.LD}}}i.LD="",i.LE=null,i.LC=!1,e.default=i},"3bfb":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("35fa")),h=i(s("8a0a")),n=i(s("e7d2")),l=s("8a0a"),_=i(s("fecb")),m=i(s("cb29"));class o extends m.default{constructor(t=h.default.VTX_STATIC_DRAW){super(t),this.DT=[null,null,null,null,null,null,null,null],this.normalType=l.VtxNormalType.FLAT,this.BZ=null,this.Ba=null,this.DU=null,this.DV=null,this.flipVerticalUV=!1,this.uvPartsNumber=0,this.uScale=1,this.vScale=1}getVS(){return this.BZ}getUVS(){return this.Ba}getNVS(){return this.DU}getCVS(){return this.DV}setPositionAt(t,e){if(t>=0&&t<8&&null!=this.BZ){let s=this.DT[t];s[0]=e.x,s[1]=e.y,s[2]=e.z}}getPositionAt(t,e){if(t>=0&&t<8&&null!=this.BZ){let s=this.DT[t];e.x=s[0],e.y=s[1],e.z=s[2]}}setEdgeAt(t,e,s){if(t>=0&&t<8&&null!=this.BZ){let i=this.DT[t];t++,3==t?t=0:7==t&&(t=4);let r=this.DT[t];i[0]=e.x,i[1]=e.y,i[2]=e.z,r[0]=s.x,r[1]=s.y,r[2]=s.z}}getEdgeAt(t,e,s){if(t>=0&&t<8&&null!=this.BZ){let i=this.DT[t];t++,3==t?t=0:7==t&&(t=4);let r=this.DT[t];e.x=i[0],e.y=i[1],e.z=i[2],s.x=r[0],s.y=r[1],s.z=r[2]}}setFaceAt(t,e,s,i,r){if(t>=0&&t<8&&null!=this.BZ){t*=4;let a,h,n=[e,s,i,r],l=o.LF,_=this.DT;for(let e=t+4,s=0;t<e;++t)a=_[l[t]],h=n[s++],a[0]=h.x,a[1]=h.y,a[2]=h.z}}getFaceAt(t,e,s,i,r){if(t>=0&&t<8&&null!=this.BZ){t*=4;let a,h,n=[e,s,i,r],l=o.LF,_=this.DT;for(let e=t+4,s=0;t<e;++t)a=_[l[t]],h=n[s++],h.x=a[0],h.y=a[1],h.z=a[2]}}getFaceCenterAt(t,e){if(t>=0&&t<8&&null!=this.BZ){t*=4;let s,i=o.LF,r=this.DT;e.setXYZ(0,0,0);for(let a=t+4;t<a;++t)s=r[i[t]],e.x+=s[0],e.y+=s[1],e.z+=s[2];e.scaleBy(.33333)}}transformFaceAt(t,e){if(t>=0&&t<8&&null!=this.BZ){t*=4;let s=o.LF,i=this.DT;for(let r=t+4;t<r;++t)e.transformVectorsSelf(i[s[t]],3)}}initializeWithYFace(t,e,s,i){let r=t,a=e,h=.5*(r.y+a.y);this.DT[0]=[a.x,h,a.z],this.DT[1]=[a.x,h,r.z],this.DT[2]=[r.x,h,r.z],this.DT[3]=[r.x,h,a.z],r=s,a=i;let n=.5*(r.y+a.y);this.DT[4]=[a.x,n,a.z],this.DT[5]=[a.x,n,r.z],this.DT[6]=[r.x,n,r.z],this.DT[7]=[r.x,n,a.z],this.initData(this.DT)}initialize(t,e){this.DT[0]=[e.x,t.y,e.z],this.DT[1]=[e.x,t.y,t.z],this.DT[2]=[t.x,t.y,t.z],this.DT[3]=[t.x,t.y,e.z],this.DT[4]=[e.x,e.y,e.z],this.DT[5]=[e.x,e.y,t.z],this.DT[6]=[t.x,e.y,t.z],this.DT[7]=[t.x,e.y,e.z],this.initData(this.DT)}scaleUVFaceAt(t,e,s,i,r){if(null!=this.Ba&&t>=0&&t<6){let a=8*t,h=a+8,n=this.Ba;for(;a<h;a+=2)n[a]=e+n[a]*i,n[a+1]=s+n[a+1]*r}}reinitialize(){this.initData(this.DT)}initData(t){this.vtxTotal=24;let e=0,s=0,i=0,m=null==this.Bb;if(m){this.BZ=new Float32Array(72),this.Bb=new Uint16Array(36);let t=[3,2,3,3,2,2];for(e=0;e<6;++e)3==t[e]?(this.Bb[i]=s+3,this.Bb[i+1]=s+2,this.Bb[i+2]=s+1,this.Bb[i+3]=s+3,this.Bb[i+4]=s+1,this.Bb[i+5]=s):(this.Bb[i]=s+2,this.Bb[i+1]=s+3,this.Bb[i+2]=s,this.Bb[i+3]=s+2,this.Bb[i+4]=s,this.Bb[i+5]=s+1),i+=6,s+=4}let u,d=o.LF,c=this.DT,f=this.BZ;for(s=0,e=0;e<this.vtxTotal;++e)u=c[d[e]],f.set(u,s),s+=3;this.bounds=new _.default,null!=this.d?(this.d.transformVectorsSelf(this.BZ,this.BZ.length),this.bounds.addXYZFloat32Arr(this.BZ)):this.bounds.addXYZFloat32Arr(this.BZ),this.bounds.updateFast(),n.default.Reset(),n.default.AddFloat32Data(this.BZ,3);let p=6;if(this.isVBufEnabledAt(h.default.VBUF_UVS_INDEX)){if(null==this.Ba&&(this.Ba=new Float32Array(48),this.initUVData(2*this.vtxTotal),4==this.uvPartsNumber?(this.scaleUVFaceAt(0,.5,.5,.5,.5),this.scaleUVFaceAt(1,0,0,.5,.5),this.scaleUVFaceAt(2,.5,0,.5,.5),this.scaleUVFaceAt(3,0,.5,.5,.5),this.scaleUVFaceAt(4,.5,0,.5,.5),this.scaleUVFaceAt(5,0,.5,.5,.5)):6==this.uvPartsNumber&&(this.scaleUVFaceAt(0,0,0,.25,.5),this.scaleUVFaceAt(1,.25,0,.25,.5),this.scaleUVFaceAt(2,.5,0,.25,.5),this.scaleUVFaceAt(3,.75,0,.25,.5),this.scaleUVFaceAt(4,0,.5,.25,.5),this.scaleUVFaceAt(5,.25,.5,.25,.5)),this.isVBufEnabledAt(h.default.VBUF_TVS_INDEX))){i=0;while(i<6){switch(i){case 0:e=0,this.Ba[e]=0,this.Ba[e+1]=1,this.Ba[e+2]=1,this.Ba[e+3]=1,this.Ba[e+4]=1,this.Ba[e+5]=0,this.Ba[e+6]=0,this.Ba[e+7]=0;break;case 3:e=24,this.Ba[e]=0,this.Ba[e+1]=1,this.Ba[e+2]=1,this.Ba[e+3]=1,this.Ba[e+4]=1,this.Ba[e+5]=0,this.Ba[e+6]=0,this.Ba[e+7]=0;break;case 5:e=32,this.Ba[e]=0,this.Ba[e+1]=1,this.Ba[e+2]=1,this.Ba[e+3]=1,this.Ba[e+4]=1,this.Ba[e+5]=0,this.Ba[e+6]=0,this.Ba[e+7]=0;break;default:break}++i}}n.default.AddFloat32Data(this.Ba,2)}if(this.isVBufEnabledAt(h.default.VBUF_NVS_INDEX)){this.DU=new Float32Array(72),i=0;let t=0,s=0,a=0;if(this.normalType==l.VtxNormalType.FLAT)while(i<p){switch(t=0,s=0,a=0,i){case 0:s=-1;break;case 1:s=1;break;case 2:t=1;break;case 3:a=-1;break;case 4:t=-1;break;case 5:a=1;break;default:break}e=12*i,t*=this.normalScale,s*=this.normalScale,a*=this.normalScale,this.DU[e]=t,this.DU[e+1]=s,this.DU[e+2]=a,this.DU[e+3]=t,this.DU[e+4]=s,this.DU[e+5]=a,this.DU[e+6]=t,this.DU[e+7]=s,this.DU[e+8]=a,this.DU[e+9]=t,this.DU[e+10]=s,this.DU[e+11]=a,++i}else{let h=this.bounds.center,n=0;while(i<this.vtxTotal)e=3*i,t=this.BZ[e]-h.x,s=this.BZ[e+1]-h.y,a=this.BZ[e+2]-h.z,n=Math.sqrt(t*t+s*s+a*a),n>r.default.MATH_MIN_POSITIVE&&(this.DU[e]=t/n,this.DU[e+1]=s/n,this.DU[e+2]=a/n),++i}n.default.AddFloat32Data(this.DU,3)}if(this.isVBufEnabledAt(h.default.VBUF_CVS_INDEX)){this.DV=new Float32Array(72),i=0;let t=1,s=1,r=1;while(i<p)e=12*i,this.DV[e]=t,this.DV[e+1]=s,this.DV[e+2]=r,this.DV[e+3]=t,this.DV[e+4]=s,this.DV[e+5]=r,this.DV[e+6]=t,this.DV[e+7]=s,this.DV[e+8]=r,this.DV[e+9]=t,this.DV[e+10]=s,this.DV[e+11]=r,++i;n.default.AddFloat32Data(this.DV,3)}if(this.isVBufEnabledAt(h.default.VBUF_TVS_INDEX)){let t=12,e=new Float32Array(this.DU.length),s=new Float32Array(this.DU.length);a.default.ClacTrisTangent(this.BZ,this.BZ.length,this.Ba,this.DU,t,this.Bb,e,s),n.default.AddFloat32Data(e,3),n.default.AddFloat32Data(s,3)}n.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.updateWireframeIvs(),m?(this.DW=n.default.CreateBySaveData(this.getBufDataUsage()),this.DW.setUint16IVSData(this.Bb),this.vtCount=this.Bb.length,this.trisNumber=12,this.buildEnd()):n.default.UpdateBufData(this.DW)}setFaceUVSAt(t,e,s=0){if(null!=this.Ba)if(s<1)this.Ba.set(e,8*t);else{t*=8,s<0&&(s=0);for(let i=0;i<4;++i)this.Ba[t++]=e[2*s],this.Ba[t++]=e[2*s+1],s++,s%=4}}initUVData(t){let e=this.uScale,s=this.vScale,i=0;if(this.flipVerticalUV)while(i<t)this.Ba[i]=1*e,this.Ba[i+1]=1*s,this.Ba[i+2]=0*e,this.Ba[i+3]=1*s,this.Ba[i+4]=0*e,this.Ba[i+5]=0*s,this.Ba[i+6]=1*e,this.Ba[i+7]=0*s,i+=8;else while(i<t)this.Ba[i]=0*e,this.Ba[i+1]=0*s,this.Ba[i+2]=1*e,this.Ba[i+3]=0*s,this.Ba[i+4]=1*e,this.Ba[i+5]=1*s,this.Ba[i+6]=0*e,this.Ba[i+7]=1*s,i+=8}testRay(t,e,s,i){let r=_.default.IntersectionRL2(e,t,this.bounds,s);return r?1:-1}toString(){return"Box3DMesh()"}__$destroy(){this.isResFree()&&(this.bounds=null,this.BZ=null,this.Ba=null,this.DU=null,this.DV=null,super.__$destroy())}}o.LF=[0,1,2,3,4,5,6,7,4,5,1,0,5,6,2,1,7,6,2,3,4,7,3,0],e.default=o},"3c81":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("7696"));class h extends r.default{setCreateParams(t,e,s,i,r,a){this.Cj=t,this.DX=e,this.BP=s,this.DY=i,this.DZ=r,this.Da=a}createNode(){return new a.default(this.Cj,this.DX,this.BP,this.DY,this.DZ,this.Da)}rejoinRunitForTro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForTro(t)}rejoinRunitForVro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForVro(t)}}e.default=h},"3e25":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("18c7")),h=i(s("6e01")),n=i(s("e214"));class l{constructor(){this.Db=new a.default,this.Dc=new a.default,this.Dd=new a.default,this.De=new a.default,this.Df=new a.default,this.Dg=new r.default,this.Dh=new r.default,this.Di=new r.default,this.Dj=new r.default,this.Dk=new r.default,this.Dl=!1,this.Dm=!0,this.Y=null,this.Db.rotationY(-.5*Math.PI)}setCamera(t){this.Y!=t&&(this.Dm=!0,null!=this.Y&&(this.Y.setViewMatrix(null),this.Y.update()),this.Y=t)}getCamera(){return this.Y}enableAxisMode(){this.Dl=!0}disableAxisMode(){this.Dl=!1}lookAtXYZUpYAxis(t,e,s){this.Dk.setXYZ(t,e,s),this.Di.subVecsTo(this.Dk,this.Dh),this.Dg.y=180-h.default.GetDegreeByXY(-this.Di.x,-this.Di.z),this.Dg.x=r.default.AngleBetween(r.default.Y_AXIS,this.Di)-90,this.Dm=!0}lookAtUpYAxis(t){this.Dk.copyFrom(t),this.Di.subVecsTo(this.Dk,this.Dh),this.Dg.y=180-h.default.GetDegreeByXY(-this.Di.x,-this.Di.z),this.Dg.x=r.default.AngleBetween(r.default.Y_AXIS,this.Di)-90,this.Dm=!0}rotateXYZ(t,e,s){this.Dg.x+=t,this.Dg.y+=e,this.Dg.z+=s,this.Dm=!0}rotate(t){this.Dg.addBy(t),this.Dm=!0}setRotationXYZ(t,e,s){this.Dg.setXYZ(t,e,s),this.Dm=!0}setRotation(t){this.Dg.copyFrom(t),this.Dm=!0}getRotation(t){t.copyFrom(this.Dg),this.Dm=!0}rotateX(t){this.Dg.x+=t,this.Dm=!0}rotateY(t){this.Dg.y+=t,this.Dm=!0}rotateZ(t){this.Dg.z+=t,this.Dm=!0}setRotationX(t){this.Dg.x=t,this.Dm=!0}setRotationY(t){this.Dg.y=t,this.Dm=!0}setRotationZ(t){this.Dg.z=t,this.Dm=!0}setXYZ(t,e,s){this.Dh.setXYZ(t,e,s),this.Dm=!0}moveXYZ(t,e,s){this.Dh.x+=t,this.Dh.y+=e,this.Dh.z+=s,this.Dm=!0}move(t){this.Dh.addBy(t),this.Dm=!0}setPosition(t){this.Dh.copyFrom(t),this.Dm=!0}getPosition(t){t.copyFrom(this.Dh)}getViewMatrix(){return this.Df}getViewInvMatrix(){return this.De}update(){if(this.Dm){if(this.Dm=!1,this.Dl){this.Di.subVecsTo(this.Dk,this.Dh),this.Di.y=0,n.default.IntersectionSLV2(r.default.Z_AXIS,0,this.Di,r.default.Z_AXIS,this.Dj),this.Dj.y=0;let t=0;r.default.Distance(this.Di,this.Dj)>.001&&(t=r.default.AngleBetween(this.Dj,this.Dj)),this.Dc.identity(),this.Dc.rotationY(t),this.Dc.transformOutVector3(r.default.Z_AXIS,this.Dj),this.Dj.normalize(),this.Di.subVecsTo(this.Dk,this.Dh),this.Dj.crossBy(this.Di),this.Df.lookAtRH(this.Dh,this.Dk,this.Dj),this.De.copyFrom(this.Df),this.De.invert()}else this.Dc.identity(),this.Dc.rotationZ(h.default.DegreeToRadian(-this.Dg.x)),this.Dc.appendRotationY(h.default.DegreeToRadian(this.Dg.y)),this.Dc.setTranslation(this.Dh),this.Dd.identity(),this.Dd.rotationX(h.default.DegreeToRadian(this.Dg.z)),this.De.copyFrom(this.Db),this.De.append(this.Dd),this.De.append(this.Dc),this.Df.copyFrom(this.De),this.Df.invert();null!=this.Y&&(this.Y.setViewMatrix(this.Df),this.Y.update())}}}e.RHCameraView=l},"402a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=i(s("8e17")),h=i(s("fecb")),n=i(s("1710")),l=i(s("29ef")),_=i(s("0929")),m=s("cc48"),o=i(s("dc2b"));class u{constructor(t=null){this.r=0,this.Dn=null,this.F=null,this.Do=!0,this.Dp=!0,this.Dq=l.default.COLOR_MASK_ALL_TRUE,this.Dr=l.default.BACK_CULLFACE_NORMAL_STATE,this.Ds=null,this.Dt=null,this.Du=null,this.Dv=null,this.t=null,this.__$rseFlag=r.default.DEFAULT,this.name="DisplayEntity",this.spaceCullMask=m.SpaceCullingMask.CAMERA,this.drawEnabled=!1,this.mouseEnabled=!1,this.vbWholeDataEnabled=!0,this.Dw=!1,this.Dx=!1,this.Dy=_.default.UPDATE_TRANSFORM,this.r=u.Kh++,this.Dn=null==t?_.default.Create():t,this.createBounds()}createBounds(){this.Du=new h.default}__$setRenderProxy(t){this.t=t}__$setParent(t){this.Dv,this.Dv=t}__$getParent(){return this.Dv}__$testSpaceEnabled(){return r.default.TestSpaceEnabled2(this.__$rseFlag)}__$testContainerEnabled(){return r.default.TestContainerEnabled(this.__$rseFlag)}__$testRendererEnabled(){return r.default.TestRendererEnabled(this.__$rseFlag)}getRendererUid(){return r.default.GetRendererUid(this.__$rseFlag)}isFree(){return this.__$rseFlag==r.default.DEFAULT}dispatchEvt(t){t.getClassType()==n.default.EventClassType&&null!=this.F&&this.F.dispatchEvt(t)}getEvtDispatcher(t){return this.F}setEvtDispatcher(t){this.F=t}getGlobalBounds(){return this.Du}getLocalBounds(){return this.Dt.bounds}getGlobalBoundsVer(){return null!=this.Du?this.Du.version:-1}__$setDrawEnabled(t){this.Dp!=t&&(this.Dp=t,null!=this.Ds&&(this.Ds.visible=this.Do&&t,null!=this.Ds.__$$runit&&this.Ds.__$$runit.setVisible(this.Ds.visible)))}isDrawEnabled(){return this.Dp}updateMeshToGpu(t=null,e=!0){null!=t&&(this.t=t),null!=this.t&&null!=this.Ds&&this.Ds.__$ruid>-1&&(this.Dx?(this.Dx=!1,this.t.VtxBufUpdater.updateDispVbuf(this.Ds,e)):this.t.VtxBufUpdater.updateVtxDataToGpuByUid(this.Ds.vbuf.getUid(),e))}updateMaterialToGpu(t=null,e=!0){null!=t&&(this.t=t),null!=this.t&&null!=this.Ds&&this.Ds.__$ruid>-1&&this.Dw&&(this.Dw=!1,this.t.MaterialUpdater.updateDispTRO(this.Ds,e))}setTextureList(t){null!=this.Ds&&this.Ds.__$ruid>-1&&null!=this.Ds.getMaterial()&&(this.Ds.getMaterial().setTextureList(t),this.Dw=!0)}setTextureAt(t,e){null!=this.Ds&&this.Ds.__$ruid>-1&&null!=this.Ds.getMaterial()&&(this.Ds.getMaterial().setTextureAt(t,e),this.Dw=!0)}setSortValue(t){null!=this.Ds&&null!=this.Ds.__$$runit&&(this.Ds.__$$runit.value=t)}setVisible(t){this.Do!=t&&(this.Do=t,null!=this.Ds&&(this.Ds.visible=t&&this.Dp,null!=this.Ds.__$$runit&&this.Ds.__$$runit.setVisible(this.Ds.visible)))}getVisible(){return this.Do}getTransform(){return this.Dn}copyPositionFrom(t){null!=t&&this.Dn.copyPositionFrom(t.getTransform())}copyMeshFrom(t){null!=t&&this.setMesh(t.getMesh())}copyMaterialFrom(t){null!=t&&this.setMaterial(t.getMaterial())}copyTransformFrom(t){let e=t;null!=e&&this.Dn.copyFrom(e.Dn)}initDisplay(t){this.Ds.vbuf=t.__$attachVBuf(),this.Ds.ivsIndex=0,this.Ds.ivsCount=t.vtCount,this.Ds.drawMode=t.drawMode,this.Ds.trisNumber=t.trisNumber,this.Ds.visible=this.Do&&this.Dp}setMesh(t){null==this.Dt?null!=t&&(t.isEnabled()||t.rebuild(),t.isEnabled()&&(this.Dt=t,t.__$attachThis(),null==this.Ds&&this.createDisplay(),null!=this.Ds&&(this.Ds.setTransform(this.Dn.getMatrix()),this.initDisplay(t)),null!=this.Du&&this.Du.copyFrom(t.bounds),this.updateMesh())):null!=this.Ds&&this.Ds.__$ruid>-1&&this.Dt!=t&&null!=t&&(this.Dn.updatedStatus|=2,this.Dt.__$detachVBuf(this.Ds.vbuf),this.Dt.__$detachThis(),t.__$attachThis(),this.Dt=t,this.initDisplay(t),this.Dx=!0,this.updateMesh())}updateMesh(){}getIvsIndex(){return this.Ds.ivsIndex}getIvsCount(){return this.Ds.ivsCount}setIvsParam(t,e){null!=this.Ds&&(this.Ds.ivsIndex=t,this.Ds.ivsCount=e,this.Ds.__$ruid>-1&&(this.Ds.__$$runit.setIvsParam(t,e),this.Ds.__$$runit.drawMode=this.Dt.drawMode))}getMesh(){return this.Dt}hasMesh(){return null!=this.Dt}isPolyhedral(){return null==this.Dt||this.Dt.isPolyhedral()}testRay(t,e,s,i){return this.Dt.testRay(t,e,s,i)}setMaterial(t){null!=t&&(null==this.Ds&&(this.Ds=o.default.Create(),this.Ds.setTransform(this.Dn.getMatrix()),this.Ds.visible=this.Do&&this.Dp),this.Ds.getMaterial()!=t&&(r.default.RENDERER_UID_FLAT&this.__$rseFlag)==r.default.RENDERER_UID_FLAT&&this.Ds.__$ruid<0&&(this.Ds.renderState=this.Dr,this.Ds.rcolorMask=this.Dq,this.Ds.setMaterial(t)))}getMaterial(){return null!=this.Ds?this.Ds.getMaterial():null}getDisplay(){return this.Ds}getInvMatrix(){return this.Dn.getInvMatrix()}getMatrix(t=!0){return this.Dn.getMatrix(t)}getToParentMatrix(){return this.Dn.getToParentMatrix()}setRenderColorMask(t){this.Dq=t,null!=this.Ds&&(this.Ds.rcolorMask=this.Dq,null!=this.Ds.__$$runit&&this.Ds.__$$runit.setDrawFlag(this.Dr,this.Dq))}setRenderColorMaskByName(t){this.Dq=l.default.GetRenderColorMaskByName(t),null!=this.Ds&&(this.Ds.rcolorMask=this.Dq,null!=this.Ds.__$$runit&&this.Ds.__$$runit.setDrawFlag(this.Dr,this.Dq))}setRenderState(t){this.Dr=t,null!=this.Ds&&(this.Ds.renderState=this.Dr,null!=this.Ds.__$$runit&&this.Ds.__$$runit.setDrawFlag(this.Dr,this.Dq))}setRenderStateByName(t){this.Dr=l.default.GetRenderStateByName(t),null!=this.Ds&&(this.Ds.renderState=this.Dr,null!=this.Ds.__$$runit&&this.Ds.__$$runit.setDrawFlag(this.Dr,this.Dq))}createDisplay(){this.Ds=o.default.Create()}activeDisplay(){if(null!=this.Ds){let t=this.Ds.getMaterial();if(null!=t){if(null==t.getShaderData()&&null!=t.getCodeBuf()&&null==t.getShaderData()){let e=t.getTextureList(),s=null!=e&&e.length>0;t.initializeByCodeBuf(s)}null==this.getMesh()&&(this.__activeMesh(t),this.Ds.name=this.name)}}}__activeMesh(t){}getUid(){return this.r}setXYZ(t,e,s){this.Dn.setXYZ(t,e,s)}offsetPosition(t){this.Dn.offsetPosition(t)}setPosition(t){this.Dn.setPosition(t)}getPosition(t){this.Dn.getPosition(t)}setRotationXYZ(t,e,s){this.Dn.setRotationXYZ(t,e,s)}setScaleXYZ(t,e,s){this.Dn.setScaleXYZ(t,e,s)}getRotationXYZ(t){this.Dn.getRotationXYZ(t)}getScaleXYZ(t){this.Dn.getScaleXYZ(t)}destroy(){null!=this.F&&(this.F.destroy(),this.F=null),null!=this.Dn&&this.isFree()&&(null!=this.Ds&&(this.Dt.__$detachVBuf(this.Ds.vbuf),o.default.Restore(this.Ds),this.Ds=null),_.default.Restore(this.Dn),this.Dn=null,null!=this.Dt&&(this.Dt.__$detachThis(),this.Dt=null),this.__$setParent(null),this.Do=!0,this.Dp=!0,this.t=null,this.__$rseFlag=r.default.DEFAULT)}isInRenderer(){return(this.__$rseFlag&r.default.RENDERER_UID_FLAT)!=r.default.RENDERER_UID_FLAT}isRenderEnabled(){return null!=this.Ds&&this.Ds.__$ruid>-1}updateBounds(){null!=this.Dn&&(this.Dy=_.default.UPDATE_TRANSFORM,this.update())}updateGlobalBounds(){if(this.Dy>_.default.UPDATE_POSITION){this.Dn.update();let t=this.Dt.bounds.min,e=this.Dt.bounds.max,s=u.LG;s[0]=t.x,s[1]=t.y,s[2]=t.z,s[3]=e.x,s[4]=t.y,s[5]=t.z,s[6]=t.x,s[7]=t.y,s[8]=e.z,s[9]=e.x,s[10]=t.y,s[11]=e.z,s[12]=t.x,s[13]=e.y,s[14]=t.z,s[15]=e.x,s[16]=e.y,s[17]=t.z,s[18]=t.x,s[19]=e.y,s[20]=e.z,s[21]=e.x,s[22]=e.y,s[23]=e.z,this.Dn.getMatrix().transformVectors(s,24,u.LJ),this.Du.reset(),this.Du.addXYZFloat32Arr(u.LJ),this.Du.update()}else{u.LH.setXYZ(0,0,0),u.LI.setXYZ(0,0,0);let t=this.Dn.getMatrix(!1);t.transformVector3Self(u.LH),this.Dn.update(),t=this.Dn.getMatrix(!1),t.transformVector3Self(u.LI),u.LI.subtractBy(u.LH);let e=this.Du;e.min.addBy(u.LI),e.max.addBy(u.LI),e.center.addBy(u.LI),++this.Du.version}}update(){this.Dn.updatedStatus>this.Dy&&(this.Dy=this.Dn.updatedStatus),this.Dy!=_.default.UPDATE_NONE&&(null!=this.Dt&&null!=this.Du?this.updateGlobalBounds():this.Dn.update(),this.Dy=_.default.UPDATE_NONE,this.Dn.updatedStatus=this.Dy),null!=this.Ds&&null!=this.Ds.__$$runit&&(this.Ds.__$$runit.bounds=this.Du,this.Dn.getPosition(this.Ds.__$$runit.pos))}toString(){return"DisplayEntity(name="+this.name+",uid = "+this.r+", rseFlag = "+this.__$rseFlag+")"}}u.Kh=0,u.LG=new Float32Array(24),u.LJ=new Float32Array(24),u.LI=new a.default,u.LH=new a.default,e.default=u},"442e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("265e"));class h extends r.default{createNode(){return new a.default}}e.default=h},"4cf7":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("8d98");class r{constructor(){this.Dz=[],this.D0=[],this.D1=[],this.D2=[]}addTexture(t){switch(t.getType()){case i.TextureProxyType.Image:this.Dz.push(t);break;case i.TextureProxyType.Bytes:this.D0.push(t);break;case i.TextureProxyType.Float:this.D1.push(t);break;case i.TextureProxyType.Wrapper:this.D2.push(t);break;default:break}}getTexture(t){switch(t){case i.TextureProxyType.Image:if(this.Dz.length>0)return this.Dz.pop();break;case i.TextureProxyType.Bytes:if(this.D0.length>0)return this.D0.pop();break;case i.TextureProxyType.Float:if(this.D1.length>0)return this.D1.pop();break;case i.TextureProxyType.Wrapper:if(this.D2.length>0)return this.D2.pop();break;default:break}return null}}e.TexturePool=r,e.default=r},"4f27":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=s("d53d"),h=i(s("2560")),n=i(s("83d1")),l=i(s("a7ed")),_=i(s("857b")),m=i(s("e87b"));class o extends a.ShaderUniform{use(t){}useByLocation(t,e,s,i){}useByShd(t,e){}updateData(){}destroy(){}}o.EmptyUniform=new o;class u{static appendUniformBuilder(t){u.LK.has(t.getIDNS())||(u.LL.push(t),u.LK.set(t.getIDNS(),t),u.LM=u.LL.length)}static Initialize(){u.Kt&&(u.Kt=!1,u.appendUniformBuilder(new h.default),u.appendUniformBuilder(new l.default),u.appendUniformBuilder(new _.default),u.appendUniformBuilder(new n.default),u.appendUniformBuilder(new m.default))}static AddSharedUniformBuilder(t){null==t||u.LK.has(t.getIDNS())||(u.LL.push(t),u.LK.set(t.getIDNS(),t),++u.LM)}static removeSharedUniformBuilder(t){if(null!=t&&u.LK.has(t.getIDNS())){for(let e=0;e<u.LM;++e)if(t==u.LL[e]){u.LL.splice(e,1),--u.LM;break}u.LK.delete(t.getIDNS())}}static removeSharedUniformBuilderByName(t){if(u.LK.has(t)){let e=u.LK.get(t);for(let t=0;t<u.LM;++t)if(e==u.LL[t]){u.LL.splice(t,1),--u.LM;break}u.LK.delete(t)}}static BuildShared(t,e,s){let i,r=null,a=null,h=u.LL,n=0,l=u.LM,_=null;for(;n<l;++n)_=h[n].create(e,s),null!=_&&(null!=a?a.next=_:null==r&&(r=_),a=_);if(null==t)i=r;else if(null!=r){for(let e=0;e<t.length;++e)a.next=t[e],a=a.next;i=r}if(null==i)i=o.EmptyUniform;else{let t=i,e=0;while(null!=t){if(null!=t.uniformNameList&&null==t.locations)for(t.types=[],t.locations=[],t.uniformSize=t.uniformNameList.length,e=0;e<t.uniformSize;++e)t.types.push(s.getUniformTypeByNS(t.uniformNameList[e])),t.locations.push(s.getUniformLocationByNS(t.uniformNameList[e]));t=t.next}}return i}static BuildLocalFromTransformV(t,e){if(null!=t){let s;return s=new a.ShaderMat4Uniform,s.uniformSize=0,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize+=1,s.uniformNameList.push("u_objMat"),s.types.push(e.getUniformTypeByNS("u_objMat")),s.locations.push(e.getUniformLocationByNS("u_objMat")),s.dataList.push(t),s.dataSizeList.push(1),s}return u.LN}static UpdateLocalFromTransformV(t,e,s){if(null!=e){let i,r=t;return null==r?(r=new a.ShaderMat4Uniform,i=r,i.uniformSize=0,i.uniformNameList=[],i.types=[],i.locations=[],i.dataList=[],i.dataSizeList=[],i.uniformSize+=1,i.uniformNameList.push("u_objMat"),i.types.push(s.getUniformTypeByNS("u_objMat")),i.locations.push(s.getUniformLocationByNS("u_objMat")),i.dataList.push(e),i.dataSizeList.push(1)):(i=r,i.locations=[],i.locations.push(s.getUniformLocationByNS("u_objMat"))),i}return u.LN}static BuildLocalFromData(t,e){if(null!=t){let s;s=r.default.IsWebGL1()?new a.ShaderUniformV1:new a.ShaderUniformV2,s.uns=t.uns,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize=0;let i=t,h=0;while(null!=i){if(null!=i.uniformNameList&&null==i.locations)for(s.uniformSize+=i.uniformNameList.length,h=0;h<s.uniformSize;++h)s.uniformNameList.push(i.uniformNameList[h]),s.types.push(e.getUniformTypeByNS(i.uniformNameList[h])),s.locations.push(e.getUniformLocationByNS(i.uniformNameList[h])),s.dataList.push(i.dataList[h]),s.dataSizeList.push(e.getUniformLengthByNS(i.uniformNameList[h]));i=i.next}return s}return o.EmptyUniform}static BuildLocal(t,e){let s=new a.ShaderUniform;s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize=0;let i=t,r=0;while(null!=i){if(null!=i.uniformNameList&&null==i.locations)for(s.uniformSize+=i.uniformNameList.length,r=0;r<s.uniformSize;++r)s.uniformNameList.push(i.uniformNameList[r]),s.types.push(e.getUniformTypeByNS(i.uniformNameList[r])),s.locations.push(e.getUniformLocationByNS(i.uniformNameList[r])),s.dataList.push(i.dataList[r]),s.dataSizeList.push(e.getUniformLengthByNS(i.uniformNameList[r]));i=i.next}return s}}u.Kt=!0,u.LK=new Map,u.LL=[],u.LM=0,u.LN=new a.ShaderUniform,e.default=u},"519e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("cb29")),h=i(s("e7d2")),n=i(s("fecb"));class l extends a.default{constructor(t=r.default.VTX_STATIC_DRAW){super(t),this.vsStride=3,this.uvsStride=2,this.nvsStride=3,this.cvsStride=3,this.vs=null,this.uvs=null,this.nvs=null,this.cvs=null,this.tvs=null,this.btvs=null,this.D3=null}initializeFromGeometry(t){this.vs=t.getVS(),this.uvs=t.getUVS(),this.nvs=t.getNVS(),this.tvs=t.getTVS(),this.btvs=t.getBTVS(),this.Bb=t.getIVS(),this.D3=this.Bb,this.initialize()}setIVS(t){this.D3=t,this.Bb=t}initialize(){null!=this.vs&&(null==this.bounds&&(this.bounds=new n.default),this.bounds.addXYZFloat32Arr(this.vs),h.default.Reset(),h.default.AddFloat32Data(this.vs,this.vsStride),this.isVBufEnabledAt(r.default.VBUF_UVS_INDEX)&&h.default.AddFloat32Data(this.uvs,this.uvsStride),this.isVBufEnabledAt(r.default.VBUF_NVS_INDEX)&&h.default.AddFloat32Data(this.nvs,this.nvsStride),this.isVBufEnabledAt(r.default.VBUF_CVS_INDEX)&&h.default.AddFloat32Data(this.cvs,this.cvsStride),this.isVBufEnabledAt(r.default.VBUF_TVS_INDEX)&&(h.default.AddFloat32Data(this.tvs,3),h.default.AddFloat32Data(this.btvs,3)),h.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.Bb=this.D3,this.updateWireframeIvs(),this.vtCount=this.Bb.length,null!=this.DW?h.default.UpdateBufData(this.DW):this.DW=h.default.CreateBySaveData(this.getBufDataUsage(),this.getBufSortFormat()),this.DW.setUintIVSData(this.Bb),this.buildEnd())}testRay(t,e,s,i){return-1}toString(){return"[DataMesh()]"}__$destroy(){this.isResFree()&&(this.bounds=null,this.vs=null,this.uvs=null,this.nvs=null,this.cvs=null,this.tvs=null,this.btvs=null,this.D3=null,super.__$destroy())}}e.default=l},5216:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["ENV_LIGHT_PARAM"]=0]="ENV_LIGHT_PARAM",t[t["FOG"]=1]="FOG",t[t["FOG_EXP2"]=2]="FOG_EXP2",t[t["VSM_SHADOW"]=3]="VSM_SHADOW",t[t["GLOBAL_LIGHT"]=4]="GLOBAL_LIGHT"}(i||(i={})),e.MaterialPipeType=i},"52c9":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(){this.disA=0,this.disB=0,this.length=0,this.tv=new r.default(1,0,0),this.pos=new r.default}}e.TrackSeg=a;class h{constructor(){this._index=0,this._pathDis=0,this._posDisList=[],this._segs=[],this._endSeg=null,this.__tempV=new r.default}addXYZ(t,e,s){let i=new a;i.pos.setTo(t,e,s);let r=this._segs.length;if(r>0){let t=this._segs[r-1];t.tv.x=i.pos.x-t.pos.x,t.tv.y=i.pos.y-t.pos.y,t.tv.z=i.pos.z-t.pos.z,t.length=t.tv.getLength(),t.tv.normalize(),this._pathDis+=t.length,t.disB=this._pathDis,i.disA=this._pathDis,this._posDisList.push(this._pathDis)}else i.disA=0,this._posDisList.push(0);this._segs.push(i),this._endSeg=i}getPathDistance(){return this._pathDis}getStepsTotal(t){return Math.ceil(this._pathDis/t)}etPosAt(t,e){e>=0&&e<this._segs.length&&t.copyFrom(this._segs[e].pos)}getCurrPosIndex(){return this._index}getDisProgrssInSeg(t){if(this._index<this._posDisList.length){let e=t-this._posDisList[this._index];if(e>=0){let t=this._segs[this._index].length;return t>.001?e/t:0}}return 0}getPosTotal(){return this._segs.length}etSqrtDistancePosEnd(t,e,s){return null!=this._endSeg?(this.__tempV.x=t-this._endSeg.pos.x,this.__tempV.y=e-this._endSeg.pos.y,this.__tempV.z=s-this._endSeg.pos.z,this.__tempV.getLengthSquared()):-1}clear(){this._segs.length=0,this._posDisList.length=0,this._pathDis=0,this._index=0,this._endSeg=null}toBegin(){this._index=0}calcPosByDis(t,e,s=!0){let i=this._segs.length;if(i>0){if(e>=this._pathDis)return this._index=i-1,t.copyFrom(this._segs[this._index].pos),h.TRACK_END;if(e<=this._segs[0].disA)return t.copyFrom(this._segs[0].pos),this._index=0,h.TRACK_BEGIN;{s?(this._index=0,this.binQueryCloseLess(e,-1,i,this._posDisList,0,i-1)):this.binQueryCloseLess(e,this._index-1,i,this._posDisList,0,i-1);let r=this._segs[this._index];return e-=r.disA,t.x=r.pos.x+r.tv.x*e,t.y=r.pos.y+r.tv.y*e,t.z=r.pos.z+r.tv.z*e,h.TRACK_AMONG}}return this._index=-1,h.TRACK_ERROR}calcNextPosByDis(t,e,s=!1){let i=this._segs.length;if(i>0){if(e>=this._pathDis)return this._index=i-1,t.copyFrom(this._segs[this._index].pos),h.TRACK_END;if(e<=this._segs[0].disA)return t.copyFrom(this._segs[0].pos),this._index=0,h.TRACK_BEGIN;{let r=null;return s?(this._index=0,this.binQueryCloseLess(e,-1,i,this._posDisList,0,i-1)):(r=this._segs[this._index],r.disA>e?(this._index=0,this.binQueryCloseLess(e,-1,i,this._posDisList,0,i-1),r=this._segs[this._index]):(r.disB<e&&(r=this._segs[this._index+1],r.disB<e&&(r=null)),null==r&&(this.binQueryCloseLess(e,this._index-1,i,this._posDisList,0,i-1),r=this._segs[this._index]))),e-=r.disA,t.x=r.pos.x+r.tv.x*e,t.y=r.pos.y+r.tv.y*e,t.z=r.pos.z+r.tv.z*e,h.TRACK_AMONG}}return this._index=-1,h.TRACK_ERROR}binQueryCloseLess(t,e,s,i,r,a){let h=Math.round(.5*(e+s));i[h]<t?h+1<=a&&i[h+1]<t&&s-h>1?this.binQueryCloseLess(t,h,s,i,r,a):this._index=h:i[h]>t&&h-1>=r?i[h-1]>t?h-e>1?this.binQueryCloseLess(t,e,h,i,r,a):this._index=h:(h-=1,this._index=h):this._index=h}}h.TRACK_INIT=-100,h.TRACK_ERROR=-1,h.TRACK_BEGIN=0,h.TRACK_AMONG=1,h.TRACK_END=2,e.PathTrack=h,e.default=h},"52e0":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class h extends a.default{constructor(t,e){super(t,e,!1),this.D4=null,this.AA=r.TextureTarget.TEXTURE_CUBE,this.mipmapEnabled=!0,this.AD=r.TextureProxyType.BytesCube}toAlphaFormat(){this.srcFormat=r.TextureFormat.ALPHA,this.internalFormat=r.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=r.TextureFormat.RED,this.internalFormat=r.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB,this.unpackAlignment=1}toRGBAFormat(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4}setDataFromBytesToFaceAt(t,e,s,i,r=0){if(null==this.D4&&(this.D4=[null,null,null,null,null,null]),s>0&&i>0){0==t&&r<1&&(this.w=s,this.x=i,this.v=r),null==this.D4[t]&&(this.D4[t]=new Array(16));let a=this.D4[t];a[r]={width:s,height:i,imgData:e,miplevel:r},this.AC=null!=a[r].imgData}}uploadData(t){let e,s,i=t.getRC(),a=null,h=this.getWidth(),n=this.getHeight();for(let l=0;l<6;++l){let t=this.D4[l];if(this.mipmapEnabled&&this.AE)a=t[0],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,r.TextureFormat.ToGL(i,this.internalFormat),h,n,0,r.TextureFormat.ToGL(i,this.srcFormat),r.TextureDataType.ToGL(i,this.dataType),a.imgData);else{e=h,s=n;let _=0;for(;e>0||s>0;)null!=t[_]&&(a=t[_],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,_,r.TextureFormat.ToGL(i,this.internalFormat),e,s,0,r.TextureFormat.ToGL(i,this.srcFormat),r.TextureDataType.ToGL(i,this.dataType),a.imgData)),e>0&&(e>>=1),s>0&&(s>>=1),++_}}this.version=0}toString(){return"[BytesCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.D4)for(let t=0;t<6;++t)null!=this.D4[t]&&(this.D4[t].imgData=null);super.__$destroy()}}}e.default=h},5326:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t){this.D5=256,this.r=0,this.index=0,this.dataList=[],this.flagList=null,this.r=t}getUid(){return this.r}static GetSlotAt(t){return i.LO[t]}static Initialize(t){let e=i.LO[t];if(null==e&&(e=new i(t),i.LO[t]=e),null==e.flagList){e.flagList=new Uint16Array(e.D5);for(let t=0;t<e.D5;++t)e.dataList.push(null),e.flagList[t]=0}}}i.LO=new Array(16),e.default=i},5336:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.D6=0,this.D7=60,this.D8=null,this.D9=null,this.D_=10,this.EA=128,this.EB=128,this.g=70,this.delayTime=40,this.statusInfo="",this.statusEnbled=!0}initialize(){var t=null;try{void 0!=document&&(t=document)}catch(e){}if(null!=t){this.EA=window.innerWidth;let t=this.EA-20;this.createCanvas(t)}}createCanvas(t){null==this.D8&&(this.D8=document.createElement("canvas"),document.body.appendChild(this.D8),this.D8.style.display="bolck",this.D8.style.left="0px",this.D8.style.top="0px",this.D8.style.position="absolute",this.D8.style.backgroundColor="transparent",this.D8.style.pointerEvents="none",this.D8.height=this.g),t=t<10?10:t,this.D8.width=t,this.D9=this.D8.getContext("2d"),this.D9.font="50px Verdana",this.D9.fillStyle="red",this.D9.textAlign="left",this.EB=this.D8.width}getFPS(){return this.D7}getFPSStr(){return this.D7>60?"FPS: 60":this.D7<10?"FPS: 0"+this.D7:"FPS: "+this.D7}render(){if(this.EA!=window.innerWidth){this.EA=window.innerWidth;let t=this.EA-20;this.createCanvas(t)}this.statusEnbled&&(this.D9.clearRect(0,0,this.EB,this.g),this.D9.fillText("FPS:"+this.D7+this.statusInfo,5,50))}update(t=!0){if(this.D_>0)--this.D_,this.D6=Date.now();else{if(null!=this.D9){let e=Date.now();this.D6>0&&(this.D6=e-this.D6,this.D7=Math.round(1e3/this.D6),t&&this.render()),this.D6=e}this.D_=this.delayTime}}}e.default=i},"53ea":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("e214"));class h{constructor(){this.Y=null,this.AO=null,this.EC=new r.default,this.ED=new r.default,this.EE=new r.default(0,1,0),this.EF=0,this.position=new r.default}bindCameraAndStage(t,e){this.Y=t,this.AO=e}setPlaneParam(t,e){this.EE.copyFrom(t),this.EE.normalize(),this.EF=e}intersectPlane(){null!=this.Y&&null!=this.AO&&(this.Y.update(),this.Y.getWorldPickingRayByScreenXY(this.AO.mouseX,this.AO.mouseY,this.EC,this.ED),a.default.IntersectionSLV2(this.EE,this.EF,this.EC,this.ED,this.position))}destroy(){this.Y=null,this.AO=null}}e.default=h},"557f":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class h extends a.default{constructor(t,e,s=1,i=!1){super(t,e,i),this.EG=null,this.EH=1,this.internalFormat=r.TextureFormat.R8,this.srcFormat=r.TextureFormat.RED,this.EH=s,this.AA=r.TextureTarget.TEXTURE_3D,this.AD=r.TextureProxyType.Texture3D,this.unpackAlignment=1}getDepth(){return this.EH}uploadFromTypedArray(t,e=0){this.isGpuEnabled()||(this.EG=t,this.v=e,this.AC=!0)}uploadData(t){if(null!=this.EG){let e=t.getRC();e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage3D(e.TEXTURE_3D,0,r.TextureFormat.ToGL(e,this.internalFormat),this.w,this.x,this.EH,0,r.TextureFormat.ToGL(e,this.srcFormat),e.UNSIGNED_BYTE,this.EG),e.pixelStorei(e.UNPACK_ALIGNMENT,4)}}__$destroy(){this.getAttachCount()<1&&(this.EG=null,super.__$destroy())}toString(){return"[Texture3DProxy(width="+this.getWidth()+",height="+this.getHeight()+",depth="+this.getDepth()+")]"}}e.default=h},"56c5":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("030e"));class a{static SetRenderer(t){a.Be=t.getRC(),a.EI=t.getWebGLVersion();let e=a;1==a.EI&&null!=r.default.WEBGL_draw_buffers?e.COLOR_ATTACHMENT0=r.default.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL:e.COLOR_ATTACHMENT0=a.Be.COLOR_ATTACHMENT0}static DrawBuffers(t){2==a.EI?a.Be.drawBuffers(t):null!=r.default.WEBGL_draw_buffers&&r.default.WEBGL_draw_buffers.drawBuffersWEBGL(t)}}a.Be=null,a.EI=2,a.COLOR_ATTACHMENT0=0,e.default=a},"5d04":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("4cf7")),h=i(s("5e78")),n=i(s("fe7f")),l=i(s("9f3e")),_=i(s("f928")),m=i(s("eaee")),o=i(s("52e0")),u=i(s("d314")),d=i(s("557f")),c=i(s("cfaf")),f=i(s("85b6")),p=i(s("da6a")),g=i(s("ccdf"));class T{constructor(){this.EJ=new a.default,this.EK=null,this.EL=null,this.EM=[],this.EN=128}addTexLoader(t){if(null!=t){let e=0,s=this.EM.length;for(;e<s;++e)if(t==this.EM[e])break;e>=s&&this.EM.push(t)}}removeTexLoader(t){if(null!=t){let e=0,s=this.EM.length;for(;e<s;++e)if(t==this.EM[e]){this.EM.slice(e,1);break}}}setRenderer(t){this.EL=t,p.default.GetInstance().setRenderProxy(t.getRenderProxy()),null==this.EK&&null!=t&&(this.EK=new g.default(t.getRenderProxy()))}getRTTStrore(){return this.EK}createWrapperTex(t,e,s=!1){let i=new f.default(t,e,s);return i.__$setRenderProxy(this.EL.getRenderProxy()),i}createRTTTex2D(t,e,s=!1){let i=new c.default(t,e,s);return i.__$setRenderProxy(this.EL.getRenderProxy()),i}createImageTex2D(t,e,s=!1){let i=this.EJ.getTexture(r.TextureProxyType.Image);return null==i&&(i=new h.default(t,e,s)),i.__$setRenderProxy(this.EL.getRenderProxy()),i.mipmapEnabled=!0,i.setWrap(r.TextureConst.WRAP_REPEAT),i}createHalfFloatTex2D(t,e,s=!1){let i=this.EJ.getTexture(r.TextureProxyType.Float);return null==i&&(i=new _.default(t,e,s)),i.__$setRenderProxy(this.EL.getRenderProxy()),i.srcFormat=r.TextureFormat.RGBA,i.dataType=r.TextureDataType.HALF_FLOAT_OES,i}createFloatTex2D(t,e,s=!1){let i=this.EJ.getTexture(r.TextureProxyType.Float);return null==i&&(i=new _.default(t,e,s)),i.__$setRenderProxy(this.EL.getRenderProxy()),i}createUint16Tex2D(t,e,s=!1){return new l.default(t,e,s)}createFloatCubeTex(t,e,s=!1){return new m.default(t,e)}createBytesTex(t,e){let s=this.EJ.getTexture(r.TextureProxyType.Bytes);return null==s&&(s=new n.default(t,e)),s.__$setRenderProxy(this.EL.getRenderProxy()),s}createBytesCubeTex(t,e){let s=new o.default(t,e);return s.__$setRenderProxy(this.EL.getRenderProxy()),s}createImageCubeTex(t,e){let s=new u.default(t,e);return s.__$setRenderProxy(this.EL.getRenderProxy()),s}createTex3D(t,e,s=1){s<1&&(s=1);let i=new d.default(t,e,s);return i.__$setRenderProxy(this.EL.getRenderProxy()),i}createRGBATex2D(t,e,s){t=t>1?t:1,e=e>1?e:1;let i=t*e,r=this.createBytesTex(t,e),a=new Uint8Array(4*i),h=Math.round(255*s.r),n=Math.round(255*s.g),l=Math.round(255*s.b),_=Math.round(255*s.a),m=0,o=[h,n,l,_];for(let u=0;u<i;++u)a.set(o,m),m+=4;return r.setDataFromBytes(a,0,t,e),r.__$setRenderProxy(this.EL.getRenderProxy()),r}createAlphaTex2D(t,e,s){t=t>1?t:1,e=e>1?e:1;let i=t*e,r=this.createBytesTex(t,e);r.toAlphaFormat();let a=new Uint8Array(i),h=Math.round(255*s);return a.fill(h,0,i),r.setDataFromBytes(a,0,t,e),r.__$setRenderProxy(this.EL.getRenderProxy()),r}createAlphaTexBytes2D(t,e,s){let i=this.createBytesTex(t,e);return i.setDataFromBytes(s,0,t,e),i.toAlphaFormat(),i.__$setRenderProxy(this.EL.getRenderProxy()),i}getCubeRTTTextureAt(t){return this.EK.getCubeRTTTextureAt(t)}createCubeRTTTextureAt(t,e,s){return this.EK.createCubeRTTTextureAt(t,e,s)}getRTTTextureAt(t){return this.EK.getRTTTextureAt(t)}createRTTTextureAt(t,e,s){return this.EK.createRTTTextureAt(t,e,s)}getDepthTextureAt(t){return this.EK.getDepthTextureAt(t)}createDepthTextureAt(t,e,s){return this.EK.createDepthTextureAt(t,e,s)}getRTTFloatTextureAt(t){return this.EK.getRTTFloatTextureAt(t)}createRTTFloatTextureAt(t,e,s){return this.EK.createRTTFloatTextureAt(t,e,s)}run(){let t=0,e=this.EM.length;for(;t<e;++t)this.EM[t].run();if(this.EN<1){let t;this.EN=128;let e=p.default.GetInstance().getFreeResUidMap(),s=32;for(const[i,r]of e){if(s<1)break;s--,r>2?(e.delete(i),t=p.default.GetInstance().removeTextureByUid(i),null!=t&&this.EJ.addTexture(t)):e.set(i,r+1)}}this.EN--}}e.TextureBlock=T,e.default=T},"5e78":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("7181")),h=i(s("0851"));class n extends h.default{constructor(t,e,s=!1){super(t,e,s),this.EO=null,this.EP=null,this.EQ=0,this.mipmapEnabled=!0,this.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,this.AD=r.TextureProxyType.Image}getTexData(){return this.EO}setDataFromImage(t,e=0,s=0,i=0,r=!1){if(null!=t&&t.width>0&&t.height>0){this.AC=!0,e<0&&(e=0),e>15&&(e=15),e>=this.EQ&&(this.EQ=e+1);let h=this.EO;null!=h?this.EO.miplevel!=e?(null==this.EP&&(this.EP=[this.EO,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),h=this.EP[e],null==h&&(h=a.default.Create(),h.miplevel=e,r=!0,this.EP[e]=h)):this.isGpuEnabled()&&(h.status=0):(h=this.EO=a.default.Create(),h.miplevel=e,r=!0,this.w=t.width,this.x=t.height),h.data==t&&h.offsetx==s&&h.offsety==i||(0==e&&(this.w=t.width,this.x=t.height),h.data=t,h.status=0,(h.width<t.width||h.height<t.height||r)&&(h.width=t.width,h.height=t.height,h.status=1),h.offsetx=s,h.offsety=i),this.version++}}uploadData(t){null!=this.EO&&this.dataUploadToGpu(t.getRC(),this.EO,this.EP,!0),this.version=0}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())&&null!=this.EO){let e=t.getRC();this.__$updateToGpuBegin(t),this.dataUploadToGpu(e,this.EO,this.EP),this.__$buildParam(e),this.AE=!0}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.EP){for(let t=0;t<this.EQ;++t)a.default.Restore(this.EP[t]);this.EQ=0,this.EP=null,this.EO=null}null!=this.EO&&(a.default.Restore(this.EO),this.EO=null),super.__$destroy()}}toString(){return"[ImageTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},"5f3c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("df9d")),h=s("7c63");class n{constructor(t){this.r=-1,this.ER=new a.default,this.index=-1,this.shdUid=-1,this.procuid=-1,this.batchEnabled=!0,this.fixedState=!0,this.runMode=0,this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null,this.Cj=null,this.Cj=t,this.r=n.__s_uid++}showInfo(){this.ER.showInfo()}addNode(t){this.ER.addNodeAndSort(t)}rejoinNode(t){this.ER.containsNode(t)&&(this.ER.removeNodeAndSort(t),this.ER.addNodeAndSort(t))}removeNode(t){this.ER.removeNodeAndSort(t)}isEmpty(){return null==this.ER.getBegin()}run(t){switch(this.runMode){case 2:this.run2(t);break;case 1:this.run1(t);break;case 0:this.run0(t);break;default:break}}run0(t){let e=this.ER.getBegin();if(null!=e){this.Cj.bindToGpu(this.shdUid),this.Cj.resetUniform();let s=null;while(null!=e)e.drawEnabled&&(s=e.unit,s.drawEnabled&&(s.run(t),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}run1(t){let e=this.ER.getBegin();if(null!=e){this.Cj.bindToGpu(this.shdUid),this.Cj.resetUniform();let s=null,i=this.ER.getVtxTotalAt(e.rvroI),r=this.ER.getTexTotalAt(e.rtroI),a=i>0,h=r>0;while(null!=e)i<1&&(i=this.ER.getVtxTotalAt(e.rvroI),a=!0),i--,r<1&&(r=this.ER.getTexTotalAt(e.rtroI),h=!0),r--,e.drawEnabled&&(s=e.unit,s.drawEnabled&&(a&&(e.vro.run(),a=!1),h&&(e.tro.run(),h=!1),s.run2(t),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}run2(t){let e=this.ER.getBegin();if(null!=e){this.Cj.bindToGpu(this.shdUid),this.Cj.resetUniform();let s=null;h.RenderStateObject.UseRenderState(e.unit.renderState),h.RenderColorMask.UseRenderState(e.unit.rcolorMask);let i=this.ER.getVtxTotalAt(e.rvroI),r=this.ER.getTexTotalAt(e.rtroI),a=i>0,n=r>0;while(null!=e)i<0&&(i=this.ER.getVtxTotalAt(e.rvroI),a=!0),i--,r<0&&(r=this.ER.getTexTotalAt(e.rtroI),n=!0),r--,e.drawEnabled&&(s=e.unit,s.drawEnabled&&(a&&(e.vro.run(),a=!1),n&&(e.tro.run(),n=!1),null!=s.ubo&&s.ubo.run(t),this.Cj.useTransUniform(s.transUniform),this.Cj.useUniform(s.uniform),s.partTotal<1?s.drawThis(t):s.drawPart(t))),e=e.next}}runLockMaterial(t){let e=this.ER.getBegin();if(null!=e){this.Cj.bindToGpu(this.shdUid),this.Cj.resetUniform();let s=this.Cj.isTextureUnLocked();t.Texture.unlocked=s;let i=null;if(this.batchEnabled){let r=this.ER.getVtxTotalAt(e.rvroI),a=r>0;while(null!=e)r<1&&(r=this.ER.getVtxTotalAt(e.rvroI),a=!0),r--,i=e.unit,e.drawEnabled&&i.drawEnabled&&(a&&(e.vro.run(),a=!1),s&&e.tro.run(),i.runLockMaterial2(null),i.partTotal<1?i.drawThis(t):i.drawPart(t)),e=e.next}else while(null!=e)i=e.unit,e.drawEnabled&&i.drawEnabled&&(i.runLockMaterial(),s&&e.tro.run(),i.partTotal<1?i.drawThis(t):i.drawPart(t)),e=e.next;t.Texture.unlocked=!1}}drawUnit(t,e,s){e.drawEnabled&&(this.Cj.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t))}drawLockMaterialByUnit(t,e,s,i,a){if(e.drawEnabled){if(a&&this.Cj.resetUniform(),r.default.IsMobileWeb()){let t=this.vtxResource.getVROByResUid(s.vbuf.getUid(),this.Cj.getCurrentShd(),!0);t.run()}else e.vro.run();e.runLockMaterial2(i?this.Cj.__$globalUniform:null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}}reset(){let t=this.ER.getBegin(),e=null;if(null!=t){let s;while(null!=t)e=t,t=t.next,this.rpoUnitBuilder.setRPNodeParam(e.__$ruid,this.procuid,-1),e.reset(),s=e.unit,this.rpoNodeBuilder.restore(e)&&this.rpoUnitBuilder.restore(s)}this.index=-1,this.shdUid=-1,this.procuid=-1,this.ER.clear(),this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null}destroy(){this.reset()}getUid(){return this.r}toString(){return"[RPOBlock(uid = "+this.r+", index = "+this.index+", shdUid = "+this.shdUid+")]"}}n.__s_uid=0,e.default=n},"644c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}static GetTypeByTypeNS(t){switch(t){case"mat4":return i.SHADER_MAT4;case"mat3":return i.SHADER_MAT3;case"mat2":return i.SHADER_MAT2;case"float":return i.SHADER_FLOAT;case"int":return i.SHADER_INT;case"vec4":return i.SHADER_VEC4;case"vec3":return i.SHADER_VEC3;case"vec2":return i.SHADER_VEC2;case"vec4[]":return i.SHADER_VEC4FV;case"vec3[]":return i.SHADER_VEC3FV;case"vec2[]":return i.SHADER_VEC2FV;case"sampler2D":return i.SHADER_SAMPLER2D;case"sampler3D":return i.SHADER_SAMPLER3D;case"samplerCube":return i.SHADER_SAMPLERCUBE;default:break}return i.SHADER_UNDEFINED}static GetTypeNSByType(t){switch(t){case i.SHADER_MAT4:return"mat4";case i.SHADER_MAT3:return"mat3";case i.SHADER_MAT2:return"mat2";case i.SHADER_FLOAT:return"float";case i.SHADER_VEC4:return"vec4";case i.SHADER_VEC3:return"vec3";case i.SHADER_VEC2:return"vec2";case i.SHADER_SAMPLER2D:return"sampler2D";case i.SHADER_SAMPLER3D:return"sampler3D";case i.SHADER_SAMPLERCUBE:return"samplerCube";case i.SHADER_UNDEFINED:return"undefined";default:break}return""}}i.ATTRINS_VTX_VS="a_vs",i.ATTRINS_VTX_UVS="a_uvs",i.ATTRINS_VTX_NVS="a_nvs",i.ATTRINS_VTX_CVS="a_cvs",i.UNIFORMNS_OBJ_MAT_NS="u_objMat",i.UNIFORMNS_VIEW_MAT_NS="u_viewMat",i.UNIFORMNS_PROJ_MAT_NS="u_projMat",i.SHADER_UNDEFINED=3010,i.SHADER_VEC2=3011,i.SHADER_VEC3=3012,i.SHADER_VEC4=3013,i.SHADER_VEC2FV=3014,i.SHADER_VEC3FV=3015,i.SHADER_VEC4FV=3016,i.SHADER_MAT2=3017,i.SHADER_MAT3=3018,i.SHADER_MAT4=3019,i.SHADER_FLOAT=3020,i.SHADER_INT=3021,i.SHADER_MAT2FV=3022,i.SHADER_MAT3FV=3023,i.SHADER_MAT4FV=3024,i.SHADER_SAMPLER2D=3031,i.SHADER_SAMPLERCUBE=3032,i.SHADER_SAMPLER3D=3033,i.SHADER_PRECISION_LOWP=3101,i.SHADER_PRECISION_MEDIUMP=3111,i.SHADER_PRECISION_HIGHP=3121,i.UNIFORM_TEX_SAMPLER2D="sampler2D",i.UNIFORM_TEX_SAMPLERCUBE="samplerCube",i.UNIFORM_TEX_SAMPLER3D="sampler3D",i.UNIFORMNS_TEX_SAMPLER_0="u_sampler0",i.UNIFORMNS_TEX_SAMPLER_1="u_sampler1",i.UNIFORMNS_TEX_SAMPLER_2="u_sampler2",i.UNIFORMNS_TEX_SAMPLER_3="u_sampler3",i.UNIFORMNS_TEX_SAMPLER_4="u_sampler4",i.UNIFORMNS_TEX_SAMPLER_5="u_sampler5",i.UNIFORMNS_TEX_SAMPLER_6="u_sampler6",i.UNIFORMNS_TEX_SAMPLER_7="u_sampler7",i.UNIFORMNS_TEX_SAMPLER_LIST=[i.UNIFORMNS_TEX_SAMPLER_0,i.UNIFORMNS_TEX_SAMPLER_1,i.UNIFORMNS_TEX_SAMPLER_2,i.UNIFORMNS_TEX_SAMPLER_3,i.UNIFORMNS_TEX_SAMPLER_4,i.UNIFORMNS_TEX_SAMPLER_5,i.UNIFORMNS_TEX_SAMPLER_6,i.UNIFORMNS_TEX_SAMPLER_7],e.default=i},"68aa":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,s,i,r,a){1==this.status||a?t.texImage2D(e,this.miplevel,s,this.width,this.height,0,i,r,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,this.width,this.height,i,r,this.data),this.status=-1}static Create(){return i.LP.length>0?i.LP.pop():new i}static Restore(t){null!=t&&(t.data=null,i.LP.push(t))}}i.LP=[],e.default=i},"6ba3":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{constructor(){this.ES=0,this.ET=0,this.EU=0,this.factor=.01,this.speed=.01}calcDegree(t){let e=r.default.GetMinDegree(this.ES,t),s=e*this.factor,i=this.ES+this.ET;return this.ES=i,this.ET+=e>0?this.speed:-this.speed,Math.abs(this.ET)>Math.abs(s)&&(this.ET=s),this.EU=this.ES+this.ET,this.EU}getDegree(){return this.ES+this.ET}setDegree(t){this.ES=t,this.ET=0,this.EU=t}}e.AngleDegreeTween=a},"6d49":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("baae")),h=s("8d98"),n=i(s("56c5"));class l{constructor(t,e,s){this.r=-1,this.A=0,this.EV=0,this.EW=null,this.EX=null,this.EY=null,this.EZ=null,this.EB=512,this.g=512,this.Ea=0,this.AN=null,this.Eb=0,this.Ec=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.Ed=[!0,!0,!0,!0,!0,!0,!0,!0],this.Ee=0,this.Ef=0,this.BI=0,this.Eg=0,this.Eh=new Float32Array(1),this.Ei=new Float32Array(4),this.Ej=new Int16Array(4),this.Ek=!1,this.textureLevel=0,this.sizeFixed=!1,this.writeDepthEnabled=!0,this.writeStencilEnabled=!1,this.multisampleEnabled=!1,this.multisampleLevel=0,this.El=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.Em=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.En=0,this.Eo=!1,this.Ep=2,this.Eq=2,this.A=t,this.DM=e,this.Ea=s,this.r=l.Kh++}getUid(){return this.r}resetAttachmentMask(t){let e=this.Ed.length-1;while(e>=0)this.Ed[e]=t,--e}setAttachmentMaskAt(t,e){this.Ed[t]=e}getActiveAttachmentTotal(){return this.Eo?this.BI-1:this.BI}getAttachmentTotal(){return this.Ed.length}bindToBackbuffer(t){switch(t){case a.default.DRAW_FRAMEBUFFER:this.AN.bindFramebuffer(this.AN.DRAW_FRAMEBUFFER,null);break;case a.default.READ_FRAMEBUFFER:this.AN.indFramebuffer(this.AN.READ_FRAMEBUFFER,null);break;default:this.AN.bindFramebuffer(this.AN.FRAMEBUFFER,null)}}bind(t){if(null!=this.EW)switch(t){case a.default.DRAW_FRAMEBUFFER:this.AN.bindFramebuffer(this.AN.DRAW_FRAMEBUFFER,this.EW);break;case a.default.READ_FRAMEBUFFER:this.AN.bindFramebuffer(this.AN.READ_FRAMEBUFFER,this.EW);break;default:this.AN.bindFramebuffer(this.AN.FRAMEBUFFER,this.EW)}}getFBO(){return this.EW}getDepthStencilRBO(){return this.EX}getDepthRBO(){return this.EY}getWidth(){return this.EB}getHeight(){return this.g}getFramebufferType(){return this.Ea}renderToTexAt(t,e,s){let i=null!=e?e.internalFormat:-1;this.AN=t,0==s&&(this.En=0,this.Eo=!1,this.AN.bindFramebuffer(this.Eb,this.EW),i!=h.TextureFormat.DEPTH_COMPONENT&&i!=h.TextureFormat.DEPTH_STENCIL&&(this.BI=0,this.Eg=0));let r=-1,a=null;null!=e?(r=e.getTargetType(),a=this.DM.getGpuBuffer(e.getResUid()),e.uploadFromFbo(this.DM,this.EB,this.g)):r=this.Ec[this.BI],this.framebufferTextureBind(t,r,i,a)}glFramebufferTex2D(t,e){let s=this.AN;s.framebufferTexture2D(this.Eb,t,s.TEXTURE_2D,e,0),this.El[this.En]=t,this.Em[this.En]=s.TEXTURE_2D,this.En++}glFramebufferTexCube(t,e,s){let i=this.AN;i.framebufferTexture2D(this.Eb,t,i.TEXTURE_CUBE_MAP_POSITIVE_X+e,s,0),this.El[this.En]=t,this.Em[this.En]=i.TEXTURE_CUBE_MAP_POSITIVE_X+e,this.En++}framebufferTexture2D(t,e,s,i){let r=-1;switch(s){case h.TextureFormat.DEPTH_COMPONENT:this.Eo=!0,r=this.AN.DEPTH_ATTACHMENT;break;case h.TextureFormat.DEPTH_STENCIL:this.Eo=!0,r=this.AN.DEPTH_STENCIL_ATTACHMENT;break;default:r=this.EV+this.Eg;break}r>0&&(this.Ed[this.BI]?(this.glFramebufferTex2D(r,i),++this.Eg,this.Ec[this.BI]=null!=i?e:0):this.Ec[this.BI]=0,++this.BI)}framebufferTextureBind(t,e,s,i){switch(e){case h.TextureTarget.TEXTURE_2D:this.framebufferTexture2D(t,e,s,i);break;case h.TextureTarget.TEXTURE_CUBE:let r=0;for(let t=0;t<6;++t)this.Ed[t]?(this.glFramebufferTexCube(this.EV+this.Eg,t,i),++this.Eg,this.Ec[this.BI+t]=null!=i?e:0,r++):this.Ec[this.BI+t]=0;r=r>0?r:6,this.BI+=r;break;case h.TextureTarget.TEXTURE_SHADOW_2D:this.Ed[this.BI]?(this.glFramebufferTex2D(this.AN.DEPTH_ATTACHMENT,i),this.Ec[this.BI]=null!=i?e:0):this.Ec[this.BI]=0,++this.BI;break;default:break}}reset(){this.Ee=-1,this.Ef=-1}use(t){if(this.AN=t,null!=this.EW){if(this.BI>1){if(this.Ef!=this.Eg){let t=[],e=0;for(;e<this.Eg;++e)t.push(this.EV+e);if(this.Ef>this.Eg)for(;e<this.Ef;++e)this.AN.framebufferTexture2D(this.Eb,this.El[e],this.Em[e],null,0);n.default.DrawBuffers(t),this.Ef=this.Eg}}else if(this.Ef!=this.Eg){if(this.Ef>this.Eg)for(let e=1;e<this.Ef;++e)this.AN.framebufferTexture2D(this.Eb,this.El[e],this.Em[e],null,0);let t=[this.EV];n.default.DrawBuffers(t),this.Ef=this.Eg}this.Ee=this.BI}}clearOnlyColor(t){if(null!=this.EW)if(r.default.IsWebGL2())if(this.Ei[0]=t.r,this.Ei[1]=t.g,this.Ei[2]=t.b,this.Ei[3]=t.a,this.Ee>1)for(let e=0;e<this.Ee;++e)this.AN.clearBufferfv(this.AN.COLOR,e,this.Ei);else this.AN.clearBufferfv(this.AN.COLOR,0,this.Ei);else this.AN.clearColor(t.r,t.g,t.b,t.a)}clearOnlyDepth(t=1){r.default.IsWebGL2()?(this.Eh[0]=t,this.AN.clearBufferfv(this.AN.DEPTH,0,this.Eh)):this.AN.clearDepth(t)}clearOnlyStencil(t){this.Ej[0]=t,this.AN.clearBufferuiv(this.AN.STENCIL,0,this.Ej)}clearOnlyDepthAndStencil(t,e){this.AN.clearBufferfi(this.AN.DEPTH_STENCIL,0,t,e)}invalidateFramebuffer(){}resize(t,e){this.Ep==t&&this.Eq==e||(this.Ek=!0,this.Ep=t,this.Eq=e)}initialize(t,e,s){this.AN=t,this.EV=n.default.COLOR_ATTACHMENT0,this.Ek&&(e=this.Ep,s=this.Eq),null==this.EW?this.createNewFBO(t,e,s):this.EB==e&&this.g==s||this.createNewFBO(t,e,s),this.Ek=!1}isSizeChanged(){return this.Ek}destroy(t){null!=this.EW&&(null!=this.EX&&(t.deleteFramebuffer(this.EX),this.EX=null),null!=this.EY&&(t.deleteFramebuffer(this.EY),this.EY=null),null!=this.EZ&&(t.deleteFramebuffer(this.EZ),this.EZ=null),t.deleteFramebuffer(this.EW),this.EW=null),this.AN=null,this.Eb=0,this.Ek=!1}buildDepthStencilRBO(t,e,s){null==this.EX&&(this.EX=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.EX),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_STENCIL,e,s),t.framebufferRenderbuffer(this.Eb,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.EX),null==this.EZ&&(this.EZ=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.EZ),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.Eb,this.EV,t.RENDERBUFFER,this.EZ)):(t.bindRenderbuffer(t.RENDERBUFFER,this.EX),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e,s),t.framebufferRenderbuffer(this.Eb,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.EX))}buildDepthRBO(t,e,s){null==this.EY&&(this.EY=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.EY),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_COMPONENT24,e,s),t.framebufferRenderbuffer(this.Eb,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.EY),null==this.EZ&&(this.EZ=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.EZ),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.Eb,this.EV,t.RENDERBUFFER,this.EZ)):(t.bindRenderbuffer(t.RENDERBUFFER,this.EY),r.default.IsWebGL2()?t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT24,e,s):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,s),t.framebufferRenderbuffer(this.Eb,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.EY))}buildStencilRBO(t,e,s){null==this.EX&&(null==this.EX&&(this.EX=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.EX),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.STENCIL_INDEX8,e,s),t.framebufferRenderbuffer(this.Eb,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.EX),null==this.EZ&&(this.EZ=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.EZ),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.Eb,this.EV,t.RENDERBUFFER,this.EZ)):(t.bindRenderbuffer(t.RENDERBUFFER,this.EX),t.renderbufferStorage(t.RENDERBUFFER,t.STENCIL_INDEX8,e,s),t.framebufferRenderbuffer(this.Eb,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.EX)))}buildColorRBO(t,e,s){this.multisampleEnabled&&(null==this.EZ&&(this.EZ=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.EZ),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,s),t.framebufferRenderbuffer(this.Eb,this.EV,t.RENDERBUFFER,this.EZ))}createNewFBO(t,e,s){let i=null==this.EW;switch(this.Ee=this.BI=0,this.Ef=this.Eg=0,this.EB=e,this.g=s,this.Ep=e,this.Eq=s,i&&(this.EW=t.createFramebuffer()),this.Ea){case a.default.DRAW_FRAMEBUFFER:this.Eb=t.DRAW_FRAMEBUFFER;break;case a.default.READ_FRAMEBUFFER:this.Eb=t.READ_FRAMEBUFFER;break;default:this.Eb=t.FRAMEBUFFER;break}if(t.bindFramebuffer(this.Eb,this.EW),this.writeDepthEnabled?this.writeStencilEnabled?null==this.EX&&this.buildDepthStencilRBO(t,e,s):this.buildDepthRBO(t,e,s):this.writeStencilEnabled?this.buildStencilRBO(t,e,s):this.buildColorRBO(t,e,s),i){t.checkFramebufferStatus(this.Eb);t.FRAMEBUFFER_COMPLETE}l.BindToBackbuffer(t,this.Ea)}static BindToBackbuffer(t,e){switch(e){case a.default.DRAW_FRAMEBUFFER:t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null);break;case a.default.READ_FRAMEBUFFER:t.indFramebuffer(t.READ_FRAMEBUFFER,null);break;default:t.bindFramebuffer(t.FRAMEBUFFER,null);break}}}l.Kh=0,e.default=l},"6e01":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Clamp(t,e,s){return Math.max(Math.min(t,s),e)}static IsPowerOf2(t){return 0==(t&t-1)}static CalcCeilPowerOfTwo(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}static CalcNearestCeilPow2(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}static CalcFloorCeilPow2(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}static DegreeToRadian(t){return i.MATH_PI_OVER_180*t}static Log2(t){return Math.log(t)/Math.LN2}static GetMaxMipMapLevel(t,e){return Math.round(i.Log2(Math.max(t,e))+1)}static SafeACos(t){return t<=-1?i.MATH_PI:t>=1?0:Math.acos(t)}static GetNearestCeilPow2(t){let e=1;while(e<t)e<<=1;return e}static GetMinRadian(t,e){return e%=i.MATH_2PI,t%=i.MATH_2PI,e<t?(e=i.MATH_2PI-t+e,e>i.MATH_PI?e-i.MATH_2PI:e):e>t?(t=i.MATH_2PI-e+t,t>i.MATH_PI?i.MATH_2PI-t:-t):0}static GetMinDegree(t,e){let s=0;return e>=270&&t<90?s=(e-(t+360))%180:e<=90&&t>=270?s=(e+360-t)%180:(s=e-t,s>180?(s-=360,s%=360):s<-180&&(s+=360,s%=360)),s}static GetDegreeByXY(t,e){if(Math.abs(t)<1e-5)return e>=0?270:90;let s=180*Math.atan(e/t)/Math.PI;return t>=0?s:180+s}static GetRadianByXY(t,e){if(Math.abs(t)<i.MATH_MIN_POSITIVE)return e>=0?i.MATH_1PER2PI:i.MATH_3PER2PI;let s=Math.atan(e/t);return t>=0?s:i.MATH_PI+s}static GetRadianByCos(t,e,s){var r=Math.acos(t);return e>=0?r:i.MATH_PI+r}}i.MATH_MIN_POSITIVE=1e-5,i.MATH_MAX_NEGATIVE=-1e-5,i.MATH_MAX_POSITIVE=268435454,i.MATH_MIN_NEGATIVE=-268435454,i.MATH_1_OVER_255=1/255,i.MATH_PI=Math.PI,i.MATH_2PI=2*i.MATH_PI,i.MATH_3PER2PI=1.5*i.MATH_PI,i.MATH_1PER2PI=.5*i.MATH_PI,i.MATH_1_OVER_PI=1/i.MATH_PI,i.MATH_1_OVER_360=1/360,i.MATH_1_OVER_180=1/180,i.MATH_180_OVER_PI=180/i.MATH_PI,i.MATH_PI_OVER_180=i.MATH_PI/180,i.MATH_LN2=.6931471805599453,e.default=i},"6ef8":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("faa5")),a=i(s("0fc4")),h=s("5216");class n extends r.default{constructor(){super(),this.DF="",this.Er=null,this.Es="",this.fogEnabled=!0}initialize(t){super.initialize(t),this.DF="RoadShd",t&&(this.DF+="Tex"),this.fogEnabled&&(this.DF+="Fog"),null!=this.pipeline&&(this.Er=[],this.fogEnabled&&this.Er.push(h.MaterialPipeType.FOG_EXP2),this.pipeline.createKeys(this.Er),this.Es=this.pipeline.getKeysString(),this.pipeline.buildSharedUniforms(this.Er))}buildThisCode(){let t=this.DG;t.addVertLayout("vec3","a_vs"),this.isTexEanbled()&&(t.addVertLayout("vec2","a_uvs"),t.addVarying("vec2","v_uv"),t.addVarying("vec4","v_wpos"),t.addTextureSample2D(),this.fogEnabled&&t.addTextureSample2D("VOX_FOG_COLOR_MAP")),t.addFragOutput("vec4","FragColor0"),t.addFragMainCode("\nworldPosition.xyz = v_wpos.xyz;\n#ifdef VOX_USE_2D_MAP\n    vec4 color = VOX_Texture2D(u_sampler0, v_uv.xy);    \n    FragColor0 = color;\n#else\n    FragColor0 = u_color;\n#endif\n"),t.addVertMainCode("\nlocalPosition.xyz = a_vs.xyz;\n\n#ifdef VOX_USE_2D_MAP\n    v_uv = a_uvs.xy;\n#endif\n\nworldPosition = u_objMat * localPosition;\nviewPosition = u_viewMat * worldPosition;\ngl_Position = u_projMat * viewPosition;\n\nv_wpos.xyz = worldPosition.xyz;\n"),null!=this.pipeline&&this.pipeline.build(this.DG,this.Er)}getFragShaderCode(){return this.buildThisCode(),this.DG.buildFragCode()}getVtxShaderCode(){return this.DG.buildVertCode()}getUniqueShaderName(){return this.DF}toString(){return"[RoadShaderBuffer()]"}static GetInstance(){return n.Ku}}n.Ku=new n;class l extends a.default{constructor(){super(),this.fogEnabled=!0}getCodeBuf(){let t=n.GetInstance();return t.fogEnabled=this.fogEnabled,t}}e.default=l},7045:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.phase=0,this.type=i.KEY_DOWN,this.target=null,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.repeat=!1,this.key="",this.keyCode=0,this.location=0}getClassType(){return i.EventClassType}toString(){return"[KeyboardEvent]"}}i.EventClassType=1003,i.KEY_DOWN=6001,i.KEY_UP=6002,e.default=i},"70f2":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),h=i(s("0236")),n=i(s("c51d")),l=i(s("af68")),_=i(s("a80a")),m=i(s("a446")),o=i(s("c711")),u=i(s("955e")),d=i(s("765c")),c=i(s("af29"));class f{constructor(t,e,s){this.r=-1,this.Aq=null,this.t=null,this.A4=null,this.EL=null,this.Dv=null,this.Et=new Uint8Array(128),this.Eu=0,this.Ev=null,this.Ew=new a.default,this.Ex=new a.default,this.Ey=!1,this.Ez=null,this.E0=!0,this.Y=null,this.B=0,this.C=0,this.D=800,this.E=800,this.E1=null,this.E2=null,this.E3=!0,this.E4=null,this.Cm=null,this.Cj=null,this.E5=-1,this.E6=!0,this.E7=null,this.Cp=!0,this.textureBlock=null,this.E8=[],this.E9=0,this.E_=!0,this.FA=!0,this.FB=!0,this.FC=!0,this.Ey=s,this.Dv=t,this.EL=e,this.Cj=e.getDataBuilder().getRenderShader(),this.r=1024+f.__s_uid++}enable(){this.Cp=!0}disable(){this.Cp=!1}isEnabled(){return this.Cp}getUid(){return this.r}getRPONodeBuilder(){return null}getRenderProxy(){return this.t}setViewPort(t,e,s,i){null!=this.t&&(this.B=t,this.C=e,this.D=s,this.E=i)}reseizeViewPort(){this.t.reseizeRCViewPort()}getRendererAdapter(){return this.Aq}getRenderer(){return this.EL}getRendererContext(){return this.A4}getStage3D(){return this.t.getStage3D()}getCurrentStage3D(){return this.E7}getCamera(){return this.Y}getMouseXYWorldRay(t,e){this.Y.getWorldPickingRayByScreenXY(this.Cm.mouseX,this.Cm.mouseY,t,e)}createCamera(){return new n.default}createFBOInstance(){return new c.default(this,this.textureBlock.getRTTStrore())}setEvt3DController(t){null!=t&&(null==this.E7&&(this.E7=new h.default(this.t.getRCUid(),null)),t.initialize(this.getStage3D(),this.E7),t.setRaySelector(this.Ev.getRaySelector())),this.Ez=t}isRayPickSelected(){return null!=this.Ez&&this.Ez.isSelected()}enableMouseEvent(t=!0){null==this.Ez&&(t?this.Ev.setRaySelector(new u.default):this.Ev.setRaySelector(new o.default),this.setEvt3DController(new d.default)),this.E0=!0}disableMouseEvent(){this.E0=!1}getEvt3DController(){return this.Ez}getSpace(){return this.Ev}getDevicePixelRatio(){return this.Aq.getDevicePixelRatio()}addEventListener(t,e,s,i=!0,r=!1){this.E7.addEventListener(t,e,s,i,r)}removeEventListener(t,e,s){this.E7.removeEventListener(t,e,s)}initialize(t,e=3,s=!0){if(null==this.t){e<1&&(e=1),e>8&&(e=8),this.E4=t,this.E3=t.cameraPerspectiveEnabled;let i=null;for(;e>=0;)i=this.EL.appendProcess(t.batchEnabled,t.processFixedState),this.Et[this.Eu]=i.getRPIndex(),this.Eu++,--e;this.A4=this.EL.getRendererContext(),this.t=this.A4.getRenderProxy(),this.Aq=this.t.getRenderAdapter(),this.Cm=this.t.getStage3D(),this.B=this.Cm.getViewX(),this.C=this.Cm.getViewY(),this.D=this.Cm.getViewWidth(),this.E=this.Cm.getViewHeight(),s?this.createMainCamera():this.Y=this.t.getCamera(),null==this.Ev&&(this.Ev=new m.default,this.Ev.initialize(this.EL,this.Y))}}createMainCamera(){this.Y=new n.default,this.Y.setViewXY(this.B,this.C),this.Y.setViewSize(this.D,this.E);let t=this.E4.camProjParam;this.E3?this.Y.perspectiveRH(r.default.DegreeToRadian(t.x),this.D/this.E,t.y,t.z):this.Y.orthoRH(t.y,t.z,-.5*this.E,.5*this.E,-.5*this.D,.5*this.D),this.Y.lookAtRH(this.E4.camPosition,this.E4.camLookAtPos,this.E4.camUpDirect),this.Y.update()}cameraLock(){this.Y.lock()}cameraUnlock(){this.Y.unlock()}updateRenderBufferSize(){this.Aq.updateRenderBufferSize()}setRendererProcessParam(t,e,s){this.EL.setRendererProcessParam(this.Et[t],e,s)}appendARendererProcess(t=!0,e=!1){let s=this.EL.appendProcess(t,e);this.Et[this.Eu]=s.getRPIndex(),this.Eu++}addContainer(t,e=0){if(e<0&&(e=0),null!=t&&t.__$wuid<0&&t.__$contId<1){let s=0;for(;s<this.E9;++s)if(this.E8[s]==t)return;s>=this.E9&&(t.__$wuid=this.r,t.wprocuid=e,t.__$setRenderer(this),this.E8.push(t),this.E9++)}}removeContainer(t){if(null!=t&&t.__$wuid==this.r&&t.getRenderer()==this.EL){let e=0;for(;e<this.E9;++e)if(this.E8[e]==t){t.__$wuid=-1,t.wprocuid=-1,t.__$setRenderer(null),this.E8.splice(e,1),--this.E9;break}}}setAutoRunningEnabled(t){this.E6=t}moveEntityTo(t,e){this.EL.moveEntityToProcessAt(t,this.Et[e])}drawEntity(t,e=!1,s=!0){this.EL.drawEntity(t,e,s)}addEntity(t,e=0,s=!0){if(t.__$testSpaceEnabled())if(t.isPolyhedral())if(t.hasMesh())this.EL.addEntity(t,this.Et[e],s),null!=this.Ev&&this.Ev.addEntity(t);else{null==this.E1&&(this.E1=new _.default,this.E2=new l.default);let s=this.E2.addEntity(t);s.rstatus=e,this.E1.addNode(s)}else this.EL.addEntity(t,this.Et[e],s),null!=this.Ev&&this.Ev.addEntity(t)}removeEntity(t){let e=null;if(null!=this.E1){let e=this.E2.getNodeByEntity(t);null!=e&&(this.E1.removeNode(e),this.E2.removeEntity(t))}null==e&&(this.EL.removeEntity(t),null!=this.Ev&&this.Ev.removeEntity(t))}updateMaterialUniformToCurrentShd(t){this.EL.updateMaterialUniformToCurrentShd(t)}drawEntityByLockMaterial(t){this.EL.drawEntityByLockMaterial(t)}showInfoAt(t){this.EL.showInfoAt(t)}updateCameraData(t){this.A4.updateCameraDataFromCamera(this.t.getCamera())}renderBegin(t=!1){t&&this.A4.renderBegin(),this.t.getCamera()!=this.Y&&(this.t.isAutoSynViewAndStage()&&(this.B=this.t.getViewX(),this.C=this.t.getViewY(),this.D=this.t.getViewWidth(),this.E=this.t.getViewHeight()),this.Y.setViewXY(this.B,this.C),this.Y.setViewSize(this.D,this.E),this.t.setRCViewPort(this.B,this.C,this.D,this.E,this.t.isAutoSynViewAndStage()),this.t.reseizeRCViewPort()),this.Y.update(),this.A4.updateCameraDataFromCamera(this.Y),this.Cj.renderBegin()}runBegin(t=!0,e=!1){t&&this.E6&&(this.E5>=0&&this.runEnd(),this.E5=0),this.renderBegin(e),null!=this.Ev&&(this.Ev.setCamera(this.Y),this.Ev.runBegin())}setRayTestEanbled(t){this.FC=t}runMouseTest(t,e){let s=-1;if(null!=this.Ez&&this.E0){if(this.FB&&this.Ez.getEvtType()>0){let t=this.Ev.getRaySelector();if(null!=t){this.FC?this.mouseRayTest():t.clear();let e=t.getSelectedNodesTotal();if(e>1){let s=0,i=t.getSelectedNodes(),r=null;for(;s<e;++s)r=i[s],r.entity.isPolyhedral()}}this.FB=!1}s=this.Ez.run(t,e)}return this.E_=!1,s}update(t=!0,e=!0){if(null!=this.E7&&this.E7.enterFrame(),t&&this.E6&&(0!=this.E5&&this.runBegin(),this.E5=1),this.E_=!0,this.FA=!0,this.FB=!0,null!=this.E1){let t=this.E1.getBegin();if(null!=t){let e,s,i;while(null!=t)t.entity.hasMesh()?(e=t,t=t.next,s=e.entity,i=e.rstatus,this.E1.removeNode(e),this.E2.removeEntity(e.entity),this.addEntity(s,i)):t=t.next}}let s=0;for(;s<this.E9;++s)this.E8[s].update();null!=this.Ev&&this.Ev.update(),null!=this.Ev&&this.FA&&(null==this.Ez&&null==this.Ev.getRaySelector()||this.Ev.run()),this.E_&&!this.Ey&&(e?this.runMouseTest(1,0):null!=this.Ez&&this.Ez.mouseOutEventTarget())}cullingTest(){null!=this.Ev&&this.Ev.run(),this.FA=!1}mouseRayTest(){null!=this.Ev&&(this.getMouseXYWorldRay(this.Ex,this.Ew),this.Ev.rayTest(this.Ex,this.Ew))}run(t=!1){if(this.Cp){t&&this.E6&&(1!=this.E5&&this.update(),this.E5=2);for(let t=0;t<this.Eu;++t)this.EL.runAt(this.Et[t]);t&&this.runEnd()}}runAt(t){this.EL.runAt(this.Et[t])}runEnd(){null!=this.Ez&&this.Ez.runEnd(),null!=this.Ev&&this.Ev.runEnd(),this.E6&&(this.E5=-1)}useCamera(t,e=!1){this.Dv.useCamera(t,e)}useMainCamera(){this.Dv.useMainCamera()}updateCamera(){null!=this.Y&&this.Y.update()}setClearUint24Color(t,e=1){this.t.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,s){this.t.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.t.setClearRGBAColor4f(t,e,s,i)}setClearColor(t){this.t.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.t.setRenderToBackBuffer()}toString(){return"[RendererSubScene(uid = "+this.r+")]"}}f.__s_uid=0,e.default=f},"710f":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){if(this.FD=[],this.FE=[],null!=i.LQ)throw Error("ROVtxBufUidStore is a singleton class!!");i.LQ=this}static GetInstance(){return i.LQ}__$getRemovedListLen(){return this.FE.length}__$getRemovedList(){return this.FE}__$attachAt(t){if(t<this.FD.length)++this.FD[t];else{let e=this.FD.length;for(;e<=t;++e)this.FD.push(0);++this.FD[t]}}__$detachAt(t){--this.FD[t],this.FD[t]<1&&(this.FD[t]=0,this.FE.push(t))}getAttachCountAt(t){return t<this.FD.length?this.FD[t]:0}getAttachAllCount(){let t=0,e=0,s=this.FD.length;for(;e<s;++e)this.FD[e]>0&&(t+=this.FD[e]);return t}}i.LQ=null,e.default=i},7181:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,s,i,r,a){1==this.status||a?t.texImage2D(e,this.miplevel,s,i,r,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,i,r,this.data),this.status=-1}static Create(){return i.LP.length>0?i.LP.pop():new i}static Restore(t){null!=t&&(t.data=null,i.LP.push(t))}}i.LP=[],e.default=i},"722e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.NEAREST=4001,i.LINEAR=4002,i.LINEAR_MIPMAP_LINEAR=4003,i.NEAREST_MIPMAP_NEAREST=4004,i.LINEAR_MIPMAP_NEAREST=4005,i.NEAREST_MIPMAP_LINEAR=4006,e.default=i},7279:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("5326")),a=i(s("3b73")),h=i(s("d53d"));class n extends h.default{constructor(){super(),this.slotId=0,this.slotIndex=0,this.uniformsTotal=0,this.locationIndexList=null,this.locations=null,this.rst=0,this.always=!1}clone(){let t=new n;return t.types=this.types.slice(0),t.uniformNameList=this.uniformNameList.slice(0),t.dataSizeList=this.dataSizeList.slice(0),t.slotIndex=this.slotIndex,t.uniformsTotal=this.uniformsTotal,t.slotId=this.slotId,t.always=this.always,t.rst=this.rst,t}copyDataFromProbe(t){this.types=t.uniformTypes.slice(0),this.dataSizeList=t.dataSizeList.slice(0),this.slotIndex=t.getSlotBeginIndex(),this.uniformsTotal=t.uniformsTotal,this.slotId=t.getSlotUid()}copyDataFromProbeAt(t,e){null==this.types&&(this.types=[],this.dataSizeList=[]),this.slotIndex=e.getSlotBeginIndex()+t,this.uniformsTotal=1,this.slotId=e.getSlotUid(),this.types[0]=e.uniformTypes[t],this.dataSizeList[0]=e.dataSizeList[t]}use(t){let e=r.default.GetSlotAt(t.getRCUid());if(this.always||this.rst!=e.flagList[this.slotIndex]){this.rst=e.flagList[this.slotIndex];let s=0;if(a.default.IsWebGL1())for(;s<this.uniformsTotal;++s)t.useUniformV1(this.locations[s],this.types[s],e.dataList[this.slotIndex+s],this.dataSizeList[s]);else for(;s<this.uniformsTotal;++s)t.useUniformV2(this.locations[s],this.types[s],e.dataList[this.slotIndex+s],this.dataSizeList[s],0)}}destroy(){this.types=null,this.dataSizeList=null,this.slotIndex=-1,this.uniformsTotal=0}}e.default=n},7499:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.FF=null,this.Cj=null,this.DM=null}setDispBuilder(t){null==this.FF&&(this.FF=t,this.Cj=t.getRenderShader(),this.DM=t.getTextureResource())}unlockMaterial(){this.Cj.unlock(),this.DM.unlocked=!0}lockMaterial(){this.Cj.lock(),this.DM.unlocked=!1}isUnlockMatrial(){return this.DM.unlocked}unlockTexture(){this.Cj.textureUnlock()}lockTexture(){this.Cj.textureLock()}renderBegin(){this.Cj.renderBegin(),this.DM.renderBegin()}resetUniform(){this.Cj.resetUniform()}useGlobalMaterial(t){this.FF.updateGlobalMaterial(t)}}e.default=i},"74c3":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8def")),a=i(s("fa60"));class h{constructor(){this.FG=null,this.FH=-1,this.FI=[],this.FJ=0,this.AD=0,this.FK=0,this.FL=0,this.FM=null,this.FN=null,this.FO=null,this.FP=[],this.FQ=0}updateToGpu(t){let e=this.FI.length;if(e>0){let s=this.FG;if(this.version!=s.vertexVer){let i,r=s.getBufDataUsage(),a=this.FO;for(let h=0;h<e;++h)i=s.getF32DataAt(h),a[h]>=i.length?(t.bindArrBuf(this.FI[h]),t.arrBufSubData(i,0)):(t.bindArrBuf(this.FI[h]),t.arrBufData(i,r),a[h]=i.length);this.version=s.vertexVer}}}uploadCombined(t,e){let s=this.FG,i=s.getF32DataAt(0);if(this.FI.push(t.createBuf()),t.bindArrBuf(this.FI[0]),t.arrBufData(i,s.getBufDataUsage()),this.FJ=1,this.FO=[i.length],null==this.FM){this.FL=0,this.FM=new Array(this.FK),this.FN=new Array(this.FK);for(let t=0;t<this.FK;++t)this.FN[t]=this.FL,this.FL+=4*e.getLocationSizeByIndex(t),this.FM[t]=e.getLocationTypeByIndex(t)}}uploadSeparated(t,e){let s=this.FG,i=0,r=null,a=s.getBufDataUsage();if(this.FJ=this.FG.getBuffersTotal(),this.FO=new Array(this.FK),null==s.bufData)for(;i<this.FK;++i)r=t.createBuf(),this.FI.push(r),t.bindArrBuf(r),t.arrBufData(s.getF32DataAt(i),a),this.FO[i]=s.getF32DataAt(i).length;else{let e=null,h=0,n=0,l=0,_=0;for(;i<this.FK;++i){for(r=t.createBuf(),this.FI.push(r),t.bindArrBuf(r),t.arrBufDataMem(s.bufData.getAttributeDataTotalBytesAt(i),a),l=0,_=0,n=s.bufData.getAttributeDataTotalAt(i),h=0;h<n;++h)e=s.bufData.getAttributeDataAt(i,h),_+=e.length,t.arrBufSubData(e,l),l+=e.byteLength;this.FO[i]=_}}if(null==this.FM){this.FM=new Array(this.FK),this.FN=new Array(this.FK);for(let t=0;t<this.FK;++t)this.FN[t]=this.FL,this.FL+=4*e.getLocationSizeByIndex(t),this.FM[t]=e.getLocationTypeByIndex(t);this.FL=0}}initialize(t,e,s){this.FI.length<1&&null!=s&&(this.version=s.vertexVer,this.FG=s,this.FH=s.getUid(),this.AD=s.getType(),this.FK=e.getLocationsTotal(),this.AD<1?this.uploadCombined(t,e):this.uploadSeparated(t,e))}getVROMid(t,e,s,i){let r=(131+t.getRCUid())*this.FH;return s?(r=131*r+e.getMid(),r=131*r+3):r=131*r+e.getMid(),r=131*r+e.getLocationsTotal(),r=131*r+i,r}createVRO(t,e,s,i,h){let n=e.getLocationsTotal();if(this.FK*n>0&&n<=this.FK){let l=this.getVROMid(t,e,s,h),_=0,m=a.default.GetByMid(l);if(null!=m)return m;e.testVertexAttribPointerOffset(this.FN);if(s){let s=a.default.Create(t,l,this.FG.getUid());if(s.vao=t.createVertexArray(),t.bindVertexArray(s.vao),this.AD<1)for(t.bindArrBuf(this.FI[0]),_=0;_<n;++_)e.vertexAttribPointerTypeFloat(this.FM[_],this.FL,this.FN[_]);else for(_=0;_<n;++_)t.bindArrBuf(this.FI[_]),e.vertexAttribPointerTypeFloat(this.FM[_],0,0);m=s,s.ibuf=i,t.bindVertexArray(null)}else{let s=r.default.Create(t,l,this.FG.getUid());for(s.shdp=e,s.attribTypes=[],s.wholeOffsetList=[],s.wholeStride=this.FL,this.AD<1?s.vbuf=this.FI[0]:s.vbufs=this.FI,_=0;_<n;++_)e.testVertexAttribPointerType(this.FM[_])&&(s.attribTypes.push(this.FM[_]),s.wholeOffsetList.push(0));s.attribTypesLen=s.attribTypes.length,s.ibuf=i,m=s}return this.FP.push(m),++this.FQ,m}return null}destroy(t){if(this.FI.length>0){this.AD=-1;let e=0,s=null;for(;e<this.FQ;++e)s=this.FP.pop(),s.restoreThis(),this.FP[e]=null;for(this.FQ=0,e=0;e<this.FK;++e)t.deleteBuf(this.FI[e]),this.FI[e]=null;this.FK=0,this.FI=[]}}}class n{constructor(){this.r=0,this.FG=null,this.FH=0,this.FR=null,this.FS=0,this.ibufStep=0,this.r=n.Kh+1}getUid(){return this.r}getVtxUid(){return this.FH}getGpuBuf(){return this.FR}updateToGpu(t){if(null!=this.FR&&this.FS>0){let e=this.FG;this.version!=e.indicesVer&&(this.Bb=e.getIvsData(),t.bindEleBuf(this.FR),this.FS>=this.Bb.length?t.eleBufSubData(this.Bb,e.getBufDataUsage()):t.eleBufData(this.Bb,e.getBufDataUsage()),this.FS=this.Bb.length,this.version=e.indicesVer)}}initialize(t,e){if(null==this.FR&&null!=e.getIvsData())if(this.version=e.indicesVer,this.FG=e,this.FH=e.getUid(),this.Bb=e.getIvsData(),this.FR=t.createBuf(),t.bindEleBuf(this.FR),null==e.bufData)t.eleBufData(this.Bb,e.getBufDataUsage()),this.FS=this.Bb.length;else{t.eleBufDataMem(e.bufData.getIndexDataTotalBytes(),e.getBufDataUsage());let s=null,i=0;this.FS=0;for(let r=0,a=e.bufData.getIndexDataTotal();r<a;++r)s=e.bufData.getIndexDataAt(r),t.eleBufSubData(s,i),i+=s.byteLength,this.FS+=s.length}}destroy(t){null!=this.FR&&(this.FG=null,t.deleteBuf(this.FR),this.FR=null,this.Bb=null,this.FS=0)}}n.Kh=0;class l{constructor(){this.version=-1,this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.vertex=new h,this.indices=new n,this.s=0}__$attachThis(){++this.s}__$detachThis(){--this.s,this.s<1&&(this.s=0)}getAttachCount(){return this.s}createVRO(t,e,s){let i=this.vertex.createVRO(t,e,s,this.indices.getGpuBuf(),this.indices.getUid());return i.ibufStep=this.indices.ibufStep,i}updateToGpu(t){this.indices.updateToGpu(t),this.vertex.updateToGpu(t)}destroy(t){this.getAttachCount()<1&&this.resUid>=0&&(this.vertex.destroy(t),this.indices.destroy(t),this.resUid=-1)}}e.GpuVtxObect=l;class _{constructor(t,e,s){this.FT=new Map,this.FU=new Map,this.FV=[],this.FW=0,this.FX=0,this.FY=128,this.DQ=!1,this.A=0,this.AN=null,this.FZ=null,this.unlocked=!0,this.A=t,this.AN=e,this.FZ=s}createResByParams3(t,e,s,i){return!1}getRCUid(){return this.A}getRC(){return this.AN}hasResUid(t){return this.FT.has(t)}bindToGpu(t){}getGpuBuffer(t){return null}renderBegin(){this.FZ.renderBegin()}getVertexResTotal(){return this.FW}updateDataToGpu(t,e){e?(this.FV.push(t),this.DQ=!0):this.FT.has(t)&&this.FT.get(t).updateToGpu(this.FZ)}addVertexRes(t){this.FT.has(t.resUid)||(t.waitDelTimes=0,this.FT.set(t.resUid,t),this.FW++)}getVertexRes(t){return this.FT.get(t)}destroyRes(t){this.FT.has(t)&&this.FT.get(t).destroy(this.FZ)}__$attachRes(t){if(this.FT.has(t)){this.FX++;let e=this.FT.get(t);e.getAttachCount()<1&&this.FU.has(t)&&this.FU.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.FT.has(t)&&this.FT.has(t)){let e=this.FT.get(t);e.getAttachCount()>0&&(this.FX--,e.__$detachThis(),e.getAttachCount()<1&&this.FU.set(t,e))}}getVROByResUid(t,e,s){let i=this.FT.get(t);return null!=i?i.createVRO(this.FZ,e,s):null}update(){if(this.DQ){this.DQ=!1;let t,e=this.FV.length;e=e>16?16:e;for(let s=0;s<e;++s)t=this.FV.shift(),this.FT.has(t)&&this.FT.get(t).updateToGpu(this.FZ)}if(this.FY--,this.FY<1){this.FY=128;for(const[t,e]of this.FU)e.waitDelTimes++,e.getAttachCount()<1?e.waitDelTimes>5&&(this.FT.delete(e.resUid),this.FU.delete(e.resUid),e.destroy(this.FZ),this.FW--):this.FU.delete(e.resUid)}}}e.ROVertexResource=_,e.default=_},"765c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("1710"));class a{constructor(){this.Fa=null,this.Fb=null,this.Fc=null,this.Fd=!0,this.r=0,this.Q=new r.default,this.Fe=new r.default,this.Ff=new r.default,this.Fg=null,this.Fh=new Float32Array(64),this.Fi=new Float32Array(64),this.Fj=new Float32Array(64),this.Fk=new Float32Array(64),this.Fl=0,this.Fm=-1,this.r=a.Kh++}initialize(t,e){null==this.Fa&&(this.Fa=t,this.Fb=e,t.addEventListener(r.default.MOUSE_DOWN,this,this.mouseDownListener,!0,!1),t.addEventListener(r.default.MOUSE_UP,this,this.mouseUpListener,!0,!1),t.addEventListener(r.default.MOUSE_CLICK,this,this.mouseClickListener,!0,!1),t.addEventListener(r.default.MOUSE_MOVE,this,this.mouseMoveListener,!0,!1),t.addEventListener(r.default.MOUSE_WHEEL,this,this.mouseWheeelListener,!0,!1))}setRaySelector(t){this.Fc=t}mouseWheeelListener(t){null!=this.Fb&&(this.Fb.mouseX=this.Fa.mouseX,this.Fb.mouseY=this.Fa.mouseY),this.Fh[this.Fl]=t.type,this.Fi[this.Fl]=t.mouseX,this.Fj[this.Fl]=t.mouseY,this.Fk[this.Fl]=t.wheelDeltaY,this.Q.type=t.type,this.Fl++}mouseMoveListener(t){null!=this.Fb&&(this.Fb.mouseX=this.Fa.mouseX,this.Fb.mouseY=this.Fa.mouseY),this.Fh[this.Fl]=t.type,this.Fi[this.Fl]=t.mouseX,this.Fj[this.Fl]=t.mouseY,this.Fk[this.Fl]=0,this.Q.type=t.type,this.Fl++}mouseDownListener(t){null!=this.Fb&&(this.Fb.mouseX=this.Fa.mouseX,this.Fb.mouseY=this.Fa.mouseY),a.LR&&(this.Fh[this.Fl]=t.type,this.Fi[this.Fl]=t.mouseX,this.Fj[this.Fl]=t.mouseY,this.Fk[this.Fl]=0,this.Q.type=t.type,this.Fl++)}mouseUpListener(t){null!=this.Fb&&(this.Fb.mouseX=this.Fa.mouseX,this.Fb.mouseY=this.Fa.mouseY),a.LR&&(this.Fh[this.Fl]=t.type,this.Fi[this.Fl]=t.mouseX,this.Fj[this.Fl]=t.mouseY,this.Fk[this.Fl]=0,this.Q.type=t.type,this.Fl++)}mouseClickListener(t){null!=this.Fb&&(this.Fb.mouseX=this.Fa.mouseX,this.Fb.mouseY=this.Fa.mouseY),a.LR&&(this.Fh[this.Fl]=t.type,this.Fi[this.Fl]=t.mouseX,this.Fj[this.Fl]=t.mouseY,this.Fk[this.Fl]=0,this.Q.type=t.type,this.Fl++)}mouseOutEventTarget(){if(null!=this.Fb&&(this.Fb.mouseX=this.Fa.mouseX,this.Fb.mouseY=this.Fa.mouseY),null!=this.Fg){let t=this.Fg.getEvtDispatcher(r.default.EventClassType);if(null!=t)return this.Ff.phase=this.Fm,this.Ff.type=r.default.MOUSE_OUT,this.Ff.mouseX=this.Q.mouseX,this.Ff.mouseY=this.Q.mouseY,this.Ff.target=this.Fg,this.Fc.getRay(this.Ff.raypv,this.Ff.raytv),this.Fg=null,t.dispatchEvt(this.Ff);this.Fg=null}return 0}run(t,e){let s=-1;if(this.Fd){this.Fm=t;let i=0;s=this.Fl>0?0:-1;let h,n,l,_=null;if(s>-1){if(this.Fb!=this.Fa&&null!=this.Fb){for(a.LR=!1,i=0;i<this.Fl;i++)switch(this.Fh[i]){case r.default.MOUSE_DOWN:this.Fb.mouseDown(1);break;case r.default.MOUSE_UP:this.Fb.mouseUp(1);break;case r.default.MOUSE_MOVE:this.Fb.mouseMove();break;default:break}a.LR=!0}if(h=e<1?this.Fc.getSelectedNode():null,null!=h){n=h.lpv,l=h.wpv;let e=h.entity;_=e.getEvtDispatcher(r.default.EventClassType);for(let i=0;i<this.Fl;i++)this.Q.type=this.Fh[i],this.Q.mouseX=this.Fi[i],this.Q.mouseY=this.Fj[i],this.Q.wheelDeltaY=this.Fk[i],this.Q.type>0&&null!=h&&null!=_&&(this.Q.target=e,this.Q.phase=t,this.Q.lpos.copyFrom(n),this.Q.wpos.copyFrom(l),this.Fc.getRay(this.Q.raypv,this.Q.raytv),this.Fg!=e&&(this.Fe.phase=t,this.Fe.type=r.default.MOUSE_OVER,this.Fe.mouseX=this.Q.mouseX,this.Fe.mouseY=this.Q.mouseY,this.Fe.target=e,this.Fe.lpos.copyFrom(n),this.Fe.wpos.copyFrom(l),this.Fc.getRay(this.Fe.raypv,this.Fe.raytv),s+=_.dispatchEvt(this.Fe)),s+=_.dispatchEvt(this.Q),null!=this.Fg&&this.Fg!=e&&(_=this.Fg.getEvtDispatcher(r.default.EventClassType),null!=_&&(this.Ff.phase=t,this.Ff.type=r.default.MOUSE_OUT,this.Ff.mouseX=this.Q.mouseX,this.Ff.mouseY=this.Q.mouseY,this.Ff.target=this.Fg,this.Ff.lpos.copyFrom(n),this.Ff.wpos.copyFrom(l),this.Fc.getRay(this.Ff.raypv,this.Ff.raytv),s+=_.dispatchEvt(this.Ff))),this.Fg=e)}else if(s+=this.mouseOutEventTarget(),null!=this.Fb)for(i=0;i<this.Fl;i++)switch(this.Fh[i]){case r.default.MOUSE_DOWN:this.Fb.mouseBgDown();break;case r.default.MOUSE_UP:this.Fb.mouseBgUp();break;default:break}if(null!=this.Fb){for(a.LR=!1,i=0;i<this.Fl;i++)switch(this.Fh[i]){case r.default.MOUSE_DOWN:this.Fb.mouseDown(2);break;case r.default.MOUSE_UP:this.Fb.mouseUp(2);break;default:break}a.LR=!0}}0==s&&null!=_&&(s=_.passTestPhase(t))}return s>0?1:0}runEnd(){this.Fl=0,this.Q.type=0}reset(){this.Fl=0}getEvtType(){return this.Q.type}isSelected(){return null!=this.Fc.getSelectedNode()}lock(){this.Fd=!1}unlock(){this.Fd=!0}isUnlock(){return this.Fd}}a.Kh=0,a.LR=!0,e.default=a},7696:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("264c")),a=i(s("5f3c"));class h{constructor(t,e,s,i,r,a){this.A=-1,this.Fn=-1,this.Fo=0,this.Cp=!0,this.Fp=[],this.Fq=0,this.Fr=new Int8Array(h.LS),this.Fs=h.LS,this.Cj=null,this.DX=null,this.BP=null,this.DY=null,this.Ft=null,this.Fu=null,this.Cl=null,this.DZ=!0,this.Da=!0,this.Fv=!1,this.uid=-1,this.Cj=t,this.DX=e,this.BP=s,this.DY=i,this.Ft=this.createBlock(),this.DZ=r,this.Da=a;for(let h=0;h<this.Fs;++h)this.Fr[h]=-1}createBlock(){let t=new a.default(this.Cj);return t.rpoNodeBuilder=this.DX,t.rpoUnitBuilder=this.BP,t.vtxResource=this.DY,t}setRenderParam(t,e){this.Fq<1&&(this.DZ=t,this.Da=e)}setRendererParam(t,e){this.Be=t,this.A=t.getRCUid(),this.Fn=e}getUid(){return this.uid}getRCUid(){return this.A}getRPIndex(){return this.Fn}hasSorter(){return null!=this.Cl}setSorter(t){this.Cl=t,null!=this.Fu&&this.Fu.setSorter(t)}setSortEnabled(t){this.Fo<1?this.Fv=t:null!=this.Fu&&(this.Fu.sortEnabled=t)}getSortEnabled(){return this.Fv}getUnitsTotal(){return this.Fo}addNodeToBlock(t){let e=null;if(t.shdUid>=h.LS)throw Error("Shader uid >= "+h.LS);this.Fr[t.shdUid]<0?(e=this.createBlock(),e.batchEnabled=this.DZ,e.fixedState=this.Da,e.batchEnabled?e.fixedState?e.runMode=2:e.runMode=1:e.runMode=0,e.shdUid=t.shdUid,e.index=this.Fq,e.procuid=this.Fn,this.Fp.push(e),this.Fr[t.shdUid]=this.Fq,++this.Fq):e=this.Fp[this.Fr[t.shdUid]],t.index=e.index,e.addNode(t)}rejoinRunitForTro(t){let e=this.DX.getNodeByUid(t.__$rpuid);null!=e&&(e.tro=t.tro,e.texMid=e.unit.texMid,this.Fp[e.index].rejoinNode(e))}rejoinRunitForVro(t){let e=this.DX.getNodeByUid(t.__$rpuid);null!=e&&(e.drawMode=t.drawMode,e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,e.vtxUid=t.vtxUid,e.vro=t.vro,this.Fp[e.index].rejoinNode(e))}addDisp(t){if(null!=t&&null!=t.__$$runit&&t.__$$runit.getRPROUid()<0&&t.__$$runit.getRPROUid()!=this.uid){let e=this.DX.create();e.unit=this.BP.getNodeByUid(t.__$ruid),e.unit.shader=this.Cj,e.unit.__$rprouid=this.uid,t.__$rpuid=e.uid,e.__$ruid=t.__$ruid,e.unit.__$rpuid=e.uid,e.updateData(),++this.Fo,this.BP.setRPNodeParam(t.__$ruid,this.getUid(),e.uid),this.Fv?(null!=this.Fu||(this.Fu=new r.default(this.Cj),this.Fu.setSorter(this.Cl)),this.Fu.addNode(e)):this.addNodeToBlock(e)}}updateDispMateiral(t){if(null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),s=this.DX.getNodeByUid(e);s.shdUid=s.unit.shdUid,s.texMid=s.unit.texMid,s.tro=s.unit.tro;let i=this.Fp[s.index];i.removeNode(s),this.addNodeToBlock(s)}}removeDisp(t){if(null!=t&&null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),s=this.DX.getNodeByUid(e);if(null!=s){if(null==this.Fu){let t=this.Fp[s.index];t.removeNode(s)}else this.Fu.removeNode(s);this.BP.setRPNodeParam(t.__$ruid,this.getUid(),-1),--this.Fo;let e=s.unit;this.DX.restore(s)&&this.BP.restore(e),this.DY.__$detachRes(t.vbuf.getUid()),t.__$$runit=null,t.__$ruid=-1}}}removeDispUnit(t){if(null!=t&&t.__$ruid>-1){let e=t.__$$runit.getRPOUid(),s=this.DX.getNodeByUid(e);if(null!=s){if(null==this.Fu){let t=this.Fp[s.index];t.removeNode(s)}else this.Fu.removeNode(s);this.BP.setRPNodeParam(t.__$ruid,this.Fn,-1),s.unit.__$rprouid=-1,--this.Fo,this.DX.restore(s)}}}update(){this.Cp&&this.Fo>0&&null!=this.Fu&&this.Fu.update()}run(){if(this.Cp&&this.Fo>0){let t=this.Be;if(null==this.Fu)if(this.Cj.isUnLocked())for(let e=0;e<this.Fq;++e)this.Fp[e].run(t);else for(let e=0;e<this.Fq;++e)this.Fp[e].runLockMaterial(t);else this.Cj.isUnLocked()?this.Fu.run(t):this.Fu.runLockMaterial(t)}}drawDisp(t,e=!1,s=!0){if(null!=t){let i=t.__$$runit;null!=i&&(this.Cj.isUnLocked()?(s&&this.Cj.resetUniform(),this.Ft.drawUnit(this.Be,i,t)):this.Ft.drawLockMaterialByUnit(this.Be,i,t,e,s))}}drawLockMaterialByDisp(t,e=!1,s=!0){if(null!=t){let i=t.__$$runit;null!=i&&this.Ft.drawLockMaterialByUnit(this.Be,i,t,e,s)}}reset(){this.Fv=!1,this.Fo=0,this.uid=-1,this.Fn=-1,this.A=-1,this.Fn=-1;let t=0;for(;t<this.Fq;++t)this.Fp[t].reset();this.Fq=0,this.Fp=[],this.DX=null,this.BP=null,this.DY=null,this.Be=null,null!=this.Fu&&(this.Fu.clear(),this.Fu=null)}showInfo(){let t=0;for(;t<this.Fq;++t)this.Fp[t].showInfo()}destroy(){this.reset()}setEnabled(t){this.Cp=t}getEnabled(){return this.Cp}toString(){return"[RenderProcess(uid = "+this.Fn+")]"}}h.LS=1024,e.default=h},"76b0":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("35fa")),a=i(s("8a0a")),h=i(s("fecb")),n=i(s("cb29")),l=i(s("e7d2")),_=s("e08e"),m=i(s("3930"));class o extends n.default{constructor(t=a.default.VTX_STATIC_DRAW){super(t),this.color0=new m.default,this.color1=new m.default,this.color2=new m.default,this.color3=new m.default,this.offsetU=0,this.offsetV=0,this.uScale=1,this.vScale=1,this.flipVerticalUV=!1,this.axisFlag=0,this.Fw=!0,this.BZ=null,this.Ba=null,this.DU=null,this.DV=null,this.Fx=null,this.Fy=null,this.vsFloat32=null,this.dataStepList=null}getVS(){return this.BZ}getUVS(){return this.Ba}setUVS(t){null!=t&&8==t.length&&(null==this.Ba?this.Ba=t.slice(0):this.Ba.set(t))}getNVS(){return this.DU}getCVS(){return this.DV}initialize(t,e,s,i){if(null!=this.BZ)return;let n=t,m=e,o=t+s,u=e+i,d=0;switch(this.Bb=new Uint16Array([0,1,2,0,2,3]),this.axisFlag){case 0:this.BZ=new Float32Array([n,m,d,o,m,d,o,u,d,n,u,d]);break;case 1:this.BZ=new Float32Array([o,d,m,n,d,m,n,d,u,o,d,u]);break;case 2:this.BZ=new Float32Array([d,n,m,d,o,m,d,o,u,d,n,u]);break;default:break}if(null==this.bounds&&(this.bounds=new h.default),this.bounds.addXYZFloat32Arr(this.BZ),this.bounds.updateFast(),l.default.Reset(),l.default.AddFloat32Data(this.BZ,3),null==this.Ba&&this.isVBufEnabledAt(a.default.VBUF_UVS_INDEX)&&(this.flipVerticalUV?this.Ba=new Float32Array([this.offsetU+0*this.uScale,this.offsetV+1*this.vScale,this.offsetU+1*this.uScale,this.offsetV+1*this.vScale,this.offsetU+1*this.uScale,this.offsetV+0*this.vScale,this.offsetU+0*this.uScale,this.offsetV+0*this.vScale]):this.Ba=new Float32Array([this.offsetU+0*this.uScale,this.offsetV+0*this.vScale,this.offsetU+1*this.uScale,this.offsetV+0*this.vScale,this.offsetU+1*this.uScale,this.offsetV+1*this.vScale,this.offsetU+0*this.uScale,this.offsetV+1*this.vScale])),this.isVBufEnabledAt(a.default.VBUF_NVS_INDEX))switch(this.axisFlag){case 0:this.DU=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]);break;case 1:this.DU=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0]);break;case 2:this.DU=new Float32Array([1,0,0,1,0,0,1,0,0,1,0,0]);break;default:break}if(this.isVBufEnabledAt(a.default.VBUF_CVS_INDEX)&&(this.DV=new Float32Array([this.color0.r,this.color0.g,this.color0.b,this.color1.r,this.color1.g,this.color1.b,this.color2.r,this.color2.g,this.color2.b,this.color3.r,this.color3.g,this.color3.b])),this.isVBufEnabledAt(a.default.VBUF_TVS_INDEX)){let t=2;this.Fx=new Float32Array(12),this.Fy=new Float32Array(12),r.default.ClacTrisTangent(this.BZ,this.BZ.length,this.Ba,this.DU,t,this.Bb,this.Fx,this.Fy)}this.drawMode=_.RenderDrawMode.ELEMENTS_TRIANGLES,this.buildVbuf(),this.vtxTotal=4,this.trisNumber=2,this.buildEnd()}reinitialize(){this.buildVbuf()}buildVbuf(){l.default.Reset(),l.default.AddFloat32Data(this.BZ,3),this.isVBufEnabledAt(a.default.VBUF_UVS_INDEX)&&l.default.AddFloat32Data(this.Ba,2),this.isVBufEnabledAt(a.default.VBUF_NVS_INDEX)&&l.default.AddFloat32Data(this.DU,3),this.isVBufEnabledAt(a.default.VBUF_CVS_INDEX)&&l.default.AddFloat32Data(this.DV,3),this.isVBufEnabledAt(a.default.VBUF_TVS_INDEX)&&(l.default.AddFloat32Data(this.Fx,3),l.default.AddFloat32Data(this.Fy,3)),l.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.updateWireframeIvs(),this.vtCount=this.Bb.length,null!=this.DW?l.default.UpdateBufData(this.DW):this.DW=l.default.CreateBySaveData(this.getBufDataUsage(),this.getBufSortFormat()),this.DW.setUintIVSData(this.Bb),this.buildEnd()}isPolyhedral(){return this.Fw}setPolyhedral(t){this.Fw=t}testRay(t,e,s,i){if(this.Fw)return-1;if(i){let i=h.default.IntersectionRL2(e,t,this.bounds,s);return i?1:-1}return-1}toString(){return"[RectPlaneMesh()]"}__$destroy(){this.isResFree()&&(this.bounds=null,this.BZ=null,this.Ba=null,this.DU=null,this.DV=null,super.__$destroy())}}e.default=o},"77cf":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("3077")),h=s("5216"),n=s("a9bf"),l=s("c70f");class _{constructor(t=0){this.r=-1,this.Fz=new l.GlobalEnvLightUniformParam,this.F0=null,this.F1=null,this.F2=!1,this.F3=0,this.F3=t,this.r=_.Kh++}getUid(){return this.r}setAmbientColorRGB3f(t,e,s){let i=r.default.EnvLightParams.data;i[0]=t,i[1]=e,i[2]=s,this.F2=!0}setFogColorRGB3f(t,e,s){let i=r.default.EnvLightParams.data;i[8]=t,i[9]=e,i[10]=s,this.F2=!0}setFogDensity(t){r.default.EnvLightParams.data[11]=t,this.F2=!0}setFogNear(t){r.default.EnvLightParams.data[6]=t,this.F2=!0}setFogFar(t){r.default.EnvLightParams.data[7]=t,this.F2=!0}setFogAreaSize(t,e){r.default.EnvLightParams.data[14]=t,r.default.EnvLightParams.data[15]=t,this.F2=!0}setFogAreaOffset(t,e){r.default.EnvLightParams.data[12]=t,r.default.EnvLightParams.data[13]=e,this.F2=!0}useShaderPipe(t,e){if(null!=this.F0)switch(e){case h.MaterialPipeType.ENV_LIGHT_PARAM:case h.MaterialPipeType.FOG:case h.MaterialPipeType.FOG_EXP2:this.Fz.use(t),e!=h.MaterialPipeType.ENV_LIGHT_PARAM&&this.useFogData(t,e==h.MaterialPipeType.FOG_EXP2,!0);break;default:break}}getPipeTypes(){return[h.MaterialPipeType.ENV_LIGHT_PARAM,h.MaterialPipeType.FOG,h.MaterialPipeType.FOG_EXP2]}getPipeKey(t){switch(t){case h.MaterialPipeType.ENV_LIGHT_PARAM:case h.MaterialPipeType.FOG:case h.MaterialPipeType.FOG_EXP2:return"["+t+"]";default:break}return""}useUniforms(t){null!=this.F0&&t.addFragUniformParam(r.default.EnvLightParams)}useFogData(t,e,s){t.addDefine("VOX_USE_FOG","1"),e&&t.addDefine("VOX_FOG_EXP2","1"),t.addVarying("float","v_fogDepth"),s?t.addShaderObject(n.EnvShaderCode):t.addShaderObjectHead(n.EnvShaderCode)}useUniformsForFog(t,e=!0){null!=this.F0&&(t.addFragUniformParam(r.default.EnvLightParams),this.useFogData(t,e,!1))}initialize(){null==this.F0&&(this.F0=new a.default,this.F0.bindSlotAt(this.F3),this.F0.addVec4Data(r.default.EnvLightParams.data,r.default.EnvLightParams.arrayLength),this.F1=this.Fz.createGlobalUinform(this.F0),this.F0.update())}update(){null!=this.F0&&this.F2&&(this.F2=!1,this.F0.update())}getGlobalUinform(){return this.F1.clone()}}_.Kh=0,e.default=_},"78e9":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("644c"));class a{constructor(){this.type=-1,this.typeName="",this.name="",this.isArray=!1,this.arrLength=0,this.isTex=!1,this.location=null}parseCode(t){const e=";";let s=t.indexOf(e);if(s<0)return!1;const i=" ";t=t.replace(/^\s*|\s*$/g,""),s>0&&(t=t.slice(0,s));let a=t.split(i);return this.typeName=a[a.length-2],this.name=a[a.length-1],s=this.name.indexOf("["),this.isArray=s>0,this.arrLength=0,this.isArray&&(this.arrLength=parseInt(this.name.slice(s+1,this.name.indexOf("]",s+1))),this.name=this.name.slice(0,s),this.typeName+="[]"),this.type=r.default.GetTypeByTypeNS(this.typeName),!(this.type<0)&&(this.isTex=this.type==r.default.SHADER_SAMPLER2D||this.type==r.default.SHADER_SAMPLERCUBE||this.type==r.default.SHADER_SAMPLER3D,!0)}}e.default=a},7934:function(t,e,s){"use strict";s.r(e),s.d(e,"TerrainShaderCode",(function(){return a}));var i="worldPosition.xyz = v_wpos.xyz;\r\n#ifdef VOX_USE_2D_MAP\r\n    vec2 colorUV = v_uv.xy * 16.0;\r\n    vec4 color = VOX_Texture2D(u_sampler0, v_uv.xy * 4.0);\r\n    vec4 ao = VOX_Texture2D(VOX_DISPLACEMENT_MAP, v_uv);\r\n\r\n    #ifdef VOX_USE_FOG\r\n        vec4 color1 = getFogColorFromTexture2D( u_sampler1 );\r\n        fogEnvColor = color1.xyz;\r\n    #else\r\n        vec4 color1 = VOX_Texture2D(u_sampler1, v_uv);\r\n    #endif\r\n    \r\n    float f = v_param.x / 0.70;\r\n    color.xyz = mix( color.xyz, color1.xyz, f * f);\r\n    color.xyz *= (ao.xyz * 0.9 + vec3(0.1));\r\n    color *= u_color;\r\n    FragColor0 = color;\r\n#else\r\n    FragColor0 = u_color;\r\n#endif",r="\r\nlocalPosition.xyz = a_vs.xyz;\r\n#ifdef VOX_USE_2D_MAP\r\n    v_uv = a_uvs.xy;\r\n#endif\r\n#ifdef VOX_DISPLACEMENT_MAP\r\n    v_param = VOX_Texture2D(VOX_DISPLACEMENT_MAP, v_uv.xy);\r\n    localPosition.xyz += normalize( a_nvs ) * vec3( v_param.x * u_displacement.x + u_displacement.y );\r\n    //localPosition += normalize( a_nvs ) * vec3( (1.0 - v_param.x) * u_displacement.x + u_displacement.y );\r\n#endif\r\n\r\nworldPosition = u_objMat * localPosition;\r\nviewPosition = u_viewMat * worldPosition;\r\ngl_Position = u_projMat * viewPosition;\r\n\r\nv_wpos.xyz = worldPosition.xyz;";const a={vert:"",vert_head:"",vert_body:r,frag:"",frag_head:"",frag_body:i}},"79d6":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("9c3c")),a=i(s("402a")),h=i(s("32cc")),n=i(s("3930"));class l extends a.default{constructor(){super(),this.F4=null,this.F5=null,this.F6=null,this.F7=[0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7],this.F8=-1,this.Y=null}setRGB3f(t,e,s){this.F4.setRGB3f(t,e,s)}createMaterial(){null==this.getMaterial()&&(this.F4=new h.default(!1),this.setMaterial(this.F4))}__activeMesh(t){if(null==this.getMesh()){let e=new r.default;e.vbWholeDataEnabled=!1,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.F5,this.F6),this.setMesh(e)}}initiazlize(t,e=null,s=null,i=null,r=null){let a=t.getWordFrustumVtxArr();null==this.F5&&(this.F5=new Array(72)),null==this.F6&&(this.F6=new Array(72));let h=this.F7;null==e&&(e=new n.default(1,0,1,1)),null==s&&(s=new n.default(0,.5,1)),null==i&&(i=new n.default(0,.9,0)),null==r&&(r=new n.default(0,.9,.9));let l,_,m=[e,e,e,e,e,e,e,e,s,s,s,s,s,s,s,s,i,i,i,i,r,r,r,r],o=0;for(let n=0;n<h.length;n++)l=a[h[n]],_=m[n],this.F5[o]=l.x,this.F5[o+1]=l.y,this.F5[o+2]=l.z,this.F6[o]=_.r,this.F6[o+1]=_.g,this.F6[o+2]=_.b,o+=3;this.createMaterial(),this.activeDisplay()}updateFrame(t){if(this.Y!=t&&(this.Y=t,this.F8=-1),null!=t&&this.F8!=t.version){this.F8=t.version;let e=this.getMesh();if(null!=e){let s,i=t.getWordFrustumVtxArr(),r=this.F7;for(let t=0;t<r.length;t++)s=i[r[t]],e.setVSXYZAt(t,s.x,s.y,s.z);return!0}}return!1}destroy(){this.Y=null}toString(){return"FrustrumFrame3DEntity(name="+this.name+",uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=l},"7a04":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("f044"));class a{constructor(){this.r=-1,this.D5=0,this.layoutBit=0,this.F9=null,this.F_=null,this.GA=null,this.GB=null,this.GC=null,this.GD=null,this.GE=0,this.r=r.default.CreateNewID()}getUid(){return this.r}getType(){return 1}getBuffersTotal(){return this.F_.length}getF32DataAt(t){return this.F_[t]}setF32DataAt(t,e,s,i){null==this.F_&&(this.F_=[null,null,null,null,null,null,null,null],this.GC=[!1,!1,!1,!1,!1,!1,!1,!1],this.GA=[0,0,0,0,0,0,0,0],this.GB=[0,0,0,0,0,0,0,0]),this.F_[t]=e,null!=this.GD&&null!=e&&(this.GC[t]=!0),null!=i&&(this.F9=i),this.GE=s,null!=e&&(this.GA[t]=e.length)}setData4fAt(t,e,s,i,r,a){t*=this.F9[e],this.F_[e][t++]=s,this.F_[e][t++]=i,this.F_[e][t++]=r,this.F_[e][t++]=a}setData3fAt(t,e,s,i,r){t*=this.F9[e],this.F_[e][t++]=s,this.F_[e][t++]=i,this.F_[e][t++]=r}setData2fAt(t,e,s,i){t*=this.F9[e],this.F_[e][t++]=s,this.F_[e][t++]=i}destroy(){this.F_=null,this.GC=null,this.GA=null,this.GB=null,this.F_=null}toString(){return"VtxSeparatedBuf(uid = "+this.r+")"}}e.default=a},"7b0e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("bbf4"));class a{constructor(){this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rayTestState=0,this.rpoNode=null,this.spaceId=-1,this.camVisiSt=0,this.camVisi=r.default.CAMERA_VISIBLE_ENABLE}reset(){this.rayTestState=0,this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rpoNode=null,this.spaceId=-1,this.camVisi=0}static GetFreeId(){return a.Al.length>0?a.Al.pop():-1}static GetByUid(t){return t>-1&&t<a.GG?a.GF[t]:null}static SetCamVisiByUid(t,e){a.GF[t].camVisi=e}static GetCamVisiByUid(t){return a.GF[t].camVisi}static Create(){let t=null,e=a.GetFreeId();return e>=0?(t=a.GF[e],t.uid=e,a.Hv[e]=a.S_FLAG_BUSY):(t=new a,a.GF.push(t),a.Hv.push(a.S_FLAG_BUSY),t.uid=a.GG,a.GG++),t}static Restore(t){null!=t&&t.uid>=0&&a.Hv[t.uid]==a.S_FLAG_BUSY&&(a.Al.push(t.uid),a.Hv[t.uid]=a.S_FLAG_FREE,t.reset())}}a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.GG=0,a.GF=[],a.Hv=[],a.Al=[],e.default=a},"7c63":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("e08e");class r{constructor(t,e,s,i){this.r=-1,this.GH=!0,this.GI=!0,this.GJ=!0,this.GK=!0,this.r=r.Kh++,this.GH=t,this.GI=e,this.GJ=s,this.GK=i}getUid(){return this.r}getR(){return this.GH}getG(){return this.GI}getB(){return this.GJ}getA(){return this.GK}use(){r.LT!=this.r&&(r.Rstate.setColorMask(this.GH,this.GI,this.GJ,this.GK),r.LT=this.r)}static Create(t,e,s,i,a){if(r.LU.has(t)){let e=r.LU.get(t);return e.getUid()}let h=(e?64:32)|(s?16:8)|(i?4:2)|(a?1:0);if(r.LV.has(h)){let t=r.LV.get(h);h=t.getUid()}else{let n=new r(e,s,i,a);h=n.getUid(),r.LV.set(h,n),r.LU.set(t,n),r.LW.push(n),++r.LY}return h}static GetColorMaskByName(t){if(r.LU.has(t)){let e=r.LU.get(t);return e.getUid()}return-1}static UseRenderState(t){r.LX&&r.Rstate.roColorMask!=t&&t>-1&&t<r.LY&&r.LW[t].use()}static UseColorMaskByName(t){let e=r.GetColorMaskByName(t);r.LX&&r.Rstate.roColorMask!=e&&e>-1&&e<r.LY&&r.LW[e].use()}static Lock(){r.LX=!1}static Unlock(){r.LX=!0}static Reset(){r.LT=-1}}r.Kh=0,r.LT=-1,r.LW=[],r.LY=1,r.LV=new Map,r.LU=new Map,r.LX=!0,r.ALL_TRUE_COLOR_MASK=0,r.ALL_FALSE_COLOR_MASK=1,r.Rstate=null,e.RenderColorMask=r;class a{constructor(t,e,s){this.r=-1,this.GL=0,this.GM=0,this.GN=0,this.GO=0,this.r=a.Kh++,this.GL=t,this.GM=e,this.GN=s}getUid(){return this.r}getCullFaceMode(){return this.GL}getDepthTestMode(){return this.GN}getBlendMode(){return this.GM}use(){if(a.LT!=this.r){a.Rstate.setCullFaceMode(this.GL);a.Lf[a.GM];a.GM<0?a.Rstate.setBlendMode(this.GM,a.Lf[this.GM]):a.Rstate.setBlendMode(a.GM,a.Lf[a.GM]),a.Ld<0?a.Rstate.setDepthTestMode(this.GN):a.Rstate.setDepthTestMode(a.Ld),a.LT=this.r}}static CreateBlendModeSeparate(t,e,s,r,h,n=0,l=0){if(null!=t&&""!=t){let _;if(a.LZ.has(t))return _=a.LZ.get(t),a.La.get(_);n<1&&(n=i.GLBlendEquation.FUNC_ADD),l<1&&(l=i.GLBlendEquation.FUNC_ADD);let m=1;if(_=31,_=131*_+e,_=131*_+s,r>0&&h>0&&(_=131*_+r,_=131*_+h,m=1),a.La.has(_))return a.LZ.set(t,_),a.La.get(_);let o=++a.Lb;a.LZ.set(t,_),a.La.set(_,o);let u=[m,n,l,e,s,r,h];return a.Lf[o]=u,o}return 0}static CreateBlendMode(t,e,s,r=0){if(null!=t&&""!=t){let h;if(a.LZ.has(t))return h=a.LZ.get(t),a.La.get(h);r<1&&(r=i.GLBlendEquation.FUNC_ADD);let n=0;if(h=31,h=131*h+e,h=131*h+s,a.La.has(h))return a.La.get(h);let l=++a.Lb;a.LZ.set(t,h),a.La.set(h,l);let _=[n,r,0,e,s,0,0];return a.Lf[l]=_,l}return 0}static Create(t,e,s,i){if(a.LU.has(t)){let e=a.LU.get(t);return e.getUid()}let r=31;if(r=131*r+i,r=131*r+s,r=131*r+e,a.LV.has(r)){let t=a.LV.get(r);r=t.getUid()}else{let h=new a(e,s,i);r=h.getUid(),a.LV.set(r,h),a.LU.set(t,h),a.LW.push(h),++a.LY}return r}static GetRenderStateByName(t){if(a.LU.has(t)){let e=a.LU.get(t);return e.getUid()}return-1}static UseRenderState(t){a.LX&&a.LT!=t&&t>-1&&t<a.LY&&a.LW[t].use()}static UseRenderStateByName(t){if(a.LX){let e=a.GetRenderStateByName(t);a.LT!=e&&e>-1&&e<a.LY&&a.LW[e].use()}}static UnlockBlendMode(){a.GM=a.Lc}static LockBlendMode(t){a.Lc=a.GM,a.GM=t}static UnlockDepthTestMode(){a.Ld=a.Le}static LockDepthTestMode(t){a.Le=a.Ld,a.Ld=t}static Lock(){a.LX=!1}static Unlock(){a.LX=!0}static Reset(){a.LT=-1}}a.Kh=0,a.LT=-1,a.LW=[],a.LY=1,a.GM=-1,a.Ld=-1,a.LV=new Map,a.LU=new Map,a.LZ=new Map,a.La=new Map,a.Lb=0,a.Lf=new Array(256),a.LX=!0,a.Rstate=null,a.Lc=-1,a.Le=-1,e.RenderStateObject=a;class h{constructor(){this.stencilMask=-1}}class n{constructor(){this.GP=new Array(128),this.GQ=null,this.GM=i.RenderBlendMode.NORMAL,this.GR=i.CullFaceMode.NONE,this.GS=i.DepthTestMode.DISABLE,this.GT=!0,this.GU=null,this.AN=null,this.roColorMask=-11}reset(){this.roColorMask=-11}setRenderContext(t){this.GU=t,this.AN=t.getRC();let e=this.AN.rcuid;this.GQ=this.GP[e],null==this.GQ&&(this.GQ=this.GP[e]=new h)}setColorMask(t,e,s,i){this.AN.colorMask(t,e,s,i)}setStencilFunc(t,e,s){this.AN.stencilFunc(t,e,s)}setStencilMask(t){this.GQ.stencilMask!=t&&t>=0&&(this.GQ.stencilMask=t,this.AN.stencilMask(t))}setStencilOp(t,e,s){this.AN.stencilOp(t,e,s)}setDepthTestEnable(t){t?this.AN.enable(this.AN.DEPTH_TEST):this.AN.disable(this.AN.DEPTH_TEST)}setCullFaceEnable(t){t?this.AN.enable(this.AN.CULL_FACE):this.AN.disable(this.AN.CULL_FACE)}setBlendEnable(t){t?this.AN.enable(this.AN.BLEND):this.AN.disable(this.AN.BLEND)}setCullFaceMode(t){this.GR!=t&&(this.GR=t,t!=i.CullFaceMode.NONE?(this.GT&&(this.GT=!1,this.AN.enable(this.AN.CULL_FACE)),this.AN.cullFace(t)):this.GT||(this.GT=!0,this.AN.disable(this.AN.CULL_FACE)))}setBlendMode(t,e){this.GM!=t&&(this.GM=t,t>0?e[0]<1?(this.AN.blendEquation(this.AN.FUNC_ADD),this.AN.blendFunc(this.AN.ONE,this.AN.ZERO),this.AN.blendEquation(e[1]),this.AN.blendFunc(e[3],e[4])):(this.AN.blendEquationSeparate(e[1],e[2]),this.AN.blendFuncSeparate(e[3],e[4],e[5],e[6])):this.AN.disable(this.AN.BLEND))}setDepthTestMode(t){if(this.GS!=t)switch(this.GS=t,t){case i.DepthTestMode.ALWAYS:this.AN.depthMask(!1),this.AN.depthFunc(this.AN.ALWAYS);break;case i.DepthTestMode.SKY:this.AN.depthMask(!0),this.AN.depthFunc(this.AN.LEQUAL);break;case i.DepthTestMode.OPAQUE:this.AN.depthMask(!0),this.AN.depthFunc(this.AN.LESS);break;case i.DepthTestMode.OPAQUE_OVERHEAD:this.AN.depthMask(!1),this.AN.depthFunc(this.AN.EQUAL);break;case i.DepthTestMode.DECALS:this.AN.depthMask(!1),this.AN.depthFunc(this.AN.LEQUAL);break;case i.DepthTestMode.BLEND:this.AN.depthMask(!1),this.AN.depthFunc(this.AN.LESS);break;case i.DepthTestMode.WIRE_FRAME:this.AN.depthMask(!0),this.AN.depthFunc(this.AN.LEQUAL);break;case i.DepthTestMode.NEXT_LAYER:this.AN.depthMask(!1),this.AN.depthFunc(this.AN.ALWAYS);break;case i.DepthTestMode.TRUE_EQUAL:this.AN.depthMask(!0),this.AN.depthFunc(this.AN.EQUAL);break;case i.DepthTestMode.TRUE_GREATER:this.AN.depthMask(!0),this.AN.depthFunc(this.AN.GREATER);break;case i.DepthTestMode.TRUE_GEQUAL:this.AN.depthMask(!0),this.AN.depthFunc(this.AN.GEQUAL);break;case i.DepthTestMode.WIRE_FRAME_NEXT:break;default:break}}}e.RODrawState=n},"81c4":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("f48d")),h=i(s("d1a0"));class n extends a.default{constructor(){super(...arguments),this.radiusSquared=2500,this.tv=new r.default(1,0,0),this.center=new r.default(50,0,0),this.anotherPosition=new r.default(100,0,0),this.length=100}intersectionCopSLV2(t,e,s){r.default.Cross(this.tv,e,a.default.__tV1),r.default.Cross(this.tv,a.default.__tV1,a.default.__tV2),a.default.__tV2.normalize(),h.default.IntersectionSLV2(a.default.__tV2,a.default.__tV2.dot(this.position),t,e,s),a.default.__tV2.x=s.x-this.position.x,a.default.__tV2.y=s.y-this.position.y,a.default.__tV2.z=s.z-this.position.z;let i=a.default.__tV2.dot(this.tv);i<0?s.copyFrom(this.position):i>this.length&&s.copyFrom(this.anotherPosition)}update(){this.tv.x=this.anotherPosition.x-this.position.x,this.tv.y=this.anotherPosition.y-this.position.y,this.tv.z=this.anotherPosition.z-this.position.z,this.length=this.tv.getLength(),this.tv.x*=.5,this.tv.y*=.5,this.tv.z*=.5,this.center.x=this.position.x+this.tv.x,this.center.y=this.position.y+this.tv.y,this.center.z=this.position.z+this.tv.z,this.radiusSquared=this.tv.getLengthSquared(),this.tv.normalize()}updateFast(){this.update()}}e.default=n},"81ce":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static Es2VtxShderToES3(t){let e=t;const s="attribute",i="varying ";let r=e.indexOf(s),a=0;while(r>=0)e=e.slice(0,r)+"layout(location="+a+") in"+e.slice(r+9),r=e.indexOf(s),a++;let h=new RegExp(i,"g");return e=e.replace(h,"out "),"#version 300 es\n"+e}static Es2FragShderToES3(t){let e=t;const s="gl_FragColor",i="varying ";let r=e.indexOf(s),a=0,h="FragColorOut_"+a;r>=0&&(e=e.slice(0,r)+h+e.slice(r+12)),r=e.indexOf("void "),e=e.slice(0,r)+"out vec4 "+h+";\n"+e.slice(r);let n=new RegExp(i,"g");return e=e.replace(n,"in "),n=new RegExp(" texture2D","g"),e=e.replace(n," texture"),n=new RegExp(" textureCube","g"),e=e.replace(n," texture"),"#version 300 es\n"+e}static Es3VtxShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const s=/\blayout\b.+\bin\b/g;t=t.replace(s,"attribute");const r=/\bout\b/g;t=t.replace(r,"varying");const a=/\btexture\b/g;t=t.replace(a,"texture2D"),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version"));let h=0,n=0,l=t.indexOf("inverse(");l<0&&(l=t.indexOf("inverse ("));let _="",m=!1,o=!1;while(l>3){if(h=t.indexOf(")",l+2),_=t.slice(l+2,h),_.indexOf("mat3")>0)m=!0;else if(_=_.replace(/\s+/g,""),h=_.indexOf("("),_=_.slice(h+1),h=t.indexOf(_,1),n=t.lastIndexOf("mat",h),n>0)switch(_=t.slice(n,h),_=_.replace(/\s+/g,""),_){case"mat3":m=!0;break;case"mat4":o=!0;break}if(l=t.indexOf("inverse(",l+5),l<0&&(l=t.indexOf("inverse (",l+5)),m&&o)break}h=0,l=t.indexOf("transpose("),l<0&&(l=t.indexOf("transpose (")),_="";let u=!1,d=!1;while(l>3){if(h=t.indexOf(")",l+2),_=t.slice(l+2,h+1),_.indexOf("mat3")>0)u=!0;else if(_=_.replace(/\s+/g,""),h=_.indexOf("("),_=_.slice(h+1),h=t.indexOf(_,1),n=t.lastIndexOf("mat",h),n>0)switch(_=t.slice(n,h),_=_.replace(/\s+/g,""),_){case"mat3":u=!0;break;case"mat4":d=!0;break}if(l=t.indexOf("transpose(",l+5),l<0&&(l=t.indexOf("transpose (",l+5)),u&&d)break}return(m||o)&&(l=t.indexOf("void "),l>10&&(m&&o?t=t.slice(0,l)+i.__glslInverseMat3+i.__glslInverseMat4+t.slice(l):m?t=t.slice(0,l)+i.__glslInverseMat3+t.slice(l):o&&(t=t.slice(0,l)+i.__glslInverseMat4+t.slice(l)))),(u||d)&&(l=t.indexOf("void "),l>10&&(u&&d?t=t.slice(0,l)+i.__glslTransposeMat3+i.__glslTransposeMat4+t.slice(l):u?t=t.slice(0,l)+i.__glslTransposeMat3+t.slice(l):d&&(t=t.slice(0,l)+i.__glslTransposeMat4+t.slice(l)))),t}static Es3FragShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const s=new RegExp(" in ","g");t=t.replace(s,"_fref_");const i=/\bin\b/g;t=t.replace(i,"varying");const r=new RegExp("_fref_","g");t=t.replace(r," in ");const a=/\btexture\b/g;t=t.replace(a,"texture2D");const h=/" "/g;let n=t;const l=";",_="layout";let m=n.indexOf(_),o=0,u=0,d="",c="",f=0,p=null,g=[],T=[];while(m>=0)o=n.indexOf(l,m+1),d=n.slice(m+1,o),c=d.slice(d.lastIndexOf(" ")+1),f=d.indexOf(")"),m=d.lastIndexOf("=",f)+1,d=d.slice(m+1,f),f=parseInt(d.replace(h,"")),g.push(c),T.push(f),m=n.indexOf(_,o);let v=g.length;if(v>0)if(p=/layout/g,t=t.replace(p,"//layout"),v>1){m=0;while(m<v)p=new RegExp(g[m],"g"),t=t.replace(p,"gl_FragData["+T[m]+"]"),++m}else p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor");else m=n.indexOf("out "),m>0&&(o=n.indexOf(l,m+1),d=n.slice(m+1,o),c=d.slice(d.lastIndexOf(" ")+1),p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor"),p=/\bout\b/g,t=t.replace(p,"//out"));v>1&&(t="#extension GL_EXT_draw_buffers: require\n"+t),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version")),m=0;for(let x=0;x<16;++x){if(m=t.indexOf("samplerCube ",m),!(m>0))break;{o=t.indexOf(";",m),d=n.slice(m+12,o),c="";let e=d.split(" ");for(let t=0;t<16;++t)if(""!=e[t]){c=e[t];break}for(v=0;v<16;++v){if(o=t.indexOf(c,o+1),!(o>0))break;if(u=t.lastIndexOf("texture2D",o-1),u<0)break;d=t.slice(u,o),t=t.slice(0,u)+"textureCube("+t.slice(o),o+=2}}m+=4}return t}}i.__glslTransposeMat3="\n    mat3 transpose(mat3 m) {\n        return mat3(m[0][0],m[1][0],m[2][0],\n            m[0][1],m[1][1],m[2][1],\n            m[0][2],m[1][2],m[2][2]);\n    }\n    ",i.__glslTransposeMat4="\n    mat4 transpose(mat4 m) {\n        return mat4(m[0][0],m[1][0],m[2][0],m[3][0],\n            m[0][1],m[1][1],m[2][1],m[3][1],\n            m[0][2],m[1][2],m[2][2],m[3][2],\n            m[0][3],m[1][3],m[2][3],m[3][3]);\n    }\n    ",i.__glslInverseMat3="\n    mat3 inverse(mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];  \n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;  \n        float det = a00 * b01 + a01 * b11 + a02 * b21;  \n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n    ",i.__glslInverseMat4="\n    mat4 inverse(mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n        }\n    ",e.default=i},8333:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.COLOR_BUFFER_BIT=131,i.DEPTH_BUFFER_BIT=132,i.STENCIL_BUFFER_BIT=133,e.default=i},"83d1":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279"));class h{create(t,e){let s=null,i=r.default.StageParam;return e.hasUniformByName(i.name)&&(s=new a.default,s.uns=i.name,s.uniformNameList=[i.name],s.copyDataFromProbe(t.getStage3D().uProbe)),s}getIDNS(){return"StageParamUniformBuilder"}}e.default=h},"857b":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279"));class h{create(t,e){let s=null,i=r.default.CameraPosParam;return e.hasUniformByName(i.name)&&(s=new a.default,s.uns=i.name,s.uniformNameList=[i.name],s.copyDataFromProbe(t.getCamera().ucameraPosProbe)),s}getIDNS(){return"CameraPosUniformBuilder"}}e.default=h},"85b6":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class h extends a.default{constructor(t,e,s=!1){super(t,e,s),this.GV=null,this.AD=r.TextureProxyType.Wrapper}getResUid(){return this.GV.getResUid()}getBufWidth(){return this.GV.getBufWidth()}getBufHeight(){return this.GV.getBufHeight()}getWidth(){return this.GV.getWidth()}getHeight(){return this.GV.getHeight()}isDirect(){return!1}attachTex(t){null!=t&&t!=this&&(this.GV!=t&&t.__$attachThis(),this.GV=t)}detachTex(){null!=this.GV&&this.GV.__$detachThis(),this.GV=null}__$attachThis(){super.__$attachThis(),null!=this.GV&&this.GV.__$attachThis()}__$detachThis(){super.__$detachThis(),null!=this.GV&&this.GV.__$detachThis()}__$$use(t){this.GV.__$$use(t)}isGpuEnabled(){return this.GV.isGpuEnabled()}getSampler(){return this.GV.getSampler()}__$updateToGpu(t){this.GV.__$updateToGpu(t)}__$$upload(t){this.GV.__$$upload(t)}__$destroy(){this.getAttachCount()<1&&(null!=this.GV&&this.GV.__$detachThis(),this.GV=null,super.__$destroy())}isDataEnough(){return this.GV.isDataEnough()}getTargetType(){return this.GV.getTargetType()}toString(){return"[WrapperTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=h},8875:function(t,e,s){var i,r,a;(function(s,h){r=[],i=h,a="function"===typeof i?i.apply(e,r):i,void 0===a||(t.exports=a)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(d){var s,i,r,a=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,h=/@([^@]*):(\d+):(\d+)\s*$/gi,n=a.exec(d.stack)||h.exec(d.stack),l=n&&n[1]||!1,_=n&&n[2]||!1,m=document.location.href.replace(document.location.hash,""),o=document.getElementsByTagName("script");l===m&&(s=document.documentElement.outerHTML,i=new RegExp("(?:[^\\n]+?\\n){0,"+(_-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=s.replace(i,"$1").trim());for(var u=0;u<o.length;u++){if("interactive"===o[u].readyState)return o[u];if(o[u].src===l)return o[u];if(l===m&&o[u].innerHTML&&o[u].innerHTML.trim()===r)return o[u]}return null}}return t}))},"8a0a":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ca6c"));class a{static ToGL(t,e){switch(e){case a.VTX_STATIC_DRAW:return t.STATIC_DRAW;case a.VTX_DYNAMIC_DRAW:return t.DYNAMIC_DRAW;case a.VTX_STREAM_DRAW:return t.STREAM_DRAW;case a.VTX_STATIC_READ:return t.STATIC_READ;case a.VTX_DYNAMIC_READ:return t.DYNAMIC_READ;case a.VTX_STREAM_READ:return t.STREAM_READ;case a.VTX_STATIC_COPY:return t.STATIC_COPY;case a.VTX_DYNAMIC_COPY:return t.DYNAMIC_COPY;case a.VTX_STREAM_COPY:return t.STREAM_COPY;default:break}return t.STATIC_DRAW}static GetVBufTypeByNS(t){switch(t){case a.VBUF_VS_NS:return a.VBUF_VS;case a.VBUF_UVS_NS:return a.VBUF_UVS;case a.VBUF_NVS_NS:return a.VBUF_NVS;case a.VBUF_CVS_NS:return a.VBUF_CVS;case a.VBUF_VS2_NS:return a.VBUF_VS2;case a.VBUF_UVS2_NS:return a.VBUF_UVS2;case a.VBUF_NVS2_NS:return a.VBUF_NVS2;case a.VBUF_CVS2_NS:return a.VBUF_CVS2;case a.VBUF_TVS_NS:return a.VBUF_TVS;case a.VBUF_TVS2_NS:return a.VBUF_TVS2;default:}return-1}static GetVBufNSByType(t){switch(t){case a.VBUF_VS:return a.VBUF_VS_NS;case a.VBUF_UVS:return a.VBUF_UVS_NS;case a.VBUF_NVS:return a.VBUF_NVS_NS;case a.VBUF_CVS:return a.VBUF_CVS_NS;case a.VBUF_VS2:return a.VBUF_VS2_NS;case a.VBUF_UVS2:return a.VBUF_UVS2_NS;case a.VBUF_NVS2:return a.VBUF_NVS2_NS;case a.VBUF_CVS2:return a.VBUF_CVS2_NS;case a.VBUF_TVS:return a.VBUF_TVS_NS;case a.VBUF_TVS2:return a.VBUF_TVS2_NS;default:}return""}static GetVBufAttributeTypeByNS(t){return a.GetVBufTypeByNS(t)-3e3}}a.VTXTYPE_GL_POINTS=101,a.VTXTYPE_GL_LINES=102,a.VTXTYPE_GL_LINE_STRIP=103,a.VTXTYPE_GL_TRIANGLES=111,a.VTX_STATIC_DRAW=0,a.VTX_DYNAMIC_DRAW=1,a.VTX_STREAM_DRAW=2,a.VTX_STATIC_READ=3,a.VTX_DYNAMIC_READ=4,a.VTX_STREAM_READ=5,a.VTX_STATIC_COPY=6,a.VTX_DYNAMIC_COPY=7,a.VTX_STREAM_COPY=8,a.VBUF_VS=3001,a.VBUF_UVS=3002,a.VBUF_NVS=3003,a.VBUF_CVS=3004,a.VBUF_TVS=3005,a.VBUF_VS2=3006,a.VBUF_UVS2=3007,a.VBUF_NVS2=3008,a.VBUF_CVS2=3009,a.VBUF_TVS2=3010,a.VBUF_VS_INDEX=r.default.BIT_ONE_0,a.VBUF_UVS_INDEX=r.default.BIT_ONE_1,a.VBUF_NVS_INDEX=r.default.BIT_ONE_2,a.VBUF_CVS_INDEX=r.default.BIT_ONE_3,a.VBUF_TVS_INDEX=r.default.BIT_ONE_4,a.VBUF_VS2_INDEX=r.default.BIT_ONE_5,a.VBUF_UVS2_INDEX=r.default.BIT_ONE_6,a.VBUF_NVS2_INDEX=r.default.BIT_ONE_7,a.VBUF_CVS2_INDEX=r.default.BIT_ONE_8,a.VBUF_TVS2_INDEX=r.default.BIT_ONE_9,a.VBUF_VS_NS="a_vs",a.VBUF_VS2_NS="a_vs2",a.VBUF_UVS_NS="a_uvs",a.VBUF_UVS2_NS="a_uvs2",a.VBUF_NVS_NS="a_nvs",a.VBUF_NVS2_NS="a_nvs2",a.VBUF_CVS_NS="a_cvs",a.VBUF_CVS2_NS="a_cvs2",a.VBUF_TVS_NS="a_tvs",a.VBUF_TVS2_NS="a_tvs2";class h{}h.FLAT=210,h.GOURAND=310,e.VtxNormalType=h,e.default=a},"8d98":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("030e"));class h{static ToGL(t,e){switch(e){case h.RGBA:break;case h.R8:return t.R8;case h.RGB:return t.RGB;case h.RGB8:return t.RGB8;case h.RGBA8:return t.RGBA8;case h.ALPHA:return t.ALPHA;case h.RGB16F:return r.default.IsWebGL2()?t.RGB16F:t.RGB;case h.RGBA16F:return r.default.IsWebGL2()?t.RGBA16F:t.RGBA;case h.RGB32F:return r.default.IsWebGL2()&&t.RGB32F,t.RGB;case h.RGBA32F:return r.default.IsWebGL2()&&t.RGBA32F,t.RGBA;case h.RED:return t.RED;case h.DEPTH_COMPONENT:return t.DEPTH_COMPONENT;case h.DEPTH_STENCIL:return t.DEPTH_STENCIL;default:break}return t.RGBA}}h.R8=101,h.RGB=110,h.RED=111,h.RGBA=121,h.RGB8=122,h.RGBA8=123,h.ALPHA=132,h.RGB16F=331,h.RGBA16F=332,h.RGB32F=341,h.RGBA32F=342,h.DEPTH_COMPONENT=351,h.DEPTH_STENCIL=352,e.TextureFormat=h;class n{static ToGL(t,e){switch(e){case n.UNSIGNED_BYTE:return t.UNSIGNED_BYTE;case n.BYTE:return t.BYTE;case n.FLOAT:return t.FLOAT;case n.HALF_FLOAT:return t.HALF_FLOAT;case n.HALF_FLOAT_OES:return null!=a.default.OES_texture_half_float?a.default.OES_texture_half_float.HALF_FLOAT_OES:t.FLOAT;case n.UNSIGNED_SHORT:return t.UNSIGNED_SHORT;case n.UNSIGNED_INT:return t.UNSIGNED_INT;case n.UNSIGNED_SHORT_5_6_5:return t.UNSIGNED_SHORT_5_6_5;case n.UNSIGNED_SHORT_4_4_4_4:return t.UNSIGNED_SHORT_4_4_4_4;case n.UNSIGNED_SHORT_5_5_5_1:return t.UNSIGNED_SHORT_5_5_5_1;case n.UNSIGNED_INT_24_8_WEBGL:return a.default.WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL;default:break}return t.UNSIGNED_BYTE}}n.UNSIGNED_BYTE=1108,n.UNSIGNED_SHORT=1109,n.UNSIGNED_INT=1110,n.BYTE=1111,n.FLOAT=1211,n.HALF_FLOAT=1212,n.HALF_FLOAT_OES=1213,n.UNSIGNED_SHORT_5_6_5=1214,n.UNSIGNED_SHORT_4_4_4_4=1215,n.UNSIGNED_SHORT_5_5_5_1=1216,n.UNSIGNED_INT_24_8_WEBGL=1217,e.TextureDataType=n;class l{static GetValue(t,e){switch(e){case l.TEXTURE_2D:return t.TEXTURE_2D;case l.TEXTURE_2D_ARRAY:return t.TEXTURE_2D_ARRAY;case l.TEXTURE_CUBE:return t.TEXTURE_CUBE_MAP;case l.TEXTURE_3D:return t.TEXTURE_3D;default:break}return t.TEXTURE_2D}}l.TEXTURE_2D=20,l.TEXTURE_2D_ARRAY=22,l.TEXTURE_SHADOW_2D=23,l.TEXTURE_CUBE=25,l.TEXTURE_3D=30,e.TextureTarget=l,function(t){t[t["Default"]=0]="Default",t[t["Depth"]=1]="Depth",t[t["Wrapper"]=2]="Wrapper",t[t["RTT"]=3]="RTT",t[t["Image"]=4]="Image",t[t["Float"]=5]="Float",t[t["Uint16"]=6]="Uint16",t[t["FloatCube"]=7]="FloatCube",t[t["Bytes"]=8]="Bytes",t[t["BytesCube"]=9]="BytesCube",t[t["ImageCube"]=10]="ImageCube",t[t["Texture3D"]=11]="Texture3D"}(e.TextureProxyType||(e.TextureProxyType={}));class _{static GetConst(t,e){switch(e){case _.NEAREST:return t.NEAREST;case _.LINEAR:return t.LINEAR;case _.LINEAR_MIPMAP_LINEAR:return t.LINEAR_MIPMAP_LINEAR;case _.NEAREST_MIPMAP_NEAREST:return t.NEAREST_MIPMAP_NEAREST;case _.LINEAR_MIPMAP_NEAREST:return t.LINEAR_MIPMAP_NEAREST;case _.NEAREST_MIPMAP_LINEAR:return t.NEAREST_MIPMAP_LINEAR;case _.WRAP_REPEAT:return t.REPEAT;case _.WRAP_CLAMP_TO_EDGE:return t.CLAMP_TO_EDGE;case _.WRAP_MIRRORED_REPEAT:return t.MIRRORED_REPEAT;default:break}return-1}}_.WRAP_REPEAT=3001,_.WRAP_CLAMP_TO_EDGE=3002,_.WRAP_MIRRORED_REPEAT=3003,_.NEAREST=4001,_.LINEAR=4002,_.LINEAR_MIPMAP_LINEAR=4003,_.NEAREST_MIPMAP_NEAREST=4004,_.LINEAR_MIPMAP_NEAREST=4005,_.NEAREST_MIPMAP_LINEAR=4006,e.TextureConst=_},"8dce":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("faa5")),a=i(s("b3bd")),h=i(s("0fc4")),n=s("5216"),l=s("7934");class _ extends r.default{constructor(){super(),this.DF="",this.Er=null,this.Es="",this.fogEnabled=!0}initialize(t){super.initialize(t),this.DF="TerrainpShd",t&&(this.DF+="Tex"),this.fogEnabled&&(this.DF+="Fog"),null!=this.pipeline&&(this.Er=[],this.fogEnabled&&this.Er.push(n.MaterialPipeType.FOG_EXP2),this.pipeline.createKeys(this.Er),this.Es=this.pipeline.getKeysString(),this.pipeline.buildSharedUniforms(this.Er))}buildThisCode(){this.DG.addVertLayout("vec3","a_vs"),this.DG.addVertLayout("vec3","a_nvs"),this.isTexEanbled()&&(this.DG.addVertLayout("vec2","a_uvs"),this.DG.addVarying("vec4","v_wpos"),this.DG.addVarying("vec2","v_uv"),this.DG.addVarying("vec4","v_param"),this.DG.addTextureSample2D(),this.DG.addTextureSample2D(),this.DG.addTextureSample2D("VOX_DISPLACEMENT_MAP",!0,!0,!0)),this.DG.addFragOutputHighp("vec4","FragColor0"),this.DG.addFragUniform("vec4","u_color"),this.DG.addVertUniform("vec4","u_displacement"),this.DG.addShaderObject(l.TerrainShaderCode),null!=this.pipeline&&this.pipeline.build(this.DG,this.Er)}getFragShaderCode(){return this.buildThisCode(),r.default.Lg.buildFragCode()}getVtxShaderCode(){return r.default.Lg.buildVertCode()}getUniqueShaderName(){return this.DF}toString(){return"[TerrainpShaderBuffer()]"}static GetInstance(){return _.Ku}}_.Ku=new _;class m extends h.default{constructor(){super(),this.fogEnabled=!0,this.DI=new Float32Array([1,1,1,1]),this.GW=new Float32Array([50,1,0,0]),this.Av=new a.default,this.Av.uniformNameList=["u_color","u_displacement"],this.Av.dataList=[this.DI,this.GW]}getCodeBuf(){let t=_.GetInstance();return t.fogEnabled=this.fogEnabled,t}setRGB3f(t,e,s){this.DI[0]=t,this.DI[1]=e,this.DI[2]=s}setRGBA4f(t,e,s,i){this.DI[0]=t,this.DI[1]=e,this.DI[2]=s,this.DI[3]=i}setAlpha(t){this.DI[3]=t}setDisplacementParams(t,e){this.GW[0]=t,this.GW[1]=e}}e.default=m},"8def":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("919c"));class a extends r.default{constructor(){super(),this.shdp=null,this.vbufs=null,this.vbuf=null,this.attribTypes=null,this.wholeOffsetList=null,this.attribTypesLen=0,this.updateUnlocked=!0,this.wholeStride=0,this.r=a.Kh++}run(){this.Be.testVROUid(this.r)&&(null!=this.vbuf?this.Be.useVtxAttribsPtrTypeFloat(this.shdp,this.vbuf,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride):this.Be.useVtxAttribsPtrTypeFloatMulti(this.shdp,this.vbufs,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride),this.Be.testRIOUid(this.FH)&&this.Be.bindEleBuf(this.ibuf))}__$destroy(){r.default.Lh.delete(this.GX),this.GX=0,this.FH=-1,this.Be=null,this.shdp=null,this.vbufs=null,this.vbuf=null,this.ibuf=null,this.attribTypes=null,this.attribTypesLen=0,this.wholeStride=0}restoreThis(){a.Restore(this)}toString(){return"VertexRenderObj(uid = "+this.r+", type="+this.GX+")"}static HasMid(t){return r.default.Lh.has(t)}static GetByMid(t){return r.default.Lh.get(t)}static GetFreeId(){return a.Li.length>0?a.Li.pop():-1}static Create(t,e,s){let i=null,h=a.GetFreeId();return h>=0?(i=a.Lj[h],a.Lk[h]=a.S_FLAG_BUSY,i.setMidAndBufUid(e,s)):(i=new a,i.setMidAndBufUid(e,s),a.Lj.push(i),a.Lk.push(a.S_FLAG_BUSY),a.Ll++),i.setRC(t),r.default.Lh.set(e,i),i}static Restore(t){if(null!=t&&t.s<1&&a.Lk[t.getUid()]==a.S_FLAG_BUSY){let e=t.getUid();a.Li.push(e),a.Lk[e]=a.S_FLAG_FREE,t.__$destroy()}}}a.Kh=0,a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.Lk=[],a.Ll=0,a.Lj=[],a.Li=[],e.default=a},"8e17":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{constructor(t=0,e=0,s=0,i=1){this.x=0,this.y=0,this.z=0,this.w=0,this.x=t,this.y=e,this.z=s,this.w=i}clone(){return new a(this.x,this.y,this.z,this.w)}setTo(t,e,s,i=1){this.x=t,this.y=e,this.z=s,this.w=i}setXYZ(t,e,s){this.x=t,this.y=e,this.z=s}copyFrom(t){this.x=t.x,this.y=t.y,this.z=t.z}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}multBy(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);t>r.default.MATH_MIN_POSITIVE&&(this.x/=t,this.y/=t,this.z/=t)}normalizeTo(t){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);e>r.default.MATH_MIN_POSITIVE?(t.x=this.x/e,t.y=this.y/e,t.z=this.z/e):(t.x=this.x,t.y=this.y,t.z=this.z)}scaleVector(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}scaleBy(t){this.x*=t,this.y*=t,this.z*=t}negate(){this.x=-this.x,this.y=-this.y,this.z=-this.z}equalsXYZ(t){return Math.abs(this.x-t.x)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.y-t.y)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.z-t.z)<r.default.MATH_MIN_POSITIVE}equalsAll(t){return Math.abs(this.x-t.x)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.y-t.y)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.z-t.z)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.w-t.w)<r.default.MATH_MIN_POSITIVE}project(){let t=1/this.w;this.x*=t,this.y*=t,this.z*=t}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getLengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}addBy(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}subtractBy(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}subtract(t){return new a(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new a(this.x+t.x,this.y+t.y,this.z+t.z)}crossProduct(t){return new a(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}crossBy(t){let e=this.y*t.z-this.z*t.y,s=this.z*t.x-this.x*t.z,i=this.x*t.y-this.y*t.x;this.x=e,this.y=s,this.z=i}reflectBy(t){let e=2*(this.x*t.x+this.y*t.y+this.z*t.z);this.x=this.x-e*t.x,this.y=this.y-e*t.y,this.z=this.z-e*t.z}scaleVecTo(t,e){this.x=t.x*e,this.y=t.y*e,this.z=t.z*e}subVecsTo(t,e){this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z}addVecsTo(t,e){this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z}crossVecsTo(t,e){this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x}toString(){return"Vector3D("+this.x+this.y+this.z+")"}static Cross(t,e,s){s.x=t.y*e.z-t.z*e.y,s.y=t.z*e.x-t.x*e.z,s.z=t.x*e.y-t.y*e.x}static CrossSubtract(t,e,s,i,r){a.__vtor3Stv0.x=e.x-t.x,a.__vtor3Stv0.y=e.y-t.y,a.__vtor3Stv0.z=e.z-t.z,a.__vtor3Stv1.x=i.x-s.x,a.__vtor3Stv1.y=i.y-s.y,a.__vtor3Stv1.z=i.z-s.z,t=a.__vtor3Stv0,s=a.__vtor3Stv1,r.x=t.y*s.z-t.z*s.y,r.y=t.z*s.x-t.x*s.z,r.z=t.x*s.y-t.y*s.x}static Subtract(t,e,s){s.x=t.x-e.x,s.y=t.y-e.y,s.z=t.z-e.z}static DistanceSquared(t,e){return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,a.__vtor3Stv0.getLengthSquared()}static DistanceXYZ(t,e,s,i,r,h){return a.__vtor3Stv0.x=t-i,a.__vtor3Stv0.y=e-r,a.__vtor3Stv0.z=s-h,a.__vtor3Stv0.getLength()}static Distance(t,e){return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,a.__vtor3Stv0.getLength()}static AngleBetween(t,e){return t.normalizeTo(a.__vtor3Stv0),e.normalizeTo(a.__vtor3Stv1),Math.acos(a.__vtor3Stv0.dot(a.__vtor3Stv1))*r.default.MATH_180_OVER_PI}static RadianBetween(t,e){return t.normalizeTo(a.__vtor3Stv0),e.normalizeTo(a.__vtor3Stv1),Math.acos(a.__vtor3Stv0.dot(a.__vtor3Stv1))}static RadianBetween2(t,e){let s=t.getLengthSquared(),i=e.getLengthSquared();return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,Math.acos((s+i-a.__vtor3Stv0.getLengthSquared())/(2*Math.sqrt(s)*Math.sqrt(i)))}static Reflect(t,e,s){let i=2*(t.x*e.x+t.y*e.y+t.z*e.z);s.x=t.x-i*e.x,s.y=t.y-i*e.y,s.z=t.z-i*e.z}}a.X_AXIS=new a(1,0,0),a.Y_AXIS=new a(0,1,0),a.Z_AXIS=new a(0,0,1),a.__vtor3Stv0=new a,a.__vtor3Stv1=new a,a.ZERO=new a,e.default=a},9156:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static SetTransUniform(t,e){i.Lm.set(t.getUid(),e)}static GetTransUniform(t){if(t.getUid()<0)throw Error("mat.getUid() < 0");return i.Lm.has(t.getUid())?i.Lm.get(t.getUid()):null}static HasTransUniform(t){return i.Lm.has(t.getUid())}static RemoveTransUniform(t){i.Lm.delete(t.getUid())}}i.Lm=new Map,e.default=i},"919c":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.r=0,this.GX=0,this.FH=0,this.Be=null,this.ibuf=null,this.ibufStep=2,this.s=0}setRC(t){this.Be=t}setMidAndBufUid(t,e){this.GX=t,this.FH=e,this.s=0}getUid(){return this.r}getVtxUid(){return this.FH}getMid(){return this.GX}run(){}__$attachThis(){++this.s}__$detachThis(){--this.s,this.s<1&&(this.s=0)}__$destroy(){i.Lh.delete(this.GX),this.GX=0,this.FH=-1,this.ibuf=null,this.Be=null}restoreThis(){}static HasMid(t){return i.Lh.has(t)}static GetByMid(t){return i.Lh.get(t)}}i.Lh=new Map,e.default=i},"91e2":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("29ef")),h=i(s("402a")),n=i(s("f63e")),l=s("8a0a"),_=i(s("3bfb"));class m extends h.default{constructor(t=null){super(t),this.GY=l.VtxNormalType.FLAT,this.GZ=null,this.Ga=null,this.d=null,this.e=null,this.uScale=1,this.vScale=1,this.normalScale=1,this.uvPartsNumber=0,this.wireframe=!1}setVtxTransformMatrix(t){this.d=t}useFlatNormal(){this.GY=l.VtxNormalType.FLAT}useGourandNormal(){this.GY=l.VtxNormalType.GOURAND}createMaterial(t){if(null==this.getMaterial()){let e=new n.default;e.setTextureList(t),this.setMaterial(e)}else null!=t&&this.getMaterial().getTextureTotal()<1&&this.getMaterial().setTextureList(t)}showBackFace(){this.setRenderState(a.default.BACK_CULLFACE_NORMAL_STATE)}showFrontFace(){this.setRenderState(a.default.FRONT_CULLFACE_NORMAL_STATE)}showAllFace(){this.setRenderState(a.default.NONE_CULLFACE_NORMAL_STATE)}scaleUVFaceAt(t,e,s,i,r){let a=this.getMesh();null!=a&&a.scaleUVFaceAt(t,e,s,i,r)}scaleUVSFaceAt(t,e){let s=this.getMesh();null!=s&&s.setFaceUVSAt(t,e)}reinitializeMesh(){null!=this.e&&this.e.reinitialize()}initialize(t,e,s=null){this.GZ=t,this.Ga=e,this.createMaterial(s),this.activeDisplay()}initializeCube(t,e=null){t*=.5,this.GZ=new r.default(-t,-t,-t),this.Ga=new r.default(t,t,t),this.createMaterial(e),this.activeDisplay()}initializeSizeXYZ(t,e,s,i=null){this.GZ=new r.default(.5*-t,.5*-e,.5*-s),this.Ga=new r.default(.5*t,.5*e,.5*s),this.createMaterial(i),this.activeDisplay()}__activeMesh(t){if(this.e=this.getMesh(),null==this.e&&(this.e=new _.default),null!=this.e){let e=this.e;null!=this.d&&e.setTransformMatrix(this.d),e.uScale=this.uScale,e.vScale=this.vScale,e.wireframe=this.wireframe,e.normalType=this.GY,e.normalScale=this.normalScale,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.uvPartsNumber=this.uvPartsNumber,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.GZ,this.Ga),this.GZ=null,this.Ga=null,this.setMesh(e),e.setTransformMatrix(null)}this.d=null}updateMesh(){this.e=this.getMesh()}setFaceUVSAt(t,e,s=0){null!=this.e&&this.e.setFaceUVSAt(t,e,s)}transformFaceAt(t,e){null!=this.e&&this.e.transformFaceAt(t,e)}getFaceCenterAt(t,e){null!=this.e&&this.e.getFaceCenterAt(t,e)}toString(){return"[Box3DEntity(uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=m},9260:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("7045"));class a{static KeyDown(t){for(var e=a.Gb.length,s=0;s<e;++s)a.Gb[s].call(a.Gd[s],t)}static KeyUp(t){let e=a.Gc.length;for(let s=0;s<e;++s)a.Gc[s].call(a.Ge[s],t)}static RemoveEventListener(t,e){if(null!=e){let s;switch(t){case r.default.KEY_DOWN:for(s=a.Gb.length-1;s>=0;--s)if(e===a.Gb[s]){a.Gd.splice(s,1),a.Gb.splice(s,1);break}break;case r.default.KEY_UP:for(s=a.Gc.length-1;s>=0;--s)if(e===a.Gc[s]){a.Ge.splice(s,1),a.Gc.splice(s,1);break}break;default:break}}}}a.Gd=[],a.Gb=[],a.Ge=[],a.Gc=[],a.AddEventListener=function(t,e,s){if(null!=s){let i=0;switch(t){case r.default.KEY_DOWN:for(i=a.Gb.length-1;i>=0;--i)if(s===a.Gb[i])break;i<0&&(a.Gd.push(e),a.Gb.push(s));break;case r.default.KEY_UP:for(i=a.Gc.length-1;i>=0;--i)if(s===a.Gc[i])break;i<0&&(a.Ge.push(e),a.Gc.push(s));break;default:break}}},e.default=a},"955e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),h=i(s("fecb")),n=i(s("c120")),l=s("e08e"),_=i(s("29ef")),m=i(s("3930")),o=i(s("e7ce"));class u{constructor(){this.Gf=new m.default,this.Gg=new o.default,this.EL=null,this.Y=null,this.Gh=null,this.Gi=null,this.Gj=new Uint8Array(256),this.Gk=null,this.Gl=null,this.Gm=0,this.Gn=0,this.Go=new a.default,this.Gp=new a.default,this.EC=null,this.ED=null,this.Gq=new Uint8Array(4),this.Gr=new a.default,this.Gs=new a.default,this.Gt=[null,null],this.Gu=!0,this.Gv=new Uint8Array(4),this.Gw=new Uint8Array(256)}setRenderer(t){this.EL=t}setRayTestMode(t){this.Gn=t}setRay(t,e){this.EC=t,this.ED=e}getRay(t,e){t.copyFrom(this.EC),e.copyFrom(this.ED)}setCamera(t){this.Y=t}setCullingNodeHead(t){if(this.Gh=t,null==this.Gk){this.Gk=[];let t=0;for(;t<256;++t)this.Gk.push(new n.default)}}getSelectedNode(){return this.Gl}getSelectedNodes(){return this.Gk}getSelectedNodesTotal(){return this.Gm}sorting(t,e){let s=this.Gk;this.Gi=s[t];while(t<e){while(t<e&&s[e].dis>=this.Gi.dis)--e;s[t]=s[e];while(t<e&&s[t].dis<=this.Gi.dis)++t;s[e]=s[t]}return s[t]=this.Gi,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}run(){let t=this.Gh;if(null!=t){let e=0,s=this.ED,i=this.EC,a=this.Gs,n=null,l=0;Math.abs(s.x)>r.default.MATH_MIN_POSITIVE?this.Gr.x=1/s.x:this.Gr.x=r.default.MATH_MAX_POSITIVE,Math.abs(s.y)>r.default.MATH_MIN_POSITIVE?this.Gr.y=1/s.y:this.Gr.y=r.default.MATH_MAX_POSITIVE,Math.abs(s.z)>r.default.MATH_MIN_POSITIVE?this.Gr.z=1/s.z:this.Gr.z=r.default.MATH_MAX_POSITIVE,this.Gr.x<0?this.Gq[0]=1:this.Gq[0]=0,this.Gr.y<0?this.Gq[1]=1:this.Gq[1]=0,this.Gr.z<0?this.Gq[2]=1:this.Gq[2]=0;while(null!=t)t.drawEnabled&&t.entity.mouseEnabled&&(a.x=t.bounds.center.x-i.x,a.y=t.bounds.center.y-i.y,a.z=t.bounds.center.z-i.z,e=a.dot(s),a.x-=e*s.x,a.y-=e*s.y,a.z-=e*s.z,a.getLengthSquared()<=t.bounds.radius2&&t.rayTestState<1&&(this.Gt[0]=t.bounds.min,this.Gt[1]=t.bounds.max,h.default.IntersectionRL3(this.Gt,this.Gq,this.Gr,s,i,a)&&(n=this.Gk[l],n.entity=t.entity,n.dis=this.Gr.w,n.wpv.copyFrom(a),++l))),t=t.next;this.Gl=null;let _=0;if(l>0){let t=this.Go,e=this.Gp,r=null,h=0,n=0,m=null,o=null,u=s.dot(i),d=0,c=!this.Gu,f=0;if(l>1){for(this.snsort(0,l-1),_=0;_<l;++_){if(o=this.Gk[_],r=this.Gk[_].entity,r.isPolyhedral()?c?(m=r.getInvMatrix(),m.transformOutVector3(i,t),m.deltaTransformOutVector(s,e),e.normalize(),h=r.testRay(t,e,a,!0)):(++f,h=0):(m=r.getInvMatrix(),m.transformOutVector3(i,t),m.deltaTransformOutVector(s,e),e.normalize(),h=r.testRay(t,e,a,!0)),h>0){if(o.lpv.copyFrom(a),r.getMatrix().transformOutVector3(a,o.wpv),o.dis=s.dot(o.wpv)-u,this.Gj[n]=_,++n,o.dis>d){this.Gl=o;break}}else if(h<0&&(this.Gj[n]=_,++n,o.dis>d)){this.Gl=o;break}d=o.dis}null==this.Gl&&n>0&&(this.Gl=this.Gk[this.Gj[0]])}else o=this.Gk[0],r=this.Gk[0].entity,m=r.getInvMatrix(),m.transformOutVector3(i,t),m.deltaTransformOutVector(s,e),e.normalize(),r.isPolyhedral()?c?h=r.testRay(t,e,a,!0):(++f,h=0):h=r.testRay(t,e,a,!0),h>0?(o.lpv.copyFrom(a),r.getMatrix().transformOutVector3(a,o.wpv),o.dis=s.dot(o.wpv)-u,this.Gl=o):h<0&&(this.Gl=o);f>0&&(this.Gn<1||null==this.Gl||this.Gl.entity.isPolyhedral())&&this.gpuPick(l)}for(_=l;_<this.Gm;++_)this.Gl!=this.Gk[_]&&(this.Gk[_].entity=null);this.Gm=l}}gpuPick(t){let e=this.EL.getRendererContext(),s=this.EL.getRenderProxy(),i=s.getStage3D().mouseX,r=s.getStage3D().mouseY;e.vertexRenderBegin(),e.getClearRGBAColor4f(this.Gf),e.setClearRGBAColor4f(0,0,0,0),e.setScissorEnabled(!0),e.setScissorRect(i,r,1,1),e.clearBackBuffer(),this.Gv[3]=0,_.default.LockBlendMode(l.RenderBlendMode.OPAQUE),_.default.LockDepthTestMode(l.DepthTestMode.OPAQUE),e.unlockMaterial(),e.unlockRenderState(),e.useGlobalMaterial(this.Gg,!1);let a=null,h=null,n=-1,m=0;for(;m<t;++m)a=this.Gk[m],h=this.Gk[m].entity,h.isPolyhedral()&&(++n,this.Gg.setIndex(n+2),this.Gw[n]=m,this.EL.updateMaterialUniformToCurrentShd(this.Gg),this.EL.drawEntity(h,!1,!0));if(n>-1&&s.readPixels(i,r,1,1,s.RGBA,s.UNSIGNED_BYTE,this.Gv),_.default.UnlockBlendMode(),_.default.UnlockDepthTestMode(),this.Gv[3]>1){m=this.Gw[this.Gv[3]-2],a=this.Gk[m];let t=(this.Gv[0]<<8)+this.Gv[1]+this.Gv[2]/255;if(null!=this.Gl){let e=this.Gl.entity;this.Gl==a||e.isPolyhedral()||this.Gl.dis<t&&(m=-1)}m>-1&&(a.dis=t,this.getWorldPosByRayDistance(t,this.ED,this.Y.getPosition(),a.wpv),this.Gl=a)}e.setScissorEnabled(!1),e.unlockMaterial(),e.unlockRenderState(),_.default.UnlockBlendMode(),_.default.UnlockDepthTestMode(),e.setClearRGBAColor4f(this.Gf.r,this.Gf.g,this.Gf.b,this.Gf.a),e.resetState()}clear(){this.Gl=null}getWorldPosByRayDistance(t,e,s,i){i.x=e.x*t+s.x,i.y=e.y*t+s.y,i.z=e.z*t+s.z}}e.default=u},9666:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("acfe"));class h{static CreateShdData(t,e,s,i,n){if(h.Ln.has(t))return h.Ln.get(t);let l=new a.default;return l.adaptationShaderVersion=i,l.preCompileInfo=n,l.initialize(t,e,s),h.Lo[l.getUid()]=l,++h.s_shdDataListLen,h.Ln.set(t,l),r.default.SHADERCODE_TRACE_ENABLED,l}static FindData(t){return h.Ln.has(t)?h.Ln.get(t):null}}h.Ln=new Map,h.Lo=[],h.s_shdDataListLen=0,e.default=h},"984e":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.width=0,this.height=0,this.depth=0,this.sampler=0,this.texBuf=null,this.s=0}__$attachThis(){++this.s}__$detachThis(){--this.s,this.s<1&&(this.s=0)}bindToGpu(t){t.bindTexture(this.sampler,this.texBuf)}getAttachCount(){return this.s}}class r{constructor(t,e){this.FT=new Map,this.FU=new Map,this.Gx=0,this.FX=0,this.FY=128,this.A=0,this.AN=null,this.texMid=-1,this.unlocked=!0,this.A=t,this.AN=e}createBuf(){return this.AN.createTexture()}createResByParams3(t,e,s,r){if(!this.FT.has(t)){let a=new i;return a.rcuid=this.getRCUid(),a.resUid=t,a.width=e,a.height=s,a.sampler=r,a.texBuf=this.createBuf(),a.texBuf.resUid=t,this.addTextureRes(a),!0}return!1}getRCUid(){return this.A}getRC(){return this.AN}hasResUid(t){return this.FT.has(t)}renderBegin(){this.texMid=-1}getTextureResTotal(){return this.Gx}addTextureRes(t){this.FT.has(t.resUid)||(t.waitDelTimes=0,this.FT.set(t.resUid,t),this.Gx++)}getGpuBuffer(t){return this.FT.has(t)?this.FT.get(t).texBuf:null}bindToGpu(t){this.FT.has(t)&&this.FT.get(t).bindToGpu(this.AN)}getAttachTotal(){return this.FX}__$attachRes(t){if(this.FT.has(t)){this.FX++;let e=this.FT.get(t);e.getAttachCount()<1&&this.FU.has(t)&&this.FU.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.FT.has(t)&&this.FT.has(t)){let e=this.FT.get(t);e.getAttachCount()>0&&(this.FX--,e.__$detachThis(),e.getAttachCount()<1&&this.FU.set(t,e))}}update(){if(this.FY--,this.FY<1){this.FY=128;for(const[t,e]of this.FU)e.waitDelTimes++,e.waitDelTimes>5&&(this.FT.delete(e.resUid),this.FU.delete(e.resUid),this.AN.deleteTexture(e.texBuf),e.texBuf=null,this.Gx--)}}}e.default=r},"9c3c":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("38de")),h=i(s("fecb")),n=i(s("8a0a")),l=i(s("cb29")),_=i(s("e7d2")),m=s("e08e");class o extends l.default{constructor(t=n.default.VTX_STATIC_DRAW){super(t),this.BZ=null,this.DV=null,this.Gy=0,this.rayTestRadius=2}getVS(){return this.BZ}getCVS(){return this.BZ}initialize(t,e){t.length>=6&&(this.vtCount=Math.floor(t.length/3),this.Gy=Math.floor(this.vtCount/2),this.BZ=new Float32Array(t),null==this.bounds&&(this.bounds=new h.default),this.bounds.addXYZFloat32Arr(this.BZ),this.bounds.updateFast(),_.default.Reset(),_.default.AddFloat32Data(this.BZ,3),this.isVBufEnabledAt(n.default.VBUF_CVS_INDEX)&&(this.DV=new Float32Array(e),_.default.AddFloat32Data(this.DV,3)),_.default.vbWholeDataEnabled=this.vbWholeDataEnabled,null!=this.DW?_.default.UpdateBufData(this.DW):this.DW=_.default.CreateBySaveData(this.getBufDataUsage()),this.drawMode=m.RenderDrawMode.ARRAYS_LINES,this.buildEnd())}setVSXYZAt(t,e,s,i){null!=this.DW&&this.DW.setData3fAt(t,0,e,s,i)}toString(){return"DashedLineMesh()"}isPolyhedral(){return!1}testRay(t,e,s,i){let r=0,h=this.BZ,n=0,l=this.rayTestRadius;for(let _=0;_<this.Gy;++_){if(o.Lp.setXYZ(h[r],h[r+1],h[r+2]),o.Lq.setXYZ(h[r+3],h[r+4],h[r+5]),n=a.default.IntersectionLS(t,e,o.Lp,o.Lq,s,l),n>0)return 1;r+=6}return 0}__$destroy(){this.isResFree()&&(this.bounds=null,this.BZ=null,this.DV=null,super.__$destroy())}}o.Lp=new r.default,o.Lq=new r.default,e.default=o},"9c4d":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.prev=null,this.next=null,this.flag=0,this.target=null}reset(){this.flag=0,this.target=null}}class r{constructor(){this.Cd=null,this.Ce=null}destroy(){this.clear()}clear(){this.Cd=this.Ce=null}getBegin(){return this.Cd}isEmpty(){return this.Cd==this.Ce&&null==this.Ce}addNode(t){null==this.Cd?this.Ce=this.Cd=t:null!=this.Ce.prev?(this.Ce.next=t,t.prev=this.Ce,this.Ce=t):(this.Cd.next=t,t.prev=this.Ce,this.Ce=t),this.Ce.next=null}removeNode(t){t==this.Cd?t==this.Ce?this.Cd=this.Ce=null:(this.Cd=t.next,this.Cd.prev=null):t==this.Ce?(this.Ce=t.prev,this.Ce.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}class a{constructor(){this.Gz=new r,this.G0=[],this.G1=[new i]}getFreeId(){if(this.G0.length>0)return this.G0.pop();let t=new i;return t.flag=this.G1.length,this.G1.push(t),t.flag}addRunner(t){if(null!=t&&t.getRunFlag()<1){let e=this.getFreeId(),s=this.G1[e];s.flag=e,s.target=t,t.setRunFlag(e),this.Gz.addNode(s)}}removeRunner(t){if(null!=t&&t.getRunFlag()>0){let e=t.getRunFlag();this.G0.push(e);let s=this.G1[e];s.flag=e,s.target=null,t.setRunFlag(0),this.Gz.removeNode(s)}}run(){let t=this.Gz.getBegin(),e=t;while(null!=e)t=e,e=t.next,t.target.isRunning()&&t.target.run()}}e.default=a},"9f3e":function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("df25"));class h extends a.default{constructor(t,e,s=!1){super(t,e,s),this.AD=r.TextureProxyType.Uint16,this.minFilter=r.TextureConst.LINEAR,this.dataType=r.TextureDataType.UNSIGNED_SHORT}toHalfFloatOes(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4,this.dataType=r.TextureDataType.HALF_FLOAT_OES}toUShort565(){this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB,this.unpackAlignment=3,this.dataType=r.TextureDataType.UNSIGNED_SHORT_5_6_5}toUShort4444(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4,this.dataType=r.TextureDataType.UNSIGNED_SHORT_4_4_4_4}toUShort5551(){this.unpackAlignment=4,this.dataType=r.TextureDataType.UNSIGNED_SHORT_5_5_5_1}toUShort(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.dataType=r.TextureDataType.UNSIGNED_SHORT}toAlphaFormat(){this.dataType==r.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=r.TextureFormat.ALPHA,this.internalFormat=r.TextureFormat.ALPHA,this.unpackAlignment=1)}toRedFormat(){this.dataType==r.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=r.TextureFormat.RED,this.internalFormat=r.TextureFormat.RED,this.unpackAlignment=1)}toRGBFormat(){this.dataType==r.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB,this.unpackAlignment=3)}toRGBAFormat(){this.dataType==r.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4)}uploadFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,h=!1){super.setDataFromBytes(t,e,s,i,r,a,h)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[Uint16TextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=h},a254:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("faa5")),a=i(s("b3bd")),h=i(s("0fc4"));class n extends r.default{constructor(){super(),this.DF="",this.G2=!1,this.mapLodEnabled=!1}initialize(t){this.DF="ScreenPlaneShd",this.G2=t,t&&(this.DF+="_tex",this.mapLodEnabled&&(this.DF+="Lod"))}buildThisCode(){let t=this.DG;t.reset(),t.addVertLayout("vec3","a_vs"),this.G2?(t.mapLodEnabled=this.mapLodEnabled,t.addVertLayout("vec2","a_uvs"),t.addTextureSample2D(),t.addVarying("vec2","v_uv")):t.mapLodEnabled=!1,t.addFragOutput("vec4","FragColor0"),t.addFragUniform("vec4","u_param",3),t.useVertSpaceMats(!0,!1,!1),t.addFragFunction("")}getFragShaderCode(){return this.buildThisCode(),this.G2?this.DG.addFragMainCode("\nvoid main() {\n    #ifdef VOX_Texture2DLod\n    vec4 color4 = VOX_Texture2DLod(u_sampler0, v_uv, u_param[2].w);\n    #else\n    vec4 color4 = VOX_Texture2D(u_sampler0, v_uv);\n    #endif\n    color4 *= u_param[0];\n    color4 += u_param[1];\n    FragColor0 = color4;\n}\n"):this.DG.addFragMainCode("\nvoid main() {\n    FragColor0 = u_param[0] + u_param[1];\n}\n"),this.DG.buildFragCode()}getVtxShaderCode(){return this.G2?this.DG.addVertMainCode("\nvoid main() {\n    gl_Position = u_objMat * vec4(a_vs,1.0);\n    v_uv = a_uvs.xy;\n}\n"):this.DG.addVertMainCode("\nvoid main() {\n    gl_Position = u_objMat * vec4(a_vs,1.0);\n}\n"),this.DG.buildVertCode()}getUniqueShaderName(){return this.DF}toString(){return"[ScreenPlaneShaderBuffer()]"}static GetInstance(){return null!=n.Ku||(n.Ku=new n),n.Ku}}n.Ku=null;class l extends h.default{constructor(){super(),this.mapLodEnabled=!1,this.G3=new Float32Array([1,1,1,1,0,0,0,0,0,0,0,0])}getCodeBuf(){let t=n.GetInstance();return t.mapLodEnabled=this.mapLodEnabled,t}setRGB3f(t,e,s){this.G3[0]=t,this.G3[1]=e,this.G3[2]=s}setRGBA4f(t,e,s,i){this.G3[0]=t,this.G3[1]=e,this.G3[2]=s,this.G3[3]=i}setOffsetRGB3f(t,e,s){this.G3[0]=t,this.G3[1]=e,this.G3[2]=s}setOffsetRGBA4f(t,e,s,i){this.G3[0]=t,this.G3[1]=e,this.G3[2]=s,this.G3[3]=i}setTextureLodLevel(t){this.G3[11]=t}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_param"],t.dataList=[this.G3],t}}e.default=l},a446:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=s("cc48"),h=i(s("265e")),n=i(s("af68")),l=i(s("a80a"));class _{constructor(){this.r=-1,this.EL=null,this.Y=null,this.G4=null,this.G5=new h.default,this.DX=null,this.G6=new n.default,this.G7=new l.default,this.G8=new l.default,this.G9=null,this.Fc=null,this.G_=0,this.r=_.Kh++,this.G6.initialize(1)}getUid(){return this.r}initialize(t,e=null){null==this.EL&&(this.EL=t,this.G4=t.getStage3D(),this.Y=e,this.DX=t.getRPONodeBuilder())}getStage3D(){return this.G4}setCamera(t){this.Y=t}getCamera(){return this.Y}getMouseXYWorldRay(t,e){this.Y.getWorldPickingRayByScreenXY(this.G4.mouseX,this.G4.mouseY,t,e)}setSpaceCullingor(t){this.G9=t}setRaySelector(t){this.Fc=t,this.Fc.setRenderer(this.EL)}getRaySelector(){return this.Fc}addEntity(t){if(null!=t.getGlobalBounds()&&t.spaceCullMask>a.SpaceCullingMask.NONE&&r.default.TestSpaceEnabled(t.__$rseFlag)){t.update(),++this.G_;let e=this.G6.addEntity(t);e.bounds=t.getGlobalBounds(),e.pcoEnabled=(t.spaceCullMask&a.SpaceCullingMask.POV)==a.SpaceCullingMask.POV;let s=t.isRenderEnabled()||null==t.getMaterial();s&&(t.spaceCullMask&a.SpaceCullingMask.POV)==a.SpaceCullingMask.POV?(e.rstatus=1,null==t.getMaterial()&&(e.rpoNode=this.G5),null==e.rpoNode&&(e.rpoNode=this.DX.getNodeByUid(t.getDisplay().__$rpuid)),this.G8.addNode(e)):null==t.getMaterial()?(e.rstatus=1,e.rpoNode=this.G5,this.G8.addNode(e)):(e.rstatus=0,this.G7.addNode(e))}}removeEntity(t){if(null!=t&&r.default.TestSpaceContains(t.__$rseFlag)){let e=this.G6.getNodeByEntity(t);null!=e&&(e.rstatus>0?this.G8.removeNode(e):this.G7.removeNode(e),this.G6.removeEntity(t),--this.G_)}}updateEntity(t){}update(){}runBegin(){}run(){let t=this.G7.getBegin();if(null!=t){let e=null;while(null!=t)t.entity.isRenderEnabled()?(e=t,e.rstatus=1,t=t.next,this.G7.removeNode(e),this.G8.addNode(e),null==e.rpoNode&&(e.rpoNode=this.DX.getNodeByUid(e.entity.getDisplay().__$rpuid))):t=t.next}if(t=this.G8.getBegin(),null!=t)if(null!=this.G9)this.G9.setCamera(this.Y),this.G9.setCullingNodeHead(t),this.G9.run();else{let e=null,s=this.Y;while(null!=t)t.rpoNode.isVsible()&&t.entity.isDrawEnabled()?(e=t.bounds,t.drawEnabled=s.visiTestSphere2(e.center,e.radius),t.entity.drawEnabled=t.drawEnabled,t.rpoNode.drawEnabled=t.drawEnabled):(t.drawEnabled=!1,t.entity.drawEnabled=!1,t.rpoNode.drawEnabled=!1),t=t.next}}rayTest(t,e){null!=this.Fc&&(this.Fc.setCamera(this.Y),this.Fc.setCullingNodeHead(this.G8.getBegin()),this.Fc.setRay(t,e),this.Fc.run())}runEnd(){}getCullingNodeHead(){return this.G8.getBegin()}toString(){return"[RendererSpace(uid = "+this.r+")]"}}_.Kh=0,e.default=_},a46e:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("1710"));class h{constructor(){this.Y=null,this.HA=!1,this.HB=0,this.HC=2,this.HD=1,this.HE=.5,this.HF=new r.default,this.HG=new r.default,this.HH=new r.default,this.HI=new r.default,this.HJ=new r.default,this.HK=new r.default,this.Dk=new r.default,this.HL=0,this.HM=!0,this.HN=!0,this.HO=0,this.HP=0,this.HQ=2}setMobileZoomSpeed(t){this.HC=t}seSlideSpeed(t){this.HD=t}setMouseWheelZoomSpd(t){this.HE=t}bindCamera(t){this.Y=t}initialize(t){this.HM&&(this.HM=!1,t.addEventListener(a.default.MOUSE_WHEEL,this,this.mouseWheelListener,!0,!0),t.addEventListener(a.default.MOUSE_MULTI_MOVE,this,this.mouseMultiMoveListener,!0,!0),t.addEventListener(a.default.MOUSE_MULTI_UP,this,this.mouseMultiUpListener,!0,!0))}setLookAtCtrlEnabled(t){this.HN=t}mouseWheelListener(t){this.HL=t.wheelDeltaY*this.HE}mouseMultiMoveListener(t){this.setTouchPosArray(t.posArray)}mouseMultiUpListener(t){this.setTouchPosArray(t.posArray)}resetState(){this.HO=0,this.HP=0,this.HQ=0}setTouchPosArray(t){if(null!=t&&t.length>1){let e=0;if(this.HJ.setXYZ(t[0].x,t[0].y,0),this.HK.setXYZ(t[1].x,t[1].y,0),this.HA){e=r.default.Distance(this.HJ,this.HK),this.HQ<1?(this.HF.copyFrom(this.HJ),this.HG.copyFrom(this.HK),this.HF.subVecsTo(this.HJ,this.HH),this.HG.subVecsTo(this.HK,this.HI),this.HF.normalize(),this.HG.normalize(),this.HF.dot(this.HG)>.9?this.HO++:this.HP++,(this.HO>3||this.HP>3)&&(this.HQ=this.HO>this.HP?1:2)):this.HF.subVecsTo(this.HJ,this.HH);let t=Math.abs(this.HB-e);t>.1&&(this.HL=(e-this.HB)*this.HC,this.HB=e)}else this.HA=!0,this.HB=r.default.Distance(this.HJ,this.HK),this.resetState()}else this.resetState(),this.HA=!1;this.HH.copyFrom(this.HJ),this.HI.copyFrom(this.HK)}run(t,e){let s=this.HN;null==t&&(t=this.Dk),null!=this.Y&&(2==this.HQ?this.HL>0?(r.default.Distance(this.Y.getPosition(),this.Y.getLookAtPosition())>e&&(this.Y.forward(this.HL),s&&this.Y.setLookPosXYZFixUp(t.x,t.y,t.z)),this.HL=0):this.HL<-.001&&(this.Y.forward(this.HL),s&&this.Y.setLookPosXYZFixUp(t.x,t.y,t.z),this.HL=0):1==this.HQ&&this.Y.slideViewOffsetXY(-this.HF.x*this.HD,this.HF.y*this.HD))}}e.default=h},a7ed:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279"));class h{create(t,e){let s=null,i=r.default.FrustumParam;return e.hasUniformByName(i.name)&&(s=new a.default,s.uns=i.name,s.uniformNameList=[i.name],s.copyDataFromProbe(t.getCamera().ufrustumProbe)),s}getIDNS(){return"FrustumUniformBuilder"}}e.default=h},a80a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.Cd=null,this.Ce=null}destroy(){this.clear()}clear(){this.Cd=this.Ce=null}getBegin(){return this.Cd}isEmpty(){return this.Cd==this.Ce&&null==this.Ce}addNode(t){null==this.Cd?this.Ce=this.Cd=t:null!=this.Ce.prev?(this.Ce.next=t,t.prev=this.Ce,this.Ce=t):(this.Cd.next=t,t.prev=this.Ce,this.Ce=t),this.Ce.next=null}removeNode(t){t==this.Cd?t==this.Ce?this.Cd=this.Ce=null:(this.Cd=t.next,this.Cd.prev=null):t==this.Ce?(this.Ce=t.prev,this.Ce.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}e.default=i},a996:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uuid="",this.phase=0,this.type=i.RESIZE,this.target=null,this.data=null,this.__$preventBoo=!1}getClassType(){return i.EventClassType}preventDefault(){this.__$preventBoo=!0}reset(){this.__$preventBoo=!1}toString(){return"[EventBase]"}}i.EventClassType=1001,i.RESIZE=3001,i.ENTER_FRAME=3002,e.default=i},a9bf:function(t,e,s){"use strict";s.r(e),s.d(e,"EnvShaderCode",(function(){return n}));var i="#ifdef VOX_USE_FOG\r\n    vec3 fogEnvColor = vec3(1.0);\r\n    vec4 getFogColorFromTexture2D(sampler2D tex) {\r\n        vec4 color = VOX_Texture2D(tex, (u_envLightParams[3].xy + worldPosition.xz) / u_envLightParams[3].zw);\r\n        fogEnvColor = color.xyz;\r\n        return color;\r\n    }\r\n    void useFog(inout vec3 color) {\r\n        vec3 fogColor = u_envLightParams[2].xyz * fogEnvColor;\r\n        #ifdef VOX_FOG_EXP2\r\n            float fogDensity = u_envLightParams[2].w;\r\n            float fogFactor = 1.0 - exp( - fogDensity * fogDensity * v_fogDepth * v_fogDepth );\r\n        #else\r\n            float fogNear = u_envLightParams[1].z;\r\n            float fogFar = u_envLightParams[1].w;\r\n            float fogFactor = smoothstep( fogNear, fogFar, v_fogDepth );\r\n        #endif\r\n        color = mix( color.rgb, fogColor, fogFactor );\r\n    }\r\n#endif",r="void calcFogDepth(in vec4 viewPos) {\r\n    v_fogDepth = -viewPosition.z;\r\n}",a="#ifdef VOX_FOG_COLOR_MAP\r\n    getFogColorFromTexture2D( VOX_FOG_COLOR_MAP );\r\n#endif\r\n\r\n#ifdef VOX_USE_FOG\r\n    useFog( FragColor0.rgb );\r\n#endif ",h="#ifdef VOX_USE_FOG\r\n\r\ncalcFogDepth(viewPosition);\r\n\r\n#endif";const n={vert:"",vert_head:r,vert_body:h,frag:"",frag_head:i,frag_body:a}},ab73:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.type="vec4",this.data=null,this.name="u_vsmParams",this.arrayLength=3}}class r{constructor(){this.type="vec4",this.data=new Float32Array([.1,.1,.1,1,1,.1,600,3500,.3,0,.9,5e-4,0,0,800,800]),this.name="u_envLightParams",this.arrayLength=4}}class a{constructor(){this.type="mat4",this.data=null,this.name="u_shadowMat",this.arrayLength=0}}class h{constructor(){this.type="vec4",this.data=null,this.name="u_stageParam",this.arrayLength=0}}class n{constructor(){this.type="vec4",this.data=null,this.name="u_viewParam",this.arrayLength=0}}class l{constructor(){this.type="vec4",this.data=null,this.name="u_frustumParam",this.arrayLength=0}}class _{constructor(){this.type="vec4",this.data=null,this.name="u_cameraPosition",this.arrayLength=0}}class m{constructor(){this.type="vec4",this.positionName="u_lightPositions",this.colorName="u_lightColors"}}class o{}o.LocalTransformMatUNS="u_objMat",o.CameraViewMatUNS="u_viewMat",o.CameraProjectiveMatUNS="u_projMat",o.FrustumParam=new l,o.CameraPosParam=new _,o.StageParam=new h,o.ViewParam=new n,o.ShadowMatrix=new a,o.ShadowVSMParams=new i,o.GlobalLight=new m,o.EnvLightParams=new r,e.default=o},abdb:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.AXIS_ANGLE=0,i.QUATERNION=1,i.EULER_ANGLES=2,e.default=i},acaa:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("cfaf"));class h extends a.default{constructor(t,e,s=!1){super(t,e,s),this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.srcFormat=r.TextureFormat.DEPTH_COMPONENT,this.internalFormat=r.TextureFormat.DEPTH_COMPONENT,this.dataType=r.TextureDataType.UNSIGNED_SHORT,this.AE=!1,this.AC=!0,this.mipmapEnabled=!1,this.AD=r.TextureProxyType.Depth}toDepthUnsignedInt(){this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.srcFormat=r.TextureFormat.DEPTH_COMPONENT,this.internalFormat=r.TextureFormat.DEPTH_COMPONENT,this.dataType=r.TextureDataType.UNSIGNED_INT,this.AE=!1,this.AC=!0,this.mipmapEnabled=!1}toDepthUnsignedShort(){this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.srcFormat=r.TextureFormat.DEPTH_COMPONENT,this.internalFormat=r.TextureFormat.DEPTH_COMPONENT,this.dataType=r.TextureDataType.UNSIGNED_SHORT,this.AE=!1,this.AC=!0,this.mipmapEnabled=!1}toDepthAndStencil(){this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.srcFormat=r.TextureFormat.DEPTH_STENCIL,this.internalFormat=r.TextureFormat.DEPTH_STENCIL,this.dataType=r.TextureDataType.UNSIGNED_INT_24_8_WEBGL,this.AE=!1,this.mipmapEnabled=!1,this.AC=!0}uploadData(t){let e=t.getRC();e.texImage2D(this.AB,0,r.TextureFormat.ToGL(e,this.internalFormat),this.w,this.x,0,r.TextureFormat.ToGL(e,this.srcFormat),r.TextureDataType.ToGL(e,this.dataType),null)}toString(){return"[DepthTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=h},acfe:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ca6c")),a=i(s("8a0a")),h=i(s("3b73")),n=i(s("81ce")),l=i(s("fc07"));class _{constructor(){this.r=-1,this.adaptationShaderVersion=!0,this.preCompileInfo=null,this.HR="",this.HS="",this.Bg="",this.Bh=0,this.HT=null,this.HU=!1,this.HV=null,this.Bp=null,this.Bj=null,this.Bq=new Map,this.HW=!1,this.HX=0,this.GX=0,this.HY=1,this.HZ=null,this.dataUniformEnabled=!1,this.r=_.Kh++}getVSCodeStr(){return this.HR}getFSCodeStr(){return this.HS}getLayoutBit(){return this.HX}getMid(){return this.GX}getFragOutputTotal(){return this.HY}parseCode(t,e){_.Lr.reset(),_.Lr.parseVShaderCode(t),_.Lr.parseFShaderCode(e),this.HY=_.Lr.fragOutputTotal,this.HT=_.Lr.HT}initialize(t,e,s){this.Bg=t,this.adaptationShaderVersion&&null==this.preCompileInfo&&h.default.IsWebGL1()&&(e=n.default.Es3VtxShaderToES2(e),s=n.default.Es3FragShaderToES2(s)),this.preCompileInfo,this.parseCode(e,s);let i=_.Lr.attributes,l=0,m=i.length,o=null;this.HV=[],this.Bp=[],this.HX=0;let u=31;while(l<m){if(o=i[l],null!=o)switch(this.HV.push(o.name),this.Bp.push(o.typeSize),a.default.GetVBufTypeByNS(o.name)){case a.default.VBUF_VS:u+=131*u+1,this.HX|=r.default.BIT_ONE_0;break;case a.default.VBUF_UVS:u+=131*u+2,this.HX|=r.default.BIT_ONE_1;break;case a.default.VBUF_NVS:u+=131*u+3,this.HX|=r.default.BIT_ONE_2;break;case a.default.VBUF_CVS:u+=131*u+4,this.HX|=r.default.BIT_ONE_3;break;case a.default.VBUF_TVS:u+=131*u+5,this.HX|=r.default.BIT_ONE_4;break;case a.default.VBUF_VS2:u+=131*u+6,this.HX|=r.default.BIT_ONE_5;break;case a.default.VBUF_UVS2:u+=131*u+7,this.HX|=r.default.BIT_ONE_6;break;case a.default.VBUF_NVS2:u+=131*u+8,this.HX|=r.default.BIT_ONE_7;break;case a.default.VBUF_CVS2:u+=131*u+9,this.HX|=r.default.BIT_ONE_8;break;case a.default.VBUF_TVS2:u+=131*u+11,this.HX|=r.default.BIT_ONE_9;break;default:break}++l}this.GX=u,this.Bh=_.Lr.texTotal,this.HU=this.Bh>0,this.HU&&(this.HZ=_.Lr.texUniformNameListStr.split(",")),this.HW=this.Bh<this.HT.length,this.HR=e,this.HS=s,this.Bg=t}getAttriSizeList(){return this.Bp}getTexUniformNames(){return this.HZ}getUniforms(){return this.HT}haveCommonUniform(){return this.HW}getAttriNSList(){return this.HV}getUid(){return this.r}getTexTotal(){return this.Bh}haveTexture(){return this.HU}getLocationsTotal(){return this.Bj.length}getUniformTypeNameByNS(t){let e=this.Bq.get(t);return null!=e?e.typeName:""}getUniformTypeByNS(t){let e=this.Bq.get(t);return null!=e?e.type:0}hasUniformByName(t){return this.Bq.has(t)}getUniformLengthByNS(t){return this.Bq.has(t)&&this.Bq.get(t).arrLength,0}getUniqueShaderName(){return this.Bg}destroy(){this.Bh=0}}_.Kh=0,_.Lr=new l.default,e.default=_},af29:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("722e")),a=i(s("8333")),h=s("8d98"),n=i(s("cfaf")),l=i(s("3930")),_=i(s("baae"));class m{constructor(t,e){this.Ha=new l.default,this.Aq=null,this.t=null,this.A4=null,this.Hb=new l.default,this.Hc=null,this.E5=!0,this.A7=-1,this.A8=-1,this.Hd=128,this.He=128,this.Hf=!0,this.Hg=!1,this.Hh=0,this.Hi=null,this.Hj=-1,this.Hk=[],this.Hl=[null,null,null,null,null,null,null,null],this.Hm=null,this.Hn=0,this.BO=!0,this.BE=1,this.BB=256,this.Ho=!0,this.Hp=!0,this.Hq=!1,this.Hr=!1,this.Hs=!1,this.Hc=t,this.Hm=e,this.t=t.getRenderProxy(),this.Aq=this.t.getRenderAdapter(),this.A4=t.getRendererContext()}getFBOUid(){return this.A7}setRProcessIDList(t){if(t.length<1)throw Error("list.length < 1, but must: list.length >= 1");this.Hk=t}setRProcessList(t){if(t.length<1)throw Error("list.length < 1, but must: list.length >= 1");this.Hk=new Array(t.length);for(let e=0;e<t.length;++e)this.Hk[e]=t[e].getRPIndex()}getRProcessIDAt(t){return this.Hk[t]}getStage3D(){return this.t.getStage3D()}getCamera(){return null!=this.t?this.t.getCamera():null}lockViewport(){this.Hr=!0}unlockViewport(){this.Hr=!1}updateCamera(){null!=this.t&&this.t.updateCamera()}updateCameraDataFromCamera(t){null!=this.t&&this.t.updateCameraDataFromCamera(t)}useGlobalRenderState(t){this.A4.useGlobalRenderState(t)}useGlobalRenderStateByName(t){this.A4.useGlobalRenderStateByName(t)}setGlobalRenderState(t){this.Hj=t}setGlobalRenderStateByName(t){this.Hj=this.A4.getRenderStateByName(t)}lockRenderState(){this.Hj>=0?this.A4.useGlobalRenderState(this.Hj):this.t.lockRenderState()}unlockRenderState(){this.t.unlockRenderState()}useGlobalMaterial(t,e=!1){this.Hs=e,this.A4.useGlobalMaterial(t,this.Hs)}setGlobalMaterial(t,e=!1){this.Hs=e,this.Hi!=t&&(null!=this.Hi&&this.Hi.__$detachThis(),null!=t&&t.__$attachThis()),this.Hi=t}lockMaterial(){null!=this.Hi?this.A4.useGlobalMaterial(this.Hi,this.Hs):this.A4.lockMaterial()}unlockMaterial(){this.A4.unlockMaterial()}synFBOSizeWithViewport(){this.BO=!0}asynFBOSizeWithViewport(){this.BO=!1}setFBOSizeFactorWithViewPort(t){this.BE=t}createViewportSizeFBOAt(t,e=!1,s=!1,i=0){this.A7<0&&(this.A7=t,this.A8=_.default.FRAMEBUFFER,this.Hd=this.Aq.getViewportWidth(),this.He=this.Aq.getViewportHeight(),this.Hf=e,this.Hg=s,this.Hh=i,this.Aq.createFBOAt(t,this.A8,this.Hd,this.He,e,s,i))}createFBO(t,e,s=0){this.Hf=t,this.Hg=e,this.Hh=s,this.Aq.createFBOAt(this.A7,this.A8,this.Hd,this.He,t,e,s)}createAutoSizeFBOAt(t,e=!1,s=!1,i=0){t>=0&&this.A7<0&&(this.A8=_.default.FRAMEBUFFER,this.Hd=512,this.He=512,this.A7=t,this.createFBO(e,s,i))}createFBOAt(t,e,s,i=!1,r=!1,a=0){t>=0&&this.A7<0&&(this.A8=_.default.FRAMEBUFFER,this.Hd=e,this.He=s,this.A7=t,this.Hd<1&&(this.Hd=this.Aq.getRCanvasWidth()),this.He<1&&(this.He=this.Aq.getRCanvasHeight()),this.createFBO(i,r,a))}createReadFBOAt(t,e,s,i=!1,r=!1,a=0){t>=0&&this.A7<0&&(this.A8=_.default.READ_FRAMEBUFFER,this.Hd=e,this.He=s,this.A7=t,this.Hd<1&&(this.Hd=this.Aq.getRCanvasWidth()),this.He<1&&(this.He=this.Aq.getRCanvasHeight()),this.createFBO(i,r,a))}createDrawFBOAt(t,e,s,i=!1,r=!1,a=0){t>=0&&this.A7<0&&(this.A8=_.default.DRAW_FRAMEBUFFER,this.Hd=e,this.He=s,this.A7=t,this.Hd<1&&(this.Hd=this.Aq.getRCanvasWidth()),this.He<1&&(this.He=this.Aq.getRCanvasHeight()),this.createFBO(i,r,a))}resizeFBOAt(t,e,s){t>=0&&this.A7<0&&this.Aq.resizeFBOAt(t,e,s)}resizeFBO(t,e){this.Aq.resizeFBOAt(this.A7,t,e)}getRTTAt(t){return this.Hl[t]}enableMipmapRTTAt(t){this.Hl[t].enableMipmap()}generateMipmapTextureAt(t){this.Hl[t].generateMipmap(this.t.Texture)}setRenderToTexture(t,e=0){return 0==e?this.Hn=1:this.Hn<e+1&&(this.Hn=e+1),this.Hl[e]=t,t}setRenderToRTTTextureAt(t,e=0){this.setRenderToTexture(this.Hm.getRTTTextureAt(t),e)}setRenderToFloatTextureAt(t,e=0){this.setRenderToTexture(this.Hm.getRTTFloatTextureAt(t),e)}setRenderToHalfFloatTexture(t,e=0){return null==t&&(t=new n.default(128,128),t.__$setRenderProxy(this.t),t.internalFormat=h.TextureFormat.RGBA16F,t.srcFormat=h.TextureFormat.RGBA,t.dataType=h.TextureDataType.FLOAT,t.minFilter=h.TextureConst.LINEAR,t.magFilter=h.TextureConst.LINEAR,t.__$setRenderProxy(this.t)),this.setRenderToTexture(t,e)}setRenderToRGBATexture(t,e=0){return null==t&&(t=new n.default(32,32),t.internalFormat=h.TextureFormat.RGBA,t.srcFormat=h.TextureFormat.RGBA,t.dataType=h.TextureDataType.UNSIGNED_BYTE,t.minFilter=h.TextureConst.LINEAR,t.magFilter=h.TextureConst.LINEAR,t.__$setRenderProxy(this.t)),this.setRenderToTexture(t,e)}setRenderToDepthTextureAt(t,e=0){return this.setRenderToTexture(this.Hm.getDepthTextureAt(t),e)}setClearState(t,e,s=!1){this.Ho=t,this.Hp=e,this.Hq=s}setRenderToBackBuffer(){this.t.setClearColor(this.Ha),this.A4.setRenderToBackBuffer()}setClearDepth(t){this.BB=t}getClearDepth(){return this.Aq.getClearDepth()}getViewX(){return this.Aq.getViewportX()}getViewY(){return this.Aq.getViewportY()}getViewWidth(){return this.Aq.getViewportWidth()}getViewHeight(){return this.Aq.getViewportHeight()}getFBOWidth(){return this.Aq.getFBOWidthAt(this.A7)}getFBOHeight(){return this.Aq.getFBOHeightAt(this.A7)}resetAttachmentMask(t){this.Aq.resetFBOAttachmentMask(t)}setAttachmentMaskAt(t,e){this.Aq.setFBOAttachmentMaskAt(t,e)}setClearRGBColor3f(t,e,s){this.Hb.setRGB3f(t,e,s)}setClearColorEnabled(t){this.Ho=t}setClearDepthEnabled(t){this.Hp=t}setClearStencilEnabled(t){this.Hq=t}setClearUint24Color(t,e=1){this.Hb.setRGBUint24(t),this.Hb.a=e}setClearRGBAColor4f(t,e,s,i){this.Hb.setRGBA4f(t,s,e,i)}blitFrom(t,e=a.default.COLOR_BUFFER_BIT,s=r.default.NEAREST,i=-1,h=0,n=null){this.A7>=0&&(this.Aq.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.Aq.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.Aq.blitFBO(t.getFBOUid(),this.A7,e,s,i,h,n))}blitColorFrom(t,e=r.default.NEAREST,s=-1,i=0,h=null){this.A7>=0&&(this.Aq.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.Aq.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.Aq.blitFBO(t.getFBOUid(),this.A7,a.default.COLOR_BUFFER_BIT,e,s,i,h))}blitDepthFrom(t,e=r.default.NEAREST,s=-1,i=0,h=null){this.A7>=0&&(this.Aq.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.Aq.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.Aq.blitFBO(t.getFBOUid(),this.A7,a.default.COLOR_BUFFER_BIT|a.default.DEPTH_BUFFER_BIT,e,s,i,h))}blitColorAndDepthFrom(t,e=r.default.NEAREST,s=-1,i=0,h=null){this.A7>=0&&(this.Aq.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.Aq.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.Aq.blitFBO(t.getFBOUid(),this.A7,a.default.COLOR_BUFFER_BIT|a.default.DEPTH_BUFFER_BIT,e,s,i,h))}blitStencilFrom(t,e=r.default.NEAREST,s=-1,i=0,h=null){this.A7>=0&&(this.Aq.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.Aq.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.Aq.blitFBO(t.getFBOUid(),this.A7,a.default.STENCIL_BUFFER_BIT,e,s,i,h))}renderToTextureAt(t,e=0){this.Aq.setRenderToTexture(this.Hl[t],this.Hf,this.Hg,e),this.Aq.useFBO(this.Ho,this.Hp,this.Hq)}runBeginDo(){if(this.E5){this.E5=!1,this.t.getClearRGBAColor4f(this.Ha),this.Hr?this.Aq.lockViewport():this.Aq.unlockViewport(),this.Aq.bindFBOAt(this.A7,this.A8),this.BO?(this.Aq.synFBOSizeWithViewport(),this.Aq.setFBOSizeFactorWithViewPort(this.BE)):this.Aq.asynFBOSizeWithViewport(),this.BB<128&&this.Aq.setClearDepth(this.BB),this.t.setClearColor(this.Hb);let t=0;for(;t<this.Hn;++t)this.Aq.setRenderToTexture(this.Hl[t],this.Hf,this.Hg,t);this.Aq.useFBO(this.Ho,this.Hp,this.Hq),null!=this.Hi?this.A4.useGlobalMaterial(this.Hi,this.Hs):this.A4.unlockMaterial()}}run(t=!1,e=!1,s=!0,i=!0){if(t&&this.lockRenderState(),e&&!i&&this.lockMaterial(),this.A7>=0&&null!=this.Hk){i&&this.runBeginDo();for(let t=0,e=this.Hk.length;t<e;++t)this.Hc.runAt(this.Hk[t])}this.E5=!0,t&&this.unlockRenderState(),e&&this.unlockMaterial(),s&&this.runEnd()}runAt(t,e=!0){this.A7>=0&&null!=this.Hk&&(0==t&&e?this.runBeginDo():this.E5=!0,this.Hc.runAt(this.Hk[t]))}drawEntity(t,e=!1,s=!0){this.E5||this.Hc.drawEntity(t,e,s)}runBegin(){this.A7>=0&&null!=this.Hk&&(this.E5=!0,this.runBeginDo())}runEnd(){this.t.setClearColor(this.Ha),this.E5=!0,this.Hr&&this.Aq.unlockViewport()}useCamera(t,e=!1){this.Hc.useCamera(t,e)}useMainCamera(){this.Hc.useMainCamera()}reset(){let t=0;for(;t<this.Hn;++t)this.Hl[t]=null;this.E5=!1,this.A7=-1,this.Hn=0,this.Hk=[],null!=this.Hi&&(this.Hi.__$detachThis(),this.Hi=null)}clone(){let t=new m(this.Hc,this.Hm);t.BE=this.BE,t.Hb.copyFrom(this.Hb),t.A7=this.A7,t.A8=this.A8,t.BB=this.BB,t.Hn=this.Hn,t.Hf=this.Hf,t.Hg=this.Hg,t.BO=this.BO,t.Hd=this.Hd,t.He=this.He,t.Hh=this.Hh;let e=0;for(;e<this.Hn;++e)t.Hl[e]=t.Hl[e];if(null!=this.Hk){let s=this.Hk.length,i=new Array(s);for(e=0;e<s;++e)i[e]=this.Hk[e];t.setRProcessIDList(i)}return t}}e.default=m},af2e:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("fecb")),h=i(s("f610")),n=i(s("35fa"));class l extends h.default{constructor(){super(),this.uScale=1,this.vScale=1,this.uvType=0,this.normalScale=1,this.normalEnabled=!1,this.tangentEnabled=!1}initializeXOYPlane(t,e=300,s=300,i=4,a=4){let h=new Array(i),n=new r.default(e/a,s/i,0);for(let l=0;l<i;++l){let e=new Array(a);for(let s=0;s<a;++s)e[a-s-1]=new r.default(t.x+s*n.x,t.y+l*n.y,t.z);h[l]=e}this.initialize(h)}initializeXOZPlane(t,e=300,s=300,i=4,a=4){let h=new Array(i),n=new r.default(e/a,0,s/i);for(let l=0;l<i;++l){let e=new Array(a);for(let s=0;s<a;++s)e[a-s-1]=new r.default(t.x+s*n.x,t.y,t.z+l*n.z);h[l]=e}this.initialize(h)}initializeYOZPlane(t,e=300,s=300,i=4,a=4){let h=new Array(i),n=new r.default(0,e/a,s/i);for(let l=0;l<i;++l){let e=new Array(a);for(let s=0;s<a;++s)e[a-s-1]=new r.default(t.x,t.y+s*n.y,t.z+l*n.z);h[l]=e}this.initialize(h)}initialize(t){let e=0,s=0,i=0;this.bounds=new a.default,this.vtxTotal=t[0].length*t.length,this.BZ=new Float32Array(3*this.vtxTotal),this.Ba=new Float32Array(2*this.vtxTotal);let r=0,h=0,l=t[0].length,_=l-1,m=t,o=m.length,u=m[0],d=this.uScale,c=this.uScale,f=this.uvType;for(e=0;e<o;++e)for(u=m[e],i=e/(o-1),s=0;s<l;++s){f<1?(this.Ba[h++]=d*(s/_),this.Ba[h++]=c*i):(this.Ba[h++]=d*i,this.Ba[h++]=c*(s/_));let t=u[s];this.BZ[r++]=t.x,this.BZ[r++]=t.y,this.BZ[r++]=t.z}this.bounds.addXYZFloat32Arr(this.BZ),this.bounds.updateFast();let p=l,g=0,T=0;o-=1;let v=o*_*6;for(this.Bb=v<65535?new Uint16Array(v):new Uint32Array(v),r=0,e=0;e<o;++e)for(g=e*p,T=(e+1)*p,s=1;s<=_;++s)this.Bb[r++]=g+s,this.Bb[r++]=T+s-1,this.Bb[r++]=g+s-1,this.Bb[r++]=g+s,this.Bb[r++]=T+s,this.Bb[r++]=T+s-1;let x=this.Bb.length/3;if((this.normalEnabled||this.tangentEnabled)&&(this.DU=new Float32Array(this.BZ.length),n.default.ClacTrisNormal(this.BZ,this.BZ.length,x,this.Bb,this.DU),1!=this.normalScale))for(o=this.DU.length,e=0;e<o;e+=3)this.DU[e]*=this.normalScale,this.DU[e+1]*=this.normalScale,this.DU[e+2]*=this.normalScale;this.tangentEnabled&&(this.Fx=new Float32Array(this.BZ.length),this.Fy=new Float32Array(this.BZ.length),n.default.ClacTrisTangent(this.BZ,this.BZ.length,this.Ba,this.DU,x,this.Bb,this.Fx,this.Fy)),this.vtCount=this.Bb.length,this.trisNumber=this.vtCount/3}}e.default=l},af68:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=i(s("7b0e"));class h{constructor(){this.GG=0,this.Ht=[],this.GF=[],this.Hu=[],this.Hv=[],this.Al=[]}getFreeId(){return this.Al.length>0?this.Al.pop():-1}createNode(){let t=this.getFreeId();if(t>=0)return this.Hv[t]=1,this.GF[t];{t=this.GG;let e=a.default.Create();return this.GF.push(e),this.Hu.push(null),e.spaceId=t,this.Hv.push(1),this.Ht.push(t),this.Hv.push(1),this.GG++,e}}restoreId(t){t>0&&1==this.Hv[t]&&(this.Al.push(t),this.Hv[t]=0,this.Hu[t]=null)}addEntity(t){let e=this.createNode();return this.Hu[e.spaceId]=t,e.entity=t,t.__$rseFlag=r.default.AddSpaceUid(t.__$rseFlag,e.spaceId),e}initialize(t){if(t>0)for(let e=0;e<t;e++){let t=this.createNode();this.Hu[t.spaceId]=null}}getNodeByEntity(t){if(r.default.TestSpaceContains(t.__$rseFlag)){let e=r.default.GetSpaceUid(t.__$rseFlag);if(this.Hu[e]==t)return this.GF[e]}return null}removeEntity(t){if(r.default.TestSpaceContains(t.__$rseFlag)){let e=r.default.GetSpaceUid(t.__$rseFlag);this.Hu[e]==t&&(this.GF[e].entity=null,this.restoreId(e),t.__$rseFlag=r.default.RemoveSpaceUid(t.__$rseFlag))}}toString(){return"[EntityNodeQueue()]"}}e.default=h},b02c:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{constructor(t,e){this.r=-1,this.GX=-1,this.Bh=0,this.Hw=null,this.Hx=null,this.q=null,this.A=0,this.DM=null,this.direct=!0,this.s=0,this.A=t,this.r=a.Kh++,this.GX=e}__$setParam(t,e){this.A=t,this.GX=e}getRCUid(){return this.A}getMid(){return this.GX}getTexTotal(){return this.Bh}collectTexList(t,e,s){this.DM=t;let i=0;if(this.direct)if(this.Bh<1&&e.length>0){let a,h=r.default.GetNearestCeilPow2(e.length);this.Hx=new Uint16Array(h),this.Hw=new Array(h),this.q=e;while(i<s)a=e[i],a.__$attachThis(),a.__$$upload(t),this.Hx[i]=a.getSampler(),this.Hw[i]=this.DM.getGpuBuffer(a.getResUid()),this.DM.__$attachRes(a.getResUid()),i++;this.Bh=i}else this.Bh=0;else this.Bh=s;while(i<e.length)e[i++].__$attachThis()}run(){if(this.DM.unlocked&&this.DM.texMid!=this.GX){this.DM.texMid=this.GX;let t=this.DM.getRC(),e=t.TEXTURE0;if(this.direct)for(let s=0;s<this.Bh;++s)t.activeTexture(e++),t.bindTexture(this.Hx[s],this.Hw[s]);else{let s=this.q;for(let i=0;i<this.Bh;++i)t.activeTexture(e++),s[i].__$$use(this.DM)}}}getUid(){return this.r}__$attachThis(){++this.s}__$detachThis(){--this.s,this.s<1&&(this.s=0,a.Restore(this))}reset(){if(null!=this.q)for(let t=0,e=this.q.length;t<e;++t)this.q[t].__$detachThis(),this.DM.__$detachRes(this.q[t].getResUid()),this.Hw[t]=null;this.Bh=0,this.q=null,this.DM=null}toString(){return"TextureRenderObj(uid = "+this.r+", mid="+this.GX+")"}static Create(t,e,s){let i=e.length;if(i>0&&s>0){if(i<s)throw Error("There are fewer textures than in the shader : (need "+s+",but only have "+i+") !!!");let r=31,h=0,n=!0;while(h<s)r=131*r+e[h].getUid(),e[h].isDirect()||(n=!1),++h;let l=a.Lt[t.getRCUid()],_=null;return l.has(r)?_=l.get(r):(_=a.Ls.length<1?new a(t.getRCUid(),r):a.Ls.pop(),_.collectTexList(t,e,s),l.set(r,_)),_.__$setParam(t.getRCUid(),r),_.direct=n,_}return null}static Restore(t){t.getMid()>-1&&(a.Lt[t.getRCUid()].delete(t.getMid()),t.__$setParam(0,0),a.Ls.push(t),t.reset())}static GetByMid(t,e){return a.Lt[t].get(e)}}a.Kh=0,a.Lt=[new Map,new Map,new Map,new Map,new Map,new Map,new Map,new Map],a.Ls=[],a.Lu=!0,a.Lv=-1,e.TextureRenderObj=a;class h{constructor(t){this.DM=null,this.DM=t}run(){this.DM.renderBegin()}getMid(){return 1}__$attachThis(){}__$detachThis(){}}e.EmptyTexRenderObj=h,e.default=a},b0ef:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.AH=null,this.AG=null,this.Hy=-1,this.Hz=-1,this.resized=!0}setDiv(t){this.AG=t}createViewEle(t,e){null==this.AG&&(this.AG=document.getElementById("voxEngineDiv")),null==this.AG&&(this.AG=t.createElement("div"),this.AG.style.width="400px",this.AG.style.height="300px",document.body.appendChild(this.AG)),this.AG.style.display="bolck",this.AG.style.position="absolute",""==this.AG.style.left&&(this.AG.style.left="0px",this.AG.style.top="0px"),e&&(this.AG.style.width="100%",this.AG.style.height="100%"),null==this.AH&&(this.AH=document.createElement("canvas"),this.AG.appendChild(this.AH),this.AH.width=800,this.AH.height=600,this.AH.style.display="bolck",this.AH.style.left="0px",this.AH.style.top="0px",this.AH.style.position="absolute")}setDivStyleLeftAndTop(t,e){this.AG.style.left=t+"px",this.AG.style.top=e+"px"}setDivStyleSize(t,e){this.Hy==t&&this.Hz==e||(this.AG.style.width=t+"px",this.AG.style.height=e+"px",this.resized=!0)}getDiv(){return this.AG}getCanvas(){return this.AH}}e.default=i},b161:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("3806")),h=i(s("c51d")),n=i(s("c497")),l=i(s("af68")),_=i(s("a80a")),m=i(s("9c4d")),o=i(s("d958")),u=i(s("5d04")),d=i(s("a446")),c=i(s("c711")),f=i(s("955e")),p=i(s("765c")),g=i(s("af29")),T=i(s("d7e2")),v=i(s("70f2")),x=i(s("2139"));class E{constructor(){this.r=-1,this.Aq=null,this.t=null,this.Cj=null,this.A4=null,this.EL=null,this.Et=new Uint8Array(128),this.Eu=0,this.Ev=null,this.Ew=new r.default,this.Ex=new r.default,this.Ey=!1,this.Ez=null,this.E0=!0,this.B=0,this.C=0,this.D=800,this.E=800,this.E1=null,this.E2=null,this.H0=null,this.H1=[],this.H2=0,this.E5=-1,this.E6=!0,this.H3=!1,this.H4=-1,this.E4=null,this.Cp=!0,this.runnableQueue=new m.default,this.textureBlock=new u.default,this.stage3D=null,this.E8=[],this.E9=0,this.H5=null,this.E_=!0,this.FA=!0,this.FB=!0,this.FC=!0,this.r=E.Kh++}tickUpdate(){this.H4>-1&&clearTimeout(this.H4),this.H4=setTimeout(this.tickUpdate.bind(this),this.E4.getTickUpdateTime()),this.textureBlock.run()}enable(){this.Cp=!0}disable(){this.Cp=!1}isEnabled(){return this.Cp}getUid(){return this.r}getDiv(){return this.t.getDiv()}getCanvas(){return this.t.getCanvas()}getRPONodeBuilder(){return null}getRenderProxy(){return this.t}setViewPort(t,e,s,i){null!=this.t&&(this.B=t,this.C=e,this.D=s,this.E=i,this.t.setViewPort(t,e,s,i))}setViewPortFromCamera(t){null!=this.t&&null!=t&&(this.B=t.getViewX(),this.C=t.getViewY(),this.D=t.getViewWidth(),this.E=t.getViewHeight(),this.t.setViewPort(this.B,this.C,this.D,this.E))}reseizeViewPort(){this.t.reseizeRCViewPort()}lockViewport(){this.Aq.lockViewport()}unlockViewport(){this.Aq.unlockViewport()}getRendererAdapter(){return this.Aq}getRenderer(){return this.EL}getRendererContext(){return this.A4}getStage3D(){return this.t.getStage3D()}getViewWidth(){return this.t.getStage3D().viewWidth}getViewHeight(){return this.t.getStage3D().viewHeight}getCamera(){return this.t.getCamera()}asynFBOSizeWithViewport(){this.A4.asynFBOSizeWithViewport()}synFBOSizeWithViewport(){this.A4.synFBOSizeWithViewport()}cameraLock(){this.t.cameraLock()}cameraUnlock(){this.t.cameraUnlock()}getMouseXYWorldRay(t,e){this.t.getMouseXYWorldRay(t,e)}createCamera(){return new h.default}createFBOInstance(){return new g.default(this,this.textureBlock.getRTTStrore())}setClearUint24Color(t,e=1){this.t.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,s){this.t.setClearRGBColor3f(t,e,s)}setClearRGBAColor4f(t,e,s,i){this.t.setClearRGBAColor4f(t,e,s,i)}setClearColor(t){this.t.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.A4.setRenderToBackBuffer()}drawBackBufferToCanvas(t){let e=this.getCanvas();var s=t.getContext("2d");s.drawImage(e,0,0,t.width,t.height)}updateRenderBufferSize(){this.Aq.updateRenderBufferSize()}setEvt3DController(t){null!=t&&(t.initialize(this.getStage3D(),this.getStage3D()),t.setRaySelector(this.Ev.getRaySelector())),this.Ez=t}isRayPickSelected(){return null!=this.Ez&&this.Ez.isSelected()}enableMouseEvent(t=!0){null==this.Ez&&(t?this.Ev.setRaySelector(new f.default):this.Ev.setRaySelector(new c.default),this.setEvt3DController(new p.default)),this.E0=!0}disableMouseEvent(){this.E0=!1}getEvt3DController(){return this.Ez}getSpace(){return this.Ev}getDevicePixelRatio(){return this.Aq.getDevicePixelRatio()}createSubScene(){if(null!=this.EL){let t=new v.default(this,this.EL,this.Ey);this.H1.push(t),this.H2++;let e=t;return e.textureBlock=this.textureBlock,t}return null}addEventListener(t,e,s,i=!0,r=!1){this.stage3D.addEventListener(t,e,s,i,r)}removeEventListener(t,e,s){this.stage3D.removeEventListener(t,e,s)}initialize(t=null,e=3){if(null==this.EL){null==t&&(t=new n.default),this.E4=t;let s=this;s.stage3D=new a.default(this.getUid(),document),e<1&&(e=1),e>8&&(e=8),this.Ey=t.evtFlowEnabled,this.EL=new o.default,this.EL.__$setStage3D(this.stage3D),x.default.Allocate(t.getMatrix4AllocateSize());let i=new h.default;this.EL.initialize(t,i),this.Et[0]=0,this.Eu++;let r=null;for(;e>=0;)r=this.EL.appendProcess(t.batchEnabled,t.processFixedState),this.Et[this.Eu]=r.getRPIndex(),this.Eu++,--e;this.A4=this.EL.getRendererContext(),this.t=this.A4.getRenderProxy(),this.Aq=this.t.getRenderAdapter();let l=this.t.getStage3D();if(this.D=l.stageWidth,this.E=l.stageHeight,this.Cj=this.EL.getDataBuilder().getRenderShader(),this.textureBlock.setRenderer(this.EL),this.H0=new T.default(this.t),null==this.Ev){let t=new d.default;t.initialize(this.EL,this.t.getCamera()),this.Ev=t}this.tickUpdate()}}setRendererProcessParam(t,e,s){this.EL.setRendererProcessParam(this.Et[t],e,s)}appendARendererProcess(t=!0,e=!1){let s=this.EL.appendProcess(t,e);this.Et[this.Eu]=s.getRPIndex(),this.Eu++}addContainer(t,e=0){if(e<0&&(e=0),null!=t&&t.__$wuid<0&&t.__$contId<1){let s=0;for(;s<this.E9;++s)if(this.E8[s]==t)return;s>=this.E9&&(t.__$wuid=this.r,t.wprocuid=e,t.__$setRenderer(this),this.E8.push(t),this.E9++)}}removeContainer(t){if(null!=t&&t.__$wuid==this.r&&t.getRenderer()==this.EL){let e=0;for(;e<this.E9;++e)if(this.E8[e]==t){t.__$wuid=-1,t.wprocuid=-1,t.__$setRenderer(null),this.E8.splice(e,1),--this.E9;break}}}setAutoRunningEnabled(t){this.E6=t}setAutoRenderingSort(t){this.H3=t}setProcessSortEnabledAt(t,e,s=null){if(this.EL.setProcessSortEnabledAt(t,e),e){let e=this.EL.getProcessAt(t);s=null!=s?s:this.H0,null!=e&&e.setSorter(s)}}setProcessSortEnabled(t,e,s=null){this.EL.setProcessSortEnabled(t,e),e&&null!=t&&!t.hasSorter()&&(s=null!=s?s:this.H0,t.setSorter(s))}moveEntityTo(t,e){this.EL.moveEntityToProcessAt(t,this.Et[e])}drawEntity(t,e=!1,s=!0){this.EL.drawEntity(t,e,s)}addEntity(t,e=0,s=!0){if(t.__$testSpaceEnabled())if(t.isPolyhedral())if(t.hasMesh())this.EL.addEntity(t,this.Et[e],s),null!=this.Ev&&this.Ev.addEntity(t);else{null==this.E1&&(this.E1=new _.default,this.E2=new l.default);let s=this.E2.addEntity(t);s.rstatus=e,this.E1.addNode(s)}else this.EL.addEntity(t,this.Et[e],s),null!=this.Ev&&this.Ev.addEntity(t)}removeEntity(t){let e=null;if(null!=this.E1){let e=this.E2.getNodeByEntity(t);null!=e&&(this.E1.removeNode(e),this.E2.removeEntity(t))}null==e&&(this.EL.removeEntity(t),null!=this.Ev&&this.Ev.removeEntity(t))}updateMaterialUniformToCurrentShd(t){this.EL.updateMaterialUniformToCurrentShd(t)}showInfoAt(t){this.EL.showInfoAt(t)}getRenderUnitsTotal(){return this.EL.getRenderUnitsTotal()}useCamera(t,e=!1){this.H5=t,e&&(this.t.setRCViewPort(t.getViewX(),t.getViewY(),t.getViewWidth(),t.getViewHeight(),!0),this.t.reseizeRCViewPort()),t.update(),this.A4.resetUniform(),this.t.updateCameraDataFromCamera(t)}useMainCamera(){this.H5=null;let t=this.t.getCamera();this.t.setRCViewPort(t.getViewX(),t.getViewY(),t.getViewWidth(),t.getViewHeight(),!0),this.t.reseizeRCViewPort(),this.t.updateCamera(),this.A4.resetUniform(),this.t.updateCameraDataFromCamera(this.t.getCamera())}updateCameraDataFromCamera(t){this.t.updateCameraDataFromCamera(t)}resetState(){this.A4.resetState()}resetUniform(){this.A4.resetUniform()}enableSynViewAndStage(){this.t.enableSynViewAndStage()}renderBegin(t=!0){if(null==this.H5){if(this.Aq.unlockViewport(),this.t.isAutoSynViewAndStage()){let t=this.t.testViewPortChanged(this.B,this.C,this.D,this.E);this.B=this.t.getViewX(),this.C=this.t.getViewY(),this.D=this.t.getViewWidth(),this.E=this.t.getViewHeight(),t&&(this.t.setRCViewPort(this.B,this.C,this.D,this.E,!0),this.t.reseizeRCViewPort())}else this.t.setViewPort(this.B,this.C,this.D,this.E);this.t.updateCamera(),this.t.updateCameraDataFromCamera(this.t.getCamera())}this.Cj.renderBegin(),t&&this.A4.renderBegin(null==this.H5),this.H5=null}runBegin(t=!0,e=!0){t&&this.E6&&(this.E5>=0&&this.runEnd(),this.E5=0);let s=this.H5,i=null==s;this.renderBegin(e),null!=this.Ev&&(this.Ev.setCamera(i?this.t.getCamera():s),this.Ev.runBegin())}renderContextBegin(){this.A4.renderBegin()}setRayTestEanbled(t){this.FC=t}runMouseTest(t,e){let s=-1;if(null!=this.Ez&&this.E0){if(this.FB&&this.Ez.getEvtType()>0){let t=this.Ev.getRaySelector();if(null!=t){this.FC?this.mouseRayTest():t.clear();let e=t.getSelectedNodesTotal();if(e>1){let s=0,i=t.getSelectedNodes(),r=null;for(;s<e;++s)r=i[s],r.entity.isPolyhedral()}}this.FB=!1}s=this.Ez.run(t,e)}return this.E_=!1,s}update(t=!0,e=!0){if(this.stage3D.enterFrame(),t&&this.E6&&(0!=this.E5&&this.runBegin(),this.E5=1),this.E_=!0,this.FA=!0,this.FB=!0,null!=this.E1){let t=this.E1.getBegin();if(null!=t){let e,s,i;while(null!=t)t.entity.hasMesh()?(e=t,t=t.next,s=e.entity,i=e.rstatus,this.E1.removeNode(e),this.E2.removeEntity(e.entity),this.addEntity(s,i)):t=t.next}}let s=0;for(;s<this.E9;++s)this.E8[s].update();this.EL.update(),null!=this.Ev&&(this.Ev.update(),this.FA&&(null!=this.Ez||this.H3||null!=this.Ev.getRaySelector())&&this.Ev.run()),this.H3&&this.EL.updateAllProcess(),this.E_&&!this.Ey&&(e?this.runMouseTest(1,0):null!=this.Ez&&this.Ez.mouseOutEventTarget())}cullingTest(){null!=this.Ev&&this.Ev.run(),this.FA=!1}mouseRayTest(){null!=this.Ev&&(this.t.getMouseXYWorldRay(this.Ex,this.Ew),this.Ev.rayTest(this.Ex,this.Ew))}run(t=!0){if(this.Cp){if(t&&this.E6&&(1!=this.E5&&this.update(),this.E5=2),this.runnableQueue.run(),this.H2>0)for(let t=0;t<this.Eu;++t)this.EL.runAt(this.Et[t]);else this.EL.run();t&&this.runEnd()}}runAt(t){this.Cp&&this.EL.runAt(this.Et[t])}runEnd(){null!=this.Ez&&this.Ez.runEnd(),this.A4.runEnd(),null!=this.Ev&&this.Ev.runEnd(),this.E6&&(this.E5=-1)}renderFlush(){null!=this.t&&this.t.flush()}updateCamera(){null!=this.t&&this.t.updateCamera()}toString(){return"[RendererScene(uid = "+this.r+")]"}}E.Kh=0,e.default=E},b30a:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("644c")),h=i(s("20ef"));class n{constructor(t,e,s){this.H6=new Map,this.H7=[],this.H8=0,this.H9=[],this.H_=!0,this.IA=!1,this.IB=-1,this.IC=null,this.HY=1,this.A=-1,this.Be=null,this.ID=null,this.Aq=null,this.IE=null,this.IF=null,this.IG=null,this.drawFlag=-1,this.__$globalUniform=null,this.A=t,this.Aq=s,this.Be=e}createResByParams3(t,e,s,i){return!1}getRC(){return this.Be}getGPUProgram(){return this.ID}getRCUid(){return this.A}useTransUniform(t){this.IG!=t&&(this.IG=t,t.use(this))}useUniform(t){this.IF!=t&&(this.IF=t,t.use(this))}create(t){let e=t.getUniqueShaderName();if(this.H6.has(e))return this.H6.get(e);let s=new h.default(this.H8);return s.setShdData(t),this.H7[s.getUid()]=s,this.H9[s.getUid()]=null,++this.H8,this.H6.set(e,s),r.default.SHADERCODE_TRACE_ENABLED,s}findShdProgramByUid(t){return this.H7[t]}findShdProgram(t){return this.H6.has(t)?this.H6.get(t):null}findShdProgramByShdData(t){return null!=t&&this.H6.has(t.getUniqueShaderName())?this.H6.get(t.getUniqueShaderName()):null}unlock(){this.H_=!0,this.__$globalUniform=null}isUnLocked(){return this.H_}lock(){this.H_=!1}textureUnlock(){this.IA=!0}isTextureUnLocked(){return this.IA}textureLock(){this.IA=!1}setSharedUniformByShd(t,e){this.H9[t.getUid()]=e}getSharedUniformByShd(t){return this.H9[t.getUid()]}getCurrFragOutputTotal(){return this.HY}hasResUid(t){return null!=this.H7[t]}bindToGpu(t){if(this.H_&&t>-1&&t<this.H8)if(this.IB!=t){this.IB=t;let e=this.H7[t];this.HY=e.getFragOutputTotal(),this.HY,this.getActiveAttachmentTotal(),this.ID=e.getGPUProgram(),this.Be.useProgram(this.ID),e.useTexLocation();let s=this.H9[e.getUid()];this.IE=s;while(null!=s)s.use(this),s=s.next;this.IC=e}else if(null==this.IE&&null!=this.IC){let t=this.H9[this.IC.getUid()];this.IE=t;while(null!=t)t.use(this),t=t.next}}getGpuBuffer(t){return null}getCurrentShd(){return this.IC}getCurrentShdUid(){return this.IB}resetUniform(){this.IF=null,this.IG=null,this.IE=null}renderBegin(){this.HY=1,this.IB=-1,this.IC=null,this.drawFlag=-1}update(){}destroy(){this.Be=null,this.Aq=null}useUniformToCurrentShd(t){this.IF!=t&&(this.IF,t.useByShd(this,this.IC))}useUniform2ToCurrentShd(t,e){this.IF!=t&&(this.IF,t.useByShd(this,this.IC)),this.IG!=e&&(this.IG,e.useByShd(this,this.IC))}useUniformMat4(t,e){this.Be.uniformMatrix4fv(t,!1,e)}useUniformV2(t,e,s,i,r){switch(e){case a.default.SHADER_MAT4:r<1?this.Be.uniformMatrix4fv(t,!1,s):this.Be.uniformMatrix4fv(t,!1,s,r,16*i);break;case a.default.SHADER_MAT3:this.Be.uniformMatrix3fv(t,!1,s,0,9*i);break;case a.default.SHADER_VEC4FV:this.Be.uniform4fv(t,s,r,4*i);break;case a.default.SHADER_VEC3FV:this.Be.uniform3fv(t,s,r,3*i);break;case a.default.SHADER_VEC4:this.Be.uniform4f(t,s[0],s[1],s[2],s[3]);break;case a.default.SHADER_VEC3:this.Be.uniform3f(t,s[0],s[1],s[2]);break;case a.default.SHADER_VEC2:this.Be.uniform2f(t,s[0],s[1]);break;default:break}}useUniformV1(t,e,s,i){switch(e){case a.default.SHADER_MAT4:this.Be.uniformMatrix4fv(t,!1,s);break;case a.default.SHADER_MAT3:this.Be.uniformMatrix3fv(t,!1,s);break;case a.default.SHADER_VEC4FV:this.Be.uniform4fv(t,s,4*i);break;case a.default.SHADER_VEC3FV:this.Be.uniform3fv(t,s,3*i);break;case a.default.SHADER_VEC4:this.Be.uniform4f(t,s[0],s[1],s[2],s[3]);break;case a.default.SHADER_VEC3:this.Be.uniform3f(t,s[0],s[1],s[2]);break;case a.default.SHADER_VEC2:this.Be.uniform2f(t,s[0],s[1]);break;default:break}}getActiveAttachmentTotal(){return this.Aq.getActiveAttachmentTotal()}}e.default=n},b3bd:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uns="",this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,s=e.length;for(let i=0;i<s;++i)if(t==e[i])return this.dataList[i]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let s=this.uniformNameList,i=s.length;for(let r=0;r<i;++r)if(t==s[r]){this.dataList[r]=e;break}}}copyDataFromProbe(t){this.types=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]);this.uniformSize=t.uniformsTotal}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.calcModels=null}}e.default=i},b88e:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s("2a95");document.title="Vox APP";let r=new i.DemoCameraMotion,a=r;if(void 0!=a.runBegin){function h(){function t(e){a.runBegin(),a.run(),a.runEnd(),window.requestAnimationFrame(t)}a.initialize(),window.requestAnimationFrame(t)}h()}else{function n(){function t(e){r.run(),window.requestAnimationFrame(t)}r.initialize(),window.requestAnimationFrame(t)}n()}},b9b5:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("9c3c")),a=i(s("402a")),h=i(s("3930")),n=i(s("32cc")),l=i(s("8e17"));class _ extends a.default{constructor(){super(),this.rayTestRadius=8,this.colorX=new h.default(1,0,0,1),this.colorY=new h.default(0,1,0,1),this.colorZ=new h.default(0,0,1,1),this.F5=[0,0,0,100,0,0,0,0,0,0,100,0,0,0,0,0,0,100]}setLineWidth(t){}createMaterial(){if(null==this.getMaterial()){let t=new n.default;this.setMaterial(t)}}__activeMesh(t){if(null==this.getMesh()){let e=[this.colorX.r,this.colorX.g,this.colorX.b,this.colorX.r,this.colorX.g,this.colorX.b,this.colorY.r,this.colorY.g,this.colorY.b,this.colorY.r,this.colorY.g,this.colorY.b,this.colorZ.r,this.colorZ.g,this.colorZ.b,this.colorZ.r,this.colorZ.g,this.colorZ.b],s=new r.default;s.rayTestRadius=this.rayTestRadius,s.vbWholeDataEnabled=!1,s.setBufSortFormat(t.getBufSortFormat()),s.initialize(this.F5,e),this.setMesh(s)}}initialize(t=100){t<2&&(t=2),this.F5[3]=t,this.F5[10]=t,this.F5[17]=t,this.createMaterial(),this.activeDisplay()}initializeSizeXYZ(t,e,s){this.F5[3]=t,this.F5[10]=e,this.F5[17]=s,this.createMaterial(),this.activeDisplay()}initializeCorssSizeXYZ(t,e,s){t*=.5,e*=.5,s*=.5,this.F5[0]=-t,this.F5[7]=-e,this.F5[14]=-s,this.F5[3]=t,this.F5[10]=e,this.F5[17]=s,this.createMaterial(),this.activeDisplay()}initializeCross(t=100,e=null){t<2&&(t=2),t*=.5,null==e&&(e=new l.default),this.F5[0]=-t+e.x,this.F5[7]=-t+e.y,this.F5[14]=-t+e.z,this.F5[3]=t+e.x,this.F5[10]=t+e.y,this.F5[17]=t+e.z,this.createMaterial(),this.activeDisplay()}toString(){return"Axis3DEntity(name="+this.name+",uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=_},baae:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.FRAMEBUFFER=71,i.DRAW_FRAMEBUFFER=72,i.READ_FRAMEBUFFER=73,e.default=i},badb:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("1710")),a=i(s("ee5a"));class h{constructor(){this.IH=null,this.II=17,this.II=r.default.GetMouseEvtTypeValuesTotal(),this.IH=new Array(this.II)}getClassType(){return r.default.EventClassType}destroy(){for(let t=0;t<this.II;++t)null!=this.IH[t]&&this.IH[t].destroy()}dispatchEvt(t){if(null!=t){let e=t.type-r.default.GetMouseEvtTypeValueBase();if(e>=0&&e<r.default.GetMouseEvtTypeValuesTotal()&&null!=this.IH[e])return this.IH[e].dispatch(t)}return 0}passTestEvt(t){if(null!=t){let e=t.type-r.default.GetMouseEvtTypeValueBase();if(e>=0&&e<r.default.GetMouseEvtTypeValuesTotal())return this.IH[e].passTestEvt(t)}return 0}passTestPhase(t){let e=r.default.GetMouseEvtTypeValuesTotal();for(let s=0;s<e;++s)if(null!=this.IH[s]&&1==this.IH[s].passTestPhase(t))return 1;return 0}addEventListener(t,e,s,i=!0,h=!1){if(null!=s&&null!=e){let n=t-r.default.GetMouseEvtTypeValueBase();if(n>=0&&n<r.default.GetMouseEvtTypeValuesTotal()){let t=0;i!=h&&(t=i?1:2),null!=this.IH[n]||(this.IH[n]=new a.default),this.IH[n].addListener(e,s,t)}}}removeEventListener(t,e,s){if(null!=s&&null!=e){let i=t-r.default.GetMouseEvtTypeValueBase();i>=0&&i<r.default.GetMouseEvtTypeValuesTotal()&&null!=this.IH[i]&&this.IH[i].removeListener(e,s)}}}e.default=h},bbf4:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.CAMERA_VISIBLE_ENABLE=0,i.CAMERA_VISIBLE_DISABLE=1,e.default=i},bcac:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(){this.Cm=null,this.Y=null,this.Cn=0,this.Co=0,this.Cp=!1}initialize(t,e){null==this.Cm&&(this.Cm=t,this.Y=e)}attach(){this.Cn=this.Cm.mouseX,this.Co=this.Cm.mouseY,this.Cp=!0}detach(){this.Cp=!1}runWithYAxis(){if(this.Cp){let t=this.Cn-this.Cm.mouseX,e=this.Co-this.Cm.mouseY,s=Math.abs(t),i=Math.abs(e);s>i?s>.5&&this.Y.swingHorizontalWithAxis(.2*t,r.default.Y_AXIS):i>.5&&this.Y.swingVertical(-.2*e),this.Cn=this.Cm.mouseX,this.Co=this.Cm.mouseY}}runWithZAxis(){if(this.Cp){let t=this.Cn-this.Cm.mouseX,e=this.Co-this.Cm.mouseY,s=Math.abs(t),i=Math.abs(e);s>i?s>.5&&this.Y.swingHorizontalWithAxis(.2*t,r.default.Y_AXIS):i>.5&&this.Y.swingVertical(-.2*e),this.Cn=this.Cm.mouseX,this.Co=this.Cm.mouseY}}}e.CameraDragSwinger=a},bd6f:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("29ef")),a=i(s("402a")),h=i(s("f63e")),n=i(s("a254")),l=i(s("76b0")),_=i(s("3930"));class m extends a.default{constructor(t=null){super(t),this.IJ=0,this.IK=0,this.IL=0,this.IM=0,this.IN=0,this.IO=!1,this.color0=new _.default,this.color1=new _.default,this.color2=new _.default,this.color3=new _.default,this.Fw=!0,this.offsetU=0,this.offsetV=0,this.uScale=1,this.vScale=1,this.wireframe=!1,this.uvs=null,this.flipVerticalUV=!1,this.vtxColorEnabled=!1,this.premultiplyAlpha=!1}setPolyhedral(t){this.Fw=t;let e=this.getMesh();null!=e&&e.setPolyhedral(t)}setScreenAlignEnable(t){this.IO=t}createMaterial(t){if(null==this.getMaterial())if(this.IO){let e=new n.default;e.setTextureList(t),this.setMaterial(e)}else{let e=new h.default;e.vtxColorEnabled=this.vtxColorEnabled,e.premultiplyAlpha=this.premultiplyAlpha,e.setTextureList(t),this.setMaterial(e)}else null!=t&&this.getMaterial().getTextureTotal()<1&&this.getMaterial().setTextureList(t)}showDoubleFace(t=!1,e=!0){t?e?this.setRenderState(r.default.NONE_CULLFACE_NORMAL_ALWAYS_STATE):this.setRenderState(r.default.BACK_NORMAL_ALWAYS_STATE):e?this.setRenderState(r.default.NONE_CULLFACE_NORMAL_STATE):this.setRenderState(r.default.NORMAL_STATE)}toTransparentBlend(t=!1,e=!1){t?e?this.setRenderState(r.default.NONE_TRANSPARENT_ALWAYS_STATE):this.setRenderState(r.default.BACK_TRANSPARENT_ALWAYS_STATE):e?this.setRenderState(r.default.NONE_TRANSPARENT_STATE):this.setRenderState(r.default.BACK_TRANSPARENT_STATE)}toBrightnessBlend(t=!1,e=!1){t?e?this.setRenderState(r.default.NONE_ADD_ALWAYS_STATE):this.setRenderState(r.default.BACK_ADD_ALWAYS_STATE):e?this.setRenderState(r.default.NONE_ADD_BLENDSORT_STATE):this.setRenderState(r.default.BACK_ADD_BLENDSORT_STATE)}initializeFixScreen(t=null){this.initializeXOY(-1,-1,2,2,t)}initializeXOY(t,e,s,i,r=null){this.IJ=t,this.IK=e,this.IL=s,this.IM=i,this.IN=0,this.createMaterial(r),this.activeDisplay()}initializeXOYSquare(t,e=null){this.IJ=-.5*t,this.IK=-.5*t,this.IL=t,this.IM=t,this.IN=0,this.createMaterial(e),this.activeDisplay()}initializeXOZ(t,e,s,i,r=null){this.IN=1,this.IJ=t,this.IK=e,this.IL=s,this.IM=i,this.createMaterial(r),this.activeDisplay()}initializeYOZ(t,e,s,i,r=null){this.IN=2,this.IJ=t,this.IK=e,this.IL=s,this.IM=i,this.createMaterial(r),this.activeDisplay()}initializeXOZSquare(t,e=null){this.IN=1,this.IJ=-.5*t,this.IK=-.5*t,this.IL=t,this.IM=t,this.createMaterial(e),this.activeDisplay()}__activeMesh(t){if(null==this.getMesh()){let e=new l.default;e.color0.copyFrom(this.color0),e.color1.copyFrom(this.color1),e.color2.copyFrom(this.color2),e.color3.copyFrom(this.color3),e.setPolyhedral(this.Fw),e.setUVS(this.uvs),this.uvs=null,e.uScale=this.uScale,e.vScale=this.vScale,e.offsetU=this.offsetU,e.offsetV=this.offsetV,e.wireframe=this.wireframe,e.flipVerticalUV=this.flipVerticalUV,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.axisFlag=this.IN,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.IJ,this.IK,this.IL,this.IM),this.setMesh(e)}}setUVS(t){let e=this.getMesh();null!=e&&e.setUVS(t)}reinitializeMesh(){let t=this.getMesh();null!=t&&t.reinitialize()}toString(){return"[Plane3DEntity]"}}e.default=m},c120:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(){this.entity=null,this.lpv=new r.default,this.wpv=new r.default,this.dis=0,this.flag=0}}e.default=a},c164:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){}}i.FragPredefined="\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n",i.FragDefined="\nvec4 worldPosition = vec4(0.0);\nvec3 worldNormal = vec3(0.0);\n",i.VertPredefined="\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n",i.VertDefined="\nvec4 localPosition = vec4(0.0,0.0,0.0,1.0);\nvec4 worldPosition = vec4(0.0,0.0,0.0,1.0);\n// view space position\nvec4 viewPosition = vec4(0.0,0.0,0.0,1.0);\n",e.default=i},c497:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(t=null){this.IP=8192,this.IQ=null,this.IR={depth:!0,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:!1,preserveDrawingBuffer:!0,powerPreference:"high-performance"},this.IS=20,this.IT=!0,this.IU=!1,this.autoSyncRenderBufferAndWindowSize=!0,this.maxWebGLVersion=2,this.cameraPerspectiveEnabled=!0,this.evtFlowEnabled=!1,this.camProjParam=new r.default(45,10,5e3),this.camPosition=new r.default(2e3,2e3,2e3),this.camLookAtPos=new r.default(0,0,0),this.camUpDirect=new r.default(0,1,0),this.batchEnabled=!0,this.processFixedState=!1,this.IQ=t}setTickUpdateTime(t){t=Math.round(t),this.IS=t>5?t:5}getTickUpdateTime(){return this.IS}setPolygonOffsetEanbled(t){this.IT=t}getPolygonOffsetEanbled(){return this.IT}setDitherEanbled(t){this.IU=t}getDitherEanbled(){return this.IU}getDiv(){return this.IQ}getRenderContextAttri(){return this.IR}setAttriDepth(t){this.IR.depth=t}setAttriStencil(t){this.IR.stencil=t}setAttriAlpha(t){this.IR.alpha=t}setAttriPremultipliedAlpha(t){this.IR.premultipliedAlpha=t}setAttriAntialias(t){this.IR.antialias=t}setAttripreserveDrawingBuffer(t){this.IR.preserveDrawingBuffer=t}setAttriHightPowerPreference(t){this.IR.powerPreference=t?"high-performance":"default"}setMatrix4AllocateSize(t){t<1024&&(t=1024),this.IP=t}getMatrix4AllocateSize(){return this.IP}setCamProject(t,e,s){if(e>=s)throw Error("Error Camera cear > far !!!");this.camProjParam.setTo(t,e,s)}setCamPosition(t,e,s){this.camPosition.setTo(t,e,s)}setCamLookAtPos(t,e,s){this.camLookAtPos.setTo(t,e,s)}setCamUpDirect(t,e,s){this.camUpDirect.setTo(t,e,s)}}e.default=a},c51d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),h=i(s("18c7")),n=i(s("e214")),l=i(s("fecb"));class _{constructor(){this.version=0,this.matUProbe=null,this.ufrustumProbe=null,this.uniformEnabled=!1,this.name="Camera",this.IV=new a.default,this.Dj=new a.default,this.IW=new a.default,this.IX=new a.default,this.IY=!0,this.T=new h.default,this.Df=new h.default,this.IZ=new h.default,this.Ia=new h.default,this.Ib=new h.default,this.Ic=new h.default,this.Id=new a.default,this.k=new a.default,this.Ie=new a.default,this.If=new a.default,this.Ig=new a.default,this.Ih=1,this.Ii=1,this.B=0,this.C=0,this.D=800,this.E=600,this.Ij=400,this.Ik=300,this.Il=0,this.Im=1,this.In=.1,this.Io=1e3,this.Ip=0,this.Iq=0,this.Ir=0,this.Is=0,this.E3=!1,this.It=!1,this.Iu=!0,this.Iv=new a.default(0,0,0),this.Iw=1,this.Dm=!0,this.Ix=!0,this.Iy=new a.default,this.Iz=new a.default,this.I0=new a.default,this.I1=new a.default,this.I2=new a.default,this.I3=0,this.I4=new a.default,this.I5=null,this.I6=!1,this.I7=new l.default,this.De=null,this.I8=.5,this.I9=.5,this.I_=new a.default,this.JA=new a.default,this.JB=new a.default,this.JC=[new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,null,null,null],this.JD=[new n.default,new n.default,new n.default,new n.default,new n.default,new n.default],this.JE=[new a.default,new a.default,new a.default,new a.default,new a.default,new a.default],this.JF=[0,0,0,0,0,0],this.JG=null}lock(){this.Ix=!1}unlock(){this.Ix=!0}lookAtLH(t,e,s){this.Ix&&(this.Id.copyFrom(t),this.k.copyFrom(e),this.Ie.copyFrom(s),this.Ig.x=this.k.x-this.Id.x,this.Ig.y=this.k.y-this.Id.y,this.Ig.z=this.k.z-this.Id.z,this.IY=!1,this.If.copyFrom(this.Ig),this.If.normalize(),this.IX.copyFrom(s),this.IX.normalize(),a.default.Cross(this.Ig,this.Ie,this.IW),this.IW.normalize(),this.Dm=!0)}lookAtRH(t,e,s){this.Ix&&(this.Id.copyFrom(t),this.k.copyFrom(e),this.Ig.x=this.k.x-this.Id.x,this.Ig.y=this.k.y-this.Id.y,this.Ig.z=this.k.z-this.Id.z,this.IY=!0,this.If.copyFrom(this.Ig),this.If.normalize(),a.default.Cross(this.Ig,s,this.IW),a.default.Cross(this.IW,this.Ig,this.IX),this.IX.normalize(),this.IW.normalize(),this.Ie.copyFrom(this.IX),this.Dm=!0)}getLookAtLHToCamera(t){t.lookAtLH(this.Id,this.k,this.Ie)}getLookAtRHToCamera(t){t.lookAtRH(this.Id,this.k,this.Ie)}perspectiveLH(t,e,s,i){this.Ix&&(this.It=!1,this.Im=e,this.Il=t,this.In=s,this.Io=i,this.Ic.perspectiveLH(t,e,s,i),this.Iw=Math.tan(.5*t),this.E3=!0,this.Iu=!1,this.Dm=!0)}perspectiveRH(t,e,s,i){this.Ix&&(this.Im=e,this.Il=t,this.In=s,this.Io=i,this.Ic.perspectiveRH(t,e,s,i),this.Iw=Math.tan(.5*t),this.It=!1,this.E3=!0,this.Iu=!0,this.Dm=!0)}perspectiveRH2(t,e,s,i,r){this.Ix&&(this.Im=e/s,this.Il=t,this.In=i,this.Io=r,this.Ic.perspectiveRH2(t,e,s,i,r),this.Iw=Math.tan(.5*t),this.E3=!0,this.It=!0,this.Iu=!0,this.Dm=!0)}getAspect(){return this.Im}getViewFieldZoom(){return this.Iw}orthoRH(t,e,s,i,r,a){this.Ix&&(this.In=t,this.Io=e,this.Ip=s,this.Iq=i,this.Ir=r,this.Is=a,this.Ic.orthoRH(s,i,r,a,t,e),this.E3=!1,this.Iu=!0,this.Dm=!0)}orthoLH(t,e,s,i,r,a){this.Ix&&(this.In=t,this.Io=e,this.Ip=s,this.Iq=i,this.Ir=r,this.Is=a,this.Ic.orthoLH(s,i,r,a,t,e),this.E3=!1,this.Iu=!1,this.Dm=!0)}isPerspectiveEnabled(){return this.E3}isRightHandEnabled(){return this.Iu}setViewXY(t,e){this.Ix&&(this.B=t,this.C=e)}setViewSize(t,e){this.Ix&&(t==this.D&&e==this.E||(this.D=t,this.E=e,this.Ij=.5*t,this.Ik=.5*e,this.E3?this.It?this.Iu&&this.perspectiveRH2(this.Il,t,e,this.In,this.Io):this.Iu?this.perspectiveRH(this.Il,t/e,this.In,this.Io):this.perspectiveLH(this.Il,t/e,this.In,this.Io):this.orthoRH(this.In,this.Io,-.5*e,.5*e,-.5*t,.5*t)))}getViewX(){return this.B}getViewY(){return this.C}getViewWidth(){return this.D}getViewHeight(){return this.E}translation(t){this.Ix&&(this.Id.copyFrom(t),this.k.x=t.x+this.Ig.x,this.k.y=t.y+this.Ig.y,this.k.z=t.z+this.Ig.z,this.Dm=!0)}translationXYZ(t,e,s){this.IV.setXYZ(t,e,s),this.Ix&&a.default.DistanceSquared(this.Id,this.IV)>1e-5&&(this.Id.setTo(t,e,s),this.k.x=t+this.Ig.x,this.k.y=e+this.Ig.y,this.k.z=s+this.Ig.z,this.Dm=!0)}forward(t){this.Ix&&(this.Id.x+=this.If.x*t,this.Id.y+=this.If.y*t,this.Id.z+=this.If.z*t,this.k.x=this.Id.x+this.Ig.x,this.k.y=this.Id.y+this.Ig.y,this.k.z=this.Id.z+this.Ig.z,this.Dm=!0)}slideViewOffsetXY(t,e){if(this.Ix){this.IV.setXYZ(t,e,0),this.De.transformVectorSelf(this.IV),t=this.IV.x-this.Id.x,e=this.IV.y-this.Id.y;let s=this.IV.z-this.Id.z;this.Id.x+=t,this.Id.y+=e,this.Id.z+=s,this.k.x+=t,this.k.y+=e,this.k.z+=s,this.Dm=!0}}forwardFixPos(t,e){this.Ix&&(this.Id.x=e.x+this.If.x*t,this.Id.y=e.y+this.If.y*t,this.Id.z=e.z+this.If.z*t,this.k.x=this.Id.x+this.Ig.x,this.k.y=this.Id.y+this.Ig.y,this.k.z=this.Id.z+this.Ig.z,this.Dm=!0)}swingHorizontalWithAxis(t,e){this.Ix&&(this.Ib.identity(),null!=e?this.Ib.appendRotation(t*r.default.MATH_PI_OVER_180,e):this.Ib.appendRotation(t*r.default.MATH_PI_OVER_180,a.default.Y_AXIS),this.Ig.x=this.Id.x-this.k.x,this.Ig.y=this.Id.y-this.k.y,this.Ig.z=this.Id.z-this.k.z,this.Ib.transformVectorSelf(this.Ig),this.Id.x=this.Ig.x+this.k.x,this.Id.y=this.Ig.y+this.k.y,this.Id.z=this.Ig.z+this.k.z,this.Ig.x=this.k.x-this.Id.x,this.Ig.y=this.k.y-this.Id.y,this.Ig.z=this.k.z-this.Id.z,this.IY=!0,this.If.copyFrom(this.Ig),this.If.normalize(),this.Ib.transformVectorSelf(this.IW),this.IW.normalize(),a.default.Cross(this.IW,this.Ig,this.Ie),this.Ie.normalize(),this.Dm=!0)}swingHorizontal(t){this.Ix&&(this.Ib.identity(),this.Ib.appendRotation(t*r.default.MATH_PI_OVER_180,this.Ie),this.Ig.x=this.Id.x-this.k.x,this.Ig.y=this.Id.y-this.k.y,this.Ig.z=this.Id.z-this.k.z,this.Ib.transformVectorSelf(this.Ig),this.Id.x=this.Ig.x+this.k.x,this.Id.y=this.Ig.y+this.k.y,this.Id.z=this.Ig.z+this.k.z,this.Ig.x=this.k.x-this.Id.x,this.Ig.y=this.k.y-this.Id.y,this.Ig.z=this.k.z-this.Id.z,this.IY=!0,this.If.copyFrom(this.Ig),this.If.normalize(),a.default.Cross(this.Ig,this.Ie,this.IW),this.IW.normalize(),this.Dm=!0)}swingVertical(t){this.Ix&&(this.Ib.identity(),this.Ib.appendRotation(t*r.default.MATH_PI_OVER_180,this.IW),this.Ig.x=this.Id.x-this.k.x,this.Ig.y=this.Id.y-this.k.y,this.Ig.z=this.Id.z-this.k.z,this.Ib.transformVectorSelf(this.Ig),this.Id.x=this.Ig.x+this.k.x,this.Id.y=this.Ig.y+this.k.y,this.Id.z=this.Ig.z+this.k.z,this.Ig.x=this.k.x-this.Id.x,this.Ig.y=this.k.y-this.Id.y,this.Ig.z=this.k.z-this.Id.z,this.IY=!0,this.If.copyFrom(this.Ig),this.If.normalize(),a.default.Cross(this.IW,this.Ig,this.Ie),this.Ie.normalize(),this.IX.copyFrom(this.Ie),this.Dm=!0)}setPosition(t){if(this.Ix){a.default.Cross(this.Ig,this.Ie,this.IV);let e=this.IV.dot(this.IX);this.Dj.copyFrom(this.IX),this.Dj.scaleBy(e),this.IV.subtractBy(this.Dj),this.Id.copyFrom(t),this.Ig.x=this.k.x-this.Id.x,this.Ig.y=this.k.y-this.Id.y,this.Ig.z=this.k.z-this.Id.z,this.If.copyFrom(this.Ig),this.If.normalize(),a.default.Cross(this.IV,this.Ig,this.Ie),this.Ie.normalize(),this.Dm=!0}}setPositionXYZ(t,e,s){if(this.Ix){a.default.Cross(this.Ig,this.Ie,this.IV);var i=this.IV.dot(this.IX);this.Dj.copyFrom(this.IX),this.Dj.scaleBy(i),this.IV.subtractBy(this.Dj),this.Id.setTo(t,e,s),this.Ig.x=this.k.x-this.Id.x,this.Ig.y=this.k.y-this.Id.y,this.Ig.z=this.k.z-this.Id.z,this.If.copyFrom(this.Ig),this.If.normalize(),a.default.Cross(this.IV,this.Ig,this.Ie),this.Ie.normalize(),this.Dm=!0}}setLookPosXYZFixUp(t,e,s){this.Ix&&(this.k.setTo(t,e,s),this.Ig.x=this.k.x-this.Id.x,this.Ig.y=this.k.y-this.Id.y,this.Ig.z=this.k.z-this.Id.z,this.IY=!0,this.If.copyFrom(this.Ig),this.If.normalize(),a.default.Cross(this.Ig,this.Ie,this.IW),this.IW.normalize(),this.Dm=!0)}setPositionXYZFixUp(t,e,s){this.Ix&&(this.Id.setTo(t,e,s),this.Ig.x=this.k.x-this.Id.x,this.Ig.y=this.k.y-this.Id.y,this.Ig.z=this.k.z-this.Id.z,this.IY=!0,this.If.copyFrom(this.Ig),this.If.normalize(),a.default.Cross(this.Ig,this.Ie,this.IW),this.IW.normalize(),this.Dm=!0)}setPositionFixUp(t){this.Ix&&(this.Id.copyFrom(t),this.Ig.x=this.k.x-this.Id.x,this.Ig.y=this.k.y-this.Id.y,this.Ig.z=this.k.z-this.Id.z,this.IY=!0,this.If.copyFrom(this.Ig),this.If.normalize(),a.default.Cross(this.Ig,this.Ie,this.IW),this.IW.normalize(),this.Dm=!0)}copyFrom(t){let e=t.getPosition();this.Id.copyFrom(e),e=t.getLookAtPosition(),this.k.copyFrom(e),this.setZNear(t.getZNear()),this.setZFar(t.getZFar()),this.setNearPlaneWidth(t.getNearPlaneWidth()),this.setNearPlaneHeight(t.getNearPlaneHeight()),this.setPerspectiveEnabled(t.getPerspectiveEnabled()),this.IZ.copyFrom(t.getViewInvMatrix())}getNV(){return this.Iy.copyFrom(this.If),this.Iy}getUV(){return this.Iz.copyFrom(this.Ie),this.Iz}getRV(){return this.I0.copyFrom(this.IW),this.I0}getPosition(){return this.I1.copyFrom(this.Id),this.I1}getLookAtPosition(){return this.I2.copyFrom(this.k),this.I2}setLookAtPosition(t,e,s){this.Ix&&(this.k.setTo(t,e,s),this.Ig.x=this.k.x-this.Id.x,this.Ig.y=this.k.y-this.Id.y,this.Ig.z=this.k.z-this.Id.z,this.If.copyFrom(this.Ig),this.If.normalize(),this.Dm=!0)}getPerspectiveEnabled(){return this.E3}setPerspectiveEnabled(t){this.E3=t}appendRotationByAxis(t,e,s=null){this.Ix&&(this.I3=t,this.Dm=!0,this.I4.copyFrom(e),this.I5=s,this.I6=!0)}setRotationX(t){this.Iv.x=t,this.Dm=!0,this.I6=!1}getRotationX(){return this.Iv.x}setRotationY(t){this.Iv.y=t,this.Dm=!0,this.I6=!1}getRotationY(){return this.Iv.y}setRotationZ(t){this.Iv.z=t,this.Dm=!0,this.I6=!1}getRotationZ(){return this.Iv.z}setRotationXYZ(t,e,s){this.Ix&&(this.Iv.setXYZ(t,e,s),this.Dm=!0,this.I6=!1)}screenXYToViewXYZ(t,e,s){t-=this.B,e-=this.C,this.E3&&(t=this.Ih*(t-this.Ij)/this.Ij,e=this.Ii*(this.Ik-e)/this.Ik),s.setTo(t,e,-this.In)}screenXYToWorldXYZ(t,e,s){t-=this.B,e-=this.C,this.E3&&(t=.5*this.Ih*(t-this.Ij)/this.Ij,e=.5*this.Ii*(this.Ik-e)/this.Ik),s.setTo(t,e,-this.In),s.w=1,this.IZ.transformVectorSelf(s)}getWorldPickingRayByScreenXY(t,e,s,i){t-=this.B,e-=this.C,this.E3?(t=.5*this.Ih*(t-this.Ij)/this.Ij,e=.5*this.Ii*(e-this.Ik)/this.Ik,s.setTo(t,e,-this.In),s.w=1,this.IZ.transformVectorSelf(s),i.copyFrom(s),i.subtractBy(this.Id),i.normalize()):(t-=this.Ij,e-=this.Ik,s.setTo(t,e,-this.In),s.w=1,this.IZ.transformVectorSelf(s),i.copyFrom(this.If))}calcScreenNormalizeXYByWorldPos(t,e){e.copyFrom(t),this.Ia.transformVectorSelf(e),e.x/=e.w,e.y/=e.w}worldPosToScreen(t){this.Df.transformVector3Self(t),this.Ic.transformVectorSelf(t),t.x/=t.w,t.y/=t.w,t.x*=this.Ij,t.y*=this.Ik,t.x+=this.B,t.y+=this.C}calcViewRectByWorldSphere(t,e,s){this.Df.transformVector3Self(t),e*=1.15,s.x=t.x-e,s.y=t.y-e,s.z=t.z,t.x+=e,t.y+=e,this.Ic.transformPerspV4Self(s),this.Ic.transformPerspV4Self(t),t.z=1/t.w,s.z=t.x*t.z,s.w=t.y*t.z,s.z*=this.Ij,s.w*=this.Ik,s.x*=t.z,s.y*=t.z,s.x*=this.Ij,s.y*=this.Ik,s.z=s.z-s.x,s.w=s.w-s.y,s.x+=this.B,s.y+=this.C}calcScreenRectByWorldSphere(t,e,s){this.Df.transformVector3Self(t),e*=1.15,s.x=t.x-e,s.y=t.y-e,t.x+=e,t.y+=e,this.Ic.transformPerspV4Self(s),this.Ic.transformPerspV4Self(t),t.z=1/t.w,s.z=t.x*t.z,s.w=t.y*t.z,s.x*=t.z,s.y*=t.z,s.z=s.z-s.x,s.w=s.w-s.y}getInvertViewMatrix(){return this.De}getZNear(){return this.In}setZNear(t){this.In=t}getZFar(){return this.Io}setZFar(t){this.Io=t}getNearPlaneWidth(){return this.Ih}setNearPlaneWidth(t){this.Ih=t}getNearPlaneHeight(){return this.Ii}setNearPlaneHeight(t){this.Ii=t}getFov(){return this.Il}__calcTestParam(){null==this.De&&(this.De=new h.default),this.De.copyFrom(this.Df),this.De.invert();let t=null,e=this.Ik,s=this.Ij,i=this.Ik,r=this.Ij;if(this.E3){let t=Math.tan(.5*this.Il);e=this.In*t,s=e*this.Im,i=this.Io*t,r=i*this.Im}this.I8=s,this.I9=e,this.I_.setTo(0,0,-this.In),this.JA.setTo(0,0,-this.Io),this.De.transformVectorSelf(this.I_),this.De.transformVectorSelf(this.JA),this.JB.x=this.JA.x-this.I_.x,this.JB.y=this.JA.y-this.I_.y,this.JB.z=this.JA.z-this.I_.z,this.JB.normalize(),t=this.JD[0],t.nv.copyFrom(this.JB),t.distance=t.nv.dot(this.JA),t.position.copyFrom(this.JA),t=this.JD[1],t.nv.copyFrom(this.JD[0].nv),t.distance=t.nv.dot(this.I_),t.position.copyFrom(this.I_),this.JC[8]=this.I_,this.JC[9]=this.JA,this.JC[11]=this.JB,this.JC[0].setTo(-r,-i,-this.Io),this.JC[1].setTo(r,-i,-this.Io),this.JC[2].setTo(r,i,-this.Io),this.JC[3].setTo(-r,i,-this.Io),this.JC[4].setTo(-s,-e,-this.In),this.JC[5].setTo(s,-e,-this.In),this.JC[6].setTo(s,e,-this.In),this.JC[7].setTo(-s,e,-this.In),this.De.transformVectorSelf(this.JC[0]),this.De.transformVectorSelf(this.JC[1]),this.De.transformVectorSelf(this.JC[2]),this.De.transformVectorSelf(this.JC[3]),this.De.transformVectorSelf(this.JC[4]),this.De.transformVectorSelf(this.JC[5]),this.De.transformVectorSelf(this.JC[6]),this.De.transformVectorSelf(this.JC[7]),this.I7.max.setTo(-9999999,-9999999,-9999999),this.I7.min.setTo(9999999,9999999,9999999);for(let a=0;a<8;++a)this.I7.addPosition(this.JC[a]);this.I7.updateFast();let n=this.JC[0],l=this.JC[4];this.IV.x=n.x-l.x,this.IV.y=n.y-l.y,this.IV.z=n.z-l.z,n=this.JC[1],l=this.JC[5],this.Dj.x=n.x-l.x,this.Dj.y=n.y-l.y,this.Dj.z=n.z-l.z,t=this.JD[3],a.default.Cross(this.Dj,this.IV,t.nv),t.nv.normalize(),t.distance=t.nv.dot(n),t.position.copyFrom(n),n=this.JC[3],l=this.JC[7],this.IV.x=n.x-l.x,this.IV.y=n.y-l.y,this.IV.z=n.z-l.z,n=this.JC[2],l=this.JC[6],this.Dj.x=n.x-l.x,this.Dj.y=n.y-l.y,this.Dj.z=n.z-l.z,t=this.JD[2],a.default.Cross(this.Dj,this.IV,t.nv),t.nv.normalize(),t.distance=t.nv.dot(n),t.position.copyFrom(n),n=this.JC[0],l=this.JC[4],this.IV.x=n.x-l.x,this.IV.y=n.y-l.y,this.IV.z=n.z-l.z,n=this.JC[3],l=this.JC[7],this.Dj.x=n.x-l.x,this.Dj.y=n.y-l.y,this.Dj.z=n.z-l.z,t=this.JD[4],a.default.Cross(this.IV,this.Dj,t.nv),t.nv.normalize(),t.distance=t.nv.dot(n),t.position.copyFrom(n),n=this.JC[1],l=this.JC[5],this.IV.x=n.x-l.x,this.IV.y=n.y-l.y,this.IV.z=n.z-l.z,n=this.JC[2],l=this.JC[6],this.Dj.x=n.x-l.x,this.Dj.y=n.y-l.y,this.Dj.z=n.z-l.z,t=this.JD[5],a.default.Cross(this.IV,this.Dj,t.nv),t.nv.normalize(),t.distance=t.nv.dot(n),t.position.copyFrom(n),this.JE[0].copyFrom(this.JD[0].nv),this.JE[1].copyFrom(this.JD[1].nv),this.JE[1].scaleBy(-1),this.JE[2].copyFrom(this.JD[2].nv),this.JE[3].copyFrom(this.JD[3].nv),this.JE[3].scaleBy(-1),this.JE[4].copyFrom(this.JD[4].nv),this.JE[4].scaleBy(-1),this.JE[5].copyFrom(this.JD[5].nv),this.JF[0]=this.JD[0].distance,this.JF[1]=-this.JD[1].distance,this.JF[2]=this.JD[2].distance,this.JF[3]=-this.JD[3].distance,this.JF[4]=-this.JD[4].distance,this.JF[5]=this.JD[5].distance}getWordFrustumWAABB(){return this.I7}getWordFrustumWAABBCenter(){return this.I7.center}getWordFrustumVtxArr(){return this.JC}getWordFrustumPlaneArr(){return this.JD}visiTestSphere2(t,e){let s=this.JE[0].dot(t)-this.JF[0]-e>r.default.MATH_MIN_POSITIVE;return!s&&(s=this.JE[1].dot(t)-this.JF[1]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.JE[2].dot(t)-this.JF[2]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.JE[3].dot(t)-this.JF[3]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.JE[4].dot(t)-this.JF[4]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.JE[5].dot(t)-this.JF[5]-e>r.default.MATH_MIN_POSITIVE,!s)))))}visiTestSphere3(t,e,s){let i=this.JE[0].dot(t)-this.JF[0]+s-e>r.default.MATH_MIN_POSITIVE;return!i&&(i=this.JE[1].dot(t)-this.JF[1]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.JE[2].dot(t)-this.JF[2]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.JE[3].dot(t)-this.JF[3]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.JE[4].dot(t)-this.JF[4]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.JE[5].dot(t)-this.JF[5]-e>r.default.MATH_MIN_POSITIVE,!i)))))}visiTestPosition(t){let e=this.JE[0].dot(t)-this.JF[0]>r.default.MATH_MIN_POSITIVE;return!e&&(e=this.JE[1].dot(t)-this.JF[1]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.JE[2].dot(t)-this.JF[2]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.JE[3].dot(t)-this.JF[3]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.JE[4].dot(t)-this.JF[4]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.JE[5].dot(t)-this.JF[5]>r.default.MATH_MIN_POSITIVE,!e)))))}visiTestPlane(t,e){let s=t.dot(this.JD[0].position)-e,i=s*(t.dot(this.JD[1].position)-e);return i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.JD[2].position)-e),i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.JD[3].position)-e),i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.JD[4].position)-e),i<r.default.MATH_MIN_POSITIVE||(i=s*(t.dot(this.JD[5].position)-e),i<r.default.MATH_MIN_POSITIVE))))}visiTestSphere(t,e){let s=this.I7.sphereIntersect(t,e);if(s){let s=this.JD[0].intersectSphere(t,e),i=this.JD[1].intersectSphere(t,e);return!(s*i>=0&&!this.JD[0].intersectBoo&&!this.JD[1].intersectBoo)&&(s=this.JD[2].intersectSphere(t,e),i=this.JD[3].intersectSphere(t,e),!(s*i>=0&&!this.JD[2].intersectBoo&&!this.JD[3].intersectBoo)&&(s=this.JD[4].intersectSphere(t,e),i=this.JD[5].intersectSphere(t,e),!(s*i>=0&&!this.JD[4].intersectBoo&&!this.JD[5].intersectBoo)))}return!1}visiTestAABB(t){let e=t.center,s=t.radius,i=this.I7.sphereIntersect(e,s);if(i){let t=this.JD[0].intersectSphere(e,s),i=this.JD[1].intersectSphere(e,s);return!(t*i>=0&&!this.JD[0].intersectBoo&&!this.JD[1].intersectBoo)&&(t=this.JD[2].intersectSphere(e,s),i=this.JD[3].intersectSphere(e,s),!(t*i>=0&&!this.JD[2].intersectBoo&&!this.JD[3].intersectBoo)&&(t=this.JD[4].intersectSphere(e,s),i=this.JD[5].intersectSphere(e,s),!(t*i>=0&&!this.JD[4].intersectBoo&&!this.JD[5].intersectBoo)))}return!1}setViewMatrix(t){this.JG=t,this.Dm=!0}update(){this.Dm&&(this.version++,this.Dm=!1,null==this.JG?(this.I6?this.T.appendRotationPivot(this.I3*r.default.MATH_PI_OVER_180,this.I4,this.I5):(this.T.identity(),this.T.appendRotationEulerAngle(this.Iv.x*r.default.MATH_PI_OVER_180,this.Iv.y*r.default.MATH_PI_OVER_180,this.Iv.z*r.default.MATH_PI_OVER_180)),this.IY?this.Df.lookAtRH(this.Id,this.k,this.Ie):this.Df.lookAtLH(this.Id,this.k,this.Ie),this.Df.append(this.T)):this.Df.copyFrom(this.JG),this.It?(this.Ih=this.In*Math.tan(.5*this.Il)*2,this.Ii=this.Ih/this.Im):(this.Ii=this.In*Math.tan(.5*this.Il)*2,this.Ih=this.Im*this.Ii),this.IZ.copyFrom(this.Df),this.IZ.invert(),this.Ia.identity(),this.Ia.copyFrom(this.Df),this.Ia.append(this.Ic),this.__calcTestParam(),this.updateUniformData())}updateCamMatToUProbe(t){t.isEnabled()&&(t.update(),t.getFS32At(0).set(this.Df.getLocalFS32(),0),t.getFS32At(1).set(this.Ic.getLocalFS32(),0))}updateUniformData(){this.uniformEnabled&&(this.updateCamMatToUProbe(this.matUProbe),this.ufrustumProbe.setVec4DataAt(0,this.In,this.Io,this.I8,this.I9),this.ufrustumProbe.update(),this.ucameraPosProbe.setVec4DataAt(0,this.Id.x,this.Id.y,this.Id.z,1),this.ucameraPosProbe.update())}destroy(){}lookRHEnabled(){return this.IY}lookLHEnabled(){return!this.IY}getVPMatrix(){return this.Ia}getViewMatrix(){return this.Df}getViewInvMatrix(){return this.IZ}getProjectMatrix(){return this.Ic}}e.default=_},c62b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=s("e08e"),h=s("7c63"),n=i(s("29ef"));class l{constructor(){this.uid=-1,this.value=-1,this.__$rpuid=-1,this.__$rprouid=-1,this.shader=null,this.pos=new r.default,this.bounds=null,this.ibufType=0,this.ibufStep=2,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.drawOffset=0,this.partTotal=0,this.partGroup=null,this.trisNumber=0,this.visible=!0,this.drawEnabled=!0,this.drawMode=0,this.renderState=0,this.rcolorMask=0,this.drawFlag=0,this.vro=null,this.transUniform=null,this.uniform=null,this.shdUid=-1,this.vtxUid=-1,this.tro=null,this.texMid=-1,this.ubo=null}testDrawFlag(){this.shader.drawFlag!=this.drawFlag&&(this.shader.drawFlag=this.drawFlag,h.RenderStateObject.UseRenderState(this.renderState),h.RenderColorMask.UseRenderState(this.rcolorMask))}getUid(){return this.uid}getRPOUid(){return this.__$rpuid}getRPROUid(){return this.__$rprouid}getShaderUid(){return this.shdUid}setIvsParam(t,e){this.ivsIndex=t,this.ivsCount=e,this.drawOffset=t*this.ibufStep,this.drawEnabled=this.visible&&this.ivsCount>0}setVisible(t){this.visible=t,this.drawEnabled=t&&this.ivsCount>0}setDrawFlag(t,e){this.renderState=t,this.rcolorMask=e,this.drawFlag=(e<<10)+t}drawThis(t){switch(++n.default.DrawCallTimes,n.default.DrawTrisNumber+=this.trisNumber,this.drawMode){case a.RenderDrawMode.ELEMENTS_TRIANGLES:t.RContext.drawElements(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ELEMENTS_LINES:t.RContext.drawElements(t.LINES,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:t.RContext.drawElements(t.TRIANGLE_STRIP,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:t.RContext.drawElementsInstanced(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset,this.insCount);break;case a.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:t.RContext.drawElements(t.TRIANGLE_FAN,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ARRAYS_LINES:t.RContext.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case a.RenderDrawMode.ARRAYS_LINE_STRIP:t.RContext.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}drawPart(t){++n.default.DrawCallTimes,n.default.DrawTrisNumber+=this.trisNumber;let e=0,s=t.RContext;switch(this.drawMode){case a.RenderDrawMode.ELEMENTS_TRIANGLES:for(;e<this.partTotal;)s.drawElements(t.TRIANGLES,this.partGroup[e++],this.ibufType,this.partGroup[e++]);break;case a.RenderDrawMode.ELEMENTS_LINES:for(;e<this.partTotal;)s.drawElements(t.LINES,this.partGroup[e++],this.ibufType,this.partGroup[e++]);break;case a.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:s.drawElements(t.TRIANGLE_STRIP,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:s.drawElementsInstanced(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset,this.insCount);break;case a.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:s.drawElements(t.TRIANGLE_FAN,this.ivsCount,this.ibufType,this.drawOffset);break;case a.RenderDrawMode.ARRAYS_LINES:s.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case a.RenderDrawMode.ARRAYS_LINE_STRIP:s.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}run2(t){null!=this.ubo&&this.ubo.run(t),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}run(t){null!=this.ubo&&this.ubo.run(t),this.vro.run(),this.tro.run(),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}runLockMaterial2(t){this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(null==t?this.uniform:t,this.transUniform)}runLockMaterial(){this.vro.run(),this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(this.uniform,this.transUniform)}reset(){this.vro.__$detachThis(),this.vro=null,this.tro.__$detachThis(),this.tro=null,this.texMid=-1,this.__$rprouid=-1,this.ubo=null,this.shdUid=-1,this.vtxUid=-1,this.uniform=null,this.transUniform=null,this.partGroup=null,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.partTotal=0,this.drawMode=0,this.drawFlag=0,this.renderState=0,this.rcolorMask=0,this.drawEnabled=!0,this.shader=null,this.bounds=null}destroy(){this.reset()}toString(){return"[RPOUnit(uid = "+this.uid+")]"}}e.default=l},c70f:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279"));class h{constructor(){}geNames(){return[]}createGlobalUinform(t){let e=new a.default;return e.uniformNameList=this.geNames(),e.copyDataFromProbe(t),t.update(),e}}class n extends h{constructor(){super()}geNames(){return[r.default.EnvLightParams.name]}use(t,e=1){t.addFragUniformParam(r.default.EnvLightParams)}}e.GlobalEnvLightUniformParam=n;class l extends h{constructor(){super()}geNames(){return[r.default.ShadowMatrix.name,r.default.ShadowVSMParams.name]}use(t,e=1){t.addFragUniformParam(r.default.ShadowVSMParams),t.addVertUniformParam(r.default.ShadowMatrix)}}e.GlobalVSMShadowUniformParam=l;class _ extends h{constructor(){super()}geNames(){return[r.default.GlobalLight.positionName,r.default.GlobalLight.colorName]}use(t,e=1){t.addFragUniformParam(r.default.CameraPosParam),t.addFragUniform(r.default.GlobalLight.type,r.default.GlobalLight.positionName,e),t.addFragUniform(r.default.GlobalLight.type,r.default.GlobalLight.colorName,e)}}e.GlobalLightUniformParam=_},c711:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),h=i(s("fecb")),n=i(s("c120"));class l{constructor(){this.EL=null,this.Y=null,this.Gh=null,this.Gi=null,this.Gj=new Uint8Array(256),this.Gk=null,this.Gl=null,this.Gm=0,this.Gn=0,this.Go=new a.default,this.Gp=new a.default,this.EC=null,this.ED=null,this.Gq=new Uint8Array(4),this.Gr=new a.default,this.Gs=new a.default,this.Gt=[null,null],this.Gu=!1}setRenderer(t){this.EL=t}setRayTestMode(t){this.Gn=t}setRay(t,e){this.EC=t,this.ED=e}getRay(t,e){t.copyFrom(this.EC),e.copyFrom(this.ED)}setCamera(t){this.Y=t}setCullingNodeHead(t){if(this.Gh=t,null==this.Gk){this.Gk=[];let t=0;for(;t<256;++t)this.Gk.push(new n.default)}}getSelectedNode(){return this.Gl}getSelectedNodes(){return this.Gk}getSelectedNodesTotal(){return this.Gm}sorting(t,e){let s=this.Gk;this.Gi=s[t];while(t<e){while(t<e&&s[e].dis>=this.Gi.dis)--e;s[t]=s[e];while(t<e&&s[t].dis<=this.Gi.dis)++t;s[e]=s[t]}return s[t]=this.Gi,t}snsort(t,e){if(t<e){let s=this.sorting(t,e);this.snsort(t,s-1),this.snsort(s+1,e)}}run(){let t=this.Gh;if(null!=t){let e=0,s=this.ED,i=this.EC,n=this.Gs,l=null,_=0;Math.abs(s.x)>r.default.MATH_MIN_POSITIVE?this.Gr.x=1/s.x:this.Gr.x=r.default.MATH_MAX_POSITIVE,Math.abs(s.y)>r.default.MATH_MIN_POSITIVE?this.Gr.y=1/s.y:this.Gr.y=r.default.MATH_MAX_POSITIVE,Math.abs(s.z)>r.default.MATH_MIN_POSITIVE?this.Gr.z=1/s.z:this.Gr.z=r.default.MATH_MAX_POSITIVE,this.Gr.x<0?this.Gq[0]=1:this.Gq[0]=0,this.Gr.y<0?this.Gq[1]=1:this.Gq[1]=0,this.Gr.z<0?this.Gq[2]=1:this.Gq[2]=0;while(null!=t)t.drawEnabled&&t.entity.mouseEnabled&&(n.x=t.bounds.center.x-i.x,n.y=t.bounds.center.y-i.y,n.z=t.bounds.center.z-i.z,e=n.dot(s),n.x-=e*s.x,n.y-=e*s.y,n.z-=e*s.z,n.getLengthSquared()<=t.bounds.radius2&&t.rayTestState<1&&(this.Gt[0]=t.bounds.min,this.Gt[1]=t.bounds.max,h.default.IntersectionRL3(this.Gt,this.Gq,this.Gr,s,i,n)&&(l=this.Gk[_],l.entity=t.entity,l.dis=this.Gr.w,l.wpv.copyFrom(n),++_))),t=t.next;this.Gl=null;let m=0;if(_>0){let t=this.Go,e=this.Gp,h=null,l=0,o=0,u=null,d=null;if(_>1){let c=!this.Gu;for(m=0;m<_;++m)d=this.Gk[m],d.dis=r.default.MATH_MAX_POSITIVE,d.flag=0,h=this.Gk[m].entity,h.isPolyhedral()?c?(u=h.getInvMatrix(),u.transformOutVector3(i,t),u.deltaTransformOutVector(s,e),e.normalize(),l=h.testRay(t,e,n,!0)):l=0:(u=h.getInvMatrix(),u.transformOutVector3(i,t),u.deltaTransformOutVector(s,e),e.normalize(),l=h.testRay(t,e,n,!0)),l>0?(d.flag=l,d.lpv.copyFrom(n),h.getMatrix().transformOutVector3(n,d.wpv),d.dis=a.default.Distance(d.wpv,i),this.Gj[o]=m,++o):l<0&&(this.Gj[o]=m,++o);for(this.snsort(0,_-1),m=0;m<_;++m)if(this.Gk[m].flag>0){this.Gl=this.Gk[m];break}}else d=this.Gk[0],d.dis=r.default.MATH_MAX_POSITIVE,h=this.Gk[0].entity,u=h.getInvMatrix(),u.transformOutVector3(i,t),u.deltaTransformOutVector(s,e),e.normalize(),l=h.testRay(t,e,n,!0),l>0?(d.lpv.copyFrom(n),h.getMatrix().transformOutVector3(n,d.wpv),d.dis=a.default.Distance(d.wpv,i),this.Gl=d):l<0&&(this.Gl=d)}for(m=_;m<this.Gm;++m)this.Gl!=this.Gk[m]&&(this.Gk[m].entity=null);this.Gm=_}}clear(){this.Gl=null}}e.default=l},c77b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17")),a=i(s("52c9")),h=i(s("6e01")),n=s("6ba3"),l=s("200a"),_=s("0706");class m{constructor(){this.JH=null,this.JI=new n.AngleDegreeTween,this.cameraFollower=new _.CameraViewFollower,this.posInterp=new l.PosInterpolation,this.cameraOffset=new r.default(0,130,-200),this.motionSpeed=1,this.JJ=0,this.C5=new r.default,this.JK=new r.default,this.JL=new r.default,this.IN=a.default.TRACK_END,this.JM=!1,this.JN=new a.default,this.moveToEnd=null,this.posInterp.minDis=30}bindTarget(t){this.JH=t}destroy(){this.JH=null}getTarget(){return this.JH}run(){if(this.IN!=a.default.TRACK_END){if(null!=this.JH){let t=this.JJ+this.motionSpeed;this.IN=this.JN.calcPosByDis(this.JK,this.JJ,!0),this.C5.copyFrom(this.JK),this.JL.y=this.C5.y,this.C5.subtractBy(this.JL);let e=this.JI.calcDegree(360-h.default.GetDegreeByXY(this.C5.x,this.C5.z));this.C5.copyFrom(this.JK),this.C5.y+=this.cameraOffset.y,this.cameraFollower.moveToOnXOZ(this.C5,e),this.JH.getPosition(this.JL),this.C5.copyFrom(this.JL),this.posInterp.interpolate(this.JK,this.JL),this.C5.subVecsTo(this.JL,this.C5),e=this.JI.calcDegree(360-h.default.GetDegreeByXY(this.C5.x,this.C5.z)),this.JH.setPosition(this.JL),this.JH.setRotationXYZ(0,e,0),this.JH.update(),this.JJ=t}}else null!=this.moveToEnd&&this.moveToEnd(),this.JM&&(this.JJ=0,this.IN=a.default.TRACK_INIT,this.JN.toBegin())}getTrackFlag(){return this.IN}setPathPosList(t,e=!1){this.JJ=0,this.IN=a.default.TRACK_INIT,this.JM=e;let s=0,i=t.length;null!=this.JH&&(this.JH.setPosition(t[0]),this.JH.update()),this.JL.copyFrom(t[0]),this.C5.copyFrom(t[1]),this.JL.y=this.C5.y,this.C5.subtractBy(this.JL),this.JI.setDegree(360-h.default.GetDegreeByXY(this.C5.x,this.C5.z)),this.C5.normalize(),this.C5.scaleBy(-210),this.C5.addBy(this.JL),this.C5.y+=this.cameraOffset.y,this.cameraFollower.setViewParams(this.C5,this.JI.getDegree(),30),this.JN.clear();let n=null;for(;s<i;++s)n=t[s],this.JN.addXYZ(n.x,n.y,n.z);e&&r.default.DistanceSquared(t[0],t[t.length-1])>.01&&(n=t[0],this.JN.addXYZ(n.x,n.y,n.z))}}e.PathMotionAction=m},ca6c:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static PushThreeBitValueToInt(t,e){return(t<<3)+e}static PopThreeBitValueFromInt(t){return i.value=7&t,t>>3}static ContainsBit(t,e){return(e&t)>0}static RemoveBit(t,e){return~e&t}static AddBit(t,e){return e|t}static AssembleFromIntArray(t){let e=0,s=0,i=t.length;for(;e<i;++e)t[e]>0&&(s|=1<<e);return s}}i.BIT_ZERO=0,i.BIT_ONE_0=1,i.BIT_ONE_1=2,i.BIT_ONE_2=4,i.BIT_ONE_3=8,i.BIT_ONE_4=16,i.BIT_ONE_5=32,i.BIT_ONE_6=64,i.BIT_ONE_7=128,i.BIT_ONE_8=256,i.BIT_ONE_9=512,i.BIT_ONE_10=1024,i.BIT_ONE_11=2048,i.value=0,e.default=i},cb29:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=s("8a0a"),h=i(s("e7d2")),n=s("e08e");class l{constructor(t=r.default.VTX_STATIC_DRAW){this.JO=0,this.HX=0,this.d=null,this.DW=null,this.Bb=null,this.JP=null,this.JQ=null,this.JR=null,this.wireframe=!1,this.bounds=null,this.normalType=a.VtxNormalType.GOURAND,this.normalScale=1,this.vtxTotal=0,this.trisNumber=0,this.drawMode=n.RenderDrawMode.ELEMENTS_TRIANGLES,this.vtCount=0,this.vbWholeDataEnabled=!1,this.drawInsBeginIndex=0,this.drawInsStride=0,this.drawInsTotal=0,this.s=0,this.JO=t}updateWireframeIvs(){if(this.drawMode=n.RenderDrawMode.ELEMENTS_TRIANGLES,this.wireframe&&null!==this.Bb){let t,e,s,i,r=this.Bb,a=2*r.length;t=a<65535?new Uint16Array(a):new Uint32Array(a);let h=0;for(let n=0,l=r.length;n<l;n+=3)e=r[n+0],s=r[n+1],i=r[n+2],t[h]=e,t[h+1]=s,t[h+2]=s,t[h+3]=i,t[h+4]=i,t[h+5]=e,h+=6;this.drawMode=n.RenderDrawMode.ELEMENTS_LINES}}buildEnd(){this.JP=h.default.BufDataList,this.JQ=h.default.BufDataStepList,this.JR=h.default.BufStatusList}setTransformMatrix(t){this.d=t}getTransformMatrix(){return this.d}isPolyhedral(){return!0}setPolyhedral(t){}testRay(t,e,s,i){return-1}rebuild(){if(null==this.DW&&null!=this.JP){h.default.Reset();let t=0,e=this.JP.length;for(;t<e;++t)h.default.AddFloat32Data(this.JP[t],this.JQ[t],this.JR[t]);this.DW=h.default.CreateBySaveData(this.getBufDataUsage()),null!=this.Bb&&(this.DW.setUint16IVSData(this.Bb),this.vtCount=this.Bb.length)}}__$attachVBuf(){return null==this.DW&&this.rebuild(),h.default.__$$AttachAt(this.DW.getUid()),this.DW}__$detachVBuf(t){if(this.DW!=t)throw Error("Fatal Error!");h.default.__$$DetachAt(this.DW.getUid())}isGeomDynamic(){return this.JO}getBufDataUsage(){return this.JO}getVS(){return null}getIVS(){return this.Bb}setBufSortFormat(t){this.HX=t}getBufSortFormat(){return this.HX}isVBufEnabledAt(t){return(t&this.HX)>0}__$attachThis(){++this.s}__$detachThis(){1==this.s?(--this.s,this.__$dispose()):--this.s,this.s<1&&(this.s=0)}getAttachCount(){return this.s}__$dispose(){this.getAttachCount()<1&&null!=this.DW&&(h.default.__$$DetachAt(this.DW.getUid()),this.DW=null)}isEnabled(){return null!=this.DW}isResFree(){return this.getAttachCount()<1&&null==this.DW}__$destroy(){this.isResFree()&&(this.Bb=null,this.JP=null,this.JQ=null,this.JR=null,this.trisNumber=0,this.d=null)}toString(){return"[MeshBase()]"}}e.default=l},cc48:function(t,e,s){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["NONE"]=0]="NONE",t[t["CAMERA"]=1]="CAMERA",t[t["POV"]=2]="POV",t[t["INNER_POV_PASS"]=3]="INNER_POV_PASS",t[t["CAMERA_AND_POV"]=4]="CAMERA_AND_POV"}(i||(i={})),e.SpaceCullingMask=i},ccdf:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("cfaf")),h=i(s("acaa")),n=i(s("85b6")),l=i(s("3b73"));class _{constructor(t){this.t=null,this.JS=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.JT=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.JU=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.JV=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.t=t}getRenderProxy(){return this.t}createWrapperTex(t,e,s=!1){let i=new n.default(t,e,s);return i}createRTTTex2D(t,e,s=!1){let i=new a.default(t,e,s);return i}createDepthTex2D(t,e,s=!1){let i=new h.default(t,e,s);return i}getCubeRTTTextureAt(t){return null!=this.JT[t]?(this.JT[t].__$setRenderProxy(this.t),this.JT[t]):(this.JT[t]=this.createRTTTex2D(32,32),this.JT[t].toCubeTexture(),this.JT[t].name="sys_cube_rttTex_"+t,this.JT[t].minFilter=r.TextureConst.LINEAR,this.JT[t].magFilter=r.TextureConst.LINEAR,this.JT[t].__$setRenderProxy(this.t),this.JT[t])}createCubeRTTTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.JT[t]?(this.JT[t].__$setRenderProxy(this.t),this.JT[t]):(this.JT[t]=this.createRTTTex2D(e,s),this.JT[t].toCubeTexture(),this.JT[t].name="sys_cube_rttTex_"+t,this.JT[t].minFilter=r.TextureConst.LINEAR,this.JT[t].magFilter=r.TextureConst.LINEAR,this.JT[t].__$setRenderProxy(this.t),this.JT[t])}getRTTTextureAt(t){return null!=this.JS[t]?(this.JS[t].__$setRenderProxy(this.t),this.JS[t]):(this.JS[t]=this.createRTTTex2D(32,32),this.JS[t].to2DTexture(),this.JS[t].name="sys_rttTex_"+t,this.JS[t].minFilter=r.TextureConst.LINEAR,this.JS[t].magFilter=r.TextureConst.LINEAR,this.JS[t].__$setRenderProxy(this.t),this.JS[t])}createRTTTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.JS[t]?(this.JS[t].__$setRenderProxy(this.t),this.JS[t]):(this.JS[t]=this.createRTTTex2D(e,s),this.JS[t].to2DTexture(),this.JS[t].name="sys_rttTex_"+t,this.JS[t].minFilter=r.TextureConst.LINEAR,this.JS[t].magFilter=r.TextureConst.LINEAR,this.JS[t].__$setRenderProxy(this.t),this.JS[t])}getDepthTextureAt(t){return null!=this.JV[t]?(this.JV[t].__$setRenderProxy(this.t),this.JV[t]):(this.JV[t]=this.createDepthTex2D(64,64),this.JV[t].to2DTexture(),this.JV[t].name="sys_depthTex_"+t,this.JV[t].minFilter=r.TextureConst.NEAREST,this.JV[t].magFilter=r.TextureConst.NEAREST,this.JV[t].__$setRenderProxy(this.t),this.JV[t])}createDepthTextureAt(t,e,s){return e=e>1?e:1,s=s>1?s:1,null!=this.JV[t]?(this.JV[t].__$setRenderProxy(this.t),this.JV[t]):(this.JV[t]=this.createDepthTex2D(e,s),this.JV[t].to2DTexture(),this.JV[t].name="sys_depthTex_"+t,this.JV[t].__$setRenderProxy(this.t),this.JV[t])}getRTTFloatTextureAt(t){if(null!=this.JU[t])return this.JU[t].__$setRenderProxy(this.t),this.JU[t];let e=this.createRTTTex2D(64,64);return e.to2DTexture(),this.JU[t]=e,this.JU[t].name="sys_rttFloatTex_"+t,e.internalFormat=r.TextureFormat.RGBA16F,e.srcFormat=r.TextureFormat.RGBA,e.dataType=r.TextureDataType.FLOAT,e.minFilter=r.TextureConst.NEAREST,e.magFilter=r.TextureConst.NEAREST,l.default.IsWebGL1()&&(e.dataType=r.TextureDataType.HALF_FLOAT_OES),this.JU[t].__$setRenderProxy(this.t),e}createRTTFloatTextureAt(t,e,s){if(e=e>1?e:1,s=s>1?s:1,null!=this.JU[t])return this.JU[t].__$setRenderProxy(this.t),this.JU[t];let i=this.createRTTTex2D(e,s);return i.to2DTexture(),this.JU[t]=i,this.JU[t].name="sys_rttFloatTex_"+t,i.internalFormat=r.TextureFormat.RGBA16F,i.srcFormat=r.TextureFormat.RGBA,i.dataType=r.TextureDataType.FLOAT,i.minFilter=r.TextureConst.NEAREST,i.magFilter=r.TextureConst.NEAREST,l.default.IsWebGL1()&&(i.dataType=r.TextureDataType.HALF_FLOAT_OES),this.JU[t].__$setRenderProxy(this.t),i}}e.RTTTextureStore=_,e.default=_},cfaf:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class h extends a.default{constructor(t,e,s=!1){super(t,e,s),this.AD=r.TextureProxyType.RTT,this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST}to2DTexture(){this.AA=r.TextureTarget.TEXTURE_2D}enableMipmap(){this.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,this.magFilter=r.TextureConst.LINEAR,this.mipmapEnabled=!0}disableMipmap(){this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.mipmapEnabled=!1}toCubeTexture(){this.AA=r.TextureTarget.TEXTURE_CUBE}setSize(t,e){this.w=t,this.x=e}uploadFromFbo(t,e,s){let i=t.getRC(),a=this.mipmapEnabled;this.mipmapEnabled=!1,t.hasResUid(this.getResUid())?this.getBufWidth()==e&&this.getBufHeight()==s||(t.bindToGpu(this.getResUid()),this.bindTexture(i,e,s),this.w=e,this.x=s,this.__$buildParam(i)):(this.AB=r.TextureTarget.GetValue(i,this.AA),this.createTexBuf(t),t.bindToGpu(this.getResUid()),this.bindTexture(i,e,s),this.AC=!0,this.w=e,this.x=s,this.__$buildParam(i)),this.mipmapEnabled=a}bindTexture(t,e,s){let i=r.TextureFormat.ToGL(t,this.internalFormat),a=r.TextureFormat.ToGL(t,this.srcFormat),h=r.TextureDataType.ToGL(t,this.dataType);switch(this.AA){case r.TextureTarget.TEXTURE_2D:t.texImage2D(t.TEXTURE_2D,0,i,e,s,0,a,h,null);break;case r.TextureTarget.TEXTURE_CUBE:for(let r=0;r<6;++r)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,i,e,s,0,a,h,null);break;case r.TextureTarget.TEXTURE_SHADOW_2D:t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT16,e,s,0,t.DEPTH_COMPONENT,t.FLOAT,null);break;default:break}}toString(){return"[RTTTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=h},d1a0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01"));class a{static PlaneCalcIntersectSphere(t,e,s,i){a.IntersectBoo=!1,a.IntersectSatus=0,e=t.dot(s)-e,e>r.default.MATH_MIN_POSITIVE?(a.IntersectBoo=e<=i,a.IntersectSatus=1):e<r.default.MATH_MAX_NEGATIVE&&(a.IntersectBoo=-e<=i,a.IntersectSatus=-1)}static CalcPVCloseV(t,e,s,i){let r=e-s.dot(t);i.setTo(r*t.x,r*t.y,r*t.z),i.addBy(s)}static CalcPVCloseV2(t,e,s,i){let r=e-s.dot(t);i.setTo(r*t.x,r*t.y,r*t.z),i.addBy(s)}static IntersectionSLV2(t,e,s,i,a){let h=t.dot(i);if(h>r.default.MATH_MIN_POSITIVE||h<r.default.MATH_MAX_NEGATIVE){let r=t.dot(s)-e;return a.x=1e5*i.x+s.x,a.y=1e5*i.y+s.y,a.z=1e5*i.z+s.z,h=t.dot(a)-e,h=r/(r-h),a.subtractBy(s),a.scaleBy(h),a.addBy(s),1}return h=t.dot(s)-e,h<=r.default.MATH_MIN_POSITIVE||h>=r.default.MATH_MAX_NEGATIVE?(a.copyFrom(s),2):0}}a.IntersectBoo=!1,a.IntersectSatus=0,e.default=a},d314:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class h extends a.default{constructor(t,e){super(t,e,!1),this.D4=null,this.AA=r.TextureTarget.TEXTURE_CUBE,this.AD=r.TextureProxyType.ImageCube,this.internalFormat=r.TextureFormat.RGBA,this.srcFormat=r.TextureFormat.RGBA,this.dataType=r.TextureDataType.UNSIGNED_BYTE,this.mipmapEnabled=!0}setDataFromImageToFaceAt(t,e,s=0){null!=e&&(null==this.D4&&(this.D4=[null,null,null,null,null,null]),e.width>0&&e.height>0&&(0==t&&(this.w=e.width,this.x=e.height,this.v=s),this.D4[t]={imgData:e,miplevel:s},this.AC=null!=this.D4[t]))}uploadData(t){let e=t.getRC(),s=null;for(let i=0;i<6;++i)s=this.D4[i],e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,this.v,r.TextureFormat.ToGL(e,this.internalFormat),r.TextureFormat.ToGL(e,this.srcFormat),r.TextureDataType.ToGL(e,this.dataType),s.imgData)}toString(){return"[ImageCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.D4)for(let t=0;t<6;++t)null!=this.D4[t]&&(this.D4[t].imgData=null);super.__$destroy()}}}e.default=h},d53d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.uns="",this.program=null,this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataSizeList=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,s=e.length;for(let i=0;i<s;++i)if(t==e[i])return this.dataList[i]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let s=this.uniformNameList,i=s.length;for(let r=0;r<i;++r)if(t==s[r]){this.dataList[r]=e;break}}}copyDataFromProbe(t){this.types=[],this.dataSizeList=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]),this.dataSizeList.push(t.dataSizeList[e]);this.uniformSize=t.uniformsTotal}useByLocation(t,e,s,i){}useByShd(t,e){}use(t){}updateData(){}destroy(){}}e.ShaderUniform=i;class r extends i{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV1(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e])}useByLocation(t,e,s,i){t.useUniformV1(s,e,this.dataList[i],this.dataSizeList[i])}useByShd(t,e){let s=0;for(;s<this.uniformSize;++s)t.useUniformV1(e.getUniformLocationByNS(this.uniformNameList[s]),this.types[s],this.dataList[s],this.dataSizeList[s])}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let s=0;s<t;++s)e=this.calcModels[s],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null}}e.ShaderUniformV1=r;class a extends i{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV2(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e],0)}useByLocation(t,e,s,i){t.useUniformV2(s,e,this.dataList[i],this.dataSizeList[i],0)}useByShd(t,e){let s=0;for(;s<this.uniformSize;++s)t.useUniformV2(e.getUniformLocationByNS(this.uniformNameList[s]),this.types[s],this.dataList[s],this.dataSizeList[s],0)}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let s=0;s<t;++s)e=this.calcModels[s],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null,this.program=null}}e.ShaderUniformV2=a;class h extends i{constructor(){super()}use(t){t.useUniformMat4(this.locations[0],this.dataList[0])}useByLocation(t,e,s,i){t.useUniformMat4(s,this.dataList[0])}useByShd(t,e){t.useUniformMat4(e.getUniformLocationByNS(this.uniformNameList[0]),this.dataList[0])}destroy(){this.dataList[0]=null,this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null}}e.ShaderMat4Uniform=h,e.default=i},d7e2:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(t){this.Be=null,this.Be=t}sortRODisplay(t,e){let s=this.Be.getCamera().getPosition();for(let i=0;i<e;++i)t[i].value=-r.default.DistanceSquared(t[i].bounds.center,s);return 0}}e.default=a},d958:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("11e6")),a=i(s("36cb")),h=i(s("c497")),n=i(s("3c81")),l=i(s("1e15")),_=i(s("0e01")),m=s("eca0"),o=i(s("442e")),u=i(s("1264"));class d{constructor(){this.___$$$$$$$Author="VilyLei(vily313@126.com)",this.r=-1,this.JW=null,this.JX=[],this.JY=0,this.JZ=[],this.Ja=0,this.t=null,this.Aq=null,this.BQ=null,this.Jb=null,this.DZ=!0,this.Jc=!0,this.BP=new m.RPOUnitBuilder,this.DX=new o.default,this.BR=new n.default,this.DK=null,this.Cm=null,this.Jd=null,this.r=d.Kh++,this.Jb=new _.default(this.r)}__$setStage3D(t){null!=t&&null==this.Cm&&(this.Cm=t)}getUid(){return this.r}getRCUid(){return this.r}getRPONodeBuilder(){return this.DX}getDataBuilder(){return this.BQ}getRendererContext(){return this.Jb}getRenderProxy(){return null!=this.t||(this.t=this.Jb.getRenderProxy()),this.t}getStage3D(){return this.t.getStage3D()}getViewX(){return this.Aq.getViewportX()}getViewY(){return this.Aq.getViewportY()}getViewWidth(){return this.Aq.getViewportWidth()}getViewHeight(){return this.Aq.getViewportHeight()}getCamera(){return this.Jb.getCamera()}createCamera(){return null}useCamera(t,e=!1){}useMainCamera(){}updateCamera(){null!=this.t&&this.t.updateCamera()}initialize(t=null,e=null){null==this.BQ&&null!=e&&(null==t&&(t=new h.default),this.DZ=t.batchEnabled,this.Jc=t.processFixedState,this.t=this.Jb.getRenderProxy(),this.BQ=new a.default,this.DK=new l.default,this.Jb.setCameraParam(t.camProjParam.x,t.camProjParam.y,t.camProjParam.z),this.Jb.initialize(t,e,this.Cm,this.BQ,this.DK),this.Aq=this.t.getRenderAdapter(),this.r=this.t.getUid(),this.BQ.initialize(this.t,this.BP,this.BR,this.DK),this.Jb.initManager(this.BQ),this.JW=new u.default(this.r,this.BQ,this.BP,this.BR),this.Jd=this.createSeparatedProcess(),this.appendProcess(this.DZ,this.Jc))}update(){this.t.Texture.update(),this.t.Vertex.update(),this.JW.update()}updateAllProcess(){for(let t=0;t<this.JY;++t)this.JX[t].update()}updateProcessAt(t){t>-1&&t<this.JY&&this.JX[t].update()}setEntityManaListener(t){this.JW.entityManaListener=t}addEntity(t,e=0,s=!0){null!=t&&t.__$testRendererEnabled()&&e>-1&&e<this.JY&&this.JW.addEntity(t,this.JX[e].getUid(),s)}addEntityToProcess(t,e,s=!0){null!=e&&null!=t&&t.__$testRendererEnabled()&&e.getRCUid()==this.r&&this.JW.addEntity(t,e.getUid(),s)}moveEntityToProcessAt(t,e){if(null!=t&&t.getRendererUid()==this.r&&t.isRenderEnabled()&&e>-1&&e<this.JY){let s=t.getDisplay().__$$runit.getRPROUid(),i=this.BR.getNodeByUid(s),a=this.JX[e];i!=a&&(i.removeDispUnit(t.getDisplay()),t.__$rseFlag=a.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),a.addDisp(t.getDisplay()))}}moveEntityToProcess(t,e){if(null!=e&&null!=t&&t.getRendererUid()==this.r&&t.isRenderEnabled()){let s=t.getDisplay().__$$runit.getRPROUid(),i=this.BR.getNodeByUid(s);if(i!=e){let s=e;i.removeDispUnit(t.getDisplay()),t.__$rseFlag=e.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),s.addDisp(t.getDisplay())}}}removeEntity(t){null!=t&&t.getRendererUid()==this.r&&(this.JW.removeEntity(t),t.__$setRenderProxy(null))}removeEntityFromProcess(t,e){null!=e&&e.getRCUid()==this.r&&null!=t&&t.getRendererUid()==this.r&&(e.removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}removeEntityByProcessIndex(t,e){e>=0&&e<this.JY&&null!=t&&t.getRendererUid()==this.r&&(this.JX[e].removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}setProcessSortEnabledAt(t,e){t>=0&&t<this.JY&&this.JX[t].setSortEnabled(e)}setProcessSortEnabled(t,e){if(null!=t&&t.getRCUid()==this.r){let s=t;s.setSortEnabled(e)}}appendProcess(t=!0,e=!1){this.BR.setCreateParams(this.BQ.getRenderShader(),this.DX,this.BP,this.t.Vertex,t,e);let s=this.BR.create();return this.JX.push(s),s.setRendererParam(this.t,this.JY),++this.JY,s}createSeparatedProcess(t=!0,e=!1){this.BR.setCreateParams(this.BQ.getRenderShader(),this.DX,this.BP,this.t.Vertex,t,e);let s=this.BR.create();return this.JZ.push(s),s.setRendererParam(this.t,this.Ja),s}setRendererProcessParam(t,e,s){t>-1&&t<this.JY&&this.JX[t].setRenderParam(e,s)}getProcessAt(t){return t>-1&&t<this.JY?this.JX[t]:null}showInfoAt(t){t>-1&&t<this.JY&&this.JX[t].showInfo()}getProcessesTotal(){return this.JY}updateMaterialUniformToCurrentShd(t){this.BQ.getRenderShader().useUniformToCurrentShd(t.__$uniform)}drawEntityByLockMaterial(t,e=!1,s=!0){null!=t&&t.getVisible()&&t.getRendererUid()==this.r&&!this.t.isContextLost()&&this.Jd.drawLockMaterialByDisp(t.getDisplay(),e,s)}drawEntity(t,e=!1,s=!0){null!=t&&t.getVisible()&&!this.t.isContextLost()&&(t.getRendererUid()==this.r?this.Jd.drawDisp(t.getDisplay(),e,s):t.__$testRendererEnabled()&&this.JW.addEntity(t,this.Jd.getUid(),!1))}runAt(t){this.t.isContextLost()||this.JX[t].run()}runProcess(t){t.getRCUid()!=this.r||this.t.isContextLost()||t.run()}runFromIndexTo(t){if(!this.t.isContextLost())for(let e=t;e<this.JY;++e)this.JX[e].run()}run(){if(this.JW.isHaveEntity()&&!this.t.isContextLost())for(let t=0;t<this.JY;++t)this.JX[t].run()}getRenderUnitsTotal(){let t=0;for(let e=0;e<this.JY;++e)t+=this.JX[e].getUnitsTotal();return t}renderflush(){this.t.flush()}toString(){return"[RendererInstance(uid = "+this.r+")]"}}d.Kh=0,e.RendererInstance=d,e.default=d},da6a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){if(this.A1=null,this.Je=null,this.Jf=0,this.Jg=new Map,this.FU=new Map,this.Jh=0,this.Ji=[],null!=i.LQ)throw Error("This Class is a singleton class!!!");i.LQ=null}static GetInstance(){return null!=i.LQ||(i.LQ=new i),i.LQ}getFreeUid(){if(this.Ji.length>0)return this.Ji.pop();let t=this.Jh++;return t}__$$addTexture(t){null==t||this.Jg.has(t.getUid())||(this.Jg.set(t.getUid(),t),this.Jf++)}getTextureByUid(t){return this.Jg.get(t)}hasTextureByUid(t){return this.Jg.has(t)}removeTextureByUid(t){if(this.Jg.has(t)){let e=this.Jg.get(t);if(e.getAttachCount()<1)return this.FU.has(t)&&this.FU.delete(t),e.__$destroy(),e.__$$removeFromSlot(),this.Jg.delete(t),this.Ji.push(t),this.Jf--,e}return null}getTextureTotal(){return this.Jf}setRenderProxy(t){this.A1=t.Texture}setBufferUpdater(t){this.Je=t}getFreeResUidMap(){return this.FU}isGpuEnabledByResUid(t){return this.A1.hasResUid(t)}addRenderBuffer(t,e){null!=this.Je&&this.Je.__$addBuf(t,e)}addFreeUid(t){this.FU.set(t,0)}removeFreeUid(t){this.FU.has(t)&&this.FU.delete(t)}}i.LQ=null,e.default=i},dc2b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("e08e"),a=i(s("29ef"));class h{constructor(){this.r=0,this.Jj=null,this.Jk=null,this.name="RODisplay",this.visible=!0,this.ivsIndex=0,this.ivsCount=0,this.trisNumber=0,this.insCount=0,this.drawMode=r.RenderDrawMode.ELEMENTS_TRIANGLES,this.vbuf=null,this.renderState=a.default.NORMAL_STATE,this.rcolorMask=a.default.COLOR_MASK_ALL_TRUE,this.mouseEnabled=!1,this.Jl=null,this.Jm=null,this.__$ruid=-1,this.__$rpuid=-1,this.__$$rsign=r.DisplayRenderSign.NOT_IN_WORLD,this.__$$runit=null,this.r=h.Kh++}getPartGroup(){return this.Jl}createPartGroup(t){t<1&&(t=1),this.Jl=new Uint16Array(2*t)}setDrawPartAt(t,e,s){t*=2,this.Jl[t]=s,this.Jl[++t]=e}getUid(){return this.r}setTransform(t){this.Jm=t,this.Jk=t.getLocalFS32()}getTransform(){return this.Jm}getMatrixFS32(){return this.Jk}enableDrawInstanced(t,e){this.drawMode=r.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES,this.ivsIndex=t,this.insCount=e}disableDrawInstanced(){this.drawMode=r.RenderDrawMode.ELEMENTS_TRIANGLES}getMaterial(){return this.Jj}setMaterial(t){null!=this.Jj&&this.Jj!=t&&(this.Jj.__$detachThis(),null!=t&&t.__$attachThis()),this.Jj=t}copyFrom(t){this.vbuf=t.vbuf,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.setMaterial(t.getMaterial())}toString(){return"RODisplay(name="+this.name+",uid="+this.getUid()+", __$ruid="+this.__$ruid+")"}destroy(){null!=this.Jj&&(this.Jj.__$detachThis(),this.Jj.destroy(),this.Jj=null),this.Jk=null,this.vbuf=null,this.__$ruid=-1,this.__$rpuid=-1,this.__$$rsign=r.DisplayRenderSign.NOT_IN_WORLD,this.ivsIndex=0,this.ivsCount=0,this.Jl=null,this.__$$runit=null}static GetFreeId(){return h.Al.length>0?h.Al.pop():-1}static GetByUid(t){return h.Am[t]}static IsEnabledByUid(t){return h.An[t]==h.S_FLAG_BUSY}static Create(){let t=null,e=h.GetFreeId();return e>=0?(t=h.Am[e],h.An[e]=h.S_FLAG_BUSY):(t=new h,h.Am.push(t),h.An.push(h.S_FLAG_BUSY),h.Ao++),t}static Restore(t){if(null!=t&&h.An[t.getUid()]==h.S_FLAG_BUSY){let e=t.getUid();h.Al.push(e),h.An[e]=h.S_FLAG_FREE,t.destroy()}}}h.Kh=0,h.S_FLAG_BUSY=1,h.S_FLAG_FREE=0,h.An=[],h.Ao=0,h.Am=[],h.Al=[],e.default=h},de9d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("722e")),a=i(s("8333")),h=i(s("6e01")),n=i(s("8e17")),l=s("7c63"),_=i(s("090c")),m=i(s("1216")),o=i(s("56c5")),u=i(s("030e")),d=i(s("74c3")),c=i(s("984e")),f=i(s("29ef")),p=i(s("3077"));class g{constructor(t){this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.RState=null,this.Vertex=null,this.Texture=null,this.VtxBufUpdater=null,this.MaterialUpdater=null,this.r=0,this.Jn=null,this.Aq=null,this.Jo=new _.default,this.Be=null,this.E3=!0,this.B=0,this.C=0,this.D=800,this.E=600,this.As=.1,this.At=5e3,this.Au=45,this.AR=2,this.Jp=2,this.Y=null,this.Jq=!1,this.Jr=!0,this.Js=!0,this.r=t}getRC(){return this.Be}getUid(){return this.r}getRCUid(){return this.r}isAutoSynViewAndStage(){return this.Jr}enableSynViewAndStage(){this.Jr=!0}lockViewport(){this.Aq.lockViewport()}unlockViewport(){this.Aq.unlockViewport()}getDiv(){return this.Aq.getDiv()}getCanvas(){return this.Aq.getCanvas()}cameraLock(){this.Y.lock()}cameraUnlock(){this.Y.unlock()}getCamera(){return this.Y}updateCamera(){return this.Y.update()}createCameraUBO(t){}updateCameraDataFromCamera(t){null!=t&&(this.Jq||t!=this.Y)&&(this.Jq=t!=this.Y,t.updateCamMatToUProbe(this.Y.matUProbe),null!=this.Jn&&(this.Jn.setSubDataArrAt(0,t.matUProbe.getFS32At(0)),this.Jn.setSubDataArrAt(16,t.matUProbe.getFS32At(1))))}useCameraData(){null!=this.Jn&&this.Jn.run()}getActiveAttachmentTotal(){return this.Aq.getActiveAttachmentTotal()}drawInstanced(t,e,s){2==this.Jp?this.Be.drawElementsInstanced(this.TRIANGLES,t,this.UNSIGNED_SHORT,e,s):u.default.ANGLE_instanced_arrays.drawElementsInstancedANGLE(this.TRIANGLES,t,e,s)}createUBOBufferByBytesCount(t){let e=this.Be.createBuffer();return this.Be.bindBuffer(this.Be.UNIFORM_BUFFER,e),this.Be.bufferData(this.Be.UNIFORM_BUFFER,t,this.Be.DYNAMIC_DRAW),e}createUBOBufferByDataArray(t){let e=this.Be.createBuffer();return this.Be.bindBuffer(this.Be.UNIFORM_BUFFER,e),this.Be.bufferData(this.Be.UNIFORM_BUFFER,t,this.Be.DYNAMIC_DRAW),e}bindUBOBuffer(t){this.Be.bindBuffer(this.Be.UNIFORM_BUFFER,t)}deleteUBOBuffer(t){this.Be.deleteBuffer(t)}bufferDataUBOBuffer(t){this.Be.bufferData(this.Be.UNIFORM_BUFFER,t,this.Be.STATIC_DRAW)}bindBufferBaseUBOBuffer(t,e){this.Be.bindBufferBase(this.Be.UNIFORM_BUFFER,t,e)}setWebGLMaxVersion(t){1!=t&&2!=t||(this.AR=t)}getContext(){return this.Jo}getStage3D(){return this.Jo.getStage()}getRenderAdapter(){return this.Aq}getRenderContext(){return this.Aq.getRenderContext()}setCameraParam(t,e,s){this.Au=t,this.As=e,this.At=s}getMouseXYWorldRay(t,e){let s=this.Jo.getStage();this.Y.getWorldPickingRayByScreenXY(s.mouseX,s.mouseY,t,e)}testViewPortChanged(t,e,s,i){return this.B!=t||this.C!=e||this.D!=s||this.E!=i}testRCViewPortChanged(t,e,s,i){return this.Jo.testViewPortChanged(t,e,s,i)}getViewX(){return this.B}getViewY(){return this.C}getViewWidth(){return this.D}getViewHeight(){return this.E}setViewPort(t,e,s,i){this.Jr=!1,this.B=t,this.C=e,this.D=s,this.E=i;let r=this.Jo.getStage();null!=r&&(r.setViewPort(s,e,s,i),null!=this.Y&&(this.Y.setViewXY(this.B,this.C),this.Y.setViewSize(this.D,this.E))),this.Jo.setViewport(this.B,this.C,this.D,this.E)}setRCViewPort(t,e,s,i,r=!1){this.Jr=r,this.Jo.setViewport(t,e,s,i)}reseizeRCViewPort(){this.Aq.unlockViewport(),this.Aq.reseizeViewPort()}resizeCallback(){this.Jr&&(this.B=0,this.C=0,this.D=this.Jo.getRCanvasWidth(),this.E=this.Jo.getRCanvasHeight(),this.createMainCamera(),this.Jo.setViewport(this.B,this.C,this.D,this.E),this.Y.setViewXY(this.B,this.C),this.Y.setViewSize(this.D,this.E))}createMainCamera(){this.Js&&(this.Js=!1,this.Y.uniformEnabled=!0,this.E3?this.Y.perspectiveRH(h.default.DegreeToRadian(this.Au),this.D/this.E,this.As,this.At):this.Y.orthoRH(this.As,this.At,-.5*this.E,.5*this.E,-.5*this.D,.5*this.D),this.Y.setViewXY(this.B,this.C),this.Y.setViewSize(this.D,this.E))}readPixels(t,e,s,i,r,a,h){this.Aq.readPixels(t,e,s,i,r,a,h)}getGLVersion(){return this.Jp}initialize(t,e,s,i,h,l){if(null!=this.Be)return;this.Y=e,null==e.matUProbe&&(e.matUProbe=new p.default,e.matUProbe.bindSlotAt(this.r),e.matUProbe.addMat4Data(new Float32Array(16),1),e.matUProbe.addMat4Data(new Float32Array(16),1)),null==e.ufrustumProbe&&(e.ufrustumProbe=new p.default,e.ufrustumProbe.bindSlotAt(this.r),e.ufrustumProbe.addVec4Data(new Float32Array([e.getZNear(),e.getZFar(),.5*e.getNearPlaneWidth(),.5*e.getNearPlaneHeight()]),1)),null==e.ucameraPosProbe&&(e.ucameraPosProbe=new p.default,e.ucameraPosProbe.bindSlotAt(this.r),e.ucameraPosProbe.addVec4Data(new Float32Array([500,500,500,1]),1));let _=t.camPosition,g=t.camLookAtPos,T=t.camUpDirect;null==_&&(_=new n.default(500,500,500)),null==g&&(g=new n.default(0,0,0)),null==T&&(T=new n.default(0,1,0)),this.E3=t.cameraPerspectiveEnabled,this.Jo.autoSyncRenderBufferAndWindowSize=t.autoSyncRenderBufferAndWindowSize,this.Jo.setResizeCallback(this,this.resizeCallback),this.Jo.setWebGLMaxVersion(this.AR),this.Jo.initialize(this.r,s,t.getDiv(),t.getRenderContextAttri()),this.Jp=this.Jo.getWebGLVersion(),this.Be=this.Jo.getRC(),f.default.Initialize(),f.default.Rstate.setRenderContext(this.Jo);let v=this,x=this.Be,E=new d.default(this.r,x,l),y=new c.default(this.r,x);if(v.Vertex=E,v.Texture=y,v.MaterialUpdater=i,v.VtxBufUpdater=h,this.D=this.Jo.getViewportWidth(),this.E=this.Jo.getViewportHeight(),this.Aq=new m.default(this.r,y),this.Aq.initialize(this.Jo,t,f.default.Rstate),this.Jr){let t=this.Jo.getStage();null!=t&&(this.D=t.stageWidth,this.E=t.stageHeight)}this.createMainCamera(),this.Jo.setViewport(this.B,this.C,this.D,this.E),this.Y.lookAtRH(_,g,T),this.Y.update(),this.Aq.bgColor.setRGB3f(0,0,0),v.RGBA=x.RGBA,v.UNSIGNED_BYTE=x.UNSIGNED_BYTE,v.TRIANGLE_STRIP=x.TRIANGLE_STRIP,v.TRIANGLE_FAN=x.TRIANGLE_FAN,v.TRIANGLES=x.TRIANGLES,v.LINES=this.Be.LINES,v.LINE_STRIP=x.LINE_STRIP,v.UNSIGNED_SHORT=x.UNSIGNED_SHORT,v.UNSIGNED_INT=x.UNSIGNED_INT,v.COLOR=x.COLOR,v.DEPTH=x.DEPTH,v.STENCIL=x.STENCIL,v.DEPTH_STENCIL=x.DEPTH_STENCIL,this.Jp>1?(v.MIN=x.MIN,v.MAX=x.MAX):(v.MIN=u.default.EXT_blend_minmax.MIN_EXT,v.MAX=u.default.EXT_blend_minmax.MAX_EXT);let S=r.default;S.NEAREST=x.NEAREST,S.LINEAR=x.LINEAR,S.LINEAR_MIPMAP_LINEAR=x.LINEAR_MIPMAP_LINEAR,S.NEAREST_MIPMAP_NEAREST=x.NEAREST_MIPMAP_NEAREST,S.LINEAR_MIPMAP_NEAREST=x.LINEAR_MIPMAP_NEAREST,S.NEAREST_MIPMAP_LINEAR=x.NEAREST_MIPMAP_LINEAR;let A=a.default;A.COLOR_BUFFER_BIT=x.COLOR_BUFFER_BIT,A.DEPTH_BUFFER_BIT=x.DEPTH_BUFFER_BIT,A.STENCIL_BUFFER_BIT=x.STENCIL_BUFFER_BIT,o.default.SetRenderer(this.Jo),v.RState=f.default.Rstate,v.RContext=this.Be}flush(){this.Be.flush()}setClearRGBColor3f(t,e,s){this.Aq.bgColor.setRGB3f(t,e,s)}setClearColor(t){this.Aq.bgColor.copyFrom(t)}setClearUint24Color(t,e){this.Aq.bgColor.setRGBUint24(t),this.Aq.bgColor.a=e}setClearRGBAColor4f(t,e,s,i){this.Aq.bgColor.setRGBA4f(t,e,s,i)}getClearRGBAColor4f(t){t.copyFrom(this.Aq.bgColor)}getViewportWidth(){return this.Aq.getViewportWidth()}getViewportHeight(){return this.Aq.getViewportHeight()}setRenderToBackBuffer(){this.Aq.setRenderToBackBuffer()}clearBackBuffer(){this.Aq.clear()}renderBegin(){this.Y.update(),this.Aq.renderBegin()}renderEnd(){}useRenderStateByName(t){l.RenderStateObject.UseRenderStateByName(t)}setScissorEnabled(t){this.Jo.setScissorEnabled(t)}setScissorRect(t,e,s,i){this.Jo.setScissorRect(t,e,s,i)}useRenderColorMask(t){l.RenderColorMask.UseRenderState(t)}unlockRenderColorMask(){l.RenderColorMask.Unlock()}lockRenderColorMask(){l.RenderColorMask.Lock()}useRenderState(t){l.RenderStateObject.UseRenderState(t)}unlockRenderState(){l.RenderStateObject.Unlock()}lockRenderState(){l.RenderStateObject.Lock()}setFrontFaceFlipped(t){this.Aq.setFrontFaceFlipped(t)}setPolygonOffset(t,e=0){this.Aq.setPolygonOffset(t,e)}resetPolygonOffset(){this.Aq.resetPolygonOffset()}loseContext(){this.Aq.loseContext()}isContextLost(){return this.Aq.isContextLost()}setViewProbeValue(t,e,s,i){this.Aq.setViewProbeValue(t,e,s,i)}toString(){return"[Object RenderProxy()]"}}e.default=g},df25:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("68aa")),h=i(s("0851"));class n extends h.default{constructor(t,e,s=!1){super(t,e,s),this.EG=null,this.Jt=null,this.EQ=0,this.EO=null,this.EP=null,this.minFilter=r.TextureConst.LINEAR}setDataFromBytes(t,e=0,s=-1,i=-1,r=0,h=0,n=!1){if(null!=t&&s>0&&i>0){e<0&&(e=0),e>15&&(e=15),e>=this.EQ&&(this.EQ=e+1),this.AC=!0;let l=this.EO;null!=l?this.EO.miplevel!=e&&(null==this.EP&&(this.EP=[this.EO,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),l=this.EP[e],null==l&&(l=a.default.Create(),l.miplevel=e,n=!0,this.EP[e]=l)):(this.EO=l=a.default.Create(),l.miplevel=e,n=!0),l.data==t&&l.offsetx==r&&l.offsety==h||(0==e&&(this.w=s,this.x=i,this.EG=t),l.data=t,l.status=0,(l.width<s||l.height<i||n)&&(l.width=s,l.height=i,l.status=1),l.offsetx=r,l.offsety=h),this.version++}}uploadData(t){null!=this.EO&&this.dataUploadToGpu(t.getRC(),this.EO,this.EP,!0)}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())){let e=t.getRC(),s=null!=this.Jt?this.Jt.length:0;if(this.__$updateToGpuBegin(t),s>0){let t=0,i=null,h=r.TextureFormat.ToGL(e,this.internalFormat),n=r.TextureFormat.ToGL(e,this.srcFormat),l=r.TextureDataType.ToGL(e,this.dataType);for(;t<s;++t)i=this.Jt.pop(),i.updateToGpu(e,this.AB,h,n,l,!1),a.default.Restore(i)}null!=this.EO&&(this.dataUploadToGpu(e,this.EO,this.EP),this.__$buildParam(e),this.AE=!0),this.__$updateToGpuEnd(e)}}setPartDataFromeBytes(t,e,s,i,r,h=0){null==this.Jt&&(this.Jt=[]);let n=a.default.Create();n.data=t,n.status=0,n.miplevel=h,n.offsetx=e,n.offsety=s,n.width=i,n.height=r,this.Jt.push(n),this.version++}getPixels(t,e,s,i,a){if(null!=this.EG&&null!=a){let h=this.unpackAlignment,n=s*i*h;if(a.length==n){let l=e,_=t,m=l+i,o=_+s,u=0;switch(this.srcFormat){case r.TextureFormat.ALPHA:for(;l<m;++l)for(_=t;_<o;++_)n=l*this.w+_,a[u]=this.EG[n],u++;break;case r.TextureFormat.RGBA:for(;l<m;++l)for(_=t;_<o;++_)n=(l*this.w+_)*h,a[u]=this.EG[n],a[u+1]=this.EG[n+1],a[u+2]=this.EG[n+2],a[u+3]=this.EG[n+3],u++;break;case r.TextureFormat.RGB:for(;l<m;++l)for(_=t;_<o;++_)n=(l*this.w+_)*h,a[u]=this.EG[n],a[u+1]=this.EG[n+1],a[u+2]=this.EG[n+2],u++;break;default:break}}}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.EP){for(let t=0;t<this.EQ;++t)a.default.Restore(this.EP[t]);this.EQ=0,this.EP=null,this.EO=null}null!=this.EO&&(a.default.Restore(this.EO),this.EO=null),this.EG=null,super.__$destroy()}}toString(){return"[RawDataTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},df9d:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.r=-1,this.Cd=null,this.Ce=null,this.Ju=new Map,this.Jv=new Map,this.Jw=1,this.Jx=0,this.Jy=[],this.Jz=[],this.J0=[],this.J1=[],this.J2=0,this.J3=[],this.J4=[],this.J5=[],this.q=[],this.Az=0,this.r=i.Kh++}getFreeVtxId(){return this.J0.length>0?this.J0.pop():-1}getVtxIndex(){let t=-1,e=this.getFreeVtxId();return e>=0?(t=e,this.J1[e]=0,this.Jy[e]=this.Jw):(t=this.J2,this.J1.push(0),this.Jz.push(this.Jx),this.Jy.push(this.Jw),this.J2++),t}restoreVtxIndex(t){this.Jy[t]==this.Jw&&(this.J0.push(t),this.Jy[t]=this.Jx,this.J1[t]=0)}attachVtxAt(t){++this.J1[t]}detachVtxAt(t){this.J1[t]>0&&(--this.J1[t],this.J1[t]<1&&this.restoreVtxIndex(t))}getVtxTotalAt(t){return this.J1[t]}getFreeTexId(){return this.J5.length>0?this.J5.pop():-1}getTexIndex(){let t=-1,e=this.getFreeTexId();return e>=0?(t=e,this.q[e]=0,this.J3[e]=this.Jw):(t=this.Az,this.q.push(0),this.J4.push(this.Jx),this.J3.push(this.Jw),this.Az++),t}restoreTexIndex(t){this.J3[t]==this.Jw&&(this.J5.push(t),this.J3[t]=this.Jx,this.q[t]=0)}attachTexAt(t){++this.q[t]}detachTexAt(t){this.q[t]>0&&(--this.q[t],this.q[t]<1&&this.restoreTexIndex(t))}getTexTotalAt(t){return this.q[t]}destroy(){this.clear()}clear(){this.Cd=this.Ce=null,this.Ju=new Map,this.Jv=new Map,this.Jy=[],this.Jz=[],this.J1=[],this.J0=[],this.J2=0,this.J3=[],this.J4=[],this.q=[],this.J5=[],this.Az=0}getBegin(){return this.Cd}containsNode(t){let e=this.Ju.get(t.vtxUid);if(null!=e){let s=131*(31+e.rvroI);return s*=s+e.texMid,t.rtokey==s}return!1}addNodeAndSort(t){let e=this.Ju.get(t.vtxUid);if(null==e){this.Ju.set(t.vtxUid,t),t.rvroI=this.getVtxIndex(),this.attachVtxAt(t.rvroI);let e=131*(31+t.rvroI);e*=e+t.texMid,t.rtokey=e,t.rtroI=this.getTexIndex(),this.Jv.set(e,t.rtroI),this.attachTexAt(t.rtroI)}else{t.rvroI=e.rvroI,this.attachVtxAt(t.rvroI);let s=131*(31+t.rvroI);if(s*=s+t.texMid,this.Jv.has(s)?t.rtroI=this.Jv.get(s):(t.rtroI=this.getTexIndex(),this.Jv.set(s,t.rtroI)),t.rtokey=s,this.attachTexAt(t.rtroI),e!=this.Ce)if(e.texMid==t.texMid)e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;else while(null!=e){if(e.vtxUid!=t.vtxUid){e=e.prev,e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.texMid==t.texMid){e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.next==this.Ce){this.Ce.vtxUid!=t.vtxUid?(e.next.prev=t,t.next=e.next,t.prev=e,e.next=t):e=null;break}e=e.next}else e=null}null==e&&(null==this.Cd?this.Ce=this.Cd=t:null!=this.Ce.prev?(this.Ce.next=t,t.prev=this.Ce,this.Ce=t):(this.Cd.next=t,t.prev=this.Ce,this.Ce=t),this.Ce.next=null)}showInfo(){let t=this.getBegin();if(null!=t){let e="",s="",i="";while(null!=t)e+=t.vtxUid+",",s+=t.texMid+",",i+=t.ivsCount+",",t=t.next}}removeNodeAndSort(t){let e=this.Ju.get(t.vtxUid);e!=t?e=null:(this.Ju.set(t.vtxUid,null),null!=t.next&&t.next.vtxUid==t.vtxUid?this.Ju.set(t.vtxUid,t.next):null!=t.prev&&t.prev.vtxUid==t.vtxUid?this.Ju.set(t.vtxUid,t.prev):this.Ju.delete(t.vtxUid)),t==this.Cd?t==this.Ce?this.Cd=this.Ce=null:(this.Cd=t.next,this.Cd.prev=null):t==this.Ce?(this.Ce=t.prev,this.Ce.next=null):(t.next.prev=t.prev,t.prev.next=t.next),this.detachVtxAt(t.rvroI),this.detachTexAt(t.rtroI),t.prev=null,t.next=null}addNode(t){null==this.Cd?this.Ce=this.Cd=t:null!=this.Ce.prev?(this.Ce.next=t,t.prev=this.Ce,this.Ce=t):(this.Cd.next=t,t.prev=this.Ce,this.Ce=t),this.Ce.next=null}removeNode(t){t==this.Cd?t==this.Ce?this.Cd=this.Ce=null:(this.Cd=t.next,this.Cd.prev=null):t==this.Ce?(this.Ce=t.prev,this.Ce.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}i.Kh=0,e.default=i},e08e:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.ELEMENTS_TRIANGLES=1,i.ELEMENTS_TRIANGLE_STRIP=2,i.ELEMENTS_TRIANGLE_FAN=3,i.ELEMENTS_INSTANCED_TRIANGLES=4,i.ARRAYS_LINES=5,i.ARRAYS_LINE_STRIP=6,i.ARRAYS_POINTS=7,i.ELEMENTS_LINES=8,i.DISABLE=0,e.RenderDrawMode=i;class r{}r.NORMAL=1,r.OPAQUE=1,r.TRANSPARENT=2,r.ALPHA_ADD=3,r.ADD=4,r.ADD_LINEAR=5,r.INVERSE_ALPHA=6,r.BLAZE=7,r.OVERLAY=8,r.OVERLAY2=8,r.DISABLE=0,e.RenderBlendMode=r;class a{}a.NEVER=1,a.LESS=1,a.EQUAL=1,a.GREATER=1,a.NOTEQUAL=1,a.GEQUAL=1,a.ALWAYS=1,e.GLStencilFunc=a;class h{}h.KEEP=1,h.ZERO=1,h.REPLACE=1,h.INCR=1,h.INCR_WRAP=1,h.DECR=1,h.DECR_WRAP=1,h.INVERT=1,e.GLStencilOp=h;class n{}n.ZERO=1,n.ONE=1,n.SRC_COLOR=1,n.DST_COLOR=1,n.SRC_ALPHA=1,n.DST_ALPHA=1,n.ONE_MINUS_SRC_ALPHA=1,e.GLBlendMode=n;class l{}l.FUNC_ADD=1,l.FUNC_SUBTRACT=1,l.FUNC_REVERSE_SUBTRACT=1,l.MIN_EXT=1,l.MAX_EXT=1,l.MIN=1,l.MAX=1,e.GLBlendEquation=l;class _{}_.BACK=1,_.FRONT=2,_.FRONT_AND_BACK=3,_.NONE=0,_.DISABLE=0,e.CullFaceMode=_;class m{}m.NEVER=1,m.ALWAYS=2,m.SKY=3,m.TRUE_LESS_EQUAL=3,m.OPAQUE=4,m.TRUE_LESS=4,m.OPAQUE_OVERHEAD=5,m.FALSE_EQUAL=5,m.FALSE_LESS=6,m.BLEND=6,m.BLEND_SORT=6,m.TRANSPARENT_SORT=6,m.TRUE_LEQUAL=7,m.WIRE_FRAME=7,m.FALSE_LEQUAL=8,m.DECALS=8,m.NEXT_LAYER=11,m.WIRE_FRAME_NEXT=12,m.TRUE_EQUAL=13,m.TRUE_GREATER=14,m.TRUE_GEQUAL=15,m.DISABLE=0,e.DepthTestMode=m;class o{}o.SCENE_RO_FILTER_BEGIN=1<<19,o.SCENE_RO_FILTER_FINISH=2<<19,o.SCENE_RO_ERASE=0,e.RenderConst=o,function(t){t[t["NOT_IN_WORLD"]=-1]="NOT_IN_WORLD",t[t["GO_TO_WORLD"]=1]="GO_TO_WORLD",t[t["LIVE_IN_WORLD"]=2]="LIVE_IN_WORLD"}(e.DisplayRenderSign||(e.DisplayRenderSign={}))},e214:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17")),h=i(s("f48d")),n=i(s("81c4"));class l extends h.default{constructor(){super(...arguments),this.nv=new a.default(0,1,0),this.distance=0,this.intersectBoo=!1}intersectStraightLinePos(t,e){let s=this.nv.dot(t.tv);if(s>r.default.MATH_MIN_POSITIVE||s<r.default.MATH_MAX_NEGATIVE){let i=this.nv.dot(t.position)-this.distance;return e.x=1e5*t.tv.x+t.position.x,e.y=1e5*t.tv.y+t.position.y,e.z=1e5*t.tv.z+t.position.z,s=this.nv.dot(e)-this.distance,s=i/(i-s),e.subtractBy(t.position),e.scaleBy(s),e.addBy(t.position),1}return s=this.nv.dot(t.position)-this.distance,s<=r.default.MATH_MIN_POSITIVE||s>=r.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),2):0}intersectStraightLinePos2(t,e,s){let i=this.nv.dot(e);if(i>r.default.MATH_MIN_POSITIVE||i<r.default.MATH_MAX_NEGATIVE){let r=this.nv.dot(t)-this.distance;return s.x=1e5*e.x+t.x,s.y=1e5*e.y+t.y,s.z=1e5*e.z+t.z,i=this.nv.dot(s)-this.distance,i=r/(r-i),s.subtractBy(t),s.scaleBy(i),s.addBy(t),1}return i=this.nv.dot(t)-this.distance,i<=r.default.MATH_MIN_POSITIVE||i>=r.default.MATH_MAX_NEGATIVE?(s.copyFrom(t),2):0}intersectRadialLinePos(t,e){let s=this.nv.dot(t.position)-this.distance;if(s>r.default.MATH_MIN_POSITIVE){let s=this.nv.dot(t.tv);if(s<0)return this.intersectStraightLinePos2(t.position,t.tv,e)}else{if(!(s<r.default.MATH_MAX_NEGATIVE)){let s=this.nv.dot(t.tv);return s>r.default.MATH_MIN_POSITIVE||s<r.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),1):(e.copyFrom(t.position),2)}{let s=this.nv.dot(t.tv);if(s>0)return this.intersectStraightLinePos2(t.position,t.tv,e)}}return-1}intersectRadialLinePos2(t,e,s){let i=this.nv.dot(t)-this.distance;if(i>r.default.MATH_MIN_POSITIVE){let i=this.nv.dot(e);if(i<0)return this.intersectStraightLinePos2(t,e,s)}else{if(!(i<r.default.MATH_MAX_NEGATIVE)){let i=this.nv.dot(e);return i>r.default.MATH_MIN_POSITIVE||i<r.default.MATH_MAX_NEGATIVE?(s.copyFrom(t),1):(s.copyFrom(t),2)}{let i=this.nv.dot(e);if(i>0)return this.intersectStraightLinePos2(t,e,s)}}return-1}containsPoint(t){let e=this.nv.dot(t)-this.distance;return e>r.default.MATH_MIN_POSITIVE?1:e<r.default.MATH_MAX_NEGATIVE?-1:0}intersectSphere(t,e){this.intersectBoo=!1;let s=this.nv.dot(t)-this.distance;return s>r.default.MATH_MIN_POSITIVE?(this.intersectBoo=s<=e,1):s<r.default.MATH_MAX_NEGATIVE?(this.intersectBoo=-s<=e,-1):0}intersectSphNegSpace(t,e){this.intersectBoo=Math.abs(this.nv.dot(t)-this.distance)<e}update(){this.nv.normalize()}updateFast(){this.nv.normalize()}static PlaneIntersectSphere(t,e,s,i){l.IntersectBoo=!1,l.IntersectSatus=0,e=t.dot(s)-e,e>r.default.MATH_MIN_POSITIVE?(l.IntersectBoo=e<=i,l.IntersectSatus=1):e<r.default.MATH_MAX_NEGATIVE&&(l.IntersectBoo=-e<=i,l.IntersectSatus=-1)}static CalcPVCloseV(t,e,s){let i=t.distance-e.dot(t.nv);s.setTo(i*t.nv.x,i*t.nv.y,i*t.nv.z),s.addBy(e)}static CalcPVCloseV2(t,e,s,i){let r=e-s.dot(t);i.setTo(r*t.x,r*t.y,r*t.z),i.addBy(s)}static IntersectionSLV2(t,e,s,i,a){let h=t.dot(i);if(h>r.default.MATH_MIN_POSITIVE||h<r.default.MATH_MAX_NEGATIVE){let r=t.dot(s)-e;return a.x=1e5*i.x+s.x,a.y=1e5*i.y+s.y,a.z=1e5*i.z+s.z,h=t.dot(a)-e,h=r/(r-h),a.subtractBy(s),a.scaleBy(h),a.addBy(s),1}return h=t.dot(s)-e,h<=r.default.MATH_MIN_POSITIVE||h>=r.default.MATH_MAX_NEGATIVE?(a.copyFrom(s),2):0}toString(){return"Plane(position="+this.position.toString()+", nv="+this.nv.toString()+")"}}l.IntersectBoo=!1,l.IntersectSatus=0;class _ extends l{constructor(){super(...arguments),this.v0=new a.default(100,0,0),this.v1=new a.default(0,0,-100),this.v2=new a.default(0,0,0),this.ls01=new n.default,this.ls12=new n.default,this.ls20=new n.default,this.radiusSquared=100}getRandomPosition(t){let e=this.ls01.length*Math.random();t.x=this.ls01.position.x+e*this.ls01.tv.x,t.y=this.ls01.position.y+e*this.ls01.tv.y,t.z=this.ls01.position.z+e*this.ls01.tv.z,e=this.ls12.length*Math.random(),t.x+=this.ls12.position.x+e*this.ls12.tv.x,t.y+=this.ls12.position.y+e*this.ls12.tv.y,t.z+=this.ls12.position.z+e*this.ls12.tv.z,e=this.ls20.length*Math.random(),t.x+=this.ls20.position.x+e*this.ls20.tv.x,t.y+=this.ls20.position.y+e*this.ls20.tv.y,t.z+=this.ls20.position.z+e*this.ls20.tv.z,t.x*=.33333,t.y*=.33333,t.z*=.33333}triIntersectStraightLinePos(t,e){let s=this.intersectStraightLinePos(t,e);return 1==s&&(s=this.triContainsPoint(e),s>0)?1:-1}triIntersectRadialLinePos(t,e){let s=this.intersectRadialLinePos(t,e);return 1==s&&(s=this.triContainsPoint(e),s>0)?1:-1}triIntersectStraightLinePos2(t,e,s){let i=this.intersectStraightLinePos2(t,e,s);return 1==i&&(i=this.triContainsPoint(s),i>0)?1:-1}triIntersectRadialLinePos2(t,e,s){let i=this.intersectStraightLinePos2(t,e,s);return 1==i&&(i=this.triContainsPoint(s),i>0)?1:-1}triContainsPoint(t){let e=this.nv.dot(t)-this.distance;return e>r.default.MATH_MIN_POSITIVE||e<r.default.MATH_MAX_NEGATIVE?-1:(h.default.__tV0.x=t.x-this.v0.x,h.default.__tV0.y=t.y-this.v0.y,h.default.__tV0.z=t.z-this.v0.z,a.default.Cross(this.ls01.tv,h.default.__tV0,h.default.__tV1),this.nv.dot(h.default.__tV1)<0?-1:(h.default.__tV0.x=t.x-this.v1.x,h.default.__tV0.y=t.y-this.v1.y,h.default.__tV0.z=t.z-this.v1.z,a.default.Cross(this.ls12.tv,h.default.__tV0,h.default.__tV1),this.nv.dot(h.default.__tV1)<0?-1:(h.default.__tV0.x=t.x-this.v2.x,h.default.__tV0.y=t.y-this.v2.y,h.default.__tV0.z=t.z-this.v2.z,a.default.Cross(this.ls20.tv,h.default.__tV0,h.default.__tV1),this.nv.dot(h.default.__tV1)<0?-1:1)))}update(){let t=1/3;this.position.x=t*(this.v0.x+this.v1.x+this.v2.x),this.position.y=t*(this.v0.y+this.v1.y+this.v2.y),this.position.z=t*(this.v0.z+this.v1.z+this.v2.z),this.nv.x=this.position.x-this.v0.x,this.nv.y=this.position.y-this.v0.y,this.nv.z=this.position.z-this.v0.z,this.radiusSquared=this.nv.getLengthSquared(),this.ls01.position.copyFrom(this.v0),this.ls01.anotherPosition.copyFrom(this.v1),this.ls12.position.copyFrom(this.v1),this.ls12.anotherPosition.copyFrom(this.v2),this.ls20.position.copyFrom(this.v2),this.ls20.anotherPosition.copyFrom(this.v0),this.ls01.update(),this.ls12.update(),this.ls20.update(),a.default.Cross(this.ls01.tv,this.ls12.tv,this.nv),this.nv.normalize(),this.distance=this.nv.dot(this.v0)}updateFast(){this.update()}}e.Triangle=_,e.default=l},e3f7:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("35fa")),a=i(s("8a0a")),h=i(s("e7d2")),n=i(s("cb29")),l=i(s("196c"));class _ extends n.default{constructor(t=a.default.VTX_STATIC_DRAW){super(t),this.BZ=null,this.Ba=null,this.DU=null,this.DV=null,this.J6=!1,this.geometry=new l.default,this.uScale=1,this.vScale=1}getCircleCenterAt(t,e){this.geometry.getCircleCenterAt(t,e),this.J6=!0}transformCircleAt(t,e){this.geometry.transformCircleAt(t,e),this.J6=!0}getVS(){return this.BZ}getUVS(){return this.Ba}getNVS(){return this.DU}getCVS(){return this.DV}getIVS(){return this.Bb}initialize(t,e,s,i,r=1,a=-.5){null==this.BZ&&(this.geometry.initialize(t,e,s,i,r,a),this.BZ=this.geometry.getVS(),this.Ba=this.geometry.getUVS(),this.Bb=this.geometry.getIVS(),this.wireframe&&this.updateWireframeIvs(),this.bounds=this.geometry.bounds,this.vtCount=this.geometry.vtCount,this.trisNumber=this.geometry.trisNumber),this.initializeBuf(!0)}reinitialize(){null!=this.BZ&&this.initializeBuf(!1)}initializeBuf(t){if(null!=this.d&&(this.J6=!0,this.d.transformVectorsSelf(this.BZ,this.BZ.length)),this.J6&&(this.bounds.reset(),this.bounds.addXYZFloat32Arr(this.BZ),this.bounds.updateFast()),this.J6=!1,h.default.Reset(),h.default.AddFloat32Data(this.BZ,3),this.isVBufEnabledAt(a.default.VBUF_UVS_INDEX)&&h.default.AddFloat32Data(this.Ba,2),this.isVBufEnabledAt(a.default.VBUF_NVS_INDEX)&&(null==this.DU&&(this.DU=new Float32Array(3*this.vtxTotal)),r.default.ClacTrisNormal(this.BZ,this.BZ.length,this.trisNumber,this.Bb,this.DU),h.default.AddFloat32Data(this.DU,3)),this.isVBufEnabledAt(a.default.VBUF_TVS_INDEX)){let t=new Float32Array(this.BZ.length),e=new Float32Array(this.BZ.length);r.default.ClacTrisTangent(this.BZ,this.BZ.length,this.Ba,this.DU,this.trisNumber,this.Bb,t,e),h.default.AddFloat32Data(t,3),h.default.AddFloat32Data(e,3)}this.updateWireframeIvs(),t?(h.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.DW=h.default.CreateBySaveData(this.getBufDataUsage()),this.DW.setUint16IVSData(this.Bb),this.buildEnd()):h.default.UpdateBufData(this.DW)}__$destroy(){this.isResFree()&&(this.bounds=null,this.BZ=null,this.Ba=null,this.DU=null,this.DV=null,super.__$destroy())}toString(){return"Pipe3DMesh()"}}e.default=_},e7ce:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("faa5")),a=i(s("b3bd")),h=i(s("0fc4"));class n extends r.default{constructor(){super(),this.DF=""}initialize(t){this.DF="PixelPickIndexShd"}getFragShaderCode(){let t="#version 300 es\nprecision highp float;\nuniform vec4 u_param;\nin vec3 v_viewPos;\n//in float v_length;\nlayout(location = 0) out vec4 FragColor0;\nvoid main()\n{\nvec4 p = vec4(length(v_viewPos.xyz));\np.x = floor(p.x)/256.0;\np.y = floor(fract(p.x) * 256.0)/255.0;\np.x = floor(p.x) / 255.0;\np.z = fract(p.z);\nFragColor0 = vec4(p.xyz,u_param.w);\n}\n";return t}getVtxShaderCode(){let t="#version 300 es\nprecision highp float;\nlayout(location = 0) in vec3 a_vs;\nuniform mat4 u_objMat;\nuniform mat4 u_viewMat;\nuniform mat4 u_projMat;\nout vec3 v_viewPos;\n//out float v_length;\nvoid main(){\nmat4 viewMat4 = u_viewMat * u_objMat;\nvec4 viewPos = viewMat4 * vec4(a_vs, 1.0);\nv_viewPos = viewPos.xyz;\n//v_length = length(viewPos.xyz);\ngl_Position = u_projMat * viewPos;\n}\n";return t}getUniqueShaderName(){return this.DF}toString(){return"[PixelPickIndexShaderBuffer()]"}static GetInstance(){return n.Ku}}n.Ku=new n,e.PixelPickIndexShaderBuffer=n;class l extends h.default{constructor(){super(),this.J7=new Float32Array([1,1,1,1]),this.J8=1/255}getCodeBuf(){return n.GetInstance()}setIndex(t){this.J7[3]=t*this.J8}getIndex(){return this.J7[3]/this.J8}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_param"],t.dataList=[this.J7],t}}e.default=l},e7d2:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8a0a")),a=i(s("710f")),h=i(s("f0f0")),n=i(s("7a04")),l=s("e08e");class _{constructor(t=r.default.VTX_STATIC_DRAW){this.r=0,this.J9=null,this.Bb=null,this.JO=0,this.J_=2,this.layoutBit=0,this.vertexVer=0,this.indicesVer=0,this.version=0,this.drawMode=l.RenderDrawMode.ELEMENTS_TRIANGLES,this.bufData=null,this.r=_.Kh++,this.JO=t}setVtxBuf(t){t!=this&&(this.J9=t,null!=t&&(t.layoutBit=this.layoutBit))}getUid(){return this.r}getType(){return this.J9.getType()}getIBufStep(){return this.J_}getBufDataUsage(){return this.JO}setBufDataUsage(t){this.JO=t}getBuffersTotal(){return this.J9.getBuffersTotal()}getF32DataAt(t){return this.J9.getF32DataAt(t)}getIvsData(){return this.Bb}setF32DataAt(t,e,s,i){this.J9.setF32DataAt(t,e,s,i),this.vertexVer++}setUintIVSData(t,e=r.default.VTX_STATIC_DRAW){if(t instanceof Uint16Array)this.J_=2;else{if(!(t instanceof Uint32Array))return;this.J_=4}this.Bb=t,null!=t&&this.indicesVer++}setUint16IVSData(t,e=r.default.VTX_STATIC_DRAW){t instanceof Uint16Array&&(this.Bb=t,this.indicesVer++,this.J_=2)}setUint32IVSData(t,e=r.default.VTX_STATIC_DRAW){t instanceof Uint32Array&&(this.Bb=t,this.indicesVer++,this.J_=4)}setData4fAt(t,e,s,i,r,a){null!=this.J9&&(this.J9.setData4fAt(t,e,s,i,r,a),this.vertexVer++)}setData3fAt(t,e,s,i,r){null!=this.J9&&(this.J9.setData3fAt(t,e,s,i,r),this.vertexVer++)}setData2fAt(t,e,s,i){null!=this.J9&&(this.J9.setData2fAt(t,e,s,i),this.vertexVer++)}destroy(){}__$destroy(){this.J9.destroy(),this.J9.getType()<1?_.Lw.push(this.J9):_.Lx.push(this.J9),this.J9=null,this.Bb=null,this.bufData=null}toString(){return"ROVertexBuffer(uid = "+this.r+")"}static GetFreeId(){return _.Li.length>0?_.Li.pop():-1}static GetVtxByUid(t){return _.Lj[t]}static Create(t=r.default.VTX_STATIC_DRAW){let e=null,s=_.GetFreeId();return s>=0?(e=_.Lj[s],e.setBufDataUsage(t),_.Lk[s]=_.S_FLAG_BUSY):(e=new _(t),_.Lj.push(e),_.Lk.push(_.S_FLAG_BUSY),_.Ll++),e.vertexVer=0,e.indicesVer=0,e.version++,_.Ly.__$attachAt(e.getUid()),e}static __$Restore(t){if(null!=t&&_.Lk[t.getUid()]==_.S_FLAG_BUSY){let e=t.getUid();_.Li.push(e),_.Lk[e]=_.S_FLAG_FREE,t.__$destroy()}}static __$$AttachAt(t){_.Ly.__$attachAt(t)}static __$$DetachAt(t){_.Ly.__$detachAt(t)}static Reset(){_.BufDataList=[],_.Lz=0,_.BufStatusList=[],_.BufDataStepList=[],_.vtxFS32=null,_.vbWholeDataEnabled=!1,_.dynBufSegEnabled=!1,_.useBufByIndexEnabled=!1}static AddFloat32Data(t,e,s=r.default.VTX_STATIC_DRAW){_.BufDataList.push(t),_.BufDataStepList.push(e),_.BufStatusList.push(s),_.Lz+=e}static CreateBySaveData(t=r.default.VTX_STATIC_DRAW,e=0){let s=0,i=0,a=0,n=_.BufDataStepList.length,l=[];for(;s<n;s++)l.push(a),a+=_.BufDataStepList[s];let m=_.BufDataList[0].length/_.BufDataStepList[0],o=new Float32Array(a*m),u=0,d=0,c=null,f=null;for(s=0;s<m;++s)for(i=s*a,u=0;u<n;++u)d=_.BufDataStepList[u],c=_.BufDataList[u],f=c.subarray(s*d,(s+1)*d),o.set(f,i),i+=d;let p=_.Create(t);if(p.layoutBit=e,_.Lw.length>0){let t=_.Lw.pop();p.setVtxBuf(t)}else p.setVtxBuf(new h.default(p.getBufDataUsage()));return p.setF32DataAt(0,o,a,l),p}static CreateVtxCombinedBuf(t,e,s=r.default.VTX_STATIC_DRAW,i=0){let a=0,n=0,l=e.length,m=[];for(;a<l;a++)m.push(n),n+=e[a];let o=_.Create(s);if(o.layoutBit=i,_.Lw.length>0){let t=_.Lw.pop();o.setVtxBuf(t)}else o.setVtxBuf(new h.default(o.getBufDataUsage()));return o.setF32DataAt(0,t,n,m),o}static UpdateBufData(t){let e=0,s=0,i=0,r=_.BufDataStepList.length,a=_.BufDataList[0].length/_.BufDataStepList[0],h=t.getF32DataAt(0),n=_.Lz*a!=h.length,l=null;if(n)for(l=[],h=new Float32Array(_.Lz*a);e<r;e++)l.push(i),i+=_.BufDataStepList[e];else i=_.Lz;let m=0,o=0,u=null,d=null;for(e=0;e<a;++e)for(s=e*i,m=0;m<r;++m)o=_.BufDataStepList[m],u=_.BufDataList[m],d=u.subarray(e*o,(e+1)*o),h.set(d,s),s+=o;n?t.setF32DataAt(0,h,i,l):t.setF32DataAt(0,h,i,null)}static CreateByBufDataSeparate(t,e=r.default.VTX_STATIC_DRAW,s=0){let i=0,a=0,h=t.getAttributesTotal(),l=new Array(h);l.fill(0);let m=_.Create(e);if(m.layoutBit=s,_.Lx.length>0){let t=_.Lx.pop();m.setVtxBuf(t)}else m.setVtxBuf(new n.default);for(i=0;i<h;i++)m.setF32DataAt(i,t.getAttributeDataAt(i,0),a,l);return m.setUintIVSData(t.getIndexDataAt(0)),m.bufData=t,m}static CreateBySaveDataSeparate(t=r.default.VTX_STATIC_DRAW){let e=0,s=0,i=_.BufDataStepList.length,a=new Array(i);a.fill(0);let h=_.Create(t);if(_.Lx.length>0){let t=_.Lx.pop();h.setVtxBuf(t)}else h.setVtxBuf(new n.default);for(e=0;e<i;e++)h.setF32DataAt(e,_.BufDataList[e],s,a);return h}static GetVtxAttachCountAt(t){return _.Ly.getAttachCountAt(t)}static GetVtxAttachAllCount(){return _.Ly.getAttachAllCount()}static ClearTest(){if(--_.L0,_.L0<1){_.L0=128;let t=_.Ly;if(t.__$getRemovedListLen()>0){let e=t.__$getRemovedList(),s=e.length,i=0,r=0,a=null,h=32;for(s=s>h?h:s;i<s;++i)r=e.shift(),t.getAttachCountAt(r)<1&&(a=_.GetVtxByUid(r),_.__$Restore(a))}}}}_.Kh=0,_.Lw=[],_.Lx=[],_.S_FLAG_BUSY=1,_.S_FLAG_FREE=0,_.Lk=[],_.Ll=0,_.Lj=[],_.Li=[],_.Ly=new a.default,_.Lz=0,_.BufDataList=null,_.BufDataStepList=null,_.BufStatusList=null,_.vtxDataFS32=null,_.vbWholeDataEnabled=!1,_.dynBufSegEnabled=!1,_.useBufByIndexEnabled=!1,_.vtxFS32=null,_.L0=128,e.default=_},e87b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("ab73")),a=i(s("7279"));class h{create(t,e){let s=null,i=r.default.ViewParam;return e.hasUniformByName(i.name)&&(s=new a.default,s.uns=i.name,s.uniformNameList=[i.name],s.copyDataFromProbe(t.getRenderAdapter().uViewProbe)),s}getIDNS(){return"ViewParamUniformBuilder"}}e.default=h},eaee:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("0851"));class h extends a.default{constructor(t,e){super(t,e,!1),this.D4=null,this.AA=r.TextureTarget.TEXTURE_CUBE,this.AD=r.TextureProxyType.FloatCube,this.internalFormat=r.TextureFormat.RGBA16F,this.dataType=r.TextureDataType.FLOAT,this.mipmapEnabled=!0}toRGBFormat(){this.unpackAlignment=1,this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB16F,this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.mipmapEnabled=!1}toRGBFormatFloat32F(){this.unpackAlignment=1,this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB32F,this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.mipmapEnabled=!1}toRGBAFormat(){this.unpackAlignment=4,this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA16F}toRGBAFormatFloat32F(){this.unpackAlignment=4,this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA32F}toRGBAFormatHalfFloat(){this.unpackAlignment=1,this.srcFormat=r.TextureFormat.RGBA,this.dataType=r.TextureDataType.HALF_FLOAT,this.internalFormat=r.TextureFormat.RGBA16F}setDataFromBytesToFaceAt(t,e,s,i,r=0){if(null==this.D4&&(this.D4=[null,null,null,null,null,null]),s>0&&i>0){0==t&&r<1&&(this.w=s,this.x=i,this.v=r),null==this.D4[t]&&(this.D4[t]=new Array(16));let a=this.D4[t];a[r]={width:s,height:i,imgData:e,miplevel:r},this.AC=null!=a[r].imgData}}uploadData(t){let e,s,i=t.getRC(),a=null,h=this.getWidth(),n=this.getHeight();for(let l=0;l<6;++l){let t=this.D4[l];if(this.mipmapEnabled&&this.AE)a=t[0],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,r.TextureFormat.ToGL(i,this.internalFormat),h,n,0,r.TextureFormat.ToGL(i,this.srcFormat),r.TextureDataType.ToGL(i,this.dataType),a.imgData);else{e=h,s=n;let _=0;for(;e>0||s>0;)null!=t[_]&&(a=t[_],i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+l,_,r.TextureFormat.ToGL(i,this.internalFormat),e,s,0,r.TextureFormat.ToGL(i,this.srcFormat),r.TextureDataType.ToGL(i,this.dataType),a.imgData)),e>0&&(e>>=1),s>0&&(s>>=1),++_}}this.version=0}toString(){return"[FloatCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.D4)for(let t=0;t<6;++t)null!=this.D4[t]&&(this.D4[t].imgData=null);super.__$destroy()}}}e.default=h},eca0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("2be1")),a=i(s("c62b"));class h{constructor(){this.idsFlag=0,this.count=0,this.rprocessUid=-1}reset(){this.idsFlag=0}}h.RenerProcessMaxTotal=16,e.RCRPObj=h;class n extends r.default{constructor(){super(...arguments),this.KA=[]}createNode(){let t=new h;return t.reset(),this.KA.push(t),new a.default}restoreUid(t){this.KA[t].reset()}testRPNodeExists(t,e){return(this.KA[t].idsFlag&1<<e)>0}testRPNodeNotExists(t,e){return(this.KA[t].idsFlag&1<<e)<1}setRPNodeParam(t,e,s){let i=this.KA[t],r=1<<e;return s>-1?(i.idsFlag&r)<1&&(++i.count,i.rprocessUid=e,i.idsFlag=i.idsFlag|r):(i.idsFlag&r)>0&&(--i.count,i.idsFlag=i.idsFlag&~r),i.count}getRCRPObj(t){return this.KA[t]}}e.RPOUnitBuilder=n},ee5a:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.type=0,this.KB=[],this.KC=[],this.KD=[]}addListener(t,e,s){let i=this.KC.length-1;for(;i>=0;--i)if(t===this.KC[i])break;i<0&&(this.KC.push(t),this.KB.push(e),this.KD.push(s))}removeListener(t,e){let s=this.KC.length-1;for(;s>=0;--s)if(t===this.KC[s]){this.KC.splice(s,1),this.KB.splice(s,1),this.KD.splice(s,1);break}}dispatch(t){let e=0,s=this.KC.length;for(let i=0;i<s;++i)(this.KD[i]<1||t.phase==this.KD[i])&&(this.KB[i].call(this.KC[i],t),e=1);return e}passTestEvt(t){let e=this.KC.length;for(let s=0;s<e;++s)if(this.KD[s]<1||t.phase==this.KD[s])return 1;return 0}passTestPhase(t){let e=this.KC.length;for(let s=0;s<e;++s)if(this.KD[s]<1||t==this.KD[s])return 1;return 0}destroy(){this.KC=[],this.KB=[],this.KD=[]}}e.default=i},f044:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{static CreateNewID(){return i.__s_uid++}}i.__s_uid=0,e.default=i},f0f0:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("f044"));class a{constructor(t){this.r=-1,this.D5=0,this.layoutBit=0,this.FN=null,this.KE=null,this.KF=0,this.r=r.default.CreateNewID()}getUid(){return this.r}getType(){return 0}getBuffersTotal(){return 1}getF32DataAt(t){return this.KE}setF32DataAt(t,e,s,i){null!=i&&(this.FN=i),this.KF=s,this.KE=e}setData4fAt(t,e,s,i,r,a){t=this.KF*t+this.FN[e],this.KE[t++]=s,this.KE[t++]=i,this.KE[t++]=r,this.KE[t++]=a}setData3fAt(t,e,s,i,r){t=this.KF*t+this.FN[e],this.KE[t++]=s,this.KE[t++]=i,this.KE[t++]=r}setData2fAt(t,e,s,i){t=this.KF*t+this.FN[e],this.KE[t++]=s,this.KE[t++]=i}destroy(){this.FN=null,this.KE=null}toString(){return"VtxCombinedBuf(uid = "+this.r+")"}}e.default=a},f208:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.info=""}}e.default=i},f444:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("1710")),a=s("bcac"),h=s("278e");class n{constructor(){this.Cm=null,this.KG=new a.CameraDragSwinger,this.KH=new h.CameraDragSlide,this.KI=!0}initialize(t,e){null==this.Cm&&(this.Cm=t,this.KG.initialize(t,e),this.KH.initialize(t,e),t.addEventListener(r.default.MOUSE_BG_DOWN,this,this.mouseDownListener,!0,!1),t.addEventListener(r.default.MOUSE_UP,this,this.mouseUpListener,!1,!0))}setSlideSpeed(t){this.KH.slideSpeed=t}enableSwing(){this.KI=!0}enableSlide(){this.KI=!1}mouseDownListener(t){this.KG.attach(),this.KH.attach()}mouseUpListener(t){this.KG.detach(),this.KH.detach()}detach(){this.KG.detach(),this.KH.detach()}runWithYAxis(){this.KI?this.KG.runWithYAxis():this.KH.run()}runWithZAxis(){this.KI?this.KG.runWithZAxis():this.KH.run()}}e.default=n},f48d:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("8e17"));class a{constructor(){this.id=-1,this.position=new r.default}update(){}updateFast(){}}a.__tV0=new r.default,a.__tV1=new r.default,a.__tV2=new r.default,e.AbsGeomBase=a,e.default=a},f610:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("fecb"));class a{constructor(){this.BZ=null,this.Ba=null,this.DU=null,this.Fx=null,this.Fy=null,this.Bb=null,this.bounds=new r.default,this.vtxTotal=0,this.trisNumber=0,this.vtCount=0}getVS(){return this.BZ}getUVS(){return this.Ba}getNVS(){return this.DU}getTVS(){return this.Fx}getBTVS(){return this.Fy}getIVS(){return this.Bb}toString(){return"GeometryBase()"}}e.default=a},f63b:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=s("8d98"),h=i(s("3b73"));function n(t,e,s){var i=document.createElement("canvas");i.width=e,i.height=s,i.style.backgroundColor="transparent",i.style.display="block",i.style.left="0px",i.style.top="0px",i.style.position="absolute";let r=i.getContext("2d");return r.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height),{canvas:i,ctx2d:r}}function l(t,e,s){var i=document.createElement("canvas");i.width=e,i.height=s,i.style.backgroundColor="transparent",i.style.display="block",i.style.left="0px",i.style.top="0px",i.style.position="absolute";let r=i.getContext("2d");return r.globalCompositeOperation="destination-atop",r.fillStyle="rgba(255, 255, 255, 1.0)",r.rect(0,0,i.width,i.height),r.fill(),r.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height),{canvas:i,ctx2d:r}}class _{constructor(t,e){this.KJ="",this.KK=null,this.KL=!1,this.KM=0,this.texture=null,this.bytesTex=null,this.powerOf2Fix=!1,this.offsetTex=null,this.premultipliedAlpha=!0,this.KJ=t,this.KM=e}startLoad(){if(null==this.KK){let t=this;this.KK=new Image,this.KK.onload=function(e){t.KL=!0,t.buildTex()},this.KK.addEventListener("error",e=>{t.KJ}),this.KK.crossOrigin="",this.KK.src=this.KJ}}buildTex(){let t=this.KK;if(null!=t&&this.KL){let e=this.texture,s=this.offsetTex,i=this.bytesTex,a=null,_=r.default.IsPowerOf2(t.width)&&r.default.IsPowerOf2(t.height),m=this.powerOf2Fix;if(h.default.IsWebGL1()&&(m=!0),!_&&m){let _=r.default.CalcCeilPowerOfTwo(t.width),m=r.default.CalcCeilPowerOfTwo(t.height);_>h.default.MAX_TEXTURE_SIZE&&(_=h.default.MAX_TEXTURE_SIZE),m>h.default.MAX_TEXTURE_SIZE&&(_=h.default.MAX_TEXTURE_SIZE);let o=n(t,_,m),u=this.KM;if(null!=e&&(e.setDataFromImage(o.canvas,u),e.name=this.KK.src,null!=s&&(o=l(t,_,m),s.setDataFromImage(o.canvas,u))),null!=i)if(this.premultipliedAlpha)a=o.ctx2d.getImageData(0,0,o.canvas.width,o.canvas.height),i.setDataFromBytes(a.data,u,o.canvas.width,o.canvas.height),i.name=this.KK.src;else{a=o.ctx2d.getImageData(0,0,o.canvas.width,o.canvas.height);let e=a.data,s=l(t,_,m);a=s.ctx2d.getImageData(0,0,s.canvas.width,s.canvas.height);let r=a.data,h=0,n=0,d=0;for(;h<m;++h)for(n=0;n<_;++n)e[d]+=255-r[d],e[d+1]+=255-r[d+1],e[d+2]+=255-r[d+2],d+=4;i.setDataFromBytes(e,u,o.canvas.width,o.canvas.height),i.name=this.KK.src}}else if(null!=e)this.powerOf2Fix,e.setDataFromImage(t,this.KM),e.name=this.KK.src;else if(null!=i){let e=r.default.CalcNearestCeilPow2(t.width),s=r.default.CalcNearestCeilPow2(t.height);e>2048&&(e=2048),s>2048&&(e=2048);let h=n(t,e,s),l=this.KM;a=h.ctx2d.getImageData(0,0,h.canvas.width,h.canvas.height),i.setDataFromBytes(a.data,l,h.canvas.width,h.canvas.height),i.name=this.KK.src}this.KL=!0}}getURL(){return this.KJ}getImage(){return this.KK}isLoaded(){return this.KL}destroy(){this.KL=!1,this.KJ="",this.texture=null,this.KK.src="",this.KK=null}}class m{constructor(t){this.KN=null,this.KO=[],this.KP=0,this.KL=!1,this.q=[],this.KQ=[],this.KN=t;var e=this;let s=0,i=null;for(;s<6;++s)i=new Image,i.onload=function(t){if(e.KP++,e.KP>=6){let t=0;for(t=0;t<6;++t)e.q[0].setDataFromImageToFaceAt(t,e.KO[t],e.KQ[0]);e.q[0].name=e.KO.src}},i.crossOrigin="",i.src=e.KN[s],e.KO.push(i)}addTex(t,e){this.q.push(t),this.KQ.push(e)}getURLAt(t){return this.KN[0]}getTexAt(t){return this.q[t]}isLoaded(){return this.KL}destroy(){}}class o{constructor(t){this.KR=new Map,this.FT=new Map,this.KS=[],this.KT=[],this.KU=[],this.KV=5,this.KW=17,this.KX=17,this.KY=512,this.KZ=512,this.Ka=null,this.E5=0,this.Ka=t,null!=t&&t.addTexLoader(this)}getTexByUrl(t,e=!0,s=!0,i=!1){let r=this.getImageTexByUrl(t,0,!1,i);return r.mipmapEnabled=s,e&&r.setWrap(a.TextureConst.WRAP_REPEAT),r}getBytesNoPremultipliedAlphaTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.FT.get(t);if(null==s){s=new _(t,e),s.premultipliedAlpha=!1,this.FT.set(t,s);let i=this.Ka.createBytesTex(1,1);return i.name=t,s.bytesTex=i,this.KT.push(s),i}return s.bytesTex.isDestroyed()&&(s.bytesTex=this.Ka.createBytesTex(1,1)),s.bytesTex}getBytesTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.FT.get(t);if(null==s){s=new _(t,e),this.FT.set(t,s);let i=this.Ka.createBytesTex(1,1);return i.name=t,s.bytesTex=i,this.KT.push(s),i}return s.bytesTex.isDestroyed()&&(s.bytesTex=this.Ka.createBytesTex(1,1)),s.bytesTex}getImageOffsetTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let s=this.FT.get(t);return null!=s?s.offsetTex:null}getImageTexByUrl(t,e=0,s=!1,i=!1){if(""==t)return null;e<0&&(e=0);let r=this.FT.get(t);if(null==r){r=new _(t,e),r.powerOf2Fix=i,s&&(r.offsetTex=this.Ka.createImageTex2D(1,1)),this.FT.set(t,r);let a=this.Ka.createImageTex2D(1,1);return a.name=t,r.texture=a,this.KT.push(r),a}return r.texture.isDestroyed()&&(r.texture=this.Ka.createImageTex2D(1,1)),r.texture}getCubeTexAndLoadImg(t,e,s=0){if(""==t||null==e||e.length<6)return null;s<0&&(s=0);let i=this.KR.get(t);if(null==i){i=new m(e),this.KR.set(t,i);let r=this.Ka.createImageCubeTex(8,8);return i.addTex(r,s),r}return i.getTexAt(0)}setRunFlag(t){this.E5=t}getRunFlag(){return this.E5}isRunning(){return!0}isStopped(){return!1}run(){let t=0,e=null;if(--this.KW,this.KW<1){this.KW=this.KX;let s=this.KU.length;if(s>0)for(;t<s;++t)this.KU[t].isLoaded()&&(this.KS.push(this.KU[t]),this.KU.splice(t,1),--t,--s);let i=this.KT.length;if(i>0&&s<this.KV)for(t=s;t<this.KV;++t){if(!(this.KT.length>0))break;e=this.KT.pop(),this.KU.push(e),e.startLoad()}}if(--this.KY,this.KY<1){this.KY=this.KZ;let s=null,i=this.KS.length;for(t=0;t<i;++t)e=this.KS[t],s=null!=e.texture?e.texture:e.bytesTex,s.isDestroyed()&&(this.FT.delete(e.getURL()),this.KS.splice(t,1),e.destroy(),--t,--i)}}}e.default=o},f63e:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("b3bd")),a=i(s("0fc4"));class h extends a.default{constructor(){super(),this.DI=new Float32Array([1,1,1,1]),this.vtxColorEnabled=!1,this.premultiplyAlpha=!1}getCodeBuf(){let t=super.getCodeBuf();return t.vtxColorEnabled=this.vtxColorEnabled,t.premultiplyAlpha=this.premultiplyAlpha,t}setRGB3f(t,e,s){this.DI[0]=t,this.DI[1]=e,this.DI[2]=s}getRGB3f(t){let e=this.DI;t.setRGB3f(e[0],e[1],e[2])}setRGBA4f(t,e,s,i){this.DI[0]=t,this.DI[1]=e,this.DI[2]=s,this.DI[3]=i}getRGBA4f(t){let e=this.DI;t.setRGBA4f(e[0],e[1],e[2],e[3])}setAlpha(t){this.DI[3]=t}createSelfUniformData(){let t=new r.default;return t.uniformNameList=["u_color"],t.dataList=[this.DI],t}}e.default=h},f928:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("df25"));class h extends a.default{constructor(t,e,s=!1){super(t,e,s),this.AD=r.TextureProxyType.Float,this.minFilter=r.TextureConst.LINEAR,this.internalFormat=r.TextureFormat.RGBA16F,this.dataType=r.TextureDataType.FLOAT,this.unpackAlignment=4}toAlphaFormat(){this.srcFormat=r.TextureFormat.ALPHA,this.internalFormat=r.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=r.TextureFormat.RED,this.internalFormat=r.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB16F,this.unpackAlignment=1}toRGBAFormat(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4}toRGBAFloatFormat(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA16F,this.unpackAlignment=4}setDataFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,h=!1){super.setDataFromBytes(t,e,s,i,r,a,h)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[FloatTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=h},fa60:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("919c"));class a extends r.default{constructor(){super(),this.vao=null,this.r=a.Kh++}run(){this.Be.testVROUid(this.r)&&(this.Be.bindVertexArray(this.vao),this.Be.testRIOUid(this.FH)&&this.Be.bindEleBuf(this.ibuf))}__$destroy(){r.default.Lh.delete(this.GX),this.GX=0,this.FH=-1,this.ibuf=null,this.vao=null,this.Be=null}restoreThis(){null!=this.vao&&this.Be.deleteVertexArray(this.vao),a.Restore(this)}toString(){return"VaoVertexRenderObj(uid = "+this.r+", type="+this.GX+")"}static HasMid(t){return r.default.Lh.has(t)}static GetByMid(t){return r.default.Lh.get(t)}static GetFreeId(){return a.Li.length>0?a.Li.pop():-1}static Create(t,e,s){let i=null,h=a.GetFreeId();return h>=0?(i=a.Lj[h],a.Lk[h]=a.S_FLAG_BUSY,i.setMidAndBufUid(e,s)):(i=new a,i.setMidAndBufUid(e,s),a.Lj.push(i),a.Lk.push(a.S_FLAG_BUSY),a.Ll++),i.setRC(t),r.default.Lh.set(e,i),i}static Restore(t){if(null!=t&&t.s<1&&a.Lk[t.getUid()]==a.S_FLAG_BUSY){let e=t.getUid();a.Li.push(e),a.Lk[e]=a.S_FLAG_FREE,t.__$destroy()}}}a.Kh=0,a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.Lk=[],a.Ll=0,a.Lj=[],a.Li=[],e.default=a},faa5:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("250c"));class a{constructor(){this.DG=null,this.q=null,this.Kb=!0,this.pipeline=null,this.vtxColorEnabled=!1,this.premultiplyAlpha=!1,this.adaptationShaderVersion=!0}reset(){this.DG=a.Lg,this.DG.reset()}clear(){this.DG=null}getShaderCodeBuilder(){return a.Lg}static GetPreCompileInfo(){return a.Lg.getPreCompileInfo()}initialize(t){null!=a.___s_csBuf&&a.___s_csBuf!=this&&a.___s_csBuf.initialize(t),this.Kb=t}isTexEanbled(){return this.Kb}setIRenderTextureList(t){this.q=t}getIRenderTextureList(){return this.q}buildShader(){}buildDefaultCode(){let t=this.DG;t.addVertLayout("vec3","a_vs"),t.addFragUniform("vec4","u_color"),t.useVertSpaceMats(!0,!0,!0),this.premultiplyAlpha&&t.addDefine("VOX_PREMULTIPLY_ALPHA","1"),this.Kb&&(t.addTextureSample2D(),t.addVertLayout("vec2","a_uvs"),t.addVarying("vec2","v_uv")),this.vtxColorEnabled&&(t.addDefine("VOX_USE_VTX_COLOR","1"),t.addVertLayout("vec3","a_cvs"),t.addVarying("vec3","v_cv")),t.addFragOutput("vec4","FragColor0"),t.addFragMainCode("\n    FragColor0 = vec4(1.0);\n    #ifdef VOX_USE_2D_MAP\n        //  FragColor0 *= VOX_Texture2D(u_sampler0, vec2(v_uv[0],v_uv[1]));\n        FragColor0 *= VOX_Texture2D(u_sampler0, v_uv.xy);\n    #endif\n    #ifdef VOX_USE_VTX_COLOR\n        FragColor0 *= vec4(v_cv.xyz,1.0);\n    #endif\n    #ifdef VOX_PREMULTIPLY_ALPHA\n        FragColor0.rgb *= u_color.xyz;\n        FragColor0.a *= u_color.w;\n        FragColor0.rgb *= u_color.aaa;\n    #else\n        FragColor0 *= u_color;\n    #endif\n"),t.addVertMainCode("\n    vec4 localPosition = vec4(a_vs.xyz,1.0);\n    vec4 wpos = u_objMat * localPosition;\n    gl_Position = u_projMat * u_viewMat * wpos;\n\n    #ifdef VOX_USE_2D_MAP\n        v_uv = a_uvs.xy;\n    #endif\n    #ifdef VOX_USE_VTX_COLOR\n        v_cv = a_cvs.xyz;\n    #endif\n"),this.pipeline}getFragShaderCode(){return a.___s_csBuf!=this?a.___s_csBuf.getFragShaderCode():(this.buildDefaultCode(),this.DG.buildFragCode())}getVtxShaderCode(){return a.___s_csBuf!=this?a.___s_csBuf.getVtxShaderCode():this.DG.buildVertCode()}getUniqueShaderName(){if(a.___s_csBuf!=this)return a.___s_csBuf.getUniqueShaderName();let t="vox_default_shd";return this.Kb&&(t+="_tex"),this.vtxColorEnabled&&(t+="_vtxColor"),this.premultiplyAlpha&&(t+="_preMulAlpha"),t}toString(){return"[ShaderCodeBuffer()]"}static UseShaderBuffer(t){null!=a.___s_csBuf&&a.___s_csBuf.clear(),a.___s_csBuf=t}}a.___s_csBuf=null,a.Lg=new r.default,e.default=a},fae3:function(t,e,s){"use strict";s.r(e);s("1eb2");var i=s("b88e");for(var r in i)["default"].indexOf(r)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(r)},fc07:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("3b73")),a=i(s("2e8a")),h=i(s("78e9"));class n{constructor(){this.HU=!1,this.Kc=new Map,this.HV=null,this.Bp=null,this.uniformNameListStr="",this.texUniformNameListStr="",this.attributes=[null,null,null,null,null,null,null,null,null,null,null,null],this.HT=null,this.texTotal=0,this.fragOutputTotal=0}reset(){this.HU=!1,this.HV=null,this.uniformNameListStr="",this.texUniformNameListStr="";let t=0;for(;t<12;++t)this.attributes[t]=null;this.HT=null,this.Kc.clear(),this.texTotal=0}parseVShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let s="\n",i=t.indexOf(s),r=0,n=[],l="",_="",m=new RegExp(" ","g");while(i>=0)l=t.slice(r,i),l.length>0&&(_=l.replace(m,""),0!=_.indexOf("//")&&n.push(l)),r=i+1,i=t.indexOf(s,r);l=t.slice(r,t.length),l.length>0&&(_=l.replace(m,""),0!=_.indexOf("//")&&n.push(l));let o="uniform ",u=n.length,d=null;for(i=0;i<12;++i)this.attributes[i]=null;this.HV=[],this.Bp=[];let c=null;null==this.HT&&(this.HT=[]),i=0;let f=!1,p=!1;while(i<u)l=n[i],f=l.indexOf("layout")>=0,p=l.indexOf("attribute ")>=0,f&&l.indexOf("location")>0||p?(d=new a.default,d.layoutEnabled=f,d.parseCode(l),this.attributes[d.attriType]=d,this.HV.push(d.name),this.Bp.push(d.typeSize)):l.indexOf(o)>=0&&(c=new h.default,c.parseCode(l)&&(this.HT.push(c),this.uniformNameListStr+=c.name+",",c.isTex&&!this.Kc.has(c.name)&&(this.Kc.set(c.name,1),this.texUniformNameListStr+=c.name+",",this.texTotal++))),++i}parseFShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let s="\n",i=t.indexOf(s),a=0,n=[],l="",_="",m=new RegExp(" ","g");while(i>=0)l=t.slice(a,i),l.length>0&&(_=l.replace(m,""),0!=_.indexOf("//")&&n.push(l)),a=i+1,i=t.indexOf(s,a);l=t.slice(a,t.length),l.length>0&&(_=_.replace(m,""),0!=_.indexOf("//")&&n.push(l));let o="uniform ",u=n.length,d=null;null==this.HT&&(this.HT=[]),i=0;while(i<u)l=n[i],l.indexOf(o)>=0&&this.uniformNameListStr.indexOf(o)<0&&(d=new h.default,d.parseCode(l)&&(this.HT.push(d),this.uniformNameListStr+=d.name+",",d.isTex&&!this.Kc.has(d.name)&&(this.Kc.set(d.name,1),this.texUniformNameListStr+=d.name+",",this.texTotal++))),++i;let c="layout";r.default.IsWebGL1()&&(c="gl_FragData"),i=t.indexOf(c),this.fragOutputTotal=0;while(i>0)this.fragOutputTotal++,i=t.indexOf(c,i+2);this.fragOutputTotal<1&&(this.fragOutputTotal=1)}}e.default=n},fe7f:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s("8d98"),a=i(s("df25"));class h extends a.default{constructor(t,e,s=!1){super(t,e,s),this.AD=r.TextureProxyType.Bytes}toAlphaFormat(){this.srcFormat=r.TextureFormat.ALPHA,this.internalFormat=r.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=r.TextureFormat.RED,this.internalFormat=r.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB,this.unpackAlignment=3}toRGBAFormat(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4}setDataFromBytes(t,e=0,s=-1,i=-1,r=0,a=0,h=!1){super.setDataFromBytes(t,e,s,i,r,a,h)}setPartDataFromeBytes(t,e,s,i,r,a=0){super.setPartDataFromeBytes(t,e,s,i,r,a)}getPixels(t,e,s,i,r){super.getPixels(t,e,s,i,r)}toString(){return"[BytesTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=h},fecb:function(t,e,s){"use strict";var i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(s("6e01")),a=i(s("8e17"));class h{constructor(){this.min=new a.default(r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE),this.max=new a.default(r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE),this.version=-1,this.radius=50,this.radius2=2500,this.center=new a.default(0,0,0),this.Kd=100,this.EB=100,this.g=100,this.Ke=50,this.Kf=50,this.Kg=50,this.IV=new a.default}getLong(){return this.Kd}getWidth(){return this.EB}getHeight(){return this.g}reset(){this.min.setXYZ(r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE),this.max.setXYZ(r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE)}equals(t){return this.min.equalsXYZ(t.min)&&this.max.equalsXYZ(t.max)}setVolume(t,e,s){this.EB=t,this.g=e,this.Kd=s,this.Ke=.5*this.Kd,this.Kf=.5*this.EB,this.Kg=.5*this.g,this.max.x=this.center.x+this.Kf,this.max.y=this.center.y+this.Kg,this.max.z=this.center.z+this.Ke,this.min.x=this.center.x-this.Kf,this.min.y=this.center.y-this.Kg,this.min.z=this.center.z-this.Ke,this.radius2=this.Kf*this.Kf+this.Kg*this.Kg+this.Ke*this.Ke,this.radius=Math.sqrt(this.radius2)}union(t){this.addPosition(t.min),this.addPosition(t.max)}addPosition(t){this.min.x>t.x&&(this.min.x=t.x),this.min.y>t.y&&(this.min.y=t.y),this.min.z>t.z&&(this.min.z=t.z),this.max.x<t.x&&(this.max.x=t.x),this.max.y<t.y&&(this.max.y=t.y),this.max.z<t.z&&(this.max.z=t.z)}addXYZ(t,e,s){this.min.x>t&&(this.min.x=t),this.min.y>e&&(this.min.y=e),this.min.z>s&&(this.min.z=s),this.max.x<t&&(this.max.x=t),this.max.y<e&&(this.max.y=e),this.max.z<s&&(this.max.z=s)}addXYZFloat32Arr(t){let e=t.length,s=0,i=0,r=0;for(let a=0;a<e;)s=t[a],++a,i=t[a],++a,r=t[a],++a,this.min.x>s&&(this.min.x=s),this.min.y>i&&(this.min.y=i),this.min.z>r&&(this.min.z=r),this.max.x<s&&(this.max.x=s),this.max.y<i&&(this.max.y=i),this.max.z<r&&(this.max.z=r)}containsV(t){return!(t.x<this.max.x||t.x>this.max.x)&&(!(t.y<this.max.y||t.y>this.max.y)&&!(t.z<this.max.z||t.z>this.max.z))}containsXY(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.y||e>this.max.y)}containsXZ(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.z||e>this.max.z)}containsYZ(t,e){return!(t<this.min.y||t>this.max.y)&&!(e<this.min.z||e>this.max.z)}update(){this.EB=this.max.x,this.min.x>this.max.x&&(this.max.x=this.min.x,this.min.x=this.EB),this.EB=this.max.x-this.min.x,this.g=this.max.y,this.min.y>this.max.y&&(this.max.y=this.min.y,this.min.y=this.g),this.g=this.max.y-this.min.y,this.Kd=this.max.z,this.min.z>this.max.z&&(this.max.z=this.min.z,this.min.z=this.Kd),this.Kd=this.max.z-this.min.z,this.center.x=.5*this.EB,this.center.y=.5*this.g,this.center.z=.5*this.Kd,this.Ke=this.center.z,this.Kf=this.center.x,this.Kg=this.center.y,this.radius2=this.Kf*this.Kf+this.Kg*this.Kg+this.Ke*this.Ke,this.radius=Math.sqrt(this.radius2),this.center.x+=this.min.x,this.center.y+=this.min.y,this.center.z+=this.min.z,++this.version}updateVolume(){this.EB=this.max.x-this.min.x,this.g=this.max.y-this.min.y,this.Kd=this.max.z-this.min.z,this.Ke=.5*this.Kd,this.Kf=.5*this.EB,this.Kg=.5*this.g}copyFrom(t){this.radius=t.radius,this.radius2=t.radius2,this.min.copyFrom(t.min),this.max.copyFrom(t.max),this.center.copyFrom(t.center),this.updateVolume()}updateFast(){this.EB=this.max.x-this.min.x,this.g=this.max.y-this.min.y,this.Kd=this.max.z-this.min.z,this.center.x=.5*this.EB,this.center.y=.5*this.g,this.center.z=.5*this.Kd,this.Ke=this.center.z,this.Kf=this.center.x,this.Kg=this.center.y,this.radius2=this.Kf*this.Kf+this.Kg*this.Kg+this.Ke*this.Ke,this.radius=Math.sqrt(this.radius2),this.center.x+=this.min.x,this.center.y+=this.min.y,this.center.z+=this.min.z,++this.version}toString(){return"[AABB(min->"+this.min+",size("+this.EB+","+this.g+","+this.Kd+"))]"}sphereIntersect(t,e){this.IV.x=this.center.x-t.x,this.IV.y=this.center.y-t.y,this.IV.z=this.center.z-t.z;let s=this.IV.getLengthSquared();return s<this.radius2||(e+=this.radius,e*=e,e>=s)}intersectRL(t,e){let s=0,i=(this.min.x-e.x)/t.x,r=(this.max.x-e.x)/t.x;i>r&&(s=r,r=i,i=s);let a=(this.min.y-e.y)/t.y,h=(this.max.y-e.y)/t.y;if(a>h&&(s=h,h=a,a=s),i>h||a>r)return!1;a>i&&(i=a),h<r&&(r=h);let n=(this.min.z-e.z)/t.z,l=(this.max.z-e.z)/t.z;return n>l&&(s=l,l=n,n=s),!(i>l||n>r)&&(n>i&&(i=n),l<r&&(r=l),!0)}static IntersectionRL3(t,e,s,i,r,a){return s.w=(t[e[0]].x-r.x)*s.x,i.w=(t[1-e[0]].x-r.x)*s.x,a.x=(t[e[1]].y-r.y)*s.y,a.y=(t[1-e[1]].y-r.y)*s.y,!(s.w>a.y||a.x>i.w)&&(a.x>s.w&&(s.w=a.x),a.y<i.w&&(i.w=a.y),a.x=(t[e[2]].z-r.z)*s.z,a.y=(t[1-e[2]].z-r.z)*s.z,!(s.w>a.y||a.x>i.w)&&(a.x>s.w&&(s.w=a.x),a.y<i.w&&(i.w=a.y),a.copyFrom(i),a.scaleBy(s.w),a.addBy(r),i.w=1,!0))}static IntersectionRL1(t,e,s,i){let r=0,a=(s.min.x-e.x)/t.x,h=(s.max.x-e.x)/t.x;a>h&&(r=h,h=a,a=r);let n=(s.min.y-e.y)/t.y,l=(s.max.y-e.y)/t.y;if(n>l&&(r=l,l=n,n=r),a>l||n>h)return!1;n>a&&(a=n),l<h&&(h=l);let _=(s.min.z-e.z)/t.z,m=(s.max.z-e.z)/t.z;return _>m&&(r=m,m=_,_=r),!(a>m||_>h)&&(_>a&&(a=_),m<h&&(h=m),i.copyFrom(t),i.scaleBy(a),i.addBy(e),!0)}static IntersectionRL2(t,e,s,i){i.x=s.center.x-e.x,i.y=s.center.y-e.y,i.z=s.center.z-e.z;let r=i.dot(t);if(i.x-=r*t.x,i.y-=r*t.y,i.z-=r*t.z,i.getLengthSquared()>s.radius2)return!1;if(s.containsV(e))return i.copyFrom(e),!0;if(e.x<s.min.x){if(t.x>0&&(r=(s.min.x-e.x)/t.x,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsYZ(i.y,i.z)))return!0}else if(e.x>s.max.x&&t.x<0&&(r=(s.max.x-e.x)/t.x,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsYZ(i.y,i.z)))return!0;if(e.y<s.min.y){if(t.y>0&&(r=(s.min.y-e.y)/t.y,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXZ(i.x,i.z)))return!0}else if(e.y>s.max.y&&t.y<0&&(r=s.max.y,r=(s.max.y-e.y)/t.y,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXZ(i.x,i.z)))return!0;if(e.z<s.min.z){if(t.z>0&&(r=(s.min.z-e.z)/t.z,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXY(i.x,i.y)))return!0}else if(e.z>s.max.z&&t.z<0&&(r=(s.max.z-e.z)/t.z,i.copyFrom(t),i.scaleBy(r),i.addBy(e),s.containsXY(i.x,i.y)))return!0;return!1}}h.___pnV=new a.default,e.default=h}})}));