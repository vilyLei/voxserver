(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["VoxApp"]=e():t["VoxApp"]=e()})("undefined"!==typeof self?self:this,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s="fae3")}({"0236":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("a996")),a=s(i("1710")),n=s(i("7045")),l=s(i("3024")),h=s(i("badb"));class o{constructor(t,e){this.A=0,this.pixelRatio=1,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.B=0,this.C=0,this.D=1,this.E=1,this.F=new h.default,this.G=[],this.H=[],this.I=[],this.J=[],this.K=[],this.L=[],this.M=[],this.N=[],this.uProbe=null,this.O=0,this.P=0,this.Q=new a.default,this.R=!0,this.S=new r.default,this.A=t}getRCUid(){return this.A}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.B}getViewY(){return this.C}getViewWidth(){return this.D}getViewHeight(){return this.E}setViewPort(t,e,i,s){this.R=!1,this.B=t,this.C=e,i==this.D&&s==this.E||(this.D=i,this.E=s,this.updateViewUData())}updateViewUData(){null==this.uProbe&&(this.uProbe=new l.default(1),this.uProbe.bindSlotAt(this.A)),this.uProbe.setVec4Data(2/(this.D*this.pixelRatio),2/(this.E*this.pixelRatio),this.D*this.pixelRatio,this.E*this.pixelRatio),this.uProbe.update(),this.O=this.D,this.P=this.E}update(){this.O==this.stageWidth&&this.P==this.stageHeight||(this.R&&(this.D=this.stageWidth,this.E=this.stageHeight,this.updateViewUData()),this.stageHalfWidth=.5*this.stageWidth,this.stageHalfHeight=.5*this.stageHeight)}mouseDown(t=1){this.Q.type=a.default.MOUSE_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=t,this.F.dispatchEvt(this.Q)}mouseUp(t=1){this.Q.phase=1,this.Q.type=a.default.MOUSE_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=t,this.F.dispatchEvt(this.Q)}mouseClick(){this.Q.type=a.default.MOUSE_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseDoubleClick(){this.Q.type=a.default.MOUSE_DOUBLE_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightDown(t=1){this.Q.type=a.default.MOUSE_RIGHT_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightUp(t=1){this.Q.type=a.default.MOUSE_RIGHT_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgDown(){this.Q.type=a.default.MOUSE_BG_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgUp(){this.Q.type=a.default.MOUSE_BG_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgClick(){this.Q.type=a.default.MOUSE_BG_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightClick(){this.Q.type=a.default.MOUSE_RIGHT_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseMove(){this.Q.type=a.default.MOUSE_MOVE,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseWheel(t){this.Q.type=a.default.MOUSE_WHEEL,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.wheelDeltaY=t.wheelDeltaY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseCancel(){this.Q.type=a.default.MOUSE_CANCEL,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseMultiDown(t){this.Q.type=a.default.MOUSE_MULTI_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseMultiUp(t){this.Q.type=a.default.MOUSE_MULTI_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseMultiMove(t){this.Q.type=a.default.MOUSE_MULTI_MOVE,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseWindowUp(t=1){}mouseWindowRightUp(t=1){}enterFrame(){this.S.type=r.default.ENTER_FRAME;let t=this.I.length;for(var e=0;e<t;++e)this.I[e].call(this.J[e],this.S)}addEventListener(t,e,i,s=!0,a=!0){if(null!=i&&null!=e){let l=0;switch(t){case r.default.RESIZE:break;case r.default.ENTER_FRAME:for(l=this.I.length-1;l>=0;--l)if(e===this.J[l])break;l<0&&(this.J.push(e),this.I.push(i));break;case n.default.KEY_DOWN:break;case n.default.KEY_UP:break;default:this.F.addEventListener(t,e,i,s,a);break}}}removeEventListener(t,e,i){if(null!=i&&null!=e){let s=0;switch(t){case r.default.RESIZE:for(s=this.G.length-1;s>=0;--s)if(e===this.H[s]){this.H.splice(s,1),this.G.splice(s,1);break}break;case r.default.ENTER_FRAME:for(s=this.I.length-1;s>=0;--s)if(e===this.J[s]){this.J.splice(s,1),this.I.splice(s,1);break}break;case n.default.KEY_DOWN:for(s=this.K.length-1;s>=0;--s)if(e===this.L[s]){this.L.splice(s,1),this.K.splice(s,1);break}break;case n.default.KEY_UP:for(s=this.M.length-1;s>=0;--s)if(e===this.N[s]){this.N.splice(s,1),this.M.splice(s,1);break}break;default:this.F.removeEventListener(t,e,i);break}}}}e.default=o},"030e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static Initialize(t,e){let i=this;1==t?(i.OES_standard_derivatives=e.getExtension("OES_standard_derivatives"),i.OES_standard_derivatives,i.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),i.EXT_shader_texture_lod,i.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),i.WEBGL_draw_buffers,i.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),i.OES_vertex_array_object,i.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),i.ANGLE_instanced_arrays,i.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),i.EXT_color_buffer_float,i.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),i.EXT_color_buffer_half_float,i.OES_texture_half_float=e.getExtension("OES_texture_half_float"),i.OES_texture_half_float,i.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),i.OES_texture_half_float_linear,i.OES_texture_float=e.getExtension("OES_texture_float"),i.OES_texture_float,i.OES_element_index_uint=e.getExtension("OES_element_index_uint"),i.OES_element_index_uint,i.EXT_blend_minmax=e.getExtension("EXT_blend_minmax"),i.EXT_blend_minmax):(i.EXT_shader_texture_lod=e.getExtension("EXT_shader_texture_lod"),i.EXT_shader_texture_lod,i.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),i.EXT_color_buffer_half_float,i.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),i.OES_texture_half_float_linear,i.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float"),i.EXT_color_buffer_float),i.OES_texture_float_linear=e.getExtension("OES_texture_float_linear"),i.OES_texture_float_linear,i.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),i.WEBGL_depth_texture,i.WEBGL_debug_renderer_info=e.getExtension("WEBGL_debug_renderer_info"),i.WEBGL_debug_renderer_info}}s.OES_standard_derivatives=null,s.EXT_shader_texture_lod=null,s.WEBGL_draw_buffers=null,s.OES_vertex_array_object=null,s.ANGLE_instanced_arrays=null,s.EXT_color_buffer_float=null,s.EXT_color_buffer_half_float=null,s.OES_texture_float_linear=null,s.OES_texture_half_float_linear=null,s.OES_texture_half_float=null,s.OES_texture_float=null,s.OES_element_index_uint=null,s.EXT_blend_minmax=null,s.WEBGL_depth_texture=null,s.WEBGL_debug_renderer_info=null,e.default=s},"0714":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t=null){this.T=s.H0++,this.U=null,this.V=!1,this.W=new Map,this.X=[],this.Y=null,this.Z=null,this.a=null,this.b="",this.uuid="",this.Z=t}getUid(){return this.T}addShaderCodeWithUUID(t,e){null!=this.Z&&this.addShaderCode(this.Z.getShaderCodeObjectWithUUID(t),e)}addShaderCode(t,e=!1){this.V=null!=t,(null==this.U||null!=t&&e)&&(this.U=t)}hasShaderCode(){return null!=this.U}addPipe(t){let e=t.getPipeTypes();for(let i=0;i<e.length;++i)this.W.has(e[i])||this.W.set(e[i],t)}getPipeByType(t){return this.W.get(t)}hasPipeByType(t){return this.W.has(t)}createKeys(t){if(this.X=[],null!=t){let e,i,s=t;for(let t=0;t<s.length;++t)i=s[t],this.W.has(i)&&(e=this.W.get(i),this.X.push(e.getPipeKey(i)))}}buildSharedUniforms(t){if(this.Y=[],this.a=t,null!=t){let e,i,s=t;for(let t=0;t<s.length;++t)i=s[t],this.W.has(i)&&(e=this.W.get(i),e.resetPipe(),this.Y.push(e.getGlobalUinform()))}}build(t){if(this.V&&null!=this.U&&t.addShaderObject(this.U),null!=this.a){let e,i,s=this.a;for(let r=0;r<s.length;++r)i=s[r],this.W.has(i)&&(e=this.W.get(i),e.useShaderPipe(t,i))}}getTextures(t,e,i){if(null!=i){let s,r,a=i;for(let i=0;i<a.length;++i)r=a[i],this.W.has(r)&&(s=this.W.get(r),s.getTextures(t,e,r))}}getSharedUniforms(){return this.Y}getSelfUniformData(){return null}appendKeyString(t){this.b+=t}getKeys(){return this.X}getKeysString(){let t="";for(let e=0;e<this.X.length;++e)t+=this.X[e];return t+this.b}reset(){this.b="",this.V=!1}clear(){this.W=new Map,this.X=[],this.Y=null,this.U=null,this.Z=null,this.a=null}}s.H0=0,e.MaterialPipeline=s},"0851":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("8d98"),a=s(i("6e01")),n=s(i("da6a"));class l{constructor(t,e,i=!1){this.T=-1,this.c=0,this.d=null,this.e=null,this.f=-1,this.g=128,this.h=128,this.i=128,this.j=128,this.k=r.TextureTarget.TEXTURE_2D,this.l=-1,this.m=!1,this.n=r.TextureProxyType.Default,this.o=!0,this.name="TextureProxy",this.internalFormat=r.TextureFormat.RGBA,this.srcFormat=r.TextureFormat.RGBA,this.dataType=r.TextureDataType.UNSIGNED_BYTE,this.wrap_s=r.TextureConst.WRAP_CLAMP_TO_EDGE,this.wrap_t=r.TextureConst.WRAP_CLAMP_TO_EDGE,this.wrap_r=r.TextureConst.WRAP_CLAMP_TO_EDGE,this.mipmapEnabled=!1,this.flipY=!1,this.premultiplyAlpha=!1,this.unpackAlignment=4,this.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,this.magFilter=r.TextureConst.LINEAR,this.version=0,this.e=n.default.GetInstance(),this.T=this.e.getFreeUid(),t<1&&(t=128),e<1&&(e=128),i?(this.g=a.default.CalcNearestCeilPow2(t),this.h=a.default.CalcNearestCeilPow2(e)):(this.g=t,this.h=e),this.e.__$$addTexture(this)}__$$use(t){t.bindToGpu(this.getResUid())}__$setRenderProxy(t){null!=this.e||(this.e=n.default.GetInstance(),this.T=this.e.getFreeUid(),this.e.__$$addTexture(this)),this.d=t}__$attachThis(){-1==this.c&&(this.e.removeFreeUid(this.getUid()),this.c=0),++this.c}__$detachThis(){this.c>0&&(--this.c,this.c<1&&(this.c=-1,this.e.addFreeUid(this.getUid())))}getAttachCount(){return this.c}isDirect(){return!0}getType(){return this.n}getResUid(){return this.T}getUid(){return this.T}setWrap(t){this.wrap_s=this.wrap_t=this.wrap_r=t}isGpuEnabled(){return null!=this.d&&this.d.Texture.hasResUid(this.getResUid())}getSampler(){return this.l}getTargetType(){return this.k}getBufWidth(){return this.i}getBufHeight(){return this.j}getWidth(){return this.g}getHeight(){return this.h}isDataEnough(){return this.m}uploadFromFbo(t,e,i){}__$buildParam(t){this.i=this.g,this.j=this.h,t.texParameteri(this.l,t.TEXTURE_WRAP_S,r.TextureConst.GetConst(t,this.wrap_s)),t.texParameteri(this.l,t.TEXTURE_WRAP_T,r.TextureConst.GetConst(t,this.wrap_t)),t.texParameteri(this.l,t.TEXTURE_MIN_FILTER,r.TextureConst.GetConst(t,this.minFilter)),t.texParameteri(this.l,t.TEXTURE_MAG_FILTER,r.TextureConst.GetConst(t,this.magFilter)),this.k==r.TextureTarget.TEXTURE_3D&&(t.texParameteri(this.l,t.TEXTURE_WRAP_R,r.TextureConst.GetConst(t,this.wrap_r)),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_BASE_LEVEL,0),t.texParameteri(t.TEXTURE_3D,t.TEXTURE_MAX_LEVEL,Math.log2(this.g))),this.mipmapEnabled&&this.o&&t.generateMipmap(this.l)}generateMipmap(t){if(this.mipmapEnabled&&this.o){let e=t.getRC();t.bindToGpu(this.getResUid()),this.__$buildParam(e)}}uploadData(t){}__$updateToGpu(t){}updateDataToGpu(t=null,e=!0){null!=t&&(this.d=t),null!=this.d&&this.d.MaterialUpdater.updateTextureData(this,e)}createTexBuf(t){return!t.hasResUid(this.getResUid())&&(this.l=r.TextureTarget.GetValue(t.getRC(),this.k),t.createResByParams3(this.getResUid(),this.getWidth(),this.getHeight(),this.l),!0)}__$$upload(t){if(this.m&&null!=this.e){let e=this.createTexBuf(t);e&&(this.__$updateToGpuBegin(t),this.uploadData(t),this.__$buildParam(t.getRC()),this.o=!0)}}dataUploadToGpu(t,e,i,s=!1){this.version=0;let a=r.TextureFormat.ToGL(t,this.internalFormat),n=r.TextureFormat.ToGL(t,this.srcFormat),l=r.TextureDataType.ToGL(t,this.dataType),h=e;if(null==i)(h.status>-1||s)&&h.updateToGpu(t,this.l,a,n,l,s);else{let e=i;for(let i=0,r=e.length;i<r;++i)h=e[i],null!=h&&(h.status>-1||s)&&h.updateToGpu(t,this.l,a,n,l,s);this.o=!1}}__$updateToGpuBegin(t){let e=t.getRC();t.bindToGpu(this.getResUid()),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,this.unpackAlignment)}__$updateToGpuEnd(t){}isDestroyed(){return this.c<-1}__$destroy(){this.getAttachCount()<1&&(this.c=-2,this.m=!1,this.g=1,this.h=1,this.d=null)}__$$removeFromSlot(){null!=this.e&&-2==this.getAttachCount()&&(this.e=null,this.d=null,this.T=-1)}toString(){return"[TextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.TextureProxy=l,e.default=l},"08ab":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=i("a52f"),n=s(i("9951")),l=s(i("0c5e")),h=i("5216");class o{constructor(){this.p=[0,0,0,0,0,0],this.q=0}updateStatus(t,e){let i=0;switch(t.campType){case a.CampType.Green:i=1;break;case a.CampType.Red:i=2;break;case a.CampType.Blue:i=3;break;default:i=0;break}this.p[i]+=e}addRole(t){this.updateStatus(t,1),this.calcCampTeamsTotal()}removeRole(t){this.updateStatus(t,-1),this.calcCampTeamsTotal()}calcCampTeamsTotal(){this.q=0;for(let t=0;t<6;++t)this.q+=this.p[t]>0?1:0}getCampTeamsTotal(){return this.q}reset(){for(let t=0;t<6;++t)this.p[t]=0;this.q=0}}class m{constructor(){this.r=null,this.s=[],this.t=[],this.u=[],this.v=[],this.w=new r.default,this.x=null,this.roleManager=new o,this.effectRenderProcessIndex=4,this.distance=0,this.y=null,this.z=new Array(128),this.A_=100}getFreeRoles(){return this.t}reviveRole(t){let e=this.t,i=e.length;i>t&&(i=t);for(let s=0;s<i;++s){const t=e[s];if(t.lifeTime=100+Math.round(300*Math.random()),t.setVisible(!0),t.campType!=a.CampType.Free){const e=t.lifeTime%3;switch(e){case 1:t.campType=a.CampType.Red;break;case 2:t.campType=a.CampType.Green;break;default:t.campType=a.CampType.Blue;break}}t.wake(),this.addRole(t),e.splice(s,1),s--,i--}}initialize(t){null==this.r&&(this.r=t,null==this.x&&(this.x=new l.default,this.x.depthOffset=n.default.GetInstance().particleGroupDepthOffset,this.x.materialPipeline=n.default.GetMaterialPipeline(),this.x.pipeTypes=[h.MaterialPipeType.FOG_EXP2],this.x.timeSpeed=15,this.x.initialize(this.r,this.effectRenderProcessIndex,60,50,n.default.GetImageTexByUrl("static/assets/testEFT4.jpg"),n.default.GetImageTexByUrl("static/assets/stones_02.png"),!0)))}addRole(t){null!=t&&t.status==a.CampRoleStatus.Free&&(t.status=a.CampRoleStatus.Busy,this.s.push(t),this.roleManager.addRole(t))}sorting(t,e){let i=this.z;this.y=i[t];while(t<e){while(t<e&&i[e].attackDis>=this.y.attackDis)--e;i[t]=i[e];while(t<e&&i[t].attackDis<=this.y.attackDis)++t;i[e]=i[t]}return i[t]=this.y,t}snsort(t,e){if(t<e){let i=this.sorting(t,e);this.snsort(t,i-1),this.snsort(i+1,e)}}testAttDst(t,e,i,s,r,a=-1){let n=this.s,l=n.length;if(l>0){let i,r=0,a=null;for(;r<l;++r)if(a=n[r],a.campType!=s&&a.lifeTime>0&&(i=e+a.radius,i*=i,this.w.subVecsTo(t,a.position),this.distance=this.w.getLengthSquared(),i>=this.distance))return a.attackDis=Math.sqrt(this.distance),a}return null}testSpecAttDst(t,e,i,s,r,a,n=-1){if(t.lifeTime>0){let s=i+t.radius;if(s*=s,this.w.subVecsTo(e,t.position),this.distance=this.w.getLengthSquared(),s>=this.distance)return t.attackDis=Math.sqrt(this.distance),t}return null}findAttDst(t,e,i,s,r,a=-1){let n=this.s,l=n.length;if(l>0){let i,r=null,a=0;for(let h=0;h<l;++h)r=n[h],r.lifeTime>0?r.campType!=s&&(i=e+r.radius,i*=i,this.w.subVecsTo(t,r.position),this.distance=this.w.getLengthSquared(),i>=this.distance&&(r.attackDis=Math.sqrt(this.distance),this.z[a]=r,a++)):(r.getDestroyedPos(this.w),this.x.createEffect(this.w),n.splice(h,1),h--,l--,this.u.push(r),this.v.push(8));if(a>1&&this.snsort(0,a-1),a>0)return this.distance=this.z[0].attackDis,this.z[0]}return null}run(){if(this.roleManager.getCampTeamsTotal()<2)if(this.A_<1){this.A_=100;let t=Math.round(20*Math.random()+20);this.reviveRole(t)}else this.A_--;let t=this.u,e=t.length;if(e>0){let i=this.v;for(let s=0;s<e;++s)i[s]--,i[s]<1&&(this.roleManager.removeRole(t[s]),t[s].status=a.CampRoleStatus.Free,this.t.push(t[s]),t[s].setVisible(!1),t.splice(s,1),i.splice(s,1),s--,e--)}this.x.run()}destroy(){this.z.fill(null)}}e.default=m},"090c":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("030e")),a=s(i("3b73")),n=s(i("b0ef")),l=s(i("0c85")),h=i("e08e");class o{constructor(){this.T=o.H0++,this.B_=new l.default,this.C_=null,this.D_=null,this.E_=null,this.F_=!1,this.G_=!0,this.H_=!0,this.I_=null,this.J_=null,this.K_=null,this.L_=0,this.M_=0,this.N_=800,this.O_=600,this.P_=2,this.Q_=2,this.R_=1,this.S_=new n.default,this.autoSyncRenderBufferAndWindowSize=!0,this.offscreenRenderEnabled=!1,this.T_=null,this.U_=0,this.V_=0,this.W_=0,this.X_=0,this.Y_=null,this.Z_=null}contextrestoredHandler(t){}contextlostHandler(t){}setWebGLMaxVersion(t){1!=t&&2!=t||(this.P_=t)}getWebGLVersion(){return this.Q_}getDiv(){return this.C_}setDivStyleLeftAndTop(t,e){this.S_.setDivStyleLeftAndTop(t,e)}setDivStyleSize(t,e){this.S_.setDivStyleSize(t,e)}getCanvas(){return this.D_}isDepthTestEnabled(){return this.G_}isStencilTestEnabled(){return this.H_}initialize(t,e,i,s=null){this.K_=e;var n=null,l=null;try{void 0!=document&&(n=document,l=window)}catch(m){}if(null!=n){this.S_.setDiv(i),this.S_.createViewEle(n,this.autoSyncRenderBufferAndWindowSize),this.C_=i=this.S_.getDiv();let m=this.D_=this.S_.getCanvas();this.R_=window.devicePixelRatio,this.B_.dpr=this.R_;let _=s;null==s?_={depth:this.G_,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:this.H_,preserveDrawingBuffer:!0,powerPreference:"default"}:(this.G_=_.depth,this.H_=_.stencil);let u=null;if(this.offscreenRenderEnabled&&(u=m.transferControlToOffscreen()),this.I_=u,2==this.P_&&(this.J_=null==u?m.getContext("webgl2",_):u.getContext("webgl2",_),null!=this.J_&&(this.Q_=2)),null==this.J_&&(this.J_=null==u?m.getContext("webgl",_)||m.getContext("experimental-webgl",_):u.getContext("webgl",_)||u.getContext("experimental-webgl",_),null!=this.J_&&(this.Q_=1)),!this.J_)throw this.Q_=-1,alert("Unable to initialize WebGL. Your browser or machine may not support it."),Error("WebGL initialization failure.");let d=this.J_;d.rcuid=t;let c=h.GLStencilFunc;c.NEVER=d.NEVER,c.LESS=d.LESS,c.EQUAL=d.EQUAL,c.GREATER=d.GREATER,c.NOTEQUAL=d.NOTEQUAL,c.GEQUAL=d.GEQUAL,c.ALWAYS=d.ALWAYS;let f=h.GLStencilOp;f.KEEP=d.KEEP,f.ZERO=d.ZERO,f.REPLACE=d.REPLACE,f.INCR=d.INCR,f.INCR_WRAP=d.INCR_WRAP,f.DECR=d.DECR,f.DECR_WRAP=d.DECR_WRAP,f.INVERT=d.INVERT;let p=h.GLBlendMode;p.ZERO=d.ZERO,p.ONE=d.ONE,p.SRC_COLOR=d.SRC_COLOR,p.DST_COLOR=d.DST_COLOR,p.SRC_ALPHA=d.SRC_ALPHA,p.DST_ALPHA=d.DST_ALPHA,p.ONE_MINUS_SRC_ALPHA=d.ONE_MINUS_SRC_ALPHA;let g=h.GLBlendEquation;g.FUNC_ADD=d.FUNC_ADD,g.FUNC_SUBTRACT=d.FUNC_SUBTRACT,g.FUNC_REVERSE_SUBTRACT=d.FUNC_REVERSE_SUBTRACT,g.MIN_EXT=d.MIN_EXT,g.MAX_EXT=d.MAX_EXT,g.MIN=d.MIN,g.MAX=d.MAX;let v=h.CullFaceMode;v.BACK=d.BACK,v.FRONT=d.FRONT,v.FRONT_AND_BACK=d.FRONT_AND_BACK;let x=a.default;x.MAX_TEXTURE_SIZE=this.J_.getParameter(this.J_.MAX_TEXTURE_SIZE),x.MAX_RENDERBUFFER_SIZE=this.J_.getParameter(this.J_.MAX_RENDERBUFFER_SIZE);let y=this.J_.getParameter(this.J_.MAX_VIEWPORT_DIMS);x.MAX_VIEWPORT_WIDTH=y[0],x.MAX_VIEWPORT_HEIGHT=y[1],r.default.Initialize(this.Q_,this.J_),a.default.Initialize([this.Q_]),null!=e&&this.B_.initialize(m,i,e);let T=r.default.WEBGL_debug_renderer_info;if(null!=T){let t=this.J_.getParameter(T.UNMASKED_VENDOR_WEBGL),e=this.J_.getParameter(T.UNMASKED_RENDERER_WEBGL);x.GPU_VENDOR=t,x.GPU_RENDERER=e,a.default.IsWinExternalVideoCard()}var o=this;l.onresize=function(t){o.autoSyncRenderBufferAndWindowSize&&o.updateRenderBufferSize()},m.addEventListener("webglcontextrestored",this.contextrestoredHandler,!1),m.addEventListener("webglcontextlost",this.contextlostHandler,!1),this.updateRenderBufferSize()}}loseContext(){null==this.T_&&(this.T_=this.J_.getExtension("WEBGL_lose_context")),null==this.T_&&this.T_.loseContext()}isContextLost(){return this.J_.isContextLost()}getRC(){return this.J_}setScissorEnabled(t){t?this.F_||(this.F_=!0,this.J_.enable(this.J_.SCISSOR_TEST)):this.F_&&(this.F_=!1,this.J_.disable(this.J_.SCISSOR_TEST))}setScissorRect(t,e,i,s){this.J_.scissor(t,e,i,s)}setResizeCallback(t,e){this.Z_=t,this.Y_=e}getDevicePixelRatio(){return this.R_}resizeBufferSize(t,e){t=Math.floor(t),e=Math.floor(e);let i=window.devicePixelRatio,s=Math.abs(i-this.R_)>.02;this.R_=i,this.B_.dpr=i,a.default.SetDevicePixelRatio(this.R_),(this.U_!=t||this.V_!=e||s)&&(this.U_=t,this.V_=e,this.W_=Math.floor(t*i),this.X_=Math.floor(e*i),null==this.I_?(this.D_.width=this.W_,this.D_.height=this.X_):(this.I_.width=this.W_,this.I_.height=this.X_),this.D_.style.width=this.U_+"px",this.D_.style.height=this.V_+"px",null!=this.K_&&(this.K_.stageWidth=this.W_,this.K_.stageHeight=this.X_,this.K_.viewWidth=this.U_,this.K_.viewHeight=this.V_,this.K_.pixelRatio=i,this.K_.update()),null!=this.Y_&&this.Y_.call(this.Z_))}getStage(){return this.K_}getStageWidth(){return this.K_.stageWidth}getStageHeight(){return this.K_.stageHeight}getDisplayWidth(){return this.U_}getDisplayHeight(){return this.V_}setViewport(t,e,i,s){let r=this.L_!=t||this.M_!=e;(this.N_!=i||this.O_!=s||r)&&(this.L_=t,this.M_=e,this.N_=i,this.O_=s)}setViewportSize(t,e){this.N_==t&&this.O_==e||(this.N_=t,this.O_=e)}testViewPortChanged(t,e,i,s){return this.L_!=t||this.M_!=e||this.N_!=i||this.O_!=s}getViewportX(){return this.L_}getViewportY(){return this.M_}getViewportWidth(){return this.N_}getViewportHeight(){return this.O_}getFBOWidth(){return this.N_<a.default.MAX_RENDERBUFFER_SIZE?this.N_:a.default.MAX_RENDERBUFFER_SIZE}getFBOHeight(){return this.O_<a.default.MAX_RENDERBUFFER_SIZE?this.O_:a.default.MAX_RENDERBUFFER_SIZE}getRCanvasWidth(){return this.W_}getRCanvasHeight(){return this.X_}updateRenderBufferSize(){let t=this.C_.getBoundingClientRect();this.resizeBufferSize(t.width,t.height)}}o.H0=0,e.default=o},"0929":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("2139")),n=s(i("9156"));class l{constructor(){this.T=0,this.a_=new Float32Array(16),this.b_=!1,this.c_=!1,this.updatedStatus=l.UPDATE_POSITION,this.updateStatus=l.UPDATE_TRANSFORM,this.d_=null,this.e_=null,this.f_=null,this.g_=null,this.h_=!0,this.i_=null,this.T=l.H0++}getUid(){return this.T}getRotationFlag(){return this.c_}getX(){return this.a_[12]}getY(){return this.a_[13]}getZ(){return this.a_[14]}setX(t){this.updateStatus|=1,this.updatedStatus|=1,this.a_[12]=t}setY(t){this.updateStatus|=1,this.updatedStatus|=1,this.a_[13]=t}setZ(t){this.updateStatus|=1,this.updatedStatus|=1,this.a_[14]=t}setXYZ(t,e,i){this.a_[12]=t,this.a_[13]=e,this.a_[14]=i,this.updateStatus|=1,this.updatedStatus|=1}offsetPosition(t){this.a_[12]+=t.x,this.a_[13]+=t.y,this.a_[14]+=t.z,this.updateStatus|=1,this.updatedStatus|=1}setPosition(t){this.a_[12]=t.x,this.a_[13]=t.y,this.a_[14]=t.z,this.updateStatus|=1,this.updatedStatus|=1}getPosition(t){t.x=this.a_[12],t.y=this.a_[13],t.z=this.a_[14]}copyPositionFrom(t){null!=t&&(this.a_[12]=t.a_[12],this.a_[13]=t.a_[13],this.a_[14]=t.a_[14],this.updateStatus|=l.UPDATE_POSITION,this.updatedStatus|=l.UPDATE_POSITION)}getRotationX(){return this.a_[1]}getRotationY(){return this.a_[6]}getRotationZ(){return this.a_[9]}setRotationX(t){this.a_[1]=t,this.c_=!0,this.updateStatus|=l.UPDATE_ROTATION,this.updatedStatus|=l.UPDATE_ROTATION}setRotationY(t){this.a_[6]=t,this.c_=!0,this.updateStatus|=l.UPDATE_ROTATION,this.updatedStatus|=l.UPDATE_ROTATION}setRotationZ(t){this.a_[9]=t,this.c_=!0,this.updateStatus|=l.UPDATE_ROTATION,this.updatedStatus|=l.UPDATE_ROTATION}setRotationXYZ(t,e,i){this.a_[1]=t,this.a_[6]=e,this.a_[9]=i,this.updateStatus|=l.UPDATE_ROTATION,this.updatedStatus|=l.UPDATE_ROTATION,this.c_=!0}getScaleX(){return this.a_[0]}getScaleY(){return this.a_[5]}getScaleZ(){return this.a_[10]}setScaleX(t){this.a_[0]=t,this.updateStatus|=l.UPDATE_SCALE,this.updatedStatus|=l.UPDATE_SCALE}setScaleY(t){this.a_[5]=t,this.updateStatus|=l.UPDATE_SCALE,this.updatedStatus|=l.UPDATE_SCALE}setScaleZ(t){this.a_[10]=t,this.updateStatus|=l.UPDATE_SCALE,this.updatedStatus|=l.UPDATE_SCALE}setScaleXYZ(t,e,i){this.a_[0]=t,this.a_[5]=e,this.a_[10]=i,this.updateStatus|=l.UPDATE_SCALE,this.updatedStatus|=l.UPDATE_SCALE}setScale(t){this.a_[0]=t,this.a_[5]=t,this.a_[10]=t,this.updateStatus|=l.UPDATE_SCALE,this.updatedStatus|=l.UPDATE_SCALE}getRotationXYZ(t){t.x=this.a_[1],t.y=this.a_[6],t.z=this.a_[9]}getScaleXYZ(t){t.x=this.a_[0],t.y=this.a_[5],t.z=this.a_[10]}localToGlobal(t){this.getMatrix().transformVectorSelf(t)}globalToLocal(t){this.getInvMatrix().transformVectorSelf(t)}getInvMatrix(){return null!=this.i_?this.b_&&(this.i_.copyFrom(this.d_),this.i_.invert()):(this.i_=a.default.GetMatrix(),this.i_.copyFrom(this.d_),this.i_.invert()),this.b_=!1,this.i_}getLocalMatrix(){return this.updateStatus>0&&this.update(),this.e_}getMatrix(t=!0){return this.updateStatus>0&&t&&this.update(),this.d_}getToParentMatrix(){return null!=this.g_?this.g_:this.d_}setParentMatrix(t){this.f_=t,this.b_=!0,null!=this.f_&&(this.e_==this.d_?(this.updateStatus=l.UPDATE_TRANSFORM,this.updatedStatus=this.updateStatus,this.e_=a.default.GetMatrix()):(this.updateStatus|=l.UPDATE_PARENT_MAT,this.updatedStatus=this.updateStatus))}updateMatrixData(t){null!=t&&(this.updateStatus=l.UPDATE_NONE,this.b_=!0,this.d_.copyFrom(t))}__$setMatrix(t){null!=t&&(this.updateStatus=l.UPDATE_NONE,this.b_=!0,this.e_==this.d_&&(this.e_=t),null!=this.d_&&(n.default.RemoveTransUniform(this.d_),a.default.RetrieveMatrix(this.d_)),this.d_=t)}destroy(){null!=this.i_&&a.default.RetrieveMatrix(this.i_),null!=this.e_&&(this.d_==this.e_&&n.default.RemoveTransUniform(this.d_),a.default.RetrieveMatrix(this.e_)),null!=this.d_&&this.d_!=this.e_&&(n.default.RemoveTransUniform(this.d_),a.default.RetrieveMatrix(this.d_)),this.i_=null,this.e_=null,this.d_=null,this.f_=null,this.updateStatus=l.UPDATE_TRANSFORM}copyFrom(t){this.a_.set(t.a_,0),this.updatedStatus|=1,this.updateStatus|=l.UPDATE_TRANSFORM,this.c_=t.c_}update(){this.updateStatus>0&&(this.b_=!0,this.updateStatus=this.updateStatus|this.updatedStatus,(this.updateStatus&l.UPDATE_TRANSFORM)>0&&(this.e_.getLocalFS32().set(this.a_,0),this.c_&&this.e_.setRotationEulerAngle(this.a_[1]*r.default.MATH_PI_OVER_180,this.a_[6]*r.default.MATH_PI_OVER_180,this.a_[9]*r.default.MATH_PI_OVER_180),null!=this.f_&&(this.updateStatus=this.updateStatus|l.UPDATE_PARENT_MAT)),this.d_!=this.e_&&this.d_.copyFrom(this.e_),(this.updateStatus&l.UPDATE_PARENT_MAT)==l.UPDATE_PARENT_MAT&&(null!=this.g_||(this.g_=a.default.GetMatrix()),this.g_.copyFrom(this.d_),this.h_=!0,this.d_.append(this.f_)),this.updateStatus=l.UPDATE_NONE)}getMatrixFS32(){return this.getMatrix().getLocalFS32()}toString(){return"[ROTransform(uid = "+this.T+")]"}static GetFreeId(){return l.j_.length>0?l.j_.pop():-1}static Create(t=null){let e=null,i=l.GetFreeId();return i>=0?(e=l.k_[i],l.l_[i]=l.S_FLAG_BUSY):(e=new l,l.k_.push(e),l.l_.push(l.S_FLAG_BUSY),l.G8++),e.d_=null==t?a.default.GetMatrix():t,e.e_=e.d_,e.a_.set(l.H1,0),e}static Restore(t){if(null!=t&&l.l_[t.getUid()]==l.S_FLAG_BUSY){let e=t.getUid();l.j_.push(e),l.l_[e]=l.S_FLAG_FREE,t.destroy()}}}l.H0=0,l.H1=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),l.UPDATE_NONE=0,l.UPDATE_POSITION=1,l.UPDATE_ROTATION=2,l.UPDATE_SCALE=4,l.UPDATE_TRANSFORM=7,l.UPDATE_PARENT_MAT=8,l.S_FLAG_BUSY=1,l.S_FLAG_FREE=0,l.l_=[],l.G8=0,l.k_=[],l.j_=[],e.default=l},"0c54":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("faa5")),n=s(i("b3bd")),l=s(i("3930")),h=s(i("0fc4"));class o extends a.default{constructor(){super(),this.n_=""}initialize(t){this.n_="BillboardAlphaTexShader"}getFragShaderCode(){let t="#version 300 es\nprecision mediump float;\nuniform sampler2D u_sampler0;\nin vec4 v_colorMult;\nin vec2 v_texUV;\nlayout(location = 0) out vec4 FragColor;\nvoid main()\n{\nFragColor = vec4(v_colorMult.xyz,v_colorMult.a * texture(u_sampler0, v_texUV).a);\n}\n";return t}getVertShaderCode(){let t="#version 300 es\nprecision mediump float;\nlayout(location = 0) in vec2 a_vs;\nlayout(location = 1) in vec2 a_uvs;\nuniform mat4 u_objMat;\nuniform mat4 u_viewMat;\nuniform mat4 u_projMat;\nuniform vec4 u_billParam[2];\nout vec4 v_colorMult;\nout vec2 v_texUV;\nvoid main()\n{\nvec4 temp = u_billParam[0];\nfloat cosv = cos(temp.z);\nfloat sinv = sin(temp.z);\nvec2 vtx = vec2(a_vs.x * temp.x, a_vs.y * temp.y);\nvec2 vtx_pos = vec2(vtx.x * cosv - vtx.y * sinv, vtx.x * sinv + vtx.y * cosv);\nvec4 pos = u_viewMat * u_objMat * vec4(0.0,0.0,0.0,1.0);\npos.xy += vtx_pos.xy;\ngl_Position =  u_projMat * pos;\nv_texUV = a_uvs;\nv_colorMult = u_billParam[1];\n}\n";return t}getUniqueShaderName(){return this.n_}toString(){return"[BillboardAlphaTexShaderBuffer()]"}static GetInstance(){return null!=o.H2||(o.H2=new o),o.H2}}o.H2=new o;class m extends h.default{constructor(){super(),this.o_=0,this.p_=new Float32Array([1,1,0,1,1,1,1,1]),this.q_=new l.default(1,1,1,1),this.r_=1}getCodeBuf(){let t=o.GetInstance();return t}createSelfUniformData(){let t=new n.default;return t.uniformNameList=["u_billParam"],t.dataList=[this.p_],t}setRGBA4f(t,e,i,s){this.q_.r=t,this.q_.g=e,this.q_.b=i,this.p_[4]=t*this.r_,this.p_[5]=e*this.r_,this.p_[6]=i*this.r_,this.p_[7]=s}setRGB3f(t,e,i){this.q_.r=t,this.q_.g=e,this.q_.b=i,this.p_[4]=t*this.r_,this.p_[5]=e*this.r_,this.p_[6]=i*this.r_}setAlpha(t){this.p_[7]=t}getAlpha(){return this.p_[6]}setBrightness(t){this.r_=t,this.p_[4]=this.q_.r*t,this.p_[5]=this.q_.g*t,this.p_[6]=this.q_.b*t}getBrightness(){return this.r_}getRotationZ(){return this.o_}setRotationZ(t){this.o_=t,this.p_[2]=t*r.default.MATH_PI_OVER_180}getScaleX(){return this.p_[0]}getScaleY(){return this.p_[1]}setScaleX(t){this.p_[0]=t}setScaleY(t){this.p_[1]=t}setScaleXY(t,e){this.p_[0]=t,this.p_[1]=e}getUniformData(){return this.p_}destroy(){super.destroy(),this.p_=null}}e.default=m},"0c5e":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("776f")),a=s(i("c7a5"));class n extends a.default{constructor(){super(),this.H3=[],this.t_=null,this.u_=null,this.v_=!1,this.materialPipeline=null,this.pipeTypes=null,this.depthOffset=0,this.solidPremultiplyAlpha=!1,this.flamePremultiplyAlpha=!1}initialize(t,e,i,s,a,n,l=!1){if(null==this.w_){this.v_=l,this.t_=a,this.u_=n,this.u_.premultiplyAlpha=this.solidPremultiplyAlpha,this.t_.premultiplyAlpha=this.flamePremultiplyAlpha,this.w_=t,this.x_=e;let h=new r.default;h.materialPipeline=this.materialPipeline,h.pipeTypes=this.pipeTypes,h.initialize(i,s,this.t_,this.u_,this.v_),h.setDepthOffset(this.depthOffset),this.H3.push(h)}}appendEffectSrc(t,e,i){let s=new r.default;s.materialPipeline=this.materialPipeline,s.pipeTypes=this.pipeTypes,s.initialize(t,e,this.t_,this.u_,i),s.setDepthOffset(this.depthOffset),this.H3.push(s)}appendEffect(t,e,i=-1){let s,a=new r.default;a.materialPipeline=this.materialPipeline,a.pipeTypes=this.pipeTypes,null==t&&(t=this.t_),null==e&&(e=this.u_),i<0?s=this.H3[Math.floor((this.H3.length-.5)*Math.random())]:(i=i<this.H3.length?i:this.H3.length-1,s=this.H3[i]),s.initializeFrom(s,t,e,this.v_),this.y_.push(a),this.w_.addEntity(a.solidEntity,this.x_,!1),this.w_.addEntity(a.flameEntity,this.x_,!1),a.setVisible(!1),a.setDepthOffset(this.depthOffset)}createEffect(t){return this.createEffectWithTexture(t,this.t_,this.u_)}createEffectWithTexture(t,e,i){let s;if(this.y_.length<1){null==e&&(e=this.t_),null==i&&(i=this.u_);let t=this.H3[Math.floor((this.H3.length-.5)*Math.random())];s=new r.default,s.materialPipeline=this.materialPipeline,s.pipeTypes=this.pipeTypes,s.initializeFrom(t,e,i,this.v_),s.setDepthOffset(this.depthOffset),this.w_.addEntity(s.solidEntity,this.x_,!1),this.w_.addEntity(s.flameEntity,this.x_,!1)}else s=this.y_.pop();this.z_.push(s);let a=1;return s.setVisible(!0),s.setTime(0),s.setPositionScale(.5),s.solidEntity.setRGB3f(Math.random()+.2,Math.random()+.2,Math.random()+.2),null!=t&&(s.setPosition(t),t.setXYZ(Math.random()+.2,Math.random()+.2,Math.random()+.2),t.normalize(),t.scaleBy(2.5),a=.4*Math.random()+.4,s.solidEntity.setScaleXY(a,a),s.solidEntity.setAcceleration(.01*Math.random()-.005,.002*-Math.random(),.01*Math.random()-.005),s.solidEntity.setRotationXYZ(0,360*Math.random(),0),null!=s.flameEntity&&(s.flameEntity.setRGBOffset3f(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),s.flameEntity.setRGB3f(t.x,t.y,t.z),s.flameEntity.setAcceleration(.01*Math.random()-.005,.002*Math.random()-.001,.01*Math.random()-.005),s.flameEntity.setRotationXYZ(0,360*Math.random(),0))),s.update(),s}destory(){this.materialPipeline=null,this.pipeTypes=null}}e.default=n},"0c85":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73"));class a{constructor(){this.AA=!1,this.AB=0,this.AC=0,this.AD=0,this.dpr=1}initMobile(t,e,i){var s=null;try{void 0!=document&&(s=document)}catch(a){}if(null!=s){let t=this;if(e.addEventListener("touchstart",t=>{let e=t.targetTouches,s=0,r=0;if(e.length<2)s=0|this.dpr*t.targetTouches[0].pageX,r=0|this.dpr*t.targetTouches[0].pageY,i.mouseX=s,i.mouseY=i.stageHeight-r,i.mouseViewX=s,i.mouseViewY=r,this.AA=!0,this.AB=i.mouseX,this.AC=i.mouseY,this.AD=Date.now(),i.mouseDown(1);else{let a=[];for(let i=0;i<e.length;++i)s=0|this.dpr*t.targetTouches[i].pageX,r=0|this.dpr*t.targetTouches[i].pageY,a.push({x:s,y:r});i.mouseMultiDown(a),this.AA=!1}t.preventDefault(),t.stopPropagation()},!1),e.addEventListener("touchend",t=>{this.AA=!1;let e=t.targetTouches,s=0,r=0;if(e.length<1)i.mouseUp(1),this.AD=Date.now()-this.AD,Math.abs(this.AB-i.mouseX)<3&&Math.abs(this.AC-i.mouseY)<3&&this.AD<900&&(this.AB=i.mouseX,this.AC=i.mouseY,i.mouseClick());else{let a=[];for(let i=0;i<e.length;++i)s=0|this.dpr*t.targetTouches[i].pageX,r=0|this.dpr*t.targetTouches[i].pageY,a.push({x:s,y:r});i.mouseMultiUp(a)}t.preventDefault()},!1),e.addEventListener("touchcancel",e=>{t.AA=!1;e.targetTouches;i.mouseCancel(),e.preventDefault()},!1),e.addEventListener("touchmove",t=>{t.preventDefault();let e=t.targetTouches,s=0,r=0;if(this.AA&&(s=0|this.dpr*e[0].pageX,r=0|this.dpr*e[0].pageY,i.mouseViewX=s,i.mouseViewY=r,i.mouseX=s,i.mouseY=i.stageHeight-r,i.mouseMove()),e.length>1){let a=[];for(let i=0;i<e.length;++i)s=0|this.dpr*t.targetTouches[i].pageX,r=0|this.dpr*t.targetTouches[i].pageY,a.push({x:s,y:r});i.mouseMultiMove(a)}},{passive:!1},!1),r.default.IsIpadOS()){let t=document.createElement("meta");t.name="viewport",t.content="width=device-width,initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no",document.getElementsByTagName("head")[0].appendChild(t)}}}initialize(t,e,i){r.default.IsMobileWeb()||r.default.IsIpadOS()||this.initPC(t,e,i),this.initMobile(t,e,i)}initPC(t,e,i){var s=null;try{void 0!=document&&(s=document)}catch(r){}if(null!=s){if(void 0==t.onmousewheel&&void 0!=t.addEventListener){let e=function(t){t.wheelDeltaY=-t.detail,i.mouseWheel(t)};t.addEventListener("DOMMouseScroll",e,!1)}t.onmousewheel=t=>{t.preventDefault(),t.stopPropagation(),i.mouseWheel(t)},t.onmousedown=t=>{let s=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-s.left),a=0|this.dpr*(t.clientY-s.top);i.mouseX=r,i.mouseY=i.stageHeight-a,i.mouseViewX=r,i.mouseViewY=a,this.AB=i.mouseX,this.AC=i.mouseY,this.AD=Date.now(),0==t.button?i.mouseDown(1):2==t.button&&i.mouseRightDown(1)},t.onmouseup=t=>{let s=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-s.left),a=0|this.dpr*(t.clientY-s.top);i.mouseX=r,i.mouseY=i.stageHeight-a,0==t.button?i.mouseUp(1):2==t.button&&i.mouseRightUp(1)},document.onmouseup=t=>{0==t.button?i.mouseWindowUp(1):2==t.button&&i.mouseWindowRightUp(1)},t.onmousemove=t=>{let s=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-s.left),a=0|this.dpr*(t.clientY-s.top);i.mouseX=r,i.mouseY=i.stageHeight-a,i.mouseViewX=r,i.mouseViewY=a,i.mouseMove()},t.onclick=t=>{let s=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-s.left),a=0|this.dpr*(t.clientY-s.top);i.mouseX=r,i.mouseY=i.stageHeight-a,i.mouseViewX=r,i.mouseViewY=a,this.AD=Date.now()-this.AD,Math.abs(this.AB-i.mouseX)<3&&Math.abs(this.AC-i.mouseY)<3&&this.AD<900&&(this.AB=i.mouseX,this.AC=i.mouseY,0==t.button?i.mouseClick():2==t.button&&i.mouseRightClick())},t.ondblclick=t=>{let s=e.getBoundingClientRect(),r=0|this.dpr*(t.clientX-s.left),a=0|this.dpr*(t.clientY-s.top);i.mouseX=r,i.mouseY=i.stageHeight-a,i.mouseViewX=r,i.mouseViewY=a,0==t.button?i.mouseDoubleClick():t.button}}}}e.default=a},"0e01":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("baae")),a=s(i("5326")),n=s(i("29ef")),l=s(i("de9d")),h=s(i("4f27")),o=s(i("7499"));class m{constructor(t){this.AE=null,this.d=null,this.AF=null,this.AG=.1,this.AH=5e3,this.AI=45,this.A=0,this.A=t,this.d=new l.default(t)}getRCUid(){return this.A}getDiv(){return this.AE.getDiv()}getCanvas(){return this.AE.getCanvas()}getRenderAdapter(){return this.AE}getRenderMaterialProxy(){return this.AF}getRenderProxy(){return this.d}getTextureResTotal(){return this.d.Texture.getTextureResTotal()}getTextureAttachTotal(){return this.d.Texture.getAttachTotal()}getDevicePixelRatio(){return this.AE.getDevicePixelRatio()}getStage3D(){return this.d.getStage3D()}getCamera(){return null!=this.d?this.d.getCamera():null}cameraLock(){this.d.cameraLock()}cameraUnlock(){this.d.cameraUnlock()}updateCamera(){null!=this.d&&this.d.updateCamera()}updateCameraDataFromCamera(t){null!=this.d&&this.d.updateCameraDataFromCamera(t)}lockRenderColorMask(){null!=this.d&&this.d.lockRenderColorMask()}unlockRendererColorMask(){null!=this.d&&this.d.unlockRenderState()}useGlobalRenderColorMask(t){null!=this.d&&(this.d.unlockRenderColorMask(),this.d.useRenderColorMask(t),this.d.lockRenderColorMask())}useGlobalRenderColorMaskByName(t){null!=this.d&&(this.d.unlockRenderColorMask(),this.d.useRenderColorMask(n.default.GetRenderColorMaskByName(t)),this.d.lockRenderColorMask())}getRenderColorMaskByName(t){return n.default.GetRenderColorMaskByName(t)}lockRenderState(){null!=this.d&&this.d.lockRenderState()}unlockRenderState(){null!=this.d&&this.d.unlockRenderState()}useGlobalRenderState(t){null!=this.d&&(this.d.unlockRenderState(),this.d.useRenderState(t),this.d.lockRenderState())}useGlobalRenderStateByName(t){null!=this.d&&(this.d.unlockRenderState(),this.d.useRenderState(n.default.GetRenderStateByName(t)),this.d.lockRenderState())}getRenderStateByName(t){return n.default.GetRenderStateByName(t)}lockMaterial(){null!=this.AF&&this.AF.lockMaterial()}unlockMaterial(){null!=this.AF&&this.AF.unlockMaterial()}isUnlockMaterial(){return this.AF.isUnlockMatrial()}useGlobalMaterial(t,e=!1,i=!1){null!=this.AF&&(this.AF.unlockMaterial(),e?this.AF.unlockTexture():this.AF.lockTexture(),this.AF.useGlobalMaterial(t,i),this.AF.lockMaterial())}updateMaterialUniform(t){this.AF.updateMaterialUniform(t)}clearBackBuffer(){this.d.clearBackBuffer()}setScissorRect(t,e,i,s){this.AE.setScissorRect(t,e,i,s)}setScissorEnabled(t){this.AE.setScissorEnabled(t)}setViewPort(t,e,i,s){this.d.setViewPort(t,e,i,s)}synFBOSizeWithViewport(){this.AE.synFBOSizeWithViewport()}asynFBOSizeWithViewport(){this.AE.asynFBOSizeWithViewport()}setFBOSizeFactorWithViewPort(t){this.AE.setFBOSizeFactorWithViewPort(t)}createFBOAt(t,e,i,s,r=!1,a=!1,n=0){this.AE.createFBOAt(t,e,i,s,r,a,n)}bindFBOAt(t,e){this.AE.bindFBOAt(t,e)}setRenderToTexture(t,e=!1,i=!1,s=0){this.AE.setRenderToTexture(t,e,i,s)}useFBO(t=!1,e=!1,i=!1){this.AE.useFBO(t,e,i)}resetFBOAttachmentMask(t){this.AE.resetFBOAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){this.AE.setFBOAttachmentMaskAt(t,e)}setRenderToBackBuffer(){null!=this.AE&&(this.AE.setRenderToBackBuffer(r.default.FRAMEBUFFER),this.AF.renderBegin())}lockViewport(){this.AE.lockViewport()}unlockViewport(){this.AE.unlockViewport()}setClearDepth(t){this.AE.setClearDepth(t)}getClearDepth(){return this.AE.getClearDepth()}getViewportX(){return this.AE.getViewportX()}getViewportY(){return this.AE.getViewportY()}getViewportWidth(){return this.AE.getViewportWidth()}getViewportHeight(){return this.AE.getViewportHeight()}setContextViewSize(t,e){this.AE.setContextViewSize(t,e)}setCameraParam(t,e,i){this.AI=t,this.AG=e,this.AH=i,null!=this.d&&this.d.setCameraParam(t,e,i)}initialize(t,e,i,s,r){if(null==this.AE){a.default.Initialize(this.d.getUid()),this.d.setCameraParam(this.AI,this.AG,this.AH),this.d.setWebGLMaxVersion(t.maxWebGLVersion),this.d.initialize(t,e,i,s,s,r),this.A=this.d.getRCUid(),r.initialize(this.A,this.d.getRC(),this.d.getGLVersion()),this.AE=this.d.getRenderAdapter(),this.AE.bgColor.setRGBA4f(0,0,0,1);let n=this.d.getContext();n.setViewport(0,0,n.getRCanvasWidth(),n.getRCanvasHeight()),h.default.Initialize()}}initManager(t){null==this.AF&&(this.AF=new o.default,this.AF.setDispBuilder(t))}setClearRGBColor3f(t,e,i){this.d.setClearRGBColor3f(t,e,i)}setClearRGBAColor4f(t,e,i,s){this.d.setClearRGBAColor4f(t,e,i,s)}getClearRGBAColor4f(t){t.copyFrom(this.AE.bgColor)}updateRenderBufferSize(){this.AE.updateRenderBufferSize()}vertexRenderBegin(){this.d.Vertex.renderBegin()}renderBegin(t=!0){null!=this.AE&&(this.AE.unlockViewport(),this.AE.setClearDepth(1),this.d.Vertex.renderBegin(),this.AF.renderBegin(),this.AE.update(),this.AE.setClearMaskClearAll(),this.AE.renderBegin(),n.default.ResetInfo(),n.default.Reset(this.d.getRenderContext()),t&&(this.d.useCameraData(),this.d.updateCameraDataFromCamera(this.d.getCamera())))}resetState(){n.default.ResetState(),this.AF.renderBegin()}resetmaterial(){this.AF.renderBegin()}resetUniform(){this.AF.resetUniform()}runEnd(){}}e.default=m},"0fc4":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("9666")),a=s(i("faa5"));class n{constructor(){this.Y=null,this.AJ=null,this.AK=null,this.AL="",this.AM="",this.AN=null,this.AO=null,this.__$troMid=-1,this.__$uniform=null,this.pipeTypes=null,this.AP=null,this.AQ=0,this.AR=!1,this.c=0}setPolygonOffset(t,e=0){null==this.AO?this.AO=[t,e]:(this.AO[0]=t,this.AO[1]=e)}getPolygonOffset(){return this.AO}setDepthOffset(t){}setMaterialPipeline(t){this.AK=t}getMaterialPipeline(){return this.AK}getShdUniqueName(){return this.AM}initializeByUniqueName(t){if(null==this.getShaderData()){let e=r.default.FindData(t);null!=e&&(this.AN=e)}return null!=this.getShaderData()}getCodeBuf(){return null!=n.H4||(n.H4=new a.default),n.H4}hasShaderData(){return null!=this.AN&&(!this.AN.haveTexture()||this.texDataEnabled())}initializeByCodeBuf(t=!1){if(null==this.AN){let e=this.getCodeBuf();if(null!=e){let i;e.reset(),e.pipeline=this.AK,e.pipeTypes=this.pipeTypes,null!=e.pipeline&&e.pipeline.reset(),this.buildBuf();let s=this.AL;if(""!=s&&(i=r.default.FindData(s),this.AM=s),null==i?(null==n.H4&&(n.H4=new a.default),a.default.UseShaderBuffer(e),t=t||this.getTextureTotal()>0,e.initialize(t),s=e.getUniqueShaderName()+e.keysString+e.getShaderCodeBuilder().getUniqueNSKeyString(),this.AM=s,this.__$initShd(this.AM),i=r.default.FindData(s),this.AL=this.AM):(a.default.UseShaderBuffer(e),t=t||this.getTextureTotal()>0,e.initialize(t)),null==i){e.buildShader(),e.buildDefine(),null!=e.pipeline&&(null!=e.getShaderCodeObject()?e.pipeline.addShaderCode(e.getShaderCodeObject(),!1):e.pipeline.addShaderCodeWithUUID(e.getShaderCodeObjectUUID(),!1),e.pipeline.build(e.getShaderCodeBuilder()));let t=e.getFragShaderCode(),n=e.getVertShaderCode();i=r.default.CreateShdData(s,n,t,e.adaptationShaderVersion,a.default.GetPreCompileInfo())}null!=this.AK&&(this.Y=this.AK.getSharedUniforms()),a.default.UseShaderBuffer(null),this.AN=i}}}buildBuf(){}__$initShd(t){}getShaderData(){return this.AN}setTextureList(t){if(this.AP!=t){this.AR=!1,this.AQ=null!=t?t.length:0;let e=0;if(null!=this.AP)for(;e<this.AP.length;++e)this.AP[e].__$detachThis();if(this.AR=!0,this.AP=t,null!=this.AP){let t=31;for(e=0;e<this.AP.length;++e)t=131*t+this.AP[e].getUid(),this.AP[e].__$attachThis(),this.AP[e].isDataEnough()||(this.AR=!1);this.__$troMid=t}}}setTextureAt(t,e){if(t>=0&&null!=e){let i=this.AP,s=i.length;if(null!=i&&i[t]!=e&&t<s&&s>0){i=i.slice(0),i[t].__$detachThis(),i[t]=e,this.AR=e.isDataEnough(),e.__$attachThis();let r=31;for(let t=0;t<s;++t)r=131*r+i[t].getUid();this.__$troMid=r,this.AP=i}}}getTextureList(){return this.AP}getTextureAt(t){return this.AP[t]}getTextureTotal(){return this.AQ}getShdTexTotal(){return null!=this.AN?this.AN.getTexTotal():0}texDataEnabled(){if(null!=this.AP){if(this.AR)return!0;let t=!0,e=this.AP;for(let i=0;i<this.AQ;++i)if(!e[i].isDataEnough()){t=!1;break}return this.AR=t,t}return null!=this.AN&&this.AN.getTexTotal(),!1}createSharedUniforms(){return this.Y}createSharedUniformsData(){return null}createSelfUniformData(){return this.AJ}updateSelfData(t){}hasTexture(){return this.AN.haveTexture()}getBufSortFormat(){return null!=this.AN?this.AN.getLayoutBit():0}__$attachThis(){++this.c}__$detachThis(){--this.c,this.c<1&&(this.c=0)}getAttachCount(){return this.c}destroy(){if(this.Y=null,this.AJ=null,this.pipeTypes=null,this.getAttachCount()<1){if(null!=this.AP)for(let t=0;t<this.AP.length;++t)this.AP[t].__$detachThis();this.AN=null,this.AP=null,this.AR=!1,this.__$troMid=0,null!=this.__$uniform&&(this.__$uniform.destroy(),this.__$uniform=null)}}toString(){return"[MaterialBase()]"}}n.H4=null,e.default=n},"11e6":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static AddContainerFlag(t){return 2147483648|t}static RemoveContainerFlag(t){return-2147483649&t}static AddSpaceUid(t,e){return-1048576&t|e}static RemoveSpaceUid(t){return-1048576&t}static GetSpaceUid(t){return 1048575&t}static AddRendererUid(t,e){return-133169153&t|e<<20}static RemoveRendererUid(t){return 133169152|t}static GetRendererUid(t){return t=(133169152&t)>>20,t<127?t:-1}static TestRendererUid(t){return t=(133169152&t)>>20,t<127}static AddSortEnabled(t){return 1073741824|t}static RemoveSortEnabled(t){return-1073741825&t}static TestSortEnabled(t){return 1073741824==(1073741824&t)}static AddRendererLoad(t){return 805306368|t}static RemoveRendererLoad(t){return-805306369&t}static TestSpaceContains(t){return(1048575&t)>0}static TestSpaceEnabled(t){return(1048575&t)<1}static TestSpaceEnabled2(t){return(1048575&t)<1&&2147483648!=(2147483648&t)}static TestContainerEnabled(t){return 133169152==(133169152&t)&&2147483648!=(2147483648&t)}static TestRendererEnabled(t){return 133169152==(938475520&t)&&2147483648!=(2147483648&t)}}s.DEFAULT=133169152,s.CONTAINER_FLAG=2147483648,s.CONTAINER_NOT_FLAG=-2147483649,s.SPACE_FLAG=1048575,s.SPACE_NOT_FLAG=-1048576,s.RENDERER_UID_FLAG=133169152,s.RENDERER_UID_NOT_FLAG=-133169153,s.RENDERER_UID_INVALID=127,s.SORT_FLAG=1073741824,s.SORT_NOT_FLAG=-1073741825,s.RENDERER_LOAD_FLAG=805306368,s.RENDERER_LOAD_NOT_FLAG=-805306369,s.RENDERER_ADN_LOAD_FLAG=938475520,e.default=s},1216:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("3930")),n=s(i("baae")),l=s(i("722e")),h=s(i("8333")),o=s(i("6d49")),m=i("e08e"),_=i("8d98"),u=i("7c63"),d=s(i("29ef")),c=s(i("3024"));class f{constructor(t,e){this.A=0,this.AS=null,this.J_=null,this.AT=!1,this.AU={mr:!0,mg:!0,mb:!0,ma:!0},this.AV=null,this.AW=0,this.AX=null,this.AY=0,this.AZ=n.default.FRAMEBUFFER,this.Aa=[null,null,null,null,null,null,null,null],this.Ab=!0,this.Ac=!1,this.Ad=!1,this.AO=!1,this.B=0,this.C=0,this.Ae=800,this.Af=600,this.Ag=1,this.Ah=0,this.Ai=new r.default(0,0,800,600),this.Aj=1,this.Ak=0,this.Al=new Uint16Array(8),this.Am=new Uint16Array(4),this.An=1,this.F_=!1,this.Ao=null,this.Ap=2,this.bgColor=new a.default,this.uViewProbe=null,this.Aq=1,this.Ar=!0,this.As=!1,this.AS=e,this.A=t}initialize(t,e,i){if(null==this.AV&&(this.Ap=t.getWebGLVersion(),this.Ao=i,this.AV=t,this.J_=t.getRC(),this.J_.disable(this.J_.SCISSOR_TEST),t.isDepthTestEnabled()?this.J_.enable(this.J_.DEPTH_TEST):this.J_.disable(this.J_.DEPTH_TEST),t.isStencilTestEnabled()?this.J_.enable(this.J_.STENCIL_TEST):this.J_.disable(this.J_.STENCIL_TEST),e.getPolygonOffsetEanbled()?this.enabledPolygonOffset():this.disabledPolygonOffset(),this.J_.enable(this.J_.CULL_FACE),this.J_.cullFace(this.J_.BACK),this.J_.enable(this.J_.BLEND),e.getDitherEanbled()?this.J_.enable(this.J_.DITHER):this.J_.disable(this.J_.DITHER),this.J_.frontFace(this.J_.CCW),this.AW=this.J_.COLOR_BUFFER_BIT|this.J_.DEPTH_BUFFER_BIT|this.J_.STENCIL_BUFFER_BIT,null==this.uViewProbe)){let t=this;t.uViewProbe=new c.default(1),this.uViewProbe.bindSlotAt(this.A),this.uViewProbe.setVec4DataWithArr4([this.B,this.C,this.Ae,this.Af])}}setFrontFaceFlipped(t){this.AT!=t&&(t?this.J_.frontFace(this.J_.CW):this.J_.frontFace(this.J_.CCW),this.AT=t)}enabledPolygonOffset(){this.AO||(this.AO=!0,this.J_.enable(this.J_.POLYGON_OFFSET_FILL))}disabledPolygonOffset(){this.AO&&(this.AO=!1,this.J_.disable(this.J_.POLYGON_OFFSET_FILL))}setPolygonOffset(t,e=0){this.J_.polygonOffset(t,e),this.Ad=!0}resetPolygonOffset(){this.Ad&&(this.J_.polygonOffset(0,0),this.Ad=!1)}getDiv(){return this.AV.getDiv()}getCanvas(){return this.AV.getCanvas()}setClearDepth(t){this.Ag=t}getClearDepth(){return this.Ag}setContextViewSize(t,e){this.AV.autoSyncRenderBufferAndWindowSize=!1,this.AV.resizeBufferSize(t,e)}getViewportX(){return this.AV.getViewportX()}getViewportY(){return this.AV.getViewportY()}getViewportWidth(){return this.AV.getViewportWidth()}getViewportHeight(){return this.AV.getViewportHeight()}getFBOFitWidth(){return this.AV.getFBOWidth()}getFBOFitHeight(){return this.AV.getFBOHeight()}getRCanvasWidth(){return this.AV.getRCanvasWidth()}getRCanvasHeight(){return this.AV.getRCanvasHeight()}setColorMask(t,e,i,s){this.AU.mr=t,this.AU.mg=e,this.AU.mb=i,this.AU.ma=s}setClearMaskClearAll(){this.AW=this.J_.COLOR_BUFFER_BIT|this.J_.DEPTH_BUFFER_BIT|this.J_.STENCIL_BUFFER_BIT}setClearMaskClearOnlyColor(){this.AW=this.J_.COLOR_BUFFER_BIT}setClearMaskClearOnlyDepthAndStencil(){this.AW=this.J_.DEPTH_BUFFER_BIT|this.J_.STENCIL_BUFFER_BIT}setScissorRect(t,e,i,s){this.F_&&this.J_.scissor(t,e,i,s)}setScissorEnabled(t){t?this.F_||(this.F_=!0,this.J_.enable(this.J_.SCISSOR_TEST)):this.F_&&(this.F_=!1,this.J_.disable(this.J_.SCISSOR_TEST))}clearDepth(t=1){this.Ag=t,this.Ah!==this.Ag&&(this.Ah=this.Ag,this.J_.clearDepth(this.Ag)),this.J_.clear(this.J_.DEPTH_BUFFER_BIT)}clearColor(t){this.J_.clearColor(t.r,t.g,t.b,t.a),this.J_.clear(this.J_.COLOR_BUFFER_BIT)}clear(){this.Ah!==this.Ag&&(this.Ah=this.Ag,this.J_.clearDepth(this.Ag)),this.AV.isStencilTestEnabled()&&this.J_.clearStencil(this.Ak),this.J_.clearColor(this.bgColor.r,this.bgColor.g,this.bgColor.b,this.bgColor.a),this.J_.clear(this.AW)}reset(){this.Ao.setCullFaceMode(m.CullFaceMode.BACK),this.Ao.setDepthTestMode(m.DepthTestMode.OPAQUE),d.default.Reset(this.J_)}getRenderContext(){return this.AV}renderBegin(){null!=this.AV&&(this.Aj=1,this.reseizeViewPort(),u.RenderStateObject.Unlock(),u.RenderStateObject.UseRenderState(d.default.NORMAL_STATE),u.RenderColorMask.Unlock(),u.RenderColorMask.UseRenderState(u.RenderColorMask.ALL_TRUE_COLOR_MASK),this.clear())}reseizeViewPort(){if(this.Ar){let t=this.AV.getDevicePixelRatio(),e=this.B!=this.AV.getViewportX()||this.C!=this.AV.getViewportY();e=e||this.Ae!=this.AV.getViewportWidth(),e=e||this.Af!=this.AV.getViewportHeight(),e=e||Math.abs(this.Aq-t)>.01,e&&(this.Aq=t,this.B=this.AV.getViewportX(),this.C=this.AV.getViewportY(),this.Ae=this.AV.getViewportWidth(),this.Af=this.AV.getViewportHeight(),this.uViewProbe.setVec4Data(this.B,this.C,this.Ae,this.Af),this.uViewProbe.update(),this.J_.viewport(this.B,this.C,this.Ae,this.Af))}}reseizeFBOViewPort(){if(this.Ar){let t=this.AV.getDevicePixelRatio(),e=this.B!=this.Ai.x||this.C!=this.Ai.y;e=e||this.Ae!=this.Ai.z,e=e||this.Af!=this.Ai.w,e=e||Math.abs(this.Aq-t)>.01,e&&(this.Aq=t,this.B=this.Ai.x,this.C=this.Ai.y,this.Ae=this.Ai.z,this.Af=this.Ai.w,this.uViewProbe.setVec4Data(this.B,this.C,this.Ae,this.Af),this.uViewProbe.update(),this.J_.viewport(this.B,this.C,this.Ae,this.Af))}}setViewProbeValue(t,e,i,s){this.uViewProbe.setVec4Data(t,e,i,s),this.uViewProbe.update()}lockViewport(){this.Ar=!1}unlockViewport(){this.Ar=!0}renderEnd(){}update(){}updateRenderBufferSize(){this.AV.updateRenderBufferSize()}destroy(){this.AV=null,this.Ao=null}getDevicePixelRatio(){return this.AV.getDevicePixelRatio()}loseContext(){this.AV.loseContext()}isContextLost(){return this.AV.isContextLost()}readPixels(t,e,i,s,r,a,n){this.J_.readPixels(t,e,i,s,_.TextureFormat.ToGL(this.J_,r),_.TextureDataType.ToGL(this.J_,a),n)}setFBOViewRect(t,e,i,s){this.Am[0]=t,this.Am[1]=e,this.Am[2]=i,this.Am[3]=s,this.Ac=!0}createFBOAt(t,e,i,s,r=!1,a=!1,n=0){null==this.Aa[t]&&(t>7&&(t=7),this.AZ=e,this.AX=new o.default(this.A,this.AS,this.AZ),this.AX.multisampleEnabled=n>0,this.AX.multisampleLevel=n,this.AX.writeDepthEnabled=r,this.AX.writeStencilEnabled=a,this.AX.initialize(this.J_,i,s),this.Aa[t]=this.AX,this.AX.sizeFixed=!0)}resizeFBOAt(t,e,i){t>7?t=7:t<0&&(t=0),null!=this.Aa[t]&&this.Aa[t].resize(e,i)}getFBOWidthAt(t){return null!=this.Aa[t]?this.Aa[t].getWidth():0}getFBOHeightAt(t){return null!=this.Aa[t]?this.Aa[t].getHeight():0}synFBOSizeWithViewport(){this.As=!0}asynFBOSizeWithViewport(){this.As=!1}setFBOSizeFactorWithViewPort(t){this.Aj=t}bindFBOAt(t,e){if(t>7?t=7:t<0&&(t=0),this.AX=this.Aa[t],null==this.AX)throw Error("Fatal Error!!! this.AX == null.");this.AY=t,this.AZ=e,this.AX.bind(e),this.Ab=!0}clearFBODepthAt(t,e=1){let i=this.Aa[t];null!=i&&i.clearOnlyDepth(e)}resetFBOAttachmentMask(t){null!=this.AX&&this.AX.resetAttachmentMask(t)}setFBOAttachmentMaskAt(t,e){null!=this.AX&&this.AX.setAttachmentMaskAt(t,e)}getFBOAttachmentTotal(){return null!=this.AX?this.AX.getAttachmentTotal():0}setRenderToTexture(t,e=!1,i=!1,s=0){(s<0||s>=8)&&(s=0),null==t&&0==s?this.setRenderToBackBuffer(n.default.FRAMEBUFFER):(0==s&&(null!=this.AX&&(this.As?this.AX.initialize(this.J_,Math.floor(this.AV.getFBOWidth()*this.Aj),Math.floor(this.AV.getFBOHeight()*this.Aj)):this.Ac?this.AX.initialize(this.J_,this.Am[2],this.Am[3]):this.AX.sizeFixed||this.AX.initialize(this.J_,t.getWidth(),t.getHeight())),this.AY>=0&&null==this.AX&&(this.AX=new o.default(this.A,this.AS,this.AZ),this.Aa[this.AY]=this.AX,this.AX.writeDepthEnabled=e,this.AX.writeStencilEnabled=i,this.As?this.AX.initialize(this.J_,Math.floor(this.AV.getFBOWidth()*this.Aj),Math.floor(this.AV.getFBOHeight()*this.Aj)):this.Ac?this.AX.initialize(this.J_,this.Am[2],this.Am[3]):this.AX.initialize(this.J_,t.getWidth(),t.getHeight()))),null!=this.AX&&this.AX.renderToTexAt(this.J_,t,s),this.Ab=!0)}getActiveAttachmentTotal(){return this.An}getAttachmentTotal(){return this.An}useFBO(t=!1,e=!1,i=!1){null!=this.AX&&this.Ab&&(this.Ab=!1,this.AX.use(this.J_),this.An=this.AX.getActiveAttachmentTotal(),t&&this.AX.clearOnlyColor(this.bgColor),this.AX.writeDepthEnabled?this.AX.writeStencilEnabled?e&&i?this.AX.clearOnlyDepthAndStencil(this.Ag,4294967295):e?this.AX.clearOnlyDepth(this.Ag):i&&this.AX.clearOnlyStencil(255):e&&this.AX.clearOnlyDepth(this.Ag):i&&this.AX.writeStencilEnabled&&this.AX.clearOnlyStencil(255),1==this.Ap&&this.J_.clear(this.AW),this.Al[4]=this.Al[0]=this.B,this.Al[5]=this.Al[1]=this.C,this.Al[6]=this.Al[2]=this.B+this.Ae,this.Al[7]=this.Al[3]=this.C+this.Af,this.Ac?(this.Ac=!1,this.Ai.setTo(this.Am[0],this.Am[1],this.Am[2],this.Am[3]),this.reseizeFBOViewPort()):(this.As?this.Ai.setTo(0,0,Math.floor(this.AV.getFBOWidth()*this.Aj),Math.floor(this.AV.getFBOHeight()*this.Aj)):(this.AX.isSizeChanged()&&this.AX.initialize(this.J_,this.AX.getWidth(),this.AX.getHeight()),this.Ai.setTo(0,0,this.AX.getWidth(),this.AX.getHeight())),this.reseizeFBOViewPort()))}setRenderToBackBuffer(t=n.default.FRAMEBUFFER){this.An=1,o.default.BindToBackbuffer(this.J_,t),this.reseizeViewPort()}bindFBOToDraw(){null!=this.AX&&this.AX.bind(n.default.DRAW_FRAMEBUFFER)}bindFBOToWrite(){null!=this.AX&&this.AX.bind(n.default.READ_FRAMEBUFFER)}setBlitFboSrcRect(t,e,i,s){this.Al[0]=t,this.Al[1]=e,this.Al[2]=t+i,this.Al[3]=e+s}setBlitFboDstRect(t,e,i,s){this.Al[4]=t,this.Al[5]=e,this.Al[6]=t+i,this.Al[7]=e+s}blitFBO(t=0,e=0,i=h.default.COLOR_BUFFER_BIT,s=l.default.NEAREST,r=0,a=0,m=null){t>7&&(t=7),e>7&&(e=7),t>=0&&null!=this.Aa[t]?this.Aa[t].bind(n.default.READ_FRAMEBUFFER):o.default.BindToBackbuffer(this.J_,n.default.READ_FRAMEBUFFER),e>=0&&null!=this.Aa[e]?this.Aa[e].bind(n.default.DRAW_FRAMEBUFFER):o.default.BindToBackbuffer(this.J_,n.default.DRAW_FRAMEBUFFER),r>0&&(a<0&&(a=0),null==m&&(m=[0,0,0,1]),this.J_.clearBufferfv(r,a,m));let _=this.Al;this.J_.blitFramebuffer(_[0],_[1],_[2],_[3],_[4],_[5],_[6],_[7],i,s)}}e.default=f},"125c":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("e9f0"));class a{constructor(){this.uvs=null,this.texture=null,this.rect=null,this.clampUVRect=null,this.uniqueName=""}getWidth(){return null!=this.rect?this.rect.width:0}getHeight(){return null!=this.rect?this.rect.height:0}destroy(){this.uvs=null,this.texture=null,this.rect=null}}e.CanvasTextureObject=a;class n{constructor(){if(this.At=null,this.Au=null,null!=n.H5)throw Error("class CanvasTextureTool is a singleton class.");n.H5=this}static GetInstance(){return null!=n.H5?n.H5:new n}initialize(t){null==this.At&&(this.At=t)}initializeAtlas(t,e,i,s=!1){let a=null;null==n.H8[0]&&(a=new r.default(this.At,t,e,i,s),n.H8[0]=a)}getAtlasAt(t){return n.H8[t]}addcharsToAtlas(t,e,i="rgba(255,255,255,1.0)",s="rgba(255,255,255,0.3)"){if(""!=t){n.H8[0];let a=r.default.CreateCharsTexture(t,e,i,s);return this.addImageToAtlas(t,a)}return null}getTextureObject(t){let e=n.H8[0],i=e.getAreaByName(t);if(null!=i){let t=new a;return t.texture=e.getTexture(),t.uvs=i.uvs.slice(0),t.rect=i.texRect.clone(),t.clampUVRect=i.texRect.clone(),t.clampUVRect.x/=e.getWidth(),t.clampUVRect.y/=e.getHeight(),t.clampUVRect.width/=e.getWidth(),t.clampUVRect.height/=e.getHeight(),t.uniqueName=i.uniqueNS,t}return null}addImageToAtlas(t,e){let i=n.H8[0],s=i.addSubImage(t,e);if(null!=s){let t=new a;return t.texture=i.getTexture(),t.uvs=s.uvs,t.rect=s.texRect,t.clampUVRect=s.texRect.clone(),t.clampUVRect.x/=i.getWidth(),t.clampUVRect.y/=i.getHeight(),t.clampUVRect.width/=i.getWidth(),t.clampUVRect.height/=i.getHeight(),t.uniqueName=s.uniqueNS,t}return null}getTextureObjectFromAtlas(t){return null}createCharsImage(t,e,i="rgba(255,255,255,1.0)",s="rgba(255,255,255,0.3)"){return null==t||""==t||e<8?null:r.default.CreateCharsTexture(t,e,i,s)}createWhiteTex(){if(null!=this.Au)return this.Au;let t=16,e=document.createElement("canvas");e.width=t,e.height=t;let i=e.getContext("2d");i.fillStyle="white",i.fillRect(0,0,t,t);let s=this.At.textureBlock.createImageTex2D(32,32);return s.setDataFromImage(e),this.Au=s,s.premultiplyAlpha=!0,s}}n.H5=null,n.H6=new Map,n.H7=new Map,n.H8=[null,null,null,null],e.CanvasTextureTool=n,e.default=n},1264:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("11e6")),a=i("e08e"),n=i("eca0");class l{constructor(t,e,i,s){this.Av=null,this.Aw=null,this.Ax=null,this.Ay=[],this.Az=[],this.A0=-1,this.A1=0,this.A2=null,this.A3=null,this.version=0,this.A0=t,this.Aw=e,this.Av=i,this.Ax=s}setListener(t){this.A3=t}isEmpty(){return this.A1<1}isHaveEntity(){return this.A1>0}removeEntity(t){this.A1--;let e=t.getDisplay();if(null!=e&&null!=e.__$$runit){let t=e.__$ruid,i=this.Av.getRCRPObj(t);if(null!=i){if(i.count>0)if(i.count<2)i.rprocessUid>-1&&(this.A2=this.Ax.getNodeByUid(i.rprocessUid),this.A2.removeDisp(e),i.rprocessUid=-1);else{let t=n.RCRPObj.RenerProcessMaxTotal;for(let s=0;s<t;++s)(i.idsFlag&1<<s)>0&&(this.A2=this.Ax.getNodeByUid(s),this.A2.removeDisp(e))}}else this.A2=this.Ax.getNodeByUid(e.__$$runit.getRPROUid()),this.A2.removeDisp(e);0==i.count&&(e.__$$rsign,a.DisplayRenderSign.LIVE_IN_RENDERER,e.__$$rsign=a.DisplayRenderSign.NOT_IN_RENDERER,this.Av.restoreByUid(t)),this.version++}t.__$rseFlag=r.default.RemoveRendererUid(t.__$rseFlag),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.RemoveSortEnabled(t.__$rseFlag),null!=this.A3&&this.A3.removeFromRenderer(t,this.A0,-1)}addEntity(t,e,i=!1){if(null!=t){let s=t.getDisplay();if(null!=s){if(s.__$$rsign==a.DisplayRenderSign.LIVE_IN_RENDERER&&!this.Av.testRPNodeNotExists(s.__$ruid,e))return;this.A2=this.Ax.getNodeByUid(e),t.__$rseFlag=this.A2.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),i?(s.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(s.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.A0),this.Ay.push(t),this.Az.push(e)):this.testValidData(t)?this.ensureAdd(t,s,e):(s.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(s.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),t.__$rseFlag=r.default.AddRendererLoad(t.__$rseFlag),this.Ay.push(t),this.Az.push(e))}else t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.A0)}return!1}testValidData(t){if(null!=t.getMaterial()&&t.hasMesh()){if(t.getMaterial().hasShaderData())return!0;null!=t.getMaterial().getCodeBuf()&&t.activeDisplay()}return!1}ensureAdd(t,e,i){t.update(),t.__$rseFlag=r.default.AddRendererUid(t.__$rseFlag,this.A0),t.__$rseFlag=r.default.RemoveRendererLoad(t.__$rseFlag),t.__$setRenderProxy(this.Aw.getRenderProxy()),this.A1++,e.__$$rsign==a.DisplayRenderSign.NOT_IN_RENDERER&&(e.__$$rsign=a.DisplayRenderSign.GO_TO_RENDERER),this.A2=this.Ax.getNodeByUid(i),(e.__$ruid>-1||this.Aw.buildGpuDisp(e))&&this.A2.addDisp(e),null!=this.A3&&this.A3.addToRenderer(t,this.A0,i),null!=t.getGlobalBounds()&&(e.__$$runit.bounds=t.getGlobalBounds(),e.__$$runit.pos=e.__$$runit.bounds.center),this.version++}updateWaitList(){let t=this.Ay.length,e=null,i=null;for(let s=0;s<t;++s)if(e=this.Ay[s],(r.default.RENDERER_LOAD_FLAG&e.__$rseFlag)==r.default.RENDERER_LOAD_FLAG){if(this.testValidData(e)){if(i=e.getDisplay(),i.__$$rsign==a.DisplayRenderSign.LIVE_IN_RENDERER&&!this.Av.testRPNodeNotExists(i.__$ruid,this.Az[s])){this.Ay.splice(s,1),this.Az.splice(s,1),--t,--s;continue}this.ensureAdd(e,i,this.Az[s]),this.Ay.splice(s,1),this.Az.splice(s,1),--t,--s}}else i=e.getDisplay(),null!=i&&i.__$$rsign==a.DisplayRenderSign.GO_TO_RENDERER&&(i.__$$rsign=a.DisplayRenderSign.NOT_IN_RENDERER),e.__$rseFlag=r.default.RemoveRendererLoad(e.__$rseFlag),e.__$rseFlag=r.default.RemoveRendererUid(e.__$rseFlag),e.__$rseFlag=r.default.RemoveSortEnabled(e.__$rseFlag),this.Ay.splice(s,1),this.Az.splice(s,1),--t,--s,null!=this.A3&&this.A3.removeFromRenderer(e,this.A0,-1)}update(){this.Ay.length>0&&this.updateWaitList(),this.Aw.update()}}e.default=l},1710:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("a996"));class n extends a.default{constructor(){super(),this.lpos=new r.default,this.wpos=new r.default,this.raytv=new r.default(1,0,0),this.raypv=new r.default(0,0,0),this.mouseX=0,this.mouseY=0,this.mouseViewX=0,this.mouseViewY=0,this.posArray=null,this.wheelDeltaY=0}static GetMouseEvtTypeValueBase(){return 5001}static GetMouseEvtTypeValuesTotal(){return 18}getClassType(){return n.EventClassType}toString(){return"[MouseEvent]"}}n.EventClassType=1002,n.MOUSE_DOWN=5001,n.MOUSE_UP=5002,n.MOUSE_RIGHT_UP=5003,n.MOUSE_RIGHT_DOWN=5004,n.MOUSE_MOVE=5005,n.MOUSE_WHEEL=5006,n.MOUSE_OVER=5007,n.MOUSE_OUT=5008,n.MOUSE_CLICK=5009,n.MOUSE_RIGHT_CLICK=5010,n.MOUSE_DOUBLE_CLICK=5011,n.MOUSE_CANCEL=5012,n.MOUSE_MULTI_DOWN=5013,n.MOUSE_MULTI_UP=5014,n.MOUSE_MULTI_MOVE=5015,n.MOUSE_BG_DOWN=5016,n.MOUSE_BG_UP=5017,n.MOUSE_BG_CLICK=5018,e.default=n},"18c7":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("8e17")),n=s(i("abdb"));class l{constructor(t=null,e=0){this.T=-1,this.A4=0,this.a_=null,this.A5=null,this.A4=e,null!=t?(this.T=l.H0++,this.a_=t,this.A5=this.a_.subarray(e,e+16)):(this.T=l.H_B++,this.a_=new Float32Array(16),this.a_.set(l.H_A,0),this.A5=this.a_)}setData(t){16==t.length&&this.A5.set(t)}getCapacity(){return 16}GetMaxUid(){return l.H0}getUid(){return this.T}getLocalFS32(){return this.A5}getFS32(){return this.a_}getFSIndex(){return this.A4}identity(){this.A5.set(l.H_A,0)}determinant(){return(this.A5[0]*this.A5[5]-this.A5[4]*this.A5[1])*(this.A5[10]*this.A5[15]-this.A5[14]*this.A5[11])-(this.A5[0]*this.A5[9]-this.A5[8]*this.A5[1])*(this.A5[6]*this.A5[15]-this.A5[14]*this.A5[7])+(this.A5[0]*this.A5[13]-this.A5[12]*this.A5[1])*(this.A5[6]*this.A5[11]-this.A5[10]*this.A5[7])+(this.A5[4]*this.A5[9]-this.A5[8]*this.A5[5])*(this.A5[2]*this.A5[15]-this.A5[14]*this.A5[3])-(this.A5[4]*this.A5[13]-this.A5[12]*this.A5[5])*(this.A5[2]*this.A5[11]-this.A5[10]*this.A5[3])+(this.A5[8]*this.A5[13]-this.A5[12]*this.A5[9])*(this.A5[2]*this.A5[7]-this.A5[6]*this.A5[3])}append(t){let e=t.getLocalFS32(),i=this.A5,s=i[0],r=i[4],a=i[8],n=i[12],l=i[1],h=i[5],o=i[9],m=i[13],_=i[2],u=i[6],d=i[10],c=i[14],f=i[3],p=i[7],g=i[11],v=i[15],x=e[0],y=e[4],T=e[8],b=e[12],S=e[1],E=e[5],M=e[9],A=e[13],R=e[2],L=e[6],P=e[10],D=e[14],w=e[3],F=e[7],B=e[11],C=e[15];i[0]=s*x+l*y+_*T+f*b,i[1]=s*S+l*E+_*M+f*A,i[2]=s*R+l*L+_*P+f*D,i[3]=s*w+l*F+_*B+f*C,i[4]=r*x+h*y+u*T+p*b,i[5]=r*S+h*E+u*M+p*A,i[6]=r*R+h*L+u*P+p*D,i[7]=r*w+h*F+u*B+p*C,i[8]=a*x+o*y+d*T+g*b,i[9]=a*S+o*E+d*M+g*A,i[10]=a*R+o*L+d*P+g*D,i[11]=a*w+o*F+d*B+g*C,i[12]=n*x+m*y+c*T+v*b,i[13]=n*S+m*E+c*M+v*A,i[14]=n*R+m*L+c*P+v*D,i[15]=n*w+m*F+c*B+v*C}append3x3(t){let e=t.getLocalFS32(),i=this.A5,s=i[0],r=i[4],a=i[8],n=i[1],l=i[5],h=i[9],o=i[2],m=i[6],_=i[10],u=e[0],d=e[4],c=e[8],f=e[1],p=e[5],g=e[9],v=e[2],x=e[6],y=e[10];i[0]=s*u+n*d+o*c,i[1]=s*f+n*p+o*g,i[2]=s*v+n*x+o*y,i[4]=r*u+l*d+m*c,i[5]=r*f+l*p+m*g,i[6]=r*v+l*x+m*y,i[8]=a*u+h*d+_*c,i[9]=a*f+h*p+_*g,i[10]=a*v+h*x+_*y}appendRotationPivot(t,e,i=null){null==i&&(i=a.default.Z_AXIS),l.H9.identity(),l.H9.getAxisRotation(e.x,e.y,e.z,t),l.H9.appendTranslationXYZ(i.x,i.y,i.z),this.append(l.H9)}appendRotation(t,e){l.H9.identity(),l.H9.getAxisRotation(e.x,e.y,e.z,t),this.append(l.H9)}appendRotationX(t){l.H9.rotationX(t),this.append3x3(l.H9)}appendRotationY(t){l.H9.rotationY(t),this.append3x3(l.H9)}appendRotationZ(t){l.H9.rotationZ(t),this.append3x3(l.H9)}appendRotationEulerAngle(t,e,i){l.H9.rotationY(e),this.append3x3(l.H9),l.H9.rotationX(t),this.append3x3(l.H9),l.H9.rotationZ(i),this.append3x3(l.H9)}setScaleXYZ(t,e,i){let s=this.A5;s[0]=t,s[5]=e,s[10]=i}setRotationEulerAngle(t,e,i){let s=this.A5,r=Math.cos(t),a=Math.sin(t),n=Math.cos(e),l=Math.sin(e),h=Math.cos(i),o=Math.sin(i),m=h*l,_=o*l,u=n*s[0],d=a*s[5],c=r*s[5],f=r*s[10],p=a*s[10];s[1]=o*u,s[2]=-l*s[0],s[0]=h*u,s[4]=m*d-o*c,s[8]=m*f+o*p,s[5]=_*d+h*c,s[9]=_*f-h*p,s[6]=n*d,s[10]=n*f}setRotationEulerAngle2(t,e,i,s,r,a){let n=this.A5,l=r*s,h=a*s,o=i*n[0],m=e*n[5],_=t*n[5],u=t*n[10],d=e*n[10];n[1]=a*o,n[2]=-s*n[0],n[0]=r*o,n[4]=l*m-a*_,n[8]=l*u+a*d,n[5]=h*m+r*_,n[9]=h*u-r*d,n[6]=i*m,n[10]=i*u}setTranslationXYZ(t,e,i){this.A5[12]=t,this.A5[13]=e,this.A5[14]=i}setTranslation(t){this.A5[12]=t.x,this.A5[13]=t.y,this.A5[14]=t.z}appendScaleXYZ(t,e,i){let s=this.A5;s[0]*=t,s[1]*=t,s[2]*=t,s[3]*=t,s[4]*=e,s[5]*=e,s[6]*=e,s[7]*=e,s[8]*=i,s[9]*=i,s[10]*=i,s[11]*=i}appendScaleXY(t,e){this.A5[0]*=t,this.A5[1]*=t,this.A5[2]*=t,this.A5[3]*=t,this.A5[4]*=e,this.A5[5]*=e,this.A5[6]*=e,this.A5[7]*=e}appendTranslationXYZ(t,e,i){this.A5[12]+=t,this.A5[13]+=e,this.A5[14]+=i}appendTranslation(t){this.A5[12]+=t.x,this.A5[13]+=t.y,this.A5[14]+=t.z}copyColumnFrom(t,e){switch(t){case 0:this.A5[0]=e.x,this.A5[1]=e.y,this.A5[2]=e.z,this.A5[3]=e.w;break;case 1:this.A5[4]=e.x,this.A5[5]=e.y,this.A5[6]=e.z,this.A5[7]=e.w;break;case 2:this.A5[8]=e.x,this.A5[9]=e.y,this.A5[10]=e.z,this.A5[11]=e.w;break;case 3:this.A5[12]=e.x,this.A5[13]=e.y,this.A5[14]=e.z,this.A5[15]=e.w;break;default:break}}copyColumnTo(t,e){t<<=2,e.x=this.A5[t],e.y=this.A5[1+t],e.z=this.A5[2+t],e.w=this.A5[3+t]}setF32ArrAndIndex(t,e=0){null!=t&&e>=0&&(this.a_=t,this.A4=e,this.A5=this.a_.subarray(e,e+16))}setF32ArrIndex(t=0){t>=0&&(this.A4=t,this.A5=this.a_.subarray(t,t+16))}setF32Arr(t){null!=t&&(this.a_=t)}copyFromF32Arr(t,e=0){let i=0;for(let s=e+16;e<s;e++)this.A5[i]=t[e],++i}copyToF32Arr(t,e=0){t.set(this.A5,e)}copyFrom(t){this.A5.set(t.A5,0)}copyTo(t){t.A5.set(this.A5,0)}copyRawDataFrom(t,e=16,i=0,s=!1){s&&this.transpose(),e-=i;let r=0;while(r<e)this.a_[this.A4+r]=t[r+i],++r;s&&this.transpose()}copyRawDataTo(t,e=16,i=0,s=!1){s&&this.transpose();let r=0;while(r<e)t[r+i]=this.a_[this.A4+r],++r;s&&this.transpose()}copyRowFrom(t,e){switch(t){case 0:this.A5[0]=e.x,this.A5[4]=e.y,this.A5[8]=e.z,this.A5[12]=e.w;break;case 1:this.A5[1]=e.x,this.A5[5]=e.y,this.A5[9]=e.z,this.A5[13]=e.w;break;case 2:this.A5[2]=e.x,this.A5[6]=e.y,this.A5[10]=e.z,this.A5[14]=e.w;break;case 3:this.A5[3]=e.x,this.A5[7]=e.y,this.A5[11]=e.z,this.A5[15]=e.w;break;default:break}}copyRowTo(t,e){e.x=this.A5[t],e.y=this.A5[4+t],e.z=this.A5[8+t],e.w=this.A5[12+t]}decompose(t){let e=[],i=l.H9,s=i.getFS32();i.copyFrom(this);let h=new a.default(s[12],s[13],s[14]),o=new a.default;o.x=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]),o.y=Math.sqrt(s[4]*s[4]+s[5]*s[5]+s[6]*s[6]),o.z=Math.sqrt(s[8]*s[8]+s[9]*s[9]+s[10]*s[10]),s[0]*(s[5]*s[10]-s[6]*s[9])-s[1]*(s[4]*s[10]-s[6]*s[8])+s[2]*(s[4]*s[9]-s[5]*s[8])<0&&(o.z=-o.z),s[0]/=o.x,s[1]/=o.x,s[2]/=o.x,s[4]/=o.y,s[5]/=o.y,s[6]/=o.y,s[8]/=o.z,s[9]/=o.z,s[10]/=o.z;let m=new a.default;switch(t){case n.default.AXIS_ANGLE:{m.w=r.default.SafeACos((s[0]+s[5]+s[10]-1)/2);let t=Math.sqrt((s[6]-s[9])*(s[6]-s[9])+(s[8]-s[2])*(s[8]-s[2])+(s[1]-s[4])*(s[1]-s[4]));t>r.default.MATH_MIN_POSITIVE?(m.x=(s[6]-s[9])/t,m.y=(s[8]-s[2])/t,m.z=(s[1]-s[4])/t):m.x=m.y=m.z=0}break;case n.default.QUATERNION:{let t=s[0]+s[5]+s[10];t>0?(m.w=Math.sqrt(1+t)/2,m.x=(s[6]-s[9])/(4*m.w),m.y=(s[8]-s[2])/(4*m.w),m.z=(s[1]-s[4])/(4*m.w)):s[0]>s[5]&&s[0]>s[10]?(m.x=Math.sqrt(1+s[0]-s[5]-s[10])/2,m.w=(s[6]-s[9])/(4*m.x),m.y=(s[1]+s[4])/(4*m.x),m.z=(s[8]+s[2])/(4*m.x)):s[5]>s[10]?(m.y=Math.sqrt(1+s[5]-s[0]-s[10])/2,m.x=(s[1]+s[4])/(4*m.y),m.w=(s[8]-s[2])/(4*m.y),m.z=(s[6]+s[9])/(4*m.y)):(m.z=Math.sqrt(1+s[10]-s[0]-s[5])/2,m.x=(s[8]+s[2])/(4*m.z),m.y=(s[6]+s[9])/(4*m.z),m.w=(s[1]-s[4])/(4*m.z))}break;case n.default.EULER_ANGLES:m.y=Math.asin(-s[2]),1!=s[2]&&-1!=s[2]?(m.x=Math.atan2(s[6],s[10]),m.z=Math.atan2(s[1],s[0])):(m.z=0,m.x=Math.atan2(s[4],s[5]));break;default:break}return e.push(h),e.push(m),e.push(o),i=null,e}invert(){let t=this.determinant(),e=Math.abs(t)>r.default.MATH_MIN_POSITIVE;if(e){let e=this.A5;t=1/t;let i=e[0],s=e[4],r=e[8],a=e[12],n=e[1],l=e[5],h=e[9],o=e[13],m=e[2],_=e[6],u=e[10],d=e[14],c=e[3],f=e[7],p=e[11],g=e[15];e[0]=t*(l*(u*g-d*p)-h*(_*g-d*f)+o*(_*p-u*f)),e[1]=-t*(n*(u*g-d*p)-h*(m*g-d*c)+o*(m*p-u*c)),e[2]=t*(n*(_*g-d*f)-l*(m*g-d*c)+o*(m*f-_*c)),e[3]=-t*(n*(_*p-u*f)-l*(m*p-u*c)+h*(m*f-_*c)),e[4]=-t*(s*(u*g-d*p)-r*(_*g-d*f)+a*(_*p-u*f)),e[5]=t*(i*(u*g-d*p)-r*(m*g-d*c)+a*(m*p-u*c)),e[6]=-t*(i*(_*g-d*f)-s*(m*g-d*c)+a*(m*f-_*c)),e[7]=t*(i*(_*p-u*f)-s*(m*p-u*c)+r*(m*f-_*c)),e[8]=t*(s*(h*g-o*p)-r*(l*g-o*f)+a*(l*p-h*f)),e[9]=-t*(i*(h*g-o*p)-r*(n*g-o*c)+a*(n*p-h*c)),e[10]=t*(i*(l*g-o*f)-s*(n*g-o*c)+a*(n*f-l*c)),e[11]=-t*(i*(l*p-h*f)-s*(n*p-h*c)+r*(n*f-l*c)),e[12]=-t*(s*(h*d-o*u)-r*(l*d-o*_)+a*(l*u-h*_)),e[13]=t*(i*(h*d-o*u)-r*(n*d-o*m)+a*(n*u-h*m)),e[14]=-t*(i*(l*d-o*_)-s*(n*d-o*m)+a*(n*_-l*m)),e[15]=t*(i*(l*u-h*_)-s*(n*u-h*m)+r*(n*_-l*m))}return e}pointAt(t,e,i){null!=e&&void 0!=e||(e=new a.default(0,0,-1)),null!=i&&void 0!=i||(i=new a.default(0,-1,0));let s=e.subtract(t),n=new a.default(i.x,i.y,i.z);s.normalize(),n.normalize();let l=new a.default(s.x,s.y,s.z);l.scaleBy(n.dot(s)),n.subtractBy(l),n.getLength()>r.default.MATH_MIN_POSITIVE?n.normalize():0!=s.x?n.setTo(-s.y,s.x,0):n.setTo(1,0,0);let h=n.crossProduct(s);h.normalize();let o=this.A5;o[0]=h.x,o[4]=h.y,o[8]=h.z,o[12]=0,o[1]=n.x,o[5]=n.y,o[9]=n.z,o[13]=0,o[2]=s.x,o[6]=s.y,o[10]=s.z,o[14]=0,o[3]=t.x,o[7]=t.y,o[11]=t.z,o[15]=1}prepend(t){let e=t.getLocalFS32(),i=this.A5,s=e[0],r=e[4],a=e[8],n=e[12],l=e[1],h=e[5],o=e[9],m=e[13],_=e[2],u=e[6],d=e[10],c=e[14],f=e[3],p=e[7],g=e[11],v=e[15],x=i[0],y=i[4],T=i[8],b=i[12],S=i[1],E=i[5],M=i[9],A=i[13],R=i[2],L=i[6],P=i[10],D=i[14],w=i[3],F=i[7],B=i[11],C=i[15];i[0]=s*x+l*y+_*T+f*b,i[1]=s*S+l*E+_*M+f*A,i[2]=s*R+l*L+_*P+f*D,i[3]=s*w+l*F+_*B+f*C,i[4]=r*x+h*y+u*T+p*b,i[5]=r*S+h*E+u*M+p*A,i[6]=r*R+h*L+u*P+p*D,i[7]=r*w+h*F+u*B+p*C,i[8]=a*x+o*y+d*T+g*b,i[9]=a*S+o*E+d*M+g*A,i[10]=a*R+o*L+d*P+g*D,i[11]=a*w+o*F+d*B+g*C,i[12]=n*x+m*y+c*T+v*b,i[13]=n*S+m*E+c*M+v*A,i[14]=n*R+m*L+c*P+v*D,i[15]=n*w+m*F+c*B+v*C}prepend3x3(t){let e=t.getLocalFS32(),i=this.A5,s=e[0],r=e[4],a=e[8],n=e[1],l=e[5],h=e[9],o=e[2],m=e[6],_=e[10],u=i[0],d=i[4],c=i[8],f=i[1],p=i[5],g=i[9],v=i[2],x=i[6],y=i[10];i[0]=s*u+n*d+o*c,i[1]=s*f+n*p+o*g,i[2]=s*v+n*x+o*y,i[4]=r*u+l*d+m*c,i[5]=r*f+l*p+m*g,i[6]=r*v+l*x+m*y,i[8]=a*u+h*d+_*c,i[9]=a*f+h*p+_*g,i[10]=a*v+h*x+_*y}prependRotationPivot(t,e,i){l.H9.identity(),l.H9.getAxisRotation(e.x,e.y,e.z,t),l.H9.appendTranslationXYZ(i.x,i.y,i.z),this.prepend(l.H9)}prependRotation(t,e){l.H9.identity(),l.H9.getAxisRotation(e.x,e.y,e.z,t),this.prepend(l.H9)}prependRotationX(t){l.H9.rotationX(t),this.prepend3x3(l.H9)}prependRotationY(t){l.H9.rotationY(t),this.prepend3x3(l.H9)}prependRotationZ(t){l.H9.rotationZ(t),this.prepend3x3(l.H9)}prependRotationEulerAngle(t,e,i){l.H9.rotationY(e),this.prepend3x3(l.H9),l.H9.rotationX(t),this.prepend3x3(l.H9),l.H9.rotationZ(i),this.prepend3x3(l.H9)}prependScale(t,e,i){let s=this.A5;s[0]*=t,s[1]*=e,s[2]*=i,s[4]*=t,s[5]*=e,s[6]*=i,s[8]*=t,s[9]*=e,s[10]*=i,s[12]*=t,s[13]*=e,s[14]*=i}prependScaleXY(t,e){this.A5[0]*=t,this.A5[1]*=e,this.A5[4]*=t,this.A5[5]*=e,this.A5[8]*=t,this.A5[9]*=e,this.A5[12]*=t,this.A5[13]*=e}prependTranslationXYZ(t,e,i){l.H9.identity(),this.prepend(l.H9)}prependTranslation(t){l.H9.identity(),this.prepend(l.H9)}recompose(t,e){if(t.length<3||0==t[2].x||0==t[2].y||0==t[2].z)return!1;this.identity();let i=l.H9.getFS32();i[0]=i[1]=i[2]=t[2].x,i[4]=i[5]=i[6]=t[2].y,i[8]=i[9]=i[10]=t[2].z;let s=this.A5;switch(e){case n.default.EULER_ANGLES:{let e=Math.cos(t[1].x),r=Math.cos(t[1].y),a=Math.cos(t[1].z),n=Math.sin(t[1].x),l=Math.sin(t[1].y),h=Math.sin(t[1].z);s[0]=r*a*i[0],s[1]=r*h*i[1],s[2]=-l*i[2],s[3]=0,s[4]=(n*l*a-e*h)*i[4],s[5]=(n*l*h+e*a)*i[5],s[6]=n*r*i[6],s[7]=0,s[8]=(e*l*a+n*h)*i[8],s[9]=(e*l*h-n*a)*i[9],s[10]=e*r*i[10],s[11]=0,s[12]=t[0].x,s[13]=t[0].y,s[14]=t[0].z,s[15]=1}break;default:{let r=t[1].x,a=t[1].y,l=t[1].z,h=t[1].w;if(e==n.default.AXIS_ANGLE){let t=.5*h;r*=Math.sin(t),a*=Math.sin(t),l*=Math.sin(t),h=Math.cos(t)}s[0]=(1-2*a*a-2*l*l)*i[0],s[1]=(2*r*a+2*h*l)*i[1],s[2]=(2*r*l-2*h*a)*i[2],s[3]=0,s[4]=(2*r*a-2*h*l)*i[4],s[5]=(1-2*r*r-2*l*l)*i[5],s[6]=(2*a*l+2*h*r)*i[6],s[7]=0,s[8]=(2*r*l+2*h*a)*i[8],s[9]=(2*a*l-2*h*r)*i[9],s[10]=(1-2*r*r-2*a*a)*i[10],s[11]=0,s[12]=t[0].x,s[13]=t[0].y,s[14]=t[0].z,s[15]=1}break}return 0==t[2].x&&(this.A5[0]=0),0==t[2].y&&(this.A5[5]=0),0==t[2].z&&(this.A5[10]=0),i=null,!0}setThreeAxes(t,e,i){let s=this.A5;s[0]=t.x,s[1]=t.y,s[2]=t.z,s[4]=e.x,s[5]=e.y,s[6]=e.z,s[8]=i.x,s[9]=i.y,s[10]=i.z}deltaTransformVector(t){let e=t.x,i=t.y,s=t.z;return new a.default(e*this.A5[0]+i*this.A5[4]+s*this.A5[8],e*this.A5[1]+i*this.A5[5]+s*this.A5[9],e*this.A5[2]+i*this.A5[6]+s*this.A5[10],0)}deltaTransformVectorSelf(t){let e=this.A5,i=t.x,s=t.y,r=t.z;t.x=i*e[0]+s*e[4]+r*e[8],t.y=i*e[1]+s*e[5]+r*e[9],t.z=i*e[2]+s*e[6]+r*e[10]}deltaTransformOutVector(t,e){let i=this.A5;e.x=t.x*i[0]+t.y*i[4]+t.z*i[8],e.y=t.x*i[1]+t.y*i[5]+t.z*i[9],e.z=t.x*i[2]+t.y*i[6]+t.z*i[10]}transformVector(t){let e=this.A5,i=t.x,s=t.y,r=t.z;return new a.default(i*e[0]+s*e[4]+r*e[8]+e[12],i*e[1]+s*e[5]+r*e[9]+e[13],i*e[2]+s*e[6]+r*e[10]+e[14],i*e[3]+s*e[7]+r*e[11]+e[15])}transformOutVector(t,e){let i=t.x,s=t.y,r=t.z,a=this.A5;e.setTo(i*a[0]+s*a[4]+r*a[8]+a[12],i*a[1]+s*a[5]+r*a[9]+a[13],i*a[2]+s*a[6]+r*a[10]+a[14],i*a[3]+s*a[7]+r*a[11]+a[15])}transformOutVector3(t,e){let i=this.A5;e.x=t.x*i[0]+t.y*i[4]+t.z*i[8]+i[12],e.y=t.x*i[1]+t.y*i[5]+t.z*i[9]+i[13],e.z=t.x*i[2]+t.y*i[6]+t.z*i[10]+i[14]}transformVector3Self(t){let e=t.x,i=t.y,s=t.z,r=this.A5;t.x=e*r[0]+i*r[4]+s*r[8]+r[12],t.y=e*r[1]+i*r[5]+s*r[9]+r[13],t.z=e*r[2]+i*r[6]+s*r[10]+r[14]}transformVectorSelf(t){let e=t.x,i=t.y,s=t.z,r=this.A5;t.setTo(e*r[0]+i*r[4]+s*r[8]+r[12],e*r[1]+i*r[5]+s*r[9]+r[13],e*r[2]+i*r[6]+s*r[10]+r[14],e*r[3]+i*r[7]+s*r[11]+r[15])}transformVectors(t,e,i){let s,r,a,n=0,l=this.A5;e-=3;while(n<=e)s=t[n],r=t[n+1],a=t[n+2],i[n]=s*l[0]+r*l[4]+a*l[8]+l[12],i[n+1]=s*l[1]+r*l[5]+a*l[9]+l[13],i[n+2]=s*l[2]+r*l[6]+a*l[10]+l[14],n+=3}transformVectorsSelf(t,e){let i,s,r,a=0,n=this.A5;e-=3;while(a<=e)i=t[a],s=t[a+1],r=t[a+2],t[a]=i*n[0]+s*n[4]+r*n[8]+n[12],t[a+1]=i*n[1]+s*n[5]+r*n[9]+n[13],t[a+2]=i*n[2]+s*n[6]+r*n[10]+n[14],a+=3}transformVectorsRangeSelf(t,e,i){let s,r,a,n=e,l=this.A5;i-=3;while(n<=i)s=t[n],r=t[n+1],a=t[n+2],t[n]=s*l[0]+r*l[4]+a*l[8]+l[12],t[n+1]=s*l[1]+r*l[5]+a*l[9]+l[13],t[n+2]=s*l[2]+r*l[6]+a*l[10]+l[14],n+=3}transpose(){l.H9.copyFrom(this);let t=l.H9.getFS32(),e=this.A5;e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11]}interpolateTo(t,e){let i=t.getFS32(),s=t.getFSIndex(),r=0,a=this.A4;while(r<16)this.a_[a]+=(i[s+r]-this.a_[a])*e,++a,++r}getAxisRotation(t,e,i,s){s=-s;let r=this.A5,a=Math.sin(s),n=Math.cos(s),l=1-n;r[0]=n+t*t*l,r[5]=n+e*e*l,r[10]=n+i*i*l;let h=t*e*l,o=i*a;r[4]=h+o,r[1]=h-o,h=t*i*l,o=e*a,r[8]=h-o,r[2]=h+o,h=e*i*l,o=t*a,r[9]=h+o,r[6]=h-o}rotationX(t){let e=Math.sin(t),i=Math.cos(t);this.A5[0]=1,this.A5[1]=0,this.A5[2]=0,this.A5[4]=0,this.A5[5]=i,this.A5[6]=e,this.A5[8]=0,this.A5[9]=-e,this.A5[10]=i}rotationY(t){let e=Math.sin(t),i=Math.cos(t);this.A5[0]=i,this.A5[1]=0,this.A5[2]=-e,this.A5[4]=0,this.A5[5]=1,this.A5[6]=0,this.A5[8]=e,this.A5[9]=0,this.A5[10]=i}rotationZ(t){let e=Math.sin(t),i=Math.cos(t);this.A5[0]=i,this.A5[1]=e,this.A5[2]=0,this.A5[4]=-e,this.A5[5]=i,this.A5[6]=0,this.A5[8]=0,this.A5[9]=0,this.A5[10]=1}toString(){let t="\n"+this.A5[0]+","+this.A5[1]+","+this.A5[2]+","+this.A5[3]+"\n";return t+=this.A5[4]+","+this.A5[5]+","+this.A5[6]+","+this.A5[7]+"\n",t+=this.A5[8]+","+this.A5[9]+","+this.A5[10]+","+this.A5[11]+"\n",t+=this.A5[12]+","+this.A5[13]+","+this.A5[14]+","+this.A5[15]+"\n",t}transformPerspV4Self(t){t.w=t.z,t.x*=this.A5[0],t.y*=this.A5[5],t.z*=this.A5[10],t.z+=this.A5[14],t.w*=this.A5[11],t.w+=this.A5[15]}perspectiveRH(t,e,i,s){let r=Math.tan(.5*t);this.identity(),this.A5[0]=1/(e*r),this.A5[5]=1/r,this.A5[10]=-(s+i)/(s-i),this.A5[11]=-1,this.A5[14]=-2*s*i/(s-i)}perspectiveRH2(t,e,i,s,r){let a=e/Math.tan(.5*t),n=a/e,l=a/i,h=-r/(r-s),o=-s*h;this.identity(),this.A5[0]=n,this.A5[5]=l,this.A5[10]=h,this.A5[11]=-1,this.A5[14]=o}orthoRH(t,e,i,s,r,a){this.identity(),this.A5[0]=2/(s-i),this.A5[5]=2/(e-t),this.A5[10]=-2/(a-r),this.A5[12]=-(s+i)/(s-i),this.A5[13]=-(e+t)/(e-t),this.A5[14]=-(a+r)/(a-r),this.A5[15]=1}perspectiveLH(t,e,i,s){let r=Math.tan(.5*t);this.identity(),this.A5[0]=1/(e*r),this.A5[5]=1/r,this.A5[10]=(s+i)/(s-i),this.A5[11]=1,this.A5[14]=2*s*i/(s-i)}orthoLH(t,e,i,s,r,a){this.identity(),this.A5[0]=2/(s-i),this.A5[5]=2/(e-t),this.A5[10]=2/(a-r),this.A5[12]=-(s+i)/(s-i),this.A5[13]=-(e+t)/(e-t),this.A5[14]=-(a+r)/(a-r),this.A5[15]=1}lookAtRH(t,e,i){this.identity();let s=e.subtract(t);s.normalize();let r=s.crossProduct(i);r.normalize();let a=r.crossProduct(s);r.w=-r.dot(t),a.w=-a.dot(t),s.w=s.dot(t),s.negate(),this.copyRowFrom(0,r),this.copyRowFrom(1,a),this.copyRowFrom(2,s)}lookAtLH(t,e,i){this.identity();let s=e.subtract(t);s.normalize();let r=s.crossProduct(i);r.normalize();let a=r.crossProduct(s);r.w=-r.dot(t),a.w=-a.dot(t),s.w=-s.dot(t),this.copyRowFrom(0,r),this.copyRowFrom(1,a),this.copyRowFrom(2,s)}destroy(){this.A5=null,this.a_=null,this.A4=-1}}l.H_A=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),l.H0=0,l.H_B=327679,l.H9=new l,e.default=l},"1e15":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8a0a")),a=s(i("030e"));class n{constructor(){this.A=0,this.A6=2,this.A7=null,this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.vroUid=0,this.rioUid=0}getRC(){return this.A7}getRCUid(){return this.A}createBuf(){return this.A7.createBuffer()}deleteBuf(t){this.A7.deleteBuffer(t)}bindArrBuf(t){this.A7.bindBuffer(this.A7.ARRAY_BUFFER,t)}bindEleBuf(t){this.A7.bindBuffer(this.A7.ELEMENT_ARRAY_BUFFER,t)}arrBufSubData(t,e){this.A7.bufferSubData(this.A7.ARRAY_BUFFER,e,t)}arrBufData(t,e){this.A7.bufferData(this.A7.ARRAY_BUFFER,t,r.default.ToGL(this.A7,e))}eleBufSubData(t,e){this.A7.bufferSubData(this.A7.ELEMENT_ARRAY_BUFFER,e,t)}eleBufData(t,e){this.A7.bufferData(this.A7.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.A7,e))}arrBufDataMem(t,e){this.A7.bufferData(this.A7.ARRAY_BUFFER,t,r.default.ToGL(this.A7,e))}eleBufDataMem(t,e){this.A7.bufferData(this.A7.ELEMENT_ARRAY_BUFFER,t,r.default.ToGL(this.A7,e))}useVtxAttribsPtrTypeFloat(t,e,i,s,r,a){this.A7.bindBuffer(this.A7.ARRAY_BUFFER,e);for(let n=0;n<s;++n)t.vertexAttribPointerTypeFloat(i[n],a,r[n])}useVtxAttribsPtrTypeFloatMulti(t,e,i,s,r,a){for(let n=0;n<s;++n)this.A7.bindBuffer(this.A7.ARRAY_BUFFER,e[n]),t.vertexAttribPointerTypeFloat(i[n],a,r[n])}createVertexArray(){let t=null;return t=2==this.A6?this.A7.createVertexArray():a.default.OES_vertex_array_object.createVertexArrayOES(),t}bindVertexArray(t){return 2==this.A6?this.A7.bindVertexArray(t):a.default.OES_vertex_array_object.bindVertexArrayOES(t),t}deleteVertexArray(t){2==this.A6?this.A7.deleteVertexArray(t):a.default.OES_vertex_array_object.deleteVertexArrayOES(t)}testVROUid(t){return this.vroUid!=t&&(this.vroUid=t,!0)}testRIOUid(t){return this.rioUid!=t&&(this.rioUid=t,!0)}initialize(t,e,i){this.A7=e,this.A=t,this.A6=i;let s=this;s.RGBA=e.RGBA,s.UNSIGNED_BYTE=e.UNSIGNED_BYTE,s.TRIANGLE_STRIP=e.TRIANGLE_STRIP,s.TRIANGLE_FAN=e.TRIANGLE_FAN,s.TRIANGLES=e.TRIANGLES,s.LINES=this.A7.LINES,s.LINE_STRIP=e.LINE_STRIP,s.UNSIGNED_SHORT=e.UNSIGNED_SHORT,s.UNSIGNED_INT=e.UNSIGNED_INT,s.COLOR=e.COLOR,s.DEPTH=e.DEPTH,s.STENCIL=e.STENCIL,s.DEPTH_STENCIL=e.DEPTH_STENCIL,this.A6>1?(s.MIN=e.MIN,s.MAX=e.MAX):(s.MIN=a.default.EXT_blend_minmax.MIN_EXT,s.MAX=a.default.EXT_blend_minmax.MAX_EXT),s.RContext=e}renderBegin(){this.vroUid=-2,this.rioUid=-3}toString(){return"[Object ROVtxBuilder()]"}}e.default=n},"1ea6":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73"));class a{constructor(){this.n_="PBRShd",this.codeBuilder=null,this.specularEnvMap=null,this.diffuseMap=null,this.normalMap=null,this.aoMap=null,this.mirrorMap=null,this.indirectEnvMap=null,this.parallaxMap=null,this.roughnessMap=null,this.woolEnabled=!0,this.toneMappingEnabled=!0,this.specularEnvMapEnabled=!0,this.scatterEnabled=!0,this.specularBleedEnabled=!0,this.metallicCorrection=!0,this.gammaCorrection=!0,this.absorbEnabled=!1,this.normalNoiseEnabled=!1,this.pixelNormalNoiseEnabled=!1,this.mirrorProjEnabled=!1,this.mirrorMapLodEnabled=!1,this.diffuseMapEnabled=!1,this.normalMapEnabled=!1,this.aoMapEnabled=!1,this.indirectEnvMapEnabled=!1,this.hdrBrnEnabled=!1,this.vtxFlatNormal=!1,this.lightEnabled=!0,this.shadowReceiveEnabled=!1,this.fogEnabled=!1,this.texturesTotal=1,this.fragLocalParamsTotal=2,this.parallaxParamIndex=2}createTextureList(){let t=this.codeBuilder,e=t.uniform,i=[];return this.specularEnvMapEnabled&&null!=this.specularEnvMap&&(i.push(this.specularEnvMap),e.addspecularEnvMap(!0)),this.diffuseMapEnabled&&null!=this.diffuseMap&&(i.push(this.diffuseMap),e.addDiffuseMap()),this.normalMapEnabled&&null!=this.normalMap&&(i.push(this.normalMap),e.addNormalMap()),this.aoMapEnabled&&null!=this.aoMap&&(i.push(this.aoMap),e.addAOMap()),this.mirrorProjEnabled&&null!=this.mirrorMap&&(i.push(this.mirrorMap),e.add2DMap("VOX_MIRROR_PROJ_MAP",!0,!0,!1)),this.indirectEnvMapEnabled&&null!=this.indirectEnvMap&&(i.push(this.indirectEnvMap),e.addCubeMap("VOX_INDIRECT_ENV_MAP",!0,!1)),null!=this.parallaxMap&&(i.push(this.parallaxMap),e.addParallaxMap(this.parallaxParamIndex)),null!=this.roughnessMap&&(i.push(this.roughnessMap),e.addRoughnessMap()),this.texturesTotal=i.length,i}copyFrom(t){this.woolEnabled=t.woolEnabled,this.toneMappingEnabled=t.toneMappingEnabled,this.specularEnvMapEnabled=t.specularEnvMapEnabled,this.scatterEnabled=t.scatterEnabled,this.specularBleedEnabled=t.specularBleedEnabled,this.metallicCorrection=t.metallicCorrection,this.gammaCorrection=t.gammaCorrection,this.absorbEnabled=t.absorbEnabled,this.normalNoiseEnabled=t.normalNoiseEnabled,this.pixelNormalNoiseEnabled=t.pixelNormalNoiseEnabled,this.mirrorProjEnabled=t.mirrorProjEnabled,this.mirrorMapLodEnabled=t.mirrorMapLodEnabled,this.diffuseMapEnabled=t.diffuseMapEnabled,this.normalMapEnabled=t.normalMapEnabled,this.aoMapEnabled=t.aoMapEnabled,this.indirectEnvMapEnabled=t.indirectEnvMapEnabled,this.shadowReceiveEnabled=t.shadowReceiveEnabled,this.fogEnabled=t.fogEnabled,this.hdrBrnEnabled=t.hdrBrnEnabled,this.vtxFlatNormal=t.vtxFlatNormal,this.fragLocalParamsTotal=t.fragLocalParamsTotal,null==this.specularEnvMap&&(this.specularEnvMap=t.specularEnvMap),null==this.diffuseMap&&(this.diffuseMap=t.diffuseMap),null==this.normalMap&&(this.normalMap=t.normalMap),null==this.aoMap&&(this.aoMap=t.aoMap),null==this.mirrorMap&&(this.mirrorMap=t.mirrorMap),null==this.indirectEnvMap&&this.indirectEnvMapEnabled&&(this.indirectEnvMap=t.indirectEnvMap),null==this.parallaxMap&&(this.parallaxMap=t.parallaxMap),null==this.roughnessMap&&(this.roughnessMap=t.roughnessMap),this.lightEnabled=t.lightEnabled,this.texturesTotal=t.texturesTotal}buildShader(){let t=this.codeBuilder;t.normalMapEnabled=this.normalMapEnabled,t.mapLodEnabled=!0,t.useHighPrecious();let e=this.mirrorProjEnabled&&this.texturesTotal>0;this.normalNoiseEnabled&&t.addDefine("VOX_NORMAL_NOISE"),this.woolEnabled&&t.addDefine("VOX_WOOL"),this.toneMappingEnabled&&t.addDefine("VOX_TONE_MAPPING"),this.scatterEnabled&&t.addDefine("VOX_SCATTER"),this.specularBleedEnabled&&t.addDefine("VOX_SPECULAR_BLEED"),this.metallicCorrection&&t.addDefine("VOX_METALLIC_CORRECTION"),this.gammaCorrection&&t.addDefine("VOX_GAMMA_CORRECTION"),this.absorbEnabled&&t.addDefine("VOX_ABSORB"),this.pixelNormalNoiseEnabled&&t.addDefine("VOX_PIXEL_NORMAL_NOISE"),this.mirrorMapLodEnabled&&t.addDefine("VOX_MIRROR_MAP_LOD","1"),this.hdrBrnEnabled&&t.addDefine("VOX_HDR_BRN","1"),this.vtxFlatNormal&&t.addDefine("VOX_VTX_FLAT_NORMAL","1"),t.addFragUniform("vec4","u_fragLocalParams",this.fragLocalParamsTotal),t.addFragUniform("vec4","u_pbrParams",4),e&&(t.addFragUniformParam(r.default.StageParam),t.addFragUniform("vec4","u_mirrorParams",2)),t.vertMatrixInverseEnabled=!0}getUniqueShaderName(){let t=this.n_;return this.woolEnabled&&(t+="_wl"),this.toneMappingEnabled&&(t+="TM"),this.specularEnvMapEnabled&&(t+="EnvM"),this.scatterEnabled&&(t+="Sct"),this.specularBleedEnabled&&(t+="SpecBl"),this.metallicCorrection&&(t+="MetCorr"),this.gammaCorrection&&(t+="GmaCorr"),this.absorbEnabled&&(t+="Absorb"),this.pixelNormalNoiseEnabled&&(t+="PNNoise"),this.mirrorProjEnabled&&(t+="MirPrj"),this.normalNoiseEnabled&&(t+="NNoise"),this.indirectEnvMapEnabled&&(t+="IndirEnv"),this.normalMapEnabled&&(t+="NorMap"),this.aoMapEnabled&&(t+="AoMap"),this.shadowReceiveEnabled&&(t+="Shadow"),this.fogEnabled&&(t+="Fog"),this.hdrBrnEnabled&&(t+="HdrBrn"),this.vtxFlatNormal&&(t+="vtxFlagN"),t+="_T"+this.texturesTotal,this.n_=t,t}toString(){return"[PBRShaderBuffer()]"}}e.default=a},"1eb2":function(t,e,i){"use strict";if("undefined"!==typeof window){var s=window.document.currentScript,r=i("8875");s=r(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:r});var a=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);a&&(i.p=a[1])}},"1f1a":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("c497")),n=s(i("f63b")),l=s(i("b161")),h=i("2fe8c"),o=i("da82");class m{constructor(t){if(this.A8=null,this.priority=0,this.processIdList=null,this.contextResetEnabled=!1,null==t)throw Error("rscene is null !!!");this.A8=t}enableMouseEvent(t=!0){this.A8.enableMouseEvent(t)}getRScene(){return this.A8}}e.RendererSceneNode=m;class _{constructor(){this.A9=[],this.texLoader=null,this.stage3D=null,this.rscene=null,this.uiScene=null,this.interaction=new o.UserInteraction}initialize(t=null,e=3){if(null==this.rscene){let i;null==t&&(t=new a.default,t.setAttriAntialias(!r.default.IsMobileWeb()),t.setCamPosition(1800,1800,1800),t.setCamProject(45,20,7e3)),i=new l.default,i.initialize(t,e),i.updateCamera();let s=this;s.stage3D=i.getStage3D(),s.rscene=i,s.texLoader=new n.default(this.rscene.textureBlock),s.uiScene=new h.OrthoUIScene,this.uiScene.initialize(this.rscene),this.interaction.initialize(i);let o=new m(this.rscene);o.priority=0,o.contextResetEnabled=!0,this.A9.push(o),o=new m(this.uiScene),o.priority=1,o.contextResetEnabled=!0,this.A9.push(o)}}setAccessorAt(t,e){if(t>=0&&t<this.A9.length){let i=this.A9[t];if(0!=t){let t=i.getRScene();t.setAccessor(e)}else{let t=i.getRScene();t.setAccessor(e)}}}appendRendererScene(t,e=3,i=!0,s=-1){null==t&&(t=new a.default,t.setAttriAntialias(!r.default.IsMobileWeb()),t.setCamPosition(1800,1800,1800),t.setCamProject(45,20,7e3));let n=this.rscene.createSubScene();n.initialize(t,e,i);let l=new m(n);return l.priority=s<0?this.A9.length:s,this.A9.push(l),l}getRendererSceneAt(t){return t>=0&&t<this.A9.length?this.A9[t]:null}getRendererScenesTotal(){return this.A9.length}setProcessIdListAt(t,e){t>=0&&t<this.A9.length&&(this.A9[t].processIdList=e)}setPriorityAt(t,e){if(e<1)throw Error("priority < 1 !!!");t>0&&t<this.A9.length&&(this.A9[t].priority=e)}swapScenePriorityAt(t,e){if(0!=t&&0!=e&&t!=e&&t>=0&&t<this.A9.length&&e>=0&&e<this.A9.length){let i=this.A9[t].priority;this.A9[t].priority=this.A9[e].priority,this.A9[e].priority=i}}swapSceneAt(t,e){if(0!=t&&0!=e&&t!=e&&t>=0&&t<this.A9.length&&e>=0&&e<this.A9.length){let i=this.A9[t].priority;this.A9[t].priority=this.A9[e].priority,this.A9[e].priority=i;let s=this.A9[t];this.A9[t]=this.A9[e],this.A9[e]=s}}sortScenes(){this.A9[0].priority=0,this.A9.sort((t,e)=>t.priority-e.priority)}showInfo(){}getRendererStatus(){return this.rscene.getRendererStatus()}run(){this.interaction.run();let t,e=!0,i=this.A9,s=i.length,r=s-1,a=i[r].getRScene();for(a.runBegin(!0,!0),a.update(!1,!0),e=a.isRayPickSelected(),r-=1;r>=0;--r)a=i[r].getRScene(),a.runBegin(!1,!0),a.update(!1,!e),e=e||a.isRayPickSelected();for(r=0;r<s;++r){t=i[r],a=i[r].getRScene(),a.renderBegin(t.contextResetEnabled);const e=t.processIdList;if(null==e)a.run(!1);else for(let t=0;t<e.length;++t)a.runAt(e[t]);a.runEnd()}}}e.EngineBase=_,e.default=_},"20ef":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("8a0a"));class n{constructor(t){this.AN=null,this.T=-1,this.A_A=null,this.A=-1,this.J_=null,this.A_B="",this.A_C=0,this.A_D=null,this.A_E=null,this.A_F=null,this.A_G=null,this.A_H=null,this.A_I=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.A_J=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],this.A_K=null,this.A_L=new Map,this.A_M=new Map,this.A_N=null,this.A_O=null,this.dataUniformEnabled=!1,this.A_P=0,this.A_Q=0,this.A_R=null,this.A_S=0,this.T=t}setShdData(t){this.AN=t,this.A_B=t.getUniqueShaderName()}getUid(){return this.T}getTexTotal(){return this.AN.getTexTotal()}useTexLocation(){for(let t=0;t<this.A_C;t++)this.J_.uniform1i(this.A_H[t],t)}haveTexture(){return this.AN.haveTexture()}createLocations(){let t=0,e=0,i=this.AN.getAttriNSList();if(null!=i&&i.length>0&&null==this.A_D){this.dataUniformEnabled=!1;let s=this.AN.getAttriSizeList();this.A_D=[],this.A_E=[],this.A_F=[],e=i.length;let n=0,l=0;while(t<e)l=this.J_.getAttribLocation(this.A_A,i[t]),this.A_D.push(l),n=a.default.GetVBufAttributeTypeByNS(i[t]),this.A_E.push(n),this.A_F.push(s[t]),this.A_I[n]=l,this.A_J[n]=s[t],this.dataUniformEnabled=!0,++t;for(this.A_K=[],t=0;t<this.A_J.length;++t)this.A_J[t]>0&&this.A_K.push(this.A_J[t]);r.default.SHADERCODE_TRACE_ENABLED}if(this.AN.haveCommonUniform()&&null==this.A_G){let i=this.AN.getUniforms();this.A_G=[],e=i.length,t=0;let s=null,a="";while(t<e)i[t].isTex||(a=i[t].name,s=this.J_.getUniformLocation(this.A_A,a),r.default.SHADERCODE_TRACE_ENABLED,null!=s?(s.uniformName=a,s.uniqueName=this.A_B,i[t].location=s,this.A_L.set(a,i[t]),this.A_M.set(a,s),this.A_G.push(s),this.dataUniformEnabled=!0):r.default.SHADERCODE_TRACE_ENABLED),++t}if(this.A_C=this.AN.getTexTotal(),this.A_C>0){this.A_H=new Array(this.A_C);let e=this.AN.getTexUniformNames();for(t=0;t<this.A_C;++t)e[t]="u_sampler"+t,this.A_H[t]=this.J_.getUniformLocation(this.A_A,e[t])}}getLayoutBit(){return this.AN.getLayoutBit()}getMid(){return this.AN.getMid()}getFragOutputTotal(){return this.AN.getFragOutputTotal()}getLocationsTotal(){return this.A_E.length}getLocationTypeByIndex(t){return this.A_E[t]}getLocationSizeByIndex(t){return this.A_F[t]}testVertexAttribPointerOffset(t){let e=!1;if(null!=t&&null!=this.A_K&&t.length>=this.A_K.length){let i=0,s=0;for(;s<this.A_K.length;++s){if(i!=t[s])break;i+=4*this.A_K[s]}e=s>=this.A_K.length}if(!e)throw Error("Shader program vertx attributes layout can not match float attribute vertex data !!!");return e}vertexAttribPointerType(t,e,i,s,r,a){this.A_P=this.A_I[t],this.A_P>-1&&(this.J_.enableVertexAttribArray(this.A_P),this.J_.vertexAttribPointer(this.A_P,this.A_J[t],i,s,r,a))}vertexAttribPointerTypeFloat(t,e,i){this.A_P=this.A_I[t],this.A_P>-1&&(this.J_.enableVertexAttribArray(this.A_P),this.J_.vertexAttribPointer(this.A_P,this.A_J[t],this.J_.FLOAT,!1,e,i))}testVertexAttribPointerType(t){return this.A_I[t]>-1}getVertexAttribByTpye(t){return this.A_I[t]}vertexAttribPointerAt(t,e,i,s,r,a){this.A_Q=t,this.A_P=this.A_D[t],this.A_P>-1&&(this.J_.enableVertexAttribArray(this.A_P),this.J_.vertexAttribPointer(this.A_P,e,i,s,r,a))}vertexAttribPointerNext(t,e,i,s,r){this.A_P=this.A_D[this.A_Q],this.A_P>-1&&(this.J_.enableVertexAttribArray(this.A_P),this.J_.vertexAttribPointer(this.A_P,t,e,i,s,r)),this.A_Q++}vertexAttribPointerFirst(t,e,i,s,r){this.A_Q=1,this.A_P=this.A_D[0],this.A_P>-1&&(this.J_.enableVertexAttribArray(this.A_P),this.J_.vertexAttribPointer(this.A_P,t,e,i,s,r))}getUniformLocationAt(t){return this.A_S=t+1,this.A_G[t]}getUniformLocationNext(){return this.A_R=this.A_G[this.A_S++],this.A_R}getUniformLocationFirst(){return this.A_S=1,this.A_G[0]}getUniformLocationByNS(t){return this.A_M.get(t)}getUniformTypeNameByNS(t){return this.A_L.has(t)?this.A_L.get(t).typeName:""}getUniformTypeByNS(t){return this.A_L.has(t)?this.A_L.get(t).type:0}hasUniformByName(t){return this.A_L.has(t)}getUniformLengthByNS(t){return this.A_L.has(t)?this.A_L.get(t).arrLength:0}initShdProgram(){let t,e=this.AN.getVSCodeStr(),i=this.AN.getFSCodeStr();null==this.AN.preCompileInfo&&r.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(e.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),e=e.replace(t," highp ")),e.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),e=e.replace(t," highp "))),r.default.SHADERCODE_TRACE_ENABLED;let s=this.loadShader(this.J_.VERTEX_SHADER,e);null==this.AN.preCompileInfo&&r.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&(i.indexOf(" mediump ")>=0&&(t=new RegExp(" mediump ","g"),i=i.replace(t," highp ")),i.indexOf(" lowp ")>=0&&(t=new RegExp(" lowp ","g"),i=i.replace(t," highp "))),r.default.SHADERCODE_TRACE_ENABLED;let a=this.loadShader(this.J_.FRAGMENT_SHADER,i),n=this.J_.createProgram();return this.J_.attachShader(n,a),this.J_.attachShader(n,s),this.J_.linkProgram(n),this.J_.getProgramParameter(n,this.J_.LINK_STATUS)?(this.A_N=s,this.A_O=a,n):(r.default.SHADERCODE_TRACE_ENABLED,null)}loadShader(t,e){let i=this.J_.createShader(t);return this.J_.shaderSource(i,e),this.J_.compileShader(i),this.J_.getShaderParameter(i,this.J_.COMPILE_STATUS)?i:(r.default.SHADERCODE_TRACE_ENABLED,this.J_.deleteShader(i),null)}getUniqueShaderName(){return this.A_B}enabled(){return null!=this.A_A}upload(t,e){null==this.A_A&&(this.A=e,this.J_=t,this.A_A=this.initShdProgram(),this.A_A.uniqueName=this.A_B,null!=this.A_A&&this.createLocations())}getRCUid(){return this.A}uniformBlockBinding(t,e){this.J_.uniformBlockBinding(this.A_A,this.J_.getUniformBlockIndex(this.A_A,t),e)}toString(){return"[ShdProgram(uniqueName = "+this.A_B+")]"}getGPUProgram(){return this.A_A}destroy(){this.A_D=null,this.A_K=null,this.A_C>0&&(this.A_H.fill(null),this.A_C=0),null!=this.A_A&&(this.J_.deleteShader(this.A_N),this.J_.deleteShader(this.A_O),this.A_N=null,this.A_O=null,this.J_.deleteProgram(this.A_A),this.A_A=null),this.J_=null,this.AN=null}}e.default=n},2139:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("18c7"));class a{static GetMatTotal(){return a.H_E}static GetFS32Arr(){return a.H_C}static SetFS32Arr(t){a.H_C=t;let e=a.H_E,i=a.H_D;for(let s=0;s<e;++s)i[s].setF32Arr(t)}static GetFreeId(){return a.j_.length>0?a.j_.pop():-1}static Allocate(t){if(t<1024&&(t=1024),a.H_E<1){a.H_E=t,a.H_C=new Float32Array(16*t);let e=0,i=new r.default(a.H_C,16*e),s=i.getUid();for(a.H_F=s,a.H_G=s+t;e<s;++e)a.H_D.push(null),a.H_H.push(a.S_FLAG_FREE);for(a.H_D.push(i),a.H_H.push(a.S_FLAG_FREE),a.j_.push(i.getUid()),e=1;e<t;++e)i=new r.default(a.H_C,16*e),a.H_D.push(i),a.H_H.push(a.S_FLAG_FREE),a.j_.push(i.getUid())}}static GetMatrix(){let t=null,e=a.GetFreeId()-a.H_F;return e>=0?(t=a.H_D[e],t.identity(),a.H_H[e]=a.S_FLAG_BUSY):t=new r.default,t}static RetrieveMatrix(t){if(null!=t){let e=t.getUid();e>=a.H_F&&e<a.H_G&&a.H_H[e-a.H_F]==a.S_FLAG_BUSY&&(a.j_.push(e),a.H_H[e-a.H_F]=a.S_FLAG_FREE)}}}a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.H_D=[],a.H_H=[],a.j_=[],a.H_C=null,a.H_F=0,a.H_G=0,a.H_E=0,e.default=a},2560:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73")),a=s(i("7279"));class n{create(t,e){let i=null,s=t.getCamera();return e.hasUniformByName(r.default.CameraViewMatUNS)&&e.hasUniformByName(r.default.CameraProjectiveMatUNS)?(i=new a.default,i.uns="u_viewAndProjMat",i.uniformNameList=[r.default.CameraViewMatUNS,r.default.CameraProjectiveMatUNS],i.copyDataFromProbe(s.matUProbe)):e.hasUniformByName(r.default.CameraViewMatUNS)?(i=new a.default,i.uns="u_viewMat",i.uniformNameList=[r.default.CameraViewMatUNS],i.copyDataFromProbeAt(0,s.matUProbe)):e.hasUniformByName(r.default.CameraProjectiveMatUNS)&&(i=new a.default,i.uns="u_projMat",i.uniformNameList=[r.default.CameraProjectiveMatUNS],i.copyDataFromProbeAt(1,s.matUProbe)),i}getIDNS(){return"CameraUniformBuilder"}}e.default=n},2574:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("b07e"));class n{constructor(){this.A_T=null,this.A_U=null,this.A_V=null,this.A_W=null,this.A_X=null,this.A_Y=null,this.A_Z=new r.default,this.A_a=new r.default,this.A_b=new a.default,this.A_c=32,this.A_d=32,this.A_e=.6,this.A_f=0,this.A_g=0,this.A_h=new r.default,this.A_i=new r.default,this.A_j=20,this.A_k=25,this.A_l=30,this.A_m=10,this.A_n=1,this.A_o=40,this.A_p=20,this.A_q=1,this.A_r=null}setCoreAngle(t){this.A_k=t}setBgAngle(t,e,i){this.A_l=t,this.A_m=e,this.A_n=i>0?1:-1}setSgOffsetAngle(t,e,i){this.A_o=t,this.A_p=e,this.A_q=i>0?1:-1}setAngleDirec(t,e){this.A_n=t>0?1:-1,this.A_q=e>0?1:-1}toPositive(){this.A_b.toPositive()}toNegative(){this.A_b.toNegative()}setDuration(t){this.A_b.duration=t}getDuration(){return this.A_b.duration}setTG(t,e,i){this.A_U=t,this.A_j=e}setBG(t,e,i){this.A_V=t,this.A_W=e,this.A_d=i}setSG(t,e){this.A_X=t,this.A_Y=e}initialize(t,e,i){null==this.A_T&&null!=t&&(this.A_T=t,this.A_Z.copyFrom(e),this.A_T.setPosition(e),this.A_c=i,this.A_a.x=i,this.A_b.initialize(),this.A_T.update(),this.A_r=this.A_T.getToParentMatrix())}getBiasTime(){return this.A_b.getBiasTime()}getOriginTime(){return this.A_b.getOriginTime()}getNextOriginTime(t){return this.A_b.getNextOriginTime(t)}resetPose(){let t=this.A_e;this.A_e=0,this.A_b.factor=0,this.A_b.reset(),this.run(0),this.A_e=t,this.A_b.factor=0}run(t){this.A_b.calc(t);let e=this.A_b.factor,i=this.A_e,s=e*this.A_l*i,r=this.A_m*i;this.A_f=-s+r,this.A_g=s+r,null!=this.A_U&&(this.A_T.setRotationXYZ(0,e*this.A_j*i,0),this.A_T.update()),this.A_T.setRotationXYZ(0,e*this.A_k*i,0),this.A_T.update(),this.A_h.setXYZ(0,0,-this.A_c),this.A_r.transformVector3Self(this.A_h),this.A_V.setPosition(this.A_h),this.A_V.setRotationXYZ(0,0,this.A_f),this.A_V.update(),this.A_h.setXYZ(0,0,this.A_c),this.A_r.transformVector3Self(this.A_h),this.A_W.setPosition(this.A_h),this.A_W.setRotationXYZ(0,0,this.A_g),this.A_W.update(),this.runPart()}runPart(){let t=this.A_q*this.A_b.factor,e=this.A_q*this.A_e,i=t*this.A_o*e,s=this.A_p*e;this.A_f-=i+s,this.A_h.setXYZ(0,this.A_d,0),this.A_V.getToParentMatrix().transformVector3Self(this.A_h),this.A_X.setPosition(this.A_h),this.A_X.setRotationXYZ(0,0,this.A_f),this.A_X.update(),this.A_g-=-i+s,this.A_h.setXYZ(0,this.A_d,0),this.A_W.getToParentMatrix().transformVector3Self(this.A_h),this.A_Y.setPosition(this.A_h),this.A_Y.setRotationXYZ(0,0,this.A_g),this.A_Y.update()}}e.default=n},"25cf":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("8e17")),n=s(i("c217")),l=s(i("faa5")),h=s(i("b3bd")),o=s(i("0fc4")),m=i("5216");class _ extends l.default{constructor(){super(),this.billFS=new n.default,this.n_="",this.brightnessEnabled=!1}initialize(t){super.initialize(t),this.n_="BillboardLine3DShader",this.n_+=this.brightnessEnabled?"Brn":"Alp"}buildShader(){let t=this.A_s;if(this.brightnessEnabled){let t=this.fogEnabled;null!=this.pipeline&&(t=t||this.pipeline.hasPipeByType(m.MaterialPipeType.FOG_EXP2),t=t||this.pipeline.hasPipeByType(m.MaterialPipeType.FOG)),this.brightnessOverlayEnabeld=t}this.A_t.addDiffuseMap(),t.addVertLayout("vec2","a_vs"),t.addVertLayout("vec2","a_uvs"),t.addVarying("vec4","v_colorMult"),t.addVarying("vec4","v_colorOffset"),t.addVarying("vec4","v_fadeV"),t.addVarying("vec4","v_uv"),t.addVertUniform("vec4","u_billParam",6),t.addDefine("FADE_VAR","fv4"),t.addVertHeadCode("\n    const vec4  direcV = vec4(1.0,-1.0,-1.0,1.0);\n");let e="\n    vec4 color = VOX_Texture2D(VOX_DIFFUSE_MAP, v_uv.xy);\n    vec3 offsetColor = v_colorOffset.rgb;\n    float kf = v_uv.z;\n    //kf = min(kf / 0.3, 1.0) * (1.0 - max((kf - 0.7)/(1.0 - 0.7),0.0));\n    kf = min(kf / v_fadeV.x, 1.0) * (1.0 - max((kf - v_fadeV.y)/(1.0 - v_fadeV.y),0.0));\n    vec4 fv4 = vec4(v_colorMult.w * kf * v_fadeV.w);\n",i=this.billFS.getBrnAndAlphaCode(),s="\n    FragColor0 = color;\n";t.addFragMainCode(e+i+s),t.addVertMainCode("\n    int i = int(a_vs.x);\n    mat4 voMat4 = u_viewMat * u_objMat;\n    viewPosition = voMat4 * vec4(u_billParam[i].xyz,1.0);\n    vec4 pv1 = voMat4 * vec4(u_billParam[i+1].xyz,1.0);\n    pv1.xy = pv1.xy - viewPosition.xy;\n    pv1.xy = pv1.yx * (a_vs.y > 0.0 ? direcV.xy : direcV.zw);\n    viewPosition.xy += normalize(pv1.xy) * abs(u_billParam[3].w);\n    gl_Position = u_projMat * viewPosition;\n    \n    vec2 puv = a_uvs * u_billParam[0].xy;\n    float cosv = cos(u_billParam[2].w);\n    float sinv = sin(u_billParam[2].w);\n    puv = vec2(puv.x * cosv - puv.y * sinv, puv.x * sinv + puv.y * cosv);\n    v_uv.xy = puv + u_billParam[0].zw;\n    v_uv.zw = a_uvs;\n    v_colorMult = u_billParam[1];\n    v_colorOffset = u_billParam[2];\n    v_fadeV = vec4(u_billParam[4].w, u_billParam[5].w, 1.0,1.0);\n")}getUniqueShaderName(){return this.n_+"_"+this.billFS.getBrnAlphaStatus()}toString(){return"[BillboardLine3DShaderBuffer()]"}static GetInstance(){return null!=_.H2||(_.H2=new _),_.H2}}_.H2=new _;class u extends o.default{constructor(t=!0,e=!1){super(),this.A_u=!0,this.A_v=!1,this.A_w=new a.default,this.A_x=new a.default,this.A_y=new a.default,this.A_z=0,this.p_=new Float32Array([1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,10,100,0,0,.3,200,0,0,.7]),this.A_u=t,this.A_v=e}buildBuf(){let t=_.GetInstance();t.billFS.setBrightnessAndAlpha(this.A_u,this.A_v),t.brightnessEnabled=this.A_u}getCodeBuf(){return _.GetInstance()}createSelfUniformData(){let t=new h.default;return t.uniformNameList=["u_billParam"],t.dataList=[this.p_],t}setBeginAndEndPos(t,e){this.A_w.copyFrom(t),this.A_x.copyFrom(e),this.A_y.subVecsTo(e,t),this.A_y.addBy(e),this.p_[12]=t.x,this.p_[13]=t.y,this.p_[14]=t.z,this.p_[16]=e.x,this.p_[17]=e.y,this.p_[18]=e.z,this.p_[20]=this.A_y.x,this.p_[21]=this.A_y.y,this.p_[22]=this.A_y.z}setBeginPos(t){this.A_w.copyFrom(t),this.A_y.subVecsTo(this.A_x,t),this.A_y.addBy(this.A_x),this.p_[12]=t.x,this.p_[13]=t.y,this.p_[14]=t.z,this.p_[20]=this.A_y.x,this.p_[21]=this.A_y.y,this.p_[22]=this.A_y.z}setEndPos(t){this.A_x.copyFrom(t),this.A_y.subVecsTo(t,this.A_w),this.A_y.addBy(t),this.p_[16]=t.x,this.p_[17]=t.y,this.p_[18]=t.z,this.p_[20]=this.A_y.x,this.p_[21]=this.A_y.y,this.p_[22]=this.A_y.z}setLineWidth(t){this.p_[15]=.5*t}getLineWidth(){return this.p_[15]}setUVRotation(t){this.A_z=t,this.p_[11]=r.default.DegreeToRadian(t)}getUVRotation(){return this.A_z}setUVParam(t,e,i,s){this.p_[0]=t,this.p_[1]=e,this.p_[2]=i,this.p_[3]=s}setUVScale(t,e){this.p_[0]=t,this.p_[1]=e}setUVOffset(t,e){this.p_[2]=t,this.p_[3]=e}setRGB3f(t,e,i){this.p_[4]=t,this.p_[5]=e,this.p_[6]=i}setFadeRange(t,e){this.p_[19]=t,this.p_[23]=e}setFadeFactor(t){this.p_[7]=t}getFadeFactor(){return this.p_[7]}setRGBOffset3f(t,e,i){this.p_[8]=t,this.p_[9]=e,this.p_[10]=i}getUniformData(){return this.p_}destroy(){super.destroy(),this.p_=null}}e.default=u},"264c":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){this.A_0=null,this.A_1=null,this.A_2=null,this.A_3=null,this.A_4=[],this.A_5=0,this.A_6=null,this.A_7=0,this.A_8=null,this.sortEnabled=!0,this.A_6=t}setSorter(t){this.A_8=t}showInfo(){let t="",e=this.A_0;while(null!=e)t+=e.unit.value+",",e=e.next}clear(){if(null!=this.A_6){this.A_4.length>0&&(this.A_4=[]);let t=this.A_0,e=null;while(null!=t)e=t,t=t.next,e.prev=null,e.next=null;this.A_0=this.A_1=null,this.A_5=0,this.A_7=0,this.sortEnabled=!0,this.A_6=null}this.A_8=null}update(){this.sortEnabled&&this.sort()}run(t){this.A_6.resetUniform();let e=null,i=this.A_4;for(let s=0;s<this.A_7;++s)e=i[s],this.A_6.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t)}runLockMaterial(t){this.A_6.resetUniform();let e=null,i=this.A_4;for(let s=0;s<this.A_7;++s)e=i[s],this.A_6.bindToGpu(e.shdUid),e.vro.run(),e.runLockMaterial2(null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}sort(){if(this.A_5>0){let t=this.A_0;this.A_4.length<this.A_5&&(this.A_4=new Array(Math.round(1.1*this.A_5)+1));let e=0;while(null!=t)t.drawEnabled&&t.unit.drawEnabled&&(this.A_4[e]=t.unit,++e),t=t.next;this.A_7=e;let i=0;null!=this.A_8&&(i=this.A_8.sortRODisplay(this.A_4,e)),i<1&&this.snsort(0,e-1)}}sorting(t,e){let i=this.A_4;this.A_3=i[t];let s=this.A_3.value;while(t<e){while(t<e&&i[e].value>=s)--e;i[t]=i[e];while(t<e&&i[t].value<=s)++t;i[e]=i[t]}return i[t]=this.A_3,t}snsort(t,e){if(t<e){let i=this.sorting(t,e);this.snsort(t,i-1),this.snsort(i+1,e)}}getNodesTotal(){return this.A_5}getBegin(){return this.A_2=this.A_0,this.A_0}getNext(){return null!=this.A_2&&(this.A_2=this.A_2.next),this.A_2}isEmpty(){return this.A_5<1}addNode(t){null==t.prev&&null==t.next&&(null==this.A_0?this.A_1=this.A_0=t:null!=this.A_1.prev?(this.A_1.next=t,t.prev=this.A_1,this.A_1=t):(this.A_0.next=t,t.prev=this.A_1,this.A_1=t),this.A_1.next=null,this.A_5++)}removeNode(t){null==t.prev&&null==t.next&&t!=this.A_0||(t==this.A_0?t==this.A_1?this.A_0=this.A_1=null:(this.A_0=t.next,this.A_0.prev=null):t==this.A_1?(this.A_1=t.prev,this.A_1.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null,this.A_5--)}}e.default=s},"265e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.__$ruid=-1,this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.prev=null,this.next=null,this.unit=null,this.vro=null,this.tro=null,this.rvroI=-1,this.rtroI=-1}setValue(t){this.unit.value=t}isVsible(){return null==this.unit||this.unit.drawEnabled}updateData(){let t=this.unit;this.drawMode=t.drawMode,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,this.vtxUid=t.vtxUid,this.vro=t.vro,this.shdUid=t.shdUid,this.texMid=t.texMid,this.tro=t.tro}reset(){this.drawEnabled=!0,this.uid=-1,this.index=-1,this.drawMode=0,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.shdUid=-1,this.vtxUid=-1,this.texMid=-1,this.rtokey=-1,this.unit=null,this.vro=null,this.tro=null,this.prev=null,this.next=null}toString(){return"[Object RPONode(uid = "+this.uid+", index = "+this.index+", shdUid = "+this.shdUid+", vtxUid = "+this.vtxUid+")]"}}e.default=s},"278e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.A_9=null,this.A_=null,this.slideSpeed=2,this.AB=0,this.AC=0,this.BA=!1}initialize(t,e){null==this.A_9&&(this.A_9=t,this.A_=e)}attach(){this.AB=this.A_9.mouseX,this.AC=this.A_9.mouseY,this.BA=!0}detach(){this.BA=!1}run(){if(this.BA){let t=(this.AB-this.A_9.mouseX)*this.slideSpeed,e=(this.AC-this.A_9.mouseY)*this.slideSpeed;this.A_.slideViewOffsetXY(t,e),this.AB=this.A_9.mouseX,this.AC=this.A_9.mouseY}}}e.CameraDragSlide=s},"28a9":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("f3a2"),r=i("69ed");class a{constructor(){this.types=[r.ShaderCodeType.VertHead,r.ShaderCodeType.VertBody,r.ShaderCodeType.FragHead,r.ShaderCodeType.FragBody],this.urls=null,this.uuid=s.ShaderCodeUUID.Default,this.binary=!1,this.buildBinaryFile=!1}}e.ShaderCodeConfigure=a},"28d0":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("a7cf")),a=s(i("c7a5"));class n extends a.default{constructor(){super(),this.H3=[],this.BB=null,this.BC=null,this.v_=!1,this.materialPipeline=null,this.pipeTypes=null,this.depthOffset=0,this.uvGridCN=4,this.uvGridsTotal=16}initialize(t,e,i,s,a,n=!1){if(null==this.BB){this.v_=n,this.BB=s,this.BC=a,this.w_=t,this.x_=e;let l=new r.default;l.materialPipeline=this.materialPipeline,l.pipeTypes=this.pipeTypes,l.uvGridCN=this.uvGridCN,l.uvGridsTotal=this.uvGridsTotal,l.initialize(i,this.BB,this.BC,this.v_),l.setDepthOffset(this.depthOffset),this.H3.push(l)}}appendEffectSrc(t,e){let i=new r.default;i.materialPipeline=this.materialPipeline,i.pipeTypes=this.pipeTypes,i.uvGridCN=this.uvGridCN,i.uvGridsTotal=this.uvGridsTotal,i.initialize(t,this.BB,this.BC,e),i.setDepthOffset(this.depthOffset),this.H3.push(i)}appendEffect(t,e,i=-1){let s,a=new r.default;a.materialPipeline=this.materialPipeline,a.pipeTypes=this.pipeTypes,a.uvGridCN=this.uvGridCN,a.uvGridsTotal=this.uvGridsTotal,null==t&&(t=this.BB),null==e&&(e=this.BC),i<0?s=this.H3[Math.floor((this.H3.length-.5)*Math.random())]:(i=i<this.H3.length?i:this.H3.length-1,s=this.H3[i]),a.initializeFrom(s,t,e,this.v_),this.y_.push(a),this.w_.addEntity(a.smokeEntity,this.x_,!1),a.setVisible(!1),a.setDepthOffset(this.depthOffset)}createEffect(t){return this.createEffectWithTexture(t,this.BB,this.BC)}createEffectWithTexture(t,e,i){let s;if(this.y_.length<1){s=new r.default,s.materialPipeline=this.materialPipeline,s.pipeTypes=this.pipeTypes,s.uvGridCN=this.uvGridCN,s.uvGridsTotal=this.uvGridsTotal,null==e&&(e=this.BB),null==i&&(i=this.BC);let t=this.H3[Math.floor((this.H3.length-.5)*Math.random())];s.initializeFrom(t,e,i,this.v_),s.setDepthOffset(this.depthOffset),this.w_.addEntity(s.smokeEntity,this.x_,!1)}else s=this.y_.pop();return this.z_.push(s),s.setVisible(!0),s.setRotationXYZ(0,360*Math.random(),0),s.setTime(0),null!=t&&s.setPosition(t),s.update(),s}destory(){this.materialPipeline=null,this.pipeTypes=null}}e.default=n},"29ef":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("7c63"),r=i("e08e");class a{static Initialize(){if(a.H_I){a.H_I=!1;let t=a;t.Rstate=new s.RODrawState,s.RenderColorMask.Rstate=a.Rstate,s.RenderStateObject.Rstate=a.Rstate,t.COLOR_MASK_ALL_TRUE=s.RenderColorMask.Create("all_true",!0,!0,!0,!0),t.COLOR_MASK_ALL_FALSE=s.RenderColorMask.Create("all_false",!1,!1,!1,!1),t.COLOR_MASK_RED_TRUE=s.RenderColorMask.Create("red_true",!0,!1,!1,!1),t.COLOR_MASK_GREEN_TRUE=s.RenderColorMask.Create("green_true",!1,!0,!1,!1),t.COLOR_MASK_BLUE_TRUE=s.RenderColorMask.Create("blue_true",!1,!1,!0,!1),t.COLOR_MASK_ALPHA_TRUE=s.RenderColorMask.Create("alpha_true",!1,!1,!1,!0),t.COLOR_MASK_RED_FALSE=s.RenderColorMask.Create("red_false",!1,!0,!0,!0),t.COLOR_MASK_GREEN_FALSE=s.RenderColorMask.Create("green_false",!0,!1,!0,!0),t.COLOR_MASK_BLUE_FALSE=s.RenderColorMask.Create("blue_false",!0,!0,!1,!0),t.COLOR_MASK_ALPHA_FALSE=s.RenderColorMask.Create("alpha_false",!0,!0,!0,!1);let e=s.RenderStateObject,i=r.RenderBlendMode;i.NORMAL=e.CreateBlendMode("NORMAL",r.GLBlendMode.ONE,r.GLBlendMode.ZERO,r.GLBlendEquation.FUNC_ADD),i.OPAQUE=e.CreateBlendMode("OPAQUE",r.GLBlendMode.ONE,r.GLBlendMode.ZERO,r.GLBlendEquation.FUNC_ADD),i.TRANSPARENT=e.CreateBlendMode("TRANSPARENT",r.GLBlendMode.SRC_ALPHA,r.GLBlendMode.ONE_MINUS_SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),i.ALPHA_ADD=e.CreateBlendMode("ALPHA_ADD",r.GLBlendMode.ONE,r.GLBlendMode.ONE_MINUS_SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),i.ADD=e.CreateBlendMode("ADD",r.GLBlendMode.SRC_ALPHA,r.GLBlendMode.ONE,r.GLBlendEquation.FUNC_ADD),i.ADD_LINEAR=e.CreateBlendMode("ADD_LINEAR",r.GLBlendMode.ONE,r.GLBlendMode.ONE,r.GLBlendEquation.FUNC_ADD),i.INVERSE_ALPHA=e.CreateBlendMode("INVERSE_ALPHA",r.GLBlendMode.ONE,r.GLBlendMode.SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),i.BLAZE=e.CreateBlendMode("BLAZE",r.GLBlendMode.SRC_COLOR,r.GLBlendMode.ONE,r.GLBlendEquation.FUNC_ADD),i.OVERLAY=e.CreateBlendMode("OVERLAY",r.GLBlendMode.DST_COLOR,r.GLBlendMode.DST_ALPHA,r.GLBlendEquation.FUNC_ADD),i.OVERLAY2=e.CreateBlendMode("OVERLAY2",r.GLBlendMode.DST_COLOR,r.GLBlendMode.SRC_ALPHA,r.GLBlendEquation.FUNC_ADD),t.NORMAL_STATE=e.Create("normal",r.CullFaceMode.BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.BACK_CULLFACE_NORMAL_STATE=t.NORMAL_STATE,t.FRONT_CULLFACE_NORMAL_STATE=e.Create("front_normal",r.CullFaceMode.FRONT,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.NONE_CULLFACE_NORMAL_STATE=e.Create("none_normal",r.CullFaceMode.NONE,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.ALL_CULLFACE_NORMAL_STATE=e.Create("all_cull_normal",r.CullFaceMode.FRONT_AND_BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.OPAQUE),t.BACK_NORMAL_ALWAYS_STATE=e.Create("back_normal_always",r.CullFaceMode.BACK,r.RenderBlendMode.NORMAL,r.DepthTestMode.ALWAYS),t.BACK_TRANSPARENT_STATE=e.Create("back_transparent",r.CullFaceMode.BACK,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.TRANSPARENT_SORT),t.BACK_TRANSPARENT_ALWAYS_STATE=e.Create("back_transparent_always",r.CullFaceMode.BACK,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.ALWAYS),t.NONE_TRANSPARENT_STATE=e.Create("none_transparent",r.CullFaceMode.NONE,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.TRANSPARENT_SORT),t.NONE_TRANSPARENT_ALWAYS_STATE=e.Create("none_transparent_always",r.CullFaceMode.NONE,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.ALWAYS),t.FRONT_CULLFACE_GREATER_STATE=e.Create("front_greater",r.CullFaceMode.FRONT,r.RenderBlendMode.NORMAL,r.DepthTestMode.TRUE_GREATER),t.BACK_ADD_BLENDSORT_STATE=e.Create("back_add_blendSort",r.CullFaceMode.BACK,r.RenderBlendMode.ADD,r.DepthTestMode.TRANSPARENT_SORT),t.BACK_ADD_ALWAYS_STATE=e.Create("back_add_always",r.CullFaceMode.BACK,r.RenderBlendMode.ADD,r.DepthTestMode.ALWAYS),t.BACK_ALPHA_ADD_ALWAYS_STATE=e.Create("back_alpha_add_always",r.CullFaceMode.BACK,r.RenderBlendMode.ALPHA_ADD,r.DepthTestMode.ALWAYS),t.NONE_ADD_ALWAYS_STATE=e.Create("none_add_always",r.CullFaceMode.NONE,r.RenderBlendMode.ADD,r.DepthTestMode.ALWAYS),t.NONE_ADD_BLENDSORT_STATE=e.Create("none_add_blendSort",r.CullFaceMode.NONE,r.RenderBlendMode.ADD,r.DepthTestMode.TRANSPARENT_SORT),t.NONE_ALPHA_ADD_ALWAYS_STATE=e.Create("none_alpha_add_always",r.CullFaceMode.NONE,r.RenderBlendMode.ALPHA_ADD,r.DepthTestMode.ALWAYS),t.FRONT_ADD_ALWAYS_STATE=e.Create("front_add_always",r.CullFaceMode.FRONT,r.RenderBlendMode.ADD,r.DepthTestMode.ALWAYS),t.FRONT_TRANSPARENT_STATE=e.Create("front_transparent",r.CullFaceMode.FRONT,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.TRANSPARENT_SORT),t.FRONT_TRANSPARENT_ALWAYS_STATE=e.Create("front_transparent_always",r.CullFaceMode.FRONT,r.RenderBlendMode.TRANSPARENT,r.DepthTestMode.ALWAYS),t.NONE_CULLFACE_NORMAL_ALWAYS_STATE=e.Create("none_normal_always",r.CullFaceMode.NONE,r.RenderBlendMode.NORMAL,r.DepthTestMode.ALWAYS),t.BACK_ALPHA_ADD_BLENDSORT_STATE=e.Create("back_alpha_add_blendSort",r.CullFaceMode.BACK,r.RenderBlendMode.ALPHA_ADD,r.DepthTestMode.TRANSPARENT_SORT)}}static CreateBlendMode(t,e,i,r=0){return s.RenderStateObject.CreateBlendMode(t,e,i,r)}static CreateBlendModeSeparate(t,e,i,r=0,a=0,n=0){return s.RenderStateObject.CreateBlendModeSeparate(t,e,i,r,a,n)}static CreateRenderState(t,e,i,r){return s.RenderStateObject.Create(t,e,i,r)}static CreateRenderColorMask(t,e,i,r,a){return s.RenderColorMask.Create(t,e,i,r,a)}static GetRenderStateByName(t){return s.RenderStateObject.GetRenderStateByName(t)}static GetRenderColorMaskByName(t){return s.RenderColorMask.GetColorMaskByName(t)}static UnlockBlendMode(){s.RenderStateObject.UnlockBlendMode()}static LockBlendMode(t){s.RenderStateObject.LockBlendMode(t)}static UnlockDepthTestMode(){s.RenderStateObject.UnlockDepthTestMode()}static LockDepthTestMode(t){s.RenderStateObject.LockDepthTestMode(t)}static ResetState(){s.RenderColorMask.Reset(),s.RenderStateObject.Reset(),a.Rstate.reset()}static Reset(t){s.RenderColorMask.Reset(),s.RenderStateObject.Reset(),a.Rstate.setRenderContext(t),a.Rstate.reset()}static ResetInfo(){a.DrawCallTimes=0,a.DrawTrisNumber=0,a.POVNumber=0}static SetDepthTestEnable(t){a.Rstate.setDepthTestEnable(t)}static SetBlendEnable(t){a.Rstate.setBlendEnable(t)}static SetStencilFunc(t,e,i){a.Rstate.setStencilFunc(t,e,i)}static SetStencilMask(t){a.Rstate.setStencilMask(t)}static SetStencilOp(t,e,i){a.Rstate.setStencilOp(t,e,i)}}a.H_I=!0,a.Rstate=null,a.DrawCallTimes=0,a.DrawTrisNumber=0,a.POVNumber=0,a.COLOR_MASK_ALL_TRUE=0,a.COLOR_MASK_ALL_FALSE=1,a.COLOR_MASK_RED_TRUE=2,a.COLOR_MASK_GREEN_TRUE=3,a.COLOR_MASK_BLUE_TRUE=4,a.COLOR_MASK_ALPHA_TRUE=5,a.COLOR_MASK_RED_FALSE=6,a.COLOR_MASK_GREEN_FALSE=7,a.COLOR_MASK_BLUE_FALSE=8,a.COLOR_MASK_ALPHA_FALSE=9,a.NORMAL_STATE=0,a.BACK_CULLFACE_NORMAL_STATE=0,a.FRONT_CULLFACE_NORMAL_STATE=1,a.NONE_CULLFACE_NORMAL_STATE=2,a.ALL_CULLFACE_NORMAL_STATE=3,a.BACK_NORMAL_ALWAYS_STATE=4,a.BACK_TRANSPARENT_STATE=5,a.BACK_TRANSPARENT_ALWAYS_STATE=6,a.NONE_TRANSPARENT_STATE=7,a.NONE_TRANSPARENT_ALWAYS_STATE=8,a.FRONT_CULLFACE_GREATER_STATE=9,a.BACK_ADD_BLENDSORT_STATE=10,a.BACK_ADD_ALWAYS_STATE=11,a.BACK_ALPHA_ADD_ALWAYS_STATE=12,a.NONE_ADD_ALWAYS_STATE=13,a.NONE_ADD_BLENDSORT_STATE=14,a.NONE_ALPHA_ADD_ALWAYS_STATE=15,a.FRONT_ADD_ALWAYS_STATE=16,a.FRONT_TRANSPARENT_STATE=17,a.FRONT_TRANSPARENT_ALWAYS_STATE=18,a.NONE_CULLFACE_NORMAL_ALWAYS_STATE=19,a.BACK_ALPHA_ADD_BLENDSORT_STATE=20,e.default=a},"2a24":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("6e01")),n=s(i("ae33")),l=s(i("afca")),h=s(i("54de")),o=s(i("6773")),m=s(i("8ca9")),_=i("a52f");class u{constructor(t=null){this.At=null,this.BD=0,this.BE=new r.default,this.BF=new r.default,this.BG=new r.default,this.BH=new l.default,this.BI=null,this.BJ=new n.default,this.BK=new n.default,this.BL=null,this.BM=3,this.BN=0,this.BO=new o.default,this.degreeTween=new h.default,this.weap=null,this.campType=_.CampType.Blue,this.BP=null,this.BQ=0,this.A_w=new r.default,this.BI=null==t?new n.default:t}getContainer(){return this.BI}setVisible(t){this.BI.setVisible(t)}getVisible(){return this.BI.getVisible()}setAngleDirec(t,e){this.BH.setAngleDirec(t,e)}toPositive(){this.BH.toPositive()}toNegative(){this.BH.toNegative()}setRotationY(t){this.BI.setRotationY(t)}getRotationY(){return this.BI.getRotationY()}initialize(t,e,i=null,s=null){if(null==this.At&&null!=i){this.BM=3*.7,this.At=t,this.BL=i,t.addContainer(this.BI,e);let a=.5*i.getCoreWidth(),n=i.getEngityCore(),l=i.getEngityBGL(),h=i.getEngityBGR(),o=i.getEngitySGL(),_=i.getEngitySGR();this.BI.addEntity(n),this.BI.addChild(this.BJ),this.BI.addChild(this.BK),this.BJ.setZ(-a),this.BK.setZ(a),this.BJ.addEntity(l),this.BJ.addEntity(o),this.BK.addEntity(h),this.BK.addEntity(_);let u=new r.default;u.copyFrom(i.getCoreCenter()),null!=s&&u.addBy(s),this.BH.initialize(n,u,0),this.BH.setBG(l,h,i.getBGLong()),this.BH.setSG(o,_),this.degreeTween.bindTarget(this.BI),this.BO.setPeriod(12),this.BO.setTriggerTimeAt(0,6),this.BO.setTriggerTimeAt(1,3),this.weap=new m.default(t)}}setXYZ(t,e,i){this.BI.setXYZ(t,e,i)}setPosition(t){this.BI.setPosition(t)}getPosition(t){this.BI.getPosition(t)}getShootPosAt(t,e,i){switch(t){case 0:this.BH.getLEndPos(e,i);break;case 1:this.BH.getREndPos(e,i);break;default:break}}setRecoilDegreeAt(t,e){switch(t){case 0:this.BH.setRecoilDegreeL(e);break;case 1:this.BH.setRecoilDegreeR(e);break;default:break}}isAttackLock(){return this.degreeTween.testDegreeDis(2)}direcByDegree(t,e){this.degreeTween.runRotY(t),this.degreeTween.isDegreeChanged()&&this.BI.update()}direcByPos(t,e){this.degreeTween.runRotYByDstPos(t),this.degreeTween.isDegreeChanged()&&this.BI.update()}setDstDirecDegree(t){this.BQ=t}setAttackDst(t){this.BP=t,null!=t&&this.BP.getHitPos(this.BE)}setAttPos(t){this.BE.copyFrom(t)}setAttPosXYZ(t,e,i){this.BE.setXYZ(t,e,i)}getAttPos(){return this.BE}updateAttackPose(){this.direcByPos(this.BE,!1),this.BI.getInvMatrix().transformOutVector3(this.BE,this.BG),this.BG.y=0;let t=this.BG.dot(r.default.X_AXIS);if(t>50){this.BJ.getPosition(this.BF),this.BG.scaleVecTo(r.default.X_AXIS,t);let e=a.default.GetDegreeByXY(this.BF.x-this.BG.x,this.BG.z-this.BF.z)+180;this.BJ.setRotationY(e),this.BJ.update(),this.BK.setRotationY(-e),this.BK.update(),this.BJ.getInvMatrix().transformOutVector3(this.BE,this.BG);let i=this.BG.y;this.BG.y=0,t=this.BG.dot(r.default.X_AXIS),t>15&&(this.BG.scaleVecTo(r.default.X_AXIS,t),this.BG.y=i,this.BH.setAttLPos(this.BG)),this.BK.getInvMatrix().transformOutVector3(this.BE,this.BG),i=this.BG.y,this.BG.y=0,t=this.BG.dot(r.default.X_AXIS),t>15&&(this.BG.scaleVecTo(r.default.X_AXIS,t),this.BG.y=i,this.BH.setAttRPos(this.BG))}}resetPose(){this.BH.resetPose(),this.BD=this.BH.getOriginTime()}resetNextOriginPose(){this.BN=this.BH.getNextOriginTime(this.BD)}attack(){if(this.BO.run(),this.isAttackLock()){let t=this.BO.getTriggerIndex();t>-1&&(this.getShootPosAt(t,this.A_w,1),this.setRecoilDegreeAt(t,8),this.weap.createAtt(0,this.A_w,this.BE,this.BP,this.campType))}}run(t){let e=null!=this.BP;e?this.updateAttackPose():this.direcByDegree(this.BQ,!1),this.BI.update(),t||this.degreeTween.isRunning()?(this.BH.runAtt(this.BD,!0),this.BD+=this.BM):this.BH.runAtt(this.BD,!1),e&&this.attack()}update(){this.BI.update()}isResetFinish(){return this.BD>=this.BN}isPoseRunning(){return!0}runToReset(){this.BD>=this.BN&&(this.BD=this.BN),this.BI.update(),this.BH.run(this.BD),this.BD+=this.BM}}e.default=u},"2b5f":function(t,e,i){"use strict";i.r(e),i.d(e,"PBRShaderCode",(function(){return l}));var s="\r\n// ----------------------------------------------------------------------------\r\n\r\n    vec3 color = vec3(0.0);\r\n\r\n    vec4 param4 = u_pbrParams[0];\r\n    vec4 color4;\r\n    float metallic = param4.x;\r\n    float roughness = param4.y;\r\n    float ao = param4.z;\r\n    #ifdef VOX_USE_2D_MAP\r\n    vec2 texUV = v_uv.xy;\r\n    #else\r\n    vec2 texUV = vec2(0.0);\r\n    #endif\r\n    \r\n    float colorGlossiness = 1.0 - roughness;\r\n    float reflectionIntensity = u_pbrParams[1].y;\r\n    float glossinessSquare = colorGlossiness * colorGlossiness;\r\n    float specularPower = exp2(8.0 * glossinessSquare + 1.0);\r\n\r\n    worldPosition.xyz = v_worldPosition.xyz;\r\n    vec3 V = normalize(u_cameraPosition.xyz - worldPosition.xyz);\r\n\r\n    #ifdef VOX_VTX_FLAT_NORMAL\r\n        worldNormal = getVtxFlatNormal(worldPosition.xyz);\r\n    #else\r\n        worldNormal = v_worldNormal;\r\n    #endif\r\n    \r\n    vec3 N = worldNormal;\r\n    #ifdef VOX_PARALLAX_MAP\r\n        #ifdef VOX_NORMAL_MAP\r\n            mat3 btnMat3 = getBTNMat3(v_uv, worldPosition.xyz, worldNormal.xyz);\r\n            vec3 tbnViewDir = btnMat3 * V;\r\n            \r\n            //default value: vec4(1.0,10.0,2.0,0.1)\r\n            param4 = u_fragLocalParams[ VOX_PARALLAX_PARAMS_INDEX ];\r\n            texUV = parallaxOccRayMarchDepth(VOX_PARALLAX_MAP, v_uv, -tbnViewDir, param4);\r\n            #ifdef VOX_NORMAL_MAP\r\n                N = btnMat3 * normalize(getNormalFromMap(VOX_NORMAL_MAP, texUV));\r\n            #endif\r\n            N = normalize(mix(worldNormal, N, u_fragLocalParams[0].w));\r\n        #endif\r\n    #else\r\n        #ifdef VOX_NORMAL_MAP\r\n            //  N = normalize(getNormalFromMap(VOX_NORMAL_MAP, texUV, worldNormal.xyz));\r\n            N = getNormalFromMap(VOX_NORMAL_MAP, texUV, worldPosition.xyz, worldNormal);\r\n            N = normalize(mix(worldNormal, N, u_fragLocalParams[0].w));\r\n        #endif\r\n    #endif\r\n    \r\n    #ifdef VOX_AO_MAP\r\n        ao = mix(1.0, VOX_Texture2D(VOX_AO_MAP, texUV).y, ao);\r\n    #endif\r\n\r\n    // #ifdef VOX_NORMAL_MAP\r\n    //     N = getNormalFromMap(VOX_NORMAL_MAP, texUV, worldPosition.xyz, worldNormal);\r\n    //     N = normalize(mix(worldNormal, N, u_fragLocalParams[0].w));\r\n    // #endif\r\n\r\n    #ifdef VOX_PIXEL_NORMAL_NOISE\r\n        N = normalize(N + rand(N) * u_pbrParams[0].w);\r\n    #else\r\n        N = normalize(N);\r\n    #endif\r\n\r\n    float dotNV = clamp(dot(N, V), 0.0, 1.0);\r\n    #ifdef VOX_DIFFUSE_MAP\r\n    vec3 albedo = u_fragLocalParams[1].xyz * VOX_Texture2D(VOX_DIFFUSE_MAP, texUV).xyz;\r\n    #else\r\n    vec3 albedo = u_fragLocalParams[1].xyz;\r\n    #endif\r\n    \r\n    // calculate reflectance at normal incidence; if dia-electric (like plastic) use F0 \r\n    // of 0.04 and if it's a metal, use the albedo color as F0 (metallic workflow)    \r\n    vec3 F0 = u_fragLocalParams[0].xyz + vec3(0.04);\r\n    F0 = mix(F0, albedo.xyz, metallic);\r\n\r\n    vec3 diffuseColor = albedo.xyz;\r\n    albedo = gammaToLinear(albedo);\r\n\r\n    vec3 specularColor = vec3(mix(0.025 * reflectionIntensity, 0.078 * reflectionIntensity, colorGlossiness));\r\n    #ifdef VOX_METALLIC_CORRECTION\r\n        //if(metallic > 0.0){\r\n            vec3 specularColorMetal = mix(F0, albedo, metallic);\r\n            float ratio = clamp(metallic, 0.0, 1.0);\r\n            specularColor = mix(specularColor, specularColorMetal, ratio);\r\n        //}\r\n    #endif\r\n    albedo = mix(albedo, F0, metallic);\r\n    \r\n    specularColor *= u_pbrParams[3].xyz;\r\n\r\n    \r\n    #ifdef VOX_ENV_MAP\r\n        float mipLv = floor(100.0 * fract(u_pbrParams[3].w));\r\n        mipLv -= glossinessSquare * mipLv;\r\n        mipLv = max(mipLv + floor(u_pbrParams[3].w), 0.0);\r\n\t    vec3 envDir = -getWorldEnvDir(N, -V);\r\n\t    envDir.x = -envDir.x;\r\n        #ifdef VOX_HDR_BRN\r\n            vec3 specularEnvColor3 = vec3(rgbaToHdrBrn(VOX_TextureCubeLod(VOX_ENV_MAP, envDir, mipLv)));\r\n        #else\r\n            vec3 specularEnvColor3 = VOX_TextureCubeLod(VOX_ENV_MAP, envDir, mipLv).xyz;\r\n        #endif\r\n        \r\n        specularEnvColor3 = gammaToLinear(specularEnvColor3);\r\n        specularColor = fresnelSchlick3(specularColor, dotNV, 0.25 * reflectionIntensity) * specularEnvColor3;\r\n    #endif\r\n\r\n    float frontIntensity = u_pbrParams[1].z;\r\n    float sideIntensity = u_pbrParams[1].w;\r\n\r\n    // reflectance equation    \r\n    RadianceLight rL;\r\n\r\n    vec3 diffuse = albedo.xyz * RECIPROCAL_PI;\r\n    vec3 rm = vec3(1.0 - metallic); // remainder metallic\r\n\r\n    rL.scatterIntensity = u_pbrParams[2].www;\r\n    rL.F0 = F0;\r\n    rL.specularColor = specularColor;\r\n    rL.dotNV = dotNV;\r\n    rL.N = N;\r\n    rL.V = V;\r\n    rL.specularPower = specularPower;\r\n    rL.frontIntensity = frontIntensity;\r\n    rL.sideIntensity = sideIntensity;\r\n    // point light process\r\n    #if VOX_POINT_LIGHTS_TOTAL > 0\r\n        for(int i = 0; i < VOX_POINT_LIGHTS_TOTAL; ++i) \r\n        {\r\n            // calculate per-light radiance\r\n            param4 = u_lightPositions[i];\r\n            color4 = u_lightColors[i];\r\n            rL.L = (param4.xyz - worldPosition.xyz);\r\n            float factor = length(rL.L);\r\n            factor = 1.0 / (1.0 + param4.w * factor + color4.w * factor * factor);\r\n            rL.L = normalize(rL.L);\r\n            calcPBRLight(roughness, rm, color4.xyz * factor, rL);\r\n        }\r\n    #endif\r\n    // parallel light process\r\n    #if VOX_DIRECTION_LIGHTS_TOTAL > 0\r\n        for(int i = VOX_POINT_LIGHTS_TOTAL; i < VOX_LIGHTS_TOTAL; ++i) \r\n        {\r\n            // calculate per-light radiance\r\n            rL.L = normalize(-u_lightPositions[i].xyz);\r\n            calcPBRLight(roughness, rm, u_lightColors[i].xyz, rL);\r\n        }\r\n    #endif\r\n    // spot light process\r\n    #if VOX_SPOT_LIGHTS_TOTAL > 0\r\n        \r\n        for(int i = (VOX_POINT_LIGHTS_TOTAL + VOX_DIRECTION_LIGHTS_TOTAL); i < VOX_LIGHTS_TOTAL; ++i) \r\n        {\r\n            param4 = u_lightPositions[i];\r\n            color4 = u_lightColors[i];\r\n            rL.L = (param4.xyz - worldPosition.xyz);\r\n            float factor = length(rL.L);\r\n            float attenuation = 1.0 / (1.0 + param4.w * factor + color4.w * factor * factor);\r\n\r\n            rL.L = normalize(rL.L);\r\n\r\n            param4 = u_lightPositions[i + VOX_SPOT_LIGHTS_TOTAL];\r\n            param4.xyz = normalize( param4.xyz );\r\n            factor = max(1.0 - (clamp((1.0 - max(dot(-param4.xyz, rL.L), 0.0)), 0.0, param4.w) / param4.w), 0.0001);\r\n\r\n            calcPBRLight(roughness, rm, color4.xyz * attenuation * factor, rL);\r\n        }\r\n    #endif\r\n    \r\n    #ifdef VOX_INDIRECT_ENV_MAP\r\n        rL.L = vec3(0.0, -1.0, 0.0);\r\n        float ifactor = clamp(abs(worldPosition.y - -210.0) / 300.0, 0.0,1.0);\r\n        float lv = 1.0 + 6.0 * ifactor;\r\n        #ifdef VOX_ENV_MAP\r\n            color = VOX_TextureCubeLod(VOX_INDIRECT_ENV_MAP, envDir, lv).xyz;\r\n            rL.specularColor = fresnelSchlick3(specularColor, dotNV, 0.25 * reflectionIntensity) * color;\r\n            color = VOX_TextureCubeLod(VOX_INDIRECT_ENV_MAP, N, lv).xyz;\r\n        #else\r\n            color = VOX_TextureCubeLod(VOX_INDIRECT_ENV_MAP, N, lv).xyz;\r\n            rL.specularColor = fresnelSchlick3(specularColor, dotNV, 0.25 * reflectionIntensity) * color;\r\n        #endif\r\n        calcPBRLight(roughness, rm, 2.0 * color, rL);\r\n        ifactor = 1.0 - ifactor;\r\n        float ifactor2 = max(dot(N, rL.L), 0.0);\r\n        color *= ifactor2 * ifactor2 * (ifactor * ifactor) * ((1.0 - metallic) * roughness) * 0.5;\r\n    #endif\r\n\r\n    specularColor = (rL.specular + specularColor);\r\n\r\n    #ifdef VOX_ABSORB\r\n        specularColor *= vec3(reflectionIntensity);\r\n    #endif\r\n    \r\n    vec3 Lo = rL.diffuse * diffuse + specularColor;\r\n    #ifdef VOX_ENV_AMBIENT_LIGHT_LIGHT_MAP\r\n        param4 = u_envLightParams[4];\r\n        Lo += diffuse * VOX_Texture2D(VOX_ENV_AMBIENT_LIGHT_LIGHT_MAP, (param4.xy + worldPosition.xz) / param4.zw).xyz;\r\n    #endif\r\n    \r\n    // ambient lighting (note that the next IBL tutorial will replace\r\n    // this ambient lighting with environment lighting).\r\n    vec3 ambient = ((color + u_pbrParams[2].xyz) * albedo.xyz) * ao;\r\n    \r\n\t#ifdef VOX_WOOL\r\n\t\tsideIntensity = getColorFactorIntensity(dotNV, frontIntensity, sideIntensity);\r\n\t\tambient *= sideIntensity;\r\n\t\tLo *= sideIntensity * frontIntensity;\r\n\t#endif\r\n\r\n    color = ambient + Lo;\r\n\r\n    // HDR tonemapping\r\n    #ifdef VOX_TONE_MAPPING\r\n        color = tonemapReinhard( color, u_pbrParams[1].x );\r\n    #endif\r\n    \r\n\r\n    // gamma correct\r\n    color = linearToGamma(color);\r\n    \r\n    // mirror inverted reflection\r\n    #ifdef VOX_MIRROR_PROJ_MAP\r\n        float factorY = max(dot(N, V), 0.01) * 0.4 + 0.4;\r\n        ao *= 0.8;\r\n        #ifdef VOX_MIRROR_MAP_LOD\r\n        vec4 mirrorColor4 = ao * VOX_Texture2DLod(VOX_MIRROR_PROJ_MAP, (gl_FragCoord.xy/u_stageParam.zw) + (N  * vec3(0.02)).xy, u_mirrorParams[0].w);\r\n        #else\r\n        vec4 mirrorColor4 = ao * VOX_Texture2D(VOX_MIRROR_PROJ_MAP, (gl_FragCoord.xy/u_stageParam.zw) + (N  * vec3(0.02)).xy);\r\n        #endif\r\n        factorY = mix(1.0, factorY, glossinessSquare);\r\n        color.xyz = mix(mirrorColor4.xyz, color.xyz, factorY);\r\n    #endif\r\n    FragColor0 = vec4(color, 1.0);\r\n//[x: displacement, y: ao, z: specular, w: occ]",r="\r\nconst vec3 vec3One = vec3(1.0);\r\n// ----------------------------------------------------------------------------\r\n\r\n// handy value clamping to 0 - 1 range\r\n#define saturate(a) clamp( a, 0.0, 1.0 )\r\n\r\n//Convert color to linear space\r\n#define VOX_GAMMA 2.2\r\nconst vec3 vec3Gamma = vec3(VOX_GAMMA);\r\nconst vec3 vec3ReciprocalGamma = vec3(1.0 / VOX_GAMMA);\r\n\r\nvec3 gammaToLinear(vec3 color) {\r\n    #ifdef VOX_GAMMA_CORRECTION\r\n\t    return pow(color, vec3Gamma);\r\n    #else\r\n        return color;\r\n    #endif\r\n}\r\nvec3 linearToGamma(vec3 color) { \r\n    #ifdef VOX_GAMMA_CORRECTION\r\n\t    return pow(color, vec3ReciprocalGamma); \r\n    #else\r\n        return color;\r\n    #endif\r\n}\r\nvec4 gammaToLinear(vec4 color) {\r\n    #ifdef VOX_GAMMA_CORRECTION\r\n        return vec4(pow(color.rgb, vec3Gamma), color.a);\r\n    #else\r\n        return color;\r\n    #endif\r\n}\r\n\r\nvec4 linearToGamma(vec4 color) {\r\n    #ifdef VOX_GAMMA_CORRECTION\r\n        return vec4(pow(color.rgb, vec3ReciprocalGamma), color.a);\r\n    #else\r\n        return color;\r\n    #endif\r\n}\r\n\r\nvec3 approximationSRGBToLinear(vec3 srgbColor) {\r\n    return pow(srgbColor, vec3Gamma);\r\n}\r\nvec3 approximationLinearToSRCB(vec3 linearColor) {\r\n    return pow(linearColor, vec3(1.0/2.2));\r\n}\r\nvec3 accurateSRGBToLinear(vec3 srgbColor) {\r\n    vec3 linearRGBLo = srgbColor / 12.92;\r\n    vec3 linearRGBHi = pow((srgbColor + vec3(0.055)) / vec3(1.055), vec3(2.4));\r\n    //vec3 linearRGB = (srgbColor <= 0.04045) ? linearRGBLo : linearRGBHi;\r\n    vec3 linearRGB = all(lessThanEqual(srgbColor, vec3(0.04045))) ? linearRGBLo : linearRGBHi;\r\n\r\n    return linearRGB;\r\n}\r\nvec3 accurateLinearToSRGB(vec3 linearColor) {\r\n    vec3 srgbLo = linearColor * 12.92;\r\n    vec3 srgbHi = (pow(abs(linearColor), vec3(1.0 / 2.4)) * 1.055) - 0.055;\r\n    vec3 srgb = all(lessThanEqual(linearColor, vec3(0.0031308))) ? srgbLo : srgbHi;\r\n\r\n    return srgb;\r\n}\r\n\r\n// Trowbridge-Reitz(Generalized-Trowbridge-Reitz，GTR)\r\n\r\nfloat DistributionGTR1(float NdotH, float roughness) {\r\n    if (roughness >= 1.0) return 1.0/PI;\r\n    float a2 = roughness * roughness;\r\n    float t = 1.0 + (a2 - 1.0)*NdotH*NdotH;\r\n    return (a2 - 1.0) / (PI * log(a2) *t);\r\n}\r\nfloat distributionGTR2(float NdotH, float roughness) {\r\n    float a2 = roughness * roughness;\r\n    float t = 1.0 + (a2 - 1.0) * NdotH * NdotH;\r\n    return a2 / (PI * t * t);\r\n}\r\n\r\nfloat distributionGGX(vec3 N, vec3 H, float roughness) {\r\n    float a = roughness*roughness;\r\n    float a2 = a*a;\r\n    float NdotH = max(dot(N, H), 0.0);\r\n    float NdotH2 = NdotH*NdotH;\r\n\r\n    float nom   = a2;\r\n    float denom = (NdotH2 * (a2 - 1.0) + 1.0);\r\n    denom = PI * denom * denom;\r\n\r\n    return nom / max(denom, 0.0000001); // prevent divide by zero for roughness=0.0 and NdotH=1.0\r\n}\r\n\r\n\r\nfloat geometryImplicit(float NdotV, float dotNL) {\r\n    return dotNL * NdotV;\r\n}\r\n\r\n// ----------------------------------------------------------------------------\r\nfloat geometrySchlickGGX(float NdotV, float roughness)\r\n{\r\n    float r = (roughness + 1.0);\r\n    float k = (r*r) / 8.0;\r\n\r\n    float nom   = NdotV;\r\n    float denom = NdotV * (1.0 - k) + k;\r\n\r\n    return nom / denom;\r\n}\r\n// ----------------------------------------------------------------------------\r\nfloat geometrySmith(vec3 N, vec3 V, vec3 L, float roughness) {\r\n    float NdotV = max(dot(N, V), 0.0);\r\n    float dotNL = max(dot(N, L), 0.0); \r\n    float ggx2 = geometrySchlickGGX(NdotV, roughness);\r\n    float ggx1 = geometrySchlickGGX(dotNL, roughness);\r\n\r\n    return ggx1 * ggx2;\r\n}\r\n// ----------------------------------------------------------------------------\r\n// @param cosTheta is clamp(dot(H, V), 0.0, 1.0)\r\nvec3 fresnelSchlick(float cosTheta, vec3 F0) {\r\n    return F0 + (1.0 - F0) * pow(max(1.0 - cosTheta, 0.0), 5.0);\r\n}\r\nvec3 fresnelSchlick2(vec3 specularColor, vec3 L, vec3 H) {\r\n   return specularColor + (1.0 - specularColor) * pow(1.0 - saturate(dot(L, H)), 5.0);\r\n}\r\n//fresnelSchlick2(specularColor, L, H) * ((SpecularPower + 2) / 8 ) * pow(saturate(dot(N, H)), SpecularPower) * dotNL;\r\n\r\n#define  OneOnLN2_x6 8.656171// == 1/ln(2) * 6 (6 is SpecularPower of 5 + 1)\r\n// dot: dot(N,V) or dot(H,V)\r\nvec3 fresnelSchlick3(vec3 specularColor, float dot, float glossiness) {\r\n\treturn specularColor + (max(vec3(glossiness), specularColor) - specularColor) * exp2(-OneOnLN2_x6 * dot); \r\n}\r\nvec3 fresnelSchlickWithRoughness(vec3 specularColor, vec3 L, vec3 N, float gloss) {\r\n   return specularColor + (max(vec3(gloss), specularColor) - specularColor) * pow(1.0 - saturate(dot(L, N)), 5.0);\r\n}\r\n\r\n//float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\r\n//float dotNV = saturate( dot( normal, viewDir ) );\r\n//specular *= computeSpecularOcclusion( dotNV, ambientOcclusion, specularRoughness );\r\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\r\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\r\n\r\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\r\n\r\n}\r\n\r\nvec3 acesToneMapping(vec3 color, float adapted_lum) {\r\n\tconst float A = 2.51;\r\n\tconst float B = 0.03;\r\n\tconst float C = 2.43;\r\n\tconst float D = 0.59;\r\n\tconst float E = 0.14;\r\n\r\n\tcolor *= adapted_lum;\r\n\treturn (color * (A * color + B)) / (color * (C * color + D) + E);\r\n}\r\n\r\n//color = color / (color + vec3One);\r\nvec3 reinhard(vec3 v) {\r\n    return v / (vec3One + v);\r\n}\r\nvec3 reinhard_extended(vec3 v, float max_white) {\r\n    vec3 numerator = v * (1.0 + (v / vec3(max_white * max_white)));\r\n    return numerator / (1.0 + v);\r\n}\r\nfloat luminance(vec3 v) {\r\n    return dot(v, vec3(0.2126, 0.7152, 0.0722));\r\n}\r\n\r\nvec3 change_luminance(vec3 c_in, float l_out) {\r\n    float l_in = luminance(c_in);\r\n    return c_in * (l_out / l_in);\r\n}\r\nvec3 reinhard_extended_luminance(vec3 v, float max_white_l) {\r\n    float l_old = luminance(v);\r\n    float numerator = l_old * (1.0 + (l_old / (max_white_l * max_white_l)));\r\n    float l_new = numerator / (1.0 + l_old);\r\n    return change_luminance(v, l_new);\r\n}\r\nvec3 tonemapReinhard(vec3 color, float exposure) {\r\n  vec3 c = color * exposure;\r\n  return c / (1.0 + c);\r\n}\r\nvec3 reinhardToneMapping( vec3 color, float toneMappingExposure ) {\r\n\r\n\tcolor *= toneMappingExposure;\r\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\r\n\r\n}\r\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\r\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\r\nhighp float randUV( const in vec2 uv ) {\r\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\r\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\r\n\treturn fract(sin(sn) * c);\r\n}\r\n// based on https://www.shadertoy.com/view/MslGR8\r\nvec3 dithering( vec3 color ) {\r\n    //Calculate grid position\r\n    float grid_position = randUV( gl_FragCoord.xy );\r\n\r\n    //Shift the individual colors differently, thus making it even harder to see the dithering pattern\r\n    vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\r\n\r\n    //modify shift acording to grid position.\r\n    dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\r\n\r\n    //shift the color by dither_shift\r\n    return color + dither_shift_RGB;\r\n}\r\nvec3 rotateY(vec3 dir, float radian)\r\n{\r\n\tvec3 result;\r\n\tresult.x = cos(radian) * dir.x - sin(radian) * dir.z;\r\n\tresult.y = dir.y;\r\n\tresult.z = sin(radian) * dir.x + cos(radian) * dir.z;\r\n\treturn result;\r\n}\r\n\r\nvec3 getWorldEnvDir(float rotateAngle, vec3 worldNormal,vec3 worldInvE)\r\n{\r\n\tvec3 worldR = reflect(worldInvE, worldNormal);\r\n    worldR.zy *= vec2(-1.0);\r\n\treturn rotateY(worldR, rotateAngle);\r\n}\r\nvec3 getWorldEnvDir(vec3 worldNormal,vec3 worldInvE)\r\n{\r\n\tvec3 worldR = reflect(worldInvE, worldNormal);\r\n    worldR.zy *= vec2(-1.0);\r\n    return worldR;\r\n}\r\nfloat FD_Schlick(float VoH, float f0, float f90) \r\n{\r\n\treturn f0 + (f90 - f0) * pow(1.0 - VoH, 5.0);\r\n}\r\nvec3 FD_Schlick(const in vec3 specularColor, const in float dotLH) {\r\n\r\n\t// Original approximation by Christophe Schlick '94\r\n\t//float fresnel = pow( 1.0 - dotLH, 5.0 );\r\n\t// Optimized variant (presented by Epic at SIGGRAPH '13)\r\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\r\n\r\n\tfloat fresnel = exp2((-5.55473 * dotLH - 6.98316) * dotLH);\r\n\treturn (vec3One - specularColor) * fresnel + specularColor;\r\n}\r\nvec3 fixSeams(vec3 vec, float mipmapIndex, float cubeTexsize) {\r\n    float scale = 1.0 - exp2(mipmapIndex) / cubeTexsize;\r\n    float M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\r\n    if (abs(vec.x) != M) vec.x *= scale;\r\n    if (abs(vec.y) != M) vec.y *= scale;\r\n    if (abs(vec.z) != M) vec.z *= scale;\r\n    return vec;\r\n}\r\n\r\nvec3 fixSeams(vec3 vec, float cubeTexsize ) {\r\n    float scale = 1.0 - 1.0 / cubeTexsize;\r\n    float M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\r\n    if (abs(vec.x) != M) vec.x *= scale;\r\n    if (abs(vec.y) != M) vec.y *= scale;\r\n    if (abs(vec.z) != M) vec.z *= scale;\r\n    return vec;\r\n}\r\n#ifdef VOX_WOOL\r\n\tfloat FD_Burley(float linearRoughness, float NoV, float NoL, float LoH)\r\n\t{\r\n\t\tfloat f90 = 0.5 + 2.0 * linearRoughness * LoH * LoH;\r\n\t\tfloat lightScatter = FD_Schlick(NoL, 1.0, f90);\r\n\t\tfloat viewScatter = FD_Schlick(NoV, 1.0, f90);\r\n\t\treturn lightScatter * viewScatter;\r\n\t}\r\n\tfloat getColorFactorIntensity(float NoV, float frontScale, float sideScale)\r\n\t{\r\n\t\tfloat invNoV = 1.0 - NoV;\r\n\t\tfloat x2 = invNoV * invNoV;\r\n\t\tfloat x3 = x2 * invNoV;\r\n\t\tfloat x4 = x3 * invNoV;\r\n\t\tfloat x5 = x4 * invNoV;\r\n\t\tfloat k = clamp(-10.15 * x5 + 20.189 * x4 - 12.811 * x3 + 4.0585 * x2 - 0.2931 * invNoV, 0.0, 1.0);\r\n\t\tfloat sideFactorIntensity = mix(frontScale, sideScale, k);\r\n\t\treturn sideFactorIntensity;\r\n\t}\r\n#else\r\n\tfloat FD_Burley(float linearRoughness, float NoV, float NoL, float LoH, float frontScale, float sideScale)\r\n\t{\r\n\t\tfloat f90 = 0.5 + 2.0 * linearRoughness * LoH * LoH;\r\n\t\tfloat lightScatter = FD_Schlick(NoL, 1.0, f90);\r\n\t\tfloat viewScatter = FD_Schlick(NoV, frontScale, sideScale * f90);\r\n\t\treturn lightScatter * viewScatter;\r\n\t}\r\n#endif\r\n\r\nstruct RadianceLight {\r\n\tvec3 diffuse;\r\n\tvec3 specular;\r\n    vec3 scatterIntensity;\r\n    vec3 F0;\r\n    vec3 N;\r\n    vec3 V;\r\n    vec3 L;\r\n    vec3 specularColor;\r\n\r\n    float dotNV;\r\n    float frontIntensity;\r\n    float sideIntensity;\r\n    float specularPower;\r\n};\r\n#ifdef VOX_PARALLAX_MAP\r\nmat3 getBTNMat3(in vec2 texUV, in vec3 pos, in vec3 nv)\r\n{\r\n    vec3 Q1  = dFdx(pos);\r\n    vec3 Q2  = dFdy(pos);\r\n    vec2 st1 = dFdx(texUV);\r\n    vec2 st2 = dFdy(texUV);\r\n\r\n    vec3 N  = normalize(nv);\r\n    vec3 T  = normalize(Q1*st2.t - Q2*st1.t);    \r\n    vec3 B  = -normalize(cross(N, T));\r\n    return mat3(T, B, N);\r\n}\r\n//example: const vec4 occParam = vec4(1.0,10.0,2.0,0.1);\r\nvec2 parallaxOccRayMarchDepth(sampler2D texSampler, vec2 puvs, vec3 viewDir,vec4 occParam)\r\n{\r\n    float depthValue = 1.0 - VOX_Texture2D(texSampler, puvs).r;\r\n    float numLayers = mix(occParam.x, occParam.y, max(dot(vec3(0.0, 0.0, 1.0), viewDir),0.0));\r\n    float layerHeight = occParam.z / numLayers;\r\n    vec2 tuv = (viewDir.xy * occParam.w) / numLayers;  \r\n    float ph = 0.0;\r\n    #ifndef VOX_GLSL_ES2\r\n        while(ph < depthValue)\r\n        {\r\n            puvs -= tuv;\r\n            depthValue = 1.0 - VOX_Texture2D(texSampler, puvs).r;\r\n            ph += layerHeight;\r\n        }\r\n    #else\r\n        for(int i = 0; i < 10; i++) {\r\n            if(ph < depthValue)\r\n            {\r\n                puvs -= tuv;\r\n                depthValue = 1.0 - VOX_Texture2D(texSampler, puvs).r;\r\n                ph += layerHeight;\r\n            }\r\n            else {\r\n                break;\r\n            }\r\n        }\r\n    #endif\r\n    tuv += puvs;\r\n    depthValue -= ph;\r\n    ph = 1.0 - VOX_Texture2D(texSampler, tuv).r - ph + layerHeight;\r\n    float weight = depthValue / (depthValue - ph);\r\n    //return puvs * (1.0 - weight) + tuv * weight;\r\n    return mix(puvs, tuv, weight);\r\n}\r\n#endif\r\n#if VOX_LIGHTS_TOTAL > 0\r\nvoid calcPBRLight(float roughness, vec3 rm, in vec3 inColor, inout RadianceLight rL) {\r\n    // rm is remainder metallic: vec3(1.0 - metallic)\r\n\r\n    vec3 H = normalize(rL.V + rL.L);\r\n\r\n    // scale light by dotNL\r\n    float dotNL = max(dot(rL.N, rL.L), 0.0);\r\n    float dotLH = max(dot(rL.L, H), 0.0);\r\n    float dotNH = max(dot(rL.N, H), 0.0);\r\n\r\n    // Cook-Torrance BRDF\r\n    float NDF = distributionGGX(rL.N, H, roughness);\r\n    float G   = geometrySmith(rL.N, rL.V, rL.L, roughness);\r\n    //vec3 F    = fresnelSchlick(clamp(dot(H, rL.V), 0.0, 1.0), rL.F0);\r\n    //vec3 F    = fresnelSchlick3(rL.F0,clamp(dot(H, V), 0.0, 1.0), roughness);\r\n    vec3 F    = fresnelSchlick3(rL.F0, rL.dotNV, roughness);\r\n    \r\n    vec3 nominator    = NDF * G * F;\r\n    float denominator = 4.0 * rL.dotNV * dotNL;\r\n    vec3 specular = nominator / max(denominator, 0.001); // prevent divide by zero for NdotV=0.0 or dotNL=0.0\r\n    \r\n    vec3 kD = (vec3One - F ) * rm;\r\n\r\n    #ifdef VOX_WOOL\r\n        float fdBurley = FD_Burley(roughness, rL.dotNV, dotNL, dotLH);\r\n    #else\r\n        float fdBurley = FD_Burley(roughness, rL.dotNV, dotNL, dotLH, rL.frontIntensity, rL.sideIntensity);\r\n    #endif\r\n    #ifdef VOX_SCATTER\r\n        vec3 specularScatter = rL.scatterIntensity * fresnelSchlick3(rL.specularColor, dotLH, 1.0) * ((rL.specularPower + 2.0) * 0.125) * pow(dotNH, rL.specularPower);\r\n    #else\r\n        vec3 specularScatter = vec3One;\r\n    #endif\r\n    \r\n    // add to outgoing radiance Lo\r\n    inColor *= dotNL;\r\n\r\n    #ifdef VOX_SPECULAR_BLEED\r\n        kD *= specularScatter;\r\n    #endif\r\n    rL.diffuse += fdBurley * inColor * kD;\r\n    rL.specular += specular * inColor * specularScatter;\r\n\r\n}\r\n#endif\r\nconst vec2 noise2 = vec2(12.9898,78.233);\r\nconst vec3 noise3 = vec3(12.9898,78.233,158.5453);\r\nvec2 rand(vec2 seed) {\r\n\r\n    float noiseX = (fract(sin(dot(seed, noise2)) * 43758.5453));\r\n    float noiseY = (fract(sin(dot(seed, noise2 * 2.0)) * 43758.5453));\r\n    return vec2(noiseX,noiseY);\r\n}\r\nvec3 rand(vec3 seed) {\r\n    float scale = 1.0;\r\n    float scale2 = 43758.54;\r\n    float noiseX = (fract(sin(scale * dot(seed, noise3)) * scale2));\r\n    float noiseY = (fract(sin(scale * dot(seed, noise3 * 2.0)) * scale2));\r\n    float noiseZ = (fract(sin(scale * dot(seed, noise3 * 3.0)) * scale2));\r\n    return vec3(noiseX, noiseY, noiseZ);\r\n}\r\n#ifdef VOX_NORMAL_MAP\r\nvec3 getNormalFromMap(sampler2D texSampler, vec2 texUV, vec3 wpos, vec3 nv)\r\n{\r\n    vec3 tangentNormal = VOX_Texture2D(texSampler, texUV).xyz * 2.0 - 1.0;\r\n\r\n    vec3 Q1  = dFdx(wpos);\r\n    vec3 Q2  = dFdy(wpos);\r\n    vec2 st1 = dFdx(texUV);\r\n    vec2 st2 = dFdy(texUV);\r\n\r\n    vec3 N   = normalize(nv);\r\n    vec3 T  = normalize(Q1*st2.t - Q2*st1.t);    \r\n    vec3 B  = -normalize(cross(N, T));\r\n    mat3 TBN = mat3(T, B, N);\r\n\r\n    return TBN * tangentNormal;\r\n}\r\nvec3 getNormalFromMap(in sampler2D texSampler, in vec2 texUV)\r\n{\r\n    return VOX_Texture2D(texSampler, texUV).xyz * 2.0 - 1.0;\r\n}\r\n#endif\r\n\r\n#ifdef VOX_HDR_BRN\r\n\r\nconst vec4 hdrBrnDecodeVec4 = vec4(255.0, 2.55, 0.0255, 0.000255);\r\nfloat rgbaToHdrBrn(in vec4 color)\r\n{\r\n    return dot(hdrBrnDecodeVec4, color);\r\n}\r\n#endif\r\n\r\n#ifdef VOX_VTX_FLAT_NORMAL\r\n\r\nvec3 getVtxFlatNormal(const in vec3 pos)\r\n{\r\n    return normalize(cross(dFdx(pos), dFdy(pos)));\r\n}\r\n#endif",a="    initLocalVtx();\r\n    \r\n    worldPosition = u_objMat * localPosition;\r\n    viewPosition = u_viewMat * worldPosition;\r\n    gl_Position = u_projMat * viewPosition;\r\n\r\n    // temporary code plan\r\n    #ifdef VOX_DISPLACEMENT_MAP\r\n        v_worldPosition = (u_objMat * vec4(a_vs.xyz, 1.0)).xyz;\r\n    #else\r\n        v_worldPosition = worldPosition.xyz;\r\n    #endif\r\n    \r\n    #ifndef VOX_VTX_FLAT_NORMAL\r\n        v_worldNormal = normalize(a_nvs * inverse(mat3(u_objMat)));\r\n    \r\n        #ifdef VOX_NORMAL_NOISE\r\n    \r\n            v_worldNormal += (rand(a_nvs)) * 0.1;\r\n    \r\n        #endif\r\n    #endif\r\n",n="const vec4 zeroPosition = vec4(0.0,0.0,0.0, 1.0);\r\n\r\n#ifdef VOX_DISPLACEMENT_MAP\r\nvoid displaceLocalVtx(in vec2 param) {    \r\n    float dispFactor = VOX_Texture2D(VOX_DISPLACEMENT_MAP, v_uv.xy).x;\r\n    localPosition.xyz += normalize( a_nvs ) * vec3( dispFactor * param.x + param.y );\r\n}\r\n#endif\r\n\r\nconst vec2 noise2 = vec2(12.9898,78.233);\r\nconst vec3 noise3 = vec3(12.9898,78.233,158.5453);\r\nvec2 rand(vec2 seed) {\r\n\r\n  float noiseX = (fract(sin(dot(seed, noise2)) * 43758.5453));\r\n  float noiseY = (fract(sin(dot(seed, noise2 * 2.0)) * 43758.5453));\r\n  return vec2(noiseX,noiseY);\r\n}\r\nvec3 rand(vec3 seed) {\r\n  float noiseX = (fract(sin(dot(seed, noise3)) * 43758.5453));\r\n  float noiseY = (fract(sin(dot(seed, noise3 * 2.0)) * 43758.5453));\r\n  float noiseZ = (fract(sin(dot(seed, noise3 * 3.0)) * 43758.5453));\r\n  return vec3(noiseX, noiseY, noiseZ);\r\n}\r\n\r\nvoid initLocalVtx() {\r\n    localPosition = vec4(a_vs.xyz, 1.0);\r\n    int paramIndex = 0;\r\n    // vertex transform calculation\r\n    #ifdef VOX_VTX_CURVE_MOVE_PARAM_INDEX\r\n        vec4 params = u_vertLocalParams[VOX_VTX_CURVE_MOVE_PARAM_INDEX];\r\n        float index = abs(mod((a_vs.w + params[1]),params[2]));\r\n        index *= params[0];\r\n        vec2 puv = vec2(fract(index), floor(index) * params[0]);\r\n        localPosition.xyz += VOX_Texture2D(VTX_CURVE_MOVE_MAP, puv).xyz;\r\n    #endif\r\n    #ifdef VOX_USE_2D_MAP\r\n        #ifdef VOX_VTX_TRANSFORM_PARAM_INDEX\r\n            paramIndex = VOX_VTX_TRANSFORM_PARAM_INDEX;\r\n            v_uv = a_uvs.xy * u_vertLocalParams[paramIndex].xy + u_vertLocalParams[paramIndex].zw;\r\n        #else\r\n            v_uv = a_uvs.xy;\r\n        #endif\r\n    #endif\r\n\r\n    #ifdef VOX_DISPLACEMENT_MAP\r\n        displaceLocalVtx( u_vertLocalParams[VOX_DISPLACEMENT_PARAMS_INDEX].xy );\r\n    #endif\r\n}";const l={vert:"",vert_head:n,vert_body:a,frag:"",frag_head:r,frag_body:s,uuid:"pbr"}},"2be0":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.uuid="BinaryLoader"}async load(t,e,i=""){const s=new FileReader;s.onload=t=>{e.loaded(s.result,this.uuid)};const r=new XMLHttpRequest;r.open("GET",t,!0),""!=i&&r.setRequestHeader("Range",i),r.responseType="blob",r.onload=t=>{r.status<=206?s.readAsArrayBuffer(r.response):e.loadError(r.status,this.uuid)},r.onerror=t=>{e.loadError(r.status,this.uuid)},r.send()}}e.default=s},"2be1":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.A_5=0,this.A_4=[],this.BR=[],this.j_=[]}createNode(){return null}restoreUid(t){}getFreeId(){return this.j_.length>0?this.j_.pop():-1}getNodeByUid(t){return this.A_4[t]}create(){let t=null,e=this.getFreeId();return e>=0?(t=this.A_4[e],t.uid=e,this.BR[e]=s.S_BUSY):(t=this.createNode(),this.A_4.push(t),this.BR.push(s.S_BUSY),t.uid=this.A_5,this.A_5++),t}restore(t){return null!=t&&t.uid>=0&&this.BR[t.uid]==s.S_BUSY&&(this.restoreUid(t.uid),this.j_.push(t.uid),this.BR[t.uid]=s.S_FREE,t.reset(),!0)}restoreByUid(t){return t>=0&&t<this.A_5&&this.BR[t]==s.S_BUSY&&(this.restoreUid(t),this.j_.push(t),this.BR[t]=s.S_FREE,this.A_4[t].reset(),!0)}}s.S_BUSY=1,s.S_FREE=0,e.default=s},"2d2e":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("3930")),n=s(i("3bfb")),l=s(i("b9b5")),h=s(i("91e2"));class o{constructor(){this.BS=new r.default(0,105,0),this.BT=60,this.A_d=-60,this.BU=-50,this.BV=20,this.BW=10,this.BX=10,this.BY=15,this.BZ=null,this.Ba=null,this.Bb=null,this.Bc=null,this.Bd=null,this.Be=null,this.Bf=new a.default,this.Bf.normalizeRandom(1.1)}setParam(t,e,i){this.BT=t,this.A_d=e,this.BU=i}setCoreCenterXYZ(t,e,i){this.BS.setXYZ(t,e,i)}setCoreCenterY(t){this.BS.y=t}setBgSize(t,e){this.BV=t,this.BW=e}setSgSize(t,e){this.BX=t,this.BY=e}initilizeCopyFrom(t){null!=t&&(this.Bg=t.Bg,this.Bh=t.Bh,this.Bi=t.Bi,this.BZ=t.BZ,this.Bc=t.Bc,this.BT=t.BT,this.A_d=t.A_d,this.BU=t.BU,this.BS.copyFrom(t.BS))}initilize(t,e,i){if(null==this.BZ){let s,a;this.Bg=t,this.Bh=e,this.Bi=i,null==o.H_J&&(a=this.materialBuilder.createMaterial(this.Bh),s=this.BZ=new h.default,this.BZ.setMaterial(a),s.initialize(o.H_K,o.H_L,[this.Bh]),o.H_J=s),s=o.H_J;let l=new n.default;l.setBufSortFormat(s.getMaterial().getBufSortFormat()),l.initializeWithYFace(new r.default(-this.BW,this.getBGLong(),-this.BW),new r.default(this.BW,this.getBGLong(),this.BW),new r.default(-this.BV,0,-this.BV),new r.default(this.BV,0,this.BV));let m=new n.default;m.setBufSortFormat(s.getMaterial().getBufSortFormat()),m.initializeWithYFace(new r.default(-this.BY,this.getBGLong(),-this.BY),new r.default(this.BY,this.getBGLong(),this.BY),new r.default(-this.BX,0,-this.BX),new r.default(this.BX,0,this.BX)),this.BZ=new h.default,a=this.materialBuilder.createMaterial(this.Bh),this.BZ.setMaterial(a),this.BZ.setMesh(l),this.BZ.initialize(new r.default(-15,this.getBGLong(),-15),new r.default(15,0,15),[this.Bh]),this.updateBoxUV(this.BZ),this.Bc=new h.default,a=this.materialBuilder.createMaterial(this.Bh),this.Bc.setMaterial(a),this.Bc.setMesh(m),this.Bc.initialize(new r.default(-10,this.getSGLong(),-10),new r.default(10,0,10),[this.Bh]),this.updateBoxUV(this.Bc)}}getCoreWidth(){return this.BT}getBGLong(){return this.A_d}getSGLong(){return this.BU}getCoreCenter(){return this.BS}getEngityCore(){let t=new l.default;return t.initializeCorssSizeXYZ(20,this.getCoreWidth(),this.getCoreWidth()),t.setPosition(this.getCoreCenter()),t}getEngityBGL(){if(null==this.Ba){this.Ba=new h.default;let t=this.materialBuilder.createMaterial(this.Bh);this.Ba.setMaterial(t),this.Ba.copyMeshFrom(this.BZ),this.Ba.initialize(o.H_K,o.H_L,[this.Bh]),this.Ba.getMaterial().setRGB3f(this.Bf.r,this.Bf.g,this.Bf.b)}return this.Ba}getEngityBGR(){if(null==this.Bb){this.Bb=new h.default;let t=this.materialBuilder.createMaterial(this.Bh);this.Bb.setMaterial(t),this.Bb.copyMeshFrom(this.BZ),this.Bb.initialize(o.H_K,o.H_L,[this.Bh]),this.Bb.getMaterial().setRGB3f(this.Bf.r,this.Bf.g,this.Bf.b)}return this.Bb}getEngitySGL(){if(null==this.Bd){this.Bd=new h.default;let t=this.materialBuilder.createMaterial(this.Bh);this.Bd.setMaterial(t),this.Bd.copyMeshFrom(this.Bc),this.Bd.initialize(o.H_K,o.H_L,[this.Bh]),this.Bd.getMaterial().setRGB3f(this.Bf.r,this.Bf.g,this.Bf.b)}return this.Bd}getEngitySGR(){if(null==this.Be){this.Be=new h.default;let t=this.materialBuilder.createMaterial(this.Bh);this.Be.setMaterial(t),this.Be.copyMeshFrom(this.Bc),this.Be.initialize(o.H_K,o.H_L,[this.Bh]),this.Be.getMaterial().setRGB3f(this.Bf.r,this.Bf.g,this.Bf.b)}return this.Be}updateBoxUV(t){t.scaleUVFaceAt(0,.5,.5,.5,.5),t.scaleUVFaceAt(1,0,0,.5,.5),t.scaleUVFaceAt(2,.5,0,.5,.5),t.scaleUVFaceAt(3,0,.5,.5,.5),t.scaleUVFaceAt(4,.5,0,.5,.5),t.scaleUVFaceAt(5,0,.5,.5,.5),t.reinitializeMesh()}destroy(){this.materialBuilder=null}}o.H_J=null,o.H_K=new r.default(-10,-10,-10),o.H_L=new r.default(10,10,10),e.default=o},"2e8a":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8a0a")),a=s(i("644c"));class n{constructor(){this.type=-1,this.attriType=-1,this.typeSize=3,this.typeName="",this.name="",this.layoutEnabled=!0}parseCode(t){const e=";",i=" ";t=t.replace(/^\s*|\s*$/g,"");let s=t.indexOf(e);s>0&&(t=t.slice(0,s));let n=t.split(i);this.typeName=n[n.length-2],this.name=n[n.length-1],this.type=a.default.GetTypeByTypeNS(this.typeName),this.typeSize=parseInt(this.typeName.slice(this.typeName.length-1)),this.attriType=r.default.GetVBufAttributeTypeByNS(this.name)}}e.default=n},"2fe8":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("29ef")),a=s(i("402a")),n=s(i("0c54")),l=s(i("efce")),h=s(i("725b"));class o extends a.default{constructor(t=!0){super(),this.Bj=!0,this.Bk=null,this.Bl=null,this.Bm="",this.Bn=.5,this.Bo=.5,this.flipVerticalUV=!1,this.fontSystem=null,this.Bj=t}getWidth(){return null!=this.Bl?this.Bl.getWidth():0}getHeight(){return null!=this.Bl?this.Bl.getHeight():0}setAlignFactor(t,e){this.Bn=t,this.Bo=e,null!=this.Bl&&this.Bl.updateCharStr(this.Bm)}alignLeftTop(){this.setAlignFactor(0,0)}alignCenter(){this.setAlignFactor(.5,.5)}alignLeftCenter(){this.setAlignFactor(0,.5)}setText(t){null!=this.Bl&&(this.Bm=t,this.Bl.alignFactorX=this.Bn,this.Bl.alignFactorY=this.Bo,this.Bl.updateCharStr(t),this.update())}setRGBA4f(t,e,i,s){null!=this.Bk&&this.Bk.setRGBA4f(t,e,i,s)}setRGB3f(t,e,i){null!=this.Bk&&this.Bk.setRGB3f(t,e,i)}setAlpha(t){this.Bk.setAlpha(t)}getAlpha(){return this.Bk.getAlpha()}setBrightness(t){this.Bk.setBrightness(t)}getBrightness(){return this.Bk.getBrightness()}getRotationZ(){return this.Bk.getRotationZ()}setRotationZ(t){this.Bk.setRotationZ(t)}getScaleX(){return this.Bk.getScaleX()}getScaleY(){return this.Bk.getScaleY()}setScaleX(t){this.Bk.setScaleX(t)}setScaleY(t){this.Bk.setScaleY(t)}setScaleXY(t,e){this.Bk.setScaleXY(t,e)}createMaterial(t){null==this.getMaterial()?(this.Bk=new n.default,this.Bk.setTextureList(t),this.setMaterial(this.Bk)):this.Bk.setTextureList(t)}initialize(t,e=null){if(this.Bm=t,null==e){let t=null!=this.fontSystem?this.fontSystem.getTextureAt(0):h.default.GetInstance().getTextureAt(0);this.createMaterial([t])}else this.createMaterial(e);this.activeDisplay(),this.setRenderState(r.default.BACK_TRANSPARENT_STATE)}createBounds(){}__activeMesh(t){if(null==this.getMesh()){let e=new l.default;e.fontSystem=this.fontSystem,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.alignFactorX=this.Bn,e.alignFactorY=this.Bo,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.Bm),this.setMesh(e),this.Bl=e}}update(){null!=this.Bq&&(this.Bj&&this.Bp.isGeomDynamic()&&this.setIvsParam(0,this.Bp.vtCount),this.Bq.update())}destroy(){super.destroy(),this.fontSystem=null}}e.default=o},"2fe8c":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("a996")),a=s(i("c497")),n=s(i("125c")),l=s(i("3930"));class h{constructor(){this.A8=null,this.Br=null}initialize(t){null!=t&&(this.A8=t,this.A8.addEventListener(r.default.RESIZE,this,this.resize),this.initUIScene())}enable(){this.Br.enable()}disable(){this.Br.disable()}isEnabled(){return this.Br.isEnabled()}initUIScene(){let t=new a.default;t.cameraPerspectiveEnabled=!1,t.setCamProject(45,.1,3e3),t.setCamPosition(0,0,1500);let e=null;e=this.A8.createSubScene(),e.initialize(t),e.enableMouseEvent(!0),this.Br=e;let i=this.A8.getStage3D();this.Br.getCamera().translationXYZ(i.stageHalfWidth,i.stageHalfHeight,1500),this.Br.getCamera().update(),n.default.GetInstance().initialize(this.A8),n.default.GetInstance().initializeAtlas(1024,1024,new l.default(1,1,1,0),!0)}getRendererScene(){return this.Br}getRendererStatus(){return this.Br.getRendererStatus()}getUid(){return this.Br.getUid()}enableMouseEvent(t=!0){this.Br.enableMouseEvent(t)}getMouseXYWorldRay(t,e){this.Br.getMouseXYWorldRay(t,e)}renderBegin(t=!1){this.Br.renderBegin()}runBegin(t=!0,e=!1){this.Br.runBegin(t,e)}setRayTestEanbled(t){this.Br.setRayTestEanbled(t)}update(t=!0,e=!0){this.Br.update(t,e)}run(t=!1){this.Br.run(t)}runEnd(){this.Br.runEnd()}runAt(t){this.Br.runAt(t)}addEntity(t,e=0,i=!0){this.Br.addEntity(t,e,i)}removeEntity(t){this.Br.removeEntity(t)}addContainer(t,e=0){this.Br.addContainer(t,e)}removeContainer(t){this.Br.removeContainer(t)}drawEntity(t,e=!1,i=!0){this.Br.drawEntity(t,e,i)}isRayPickSelected(){return this.Br.isRayPickSelected()}addEventListener(t,e,i,s,r=!1){this.Br.addEventListener(t,e,i,s,r)}removeEventListener(t,e,i){this.Br.removeEventListener(t,e,i)}resize(t){if(null!=this.Br){let t=this.Br.getStage3D();this.Br.getCamera().translationXYZ(t.stageHalfWidth,t.stageHalfHeight,1500)}}setClearUint24Color(t,e=1){this.A8.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,i){this.A8.setClearRGBColor3f(t,e,i)}setClearRGBAColor4f(t,e,i,s){this.A8.setClearRGBAColor4f(t,e,i,s)}setClearColor(t){this.A8.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.A8.setRenderToBackBuffer()}updateCamera(){this.A8.updateCamera()}getCamera(){return this.A8.getCamera()}getStage3D(){return this.Br.getStage3D()}getRenderProxy(){return this.Br.getRenderProxy()}getRenderProcessAt(t){return this.Br.getRenderProcessAt(t)}}e.OrthoUIScene=h},3024:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3077"));class a extends r.default{constructor(t){super(),this.Bs=null,this.Bt=1,t<1&&(t=1),this.Bt=t,this.Bs=new Float32Array(4*t)}bindSlotAt(t){super.bindSlotAt(t),this.addVec4Data(this.Bs,this.Bt)}destroy(){super.destroy(),this.Bs=null}}e.default=a},3077:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("644c")),a=s(i("5326"));class n{constructor(){this.T=n.H0++,this.e=null,this.Bu=null,this.Bv=0,this.Bw=-1,this.rst=-1,this.uniformsTotal=0,this.uniformTypes=null,this.dataSizeList=null}getUid(){return this.T}getSlotBeginIndex(){return this.Bw}getSlotUid(){return this.e.getUid()}getFS32At(t){return this.Bu[t]}setFS32At(t,e){this.Bu[e]=t}setVec4DataAt(t,e,i,s,r){let a=this.Bu[t];a[0]=e,a[1]=i,a[2]=s,a[3]=r}setVec4Data(t,e,i,s){let r=this.Bu[0];r[0]=t,r[1]=e,r[2]=i,r[3]=s}setVec4DataAtWithArr4(t,e){this.Bu[t].set(e,0)}setVec4DataWithArr4(t){this.Bu[0].set(t,0)}addVec4Data(t,e){t.length,this.Bu.push(t),this.uniformTypes.push(r.default.SHADER_VEC4),this.dataSizeList.push(e),this.e.dataList[this.Bv]=t,this.Bv++,this.uniformsTotal++,this.e.index++}addMat4Data(t,e){this.Bu.push(t),this.uniformTypes.push(r.default.SHADER_MAT4),this.dataSizeList.push(e),this.e.dataList[this.Bv]=t,this.Bv++,this.uniformsTotal++,this.e.index++}isEnabled(){return this.rst>=0}bindSlotAt(t){let e=a.default.GetSlotAt(t);this.rst>=0&&this.reset(),null==this.Bu&&(this.Bu=[],this.uniformTypes=[],this.dataSizeList=[]),this.e=e,this.rst=1,this.Bw=e.index,this.Bv=e.index}update(){if(this.rst++,this.uniformsTotal<2)this.e.flagList[this.Bw]=this.rst;else for(let t=this.Bw;t<=this.Bv;++t)this.e.flagList[t]=this.rst}reset(){this.rst=-1,this.Bw=-1,this.uniformsTotal=0,this.Bv=0,null!=this.Bu&&(this.Bu=null,this.uniformTypes=null,this.dataSizeList=null),this.e=null}destroy(){this.reset()}}n.H0=0,e.default=n},3113:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("839a"),a=i("a9f4"),n=s(i("ab73"));class l{constructor(){this.Bx=null,this.By="",this.Bz=new Uint16Array(128),this.B0=10,this.B1=!1}__$setCodeBuilder(t){this.Bx=t}getUniqueNSKeyID(){if(this.B1){let t=31;for(let e=0;e<this.B0;++e)t=131*t+this.Bz[e];return t}return 0}getUniqueNSKeyString(){if(this.B1){this.By="["+this.Bz[0];for(let t=1;t<this.B0;++t)this.By+="-"+this.Bz[t];return this.By+="]",this.By}return""}reset(){if(this.B1){for(let t=0;t<this.B0;++t)this.Bz[t]=0;this.B1=!1}}useCameraPosition(t=!1,e=!0){t&&this.Bx.addVertUniformParam(n.default.CameraPosParam),e&&this.Bx.addFragUniformParam(n.default.CameraPosParam)}useViewPort(t=!1,e=!0){t&&this.Bx.addVertUniformParam(n.default.ViewportParam),e&&this.Bx.addFragUniformParam(n.default.ViewportParam)}useFrustum(t=!1,e=!0){t&&this.Bx.addVertUniformParam(n.default.FrustumParam),e&&this.Bx.addFragUniformParam(n.default.FrustumParam)}useStage(t,e){t&&this.Bx.addVertUniformParam(n.default.StageParam),e&&this.Bx.addFragUniformParam(n.default.StageParam)}addDiffuseMap(){this.Bx.addTextureSample2D("VOX_DIFFUSE_MAP",!0,!0,!1),this.Bz[0]=1,this.B1=!0}addNormalMap(){this.Bx.addTextureSample2D("VOX_NORMAL_MAP",!0,!0,!1),this.Bx.normalMapEnabled=!0,this.Bz[1]=1,this.B1=!0}addParallaxMap(t){this.Bx.addTextureSample2D("VOX_PARALLAX_MAP",!0,!0,!1),t>=0?(this.Bx.addDefine("VOX_PARALLAX_PARAMS_INDEX",""+t),this.Bz[2]=1+(t<<1)):this.Bz[2]=1,this.B1=!0}addDisplacementMap(t){this.Bx.addTextureSample2D("VOX_DISPLACEMENT_MAP",!0,!1,!0),t>=0?(this.Bx.addDefine("VOX_DISPLACEMENT_PARAMS_INDEX",""+t),this.Bz[3]=1+(t<<1)):this.Bz[3]=1,this.B1=!0}addAOMap(){this.Bx.addTextureSample2D("VOX_AO_MAP",!0,!0,!1),this.Bz[4]=1,this.B1=!0}addSpecularMap(t=r.SpecularMode.Default){this.Bx.addTextureSample2D("VOX_SPECULAR_MAP",!0,!0,!1),this.Bx.addDefine("VOX_SPECULAR_MODE",""+t),this.Bz[5]=1+(t<<1),this.B1=!0}addShadowMap(t=a.ShadowMode.VSM){this.Bx.addTextureSample2D("VOX_VSM_SHADOW_MAP",!1,!0,!1),this.Bz[6]=1+(t<<1),this.B1=!0}addFogColorMap(){this.Bx.addTextureSample2D("VOX_FOG_COLOR_MAP",!0,!0,!1),this.Bz[7]=1,this.B1=!0}addspecularEnvMap(t=!0){t?this.Bx.addTextureSampleCube("VOX_ENV_MAP",!0,!1):this.Bx.addTextureSample2D("VOX_ENV_MAP",!0,!0,!1),this.Bz[8]=1,this.B1=!0}addRoughnessMap(){this.Bx.addTextureSample2D("VOX_ROUGHNESS_MAP",!0,!0,!1),this.Bz[9]=1,this.B1=!0}add2DMap(t="",e=!0,i=!0,s=!1){this.Bx.addTextureSample2D(t,e,i,s)}addCubeMap(t="",e=!0,i=!1){this.Bx.addTextureSampleCube(t,e,i)}add3DMap(t="",e=!0,i=!1){this.Bx.addTextureSample3D(t,e,i)}}e.ShaderCodeUniform=l},"319d":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("f3a2"),a=s(i("faa5")),n=i("839a");class l extends a.default{constructor(){super(),this.n_="",this.colorEnabled=!0,this.specularMode=n.SpecularMode.Default,this.fragLocalParamsTotal=2,this.lightParamsIndex=2,this.normalEnabled=!0,this.buildFlag=!0,this.vertColorEnabled=!1,this.vertUniform=null}reset(){super.reset(),this.A_s.normalEnabled=!0,this.A_s.vertMatrixInverseEnabled=!0,this.AP=[],this.n_="LambertShd"}addDiffuseMap(t){null!=t&&(this.AP.push(t),this.buildFlag&&this.A_t.addDiffuseMap())}addNormalMap(t){null!=t&&this.lightEnabled&&(this.AP.push(t),this.buildFlag&&this.A_t.addNormalMap())}addParallaxMap(t,e=0){null!=t&&this.lightEnabled&&(this.AP.push(t),this.buildFlag&&this.A_t.addParallaxMap(e))}addDisplacementMap(t,e=0){null!=t&&(this.AP.push(t),this.buildFlag&&this.A_t.addDisplacementMap(e))}addAOMap(t){null!=t&&(this.AP.push(t),this.buildFlag&&this.A_t.addAOMap())}addSpecularMap(t){null!=t&&this.lightEnabled&&(this.AP.push(t),this.buildFlag&&this.A_t.addSpecularMap(this.specularMode))}initialize(t){t=null!=this.AP&&this.AP.length>0,super.initialize(t),this.colorEnabled&&(this.n_+="Col"),this.n_+=this.fragLocalParamsTotal}buildShader(){null!=this.vertUniform&&this.vertUniform.use(this.A_s),this.A_s.addFragUniform("vec4","u_fragLocalParams",this.fragLocalParamsTotal),this.lightEnabled&&this.A_s.addDefine("VOX_LIGHT_LOCAL_PARAMS_INDEX",""+this.lightParamsIndex),this.vertColorEnabled&&(this.A_s.addVertLayout("vec3","a_cvs"),this.A_s.addVarying("vec3","v_cv"))}getShaderCodeObjectUUID(){return r.ShaderCodeUUID.Lambert}getUniqueShaderName(){return null!=this.vertUniform?this.n_+this.keysString+this.vertUniform.getUniqueNSKeyString():this.n_+this.keysString}toString(){return"[LambertLightShaderBuffer()]"}}e.AdvancedShaderCodeBuffer=l},3221:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.B2=null,this.By=""}initialize(){}use(t){}getTextures(t,e=null){return null}reset(){}destroy(){}getUniqueNSKeyString(){return this.By}clone(){return null}getParams(){return this.B2}getParamsTotal(){return null!=this.B2?this.B2.length>>2:0}buildShaderUniformData(t){}}e.UniformComp=s},"32cc":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("b3bd")),a=s(i("faa5")),n=s(i("0fc4"));class l extends a.default{constructor(){super(),this.n_="",this.dynColorEnabled=!1}initialize(t){super.initialize(t),this.n_="Line3DShd",this.dynColorEnabled&&(this.n_+="_dynColor")}buildShader(){this.A_s.addVertLayout("vec3","a_vs"),this.dynColorEnabled?(this.A_s.addDefine("DYNAMIC_COLOR"),this.A_s.addFragUniform("vec4","u_color")):(this.A_s.addVertLayout("vec3","a_cvs"),this.A_s.addVarying("vec3","v_color")),this.A_s.addFragOutputHighp("vec4","FragColor0"),this.A_s.addFragMainCode("\n    #ifndef DYNAMIC_COLOR\n        FragColor0 = vec4(v_color, 1.0);\n    #else\n        FragColor0 = u_color;\n    #endif\n"),this.A_s.addVertMainCode("\n    viewPosition = u_viewMat * u_objMat * vec4(a_vs,1.0);\n    vec4 pv = u_projMat * viewPosition;\n    // pixels move offset, and no perspective error.\n    //  pv.xy = (pv.xy/pv.w - vec2(0.5)) * pv.w;\n    #ifndef DYNAMIC_COLOR\n        v_color = a_cvs;\n    #endif\n    gl_Position = pv;\n            ")}getUniqueShaderName(){return this.n_}toString(){return"[Line3DShaderBuffer()]"}static GetInstance(){return null!=l.H2||(l.H2=new l),l.H2}}l.H2=null;class h extends n.default{constructor(t=!1){if(super(),this.B3=!1,this.B4=null,this.B3=t,t&&(this.B4=new Float32Array([1,1,1,1]),this.B3)){let t=new r.default;t.uniformNameList=["u_color"],t.dataList=[this.B4],this.AJ=t}}getCodeBuf(){return l.GetInstance().dynColorEnabled=this.B3,l.GetInstance()}setRGB3f(t,e,i){null!=this.B4&&(this.B4[0]=t,this.B4[1]=e,this.B4[2]=i)}}e.default=h},"35fa":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17"));class a{static ClacTriNormal(t,e,i,s){r.default.Subtract(e,t,a.H_O),r.default.Subtract(i,e,a.H_N),r.default.Cross(a.H_O,a.H_N,s),s.normalize()}static ClacTriNormalByVS(t,e,i){let s=9*e;a.H_M.setTo(t[s],t[s+1],t[s+2]),i.setTo(t[s+3],t[s+4],t[s+5]),a.H_N.setTo(t[s+6],t[s+7],t[s+8]),i.subtractBy(a.H_M),a.H_N.subtractBy(a.H_M),i.crossBy(a.H_N),i.normalize()}static ClacTriNormalByIVS(t,e,i,s){let r=3*e,n=3*i[r];a.H_M.setTo(t[n],t[n+1],t[n+2]),n=3*i[r+1],s.setTo(t[n],t[n+1],t[n+2]),n=3*i[r+2],a.H_N.setTo(t[n],t[n+1],t[n+2]),s.subtractBy(a.H_M),a.H_N.subtractBy(a.H_M),s.crossBy(a.H_N),s.normalize()}static ClacTrisNormal(t,e,i,s,n){let l=new r.default,h=0,o=0,m=0;for(m=0;m<e;++m)n[m]=0;for(m=0;m<i;++m)a.ClacTriNormalByIVS(t,m,s,l),h=3*m,o=3*s[h],n[o]+=l.x,n[o+1]+=l.y,n[o+2]+=l.z,o=3*s[h+1],n[o]+=l.x,n[o+1]+=l.y,n[o+2]+=l.z,o=3*s[h+2],n[o]+=l.x,n[o+1]+=l.y,n[o+2]+=l.z;for(m=0;m<e;m+=3)a.H_M.setTo(n[m],n[m+1],n[m+2]),a.H_M.normalize(),n[m]=a.H_M.x,n[m+1]=a.H_M.y,n[m+2]=a.H_M.z}static ClacTriTangent(t,e,i,s,r,n,l){let h=3*s,o=3*r[h];a.H_M.setTo(i[o],i[o+1],i[o+2]),a.H_M.setTo(t[o],t[o+1],t[o+2]),o=3*r[h+1],a.H_O.setTo(t[o],t[o+1],t[o+2]),o=3*r[h+2],a.H_N.setTo(t[o],t[o+1],t[o+2]),o=2*r[h],a.H_P.setTo(e[o],e[o+1],0),o=2*r[h+1],a.H_Q.setTo(e[o],e[o+1],0),o=2*r[h+2],a.H_R.setTo(e[o],e[o+1],0),a.H_O.subtractBy(a.H_M),a.H_N.subtractBy(a.H_M),a.H_Q.subtractBy(a.H_P),a.H_R.subtractBy(a.H_P);let m=1/(a.H_Q.x*a.H_R.y-a.H_Q.y*a.H_R.x);n.copyFrom(a.H_O),n.scaleBy(a.H_R.y),a.H_M.copyFrom(a.H_N),a.H_M.scaleBy(a.H_Q.y),n.subtractBy(a.H_M),n.scaleBy(m),n.normalize(),l.copyFrom(a.H_N),l.scaleBy(a.H_Q.x),a.H_M.copyFrom(a.H_O),a.H_M.scaleBy(a.H_R.x),l.subtractBy(a.H_M),l.scaleBy(m),l.normalize()}static ClacTrisTangent(t,e,i,s,n,l,h,o){let m=new r.default,_=new r.default,u=0,d=0,c=0;for(c=0;c<e;++c)h[c]=0,o[c]=0;for(c=0;c<n;++c)a.ClacTriTangent(t,i,s,c,l,m,_),u=3*c,d=3*l[u],h[d]=m.x,h[d+1]=m.y,h[d+2]=m.z,o[d]=_.x,o[d+1]=_.y,o[d+2]=_.z,d=3*l[u+1],h[d]=m.x,h[d+1]=m.y,h[d+2]=m.z,o[d]=_.x,o[d+1]=_.y,o[d+2]=_.z,d=3*l[u+2],h[d]=m.x,h[d+1]=m.y,h[d+2]=m.z,o[d]=_.x,o[d+1]=_.y,o[d+2]=_.z;for(c=0;c<e;c+=3)a.H_P.setTo(h[c],h[c+1],h[c+2]),a.H_P.normalize(),a.H_O.setTo(o[c],o[c+1],o[c+2]),a.H_O.normalize(),a.H_N.setTo(s[c],s[c+1],s[c+2]),a.H_M.copyFrom(a.H_N),a.H_N.scaleBy(a.H_N.dot(a.H_P)),a.H_P.subtractBy(a.H_N),a.H_P.normalize(),a.H_N.setTo(s[c],s[c+1],s[c+2]),a.H_N.scaleBy(a.H_O.dot(a.H_N)),a.H_O.subtractBy(a.H_N),a.H_O.normalize(),a.H_M.crossBy(a.H_P),a.H_M.dot(a.H_O)<0&&a.H_P.scaleBy(-1),h[c]=a.H_P.x,h[c+1]=a.H_P.y,h[c+2]=a.H_P.z,a.H_O.setTo(s[c],s[c+1],s[c+2]),a.H_O.crossBy(a.H_P),a.H_O.normalize(),o[c]=a.H_O.x,o[c+1]=a.H_O.y,o[c+2]=a.H_O.z}}a.H_M=new r.default,a.H_O=new r.default,a.H_N=new r.default,a.H_P=new r.default,a.H_Q=new r.default,a.H_R=new r.default,a.H_S=new r.default,e.default=a},"36cb":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("e08e"),a=s(i("ab73")),n=i("b02c"),l=s(i("4f27")),h=s(i("b30a")),o=s(i("9156")),m=i("670e");class _{constructor(){this.B5=null,this.A_6=null,this.Av=null,this.Ax=null,this.B6=null,this.A7=null,this.B7=null,this.B8=null,this.B9=[],this.B_A=[],this.B_B=[],this.B_C=!1}initialize(t,e,i,s){null==this.A_6&&(this.A7=t,this.B7=t.Vertex,this.B8=t.Texture,this.A_6=new h.default(t.getRCUid(),t.getRC(),t.getRenderAdapter()),this.Av=e,this.Ax=i,this.B6=s,this.B5=new n.EmptyTexRenderObj(this.B8))}getRenderProxy(){return this.A7}getRenderShader(){return this.A_6}getTextureResource(){return this.B8}updateTextureData(t,e){this.B8.hasResUid(t.getResUid())&&(e?(this.B_B.push(t),this.B_C=!0):t.__$updateToGpu(this.B8))}updateDispTRO(t,e){t.__$ruid>-1&&(e?(this.B_A.push(t),this.B_C=!0):this.updateTextureTRO(t))}createTRO(t,e){if(null!=t){for(let e=0;e<t.length;++e)null!=t[e]&&t[e].__$setRenderProxy(this.A7);return n.TextureRenderObj.Create(this.B8,t,e)}return null}updateTextureTRO(t){if(null!=t.__$$runit){let e=t.getMaterial();if(null!=e){let i=this.B8,s=t.__$$runit,r=n.TextureRenderObj.GetByMid(i.getRCUid(),e.__$troMid);if(null!=s.tro&&(null==r||s.tro.getMid()!=r.getMid())){let t=this.A_6.findShdProgramByShdData(e.getShaderData());null!=t&&(t.getTexTotal()>0?(null==r&&(r=this.createTRO(e.getTextureList(),t.getTexTotal())),s.tro!=r&&(null!=s.tro&&s.tro.__$detachThis(),s.tro=r,r.__$attachThis(),s.texMid=s.tro.getMid(),this.Ax.rejoinRunitForTro(s),e.__$troMid=s.tro.getMid())):s.tro!=this.B5&&(null!=s.tro&&s.tro.__$detachThis(),s.tro=this.B5,s.texMid=s.tro.getMid(),this.Ax.rejoinRunitForTro(s),e.__$troMid=s.texMid))}}}}updateDispMaterial(t,e){let i=null;if(e.__$ruid>=0){let s=this.A7,r=e.getMaterial();if(null!=r){if(null==r.getShaderData()){let t=r.getTextureList(),e=null!=t&&null!=t&&t.length>0;r.initializeByCodeBuf(e)}i=this.A_6.create(r.getShaderData()),i.upload(s.RContext,s.getUid()),t.shdUid=i.getUid();let n=null;if(i.getTexTotal()>0?(n=this.createTRO(r.getTextureList(),i.getTexTotal()),t.tro!=n&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=n,n.__$attachThis(),t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.Ax.rejoinRunitForTro(t),r.__$troMid=t.tro.getMid())):t.tro!=this.B5&&(null!=t.tro&&t.tro.__$detachThis(),t.tro=this.B5,t.texMid=t.tro.getMid(),t.__$rprouid>=0&&this.Ax.rejoinRunitForTro(t),r.__$troMid=t.texMid),null==this.A_6.getSharedUniformByShd(i)){let t=this.createsharedMList(r,i);if(null!=t)for(let e=0;e<t.length;++e)t[e].program=i.getGPUProgram();this.A_6.setSharedUniformByShd(i,l.default.BuildShared(t,s,i))}let h=i.hasUniformByName(a.default.LocalTransformMatUNS);null==r.__$uniform&&(r.__$uniform=l.default.BuildLocalFromData(r.createSelfUniformData(),i)),h&&null!=e.getTransform()&&(t.transUniform=o.default.GetTransUniform(e.getTransform())),null==t.transUniform?(t.transUniform=l.default.BuildLocalFromTransformV(h?e.getMatrixFS32():null,i),o.default.SetTransUniform(e.getTransform(),t.transUniform)):t.transUniform=l.default.UpdateLocalFromTransformV(t.transUniform,h?e.getMatrixFS32():null,i),t.polygonOffset=r.getPolygonOffset(),t.uniform=r.__$uniform}}return i}updateVtxDataToGpuByUid(t,e){this.B7.updateDataToGpu(t,e)}updateDispVbuf(t,e){if(t.__$ruid>-1)if(e)this.B9.push(t),this.B_C=!0;else{let e=t.__$$runit;if(null!=e&&e.vtxUid!=t.vbuf.getUid()){let i=e.vtxUid,s=this.B7;s.hasResUid(i)&&s.__$detachRes(i),e.vro.__$detachThis(),this.buildVtxRes(t,e,this.A_6.findShdProgramByUid(e.shdUid)),e.__$rprouid>=0&&this.Ax.rejoinRunitForVro(e)}}}buildVtxRes(t,e,i){if(null!=t.vbuf){let s=this.B7;e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,e.visible=t.visible,e.setVisible(t.visible),e.drawMode=t.drawMode,e.renderState=t.renderState,e.rcolorMask=t.rcolorMask,e.trisNumber=t.trisNumber;let r,a=t.vbuf.getUid(),n=!0;s.hasResUid(a)?(r=s.getVertexRes(a),n=r.version!=t.vbuf.version,n&&(s.destroyRes(a),r.rcuid=s.getRCUid(),r.resUid=a)):(r=new m.GpuVtxObject,r.rcuid=s.getRCUid(),r.resUid=a,s.addVertexRes(r)),n&&(r.indices.ibufStep=t.vbuf.getIBufStep(),r.indices.initialize(this.B6,t.vbuf),r.vertex.initialize(this.B6,i,t.vbuf),r.version=t.vbuf.version),s.__$attachRes(a),e.vro=r.createVRO(this.B6,i,!0),e.indicesRes=e.vro.indicesRes,e.vro.__$attachThis(),e.vtxUid=t.vbuf.getUid(),e.ibufStep=e.vro.ibufStep,e.ibufType=4!=e.ibufStep?this.A7.UNSIGNED_SHORT:this.A7.UNSIGNED_INT}}buildGpuDisp(t){if(t.__$ruid<0&&null!=t.getMaterial()){t.__$$rsign=r.DisplayRenderSign.LIVE_IN_RENDERER;let e=this.Av.create();if(t.__$ruid=e.uid,t.__$$runit=e,null!=t.getPartGroup()){e.partGroup=t.getPartGroup().slice(0),e.partTotal=e.partGroup.length;let i=e.partGroup;for(let t=0,s=e.partTotal;t<s;)t++,i[t++]*=e.ibufStep}return e.setDrawFlag(t.renderState,t.rcolorMask),this.buildVtxRes(t,e,this.updateDispMaterial(e,t)),!0}return!1}update(){if(this.B_C){this.B_C=!1;let t=this.B9.length,e=0;if(t>0){for(;e<t;++e)this.updateDispVbuf(this.B9[e],!1);this.B9=[]}if(t=this.B_A.length,t>0){for(e=0;e<t;++e)this.updateTextureTRO(this.B_A[e]);this.B_A=[]}if(t=this.B_B.length,t>0){for(e=0;e<t;++e)this.B_B[e].__$updateToGpu(this.B8);this.B_B=[]}}}createsharedMList(t,e){let i=t.createSharedUniforms();if(null==i){let s=t.createSharedUniformsData();if(null!=s&&s.length>0){i=[];for(let t=0;t<s.length;++t)if(null!=s[t]){let r=l.default.BuildLocalFromData(s[t],e);i.push(r)}i.length<1&&(i=null)}}return i}updateGlobalMaterial(t,e=!1){if(null!=t){let i=this.A7,s=null,r=null,a=null,n=!1;null==t.getShaderData()?(a=t.getTextureList(),n=null!=a&&a.length>0,t.initializeByCodeBuf(n)):a=t.getTextureList(),r=this.A_6.create(t.getShaderData()),r.upload(i.RContext,i.getUid());let h=r.getTexTotal();if(h>0&&(s=this.createTRO(a,h)),null==this.A_6.getSharedUniformByShd(r)){let e=this.createsharedMList(t,r);if(null!=e)for(let t=0;t<e.length;++t)e[t].program=r.getGPUProgram();this.A_6.setSharedUniformByShd(r,l.default.BuildShared(e,i,r))}null==t.__$uniform&&(t.__$uniform=l.default.BuildLocalFromData(t.createSelfUniformData(),r)),this.A_6.__$globalUniform=t.__$uniform,this.A_6.bindToGpu(r.getUid()),e&&null!=t.__$uniform&&this.A_6.useUniform(t.__$uniform),null!=s&&s.run()}}reset(){this.B9=[],this.B_A=[]}}e.default=_},3806:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("a996")),a=s(i("1710")),n=s(i("7045")),l=s(i("9260")),h=s(i("3024")),o=s(i("badb"));class m{constructor(t,e){this.A=0,this.uProbe=null,this.pixelRatio=1,this.stageWidth=800,this.stageHeight=600,this.stageHalfWidth=400,this.stageHalfHeight=300,this.mouseX=0,this.mouseY=0,this.viewWidth=800,this.viewHeight=600,this.mouseViewX=0,this.mouseViewY=0,this.B=0,this.C=0,this.D=1,this.E=1,this.F=new o.default,this.G=[],this.H=[],this.I=[],this.J=[],this.B_D=new n.default,this.K=[],this.L=[],this.M=[],this.N=[],this.O=0,this.P=0,this.Q=new a.default,this.B_E=new r.default,this.R=!0,this.S=new r.default,this.A=t,null==m.H_T&&(m.H_T=e,e.onkeydown=function(t){l.default.KeyDown(t)},e.onkeyup=function(t){l.default.KeyUp(t)}),l.default.AddEventListener(n.default.KEY_DOWN,this,this.keyDown),l.default.AddEventListener(n.default.KEY_UP,this,this.keyUp)}getRCUid(){return this.A}getDevicePixelRatio(){return window.devicePixelRatio}getViewX(){return this.B}getViewY(){return this.C}getViewWidth(){return this.D}getViewHeight(){return this.E}setViewPort(t,e,i,s){this.R=!1,this.B=t,this.C=e,i==this.D&&s==this.E||(this.D=i,this.E=s,this.updateViewUData())}updateViewUData(){null==this.uProbe&&(this.uProbe=new h.default(1),this.uProbe.bindSlotAt(this.A)),this.uProbe.setVec4Data(2/this.stageWidth,2/this.stageHeight,this.stageWidth,this.stageHeight),this.uProbe.update(),this.O=this.D,this.P=this.E}update(){this.O==this.stageWidth&&this.P==this.stageHeight||(this.R&&(this.D=this.stageWidth,this.E=this.stageHeight,this.updateViewUData()),this.stageHalfWidth=.5*this.stageWidth,this.stageHalfHeight=.5*this.stageHeight,this.B_E.target=this,this.B_E.type=r.default.RESIZE,this.B_E.phase=1,this.sendResizeEvt(this.B_E))}keyDown(t){this.B_D.phase=1,this.B_D.type=n.default.KEY_DOWN,this.B_D.altKey=t.altKey,this.B_D.ctrlKey=t.ctrlKey,this.B_D.shiftKey=t.shiftKey,this.B_D.repeat=t.repeat,this.B_D.key=t.key,this.B_D.keyCode=t.keyCode,this.B_D.location=t.location;let e=this.K.length;for(var i=0;i<e;++i)this.K[i].call(this.L[i],this.B_D)}keyUp(t){this.B_D.phase=1,this.B_D.type=n.default.KEY_UP,this.B_D.altKey=t.altKey,this.B_D.ctrlKey=t.ctrlKey,this.B_D.shiftKey=t.shiftKey,this.B_D.repeat=t.repeat,this.B_D.key=t.key,this.B_D.keyCode=t.keyCode,this.B_D.location=t.location,this.B_D.target=this;let e=this.M.length;for(var i=0;i<e;++i)this.M[i].call(this.N[i],this.B_D)}sendResizeEvt(t){let e=this.G.length;for(var i=0;i<e;++i)this.G[i].call(this.H[i],t)}mouseDown(t=1){this.Q.type=a.default.MOUSE_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=t,this.F.dispatchEvt(this.Q)}mouseUp(t=1){this.Q.phase=1,this.Q.type=a.default.MOUSE_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=t,this.F.dispatchEvt(this.Q)}mouseClick(){this.Q.type=a.default.MOUSE_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseDoubleClick(){this.Q.type=a.default.MOUSE_DOUBLE_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightDown(t=1){this.Q.type=a.default.MOUSE_RIGHT_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightUp(t=1){this.Q.type=a.default.MOUSE_RIGHT_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgDown(){this.Q.type=a.default.MOUSE_BG_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgUp(){this.Q.type=a.default.MOUSE_BG_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseBgClick(){this.Q.type=a.default.MOUSE_BG_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseRightClick(){this.Q.type=a.default.MOUSE_RIGHT_CLICK,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseMove(){this.Q.type=a.default.MOUSE_MOVE,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseWheel(t){this.Q.type=a.default.MOUSE_WHEEL,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.wheelDeltaY=t.wheelDeltaY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseCancel(){this.Q.type=a.default.MOUSE_CANCEL,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.F.dispatchEvt(this.Q)}mouseMultiDown(t){this.Q.type=a.default.MOUSE_MULTI_DOWN,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseMultiUp(t){this.Q.type=a.default.MOUSE_MULTI_UP,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseMultiMove(t){this.Q.type=a.default.MOUSE_MULTI_MOVE,this.Q.mouseX=this.mouseX,this.Q.mouseY=this.mouseY,this.Q.target=this,this.Q.phase=1,this.Q.posArray=t,this.F.dispatchEvt(this.Q)}mouseWindowUp(t=1){}mouseWindowRightUp(t=1){}enterFrame(){this.S.type=r.default.ENTER_FRAME;let t=this.I.length;for(var e=0;e<t;++e)this.I[e].call(this.J[e],this.S)}addEventListener(t,e,i,s=!0,a=!0){if(null!=i&&null!=e){let l=0;switch(t){case r.default.RESIZE:for(l=this.G.length-1;l>=0;--l)if(e===this.H[l])break;l<0&&(this.H.push(e),this.G.push(i));break;case r.default.ENTER_FRAME:for(l=this.I.length-1;l>=0;--l)if(e===this.J[l])break;l<0&&(this.J.push(e),this.I.push(i));break;case n.default.KEY_DOWN:for(l=this.K.length-1;l>=0;--l)if(e===this.L[l])break;l<0&&(this.L.push(e),this.K.push(i));break;case n.default.KEY_UP:for(l=this.M.length-1;l>=0;--l)if(e===this.N[l])break;l<0&&(this.N.push(e),this.M.push(i));break;default:this.F.addEventListener(t,e,i,s,a);break}}}removeEventListener(t,e,i){if(null!=i&&null!=e){let s=0;switch(t){case r.default.RESIZE:for(s=this.G.length-1;s>=0;--s)if(e===this.H[s]){this.H.splice(s,1),this.G.splice(s,1);break}break;case r.default.ENTER_FRAME:for(s=this.I.length-1;s>=0;--s)if(e===this.J[s]){this.J.splice(s,1),this.I.splice(s,1);break}break;case n.default.KEY_DOWN:for(s=this.K.length-1;s>=0;--s)if(e===this.L[s]){this.L.splice(s,1),this.K.splice(s,1);break}break;case n.default.KEY_UP:for(s=this.M.length-1;s>=0;--s)if(e===this.N[s]){this.N.splice(s,1),this.M.splice(s,1);break}break;default:this.F.removeEventListener(t,e,i);break}}}}m.H_T=null,e.default=m},"38de":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("8e17")),n=s(i("f48d"));class l extends n.default{constructor(){super(...arguments),this.tv=new a.default(1,0,0)}update(){this.tv.normalize()}updateFast(){this.tv.normalize()}static IntersectionTri(t,e,i,s,r,a){return 0}static IntersectionLS(t,e,i,s,r,h=1){let o=l.__tAv;if(o.copyFrom(s),o.subtractBy(i),o.normalize(),a.default.Cross(e,o,r),r.normalize(),o.w=r.dot(t)-r.dot(s),Math.abs(o.w)<=h){r.crossBy(e),r.normalize(),r.w=r.dot(t),o.w=(r.w-r.dot(i))/o.dot(r),r.copyFrom(o),r.scaleBy(o.w),r.addBy(i),o.copyFrom(r),o.subtractBy(i);let a=n.default.__tV1;if(a.copyFrom(r),a.subtractBy(s),o.dot(a)<=0)return 1}return 0}static IntersectioNearSphere2(t,e,i,s,a){let n=l.__tAv;if(n.x=i.x-t.x,n.y=i.y-t.y,n.z=i.z-t.z,n.w=n.dot(e),s*=s,n.w>r.default.MATH_MIN_POSITIVE){if(a.copyFrom(e),a.scaleBy(n.w),a.subtractBy(n),n.x=a.getLengthSquared(),n.x<=s)return n.w-=Math.sqrt(s-n.x),a.copyFrom(e),a.scaleBy(n.w),a.addBy(t),a.w=1,1}else if(n.getLengthSquared()<=s&&(a.copyFrom(e),a.scaleBy(n.w),a.subtractBy(n),n.x=a.getLengthSquared(),n.x<=s))return n.w+=Math.sqrt(s-n.x),a.copyFrom(e),a.scaleBy(n.w),a.addBy(t),a.w=1,1;return 0}static IntersectioNearSphere(t,e,i,s,a){let n=l.__tAv;if(n.x=i.x-t.x,n.y=i.y-t.y,n.z=i.z-t.z,n.w=n.dot(e),n.w>r.default.MATH_MIN_POSITIVE){if(a.x=n.x-n.w*e.x,a.y=n.y-n.w*e.y,a.z=n.z-n.w*e.z,a.x=a.getLengthSquared(),a.w=s*s,a.x<=a.w)return a.x=n.getLengthSquared(),a.z=a.w-a.x,n.normalize(),a.y=n.dot(e)*Math.sqrt(a.x),n.w=.5*(-a.y+Math.sqrt(a.y*a.y+4*a.z)),a.copyFrom(e),a.scaleBy(n.w),a.addBy(t),a.w=1,1}else if(a.x=n.getLengthSquared(),a.w=s*s,a.x<=a.w)return a.z=a.w-a.x,n.normalize(),a.y=n.dot(e)*Math.sqrt(a.x),n.w=.5*(-a.y+Math.sqrt(a.y*a.y+4*a.z)),a.copyFrom(e),a.scaleBy(n.w),a.addBy(t),a.w=1,1;return 0}static IntersectSphere(t,e,i,s){let a=l.__tAv;return a.x=i.x-t.x,a.y=i.y-t.y,a.z=i.z-t.z,a.w=a.dot(e),a.w<r.default.MATH_MIN_POSITIVE||(a.x-=a.w*e.x,a.y-=a.w*e.y,a.z-=a.w*e.z),a.getLengthSquared()<=s*s}}l.__tAv=new a.default,e.default=l},3930:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01"));class a{constructor(t=1,e=1,i=1,s=1){this.r=1,this.g=1,this.b=1,this.a=1,this.r=t,this.g=e,this.b=i,this.a=s}setRGB3Bytes(t,e,i){this.r=t/255,this.g=e/255,this.b=i/255}setRGB3f(t,e,i){this.r=t,this.g=e,this.b=i}setRGBUint24(t){this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255}setRGBA4f(t,e,i,s){this.r=t,this.g=e,this.b=i,this.a=s}copyFrom(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a}copyFromRGB(t){this.r=t.r,this.g=t.g,this.b=t.b}scaleBy(t){this.r*=t,this.g*=t,this.b*=t}inverseRGB(){this.r=1-this.r,this.g=1-this.g,this.b=1-this.b}randomRGB(t=1){this.r=Math.random()*t,this.g=Math.random()*t,this.b=Math.random()*t}normalizeRandom(t=1){this.r=Math.random(),this.g=Math.random(),this.b=Math.random();let e=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);e>r.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/e,this.g=t*this.g/e,this.b=t*this.b/e)}normalize(t){void 0==t&&(t=1);let e=Math.sqrt(this.r*this.r+this.g*this.g+this.b*this.b);e>r.default.MATH_MIN_POSITIVE&&(this.r=t*this.r/e,this.g=t*this.g/e,this.b=t*this.b/e)}getCSSDecRGBAColor(){let t=Math.floor(255*this.r),e=Math.floor(255*this.g),i=Math.floor(255*this.b),s=this.a;return"rgba("+t+","+e+","+i+","+s+")"}getCSSHeXRGBColor(){let t="#",e=Math.floor(255*this.r);return t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.g),t+=e<15?"0"+e.toString(16):""+e.toString(16),e=Math.floor(255*this.b),t+=e<15?"0"+e.toString(16):""+e.toString(16),t}toString(){return"[Color4(r="+this.r+", g="+this.g+",b="+this.b+",a="+this.a+")]"}}e.default=a},"3aab":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("f367")),n=s(i("cd57")),l=s(i("577c")),h=s(i("9951"));class o{constructor(t){this.B_F=null,this.r=null,this.B_G=1.1,this.B_H=0,this.A_w=new r.default,this.A_x=new r.default,this.B_I=null,this.effectRenderProcessIndex=2,this.r=t}initialize(t){if(null==this.B_F){let e=new a.default;h.default.UseFog(e),e.toBrightnessBlend(),e.initialize([h.default.GetBulTex(t)]),e.setLineWidth(20),this.r.addEntity(e,this.effectRenderProcessIndex),this.B_F=e,this.B_H=.2,this.B_F.setUVOffset(this.B_H,0)}}setPosParam(t,e,i,s){let r=this.B_F;h.default.UseFog(r),this.A_x.subVecsTo(e,t),this.A_x.getLengthSquared()>4e4&&(this.A_x.normalize(),this.A_x.scaleBy(200)),r.setBeginAndEndPos(this.A_w,this.A_x),r.setPosition(t),r.update(),null==this.B_I&&(this.B_I=new n.default,this.B_I.campType=s,this.B_I.attackDst=i,this.B_I.dstPos.copyFrom(e))}run(){null!=this.B_F&&this.B_G>.1&&(this.B_F.setFadeFactor(this.B_G),this.B_G-=.3,this.B_H+=.2,this.B_F.setUVOffset(this.B_H,0),this.B_G<.1&&this.B_F.setVisible(!1),null!=this.B_I&&this.B_I.trigger()&&(l.default.GetInstance().addTriggerData(this.B_I),this.B_I=null))}isHiding(){return this.B_G<.1}reset(){this.B_G=1.1,this.B_F.setVisible(!0),this.B_H=.2,this.B_F.setUVOffset(this.B_H,0)}destroy(){this.r=null,this.B_F=null}}e.default=o},"3b73":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static SetWebBodyColor(t="white"){const e=document.body;e.style.background=t}static SetLanguage(t){s.H_U=t}static GetLanguage(){return""!=s.H_U||(s.H_U=navigator.language),s.H_U}static SetThreadEnabled(t){s.H_V=t}static GetThreadEnabled(){return s.H_V}static GetDebugEnabled(){return s.H_W}static SetDebugEnabled(t){s.H_W=t}static SetDevicePixelRatio(t){s.H_X=t}static GetDevicePixelRatio(){return s.H_X}static Initialize(t){s.H_Y&&(s.H_Y=!1,s.H_Z=t[0],s.TestMobileWeb(),s.H_U=navigator.language+"")}static IsWindowsPCOS(){return!(s.IsSafariWeb()||s.IsMobileWeb())}static IsWinExternalVideoCard(){if(s.H_a>0)return 2==s.H_a;let t=s.IsSafariWeb()||s.IsMobileWeb();return t||(t=s.GPU_RENDERER.indexOf("Intel(R)")<0),s.H_a=t?2:1,2==s.H_a}static TestSafariWeb(){return/Safari/.test(navigator.userAgent)&&/Mac OS/.test(navigator.userAgent)}static IsWebGL1(){return 1==s.H_Z}static IsWebGL2(){return 2==s.H_Z}static IsMobileWeb(){return s.H_f>0?2==s.H_f:s.TestMobileWeb()}static IsSafariWeb(){return s.H_b>0||(s.H_b=s.TestSafariWeb()?2:1),2==s.H_b}static IsIOS(){if(s.H_c>0)return 2==s.H_c;let t=!1;return t=!!/iPad|iPhone|iPod/.test(navigator.platform)||void 0!=navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform),s.H_c=t?2:1,t}static IsIpadOS(){if(s.H_d>0)return 2==s.H_d;let t=navigator.maxTouchPoints>0&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform);return!t&&/iPod|iPad|iPadPro|iPodPro/i.test(navigator.userAgent)&&(t=!0),s.H_d=t?2:1,t}static IsAndroidOS(){if(s.H_e>0)return 2==s.H_e;let t=s.TestMobileWeb();return t=!(!t||!/Android|Linux/i.test(navigator.userAgent)),s.H_e=t?2:1,t}static TestMobileWeb(){return s.H_f>0?2==s.H_f:/mobile/.test(location.href)?(s.H_f=2,2==s.H_f):/Android/i.test(navigator.userAgent)?/Mobile/i.test(navigator.userAgent)?(s.H_f=2,2==s.H_f):(s.H_f=1,2==s.H_f):/webOS|iPhone|iPod|iPad|iPodPro|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?(s.H_f=2,2==s.H_f):(s.H_f=1,2==s.H_f)}}s.H_Y=!0,s.H_Z=2,s.H_X=1,s.H_f=0,s.H_b=0,s.H_e=0,s.H_c=0,s.H_d=0,s.H_a=0,s.H_U="",s.H_W=!0,s.GPU_VENDOR="unknown",s.GPU_RENDERER="unknown",s.MAX_TEXTURE_SIZE=4096,s.MAX_RENDERBUFFER_SIZE=4096,s.MAX_VIEWPORT_WIDTH=4096,s.MAX_VIEWPORT_HEIGHT=4096,s.SHOWLOG_ENABLED=!1,s.SHADERCODE_TRACE_ENABLED=!1,s.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,s.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,s.H_V=!0,e.default=s},"3bfb":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("35fa")),n=s(i("8a0a")),l=s(i("e7d2")),h=i("8a0a"),o=s(i("fecb")),m=s(i("cb29"));class _ extends m.default{constructor(t=n.default.VTX_STATIC_DRAW){super(t),this.B_J=[null,null,null,null,null,null,null,null],this.normalType=h.VtxNormalType.FLAT,this.B_K=null,this.B_L=null,this.B_M=null,this.B_N=null,this.vtxColor=null,this.flipVerticalUV=!1,this.uvPartsNumber=0,this.uScale=1,this.vScale=1}getVS(){return this.B_K}getUVS(){return this.B_L}getNVS(){return this.B_M}getCVS(){return this.B_N}setPositionAt(t,e){if(t>=0&&t<8&&null!=this.B_K){let i=this.B_J[t];i[0]=e.x,i[1]=e.y,i[2]=e.z}}getPositionAt(t,e){if(t>=0&&t<8&&null!=this.B_K){let i=this.B_J[t];e.x=i[0],e.y=i[1],e.z=i[2]}}setEdgeAt(t,e,i){if(t>=0&&t<8&&null!=this.B_K){let s=this.B_J[t];t++,3==t?t=0:7==t&&(t=4);let r=this.B_J[t];s[0]=e.x,s[1]=e.y,s[2]=e.z,r[0]=i.x,r[1]=i.y,r[2]=i.z}}getEdgeAt(t,e,i){if(t>=0&&t<8&&null!=this.B_K){let s=this.B_J[t];t++,3==t?t=0:7==t&&(t=4);let r=this.B_J[t];e.x=s[0],e.y=s[1],e.z=s[2],i.x=r[0],i.y=r[1],i.z=r[2]}}setFaceAt(t,e,i,s,r){if(t>=0&&t<8&&null!=this.B_K){t*=4;let a,n,l=[e,i,s,r],h=_.H_g,o=this.B_J;for(let e=t+4,i=0;t<e;++t)a=o[h[t]],n=l[i++],a[0]=n.x,a[1]=n.y,a[2]=n.z}}getFaceAt(t,e,i,s,r){if(t>=0&&t<8&&null!=this.B_K){t*=4;let a,n,l=[e,i,s,r],h=_.H_g,o=this.B_J;for(let e=t+4,i=0;t<e;++t)a=o[h[t]],n=l[i++],n.x=a[0],n.y=a[1],n.z=a[2]}}getFaceCenterAt(t,e){if(t>=0&&t<8&&null!=this.B_K){t*=4;let i,s=_.H_g,r=this.B_J;e.setXYZ(0,0,0);for(let a=t+4;t<a;++t)i=r[s[t]],e.x+=i[0],e.y+=i[1],e.z+=i[2];e.scaleBy(.33333)}}transformFaceAt(t,e){if(t>=0&&t<8&&null!=this.B_K){t*=4;let i=_.H_g,s=this.B_J;for(let r=t+4;t<r;++t)e.transformVectorsSelf(s[i[t]],3)}}initializeWithYFace(t,e,i,s){let r=t,a=e,n=.5*(r.y+a.y);this.B_J[0]=[a.x,n,a.z],this.B_J[1]=[a.x,n,r.z],this.B_J[2]=[r.x,n,r.z],this.B_J[3]=[r.x,n,a.z],r=i,a=s;let l=.5*(r.y+a.y);this.B_J[4]=[a.x,l,a.z],this.B_J[5]=[a.x,l,r.z],this.B_J[6]=[r.x,l,r.z],this.B_J[7]=[r.x,l,a.z],this.initData()}initialize(t,e){this.B_J[0]=[e.x,t.y,e.z],this.B_J[1]=[e.x,t.y,t.z],this.B_J[2]=[t.x,t.y,t.z],this.B_J[3]=[t.x,t.y,e.z],this.B_J[4]=[e.x,e.y,e.z],this.B_J[5]=[e.x,e.y,t.z],this.B_J[6]=[t.x,e.y,t.z],this.B_J[7]=[t.x,e.y,e.z],this.initData()}scaleUVFaceAt(t,e,i,s,r){if(null!=this.B_L&&t>=0&&t<6){let a=8*t,n=a+8,l=this.B_L;for(;a<n;a+=2)l[a]=e+l[a]*s,l[a+1]=i+l[a+1]*r}}reinitialize(){this.initData()}initData(){this.vtxTotal=24;let t=0,e=0,i=0,s=null==this.B_O;if(s){this.B_K=new Float32Array(72),this.B_O=new Uint16Array(36);let s=[3,2,3,3,2,2];for(t=0;t<6;++t)3==s[t]?(this.B_O[i]=e+3,this.B_O[i+1]=e+2,this.B_O[i+2]=e+1,this.B_O[i+3]=e+3,this.B_O[i+4]=e+1,this.B_O[i+5]=e):(this.B_O[i]=e+2,this.B_O[i+1]=e+3,this.B_O[i+2]=e,this.B_O[i+3]=e+2,this.B_O[i+4]=e,this.B_O[i+5]=e+1),i+=6,e+=4}let m,u=_.H_g,d=this.B_J,c=this.B_K;for(e=0,t=0;t<this.vtxTotal;++t)m=d[u[t]],c.set(m,e),e+=3;null==this.bounds?this.bounds=new o.default:this.bounds.reset(),null!=this.B_P?(this.B_P.transformVectorsSelf(this.B_K,this.B_K.length),this.bounds.addXYZFloat32Arr(this.B_K)):this.bounds.addXYZFloat32Arr(this.B_K),this.bounds.updateFast(),l.default.Reset(),l.default.AddFloat32Data(this.B_K,3);let f=6;if(this.isVBufEnabledAt(n.default.VBUF_UVS_INDEX)){if(null==this.B_L&&(this.B_L=new Float32Array(48),this.initUVData(2*this.vtxTotal),4==this.uvPartsNumber?(this.scaleUVFaceAt(0,.5,.5,.5,.5),this.scaleUVFaceAt(1,0,0,.5,.5),this.scaleUVFaceAt(2,.5,0,.5,.5),this.scaleUVFaceAt(3,0,.5,.5,.5),this.scaleUVFaceAt(4,.5,0,.5,.5),this.scaleUVFaceAt(5,0,.5,.5,.5)):6==this.uvPartsNumber&&(this.scaleUVFaceAt(0,0,0,.25,.5),this.scaleUVFaceAt(1,.25,0,.25,.5),this.scaleUVFaceAt(2,.5,0,.25,.5),this.scaleUVFaceAt(3,.75,0,.25,.5),this.scaleUVFaceAt(4,0,.5,.25,.5),this.scaleUVFaceAt(5,.25,.5,.25,.5)),this.isVBufEnabledAt(n.default.VBUF_TVS_INDEX))){i=0;while(i<6){switch(i){case 0:t=0,this.B_L[t]=0,this.B_L[t+1]=1,this.B_L[t+2]=1,this.B_L[t+3]=1,this.B_L[t+4]=1,this.B_L[t+5]=0,this.B_L[t+6]=0,this.B_L[t+7]=0;break;case 3:t=24,this.B_L[t]=0,this.B_L[t+1]=1,this.B_L[t+2]=1,this.B_L[t+3]=1,this.B_L[t+4]=1,this.B_L[t+5]=0,this.B_L[t+6]=0,this.B_L[t+7]=0;break;case 5:t=32,this.B_L[t]=0,this.B_L[t+1]=1,this.B_L[t+2]=1,this.B_L[t+3]=1,this.B_L[t+4]=1,this.B_L[t+5]=0,this.B_L[t+6]=0,this.B_L[t+7]=0;break;default:break}++i}}l.default.AddFloat32Data(this.B_L,2)}if(this.isVBufEnabledAt(n.default.VBUF_NVS_INDEX)){this.B_M=new Float32Array(72),i=0;let e=0,s=0,a=0;if(this.normalType==h.VtxNormalType.FLAT)while(i<f){switch(e=0,s=0,a=0,i){case 0:s=-1;break;case 1:s=1;break;case 2:e=1;break;case 3:a=-1;break;case 4:e=-1;break;case 5:a=1;break;default:break}t=12*i,e*=this.normalScale,s*=this.normalScale,a*=this.normalScale,this.B_M[t]=e,this.B_M[t+1]=s,this.B_M[t+2]=a,this.B_M[t+3]=e,this.B_M[t+4]=s,this.B_M[t+5]=a,this.B_M[t+6]=e,this.B_M[t+7]=s,this.B_M[t+8]=a,this.B_M[t+9]=e,this.B_M[t+10]=s,this.B_M[t+11]=a,++i}else{let n=this.bounds.center,l=0;while(i<this.vtxTotal)t=3*i,e=this.B_K[t]-n.x,s=this.B_K[t+1]-n.y,a=this.B_K[t+2]-n.z,l=Math.sqrt(e*e+s*s+a*a),l>r.default.MATH_MIN_POSITIVE&&(this.B_M[t]=e/l,this.B_M[t+1]=s/l,this.B_M[t+2]=a/l),++i}l.default.AddFloat32Data(this.B_M,3)}if(this.isVBufEnabledAt(n.default.VBUF_CVS_INDEX)){this.B_N=new Float32Array(72),i=0;let e=1,s=1,r=1;null!=this.vtxColor&&(e=this.vtxColor.r,s=this.vtxColor.g,r=this.vtxColor.b);while(i<f)t=12*i,this.B_N[t]=e,this.B_N[t+1]=s,this.B_N[t+2]=r,this.B_N[t+3]=e,this.B_N[t+4]=s,this.B_N[t+5]=r,this.B_N[t+6]=e,this.B_N[t+7]=s,this.B_N[t+8]=r,this.B_N[t+9]=e,this.B_N[t+10]=s,this.B_N[t+11]=r,++i;l.default.AddFloat32Data(this.B_N,3)}if(this.isVBufEnabledAt(n.default.VBUF_TVS_INDEX)){let t=12,e=new Float32Array(this.B_M.length),i=new Float32Array(this.B_M.length);a.default.ClacTrisTangent(this.B_K,this.B_K.length,this.B_L,this.B_M,t,this.B_O,e,i),l.default.AddFloat32Data(e,3),l.default.AddFloat32Data(i,3)}l.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.updateWireframeIvs(),null==this.B_Q?(this.B_Q=l.default.CreateBySaveData(this.getBufDataUsage()),this.B_Q.setUint16IVSData(this.B_O),this.vtCount=this.B_O.length,this.trisNumber=12,this.buildEnd()):(this.forceUpdateIVS&&this.B_Q.setUint16IVSData(this.B_O),l.default.UpdateBufData(this.B_Q))}setFaceUVSAt(t,e,i=0){if(null!=this.B_L)if(i<1)this.B_L.set(e,8*t);else{t*=8,i<0&&(i=0);for(let s=0;s<4;++s)this.B_L[t++]=e[2*i],this.B_L[t++]=e[2*i+1],i++,i%=4}}initUVData(t){let e=this.uScale,i=this.vScale,s=0;if(this.flipVerticalUV)while(s<t)this.B_L[s]=1*e,this.B_L[s+1]=1*i,this.B_L[s+2]=0*e,this.B_L[s+3]=1*i,this.B_L[s+4]=0*e,this.B_L[s+5]=0*i,this.B_L[s+6]=1*e,this.B_L[s+7]=0*i,s+=8;else while(s<t)this.B_L[s]=0*e,this.B_L[s+1]=0*i,this.B_L[s+2]=1*e,this.B_L[s+3]=0*i,this.B_L[s+4]=1*e,this.B_L[s+5]=1*i,this.B_L[s+6]=0*e,this.B_L[s+7]=1*i,s+=8}testRay(t,e,i,s){let r=o.default.IntersectionRL2(e,t,this.bounds,i);return r?1:-1}toString(){return"Box3DMesh()"}__$destroy(){this.isResFree()&&(this.bounds=null,this.B_K=null,this.B_L=null,this.B_M=null,this.B_N=null,this.vtxColor=null,super.__$destroy())}}_.H_g=[0,1,2,3,4,5,6,7,4,5,1,0,5,6,2,1,7,6,2,3,4,7,3,0],e.default=_},"3c81":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("2be1")),a=s(i("7696"));class n extends r.default{setCreateParams(t,e,i,s,r,a){this.A_6=t,this.B_R=e,this.Av=i,this.B_S=s,this.B_T=r,this.B_U=a}createNode(){return new a.default(this.A_6,this.B_R,this.Av,this.B_S,this.B_T,this.B_U)}rejoinRunitForTro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForTro(t)}rejoinRunitForVro(t){this.getNodeByUid(t.__$rprouid).rejoinRunitForVro(t)}}e.default=n},"3d6c":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("b9b5")),a=s(i("da9b")),n=s(i("9951")),l=s(i("6953")),h=i("838f"),o=i("9d30"),m=s(i("91e2")),_=i("5216"),u=s(i("2fe8")),d=s(i("725b"));class c{constructor(){this.A8=null,this.B_V=new a.default,this.B_W=new h.TerrainModule,this.B_X=new o.RoleBuilder,this.B_Y=0,this.envAmbientLightEnabled=!0,this.shadowEnabled=!0,this.fogEnabled=!0,this.B_Z=!1}initialize(t,e){null==this.A8&&(this.A8=t,this.B_a=e,n.default.GetInstance().initialize(this.B_a),this.B_Y=this.B_a.getTextureLoader().getWaitTotal(),this.init())}init(){let t=d.default.GetInstance();t.mobileEnabled=!1,t.setRenderProxy(this.A8.getRenderProxy()),t.initialize("fontTex",36,512,512,!1,!0),this.B_b=new u.default,this.B_b.initialize("resource"),this.B_b.setXYZ(0,-230,0),this.B_b.setScaleXY(3,3),this.B_b.setRGB3f(.3,1.7,.5),this.A8.addEntity(this.B_b),this.B_c=new u.default,this.B_c.initialize("loading 100%"),this.B_c.setXYZ(0,-370,0),this.B_c.setScaleXY(3,3),this.B_c.setRGB3f(.5,.5,1.3),this.A8.addEntity(this.B_c);let e=new r.default;e.initialize(300),this.A8.addEntity(e),e=new r.default,e.setMaterialPipeline(this.B_a.pipeline),e.pipeTypes=[_.MaterialPipeType.FOG_EXP2],e.initializeCross(200),this.A8.addEntity(e)}initScene(){this.B_W.terrain.shadowReceiveEnabled=this.shadowEnabled,this.B_W.terrain.envAmbientLightEnabled=this.envAmbientLightEnabled,this.B_W.terrain.fogEnabled=this.fogEnabled,this.B_W.terrain.renderProcessIndex=1,this.B_W.terrain.colorBrightness=.4,this.B_W.initialize(this.A8,this.B_a),this.B_V.initialize(this.A8),this.B_X.envAmbientLightEnabled=this.envAmbientLightEnabled,this.B_X.fogEnabled=this.fogEnabled,this.B_X.terrain=this.B_W,this.B_X.campModule=this.B_V,this.B_X.initialize(this.A8,this.B_a);let t=50;this.B_X.createLimbRoles(t),this.B_X.createTrackWheelRoles(t),this.B_X.createSillyRoles(t),this.initEnvBox()}initEnvBox(){let t=this.B_X.materialBuilder,e=t.createBaseLambertMaterial(this.B_a.getTextureByUrl("static/assets/image_003.jpg"),null,null,!0);e.setRGB3f(.2,.2,.2);let i=new m.default;i.normalScale=-1,i.setMaterial(e),i.showFrontFace(),i.initializeCube(4e3),this.A8.addEntity(i,2)}run(){if(this.B_Z)this.B_V.run(),l.default.Run(),null!=this.B_c&&(this.A8.removeEntity(this.B_b),this.A8.removeEntity(this.B_c),this.B_b=null,this.B_c=null,this.initScene());else if(null!=this.B_a)if(this.B_a.isTextureLoadedAll())this.B_Z=!0,this.B_c.setText("loading 100%"),this.B_c.updateMeshToGpu(),this.B_c.update();else{let t=(this.B_Y-this.B_a.getTextureLoader().getWaitTotal())/this.B_Y;this.B_c.setText("loading "+Math.round(100*t)+"%"),this.B_c.updateMeshToGpu(),this.B_c.update()}}}e.SceneModule=c},"3d98":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("8d98"),a=s(i("2be0"));class n{constructor(){this.A8=null,this.texture=null}loadTextureWithUrl(t,e){let i=new a.default;i.uuid=t,i.load(t,this),this.A8=e,this.createTexture()}createTexture(){this.texture=this.A8.textureBlock.createFloatCubeTex(32,32)}loaded(t,e){this.parseTextureBuffer(t),this.A8=null,this.texture=null}loadError(t,e){}parseTextureBuffer(t){let e=0,i=128,s=128,r=i*s*3,a=new Float32Array(t),n=null,l=this.texture;l.toRGBFormat();for(let h=0,o=6;h<o;++h)n=a.slice(e,e+r),l.setDataFromBytesToFaceAt(h,n,i,s,0),e+=r}}e.TextureLoader=n;class l extends n{constructor(){super(),this.hdrBrnEnabled=!1}createTexture(){this.hdrBrnEnabled?this.texture=this.A8.textureBlock.createBytesCubeTex(32,32):this.texture=this.A8.textureBlock.createFloatCubeTex(32,32)}parseFloat(t){let e=0,i=128,s=128,a=3,n=new Float32Array(t),l=null,h=this.texture;h.toRGBFormat(),h.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,h.magFilter=r.TextureConst.LINEAR;for(let r=0;r<9;r++){for(let t=0;t<6;t++){const o=i*s*a;l=n.subarray(e,e+o),h.setDataFromBytesToFaceAt(t,l,i,s,r),e+=o}i>>=1,s>>=1}}parseHdrBrn(t){let e=new Uint16Array(t),i=new Uint8Array(t),s=0,a=e[4],n=e[5],l=e[6],h=0,o=i.subarray(32),m=this.texture;l>1?(m.mipmapEnabled=!1,m.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,m.magFilter=r.TextureConst.LINEAR):(m.mipmapEnabled=!0,m.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,m.magFilter=r.TextureConst.LINEAR);for(let r=0;r<l;r++){for(let t=0;t<6;t++)h=a*n*4,m.setDataFromBytesToFaceAt(t,o.subarray(s,s+h),a,n,r),s+=h;a>>=1,n>>=1}}parseTextureBuffer(t){this.hdrBrnEnabled?this.parseHdrBrn(t):this.parseFloat(t)}}e.SpecularTextureLoader=l},"402a":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("11e6")),a=s(i("8e17")),n=s(i("fecb")),l=s(i("29ef")),h=s(i("0929")),o=i("cc48"),m=s(i("dc2b"));class _{constructor(t=null){this.T=0,this.Bq=null,this.B_d=null,this.B_e=!0,this.B_f=!0,this.B_g=l.default.COLOR_MASK_ALL_TRUE,this.B_h=l.default.BACK_CULLFACE_NORMAL_STATE,this.B_i=null,this.Bp=null,this.B_j=null,this.B_k=null,this.B_l=-1,this.B_m=null,this.d=null,this.AK=null,this.__$rseFlag=r.default.DEFAULT,this.name="DisplayEntity",this.spaceCullMask=o.SpaceCullingMask.CAMERA,this.drawEnabled=!1,this.mouseEnabled=!1,this.vbWholeDataEnabled=!0,this.pipeTypes=null,this.B_n=!1,this.B_o=!1,this.B_p=null,this.B_q=h.default.UPDATE_TRANSFORM,this.T=_.H0++,this.Bq=null==t?h.default.Create():t,this.createBounds()}createBounds(){this.B_k=new n.default}__$setRenderProxy(t){this.d=t}__$setParent(t){this.B_m,this.B_m=t}__$getParent(){return this.B_m}__$testSpaceEnabled(){return r.default.TestSpaceEnabled2(this.__$rseFlag)}__$testContainerEnabled(){return r.default.TestContainerEnabled(this.__$rseFlag)}__$testRendererEnabled(){return r.default.TestRendererEnabled(this.__$rseFlag)}getRendererUid(){return r.default.GetRendererUid(this.__$rseFlag)}setMaterialPipeline(t){this.AK=t}getMaterialPipeline(){return this.AK}isFree(){return this.__$rseFlag==r.default.DEFAULT}dispatchEvt(t){return null!=this.B_d?this.B_d.dispatchEvt(t):0}getEvtDispatcher(t){return this.B_d}setEvtDispatcher(t){this.B_d=t}getGlobalBounds(){return this.B_k}getLocalBounds(){return this.Bp.bounds}getGlobalBoundsVer(){return null!=this.B_k?this.B_k.version:-1}__$setDrawEnabled(t){this.B_f!=t&&(this.B_f=t,null!=this.B_i&&(this.B_i.visible=this.B_e&&t,null!=this.B_i.__$$runit&&this.B_i.__$$runit.setVisible(this.B_i.visible)))}isDrawEnabled(){return this.B_f}updateMeshToGpu(t=null,e=!0){null!=t&&(this.d=t),null!=this.d&&null!=this.B_i&&this.B_i.__$ruid>-1&&(this.B_o?(this.B_o=!1,this.d.VtxBufUpdater.updateDispVbuf(this.B_i,e)):this.d.VtxBufUpdater.updateVtxDataToGpuByUid(this.B_i.vbuf.getUid(),e))}updateMaterialToGpu(t=null,e=!0){null!=t&&(this.d=t),null!=this.d&&null!=this.B_i&&this.B_i.__$ruid>-1&&this.B_n&&(this.B_n=!1,this.d.MaterialUpdater.updateDispTRO(this.B_i,e))}setTextureList(t){null!=this.B_i&&this.B_i.__$ruid>-1&&null!=this.B_i.getMaterial()&&(this.B_i.getMaterial().setTextureList(t),this.B_n=!0)}setTextureAt(t,e){null!=this.B_i&&this.B_i.__$ruid>-1&&null!=this.B_i.getMaterial()&&(this.B_i.getMaterial().setTextureAt(t,e),this.B_n=!0)}setSortValue(t){null!=this.B_i&&null!=this.B_i.__$$runit&&(this.B_i.__$$runit.value=t)}setVisible(t){this.B_e!=t&&(this.B_e=t,null!=this.B_i&&(this.B_i.visible=t&&this.B_f,null!=this.B_i.__$$runit&&this.B_i.__$$runit.setVisible(this.B_i.visible)))}getVisible(){return this.B_e}getTransform(){return this.Bq}copyPositionFrom(t){null!=t&&this.Bq.copyPositionFrom(t.getTransform())}copyMeshFrom(t){null!=t&&this.setMesh(t.getMesh())}copyMaterialFrom(t){null!=t&&this.setMaterial(t.getMaterial())}copyTransformFrom(t){let e=t;null!=e&&this.Bq.copyFrom(e.Bq)}initDisplay(t){this.B_i.vbuf=t.__$attachVBuf(),this.B_i.ivsIndex=0,this.B_i.ivsCount=t.vtCount,this.B_i.drawMode=t.drawMode,this.B_i.trisNumber=t.trisNumber,this.B_i.visible=this.B_e&&this.B_f}setMesh(t){null==this.Bp?null!=t&&(t.isEnabled()||t.rebuild(),t.isEnabled()&&(this.Bp=t,t.__$attachThis(),null==this.B_i&&this.createDisplay(),null!=this.B_i&&(this.B_i.setTransform(this.Bq.getMatrix()),this.initDisplay(t)),null==this.B_j?this.B_j=t.bounds:this.B_j.copyFrom(t.bounds),this.updateMesh())):null!=this.B_i&&this.B_i.__$ruid>-1&&this.Bp!=t&&null!=t&&(this.Bq.updatedStatus|=2,this.Bp.__$detachVBuf(this.B_i.vbuf),this.Bp.__$detachThis(),t.__$attachThis(),this.Bp=t,this.initDisplay(t),this.updateMesh(),this.B_o=!0)}updateMesh(){}getIvsIndex(){return this.B_i.ivsIndex}getIvsCount(){return this.B_i.ivsCount}setIvsParam(t,e,i=!1){if(null!=this.B_i&&(this.B_i.ivsIndex=t,this.B_i.ivsCount=e,this.B_i.__$ruid>-1&&(this.B_i.__$$runit.trisNumber=Math.floor((e-t)/3),this.B_i.__$$runit.setIvsParam(t,e),this.B_i.__$$runit.drawMode=this.Bp.drawMode,i&&this.isPolyhedral()))){this.B_j==this.Bp.bounds&&(this.B_j=new n.default,this.B_j.copyFrom(this.Bp.bounds)),this.B_q=h.default.UPDATE_TRANSFORM,this.B_j.reset();let i=this.Bp.getIVS();this.B_j.addXYZFloat32AndIndicesArr(this.Bp.getVS(),i.subarray(t,t+e)),this.B_j.update()}}getMesh(){return this.Bp}hasMesh(){return null!=this.Bp}isPolyhedral(){return null==this.Bp||this.Bp.isPolyhedral()}testRay(t,e,i,s){return this.Bp.testRay(t,e,i,s)}setMaterial(t){null!=t&&(null==this.B_i&&(this.B_i=m.default.Create(),this.B_i.setTransform(this.Bq.getMatrix()),this.B_i.visible=this.B_e&&this.B_f),this.B_i.getMaterial()!=t&&(r.default.RENDERER_UID_FLAG&this.__$rseFlag)==r.default.RENDERER_UID_FLAG&&this.B_i.__$ruid<0&&(this.B_i.renderState=this.B_h,this.B_i.rcolorMask=this.B_g,this.B_i.setMaterial(t)))}getMaterial(){return null!=this.B_i?this.B_i.getMaterial():null}getDisplay(){return this.B_i}getInvMatrix(){return this.Bq.getInvMatrix()}getMatrix(t=!0){return this.Bq.getMatrix(t)}getToParentMatrix(){return this.Bq.getToParentMatrix()}setRenderColorMask(t){this.B_g=t,null!=this.B_i&&(this.B_i.rcolorMask=this.B_g,null!=this.B_i.__$$runit&&this.B_i.__$$runit.setDrawFlag(this.B_h,this.B_g))}setRenderColorMaskByName(t){this.B_g=l.default.GetRenderColorMaskByName(t),null!=this.B_i&&(this.B_i.rcolorMask=this.B_g,null!=this.B_i.__$$runit&&this.B_i.__$$runit.setDrawFlag(this.B_h,this.B_g))}setRenderState(t){this.B_h=t,null!=this.B_i&&(this.B_i.renderState=this.B_h,null!=this.B_i.__$$runit&&this.B_i.__$$runit.setDrawFlag(this.B_h,this.B_g))}setRenderStateByName(t){this.B_h=l.default.GetRenderStateByName(t),null!=this.B_i&&(this.B_i.renderState=this.B_h,null!=this.B_i.__$$runit&&this.B_i.__$$runit.setDrawFlag(this.B_h,this.B_g))}createDisplay(){this.B_i=m.default.Create()}activeDisplay(){if(null!=this.B_i){let t=this.B_i.getMaterial();if(null!=t){if(null==t.getShaderData()&&null!=t.getCodeBuf()&&null==t.getShaderData()){let e=t.getTextureList(),i=null!=e&&e.length>0;null==t.getMaterialPipeline()&&null!=this.getMaterialPipeline()&&t.setMaterialPipeline(this.getMaterialPipeline()),null==t.pipeTypes&&(t.pipeTypes=this.pipeTypes),t.initializeByCodeBuf(i)}null==this.getMesh()&&(this.__activeMesh(t),this.B_i.name=this.name)}}}__activeMesh(t){}getUid(){return this.T}setXYZ(t,e,i){this.Bq.setXYZ(t,e,i)}offsetPosition(t){this.Bq.offsetPosition(t)}setPosition(t){this.Bq.setPosition(t)}getPosition(t){this.Bq.getPosition(t)}setRotation3(t){this.Bq.setRotationXYZ(t.x,t.y,t.z)}setRotationXYZ(t,e,i){this.Bq.setRotationXYZ(t,e,i)}setScale3(t){this.Bq.setScaleXYZ(t.x,t.y,t.z)}setScaleXYZ(t,e,i){this.Bq.setScaleXYZ(t,e,i)}getRotationXYZ(t){this.Bq.getRotationXYZ(t)}getScaleXYZ(t){this.Bq.getScaleXYZ(t)}localToGlobal(t){null!=this.Bq&&this.Bq.localToGlobal(t)}globalToLocal(t){null!=this.Bq&&this.Bq.globalToLocal(t)}isInRenderer(){return(this.__$rseFlag&r.default.RENDERER_UID_FLAG)!=r.default.RENDERER_UID_FLAG}isInRendererProcess(){return null!=this.B_i&&this.B_i.__$ruid>-1}isRenderEnabled(){return this.drawEnabled&&this.B_e&&null!=this.B_i&&this.B_i.__$ruid>-1}updateBounds(){if(null!=this.Bq){if(this.B_q=h.default.UPDATE_TRANSFORM,null!=this.Bp&&this.B_j!=this.Bp.bounds){this.B_j.reset();let t=this.Bp.getIVS();this.B_j.addXYZFloat32AndIndicesArr(this.Bp.getVS(),t.subarray(this.B_i.ivsIndex,this.B_i.ivsIndex+this.B_i.ivsCount)),this.B_j.update()}this.update()}}updateLocalBoundsVS(t){let e=t.min,i=t.max;null==this.B_p&&(this.B_p=new Float32Array(24));let s=this.B_p;s[0]=e.x,s[1]=e.y,s[2]=e.z,s[3]=i.x,s[4]=e.y,s[5]=e.z,s[6]=e.x,s[7]=e.y,s[8]=i.z,s[9]=i.x,s[10]=e.y,s[11]=i.z,s[12]=e.x,s[13]=i.y,s[14]=e.z,s[15]=i.x,s[16]=i.y,s[17]=e.z,s[18]=e.x,s[19]=i.y,s[20]=i.z,s[21]=i.x,s[22]=i.y,s[23]=i.z}updateGlobalBounds(){let t=this.B_j;if(this.B_q>h.default.UPDATE_POSITION||this.B_l!=t.version){let e=this.Bq.updateStatus;if(this.Bq.update(),this.B_l!=t.version||e!=this.Bq.updateStatus){this.B_l=t.version,this.updateLocalBoundsVS(t);let e=this.B_p,i=_.H_h;this.Bq.getMatrix().transformVectors(e,24,i),this.B_k.reset(),this.B_k.addXYZFloat32Arr(i),this.B_k.update()}}else{_.H_i.setXYZ(0,0,0),_.H_j.setXYZ(0,0,0);let t=this.Bq.getMatrix(!1);t.transformVector3Self(_.H_i),this.Bq.update(),t=this.Bq.getMatrix(!1),t.transformVector3Self(_.H_j),_.H_j.subtractBy(_.H_i);let e=this.B_k;e.min.addBy(_.H_j),e.max.addBy(_.H_j),e.center.addBy(_.H_j),++this.B_k.version}}update(){this.Bq.updatedStatus>this.B_q&&(this.B_q=this.Bq.updatedStatus),this.B_q!=h.default.UPDATE_NONE&&(null!=this.Bp&&null!=this.B_k?this.updateGlobalBounds():this.Bq.update(),this.B_q=h.default.UPDATE_NONE,this.Bq.updatedStatus=this.B_q)}destroy(){null!=this.B_d&&(this.B_d.destroy(),this.B_d=null),null!=this.Bq&&this.isFree()&&(null!=this.B_i&&(this.Bp.__$detachVBuf(this.B_i.vbuf),m.default.Restore(this.B_i),this.B_i=null),h.default.Restore(this.Bq),this.Bq=null,null!=this.Bp&&(this.Bp.__$detachThis(),this.Bp=null),this.__$setParent(null),this.B_e=!0,this.B_f=!0,this.d=null,this.__$rseFlag=r.default.DEFAULT),this.B_k=null,this.B_j=null,this.AK=null}toString(){return"DisplayEntity(name="+this.name+",uid = "+this.T+", rseFlag = "+this.__$rseFlag+")"}}_.H0=0,_.H_h=new Float32Array(24),_.H_j=new a.default,_.H_i=new a.default,e.default=_},"408b":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("faa5")),a=s(i("b3bd")),n=s(i("0fc4"));class l extends r.default{constructor(){super(),this.n_="",this.normalEnabled=!1,this.diffuseMapEnabled=!0}initialize(t){super.initialize(t),this.n_="VSTexturePosIdMaterialShd",this.adaptationShaderVersion=!1}buildShader(){let t=this.A_s;t.normalEnabled=this.normalEnabled,t.addVertLayout("vec4","a_vs"),t.addFragUniform("vec4","u_color"),t.addVertUniform("vec4","u_vtxParam"),this.A_t.add2DMap("VTX_CURVE_MOVE_MAP",!1,!1,!0),this.diffuseMapEnabled&&this.A_t.addDiffuseMap(),t.addVertFunction("\nvoid  initLocalPos() {\n    localPosition = vec4(a_vs.xyz, 1.0);\n    \n    vec4 params = u_vtxParam;\n    float index = abs(mod((a_vs.w + params[1]),params[2]));\n    index *= params[0];\n    vec2 puv = vec2(fract(index), floor(index) * params[0]);\n    localPosition.xyz += VOX_Texture2D(VTX_CURVE_MOVE_MAP, puv).xyz;\n}\n            "),t.addFragMainCode("\n    #ifdef VOX_USE_2D_MAP\n        FragColor0 = VOX_Texture2D(VOX_DIFFUSE_MAP, v_uv) * u_color;\n    #else\n        FragColor0 = u_color;\n    #endif\n    //FragColor0.xyz *= abs(v_worldNormal.xyz);\n"),t.addVertMainCode("\n    initLocalPos();\n    \n    worldPosition = u_objMat * localPosition;\n    viewPosition = u_viewMat * worldPosition;\n    gl_Position = u_projMat * viewPosition;\n    #ifdef VOX_USE_2D_MAP\n        v_uv = a_uvs;\n    #endif\n    #ifdef VOX_USE_NORMAL\n        v_worldNormal = normalize(a_nvs.xyz * inverse(mat3(u_objMat)));\n    #endif\n")}getUniqueShaderName(){return this.n_}toString(){return"[VSTexturePosIdRenderShaderBuffer()]"}static GetInstance(){return null!=l.H2||(l.H2=new l),l.H2}}l.H2=null;class h extends n.default{constructor(){super(),this.normalEnabled=!1,this.diffuseMapEnabled=!0,this.B4=new Float32Array([1,1,1,1]),this.B_r=new Float32Array([1/16,0,0,0])}buildBuf(){let t=l.GetInstance();t.normalEnabled=this.normalEnabled,t.diffuseMapEnabled=this.diffuseMapEnabled}getCodeBuf(){return l.GetInstance()}setTexSize(t){this.B_r[0]=1/t}setPositionsTotal(t){this.B_r[2]=t}setCurveMoveDistance(t){this.B_r[1]=t}setRGB3f(t,e,i){this.B4[0]=t,this.B4[1]=e,this.B4[2]=i}setRGBA4f(t,e,i,s){this.B4[0]=t,this.B4[1]=e,this.B4[2]=i,this.B4[3]=s}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_vtxParam","u_color"],t.dataList=[this.B_r,this.B4],t}}e.VSTexturePosIdMaterial=h,e.default=h},"41a8":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("faa5")),a=s(i("c217")),n=i("5216"),l=i("fba3");class h extends r.default{constructor(){super(),this.B_s=!1,this.B_t=!1,this.B_u=!1,this.A_u=!1,this.n_="",this.clipMixEnabled=!1,this.brightnessEnabled=!1}initialize(t){super.initialize(t),this.n_="BillboardGroupShader",this.clipMixEnabled&&(this.n_+="Mix"),this.n_+=this.brightnessEnabled?"Brn":"Alp",this.adaptationShaderVersion=!1}setParam(t,e,i,s){this.A_u=t,h.H_k.setBrightnessAndAlpha(t,e),this.B_s=i,this.B_t=s}buildVertShd(){}getShaderCodeObject(){return l.BillboardGroupShaderCode}buildShader(){this.A_s.autoBuildHeadCodeEnabled=!1,this.buildFragShd(),this.buildVertShd(),null==this.pipeline&&this.A_s.addShaderObject(l.BillboardGroupShaderCode)}buildFragShd(){if(this.brightnessEnabled){let t=this.fogEnabled;null!=this.pipeline&&(t=t||this.pipeline.hasPipeByType(n.MaterialPipeType.FOG_EXP2),t=t||this.pipeline.hasPipeByType(n.MaterialPipeType.FOG)),this.brightnessOverlayEnabeld=t}let t=this.A_s;this.A_t.addDiffuseMap(),this.B_t&&(this.A_t.add2DMap("VOX_OFFSET_COLOR_MAP"),this.B_u&&(t.addDefine("VOX_USE_RAW_UV"),t.addVarying("vec4","v_uv"))),t.addVarying("vec4","v_colorMult"),t.addVarying("vec4","v_colorOffset"),t.addVarying("vec4","v_texUV"),t.addVarying("vec4","v_factor"),this.B_s&&(t.addDefine("VOX_USE_CLIP"),this.clipMixEnabled&&t.addDefine("VOX_USE_CLIP_MIX")),t.addDefine("FADE_VAR","v_factor"),t.addDefine("FADE_STATUS",""+h.H_k.getBrnAlphaStatus())}getUniqueShaderName(){let t=this.n_+"_"+h.H_k.getBrnAlphaStatus();return this.B_t&&this.B_s&&(t+="ClipColorTex"),this.premultiplyAlpha&&(t+="PreMAlpha"),t}}h.H_k=new a.default,e.default=h},"425c":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=i("c870"),n=s(i("52c9")),l=s(i("3bfb")),h=s(i("408b"));class o{constructor(){this.B_v=1,this.B_w=1,this.B_x=1,this.B_y=2,this.B_z=5,this.B_0=2,this.B_1=new r.default(.2,.2,.2),this.B_2=new r.default(-2,-2,-4),this.B_3=new r.default(2,2,4),this.B_4=new n.default,this.B_5=null,this.animator=new a.IdMeshGroupAnimator}setTrackScale(t){this.B_1.setXYZ(t,t,t)}setTrackScaleXYZ(t,e,i){this.B_1.setXYZ(t,e,i)}setFactor(t,e,i){t>1&&(this.B_y=t),e>1&&(this.B_z=e),i>1&&(this.B_0=i)}getTrackPosList(){return this.B_5}createTrackData(){let t=[new r.default(100,40,0),new r.default(70,60,0),new r.default(-70,60,0),new r.default(-100,40,0),new r.default(-100,-40,0),new r.default(-70,-60,0),new r.default(70,-60,0),new r.default(100,-40,0),new r.default(100,40,0)];this.B_5=t;let e=this.B_y,i=this.B_z;this.B_2.setXYZ(-e,-e,-e*i),this.B_3.copyFrom(this.B_2),this.B_3.scaleBy(-1)}initializeFrom(t,e){null!=t&&(this.B_y=t.B_y,this.B_z=t.B_z,this.B_2.copyFrom(t.B_2),this.B_3.copyFrom(t.B_3),this.animator.copyTransformFrom(t.animator),this.animator.setPosData(t.animator.getPosDataTexture(),t.animator.getPosData(),t.animator.getPosTotal()),this.animator.copyMeshFrom(t.animator),this.animator.initialize(t.B_w,t.B_x,e))}initialize(t,e=.5,i=null,s=1){let a;this.createTrackData();for(let r=this.B_5.length-1;r>=0;--r)a=this.B_5[r],a.scaleVector(this.B_1),this.B_4.addXYZ(a.x,a.y,a.z);this.animator.createDataTexture(t,this.B_4.getStepsTotal(e)/s),a=new r.default(100,0,0);let o=0,m=n.default.TRACK_BEGIN,_=this.animator.getDataTextureArea(),u=0;for(;u<_;++u)if(m=this.B_4.calcPosByDis(a,o,!1),o+=e*s,this.animator.setPosAt(u,a),m==n.default.TRACK_END)break;let d=null;if(null==this.animator.getMesh()&&null==this.animator.getGroupSrcMesh()){d=new h.default,d.normalEnabled=this.animator.normalEnabled,d.diffuseMapEnabled=this.animator.diffuseMapEnabled,d.initializeByCodeBuf(!0);let t=new l.default;t.setBufSortFormat(d.getBufSortFormat()),t.initialize(this.B_2,this.B_3),this.animator.setGroupSrcMesh(t),this.animator.setMaterial(d)}this.B_v=Math.floor(Math.abs(2*this.B_2.x)+this.B_0),this.B_w=Math.ceil(this.B_4.getPathDistance()/this.B_v),this.B_x=Math.round(this.B_v/e),this.animator.initialize(this.B_w,this.B_x,i),null!=d&&(d.setTexSize(this.animator.getDataTextureSize()),d.setPositionsTotal(this.animator.getPosTotal()))}moveDistanceOffset(t){this.animator.moveIdDistanceOffset(t)}moveDistance(t){this.animator.moveIdDistance(t)}setXYZ(t,e,i){this.animator.setXYZ(t,e,i)}setPosition(t){this.animator.setPosition(t)}getPosition(t){this.animator.getPosition(t)}setRotationXYZ(t,e,i){this.animator.setRotationXYZ(t,e,i)}setScaleXYZ(t,e,i){this.animator.setScaleXYZ(t,e,i)}setScale(t){this.animator.setScaleXYZ(t,t,t)}update(){this.animator.update()}}e.default=o},"442e":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("2be1")),a=s(i("265e"));class n extends r.default{createNode(){return new a.default}}e.default=n},"45db":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8def")),a=s(i("fa60"));class n{constructor(){this.B_6=null,this.B_7=-1,this.B_8=[],this.B_9=0,this.n=0,this.B_=0,this.CA=0,this.CB=null,this.CC=null,this.CD=null,this.CE=[],this.CF=0}updateToGpu(t){let e=this.B_8.length;if(e>0){let i=this.B_6;if(this.version!=i.vertexVer){let s,r=i.getBufDataUsage(),a=this.CD;for(let n=0;n<e;++n)s=i.getF32DataAt(n),a[n]>=s.length?(t.bindArrBuf(this.B_8[n]),t.arrBufSubData(s,0)):(t.bindArrBuf(this.B_8[n]),t.arrBufData(s,r),a[n]=s.length);this.version=i.vertexVer}}}uploadCombined(t,e){let i=this.B_6,s=i.getF32DataAt(0);if(this.B_8.push(t.createBuf()),t.bindArrBuf(this.B_8[0]),t.arrBufData(s,i.getBufDataUsage()),this.B_9=1,this.CD=[s.length],null==this.CB){this.CA=0,this.CB=new Array(this.B_),this.CC=new Array(this.B_);for(let t=0;t<this.B_;++t)this.CC[t]=this.CA,this.CA+=4*e.getLocationSizeByIndex(t),this.CB[t]=e.getLocationTypeByIndex(t)}}uploadSeparated(t,e){let i=this.B_6,s=0,r=null,a=i.getBufDataUsage();if(this.B_9=this.B_6.getBuffersTotal(),this.CD=new Array(this.B_),null==i.bufData)for(;s<this.B_;++s)r=t.createBuf(),this.B_8.push(r),t.bindArrBuf(r),t.arrBufData(i.getF32DataAt(s),a),this.CD[s]=i.getF32DataAt(s).length;else{let e=null,n=0,l=0,h=0,o=0;for(;s<this.B_;++s){for(r=t.createBuf(),this.B_8.push(r),t.bindArrBuf(r),t.arrBufDataMem(i.bufData.getAttributeDataTotalBytesAt(s),a),h=0,o=0,l=i.bufData.getAttributeDataTotalAt(s),n=0;n<l;++n)e=i.bufData.getAttributeDataAt(s,n),o+=e.length,t.arrBufSubData(e,h),h+=e.byteLength;this.CD[s]=o}}if(null==this.CB){this.CB=new Array(this.B_),this.CC=new Array(this.B_);for(let t=0;t<this.B_;++t)this.CC[t]=this.CA,this.CA+=4*e.getLocationSizeByIndex(t),this.CB[t]=e.getLocationTypeByIndex(t);this.CA=0}}initialize(t,e,i){this.B_8.length<1&&null!=i&&(this.version=i.vertexVer,this.B_6=i,this.B_7=i.getUid(),this.n=i.getType(),this.B_=e.getLocationsTotal(),this.n<1?this.uploadCombined(t,e):this.uploadSeparated(t,e))}getVROMid(t,e,i,s){let r=(131+t.getRCUid())*this.B_7;return i?(r=131*r+e.getMid(),r=131*r+3):r=131*r+e.getMid(),r=131*r+e.getLocationsTotal(),r=131*r+s,r}createVRO(t,e,i,s,n){let l=e.getLocationsTotal();if(this.B_*l>0&&l<=this.B_){let h=this.getVROMid(t,e,i,n),o=0,m=a.default.GetByMid(h);if(null!=m)return m;e.testVertexAttribPointerOffset(this.CC);if(i){let i=a.default.Create(t,h,this.B_6.getUid());if(i.indicesRes=s,i.vao=t.createVertexArray(),t.bindVertexArray(i.vao),this.n<1)for(t.bindArrBuf(this.B_8[0]),o=0;o<l;++o)e.vertexAttribPointerTypeFloat(this.CB[o],this.CA,this.CC[o]);else for(o=0;o<l;++o)t.bindArrBuf(this.B_8[o]),e.vertexAttribPointerTypeFloat(this.CB[o],0,0);m=i,i.ibuf=s.getGpuBuf(),t.bindVertexArray(null)}else{let i=r.default.Create(t,h,this.B_6.getUid());for(i.indicesRes=s,i.shdp=e,i.attribTypes=[],i.wholeOffsetList=[],i.wholeStride=this.CA,this.n<1?i.vbuf=this.B_8[0]:i.vbufs=this.B_8,o=0;o<l;++o)e.testVertexAttribPointerType(this.CB[o])&&(i.attribTypes.push(this.CB[o]),i.wholeOffsetList.push(0));i.attribTypesLen=i.attribTypes.length,i.ibuf=s.getGpuBuf(),m=i}return this.CE.push(m),++this.CF,m}return null}destroy(t){if(this.B_8.length>0){this.n=-1;let e=0,i=null;for(;e<this.CF;++e)i=this.CE.pop(),i.restoreThis(),this.CE[e]=null;for(this.CF=0,e=0;e<this.B_;++e)t.deleteBuf(this.B_8[e]),this.B_8[e]=null;this.B_=0,this.B_8=[]}}}e.ROVertexRes=n},"46c6":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("18c7")),n=s(i("91e2")),l=s(i("ae33")),h=s(i("6773")),o=s(i("8ca9")),m=i("a52f");class _{constructor(t=null){this.BF=new r.default,this.CG=null,this.CH=null,this.CI=null,this.BI=null,this.BO=new h.default,this.CJ=0,this.materialBuilder=null,this.weap=null,this.campType=m.CampType.Blue,this.A_w=new r.default,this.BI=null==t?new l.default:t}getContainer(){return this.BI}setVisible(t){this.BI.setVisible(t)}getVisible(){return this.BI.getVisible()}setRotationY(t){this.BI.setRotationY(t)}getRotationY(){return this.BI.getRotationY()}initWeap01(t){let e,i=30;if(null==_.CK){_.CK=new n.default,e=this.materialBuilder.createMaterial(t),_.CK.setMaterial(e),_.CK.initializeSizeXYZ(60,30,60,[t]);let s=new a.default;s.identity(),s.setScaleXYZ(1,1.1,1),s.appendTranslationXYZ(0,.5*i*.1,0),_.CK.transformFaceAt(2,s),_.CK.reinitializeMesh()}let s=new n.default;e=this.materialBuilder.createMaterial(t),s.setMaterial(e),s.copyMeshFrom(_.CK),s.initializeSizeXYZ(60,i,60,[t]),s.setXYZ(0,75,0),this.CG=s,this.CJ=0}initWeap02(t){let e;if(null==_.CK){let i=1,s=new n.default;e=this.materialBuilder.createMaterial(t),s.setMaterial(e),s.initializeSizeXYZ(80,20,60,[t]),s.setXYZ(0,70,0),s.setScaleXYZ(i,i,i);let r=new a.default;r.identity(),r.setScaleXYZ(.7,1,.9),r.appendTranslationXYZ(-8,0,0),s.transformFaceAt(0,r),s.reinitializeMesh(),_.CK=s,s=new n.default,e=this.materialBuilder.createMaterial(t),s.setMaterial(e),s.initializeSizeXYZ(80,12,60,[t]),s.setXYZ(0,86,0),s.setScaleXYZ(i,i,i),r=new a.default,r.identity(),r.setScaleXYZ(.6,1,.8),r.appendTranslationXYZ(-20,0,0),s.transformFaceAt(1,r),s.reinitializeMesh(),_.CL=s}let i=new n.default;e=this.materialBuilder.createMaterial(t),i.setMaterial(e),i.copyMeshFrom(_.CK),i.copyTransformFrom(_.CK),i.initializeSizeXYZ(60,30,60,[t]),this.CG=i,i=new n.default,e=this.materialBuilder.createMaterial(t),i.setMaterial(e),i.copyMeshFrom(_.CL),i.copyTransformFrom(_.CL),i.initializeSizeXYZ(60,30,60,[t]),this.CH=i,this.CJ=1}initialize(t,e,i=null){if(null==this.CI){this.CI=e,e.addChild(this.BI),0==this.CJ?this.BI.addEntity(this.CG):1==this.CJ&&(this.BI.addEntity(this.CG),this.BI.addEntity(this.CH),this.BI.setScaleXYZ(1.5,1.3,1.7),this.BI.setXYZ(0,-50,0));let s=new r.default;null!=i&&s.addBy(i),this.BO.setPeriod(16),this.BO.setTriggerTimeAt(0,6),this.weap=new o.default(t)}}getPosition(t){this.BI.getPosition(t)}run(t,e,i){if(this.BO.run(),e<2){let e=this.BO.getTriggerIndex();e>-1&&(this.CI.getPosition(this.A_w),this.CG.getPosition(this.BF),this.A_w.y+=this.BF.y+10,this.weap.createAtt(0,this.A_w,i,t,this.campType))}}}_.CK=null,_.CL=null,e.default=_},"4a54":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("81ce")),n=s(i("f208")),l=i("c164");class h{constructor(t){this.CM="#version 300 es\n",this.CN="precision mediump float;\n",this.CO=[],this.CP=[],this.CQ=[],this.CR=[],this.CS=[],this.CT=[],this.CU=[],this.CV=[],this.CW=[],this.CX=[],this.CY=[],this.CZ=[],this.Ca=[],this.Cb=[],this.Cc=[],this.Cd=[],this.Ce=[],this.Cf=[],this.Cg=[],this.Ch=[],this.Ci="",this.Cj=[],this.Ck=!1,this.Cl=!1,this.Cm=!1,this.Cn=!1,this.Co=!1,this.Cp=!1,this.Cq="",this.Cr="",this.Cs="",this.Ct="",this.By="",this.B0=10,this.Cu=!1,this.Cv=null,this.fragHeadCodeUnlock=!0,this.fragMainCodeUnlock=!0,this.vertHeadCodeUnlock=!0,this.vertMainCodeUnlock=!0,this.autoBuildHeadCodeEnabled=!0,this.mathDefineEanbled=!0,this.normalEnabled=!1,this.normalMapEnabled=!1,this.mapLodEnabled=!1,this.derivatives=!1,this.vertMatrixInverseEnabled=!1,this.vtxUVTransfromEnabled=!1,this.fragMatrixInverseEnabled=!1;let e=this;e.uniform=t}getUniqueNSKeyID(){return this.uniform.getUniqueNSKeyID()}getUniqueNSKeyString(){let t=this.By;return this.vtxUVTransfromEnabled&&(t+="VtxUVT"),this.uniform.getUniqueNSKeyString()+t}reset(){this.Ck=!0,this.Cl=!0,this.Cm=!0,this.Cn=!1,this.Co=!1,this.Cp=!1,this.fragHeadCodeUnlock=!0,this.fragMainCodeUnlock=!0,this.vertHeadCodeUnlock=!0,this.vertMainCodeUnlock=!0,this.autoBuildHeadCodeEnabled=!0,this.Cu=!1,this.Cq="",this.Cr="",this.Cs="",this.Ct="",this.By="",this.CP=[],this.CO=[],this.CS=[],this.CT=[],this.CU=[],this.CV=[],this.CW=[],this.Cb=[],this.Cc=[],this.CX=[],this.CY=[],this.CZ=[],this.Ca=[],this.Cd=[],this.Ce=[],this.CQ=[],this.CR=[],this.Cf=[],this.Cg=[],this.Ch=[],this.Cj=[],this.Ci="",this.mathDefineEanbled=!0,this.normalEnabled=!1,this.normalMapEnabled=!1,this.mapLodEnabled=!1,this.vertMatrixInverseEnabled=!1,this.fragMatrixInverseEnabled=!1,this.vtxUVTransfromEnabled=!1,this.Cv=null,this.uniform.reset()}getPreCompileInfo(){let t=this.Cv;return this.Cv=null,t}useHighPrecious(){this.CN="precision highp float;"}useMediumPrecious(){this.CN="precision mediump float;"}useLowPrecious(){this.CN="precision lowp float;"}addDefine(t,e="1"){return!this.CQ.includes(t)&&(this.CQ.push(t),this.CR.push(e),!0)}addVertLayout(t,e){this.CS.includes(e)||(this.CS.push(e),this.CT.push(t))}addFragOutputHighp(t,e){this.CV.includes(e)||(this.CU.push("highp"),this.CV.push(e),this.CW.push(t))}addFragOutput(t,e){this.CV.includes(e)||(this.CU.push(""),this.CV.push(e),this.CW.push(t))}addVarying(t,e){this.Cb.includes(e)||(this.Cb.push(e),this.Cc.push(t))}addVertUniform(t,e,i=0){this.CX.includes(e)||(i>0?this.CX.push(e+"["+i+"]"):this.CX.push(e),this.CY.push(t))}addVertUniformParam(t){this.addVertUniform(t.type,t.name,t.arrayLength)}addFragUniform(t,e,i=0){this.CZ.includes(e)||(i>0?this.CZ.push(e+"["+i+"]"):this.CZ.push(e),this.Ca.push(t))}addFragUniformParam(t){this.addFragUniform(t.type,t.name,t.arrayLength)}addVertAndFragUniform(t,e,i=0){this.addVertUniform(t,e,i),this.addFragUniform(t,e,i)}addFragFunction(t){this.Cd.push(t)}addVertFunction(t){this.Ce.push(t)}useTexturePreciseHighp(){this.Ci="highp"}addTextureSample2D(t="",e=!0,i=!0,s=!1){if(""==t||!this.Ch.includes(t)){this.Cf.push("sampler2D"),this.Ch.push(t),this.Cg.push(this.Ci);let r=0;i&&(r|=2),s&&(r|=4),this.Cj.push(r),this.Ci="",e&&(this.Cu=!0)}}addTextureSampleCube(t="",e=!0,i=!1){if(""==t||!this.Ch.includes(t)){this.Cf.push("samplerCube"),this.Ch.push(t),this.Cg.push(this.Ci);let s=0;e&&(s|=2),i&&(s|=4),this.Cj.push(s),this.Ci=""}}addTextureSample3D(t="",e=!0,i=!1){if(""==t||!this.Ch.includes(t)){this.Cf.push("sampler3D"),this.Ch.push(t),this.Cg.push(this.Ci);let s=0;e&&(s|=2),i&&(s|=4),this.Cj.push(s),this.Ci=""}}isHaveTexture(){return this.Cf.length>0}isHaveTexture2D(){return this.Cu}useVertSpaceMats(t=!0,e=!0,i=!0){this.Ck=t,this.Cl=e,this.Cm=i}useFragSpaceMats(t=!0,e=!0,i=!0){this.Cn=t,this.Co=e,this.Cp=i}addVertExtend(t){this.CP.push(t)}addFragExtend(t){this.CO.push(t)}addVertHeadCode(t){""!=t&&(this.Cq+="\n"+t)}addVertMainCode(t){""!=t&&(this.Cr+="\n"+t)}addFragHeadCode(t){""!=t&&(this.Cs+="\n"+t)}addFragMainCode(t){""!=t&&(this.Ct+="\n"+t)}addShaderObject(t){this.fragHeadCodeUnlock&&this.addFragHeadCode(t.frag_head),this.fragMainCodeUnlock&&this.addFragMainCode(t.frag_body),this.vertHeadCodeUnlock&&this.addVertHeadCode(t.vert_head),this.vertMainCodeUnlock&&this.addVertMainCode(t.vert_body)}addShaderObjectHead(t){this.fragHeadCodeUnlock&&this.addFragHeadCode(t.frag_head),this.vertHeadCodeUnlock&&this.addVertMainCode(t.vert_head)}autoBuildHeadCode(){this.addVertLayout("vec3","a_vs"),(this.Cu||this.CS.includes("a_uvs"))&&(this.addVertLayout("vec2","a_uvs"),this.addVarying("vec2","v_uv")),(this.normalEnabled||this.normalMapEnabled||this.CS.includes("a_nvs"))&&(this.addVertLayout("vec3","a_nvs"),this.addVarying("vec3","v_worldNormal"),this.addVarying("vec3","v_worldPosition"),this.addDefine("VOX_USE_NORMAL"));let t=["a_vs","a_uvs","a_nvs"],e=[],i=[];for(;t.length>0;){let s=this.CS.indexOf(t[0]);s>=0&&(e.push(this.CS[s]),i.push(this.CT[s]),this.CS.splice(s,1),this.CT.splice(s,1)),t.shift()}this.CS=e.concat(this.CS),this.CT=i.concat(this.CT),this.vtxUVTransfromEnabled&&this.addDefine("VOX_VTX_TRANSFORM_PARAM_INDEX","0")}buildFragCode(){this.autoBuildHeadCodeEnabled&&this.autoBuildHeadCode(),this.CV.length<1&&this.addFragOutput("vec4","FragColor0");let t=0,e=0,i="";for((r.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED||r.default.IsMobileWeb())&&this.useHighPrecious(),r.default.IsWebGL2()&&(i+=this.CM),this.Cv=new n.default,this.Cv.info="\n//##COMPILE_INFO_BEGIN",this.Cv.info+="\n//##COMPILE_INFO_END",t=0,e=this.CO.length;t<e;t++)i+="\n"+this.CO[t];for(r.default.IsWebGL1()&&(this.CV.length>1&&(i+="\n#extension GL_EXT_draw_buffers: require"),(this.normalMapEnabled||this.derivatives)&&(i+="\n#extension GL_OES_standard_derivatives : enable"),this.mapLodEnabled&&(i+="\n#extension GL_EXT_shader_texture_lod : enable")),r.default.IsMobileWeb()?i+="\nprecision highp float;":i+="\n"+this.CN,r.default.IsWebGL2()?(i+="\n#define VOX_GLSL_ES3 1",i+="\n#define VOX_IN in",this.mapLodEnabled&&(i+="\n#define VOX_TextureCubeLod textureLod",i+="\n#define VOX_Texture2DLod textureLod"),i+="\n#define VOX_Texture2D texture",i+="\n#define VOX_TextureCube texture"):(i+="\n#define VOX_GLSL_ES2 1",i+="\n#define VOX_IN varying",this.mapLodEnabled&&(i+="\n#define VOX_TextureCubeLod textureCubeLodEXT",i+="\n#define VOX_Texture2DLod texture2DLodEXT"),i+="\n#define VOX_TextureCube textureCube",i+="\n#define VOX_Texture2D texture2D"),this.mathDefineEanbled&&(i+=l.MathShaderCode.BasePredefined),e=this.CQ.length,t=0;t<e;t++)""!=this.CR[t]?i+="\n#define "+this.CQ[t]+" "+this.CR[t]:i+="\n#define "+this.CQ[t]+" 1";for(t=0,e=this.Ch.length;t<e;t++)""!=this.Ch[t]&&0!=(2&this.Cj[t])&&(i+="\n#define "+this.Ch[t]+" u_sampler"+t);for(this.Cu&&(i+="\n#define VOX_USE_2D_MAP 1"),t=0,e=this.Cf.length;t<e;t++)0!=(2&this.Cj[t])&&(""==this.Cg[t]?i+="\nuniform "+this.Cf[t]+" u_sampler"+t+";":i+="\nuniform "+this.Cg[t]+" "+this.Cf[t]+" u_sampler"+t+";");for(t=0,e=this.Ca.length;t<e;t++)i+="\nuniform "+this.Ca[t]+" "+this.CZ[t]+";";if(this.Cn&&(i+="\nuniform mat4 u_objMat;"),this.Co&&(i+="\nuniform mat4 u_viewMat;"),this.Cp&&(i+="\nuniform mat4 u_projMat;"),e=this.Cb.length,r.default.IsWebGL2())for(t=0;t<e;t++)i+="\nin "+this.Cc[t]+" "+this.Cb[t]+";";else for(t=0;t<e;t++)i+="\nvarying "+this.Cc[t]+" "+this.Cb[t]+";";for(i+=l.ShaderCode.BasePredefined,this.fragMatrixInverseEnabled&&r.default.IsWebGL1()&&(this.addVertFunction(a.default.__glslInverseMat3),this.addVertFunction(a.default.__glslInverseMat4)),i+=this.Cs,t=0,e=this.Cd.length;t<e;t++)i+="\n"+this.Cd[t];if(t=0,e=this.CV.length,r.default.IsWebGL2())for(;t<e;t++)""!=this.CU[t]?i+="\nlayout(location = "+t+") out "+this.CU[t]+" "+this.CW[t]+" "+this.CV[t]+";":i+="\nlayout(location = "+t+") out "+this.CW[t]+" "+this.CV[t]+";";else 1==e&&(i+="\n#define "+this.CV[t]+" gl_FragColor");let s=!1,h=this.Ct.indexOf("{");if(h>0){let t=this.Ct.slice(0,h);s=t.indexOf(" main")>0,s||(s=this.Ct.indexOf(" main")>0)}if(s?i+=this.Ct:(i+="\nvoid main() {\n",i+=this.Ct,i+="\n}\n"),e=this.CV.length,r.default.IsWebGL1()&&e>1)for(t=0;t<e;t++){let e=new RegExp(this.CV[t],"g");i=i.replace(e,"gl_FragData["+t+"]")}return i}buildVertCode(){let t=0,e=0,i="";for(r.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED&&this.useHighPrecious(),r.default.IsWebGL2()&&(i+=this.CM),t=0,e=this.CP.length;t<e;t++)i+="\n"+this.CP[t];for(r.default.IsMobileWeb()?i+="\nprecision highp float;":i+="\n"+this.CN,r.default.IsWebGL2()?(i+="\n#define VOX_GLSL_ES3 1",i+="\n#define VOX_IN in",this.mapLodEnabled&&(i+="\n#define VOX_TextureCubeLod textureLod",i+="\n#define VOX_Texture2DLod textureLod"),i+="\n#define VOX_Texture2D texture",i+="\n#define VOX_TextureCube texture"):(i+="\n#define VOX_GLSL_ES2 1",i+="\n#define VOX_IN varying",this.mapLodEnabled&&(i+="\n#define VOX_TextureCubeLod textureCubeLodEXT",i+="\n#define VOX_Texture2DLod texture2DLodEXT"),i+="\n#define VOX_TextureCube textureCube",i+="\n#define VOX_Texture2D texture2D"),r.default.IsWebGL2()?i+="\n#define VOX_OUT out":i+="\n#define VOX_OUT varying",this.mathDefineEanbled&&(i+=l.MathShaderCode.BasePredefined),e=this.CQ.length,t=0;t<e;t++)""!=this.CR[t]?i+="\n#define "+this.CQ[t]+" "+this.CR[t]:i+="\n#define "+this.CQ[t];for(t=0,e=this.Ch.length;t<e;t++)""!=this.Ch[t]&&0!=(4&this.Cj[t])&&(i+="\n#define "+this.Ch[t]+" u_sampler"+t);for(this.Cu&&(i+="\n#define VOX_USE_2D_MAP 1"),t=0,e=this.Cf.length;t<e;t++)0!=(4&this.Cj[t])&&(""==this.Cg[t]?i+="\nuniform "+this.Cf[t]+" u_sampler"+t+";":i+="\nuniform "+this.Cg[t]+" "+this.Cf[t]+" u_sampler"+t+";");if(e=this.CS.length,r.default.IsWebGL2())for(t=0;t<e;t++)i+="\nlayout(location = "+t+") in "+this.CT[t]+" "+this.CS[t]+";";else for(t=0;t<e;t++)i+="\nattribute "+this.CT[t]+" "+this.CS[t]+";";for(e=this.CY.length,t=0;t<e;t++)i+="\nuniform "+this.CY[t]+" "+this.CX[t]+";";if(this.Ck&&(i+="\nuniform mat4 u_objMat;"),this.Cl&&(i+="\nuniform mat4 u_viewMat;"),this.Cm&&(i+="\nuniform mat4 u_projMat;"),e=this.Cb.length,r.default.IsWebGL2())for(t=0;t<e;t++)i+="\nout "+this.Cc[t]+" "+this.Cb[t]+";";else for(t=0;t<e;t++)i+="\nvarying "+this.Cc[t]+" "+this.Cb[t]+";";for(i+=l.ShaderCode.BasePredefined,this.vertMatrixInverseEnabled&&r.default.IsWebGL1()&&(this.addVertFunction(a.default.__glslInverseMat3),this.addVertFunction(a.default.__glslInverseMat4)),i+=this.Cq,t=0,e=this.Ce.length;t<e;t++)i+="\n"+this.Ce[t];let s=!1,n=this.Cr.indexOf("{");if(n>0){let t=this.Cr.slice(0,n);s=t.indexOf(" main")>0,s||(s=this.Cr.indexOf(" main")>0)}return s?i+=this.Cr:(i+="\nvoid main() {\n",i+=this.Cr,i+="\n}\n"),i}}e.default=h},"4abf":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("402a")),n=s(i("6940")),l=s(i("546c")),h=s(i("63ff")),o=i("ef2f");class m extends h.default{constructor(){super(),this.Cw=0,this.Cx=null,this.Cy=null,this.Cz=null,this.C0=null}initializeFrom(t){if(null!=t){this.campType=t.campType,this.lifeTime=t.lifeTime,this.attackDis=t.attackDis,this.radius=t.radius;let e=new a.default;e.copyMeshFrom(t.Cz),e.copyMaterialFrom(t.Cz);let i=new a.default;i.copyMeshFrom(t.C0),i.copyMaterialFrom(t.C0),this.initialize(t.getRendererScene(),t.Cw,e,i)}}initialize(t,e,i,s,a=100){if(null==this.A8&&null!=t){this.A8=t,this.Cz=i,this.C0=s,this.Cx=new n.default,this.Cy=new l.default;let h=new r.default(0,0,0);this.Cx.initialize(t,e,i,h),h.y=a,this.Cy.initialize(t,e,s,h),this.C1.setSpeed(this.C_y),this.C1.syncTargetUpdate=!1,this.C1.syncDirecUpdate=!1,this.C1.setTarget(this.Cx.getContainer()),this.C1.setVelocityFactor(.02,.03),this.C2=this.Cx,this.C3=this.Cy,this.C2.direcByDegree(0,!1);let m=this.Cx.getContainer();m.update();let _=m.getGlobalBounds();this.shadowEntity=new o.ShadowEntity;let u=this.shadowEntity;u.type=1,u.sizeScaleX=1,u.sizeScaleZ=1,u.srcEntity=m,u.bounds.copyFrom(_),u.initialize(),t.addEntity(u.entity,3)}}wake(){super.wake()}getHitPos(t){t.copyFrom(this.position),t.y+=50}getDestroyedPos(t){t.copyFrom(this.position),t.y+=30}consume(t){this.lifeTime-=t,this.lifeTime<1&&this.sleep()}attackTest(){return!0}}e.default=m},"4cf7":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("8d98");class r{constructor(){this.C4=[],this.C5=[],this.C6=[],this.C7=[]}addTexture(t){switch(t.getType()){case s.TextureProxyType.Image:this.C4.push(t);break;case s.TextureProxyType.Bytes:this.C5.push(t);break;case s.TextureProxyType.Float:this.C6.push(t);break;case s.TextureProxyType.Wrapper:this.C7.push(t);break;default:break}}getTexture(t){switch(t){case s.TextureProxyType.Image:if(this.C4.length>0)return this.C4.pop();break;case s.TextureProxyType.Bytes:if(this.C5.length>0)return this.C5.pop();break;case s.TextureProxyType.Float:if(this.C6.length>0)return this.C6.pop();break;case s.TextureProxyType.Wrapper:if(this.C7.length>0)return this.C7.pop();break;default:break}return null}}e.TexturePool=r,e.default=r},"4df3":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("b4ea");e.IShaderLibConfigure=r.IShaderLibConfigure,e.ShaderCodeType=r.ShaderCodeType,e.ShaderCodeUUID=r.ShaderCodeUUID,e.ShaderCodeConfigure=r.ShaderCodeConfigure,e.IShaderLibListener=r.IShaderLibListener,e.MaterialContext=r.MaterialContext,e.MaterialContextParam=r.MaterialContextParam;const a=s(i("b409")),n=s(i("cf91")),l=s(i("1ea6")),h=s(i("f63e")),o=i("debe"),m=i("3d98");class _ extends r.MaterialContext{constructor(){super(),this.C8=null,this.C9=null,this.lambertPipeline=null,this.pbrPipeline=null}createDefaultMaterial(t,e=!0){let i=new h.default;if(i.setMaterialPipeline(this.pipeline),i.setTextureList(t),e){let e=null!=t&&t.length>0&&null!=t[0];i.initializeByCodeBuf(e)}return i}createLambertLightMaterial(t=!1){let e=new a.default;return e.setMaterialPipeline(this.lambertPipeline),t&&(e.vertUniform=new o.VertUniformComp),e}createPBRLightMaterial(t=!0,e=!1,i=!1){let s=new n.default;if(s.setMaterialPipeline(this.pbrPipeline),t&&(s.decorator=new l.default),e&&(s.vertUniform=new o.VertUniformComp),null!=s.decorator&&i){if(s.decorator.hdrBrnEnabled=!0,null==this.C9){let t="static/bytes/spe.mdf";s.decorator.hdrBrnEnabled&&(t="static/bytes/spe.hdrBrn"),this.C8=new m.SpecularTextureLoader,this.C8.hdrBrnEnabled=s.decorator.hdrBrnEnabled,this.C8.loadTextureWithUrl(t,this.A8),this.C9=this.C8.texture,this.C9.__$attachThis()}s.decorator.specularEnvMap=this.C9}return s}initialize(t,e=null,i=null){null==this.A8&&(i=this.buildConfigure(e,i),super.initialize(t,e,i))}buildConfigure(t,e){if(null==e){let i=this.createShaderLibConfig(),s=null;null==t&&(t=new r.MaterialContextParam),t.loadAllShaderCode=!0,t.loadAllShaderCode&&(t.lambertMaterialEnabled&&(s=new r.ShaderCodeConfigure,s.buildBinaryFile=t.buildBinaryFile,s.uuid=r.ShaderCodeUUID.Lambert,s.types=[r.ShaderCodeType.VertHead,r.ShaderCodeType.VertBody,r.ShaderCodeType.FragHead,r.ShaderCodeType.FragBody],t.shaderCodeBinary&&(s.urls=["static/shader/glsl/lambert/glsl01.bin","static/shader/glsl/lambert/glsl02.bin","static/shader/glsl/lambert/glsl03.bin","static/shader/glsl/lambert/glsl04.bin"]),s.binary=t.shaderCodeBinary,i.shaderCodeConfigures.push(s)),t.pbrMaterialEnabled&&(s=new r.ShaderCodeConfigure,s.buildBinaryFile=t.buildBinaryFile,s.uuid=r.ShaderCodeUUID.PBR,s.types=[r.ShaderCodeType.VertHead,r.ShaderCodeType.VertBody,r.ShaderCodeType.FragHead,r.ShaderCodeType.FragBody],t.shaderCodeBinary&&(s.urls=["static/shader/glsl/pbr/glsl01.bin","static/shader/glsl/pbr/glsl02.bin","static/shader/glsl/pbr/glsl03.bin","static/shader/glsl/pbr/glsl04.bin"],s.binary=t.shaderCodeBinary),i.shaderCodeConfigures.push(s))),e=i}return e}initEnd(t){let e=this;null==this.pbrPipeline&&(e.pbrPipeline=this.createPipeline()),null==this.lambertPipeline&&(e.lambertPipeline=this.createPipeline()),this.pbrPipeline.uuid="pbr",this.lambertPipeline.uuid="lambert",super.initEnd(t)}}e.CommonMaterialContext=_},"4f27":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=i("d53d"),n=s(i("2560")),l=s(i("83d1")),h=s(i("a7ed")),o=s(i("857b")),m=s(i("e87b"));class _ extends a.ShaderUniform{use(t){}useByLocation(t,e,i,s){}useByShd(t,e){}updateData(){}destroy(){}}_.EmptyUniform=new _;class u{static appendUniformBuilder(t){u.H_l.has(t.getIDNS())||(u.H_m.push(t),u.H_l.set(t.getIDNS(),t),u.H_n=u.H_m.length)}static Initialize(){u.H_I&&(u.H_I=!1,u.appendUniformBuilder(new n.default),u.appendUniformBuilder(new h.default),u.appendUniformBuilder(new o.default),u.appendUniformBuilder(new l.default),u.appendUniformBuilder(new m.default))}static AddSharedUniformBuilder(t){null==t||u.H_l.has(t.getIDNS())||(u.H_m.push(t),u.H_l.set(t.getIDNS(),t),++u.H_n)}static removeSharedUniformBuilder(t){if(null!=t&&u.H_l.has(t.getIDNS())){for(let e=0;e<u.H_n;++e)if(t==u.H_m[e]){u.H_m.splice(e,1),--u.H_n;break}u.H_l.delete(t.getIDNS())}}static removeSharedUniformBuilderByName(t){if(u.H_l.has(t)){let e=u.H_l.get(t);for(let t=0;t<u.H_n;++t)if(e==u.H_m[t]){u.H_m.splice(t,1),--u.H_n;break}u.H_l.delete(t)}}static BuildShared(t,e,i){let s,r=null,a=null,n=u.H_m,l=0,h=u.H_n,o=null;for(;l<h;++l)o=n[l].create(e,i),null!=o&&(null!=a?a.next=o:null==r&&(r=o),a=o);if(null==t)s=r;else if(null!=r){for(let e=0;e<t.length;++e)a.next=t[e],a=a.next;s=r}if(null==s)s=_.EmptyUniform;else{let t=s,e=0;while(null!=t){if(null!=t.uniformNameList&&null==t.locations)for(t.types=[],t.locations=[],t.uniformSize=t.uniformNameList.length,e=0;e<t.uniformSize;++e)t.types.push(i.getUniformTypeByNS(t.uniformNameList[e])),t.locations.push(i.getUniformLocationByNS(t.uniformNameList[e]));t=t.next}}return s}static BuildLocalFromTransformV(t,e){if(null!=t){let i;return i=new a.ShaderMat4Uniform,i.uniformSize=0,i.uniformNameList=[],i.types=[],i.locations=[],i.dataList=[],i.dataSizeList=[],i.uniformSize+=1,i.uniformNameList.push("u_objMat"),i.types.push(e.getUniformTypeByNS("u_objMat")),i.locations.push(e.getUniformLocationByNS("u_objMat")),i.dataList.push(t),i.dataSizeList.push(1),i}return u.H_o}static UpdateLocalFromTransformV(t,e,i){if(null!=e){let s,r=t;return null==r?(r=new a.ShaderMat4Uniform,s=r,s.uniformSize=0,s.uniformNameList=[],s.types=[],s.locations=[],s.dataList=[],s.dataSizeList=[],s.uniformSize+=1,s.uniformNameList.push("u_objMat"),s.types.push(i.getUniformTypeByNS("u_objMat")),s.locations.push(i.getUniformLocationByNS("u_objMat")),s.dataList.push(e),s.dataSizeList.push(1)):(s=r,s.locations=[],s.locations.push(i.getUniformLocationByNS("u_objMat"))),s}return u.H_o}static BuildLocalFromData(t,e){if(null!=t){let i;i=r.default.IsWebGL1()?new a.ShaderUniformV1:new a.ShaderUniformV2,i.uns=t.uns,i.uniformNameList=[],i.types=[],i.locations=[],i.dataList=[],i.dataSizeList=[],i.uniformSize=0;let s=t,n=0;while(null!=s){if(null!=s.uniformNameList&&null==s.locations)for(i.uniformSize+=s.uniformNameList.length,n=0;n<i.uniformSize;++n)i.uniformNameList.push(s.uniformNameList[n]),i.types.push(e.getUniformTypeByNS(s.uniformNameList[n])),i.locations.push(e.getUniformLocationByNS(s.uniformNameList[n])),i.dataList.push(s.dataList[n]),i.dataSizeList.push(e.getUniformLengthByNS(s.uniformNameList[n]));s=s.next}return i}return _.EmptyUniform}static BuildLocal(t,e){let i=new a.ShaderUniform;i.uniformNameList=[],i.types=[],i.locations=[],i.dataList=[],i.dataSizeList=[],i.uniformSize=0;let s=t,r=0;while(null!=s){if(null!=s.uniformNameList&&null==s.locations)for(i.uniformSize+=s.uniformNameList.length,r=0;r<i.uniformSize;++r)i.uniformNameList.push(s.uniformNameList[r]),i.types.push(e.getUniformTypeByNS(s.uniformNameList[r])),i.locations.push(e.getUniformLocationByNS(s.uniformNameList[r])),i.dataList.push(s.dataList[r]),i.dataSizeList.push(e.getUniformLengthByNS(s.uniformNameList[r]));s=s.next}return i}}u.H_I=!0,u.H_l=new Map,u.H_m=[],u.H_n=0,u.H_o=new a.ShaderUniform,e.default=u},"519e":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8a0a")),a=s(i("cb29")),n=s(i("e7d2")),l=s(i("fecb")),h=s(i("35fa"));class o extends a.default{constructor(t=r.default.VTX_STATIC_DRAW){super(t),this.C_A=null,this.C_B=!0,this.B_K=null,this.B_L=null,this.B_M=null,this.B_N=null,this.C_C=null,this.C_D=null,this.C_E=-2,this.vsStride=3,this.uvsStride=2,this.nvsStride=3,this.cvsStride=3}setVS(t){this.B_K=t,this.C_B=!0}getVS(){return this.B_K}setUVS(t){this.B_L=t}getUVS(){return this.B_L}setNVS(t){this.B_M=t}getNVS(){return this.B_M}setTVS(t){this.C_C=t}getTVS(){return this.C_C}setBTVS(t){this.C_D=t}setCVS(t){this.B_N=t}getBTVS(){return this.C_D}setIVS(t){this.C_A=t,this.B_O=t,this.C_B=!0}initializeFromGeometry(t){this.B_K=t.getVS(),this.B_L=t.getUVS(),this.B_M=t.getNVS(),this.C_C=t.getTVS(),this.C_D=t.getBTVS(),this.B_N=t.getCVS(),this.B_O=t.getIVS(),this.C_A=this.B_O,this.C_B=!0,this.initialize()}initialize(){null!=this.B_K&&(null==this.bounds?(this.bounds=new l.default,this.bounds.addXYZFloat32Arr(this.B_K),this.bounds.update(),this.C_E=this.bounds.version):(this.C_B||this.C_E==this.bounds.version)&&(this.bounds.reset(),this.bounds.addXYZFloat32Arr(this.B_K),this.bounds.update(),this.C_E=this.bounds.version),this.C_B=!1,this.B_O=this.C_A,n.default.Reset(),n.default.AddFloat32Data(this.B_K,this.vsStride),this.isVBufEnabledAt(r.default.VBUF_UVS_INDEX)&&n.default.AddFloat32Data(this.B_L,this.uvsStride),this.isVBufEnabledAt(r.default.VBUF_NVS_INDEX)&&(null==this.B_M&&(this.vtCount=this.B_O.length,this.trisNumber=this.vtCount/3,this.B_M=new Float32Array(this.B_K.length),h.default.ClacTrisNormal(this.B_K,this.B_K.length,this.trisNumber,this.B_O,this.B_M)),n.default.AddFloat32Data(this.B_M,this.nvsStride)),this.isVBufEnabledAt(r.default.VBUF_CVS_INDEX)&&n.default.AddFloat32Data(this.B_N,this.cvsStride),this.isVBufEnabledAt(r.default.VBUF_TVS_INDEX)&&(n.default.AddFloat32Data(this.C_C,3),n.default.AddFloat32Data(this.C_D,3)),n.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.updateWireframeIvs(),this.vtCount=this.B_O.length,null!=this.B_Q?n.default.UpdateBufData(this.B_Q):this.B_Q=n.default.CreateBySaveData(this.getBufDataUsage(),this.getBufSortFormat()),this.B_Q.setUintIVSData(this.B_O),this.trisNumber=this.vtCount/3,this.buildEnd())}testRay(t,e,i,s){return-1}toString(){return"[DataMesh()]"}__$destroy(){this.isResFree()&&(this.bounds=null,this.B_K=null,this.B_L=null,this.B_M=null,this.B_N=null,this.C_C=null,this.C_D=null,this.C_A=null,super.__$destroy())}}e.default=o},5216:function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["ENV_LIGHT_PARAM"]=0]="ENV_LIGHT_PARAM",t[t["ENV_AMBIENT_LIGHT"]=1]="ENV_AMBIENT_LIGHT",t[t["FOG"]=2]="FOG",t[t["FOG_EXP2"]=3]="FOG_EXP2",t[t["VSM_SHADOW"]=4]="VSM_SHADOW",t[t["GLOBAL_LIGHT"]=5]="GLOBAL_LIGHT"}(s||(s={})),e.MaterialPipeType=s},5282:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t=0,e=0,i=0,s=0){this.x=0,this.y=0,this.z=0,this.u=0,this.v=1,this.nx=0,this.ny=0,this.nz=0,this.index=0,this.x=t,this.y=e,this.z=i,this.index=s}cloneVertex(){let t=new s(this.x,this.y,this.z,this.index);return t.nx=this.nx,t.ny=this.ny,t.nz=this.nz,t.u=this.u,t.v=this.v,t}copyFrom(t){this.x=t.x,this.y=t.y,this.z=t.z,this.u=t.u,this.v=t.v,this.nx=t.nx,this.ny=t.ny,this.nz=t.nz,this.index=t.index}}e.default=s},"52c9":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17"));class a{constructor(){this.disA=0,this.disB=0,this.length=0,this.tv=new r.default(1,0,0),this.pos=new r.default}}e.TrackSeg=a;class n{constructor(){this._index=0,this._pathDis=0,this._posDisList=[],this._segs=[],this._endSeg=null,this.__tempV=new r.default}addXYZ(t,e,i){let s=new a;s.pos.setTo(t,e,i);let r=this._segs.length;if(r>0){let t=this._segs[r-1];t.tv.x=s.pos.x-t.pos.x,t.tv.y=s.pos.y-t.pos.y,t.tv.z=s.pos.z-t.pos.z,t.length=t.tv.getLength(),t.tv.normalize(),this._pathDis+=t.length,t.disB=this._pathDis,s.disA=this._pathDis,this._posDisList.push(this._pathDis)}else s.disA=0,this._posDisList.push(0);this._segs.push(s),this._endSeg=s}getPathDistance(){return this._pathDis}getStepsTotal(t){return Math.ceil(this._pathDis/t)}etPosAt(t,e){e>=0&&e<this._segs.length&&t.copyFrom(this._segs[e].pos)}getCurrPosIndex(){return this._index}getDisProgrssInSeg(t){if(this._index<this._posDisList.length){let e=t-this._posDisList[this._index];if(e>=0){let t=this._segs[this._index].length;return t>.001?e/t:0}}return 0}getPosTotal(){return this._segs.length}etSqrtDistancePosEnd(t,e,i){return null!=this._endSeg?(this.__tempV.x=t-this._endSeg.pos.x,this.__tempV.y=e-this._endSeg.pos.y,this.__tempV.z=i-this._endSeg.pos.z,this.__tempV.getLengthSquared()):-1}clear(){this._segs.length=0,this._posDisList.length=0,this._pathDis=0,this._index=0,this._endSeg=null}toBegin(){this._index=0}calcPosByDis(t,e,i=!0){let s=this._segs.length;if(s>0){if(e>=this._pathDis)return this._index=s-1,t.copyFrom(this._segs[this._index].pos),n.TRACK_END;if(e<=this._segs[0].disA)return t.copyFrom(this._segs[0].pos),this._index=0,n.TRACK_BEGIN;{i?(this._index=0,this.binQueryCloseLess(e,-1,s,this._posDisList,0,s-1)):this.binQueryCloseLess(e,this._index-1,s,this._posDisList,0,s-1);let r=this._segs[this._index];return e-=r.disA,t.x=r.pos.x+r.tv.x*e,t.y=r.pos.y+r.tv.y*e,t.z=r.pos.z+r.tv.z*e,n.TRACK_AMONG}}return this._index=-1,n.TRACK_ERROR}calcNextPosByDis(t,e,i=!1){let s=this._segs.length;if(s>0){if(e>=this._pathDis)return this._index=s-1,t.copyFrom(this._segs[this._index].pos),n.TRACK_END;if(e<=this._segs[0].disA)return t.copyFrom(this._segs[0].pos),this._index=0,n.TRACK_BEGIN;{let r=null;return i?(this._index=0,this.binQueryCloseLess(e,-1,s,this._posDisList,0,s-1)):(r=this._segs[this._index],r.disA>e?(this._index=0,this.binQueryCloseLess(e,-1,s,this._posDisList,0,s-1),r=this._segs[this._index]):(r.disB<e&&(r=this._segs[this._index+1],r.disB<e&&(r=null)),null==r&&(this.binQueryCloseLess(e,this._index-1,s,this._posDisList,0,s-1),r=this._segs[this._index]))),e-=r.disA,t.x=r.pos.x+r.tv.x*e,t.y=r.pos.y+r.tv.y*e,t.z=r.pos.z+r.tv.z*e,n.TRACK_AMONG}}return this._index=-1,n.TRACK_ERROR}binQueryCloseLess(t,e,i,s,r,a){let n=Math.round(.5*(e+i));s[n]<t?n+1<=a&&s[n+1]<t&&i-n>1?this.binQueryCloseLess(t,n,i,s,r,a):this._index=n:s[n]>t&&n-1>=r?s[n-1]>t?n-e>1?this.binQueryCloseLess(t,e,n,s,r,a):this._index=n:(n-=1,this._index=n):this._index=n}}n.TRACK_INIT=-100,n.TRACK_ERROR=-1,n.TRACK_BEGIN=0,n.TRACK_AMONG=1,n.TRACK_END=2,e.PathTrack=n,e.default=n},"52e0":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("8d98"),a=s(i("0851"));class n extends a.default{constructor(t,e){super(t,e,!1),this.C_F=null,this.k=r.TextureTarget.TEXTURE_CUBE,this.mipmapEnabled=!0,this.n=r.TextureProxyType.BytesCube}toAlphaFormat(){this.srcFormat=r.TextureFormat.ALPHA,this.internalFormat=r.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=r.TextureFormat.RED,this.internalFormat=r.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB,this.unpackAlignment=1}toRGBAFormat(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4}setDataFromBytesToFaceAt(t,e,i,s,r=0){if(null==this.C_F&&(this.C_F=[null,null,null,null,null,null]),i>0&&s>0){0==t&&r<1&&(this.g=i,this.h=s,this.f=r),null==this.C_F[t]&&(this.C_F[t]=new Array(16));let a=this.C_F[t];a[r]={width:i,height:s,imgData:e,miplevel:r},this.m=null!=a[r].imgData}}uploadData(t){let e,i,s=t.getRC(),a=null,n=this.getWidth(),l=this.getHeight();for(let h=0;h<6;++h){let t=this.C_F[h];if(this.mipmapEnabled&&this.o)a=t[0],s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,r.TextureFormat.ToGL(s,this.internalFormat),n,l,0,r.TextureFormat.ToGL(s,this.srcFormat),r.TextureDataType.ToGL(s,this.dataType),a.imgData);else{e=n,i=l;let o=0;for(;e>0||i>0;)null!=t[o]&&(a=t[o],s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+h,o,r.TextureFormat.ToGL(s,this.internalFormat),e,i,0,r.TextureFormat.ToGL(s,this.srcFormat),r.TextureDataType.ToGL(s,this.dataType),a.imgData)),e>0&&(e>>=1),i>0&&(i>>=1),++o}}this.version=0}toString(){return"[BytesCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.C_F)for(let t=0;t<6;++t)null!=this.C_F[t]&&(this.C_F[t].imgData=null);super.__$destroy()}}}e.default=n},5326:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){this.C_G=256,this.T=0,this.index=0,this.dataList=[],this.flagList=null,this.T=t}getUid(){return this.T}static GetSlotAt(t){return s.H_p[t]}static Initialize(t){let e=s.H_p[t];if(null==e&&(e=new s(t),s.H_p[t]=e),null==e.flagList){e.flagList=new Uint16Array(e.C_G);for(let t=0;t<e.C_G;++t)e.dataList.push(null),e.flagList[t]=0}}}s.H_p=new Array(16),e.default=s},5336:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.C_H=0,this.C_I=60,this.C_J=null,this.C_K=null,this.C_L=10,this.C_M=128,this.C_N=128,this.C_O=70,this.delayTime=40,this.statusInfo="",this.statusEnbled=!0}initialize(){var t=null;try{void 0!=document&&(t=document)}catch(e){}if(null!=t){this.C_M=window.innerWidth;let t=this.C_M-20;this.createCanvas(t)}}createCanvas(t){null==this.C_J&&(this.C_J=document.createElement("canvas"),document.body.appendChild(this.C_J),this.C_J.style.display="bolck",this.C_J.style.left="0px",this.C_J.style.top="0px",this.C_J.style.position="absolute",this.C_J.style.backgroundColor="transparent",this.C_J.style.pointerEvents="none",this.C_J.height=this.C_O),t=t<10?10:t,this.C_J.width=t,this.C_K=this.C_J.getContext("2d"),this.C_K.font="50px Verdana",this.C_K.fillStyle="red",this.C_K.textAlign="left",this.C_N=this.C_J.width}getFPS(){return this.C_I}getFPSStr(){return this.C_I>60?"FPS: 60":this.C_I<10?"FPS: 0"+this.C_I:"FPS: "+this.C_I}render(){if(this.C_M!=window.innerWidth){this.C_M=window.innerWidth;let t=this.C_M-20;this.createCanvas(t)}this.statusEnbled&&(this.C_K.clearRect(0,0,this.C_N,this.C_O),this.C_K.fillText("FPS:"+this.C_I+this.statusInfo,5,50))}update(t=!0){if(this.C_L>0)--this.C_L,this.C_H=Date.now();else{if(null!=this.C_K){let e=Date.now();this.C_H>0&&(this.C_H=e-this.C_H,this.C_I=Math.round(1e3/this.C_H),t&&this.render()),this.C_H=e}this.C_L=this.delayTime}}}e.default=s},"53ea":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("e214"));class n{constructor(){this.A_=null,this.K_=null,this.C_P=new r.default,this.C_Q=new r.default,this.C_R=new r.default(0,1,0),this.C_S=0,this.position=new r.default}bindCameraAndStage(t,e){this.A_=t,this.K_=e}setPlaneParam(t,e){this.C_R.copyFrom(t),this.C_R.normalize(),this.C_S=e}intersectPlane(){null!=this.A_&&null!=this.K_&&(this.A_.update(),this.A_.getWorldPickingRayByScreenXY(this.K_.mouseX,this.K_.mouseY,this.C_P,this.C_Q),a.default.IntersectionSLV2(this.C_R,this.C_S,this.C_P,this.C_Q,this.position))}destroy(){this.A_=null,this.K_=null}}e.default=n},"546c":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("ae33")),n=s(i("54de")),l=i("a52f");class h{constructor(t=null){this.At=null,this.BD=0,this.BE=new r.default,this.BF=new r.default,this.BG=new r.default,this.BI=null,this.degreeTween=new n.default,this.campType=l.CampType.Blue,this.BP=null,this.BQ=0,this.BI=null==t?new a.default:t}getContainer(){return this.BI}setVisible(t){this.BI.setVisible(t)}getVisible(){return this.BI.getVisible()}setRotationY(t){this.BI.setRotationY(t)}getRotationY(){return this.BI.getRotationY()}initialize(t,e,i,s=null){if(null==this.At){this.At=t,t.addContainer(this.BI,e),this.BI.addEntity(i);let a=new r.default;null!=s&&a.addBy(s),this.degreeTween.bindTarget(this.BI)}}setXYZ(t,e,i){this.BI.setXYZ(t,e,i)}setPosition(t){this.BI.setPosition(t)}getPosition(t){this.BI.getPosition(t)}isAttackLock(){return this.degreeTween.testDegreeDis(2)}direcByDegree(t,e){this.degreeTween.runRotY(t),this.degreeTween.isDegreeChanged()&&this.BI.update()}direcByPos(t,e){this.degreeTween.runRotYByDstPos(t),this.degreeTween.isDegreeChanged()&&this.BI.update()}setDstDirecDegree(t){this.BQ=t}setAttackDst(t){this.BP=t,null!=t&&this.BP.getHitPos(this.BE)}setAttPos(t){this.BE.copyFrom(t)}setAttPosXYZ(t,e,i){this.BE.setXYZ(t,e,i)}getAttPos(){return this.BE}updateAttackPose(){this.direcByPos(this.BE,!1)}resetPose(){}resetNextOriginPose(){}run(t){let e=null!=this.BP;e?this.updateAttackPose():this.direcByDegree(this.BQ,!1),this.BI.update()}update(){this.BI.update()}isResetFinish(){return!0}isPoseRunning(){return!0}runToReset(){}}e.default=h},"54de":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("8e17"));class n{constructor(){this.C_T=null,this.C_U=!0,this.C_V=0,this.C_W=0,this.C_X=new a.default,this.syncDegreeUpdate=!0}bindTarget(t){this.C_T=t}isDegreeChanged(){return this.C_U}testDegreeDis(t){return this.C_W<t}isEnd(){return this.C_W<1}isRunning(){return this.C_W>=1}getDegreeDis(){return this.C_W}getDegree(){return this.C_V}runRotYByDstPos(t){if(null!=this.C_T){this.C_T.getPosition(this.C_X);let e=180+r.default.GetDegreeByXY(this.C_X.x-t.x,t.z-this.C_X.z);this.runRotY(e)}}runRotY(t){if(null!=this.C_T){this.C_T.getRotationXYZ(this.C_X);let e=r.default.GetMinDegree(t,this.C_X.y);this.C_W=Math.abs(e);let i=2;this.C_W>=i&&(e<0?(e=.2*this.C_W,e=e>i?e:i,t=this.C_X.y+e):(e=.2*this.C_W,e=e>i?e:i,t=this.C_X.y-e)),this.C_U=Math.abs(this.C_V-t)>r.default.MATH_MIN_POSITIVE,this.C_U&&(this.C_V=t,this.syncDegreeUpdate&&this.C_T.setRotationXYZ(0,t,0))}}destroy(){this.C_T=null}}e.default=n},"557f":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("8d98"),a=s(i("0851"));class n extends a.default{constructor(t,e,i=1,s=!1){super(t,e,s),this.C_Y=null,this.C_Z=1,this.internalFormat=r.TextureFormat.R8,this.srcFormat=r.TextureFormat.RED,this.C_Z=i,this.k=r.TextureTarget.TEXTURE_3D,this.n=r.TextureProxyType.Texture3D,this.unpackAlignment=1}getDepth(){return this.C_Z}uploadFromTypedArray(t,e=0){this.isGpuEnabled()||(this.C_Y=t,this.f=e,this.m=!0)}uploadData(t){if(null!=this.C_Y){let e=t.getRC();e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage3D(e.TEXTURE_3D,0,r.TextureFormat.ToGL(e,this.internalFormat),this.g,this.h,this.C_Z,0,r.TextureFormat.ToGL(e,this.srcFormat),e.UNSIGNED_BYTE,this.C_Y),e.pixelStorei(e.UNPACK_ALIGNMENT,4)}}__$destroy(){this.getAttachCount()<1&&(this.C_Y=null,super.__$destroy())}toString(){return"[Texture3DProxy(width="+this.getWidth()+",height="+this.getHeight()+",depth="+this.getDepth()+")]"}}e.default=n},5639:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("cc9c")),n=s(i("2a24")),l=s(i("96af")),h=s(i("63ff")),o=i("ef2f");class m extends h.default{constructor(){super(),this.Cx=null,this.Cy=null}initialize(t,e,i,s,h=100){if(null!=t&&null!=i&&null!=s){this.Cx=new a.default,this.Cy=new n.default;let m=new r.default(0,0,0);this.Cx.initialize(t,e,i,m),this.Cx.toPositive(),m.y=h,this.Cy.campType=this.campType,this.Cy.initialize(t,e,s,m),this.Cy.toNegative(),this.Cy.setAngleDirec(1,-1),this.C1.setSpeed(this.C_y),this.C1.syncTargetUpdate=!1,this.C1.syncDirecUpdate=!1,this.C1.setTarget(this.Cx.getContainer()),this.C1.setVelocityFactor(.02,.03);let _=new l.default;_.dstCamp=this.roleCamp,_.srcRole=this,_.campType=this.campType,this.C_a=_,this.C2=this.Cx,this.C3=this.Cy,this.C2.direcByDegree(0,!1);let u=this.Cx.getContainer();u.update();let d=u.getGlobalBounds();this.shadowEntity=new o.ShadowEntity;let c=this.shadowEntity;c.sizeScaleX=.35,c.sizeScaleZ=.5,c.srcEntity=u,c.bounds.copyFrom(d),c.initialize(),t.addEntity(c.entity,3)}}wake(){this.C_w||(this.Cx.toPositive(),this.Cy.toNegative()),super.wake()}getHitPos(t){t.copyFrom(this.position),t.y+=100}getDestroyedPos(t){t.copyFrom(this.position),t.y+=60}consume(t){this.lifeTime-=t,this.lifeTime<1&&this.sleep()}attackTest(){return!0}}e.default=m},"56c5":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("030e"));class a{static SetRenderer(t){a.A7=t.getRC(),a.C_b=t.getWebGLVersion();let e=a;1==a.C_b&&null!=r.default.WEBGL_draw_buffers?e.COLOR_ATTACHMENT0=r.default.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL:e.COLOR_ATTACHMENT0=a.A7.COLOR_ATTACHMENT0}static DrawBuffers(t){2==a.C_b?a.A7.drawBuffers(t):null!=r.default.WEBGL_draw_buffers&&r.default.WEBGL_draw_buffers.drawBuffersWEBGL(t)}}a.A7=null,a.C_b=2,a.COLOR_ATTACHMENT0=0,e.default=a},"577c":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){if(this.dataList=[],null!=s.H5)throw Error("Error!");s.H5=this}static GetInstance(){return null!=s.H5?s.H5:new s}addTriggerData(t){0==t.status&&(t.status=1,this.dataList.push(t))}}s.H5=null,e.default=s},"58c1":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("2d2e")),a=s(i("5639"));class n{constructor(){this.C_c=null,this.C_d=null,this.A8=null,this.C_e=null,this.Cw=0}setMaterialBuilder(t){this.C_e=t}initialize(t,e,i,s){this.A8=t,this.Cw=e,this.C_c=i,this.C_d=s}create(t,e,i,s,n){let l=new r.default;l.materialBuilder=this.C_e,l.setSgSize(10,15),l.initilize(t,i,e);let h=new r.default;h.materialBuilder=this.C_e,h.setParam(100,-40,-30),h.setBgSize(10,8),h.setSgSize(7,5),h.initilize(t,i,e);let o=new a.default;return o.roleCamp=this.C_c,o.terrainData=this.C_d,o.radius=2*n+15,o.campType=s,o.initialize(this.A8,this.Cw,l,h,n),o}}e.default=n},"59df":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.fogEnabled=!1,this.envAmbientLightEnabled=!1}initialize(t){null==this.B_a&&(this.B_a=t)}createTrackLambertMaterial(t,e,i=null,s=null){let r=t.animator.getPosDataTexture(),a=t.animator.getPosTotal(),n=this.B_a.createLambertLightMaterial(!0);n.fogEnabled=this.fogEnabled,n.envAmbientLightEnabled=this.envAmbientLightEnabled,n.diffuseMap=e,n.normalMap=null!=i?i:this.B_a.getTextureByUrl("static/assets/rock_a_n.jpg"),n.aoMap=null!=s?s:this.B_a.getTextureByUrl("static/assets/rock_a.jpg");let l=n.vertUniform;return l.uvTransformEnabled=!0,n.vertUniform=l,l.curveMoveMap=r,n.initializeByCodeBuf(!0),n.setBlendFactor(.6,.7),l.setCurveMoveParam(r.getWidth(),a),l.setCurveMoveDistance(0),l.setUVScale(2,1),n}createLambertMaterial(t,e=null,i=null){let s=this.B_a.createLambertLightMaterial(!1);return s.fogEnabled=this.fogEnabled,s.envAmbientLightEnabled=this.envAmbientLightEnabled,s.diffuseMap=t,s.normalMap=null!=e?e:this.B_a.getTextureByUrl("static/assets/rock_a_n.jpg"),s.aoMap=null!=i?i:this.B_a.getTextureByUrl("static/assets/rock_a.jpg"),s.initializeByCodeBuf(!0),s.setBlendFactor(.6,.7),s}createBaseLambertMaterial(t,e=null,i=null,s=!1){let r=this.B_a.createLambertLightMaterial(!1);return r.fogEnabled=this.fogEnabled,r.envAmbientLightEnabled=s,r.diffuseMap=t,r.normalMap=e,r.aoMap=i,r.initializeByCodeBuf(!0),r.setBlendFactor(.6,.7),r}createMaterial(t,e=null,i=null){return this.createLambertMaterial(t,e,i)}}e.RoleMaterialBuilder=s},"5d04":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("8d98"),a=s(i("4cf7")),n=s(i("5e78")),l=s(i("fe7f")),h=s(i("9f3e")),o=s(i("f928")),m=s(i("eaee")),_=s(i("52e0")),u=s(i("d314")),d=s(i("557f")),c=s(i("cfaf")),f=s(i("85b6")),p=s(i("da6a")),g=s(i("ccdf"));class v{constructor(){this.C_f=new a.default,this.C_g=null,this.w_=null,this.C_h=[],this.C_i=128}addTexLoader(t){if(null!=t){let e=0,i=this.C_h.length;for(;e<i;++e)if(t==this.C_h[e])break;e>=i&&this.C_h.push(t)}}removeTexLoader(t){if(null!=t){let e=0,i=this.C_h.length;for(;e<i;++e)if(t==this.C_h[e]){this.C_h.slice(e,1);break}}}setRenderer(t){this.w_=t,p.default.GetInstance().setRenderProxy(t.getRenderProxy()),null==this.C_g&&null!=t&&(this.C_g=new g.default(t.getRenderProxy()))}getRTTStrore(){return this.C_g}createWrapperTex(t,e,i=!1){let s=new f.default(t,e,i);return s.__$setRenderProxy(this.w_.getRenderProxy()),s}createRTTTex2D(t,e,i=!1){let s=new c.default(t,e,i);return s.__$setRenderProxy(this.w_.getRenderProxy()),s}createImageTex2D(t,e,i=!1){let s=this.C_f.getTexture(r.TextureProxyType.Image);return null==s&&(s=new n.default(t,e,i)),s.__$setRenderProxy(this.w_.getRenderProxy()),s.mipmapEnabled=!0,s.setWrap(r.TextureConst.WRAP_REPEAT),s}createHalfFloatTex2D(t,e,i=!1){let s=this.C_f.getTexture(r.TextureProxyType.Float);return null==s&&(s=new o.default(t,e,i)),s.__$setRenderProxy(this.w_.getRenderProxy()),s.srcFormat=r.TextureFormat.RGBA,s.dataType=r.TextureDataType.HALF_FLOAT_OES,s}createFloatTex2D(t,e,i=!1){let s=this.C_f.getTexture(r.TextureProxyType.Float);return null==s&&(s=new o.default(t,e,i)),s.__$setRenderProxy(this.w_.getRenderProxy()),s}createUint16Tex2D(t,e,i=!1){return new h.default(t,e,i)}createFloatCubeTex(t,e,i=!1){return new m.default(t,e)}createBytesTex(t,e){let i=this.C_f.getTexture(r.TextureProxyType.Bytes);return null==i&&(i=new l.default(t,e)),i.__$setRenderProxy(this.w_.getRenderProxy()),i}createBytesCubeTex(t,e){let i=new _.default(t,e);return i.__$setRenderProxy(this.w_.getRenderProxy()),i}createImageCubeTex(t,e){let i=new u.default(t,e);return i.__$setRenderProxy(this.w_.getRenderProxy()),i}createTex3D(t,e,i=1){i<1&&(i=1);let s=new d.default(t,e,i);return s.__$setRenderProxy(this.w_.getRenderProxy()),s}createRGBATex2D(t,e,i){t=t>1?t:1,e=e>1?e:1;let s=t*e,r=this.createBytesTex(t,e),a=new Uint8Array(4*s),n=Math.round(255*i.r),l=Math.round(255*i.g),h=Math.round(255*i.b),o=Math.round(255*i.a),m=0,_=[n,l,h,o];for(let u=0;u<s;++u)a.set(_,m),m+=4;return r.setDataFromBytes(a,0,t,e),r.__$setRenderProxy(this.w_.getRenderProxy()),r}createAlphaTex2D(t,e,i){t=t>1?t:1,e=e>1?e:1;let s=t*e,r=this.createBytesTex(t,e);r.toAlphaFormat();let a=new Uint8Array(s),n=Math.round(255*i);return a.fill(n,0,s),r.setDataFromBytes(a,0,t,e),r.__$setRenderProxy(this.w_.getRenderProxy()),r}createAlphaTexBytes2D(t,e,i){let s=this.createBytesTex(t,e);return s.setDataFromBytes(i,0,t,e),s.toAlphaFormat(),s.__$setRenderProxy(this.w_.getRenderProxy()),s}getCubeRTTTextureAt(t){return this.C_g.getCubeRTTTextureAt(t)}createCubeRTTTextureAt(t,e,i){return this.C_g.createCubeRTTTextureAt(t,e,i)}getRTTTextureAt(t){return this.C_g.getRTTTextureAt(t)}createRTTTextureAt(t,e,i){return this.C_g.createRTTTextureAt(t,e,i)}getDepthTextureAt(t){return this.C_g.getDepthTextureAt(t)}createDepthTextureAt(t,e,i){return this.C_g.createDepthTextureAt(t,e,i)}getRTTFloatTextureAt(t){return this.C_g.getRTTFloatTextureAt(t)}createRTTFloatTextureAt(t,e,i){return this.C_g.createRTTFloatTextureAt(t,e,i)}run(){let t=0,e=this.C_h.length;for(;t<e;++t)this.C_h[t].run();if(this.C_i<1){let t;this.C_i=128;let e=p.default.GetInstance().getFreeResUidMap(),i=32;for(const[s,r]of e){if(i<1)break;i--,r>2?(e.delete(s),t=p.default.GetInstance().removeTextureByUid(s),null!=t&&this.C_f.addTexture(t)):e.set(s,r+1)}}this.C_i--}}e.TextureBlock=v,e.default=v},"5e22":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("54de"));class a{constructor(){this.C_T=null,this.C_j=!0,this.C_k=!0,this.degreeTween=new r.default}bindTarget(t){this.C_T=t,this.degreeTween.bindTarget(this.C_T.getContainer())}isRunning(){return this.C_j}runByDegree(t,e){null!=this.C_T&&(this.degreeTween.runRotY(t),this.runTest(e))}runTest(t){t&&this.degreeTween.testDegreeDis(20)?(this.C_k&&(this.C_T.resetNextOriginPose(),this.C_k=!1),this.C_T.isResetFinish()?(this.C_j=!1,this.C_T.resetPose()):this.C_T.runToReset()):(this.C_k=!0,this.C_j=!0,this.C_T.run(!1))}runByPos(t,e){null!=this.C_T&&(this.degreeTween.runRotYByDstPos(t),this.runTest(e))}}e.default=a},"5e78":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("8d98"),a=s(i("7181")),n=s(i("0851"));class l extends n.default{constructor(t,e,i=!1){super(t,e,i),this.C_l=null,this.C_m=null,this.C_n=0,this.mipmapEnabled=!0,this.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,this.n=r.TextureProxyType.Image}getTexData(){return this.C_l}setDataFromImage(t,e=0,i=0,s=0,r=!1){if(null!=t&&t.width>0&&t.height>0){this.m=!0,e<0&&(e=0),e>15&&(e=15),e>=this.C_n&&(this.C_n=e+1);let n=this.C_l;null!=n?this.C_l.miplevel!=e?(null==this.C_m&&(this.C_m=[this.C_l,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),n=this.C_m[e],null==n&&(n=a.default.Create(),n.miplevel=e,r=!0,this.C_m[e]=n)):this.isGpuEnabled()&&(n.status=0):(n=this.C_l=a.default.Create(),n.miplevel=e,r=!0,this.g=t.width,this.h=t.height),n.data==t&&n.offsetx==i&&n.offsety==s||(0==e&&(this.g=t.width,this.h=t.height),n.data=t,n.status=0,(n.width<t.width||n.height<t.height||r)&&(n.width=t.width,n.height=t.height,n.status=1),n.offsetx=i,n.offsety=s),this.version++}}uploadData(t){null!=this.C_l&&this.dataUploadToGpu(t.getRC(),this.C_l,this.C_m,!0),this.version=0}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())&&null!=this.C_l){let e=t.getRC();this.__$updateToGpuBegin(t),this.dataUploadToGpu(e,this.C_l,this.C_m),this.__$buildParam(e),this.o=!0}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.C_m){for(let t=0;t<this.C_n;++t)a.default.Restore(this.C_m[t]);this.C_n=0,this.C_m=null,this.C_l=null}null!=this.C_l&&(a.default.Restore(this.C_l),this.C_l=null),super.__$destroy()}}toString(){return"[ImageTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=l},"5f3c":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("df9d")),n=i("7c63");class l{constructor(t){this.T=-1,this.C_o=new a.default,this.A_6=null,this.index=-1,this.shdUid=-1,this.procuid=-1,this.batchEnabled=!0,this.fixedState=!0,this.runMode=0,this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null,this.A_6=t,this.T=l.H0++}showInfo(){this.C_o.showInfo()}addNode(t){this.C_o.addNodeAndSort(t)}rejoinNode(t){this.C_o.containsNode(t)&&(this.C_o.removeNodeAndSort(t),this.C_o.addNodeAndSort(t))}removeNode(t){this.C_o.removeNodeAndSort(t)}isEmpty(){return null==this.C_o.getBegin()}run(t){switch(this.runMode){case 2:this.run2(t);break;case 1:this.run1(t);break;case 0:this.run0(t);break;default:break}}run0(t){let e=this.C_o.getBegin();if(null!=e){this.A_6.bindToGpu(this.shdUid),this.A_6.resetUniform();let i=null;while(null!=e)e.drawEnabled&&(i=e.unit,i.drawEnabled&&(i.run(t),i.partTotal<1?i.drawThis(t):i.drawPart(t))),e=e.next}}run1(t){let e=this.C_o.getBegin();if(null!=e){this.A_6.bindToGpu(this.shdUid),this.A_6.resetUniform();let i=null,s=this.C_o.getVtxTotalAt(e.rvroI),r=this.C_o.getTexTotalAt(e.rtroI),a=s>0,n=r>0;while(null!=e)s<1&&(s=this.C_o.getVtxTotalAt(e.rvroI),a=!0),s--,r<1&&(r=this.C_o.getTexTotalAt(e.rtroI),n=!0),r--,e.drawEnabled&&(i=e.unit,i.drawEnabled&&(a&&(e.vro.run(),a=!1),n&&(e.tro.run(),n=!1),i.run2(t),i.partTotal<1?i.drawThis(t):i.drawPart(t))),e=e.next}}run2(t){let e=this.C_o.getBegin();if(null!=e){this.A_6.bindToGpu(this.shdUid),this.A_6.resetUniform();let i=null;n.RenderStateObject.UseRenderState(e.unit.renderState),n.RenderColorMask.UseRenderState(e.unit.rcolorMask);let s=this.C_o.getVtxTotalAt(e.rvroI),r=this.C_o.getTexTotalAt(e.rtroI),a=s>0,l=r>0;while(null!=e)s<0&&(s=this.C_o.getVtxTotalAt(e.rvroI),a=!0),s--,r<0&&(r=this.C_o.getTexTotalAt(e.rtroI),l=!0),r--,e.drawEnabled&&(i=e.unit,i.drawEnabled&&(a&&(e.vro.run(),a=!1),l&&(e.tro.run(),l=!1),null!=i.ubo&&i.ubo.run(t),this.A_6.useTransUniform(i.transUniform),this.A_6.useUniform(i.uniform),i.partTotal<1?i.drawThis(t):i.drawPart(t))),e=e.next}}runLockMaterial(t){let e=this.C_o.getBegin();if(null!=e){this.A_6.bindToGpu(this.shdUid),this.A_6.resetUniform();let i=this.A_6.isTextureUnLocked();t.Texture.unlocked=i;let s=null;if(this.batchEnabled){let r=this.C_o.getVtxTotalAt(e.rvroI),a=r>0;while(null!=e)r<1&&(r=this.C_o.getVtxTotalAt(e.rvroI),a=!0),r--,s=e.unit,e.drawEnabled&&s.drawEnabled&&(a&&(e.vro.run(),a=!1),i&&e.tro.run(),s.runLockMaterial2(null),s.partTotal<1?s.drawThis(t):s.drawPart(t)),e=e.next}else while(null!=e)s=e.unit,e.drawEnabled&&s.drawEnabled&&(s.runLockMaterial(),i&&e.tro.run(),s.partTotal<1?s.drawThis(t):s.drawPart(t)),e=e.next;t.Texture.unlocked=!1}}drawUnit(t,e,i){e.drawEnabled&&(this.A_6.bindToGpu(e.shdUid),e.run(t),e.partTotal<1?e.drawThis(t):e.drawPart(t))}drawLockMaterialByUnit(t,e,i,s,a){if(e.drawEnabled){if(a&&this.A_6.resetUniform(),r.default.IsMobileWeb()){let t=this.vtxResource.getVROByResUid(i.vbuf.getUid(),this.A_6.getCurrentShd(),!0);t.run()}else e.vro.run();e.runLockMaterial2(s?this.A_6.__$globalUniform:null),e.partTotal<1?e.drawThis(t):e.drawPart(t)}}reset(){let t=this.C_o.getBegin(),e=null;if(null!=t){let i;while(null!=t)e=t,t=t.next,this.rpoUnitBuilder.setRPNodeParam(e.__$ruid,this.procuid,-1),e.reset(),i=e.unit,this.rpoNodeBuilder.restore(e)&&this.rpoUnitBuilder.restore(i)}this.index=-1,this.shdUid=-1,this.procuid=-1,this.C_o.clear(),this.rpoNodeBuilder=null,this.rpoUnitBuilder=null,this.vtxResource=null}destroy(){this.reset()}getUid(){return this.T}toString(){return"[RPOBlock(uid = "+this.T+", index = "+this.index+", shdUid = "+this.shdUid+")]"}}l.H0=0,e.default=l},"61d7":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("8ae0");class r{constructor(t,e){this.T=0,this.C_p=null,this.C_q=new Map,this.C_r=new s.TexArea,this.C_s=2,this.C_t=32,this.C_N=32,this.C_O=32,this.C_u=!1,t<128&&(t=128),e<128&&(e=128),this.C_N=t,this.C_O=e,this.C_p=new s.TexAreaNode(0,0,t,e),this.T=r.H0++}getUid(){return this.T}getWidth(){return this.C_N}getHeight(){return this.C_O}setMinSize(t){this.C_t=Math.max(t,4)}getAreaByName(t){return this.C_q.has(t)?this.C_q.get(t):null}getTexAreaByXY(t,e){let i=this.C_p.findByXY(t,e);return null!=i&&this.C_q.has(i.uniqueNS)?this.C_q.get(i.uniqueNS):null}addSubTexArea(t,e,i){if(this.C_q.has(t))return this.C_q.get(t);{let r=this.C_r;r.offset=this.C_s,r.minSize=this.C_t,r.uniqueNS=t,r.rect.width=e+2*r.offset,r.rect.height=i+2*r.offset;let a=this.C_p.addTexArea(r);if(a){r=new s.TexArea,r.copyFrom(this.C_r),this.C_q.set(t,r),r.atlasUid=this.T;let e=r.rect,i=r.texRect;i.copyFrom(e),i.x+=r.offset,i.y+=r.offset,i.width-=2*r.offset,i.height-=2*r.offset,i.flipY(this.C_O);let a=i.x/this.C_N,n=i.y/this.C_O,l=i.getRight()/this.C_N,h=i.getTop()/this.C_O;return this.C_u?r.uvs.set([a,h,l,h,l,n,a,n],0):r.uvs.set([a,n,l,n,l,h,a,h],0),r}return null}}}r.H0=0,e.default=r},"63ff":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("ad24")),n=i("a52f"),l=s(i("91f5")),h=s(i("6953"));class o{constructor(){this.C_v=50,this.A8=null,this.C_w=!0,this.C_x=!0,this.C1=new a.default,this.C_y=4.5,this.C_z=l.default.FREE_RUN,this.C_a=null,this.C3=null,this.C2=null,this.shadowEntity=null,this.position=new r.default,this.attackDis=50,this.radius=100,this.lifeTime=3e3,this.campType=n.CampType.Blue,this.status=n.CampRoleStatus.Free,this.terrainData=null,this.roleCamp=null,this.C_0=0,this.C_1=Math.round(20*Math.random()+20),this.C_2=new r.default}getRendererScene(){return this.A8}getAttackModule(){return this.C3}getMotionModule(){return this.C2}isAwake(){return this.C_w}wake(){h.default.RunnerQueue.addRunner(this),this.C_w=!0,this.C_x=!0}sleep(){h.default.RunnerQueue.removeRunner(this),this.C_w=!1}setRunFlag(t){this.C_0=t}getRunFlag(){return this.C_0}isRunning(){return!0}isStopped(){return!1}run(){switch(this.C_z){case l.default.ATTACK_RUN:this.attackRun();break;case l.default.FREE_RUN:this.freeRun();break;default:break}}setVisible(t){this.C2.setVisible(t),this.C3.setVisible(t),null!=this.shadowEntity&&this.shadowEntity.setVisible(t)}setXYZ(t,e,i){this.C2.setXYZ(t,e,i),this.C3.setXYZ(t,e,i),this.C1.setCurrentXYZ(t,e,i),this.C_2.setXYZ(t,e,i)}setPosition(t){this.C2.setPosition(t),this.C3.setPosition(t),this.C1.setCurrentPosition(t),this.C_2.copyFrom(t)}getPosition(t){this.C2.getPosition(t)}resetPose(){this.C2.resetPose(),this.C3.resetPose()}attackMove(t,e){let i=!0;t&&this.roleCamp.distance>.4*(this.attackDis+this.radius)?i=!1:this.C1.isMoving()&&(this.C_x=!0);let s=!1;return this.C_x?(e=t?e:this.C1.getDirecDegree(),i=this.C_w&&i,i&&(s=!0,this.C1.run(),this.C_w=this.C1.isMoving(),this.C2.getPosition(this.position)),this.C2.direcByDegree(e,!i),null!=this.shadowEntity&&this.shadowEntity.update(),this.C_x=!!s||this.C2.isPoseRunning()):t&&Math.abs(this.C2.getRotationY()-e)>this.C_v&&(this.C_x=!0),s}armMove(t,e){this.C3.setPosition(t),this.C3.setDstDirecDegree(e)}attackRun(){let t=this.C3.getRotationY(),e=null!=this.C_a?this.C_a.findAttDst(t):null;this.C3.setAttackDst(e);let i=this.attackMove(null!=e,t);i&&this.armMove(this.position,this.C2.getRotationY()),this.C3.run(i),i||null!=e?(this.C_1=30,this.C_2.copyFrom(this.position)):(this.C_1<1&&(this.C_z=l.default.FREE_RUN),this.C_1--)}freeRunTest(){if(this.C_1<1){this.C_1=Math.round(30*Math.random()+30);let t=this.terrainData.getRandomFreeGridPosition();this.moveToXZ(t.x,t.z)}else this.C_1--}freeRun(){let t=this.C3.getRotationY(),e=null!=this.C_a?this.C_a.testAttDst(t):null,i=this.attackMove(!1,t);i&&this.armMove(this.position,this.C2.getRotationY()),this.C3.run(i),i||this.freeRunTest(),null!=e&&(this.C_z=l.default.ATTACK_RUN)}moveToXZ(t,e,i=!1){this.C1.toXZ(t,e),i&&(this.C_z=l.default.ATTACK_RUN),this.wake()}}e.default=o},"644c":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){}static GetTypeByTypeNS(t){switch(t){case"mat4":return s.SHADER_MAT4;case"mat3":return s.SHADER_MAT3;case"mat2":return s.SHADER_MAT2;case"float":return s.SHADER_FLOAT;case"int":return s.SHADER_INT;case"vec4":return s.SHADER_VEC4;case"vec3":return s.SHADER_VEC3;case"vec2":return s.SHADER_VEC2;case"vec4[]":return s.SHADER_VEC4FV;case"vec3[]":return s.SHADER_VEC3FV;case"vec2[]":return s.SHADER_VEC2FV;case"sampler2D":return s.SHADER_SAMPLER2D;case"sampler3D":return s.SHADER_SAMPLER3D;case"samplerCube":return s.SHADER_SAMPLERCUBE;default:break}return s.SHADER_UNDEFINED}static GetTypeNSByType(t){switch(t){case s.SHADER_MAT4:return"mat4";case s.SHADER_MAT3:return"mat3";case s.SHADER_MAT2:return"mat2";case s.SHADER_FLOAT:return"float";case s.SHADER_VEC4:return"vec4";case s.SHADER_VEC3:return"vec3";case s.SHADER_VEC2:return"vec2";case s.SHADER_SAMPLER2D:return"sampler2D";case s.SHADER_SAMPLER3D:return"sampler3D";case s.SHADER_SAMPLERCUBE:return"samplerCube";case s.SHADER_UNDEFINED:return"undefined";default:break}return""}}s.ATTRINS_VTX_VS="a_vs",s.ATTRINS_VTX_UVS="a_uvs",s.ATTRINS_VTX_NVS="a_nvs",s.ATTRINS_VTX_CVS="a_cvs",s.UNIFORMNS_OBJ_MAT_NS="u_objMat",s.UNIFORMNS_VIEW_MAT_NS="u_viewMat",s.UNIFORMNS_PROJ_MAT_NS="u_projMat",s.SHADER_UNDEFINED=3010,s.SHADER_VEC2=3011,s.SHADER_VEC3=3012,s.SHADER_VEC4=3013,s.SHADER_VEC2FV=3014,s.SHADER_VEC3FV=3015,s.SHADER_VEC4FV=3016,s.SHADER_MAT2=3017,s.SHADER_MAT3=3018,s.SHADER_MAT4=3019,s.SHADER_FLOAT=3020,s.SHADER_INT=3021,s.SHADER_MAT2FV=3022,s.SHADER_MAT3FV=3023,s.SHADER_MAT4FV=3024,s.SHADER_SAMPLER2D=3031,s.SHADER_SAMPLERCUBE=3032,s.SHADER_SAMPLER3D=3033,s.SHADER_PRECISION_LOWP=3101,s.SHADER_PRECISION_MEDIUMP=3111,s.SHADER_PRECISION_HIGHP=3121,s.UNIFORM_TEX_SAMPLER2D="sampler2D",s.UNIFORM_TEX_SAMPLERCUBE="samplerCube",s.UNIFORM_TEX_SAMPLER3D="sampler3D",s.UNIFORMNS_TEX_SAMPLER_0="u_sampler0",s.UNIFORMNS_TEX_SAMPLER_1="u_sampler1",s.UNIFORMNS_TEX_SAMPLER_2="u_sampler2",s.UNIFORMNS_TEX_SAMPLER_3="u_sampler3",s.UNIFORMNS_TEX_SAMPLER_4="u_sampler4",s.UNIFORMNS_TEX_SAMPLER_5="u_sampler5",s.UNIFORMNS_TEX_SAMPLER_6="u_sampler6",s.UNIFORMNS_TEX_SAMPLER_7="u_sampler7",s.UNIFORMNS_TEX_SAMPLER_LIST=[s.UNIFORMNS_TEX_SAMPLER_0,s.UNIFORMNS_TEX_SAMPLER_1,s.UNIFORMNS_TEX_SAMPLER_2,s.UNIFORMNS_TEX_SAMPLER_3,s.UNIFORMNS_TEX_SAMPLER_4,s.UNIFORMNS_TEX_SAMPLER_5,s.UNIFORMNS_TEX_SAMPLER_6,s.UNIFORMNS_TEX_SAMPLER_7],e.default=s},6661:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("faa5")),n=s(i("b3bd")),l=s(i("0fc4"));class h extends a.default{constructor(){super(),this.n_=""}initialize(t){this.n_="PingpongHBlurBlurShd"}getFragShaderCode(){let t="";return t=r.default.IsWebGL2()?"#version 300 es\nprecision mediump float;\nfloat weight[5] = float[] (0.227027, 0.1945946, 0.1216216, 0.054054, 0.016216);\nuniform vec4 u_texSize;\nuniform sampler2D u_sampler0;\nin vec2 v_uvs;\nout vec4 FragColor;\nvoid main()\n{\n    vec2 tex_offset = u_texSize.w / u_texSize.xy;\n    float dx = tex_offset.x;\n    tex_offset.y = 0.0;\n    vec4 result = texture(u_sampler0, v_uvs) * weight[0];\n    for(int i = 1; i < 5; ++i)\n    {\n        tex_offset.x = dx * float(i);\n        result += texture(u_sampler0, v_uvs + tex_offset) * weight[i];\n        result += texture(u_sampler0, v_uvs - tex_offset) * weight[i];\n    }\n    FragColor = result;\n}\n":"\nprecision mediump float;\nuniform vec4 u_texSize;\nuniform sampler2D u_sampler0;\nin vec2 v_uvs;\nout vec4 FragColor;\nvoid main()\n{\n    vec2 tex_offset = u_texSize.w / u_texSize.xy;\n    float dx = tex_offset.x;\n    tex_offset.y = 0.0;\n    vec4 result = texture2D(u_sampler0, v_uvs) * 0.227027;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.1945946;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.1945946;\n    tex_offset.x = dx * 2.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.1216216;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.1216216;\n    tex_offset.x = dx * 3.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.054054;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.054054;\n    tex_offset.x = dx * 4.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.016216;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.016216;\n    FragColor = result;\n}\n",t}getVertShaderCode(){let t="#version 300 es\nprecision mediump float;\nlayout(location = 0) in vec3 a_vs;\nlayout(location = 1) in vec2 a_uvs;\nout vec2 v_uvs;\nvoid main()\n{\n    gl_Position = vec4(a_vs, 1.0);\n    v_uvs = vec2(a_uvs.x, a_uvs.y);\n}\n";return t}getUniqueShaderName(){return this.n_}toString(){return"[PingpongHBlurShaderBuffer()]"}static GetInstance(){return h.H2}}h.H2=new h;class o extends a.default{constructor(){super(),this.n_=""}initialize(t){this.n_="PingpongVBlurBlurShd"}getFragShaderCode(){let t="";return t=r.default.IsWebGL2()?"#version 300 es\nprecision mediump float;\nfloat weight[5] = float[] (0.227027, 0.1945946, 0.1216216, 0.054054, 0.016216);\nuniform vec4 u_texSize;\nuniform sampler2D u_sampler0;\nin vec2 v_uvs;\nout vec4 FragColor;\nvoid main()\n{\n    //vec2 tex_offset = u_texSize.w / vec2(textureSize(u_sampler0, 0));\n    vec2 tex_offset = u_texSize.w / u_texSize.xy;\n    float dy = tex_offset.y;\n    tex_offset.x = 0.0;\n    vec4 result = texture(u_sampler0, v_uvs) * weight[0];\n    for(int i = 1; i < 5; ++i)\n    {\n        tex_offset.y = dy * float(i);\n        result += texture(u_sampler0, v_uvs + tex_offset) * weight[i];\n        result += texture(u_sampler0, v_uvs - tex_offset) * weight[i];\n    }\n    FragColor = result;\n}\n":"\nprecision mediump float;\nuniform vec4 u_texSize;\nuniform sampler2D u_sampler0;\nin vec2 v_uvs;\nout vec4 FragColor;\nvoid main()\n{\n    vec2 tex_offset = u_texSize.w / u_texSize.xy;\n    float dy = tex_offset.y;\n    tex_offset.x = 0.0;\n    vec4 result = texture2D(u_sampler0, v_uvs) * 0.227027;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.1945946;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.1945946;\n    tex_offset.y = dy * 2.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.1216216;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.1216216;\n    tex_offset.y = dy * 3.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.054054;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.054054;\n    tex_offset.y = dy * 4.0;\n    result += texture2D(u_sampler0, v_uvs + tex_offset) * 0.016216;\n    result += texture2D(u_sampler0, v_uvs - tex_offset) * 0.016216;\n\n    FragColor = result;\n}\n",t}getVertShaderCode(){let t="#version 300 es\nprecision mediump float;\nlayout(location = 0) in vec3 a_vs;\nlayout(location = 1) in vec2 a_uvs;\nout vec2 v_uvs;\nvoid main()\n{\n    gl_Position = vec4(a_vs, 1.0);\n    v_uvs = vec2(a_uvs.x, a_uvs.y);\n}\n";return t}getUniqueShaderName(){return this.n_}toString(){return"[PingpongVBlurShaderBuffer()]"}static GetInstance(){return o.H2}}o.H2=new o,e.PingpongVBlurShaderBuffer=o;class m extends l.default{constructor(t=0){super(),this.C_3=0,this.C_4=new Float32Array([800,600,0,0]),this.C_3=t}setTexSize(t,e){this.C_4[0]=t,this.C_4[1]=e}setBlurDensity(t){this.C_4[3]=t}getCodeBuf(){return this.C_3>0?o.GetInstance():h.GetInstance()}createSelfUniformData(){let t=new n.default;return t.uniformNameList=["u_texSize"],t.dataList=[this.C_4],t}}e.default=m},"670b":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("f610"));class a{constructor(){this.ivs=null,this.vs=null,this.uvs=null,this.nvs=null,this.cvs=null,this.vsBufStep=3,this.mat4=null,this.offset=null}destroy(){this.ivs=null,this.vs=null,this.uvs=null,this.nvs=null}}class n extends r.default{constructor(){super(),this.A_4=[]}static MergeSameIvs(t,e,i,s){let r=t.length,a=new Uint16Array(r*s);a.set(t,0);let n=e.length/i,l=0,h=0,o=0;for(h=1;h<s;++h)for(n=24*h,l=r*h,a.set(t,l),o=l+r;l<o;++l)a[l]+=n;return a}addEntity(t,e=!0){if(null!=t){let i=t.getMesh(),s=new a;if(s.ivs=i.getIVS(),s.vs=i.getVS(),s.uvs=i.getUVS(),s.nvs=i.getNVS(),s.cvs=i.getCVS(),e){s.vs=s.vs.slice(0);let e=t.getMatrix();e.transformVectorsSelf(s.vs,s.vs.length)}this.A_4.push(s)}}addGeometry(t,e=null){if(null!=t&&t!=this){let e=new a;e.ivs=t.getIVS(),e.vs=t.getVS(),e.uvs=t.getUVS(),e.nvs=t.getNVS(),e.cvs=t.getCVS(),this.A_4.push(e)}}addMesh(t){if(null!=t){let e=new a;e.ivs=t.getIVS(),e.vs=t.getVS(),e.uvs=t.getUVS(),e.nvs=t.getNVS(),e.cvs=t.getCVS(),this.A_4.push(e)}}merger(){let t=null,e=null,i=null,s=null,r=null,a=0,n=null,l=this.A_4.length;if(!(l>1))throw Error("meshs total less than 2.");{let h=0,o=0,m=0,_=0,u=0,d=0,c=0,f=0,p=0,g=0,v=0;for(a=0;a<l;++a)n=this.A_4[a],o+=n.ivs.length,m+=n.vs.length,null!=n.uvs&&(_+=n.uvs.length),null!=n.nvs&&(u+=n.nvs.length),null!=n.cvs&&(d+=n.cvs.length);let x,y=m/n.vsBufStep;t=y>65535?new Uint32Array(o):new Uint16Array(o),e=new Float32Array(m),_>0&&(i=new Float32Array(_)),u>0&&(s=new Float32Array(u)),d>0&&(r=new Float32Array(d));let T=0,b=null,S=null,E=null,M=null,A=null;for(a=0;a<l;++a){for(n=this.A_4[a],b=n.ivs,x=b.length,h=0;h<x;h++)t[c++]=b[h]+T;S=n.vs,T+=S.length/3,e.set(S,f),f+=S.length,_>0&&(E=n.uvs,i.set(E,p),p+=E.length),u>0&&(M=n.nvs,s.set(M,g),g+=M.length),d>0&&(A=n.cvs,r.set(A,v),v+=A.length)}this.B_O=t,this.B_K=e,this.B_L=i,this.B_M=s,this.B_N=r}for(a=0;a<l;++a)this.A_4[a].destroy();this.A_4=[]}}e.GeometryMerger=n},"670e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("45db"),r=i("8ae4");class a{constructor(){this.version=-1,this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.vertex=new s.ROVertexRes,this.indices=new r.ROIndicesRes,this.c=0}__$attachThis(){++this.c}__$detachThis(){--this.c,this.c<1&&(this.c=0)}getAttachCount(){return this.c}createVRO(t,e,i){let s=this.vertex.createVRO(t,e,i,this.indices,this.indices.getUid());return s.ibufStep=this.indices.ibufStep,s}updateToGpu(t){this.indices.updateToGpu(t),this.vertex.updateToGpu(t)}destroy(t){this.getAttachCount()<1&&this.resUid>=0&&(this.vertex.destroy(t),this.indices.destroy(t),this.resUid=-1)}}e.GpuVtxObject=a},6773:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.B_O=new Uint8Array(32),this.C_C=new Uint8Array(16),this.BD=40,this.C_5=40,this.C_6=20}setTriggerTimeAt(t,e){this.B_O[e]=t+1,this.C_C[t]=e}setTimeByIndex(t,e=0){this.BD=this.C_C[t]+e}getTriggerIndex(){return this.B_O[this.BD]-1}setPeriod(t){this.C_5=t>5?t:5,this.B_O.length<this.C_5&&(this.B_O=new Uint8Array(this.C_5+8))}isLock(){return this.BD>this.C_6}isUnlock(){return this.BD<=this.C_6}run(){this.BD<1&&(this.BD=this.C_5),this.BD--}}e.default=s},6883:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("29ef")),a=s(i("402a")),n=s(i("9cf1")),l=s(i("f0d9"));class h extends a.default{constructor(t=null){super(t),this.C_7=null,this.Bl=null,this.A_u=!0,this.A_v=!1,this.C_8=!1,this.C_9=!1,this.B_s=!1,this.v_=!1,this.C_=!1,this.flipVerticalUV=!1,this.premultiplyAlpha=!1,this.setRenderState(r.default.BACK_ADD_BLENDSORT_STATE)}createGroup(t){this.Bl=this.getMesh(),t>0&&null==this.Bl&&(this.Bl=new l.default,this.Bl.createData(t))}setSizeAndScaleAt(t,e,i,s,r){null!=this.Bl&&this.Bl.setSizeAndScaleAt(t,e,i,s,r)}setPositionAt(t,e,i,s){null!=this.Bl&&this.Bl.setPositionAt(t,e,i,s)}setVelocityAt(t,e,i,s){null!=this.Bl&&this.Bl.setVelocityAt(t,e,i,s)}setAccelerationAt(t,e,i,s){null!=this.Bl&&this.Bl.setAccelerationAt(t,e,i,s)}setUVRectAt(t,e,i,s,r){null!=this.Bl&&this.Bl.setUVRectAt(t,e,i,s,r)}setTimeAt(t,e,i,s,r=0){null!=this.Bl&&this.Bl.setTimeAt(t,e,i,s,r)}setTimeSpeedAt(t,e){null!=this.Bl&&this.Bl.setTimeSpeedAt(t,e)}setTimeSpeed(t,e){null!=this.Bl&&this.Bl.setTimeSpeedAt(t,e)}setAlphaAt(t,e){null!=this.Bl&&this.Bl.setAlphaAt(t,e)}setBrightnessAt(t,e){null!=this.Bl&&this.Bl.setBrightnessAt(t,e)}setRGBA4f(t,e,i,s){null!=this.C_7&&this.C_7.setRGBA4f(t,e,i,s)}setRGB3f(t,e,i){null!=this.C_7&&this.C_7.setRGB3f(t,e,i)}setRGBAOffset4f(t,e,i,s){null!=this.C_7&&this.C_7.setRGBAOffset4f(t,e,i,s)}setRGBOffset3f(t,e,i){null!=this.C_7&&this.C_7.setRGBOffset3f(t,e,i)}setAlpha(t){null!=this.C_7&&this.C_7.setAlpha(t)}getAlpha(){return this.C_7.getAlpha()}setBrightness(t){this.C_7.setBrightness(t)}getBrightness(){return this.C_7.getBrightness()}setAcceleration(t,e,i){null!=this.C_7&&this.C_7.setAcceleration(t,e,i)}setSpdScaleMax(t,e=1){null!=this.C_7&&this.C_7.setSpdScaleMax(t,e)}setClipUVParam(t,e,i,s){this.B_s&&null!=this.C_7&&this.C_7.setClipUVParam(t,e,i,s)}getTime(){return this.C_7.getTime()}setTime(t){this.C_7.setTime(t)}setDepthOffset(t){this.C_7.setDepthOffset(t)}updateTime(t){this.C_7.updateTime(t)}getScaleX(){return this.C_7.getScaleX()}getScaleY(){return this.C_7.getScaleY()}setScaleX(t){this.C_7.setScaleX(t)}setScaleY(t){this.C_7.setScaleY(t)}setScaleXY(t,e){this.C_7.setScaleXY(t,e)}createMaterial(t){null==this.getMaterial()?(this.C_7=new n.default(this.A_u,this.A_v,this.B_s),this.C_7.setPlayParam(this.C_8,this.C_9,this.v_,this.C_),this.C_7.setTextureList(t),this.C_7.premultiplyAlpha=this.premultiplyAlpha,this.setMaterial(this.C_7)):(this.C_7=this.getMaterial(),this.C_7.setTextureList(t))}toTransparentBlend(t=!1){t?this.setRenderState(r.default.BACK_TRANSPARENT_ALWAYS_STATE):this.setRenderState(r.default.BACK_TRANSPARENT_STATE)}toBrightnessBlend(t=!1){t?this.setRenderState(r.default.BACK_ADD_ALWAYS_STATE):this.setRenderState(r.default.BACK_ADD_BLENDSORT_STATE)}setPlayParam(t,e,i=!1,s=!1){this.C_8=t,this.C_9=e,this.v_=i,this.C_=s}initialize(t,e,i,s){this.B_s=i,this.A_u=t,this.A_v=e,null!=this.Bl&&(this.createMaterial(s),this.activeDisplay())}createBounds(){}__activeMesh(t){if(null==this.getMesh()){let e=this.Bl;e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.flipVerticalUV=this.flipVerticalUV,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(),this.setMesh(e)}}setUV(t,e,i,s){null!=this.Bl&&this.Bl.setUV(t,e,i,s)}update(){this.Bq.update()}isAwake(){return this.C_8&&this.C_7.getTime()<this.Bl.getEndTime()}destroy(){this.C_7=null,this.Bl=null,super.destroy()}toString(){return"Billboard3DFlowEntity(uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=h},"68aa":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,i,s,r,a){1==this.status||a?t.texImage2D(e,this.miplevel,i,this.width,this.height,0,s,r,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,this.width,this.height,s,r,this.data),this.status=-1}static Create(){return s.H_q.length>0?s.H_q.pop():new s}static Restore(t){null!=t&&(t.data=null,s.H_q.push(t))}}s.H_q=[],e.default=s},6940:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ae33")),a=s(i("54de"));class n{constructor(t=null){this.At=null,this.BI=null,this.degreeTween=new a.default,this.BI=null==t?new r.default:t}getContainer(){return this.BI}setAttackDst(t){}setVisible(t){this.BI.setVisible(t)}getVisible(){return this.BI.getVisible()}setRotationY(t){this.BI.setRotationY(t)}getRotationY(){return this.BI.getRotationY()}direcByDegree(t,e){this.degreeTween.runRotY(t),this.degreeTween.isDegreeChanged()&&this.BI.update()}direcByPos(t,e){this.degreeTween.runRotYByDstPos(t),this.degreeTween.isDegreeChanged()&&this.BI.update()}setDstDirecDegree(t){}isPoseRunning(){return!1}initialize(t,e,i,s=null){null==this.At&&(this.At=t,t.addContainer(this.BI,e),this.BI.addEntity(i),this.degreeTween.bindTarget(this.BI))}setXYZ(t,e,i){this.BI.setXYZ(t,e,i)}setPosition(t){this.BI.setPosition(t)}getPosition(t){this.BI.getPosition(t)}resetPose(){}resetNextOriginPose(){}run(t){this.BI.update()}isResetFinish(){return!0}runToReset(){this.BI.update()}}e.default=n},6953:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("9c4d"));class a{constructor(){}static Run(){a.RunnerQueue.run()}}a.RunnerQueue=new r.default,e.default=a},"69ed":function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["VertHead"]="vertHead",t["VertBody"]="vertBody",t["FragHead"]="fragHead",t["FragBody"]="fragBody"}(s||(s={})),e.ShaderCodeType=s},"6a30":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("3930"));class n{constructor(){this.direction=new r.default(0,-1,0,0),this.color=new a.default(1,1,1,1),this.attenuationFactor1=0,this.attenuationFactor2=0}}e.DirectionLight=n},"6d49":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("baae")),n=i("8d98"),l=s(i("56c5"));class h{constructor(t,e,i){this.T=-1,this.A=0,this.DA=0,this.DB=null,this.DC=null,this.DD=null,this.DE=null,this.C_N=512,this.C_O=512,this.DF=0,this.J_=null,this.DG=0,this.DH=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.DI=[!0,!0,!0,!0,!0,!0,!0,!0],this.DJ=0,this.DK=0,this.An=0,this.DL=0,this.DM=new Float32Array(1),this.DN=new Float32Array(4),this.DO=new Int16Array(4),this.DP=!1,this.textureLevel=0,this.sizeFixed=!1,this.writeDepthEnabled=!0,this.writeStencilEnabled=!1,this.multisampleEnabled=!1,this.multisampleLevel=0,this.DQ=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.DR=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.DS=0,this.DT=!1,this.DU=2,this.DV=2,this.A=t,this.B8=e,this.DF=i,this.T=h.H0++}getUid(){return this.T}resetAttachmentMask(t){let e=this.DI.length-1;while(e>=0)this.DI[e]=t,--e}setAttachmentMaskAt(t,e){this.DI[t]=e}getActiveAttachmentTotal(){return this.DT?this.An-1:this.An}getAttachmentTotal(){return this.DI.length}bindToBackbuffer(t){switch(t){case a.default.DRAW_FRAMEBUFFER:this.J_.bindFramebuffer(this.J_.DRAW_FRAMEBUFFER,null);break;case a.default.READ_FRAMEBUFFER:this.J_.indFramebuffer(this.J_.READ_FRAMEBUFFER,null);break;default:this.J_.bindFramebuffer(this.J_.FRAMEBUFFER,null)}}bind(t){if(null!=this.DB)switch(t){case a.default.DRAW_FRAMEBUFFER:this.J_.bindFramebuffer(this.J_.DRAW_FRAMEBUFFER,this.DB);break;case a.default.READ_FRAMEBUFFER:this.J_.bindFramebuffer(this.J_.READ_FRAMEBUFFER,this.DB);break;default:this.J_.bindFramebuffer(this.J_.FRAMEBUFFER,this.DB)}}getFBO(){return this.DB}getDepthStencilRBO(){return this.DC}getDepthRBO(){return this.DD}getWidth(){return this.C_N}getHeight(){return this.C_O}getFramebufferType(){return this.DF}renderToTexAt(t,e,i){let s=null!=e?e.internalFormat:-1;this.J_=t,0==i&&(this.DS=0,this.DT=!1,this.J_.bindFramebuffer(this.DG,this.DB),s!=n.TextureFormat.DEPTH_COMPONENT&&s!=n.TextureFormat.DEPTH_STENCIL&&(this.An=0,this.DL=0));let r=-1,a=null;null!=e?(r=e.getTargetType(),a=this.B8.getGpuBuffer(e.getResUid()),e.uploadFromFbo(this.B8,this.C_N,this.C_O)):r=this.DH[this.An],this.framebufferTextureBind(t,r,s,a)}glFramebufferTex2D(t,e){let i=this.J_;i.framebufferTexture2D(this.DG,t,i.TEXTURE_2D,e,0),this.DQ[this.DS]=t,this.DR[this.DS]=i.TEXTURE_2D,this.DS++}glFramebufferTexCube(t,e,i){let s=this.J_;s.framebufferTexture2D(this.DG,t,s.TEXTURE_CUBE_MAP_POSITIVE_X+e,i,0),this.DQ[this.DS]=t,this.DR[this.DS]=s.TEXTURE_CUBE_MAP_POSITIVE_X+e,this.DS++}framebufferTexture2D(t,e,i,s){let r=-1;switch(i){case n.TextureFormat.DEPTH_COMPONENT:this.DT=!0,r=this.J_.DEPTH_ATTACHMENT;break;case n.TextureFormat.DEPTH_STENCIL:this.DT=!0,r=this.J_.DEPTH_STENCIL_ATTACHMENT;break;default:r=this.DA+this.DL;break}r>0&&(this.DI[this.An]?(this.glFramebufferTex2D(r,s),++this.DL,this.DH[this.An]=null!=s?e:0):this.DH[this.An]=0,++this.An)}framebufferTextureBind(t,e,i,s){switch(e){case n.TextureTarget.TEXTURE_2D:this.framebufferTexture2D(t,e,i,s);break;case n.TextureTarget.TEXTURE_CUBE:let r=0;for(let t=0;t<6;++t)this.DI[t]?(this.glFramebufferTexCube(this.DA+this.DL,t,s),++this.DL,this.DH[this.An+t]=null!=s?e:0,r++):this.DH[this.An+t]=0;r=r>0?r:6,this.An+=r;break;case n.TextureTarget.TEXTURE_SHADOW_2D:this.DI[this.An]?(this.glFramebufferTex2D(this.J_.DEPTH_ATTACHMENT,s),this.DH[this.An]=null!=s?e:0):this.DH[this.An]=0,++this.An;break;default:break}}reset(){this.DJ=-1,this.DK=-1}use(t){if(this.J_=t,null!=this.DB){if(this.An>1){if(this.DK!=this.DL){let t=[],e=0;for(;e<this.DL;++e)t.push(this.DA+e);if(this.DK>this.DL)for(;e<this.DK;++e)this.J_.framebufferTexture2D(this.DG,this.DQ[e],this.DR[e],null,0);l.default.DrawBuffers(t),this.DK=this.DL}}else if(this.DK!=this.DL){if(this.DK>this.DL)for(let e=1;e<this.DK;++e)this.J_.framebufferTexture2D(this.DG,this.DQ[e],this.DR[e],null,0);let t=[this.DA];l.default.DrawBuffers(t),this.DK=this.DL}this.DJ=this.An}}clearOnlyColor(t){if(null!=this.DB)if(r.default.IsWebGL2())if(this.DN[0]=t.r,this.DN[1]=t.g,this.DN[2]=t.b,this.DN[3]=t.a,this.DJ>1)for(let e=0;e<this.DJ;++e)this.J_.clearBufferfv(this.J_.COLOR,e,this.DN);else this.J_.clearBufferfv(this.J_.COLOR,0,this.DN);else this.J_.clearColor(t.r,t.g,t.b,t.a)}clearOnlyDepth(t=1){r.default.IsWebGL2()?(this.DM[0]=t,this.J_.clearBufferfv(this.J_.DEPTH,0,this.DM)):this.J_.clearDepth(t)}clearOnlyStencil(t){this.DO[0]=t,this.J_.clearBufferuiv(this.J_.STENCIL,0,this.DO)}clearOnlyDepthAndStencil(t,e){this.J_.clearBufferfi(this.J_.DEPTH_STENCIL,0,t,e)}invalidateFramebuffer(){}resize(t,e){this.DU==t&&this.DV==e||(this.DP=!0,this.DU=t,this.DV=e)}initialize(t,e,i){this.J_=t,this.DA=l.default.COLOR_ATTACHMENT0,this.DP&&(e=this.DU,i=this.DV),null==this.DB?this.createNewFBO(t,e,i):this.C_N==e&&this.C_O==i||this.createNewFBO(t,e,i),this.DP=!1}isSizeChanged(){return this.DP}destroy(t){null!=this.DB&&(null!=this.DC&&(t.deleteFramebuffer(this.DC),this.DC=null),null!=this.DD&&(t.deleteFramebuffer(this.DD),this.DD=null),null!=this.DE&&(t.deleteFramebuffer(this.DE),this.DE=null),t.deleteFramebuffer(this.DB),this.DB=null),this.J_=null,this.DG=0,this.DP=!1}buildDepthStencilRBO(t,e,i){null==this.DC&&(this.DC=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.DC),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_STENCIL,e,i),t.framebufferRenderbuffer(this.DG,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.DC),null==this.DE&&(this.DE=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.DE),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,i),t.framebufferRenderbuffer(this.DG,this.DA,t.RENDERBUFFER,this.DE)):(t.bindRenderbuffer(t.RENDERBUFFER,this.DC),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e,i),t.framebufferRenderbuffer(this.DG,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.DC))}buildDepthRBO(t,e,i){null==this.DD&&(this.DD=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.DD),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.DEPTH_COMPONENT24,e,i),t.framebufferRenderbuffer(this.DG,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.DD),null==this.DE&&(this.DE=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.DE),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,i),t.framebufferRenderbuffer(this.DG,this.DA,t.RENDERBUFFER,this.DE)):(t.bindRenderbuffer(t.RENDERBUFFER,this.DD),r.default.IsWebGL2()?t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT24,e,i):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,i),t.framebufferRenderbuffer(this.DG,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.DD))}buildStencilRBO(t,e,i){null==this.DC&&(null==this.DC&&(this.DC=t.createRenderbuffer()),this.multisampleEnabled?(t.bindRenderbuffer(t.RENDERBUFFER,this.DC),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.STENCIL_INDEX8,e,i),t.framebufferRenderbuffer(this.DG,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.DC),null==this.DE&&(this.DE=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.DE),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,i),t.framebufferRenderbuffer(this.DG,this.DA,t.RENDERBUFFER,this.DE)):(t.bindRenderbuffer(t.RENDERBUFFER,this.DC),t.renderbufferStorage(t.RENDERBUFFER,t.STENCIL_INDEX8,e,i),t.framebufferRenderbuffer(this.DG,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.DC)))}buildColorRBO(t,e,i){this.multisampleEnabled&&(null==this.DE&&(this.DE=t.createRenderbuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.DE),t.renderbufferStorageMultisample(t.RENDERBUFFER,this.multisampleLevel,t.RGBA8,e,i),t.framebufferRenderbuffer(this.DG,this.DA,t.RENDERBUFFER,this.DE))}createNewFBO(t,e,i){let s=null==this.DB;switch(this.DJ=this.An=0,this.DK=this.DL=0,this.C_N=e,this.C_O=i,this.DU=e,this.DV=i,s&&(this.DB=t.createFramebuffer()),this.DF){case a.default.DRAW_FRAMEBUFFER:this.DG=t.DRAW_FRAMEBUFFER;break;case a.default.READ_FRAMEBUFFER:this.DG=t.READ_FRAMEBUFFER;break;default:this.DG=t.FRAMEBUFFER;break}if(t.bindFramebuffer(this.DG,this.DB),this.writeDepthEnabled?this.writeStencilEnabled?null==this.DC&&this.buildDepthStencilRBO(t,e,i):this.buildDepthRBO(t,e,i):this.writeStencilEnabled?this.buildStencilRBO(t,e,i):this.buildColorRBO(t,e,i),s){t.checkFramebufferStatus(this.DG);t.FRAMEBUFFER_COMPLETE}h.BindToBackbuffer(t,this.DF)}static BindToBackbuffer(t,e){switch(e){case a.default.DRAW_FRAMEBUFFER:t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null);break;case a.default.READ_FRAMEBUFFER:t.indFramebuffer(t.READ_FRAMEBUFFER,null);break;default:t.bindFramebuffer(t.FRAMEBUFFER,null);break}}}h.H0=0,e.default=h},"6e01":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static Clamp(t,e,i){return Math.max(Math.min(t,i),e)}static IsPowerOf2(t){return 0==(t&t-1)}static CalcCeilPowerOfTwo(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}static CalcNearestCeilPow2(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))}static CalcFloorCeilPow2(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}static DegreeToRadian(t){return s.MATH_PI_OVER_180*t}static Log2(t){return Math.log(t)/Math.LN2}static GetMaxMipMapLevel(t,e){return Math.round(s.Log2(Math.max(t,e))+1)}static SafeACos(t){return t<=-1?s.MATH_PI:t>=1?0:Math.acos(t)}static GetNearestCeilPow2(t){let e=1;while(e<t)e<<=1;return e}static GetMinRadian(t,e){return e%=s.MATH_2PI,t%=s.MATH_2PI,e<t?(e=s.MATH_2PI-t+e,e>s.MATH_PI?e-s.MATH_2PI:e):e>t?(t=s.MATH_2PI-e+t,t>s.MATH_PI?s.MATH_2PI-t:-t):0}static GetMinDegree(t,e){let i=0;return e>=270&&t<90?i=(e-(t+360))%180:e<=90&&t>=270?i=(e+360-t)%180:(i=e-t,i>180?(i-=360,i%=360):i<-180&&(i+=360,i%=360)),i}static GetDegreeByXY(t,e){if(Math.abs(t)<1e-5)return e>=0?270:90;let i=180*Math.atan(e/t)/Math.PI;return t>=0?i:180+i}static GetRadianByXY(t,e){if(Math.abs(t)<s.MATH_MIN_POSITIVE)return e>=0?s.MATH_1PER2PI:s.MATH_3PER2PI;let i=Math.atan(e/t);return t>=0?i:s.MATH_PI+i}static GetRadianByCos(t,e,i){var r=Math.acos(t);return e>=0?r:s.MATH_PI+r}}s.MATH_MIN_POSITIVE=1e-5,s.MATH_MAX_NEGATIVE=-1e-5,s.MATH_MAX_POSITIVE=268435454,s.MATH_MIN_NEGATIVE=-268435454,s.MATH_1_OVER_255=1/255,s.MATH_PI=Math.PI,s.MATH_2PI=2*s.MATH_PI,s.MATH_3PER2PI=1.5*s.MATH_PI,s.MATH_1PER2PI=.5*s.MATH_PI,s.MATH_1_OVER_PI=1/s.MATH_PI,s.MATH_1_OVER_360=1/360,s.MATH_1_OVER_180=1/180,s.MATH_180_OVER_PI=180/s.MATH_PI,s.MATH_PI_OVER_180=s.MATH_PI/180,s.MATH_LN2=.6931471805599453,e.default=s},7045:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.phase=0,this.type=s.KEY_DOWN,this.target=null,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.repeat=!1,this.key="",this.keyCode=0,this.location=0}getClassType(){return s.EventClassType}toString(){return"[KeyboardEvent]"}}s.EventClassType=1003,s.KEY_DOWN=6001,s.KEY_UP=6002,e.default=s},"70f2":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("8e17")),n=s(i("0236")),l=s(i("c51d")),h=s(i("af68")),o=s(i("a80a")),m=s(i("a446")),_=s(i("c711")),u=s(i("955e")),d=s(i("765c")),c=s(i("af29"));class f{constructor(t,e,i){this.T=-1,this.AE=null,this.d=null,this.AV=null,this.w_=null,this.B_m=null,this.DW=new Uint8Array(128),this.DX=0,this.DY=null,this.DZ=new a.default,this.Da=new a.default,this.Db=null,this.Dc=!1,this.Dd=null,this.De=!0,this.A_=null,this.B=0,this.C=0,this.D=800,this.E=800,this.Df=null,this.Dg=null,this.Dh=!0,this.Di=null,this.A_9=null,this.A_6=null,this.Dj=-1,this.Dk=!0,this.Dl=null,this.BA=!0,this.textureBlock=null,this.Dm=[],this.Dn=0,this.Do=!0,this.Dp=!0,this.Dq=!0,this.Dr=!0,this.Dc=i,this.B_m=t,this.w_=e,this.A_6=e.getDataBuilder().getRenderShader(),this.T=1024+f.__s_uid++}enable(){this.BA=!0}disable(){this.BA=!1}isEnabled(){return this.BA}getUid(){return this.T}getRPONodeBuilder(){return null}getRenderProxy(){return this.d}setViewPort(t,e,i,s){null!=this.d&&(this.B=t,this.C=e,this.D=i,this.E=s)}reseizeViewPort(){this.d.reseizeRCViewPort()}getRendererAdapter(){return this.AE}getRenderer(){return this.w_}getRendererContext(){return this.AV}getStage3D(){return this.d.getStage3D()}getCurrentStage3D(){return this.Dl}getCamera(){return this.A_}getRendererStatus(){return this.w_.getRendererStatus()}getMouseXYWorldRay(t,e){this.A_.getWorldPickingRayByScreenXY(this.A_9.mouseX,this.A_9.mouseY,t,e)}createCamera(){return new l.default}createFBOInstance(){return new c.default(this,this.textureBlock.getRTTStrore())}setEvt3DController(t){null!=t&&(null==this.Dl&&(this.Dl=new n.default(this.d.getRCUid(),null)),t.initialize(this.getStage3D(),this.Dl),t.setRaySelector(this.DY.getRaySelector())),this.Dd=t}isRayPickSelected(){return null!=this.Dd&&this.Dd.isSelected()}enableMouseEvent(t=!0){null==this.Dd&&(t?this.DY.setRaySelector(new u.default):this.DY.setRaySelector(new _.default),this.setEvt3DController(new d.default)),this.De=!0}disableMouseEvent(){this.De=!1}getEvt3DController(){return this.Dd}getSpace(){return this.DY}getDevicePixelRatio(){return this.AE.getDevicePixelRatio()}addEventListener(t,e,i,s=!0,r=!1){this.Dl.addEventListener(t,e,i,s,r)}removeEventListener(t,e,i){this.Dl.removeEventListener(t,e,i)}setAccessor(t){this.Db=t}initialize(t,e=3,i=!0){if(null==this.d){e<1&&(e=1),e>8&&(e=8),this.Di=t,this.Dh=t.cameraPerspectiveEnabled;let s=null;for(;e>=0;)s=this.w_.appendProcess(t.batchEnabled,t.processFixedState),this.DW[this.DX]=s.getRPIndex(),this.DX++,--e;this.AV=this.w_.getRendererContext(),this.d=this.AV.getRenderProxy(),this.AE=this.d.getRenderAdapter(),this.A_9=this.d.getStage3D(),this.B=this.A_9.getViewX(),this.C=this.A_9.getViewY(),this.D=this.A_9.getViewWidth(),this.E=this.A_9.getViewHeight(),i?this.createMainCamera():this.A_=this.d.getCamera(),null==this.DY&&(this.DY=new m.default,this.DY.initialize(this.w_,this.A_))}}createMainCamera(){this.A_=new l.default,this.A_.setViewXY(this.B,this.C),this.A_.setViewSize(this.D,this.E);let t=this.Di.camProjParam;this.Dh?this.A_.perspectiveRH(r.default.DegreeToRadian(t.x),this.D/this.E,t.y,t.z):this.A_.orthoRH(t.y,t.z,-.5*this.E,.5*this.E,-.5*this.D,.5*this.D),this.A_.lookAtRH(this.Di.camPosition,this.Di.camLookAtPos,this.Di.camUpDirect),this.A_.update()}cameraLock(){this.A_.lock()}cameraUnlock(){this.A_.unlock()}updateRenderBufferSize(){this.AE.updateRenderBufferSize()}setRendererProcessParam(t,e,i){this.w_.setRendererProcessParam(this.DW[t],e,i)}appendARendererProcess(t=!0,e=!1){let i=this.w_.appendProcess(t,e);this.DW[this.DX]=i.getRPIndex(),this.DX++}getRenderProcessAt(t){return this.w_.getProcessAt(this.DW[t])}addContainer(t,e=0){if(e<0&&(e=0),null!=t&&t.__$wuid<0&&t.__$contId<1){let i=0;for(;i<this.Dn;++i)if(this.Dm[i]==t)return;i>=this.Dn&&(t.__$wuid=this.T,t.wprocuid=e,t.__$setRenderer(this),this.Dm.push(t),this.Dn++)}}removeContainer(t){if(null!=t&&t.__$wuid==this.T&&t.getRenderer()==this.w_){let e=0;for(;e<this.Dn;++e)if(this.Dm[e]==t){t.__$wuid=-1,t.wprocuid=-1,t.__$setRenderer(null),this.Dm.splice(e,1),--this.Dn;break}}}setAutoRunningEnabled(t){this.Dk=t}moveEntityTo(t,e){this.w_.moveEntityToProcessAt(t,this.DW[e])}drawEntity(t,e=!1,i=!0){this.w_.drawEntity(t,e,i)}addEntity(t,e=0,i=!0){if(null!=t&&t.__$testSpaceEnabled())if(t.isPolyhedral())if(t.hasMesh())this.w_.addEntity(t,this.DW[e],i),null!=this.DY&&this.DY.addEntity(t);else{null==this.Df&&(this.Df=new o.default,this.Dg=new h.default);let i=this.Dg.addEntity(t);i.rstatus=e,this.Df.addNode(i)}else this.w_.addEntity(t,this.DW[e],i),null!=this.DY&&this.DY.addEntity(t)}removeEntity(t){if(null!=t){let e=null;if(null!=this.Df){let e=this.Dg.getNodeByEntity(t);null!=e&&(this.Df.removeNode(e),this.Dg.removeEntity(t))}null==e&&(this.w_.removeEntity(t),null!=this.DY&&this.DY.removeEntity(t))}}updateMaterialUniformToCurrentShd(t){this.w_.updateMaterialUniformToCurrentShd(t)}drawEntityByLockMaterial(t){this.w_.drawEntityByLockMaterial(t)}showInfoAt(t){this.w_.showInfoAt(t)}updateCameraData(t){this.AV.updateCameraDataFromCamera(this.d.getCamera())}renderBegin(t=!1){t&&this.AV.renderBegin(),this.d.getCamera()!=this.A_&&(this.d.isAutoSynViewAndStage()&&(this.B=this.d.getViewX(),this.C=this.d.getViewY(),this.D=this.d.getViewWidth(),this.E=this.d.getViewHeight()),this.A_.setViewXY(this.B,this.C),this.A_.setViewSize(this.D,this.E),this.d.setRCViewPort(this.B,this.C,this.D,this.E,this.d.isAutoSynViewAndStage()),this.d.reseizeRCViewPort()),this.A_.update(),this.AV.updateCameraDataFromCamera(this.A_),this.A_6.renderBegin(),null!=this.Db&&this.Db.renderBegin(this)}runBegin(t=!0,e=!1){t&&this.Dk&&(this.Dj>=0&&this.runEnd(),this.Dj=0),this.renderBegin(e),null!=this.DY&&(this.DY.setCamera(this.A_),this.DY.runBegin())}setRayTestEanbled(t){this.Dr=t}runMouseTest(t,e){let i=-1;if(null!=this.Dd&&this.De){if(this.Dq&&this.Dd.getEvtType()>0){let t=this.DY.getRaySelector();if(null!=t){this.Dr?this.mouseRayTest():t.clear();let e=t.getSelectedNodesTotal();if(e>1){let i=0,s=t.getSelectedNodes(),r=null;for(;i<e;++i)r=s[i],r.entity.isPolyhedral()}}this.Dq=!1}i=this.Dd.run(t,e)}return this.Do=!1,i}update(t=!0,e=!0){if(null!=this.Dl&&this.Dl.enterFrame(),t&&this.Dk&&(0!=this.Dj&&this.runBegin(),this.Dj=1),this.Do=!0,this.Dp=!0,this.Dq=!0,null!=this.Df){let t=this.Df.getBegin();if(null!=t){let e,i,s;while(null!=t)t.entity.hasMesh()?(e=t,t=t.next,i=e.entity,s=e.rstatus,this.Df.removeNode(e),this.Dg.removeEntity(e.entity),this.addEntity(i,s)):t=t.next}}let i=0;for(;i<this.Dn;++i)this.Dm[i].update();null!=this.DY&&this.DY.update(),null!=this.DY&&this.Dp&&(null==this.Dd&&null==this.DY.getRaySelector()||this.DY.run()),this.Do&&!this.Dc&&(e?this.runMouseTest(1,0):null!=this.Dd&&this.Dd.mouseOutEventTarget())}cullingTest(){null!=this.DY&&this.DY.run(),this.Dp=!1}mouseRayTest(){null!=this.DY&&(this.getMouseXYWorldRay(this.Da,this.DZ),this.DY.rayTest(this.Da,this.DZ))}run(t=!1){if(this.BA){t&&this.Dk&&(1!=this.Dj&&this.update(),this.Dj=2);for(let t=0;t<this.DX;++t)this.w_.runAt(this.DW[t]);t&&this.runEnd()}}runAt(t){this.w_.runAt(this.DW[t])}runEnd(){null!=this.Dd&&this.Dd.runEnd(),null!=this.DY&&this.DY.runEnd(),this.Dk&&(this.Dj=-1),null!=this.Db&&this.Db.renderEnd(this)}useCamera(t,e=!1){this.B_m.useCamera(t,e)}useMainCamera(){this.B_m.useMainCamera()}updateCamera(){null!=this.A_&&this.A_.update()}setClearUint24Color(t,e=1){this.d.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,i){this.d.setClearRGBColor3f(t,e,i)}setClearRGBAColor4f(t,e,i,s){this.d.setClearRGBAColor4f(t,e,i,s)}setClearColor(t){this.d.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.d.setRenderToBackBuffer()}toString(){return"[RendererSubScene(uid = "+this.T+")]"}}f.__s_uid=0,e.default=f},"710f":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){if(this.Ds=[],this.Dt=[],null!=s.H5)throw Error("ROVtxBufUidStore is a singleton class!!");s.H5=this}static GetInstance(){return s.H5}__$getRemovedListLen(){return this.Dt.length}__$getRemovedList(){return this.Dt}__$attachAt(t){if(t<this.Ds.length)++this.Ds[t];else{let e=this.Ds.length;for(;e<=t;++e)this.Ds.push(0);++this.Ds[t]}}__$detachAt(t){--this.Ds[t],this.Ds[t]<1&&(this.Ds[t]=0,this.Dt.push(t))}getAttachCountAt(t){return t<this.Ds.length?this.Ds[t]:0}getAttachAllCount(){let t=0,e=0,i=this.Ds.length;for(;e<i;++e)this.Ds[e]>0&&(t+=this.Ds[e]);return t}}s.H5=null,e.default=s},7181:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.width=0,this.height=0,this.data=null,this.miplevel=0,this.status=1,this.offsetx=0,this.offsety=0}updateToGpu(t,e,i,s,r,a){1==this.status||a?t.texImage2D(e,this.miplevel,i,s,r,this.data):0==this.status&&t.texSubImage2D(e,this.miplevel,this.offsetx,this.offsety,s,r,this.data),this.status=-1}static Create(){return s.H_q.length>0?s.H_q.pop():new s}static Restore(t){null!=t&&(t.data=null,s.H_q.push(t))}}s.H_q=[],e.default=s},"722e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.NEAREST=4001,s.LINEAR=4002,s.LINEAR_MIPMAP_LINEAR=4003,s.NEAREST_MIPMAP_NEAREST=4004,s.LINEAR_MIPMAP_NEAREST=4005,s.NEAREST_MIPMAP_LINEAR=4006,e.default=s},"725b":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("8d98"),a=s(i("fe7f")),n=s(i("3b73"));class l{constructor(){this.width=4,this.height=4,this.x=0,this.y=0,this.uvs=new Float32Array(8)}toString(){return"FontTexCharGrid(x="+this.x+",y="+this.y+",width="+this.width+",height="+this.height+")"}}class h{constructor(){this.g=512,this.h=256,this.Du=new Map,this.layoutDataStr="",this.Dv=0,this.Dw=0,this.Dx=0,this.Dy=0}initialize(t,e){this.g=t,this.h=e}addCharsByRawData(t,e){let i=0,s=0,r=e.split(","),a=r.length/4;for(;i<a;++i)s=4*i,this.addUV8RawDataFromChar(t.charAt(i),parseInt(r[s]),parseInt(r[s+1]),parseInt(r[s+2]),parseInt(r[s+3]))}addUV8RawDataFromChar(t,e,i,s,r){if(null==this.Du.get(t)){let a=new l,n=a.uvs,h=this.g,o=this.h;this.Dv=e/h,this.Dw=i/o,this.Dx=(e+s)/h,this.Dy=(i+r)/o,n[0]=this.Dv,n[1]=this.Dy,n[2]=this.Dx,n[3]=this.Dy,n[4]=this.Dx,n[5]=this.Dw,n[6]=this.Dv,n[7]=this.Dw,a.x=e,a.y=i,a.width=s,a.height=r,this.Du.set(t,a)}}getGridByChar(t){return this.Du.get(t)}getUV8FromChar(t,e,i=0){let s=this.Du.get(t);null==s&&(s=this.Du.get("?")),e.set(s.uvs,i)}getVtxFromChar(t,e,i=0){let s=this.Du.get(t);null==s&&(s=this.Du.get("?"));let r=[0,0,0,s.width,0,0,s.width,s.height,0,0,s.height,0];e.set(r,i)}getUV8AndVtxFromChar(t,e,i,s=0,r=0){let a=this.Du.get(t);null==a&&(a=this.Du.get("?")),e.set(a.uvs,s);let n=[0,0,0,a.width,0,0,a.width,a.height,0,0,a.height,0];i.set(n,r)}getUV8AndSizeFromChar(t,e,i,s=0){let r=this.Du.get(t);null==r&&(r=this.Du.get("?")),e.set(r.uvs,s),i[0]=r.width,i[1]=r.height}getUV8AndOffsetXYVtxFromChar(t,e,i,s=0,r=0,a=0,n=0){let l=this.Du.get(t);null==l&&(l=this.Du.get("?")),e.set(l.uvs,a);let h=[s,r,0,s+l.width,r,0,s+l.width,r+l.height,0,s,r+l.height,0];i.set(h,n)}}e.FontTexCharTable=h;class o{constructor(){this.Dz=0,this.D0=0,this.D1="",this.D2=null,this.pixMinPos={x:0,y:0},this.pixMaxPos={x:0,y:0},this.canvas=null,this.ctx2d=null,this.D3=0,this.charTexWidth=0,this.px=0,this.py=0,this.ph=0,this.linedis=2,this.charHDis=1,this.tx=0,this.char="",this.meao=null}setFontCharTable(t){this.D2=t}textFilte(t){let e=t.length,i="",s="";for(let r=0;r<e;++r)s=t.charAt(r),this.D1.indexOf(s)<0&&i.indexOf(s)<0&&(i+=s);return i}crateTextUVData(t,e,i,s=18){this.D1+=t;let r=this.ctx2d;this.D0<2&&(this.D0=s),this.charTexWidth=0,r.textAlign="left",r.fillStyle="white",r.font=s+"px Arial";let a=t.length;this.pixMinPos.x=2e4,this.pixMinPos.y=2e4,this.pixMaxPos.x=-2e4,this.pixMaxPos.y=-2e4,this.ph=s+8;for(let n=0;n<a;n++)this.char=t.charAt(n),this.meao=r.measureText(this.char),this.charTexWidth=Math.floor(this.meao.width)+1,this.tx=this.Dz+this.charTexWidth,this.tx<e?(r.fillText(this.char,this.Dz,this.D0),this.D3=this.D0-s,this.pixMinPos.x>this.Dz&&(this.pixMinPos.x=this.Dz),this.pixMinPos.y>this.D3&&(this.pixMinPos.y=this.D3),this.px=this.Dz+this.charTexWidth,this.py=this.D3+this.ph,this.pixMaxPos.x<this.px&&(this.pixMaxPos.x=this.px),this.pixMaxPos.y<this.py&&(this.pixMaxPos.y=this.py),this.D2.addUV8RawDataFromChar(this.char,this.Dz,this.D3+1,this.charTexWidth,this.ph),this.Dz=this.tx+this.charHDis):(this.Dz=0,this.D0+=this.ph+this.linedis,r.fillText(this.char,this.Dz,this.D0),this.D3=this.D0-s,this.pixMinPos.x>this.Dz&&(this.pixMinPos.x=this.Dz),this.pixMinPos.y>this.D3&&(this.pixMinPos.y=this.D3),this.px=this.Dz+this.charTexWidth,this.py=this.D3+this.ph,this.pixMaxPos.x<this.px&&(this.pixMaxPos.x=this.px),this.pixMaxPos.y<this.py&&(this.pixMaxPos.y=this.py),this.D2.addUV8RawDataFromChar(this.char,this.Dz,this.D3+1,this.charTexWidth,this.ph),this.Dz+=this.charTexWidth)}}e.FontTexDataBuilder=o;class m{constructor(){this.g=512,this.h=256,this.D_=null,this.C_K=null,this.D4=null,this.D5=18,this.D2=new h,this.D6=new o,this.d=null,this.mobileEnabled=!0,this.D7=0,this.D8=0,this.D9=null}setRenderProxy(t){null!=t&&(this.d=t,null!=this.D4&&this.D4.__$setRenderProxy(t))}isEnabled(){return null!=this.D_}getFontSize(){return this.D5}initialize(t,e=10,i=512,s=512,l=!1,h=!1){if(this.mobileEnabled&&n.default.IsMobileWeb()&&(e*=2,i=s*=2),null==this.D_){i<32&&(i=32),s<32&&(s=32),this.g=i,this.h=s,e<10&&(e=10),this.D5=e;var o=null;try{void 0!=document&&(o=document)}catch(m){}this.D_=o.getElementById(t),null==this.D_&&(this.D_=document.createElement("canvas"),this.D_.style.width="128px",this.D_.style.height="128px",this.D_.style.display="bolck",this.D_.style.overflow="hidden",this.D_.style.left="0px",this.D_.style.top="0px",this.D_.style.position="absolute",this.D_.style.backgroundColor="transparent",this.D_.style.pointerEvents="none"),this.D_.width=i,this.D_.height=s,l?(document.body.appendChild(this.D_),this.D_.style.visibility="visible"):this.D_.style.visibility="hidden",this.C_K=this.D_.getContext("2d"),this.D6.canvas=this.D_,this.D6.ctx2d=this.C_K,this.D6.setFontCharTable(this.D2),this.D2.initialize(this.g,this.h),this.D4=new a.default(this.g,this.h),this.D4.__$setRenderProxy(this.d),this.D4.toAlphaFormat(),this.D4.mipmapEnabled=h,this.D4.minFilter=r.TextureConst.LINEAR,this.D4.magFilter=r.TextureConst.NEAREST,this.createInitTexAndChars()}}setStyleSize(t,e){null!=this.D_&&(this.D7==t&&this.D8==e||(this.D7=t,this.D8=e,this.D_.style.width=t+"px",this.D_.style.height=e+"px"))}setCanvasVisible(t){this.D_.style.visibility=t?"visible":"hidden"}getUV8FromChar(t,e,i=0){this.D2.getUV8FromChar(t,e,i)}getCharTable(){return this.D2}createCharsTexFromStr(t){if(t=this.D6.textFilte(t),t.length<1)return;let e=t;this.D6.crateTextUVData(e,this.g,this.h,this.D5);let i=0,s=0,r=0,a=0,n=0,l=this.D6.pixMaxPos.x-this.D6.pixMinPos.x,h=this.D6.pixMaxPos.y-this.D6.pixMinPos.y,o=this.C_K.getImageData(this.D6.pixMinPos.x,this.D6.pixMinPos.y,l,h),m=o.data,_=new Uint8Array(l*h),u=this.D6.pixMinPos.x,d=this.D6.pixMinPos.y;for(s=0;s<h;++s)for(r=0;r<l;++r)n=(s+d)*this.g+(u+r),i=4*(s*l+r),this.D9[n]=m[i+3],_[a]=this.D9[n],a++;this.D4.setPartDataFromeBytes(_,this.D6.pixMinPos.x,this.D6.pixMinPos.y,l,h),this.D4.updateDataToGpu()}createInitTexAndChars(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890~`!@#$%^&*()_+-={}[]:\";\\|'<>,.?/\n ",e=t;this.D6.crateTextUVData(e,this.g,this.h,this.D5);let i=this.C_K.getImageData(0,0,this.g,this.h),s=i.data,r=0,a=0,n=0;this.D9=new Uint8Array(this.g*this.h);let l=0;for(r=0;r<this.h;++r)for(a=0;a<this.g;++a)n=4*(r*this.g+a),this.D9[l]=s[n+3],l++;this.D4.setDataFromBytes(this.D9,0,this.g,this.h)}getTextureAt(t=0){return this.D4}static GetInstance(){return null!=m.H5||(m.H5=new m),m.H5}}m.H5=null,e.default=m},7279:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("5326")),a=s(i("3b73")),n=s(i("d53d"));class l extends n.default{constructor(){super(),this.slotId=0,this.slotIndex=0,this.uniformsTotal=0,this.locationIndexList=null,this.locations=null,this.rst=0,this.always=!1}clone(){let t=new l;return t.types=this.types.slice(0),t.uniformNameList=this.uniformNameList.slice(0),t.dataSizeList=this.dataSizeList.slice(0),t.slotIndex=this.slotIndex,t.uniformsTotal=this.uniformsTotal,t.slotId=this.slotId,t.always=this.always,t.rst=this.rst,t}copyDataFromProbe(t){this.types=t.uniformTypes.slice(0),this.dataSizeList=t.dataSizeList.slice(0),this.slotIndex=t.getSlotBeginIndex(),this.uniformsTotal=t.uniformsTotal,this.slotId=t.getSlotUid()}copyDataFromProbeAt(t,e){null==this.types&&(this.types=[],this.dataSizeList=[]),this.slotIndex=e.getSlotBeginIndex()+t,this.uniformsTotal=1,this.slotId=e.getSlotUid(),this.types[0]=e.uniformTypes[t],this.dataSizeList[0]=e.dataSizeList[t]}use(t){let e=r.default.GetSlotAt(t.getRCUid());if(this.always||this.rst!=e.flagList[this.slotIndex]){this.rst=e.flagList[this.slotIndex];let i=0;if(a.default.IsWebGL1())for(;i<this.uniformsTotal;++i)t.useUniformV1(this.locations[i],this.types[i],e.dataList[this.slotIndex+i],this.dataSizeList[i]);else for(;i<this.uniformsTotal;++i)t.useUniformV2(this.locations[i],this.types[i],e.dataList[this.slotIndex+i],this.dataSizeList[i],0)}}destroy(){this.types=null,this.dataSizeList=null,this.slotIndex=-1,this.uniformsTotal=0}}e.default=l},7499:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.D_A=null,this.A_6=null,this.B8=null}setDispBuilder(t){null==this.D_A&&(this.D_A=t,this.A_6=t.getRenderShader(),this.B8=t.getTextureResource())}unlockMaterial(){this.A_6.unlock(),this.B8.unlocked=!0}lockMaterial(){this.A_6.lock(),this.B8.unlocked=!1}isUnlockMatrial(){return this.B8.unlocked}unlockTexture(){this.A_6.textureUnlock()}lockTexture(){this.A_6.textureLock()}renderBegin(){this.A_6.renderBegin(),this.B8.renderBegin()}resetUniform(){this.A_6.resetUniform()}useGlobalMaterial(t,e=!1){null!=t&&this.D_A.updateGlobalMaterial(t,e)}updateMaterialUniform(t){this.A_6.updateUniform(t.__$uniform)}}e.default=s},"74c3":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t,e,i){this.D_B=new Map,this.D_C=new Map,this.D_D=[],this.D_E=0,this.D_F=0,this.D_G=128,this.B_C=!1,this.D_H=16,this.A=0,this.J_=null,this.D_I=null,this.unlocked=!0,this.A=t,this.J_=e,this.D_I=i}setVtxUpdateTimesTotal(t){this.D_H=t>4?t:4}createResByParams3(t,e,i,s){return!1}getRCUid(){return this.A}getRC(){return this.J_}hasResUid(t){return this.D_B.has(t)}bindToGpu(t){}getGpuBuffer(t){return null}renderBegin(){this.D_I.renderBegin()}getVertexResTotal(){return this.D_E}updateDataToGpu(t,e){e?(this.D_D.push(t),this.B_C=!0):this.D_B.has(t)&&this.D_B.get(t).updateToGpu(this.D_I)}addVertexRes(t){this.D_B.has(t.resUid)||(t.waitDelTimes=0,this.D_B.set(t.resUid,t),this.D_E++)}getVertexRes(t){return this.D_B.get(t)}destroyRes(t){this.D_B.has(t)&&this.D_B.get(t).destroy(this.D_I)}__$attachRes(t){if(this.D_B.has(t)){this.D_F++;let e=this.D_B.get(t);e.getAttachCount()<1&&this.D_C.has(t)&&this.D_C.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.D_B.has(t)&&this.D_B.has(t)){let e=this.D_B.get(t);e.getAttachCount()>0&&(this.D_F--,e.__$detachThis(),e.getAttachCount()<1&&this.D_C.set(t,e))}}getVROByResUid(t,e,i){let s=this.D_B.get(t);return null!=s?s.createVRO(this.D_I,e,i):null}update(){if(this.B_C){let t=this.D_D.length;if(t>0){let e;t>this.D_H&&(t=this.D_H);for(let i=0;i<t;++i)e=this.D_D.shift(),this.D_B.has(e)&&this.D_B.get(e).updateToGpu(this.D_I)}else this.B_C=!1}if(this.D_G--,this.D_G<1){this.D_G=128;for(const[t,e]of this.D_C)e.waitDelTimes++,e.getAttachCount()<1?e.waitDelTimes>5&&(this.D_B.delete(e.resUid),this.D_C.delete(e.resUid),e.destroy(this.D_I),this.D_E--):this.D_C.delete(e.resUid)}}}e.ROVertexResource=s,e.default=s},"765c":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("1710"));class a{constructor(){this.T=0,this.D_J=null,this.D_K=null,this.D_L=null,this.D_M=!0,this.Q=new r.default,this.D_N=new r.default,this.D_O=new r.default,this.D_P=new Float32Array(64),this.D_Q=new Float32Array(64),this.D_R=new Float32Array(64),this.D_S=new Float32Array(64),this.D_T=0,this.D_U=null,this.D_V=null,this.D_W=-1,this.T=a.H0++}initialize(t,e){null==this.D_J&&(this.D_J=t,this.D_K=e,t.addEventListener(r.default.MOUSE_DOWN,this,this.mouseDownListener,!0,!1),t.addEventListener(r.default.MOUSE_UP,this,this.mouseUpListener,!0,!1),t.addEventListener(r.default.MOUSE_CLICK,this,this.mouseClickListener,!0,!1),t.addEventListener(r.default.MOUSE_MOVE,this,this.mouseMoveListener,!0,!1),t.addEventListener(r.default.MOUSE_WHEEL,this,this.mouseWheeelListener,!0,!1))}setRaySelector(t){this.D_L=t}mouseWheeelListener(t){null!=this.D_K&&(this.D_K.mouseX=this.D_J.mouseX,this.D_K.mouseY=this.D_J.mouseY),this.D_P[this.D_T]=t.type,this.D_Q[this.D_T]=t.mouseX,this.D_R[this.D_T]=t.mouseY,this.D_S[this.D_T]=t.wheelDeltaY,this.Q.type=t.type,this.D_T++}mouseMoveListener(t){null!=this.D_K&&(this.D_K.mouseX=this.D_J.mouseX,this.D_K.mouseY=this.D_J.mouseY),this.D_P[this.D_T]=t.type,this.D_Q[this.D_T]=t.mouseX,this.D_R[this.D_T]=t.mouseY,this.D_S[this.D_T]=0,this.Q.type=t.type,this.D_T++}mouseDownListener(t){null!=this.D_K&&(this.D_K.mouseX=this.D_J.mouseX,this.D_K.mouseY=this.D_J.mouseY),a.H_r&&(this.D_P[this.D_T]=t.type,this.D_Q[this.D_T]=t.mouseX,this.D_R[this.D_T]=t.mouseY,this.D_S[this.D_T]=0,this.Q.type=t.type,this.D_T++)}mouseUpListener(t){null!=this.D_K&&(this.D_K.mouseX=this.D_J.mouseX,this.D_K.mouseY=this.D_J.mouseY),a.H_r&&(this.D_P[this.D_T]=t.type,this.D_Q[this.D_T]=t.mouseX,this.D_R[this.D_T]=t.mouseY,this.D_S[this.D_T]=0,this.Q.type=t.type,this.D_T++)}mouseClickListener(t){null!=this.D_K&&(this.D_K.mouseX=this.D_J.mouseX,this.D_K.mouseY=this.D_J.mouseY),a.H_r&&(this.D_P[this.D_T]=t.type,this.D_Q[this.D_T]=t.mouseX,this.D_R[this.D_T]=t.mouseY,this.D_S[this.D_T]=0,this.Q.type=t.type,this.D_T++)}mouseOutEventTarget(){if(null!=this.D_K&&(this.D_K.mouseX=this.D_J.mouseX,this.D_K.mouseY=this.D_J.mouseY),null!=this.D_U){let t=this.D_U.getEvtDispatcher(r.default.EventClassType);if(null!=t)return this.D_O.phase=this.D_W,this.D_O.type=r.default.MOUSE_OUT,this.D_O.mouseX=this.Q.mouseX,this.D_O.mouseY=this.Q.mouseY,this.D_O.target=this.D_U,this.D_L.getRay(this.D_O.raypv,this.D_O.raytv),this.D_U=null,t.dispatchEvt(this.D_O);this.D_U=null}return 0}run(t,e){let i=-1;if(this.D_M){this.D_W=t;let s=0;i=this.D_T>0?0:-1;let n,l,h,o=null;if(i>-1){if(this.D_K!=this.D_J&&null!=this.D_K){for(a.H_r=!1,s=0;s<this.D_T;s++)switch(this.D_P[s]){case r.default.MOUSE_DOWN:this.D_K.mouseDown(1);break;case r.default.MOUSE_UP:this.D_K.mouseUp(1);break;case r.default.MOUSE_MOVE:this.D_K.mouseMove();break;default:break}a.H_r=!0}if(n=e<1?this.D_L.getSelectedNode():null,null!=n){l=n.lpv,h=n.wpv;let e=n.entity;o=e.getEvtDispatcher(r.default.EventClassType);let s=e.__$getParent(),a=null!=s&&s.mouseEnabled;a||(i+=this.mouseOutContainer(t,null,null,null),this.D_V=null);let m=this.D_U;for(let _=0;_<this.D_T;_++)this.Q.type=this.D_P[_],this.Q.mouseX=this.D_Q[_],this.Q.mouseY=this.D_R[_],this.Q.wheelDeltaY=this.D_S[_],this.Q.type>0&&null!=n&&null!=o&&(this.Q.target=e,this.Q.currentTarget=e,this.Q.phase=t,this.Q.lpos.copyFrom(l),this.Q.wpos.copyFrom(h),this.D_L.getRay(this.Q.raypv,this.Q.raytv),i+=this.mouseOutEntity(t,e,l,h),this.D_U!=e&&(this.D_N.phase=t,this.D_N.type=r.default.MOUSE_OVER,this.D_N.mouseX=this.Q.mouseX,this.D_N.mouseY=this.Q.mouseY,this.D_N.target=e,this.D_N.currentTarget=e,this.D_N.lpos.copyFrom(l),this.D_N.wpos.copyFrom(h),this.D_L.getRay(this.D_N.raypv,this.D_N.raytv),i+=o.dispatchEvt(this.D_N)),i+=o.dispatchEvt(this.Q),this.D_U=e);if(a){null!=m&&null==m.__$getParent()&&(this.D_U=m,i+=this.mouseOutEntity(t,null,null,null),this.D_U=null);for(let a=0;a<this.D_T;a++)this.Q.type=this.D_P[a],this.Q.mouseX=this.D_Q[a],this.Q.mouseY=this.D_R[a],this.Q.wheelDeltaY=this.D_S[a],this.Q.type>0&&null!=n&&(this.Q.target=s,this.Q.currentTarget=e,this.Q.phase=t,this.Q.lpos.copyFrom(l),this.Q.wpos.copyFrom(h),this.D_L.getRay(this.Q.raypv,this.Q.raytv),i+=this.mouseOutContainer(t,s,l,h),this.D_V!=s&&(this.D_N.phase=t,this.D_N.type=r.default.MOUSE_OVER,this.D_N.mouseX=this.Q.mouseX,this.D_N.mouseY=this.Q.mouseY,this.D_N.target=s,this.D_N.currentTarget=e,this.D_N.lpos.copyFrom(l),this.D_N.wpos.copyFrom(h),this.D_L.getRay(this.D_N.raypv,this.D_N.raytv),i+=s.dispatchEvt(this.D_N)),i+=s.dispatchEvt(this.Q),this.D_V=s)}}else if(this.mouseOutEntity(t,null,null,null),this.mouseOutContainer(t,null,null,null),this.D_U=null,this.D_V=null,i+=this.mouseOutEventTarget(),null!=this.D_K)for(s=0;s<this.D_T;s++)switch(this.D_P[s]){case r.default.MOUSE_DOWN:this.D_K.mouseBgDown();break;case r.default.MOUSE_UP:this.D_K.mouseBgUp();break;case r.default.MOUSE_CLICK:this.D_K.mouseBgClick();break;default:break}if(null!=this.D_K){for(a.H_r=!1,s=0;s<this.D_T;s++)switch(this.D_P[s]){case r.default.MOUSE_DOWN:this.D_K.mouseDown(2);break;case r.default.MOUSE_UP:this.D_K.mouseUp(2);break;default:break}a.H_r=!0}}0==i&&null!=o&&(i=o.passTestPhase(t))}return i>0?1:0}mouseOutEntity(t,e,i,s){if(null!=this.D_U&&this.D_U!=e){let e=this.D_U.getEvtDispatcher(r.default.EventClassType);if(null!=e)return this.D_O.phase=t,this.D_O.type=r.default.MOUSE_OUT,this.D_O.mouseX=this.Q.mouseX,this.D_O.mouseY=this.Q.mouseY,this.D_O.target=this.D_U,this.D_N.currentTarget=this.D_U,null!=i&&this.D_O.lpos.copyFrom(i),null!=s&&this.D_O.wpos.copyFrom(s),this.D_L.getRay(this.D_O.raypv,this.D_O.raytv),e.dispatchEvt(this.D_O)}return 0}mouseOutContainer(t,e,i,s){return null!=this.D_V&&this.D_V!=e?(this.D_O.phase=t,this.D_O.type=r.default.MOUSE_OUT,this.D_O.mouseX=this.Q.mouseX,this.D_O.mouseY=this.Q.mouseY,this.D_O.target=this.D_V,this.D_O.currentTarget=null,null!=i&&this.D_O.lpos.copyFrom(i),null!=s&&this.D_O.wpos.copyFrom(s),this.D_L.getRay(this.D_O.raypv,this.D_O.raytv),this.D_V.dispatchEvt(this.D_O)):0}runEnd(){this.D_T=0,this.Q.type=0}reset(){this.D_T=0}getEvtType(){return this.Q.type}isSelected(){return null!=this.D_L.getSelectedNode()}lock(){this.D_M=!1}unlock(){this.D_M=!0}isUnlock(){return this.D_M}}a.H_r=!0,a.H0=0,e.default=a},7696:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("264c")),a=s(i("5f3c"));class n{constructor(t,e,i,s,r,a){this.A=-1,this.D_X=-1,this.D_Y=0,this.BA=!0,this.D_Z=[],this.D_a=0,this.D_b=new Int8Array(n.H_s),this.D_c=n.H_s,this.A_6=null,this.B_R=null,this.Av=null,this.B_S=null,this.D_d=null,this.D_e=null,this.A_8=null,this.B_T=!0,this.B_U=!0,this.D_f=!1,this.D_g=0,this.uid=-1,this.A_6=t,this.B_R=e,this.Av=i,this.B_S=s,this.D_d=this.createBlock(),this.B_T=r,this.B_U=a;for(let n=0;n<this.D_c;++n)this.D_b[n]=-1}createBlock(){let t=new a.default(this.A_6);return t.rpoNodeBuilder=this.B_R,t.rpoUnitBuilder=this.Av,t.vtxResource=this.B_S,t}setRenderParam(t,e){this.D_a<1&&(this.B_T=t,this.B_U=e)}setRendererParam(t,e){this.A7=t,this.A=t.getRCUid(),this.D_X=e}getUid(){return this.uid}getRCUid(){return this.A}getRPIndex(){return this.D_X}hasSorter(){return null!=this.A_8}setSorter(t){this.A_8=t,null!=this.D_e&&this.D_e.setSorter(t)}setSortEnabled(t){this.D_Y<1?this.D_f=t:null!=this.D_e&&(this.D_e.sortEnabled=t)}getSortEnabled(){return this.D_f}getUnitsTotal(){return this.D_Y}addNodeToBlock(t){let e=null;if(t.shdUid>=n.H_s)throw Error("Shader uid >= "+n.H_s);this.D_b[t.shdUid]<0?(e=this.createBlock(),e.batchEnabled=this.B_T,e.fixedState=this.B_U,e.batchEnabled?e.fixedState?e.runMode=2:e.runMode=1:e.runMode=0,e.shdUid=t.shdUid,e.index=this.D_a,e.procuid=this.D_X,this.D_Z.push(e),this.D_b[t.shdUid]=this.D_a,++this.D_a):e=this.D_Z[this.D_b[t.shdUid]],t.index=e.index,e.addNode(t)}rejoinRunitForTro(t){let e=this.B_R.getNodeByUid(t.__$rpuid);null!=e&&(e.tro=t.tro,e.texMid=e.unit.texMid,this.D_Z[e.index].rejoinNode(e))}rejoinRunitForVro(t){let e=this.B_R.getNodeByUid(t.__$rpuid);null!=e&&(e.drawMode=t.drawMode,e.ivsIndex=t.ivsIndex,e.ivsCount=t.ivsCount,e.insCount=t.insCount,t.drawOffset=t.ivsIndex*t.ibufStep,e.vtxUid=t.vtxUid,e.vro=t.vro,this.D_Z[e.index].rejoinNode(e),this.D_g++)}addDisp(t){if(null!=t&&null!=t.__$$runit&&t.__$$runit.getRPROUid()<0&&t.__$$runit.getRPROUid()!=this.uid){let e=this.B_R.create();e.unit=this.Av.getNodeByUid(t.__$ruid),e.unit.shader=this.A_6,e.unit.__$rprouid=this.uid,t.__$rpuid=e.uid,e.__$ruid=t.__$ruid,e.unit.__$rpuid=e.uid,e.updateData(),++this.D_Y,this.Av.setRPNodeParam(t.__$ruid,this.getUid(),e.uid),this.D_f?(null!=this.D_e||(this.D_e=new r.default(this.A_6),this.D_e.setSorter(this.A_8)),this.D_e.addNode(e)):this.addNodeToBlock(e),this.D_g++}}updateDispMateiral(t){if(null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),i=this.B_R.getNodeByUid(e);i.shdUid=i.unit.shdUid,i.texMid=i.unit.texMid,i.tro=i.unit.tro;let s=this.D_Z[i.index];s.removeNode(i),this.addNodeToBlock(i)}}removeDisp(t){if(null!=t&&null!=t.__$$runit){let e=t.__$$runit.getRPOUid(),i=this.B_R.getNodeByUid(e);if(null!=i){if(null==this.D_e){let t=this.D_Z[i.index];t.removeNode(i)}else this.D_e.removeNode(i);this.Av.setRPNodeParam(t.__$ruid,this.getUid(),-1),--this.D_Y;let e=i.unit;this.B_R.restore(i)&&this.Av.restore(e),this.B_S.__$detachRes(t.vbuf.getUid()),t.__$$runit=null,t.__$ruid=-1,this.D_g++}}}getStatus(){return this.D_g}removeDispUnit(t){if(null!=t&&t.__$ruid>-1){let e=t.__$$runit.getRPOUid(),i=this.B_R.getNodeByUid(e);if(null!=i){if(null==this.D_e){let t=this.D_Z[i.index];t.removeNode(i)}else this.D_e.removeNode(i);this.Av.setRPNodeParam(t.__$ruid,this.D_X,-1),i.unit.__$rprouid=-1,--this.D_Y,this.B_R.restore(i)}}}update(){this.BA&&this.D_Y>0&&null!=this.D_e&&this.D_e.update()}run(){if(this.BA&&this.D_Y>0){let t=this.A7;if(null==this.D_e)if(this.A_6.isUnLocked())for(let e=0;e<this.D_a;++e)this.D_Z[e].run(t);else for(let e=0;e<this.D_a;++e)this.D_Z[e].runLockMaterial(t);else this.A_6.isUnLocked()?this.D_e.run(t):this.D_e.runLockMaterial(t)}}drawDisp(t,e=!1,i=!0){if(null!=t){let s=t.__$$runit;null!=s&&(this.A_6.isUnLocked()?(i&&this.A_6.resetUniform(),this.D_d.drawUnit(this.A7,s,t)):this.D_d.drawLockMaterialByUnit(this.A7,s,t,e,i))}}drawLockMaterialByDisp(t,e=!1,i=!0){if(null!=t){let s=t.__$$runit;null!=s&&this.D_d.drawLockMaterialByUnit(this.A7,s,t,e,i)}}reset(){this.D_f=!1,this.D_Y=0,this.uid=-1,this.D_X=-1,this.A=-1,this.D_X=-1;let t=0;for(;t<this.D_a;++t)this.D_Z[t].reset();this.D_a=0,this.D_Z=[],this.B_R=null,this.Av=null,this.B_S=null,this.A7=null,null!=this.D_e&&(this.D_e.clear(),this.D_e=null)}showInfo(){let t=0;for(;t<this.D_a;++t)this.D_Z[t].showInfo()}destroy(){this.reset()}setEnabled(t){this.BA=t}getEnabled(){return this.BA}toString(){return"[RenderProcess(uid = "+this.D_X+")]"}}n.H_s=1024,e.default=n},"76b0":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("35fa")),a=s(i("8a0a")),n=s(i("fecb")),l=s(i("cb29")),h=s(i("e7d2")),o=i("e08e"),m=s(i("3930"));class _ extends l.default{constructor(t=a.default.VTX_STATIC_DRAW){super(t),this.color0=new m.default,this.color1=new m.default,this.color2=new m.default,this.color3=new m.default,this.offsetU=0,this.offsetV=0,this.uScale=1,this.vScale=1,this.flipVerticalUV=!1,this.axisFlag=0,this.D_h=!0,this.B_K=null,this.B_L=null,this.B_M=null,this.B_N=null,this.C_C=null,this.C_D=null,this.vsFloat32=null,this.dataStepList=null}getVS(){return this.B_K}getUVS(){return this.B_L}setUVS(t){null!=t&&8==t.length&&(null==this.B_L?this.B_L=t.slice(0):this.B_L.set(t))}getNVS(){return this.B_M}getCVS(){return this.B_N}initialize(t,e,i,s){if(null!=this.B_K)return;let l=t,m=e,_=t+i,u=e+s,d=0;switch(this.B_O=new Uint16Array([0,1,2,0,2,3]),this.axisFlag){case 0:this.B_K=new Float32Array([l,m,d,_,m,d,_,u,d,l,u,d]);break;case 1:this.B_K=new Float32Array([_,d,m,l,d,m,l,d,u,_,d,u]);break;case 2:this.B_K=new Float32Array([d,l,m,d,_,m,d,_,u,d,l,u]);break;default:break}if(null==this.bounds&&(this.bounds=new n.default),this.bounds.addXYZFloat32Arr(this.B_K),this.bounds.updateFast(),h.default.Reset(),h.default.AddFloat32Data(this.B_K,3),null==this.B_L&&this.isVBufEnabledAt(a.default.VBUF_UVS_INDEX)&&(this.flipVerticalUV?this.B_L=new Float32Array([this.offsetU+0*this.uScale,this.offsetV+1*this.vScale,this.offsetU+1*this.uScale,this.offsetV+1*this.vScale,this.offsetU+1*this.uScale,this.offsetV+0*this.vScale,this.offsetU+0*this.uScale,this.offsetV+0*this.vScale]):this.B_L=new Float32Array([this.offsetU+0*this.uScale,this.offsetV+0*this.vScale,this.offsetU+1*this.uScale,this.offsetV+0*this.vScale,this.offsetU+1*this.uScale,this.offsetV+1*this.vScale,this.offsetU+0*this.uScale,this.offsetV+1*this.vScale])),this.isVBufEnabledAt(a.default.VBUF_NVS_INDEX))switch(this.axisFlag){case 0:this.B_M=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]);break;case 1:this.B_M=new Float32Array([0,1,0,0,1,0,0,1,0,0,1,0]);break;case 2:this.B_M=new Float32Array([1,0,0,1,0,0,1,0,0,1,0,0]);break;default:break}if(this.isVBufEnabledAt(a.default.VBUF_CVS_INDEX)&&(this.B_N=new Float32Array([this.color0.r,this.color0.g,this.color0.b,this.color1.r,this.color1.g,this.color1.b,this.color2.r,this.color2.g,this.color2.b,this.color3.r,this.color3.g,this.color3.b])),this.isVBufEnabledAt(a.default.VBUF_TVS_INDEX)){let t=2;this.C_C=new Float32Array(12),this.C_D=new Float32Array(12),r.default.ClacTrisTangent(this.B_K,this.B_K.length,this.B_L,this.B_M,t,this.B_O,this.C_C,this.C_D)}this.drawMode=o.RenderDrawMode.ELEMENTS_TRIANGLES,this.buildVbuf(),this.vtxTotal=4,this.trisNumber=2,this.buildEnd()}reinitialize(){this.buildVbuf()}buildVbuf(){h.default.Reset(),h.default.AddFloat32Data(this.B_K,3),this.isVBufEnabledAt(a.default.VBUF_UVS_INDEX)&&h.default.AddFloat32Data(this.B_L,2),this.isVBufEnabledAt(a.default.VBUF_NVS_INDEX)&&h.default.AddFloat32Data(this.B_M,3),this.isVBufEnabledAt(a.default.VBUF_CVS_INDEX)&&h.default.AddFloat32Data(this.B_N,3),this.isVBufEnabledAt(a.default.VBUF_TVS_INDEX)&&(h.default.AddFloat32Data(this.C_C,3),h.default.AddFloat32Data(this.C_D,3)),h.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.updateWireframeIvs(),this.vtCount=this.B_O.length,null!=this.B_Q?(this.forceUpdateIVS&&this.B_Q.setUint16IVSData(this.B_O),h.default.UpdateBufData(this.B_Q)):this.B_Q=h.default.CreateBySaveData(this.getBufDataUsage(),this.getBufSortFormat()),this.B_Q.setUintIVSData(this.B_O),this.buildEnd()}isPolyhedral(){return this.D_h}setPolyhedral(t){this.D_h=t}testRay(t,e,i,s){if(this.D_h)return-1;if(s){let s=n.default.IntersectionRL2(e,t,this.bounds,i);return s?1:-1}return-1}toString(){return"[RectPlaneMesh()]"}__$destroy(){this.isResFree()&&(this.bounds=null,this.B_K=null,this.B_L=null,this.B_M=null,this.B_N=null,super.__$destroy())}}e.default=_},"776f":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("6883")),n=s(i("29ef"));class l{constructor(){this.v_=!1,this.flameEntity=null,this.solidEntity=null,this.materialPipeline=null,this.pipeTypes=null}initialize(t,e,i,s,r=!1){null==this.solidEntity&&(this.v_=r,this.initFlame(null,t,i),this.initSolid(null,e,s))}initializeFrom(t,e,i,s=!1){null!=t&&null==this.solidEntity&&(this.v_=s,this.initFlame(t.flameEntity,50,e),this.initSolid(t.solidEntity,50,i))}initSolid(t,e,i){let s=100,l=[[0,0,.5,.5],[.5,0,.5,.5],[0,.5,.5,.5],[.5,.5,.5,.5]],h=new a.default;if(h.setMaterialPipeline(this.materialPipeline),h.pipeTypes=this.pipeTypes,h.premultiplyAlpha=i.premultiplyAlpha,null!=t)h.copyMeshFrom(t),h.createGroup(e);else{h.createGroup(e);let t=new r.default;for(let i=0;i<e;++i){s=Math.random()*Math.random()*Math.random()*180+10,h.setSizeAndScaleAt(i,s,s,.2,1);let e=l[Math.floor((l.length-1)*Math.random()+.5)];h.setUVRectAt(i,e[0],e[1],e[2],e[3]),h.setTimeAt(i,50*Math.random()+150,.1,.7,5*Math.random()),h.setBrightnessAt(i,1),h.setTimeSpeedAt(i,1*Math.random()+.5),t.setTo(50*Math.random()-25,10*Math.random()+10,50*Math.random()-25),h.setPositionAt(i,t.x,t.y,t.z),h.setAccelerationAt(i,.01*Math.random()-.005,-.004,0),t.normalize(),t.scaleBy(1*Math.random()+1.5),h.setVelocityAt(i,t.x,t.y,t.z)}}h.setPlayParam(!0,!0,this.v_,!0),h.initialize(!1,!0,!1,[i]),h.setSpdScaleMax(4,1.5),i.premultiplyAlpha?h.setRenderState(n.default.BACK_ALPHA_ADD_ALWAYS_STATE):h.toTransparentBlend(),this.solidEntity=h}initFlame(t,e,i){let s=100,n=[[0,0,.5,.5],[.5,0,.5,.5],[0,.5,.5,.5],[.5,.5,.5,.5]];i.premultiplyAlpha=i.premultiplyAlpha;let l=new a.default;if(l.setMaterialPipeline(this.materialPipeline),l.pipeTypes=this.pipeTypes,l.premultiplyAlpha=i.premultiplyAlpha,l.toBrightnessBlend(),null!=t)l.copyMeshFrom(t),l.createGroup(e);else{l.createGroup(e);let t=new r.default;for(let i=0;i<e;++i){s=Math.random()*Math.random()*Math.random()*180+10,l.setSizeAndScaleAt(i,s,s,.5,1);let e=n[Math.floor((n.length-1)*Math.random()+.5)];l.setUVRectAt(i,e[0],e[1],e[2],e[3]),l.setTimeAt(i,50*Math.random()+100,.4,.6,10*Math.random()),l.setBrightnessAt(i,1),l.setTimeSpeedAt(i,1*Math.random()+.5),t.setTo(60*Math.random()-30,50*Math.random()+10,60*Math.random()-30),l.setPositionAt(i,t.x,t.y,t.z),l.setAccelerationAt(i,0,-.01,0),t.normalize(),t.scaleBy(2*Math.random()+.8),l.setVelocityAt(i,t.x,t.y,t.z)}}l.setPlayParam(!0,!1,this.v_),l.initialize(!0,!1,!1,[i]),this.flameEntity=l}setDepthOffset(t){null!=this.solidEntity&&this.solidEntity.setDepthOffset(t),null!=this.flameEntity&&this.flameEntity.setDepthOffset(t)}setTime(t){null!=this.solidEntity&&this.solidEntity.setTime(t),null!=this.flameEntity&&this.flameEntity.setTime(t)}updateTime(t){null!=this.solidEntity&&this.solidEntity.updateTime(t),null!=this.flameEntity&&this.flameEntity.updateTime(t)}setRotationXYZ(t,e,i){null!=this.solidEntity&&this.solidEntity.setRotationXYZ(t,e,i),null!=this.flameEntity&&this.flameEntity.setRotationXYZ(t,e,i)}setXYZ(t,e,i){null!=this.solidEntity&&this.solidEntity.setXYZ(t,e,i),null!=this.flameEntity&&this.flameEntity.setXYZ(t,e,i)}setPositionScale(t){null!=this.solidEntity&&this.solidEntity.setScaleXYZ(t,t,t),null!=this.flameEntity&&this.flameEntity.setScaleXYZ(t,t,t)}setSizeScale(t){null!=this.solidEntity&&this.solidEntity.setScaleXY(t,t),null!=this.flameEntity&&this.flameEntity.setScaleXY(t,t)}setPosition(t){null!=this.solidEntity&&this.solidEntity.setPosition(t),null!=this.flameEntity&&this.flameEntity.setPosition(t)}setVisible(t){null!=this.solidEntity&&this.solidEntity.setVisible(t),null!=this.flameEntity&&this.flameEntity.setVisible(t)}update(){null!=this.solidEntity&&this.solidEntity.update(),null!=this.flameEntity&&this.flameEntity.update()}isAwake(){return null!=this.solidEntity&&(this.solidEntity.isAwake()||null!=this.flameEntity&&this.flameEntity.isAwake())}destory(){this.materialPipeline=null,this.pipeTypes=null}}e.default=l},"77cf":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73")),a=s(i("3077")),n=i("5216"),l=i("a9bf"),h=i("c70f");class o{constructor(t=0){this.T=-1,this.D_i=new h.GlobalEnvLightUniformParam,this.D_j=null,this.D_k=null,this.D_l=!1,this.D_m=0,this.D_n=!0,this.D_o=!0,this.D_p=null,this.D_m=t,this.T=o.H0++}setEnvAmbientMap(t){null==this.D_p&&null!=t&&(this.D_p=t,this.D_p.__$attachThis())}getUid(){return this.T}setAmbientColorRGB3f(t,e,i){let s=r.default.EnvLightParams.data;s[0]=t,s[1]=e,s[2]=i,this.D_l=!0}setFogColorRGB3f(t,e,i){let s=r.default.EnvLightParams.data;s[8]=t,s[9]=e,s[10]=i,this.D_l=!0}setFogDensity(t){r.default.EnvLightParams.data[11]=t,this.D_l=!0}setFogNear(t){r.default.EnvLightParams.data[6]=t,this.D_l=!0}setFogFar(t){r.default.EnvLightParams.data[7]=t,this.D_l=!0}setFogAreaOffset(t,e){r.default.EnvLightParams.data[12]=t,r.default.EnvLightParams.data[13]=e,this.D_l=!0}setFogAreaSize(t,e){r.default.EnvLightParams.data[14]=t,r.default.EnvLightParams.data[15]=e,this.D_l=!0}setEnvAmbientLightAreaOffset(t,e){r.default.EnvLightParams.data[16]=t,r.default.EnvLightParams.data[17]=e,this.D_l=!0}setEnvAmbientLightAreaSize(t,e){r.default.EnvLightParams.data[18]=t,r.default.EnvLightParams.data[19]=e,this.D_l=!0}resetPipe(){this.D_n=!0,this.D_o=!0}getTextures(t,e,i){return null!=this.D_p&&i==n.MaterialPipeType.ENV_AMBIENT_LIGHT?(null==e&&(e=[]),e.push(this.D_p),t.uniform.add2DMap("VOX_ENV_AMBIENT_LIGHT_LIGHT_MAP",!0,!0,!1),e):null}useShaderPipe(t,e){if(null!=this.D_j)switch(e){case n.MaterialPipeType.ENV_LIGHT_PARAM:this.buildUniformCode(t);break;case n.MaterialPipeType.FOG:case n.MaterialPipeType.FOG_EXP2:this.buildUniformCode(t),this.useFogData(t,e==n.MaterialPipeType.FOG_EXP2,!0);break;case n.MaterialPipeType.ENV_AMBIENT_LIGHT:this.buildUniformCode(t);break;default:break}}getPipeTypes(){return[n.MaterialPipeType.ENV_LIGHT_PARAM,n.MaterialPipeType.FOG,n.MaterialPipeType.FOG_EXP2,n.MaterialPipeType.ENV_AMBIENT_LIGHT]}getPipeKey(t){switch(t){case n.MaterialPipeType.ENV_LIGHT_PARAM:case n.MaterialPipeType.FOG:case n.MaterialPipeType.FOG_EXP2:case n.MaterialPipeType.ENV_AMBIENT_LIGHT:return"["+t+"]";default:break}return""}useUniforms(t){null!=this.D_j&&t.addFragUniformParam(r.default.EnvLightParams)}buildUniformCode(t){this.D_o&&(this.D_o=!1,this.D_i.use(t))}useFogData(t,e,i){t.addDefine("VOX_USE_FOG","1"),e&&t.addDefine("VOX_FOG_EXP2","1"),t.addVarying("float","v_fogDepth"),this.useShaderCode(t,i)}useShaderCode(t,e){this.D_n&&(this.D_n=!1,e?t.addShaderObject(l.EnvShaderCode):t.addShaderObjectHead(l.EnvShaderCode))}initialize(){null==this.D_j&&(this.D_j=new a.default,this.D_j.bindSlotAt(this.D_m),this.D_j.addVec4Data(r.default.EnvLightParams.data,r.default.EnvLightParams.arrayLength),this.D_k=this.D_i.createGlobalUinform(this.D_j),this.D_j.update())}update(){null!=this.D_j&&this.D_l&&(this.D_l=!1,this.D_j.update())}getGlobalUinform(){return this.D_k.clone()}}o.H0=0,e.default=o},"78e9":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("644c"));class a{constructor(){this.type=-1,this.typeName="",this.name="",this.isArray=!1,this.arrLength=0,this.isTex=!1,this.location=null}parseCode(t){const e=";";let i=t.indexOf(e);if(i<0)return!1;const s=" ";t=t.replace(/^\s*|\s*$/g,""),i>0&&(t=t.slice(0,i));let a=t.split(s);return this.typeName=a[a.length-2],this.name=a[a.length-1],i=this.name.indexOf("["),this.isArray=i>0,this.arrLength=0,this.isArray&&(this.arrLength=parseInt(this.name.slice(i+1,this.name.indexOf("]",i+1))),this.name=this.name.slice(0,i),this.typeName+="[]"),this.type=r.default.GetTypeByTypeNS(this.typeName),!(this.type<0)&&(this.isTex=this.type==r.default.SHADER_SAMPLER2D||this.type==r.default.SHADER_SAMPLERCUBE||this.type==r.default.SHADER_SAMPLER3D,!0)}}e.default=a},"7a04":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("f044"));class a{constructor(){this.T=-1,this.C_G=0,this.layoutBit=0,this.D_q=null,this.D_r=null,this.D_s=null,this.D_t=null,this.D_u=null,this.D_v=null,this.D_w=0,this.T=r.default.CreateNewID()}getUid(){return this.T}getType(){return 1}getBuffersTotal(){return this.D_r.length}getF32DataAt(t){return this.D_r[t]}setF32DataAt(t,e,i,s){null==this.D_r&&(this.D_r=[null,null,null,null,null,null,null,null],this.D_u=[!1,!1,!1,!1,!1,!1,!1,!1],this.D_s=[0,0,0,0,0,0,0,0],this.D_t=[0,0,0,0,0,0,0,0]),this.D_r[t]=e,null!=this.D_v&&null!=e&&(this.D_u[t]=!0),null!=s&&(this.D_q=s),this.D_w=i,null!=e&&(this.D_s[t]=e.length)}setData4fAt(t,e,i,s,r,a){t*=this.D_q[e],this.D_r[e][t++]=i,this.D_r[e][t++]=s,this.D_r[e][t++]=r,this.D_r[e][t++]=a}setData3fAt(t,e,i,s,r){t*=this.D_q[e],this.D_r[e][t++]=i,this.D_r[e][t++]=s,this.D_r[e][t++]=r}setData2fAt(t,e,i,s){t*=this.D_q[e],this.D_r[e][t++]=i,this.D_r[e][t++]=s}destroy(){this.D_r=null,this.D_u=null,this.D_s=null,this.D_t=null,this.D_r=null}toString(){return"VtxSeparatedBuf(uid = "+this.T+")"}}e.default=a},"7b0e":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("bbf4"));class a{constructor(){this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rayTestState=0,this.rpoNode=null,this.spaceId=-1,this.camVisiSt=0,this.camVisi=r.default.CAMERA_VISIBLE_ENABLE}reset(){this.rayTestState=0,this.uid=-1,this.rstatus=0,this.pcoEnabled=!1,this.drawEnabled=!0,this.prev=null,this.next=null,this.entity=null,this.bounds=null,this.rpoNode=null,this.spaceId=-1,this.camVisi=0}static GetFreeId(){return a.j_.length>0?a.j_.pop():-1}static GetByUid(t){return t>-1&&t<a.D_y?a.D_x[t]:null}static SetCamVisiByUid(t,e){a.D_x[t].camVisi=e}static GetCamVisiByUid(t){return a.D_x[t].camVisi}static Create(){let t=null,e=a.GetFreeId();return e>=0?(t=a.D_x[e],t.uid=e,a.FS[e]=a.S_FLAG_BUSY):(t=new a,a.D_x.push(t),a.FS.push(a.S_FLAG_BUSY),t.uid=a.D_y,a.D_y++),t}static Restore(t){null!=t&&t.uid>=0&&a.FS[t.uid]==a.S_FLAG_BUSY&&(a.j_.push(t.uid),a.FS[t.uid]=a.S_FLAG_FREE,t.reset())}}a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.D_y=0,a.D_x=[],a.FS=[],a.j_=[],e.default=a},"7b16":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("18c7")),n=s(i("91e2")),l=s(i("ae33")),h=i("a52f");class o{constructor(t=null){this.BF=new r.default,this.CG=null,this.CH=null,this.CI=null,this.BI=null,this.CJ=0,this.materialBuilder=null,this.weap=null,this.campType=h.CampType.Blue,this.BI=null==t?new l.default:t}getContainer(){return this.BI}setVisible(t){this.BI.setVisible(t)}getVisible(){return this.BI.getVisible()}setRotationY(t){this.BI.setRotationY(t)}getRotationY(){return this.BI.getRotationY()}initWeap01(t){let e;null==o.CK&&(o.CK=new n.default,e=this.materialBuilder.createMaterial(t),o.CK.setMaterial(e),o.CK.initializeSizeXYZ(60,30,60,[t]),o.CK.setXYZ(0,70,0));let i=new n.default;e=this.materialBuilder.createMaterial(t),i.setMaterial(e),i.copyMeshFrom(o.CK),i.initializeSizeXYZ(60,30,60,[t]),i.setXYZ(0,70,0),this.CG=i,this.CJ=0}initWeap02(t){let e;if(null==o.CK){let i=1,s=new n.default;e=this.materialBuilder.createMaterial(t),s.setMaterial(e),s.initializeSizeXYZ(80,20,60,[t]),s.setXYZ(0,70,0),s.setScaleXYZ(i,i,i);let r=new a.default;r.identity(),r.setScaleXYZ(.7,1,.9),r.appendTranslationXYZ(-8,0,0),s.transformFaceAt(0,r),s.reinitializeMesh(),o.CK=s,s=new n.default,e=this.materialBuilder.createMaterial(t),s.setMaterial(e),s.initializeSizeXYZ(80,12,60,[t]),s.setXYZ(0,86,0),s.setScaleXYZ(i,i,i),r=new a.default,r.identity(),r.setScaleXYZ(.6,1,.8),r.appendTranslationXYZ(-20,0,0),s.transformFaceAt(1,r),s.reinitializeMesh(),o.CL=s}let i=new n.default;e=this.materialBuilder.createMaterial(t),i.setMaterial(e),i.copyMeshFrom(o.CK),i.copyTransformFrom(o.CK),i.initializeSizeXYZ(60,30,60,[t]),this.CG=i,i=new n.default,e=this.materialBuilder.createMaterial(t),i.setMaterial(e),i.copyMeshFrom(o.CL),i.copyTransformFrom(o.CL),i.initializeSizeXYZ(60,30,60,[t]),this.CH=i,this.CJ=1}initialize(t,e,i=null){null==this.CI&&(this.CI=e,e.addChild(this.BI),0==this.CJ?this.BI.addEntity(this.CG):1==this.CJ&&(this.BI.addEntity(this.CG),this.BI.addEntity(this.CH),this.BI.setScaleXYZ(1.5,1.3,1.7),this.BI.setXYZ(0,-50,0)))}getPosition(t){this.BI.getPosition(t)}destroy(){this.materialBuilder=null}}o.CK=null,o.CL=null,e.default=o},"7c63":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("e08e");class r{constructor(t,e,i,s){this.T=-1,this.D_z=!0,this.D_0=!0,this.D_1=!0,this.D_2=!0,this.T=r.H0++,this.D_z=t,this.D_0=e,this.D_1=i,this.D_2=s}getUid(){return this.T}getR(){return this.D_z}getG(){return this.D_0}getB(){return this.D_1}getA(){return this.D_2}use(){r.H_t!=this.T&&(r.Rstate.setColorMask(this.D_z,this.D_0,this.D_1,this.D_2),r.H_t=this.T)}static Create(t,e,i,s,a){if(r.H_u.has(t)){let e=r.H_u.get(t);return e.getUid()}let n=(e?64:32)|(i?16:8)|(s?4:2)|(a?1:0);if(r.H_v.has(n)){let t=r.H_v.get(n);n=t.getUid()}else{let l=new r(e,i,s,a);n=l.getUid(),r.H_v.set(n,l),r.H_u.set(t,l),r.H_w.push(l),++r.H_y}return n}static GetColorMaskByName(t){if(r.H_u.has(t)){let e=r.H_u.get(t);return e.getUid()}return-1}static UseRenderState(t){r.H_x&&r.Rstate.roColorMask!=t&&t>-1&&t<r.H_y&&r.H_w[t].use()}static UseColorMaskByName(t){let e=r.GetColorMaskByName(t);r.H_x&&r.Rstate.roColorMask!=e&&e>-1&&e<r.H_y&&r.H_w[e].use()}static Lock(){r.H_x=!1}static Unlock(){r.H_x=!0}static Reset(){r.H_t=-1}}r.H0=0,r.H_t=-1,r.H_w=[],r.H_y=1,r.H_v=new Map,r.H_u=new Map,r.H_x=!0,r.ALL_TRUE_COLOR_MASK=0,r.ALL_FALSE_COLOR_MASK=1,r.Rstate=null,e.RenderColorMask=r;class a{constructor(t,e,i){this.T=-1,this.D_3=0,this.D_4=0,this.D_5=0,this.D_6=0,this.T=a.H0++,this.D_3=t,this.D_4=e,this.D_5=i}getUid(){return this.T}getCullFaceMode(){return this.D_3}getDepthTestMode(){return this.D_5}getBlendMode(){return this.D_4}use(){if(a.H_t!=this.T){a.Rstate.setCullFaceMode(this.D_3);a.H_5[a.D_4];a.D_4<0?a.Rstate.setBlendMode(this.D_4,a.H_5[this.D_4]):a.Rstate.setBlendMode(a.D_4,a.H_5[a.D_4]),a.H_3<0?a.Rstate.setDepthTestMode(this.D_5):a.Rstate.setDepthTestMode(a.H_3),a.H_t=this.T}}static CreateBlendModeSeparate(t,e,i,r,n,l=0,h=0){if(null!=t&&""!=t){let o;if(a.H_z.has(t))return o=a.H_z.get(t),a.H_0.get(o);l<1&&(l=s.GLBlendEquation.FUNC_ADD),h<1&&(h=s.GLBlendEquation.FUNC_ADD);let m=1;if(o=31,o=131*o+e,o=131*o+i,r>0&&n>0&&(o=131*o+r,o=131*o+n,m=1),a.H_0.has(o))return a.H_z.set(t,o),a.H_0.get(o);let _=++a.H_1;a.H_z.set(t,o),a.H_0.set(o,_);let u=[m,l,h,e,i,r,n];return a.H_5[_]=u,_}return 0}static CreateBlendMode(t,e,i,r=0){if(null!=t&&""!=t){let n;if(a.H_z.has(t))return n=a.H_z.get(t),a.H_0.get(n);r<1&&(r=s.GLBlendEquation.FUNC_ADD);let l=0;if(n=31,n=131*n+e,n=131*n+i,a.H_0.has(n))return a.H_0.get(n);let h=++a.H_1;a.H_z.set(t,n),a.H_0.set(n,h);let o=[l,r,0,e,i,0,0];return a.H_5[h]=o,h}return 0}static Create(t,e,i,s){if(a.H_u.has(t)){let e=a.H_u.get(t);return e.getUid()}let r=31;if(r=131*r+s,r=131*r+i,r=131*r+e,a.H_v.has(r)){let t=a.H_v.get(r);r=t.getUid()}else{let n=new a(e,i,s);r=n.getUid(),a.H_v.set(r,n),a.H_u.set(t,n),a.H_w.push(n),++a.H_y}return r}static GetRenderStateByName(t){if(a.H_u.has(t)){let e=a.H_u.get(t);return e.getUid()}return-1}static UseRenderState(t){a.H_x&&a.H_t!=t&&t>-1&&t<a.H_y&&a.H_w[t].use()}static UseRenderStateByName(t){if(a.H_x){let e=a.GetRenderStateByName(t);a.H_t!=e&&e>-1&&e<a.H_y&&a.H_w[e].use()}}static UnlockBlendMode(){a.D_4=a.H_2}static LockBlendMode(t){a.H_2=a.D_4,a.D_4=t}static UnlockDepthTestMode(){a.H_3=a.H_4}static LockDepthTestMode(t){a.H_4=a.H_3,a.H_3=t}static Lock(){a.H_x=!1}static Unlock(){a.H_x=!0}static Reset(){a.H_t=-1}}a.H0=0,a.H_t=-1,a.H_w=[],a.H_y=1,a.D_4=-1,a.H_3=-1,a.H_v=new Map,a.H_u=new Map,a.H_z=new Map,a.H_0=new Map,a.H_1=0,a.H_5=new Array(256),a.H_x=!0,a.Rstate=null,a.H_2=-1,a.H_4=-1,e.RenderStateObject=a;class n{constructor(){this.stencilMask=-1}}class l{constructor(){this.D_7=new Array(128),this.D_8=null,this.D_4=s.RenderBlendMode.NORMAL,this.D_9=s.CullFaceMode.NONE,this.D_=s.DepthTestMode.DISABLE,this.EA=!0,this.EB=null,this.J_=null,this.roColorMask=-11}reset(){this.roColorMask=-11}setRenderContext(t){this.EB=t,this.J_=t.getRC();let e=this.J_.rcuid;this.D_8=this.D_7[e],null==this.D_8&&(this.D_8=this.D_7[e]=new n)}setColorMask(t,e,i,s){this.J_.colorMask(t,e,i,s)}setStencilFunc(t,e,i){this.J_.stencilFunc(t,e,i)}setStencilMask(t){this.D_8.stencilMask!=t&&t>=0&&(this.D_8.stencilMask=t,this.J_.stencilMask(t))}setStencilOp(t,e,i){this.J_.stencilOp(t,e,i)}setDepthTestEnable(t){t?this.J_.enable(this.J_.DEPTH_TEST):this.J_.disable(this.J_.DEPTH_TEST)}setCullFaceEnable(t){t?this.J_.enable(this.J_.CULL_FACE):this.J_.disable(this.J_.CULL_FACE)}setBlendEnable(t){t?this.J_.enable(this.J_.BLEND):this.J_.disable(this.J_.BLEND)}setCullFaceMode(t){this.D_9!=t&&(this.D_9=t,t!=s.CullFaceMode.NONE?(this.EA&&(this.EA=!1,this.J_.enable(this.J_.CULL_FACE)),this.J_.cullFace(t)):this.EA||(this.EA=!0,this.J_.disable(this.J_.CULL_FACE)))}setBlendMode(t,e){this.D_4!=t&&(this.D_4=t,t>0?e[0]<1?(this.J_.blendEquation(this.J_.FUNC_ADD),this.J_.blendFunc(this.J_.ONE,this.J_.ZERO),this.J_.blendEquation(e[1]),this.J_.blendFunc(e[3],e[4])):(this.J_.blendEquationSeparate(e[1],e[2]),this.J_.blendFuncSeparate(e[3],e[4],e[5],e[6])):this.J_.disable(this.J_.BLEND))}setDepthTestMode(t){if(this.D_!=t)switch(this.D_=t,t){case s.DepthTestMode.ALWAYS:this.J_.depthMask(!1),this.J_.depthFunc(this.J_.ALWAYS);break;case s.DepthTestMode.SKY:this.J_.depthMask(!0),this.J_.depthFunc(this.J_.LEQUAL);break;case s.DepthTestMode.OPAQUE:this.J_.depthMask(!0),this.J_.depthFunc(this.J_.LESS);break;case s.DepthTestMode.OPAQUE_OVERHEAD:this.J_.depthMask(!1),this.J_.depthFunc(this.J_.EQUAL);break;case s.DepthTestMode.DECALS:this.J_.depthMask(!1),this.J_.depthFunc(this.J_.LEQUAL);break;case s.DepthTestMode.BLEND:this.J_.depthMask(!1),this.J_.depthFunc(this.J_.LESS);break;case s.DepthTestMode.WIRE_FRAME:this.J_.depthMask(!0),this.J_.depthFunc(this.J_.LEQUAL);break;case s.DepthTestMode.NEXT_LAYER:this.J_.depthMask(!1),this.J_.depthFunc(this.J_.ALWAYS);break;case s.DepthTestMode.TRUE_EQUAL:this.J_.depthMask(!0),this.J_.depthFunc(this.J_.EQUAL);break;case s.DepthTestMode.TRUE_GREATER:this.J_.depthMask(!0),this.J_.depthFunc(this.J_.GREATER);break;case s.DepthTestMode.TRUE_GEQUAL:this.J_.depthMask(!0),this.J_.depthFunc(this.J_.GEQUAL);break;case s.DepthTestMode.WIRE_FRAME_NEXT:break;default:break}}}e.RODrawState=l},"81c4":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("f48d")),n=s(i("d1a0"));class l extends a.default{constructor(){super(...arguments),this.radiusSquared=2500,this.tv=new r.default(1,0,0),this.center=new r.default(50,0,0),this.anotherPosition=new r.default(100,0,0),this.length=100}intersectionCopSLV2(t,e,i){r.default.Cross(this.tv,e,a.default.__tV1),r.default.Cross(this.tv,a.default.__tV1,a.default.__tV2),a.default.__tV2.normalize(),n.default.IntersectionSLV2(a.default.__tV2,a.default.__tV2.dot(this.position),t,e,i),a.default.__tV2.x=i.x-this.position.x,a.default.__tV2.y=i.y-this.position.y,a.default.__tV2.z=i.z-this.position.z;let s=a.default.__tV2.dot(this.tv);s<0?i.copyFrom(this.position):s>this.length&&i.copyFrom(this.anotherPosition)}update(){this.tv.x=this.anotherPosition.x-this.position.x,this.tv.y=this.anotherPosition.y-this.position.y,this.tv.z=this.anotherPosition.z-this.position.z,this.length=this.tv.getLength(),this.tv.x*=.5,this.tv.y*=.5,this.tv.z*=.5,this.center.x=this.position.x+this.tv.x,this.center.y=this.position.y+this.tv.y,this.center.z=this.position.z+this.tv.z,this.radiusSquared=this.tv.getLengthSquared(),this.tv.normalize()}updateFast(){this.update()}}e.default=l},"81ce":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static Es2VtxShderToES3(t){let e=t;const i="attribute",s="varying ";let r=e.indexOf(i),a=0;while(r>=0)e=e.slice(0,r)+"layout(location="+a+") in"+e.slice(r+9),r=e.indexOf(i),a++;let n=new RegExp(s,"g");return e=e.replace(n,"out "),"#version 300 es\n"+e}static Es2FragShderToES3(t){let e=t;const i="gl_FragColor",s="varying ";let r=e.indexOf(i),a=0,n="FragColorOut_"+a;r>=0&&(e=e.slice(0,r)+n+e.slice(r+12)),r=e.indexOf("void "),e=e.slice(0,r)+"out vec4 "+n+";\n"+e.slice(r);let l=new RegExp(s,"g");return e=e.replace(l,"in "),l=new RegExp(" texture2D","g"),e=e.replace(l," texture"),l=new RegExp(" textureCube","g"),e=e.replace(l," texture"),"#version 300 es\n"+e}static Es3VtxShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const i=/\blayout\b.+\bin\b/g;t=t.replace(i,"attribute");const r=/\bout\b/g;t=t.replace(r,"varying");const a=/\btexture\b/g;t=t.replace(a,"texture2D"),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version"));let n=0,l=0,h=t.indexOf("inverse(");h<0&&(h=t.indexOf("inverse ("));let o="",m=!1,_=!1;while(h>3){if(n=t.indexOf(")",h+2),o=t.slice(h+2,n),o.indexOf("mat3")>0)m=!0;else if(o=o.replace(/\s+/g,""),n=o.indexOf("("),o=o.slice(n+1),n=t.indexOf(o,1),l=t.lastIndexOf("mat",n),l>0)switch(o=t.slice(l,n),o=o.replace(/\s+/g,""),o){case"mat3":m=!0;break;case"mat4":_=!0;break}if(h=t.indexOf("inverse(",h+5),h<0&&(h=t.indexOf("inverse (",h+5)),m&&_)break}n=0,h=t.indexOf("transpose("),h<0&&(h=t.indexOf("transpose (")),o="";let u=!1,d=!1;while(h>3){if(n=t.indexOf(")",h+2),o=t.slice(h+2,n+1),o.indexOf("mat3")>0)u=!0;else if(o=o.replace(/\s+/g,""),n=o.indexOf("("),o=o.slice(n+1),n=t.indexOf(o,1),l=t.lastIndexOf("mat",n),l>0)switch(o=t.slice(l,n),o=o.replace(/\s+/g,""),o){case"mat3":u=!0;break;case"mat4":d=!0;break}if(h=t.indexOf("transpose(",h+5),h<0&&(h=t.indexOf("transpose (",h+5)),u&&d)break}return(m||_)&&(h=t.indexOf("void "),h>10&&(m&&_?t=t.slice(0,h)+s.__glslInverseMat3+s.__glslInverseMat4+t.slice(h):m?t=t.slice(0,h)+s.__glslInverseMat3+t.slice(h):_&&(t=t.slice(0,h)+s.__glslInverseMat4+t.slice(h)))),(u||d)&&(h=t.indexOf("void "),h>10&&(u&&d?t=t.slice(0,h)+s.__glslTransposeMat3+s.__glslTransposeMat4+t.slice(h):u?t=t.slice(0,h)+s.__glslTransposeMat3+t.slice(h):d&&(t=t.slice(0,h)+s.__glslTransposeMat4+t.slice(h)))),t}static Es3FragShaderToES2(t){const e=/^#.+(\bes|core\b)/;t=t.replace(e,"");const i=new RegExp(" in ","g");t=t.replace(i,"_fref_");const s=/\bin\b/g;t=t.replace(s,"varying");const r=new RegExp("_fref_","g");t=t.replace(r," in ");const a=/\btexture\b/g;t=t.replace(a,"texture2D");const n=/" "/g;let l=t;const h=";",o="layout";let m=l.indexOf(o),_=0,u=0,d="",c="",f=0,p=null,g=[],v=[];while(m>=0)_=l.indexOf(h,m+1),d=l.slice(m+1,_),c=d.slice(d.lastIndexOf(" ")+1),f=d.indexOf(")"),m=d.lastIndexOf("=",f)+1,d=d.slice(m+1,f),f=parseInt(d.replace(n,"")),g.push(c),v.push(f),m=l.indexOf(o,_);let x=g.length;if(x>0)if(p=/layout/g,t=t.replace(p,"//layout"),x>1){m=0;while(m<x)p=new RegExp(g[m],"g"),t=t.replace(p,"gl_FragData["+v[m]+"]"),++m}else p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor");else m=l.indexOf("out "),m>0&&(_=l.indexOf(h,m+1),d=l.slice(m+1,_),c=d.slice(d.lastIndexOf(" ")+1),p=new RegExp(c,"g"),t=t.replace(p,"gl_FragColor"),p=/\bout\b/g,t=t.replace(p,"//out"));x>1&&(t="#extension GL_EXT_draw_buffers: require\n"+t),t.indexOf("#version")>=0&&(t=t.replace("#version","//#version")),m=0;for(let y=0;y<16;++y){if(m=t.indexOf("samplerCube ",m),!(m>0))break;{_=t.indexOf(";",m),d=l.slice(m+12,_),c="";let e=d.split(" ");for(let t=0;t<16;++t)if(""!=e[t]){c=e[t];break}for(x=0;x<16;++x){if(_=t.indexOf(c,_+1),!(_>0))break;if(u=t.lastIndexOf("texture2D",_-1),u<0)break;d=t.slice(u,_),t=t.slice(0,u)+"textureCube("+t.slice(_),_+=2}}m+=4}return t}}s.__glslTransposeMat3="\n    mat3 transpose(mat3 m) {\n        return mat3(m[0][0],m[1][0],m[2][0],\n            m[0][1],m[1][1],m[2][1],\n            m[0][2],m[1][2],m[2][2]);\n    }\n    ",s.__glslTransposeMat4="\n    mat4 transpose(mat4 m) {\n        return mat4(m[0][0],m[1][0],m[2][0],m[3][0],\n            m[0][1],m[1][1],m[2][1],m[3][1],\n            m[0][2],m[1][2],m[2][2],m[3][2],\n            m[0][3],m[1][3],m[2][3],m[3][3]);\n    }\n    ",s.__glslInverseMat3="\n    mat3 inverse(mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];  \n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;  \n        float det = a00 * b01 + a01 * b11 + a02 * b21;  \n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n    ",s.__glslInverseMat4="\n    mat4 inverse(mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n        }\n    ",e.default=s},"829f":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("cfaf")),a=s(i("bd6f")),n=s(i("6661")),l=s(i("29ef")),h=s(i("85b6")),o=s(i("baae"));class m{constructor(t,e=2){if(this.EC=2,this.w_=null,this.ED=null,this.EE=null,this.EF=null,this.EG=null,this.EH=[null,null],this.EI=null,this.EJ=!1,this.EK=6,this.EL=2,this.EM=-1,this.EN=!0,this.EO=0,this.EP=0,this.EQ=null,this.w_=t,e>=0&&e<3&&(this.EC=e),null==this.EI){this.EI=[null,null];let t=new h.default(32,32,!0);t.__$setRenderProxy(this.w_.getRenderProxy());let e=new h.default(32,32,!0);e.__$setRenderProxy(this.w_.getRenderProxy()),this.EI[0]=t,this.EI[1]=e,this.EH=[new r.default(32,32),new r.default(32,32)],t.attachTex(this.EH[0]),e.attachTex(this.EH[1])}}bindSrcProcessId(t){this.EM=t}bindSrcProcess(t){this.EM=t.getRPIndex()}bindDrawEntity(t){this.EQ=t}setBackbufferVisible(t){this.EJ=t}setSyncViewSizeEnabled(t){this.EN=t}setBlurCount(t){t<1&&(t=1),this.EK=t}setBlurDensity(t){this.EL=t}setFBOSize(t,e){(Math.abs(this.EO-t)>.1||Math.abs(this.EP-e))&&(this.EO=t,this.EP=e,this.EN=!1,null!=this.EH[0]&&this.EH[0].setSize(t,e),null!=this.EH[1]&&this.EH[1].setSize(t,e))}getDstTexture(){return this.getTextureAt(this.EK%2)}swapTextureAt(t,e){t>0&&t<2&&null!=e&&e!=this.EH[t]&&(this.EH[t]=e,this.EI[t].attachTex(e))}getTextureAt(t){return null!=this.EH[t]?(this.EO*this.EP>0?this.EH[t].setSize(this.EO,this.EP):this.EH[t].setSize(this.w_.getViewWidth(),this.w_.getViewHeight()),this.EH[t]):null}updateState(t){if(null==this.ED){let t=0,e=1;switch(this.EC){case m.HORIZONTAL:e=0;break;case m.VERTICAL:t=1;break;default:break}this.EG=new n.default(e),this.EG.setBlurDensity(this.EL);let i=new a.default;i.setMaterial(this.EG),i.initializeXOY(-1,-1,2,2,[this.EI[0]]),i.setRenderState(l.default.BACK_NORMAL_ALWAYS_STATE),this.ED=i,this.EF=new n.default(t),this.EF.setBlurDensity(this.EL),i=new a.default,i.setMaterial(this.EF),i.copyMeshFrom(this.ED),i.initializeXOY(-1,-1,2,2,[this.EI[1]]),i.setRenderState(l.default.BACK_NORMAL_ALWAYS_STATE),this.EE=i}let e=t.getFBOFitWidth(),i=t.getFBOFitHeight();this.EO*this.EP>0&&(e=this.EO,i=this.EP),this.EG.setTexSize(e,i),this.EF.setTexSize(e,i)}run(t=-1){let e=this.w_.getRenderProxy(),i=e.getRenderAdapter();this.EN?i.synFBOSizeWithViewport():i.asynFBOSizeWithViewport(),t<0&&(t=this.EM),this.updateState(i),i.setRenderToTexture(this.getTextureAt(0),!0,!1,0),i.useFBO(!0,!0,!1),null!=this.EQ&&this.w_.drawEntity(this.EQ),t>=0&&this.w_.runAt(t);let s=0;for(;s<this.EK;++s)i.setRenderToTexture(this.getTextureAt(1-s%2),!0,!1,0),i.useFBO(!0,!0,!1),s%2==0?this.w_.drawEntity(this.ED):this.w_.drawEntity(this.EE);this.EJ&&(i.setRenderToBackBuffer(o.default.FRAMEBUFFER),e.unlockRenderState(),s%2==0?this.w_.drawEntity(this.ED):this.w_.drawEntity(this.EE))}destroy(){null!=this.w_&&(this.w_.removeEntity(this.ED),this.w_.removeEntity(this.EE),this.ED.destroy(),this.EE.destroy(),this.ED=null,this.EE=null,this.EF=null,this.EG=null,this.EH[0]=null,this.EH[1]=null,this.w_=null)}}m.HORIZONTAL=0,m.VERTICAL=1,m.DEFALUT=2,e.default=m},8333:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.COLOR_BUFFER_BIT=131,s.DEPTH_BUFFER_BIT=132,s.STENCIL_BUFFER_BIT=133,e.default=s},"838f":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("f041"),r=i("ccaa");class a{constructor(){this.A8=null,this.C_d=null,this.terrain=new r.SimpleTerrain}getTerrainData(){return this.C_d}initTerrain(){let t=new Uint16Array([0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0]),e=new s.TerrainData;e.rn=6,e.cn=6,e.stvs=t,e.rn=30,e.cn=30,e.terrainHeight=15,e.obstacleHeight=e.terrainHeight,e.obstacleY=0,e.gridSize=80,e.positionOffset.y=-e.terrainHeight;let i=new Uint16Array(e.rn*e.cn);for(let s=0;s<i.length;++s)i[s]=Math.random()>.9?1:0;e.stvs=i,e.initialize(),this.C_d=e,this.initTerrainIns(e)}initTerrainIns(t){this.terrain.initialize(this.A8,this.B_a,t)}initialize(t,e){null==this.A8&&(this.A8=t,this.B_a=e,this.initTerrain())}}e.TerrainModule=a},"839a":function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["Default"]=1]="Default",t[t["FragColor"]=2]="FragColor",t[t["SpecularMapColor"]=3]="SpecularMapColor"}(s||(s={})),e.SpecularMode=s},"83d1":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73")),a=s(i("7279"));class n{create(t,e){let i=null,s=r.default.StageParam;return e.hasUniformByName(s.name)&&(i=new a.default,i.uns=s.name,i.uniformNameList=[s.name],i.copyDataFromProbe(t.getStage3D().uProbe)),i}getIDNS(){return"StageParamUniformBuilder"}}e.default=n},"857b":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73")),a=s(i("7279"));class n{create(t,e){let i=null,s=r.default.CameraPosParam;return e.hasUniformByName(s.name)&&(i=new a.default,i.uns=s.name,i.uniformNameList=[s.name],i.copyDataFromProbe(t.getCamera().ucameraPosProbe)),i}getIDNS(){return"CameraPosUniformBuilder"}}e.default=n},"85b6":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("8d98"),a=s(i("0851"));class n extends a.default{constructor(t,e,i=!1){super(t,e,i),this.ER=null,this.n=r.TextureProxyType.Wrapper}getResUid(){return this.ER.getResUid()}getBufWidth(){return this.ER.getBufWidth()}getBufHeight(){return this.ER.getBufHeight()}getWidth(){return this.ER.getWidth()}getHeight(){return this.ER.getHeight()}isDirect(){return!1}attachTex(t){null!=t&&t!=this&&(this.ER!=t&&t.__$attachThis(),this.ER=t)}detachTex(){null!=this.ER&&this.ER.__$detachThis(),this.ER=null}__$attachThis(){super.__$attachThis(),null!=this.ER&&this.ER.__$attachThis()}__$detachThis(){super.__$detachThis(),null!=this.ER&&this.ER.__$detachThis()}__$$use(t){this.ER.__$$use(t)}isGpuEnabled(){return this.ER.isGpuEnabled()}getSampler(){return this.ER.getSampler()}__$updateToGpu(t){this.ER.__$updateToGpu(t)}__$$upload(t){this.ER.__$$upload(t)}__$destroy(){this.getAttachCount()<1&&(null!=this.ER&&this.ER.__$detachThis(),this.ER=null,super.__$destroy())}isDataEnough(){return this.ER.isDataEnough()}getTargetType(){return this.ER.getTargetType()}toString(){return"[WrapperTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},8602:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("3930"));class n{constructor(){this.position=new r.default(0,100,0),this.color=new a.default(1,1,1,1),this.attenuationFactor1=1e-4,this.attenuationFactor2=5e-4}}e.PointLight=n},8875:function(t,e,i){var s,r,a;(function(i,n){r=[],s=n,a="function"===typeof s?s.apply(e,r):s,void 0===a||(t.exports=a)})("undefined"!==typeof self&&self,(function(){function t(){var e=Object.getOwnPropertyDescriptor(document,"currentScript");if(!e&&"currentScript"in document&&document.currentScript)return document.currentScript;if(e&&e.get!==t&&document.currentScript)return document.currentScript;try{throw new Error}catch(d){var i,s,r,a=/.*at [^(]*\((.*):(.+):(.+)\)$/gi,n=/@([^@]*):(\d+):(\d+)\s*$/gi,l=a.exec(d.stack)||n.exec(d.stack),h=l&&l[1]||!1,o=l&&l[2]||!1,m=document.location.href.replace(document.location.hash,""),_=document.getElementsByTagName("script");h===m&&(i=document.documentElement.outerHTML,s=new RegExp("(?:[^\\n]+?\\n){0,"+(o-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),r=i.replace(s,"$1").trim());for(var u=0;u<_.length;u++){if("interactive"===_[u].readyState)return _[u];if(_[u].src===h)return _[u];if(h===m&&_[u].innerHTML&&_[u].innerHTML.trim()===r)return _[u]}return null}}return t}))},8910:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8a0a")),a=s(i("fecb")),n=s(i("cb29")),l=s(i("e7d2")),h=i("e08e");class o extends n.default{constructor(t=r.default.VTX_STATIC_DRAW){super(t),this.offsetU=0,this.offsetV=0,this.uScale=1,this.vScale=1,this.flipVerticalUV=!1,this.flip90UV=!1,this.B_K=null,this.B_L=null,this.B_M=null,this.B_N=null}getVS(){return this.B_K}getUVS(){return this.B_L}getNVS(){return this.B_M}getCVS(){return this.B_N}initialize(t,e,i){if(null!=this.B_K)return;i=Math.abs(.5*i),this.B_O=new Uint16Array([0,1,2,0,2,3]),this.B_K=new Float32Array([t.x,t.y,t.z,i,e.x,e.y,e.z,i,e.x,e.y,e.z,-i,t.x,t.y,t.z,-i]);let s={x:0,y:0,z:0};if(s.x=2*e.x-t.x,s.y=2*e.y-t.y,s.z=2*e.z-t.z,this.B_M=new Float32Array([e.x,e.y,e.z,s.x,s.y,s.z,s.x,s.y,s.z,e.x,e.y,e.z]),null==this.bounds&&(this.bounds=new a.default),this.bounds.addXYZFloat32Arr(this.B_K),this.bounds.updateFast(),l.default.Reset(),l.default.AddFloat32Data(this.B_K,4),this.isVBufEnabledAt(r.default.VBUF_UVS_INDEX)){let t;t=this.flipVerticalUV?[0,0,1,0,1,1,0,1]:this.flip90UV?[1,1,1,0,0,0,0,1]:[0,1,1,1,1,0,0,0],this.B_L=new Float32Array(t),l.default.AddFloat32Data(this.B_L,2)}l.default.AddFloat32Data(this.B_M,3),l.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.vtCount=this.B_O.length,this.B_Q=l.default.CreateBySaveData(this.getBufDataUsage()),this.B_Q.setUintIVSData(this.B_O),this.vtxTotal=4,this.trisNumber=2,this.drawMode=h.RenderDrawMode.ELEMENTS_TRIANGLES,this.buildEnd()}initializeBill(){if(null==this.B_K){if(this.B_O=new Uint16Array([0,1,2,0,2,3]),this.B_K=new Float32Array([3,1,4,1,4,-1,3,-1]),null==this.bounds&&(this.bounds=new a.default),this.bounds.addXYZFloat32Arr(this.B_K),this.bounds.updateFast(),l.default.Reset(),l.default.AddFloat32Data(this.B_K,2),this.isVBufEnabledAt(r.default.VBUF_UVS_INDEX)){let t;t=this.flipVerticalUV?[0,0,1,0,1,1,0,1]:this.flip90UV?[1,1,1,0,0,0,0,1]:[0,1,1,1,1,0,0,0],this.B_L=new Float32Array(t),l.default.AddFloat32Data(this.B_L,2)}l.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.vtCount=this.B_O.length,this.B_Q=l.default.CreateBySaveData(this.getBufDataUsage()),this.B_Q.setUintIVSData(this.B_O),this.vtxTotal=4,this.trisNumber=2,this.drawMode=h.RenderDrawMode.ELEMENTS_TRIANGLES,this.buildEnd()}}toString(){return"[LightLine3DMesh()]"}__$destroy(){this.isResFree()&&(this.bounds=null,this.B_K=null,this.B_L=null,this.B_M=null,this.B_N=null,super.__$destroy())}}e.default=o},"8a0a":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ca6c"));class a{static ToGL(t,e){switch(e){case a.VTX_STATIC_DRAW:return t.STATIC_DRAW;case a.VTX_DYNAMIC_DRAW:return t.DYNAMIC_DRAW;case a.VTX_STREAM_DRAW:return t.STREAM_DRAW;case a.VTX_STATIC_READ:return t.STATIC_READ;case a.VTX_DYNAMIC_READ:return t.DYNAMIC_READ;case a.VTX_STREAM_READ:return t.STREAM_READ;case a.VTX_STATIC_COPY:return t.STATIC_COPY;case a.VTX_DYNAMIC_COPY:return t.DYNAMIC_COPY;case a.VTX_STREAM_COPY:return t.STREAM_COPY;default:break}return t.STATIC_DRAW}static GetVBufTypeByNS(t){switch(t){case a.VBUF_VS_NS:return a.VBUF_VS;case a.VBUF_UVS_NS:return a.VBUF_UVS;case a.VBUF_NVS_NS:return a.VBUF_NVS;case a.VBUF_CVS_NS:return a.VBUF_CVS;case a.VBUF_VS2_NS:return a.VBUF_VS2;case a.VBUF_UVS2_NS:return a.VBUF_UVS2;case a.VBUF_NVS2_NS:return a.VBUF_NVS2;case a.VBUF_CVS2_NS:return a.VBUF_CVS2;case a.VBUF_TVS_NS:return a.VBUF_TVS;case a.VBUF_TVS2_NS:return a.VBUF_TVS2;default:}return-1}static GetVBufNSByType(t){switch(t){case a.VBUF_VS:return a.VBUF_VS_NS;case a.VBUF_UVS:return a.VBUF_UVS_NS;case a.VBUF_NVS:return a.VBUF_NVS_NS;case a.VBUF_CVS:return a.VBUF_CVS_NS;case a.VBUF_VS2:return a.VBUF_VS2_NS;case a.VBUF_UVS2:return a.VBUF_UVS2_NS;case a.VBUF_NVS2:return a.VBUF_NVS2_NS;case a.VBUF_CVS2:return a.VBUF_CVS2_NS;case a.VBUF_TVS:return a.VBUF_TVS_NS;case a.VBUF_TVS2:return a.VBUF_TVS2_NS;default:}return""}static GetVBufAttributeTypeByNS(t){return a.GetVBufTypeByNS(t)-3e3}}a.VTXTYPE_GL_POINTS=101,a.VTXTYPE_GL_LINES=102,a.VTXTYPE_GL_LINE_STRIP=103,a.VTXTYPE_GL_TRIANGLES=111,a.VTX_STATIC_DRAW=0,a.VTX_DYNAMIC_DRAW=1,a.VTX_STREAM_DRAW=2,a.VTX_STATIC_READ=3,a.VTX_DYNAMIC_READ=4,a.VTX_STREAM_READ=5,a.VTX_STATIC_COPY=6,a.VTX_DYNAMIC_COPY=7,a.VTX_STREAM_COPY=8,a.VBUF_VS=3001,a.VBUF_UVS=3002,a.VBUF_NVS=3003,a.VBUF_CVS=3004,a.VBUF_TVS=3005,a.VBUF_VS2=3006,a.VBUF_UVS2=3007,a.VBUF_NVS2=3008,a.VBUF_CVS2=3009,a.VBUF_TVS2=3010,a.VBUF_VS_INDEX=r.default.BIT_ONE_0,a.VBUF_UVS_INDEX=r.default.BIT_ONE_1,a.VBUF_NVS_INDEX=r.default.BIT_ONE_2,a.VBUF_CVS_INDEX=r.default.BIT_ONE_3,a.VBUF_TVS_INDEX=r.default.BIT_ONE_4,a.VBUF_VS2_INDEX=r.default.BIT_ONE_5,a.VBUF_UVS2_INDEX=r.default.BIT_ONE_6,a.VBUF_NVS2_INDEX=r.default.BIT_ONE_7,a.VBUF_CVS2_INDEX=r.default.BIT_ONE_8,a.VBUF_TVS2_INDEX=r.default.BIT_ONE_9,a.VBUF_VS_NS="a_vs",a.VBUF_VS2_NS="a_vs2",a.VBUF_UVS_NS="a_uvs",a.VBUF_UVS2_NS="a_uvs2",a.VBUF_NVS_NS="a_nvs",a.VBUF_NVS2_NS="a_nvs2",a.VBUF_CVS_NS="a_cvs",a.VBUF_CVS2_NS="a_cvs2",a.VBUF_TVS_NS="a_tvs",a.VBUF_TVS2_NS="a_tvs2";class n{}n.FLAT=210,n.GOURAND=310,e.VtxNormalType=n,e.default=a},"8ae0":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("e2fe"));var a;(function(t){t[t["NONE"]=0]="NONE",t[t["ONE"]=1]="ONE",t[t["TWO_H"]=2]="TWO_H",t[t["TWO_V"]=3]="TWO_V",t[t["THREE"]=4]="THREE",t[t["FOUR"]=5]="FOUR"})(a=e.TexAreaFillType||(e.TexAreaFillType={}));class n{constructor(t=0,e=0,i=100,s=100){this.uniqueNS="TexArea",this.listIndex=-1,this.atlasUid=0,this.rect=null,this.texRect=null,this.offset=2,this.minSize=32,this.uvs=new Float32Array(8),this.rect=new r.default(t,e,i,s),this.texRect=new r.default(t,e,i,s)}copyFrom(t){this.uniqueNS=t.uniqueNS,this.rect.copyFrom(t.rect),this.offset=t.offset,this.uvs.set(t.uvs,0)}update(){this.rect.update()}}e.TexArea=n;class l{constructor(t=0,e=0,i=100,s=100){this.rect=null,this.subNodes=null,this.uniqueNS="TexAreaNode",this.subIndex=0,this.ES=a.NONE,this.rect=new r.default(t,e,i,s)}isFull(){if(null==this.subNodes)return!1;let t=null,e=this.subNodes;if(1==e.length)return!0;for(let i=0;i<e.length;++i)if(t=e[i],!t.isFull())return!1;return!0}fillFour(t,e){let i=!1;if(null==this.subNodes){let e=this.rect,s=(t.rect,.5*this.rect.width),r=.5*this.rect.height,n=new l(e.x,e.y,s,r),h=new l(e.x+s,e.y,s,r),o=new l(e.x+s,e.y+r,s,r),m=new l(e.x,e.y+r,s,r);this.subNodes=[n,h,o,m];for(let t=0;t<this.subNodes.length;++t)this.subNodes[t].subIndex=t;let _=this.subNodes[0];this.subNodes.sort((t,e)=>t.rect.width*t.rect.height-e.rect.width*e.rect.height),this.ES=a.FOUR,i=_.fillOne(t)}else{let e=null,s=this.subNodes;for(let r=0;r<s.length;++r)if(e=s[r],!e.isFull()&&(i=e.addTexArea(t),i))break}return i}fillThree(t){let e=!1;if(null==this.subNodes){let e,i,s=this.rect,r=t.rect,n=new l(s.x,s.y,r.width,r.height);r.width>r.height?(e=new l(s.x+r.width,s.y,this.rect.width-r.width,this.rect.height),i=new l(s.x,s.y+r.height,r.width,this.rect.height-r.height)):(e=new l(s.x+r.width,s.y,this.rect.width-r.width,r.height),i=new l(s.x,s.y+r.height,this.rect.width,this.rect.height-r.height)),this.subNodes=[n,e,i];for(let t=0;t<this.subNodes.length;++t)this.subNodes[t].subIndex=t;let h=this.subNodes[1],o=this.subNodes[2];return h.rect.width*h.rect.height>o.rect.width*o.rect.height&&(this.subNodes[1]=o,this.subNodes[2]=h),this.ES=a.THREE,this.subNodes[0].fillOne(t)}{let i=null,s=this.subNodes;for(let r=0;r<s.length;++r)if(i=s[r],!i.isFull()&&(e=i.addTexArea(t),e))break}return e}fillTwoH(t){if(null==this.subNodes){let e=t.rect.width,i=this.rect.width-t.rect.width,s=this.rect.height,r=this.rect,n=new l(r.x,r.y,e,s),h=new l(r.x+e,r.y,i,s);return this.subNodes=[n,h],this.ES=a.TWO_H,n.fillOne(t)}return!this.subNodes[1].isFull()&&this.subNodes[1].addTexArea(t)}fillTwoV(t){if(null==this.subNodes){let e=this.rect.width,i=t.rect.height,s=this.rect.height-t.rect.height,r=this.rect,n=new l(r.x,r.y,e,i),h=new l(r.x,r.y+i,e,s);return this.subNodes=[n,h],this.ES=a.TWO_V,n.fillOne(t)}return!this.subNodes[1].isFull()&&this.subNodes[1].addTexArea(t)}fillOne(t){let e=!0;return null==this.subNodes&&(this.subNodes=[this],this.ES=a.ONE,t.rect.x=this.rect.x,t.rect.y=this.rect.y,t.update(),this.uniqueNS=t.uniqueNS),e}findByXY(t,e){if(this.rect.containsXY(t,e)&&null!=this.subNodes){if(this.ES==a.ONE)return this;let i;for(let s=0;s<this.subNodes.length;++s)if(i=this.subNodes[s].findByXY(t,e),null!=i)return i}return null}addTexArea(t){let e=t.rect.width,i=t.rect.height;if(this.rect.width<=t.minSize&&this.rect.height<=t.minSize)return e<=this.rect.width&&i<=this.rect.height&&!this.isFull()&&this.fillOne(t);let s=this.rect.width>t.minSize?this.rect.width:t.minSize,r=this.rect.height>t.minSize?this.rect.height:t.minSize;if(e<=s&&i<=r){let n=.5*s,l=.5*r,h=this.ES;if(this.ES==a.NONE)h=e<=n&&i<=l?a.FOUR:e<=n?a.TWO_H:i<=l?a.TWO_V:a.ONE;else if(h==a.ONE)return!1;return!this.isFull()&&(h==a.THREE||h==a.FOUR?this.fillThree(t):h==a.TWO_H?this.fillTwoH(t):h==a.TWO_V?this.fillTwoV(t):this.fillOne(t))}return!1}}e.TexAreaNode=l},"8ae4":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.T=0,this.B_6=null,this.B_7=0,this.ET=null,this.EU=0,this.ibufStep=0,this.T=s.H0+1}getUid(){return this.T}getVtxUid(){return this.B_7}getGpuBuf(){return this.ET}getVTCount(){return this.EU}updateToGpu(t){if(null!=this.ET&&this.EU>0){let e=this.B_6;this.version!=e.indicesVer&&(this.B_O=e.getIvsData(),t.bindEleBuf(this.ET),this.EU>=this.B_O.length?t.eleBufSubData(this.B_O,e.getBufDataUsage()):t.eleBufData(this.B_O,e.getBufDataUsage()),this.EU=this.B_O.length,this.version=e.indicesVer)}}initialize(t,e){if(null==this.ET&&null!=e.getIvsData())if(this.version=e.indicesVer,this.B_6=e,this.B_7=e.getUid(),this.B_O=e.getIvsData(),this.ET=t.createBuf(),t.bindEleBuf(this.ET),null==e.bufData)t.eleBufData(this.B_O,e.getBufDataUsage()),this.EU=this.B_O.length;else{t.eleBufDataMem(e.bufData.getIndexDataTotalBytes(),e.getBufDataUsage());let i=null,s=0;this.EU=0;for(let r=0,a=e.bufData.getIndexDataTotal();r<a;++r)i=e.bufData.getIndexDataAt(r),t.eleBufSubData(i,s),s+=i.byteLength,this.EU+=i.length}}destroy(t){null!=this.ET&&(this.B_6=null,t.deleteBuf(this.ET),this.ET=null,this.B_O=null,this.EU=0)}}s.H0=0,e.ROIndicesRes=s},"8ca9":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6953")),a=s(i("3aab"));class n{constructor(t){this.r=null,this.EV=[],this.EW=[],this.effectRenderProcessIndex=2,this.Dj=0,this.r=t}createAtt(t,e,i,s,n){let l;this.EW.length>0?(l=this.EW.pop(),l.reset()):(l=new a.default(this.r),l.effectRenderProcessIndex=this.effectRenderProcessIndex,l.initialize(0)),l.setPosParam(e,i,s,n),this.EW.push(l),r.default.RunnerQueue.addRunner(this)}setRunFlag(t){this.Dj=t}getRunFlag(){return this.Dj}isRunning(){return!0}isStopped(){return!1}run(){let t;for(let e=0,i=this.EW.length;e<i;++e)t=this.EW[e],t.run(),t.isHiding()&&(this.EW.splice(e,1),e--,i--,this.EW.push(t));this.EW.length<1&&r.default.RunnerQueue.removeRunner(this)}}e.default=n},"8d98":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("030e"));class n{static ToGL(t,e){switch(e){case n.RGBA:break;case n.R8:return t.R8;case n.RGB:return t.RGB;case n.RGB8:return t.RGB8;case n.RGBA8:return t.RGBA8;case n.ALPHA:return t.ALPHA;case n.RGB16F:return r.default.IsWebGL2()?t.RGB16F:t.RGB;case n.RGBA16F:return r.default.IsWebGL2()?t.RGBA16F:t.RGBA;case n.RGB32F:return r.default.IsWebGL2()&&t.RGB32F,t.RGB;case n.RGBA32F:return r.default.IsWebGL2()&&t.RGBA32F,t.RGBA;case n.RED:return t.RED;case n.DEPTH_COMPONENT:return t.DEPTH_COMPONENT;case n.DEPTH_STENCIL:return t.DEPTH_STENCIL;default:break}return t.RGBA}}n.R8=101,n.RGB=110,n.RED=111,n.RGBA=121,n.RGB8=122,n.RGBA8=123,n.ALPHA=132,n.RGB16F=331,n.RGBA16F=332,n.RGB32F=341,n.RGBA32F=342,n.DEPTH_COMPONENT=351,n.DEPTH_STENCIL=352,e.TextureFormat=n;class l{static ToGL(t,e){switch(e){case l.UNSIGNED_BYTE:return t.UNSIGNED_BYTE;case l.BYTE:return t.BYTE;case l.FLOAT:return t.FLOAT;case l.HALF_FLOAT:return t.HALF_FLOAT;case l.HALF_FLOAT_OES:return null!=a.default.OES_texture_half_float?a.default.OES_texture_half_float.HALF_FLOAT_OES:t.FLOAT;case l.UNSIGNED_SHORT:return t.UNSIGNED_SHORT;case l.UNSIGNED_INT:return t.UNSIGNED_INT;case l.UNSIGNED_SHORT_5_6_5:return t.UNSIGNED_SHORT_5_6_5;case l.UNSIGNED_SHORT_4_4_4_4:return t.UNSIGNED_SHORT_4_4_4_4;case l.UNSIGNED_SHORT_5_5_5_1:return t.UNSIGNED_SHORT_5_5_5_1;case l.UNSIGNED_INT_24_8_WEBGL:return a.default.WEBGL_depth_texture.UNSIGNED_INT_24_8_WEBGL;default:break}return t.UNSIGNED_BYTE}}l.UNSIGNED_BYTE=1108,l.UNSIGNED_SHORT=1109,l.UNSIGNED_INT=1110,l.BYTE=1111,l.FLOAT=1211,l.HALF_FLOAT=1212,l.HALF_FLOAT_OES=1213,l.UNSIGNED_SHORT_5_6_5=1214,l.UNSIGNED_SHORT_4_4_4_4=1215,l.UNSIGNED_SHORT_5_5_5_1=1216,l.UNSIGNED_INT_24_8_WEBGL=1217,e.TextureDataType=l;class h{static GetValue(t,e){switch(e){case h.TEXTURE_2D:return t.TEXTURE_2D;case h.TEXTURE_2D_ARRAY:return t.TEXTURE_2D_ARRAY;case h.TEXTURE_CUBE:return t.TEXTURE_CUBE_MAP;case h.TEXTURE_3D:return t.TEXTURE_3D;default:break}return t.TEXTURE_2D}}h.TEXTURE_2D=20,h.TEXTURE_2D_ARRAY=22,h.TEXTURE_SHADOW_2D=23,h.TEXTURE_CUBE=25,h.TEXTURE_3D=30,e.TextureTarget=h,function(t){t[t["Default"]=0]="Default",t[t["Depth"]=1]="Depth",t[t["Wrapper"]=2]="Wrapper",t[t["RTT"]=3]="RTT",t[t["Image"]=4]="Image",t[t["Float"]=5]="Float",t[t["Uint16"]=6]="Uint16",t[t["FloatCube"]=7]="FloatCube",t[t["Bytes"]=8]="Bytes",t[t["BytesCube"]=9]="BytesCube",t[t["ImageCube"]=10]="ImageCube",t[t["Texture3D"]=11]="Texture3D"}(e.TextureProxyType||(e.TextureProxyType={}));class o{static GetConst(t,e){switch(e){case o.NEAREST:return t.NEAREST;case o.LINEAR:return t.LINEAR;case o.LINEAR_MIPMAP_LINEAR:return t.LINEAR_MIPMAP_LINEAR;case o.NEAREST_MIPMAP_NEAREST:return t.NEAREST_MIPMAP_NEAREST;case o.LINEAR_MIPMAP_NEAREST:return t.LINEAR_MIPMAP_NEAREST;case o.NEAREST_MIPMAP_LINEAR:return t.NEAREST_MIPMAP_LINEAR;case o.WRAP_REPEAT:return t.REPEAT;case o.WRAP_CLAMP_TO_EDGE:return t.CLAMP_TO_EDGE;case o.WRAP_MIRRORED_REPEAT:return t.MIRRORED_REPEAT;default:break}return-1}}o.WRAP_REPEAT=3001,o.WRAP_CLAMP_TO_EDGE=3002,o.WRAP_MIRRORED_REPEAT=3003,o.NEAREST=4001,o.LINEAR=4002,o.LINEAR_MIPMAP_LINEAR=4003,o.NEAREST_MIPMAP_NEAREST=4004,o.LINEAR_MIPMAP_NEAREST=4005,o.NEAREST_MIPMAP_LINEAR=4006,e.TextureConst=o},"8def":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("919c"));class a extends r.default{constructor(){super(),this.shdp=null,this.vbufs=null,this.vbuf=null,this.attribTypes=null,this.wholeOffsetList=null,this.attribTypesLen=0,this.updateUnlocked=!0,this.wholeStride=0,this.T=a.H0++}run(){this.A7.testVROUid(this.T)&&(null!=this.vbuf?this.A7.useVtxAttribsPtrTypeFloat(this.shdp,this.vbuf,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride):this.A7.useVtxAttribsPtrTypeFloatMulti(this.shdp,this.vbufs,this.attribTypes,this.attribTypesLen,this.wholeOffsetList,this.wholeStride),this.A7.testRIOUid(this.B_7)&&this.A7.bindEleBuf(this.ibuf))}__$destroy(){r.default.H_6.delete(this.EX),this.EX=0,this.B_7=-1,this.A7=null,this.shdp=null,this.vbufs=null,this.vbuf=null,this.ibuf=null,this.attribTypes=null,this.attribTypesLen=0,this.wholeStride=0}restoreThis(){a.Restore(this)}toString(){return"VertexRenderObj(uid = "+this.T+", type="+this.EX+")"}static HasMid(t){return r.default.H_6.has(t)}static GetByMid(t){return r.default.H_6.get(t)}static GetFreeId(){return a.H_7.length>0?a.H_7.pop():-1}static Create(t,e,i){let s=null,n=a.GetFreeId();return n>=0?(s=a.H_8[n],a.H_9[n]=a.S_FLAG_BUSY,s.setMidAndBufUid(e,i)):(s=new a,s.setMidAndBufUid(e,i),a.H_8.push(s),a.H_9.push(a.S_FLAG_BUSY),a.H_++),s.setRC(t),r.default.H_6.set(e,s),s}static Restore(t){if(null!=t&&t.c<1&&a.H_9[t.getUid()]==a.S_FLAG_BUSY){let e=t.getUid();a.H_7.push(e),a.H_9[e]=a.S_FLAG_FREE,t.__$destroy()}}}a.H0=0,a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.H_9=[],a.H_=0,a.H_8=[],a.H_7=[],e.default=a},"8e17":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01"));class a{constructor(t=0,e=0,i=0,s=1){this.x=0,this.y=0,this.z=0,this.w=0,this.x=t,this.y=e,this.z=i,this.w=s}clone(){return new a(this.x,this.y,this.z,this.w)}setTo(t,e,i,s=1){this.x=t,this.y=e,this.z=i,this.w=s}setXYZ(t,e,i){this.x=t,this.y=e,this.z=i}copyFrom(t){this.x=t.x,this.y=t.y,this.z=t.z}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}multBy(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);t>r.default.MATH_MIN_POSITIVE&&(this.x/=t,this.y/=t,this.z/=t)}normalizeTo(t){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);e>r.default.MATH_MIN_POSITIVE?(t.x=this.x/e,t.y=this.y/e,t.z=this.z/e):(t.x=this.x,t.y=this.y,t.z=this.z)}scaleVector(t){this.x*=t.x,this.y*=t.y,this.z*=t.z}scaleBy(t){this.x*=t,this.y*=t,this.z*=t}negate(){this.x=-this.x,this.y=-this.y,this.z=-this.z}equalsXYZ(t){return Math.abs(this.x-t.x)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.y-t.y)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.z-t.z)<r.default.MATH_MIN_POSITIVE}equalsAll(t){return Math.abs(this.x-t.x)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.y-t.y)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.z-t.z)<r.default.MATH_MIN_POSITIVE&&Math.abs(this.w-t.w)<r.default.MATH_MIN_POSITIVE}project(){let t=1/this.w;this.x*=t,this.y*=t,this.z*=t}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}getLengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}addBy(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}subtractBy(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}subtract(t){return new a(this.x-t.x,this.y-t.y,this.z-t.z)}add(t){return new a(this.x+t.x,this.y+t.y,this.z+t.z)}crossProduct(t){return new a(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}crossBy(t){let e=this.y*t.z-this.z*t.y,i=this.z*t.x-this.x*t.z,s=this.x*t.y-this.y*t.x;this.x=e,this.y=i,this.z=s}reflectBy(t){let e=2*(this.x*t.x+this.y*t.y+this.z*t.z);this.x=this.x-e*t.x,this.y=this.y-e*t.y,this.z=this.z-e*t.z}scaleVecTo(t,e){this.x=t.x*e,this.y=t.y*e,this.z=t.z*e}subVecsTo(t,e){this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z}addVecsTo(t,e){this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z}crossVecsTo(t,e){this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x}toString(){return"Vector3D("+this.x+this.y+this.z+")"}static Cross(t,e,i){i.x=t.y*e.z-t.z*e.y,i.y=t.z*e.x-t.x*e.z,i.z=t.x*e.y-t.y*e.x}static CrossSubtract(t,e,i,s,r){a.__vtor3Stv0.x=e.x-t.x,a.__vtor3Stv0.y=e.y-t.y,a.__vtor3Stv0.z=e.z-t.z,a.__vtor3Stv1.x=s.x-i.x,a.__vtor3Stv1.y=s.y-i.y,a.__vtor3Stv1.z=s.z-i.z,t=a.__vtor3Stv0,i=a.__vtor3Stv1,r.x=t.y*i.z-t.z*i.y,r.y=t.z*i.x-t.x*i.z,r.z=t.x*i.y-t.y*i.x}static Subtract(t,e,i){i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z}static DistanceSquared(t,e){return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,a.__vtor3Stv0.getLengthSquared()}static DistanceXYZ(t,e,i,s,r,n){return a.__vtor3Stv0.x=t-s,a.__vtor3Stv0.y=e-r,a.__vtor3Stv0.z=i-n,a.__vtor3Stv0.getLength()}static Distance(t,e){return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,a.__vtor3Stv0.getLength()}static AngleBetween(t,e){return t.normalizeTo(a.__vtor3Stv0),e.normalizeTo(a.__vtor3Stv1),Math.acos(a.__vtor3Stv0.dot(a.__vtor3Stv1))*r.default.MATH_180_OVER_PI}static RadianBetween(t,e){return t.normalizeTo(a.__vtor3Stv0),e.normalizeTo(a.__vtor3Stv1),Math.acos(a.__vtor3Stv0.dot(a.__vtor3Stv1))}static RadianBetween2(t,e){let i=t.getLengthSquared(),s=e.getLengthSquared();return a.__vtor3Stv0.x=t.x-e.x,a.__vtor3Stv0.y=t.y-e.y,a.__vtor3Stv0.z=t.z-e.z,Math.acos((i+s-a.__vtor3Stv0.getLengthSquared())/(2*Math.sqrt(i)*Math.sqrt(s)))}static Reflect(t,e,i){let s=2*(t.x*e.x+t.y*e.y+t.z*e.z);i.x=t.x-s*e.x,i.y=t.y-s*e.y,i.z=t.z-s*e.z}}a.X_AXIS=new a(1,0,0),a.Y_AXIS=new a(0,1,0),a.Z_AXIS=new a(0,0,1),a.__vtor3Stv0=new a,a.__vtor3Stv1=new a,a.ZERO=new a,e.default=a},9156:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static SetTransUniform(t,e){s.IA.set(t.getUid(),e)}static GetTransUniform(t){if(t.getUid()<0)throw Error("mat.getUid() < 0");return s.IA.has(t.getUid())?s.IA.get(t.getUid()):null}static HasTransUniform(t){return s.IA.has(t.getUid())}static RemoveTransUniform(t){s.IA.delete(t.getUid())}}s.IA=new Map,e.default=s},"919c":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.T=0,this.EX=0,this.B_7=0,this.A7=null,this.indicesRes=null,this.ibuf=null,this.ibufStep=2,this.c=0}getVTCount(){return null!=this.indicesRes?this.indicesRes.getVTCount():0}setRC(t){this.A7=t}setMidAndBufUid(t,e){this.EX=t,this.B_7=e,this.c=0}getUid(){return this.T}getVtxUid(){return this.B_7}getMid(){return this.EX}run(){}__$attachThis(){++this.c}__$detachThis(){--this.c,this.c<1&&(this.c=0)}__$destroy(){s.H_6.delete(this.EX),this.EX=0,this.B_7=-1,this.ibuf=null,this.A7=null,this.indicesRes=null}restoreThis(){}static HasMid(t){return s.H_6.has(t)}static GetByMid(t){return s.H_6.get(t)}}s.H_6=new Map,e.default=s},"91e2":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("29ef")),n=s(i("402a")),l=s(i("f63e")),h=i("8a0a"),o=s(i("3bfb"));class m extends n.default{constructor(t=null){super(t),this.EY=h.VtxNormalType.FLAT,this.EZ=new r.default(-50,-50,-50),this.Ea=new r.default(50,50,50),this.B_P=null,this.Eb=null,this.Ec=!0,this.vtxColor=null,this.uScale=1,this.vScale=1,this.normalScale=1,this.uvPartsNumber=0,this.wireframe=!1}setVtxTransformMatrix(t){this.B_P=t}useFlatNormal(){this.EY=h.VtxNormalType.FLAT}useGourandNormal(){this.EY=h.VtxNormalType.GOURAND}createMaterial(t){if(null==this.getMaterial()){let e=new l.default;e.vertColorEnabled=null!=this.vtxColor,e.setTextureList(t),this.setMaterial(e)}else null!=t&&this.getMaterial().getTextureTotal()<1&&this.getMaterial().setTextureList(t)}initializeThis(t){if(this.Ec)this.createMaterial(t),this.activeDisplay();else{let t=this.getMesh();null!=t&&t.initialize(this.EZ,this.Ea)}this.Ec=!1}showBackFace(){this.setRenderState(a.default.BACK_CULLFACE_NORMAL_STATE)}showFrontFace(){this.setRenderState(a.default.FRONT_CULLFACE_NORMAL_STATE)}showAllFace(){this.setRenderState(a.default.NONE_CULLFACE_NORMAL_STATE)}scaleUVFaceAt(t,e,i,s,r){let a=this.getMesh();null!=a&&a.scaleUVFaceAt(t,e,i,s,r)}scaleUVSFaceAt(t,e){let i=this.getMesh();null!=i&&i.setFaceUVSAt(t,e)}reinitializeMesh(){null!=this.Eb&&this.Eb.reinitialize()}initialize(t,e,i=null){null!=t&&this.EZ.copyFrom(t),null!=e&&this.Ea.copyFrom(e),this.initializeThis(i)}initializeCube(t,e=null){t*=.5,this.EZ.setXYZ(-t,-t,-t),this.Ea.setXYZ(t,t,t),this.initializeThis(e)}initializeSizeXYZ(t,e,i,s=null){this.EZ.setXYZ(.5*-t,.5*-e,.5*-i),this.Ea.setXYZ(.5*t,.5*e,.5*i),this.initializeThis(s)}__activeMesh(t){if(this.Eb=this.getMesh(),null==this.Eb&&(this.Eb=new o.default),null!=this.Eb){let e=this.Eb;null!=this.B_P&&e.setTransformMatrix(this.B_P),e.vtxColor=this.vtxColor,e.uScale=this.uScale,e.vScale=this.vScale,e.wireframe=this.wireframe,e.normalType=this.EY,e.normalScale=this.normalScale,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.uvPartsNumber=this.uvPartsNumber,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.EZ,this.Ea),this.setMesh(e),e.setTransformMatrix(null)}this.B_P=null}updateMesh(){this.Eb=this.getMesh()}setFaceUVSAt(t,e,i=0){null!=this.Eb&&this.Eb.setFaceUVSAt(t,e,i)}transformFaceAt(t,e){null!=this.Eb&&this.Eb.transformFaceAt(t,e)}getFaceCenterAt(t,e){null!=this.Eb&&this.Eb.getFaceCenterAt(t,e)}destroy(){super.destroy(),this.vtxColor=null,this.Eb=null,this.Ec=!0}toString(){return"[Box3DEntity(uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=m},"91f5":function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["FREE_RUN"]=1001]="FREE_RUN",t[t["ATTACK_RUN"]=1002]="ATTACK_RUN"}(s||(s={})),e.default=s},9260:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("7045"));class a{static KeyDown(t){for(var e=a.Ed.length,i=0;i<e;++i)a.Ed[i].call(a.Ef[i],t)}static KeyUp(t){let e=a.Ee.length;for(let i=0;i<e;++i)a.Ee[i].call(a.Eg[i],t)}static RemoveEventListener(t,e){if(null!=e){let i;switch(t){case r.default.KEY_DOWN:for(i=a.Ed.length-1;i>=0;--i)if(e===a.Ed[i]){a.Ef.splice(i,1),a.Ed.splice(i,1);break}break;case r.default.KEY_UP:for(i=a.Ee.length-1;i>=0;--i)if(e===a.Ee[i]){a.Eg.splice(i,1),a.Ee.splice(i,1);break}break;default:break}}}}a.Ef=[],a.Ed=[],a.Eg=[],a.Ee=[],a.AddEventListener=function(t,e,i){if(null!=i){let s=0;switch(t){case r.default.KEY_DOWN:for(s=a.Ed.length-1;s>=0;--s)if(i===a.Ed[s])break;s<0&&(a.Ef.push(e),a.Ed.push(i));break;case r.default.KEY_UP:for(s=a.Ee.length-1;s>=0;--s)if(i===a.Ee[s])break;s<0&&(a.Eg.push(e),a.Ee.push(i));break;default:break}}},e.default=a},9557:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("fecb")),a=s(i("8a0a")),n=s(i("e7d2")),l=s(i("cb29")),h=i("670b"),o=s(i("8e17"));class m extends l.default{constructor(t=a.default.VTX_STATIC_DRAW){super(t),this.srcMesh=null,this.B_K=null,this.B_L=null,this.B_M=null,this.B_N=null}getVS(){return this.B_K}getUVS(){return this.B_L}getNVS(){return this.B_M}getCVS(){return this.B_N}setBufSortFormat(t){super.setBufSortFormat(t),this.srcMesh.setBufSortFormat(t)}initialize(t=1,e=3,i=null){let s=0,l=t,m=null==this.B_O;this.B_K=this.srcMesh.getVS(),this.B_L=this.srcMesh.getUVS(),this.B_M=this.srcMesh.getNVS(),this.B_O=this.srcMesh.getIVS(),n.default.Reset();let _=96,u=null!=i?i.length:1,d=_*t,c=new Float32Array(d*u),f=0,p=0,g=null!=i?i[0]:new o.default,v=this.srcMesh.getVS();for(let r=0;r<u;++r){for(g=null!=i?i[r]:new o.default,f=0,p=r*d,s=0;s<24;++s)c[p]=v[f]+g.x,c[p+1]=v[f+1]+g.y,c[p+2]=v[f+2]+g.z,c[p+3]=0,f+=3,p+=4;for(p=r*d,s=1;s<l;++s)f=s*_+p,c.copyWithin(f,p,p+_);let t=0;p=r*d;for(let i=1;i<l;++i)for(f=_*i+p,t+=e,s=0;s<24;++s)c[f+3]=t,f+=4}this.B_K=c,null==this.bounds&&(this.bounds=new r.default,this.bounds.addXYZFloat32Arr(this.B_K,4),this.bounds.updateFast()),n.default.AddFloat32Data(this.B_K,4),l*=u,this.isVBufEnabledAt(a.default.VBUF_UVS_INDEX)&&(this.B_L=this.buildGroupData(this.srcMesh.getUVS(),l,2)),this.isVBufEnabledAt(a.default.VBUF_NVS_INDEX)&&(this.B_M=this.buildGroupData(this.srcMesh.getNVS(),l,3)),this.isVBufEnabledAt(a.default.VBUF_CVS_INDEX)&&(this.B_N=this.buildGroupData(this.srcMesh.getCVS(),l,3)),n.default.vbWholeDataEnabled=this.vbWholeDataEnabled,m?(this.B_O=h.GeometryMerger.MergeSameIvs(this.srcMesh.getIVS(),this.B_K,4,l),this.B_Q=n.default.CreateBySaveData(this.getBufDataUsage()),this.B_Q.setUint16IVSData(this.B_O),this.vtCount=this.B_O.length,this.trisNumber=12*l,this.buildEnd()):n.default.UpdateBufData(this.B_Q)}buildGroupData(t,e,i){let s=t.length,r=new Float32Array(s*e);for(let a=0;a<e;++a)r.set(t,0),r.copyWithin(a*s,0,s);return n.default.AddFloat32Data(r,i),r}__$destroy(){this.isResFree()&&(this.bounds=null,this.srcMesh=null,this.B_K=null,this.B_L=null,this.B_M=null,this.B_N=null,super.__$destroy())}}e.IdGroupMesh=m},"955e":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("8e17")),n=s(i("fecb")),l=s(i("c120")),h=i("e08e"),o=s(i("29ef")),m=s(i("3930")),_=s(i("e7ce"));class u{constructor(){this.Eh=new m.default,this.Ei=new _.default,this.w_=null,this.A_=null,this.Ej=null,this.y=null,this.Ek=new Uint8Array(256),this.z=null,this.El=null,this.Em=0,this.En=0,this.Eo=new a.default,this.Ep=new a.default,this.C_P=null,this.C_Q=null,this.Eq=new Uint8Array(4),this.Er=new a.default,this.Es=new a.default,this.Et=[null,null],this.Eu=!0,this.Ev=new Uint8Array(4),this.Ew=new Uint8Array(256)}setRenderer(t){this.w_=t}setRayTestMode(t){this.En=t}setRay(t,e){this.C_P=t,this.C_Q=e}getRay(t,e){t.copyFrom(this.C_P),e.copyFrom(this.C_Q)}setCamera(t){this.A_=t}setCullingNodeHead(t){if(this.Ej=t,null==this.z){this.z=[];let t=0;for(;t<256;++t)this.z.push(new l.default)}}getSelectedNode(){return this.El}getSelectedNodes(){return this.z}getSelectedNodesTotal(){return this.Em}sorting(t,e){let i=this.z;this.y=i[t];while(t<e){while(t<e&&i[e].dis>=this.y.dis)--e;i[t]=i[e];while(t<e&&i[t].dis<=this.y.dis)++t;i[e]=i[t]}return i[t]=this.y,t}snsort(t,e){if(t<e){let i=this.sorting(t,e);this.snsort(t,i-1),this.snsort(i+1,e)}}run(){let t=this.Ej;if(null!=t){let e=0,i=this.C_Q,s=this.C_P,a=this.Es,l=null,h=0;Math.abs(i.x)>r.default.MATH_MIN_POSITIVE?this.Er.x=1/i.x:this.Er.x=r.default.MATH_MAX_POSITIVE,Math.abs(i.y)>r.default.MATH_MIN_POSITIVE?this.Er.y=1/i.y:this.Er.y=r.default.MATH_MAX_POSITIVE,Math.abs(i.z)>r.default.MATH_MIN_POSITIVE?this.Er.z=1/i.z:this.Er.z=r.default.MATH_MAX_POSITIVE,this.Er.x<0?this.Eq[0]=1:this.Eq[0]=0,this.Er.y<0?this.Eq[1]=1:this.Eq[1]=0,this.Er.z<0?this.Eq[2]=1:this.Eq[2]=0;while(null!=t)t.drawEnabled&&t.entity.mouseEnabled&&(a.x=t.bounds.center.x-s.x,a.y=t.bounds.center.y-s.y,a.z=t.bounds.center.z-s.z,e=a.dot(i),a.x-=e*i.x,a.y-=e*i.y,a.z-=e*i.z,a.getLengthSquared()<=t.bounds.radius2&&t.rayTestState<1&&(this.Et[0]=t.bounds.min,this.Et[1]=t.bounds.max,n.default.IntersectionRL3(this.Et,this.Eq,this.Er,i,s,a)&&(l=this.z[h],l.entity=t.entity,l.dis=this.Er.w,l.wpv.copyFrom(a),++h))),t=t.next;this.El=null;let o=0;if(h>0){let t=this.Eo,e=this.Ep,r=null,n=0,l=0,m=null,_=null,u=i.dot(s),d=0,c=!this.Eu,f=0;if(h>1){for(this.snsort(0,h-1),o=0;o<h;++o){if(_=this.z[o],r=this.z[o].entity,r.isPolyhedral()?c?(m=r.getInvMatrix(),m.transformOutVector3(s,t),m.deltaTransformOutVector(i,e),e.normalize(),n=r.testRay(t,e,a,!0)):(++f,n=0):(m=r.getInvMatrix(),m.transformOutVector3(s,t),m.deltaTransformOutVector(i,e),e.normalize(),n=r.testRay(t,e,a,!0)),n>0){if(_.lpv.copyFrom(a),r.getMatrix().transformOutVector3(a,_.wpv),_.dis=i.dot(_.wpv)-u,this.Ek[l]=o,++l,_.dis>d){this.El=_;break}}else if(n<0&&(this.Ek[l]=o,++l,_.dis>d)){this.El=_;break}d=_.dis}null==this.El&&l>0&&(this.El=this.z[this.Ek[0]])}else _=this.z[0],r=this.z[0].entity,m=r.getInvMatrix(),m.transformOutVector3(s,t),m.deltaTransformOutVector(i,e),e.normalize(),r.isPolyhedral()?c?n=r.testRay(t,e,a,!0):(++f,n=0):n=r.testRay(t,e,a,!0),n>0?(_.lpv.copyFrom(a),r.getMatrix().transformOutVector3(a,_.wpv),_.dis=i.dot(_.wpv)-u,this.El=_):n<0&&(this.El=_);f>0&&(this.En<1||null==this.El||this.El.entity.isPolyhedral())&&this.gpuPick(h)}for(o=h;o<this.Em;++o)this.El!=this.z[o]&&(this.z[o].entity=null);this.Em=h}}gpuPick(t){let e=this.w_.getRendererContext(),i=this.w_.getRenderProxy(),s=i.getStage3D().mouseX,r=i.getStage3D().mouseY;e.vertexRenderBegin(),e.getClearRGBAColor4f(this.Eh),e.setClearRGBAColor4f(0,0,0,0),e.setScissorEnabled(!0),e.setScissorRect(s,r,1,1),e.clearBackBuffer(),this.Ev[3]=0,o.default.LockBlendMode(h.RenderBlendMode.OPAQUE),o.default.LockDepthTestMode(h.DepthTestMode.OPAQUE),e.unlockMaterial(),e.unlockRenderState(),e.useGlobalMaterial(this.Ei,!1,!1);let a=null,n=null,l=-1,m=0;for(;m<t;++m)a=this.z[m],n=this.z[m].entity,n.isPolyhedral()&&(++l,this.Ei.setIndex(l+2),this.Ew[l]=m,this.w_.updateMaterialUniformToCurrentShd(this.Ei),this.w_.drawEntity(n,!1,!0));if(l>-1&&i.readPixels(s,r,1,1,i.RGBA,i.UNSIGNED_BYTE,this.Ev),o.default.UnlockBlendMode(),o.default.UnlockDepthTestMode(),this.Ev[3]>1){m=this.Ew[this.Ev[3]-2],a=this.z[m];let t=(this.Ev[0]<<8)+this.Ev[1]+this.Ev[2]/255;if(null!=this.El){let e=this.El.entity;this.El==a||e.isPolyhedral()||this.El.dis<t&&(m=-1)}m>-1&&(a.dis=t,this.getWorldPosByRayDistance(t,this.C_Q,this.A_.getPosition(),a.wpv),this.El=a)}e.setScissorEnabled(!1),e.unlockMaterial(),e.unlockRenderState(),o.default.UnlockBlendMode(),o.default.UnlockDepthTestMode(),e.setClearRGBAColor4f(this.Eh.r,this.Eh.g,this.Eh.b,this.Eh.a),e.resetState()}clear(){this.El=null}getWorldPosByRayDistance(t,e,i,s){s.x=e.x*t+i.x,s.y=e.y*t+i.y,s.z=e.z*t+i.z}}e.default=u},9666:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("acfe"));class n{static CreateShdData(t,e,i,s,l){if(n.IB.has(t))return n.IB.get(t);let h=new a.default;return h.adaptationShaderVersion=s,h.preCompileInfo=l,h.initialize(t,e,i),n.IC[h.getUid()]=h,++n.s_shdDataListLen,n.IB.set(t,h),r.default.SHADERCODE_TRACE_ENABLED,h}static FindData(t){return n.IB.has(t)?n.IB.get(t):null}}n.IB=new Map,n.IC=[],n.s_shdDataListLen=0,e.default=n},"96af":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=i("a52f");class n{constructor(){this.Ex=null,this.Ey=new r.default,this.C_L=3,this.D_G=3,this.campType=a.CampType.Blue,this.srcRole=null,this.dstCamp=null}resetState(){this.Ex=null,this.D_G=0}setDelayTime(t){this.C_L=t>=0?t:3}testAttDst(t){return this.Ex=null,this.srcRole.getPosition(this.Ey),this.dstCamp.testAttDst(this.Ey,this.srcRole.attackDis+this.srcRole.radius,a.CampFindMode.XOZ,this.campType,t,-1)}findAttDst(t){return this.D_G<1||null!=this.Ex&&this.Ex.lifeTime<1?(this.D_G=this.C_L,this.srcRole.getPosition(this.Ey),null==this.Ex||this.Ex.lifeTime<1?this.Ex=this.dstCamp.findAttDst(this.Ey,this.srcRole.attackDis+this.srcRole.radius,a.CampFindMode.XOZ,this.campType,t,-1):this.Ex=this.dstCamp.testSpecAttDst(this.Ex,this.Ey,this.srcRole.attackDis+this.srcRole.radius,a.CampFindMode.XOZ,this.campType,t,-1),this.Ex):null!=this.Ex?(this.Ex=this.dstCamp.testSpecAttDst(this.Ex,this.Ey,this.srcRole.attackDis+this.srcRole.radius,a.CampFindMode.XOZ,this.campType,t,-1),this.Ex):(this.D_G--,null)}findNextDst(){return null}}e.default=n},"984e":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.waitDelTimes=0,this.rcuid=0,this.resUid=0,this.width=0,this.height=0,this.depth=0,this.sampler=0,this.texBuf=null,this.c=0}__$attachThis(){++this.c}__$detachThis(){--this.c,this.c<1&&(this.c=0)}bindToGpu(t){t.bindTexture(this.sampler,this.texBuf)}getAttachCount(){return this.c}}class r{constructor(t,e){this.D_B=new Map,this.D_C=new Map,this.Ez=0,this.D_F=0,this.D_G=128,this.A=0,this.J_=null,this.texMid=-1,this.unlocked=!0,this.A=t,this.J_=e}createBuf(){return this.J_.createTexture()}createResByParams3(t,e,i,r){if(!this.D_B.has(t)){let a=new s;return a.rcuid=this.getRCUid(),a.resUid=t,a.width=e,a.height=i,a.sampler=r,a.texBuf=this.createBuf(),a.texBuf.resUid=t,this.addTextureRes(a),!0}return!1}getRCUid(){return this.A}getRC(){return this.J_}hasResUid(t){return this.D_B.has(t)}renderBegin(){this.texMid=-1}getTextureResTotal(){return this.Ez}addTextureRes(t){this.D_B.has(t.resUid)||(t.waitDelTimes=0,this.D_B.set(t.resUid,t),this.Ez++)}getGpuBuffer(t){return this.D_B.has(t)?this.D_B.get(t).texBuf:null}bindToGpu(t){this.D_B.has(t)&&this.D_B.get(t).bindToGpu(this.J_)}getAttachTotal(){return this.D_F}__$attachRes(t){if(this.D_B.has(t)){this.D_F++;let e=this.D_B.get(t);e.getAttachCount()<1&&this.D_C.has(t)&&this.D_C.delete(t),e.waitDelTimes=0,e.__$attachThis()}}__$detachRes(t){if(this.D_B.has(t)&&this.D_B.has(t)){let e=this.D_B.get(t);e.getAttachCount()>0&&(this.D_F--,e.__$detachThis(),e.getAttachCount()<1&&this.D_C.set(t,e))}}update(){if(this.D_G--,this.D_G<1){this.D_G=128;for(const[t,e]of this.D_C)e.waitDelTimes++,e.waitDelTimes>5&&(this.D_B.delete(e.resUid),this.D_C.delete(e.resUid),this.J_.deleteTexture(e.texBuf),e.texBuf=null,this.Ez--)}}}e.default=r},9951:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("8d98"),r=i("5216");class a{constructor(){if(this.B_a=null,this.particleGroupDepthOffset=-4e-4,null!=a.H5)throw Error("AssetsModule is a singleton class.");a.H5=this}static GetInstance(){return null!=a.H5?a.H5:new a}getImageTexByUrl(t,e=!0,i=!0){let r=this.B_a.getTextureByUrl(t);return r.mipmapEnabled=i,e&&r.setWrap(s.TextureConst.WRAP_REPEAT),r}static GetImageTexByUrl(t,e=!0,i=!0){return a.H5.getImageTexByUrl(t,e,i)}initialize(t){null==this.B_a&&(this.B_a=t,a.ID=t,t.getTextureByUrl("static/assets/box_wood01.jpg"),t.getTextureByUrl("static/assets/moss_01.jpg"),t.getTextureByUrl("static/assets/moss_03.jpg"),t.getTextureByUrl("static/assets/rock_a_n.jpg"),t.getTextureByUrl("static/assets/rock_a.jpg"),t.getTextureByUrl("static/assets/testEFT4.jpg"),t.getTextureByUrl("static/assets/stones_02.png"),t.getTextureByUrl("static/assets/image_003.jpg"),t.getTextureByUrl("static/assets/brn_03.jpg"),t.getTextureByUrl("static/assets/flare_core_02.jpg"),t.getTextureByUrl("static/assets/xulie_02_07.png"),t.getTextureByUrl("static/assets/color_05.jpg"),t.getTextureByUrl("static/assets/wood_01.jpg"),t.getTextureByUrl("static/assets/yanj.jpg"),t.getTextureByUrl("static/assets/skin_01.jpg"),t.getTextureByUrl("static/assets/default.jpg"),t.getTextureByUrl("static/assets/warter_01.jpg"),t.getTextureByUrl("static/assets/metal_02.jpg"),t.getTextureByUrl("static/assets/image_003.jpg"),t.getTextureByUrl("static/assets/metal_08.jpg"))}static GetMaterialPipeline(){if(null!=a.ID)return a.ID.pipeline}static UseFog(t){null!=a.ID&&(t.setMaterialPipeline(a.ID.pipeline),t.pipeTypes=[r.MaterialPipeType.FOG_EXP2])}static GetBulTex(t){return a.H5.getImageTexByUrl("static/assets/flare_core_02.jpg")}}a.ID=null,a.H5=null,e.default=a},"9bb7":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("faa5")),a=s(i("0fc4"));class n extends r.default{constructor(){super(),this.n_=""}initialize(t){super.initialize(t),this.n_="DepthShd",this.adaptationShaderVersion=!1}buildThisCode(){let t=this.A_s;t.reset(),t.addVertLayout("vec3","a_vs"),t.addVarying("vec4","v_pos"),t.addFragOutput("vec4","FragColor0"),t.useVertSpaceMats(!0,!0,!0),t.addFragFunction("\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\n\treturn r * PackUpscale;\n}\n")}getFragShaderCode(){return this.buildThisCode(),this.A_s.addFragMainCode("\nvoid main() {\n    // Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\n    float fragCoordZ = 0.5 * v_pos[2] / v_pos[3] + 0.5;\n    FragColor0 = packDepthToRGBA( fragCoordZ );\n}\n"),this.A_s.buildFragCode()}getVertShaderCode(){return this.A_s.addVertMainCode("\nvoid main() {\n    vec4 wpos = u_objMat * vec4(a_vs, 1.0);\n    vec4 viewPos = u_viewMat * wpos;\n    gl_Position =  u_projMat * viewPos;\n    v_pos = gl_Position;\n}\n"),this.A_s.buildVertCode()}getUniqueShaderName(){return this.n_}toString(){return"[DepthShaderBuffer()]"}static GetInstance(){return n.H2}}n.H2=new n;class l extends a.default{constructor(){super()}getCodeBuf(){return n.GetInstance()}createSelfUniformData(){return null}}e.default=l},"9c3c":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("38de")),n=s(i("fecb")),l=s(i("8a0a")),h=s(i("cb29")),o=s(i("e7d2")),m=i("e08e");class _ extends h.default{constructor(t=l.default.VTX_STATIC_DRAW){super(t),this.B_K=null,this.B_N=null,this.E0=0,this.rayTestRadius=2}getVS(){return this.B_K}getCVS(){return this.B_K}initialize(t,e){t.length>=6&&(this.vtCount=Math.floor(t.length/3),this.E0=Math.floor(this.vtCount/2),this.B_K=new Float32Array(t),null==this.bounds&&(this.bounds=new n.default),this.bounds.addXYZFloat32Arr(this.B_K),this.bounds.updateFast(),o.default.Reset(),o.default.AddFloat32Data(this.B_K,3),this.isVBufEnabledAt(l.default.VBUF_CVS_INDEX)&&(this.B_N=new Float32Array(e),o.default.AddFloat32Data(this.B_N,3)),o.default.vbWholeDataEnabled=this.vbWholeDataEnabled,null!=this.B_Q?o.default.UpdateBufData(this.B_Q):this.B_Q=o.default.CreateBySaveData(this.getBufDataUsage()),this.drawMode=m.RenderDrawMode.ARRAYS_LINES,this.buildEnd())}setVSXYZAt(t,e,i,s){null!=this.B_Q&&this.B_Q.setData3fAt(t,0,e,i,s)}toString(){return"DashedLineMesh()"}isPolyhedral(){return!1}testRay(t,e,i,s){let r=0,n=this.B_K,l=0,h=this.rayTestRadius;for(let o=0;o<this.E0;++o){if(_.IE.setXYZ(n[r],n[r+1],n[r+2]),_.IF.setXYZ(n[r+3],n[r+4],n[r+5]),l=a.default.IntersectionLS(t,e,_.IE,_.IF,i,h),l>0)return 1;r+=6}return 0}__$destroy(){this.isResFree()&&(this.bounds=null,this.B_K=null,this.B_N=null,super.__$destroy())}}_.IE=new r.default,_.IF=new r.default,e.default=_},"9c4d":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.prev=null,this.next=null,this.flag=0,this.target=null}reset(){this.flag=0,this.target=null}}class r{constructor(){this.A_0=null,this.A_1=null}destroy(){this.clear()}clear(){this.A_0=this.A_1=null}getBegin(){return this.A_0}isEmpty(){return this.A_0==this.A_1&&null==this.A_1}addNode(t){null==this.A_0?this.A_1=this.A_0=t:null!=this.A_1.prev?(this.A_1.next=t,t.prev=this.A_1,this.A_1=t):(this.A_0.next=t,t.prev=this.A_1,this.A_1=t),this.A_1.next=null}removeNode(t){t==this.A_0?t==this.A_1?this.A_0=this.A_1=null:(this.A_0=t.next,this.A_0.prev=null):t==this.A_1?(this.A_1=t.prev,this.A_1.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}class a{constructor(){this.E1=new r,this.E2=[],this.E3=[new s]}getFreeId(){if(this.E2.length>0)return this.E2.pop();let t=new s;return t.flag=this.E3.length,this.E3.push(t),t.flag}addRunner(t){if(null!=t&&t.getRunFlag()<1){let e=this.getFreeId(),i=this.E3[e];i.flag=e,i.target=t,t.setRunFlag(e),this.E1.addNode(i)}}removeRunner(t){if(null!=t&&t.getRunFlag()>0){let e=t.getRunFlag();this.E2.push(e);let i=this.E3[e];i.flag=e,i.target=null,t.setRunFlag(0),this.E1.removeNode(i)}}run(){let t=this.E1.getBegin(),e=t;while(null!=e)t=e,e=t.next,t.target.isRunning()&&t.target.run()}}e.default=a},"9cf1":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("b3bd")),a=s(i("3930")),n=s(i("0fc4")),l=s(i("41a8"));class h extends l.default{constructor(){super(),this.playOnce=!1,this.direcEnabled=!1,this.spdScaleEnabled=!1}initialize(t){super.initialize(t),this.n_="flow_"+this.n_,this.playOnce&&this.direcEnabled?this.n_+="_OD":this.playOnce?this.n_+="_O":this.direcEnabled&&(this.n_+="_D",this.spdScaleEnabled&&(this.n_+="SpdScale")),this.premultiplyAlpha&&(this.n_+="PreMAlpha")}buildVertShd(){let t=this.A_s;t.addVertLayout("vec4","a_vs"),t.addVertLayout("vec2","a_uvs"),t.addVertLayout("vec4","a_nvs"),t.addVertLayout("vec4","a_vs2"),t.addVertLayout("vec4","a_uvs2"),t.addVertLayout("vec4","a_nvs2");let e=this.B_s?5:4;t.addVertUniform("vec4","u_billParam",e),this.direcEnabled&&t.addDefine("ROTATION_DIRECT"),this.playOnce&&t.addDefine("PLAY_ONCE"),this.spdScaleEnabled&&t.addDefine("SPEED_SCALE"),this.B_s&&t.addDefine("BILL_PARAM_INDEX","4")}toString(){return"[BillboardFlowShaderBuffer()]"}static GetInstance(){return null!=h.H2||(h.H2=new h),h.H2}}h.H2=new h;class o extends n.default{constructor(t=!0,e=!1,i=!1){super(),this.A_u=!0,this.A_v=!1,this.B_s=!1,this.v_=!1,this.C_8=!1,this.C_9=!1,this.C_=!1,this.BD=0,this.p_=null,this.q_=new a.default(1,1,1,1),this.r_=1,this.premultiplyAlpha=!1,this.A_u=t,this.A_v=e,this.B_s=i,this.p_=i?new Float32Array([1,1,0,0,1,1,1,1,0,0,0,0,0,0,0,2,2,4,.5,.5]):new Float32Array([1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,2])}setPlayParam(t,e,i=!1,s=!1){this.C_8=t,this.C_9=e,this.v_=i,this.C_=s}buildBuf(){let t=h.GetInstance();t.playOnce=this.C_8,t.direcEnabled=this.C_9,t.clipMixEnabled=this.v_,t.spdScaleEnabled=this.C_,t.premultiplyAlpha=this.premultiplyAlpha,t.brightnessEnabled=this.A_u,t.setParam(this.A_u,this.A_v,this.B_s,this.getTextureTotal()>1)}getCodeBuf(){return h.GetInstance()}createSelfUniformData(){let t=new r.default;return t.uniformNameList=["u_billParam"],t.dataList=[this.p_],t}setRGBA4f(t,e,i,s){this.q_.r=t,this.q_.g=e,this.q_.b=i,this.q_.a=s,this.p_[4]=t*this.r_,this.p_[5]=e*this.r_,this.p_[6]=i*this.r_}setRGB3f(t,e,i){this.q_.r=t,this.q_.g=e,this.q_.b=i,this.p_[4]=t*this.r_,this.p_[5]=e*this.r_,this.p_[6]=i*this.r_}setAlpha(t){this.p_[7]=t}getAlpha(){return this.p_[6]}setBrightness(t){this.r_=t,this.p_[4]=this.q_.r*t,this.p_[5]=this.q_.g*t,this.p_[6]=this.q_.b*t}getBrightness(){return this.r_}setRGBAOffset4f(t,e,i,s){this.p_[8]=t,this.p_[9]=e,this.p_[10]=i,this.p_[11]=s}setRGBOffset3f(t,e,i){this.p_[8]=t,this.p_[9]=e,this.p_[10]=i}setAcceleration(t,e,i){this.p_[12]=t,this.p_[13]=e,this.p_[14]=i}setSpdScaleMax(t,e=1){t<1&&(t=1),t>10&&(t=10),e<.1&&(e=.1),e>5&&(e=5),this.p_[15]=t,this.p_[7]=e}setClipUVParam(t,e,i,s){this.B_s&&(this.p_[16]=t,this.p_[17]=e,this.p_[18]=i,this.p_[19]=s)}getTime(){return this.BD}setTime(t){this.BD=t,this.p_[2]=t}updateTime(t){this.BD+=t,this.p_[2]=this.BD}getScaleX(){return this.p_[0]}getScaleY(){return this.p_[1]}setScaleX(t){this.p_[0]=t}setScaleY(t){this.p_[1]=t}setScaleXY(t,e){this.p_[0]=t,this.p_[1]=e}setDepthOffset(t){this.p_[3]=t}getUniformData(){return this.p_}destroy(){super.destroy(),this.p_=null}}e.default=o},"9d30":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("91e2")),a=s(i("58c1")),n=s(i("edf2")),l=i("a52f"),h=s(i("4abf")),o=i("59df");class m{constructor(){this.A8=null,this.AP=null,this.E4=new a.default,this.E5=new n.default,this.materialBuilder=new o.RoleMaterialBuilder,this.envAmbientLightEnabled=!1,this.fogEnabled=!1}initialize(t,e){null==this.A8&&(this.A8=t,this.B_a=e,this.materialBuilder.envAmbientLightEnabled=this.envAmbientLightEnabled,this.materialBuilder.fogEnabled=this.fogEnabled,this.materialBuilder.initialize(e),this.initTexture(e),this.E4.setMaterialBuilder(this.materialBuilder),this.E5.setMaterialBuilder(this.materialBuilder),this.E4.initialize(this.A8,0,this.campModule.redCamp,this.terrain.getTerrainData()),this.E5.initialize(this.A8,0,this.campModule.redCamp,this.terrain.getTerrainData(),70))}initTexture(t){null==this.AP&&(this.AP=[t.getTextureByUrl("static/assets/wood_01.jpg"),t.getTextureByUrl("static/assets/yanj.jpg"),t.getTextureByUrl("static/assets/skin_01.jpg"),t.getTextureByUrl("static/assets/default.jpg"),t.getTextureByUrl("static/assets/warter_01.jpg"),t.getTextureByUrl("static/assets/metal_02.jpg"),t.getTextureByUrl("static/assets/image_003.jpg"),t.getTextureByUrl("static/assets/metal_08.jpg")])}createLimbRoles(t=20){let e,i,s=this.AP[0],r=this.AP[1],a=this.AP[2],n=40;for(let h=0;h<t;++h){switch(n=Math.round(60*Math.random())+30,h%3){case 1:i=l.CampType.Red;break;case 2:i=l.CampType.Green;break;default:i=l.CampType.Blue;break}e=this.E4.create(s,r,a,i,n),e.lifeTime=100+Math.round(300*Math.random()),e.setXYZ(1600*Math.random()-800,0,1600*Math.random()-800),e.moveToXZ(1600*Math.random()-800,1600*Math.random()-800),this.campModule.redCamp.addRole(e)}}createTrackWheelRoles(t=20){let e,i=40,s=this.AP[2],r=this.AP[6],a=this.AP[7];for(let n=0;n<t;++n){switch(n%3){case 1:e=l.CampType.Red;break;case 2:e=l.CampType.Green;break;default:e=l.CampType.Blue;break}let t=this.E5.create(r,a,s,e,i);t.lifeTime=100+Math.round(300*Math.random()),t.setXYZ(1600*Math.random()-800,0,1600*Math.random()-800),t.moveToXZ(1600*Math.random()-800,1600*Math.random()-800),t.wake(),this.campModule.redCamp.addRole(t)}}createSillyRoles(t=20){let e=this.AP[3],i=this.AP[4],s=this.AP[5],a=null;null==this.E6&&(a=this.materialBuilder.createMaterial(e),this.E6=new r.default,this.E6.setMaterial(a),this.E6.initializeSizeXYZ(50,40,50,[e]),this.E6.setXYZ(0,20,0),this.E7=new r.default,this.E7.setMaterial(a),this.E7.initializeSizeXYZ(30,20,30,[s]),this.E7.setXYZ(0,50,0));let n=null,o=this.E6,m=this.E7;for(let _=0;_<t;++_){let t=new h.default;if(null!=n)t.initializeFrom(n);else{let e=new r.default,a=this.materialBuilder.createMaterial(s);a.setRGB3f(Math.random()+.2,Math.random()+.2,Math.random()+.2),e.setMaterial(a),e.copyMeshFrom(o),e.initializeSizeXYZ(50,40,50,[s]),e.setXYZ(0,20,0);let n=new r.default;a=this.materialBuilder.createMaterial(i),a.setRGB3f(Math.random()+.4,Math.random()+.4,Math.random()+.4),n.setMaterial(a),n.copyMeshFrom(m),n.initializeSizeXYZ(30,20,30,[i]),n.setXYZ(0,50,0),t.initialize(this.A8,0,e,n)}t.setXYZ(1600*Math.random()-800,0,1600*Math.random()-800),t.moveToXZ(1600*Math.random()-800,1600*Math.random()-800),t.campType=l.CampType.Free,t.terrainData=this.terrain.getTerrainData(),t.attackDis=50,t.radius=80,t.lifeTime=200+Math.round(200*Math.random()),t.wake(),this.campModule.redCamp.addRole(t)}}}e.RoleBuilder=m},"9f3e":function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("8d98"),a=s(i("df25"));class n extends a.default{constructor(t,e,i=!1){super(t,e,i),this.n=r.TextureProxyType.Uint16,this.minFilter=r.TextureConst.LINEAR,this.dataType=r.TextureDataType.UNSIGNED_SHORT}toHalfFloatOes(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4,this.dataType=r.TextureDataType.HALF_FLOAT_OES}toUShort565(){this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB,this.unpackAlignment=3,this.dataType=r.TextureDataType.UNSIGNED_SHORT_5_6_5}toUShort4444(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4,this.dataType=r.TextureDataType.UNSIGNED_SHORT_4_4_4_4}toUShort5551(){this.unpackAlignment=4,this.dataType=r.TextureDataType.UNSIGNED_SHORT_5_5_5_1}toUShort(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.dataType=r.TextureDataType.UNSIGNED_SHORT}toAlphaFormat(){this.dataType==r.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=r.TextureFormat.ALPHA,this.internalFormat=r.TextureFormat.ALPHA,this.unpackAlignment=1)}toRedFormat(){this.dataType==r.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=r.TextureFormat.RED,this.internalFormat=r.TextureFormat.RED,this.unpackAlignment=1)}toRGBFormat(){this.dataType==r.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB,this.unpackAlignment=3)}toRGBAFormat(){this.dataType==r.TextureDataType.UNSIGNED_SHORT&&(this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4)}uploadFromBytes(t,e=0,i=-1,s=-1,r=0,a=0,n=!1){super.setDataFromBytes(t,e,i,s,r,a,n)}setPartDataFromeBytes(t,e,i,s,r,a=0){super.setPartDataFromeBytes(t,e,i,s,r,a)}getPixels(t,e,i,s,r){super.getPixels(t,e,i,s,r)}toString(){return"[Uint16TextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},a221:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},a254:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("faa5")),a=s(i("b3bd")),n=s(i("0fc4"));class l extends r.default{constructor(){super(),this.n_="",this.E8=!1,this.mapLodEnabled=!1}initialize(t){this.n_="ScreenPlaneShd",this.E8=t,t&&(this.n_+="_tex",this.mapLodEnabled&&(this.n_+="Lod"))}buildShader(){let t=this.A_s;t.mapLodEnabled=!1,this.E8&&(t.mapLodEnabled=this.mapLodEnabled,this.A_t.addDiffuseMap()),t.addFragUniform("vec4","u_param",3),t.useVertSpaceMats(!0,!1,!1),this.A_s.addFragMainCode("\nvoid main() {\n#ifdef VOX_USE_2D_MAP\n    #ifdef VOX_Texture2DLod\n    vec4 color4 = VOX_Texture2DLod(VOX_DIFFUSE_MAP, v_uv, u_param[2].w);\n    #else\n    vec4 color4 = VOX_Texture2D(VOX_DIFFUSE_MAP, v_uv);\n    #endif\n    color4 *= u_param[0];\n    color4 += u_param[1];\n    FragColor0 = color4;\n#else\n    FragColor0 = u_param[0] + u_param[1];\n#endif\n}\n"),this.A_s.addVertMainCode("\nvoid main() {\n    gl_Position = u_objMat * vec4(a_vs,1.0);\n#ifdef VOX_USE_2D_MAP\n    v_uv = a_uvs.xy;\n#endif\n}\n")}getUniqueShaderName(){return this.n_}toString(){return"[ScreenPlaneShaderBuffer()]"}static GetInstance(){return null!=l.H2||(l.H2=new l),l.H2}}l.H2=null;class h extends n.default{constructor(){super(),this.mapLodEnabled=!1,this.E9=new Float32Array([1,1,1,1,0,0,0,0,0,0,0,0])}buildBuf(){let t=l.GetInstance();t.mapLodEnabled=this.mapLodEnabled}getCodeBuf(){return l.GetInstance()}setRGB3f(t,e,i){this.E9[0]=t,this.E9[1]=e,this.E9[2]=i}setRGBA4f(t,e,i,s){this.E9[0]=t,this.E9[1]=e,this.E9[2]=i,this.E9[3]=s}setOffsetRGB3f(t,e,i){this.E9[0]=t,this.E9[1]=e,this.E9[2]=i}setOffsetRGBA4f(t,e,i,s){this.E9[0]=t,this.E9[1]=e,this.E9[2]=i,this.E9[3]=s}setTextureLodLevel(t){this.E9[11]=t}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_param"],t.dataList=[this.E9],t}}e.default=h},a446:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("11e6")),a=i("cc48"),n=s(i("265e")),l=s(i("af68")),h=s(i("a80a"));class o{constructor(){this.T=-1,this.w_=null,this.A_=null,this.E_A=null,this.E_B=new n.default,this.B_R=null,this.E_C=new l.default,this.E_D=new h.default,this.E_E=new h.default,this.E_F=null,this.D_L=null,this.E_G=0,this.T=o.H0++,this.E_C.initialize(1)}getUid(){return this.T}initialize(t,e=null){null==this.w_&&(this.w_=t,this.E_A=t.getStage3D(),this.A_=e,this.B_R=t.getRPONodeBuilder())}getStage3D(){return this.E_A}setCamera(t){this.A_=t}getCamera(){return this.A_}getMouseXYWorldRay(t,e){this.A_.getWorldPickingRayByScreenXY(this.E_A.mouseX,this.E_A.mouseY,t,e)}setSpaceCullingor(t){this.E_F=t}setRaySelector(t){this.D_L=t,this.D_L.setRenderer(this.w_)}getRaySelector(){return this.D_L}addEntity(t){if(null!=t.getGlobalBounds()&&t.spaceCullMask>a.SpaceCullingMask.NONE&&r.default.TestSpaceEnabled(t.__$rseFlag)){t.update(),++this.E_G;let e=this.E_C.addEntity(t);e.bounds=t.getGlobalBounds(),e.pcoEnabled=(t.spaceCullMask&a.SpaceCullingMask.POV)==a.SpaceCullingMask.POV;let i=t.isInRendererProcess()||null==t.getMaterial();i&&(t.spaceCullMask&a.SpaceCullingMask.POV)==a.SpaceCullingMask.POV?(e.rstatus=1,null==t.getMaterial()&&(e.rpoNode=this.E_B),null==e.rpoNode&&(e.rpoNode=this.B_R.getNodeByUid(t.getDisplay().__$rpuid)),this.E_E.addNode(e)):null==t.getMaterial()?(e.rstatus=1,e.rpoNode=this.E_B,this.E_E.addNode(e)):(e.rstatus=0,this.E_D.addNode(e))}}removeEntity(t){if(null!=t&&r.default.TestSpaceContains(t.__$rseFlag)){let e=this.E_C.getNodeByEntity(t);null!=e&&(e.rstatus>0?this.E_E.removeNode(e):this.E_D.removeNode(e),this.E_C.removeEntity(t),--this.E_G)}}updateEntity(t){}update(){}runBegin(){}run(){let t=this.E_D.getBegin();if(null!=t){let e=null;while(null!=t)t.entity.isInRendererProcess()?(e=t,e.rstatus=1,t=t.next,this.E_D.removeNode(e),this.E_E.addNode(e),null==e.rpoNode&&(e.rpoNode=this.B_R.getNodeByUid(e.entity.getDisplay().__$rpuid))):t=t.next}if(t=this.E_E.getBegin(),null!=t)if(null!=this.E_F)this.E_F.setCamera(this.A_),this.E_F.setCullingNodeHead(t),this.E_F.run();else{let e=null,i=this.A_;while(null!=t)t.rpoNode.isVsible()&&t.entity.isDrawEnabled()?(e=t.bounds,t.drawEnabled=i.visiTestSphere2(e.center,e.radius),t.entity.drawEnabled=t.drawEnabled,t.rpoNode.drawEnabled=t.drawEnabled):(t.drawEnabled=!1,t.entity.drawEnabled=!1,t.rpoNode.drawEnabled=!1),t=t.next}}rayTest(t,e){null!=this.D_L&&(this.D_L.setCamera(this.A_),this.D_L.setCullingNodeHead(this.E_E.getBegin()),this.D_L.setRay(t,e),this.D_L.run())}runEnd(){}getCullingNodeHead(){return this.E_E.getBegin()}toString(){return"[RendererSpace(uid = "+this.T+")]"}}o.H0=0,e.default=o},a46e:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("1710")),n=s(i("3b73"));class l{constructor(){this.A_=null,this.E_H=!1,this.E_I=0,this.E_J=2,this.E_K=1,this.E_L=6,this.E_M=new r.default,this.E_N=new r.default,this.E_O=new r.default,this.E_P=new r.default,this.E_Q=new r.default,this.E_R=new r.default,this.E_S=new r.default,this.E_T=0,this.E_U=!0,this.E_V=!0,this.E_W=0,this.E_X=0,this.E_Y=!0,this.E_Z=2,this.E_Y=!(n.default.IsMobileWeb()||n.default.IsSafariWeb())}setMobileZoomSpeed(t){this.E_J=t}seSlideSpeed(t){this.E_K=t}setMouseWheelZoomSpd(t){this.E_L=t}bindCamera(t){this.A_=t}initialize(t){this.E_U&&(this.E_U=!1,t.addEventListener(a.default.MOUSE_WHEEL,this,this.mouseWheelListener,!0,!0),t.addEventListener(a.default.MOUSE_MULTI_MOVE,this,this.mouseMultiMoveListener,!0,!0),t.addEventListener(a.default.MOUSE_MULTI_UP,this,this.mouseMultiUpListener,!0,!0))}setLookAtCtrlEnabled(t){this.E_V=t}mouseWheelListener(t){t.wheelDeltaY>0?this.E_T+=this.E_L:this.E_T-=this.E_L}mouseMultiMoveListener(t){this.setTouchPosArray(t.posArray)}mouseMultiUpListener(t){this.setTouchPosArray(t.posArray)}resetState(){this.E_W=0,this.E_X=0,this.E_Z=0}setTouchPosArray(t){if(null!=t&&t.length>1){let e=0;if(this.E_Q.setXYZ(t[0].x,t[0].y,0),this.E_R.setXYZ(t[1].x,t[1].y,0),this.E_H){e=r.default.Distance(this.E_Q,this.E_R),this.E_Z<1?(this.E_M.copyFrom(this.E_Q),this.E_N.copyFrom(this.E_R),this.E_M.subVecsTo(this.E_Q,this.E_O),this.E_N.subVecsTo(this.E_R,this.E_P),this.E_M.normalize(),this.E_N.normalize(),this.E_M.dot(this.E_N)>.9?this.E_W++:this.E_X++,(this.E_W>3||this.E_X>3)&&(this.E_Z=this.E_W>this.E_X?1:2)):this.E_M.subVecsTo(this.E_Q,this.E_O);let t=Math.abs(this.E_I-e);t>.1&&(this.E_T=(e-this.E_I)*this.E_J,this.E_I=e)}else this.E_H=!0,this.E_I=r.default.Distance(this.E_Q,this.E_R),this.resetState()}else this.resetState(),this.E_H=!1;this.E_O.copyFrom(this.E_Q),this.E_P.copyFrom(this.E_R)}run(t,e){let i=this.E_V;if(null==t&&(t=this.E_S),null!=this.A_)if(2==this.E_Z){if(Math.abs(this.E_T)>.001){let s=r.default.Distance(this.A_.getPosition(),this.A_.getLookAtPosition()),a=this.E_T;this.E_T>0&&(s>e?(a=s-e,a>this.E_T&&(a=this.E_T)):a=0),Math.abs(a)>.1&&(this.A_.forward(a),i&&this.A_.setLookPosXYZFixUp(t.x,t.y,t.z)),this.E_Y?this.E_T*=.95:this.E_T=0}}else 1==this.E_Z&&this.A_.slideViewOffsetXY(-this.E_M.x*this.E_K,this.E_M.y*this.E_K)}}e.default=l},a52f:function(t,e,i){"use strict";var s,r,a;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["Free"]=1]="Free",t[t["Busy"]=2]="Busy"}(s||(s={})),e.CampRoleStatus=s,function(t){t[t["Free"]=1]="Free",t[t["Red"]=2]="Red",t[t["Blue"]=3]="Blue",t[t["Green"]=4]="Green"}(r||(r={})),e.CampType=r,function(t){t[t["Default"]=0]="Default",t[t["XOZ"]=1]="XOZ"}(a||(a={})),e.CampFindMode=a},a7cf:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("6883"));class n{constructor(){this.v_=!1,this.smokeEntity=null,this.uvGridCN=4,this.uvGridsTotal=16,this.materialPipeline=null,this.pipeTypes=null}initialize(t,e,i,s=!1){null==this.smokeEntity&&t>0&&(this.v_=s,this.initSmoke(null,t,e,i))}initializeFrom(t,e,i,s=!1){null!=t&&null==this.smokeEntity&&(this.v_=s,this.initSmoke(t.smokeEntity,50,e,i))}initSmoke(t,e,i,s){let n=new a.default;if(n.setMaterialPipeline(this.materialPipeline),n.pipeTypes=this.pipeTypes,null!=t)n.copyMeshFrom(t),n.createGroup(e);else{let t=100;n.createGroup(e);let i=new r.default,s=[0,0,1,1];for(let r=0;r<e;++r)t=Math.random()*Math.random()*Math.random()*180+10,n.setSizeAndScaleAt(r,t,t,2,1),n.setUVRectAt(r,s[0],s[1],s[2],s[3]),n.setTimeAt(r,50*Math.random()+80,.01,.95,0),n.setBrightnessAt(r,1),n.setTimeSpeedAt(r,1*Math.random()+.5),i.setTo(100*Math.random()-50,50*Math.random()+50,100*Math.random()-50),i.scaleBy(.2),n.setPositionAt(r,i.x,i.y,i.z),n.setAccelerationAt(r,.006*Math.random()-.003,-.004,.006*Math.random()-.003),n.setVelocityAt(r,0,1.5*Math.random()+.5,0),i.normalize(),i.scaleBy(1*(2*Math.random()+.2))}n.toBrightnessBlend(!1),n.setPlayParam(!0,!1,this.v_),n.initialize(!0,!1,!0,[i,s]),n.setRGBOffset3f(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1),n.setRGB3f(.1,.1,.1);let l=1/this.uvGridCN,h=1/Math.floor(this.uvGridsTotal/this.uvGridCN);n.setClipUVParam(this.uvGridCN,this.uvGridsTotal,l,h),this.smokeEntity=n}setDepthOffset(t){null!=this.smokeEntity&&this.smokeEntity.setDepthOffset(t)}setTime(t){null!=this.smokeEntity&&this.smokeEntity.setTime(t)}updateTime(t){null!=this.smokeEntity&&this.smokeEntity.updateTime(t)}setRotationXYZ(t,e,i){null!=this.smokeEntity&&this.smokeEntity.setRotationXYZ(t,e,i)}setXYZ(t,e,i){null!=this.smokeEntity&&this.smokeEntity.setXYZ(t,e,i)}setPositionScale(t){null!=this.smokeEntity&&this.smokeEntity.setScaleXYZ(t,t,t)}setSizeScale(t){null!=this.smokeEntity&&this.smokeEntity.setScaleXY(t,t)}setPosition(t){null!=this.smokeEntity&&this.smokeEntity.setPosition(t)}setVisible(t){null!=this.smokeEntity&&this.smokeEntity.setVisible(t)}update(){null!=this.smokeEntity&&this.smokeEntity.update()}isAwake(){return null!=this.smokeEntity&&this.smokeEntity.isAwake()}destory(){this.materialPipeline=null,this.pipeTypes=null}}e.default=n},a7ed:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73")),a=s(i("7279"));class n{create(t,e){let i=null,s=r.default.FrustumParam;return e.hasUniformByName(s.name)&&(i=new a.default,i.uns=s.name,i.uniformNameList=[s.name],i.copyDataFromProbe(t.getCamera().ufrustumProbe)),i}getIDNS(){return"FrustumUniformBuilder"}}e.default=n},a80a:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.A_0=null,this.A_1=null}destroy(){this.clear()}clear(){this.A_0=this.A_1=null}getBegin(){return this.A_0}isEmpty(){return this.A_0==this.A_1&&null==this.A_1}addNode(t){null==this.A_0?this.A_1=this.A_0=t:null!=this.A_1.prev?(this.A_1.next=t,t.prev=this.A_1,this.A_1=t):(this.A_0.next=t,t.prev=this.A_1,this.A_1=t),this.A_1.next=null}removeNode(t){t==this.A_0?t==this.A_1?this.A_0=this.A_1=null:(this.A_0=t.next,this.A_0.prev=null):t==this.A_1?(this.A_1=t.prev,this.A_1.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}e.default=s},a996:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.uuid="",this.phase=0,this.type=s.RESIZE,this.target=null,this.currentTarget=null,this.data=null,this.__$preventBoo=!1}getClassType(){return s.EventClassType}preventDefault(){this.__$preventBoo=!0}reset(){this.__$preventBoo=!1}toString(){return"[EventBase]"}}s.EventClassType=1001,s.RESIZE=3001,s.ENTER_FRAME=3002,e.default=s},a9bf:function(t,e,i){"use strict";i.r(e),i.d(e,"EnvShaderCode",(function(){return l}));var s="#ifdef VOX_USE_FOG\r\n    #ifdef VOX_FOG_COLOR_MAP\r\n        vec3 fogEnvColor = vec3(1.0);\r\n        vec4 getFogColorFromTexture2D(sampler2D tex) {\r\n            vec4 color = VOX_Texture2D(tex, (u_envLightParams[3].xy + worldPosition.xz) / u_envLightParams[3].zw);\r\n            fogEnvColor = color.xyz;\r\n            return color;\r\n        }\r\n    #endif\r\n    void useFog(inout vec4 color) {\r\n        vec3 fogColor = u_envLightParams[2].xyz;\r\n        #ifdef VOX_FOG_COLOR_MAP\r\n            fogColor *= fogEnvColor;\r\n        #endif\r\n        #ifdef VOX_FOG_EXP2\r\n            float fogDensity = u_envLightParams[2].w;\r\n            float fogFactor = 1.0 - exp( - fogDensity * fogDensity * v_fogDepth * v_fogDepth );\r\n        #else\r\n            float fogNear = u_envLightParams[1].z;\r\n            float fogFar = u_envLightParams[1].w;\r\n            float fogFactor = smoothstep( fogNear, fogFar, v_fogDepth );\r\n        #endif\r\n        #ifdef VOX_USE_BRIGHTNESS_OVERLAY_COLOR\r\n            color.xyz = mix( color.rgb, fogColor, fogFactor ) * length(color.rgb) * (1.0 - fogFactor);\r\n        #else\r\n            color.xyz = mix( color.rgb, fogColor, fogFactor );\r\n            #ifdef VOX_PREMULTIPLY_ALPHA\r\n                color.xyz *= color.w;\r\n            #endif\r\n        #endif\r\n    }\r\n#endif",r="void calcFogDepth(in vec4 viewPos) {\r\n    v_fogDepth = -viewPosition.z;\r\n}",a="#ifdef VOX_FOG_COLOR_MAP\r\n    getFogColorFromTexture2D( VOX_FOG_COLOR_MAP );\r\n#endif\r\n\r\n#ifdef VOX_USE_FOG\r\n    useFog( FragColor0 );\r\n#endif ",n="#ifdef VOX_USE_FOG\r\n\r\ncalcFogDepth(viewPosition);\r\n\r\n#endif";const l={vert:"",vert_head:r,vert_body:n,frag:"",frag_head:s,frag_body:a}},a9f4:function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["Default"]=1]="Default",t[t["VSM"]=1]="VSM"}(s||(s={})),e.ShadowMode=s},ab2e:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("4df3");e.IShaderLibConfigure=s.IShaderLibConfigure,e.ShaderCodeType=s.ShaderCodeType,e.ShaderCodeUUID=s.ShaderCodeUUID,e.ShaderCodeConfigure=s.ShaderCodeConfigure,e.IShaderLibListener=s.IShaderLibListener,e.MaterialContextParam=s.MaterialContextParam;const r=i("d63d"),a=i("2b5f");class n extends s.CommonMaterialContext{constructor(){super()}initialize(t,e=null,i=null){null==e&&(e=new s.MaterialContextParam),e.shaderCodeBinary=!1,e.loadAllShaderCode=!1,super.initialize(t,e,i)}buildConfigure(t,e){return null}initEnd(t){super.initEnd(t),this.addShaderCodeObject(s.ShaderCodeUUID.PBR,a.PBRShaderCode),this.addShaderCodeObject(s.ShaderCodeUUID.Lambert,r.LambertLightShaderCode)}}e.DebugMaterialContext=n},ab73:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.type="vec4",this.data=null,this.name="u_vsmParams",this.arrayLength=3}}class r{constructor(){this.type="vec4",this.data=new Float32Array([.1,.1,.1,1,1,.1,600,3500,.3,0,.9,5e-4,0,0,800,800,-500,-500,1e3,1e3]),this.name="u_envLightParams",this.arrayLength=5}}class a{constructor(){this.type="mat4",this.data=null,this.name="u_shadowMat",this.arrayLength=0}}class n{constructor(){this.type="vec4",this.data=null,this.name="u_stageParam",this.arrayLength=0}}class l{constructor(){this.type="vec4",this.data=null,this.name="u_viewParam",this.arrayLength=0}}class h{constructor(){this.type="vec4",this.data=null,this.name="u_frustumParam",this.arrayLength=0}}class o{constructor(){this.type="vec4",this.data=null,this.name="u_cameraPosition",this.arrayLength=0}}class m{constructor(){this.type="vec4",this.positionName="u_lightPositions",this.colorName="u_lightColors"}}class _{}_.LocalTransformMatUNS="u_objMat",_.CameraViewMatUNS="u_viewMat",_.CameraProjectiveMatUNS="u_projMat",_.FrustumParam=new h,_.CameraPosParam=new o,_.StageParam=new n,_.ViewportParam=new l,_.ShadowMatrix=new a,_.ShadowVSMParams=new s,_.GlobalLight=new m,_.EnvLightParams=new r,e.default=_},abdb:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.AXIS_ANGLE=0,s.QUATERNION=1,s.EULER_ANGLES=2,e.default=s},acaa:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("8d98"),a=s(i("cfaf"));class n extends a.default{constructor(t,e,i=!1){super(t,e,i),this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.srcFormat=r.TextureFormat.DEPTH_COMPONENT,this.internalFormat=r.TextureFormat.DEPTH_COMPONENT,this.dataType=r.TextureDataType.UNSIGNED_SHORT,this.o=!1,this.m=!0,this.mipmapEnabled=!1,this.n=r.TextureProxyType.Depth}toDepthUnsignedInt(){this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.srcFormat=r.TextureFormat.DEPTH_COMPONENT,this.internalFormat=r.TextureFormat.DEPTH_COMPONENT,this.dataType=r.TextureDataType.UNSIGNED_INT,this.o=!1,this.m=!0,this.mipmapEnabled=!1}toDepthUnsignedShort(){this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.srcFormat=r.TextureFormat.DEPTH_COMPONENT,this.internalFormat=r.TextureFormat.DEPTH_COMPONENT,this.dataType=r.TextureDataType.UNSIGNED_SHORT,this.o=!1,this.m=!0,this.mipmapEnabled=!1}toDepthAndStencil(){this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.srcFormat=r.TextureFormat.DEPTH_STENCIL,this.internalFormat=r.TextureFormat.DEPTH_STENCIL,this.dataType=r.TextureDataType.UNSIGNED_INT_24_8_WEBGL,this.o=!1,this.mipmapEnabled=!1,this.m=!0}uploadData(t){let e=t.getRC();e.texImage2D(this.l,0,r.TextureFormat.ToGL(e,this.internalFormat),this.g,this.h,0,r.TextureFormat.ToGL(e,this.srcFormat),r.TextureDataType.ToGL(e,this.dataType),null)}toString(){return"[DepthTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},acfe:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ca6c")),a=s(i("8a0a")),n=s(i("3b73")),l=s(i("81ce")),h=s(i("fc07"));class o{constructor(){this.T=-1,this.adaptationShaderVersion=!0,this.preCompileInfo=null,this.E_a="",this.E_b="",this.A_B="",this.A_C=0,this.E_c=null,this.E_d=!1,this.E_e=null,this.A_K=null,this.A_E=null,this.A_L=new Map,this.E_f=!1,this.E_g=0,this.EX=0,this.E_h=1,this.E_i=null,this.dataUniformEnabled=!1,this.T=o.H0++}getVSCodeStr(){return this.E_a}getFSCodeStr(){return this.E_b}getLayoutBit(){return this.E_g}getMid(){return this.EX}getFragOutputTotal(){return this.E_h}parseCode(t,e){o.IG.reset(),o.IG.parseVShaderCode(t),o.IG.parseFShaderCode(e),this.E_h=o.IG.fragOutputTotal,this.E_c=o.IG.uniforms}initialize(t,e,i){this.A_B=t,this.adaptationShaderVersion&&null==this.preCompileInfo&&n.default.IsWebGL1()&&(e=l.default.Es3VtxShaderToES2(e),i=l.default.Es3FragShaderToES2(i)),this.preCompileInfo,this.parseCode(e,i);let s=o.IG.attributes,h=0,m=s.length,_=null;this.E_e=[],this.A_K=[],this.E_g=0;let u=31;while(h<m){if(_=s[h],null!=_)switch(this.E_e.push(_.name),this.A_K.push(_.typeSize),a.default.GetVBufTypeByNS(_.name)){case a.default.VBUF_VS:u+=131*u+1,this.E_g|=r.default.BIT_ONE_0;break;case a.default.VBUF_UVS:u+=131*u+2,this.E_g|=r.default.BIT_ONE_1;break;case a.default.VBUF_NVS:u+=131*u+3,this.E_g|=r.default.BIT_ONE_2;break;case a.default.VBUF_CVS:u+=131*u+4,this.E_g|=r.default.BIT_ONE_3;break;case a.default.VBUF_TVS:u+=131*u+5,this.E_g|=r.default.BIT_ONE_4;break;case a.default.VBUF_VS2:u+=131*u+6,this.E_g|=r.default.BIT_ONE_5;break;case a.default.VBUF_UVS2:u+=131*u+7,this.E_g|=r.default.BIT_ONE_6;break;case a.default.VBUF_NVS2:u+=131*u+8,this.E_g|=r.default.BIT_ONE_7;break;case a.default.VBUF_CVS2:u+=131*u+9,this.E_g|=r.default.BIT_ONE_8;break;case a.default.VBUF_TVS2:u+=131*u+11,this.E_g|=r.default.BIT_ONE_9;break;default:break}++h}this.EX=u,this.A_C=o.IG.texTotal,this.E_d=this.A_C>0,this.E_d&&(this.E_i=o.IG.texUniformNameListStr.split(",")),this.E_f=this.A_C<this.E_c.length,this.E_a=e,this.E_b=i,this.A_B=t}getAttriSizeList(){return this.A_K}getTexUniformNames(){return this.E_i}getUniforms(){return this.E_c}haveCommonUniform(){return this.E_f}getAttriNSList(){return this.E_e}getUid(){return this.T}getTexTotal(){return this.A_C}haveTexture(){return this.E_d}getLocationsTotal(){return this.A_E.length}getUniformTypeNameByNS(t){let e=this.A_L.get(t);return null!=e?e.typeName:""}getUniformTypeByNS(t){let e=this.A_L.get(t);return null!=e?e.type:0}hasUniformByName(t){return this.A_L.has(t)}getUniformLengthByNS(t){return this.A_L.has(t)&&this.A_L.get(t).arrLength,0}getUniqueShaderName(){return this.A_B}destroy(){this.A_C=0}}o.H0=0,o.IG=new h.default,e.default=o},ad24:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("8e17")),n=s(i("e16a"));class l{constructor(){this.E_j=new a.default,this.E_k=new a.default(.1,0,0),this.BF=new a.default,this.E_l=new n.default,this.C_T=null,this.E_m=!0,this.E_n=0,this.E_o=0,this.syncTargetUpdate=!0,this.syncDirecUpdate=!0,this.E_p=!0}setSpeed(t){this.E_l.setSpeed(t)}getSpeed(){return this.E_l.getSpeed()}setVelocityFactor(t,e){this.E_l.setFactor(t,e)}setTarget(t){this.C_T=t}setCurrentXYZ(t,e,i){this.E_j.setXYZ(t,e,i),this.calcSquaredDis()}setCurrentPosition(t){this.E_j.copyFrom(t),this.calcSquaredDis()}toXZ(t,e){this.E_k.x=t,this.E_k.z=e,this.E_l.setDirecXZ(t-this.E_j.x,e-this.E_j.z),this.E_m=!0,this.calcSquaredDis()}setDstPosition(t){this.E_k.copyFrom(t),this.E_l.setDirecXZ(t.x-this.E_j.x,t.z-this.E_j.z),this.E_m=!0,this.calcSquaredDis()}stop(){this.E_m=!1}isMoving(){return this.E_m}getVelocity(){return this.E_l.spdv}calcVelocity(){this.E_l.updateDirecXZ(this.E_k.x-this.E_j.x,this.E_k.z-this.E_j.z),this.E_l.run(),this.E_p=!1}run(){this.E_m&&null!=this.C_T&&this.updatePos()}getDirecDegree(){return this.E_n}getSquredDis(){return this.E_o}calcSquaredDis(){this.BF.subVecsTo(this.E_j,this.E_k),this.BF.y=0,this.E_o=this.BF.getLengthSquared()}updatePos(){this.E_p&&this.calcVelocity(),this.E_p=!0;let t=this.E_l.spdv,e=(this.E_n,r.default.GetDegreeByXY(-t.x,t.z));this.E_n=e+180,t.getLengthSquared()<this.E_o?(this.BF.addVecsTo(this.E_j,t),this.BF.subtractBy(this.E_k),this.E_j.addVecsTo(this.E_j,t),this.calcSquaredDis()):(this.E_o=0,this.E_j.copyFrom(this.E_k),this.E_m=!1,this.E_l.stop()),this.C_T.setPosition(this.E_j),this.syncDirecUpdate&&this.C_T.setRotationXYZ(0,this.E_n,0),this.syncTargetUpdate&&this.C_T.update()}}e.default=l},ae33:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("11e6")),n=s(i("8e17")),l=s(i("fecb")),h=s(i("2139"));class o{constructor(t=!0){this.T=0,this.B_d=null,this.E_q=0,this.E_r=!1,this.b_=!1,this.E_s=!1,this.E_t=!1,this.BF=new n.default,this.B_e=!0,this.E_u=!0,this.B_k=null,this.E_v=-1,this.E_w=null,this.E_x=null,this.G8$updateBounds=!0,this.__$wuid=-1,this.wprocuid=-1,this.__$weid=-1,this.__$contId=0,this.__$parent=null,this.__$renderer=null,this.name="DisplayEntityContainer",this.mouseEnabled=!1,this.E_y=[],this.E_z=0,this.E_0=[],this.E_1=0,this.E_2=0,this.E_3=0,this.o_=0,this.E_4=1,this.E_5=1,this.E_6=1,this.e_=h.default.GetMatrix(),this.E_7=null,this.d_=null,this.i_=null,this.f_=null,t&&this.createBounds(),this.T=o.H0++}__$setRenderer(t){let e=0;if(null!=this.__$renderer){if(null==t)for(;e<this.E_z;++e)this.__$renderer.removeEntity(this.E_y[e]);this.__$renderer=t}else if(this.__$renderer=t,null!=t)for(;e<this.E_z;++e)this.E_y[e].__$rseFlag=a.default.RemoveContainerFlag(this.E_y[e].__$rseFlag),this.__$renderer.addEntity(this.E_y[e],this.wprocuid,!1),this.E_y[e].__$rseFlag=a.default.AddContainerFlag(this.E_y[e].__$rseFlag);for(e=0;e<this.E_1;++e)this.E_0[e].wprocuid=this.wprocuid,this.E_0[e].__$setRenderer(t)}__$setParent(t){t!=this&&t!=this.__$parent&&(this.G8$updateBounds=!0,this.__$parent=t,null!=t?(this.wprocuid=t.wprocuid,this.E_u=t.__$getParentVisible()&&t.getVisible(),this.__$setRenderer(t.__$renderer)):this.__$setRenderer(null),this.__$setParentMatrix(t))}getRenderer(){return this.__$renderer}getParent(){return this.__$parent}dispatchEvt(t){return null!=this.B_d?this.B_d.dispatchEvt(t):0}getEvtDispatcher(t){return this.B_d}setEvtDispatcher(t){this.B_d=t}createBounds(){null==this.B_k&&(this.B_k=new l.default,this.E_w=[],this.E_x=[])}getGlobalBounds(){return this.B_k}getGlobalBoundsVer(){return null!=this.B_k?this.B_k.version:-1}addChild(t){if(null!=t&&t.__$wuid<0&&t.__$contId<1){let e=0;for(;e<this.E_1;++e)if(this.E_0[e]==t)return;e>=this.E_1&&(null!=this.E_x&&this.E_x.push(-1),t.__$contId=1,t.wprocuid=this.wprocuid,t.__$setParent(this),this.E_0.push(t),this.E_1++)}}removeChild(t){if(null!=t&&t.getParent()==this){let e=0;for(;e<this.E_1;++e)if(this.E_0[e]==t){t.__$contId=0,t.wprocuid=-1,t.__$setParent(null),this.E_0.splice(e,1),null!=this.E_x&&this.E_x.slice(e,1),--this.E_1;break}}}removeChildByUid(t){if(t>-1){let e=0;for(;e<this.E_1;++e)if(this.E_0[e].getUid()==t){this.E_0[e].__$contId=0,this.E_0.splice(e,1),null!=this.E_x&&this.E_x.slice(e,1),--this.E_1;break}}}getChildAt(t){return t>=0&&t<this.E_1?this.E_0[t]:null}getChildByUid(t){if(t>-1){let e=0;for(;e<this.E_z;++e)if(this.E_y[e].getUid()==t)return this.E_y[e]}return null}getChildrenTotal(){return this.E_1}addEntity(t){if(null==t.getMesh())throw Error("Error: entity.getMesh() == null.");if(t.__$testContainerEnabled()){let e=0;for(;e<this.E_z;++e)if(this.E_y[e]==t)return;e>=this.E_z&&(this.E_y.push(t),this.E_z++,null!=this.E_w&&this.E_w.push(-1),t.getTransform().setParentMatrix(this.getMatrix()),null!=this.__$renderer&&(t.__$rseFlag=a.default.RemoveContainerFlag(t.__$rseFlag),this.__$renderer.addEntity(this.E_y[e],this.wprocuid,!1)),t.__$rseFlag=a.default.AddContainerFlag(t.__$rseFlag),t.__$setParent(this),t.update())}}removeEntity(t){if(null!=t&&t.__$getParent()==this){let e=0;for(;e<this.E_z;++e)if(this.E_y[e]==t){t.__$rseFlag=a.default.RemoveContainerFlag(t.__$rseFlag),this.E_y[e].__$setParent(null),this.E_y.splice(e,1),null!=this.E_w&&this.E_w.slice(e,1),--this.E_z,null!=this.__$renderer&&this.__$renderer.removeEntity(t);break}}}removeEntityByUid(t){if(t>-1){let e=0;for(;e<this.E_z;++e)if(this.E_y[e].getUid()==t){this.E_y[e].__$rseFlag=a.default.RemoveContainerFlag(this.E_y[e].__$rseFlag),this.E_y[e].__$setParent(null),null!=this.__$renderer&&this.__$renderer.removeEntity(this.E_y[e]),this.E_y.splice(e,1),null!=this.E_w&&this.E_w.slice(e,1),--this.E_z;break}}}getEntityAt(t){return t>=0&&t<this.E_z?this.E_y[t]:null}getEntities(){let t=null;null!=this.E_y&&(t=this.E_y.slice(0));for(let e=0;e<this.E_0.length;++e){let i=this.E_0[e].getEntities();null!=i&&(t=t.concat(i))}return t}getEntityByUid(t){if(t>-1){let e=0;for(;e<this.E_z;++e)if(this.E_y[e].getUid()==t)return this.E_y[e]}return null}getEntitysTotal(){return this.E_z}sphereIntersect(t,e){return!1}__$getParentVisible(){return this.E_u}__$updateVisible(){null!=this.__$parent&&(this.E_u=this.__$parent.__$getParentVisible()&&this.__$parent.getVisible());let t=0,e=this.B_e&&this.E_u;for(;t<this.E_z;++t)this.E_y[t].__$setDrawEnabled(e);for(t=0;t<this.E_1;++t)this.E_0[t].__$updateVisible()}setVisible(t){this.B_e=t,this.__$updateVisible()}getVisible(){return this.B_e}getUid(){return this.T}getX(){return this.BF.x}getY(){return this.BF.y}getZ(){return this.BF.z}setX(t){this.BF.x=t,this.E_q|=1}setY(t){this.BF.y=t,this.E_q|=1}setZ(t){this.BF.z=t,this.E_q|=1}setXYZ(t,e,i){this.BF.x=t,this.BF.y=e,this.BF.z=i,this.E_q|=1}offsetPosition(t){this.BF.x+=t.x,this.BF.y+=t.y,this.BF.z+=t.z,this.E_q|=1}setPosition(t){this.BF.x=t.x,this.BF.y=t.y,this.BF.z=t.z,this.E_q|=1}getPosition(t){t.x=this.BF.x,t.y=this.BF.y,t.z=this.BF.z}getRotationX(){return this.E_2}getRotationY(){return this.E_3}getRotationZ(){return this.o_}setRotationX(t){this.E_2=t,this.E_q|=2,this.E_r=!0}setRotationY(t){this.E_3=t,this.E_q|=2,this.E_r=!0}setRotationZ(t){this.o_=t,this.E_q|=2,this.E_r=!0}setRotationXYZ(t,e,i){this.E_2=t,this.E_3=e,this.o_=i,this.E_q|=2,this.E_r=!0}getScaleX(){return this.E_4}getScaleY(){return this.E_5}getScaleZ(){return this.E_6}setScaleX(t){this.E_4=t,this.E_q|=2}setScaleY(t){this.E_5=t,this.E_q|=2}setScaleZ(t){this.E_6=t,this.E_q|=2}setScaleXYZ(t,e,i){this.E_4=t,this.E_5=e,this.E_6=i,this.E_q|=2}setScaleXY(t,e){this.E_4=t,this.E_5=e,this.E_q|=2}setScale(t){this.E_4=t,this.E_5=t,this.E_6=t,this.E_q|=2}getRotationXYZ(t){t.setXYZ(this.E_2,this.E_3,this.o_)}getScaleXYZ(t){t.setXYZ(this.E_4,this.E_5,this.E_6)}localToParent(t){this.e_.transformVectorSelf(t)}parentToLocal(t){null!=this.E_7?this.E_s&&(this.E_s=!1,this.E_7.copyFrom(this.e_)):(this.e_=h.default.GetMatrix(),this.E_s=!1),this.E_7.transformVectorSelf(t)}localToGlobal(t){this.getMatrix().transformVectorSelf(t)}globalToLocal(t){this.getInvMatrix().transformVectorSelf(t)}getInvMatrix(){return null!=this.i_?this.b_&&(this.i_.copyFrom(this.getMatrix()),this.i_.invert(),this.b_=!1):(this.i_=h.default.GetMatrix(),this.i_.copyFrom(this.getMatrix()),this.i_.invert()),this.b_=!1,this.i_}getLocalMatrix(){return this.e_}getMatrix(){return null!=this.f_?(this.E_t&&(this.d_.copyFrom(this.e_),this.d_.append(this.f_),this.E_t=!1),this.d_):(this.E_t=!1,this.e_)}__$setParentMatrix(t){this.f_=t.getMatrix(),null!=this.f_&&null==this.d_&&(this.d_=h.default.GetMatrix()),this.E_q|=2;let e=0;for(;e<this.E_1;++e)this.E_0[e].__$setParentMatrix(this)}__$updateBoundsDo(){let t=0;if(this.G8$updateBounds){if(this.G8$updateBounds=!1,null!=this.B_k){this.B_k.reset();let e=null;for(;t<this.E_z;++t)e=this.E_y[t].getGlobalBounds(),null!=e&&this.B_k.union(e),this.E_w[t],this.E_y[t].getGlobalBoundsVer();for(t=0;t<this.E_1;++t)this.E_0[t].__$updateBoundsDo(),e=this.E_0[t].getGlobalBounds(),null!=e&&this.B_k.union(e),this.E_x[t],this.E_0[t].getGlobalBoundsVer();this.B_k.update()}}else for(t=0;t<this.E_1;++t)this.E_0[t].__$updateBoundsDo()}__$updateBounds(){this.G8$updateBounds=!0}updateBounds(){if(null!=this.B_k&&this.E_v>0){let t=0;if(this.E_v<2)for(;t<this.E_1;++t)this.E_0[t].updateBounds();this.B_k.reset(),t=0;let e=null;for(;t<this.E_z;++t)e=this.E_y[t].getGlobalBounds(),null!=e&&this.B_k.union(e),this.E_w[t]=this.E_y[t].getGlobalBoundsVer();for(t=0;t<this.E_1;++t)e=this.E_0[t].getGlobalBounds(),null!=e&&this.B_k.union(e),this.E_x[t]=this.E_0[t].getGlobalBoundsVer();if(this.B_k.update(),null!=this.__$parent){let t=this.__$parent;while(null!=t)t.__$updateBounds(),t=t.getParent()}this.E_v=-1}}update(){if(null!=this.e_){if(this.E_q>0){this.e_.identity(),this.E_r?(this.e_.setScaleXYZ(this.E_4,this.E_5,this.E_6),this.e_.setRotationEulerAngle(this.E_2*r.default.MATH_PI_OVER_180,this.E_3*r.default.MATH_PI_OVER_180,this.o_*r.default.MATH_PI_OVER_180),this.e_.setTranslation(this.BF)):(this.e_.setScaleXYZ(this.E_4,this.E_5,this.E_6),this.e_.setTranslation(this.BF)),this.b_=!0,this.E_t=!0,this.E_s=!0,this.E_q=0;let t=0;for(;t<this.E_z;++t)this.E_y[t].getTransform().setParentMatrix(this.getMatrix()),this.E_y[t].update();for(t=0;t<this.E_1;++t)this.E_0[t].__$setParentMatrix(this),this.E_0[t].update();this.E_v=1}else{this.E_v=-1;let t=0;if(this.E_z>0)for(;t<this.E_z;++t)this.E_y[t].update(),this.E_w[t]!=this.E_y[t].getGlobalBoundsVer()&&(this.E_v=2);if(this.E_1>0)for(t=0;t<this.E_1;++t)this.E_0[t].update(),this.E_x[t]!=this.E_0[t].getGlobalBoundsVer()&&(this.E_v=2)}this.updateBounds(),this.__$updateBoundsDo()}}destroy(){this.__$wuid<0&&(null!=this.B_d&&(this.B_d.destroy(),this.B_d=null),null!=this.d_&&this.d_!=this.e_&&h.default.RetrieveMatrix(this.d_),null!=this.i_&&h.default.RetrieveMatrix(this.i_),null!=this.e_&&h.default.RetrieveMatrix(this.e_),null!=this.E_7&&h.default.RetrieveMatrix(this.E_7),this.e_=null,this.E_7=null,this.i_=null,this.f_=null,this.d_=null)}toString(){return"[DisplayEntityContainer(uid = "+this.T+", __$wuid = "+this.__$wuid+", __$weid = "+this.__$weid+")]"}}o.H0=0,e.default=o},af29:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("722e")),a=s(i("8333")),n=i("8d98"),l=s(i("cfaf")),h=s(i("3930")),o=s(i("baae")),m=s(i("29ef"));class _{constructor(t,e){this.E_8=new h.default,this.AE=null,this.d=null,this.AV=null,this.E_9=new h.default,this.w_=null,this.Dj=!0,this.AY=-1,this.AZ=-1,this.E_=128,this.FA=128,this.FB=!0,this.FC=!1,this.FD=0,this.FE=null,this.FF=-1,this.FG=-1,this.FH=[],this.EH=[null,null,null,null,null,null,null,null],this.FI=null,this.FJ=0,this.As=!0,this.Aj=1,this.Ag=256,this.FK=!0,this.FL=!0,this.FM=!1,this.FN=!1,this.FO=!1,this.FP=!1,this.uns="FBOInstance",this.w_=t,this.FI=e,this.d=t.getRenderProxy(),this.AE=this.d.getRenderAdapter(),this.AV=t.getRendererContext()}getFBOUid(){return this.AY}setRProcessIDList(t){if(null!=t){if(t.length<1)throw Error("processIDlist.length < 1, but it must: processIDlist.length >= 1");this.FH=t.slice(0)}}setRProcessList(t){if(t.length<1)throw Error("list.length < 1, but must: list.length >= 1");this.FH=new Array(t.length);for(let e=0;e<t.length;++e)this.FH[e]=t[e].getRPIndex()}getRProcessIDAt(t){return this.FH[t]}getStage3D(){return this.d.getStage3D()}getCamera(){return null!=this.d?this.d.getCamera():null}lockViewport(){this.FN=!0}unlockViewport(){this.FN=!1}updateCamera(){null!=this.d&&this.d.updateCamera()}updateCameraDataFromCamera(t){null!=this.d&&this.d.updateCameraDataFromCamera(t)}useGlobalRenderState(t){this.AV.useGlobalRenderState(t)}useGlobalRenderStateByName(t){this.AV.useGlobalRenderStateByName(t)}setGlobalRenderState(t){this.FF=t}setGlobalRenderStateByName(t){this.FF=this.AV.getRenderStateByName(t)}lockRenderState(t=-1){this.FF>=0||t>=0?this.AV.useGlobalRenderState(t<0?this.FF:t):this.d.lockRenderState()}unlockRenderState(){this.d.unlockRenderState()}useGlobalRenderColorMask(t){this.AV.useGlobalRenderColorMask(t)}useGlobalRenderColorMaskByName(t){this.AV.useGlobalRenderColorMaskByName(t)}setGlobalRenderColorMask(t){this.FG=t}setGlobalRenderColorMaskByName(t){this.FG=this.AV.getRenderColorMaskByName(t)}lockColorMask(t=-1){this.FG>=0||t>=0?this.AV.useGlobalRenderColorMask(t<0?this.FG:t):this.d.lockRenderColorMask()}unlockRenderColorMask(){this.AV.useGlobalRenderColorMask(m.default.COLOR_MASK_ALL_TRUE),this.d.unlockRenderColorMask()}useGlobalMaterial(t,e=!1,i=!1){this.FO=e,this.FP=i,this.AV.useGlobalMaterial(t,this.FO,i)}setGlobalMaterial(t,e=!1,i=!1){this.FO=e,this.FP=i,this.FE!=t&&(null!=this.FE&&this.FE.__$detachThis(),null!=t&&t.__$attachThis()),this.FE=t}lockMaterial(){null!=this.FE?this.AV.useGlobalMaterial(this.FE,this.FO,this.FP):this.AV.lockMaterial()}unlockMaterial(){this.AV.unlockMaterial()}updateGlobalMaterialUniform(){this.AV.updateMaterialUniform(this.FE)}clearDepth(t=1){this.AE.clearFBODepthAt(this.AY,t)}synFBOSizeWithViewport(){this.As=!0}asynFBOSizeWithViewport(){this.As=!1}setFBOSizeFactorWithViewPort(t){this.Aj=t}createViewportSizeFBOAt(t,e=!1,i=!1,s=0){this.AY<0&&(this.AY=t,this.AZ=o.default.FRAMEBUFFER,this.E_=this.AE.getViewportWidth(),this.FA=this.AE.getViewportHeight(),this.FB=e,this.FC=i,this.FD=s,this.AE.createFBOAt(t,this.AZ,this.E_,this.FA,e,i,s))}createFBO(t,e,i=0){this.FB=t,this.FC=e,this.FD=i,this.AE.createFBOAt(this.AY,this.AZ,this.E_,this.FA,t,e,i)}createAutoSizeFBOAt(t,e=!1,i=!1,s=0){t>=0&&this.AY<0&&(this.AZ=o.default.FRAMEBUFFER,this.E_=512,this.FA=512,this.AY=t,this.createFBO(e,i,s))}createFBOAt(t,e,i,s=!1,r=!1,a=0){t>=0&&this.AY<0&&(this.AZ=o.default.FRAMEBUFFER,this.E_=e,this.FA=i,this.AY=t,this.E_<1&&(this.E_=this.AE.getRCanvasWidth()),this.FA<1&&(this.FA=this.AE.getRCanvasHeight()),this.createFBO(s,r,a))}createReadFBOAt(t,e,i,s=!1,r=!1,a=0){t>=0&&this.AY<0&&(this.AZ=o.default.READ_FRAMEBUFFER,this.E_=e,this.FA=i,this.AY=t,this.E_<1&&(this.E_=this.AE.getRCanvasWidth()),this.FA<1&&(this.FA=this.AE.getRCanvasHeight()),this.createFBO(s,r,a))}createDrawFBOAt(t,e,i,s=!1,r=!1,a=0){t>=0&&this.AY<0&&(this.AZ=o.default.DRAW_FRAMEBUFFER,this.E_=e,this.FA=i,this.AY=t,this.E_<1&&(this.E_=this.AE.getRCanvasWidth()),this.FA<1&&(this.FA=this.AE.getRCanvasHeight()),this.createFBO(s,r,a))}resizeFBO(t,e){this.E_==t&&this.FA==e||(this.E_=t,this.FA=e,this.AE.resizeFBOAt(this.AY,t,e))}getRTTAt(t){return this.EH[t]}enableMipmapRTTAt(t){this.EH[t].enableMipmap()}generateMipmapTextureAt(t){this.EH[t].generateMipmap(this.d.Texture)}setRenderToTexture(t,e=0){return 0==e?this.FJ=1:this.FJ<e+1&&(this.FJ=e+1),this.EH[e]=t,t}setRenderToRTTTextureAt(t,e=0){this.setRenderToTexture(this.FI.getRTTTextureAt(t),e)}setRenderToFloatTextureAt(t,e=0){this.setRenderToTexture(this.FI.getRTTFloatTextureAt(t),e)}setRenderToHalfFloatTexture(t,e=0){return null==t&&(t=new l.default(128,128),t.__$setRenderProxy(this.d),t.internalFormat=n.TextureFormat.RGBA16F,t.srcFormat=n.TextureFormat.RGBA,t.dataType=n.TextureDataType.FLOAT,t.minFilter=n.TextureConst.LINEAR,t.magFilter=n.TextureConst.LINEAR,t.__$setRenderProxy(this.d)),this.setRenderToTexture(t,e)}setRenderToRGBATexture(t,e=0){return null==t&&(t=new l.default(32,32),t.internalFormat=n.TextureFormat.RGBA,t.srcFormat=n.TextureFormat.RGBA,t.dataType=n.TextureDataType.UNSIGNED_BYTE,t.minFilter=n.TextureConst.LINEAR,t.magFilter=n.TextureConst.LINEAR,t.__$setRenderProxy(this.d)),this.setRenderToTexture(t,e)}setRenderToDepthTextureAt(t,e=0){return this.setRenderToTexture(this.FI.getDepthTextureAt(t),e)}setClearState(t,e,i=!1){this.FK=t,this.FL=e,this.FM=i}setRenderToBackBuffer(){this.d.setClearColor(this.E_8),this.AV.setRenderToBackBuffer()}setClearDepth(t){this.Ag=t}getClearDepth(){return this.AE.getClearDepth()}getViewportX(){return this.AE.getViewportX()}getViewportY(){return this.AE.getViewportY()}getViewportWidth(){return this.AE.getViewportWidth()}getViewportHeight(){return this.AE.getViewportHeight()}getFBOWidth(){return this.AE.getFBOWidthAt(this.AY)}getFBOHeight(){return this.AE.getFBOHeightAt(this.AY)}resetAttachmentMask(t){this.AE.resetFBOAttachmentMask(t)}setAttachmentMaskAt(t,e){this.AE.setFBOAttachmentMaskAt(t,e)}setClearRGBColor3f(t,e,i){this.E_9.setRGB3f(t,e,i)}setClearColorEnabled(t){this.FK=t}setClearDepthEnabled(t){this.FL=t}setClearStencilEnabled(t){this.FM=t}setClearUint24Color(t,e=1){this.E_9.setRGBUint24(t),this.E_9.a=e}setClearRGBAColor4f(t,e,i,s){this.E_9.setRGBA4f(t,i,e,s)}blitFrom(t,e=a.default.COLOR_BUFFER_BIT,i=r.default.NEAREST,s=-1,n=0,l=null){this.AY>=0&&(this.AE.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.AE.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.AE.blitFBO(t.getFBOUid(),this.AY,e,i,s,n,l))}blitColorFrom(t,e=r.default.NEAREST,i=-1,s=0,n=null){this.AY>=0&&(this.AE.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.AE.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.AE.blitFBO(t.getFBOUid(),this.AY,a.default.COLOR_BUFFER_BIT,e,i,s,n))}blitDepthFrom(t,e=r.default.NEAREST,i=-1,s=0,n=null){this.AY>=0&&(this.AE.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.AE.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.AE.blitFBO(t.getFBOUid(),this.AY,a.default.COLOR_BUFFER_BIT|a.default.DEPTH_BUFFER_BIT,e,i,s,n))}blitColorAndDepthFrom(t,e=r.default.NEAREST,i=-1,s=0,n=null){this.AY>=0&&(this.AE.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.AE.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.AE.blitFBO(t.getFBOUid(),this.AY,a.default.COLOR_BUFFER_BIT|a.default.DEPTH_BUFFER_BIT,e,i,s,n))}blitStencilFrom(t,e=r.default.NEAREST,i=-1,s=0,n=null){this.AY>=0&&(this.AE.setBlitFboSrcRect(0,0,t.getFBOWidth(),t.getFBOHeight()),this.AE.setBlitFboSrcRect(0,0,this.getFBOWidth(),this.getFBOHeight()),this.AE.blitFBO(t.getFBOUid(),this.AY,a.default.STENCIL_BUFFER_BIT,e,i,s,n))}renderToTextureAt(t,e=0){this.AE.setRenderToTexture(this.EH[t],this.FB,this.FC,e),this.AE.useFBO(this.FK,this.FL,this.FM)}runBeginDo(){if(this.Dj){this.Dj=!1,this.d.getClearRGBAColor4f(this.E_8),this.FN?this.AE.lockViewport():this.AE.unlockViewport(),this.AE.bindFBOAt(this.AY,this.AZ),this.As?(this.AE.synFBOSizeWithViewport(),this.AE.setFBOSizeFactorWithViewPort(this.Aj)):this.AE.asynFBOSizeWithViewport(),this.Ag<128&&this.AE.setClearDepth(this.Ag),this.d.setClearColor(this.E_9);let t=0;for(;t<this.FJ;++t)this.AE.setRenderToTexture(this.EH[t],this.FB,this.FC,t);this.AE.useFBO(this.FK,this.FL,this.FM),null!=this.FE?this.AV.useGlobalMaterial(this.FE,this.FO,this.FP):this.AV.unlockMaterial()}}run(t=!1,e=!1,i=!0,s=!0){if(t&&this.lockRenderState(),e&&!s&&this.lockMaterial(),this.AY>=0&&null!=this.FH){s&&this.runBeginDo();for(let t=0,e=this.FH.length;t<e;++t)this.w_.runAt(this.FH[t])}t&&this.unlockRenderState(),e&&this.unlockMaterial(),i&&this.runEnd()}runAt(t,e=!0){this.AY>=0&&null!=this.FH&&(0==t&&e?this.runBeginDo():this.Dj=!0,this.w_.runAt(this.FH[t]))}drawEntity(t,e=!1,i=!0){this.Dj||this.w_.drawEntity(t,e,i)}runBegin(){this.AY>=0&&null!=this.FH&&(this.Dj=!0,this.runBeginDo())}runEnd(){this.d.setClearColor(this.E_8),this.Dj=!0,this.FN&&this.AE.unlockViewport()}useCamera(t,e=!1){this.w_.useCamera(t,e)}useMainCamera(){this.w_.useMainCamera()}reset(){let t=0;for(;t<this.FJ;++t)this.EH[t]=null;this.Dj=!1,this.AY=-1,this.FJ=0,this.FH=[],null!=this.FE&&(this.FE.__$detachThis(),this.FE=null)}clone(){let t=new _(this.w_,this.FI);t.Aj=this.Aj,t.E_9.copyFrom(this.E_9),t.AY=this.AY,t.AZ=this.AZ,t.Ag=this.Ag,t.FJ=this.FJ,t.FB=this.FB,t.FC=this.FC,t.As=this.As,t.E_=this.E_,t.FA=this.FA,t.FD=this.FD;let e=0;for(;e<this.FJ;++e)t.EH[e]=t.EH[e];if(null!=this.FH){let i=this.FH.length,s=new Array(i);for(e=0;e<i;++e)s[e]=this.FH[e];t.setRProcessIDList(s)}return t}}e.default=_},af68:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("11e6")),a=s(i("7b0e"));class n{constructor(){this.D_y=0,this.FQ=[],this.D_x=[],this.FR=[],this.FS=[],this.j_=[]}getFreeId(){return this.j_.length>0?this.j_.pop():-1}createNode(){let t=this.getFreeId();if(t>=0)return this.FS[t]=1,this.D_x[t];{t=this.D_y;let e=a.default.Create();return this.D_x.push(e),this.FR.push(null),e.spaceId=t,this.FS.push(1),this.FQ.push(t),this.FS.push(1),this.D_y++,e}}restoreId(t){t>0&&1==this.FS[t]&&(this.j_.push(t),this.FS[t]=0,this.FR[t]=null)}addEntity(t){let e=this.createNode();return this.FR[e.spaceId]=t,e.entity=t,t.__$rseFlag=r.default.AddSpaceUid(t.__$rseFlag,e.spaceId),e}initialize(t){if(t>0)for(let e=0;e<t;e++){let t=this.createNode();this.FR[t.spaceId]=null}}getNodeByEntity(t){if(r.default.TestSpaceContains(t.__$rseFlag)){let e=r.default.GetSpaceUid(t.__$rseFlag);if(this.FR[e]==t)return this.D_x[e]}return null}removeEntity(t){if(r.default.TestSpaceContains(t.__$rseFlag)){let e=r.default.GetSpaceUid(t.__$rseFlag);this.FR[e]==t&&(this.D_x[e].entity=null,this.restoreId(e),t.__$rseFlag=r.default.RemoveSpaceUid(t.__$rseFlag))}}toString(){return"[EntityNodeQueue()]"}}e.default=n},afca:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("8e17")),n=s(i("b07e"));class l{constructor(){this.A_T=null,this.A_U=null,this.A_V=null,this.A_W=null,this.A_X=null,this.A_Y=null,this.A_Z=new a.default,this.A_a=new a.default,this.A_b=new n.default,this.A_c=32,this.A_d=32,this.A_e=.6,this.A_f=0,this.A_g=0,this.A_h=new a.default,this.A_i=new a.default,this.A_j=20,this.A_k=25,this.A_l=30,this.A_m=10,this.A_n=1,this.A_o=40,this.A_p=20,this.A_q=1,this.A_r=null,this.FT=new a.default(100,110),this.FU=new a.default(100,110),this.FV=20,this.FW=20}setCoreAngle(t){this.A_k=t}setBgAngle(t,e,i){this.A_l=t,this.A_m=e,this.A_n=i>0?1:-1}setSgOffsetAngle(t,e,i){this.A_o=t,this.A_p=e,this.A_q=i>0?1:-1}setAngleDirec(t,e){this.A_n=t>0?1:-1,this.A_q=e>0?1:-1}toPositive(){this.A_b.toPositive()}toNegative(){this.A_b.toNegative()}setDuration(t){this.A_b.duration=t}getDuration(){return this.A_b.duration}setTG(t,e,i){this.A_U=t,this.A_j=e}setBG(t,e,i){this.A_V=t,this.A_W=e,this.A_d=i}setSG(t,e){this.A_X=t,this.A_Y=e}initialize(t,e,i){null==this.A_T&&null!=t&&(this.A_T=t,this.A_Z.copyFrom(e),this.A_T.setPosition(e),this.A_c=i,this.A_a.x=i,this.A_b.initialize(),this.A_T.update(),this.A_r=this.A_T.getToParentMatrix())}getBiasTime(){return this.A_b.getBiasTime()}getOriginTime(){return this.A_b.getOriginTime()}getNextOriginTime(t){return this.A_b.getNextOriginTime(t)}resetPose(){let t=this.A_e;this.A_e=0,this.A_b.factor=0,this.A_b.reset(),this.run(0),this.A_e=t,this.A_b.factor=0}setAttLPos(t){this.FT.copyFrom(t)}setAttRPos(t){this.FU.copyFrom(t)}getLEndPos(t,e){this.A_h.setXYZ(0,this.A_d*e,0),this.A_X.getMatrix().transformOutVector3(this.A_h,t)}getREndPos(t,e){this.A_h.setXYZ(0,this.A_d*e,0),this.A_Y.getMatrix().transformOutVector3(this.A_h,t)}setRecoilDegreeL(t){this.FV=t}setRecoilDegreeR(t){this.FW=t}runAtt(t,e){if(e||this.FV>-1||this.FW>-1){this.A_b.calc(t);let e=this.A_b.factor,i=this.A_e,s=e*this.A_l*i,r=this.A_m*i;this.A_f=-s+r-this.FV,this.A_g=s+r-this.FW,this.FV>0&&this.FV--,this.FW>0&&this.FW--,null!=this.A_U&&(this.A_T.setRotationXYZ(0,e*this.A_j*i,0),this.A_T.update()),this.A_T.setRotationXYZ(0,e*this.A_k*i,0),this.A_T.update(),this.A_h.setXYZ(0,0,-this.A_c),this.A_r.transformVector3Self(this.A_h),this.A_V.setPosition(this.A_h),this.A_V.setRotationXYZ(0,0,this.A_f),this.A_V.update(),this.A_h.setXYZ(0,0,this.A_c),this.A_r.transformVector3Self(this.A_h),this.A_W.setPosition(this.A_h),this.A_W.setRotationXYZ(0,0,this.A_g),this.A_W.update(),this.runPartAtt()}}runPartAtt(){this.A_h.setXYZ(0,this.A_d,0),this.A_V.getToParentMatrix().transformVector3Self(this.A_h),this.A_X.setPosition(this.A_h);let t=r.default.GetDegreeByXY(this.A_h.y-this.FT.y,this.FT.x-this.A_h.x);this.A_X.setRotationXYZ(0,0,t),this.A_X.update(),this.A_h.setXYZ(0,this.A_d,0),this.A_W.getToParentMatrix().transformVector3Self(this.A_h),this.A_Y.setPosition(this.A_h),t=r.default.GetDegreeByXY(this.A_h.y-this.FU.y,this.FU.x-this.A_h.x),this.A_Y.setRotationXYZ(0,0,t),this.A_Y.update()}run(t){this.A_b.calc(t);let e=this.A_b.factor,i=this.A_e,s=e*this.A_l*i,r=this.A_m*i;this.A_f=-s+r,this.A_g=s+r,null!=this.A_U&&(this.A_T.setRotationXYZ(0,e*this.A_j*i,0),this.A_T.update()),this.A_T.setRotationXYZ(0,e*this.A_k*i,0),this.A_T.update(),this.A_h.setXYZ(0,0,-this.A_c),this.A_r.transformVector3Self(this.A_h),this.A_V.setPosition(this.A_h),this.A_V.setRotationXYZ(0,0,this.A_f),this.A_V.update(),this.A_h.setXYZ(0,0,this.A_c),this.A_r.transformVector3Self(this.A_h),this.A_W.setPosition(this.A_h),this.A_W.setRotationXYZ(0,0,this.A_g),this.A_W.update(),this.runPart()}runPart(){let t=this.A_q*this.A_b.factor,e=this.A_q*this.A_e,i=t*this.A_o*e,s=this.A_p*e;this.A_f-=i+s,this.A_h.setXYZ(0,this.A_d,0),this.A_V.getToParentMatrix().transformVector3Self(this.A_h),this.A_X.setPosition(this.A_h),this.A_X.setRotationXYZ(0,0,this.A_f),this.A_X.update(),this.A_g-=-i+s,this.A_h.setXYZ(0,this.A_d,0),this.A_W.getToParentMatrix().transformVector3Self(this.A_h),this.A_Y.setPosition(this.A_h),this.A_Y.setRotationXYZ(0,0,this.A_g),this.A_Y.update()}}e.default=l},b02c:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01"));class a{constructor(t,e){this.T=-1,this.EX=-1,this.A_C=0,this.FX=null,this.FY=null,this.AP=null,this.A=0,this.B8=null,this.direct=!0,this.c=0,this.A=t,this.T=a.H0++,this.EX=e}__$setParam(t,e){this.A=t,this.EX=e}getRCUid(){return this.A}getMid(){return this.EX}getTexTotal(){return this.A_C}collectTexList(t,e,i){this.B8=t;let s=0;if(this.direct)if(this.A_C<1&&e.length>0){let a,n=r.default.GetNearestCeilPow2(e.length);this.FY=new Uint16Array(n),this.FX=new Array(n),this.AP=e;while(s<i)a=e[s],a.__$attachThis(),a.__$$upload(t),this.FY[s]=a.getSampler(),this.FX[s]=this.B8.getGpuBuffer(a.getResUid()),this.B8.__$attachRes(a.getResUid()),s++;this.A_C=s}else this.A_C=0;else this.A_C=i;while(s<e.length)e[s++].__$attachThis()}run(){if(this.B8.unlocked&&this.B8.texMid!=this.EX){this.B8.texMid=this.EX;let t=this.B8.getRC(),e=t.TEXTURE0;if(this.direct)for(let i=0;i<this.A_C;++i)t.activeTexture(e++),t.bindTexture(this.FY[i],this.FX[i]);else{let i=this.AP;for(let s=0;s<this.A_C;++s)t.activeTexture(e++),i[s].__$$use(this.B8)}}}getUid(){return this.T}__$attachThis(){++this.c}__$detachThis(){--this.c,this.c<1&&(this.c=0,a.Restore(this))}reset(){if(null!=this.AP)for(let t=0,e=this.AP.length;t<e;++t)this.AP[t].__$detachThis(),this.B8.__$detachRes(this.AP[t].getResUid()),this.FX[t]=null;this.A_C=0,this.AP=null,this.B8=null}toString(){return"TextureRenderObj(uid = "+this.T+", mid="+this.EX+")"}static Create(t,e,i){let s=e.length;if(s>0&&i>0){if(s<i)throw Error("There are fewer textures than in the shader : (need "+i+",but only have "+s+") !!!");let r=31,n=0,l=!0;while(n<i)r=131*r+e[n].getUid(),e[n].isDirect()||(l=!1),++n;let h=a.II[t.getRCUid()],o=null;return h.has(r)?o=h.get(r):(o=a.IH.length<1?new a(t.getRCUid(),r):a.IH.pop(),o.collectTexList(t,e,i),h.set(r,o)),o.__$setParam(t.getRCUid(),r),o.direct=l,o}return null}static Restore(t){t.getMid()>-1&&(a.II[t.getRCUid()].delete(t.getMid()),t.__$setParam(0,0),a.IH.push(t),t.reset())}static GetByMid(t,e){return a.II[t].get(e)}}a.H0=0,a.II=[new Map,new Map,new Map,new Map,new Map,new Map,new Map,new Map],a.IH=[],a.IJ=!0,a.IK=-1,e.TextureRenderObj=a;class n{constructor(t){this.B8=null,this.B8=t}run(){this.B8.renderBegin()}getMid(){return 1}__$attachThis(){}__$detachThis(){}}e.EmptyTexRenderObj=n,e.default=a},b07e:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.progress=1,this.factor=1,this.duration=40,this.FZ=10,this.Fa=.3,this.C_0=1,this.Fb=1,this.Fc=1.03}initialize(){this.FZ=Math.floor(.25*this.duration);let t=1-Math.sqrt(.5/this.Fc);this.Fa=2*t*this.FZ}toPositive(){this.Fb=1}toNegative(){this.Fb=-1}reset(){this.C_0=1,this.Fb=1}getOriginTime(){return this.FZ}getBiasTime(){return this.Fa}getNextOriginTime(t){let e=Math.ceil(.25*Math.floor(t/this.FZ));return 4*e*this.FZ+this.Fa}calc(t){let e=t/this.duration;this.progress=e-Math.floor(e),e*=2,e-=Math.floor(e),this.Fb>e&&(this.C_0*=-1),this.Fb=e,e=1-e,e=e*e*this.Fc,e=this.C_0*(e-.5),this.factor=e}calcAngleEEE(t){let e=t/this.duration;e-=Math.floor(e),e=this.C_0*(e-.5),(this.Fb<e&&this.C_0<0||this.Fb>e&&this.C_0>0)&&(this.C_0*=-1),this.Fb=e}}e.default=s},b0ef:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.D_=null,this.C_=null,this.Fd=-1,this.Fe=-1,this.resized=!0}setDiv(t){this.C_=t}createViewEle(t,e){null==this.C_&&(this.C_=document.getElementById("voxEngineDiv")),null==this.C_&&(this.C_=t.createElement("div"),this.C_.style.width="400px",this.C_.style.height="300px",document.body.appendChild(this.C_)),this.C_.style.display="bolck",this.C_.style.position="absolute",""==this.C_.style.left&&(this.C_.style.left="0px",this.C_.style.top="0px"),e&&(this.C_.style.width="100%",this.C_.style.height="100%"),null==this.D_&&(this.D_=document.createElement("canvas"),this.C_.appendChild(this.D_),this.D_.width=800,this.D_.height=600,this.D_.style.display="bolck",this.D_.style.left="0px",this.D_.style.top="0px",this.D_.style.position="absolute")}setDivStyleLeftAndTop(t,e){this.C_.style.left=t+"px",this.C_.style.top=e+"px"}setDivStyleSize(t,e){this.Fd==t&&this.Fe==e||(this.C_.style.width=t+"px",this.C_.style.height=e+"px",this.resized=!0)}getDiv(){return this.C_}getCanvas(){return this.D_}}e.default=s},b161:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("3806")),n=s(i("c51d")),l=s(i("c497")),h=s(i("af68")),o=s(i("a80a")),m=s(i("9c4d")),_=s(i("d958")),u=s(i("5d04")),d=s(i("a446")),c=s(i("c711")),f=s(i("955e")),p=s(i("765c")),g=s(i("af29")),v=s(i("d7e2")),x=s(i("70f2")),y=s(i("2139"));class T{constructor(){this.T=-1,this.AE=null,this.d=null,this.A_6=null,this.AV=null,this.w_=null,this.DW=new Uint8Array(128),this.DX=0,this.DY=null,this.DZ=new r.default,this.Da=new r.default,this.Db=null,this.Dc=!1,this.Dd=null,this.De=!0,this.B=0,this.C=0,this.D=800,this.E=800,this.Df=null,this.Dg=null,this.Ff=null,this.Fg=[],this.Fh=0,this.Dj=-1,this.Dk=!0,this.Fi=!1,this.Fj=-1,this.Di=null,this.BA=!0,this.runnableQueue=new m.default,this.textureBlock=new u.default,this.stage3D=null,this.Dm=[],this.Dn=0,this.Fk=null,this.Do=!0,this.Dp=!0,this.Dq=!0,this.Dr=!0,this.T=T.H0++}tickUpdate(){this.Fj>-1&&clearTimeout(this.Fj),this.Fj=setTimeout(this.tickUpdate.bind(this),this.Di.getTickUpdateTime()),this.textureBlock.run()}enable(){this.BA=!0}disable(){this.BA=!1}isEnabled(){return this.BA}getUid(){return this.T}getDiv(){return this.d.getDiv()}getCanvas(){return this.d.getCanvas()}getRPONodeBuilder(){return null}getRenderProxy(){return this.d}setViewPort(t,e,i,s){null!=this.d&&(this.B=t,this.C=e,this.D=i,this.E=s,this.d.setViewPort(t,e,i,s))}setViewPortFromCamera(t){null!=this.d&&null!=t&&(this.B=t.getViewX(),this.C=t.getViewY(),this.D=t.getViewWidth(),this.E=t.getViewHeight(),this.d.setViewPort(this.B,this.C,this.D,this.E))}reseizeViewPort(){this.d.reseizeRCViewPort()}lockViewport(){this.AE.lockViewport()}unlockViewport(){this.AE.unlockViewport()}getRendererAdapter(){return this.AE}getRenderer(){return this.w_}getRendererContext(){return this.AV}getStage3D(){return this.d.getStage3D()}getRendererStatus(){return this.w_.getRendererStatus()}getViewWidth(){return this.d.getStage3D().viewWidth}getViewHeight(){return this.d.getStage3D().viewHeight}getCamera(){return this.d.getCamera()}asynFBOSizeWithViewport(){this.AV.asynFBOSizeWithViewport()}synFBOSizeWithViewport(){this.AV.synFBOSizeWithViewport()}cameraLock(){this.d.cameraLock()}cameraUnlock(){this.d.cameraUnlock()}getMouseXYWorldRay(t,e){this.d.getMouseXYWorldRay(t,e)}createCamera(){return new n.default}createFBOInstance(){return new g.default(this,this.textureBlock.getRTTStrore())}setClearUint24Color(t,e=1){this.d.setClearUint24Color(t,e)}setClearRGBColor3f(t,e,i){this.d.setClearRGBColor3f(t,e,i)}setClearRGBAColor4f(t,e,i,s){this.d.setClearRGBAColor4f(t,e,i,s)}setClearColor(t){this.d.setClearRGBAColor4f(t.r,t.g,t.b,t.a)}setRenderToBackBuffer(){this.AV.setRenderToBackBuffer()}drawBackBufferToCanvas(t){let e=this.getCanvas();var i=t.getContext("2d");i.drawImage(e,0,0,t.width,t.height)}updateRenderBufferSize(){this.AE.updateRenderBufferSize()}setEvt3DController(t){null!=t&&(t.initialize(this.getStage3D(),this.getStage3D()),t.setRaySelector(this.DY.getRaySelector())),this.Dd=t}isRayPickSelected(){return null!=this.Dd&&this.Dd.isSelected()}enableMouseEvent(t=!0){null==this.Dd&&(t?this.DY.setRaySelector(new f.default):this.DY.setRaySelector(new c.default),this.setEvt3DController(new p.default)),this.De=!0}disableMouseEvent(){this.De=!1}getEvt3DController(){return this.Dd}getSpace(){return this.DY}getDevicePixelRatio(){return this.AE.getDevicePixelRatio()}createSubScene(){if(null!=this.w_){let t=new x.default(this,this.w_,this.Dc);this.Fg.push(t),this.Fh++;let e=t;return e.textureBlock=this.textureBlock,t}return null}addEventListener(t,e,i,s=!0,r=!1){this.stage3D.addEventListener(t,e,i,s,r)}removeEventListener(t,e,i){this.stage3D.removeEventListener(t,e,i)}setAccessor(t){this.Db=t}initialize(t=null,e=3){if(null==this.w_){null==t&&(t=new l.default),this.Di=t;let i=this;i.stage3D=new a.default(this.getUid(),document),e<1&&(e=1),e>8&&(e=8),this.Dc=t.evtFlowEnabled,this.w_=new _.default,this.w_.__$setStage3D(this.stage3D),y.default.Allocate(t.getMatrix4AllocateSize());let s=new n.default;this.w_.initialize(t,s),this.DW[0]=0,this.DX++;let r=null;for(;e>=0;)r=this.w_.appendProcess(t.batchEnabled,t.processFixedState),this.DW[this.DX]=r.getRPIndex(),this.DX++,--e;this.AV=this.w_.getRendererContext(),this.d=this.AV.getRenderProxy(),this.AE=this.d.getRenderAdapter();let h=this.d.getStage3D();if(this.D=h.stageWidth,this.E=h.stageHeight,this.A_6=this.w_.getDataBuilder().getRenderShader(),this.textureBlock.setRenderer(this.w_),this.Ff=new v.default(this.d),null==this.DY){let t=new d.default;t.initialize(this.w_,this.d.getCamera()),this.DY=t}this.tickUpdate()}}setRendererProcessParam(t,e,i){this.w_.setRendererProcessParam(this.DW[t],e,i)}appendARendererProcess(t=!0,e=!1){let i=this.w_.appendProcess(t,e);this.DW[this.DX]=i.getRPIndex(),this.DX++}getRenderProcessAt(t){return this.w_.getProcessAt(this.DW[t])}addContainer(t,e=0){if(e<0&&(e=0),null!=t&&t.__$wuid<0&&t.__$contId<1){let i=0;for(;i<this.Dn;++i)if(this.Dm[i]==t)return;i>=this.Dn&&(t.__$wuid=this.T,t.wprocuid=e,t.__$setRenderer(this),this.Dm.push(t),this.Dn++)}}removeContainer(t){if(null!=t&&t.__$wuid==this.T&&t.getRenderer()==this.w_){let e=0;for(;e<this.Dn;++e)if(this.Dm[e]==t){t.__$wuid=-1,t.wprocuid=-1,t.__$setRenderer(null),this.Dm.splice(e,1),--this.Dn;break}}}setAutoRunningEnabled(t){this.Dk=t}setAutoRenderingSort(t){this.Fi=t}setProcessSortEnabledAt(t,e,i=null){if(this.w_.setProcessSortEnabledAt(t,e),e){let e=this.w_.getProcessAt(t);i=null!=i?i:this.Ff,null!=e&&e.setSorter(i)}}setProcessSortEnabled(t,e,i=null){this.w_.setProcessSortEnabled(t,e),e&&null!=t&&!t.hasSorter()&&(i=null!=i?i:this.Ff,t.setSorter(i))}moveEntityTo(t,e){this.w_.moveEntityToProcessAt(t,this.DW[e])}drawEntity(t,e=!1,i=!0){this.w_.drawEntity(t,e,i)}addEntity(t,e=0,i=!0){if(null!=t&&t.__$testSpaceEnabled())if(t.isPolyhedral())if(t.hasMesh())this.w_.addEntity(t,this.DW[e],i),null!=this.DY&&this.DY.addEntity(t);else{null==this.Df&&(this.Df=new o.default,this.Dg=new h.default);let i=this.Dg.addEntity(t);i.rstatus=e,this.Df.addNode(i)}else this.w_.addEntity(t,this.DW[e],i),null!=this.DY&&this.DY.addEntity(t)}removeEntity(t){if(null!=t){let e=null;if(null!=this.Df){let e=this.Dg.getNodeByEntity(t);null!=e&&(this.Df.removeNode(e),this.Dg.removeEntity(t))}null==e&&(this.w_.removeEntity(t),null!=this.DY&&this.DY.removeEntity(t))}}updateMaterialUniformToCurrentShd(t){this.w_.updateMaterialUniformToCurrentShd(t)}showInfoAt(t){this.w_.showInfoAt(t)}getRenderUnitsTotal(){return this.w_.getRenderUnitsTotal()}useCamera(t,e=!1){this.Fk=t,e&&(this.d.setRCViewPort(t.getViewX(),t.getViewY(),t.getViewWidth(),t.getViewHeight(),!0),this.d.reseizeRCViewPort()),t.update(),this.AV.resetUniform(),this.d.updateCameraDataFromCamera(t)}useMainCamera(){this.Fk=null;let t=this.d.getCamera();this.d.setRCViewPort(t.getViewX(),t.getViewY(),t.getViewWidth(),t.getViewHeight(),!0),this.d.reseizeRCViewPort(),this.d.updateCamera(),this.AV.resetUniform(),this.d.updateCameraDataFromCamera(this.d.getCamera())}updateCameraDataFromCamera(t){this.d.updateCameraDataFromCamera(t)}resetState(){this.AV.resetState()}resetUniform(){this.AV.resetUniform()}enableSynViewAndStage(){this.d.enableSynViewAndStage()}renderBegin(t=!0){if(null==this.Fk){if(this.AE.unlockViewport(),this.d.isAutoSynViewAndStage()){let t=this.d.testViewPortChanged(this.B,this.C,this.D,this.E);this.B=this.d.getViewX(),this.C=this.d.getViewY(),this.D=this.d.getViewWidth(),this.E=this.d.getViewHeight(),t&&(this.d.setRCViewPort(this.B,this.C,this.D,this.E,!0),this.d.reseizeRCViewPort())}else this.d.setViewPort(this.B,this.C,this.D,this.E);this.d.updateCamera(),this.d.updateCameraDataFromCamera(this.d.getCamera())}this.A_6.renderBegin(),t&&this.AV.renderBegin(null==this.Fk),this.Fk=null,null!=this.Db&&this.Db.renderBegin(this)}runBegin(t=!0,e=!0){t&&this.Dk&&(this.Dj>=0&&this.runEnd(),this.Dj=0);let i=this.Fk,s=null==i;this.renderBegin(e),null!=this.DY&&(this.DY.setCamera(s?this.d.getCamera():i),this.DY.runBegin())}renderContextBegin(){this.AV.renderBegin()}setRayTestEanbled(t){this.Dr=t}runMouseTest(t,e){let i=-1;if(null!=this.Dd&&this.De){if(this.Dq&&this.Dd.getEvtType()>0){let t=this.DY.getRaySelector();if(null!=t){this.Dr?this.mouseRayTest():t.clear();let e=t.getSelectedNodesTotal();if(e>1){let i=0,s=t.getSelectedNodes(),r=null;for(;i<e;++i)r=s[i],r.entity.isPolyhedral()}}this.Dq=!1}i=this.Dd.run(t,e)}return this.Do=!1,i}update(t=!0,e=!0){if(this.stage3D.enterFrame(),t&&this.Dk&&(0!=this.Dj&&this.runBegin(),this.Dj=1),this.Do=!0,this.Dp=!0,this.Dq=!0,null!=this.Df){let t=this.Df.getBegin();if(null!=t){let e,i,s;while(null!=t)t.entity.hasMesh()?(e=t,t=t.next,i=e.entity,s=e.rstatus,this.Df.removeNode(e),this.Dg.removeEntity(e.entity),this.addEntity(i,s)):t=t.next}}let i=0;for(;i<this.Dn;++i)this.Dm[i].update();this.w_.update(),null!=this.DY&&(this.DY.update(),this.Dp&&(null!=this.Dd||this.Fi||null!=this.DY.getRaySelector())&&this.DY.run()),this.Fi&&this.w_.updateAllProcess(),this.Do&&!this.Dc&&(e?this.runMouseTest(1,0):null!=this.Dd&&this.Dd.mouseOutEventTarget())}cullingTest(){null!=this.DY&&this.DY.run(),this.Dp=!1}mouseRayTest(){null!=this.DY&&(this.d.getMouseXYWorldRay(this.Da,this.DZ),this.DY.rayTest(this.Da,this.DZ))}run(t=!0){if(this.BA){if(t&&this.Dk&&(1!=this.Dj&&this.update(),this.Dj=2),this.runnableQueue.run(),this.Fh>0)for(let t=0;t<this.DX;++t)this.w_.runAt(this.DW[t]);else this.w_.run();t&&this.runEnd()}}runAt(t){this.BA&&this.w_.runAt(this.DW[t])}runEnd(){null!=this.Dd&&this.Dd.runEnd(),this.AV.runEnd(),null!=this.DY&&this.DY.runEnd(),this.Dk&&(this.Dj=-1),null!=this.Db&&this.Db.renderEnd(this)}renderFlush(){null!=this.d&&this.d.flush()}updateCamera(){null!=this.d&&this.d.updateCamera()}toString(){return"[RendererScene(uid = "+this.T+")]"}}T.H0=0,e.default=T},b30a:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("644c")),n=s(i("20ef"));class l{constructor(t,e,i){this.Fl=new Map,this.Fm=[],this.Fn=0,this.Fo=[],this.Fp=!0,this.Fq=!1,this.Fr=-1,this.Fs=null,this.E_h=1,this.A=-1,this.A7=null,this.Ft=null,this.AE=null,this.Fu=null,this.A_t=null,this.Fv=null,this.drawFlag=-1,this.__$globalUniform=null,this.A=t,this.AE=i,this.A7=e}createResByParams3(t,e,i,s){return!1}getRC(){return this.A7}getGPUProgram(){return this.Ft}getRCUid(){return this.A}useTransUniform(t){this.Fv!=t&&(this.Fv=t,t.use(this))}useUniform(t){this.A_t!=t&&(this.A_t=t,t.use(this))}updateUniform(t){null!=t&&t.use(this)}create(t){let e=t.getUniqueShaderName();if(this.Fl.has(e))return this.Fl.get(e);let i=new n.default(this.Fn);return i.setShdData(t),this.Fm[i.getUid()]=i,this.Fo[i.getUid()]=null,++this.Fn,this.Fl.set(e,i),r.default.SHADERCODE_TRACE_ENABLED,i}findShdProgramByUid(t){return this.Fm[t]}findShdProgram(t){return this.Fl.has(t)?this.Fl.get(t):null}findShdProgramByShdData(t){return null!=t&&this.Fl.has(t.getUniqueShaderName())?this.Fl.get(t.getUniqueShaderName()):null}unlock(){this.Fp=!0,this.__$globalUniform=null}isUnLocked(){return this.Fp}lock(){this.Fp=!1}textureUnlock(){this.Fq=!0}isTextureUnLocked(){return this.Fq}textureLock(){this.Fq=!1}setSharedUniformByShd(t,e){this.Fo[t.getUid()]=e}getSharedUniformByShd(t){return this.Fo[t.getUid()]}getCurrFragOutputTotal(){return this.E_h}hasResUid(t){return null!=this.Fm[t]}bindToGpu(t){if(this.Fp&&t>-1&&t<this.Fn)if(this.Fr!=t){this.Fr=t;let e=this.Fm[t];this.E_h=e.getFragOutputTotal(),this.E_h,this.getActiveAttachmentTotal(),this.Ft=e.getGPUProgram(),this.A7.useProgram(this.Ft),e.useTexLocation();let i=this.Fo[e.getUid()];this.Fu=i;while(null!=i)i.use(this),i=i.next;this.Fs=e}else if(null==this.Fu&&null!=this.Fs){let t=this.Fo[this.Fs.getUid()];this.Fu=t;while(null!=t)t.use(this),t=t.next}}getGpuBuffer(t){return null}getCurrentShd(){return this.Fs}getCurrentShdUid(){return this.Fr}resetUniform(){this.A_t=null,this.Fv=null,this.Fu=null}renderBegin(){this.E_h=1,this.Fr=-1,this.Fs=null,this.drawFlag=-1}update(){}destroy(){this.A7=null,this.AE=null}useUniformToCurrentShd(t){this.A_t!=t&&(this.A_t,t.useByShd(this,this.Fs))}useUniform2ToCurrentShd(t,e){this.A_t!=t&&(this.A_t,t.useByShd(this,this.Fs)),this.Fv!=e&&(this.Fv,e.useByShd(this,this.Fs))}useUniformMat4(t,e){this.A7.uniformMatrix4fv(t,!1,e)}useUniformV2(t,e,i,s,r){switch(e){case a.default.SHADER_MAT4:r<1?this.A7.uniformMatrix4fv(t,!1,i):this.A7.uniformMatrix4fv(t,!1,i,r,16*s);break;case a.default.SHADER_MAT3:this.A7.uniformMatrix3fv(t,!1,i,0,9*s);break;case a.default.SHADER_VEC4FV:this.A7.uniform4fv(t,i,r,4*s);break;case a.default.SHADER_VEC3FV:this.A7.uniform3fv(t,i,r,3*s);break;case a.default.SHADER_VEC4:this.A7.uniform4f(t,i[0],i[1],i[2],i[3]);break;case a.default.SHADER_VEC3:this.A7.uniform3f(t,i[0],i[1],i[2]);break;case a.default.SHADER_VEC2:this.A7.uniform2f(t,i[0],i[1]);break;default:break}}useUniformV1(t,e,i,s){switch(e){case a.default.SHADER_MAT4:this.A7.uniformMatrix4fv(t,!1,i);break;case a.default.SHADER_MAT3:this.A7.uniformMatrix3fv(t,!1,i);break;case a.default.SHADER_VEC4FV:this.A7.uniform4fv(t,i,4*s);break;case a.default.SHADER_VEC3FV:this.A7.uniform3fv(t,i,3*s);break;case a.default.SHADER_VEC4:this.A7.uniform4f(t,i[0],i[1],i[2],i[3]);break;case a.default.SHADER_VEC3:this.A7.uniform3f(t,i[0],i[1],i[2]);break;case a.default.SHADER_VEC2:this.A7.uniform2f(t,i[0],i[1]);break;default:break}}getActiveAttachmentTotal(){return this.AE.getActiveAttachmentTotal()}}e.default=l},b3bd:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.uns="",this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,i=e.length;for(let s=0;s<i;++s)if(t==e[s])return this.dataList[s]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let i=this.uniformNameList,s=i.length;for(let r=0;r<s;++r)if(t==i[r]){this.dataList[r]=e;break}}}copyDataFromProbe(t){this.types=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]);this.uniformSize=t.uniformsTotal}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.calcModels=null}}e.default=s},b409:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("b3bd")),a=s(i("0fc4")),n=i("839a");e.SpecularMode=n.SpecularMode;const l=i("319d");class h extends a.default{constructor(){super(),this.Fw=null,this.Fx=1,this.Fy=null,this.Fz=null,this.F0=1,this.F1=1,this.colorEnabled=!0,this.normalEnabled=!0,this.diffuseMap=null,this.normalMap=null,this.parallaxMap=null,this.aoMap=null,this.specularMap=null,this.specularMode=n.SpecularMode.Default,this.shadowReceiveEnabled=!1,this.lightEnabled=!0,this.fogEnabled=!1,this.vertColorEnabled=!1,this.envAmbientLightEnabled=!1,this.vertUniform=null,null==h.IL&&(h.IL=new l.AdvancedShaderCodeBuffer)}clone(){let t=new h;return t.initializeByCodeBuf(!1),t.copyFrom(this),t}copyFrom(t){this.AK=t.AK,this.colorEnabled=t.colorEnabled,this.lightEnabled=t.lightEnabled,this.shadowReceiveEnabled=t.shadowReceiveEnabled,this.fogEnabled=t.fogEnabled,this.normalEnabled=t.normalEnabled,this.vertColorEnabled=t.vertColorEnabled,this.envAmbientLightEnabled=t.envAmbientLightEnabled,this.vertUniform=t.vertUniform,null==this.diffuseMap&&(this.diffuseMap=t.diffuseMap),null==this.normalMap&&(this.normalMap=t.normalMap),null==this.parallaxMap&&(this.parallaxMap=t.parallaxMap),null==this.aoMap&&(this.aoMap=t.aoMap),null==this.specularMap&&(this.specularMap=t.specularMap),this.specularMode=t.specularMode,this.Fz=t.Fz.slice();let e=2;null!=this.parallaxMap&&(this.Fw=this.Fz.subarray(4*e,4*(e+1)),e+=1),this.lightEnabled&&(this.Fy=this.Fz.subarray(4*e)),this.F1=t.F1,this.Fx=t.Fx,this.F0=t.F0,this.AL=t.AL}buildTextureList(){let t=h.IL;t.setIRenderTextureList([]),t.addDiffuseMap(this.diffuseMap),t.addNormalMap(this.normalMap),t.addParallaxMap(this.parallaxMap,this.Fx),t.addAOMap(this.aoMap),t.addSpecularMap(this.specularMap);let e=t.getIRenderTextureList();return null!=this.vertUniform&&this.vertUniform.getTextures(t.getShaderCodeBuilder(),e),t.getTexturesFromPipeline(e),e}initializeLocalData(){if(null!=this.vertUniform&&this.vertUniform.initialize(),null==this.Fz){this.F0=2,null!=this.parallaxMap&&(this.F0+=1),this.lightEnabled&&(this.F0+=3),this.Fz=new Float32Array(4*this.F0),this.Fz.set([1,1,1,1,0,0,0,0]);let t=2;null!=this.parallaxMap&&(this.Fw=this.Fz.subarray(4*t,4*(t+1)),this.Fw.set([1,10,2,.1]),this.Fx=t,t+=1),this.lightEnabled&&(this.F1=t,this.Fy=this.Fz.subarray(4*t),this.Fy.set([.5,.5,.5,32,.7,.3,.3,.7,.01,.01,.01,0]))}}buildBuf(){null==this.Fz&&this.initializeLocalData();let t=h.IL;t.lightEnabled=this.lightEnabled,t.shadowReceiveEnabled=this.shadowReceiveEnabled,t.fogEnabled=this.fogEnabled,t.envAmbientLightEnabled=this.envAmbientLightEnabled,t.buildPipelineParams(),t.colorEnabled=this.colorEnabled,t.vertColorEnabled=this.vertColorEnabled,t.lightParamsIndex=this.F1,t.normalEnabled=this.normalEnabled,t.vertUniform=this.vertUniform,t.fragLocalParamsTotal=this.F0,t.buildFlag=""==this.AL;let e=this.buildTextureList();super.setTextureList(e),t.buildFlag=!1}getCodeBuf(){return h.IL}setSpecularColor(t){null!=this.Fy&&(this.Fy[0]=t.r,this.Fy[1]=t.g,this.Fy[2]=t.b)}setSpecularIntensity(t){null!=this.Fy&&(this.Fy[3]=t)}setLightBlendFactor(t,e){null!=this.Fy&&(this.Fy[4]=t,this.Fy[5]=e)}setBlendFactor(t,e){null!=this.Fy&&(this.Fy[6]=t,this.Fy[7]=e)}setAmbientFactor(t,e,i){null!=this.Fy&&(this.Fy[8]=t,this.Fy[9]=e,this.Fy[10]=i)}setParallaxParams(t=1,e=10,i=2,s=.1){null!=this.Fw&&(this.Fw[0]=t,this.Fw[1]=e,this.Fw[2]=i,this.Fw[3]=s)}setRGB3f(t,e,i){this.Fz[0]=t,this.Fz[1]=e,this.Fz[2]=i}setColor(t,e=null){null!=t&&(this.Fz[0]=t.r,this.Fz[1]=t.g,this.Fz[2]=t.b,this.Fz[3]=t.a),null!=e&&(this.Fz[4]=e.r,this.Fz[5]=e.g,this.Fz[6]=e.b,this.Fz[7]=e.a)}setColorAlpha(t){this.Fz[3]=t}createSelfUniformData(){let t=new r.default;return t.uniformNameList=["u_fragLocalParams"],t.dataList=[this.Fz],null!=this.vertUniform&&this.vertUniform.buildShaderUniformData(t),t}destroy(){super.destroy(),this.Fz=null,null!=this.vertUniform&&(this.vertUniform=null)}}h.IL=null,e.default=h,e.LambertLightMaterial=h},b498:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("18c7")),a=s(i("ab73")),n=s(i("7279")),l=s(i("3077")),h=i("5216"),o=i("c70f"),m=i("d846"),_=i("a9f4");class u{constructor(t=0){this.D_i=new o.GlobalVSMShadowUniformParam,this.D_j=null,this.D_k=null,this.F2=null,this.B2=null,this.F3=null,this.F4=null,this.F5=-1,this.D_l=!1,this.D_m=0,this.D_m=t}setShadowMap(t){this.F4=t}resetPipe(){}getTextures(t,e,i){return null!=this.F4?(null==e&&(e=[]),e.push(this.F4),t.uniform.addShadowMap(_.ShadowMode.VSM),e):null}useShaderPipe(t,e){null!=this.D_j&&(t.addDefine("VOX_USE_SHADOW","1"),t.addVarying("vec4","v_shadowPos"),this.D_i.use(t),t.addShaderObject(m.VSMShaderCode))}getPipeTypes(){return[h.MaterialPipeType.VSM_SHADOW]}getPipeKey(t){switch(t){case h.MaterialPipeType.VSM_SHADOW:return"["+t+"]";default:break}return""}initialize(){null==this.D_j&&(this.F2=new r.default,this.F3=new r.default,this.F3.identity(),this.F3.setScaleXYZ(.5,.5,.5),this.F3.setTranslationXYZ(.5,.5,.5),this.B2=new Float32Array([-5e-4,0,4,.8,512,512,.1,0,1,1,1,0]),this.D_j=new l.default,this.D_j.bindSlotAt(this.D_m),this.D_j.addMat4Data(this.F2.getLocalFS32(),1),this.D_j.addVec4Data(this.B2,a.default.ShadowVSMParams.arrayLength),this.D_k=this.D_i.createGlobalUinform(this.D_j),this.D_j.update())}getGlobalUinform(){return this.D_k.clone()}getGlobalUinformAt(t){let e=new n.default;return e.copyDataFromProbeAt(t,this.D_j),e}updateShadowCamera(t){this.F5!=t.version&&(this.F5=t.version,this.F2.copyFrom(t.getVPMatrix()),this.F2.append(this.F3),this.setDirec(t.getNV()),this.D_l=!0)}setShadowParam(t,e,i){this.B2[0]=t,this.B2[1]=e,this.B2[2]=i,this.D_l=!0}setShadowIntensity(t){this.B2[3]=t,this.D_l=!0}setColorIntensity(t){this.B2[6]=t,this.D_l=!0}setShadowRadius(t){this.B2[2]=t,this.D_l=!0}setShadowBias(t){this.B2[0]=t,this.D_l=!0}setShadowSize(t,e){this.B2[4]=t,this.B2[5]=e,this.D_l=!0}setDirec(t){this.B2[8]=-t.x,this.B2[9]=-t.y,this.B2[10]=-t.z,this.D_l=!0}update(){this.D_l&&null!=this.D_j&&(this.D_l=!1,this.D_j.update())}destroy(){this.F4=null}}e.default=u},b4ea:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=i("0714"),n=i("e753"),l=s(i("77cf")),h=s(i("e439")),o=s(i("6e01")),m=s(i("f63b")),_=i("8d98"),u=i("f3a2");e.ShaderCodeUUID=u.ShaderCodeUUID;const d=i("c052");e.ShaderCodeConfigure=d.ShaderCodeConfigure,e.ShaderCodeType=d.ShaderCodeType,e.IShaderLibConfigure=d.IShaderLibConfigure,e.IShaderLibListener=d.IShaderLibListener;class c{constructor(){this.pointLightsTotal=1,this.directionLightsTotal=1,this.spotLightsTotal=0,this.vsmFboIndex=0,this.vsmEnabled=!0,this.loadAllShaderCode=!1,this.shaderCodeBinary=!1,this.lambertMaterialEnabled=!0,this.pbrMaterialEnabled=!0,this.buildBinaryFile=!1}}e.MaterialContextParam=c;class f{constructor(){this.Ec=!0,this.F6=null,this.A8=null,this.lightModule=new n.LightModule,this.envData=new l.default,this.vsmModule=null,this.pipeline=null}addShaderLibListener(t){null!=f.ShaderLib&&f.ShaderLib.setListener(t)}getTextureLoader(){return this.F6}isTextureLoadedAll(){return this.F6.isLoadedAll()}getTextureByUrl(t,e=!0,i=!0){let s=null,r=t.slice(t.lastIndexOf(".")+1);switch(r=r.toLocaleLowerCase(),r){case"jpeg":case"jpg":case"png":case"gif":s=this.F6.getImageTexByUrl(t),s.mipmapEnabled=i,e&&s.setWrap(_.TextureConst.WRAP_REPEAT);break;default:break}return s}createShaderLibConfig(){return{shaderCodeConfigures:[]}}initialize(t,e=null,i=null){if(this.Ec){this.Ec=!1,this.A8=t,this.F6=new m.default(this.A8.textureBlock);let s=this;null==e&&(e=new c),this.E9=e,f.ShaderLib.initialize(i,e.shaderCodeBinary),e.loadAllShaderCode&&f.ShaderLib.addAllShaderCodeObject(),e.pointLightsTotal=o.default.Clamp(e.pointLightsTotal,0,256),e.directionLightsTotal=o.default.Clamp(e.directionLightsTotal,0,256),e.spotLightsTotal=o.default.Clamp(e.spotLightsTotal,0,256);for(let t=0;t<e.pointLightsTotal;++t)this.lightModule.appendPointLight();for(let t=0;t<e.directionLightsTotal;++t)this.lightModule.appendDirectionLight();for(let t=0;t<e.spotLightsTotal;++t)this.lightModule.appendSpotLight();if(this.lightModule.update(),s.envData=new l.default,this.envData.initialize(),this.envData.setFogColorRGB3f(0,.8,.1),e.vsmEnabled&&(s.vsmModule=new h.default(e.vsmFboIndex),this.vsmModule.setCameraPosition(new r.default(1,800,1)),this.vsmModule.setCameraNear(10),this.vsmModule.setCameraFar(3e3),this.vsmModule.setMapSize(512,512),this.vsmModule.setCameraViewSize(4e3,4e3),this.vsmModule.setShadowRadius(2),this.vsmModule.setShadowBias(-5e-4),this.vsmModule.initialize(t,[0],3e3),this.vsmModule.setShadowIntensity(.8),this.vsmModule.setColorIntensity(.3)),s.pipeline=this.createPipeline(),this.initEnd(e),!e.loadAllShaderCode){let t=f.ShaderLib.getListener();null!=t&&t.shaderLibLoadComplete(0,0)}}}initEnd(t){}addShaderCodeObject(t,e){f.ShaderLib.addShaderCodeObject(t,e)}addPipeline(t){null!=t&&t!=this.pipeline&&(t.addPipe(this.lightModule),t.addPipe(this.envData),null!=this.vsmModule&&t.addPipe(this.vsmModule.getVSMData()))}createPipeline(){let t=new a.MaterialPipeline(f.ShaderLib);return t.addPipe(this.lightModule),t.addPipe(this.envData),null!=this.vsmModule&&t.addPipe(this.vsmModule.getVSMData()),t}run(){null!=this.vsmModule&&this.E9.vsmEnabled&&this.vsmModule.run()}destroy(){this.A8=null}}f.ShaderLib=new d.ShaderLib,e.MaterialContext=f},b88e:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("eebe");document.title="Vox APP";let r=new s.RbtDrama,a=r;if(void 0!=a.runBegin){function n(){function t(e){a.runBegin(),a.run(),a.runEnd(),window.requestAnimationFrame(t)}a.initialize(),window.requestAnimationFrame(t)}n()}else{function l(){function t(e){r.run(),window.requestAnimationFrame(t)}r.initialize(),window.requestAnimationFrame(t)}l()}},b8ff:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("402a")),a=s(i("f63e")),n=s(i("f152")),l=s(i("29ef"));class h extends r.default{constructor(t=null){super(t),this.doubleTriFaceEnabled=!1,this.wireframe=!1,this.inverseUV=!1,this.B_y=50,this.F7=10,this.F8=10}showBackFace(){this.setRenderState(l.default.NORMAL_STATE)}showFrontFace(){this.setRenderState(l.default.FRONT_CULLFACE_NORMAL_STATE)}showDoubleFace(t=!1,e=!0){t?e?this.setRenderState(l.default.NONE_CULLFACE_NORMAL_ALWAYS_STATE):this.setRenderState(l.default.BACK_NORMAL_ALWAYS_STATE):e?this.setRenderState(l.default.NONE_CULLFACE_NORMAL_STATE):this.setRenderState(l.default.NORMAL_STATE)}toTransparentBlend(t=!1,e=!1){t?e?this.setRenderState(l.default.NONE_TRANSPARENT_ALWAYS_STATE):this.setRenderState(l.default.BACK_TRANSPARENT_ALWAYS_STATE):e?this.setRenderState(l.default.NONE_TRANSPARENT_STATE):this.setRenderState(l.default.BACK_TRANSPARENT_STATE)}toBrightnessBlend(t=!1,e=!1){t?e?this.setRenderState(l.default.NONE_ADD_ALWAYS_STATE):this.setRenderState(l.default.BACK_ADD_ALWAYS_STATE):e?this.setRenderState(l.default.NONE_ADD_BLENDSORT_STATE):this.setRenderState(l.default.BACK_ADD_BLENDSORT_STATE)}createMaterial(t){if(null==this.getMaterial()){let e=new a.default;e.setTextureList(t),this.setMaterial(e)}else null!=t&&this.getMaterial().setTextureList(t)}initializeFrom(t,e=null){this.copyMeshFrom(t),this.copyMaterialFrom(t),this.createMaterial(e),this.activeDisplay()}initialize(t,e,i,s=null){this.B_y=t,this.F7=e,this.F8=i,this.createMaterial(s),this.activeDisplay()}__activeMesh(t){if(null==this.getMesh()){let e=new n.default;e.wireframe=this.wireframe,e.inverseUV=this.inverseUV,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.B_y,this.F7,this.F8,this.doubleTriFaceEnabled),this.setMesh(e)}}toString(){return"[Sphere3DEntity(uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")]"}}e.default=h},b9b5:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("9c3c")),a=s(i("402a")),n=s(i("3930")),l=s(i("32cc")),h=s(i("8e17"));class o extends a.default{constructor(){super(),this.rayTestRadius=8,this.colorX=new n.default(1,0,0,1),this.colorY=new n.default(0,1,0,1),this.colorZ=new n.default(0,0,1,1),this.F9=[0,0,0,100,0,0,0,0,0,0,100,0,0,0,0,0,0,100]}setLineWidth(t){}createMaterial(){if(null==this.getMaterial()){let t=new l.default;this.setMaterial(t)}}__activeMesh(t){if(null==this.getMesh()){let e=[this.colorX.r,this.colorX.g,this.colorX.b,this.colorX.r,this.colorX.g,this.colorX.b,this.colorY.r,this.colorY.g,this.colorY.b,this.colorY.r,this.colorY.g,this.colorY.b,this.colorZ.r,this.colorZ.g,this.colorZ.b,this.colorZ.r,this.colorZ.g,this.colorZ.b],i=new r.default;i.rayTestRadius=this.rayTestRadius,i.vbWholeDataEnabled=!1,i.setBufSortFormat(t.getBufSortFormat()),i.initialize(this.F9,e),this.setMesh(i)}}initialize(t=100){t<2&&(t=2),this.F9[3]=t,this.F9[10]=t,this.F9[17]=t,this.createMaterial(),this.activeDisplay()}initializeSizeXYZ(t,e,i){this.F9[3]=t,this.F9[10]=e,this.F9[17]=i,this.createMaterial(),this.activeDisplay()}initializeCorssSizeXYZ(t,e,i){t*=.5,e*=.5,i*=.5,this.F9[0]=-t,this.F9[7]=-e,this.F9[14]=-i,this.F9[3]=t,this.F9[10]=e,this.F9[17]=i,this.createMaterial(),this.activeDisplay()}initializeCross(t=100,e=null){t<2&&(t=2),t*=.5,null==e&&(e=new h.default),this.F9[0]=-t+e.x,this.F9[7]=-t+e.y,this.F9[14]=-t+e.z,this.F9[3]=t+e.x,this.F9[10]=t+e.y,this.F9[17]=t+e.z,this.createMaterial(),this.activeDisplay()}toString(){return"Axis3DEntity(name="+this.name+",uid = "+this.getUid()+", rseFlag = "+this.__$rseFlag+")"}}e.default=o},baae:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.FRAMEBUFFER=71,s.DRAW_FRAMEBUFFER=72,s.READ_FRAMEBUFFER=73,e.default=s},badb:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("1710")),a=s(i("ee5a"));class n{constructor(){this.F_A=null,this.F_B=18,this.uuid="",this.data=null,this.F_B=r.default.GetMouseEvtTypeValuesTotal(),this.F_A=new Array(this.F_B)}getClassType(){return r.default.EventClassType}destroy(){for(let t=0;t<this.F_B;++t)null!=this.F_A[t]&&this.F_A[t].destroy()}dispatchEvt(t){if(null!=t){""!=this.uuid&&(t.uuid=this.uuid),null!=this.data&&(t.data=this.data);let e=t.type-r.default.GetMouseEvtTypeValueBase();if(e>=0&&e<r.default.GetMouseEvtTypeValuesTotal()&&null!=this.F_A[e])return this.F_A[e].dispatch(t)}return 0}passTestEvt(t){if(null!=t){let e=t.type-r.default.GetMouseEvtTypeValueBase();if(e>=0&&e<r.default.GetMouseEvtTypeValuesTotal())return this.F_A[e].passTestEvt(t)}return 0}passTestPhase(t){let e=r.default.GetMouseEvtTypeValuesTotal();for(let i=0;i<e;++i)if(null!=this.F_A[i]&&1==this.F_A[i].passTestPhase(t))return 1;return 0}addEventListener(t,e,i,s=!0,n=!1){if(null!=i&&null!=e){let l=t-r.default.GetMouseEvtTypeValueBase();if(l>=0&&l<r.default.GetMouseEvtTypeValuesTotal()){let t=0;s!=n&&(t=s?1:2),null!=this.F_A[l]||(this.F_A[l]=new a.default),this.F_A[l].addListener(e,i,t)}}}removeEventListener(t,e,i){if(null!=i&&null!=e){let s=t-r.default.GetMouseEvtTypeValueBase();s>=0&&s<r.default.GetMouseEvtTypeValuesTotal()&&null!=this.F_A[s]&&this.F_A[s].removeListener(e,i)}}}e.default=n},bbf4:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.CAMERA_VISIBLE_ENABLE=0,s.CAMERA_VISIBLE_DISABLE=1,e.default=s},bcac:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17"));class a{constructor(){this.A_9=null,this.A_=null,this.AB=0,this.AC=0,this.BA=!1,this.F_C=0,this.F_D=100,this.autoRotationEnabled=!1,this.autoRotationSpeed=.2,this.rotationAttenuationEnabled=!1,this.rotationSpeed=.2}initialize(t,e){null==this.A_9&&(this.A_9=t,this.A_=e)}attach(){this.AB=this.A_9.mouseX,this.AC=this.A_9.mouseY,this.BA=!0,this.F_D=100}detach(){this.BA=!1}runWithYAxis(){if(this.BA){let t=this.AB-this.A_9.mouseX,e=this.AC-this.A_9.mouseY,i=Math.abs(t),s=Math.abs(e);i>s?(this.F_C=t*this.rotationSpeed,i>.5&&this.A_.swingHorizontalWithAxis(this.F_C,r.default.Y_AXIS)):(this.F_C=0,s>.5&&this.A_.swingVertical(-e*this.rotationSpeed)),this.AB=this.A_9.mouseX,this.AC=this.A_9.mouseY}else this.autoRotationEnabled&&(this.F_D<0?this.A_.swingHorizontalWithAxis(this.autoRotationSpeed,r.default.Y_AXIS):this.F_D--)}runWithZAxis(){if(this.BA){let t=this.AB-this.A_9.mouseX,e=this.AC-this.A_9.mouseY,i=Math.abs(t),s=Math.abs(e);i>s?i>.5&&this.A_.swingHorizontalWithAxis(.2*t,r.default.Z_AXIS):s>.5&&this.A_.swingVertical(-.2*e),this.AB=this.A_9.mouseX,this.AC=this.A_9.mouseY}else this.autoRotationEnabled&&(this.F_D<0?this.A_.swingHorizontalWithAxis(this.autoRotationSpeed,r.default.Z_AXIS):this.F_D--)}}e.CameraDragSwinger=a},bd6f:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("29ef")),a=s(i("402a")),n=s(i("f63e")),l=s(i("a254")),h=s(i("76b0")),o=s(i("3930"));class m extends a.default{constructor(t=null){super(t),this.F_E=0,this.F_F=0,this.F_G=0,this.F_H=0,this.C_0=0,this.F_I=!1,this.color0=new o.default,this.color1=new o.default,this.color2=new o.default,this.color3=new o.default,this.D_h=!0,this.offsetU=0,this.offsetV=0,this.uScale=1,this.vScale=1,this.wireframe=!1,this.uvs=null,this.flipVerticalUV=!1,this.vertColorEnabled=!1,this.premultiplyAlpha=!1}setPolyhedral(t){this.D_h=t;let e=this.getMesh();null!=e&&e.setPolyhedral(t)}setScreenAlignEnable(t){this.F_I=t}createMaterial(t){if(null==this.getMaterial())if(this.F_I){let e=new l.default;e.setTextureList(t),this.setMaterial(e)}else{let e=new n.default;e.vertColorEnabled=this.vertColorEnabled,e.premultiplyAlpha=this.premultiplyAlpha,e.setTextureList(t),this.setMaterial(e)}else null!=t&&this.getMaterial().getTextureTotal()<1&&this.getMaterial().setTextureList(t)}showDoubleFace(t=!1,e=!0){t?e?this.setRenderState(r.default.NONE_CULLFACE_NORMAL_ALWAYS_STATE):this.setRenderState(r.default.BACK_NORMAL_ALWAYS_STATE):e?this.setRenderState(r.default.NONE_CULLFACE_NORMAL_STATE):this.setRenderState(r.default.NORMAL_STATE)}toTransparentBlend(t=!1,e=!1){t?e?this.setRenderState(r.default.NONE_TRANSPARENT_ALWAYS_STATE):this.setRenderState(r.default.BACK_TRANSPARENT_ALWAYS_STATE):e?this.setRenderState(r.default.NONE_TRANSPARENT_STATE):this.setRenderState(r.default.BACK_TRANSPARENT_STATE)}toBrightnessBlend(t=!1,e=!1){t?e?this.setRenderState(r.default.NONE_ADD_ALWAYS_STATE):this.setRenderState(r.default.BACK_ADD_ALWAYS_STATE):e?this.setRenderState(r.default.NONE_ADD_BLENDSORT_STATE):this.setRenderState(r.default.BACK_ADD_BLENDSORT_STATE)}initializeFixScreen(t=null){this.initializeXOY(-1,-1,2,2,t)}initializeXOY(t,e,i,s,r=null){this.F_E=t,this.F_F=e,this.F_G=i,this.F_H=s,this.C_0=0,this.createMaterial(r),this.activeDisplay()}initializeXOYSquare(t,e=null){this.F_E=-.5*t,this.F_F=-.5*t,this.F_G=t,this.F_H=t,this.C_0=0,this.createMaterial(e),this.activeDisplay()}initializeXOZ(t,e,i,s,r=null){this.C_0=1,this.F_E=t,this.F_F=e,this.F_G=i,this.F_H=s,this.createMaterial(r),this.activeDisplay()}initializeYOZ(t,e,i,s,r=null){this.C_0=2,this.F_E=t,this.F_F=e,this.F_G=i,this.F_H=s,this.createMaterial(r),this.activeDisplay()}initializeXOZSquare(t,e=null){this.C_0=1,this.F_E=-.5*t,this.F_F=-.5*t,this.F_G=t,this.F_H=t,this.createMaterial(e),this.activeDisplay()}__activeMesh(t){if(null==this.getMesh()){let e=new h.default;e.color0.copyFrom(this.color0),e.color1.copyFrom(this.color1),e.color2.copyFrom(this.color2),e.color3.copyFrom(this.color3),e.setPolyhedral(this.D_h),e.setUVS(this.uvs),this.uvs=null,e.uScale=this.uScale,e.vScale=this.vScale,e.offsetU=this.offsetU,e.offsetV=this.offsetV,e.wireframe=this.wireframe,e.flipVerticalUV=this.flipVerticalUV,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.axisFlag=this.C_0,e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.F_E,this.F_F,this.F_G,this.F_H),this.setMesh(e)}}setUVS(t){let e=this.getMesh();null!=e&&e.setUVS(t)}reinitializeMesh(){let t=this.getMesh();null!=t&&t.reinitialize()}toString(){return"[Plane3DEntity]"}}e.default=m},c052:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("f3a2"),r=i("cc55"),a=i("69ed");e.ShaderCodeType=a.ShaderCodeType;const n=i("28a9");e.ShaderCodeConfigure=n.ShaderCodeConfigure;const l=i("a221");e.IShaderLibConfigure=l.IShaderLibConfigure;const h=i("ca2f");class o{constructor(){this.F_J=new Map,this.F_K=[]}addConfigureWithUUID(t,e){""==t||this.F_J.has(t)||(this.F_J.set(t,e),this.F_K.push(t))}getConfigureWithUUID(t){return this.F_J.get(t)}getUUIDList(){return this.F_K}getUUIDListLength(){return this.F_K.length}}class m{constructor(t){this.F_L=0,this.F_M=new r.ShaderCodeObject,this.F_N=null,this.F_N=t}decodeUint8Arr(t){return new TextDecoder("utf-8").decode(t)}encodeUint8Arr(t){return(new TextEncoder).encode(t)}loadedShdCode(t,e,i){if(this.F_L++,this.F_N.buildBinaryFile&&!this.F_N.binary){let i=this.encodeUint8Arr(t);for(let t=0;t<i.length;++t)i[t]=222-i[t];m.IM.downloadBinFile(i,e+"","bin")}switch(e){case a.ShaderCodeType.VertHead:this.F_M.vert_head=t;break;case a.ShaderCodeType.VertBody:this.F_M.vert_body=t;break;case a.ShaderCodeType.FragHead:this.F_M.frag_head=t;break;case a.ShaderCodeType.FragBody:this.F_M.frag_body=t;break;default:break}this.F_L==this.F_N.types.length&&(i(this.F_N.uuid,this.F_M),this.F_M=null,this.F_N=null)}async loadBinCode(t,e,i){const s=new FileReader;s.onload=t=>{let r=new Uint8Array(s.result);for(let e=0;e<r.length;++e)r[e]=222-r[e];this.loadedShdCode(this.decodeUint8Arr(r),e,i)};const r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="blob",r.onload=t=>{r.status<=206&&s.readAsArrayBuffer(r.response)},r.onerror=t=>{},r.send()}loadTextCode(t,e,i){let s=new XMLHttpRequest;s.open("GET",t,!0),s.onload=()=>{s.status<=206&&this.loadedShdCode(s.responseText,e,i)},s.onerror=t=>{},s.send()}loadCode(t,e,i){this.F_N.binary?this.loadBinCode(t,e,i):this.loadTextCode(t,e,i)}load(t){if(this.F_L=0,null==this.F_N.urls){let e=this.F_N.binary?".bin":".glsl";for(let i=0;i<this.F_N.types.length;++i){let s="static/shader/glsl/"+this.F_N.uuid+"/"+this.F_N.types[i]+e;this.loadCode(s,this.F_N.types[i],t)}}else for(let e=0;e<this.F_N.urls.length;++e){let i=this.F_N.urls[e];this.loadCode(i,this.F_N.types[e],t)}}}m.IM=new h.FileIO;class _{constructor(){this.F_L=0,this.F_O=0,this.F_P=new Map,this.F_Q=new Map,this.F_R=null,this.F_S=null}setListener(t){this.F_S=t}getListener(){return this.F_S}initialize(t=null,e=!1){if(null==this.F_R){let i;this.F_R=new o;let r=null;if(null!=t&&(r=t.shaderCodeConfigures),null!=r)for(let t=0;t<r.length;++t)i=r[t],null!=i&&this.F_R.addConfigureWithUUID(i.uuid,i);else i=new n.ShaderCodeConfigure,i.uuid=s.ShaderCodeUUID.PBR,i.types=[a.ShaderCodeType.VertHead,a.ShaderCodeType.VertBody,a.ShaderCodeType.FragHead,a.ShaderCodeType.FragBody],i.binary=e,this.F_R.addConfigureWithUUID(i.uuid,i)}}addAllShaderCodeObject(){if(this.F_R.getUUIDListLength()>0){let t=this.F_R.getUUIDList();for(let e=0;e<t.length;++e)this.addShaderCodeObjectWithUUID(t[e])}else null!=this.F_S&&this.F_S.shaderLibLoadComplete(0,0)}addShaderCodeObjectWithUUID(t){if(!this.F_Q.has(t)&&!this.F_P.has(t)){this.F_L++;let e=new m(this.F_R.getConfigureWithUUID(t));e.load((t,e)=>{this.F_Q.set(t,e),this.F_O++,null!=this.F_S&&this.F_S.shaderLibLoadComplete(this.F_L,this.F_O)})}}addShaderCodeObject(t,e){null==e||e.uuid!=""+t||this.F_Q.has(t)||this.F_Q.set(t,e)}getShaderCodeObjectWithUUID(t){let e=null;return this.F_Q.has(t)&&(e=this.F_Q.get(t)),e}}e.ShaderLib=_},c06a:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("ae33")),n=s(i("54de")),l=s(i("9951")),h=s(i("402a"));class o{constructor(t=null){this.At=null,this.BI=null,this.F_T=null,this.BF=new r.default,this.F_U=null,this.F_V=null,this.F_W=0,this.materialBuilder=null,this.degreeTween=new n.default,this.BI=null==t?new a.default:t}getContainer(){return this.BI}setAttackDst(t){}setVisible(t){this.BI.setVisible(t)}getVisible(){return this.BI.getVisible()}setRotationY(t){this.BI.setRotationY(t)}getRotationY(){return this.BI.getRotationY()}direcByDegree(t,e){this.F_W+=.75,this.F_V.setCurveMoveDistance(this.F_W),null!=this.F_T&&this.F_T.moveDistanceOffset(.75),this.degreeTween.runRotY(t),this.degreeTween.isDegreeChanged()&&this.BI.update()}direcByPos(t,e){this.degreeTween.runRotYByDstPos(t),this.degreeTween.isDegreeChanged()&&this.BI.update()}setDstDirecDegree(t){}isPoseRunning(){return!1}initialize(t,e,i,s,r,a=null){if(null==this.At){let i;this.At=t,t.addContainer(this.BI,e),s.getPosition(this.BF),this.BF.addBy(a);let r=this.materialBuilder.createTrackLambertMaterial(s,l.default.GetImageTexByUrl("static/assets/metal_02.jpg"));this.F_V=r.vertUniform,i=r,this.F_U=new h.default,this.F_U.setMaterial(i),this.F_U.copyMeshFrom(s.animator),this.F_U.setPosition(this.BF),this.BI.addEntity(this.F_U),this.degreeTween.bindTarget(this.BI)}}setXYZ(t,e,i){this.BI.setXYZ(t,e,i)}setPosition(t){this.BI.setPosition(t)}getPosition(t){this.BI.getPosition(t)}resetPose(){}resetNextOriginPose(){}run(t){this.BI.update()}isResetFinish(){return!0}runToReset(){this.BI.update()}}e.default=o},c120:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17"));class a{constructor(){this.entity=null,this.lpv=new r.default,this.wpv=new r.default,this.dis=0,this.flag=0}}e.default=a},c164:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){}}s.BasePredefined="\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n",s.FragPredefined="\n",s.FragDefined="\n",s.VertPredefined="\n",s.VertDefined="\nvec4 localPosition = vec4(0.0,0.0,0.0,1.0);\nvec4 worldPosition = vec4(0.0,0.0,0.0,1.0);\n// view space position\nvec4 viewPosition = vec4(0.0,0.0,0.0,1.0);\n",e.MathShaderCode=s;class r{constructor(){}}r.BasePredefined="\nvec4 localPosition = vec4(0.0,0.0,0.0,1.0);\nvec4 worldPosition = vec4(0.0,0.0,0.0,1.0);\n// view space position\nvec4 viewPosition = vec4(0.0,0.0,0.0,1.0);\nvec3 worldNormal = vec3(0.0, 0.0, 1.0);\n",r.FragPredefined="\n",r.FragDefined="\n",r.VertPredefined="\n",r.VertDefined="\n",e.ShaderCode=r},c217:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.F_X=0}getBrnAlphaStatus(){return this.F_X}setBrightnessAndAlpha(t,e){this.F_X=10*Number(t)+Number(e)}getBrnAndAlphaCode(){let t;return t=11==this.F_X?"\ncolor.rgb = color.rgb * v_colorMult.xyz + color.aaa * offsetColor;\ncolor *= FADE_VAR.zzzz;\n":10==this.F_X?"\ncolor.rgb = min(color.rgb * v_colorMult.xyz + color.rgb * offsetColor, vec3(1.0));\ncolor.rgb *= FADE_VAR.zzz;\n":1==this.F_X?"\ncolor.rgb = color.rgb * v_colorMult.xyz + color.aaa * offsetColor;\ncolor.a *= FADE_VAR.z;\n":"\ncolor.rgb = color.rgb * v_colorMult.xyz + offsetColor;\ncolor.a *= FADE_VAR.z;\n",t}getMixThreeColorsCode(){let t="\nvec4 mixThreeColors(vec4 color0,vec4 color1,vec4 color2,float t)\n{\n    float k0 = max(1.0 - 2.0 * t, 0.0);\n    float k = max(t - 0.5, 0.0);\n    float k1 = (1.0 - (2.0 * k)) * step(-0.00001,k);\n    k = step(0.00001,k0);\n    return mix(mix(color2,color1,k1), mix(color1,color0,k0), k);\n}\n";return t}getOffsetColorCode(t,e=!1){let i;return i=t?e?"\nvec3 offsetColor = clamp(v_colorOffset.xyz + texture(VOX_OFFSET_COLOR_MAP, v_uv.xy).xyz,vec3(0.0),vec3(1.0));\n":"\nvec3 offsetColor = clamp(v_colorOffset.xyz + texture(VOX_OFFSET_COLOR_MAP, v_texUV.xy).xyz,vec3(0.0),vec3(1.0));\n":"\nvec3 offsetColor = v_colorOffset.xyz;\n",i}}e.default=s},c497:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17"));class a{constructor(t=null){this.F_Y=8192,this.F_Z=null,this.F_a={depth:!0,premultipliedAlpha:!1,alpha:!0,antialias:!1,stencil:!1,preserveDrawingBuffer:!0,powerPreference:"high-performance"},this.F_b=20,this.F_c=!1,this.F_d=!1,this.autoSyncRenderBufferAndWindowSize=!0,this.maxWebGLVersion=2,this.cameraPerspectiveEnabled=!0,this.evtFlowEnabled=!1,this.camProjParam=new r.default(45,10,5e3),this.camPosition=new r.default(2e3,2e3,2e3),this.camLookAtPos=new r.default(0,0,0),this.camUpDirect=new r.default(0,1,0),this.batchEnabled=!0,this.processFixedState=!1,this.F_Z=t,this.autoSyncRenderBufferAndWindowSize=null==t}setTickUpdateTime(t){t=Math.round(t),this.F_b=t>5?t:5}getTickUpdateTime(){return this.F_b}setPolygonOffsetEanbled(t){this.F_c=t}getPolygonOffsetEanbled(){return this.F_c}setDitherEanbled(t){this.F_d=t}getDitherEanbled(){return this.F_d}getDiv(){return this.F_Z}getRenderContextAttri(){return this.F_a}setAttriDepth(t){this.F_a.depth=t}setAttriStencil(t){this.F_a.stencil=t}setAttriAlpha(t){this.F_a.alpha=t}setAttriPremultipliedAlpha(t){this.F_a.premultipliedAlpha=t}setAttriAntialias(t){this.F_a.antialias=t}setAttripreserveDrawingBuffer(t){this.F_a.preserveDrawingBuffer=t}setAttriHightPowerPreference(t){this.F_a.powerPreference=t?"high-performance":"default"}setMatrix4AllocateSize(t){t<1024&&(t=1024),this.F_Y=t}getMatrix4AllocateSize(){return this.F_Y}setCamProject(t,e,i){if(e>=i)throw Error("Error Camera cear > far !!!");this.camProjParam.setTo(t,e,i)}setCamPosition(t,e,i){this.camPosition.setTo(t,e,i)}setCamLookAtPos(t,e,i){this.camLookAtPos.setTo(t,e,i)}setCamUpDirect(t,e,i){this.camUpDirect.setTo(t,e,i)}}e.default=a},c51d:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("8e17")),n=s(i("18c7")),l=s(i("e214")),h=s(i("fecb"));class o{constructor(){this.version=0,this.matUProbe=null,this.ufrustumProbe=null,this.uniformEnabled=!1,this.name="Camera",this.BG=new a.default,this.F_e=new a.default,this.F_f=new a.default,this.F_g=new a.default,this.F_h=!0,this.F_i=new n.default,this.F_j=new n.default,this.F_k=new n.default,this.F_l=new n.default,this.F_m=new n.default,this.F_n=new n.default,this.F_o=new a.default,this.F_p=new a.default,this.F_q=new a.default,this.F_r=new a.default,this.F_s=new a.default,this.F_t=1,this.F_u=1,this.B=0,this.C=0,this.D=800,this.E=600,this.F_v=400,this.F_w=300,this.F_x=0,this.F_y=1,this.F_z=.1,this.F_0=1e3,this.F_1=0,this.F_2=0,this.F_3=0,this.F_4=0,this.Dh=!1,this.F_5=!1,this.F_6=!0,this.F_7=new a.default(0,0,0),this.F_8=1,this.F_9=!0,this.F_=!0,this.GA=new a.default,this.GB=new a.default,this.GC=new a.default,this.GD=new a.default,this.GE=new a.default,this.GF=0,this.GG=new a.default,this.GH=null,this.GI=!1,this.GJ=new h.default,this.GK=null,this.GL=.5,this.GM=.5,this.GN=new a.default,this.GO=new a.default,this.GP=new a.default,this.GQ=[new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,new a.default,null,null,null],this.GR=[new l.default,new l.default,new l.default,new l.default,new l.default,new l.default],this.GS=[new a.default,new a.default,new a.default,new a.default,new a.default,new a.default],this.GT=[0,0,0,0,0,0],this.GU=null}lock(){this.F_=!1}unlock(){this.F_=!0}lookAtLH(t,e,i){this.F_&&(this.F_o.copyFrom(t),this.F_p.copyFrom(e),this.F_q.copyFrom(i),this.F_s.x=this.F_p.x-this.F_o.x,this.F_s.y=this.F_p.y-this.F_o.y,this.F_s.z=this.F_p.z-this.F_o.z,this.F_h=!1,this.F_r.copyFrom(this.F_s),this.F_r.normalize(),this.F_g.copyFrom(i),this.F_g.normalize(),a.default.Cross(this.F_s,this.F_q,this.F_f),this.F_f.normalize(),this.F_9=!0)}lookAtRH(t,e,i){this.F_&&(this.F_o.copyFrom(t),this.F_p.copyFrom(e),this.F_s.x=this.F_p.x-this.F_o.x,this.F_s.y=this.F_p.y-this.F_o.y,this.F_s.z=this.F_p.z-this.F_o.z,this.F_h=!0,this.F_r.copyFrom(this.F_s),this.F_r.normalize(),a.default.Cross(this.F_s,i,this.F_f),a.default.Cross(this.F_f,this.F_s,this.F_g),this.F_g.normalize(),this.F_f.normalize(),this.F_q.copyFrom(this.F_g),this.F_9=!0)}getLookAtLHToCamera(t){t.lookAtLH(this.F_o,this.F_p,this.F_q)}getLookAtRHToCamera(t){t.lookAtRH(this.F_o,this.F_p,this.F_q)}perspectiveLH(t,e,i,s){this.F_&&(this.F_5=!1,this.F_y=e,this.F_x=t,this.F_z=i,this.F_0=s,this.F_n.perspectiveLH(t,e,i,s),this.F_8=Math.tan(.5*t),this.Dh=!0,this.F_6=!1,this.F_9=!0)}perspectiveRH(t,e,i,s){this.F_&&(this.F_y=e,this.F_x=t,this.F_z=i,this.F_0=s,this.F_n.perspectiveRH(t,e,i,s),this.F_8=Math.tan(.5*t),this.F_5=!1,this.Dh=!0,this.F_6=!0,this.F_9=!0)}perspectiveRH2(t,e,i,s,r){this.F_&&(this.F_y=e/i,this.F_x=t,this.F_z=s,this.F_0=r,this.F_n.perspectiveRH2(t,e,i,s,r),this.F_8=Math.tan(.5*t),this.Dh=!0,this.F_5=!0,this.F_6=!0,this.F_9=!0)}getAspect(){return this.F_y}getViewFieldZoom(){return this.F_8}orthoRH(t,e,i,s,r,a){this.F_&&(this.F_z=t,this.F_0=e,this.F_1=i,this.F_2=s,this.F_3=r,this.F_4=a,this.F_n.orthoRH(i,s,r,a,t,e),this.Dh=!1,this.F_6=!0,this.F_9=!0)}orthoLH(t,e,i,s,r,a){this.F_&&(this.F_z=t,this.F_0=e,this.F_1=i,this.F_2=s,this.F_3=r,this.F_4=a,this.F_n.orthoLH(i,s,r,a,t,e),this.Dh=!1,this.F_6=!1,this.F_9=!0)}isPerspectiveEnabled(){return this.Dh}isRightHandEnabled(){return this.F_6}setViewXY(t,e){this.F_&&(this.B=t,this.C=e)}setViewSize(t,e){this.F_&&(t==this.D&&e==this.E||(this.D=t,this.E=e,this.F_v=.5*t,this.F_w=.5*e,this.Dh?this.F_5?this.F_6&&this.perspectiveRH2(this.F_x,t,e,this.F_z,this.F_0):this.F_6?this.perspectiveRH(this.F_x,t/e,this.F_z,this.F_0):this.perspectiveLH(this.F_x,t/e,this.F_z,this.F_0):this.orthoRH(this.F_z,this.F_0,-.5*e,.5*e,-.5*t,.5*t)))}getViewX(){return this.B}getViewY(){return this.C}getViewWidth(){return this.D}getViewHeight(){return this.E}translation(t){this.F_&&(this.F_o.copyFrom(t),this.F_p.x=t.x+this.F_s.x,this.F_p.y=t.y+this.F_s.y,this.F_p.z=t.z+this.F_s.z,this.F_9=!0)}translationXYZ(t,e,i){this.BG.setXYZ(t,e,i),this.F_&&a.default.DistanceSquared(this.F_o,this.BG)>1e-5&&(this.F_o.setTo(t,e,i),this.F_p.x=t+this.F_s.x,this.F_p.y=e+this.F_s.y,this.F_p.z=i+this.F_s.z,this.F_9=!0)}forward(t){this.F_&&(this.F_o.x+=this.F_r.x*t,this.F_o.y+=this.F_r.y*t,this.F_o.z+=this.F_r.z*t,this.F_p.x=this.F_o.x+this.F_s.x,this.F_p.y=this.F_o.y+this.F_s.y,this.F_p.z=this.F_o.z+this.F_s.z,this.F_9=!0)}slideViewOffsetXY(t,e){if(this.F_){this.BG.setXYZ(t,e,0),this.GK.transformVectorSelf(this.BG),t=this.BG.x-this.F_o.x,e=this.BG.y-this.F_o.y;let i=this.BG.z-this.F_o.z;this.F_o.x+=t,this.F_o.y+=e,this.F_o.z+=i,this.F_p.x+=t,this.F_p.y+=e,this.F_p.z+=i,this.F_9=!0}}forwardFixPos(t,e){this.F_&&(this.F_o.x=e.x+this.F_r.x*t,this.F_o.y=e.y+this.F_r.y*t,this.F_o.z=e.z+this.F_r.z*t,this.F_p.x=this.F_o.x+this.F_s.x,this.F_p.y=this.F_o.y+this.F_s.y,this.F_p.z=this.F_o.z+this.F_s.z,this.F_9=!0)}swingHorizontalWithAxis(t,e){this.F_&&(this.F_m.identity(),null!=e?this.F_m.appendRotation(t*r.default.MATH_PI_OVER_180,e):this.F_m.appendRotation(t*r.default.MATH_PI_OVER_180,a.default.Y_AXIS),this.F_s.x=this.F_o.x-this.F_p.x,this.F_s.y=this.F_o.y-this.F_p.y,this.F_s.z=this.F_o.z-this.F_p.z,this.F_m.transformVectorSelf(this.F_s),this.F_o.x=this.F_s.x+this.F_p.x,this.F_o.y=this.F_s.y+this.F_p.y,this.F_o.z=this.F_s.z+this.F_p.z,this.F_s.x=this.F_p.x-this.F_o.x,this.F_s.y=this.F_p.y-this.F_o.y,this.F_s.z=this.F_p.z-this.F_o.z,this.F_h=!0,this.F_r.copyFrom(this.F_s),this.F_r.normalize(),this.F_m.transformVectorSelf(this.F_f),this.F_f.normalize(),a.default.Cross(this.F_f,this.F_s,this.F_q),this.F_q.normalize(),this.F_9=!0)}swingHorizontal(t){this.F_&&(this.F_m.identity(),this.F_m.appendRotation(t*r.default.MATH_PI_OVER_180,this.F_q),this.F_s.x=this.F_o.x-this.F_p.x,this.F_s.y=this.F_o.y-this.F_p.y,this.F_s.z=this.F_o.z-this.F_p.z,this.F_m.transformVectorSelf(this.F_s),this.F_o.x=this.F_s.x+this.F_p.x,this.F_o.y=this.F_s.y+this.F_p.y,this.F_o.z=this.F_s.z+this.F_p.z,this.F_s.x=this.F_p.x-this.F_o.x,this.F_s.y=this.F_p.y-this.F_o.y,this.F_s.z=this.F_p.z-this.F_o.z,this.F_h=!0,this.F_r.copyFrom(this.F_s),this.F_r.normalize(),a.default.Cross(this.F_s,this.F_q,this.F_f),this.F_f.normalize(),this.F_9=!0)}swingVertical(t){this.F_&&(this.F_m.identity(),this.F_m.appendRotation(t*r.default.MATH_PI_OVER_180,this.F_f),this.F_s.x=this.F_o.x-this.F_p.x,this.F_s.y=this.F_o.y-this.F_p.y,this.F_s.z=this.F_o.z-this.F_p.z,this.F_m.transformVectorSelf(this.F_s),this.F_o.x=this.F_s.x+this.F_p.x,this.F_o.y=this.F_s.y+this.F_p.y,this.F_o.z=this.F_s.z+this.F_p.z,this.F_s.x=this.F_p.x-this.F_o.x,this.F_s.y=this.F_p.y-this.F_o.y,this.F_s.z=this.F_p.z-this.F_o.z,this.F_h=!0,this.F_r.copyFrom(this.F_s),this.F_r.normalize(),a.default.Cross(this.F_f,this.F_s,this.F_q),this.F_q.normalize(),this.F_g.copyFrom(this.F_q),this.F_9=!0)}setPosition(t){if(this.F_){a.default.Cross(this.F_s,this.F_q,this.BG);let e=this.BG.dot(this.F_g);this.F_e.copyFrom(this.F_g),this.F_e.scaleBy(e),this.BG.subtractBy(this.F_e),this.F_o.copyFrom(t),this.F_s.x=this.F_p.x-this.F_o.x,this.F_s.y=this.F_p.y-this.F_o.y,this.F_s.z=this.F_p.z-this.F_o.z,this.F_r.copyFrom(this.F_s),this.F_r.normalize(),a.default.Cross(this.BG,this.F_s,this.F_q),this.F_q.normalize(),this.F_9=!0}}setPositionXYZ(t,e,i){if(this.F_){a.default.Cross(this.F_s,this.F_q,this.BG);var s=this.BG.dot(this.F_g);this.F_e.copyFrom(this.F_g),this.F_e.scaleBy(s),this.BG.subtractBy(this.F_e),this.F_o.setTo(t,e,i),this.F_s.x=this.F_p.x-this.F_o.x,this.F_s.y=this.F_p.y-this.F_o.y,this.F_s.z=this.F_p.z-this.F_o.z,this.F_r.copyFrom(this.F_s),this.F_r.normalize(),a.default.Cross(this.BG,this.F_s,this.F_q),this.F_q.normalize(),this.F_9=!0}}setLookPosXYZFixUp(t,e,i){this.F_&&(this.F_p.setTo(t,e,i),this.F_s.x=this.F_p.x-this.F_o.x,this.F_s.y=this.F_p.y-this.F_o.y,this.F_s.z=this.F_p.z-this.F_o.z,this.F_h=!0,this.F_r.copyFrom(this.F_s),this.F_r.normalize(),a.default.Cross(this.F_s,this.F_q,this.F_f),this.F_f.normalize(),this.F_9=!0)}setPositionXYZFixUp(t,e,i){this.F_&&(this.F_o.setTo(t,e,i),this.F_s.x=this.F_p.x-this.F_o.x,this.F_s.y=this.F_p.y-this.F_o.y,this.F_s.z=this.F_p.z-this.F_o.z,this.F_h=!0,this.F_r.copyFrom(this.F_s),this.F_r.normalize(),a.default.Cross(this.F_s,this.F_q,this.F_f),this.F_f.normalize(),this.F_9=!0)}setPositionFixUp(t){this.F_&&(this.F_o.copyFrom(t),this.F_s.x=this.F_p.x-this.F_o.x,this.F_s.y=this.F_p.y-this.F_o.y,this.F_s.z=this.F_p.z-this.F_o.z,this.F_h=!0,this.F_r.copyFrom(this.F_s),this.F_r.normalize(),a.default.Cross(this.F_s,this.F_q,this.F_f),this.F_f.normalize(),this.F_9=!0)}copyFrom(t){let e=t.getPosition();this.F_o.copyFrom(e),e=t.getLookAtPosition(),this.F_p.copyFrom(e),this.setZNear(t.getZNear()),this.setZFar(t.getZFar()),this.setNearPlaneWidth(t.getNearPlaneWidth()),this.setNearPlaneHeight(t.getNearPlaneHeight()),this.setPerspectiveEnabled(t.getPerspectiveEnabled()),this.F_k.copyFrom(t.getViewInvMatrix())}getNV(){return this.GA.copyFrom(this.F_r),this.GA}getUV(){return this.GB.copyFrom(this.F_q),this.GB}getRV(){return this.GC.copyFrom(this.F_f),this.GC}getPosition(){return this.GD.copyFrom(this.F_o),this.GD}getLookAtPosition(){return this.GE.copyFrom(this.F_p),this.GE}setLookAtPosition(t,e,i){this.F_&&(this.F_p.setTo(t,e,i),this.F_s.x=this.F_p.x-this.F_o.x,this.F_s.y=this.F_p.y-this.F_o.y,this.F_s.z=this.F_p.z-this.F_o.z,this.F_r.copyFrom(this.F_s),this.F_r.normalize(),this.F_9=!0)}getPerspectiveEnabled(){return this.Dh}setPerspectiveEnabled(t){this.Dh=t}appendRotationByAxis(t,e,i=null){this.F_&&(this.GF=t,this.F_9=!0,this.GG.copyFrom(e),this.GH=i,this.GI=!0)}setRotationX(t){this.F_7.x=t,this.F_9=!0,this.GI=!1}getRotationX(){return this.F_7.x}setRotationY(t){this.F_7.y=t,this.F_9=!0,this.GI=!1}getRotationY(){return this.F_7.y}setRotationZ(t){this.F_7.z=t,this.F_9=!0,this.GI=!1}getRotationZ(){return this.F_7.z}setRotationXYZ(t,e,i){this.F_&&(this.F_7.setXYZ(t,e,i),this.F_9=!0,this.GI=!1)}screenXYToViewXYZ(t,e,i){t-=this.B,e-=this.C,this.Dh&&(t=this.F_t*(t-this.F_v)/this.F_v,e=this.F_u*(this.F_w-e)/this.F_w),i.setTo(t,e,-this.F_z)}screenXYToWorldXYZ(t,e,i){t-=this.B,e-=this.C,this.Dh&&(t=.5*this.F_t*(t-this.F_v)/this.F_v,e=.5*this.F_u*(this.F_w-e)/this.F_w),i.setTo(t,e,-this.F_z),i.w=1,this.F_k.transformVectorSelf(i)}getWorldPickingRayByScreenXY(t,e,i,s){t-=this.B,e-=this.C,this.Dh?(t=.5*this.F_t*(t-this.F_v)/this.F_v,e=.5*this.F_u*(e-this.F_w)/this.F_w,i.setTo(t,e,-this.F_z),i.w=1,this.F_k.transformVectorSelf(i),s.copyFrom(i),s.subtractBy(this.F_o),s.normalize()):(t-=this.F_v,e-=this.F_w,i.setTo(t,e,-this.F_z),i.w=1,this.F_k.transformVectorSelf(i),s.copyFrom(this.F_r))}calcScreenNormalizeXYByWorldPos(t,e){e.copyFrom(t),this.F_l.transformVectorSelf(e),e.x/=e.w,e.y/=e.w}worldPosToScreen(t){this.F_j.transformVector3Self(t),this.F_n.transformVectorSelf(t),t.x/=t.w,t.y/=t.w,t.x*=this.F_v,t.y*=this.F_w,t.x+=this.B,t.y+=this.C}calcViewRectByWorldSphere(t,e,i){this.F_j.transformVector3Self(t),e*=1.15,i.x=t.x-e,i.y=t.y-e,i.z=t.z,t.x+=e,t.y+=e,this.F_n.transformPerspV4Self(i),this.F_n.transformPerspV4Self(t),t.z=1/t.w,i.z=t.x*t.z,i.w=t.y*t.z,i.z*=this.F_v,i.w*=this.F_w,i.x*=t.z,i.y*=t.z,i.x*=this.F_v,i.y*=this.F_w,i.z=i.z-i.x,i.w=i.w-i.y,i.x+=this.B,i.y+=this.C}calcScreenRectByWorldSphere(t,e,i){this.F_j.transformVector3Self(t),e*=1.15,i.x=t.x-e,i.y=t.y-e,t.x+=e,t.y+=e,this.F_n.transformPerspV4Self(i),this.F_n.transformPerspV4Self(t),t.z=1/t.w,i.z=t.x*t.z,i.w=t.y*t.z,i.x*=t.z,i.y*=t.z,i.z=i.z-i.x,i.w=i.w-i.y}getInvertViewMatrix(){return this.GK}getZNear(){return this.F_z}setZNear(t){this.F_z=t}getZFar(){return this.F_0}setZFar(t){this.F_0=t}getNearPlaneWidth(){return this.F_t}setNearPlaneWidth(t){this.F_t=t}getNearPlaneHeight(){return this.F_u}setNearPlaneHeight(t){this.F_u=t}getFov(){return this.F_x}__calcTestParam(){null==this.GK&&(this.GK=new n.default),this.GK.copyFrom(this.F_j),this.GK.invert();let t=null,e=this.F_w,i=this.F_v,s=this.F_w,r=this.F_v;if(this.Dh){let t=Math.tan(.5*this.F_x);e=this.F_z*t,i=e*this.F_y,s=this.F_0*t,r=s*this.F_y}this.GL=i,this.GM=e,this.GN.setTo(0,0,-this.F_z),this.GO.setTo(0,0,-this.F_0),this.GK.transformVectorSelf(this.GN),this.GK.transformVectorSelf(this.GO),this.GP.x=this.GO.x-this.GN.x,this.GP.y=this.GO.y-this.GN.y,this.GP.z=this.GO.z-this.GN.z,this.GP.normalize(),t=this.GR[0],t.nv.copyFrom(this.GP),t.distance=t.nv.dot(this.GO),t.position.copyFrom(this.GO),t=this.GR[1],t.nv.copyFrom(this.GR[0].nv),t.distance=t.nv.dot(this.GN),t.position.copyFrom(this.GN),this.GQ[8]=this.GN,this.GQ[9]=this.GO,this.GQ[11]=this.GP,this.GQ[0].setTo(-r,-s,-this.F_0),this.GQ[1].setTo(r,-s,-this.F_0),this.GQ[2].setTo(r,s,-this.F_0),this.GQ[3].setTo(-r,s,-this.F_0),this.GQ[4].setTo(-i,-e,-this.F_z),this.GQ[5].setTo(i,-e,-this.F_z),this.GQ[6].setTo(i,e,-this.F_z),this.GQ[7].setTo(-i,e,-this.F_z),this.GK.transformVectorSelf(this.GQ[0]),this.GK.transformVectorSelf(this.GQ[1]),this.GK.transformVectorSelf(this.GQ[2]),this.GK.transformVectorSelf(this.GQ[3]),this.GK.transformVectorSelf(this.GQ[4]),this.GK.transformVectorSelf(this.GQ[5]),this.GK.transformVectorSelf(this.GQ[6]),this.GK.transformVectorSelf(this.GQ[7]),this.GJ.max.setTo(-9999999,-9999999,-9999999),this.GJ.min.setTo(9999999,9999999,9999999);for(let a=0;a<8;++a)this.GJ.addPosition(this.GQ[a]);this.GJ.updateFast();let l=this.GQ[0],h=this.GQ[4];this.BG.x=l.x-h.x,this.BG.y=l.y-h.y,this.BG.z=l.z-h.z,l=this.GQ[1],h=this.GQ[5],this.F_e.x=l.x-h.x,this.F_e.y=l.y-h.y,this.F_e.z=l.z-h.z,t=this.GR[3],a.default.Cross(this.F_e,this.BG,t.nv),t.nv.normalize(),t.distance=t.nv.dot(l),t.position.copyFrom(l),l=this.GQ[3],h=this.GQ[7],this.BG.x=l.x-h.x,this.BG.y=l.y-h.y,this.BG.z=l.z-h.z,l=this.GQ[2],h=this.GQ[6],this.F_e.x=l.x-h.x,this.F_e.y=l.y-h.y,this.F_e.z=l.z-h.z,t=this.GR[2],a.default.Cross(this.F_e,this.BG,t.nv),t.nv.normalize(),t.distance=t.nv.dot(l),t.position.copyFrom(l),l=this.GQ[0],h=this.GQ[4],this.BG.x=l.x-h.x,this.BG.y=l.y-h.y,this.BG.z=l.z-h.z,l=this.GQ[3],h=this.GQ[7],this.F_e.x=l.x-h.x,this.F_e.y=l.y-h.y,this.F_e.z=l.z-h.z,t=this.GR[4],a.default.Cross(this.BG,this.F_e,t.nv),t.nv.normalize(),t.distance=t.nv.dot(l),t.position.copyFrom(l),l=this.GQ[1],h=this.GQ[5],this.BG.x=l.x-h.x,this.BG.y=l.y-h.y,this.BG.z=l.z-h.z,l=this.GQ[2],h=this.GQ[6],this.F_e.x=l.x-h.x,this.F_e.y=l.y-h.y,this.F_e.z=l.z-h.z,t=this.GR[5],a.default.Cross(this.BG,this.F_e,t.nv),t.nv.normalize(),t.distance=t.nv.dot(l),t.position.copyFrom(l),this.GS[0].copyFrom(this.GR[0].nv),this.GS[1].copyFrom(this.GR[1].nv),this.GS[1].scaleBy(-1),this.GS[2].copyFrom(this.GR[2].nv),this.GS[3].copyFrom(this.GR[3].nv),this.GS[3].scaleBy(-1),this.GS[4].copyFrom(this.GR[4].nv),this.GS[4].scaleBy(-1),this.GS[5].copyFrom(this.GR[5].nv),this.GT[0]=this.GR[0].distance,this.GT[1]=-this.GR[1].distance,this.GT[2]=this.GR[2].distance,this.GT[3]=-this.GR[3].distance,this.GT[4]=-this.GR[4].distance,this.GT[5]=this.GR[5].distance}getWordFrustumWAABB(){return this.GJ}getWordFrustumWAABBCenter(){return this.GJ.center}getWordFrustumVtxArr(){return this.GQ}getWordFrustumPlaneArr(){return this.GR}visiTestSphere2(t,e){let i=this.GS[0].dot(t)-this.GT[0]-e>r.default.MATH_MIN_POSITIVE;return!i&&(i=this.GS[1].dot(t)-this.GT[1]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.GS[2].dot(t)-this.GT[2]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.GS[3].dot(t)-this.GT[3]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.GS[4].dot(t)-this.GT[4]-e>r.default.MATH_MIN_POSITIVE,!i&&(i=this.GS[5].dot(t)-this.GT[5]-e>r.default.MATH_MIN_POSITIVE,!i)))))}visiTestSphere3(t,e,i){let s=this.GS[0].dot(t)-this.GT[0]+i-e>r.default.MATH_MIN_POSITIVE;return!s&&(s=this.GS[1].dot(t)-this.GT[1]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.GS[2].dot(t)-this.GT[2]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.GS[3].dot(t)-this.GT[3]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.GS[4].dot(t)-this.GT[4]-e>r.default.MATH_MIN_POSITIVE,!s&&(s=this.GS[5].dot(t)-this.GT[5]-e>r.default.MATH_MIN_POSITIVE,!s)))))}visiTestPosition(t){let e=this.GS[0].dot(t)-this.GT[0]>r.default.MATH_MIN_POSITIVE;return!e&&(e=this.GS[1].dot(t)-this.GT[1]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.GS[2].dot(t)-this.GT[2]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.GS[3].dot(t)-this.GT[3]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.GS[4].dot(t)-this.GT[4]>r.default.MATH_MIN_POSITIVE,!e&&(e=this.GS[5].dot(t)-this.GT[5]>r.default.MATH_MIN_POSITIVE,!e)))))}visiTestPlane(t,e){let i=t.dot(this.GR[0].position)-e,s=i*(t.dot(this.GR[1].position)-e);return s<r.default.MATH_MIN_POSITIVE||(s=i*(t.dot(this.GR[2].position)-e),s<r.default.MATH_MIN_POSITIVE||(s=i*(t.dot(this.GR[3].position)-e),s<r.default.MATH_MIN_POSITIVE||(s=i*(t.dot(this.GR[4].position)-e),s<r.default.MATH_MIN_POSITIVE||(s=i*(t.dot(this.GR[5].position)-e),s<r.default.MATH_MIN_POSITIVE))))}visiTestSphere(t,e){let i=this.GJ.sphereIntersect(t,e);if(i){let i=this.GR[0].intersectSphere(t,e),s=this.GR[1].intersectSphere(t,e);return!(i*s>=0&&!this.GR[0].intersectBoo&&!this.GR[1].intersectBoo)&&(i=this.GR[2].intersectSphere(t,e),s=this.GR[3].intersectSphere(t,e),!(i*s>=0&&!this.GR[2].intersectBoo&&!this.GR[3].intersectBoo)&&(i=this.GR[4].intersectSphere(t,e),s=this.GR[5].intersectSphere(t,e),!(i*s>=0&&!this.GR[4].intersectBoo&&!this.GR[5].intersectBoo)))}return!1}visiTestAABB(t){let e=t.center,i=t.radius,s=this.GJ.sphereIntersect(e,i);if(s){let t=this.GR[0].intersectSphere(e,i),s=this.GR[1].intersectSphere(e,i);return!(t*s>=0&&!this.GR[0].intersectBoo&&!this.GR[1].intersectBoo)&&(t=this.GR[2].intersectSphere(e,i),s=this.GR[3].intersectSphere(e,i),!(t*s>=0&&!this.GR[2].intersectBoo&&!this.GR[3].intersectBoo)&&(t=this.GR[4].intersectSphere(e,i),s=this.GR[5].intersectSphere(e,i),!(t*s>=0&&!this.GR[4].intersectBoo&&!this.GR[5].intersectBoo)))}return!1}setViewMatrix(t){this.GU=t,this.F_9=!0}update(){this.F_9&&(this.version++,this.F_9=!1,null==this.GU?(this.GI?this.F_i.appendRotationPivot(this.GF*r.default.MATH_PI_OVER_180,this.GG,this.GH):(this.F_i.identity(),this.F_i.appendRotationEulerAngle(this.F_7.x*r.default.MATH_PI_OVER_180,this.F_7.y*r.default.MATH_PI_OVER_180,this.F_7.z*r.default.MATH_PI_OVER_180)),this.F_h?this.F_j.lookAtRH(this.F_o,this.F_p,this.F_q):this.F_j.lookAtLH(this.F_o,this.F_p,this.F_q),this.F_j.append(this.F_i)):this.F_j.copyFrom(this.GU),this.F_5?(this.F_t=this.F_z*Math.tan(.5*this.F_x)*2,this.F_u=this.F_t/this.F_y):(this.F_u=this.F_z*Math.tan(.5*this.F_x)*2,this.F_t=this.F_y*this.F_u),this.F_k.copyFrom(this.F_j),this.F_k.invert(),this.F_l.identity(),this.F_l.copyFrom(this.F_j),this.F_l.append(this.F_n),this.__calcTestParam(),this.updateUniformData())}updateCamMatToUProbe(t){t.isEnabled()&&(t.update(),t.getFS32At(0).set(this.F_j.getLocalFS32(),0),t.getFS32At(1).set(this.F_n.getLocalFS32(),0))}updateUniformData(){this.uniformEnabled&&(this.updateCamMatToUProbe(this.matUProbe),this.ufrustumProbe.setVec4DataAt(0,this.F_z,this.F_0,this.GL,this.GM),this.ufrustumProbe.update(),this.ucameraPosProbe.setVec4DataAt(0,this.F_o.x,this.F_o.y,this.F_o.z,1),this.ucameraPosProbe.update())}destroy(){}lookRHEnabled(){return this.F_h}lookLHEnabled(){return!this.F_h}getVPMatrix(){return this.F_l}getViewMatrix(){return this.F_j}getViewInvMatrix(){return this.F_k}getProjectMatrix(){return this.F_n}}e.default=o},c62b:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("e08e"),a=i("7c63"),n=s(i("29ef"));class l{constructor(){this.uid=-1,this.value=-1,this.__$rpuid=-1,this.__$rprouid=-1,this.shader=null,this.pos=null,this.bounds=null,this.ibufType=0,this.ibufStep=2,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.drawOffset=0,this.partTotal=0,this.partGroup=null,this.trisNumber=0,this.visible=!0,this.drawEnabled=!0,this.drawMode=0,this.renderState=0,this.rcolorMask=0,this.drawFlag=0,this.vro=null,this.transUniform=null,this.uniform=null,this.shdUid=-1,this.vtxUid=-1,this.tro=null,this.texMid=-1,this.ubo=null,this.polygonOffset=null}testDrawFlag(){this.shader.drawFlag!=this.drawFlag&&(this.shader.drawFlag=this.drawFlag,a.RenderStateObject.UseRenderState(this.renderState),a.RenderColorMask.UseRenderState(this.rcolorMask))}getUid(){return this.uid}getRPOUid(){return this.__$rpuid}getRPROUid(){return this.__$rprouid}getShaderUid(){return this.shdUid}setIvsParam(t,e){this.ivsIndex=t,this.ivsCount=e,this.drawOffset=t*this.ibufStep,this.drawEnabled=this.visible&&this.ivsCount>0}setVisible(t){this.visible=t,this.drawEnabled=t&&this.ivsCount>0}setDrawFlag(t,e){this.renderState=t,this.rcolorMask=e,this.drawFlag=(e<<10)+t}drawThis(t){++n.default.DrawCallTimes,n.default.DrawTrisNumber+=this.trisNumber;let e=this.indicesRes.getVTCount();switch(this.ivsCount<=e&&(e=this.ivsCount),null!=this.polygonOffset?t.setPolygonOffset(this.polygonOffset[0],this.polygonOffset[1]):t.resetPolygonOffset(),this.drawMode){case r.RenderDrawMode.ELEMENTS_TRIANGLES:t.RContext.drawElements(t.TRIANGLES,e,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_LINES:t.RContext.drawElements(t.LINES,e,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:t.RContext.drawElements(t.TRIANGLE_STRIP,e,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:t.RContext.drawElementsInstanced(t.TRIANGLES,e,this.ibufType,this.drawOffset,this.insCount);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:t.RContext.drawElements(t.TRIANGLE_FAN,e,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ARRAYS_LINES:t.RContext.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case r.RenderDrawMode.ARRAYS_LINE_STRIP:t.RContext.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}drawPart(t){++n.default.DrawCallTimes,n.default.DrawTrisNumber+=this.trisNumber;let e=this.indicesRes.getVTCount();this.ivsCount<=e&&(e=this.ivsCount),null!=this.polygonOffset?t.setPolygonOffset(this.polygonOffset[0],this.polygonOffset[1]):t.resetPolygonOffset();let i=0,s=t.RContext;switch(this.drawMode){case r.RenderDrawMode.ELEMENTS_TRIANGLES:for(;i<this.partTotal;)s.drawElements(t.TRIANGLES,this.partGroup[i++],this.ibufType,this.partGroup[i++]);break;case r.RenderDrawMode.ELEMENTS_LINES:for(;i<this.partTotal;)s.drawElements(t.LINES,this.partGroup[i++],this.ibufType,this.partGroup[i++]);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_STRIP:s.drawElements(t.TRIANGLE_STRIP,this.ivsCount,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES:s.drawElementsInstanced(t.TRIANGLES,this.ivsCount,this.ibufType,this.drawOffset,this.insCount);break;case r.RenderDrawMode.ELEMENTS_TRIANGLE_FAN:s.drawElements(t.TRIANGLE_FAN,this.ivsCount,this.ibufType,this.drawOffset);break;case r.RenderDrawMode.ARRAYS_LINES:s.drawArrays(t.LINES,this.ivsIndex,this.ivsCount);break;case r.RenderDrawMode.ARRAYS_LINE_STRIP:s.drawArrays(t.LINE_STRIP,this.ivsIndex,this.ivsCount);break;default:break}}run2(t){null!=this.ubo&&this.ubo.run(t),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}run(t){null!=this.ubo&&this.ubo.run(t),this.vro.run(),this.tro.run(),this.shader.useTransUniform(this.transUniform),this.shader.useUniform(this.uniform),this.testDrawFlag()}runLockMaterial2(t){this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(null==t?this.uniform:t,this.transUniform)}runLockMaterial(){this.vro.run(),this.testDrawFlag(),this.shader.useUniform2ToCurrentShd(this.uniform,this.transUniform)}reset(){this.indicesRes=null,this.polygonOffset=null,this.vro.__$detachThis(),this.vro=null,this.tro.__$detachThis(),this.tro=null,this.texMid=-1,this.__$rprouid=-1,this.ubo=null,this.shdUid=-1,this.vtxUid=-1,this.uniform=null,this.transUniform=null,this.partGroup=null,this.ivsIndex=0,this.ivsCount=0,this.insCount=0,this.partTotal=0,this.drawMode=0,this.drawFlag=0,this.renderState=0,this.rcolorMask=0,this.drawEnabled=!0,this.shader=null,this.bounds=null,this.pos=null}destroy(){this.reset()}toString(){return"[RPOUnit(uid = "+this.uid+")]"}}e.default=l},c70f:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73")),a=s(i("7279"));class n{constructor(){}geNames(){return[]}createGlobalUinform(t){let e=new a.default;return e.uniformNameList=this.geNames(),e.copyDataFromProbe(t),t.update(),e}}class l extends n{constructor(){super()}geNames(){return[r.default.EnvLightParams.name]}use(t,e=1){t.addFragUniformParam(r.default.EnvLightParams)}}e.GlobalEnvLightUniformParam=l;class h extends n{constructor(){super()}geNames(){return[r.default.ShadowMatrix.name,r.default.ShadowVSMParams.name]}use(t,e=1){t.addFragUniformParam(r.default.ShadowVSMParams),t.addVertUniformParam(r.default.ShadowMatrix)}}e.GlobalVSMShadowUniformParam=h;class o extends n{constructor(){super()}geNames(){return[r.default.GlobalLight.positionName,r.default.GlobalLight.colorName]}use(t,e=1,i=1){t.uniform.useCameraPosition(!1,!0),t.addFragUniform(r.default.GlobalLight.type,r.default.GlobalLight.positionName,e),t.addFragUniform(r.default.GlobalLight.type,r.default.GlobalLight.colorName,i)}}e.GlobalLightUniformParam=o},c711:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("8e17")),n=s(i("fecb")),l=s(i("c120"));class h{constructor(){this.w_=null,this.A_=null,this.Ej=null,this.y=null,this.Ek=new Uint8Array(256),this.z=null,this.El=null,this.Em=0,this.En=0,this.Eo=new a.default,this.Ep=new a.default,this.C_P=null,this.C_Q=null,this.Eq=new Uint8Array(4),this.Er=new a.default,this.Es=new a.default,this.Et=[null,null],this.Eu=!1}setRenderer(t){this.w_=t}setRayTestMode(t){this.En=t}setRay(t,e){this.C_P=t,this.C_Q=e}getRay(t,e){t.copyFrom(this.C_P),e.copyFrom(this.C_Q)}setCamera(t){this.A_=t}setCullingNodeHead(t){if(this.Ej=t,null==this.z){this.z=[];let t=0;for(;t<256;++t)this.z.push(new l.default)}}getSelectedNode(){return this.El}getSelectedNodes(){return this.z}getSelectedNodesTotal(){return this.Em}sorting(t,e){let i=this.z;this.y=i[t];while(t<e){while(t<e&&i[e].dis>=this.y.dis)--e;i[t]=i[e];while(t<e&&i[t].dis<=this.y.dis)++t;i[e]=i[t]}return i[t]=this.y,t}snsort(t,e){if(t<e){let i=this.sorting(t,e);this.snsort(t,i-1),this.snsort(i+1,e)}}run(){let t=this.Ej;if(null!=t){let e=0,i=this.C_Q,s=this.C_P,l=this.Es,h=null,o=0;Math.abs(i.x)>r.default.MATH_MIN_POSITIVE?this.Er.x=1/i.x:this.Er.x=r.default.MATH_MAX_POSITIVE,Math.abs(i.y)>r.default.MATH_MIN_POSITIVE?this.Er.y=1/i.y:this.Er.y=r.default.MATH_MAX_POSITIVE,Math.abs(i.z)>r.default.MATH_MIN_POSITIVE?this.Er.z=1/i.z:this.Er.z=r.default.MATH_MAX_POSITIVE,this.Er.x<0?this.Eq[0]=1:this.Eq[0]=0,this.Er.y<0?this.Eq[1]=1:this.Eq[1]=0,this.Er.z<0?this.Eq[2]=1:this.Eq[2]=0;while(null!=t)t.drawEnabled&&t.entity.mouseEnabled&&(l.x=t.bounds.center.x-s.x,l.y=t.bounds.center.y-s.y,l.z=t.bounds.center.z-s.z,e=l.dot(i),l.x-=e*i.x,l.y-=e*i.y,l.z-=e*i.z,l.getLengthSquared()<=t.bounds.radius2&&t.rayTestState<1&&(this.Et[0]=t.bounds.min,this.Et[1]=t.bounds.max,n.default.IntersectionRL3(this.Et,this.Eq,this.Er,i,s,l)&&(h=this.z[o],h.entity=t.entity,h.dis=this.Er.w,h.wpv.copyFrom(l),++o))),t=t.next;this.El=null;let m=0;if(o>0){let t=this.Eo,e=this.Ep,n=null,h=0,_=0,u=null,d=null;if(o>1){let c=!this.Eu;for(m=0;m<o;++m)d=this.z[m],d.dis=r.default.MATH_MAX_POSITIVE,d.flag=0,n=this.z[m].entity,n.isPolyhedral()?c?(u=n.getInvMatrix(),u.transformOutVector3(s,t),u.deltaTransformOutVector(i,e),e.normalize(),h=n.testRay(t,e,l,!0)):h=0:(u=n.getInvMatrix(),u.transformOutVector3(s,t),u.deltaTransformOutVector(i,e),e.normalize(),h=n.testRay(t,e,l,!0)),h>0?(d.flag=h,d.lpv.copyFrom(l),n.getMatrix().transformOutVector3(l,d.wpv),d.dis=a.default.Distance(d.wpv,s),this.Ek[_]=m,++_):h<0&&(this.Ek[_]=m,++_);for(this.snsort(0,o-1),m=0;m<o;++m)if(this.z[m].flag>0){this.El=this.z[m];break}}else d=this.z[0],d.dis=r.default.MATH_MAX_POSITIVE,n=this.z[0].entity,u=n.getInvMatrix(),u.transformOutVector3(s,t),u.deltaTransformOutVector(i,e),e.normalize(),h=n.testRay(t,e,l,!0),h>0?(d.lpv.copyFrom(l),n.getMatrix().transformOutVector3(l,d.wpv),d.dis=a.default.Distance(d.wpv,s),this.El=d):h<0&&(this.El=d)}for(m=o;m<this.Em;++m)this.El!=this.z[m]&&(this.z[m].entity=null);this.Em=o}}clear(){this.El=null}}e.default=h},c7a5:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.z_=[],this.y_=[],this.w_=null,this.x_=0,this.timeSpeed=6,this.Dj=0}createEffect(t){}setRunFlag(t){this.Dj=t}getRunFlag(){return this.Dj}isRunning(){return!0}isStopped(){return!1}run(){let t,e=this.z_,i=e.length,s=0;for(;s<i;++s)t=e[s],t.isAwake()?t.updateTime(this.timeSpeed):(t.setVisible(!1),e.splice(s,1),s--,i--,this.y_.push(t))}}e.default=s},c870:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("29ef")),n=s(i("402a")),l=s(i("408b")),h=i("8d98"),o=i("9557");class m extends n.default{constructor(t=null){super(t),this.GV=null,this.GW=null,this.B_P=null,this.GX=null,this.GY=64,this.GZ=64,this.C_l=null,this.Ga=null,this.Gb=300,this.Gc=0,this.Gd=10,this.normalEnabled=!1,this.diffuseMapEnabled=!0}setGroupSrcMesh(t){this.GV=t}getGroupSrcMesh(){return this.GV}createDataTexture(t,e){if(e>0){this.GZ=e,this.GY=Math.sqrt(e),this.GY=r.default.GetNearestCeilPow2(Math.sqrt(e)),this.GY<8&&(this.GY=8);let i=this.GY,s=t.createFloatTex2D(i,i);s.setWrap(h.TextureConst.WRAP_CLAMP_TO_EDGE),s.mipmapEnabled=!1,s.minFilter=h.TextureConst.NEAREST,s.magFilter=h.TextureConst.NEAREST;let a=new Float32Array(i*i*4);return s.setDataFromBytes(a,0,i,i),this.GX=s,this.C_l=a,this.GX}}setPosData(t,e,i){null!=t&&null!=e&&(this.GY=t.getWidth(),this.GZ=i,this.GX=t,this.C_l=e)}getPosDataTexture(){return this.GX}getPosData(){return this.C_l}getPosTotal(){return this.GZ}getDataTextureSize(){return this.GY}getDataTextureArea(){return this.GY*this.GY}setPosAt(t,e){t*=4,this.C_l[t++]=e.x,this.C_l[t++]=e.y,this.C_l[t]=e.z}getPosAt(t,e){t*=4,e.x=this.C_l[t++],e.y=this.C_l[t++],e.y=this.C_l[t]}setVtxTransformMatrix(t){this.B_P=t}createMaterial(t){let e=this.getMaterial();null==e?(e=new l.default,e.normalEnabled=this.normalEnabled,e.diffuseMapEnabled=this.diffuseMapEnabled,e.setTexSize(this.GY),e.setPositionsTotal(this.GZ),e.setTextureList(t),this.setMaterial(e)):e.getTextureTotal()<1&&e.setTextureList(t),this.Ga=e}moveIdDistanceOffset(t){this.Gb+=t,this.Ga.setCurveMoveDistance(this.Gb)}moveIdDistance(t){this.Gb=t,this.Ga.setCurveMoveDistance(t)}showBackFace(){this.setRenderState(a.default.FRONT_CULLFACE_NORMAL_STATE)}showFrontFace(){this.setRenderState(a.default.NORMAL_STATE)}setGroupPositions(t=null){this.GW=t.slice()}initialize(t=1,e=10,i=null){null==i&&(i=[this.GX]);let s=i.length,r=[];r[0]=this.GX;let a=i[0]!=this.GX?0:1;for(;a<s;++a)r.push(i[a]);i=r,this.Gc=t,this.Gd=e,this.createMaterial(i),this.activeDisplay()}__activeMesh(t){let e=null;null==this.getMesh()?e=new o.IdGroupMesh:null==this.getMesh().getIVS()&&(e=this.getMesh()),null!=e&&(e.srcMesh=this.GV,null!=this.B_P&&e.setTransformMatrix(this.B_P),e.setBufSortFormat(t.getBufSortFormat()),e.initialize(this.Gc,this.Gd,this.GW),this.setMesh(e),e.setTransformMatrix(null)),this.B_P=null}destroy(){super.destroy(),this.GV=null}}e.IdMeshGroupAnimator=m},ca2f:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){}downloadBinFile(t,e,i="vrd"){var s,r;s=function(t,e,i){var s,a;s=new Blob([t],{type:i}),a=window.URL.createObjectURL(s),r(a,e),setTimeout((function(){return window.URL.revokeObjectURL(a)}),1e3)},r=function(t,e){var i;i=document.createElement("a"),i.href=t,i.download=e,document.body.appendChild(i),i.style="display: none",i.click(),i.remove()},s(t,e+"."+i,"application/octet-stream")}}e.FileIO=s},ca6c:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static PushThreeBitValueToInt(t,e){return(t<<3)+e}static PopThreeBitValueFromInt(t){return s.value=7&t,t>>3}static ContainsBit(t,e){return(e&t)>0}static RemoveBit(t,e){return~e&t}static AddBit(t,e){return e|t}static AssembleFromIntArray(t){let e=0,i=0,s=t.length;for(;e<s;++e)t[e]>0&&(i|=1<<e);return i}}s.BIT_ZERO=0,s.BIT_ONE_0=1,s.BIT_ONE_1=2,s.BIT_ONE_2=4,s.BIT_ONE_3=8,s.BIT_ONE_4=16,s.BIT_ONE_5=32,s.BIT_ONE_6=64,s.BIT_ONE_7=128,s.BIT_ONE_8=256,s.BIT_ONE_9=512,s.BIT_ONE_10=1024,s.BIT_ONE_11=2048,s.value=0,e.default=s},cb29:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8a0a")),a=i("8a0a"),n=s(i("e7d2")),l=i("e08e");class h{constructor(t=r.default.VTX_STATIC_DRAW){this.Ge=0,this.E_g=0,this.B_P=null,this.B_Q=null,this.B_O=null,this.Gf=null,this.Gg=null,this.Gh=null,this.forceUpdateIVS=!1,this.wireframe=!1,this.bounds=null,this.normalType=a.VtxNormalType.GOURAND,this.normalScale=1,this.vtxTotal=0,this.trisNumber=0,this.drawMode=l.RenderDrawMode.ELEMENTS_TRIANGLES,this.vtCount=0,this.vbWholeDataEnabled=!1,this.drawInsBeginIndex=0,this.drawInsStride=0,this.drawInsTotal=0,this.c=0,this.Ge=t}updateWireframeIvs(){if(this.drawMode=l.RenderDrawMode.ELEMENTS_TRIANGLES,this.wireframe&&null!==this.B_O){let t,e,i,s,r=this.B_O,a=2*r.length;t=a<65535?new Uint16Array(a):new Uint32Array(a);let n=0;for(let l=0,h=r.length;l<h;l+=3)e=r[l+0],i=r[l+1],s=r[l+2],t[n]=e,t[n+1]=i,t[n+2]=i,t[n+3]=s,t[n+4]=s,t[n+5]=e,n+=6;this.drawMode=l.RenderDrawMode.ELEMENTS_LINES}}buildEnd(){this.Gf=n.default.BufDataList,this.Gg=n.default.BufDataStepList,this.Gh=n.default.BufStatusList}setTransformMatrix(t){this.B_P=t}getTransformMatrix(){return this.B_P}isPolyhedral(){return!0}setPolyhedral(t){}testRay(t,e,i,s){return-1}rebuild(){if(null==this.B_Q&&null!=this.Gf){n.default.Reset();let t=0,e=this.Gf.length;for(;t<e;++t)n.default.AddFloat32Data(this.Gf[t],this.Gg[t],this.Gh[t]);this.B_Q=n.default.CreateBySaveData(this.getBufDataUsage()),null!=this.B_O&&(this.B_Q.setUint16IVSData(this.B_O),this.vtCount=this.B_O.length)}}__$attachVBuf(){return null==this.B_Q&&this.rebuild(),n.default.__$$AttachAt(this.B_Q.getUid()),this.B_Q}__$detachVBuf(t){if(this.B_Q!=t)throw Error("Fatal Error!");n.default.__$$DetachAt(this.B_Q.getUid())}isGeomDynamic(){return this.Ge}getBufDataUsage(){return this.Ge}getVS(){return null}getUVS(){return null}getNVS(){return null}getCVS(){return null}getIVS(){return this.B_O}setBufSortFormat(t){this.E_g=t}getBufSortFormat(){return this.E_g}isVBufEnabledAt(t){return(t&this.E_g)>0}__$attachThis(){++this.c}__$detachThis(){1==this.c?(--this.c,this.__$dispose()):--this.c,this.c<1&&(this.c=0)}getAttachCount(){return this.c}__$dispose(){this.getAttachCount()<1&&null!=this.B_Q&&(n.default.__$$DetachAt(this.B_Q.getUid()),this.B_Q=null)}isEnabled(){return null!=this.B_Q}isResFree(){return this.getAttachCount()<1&&null==this.B_Q}__$destroy(){this.isResFree()&&(this.B_O=null,this.Gf=null,this.Gg=null,this.Gh=null,this.trisNumber=0,this.B_P=null)}toString(){return"[MeshBase()]"}}e.default=h},cc48:function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t["NONE"]=0]="NONE",t[t["CAMERA"]=1]="CAMERA",t[t["POV"]=2]="POV",t[t["INNER_POV_PASS"]=3]="INNER_POV_PASS",t[t["CAMERA_AND_POV"]=4]="CAMERA_AND_POV"}(s||(s={})),e.SpaceCullingMask=s},cc55:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.vert="",this.vert_head="",this.vert_body="",this.frag="",this.frag_head="",this.frag_body="",this.uuid=""}}e.ShaderCodeObject=s},cc9c:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("ae33")),n=s(i("2574")),l=s(i("5e22"));class h{constructor(t=null){this.At=null,this.BD=0,this.BH=new n.default,this.BI=null,this.BL=null,this.BM=3,this.BN=0,this.postureCtrl=new l.default,this.BI=null==t?new a.default:t}getContainer(){return this.BI}setAttackDst(t){}setVisible(t){this.BI.setVisible(t)}getVisible(){return this.BI.getVisible()}toPositive(){this.BH.toPositive()}toNegative(){this.BH.toNegative()}setRotationY(t){this.BI.setRotationY(t)}getRotationY(){return this.BI.getRotationY()}direcByPos(t,e){this.postureCtrl.runByPos(t,e)}direcByDegree(t,e){this.postureCtrl.runByDegree(t,e)}setDstDirecDegree(t){}isPoseRunning(){return this.postureCtrl.isRunning()}initialize(t,e,i=null,s=null){if(null==this.At&&null!=i){this.BM=3*.7,this.At=t,this.BL=i,t.addContainer(this.BI,e);let a=i.getEngityCore(),n=i.getEngityBGL(),l=i.getEngityBGR(),h=i.getEngitySGL(),o=i.getEngitySGR();this.BI.addEntity(a),this.BI.addEntity(n),this.BI.addEntity(l),this.BI.addEntity(h),this.BI.addEntity(o);let m=new r.default;m.copyFrom(i.getCoreCenter()),null!=s&&m.addBy(s),this.BH.initialize(a,m,.5*i.getCoreWidth()),this.BH.setBG(n,l,i.getBGLong()),this.BH.setSG(h,o),this.postureCtrl.bindTarget(this)}}setXYZ(t,e,i){this.BI.setXYZ(t,e,i)}setPosition(t){this.BI.setPosition(t)}getPosition(t){this.BI.getPosition(t)}resetPose(){this.BH.resetPose(),this.BD=this.BH.getOriginTime()}resetNextOriginPose(){this.BN=this.BH.getNextOriginTime(this.BD)}run(t){this.BI.update(),this.BH.run(this.BD),this.BD+=this.BM}isResetFinish(){return this.BD>=this.BN}runToReset(){this.BD>=this.BN&&(this.BD=this.BN),this.BI.update(),this.BH.run(this.BD),this.BD+=this.BM}}e.default=h},ccaa:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("91e2")),a=s(i("8e17")),n=i("670b"),l=s(i("519e")),h=s(i("402a")),o=s(i("3930"));class m{constructor(){this.A8=null,this.B_a=null,this.envAmbientLightEnabled=!1,this.shadowReceiveEnabled=!1,this.fogEnabled=!1,this.renderProcessIndex=1,this.colorBrightness=1}initialize(t,e,i){null==this.A8&&(this.A8=t,this.B_a=e,this.C_d=i,this.initTerrain())}createLambertMaterial(t,e=null,i=null,s=!1){let r=this.B_a.createLambertLightMaterial(!1);return r.shadowReceiveEnabled=this.shadowReceiveEnabled,r.envAmbientLightEnabled=this.envAmbientLightEnabled,r.fogEnabled=this.fogEnabled,r.vertColorEnabled=!0,r.vertColorEnabled=s,r.diffuseMap=t,r.normalMap=e,r.aoMap=i,r.initializeByCodeBuf(!0),r.setBlendFactor(.6,.7),r}initTerrain(){let t=this.C_d.gridSize,e=this.C_d.terrainHeight,i=new a.default(.5*-t,0,.5*-t),s=new a.default(.5*t,e,.5*t),l=new a.default(.5*-t,0,.5*-t),h=new a.default(.5*t,this.C_d.obstacleHeight,.5*t),m=new o.default,_=null,u=null,d=this.createLambertMaterial(this.B_a.getTextureByUrl("static/assets/box_wood01.jpg"),_,u,!0),c=new r.default;c.vtxColor=m,c.setMaterial(d),c.initialize(i,s,[this.B_a.getTextureByUrl("static/assets/box_wood01.jpg")]);let f=new n.GeometryMerger,p=new n.GeometryMerger,g=new n.GeometryMerger,v=this.B_a.getTextureByUrl("static/assets/box_wood01.jpg"),x=this.B_a.getTextureByUrl("static/assets/moss_01.jpg"),y=this.B_a.getTextureByUrl("static/assets/moss_03.jpg"),T=this.createLambertMaterial(v,_,u,!0);T.initializeByCodeBuf(),_=null;let b=this.createLambertMaterial(x,_,u,!0);b.initializeByCodeBuf();let S=this.createLambertMaterial(y,_,u,!0);S.initializeByCodeBuf();let E,M=this.colorBrightness,A=this.C_d.rn,R=this.C_d.cn;for(let a=0;a<A;a++)for(let t=0;t<R;t++){m.setRGB3f(M*t/R,M,M*a/A),E=this.C_d.getGridPositionByRC(a,t);let e=this.C_d.getGridStatusByRC(a,t),n=new r.default;n.vtxColor=m,e<1&&(e=Math.random()>.5?-1:-2),E.addBy(this.C_d.positionOffset),e>0?(E.y+=this.C_d.obstacleY,n.setPosition(E),n.setMaterial(T),n.initialize(l,h,[v]),f.addEntity(n)):(n.setPosition(E),-1==e?(n.setMaterial(b),n.initialize(i,s,[x]),p.addEntity(n)):-2==e&&(n.setMaterial(S),n.initialize(i,s,[y]),g.addEntity(n)))}this.addMergedEntity(f,T),this.addMergedEntity(p,b),this.addMergedEntity(g,S)}addMergedEntity(t,e){t.merger();let i=new l.default;i.setBufSortFormat(e.getBufSortFormat()),i.initializeFromGeometry(t);let s=new h.default;s.setMaterial(e),s.setMesh(i),this.A8.addEntity(s,this.renderProcessIndex)}run(){}}e.SimpleTerrain=m},ccdf:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("8d98"),a=s(i("cfaf")),n=s(i("acaa")),l=s(i("85b6")),h=s(i("3b73"));class o{constructor(t){this.d=null,this.Gi=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.Gj=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.Gk=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.Gl=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],this.d=t}getRenderProxy(){return this.d}createWrapperTex(t,e,i=!1){let s=new l.default(t,e,i);return s}createRTTTex2D(t,e,i=!1){let s=new a.default(t,e,i);return s}createDepthTex2D(t,e,i=!1){let s=new n.default(t,e,i);return s}getCubeRTTTextureAt(t){return null!=this.Gj[t]?(this.Gj[t].__$setRenderProxy(this.d),this.Gj[t]):(this.Gj[t]=this.createRTTTex2D(32,32),this.Gj[t].toCubeTexture(),this.Gj[t].name="sys_cube_rttTex_"+t,this.Gj[t].minFilter=r.TextureConst.LINEAR,this.Gj[t].magFilter=r.TextureConst.LINEAR,this.Gj[t].__$setRenderProxy(this.d),this.Gj[t])}createCubeRTTTextureAt(t,e,i){return e=e>1?e:1,i=i>1?i:1,null!=this.Gj[t]?(this.Gj[t].__$setRenderProxy(this.d),this.Gj[t]):(this.Gj[t]=this.createRTTTex2D(e,i),this.Gj[t].toCubeTexture(),this.Gj[t].name="sys_cube_rttTex_"+t,this.Gj[t].minFilter=r.TextureConst.LINEAR,this.Gj[t].magFilter=r.TextureConst.LINEAR,this.Gj[t].__$setRenderProxy(this.d),this.Gj[t])}getRTTTextureAt(t){return null!=this.Gi[t]?(this.Gi[t].__$setRenderProxy(this.d),this.Gi[t]):(this.Gi[t]=this.createRTTTex2D(32,32),this.Gi[t].to2DTexture(),this.Gi[t].name="sys_rttTex_"+t,this.Gi[t].minFilter=r.TextureConst.LINEAR,this.Gi[t].magFilter=r.TextureConst.LINEAR,this.Gi[t].__$setRenderProxy(this.d),this.Gi[t])}createRTTTextureAt(t,e,i){return e=e>1?e:1,i=i>1?i:1,null!=this.Gi[t]?(this.Gi[t].__$setRenderProxy(this.d),this.Gi[t]):(this.Gi[t]=this.createRTTTex2D(e,i),this.Gi[t].to2DTexture(),this.Gi[t].name="sys_rttTex_"+t,this.Gi[t].minFilter=r.TextureConst.LINEAR,this.Gi[t].magFilter=r.TextureConst.LINEAR,this.Gi[t].__$setRenderProxy(this.d),this.Gi[t])}getDepthTextureAt(t){return null!=this.Gl[t]?(this.Gl[t].__$setRenderProxy(this.d),this.Gl[t]):(this.Gl[t]=this.createDepthTex2D(64,64),this.Gl[t].to2DTexture(),this.Gl[t].name="sys_depthTex_"+t,this.Gl[t].minFilter=r.TextureConst.NEAREST,this.Gl[t].magFilter=r.TextureConst.NEAREST,this.Gl[t].__$setRenderProxy(this.d),this.Gl[t])}createDepthTextureAt(t,e,i){return e=e>1?e:1,i=i>1?i:1,null!=this.Gl[t]?(this.Gl[t].__$setRenderProxy(this.d),this.Gl[t]):(this.Gl[t]=this.createDepthTex2D(e,i),this.Gl[t].to2DTexture(),this.Gl[t].name="sys_depthTex_"+t,this.Gl[t].__$setRenderProxy(this.d),this.Gl[t])}getRTTFloatTextureAt(t){if(null!=this.Gk[t])return this.Gk[t].__$setRenderProxy(this.d),this.Gk[t];let e=this.createRTTTex2D(64,64);return e.to2DTexture(),this.Gk[t]=e,this.Gk[t].name="sys_rttFloatTex_"+t,e.internalFormat=r.TextureFormat.RGBA16F,e.srcFormat=r.TextureFormat.RGBA,e.dataType=r.TextureDataType.FLOAT,e.minFilter=r.TextureConst.NEAREST,e.magFilter=r.TextureConst.NEAREST,h.default.IsWebGL1()&&(e.dataType=r.TextureDataType.HALF_FLOAT_OES),this.Gk[t].__$setRenderProxy(this.d),e}createRTTFloatTextureAt(t,e,i){if(e=e>1?e:1,i=i>1?i:1,null!=this.Gk[t])return this.Gk[t].__$setRenderProxy(this.d),this.Gk[t];let s=this.createRTTTex2D(e,i);return s.to2DTexture(),this.Gk[t]=s,this.Gk[t].name="sys_rttFloatTex_"+t,s.internalFormat=r.TextureFormat.RGBA16F,s.srcFormat=r.TextureFormat.RGBA,s.dataType=r.TextureDataType.FLOAT,s.minFilter=r.TextureConst.NEAREST,s.magFilter=r.TextureConst.NEAREST,h.default.IsWebGL1()&&(s.dataType=r.TextureDataType.HALF_FLOAT_OES),this.Gk[t].__$setRenderProxy(this.d),s}}e.RTTTextureStore=o,e.default=o},cd57:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=i("a52f");class n{constructor(){this.campType=a.CampType.Blue,this.attackDst=null,this.dstPos=new r.default,this.bulType=0,this.delayTime=2,this.value=30,this.status=0}reset(){this.delayTime=2,this.status=0}trigger(){return this.delayTime>0&&this.delayTime--,this.delayTime<1}}e.default=n},cf91:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("faa5")),a=s(i("b3bd")),n=s(i("0fc4")),l=s(i("6e01")),h=s(i("1ea6")),o=i("f3a2");class m extends r.default{constructor(){super(),this.decorator=null,this.texturesTotal=0,this.vertUniform=null}initialize(t){t=this.texturesTotal>0,super.initialize(t),this.adaptationShaderVersion=!1}buildShader(){null!=this.vertUniform&&this.vertUniform.use(this.A_s),this.decorator.buildShader()}getShaderCodeObjectUUID(){return o.ShaderCodeUUID.PBR}getUniqueShaderName(){return null!=this.vertUniform?this.decorator.getUniqueShaderName()+this.vertUniform.getUniqueNSKeyString():this.decorator.getUniqueShaderName()}toString(){return"[PBRShaderBuffer()]"}static GetInstance(){return m.H2}}m.H2=new m;class _ extends n.default{constructor(){super(),this.Gm=128,this.Gn=128,this.Go=new Float32Array([0,0,1,.02,1,.1,1,1,.1,.1,.1,1,1,1,1,.07]),this.Fz=null,this.Fw=null,this.Gp=new Float32Array([0,0,-1,1,1,.3,0,0]),this.decorator=null,this.vertUniform=null}buildBuf(){let t=m.GetInstance(),e=this.decorator;t.lightEnabled=e.lightEnabled,t.shadowReceiveEnabled=e.shadowReceiveEnabled,t.fogEnabled=e.fogEnabled,t.buildPipelineParams(),t.decorator=e,t.vertUniform=this.vertUniform,t.decorator.codeBuilder=t.getShaderCodeBuilder(),null==this.Fz&&this.initializeLocalData();let i=e.createTextureList();null!=this.vertUniform&&this.vertUniform.getTextures(t.getShaderCodeBuilder(),i),t.getTexturesFromPipeline(i),super.setTextureList(i),t.texturesTotal=i.length}getCodeBuf(){return m.GetInstance()}initializeLocalData(){null!=this.vertUniform&&this.vertUniform.initialize();let t=this.decorator;t.fragLocalParamsTotal=2,t.parallaxParamIndex=2,null!=t.parallaxMap&&(t.fragLocalParamsTotal+=1),this.Fz=new Float32Array(4*t.fragLocalParamsTotal),this.Fz.set([0,0,0,1,.2,.2,.2,0],0),null!=t.parallaxMap&&(this.Fw=this.Fz.subarray(4*t.parallaxParamIndex,4*(t.parallaxParamIndex+1)),this.Fw.set([1,10,2,.1]))}copyFrom(t){this.setMaterialPipeline(t.AK),null==this.decorator&&(this.decorator=new h.default),this.decorator.copyFrom(t.decorator),this.vertUniform=t.vertUniform,null==this.Go||this.Go.length!=t.Go.length?this.Go=t.Go.slice():this.Go.set(t.Go),null==this.Fz||this.Fz.length!=t.Fz.length?this.Fz=t.Fz.slice():this.Fz.set(t.Fz),null==this.Gp||this.Gp.length!=t.Gp.length?this.Gp=t.Gp.slice():this.Gp.set(t.Gp)}setTextureList(t){}clone(){let t=new _;return t.copyFrom(this),t}seNormalMapIntensity(t){t=Math.min(Math.max(t,0),1),this.Fz[4]=t}setPixelNormalNoiseIntensity(t){t=Math.min(Math.max(t,0),2),this.Go[3]=t}getPixelNormalNoiseIntensity(){return this.Go[3]}setMirrorViewNV(t){this.Gp[0]=t.x,this.Gp[1]=t.y,this.Gp[2]=t.z}setMirrorPlaneNV(t){}setMirrorMapLodLevel(t){this.Gp[3]=t}setMirrorIntensity(t){this.Gp[4]=Math.min(Math.max(t,.01),2)}setMirrorMixFactor(t){this.Gp[5]=Math.min(Math.max(t,.01),2)}setEnvMapLodMipMapLevel(t,e=0){t=Math.min(Math.max(t,0),14),e=Math.min(Math.max(e,-7),12),this.Go[15]=.01*Math.round(t)+e}setEnvMapLodMipMapLevelWithSize(t,e,i=0){this.Gm=t,this.Gn=e,i=Math.min(Math.max(i,-7),12),this.Go[15]=.01*l.default.GetMaxMipMapLevel(t,e)+i}setScatterIntensity(t){this.Go[11]=Math.min(Math.max(t,.01),512)}getScatterIntensity(){return this.Go[11]}setToneMapingExposure(t){this.Go[4]=Math.min(Math.max(t,.1),128)}getToneMapingExposure(){return this.Go[4]}setReflectionIntensity(t){this.Go[5]=Math.min(Math.max(t,.001),1)}getReflectionIntensity(){return this.Go[5]}setSurfaceIntensity(t){this.Go[6]=Math.min(Math.max(t,.001),32)}getSurfaceIntensity(){return this.Go[6]}setSideIntensity(t){this.Go[7]=Math.min(Math.max(t,.001),32)}getSideIntensity(){return this.Go[7]}setEnvSpecularColorFactor(t,e,i){this.Go[12]=t,this.Go[13]=e,this.Go[14]=i}getEnvSpecularColorFactor(t){t.r=this.Go[12],t.g=this.Go[13],t.b=this.Go[14]}setAmbientFactor(t,e,i){this.Go[8]=t,this.Go[9]=e,this.Go[10]=i}getAmbientFactor(t){t.r=this.Go[8],t.g=this.Go[9],t.b=this.Go[10]}setMetallic(t){this.Go[0]=Math.min(Math.max(t,.05),1)}getMetallic(){return this.Go[0]}setRoughness(t){this.Go[1]=Math.min(Math.max(t,.05),1)}getRoughness(){return this.Go[1]}setAO(t){this.Go[2]=t}getAO(){return this.Go[2]}setF0(t,e,i){this.Fz[0]=t,this.Fz[1]=e,this.Fz[2]=i}getF0(t){t.r=this.Fz[0],t.g=this.Fz[1],t.b=this.Fz[2]}setAlbedoColor(t,e,i){this.Fz[4]=t,this.Fz[5]=e,this.Fz[6]=i}getAlbedoColor(t){t.r=this.Fz[4],t.g=this.Fz[5],t.b=this.Fz[6]}setParallaxParams(t=1,e=10,i=2,s=.1){null!=this.Fw&&(this.Fw[0]=t,this.Fw[1]=e,this.Fw[2]=i,this.Fw[3]=s)}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_pbrParams","u_fragLocalParams","u_mirrorParams"],t.dataList=[this.Go,this.Fz,this.Gp],null!=this.vertUniform&&this.vertUniform.buildShaderUniformData(t),t}destroy(){this.vertUniform=null,this.Go=null,this.Fz=null,this.Gp=null,super.destroy()}}e.default=_},cfaf:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("8d98"),a=s(i("0851"));class n extends a.default{constructor(t,e,i=!1){super(t,e,i),this.n=r.TextureProxyType.RTT,this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST}to2DTexture(){this.k=r.TextureTarget.TEXTURE_2D}enableMipmap(){this.minFilter=r.TextureConst.LINEAR_MIPMAP_LINEAR,this.magFilter=r.TextureConst.LINEAR,this.mipmapEnabled=!0}disableMipmap(){this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.mipmapEnabled=!1}toCubeTexture(){this.k=r.TextureTarget.TEXTURE_CUBE}setSize(t,e){this.g=t,this.h=e}uploadFromFbo(t,e,i){let s=t.getRC(),a=this.mipmapEnabled;this.mipmapEnabled=!1,t.hasResUid(this.getResUid())?this.getBufWidth()==e&&this.getBufHeight()==i||(t.bindToGpu(this.getResUid()),this.bindTexture(s,e,i),this.g=e,this.h=i,this.__$buildParam(s)):(this.l=r.TextureTarget.GetValue(s,this.k),this.createTexBuf(t),t.bindToGpu(this.getResUid()),this.bindTexture(s,e,i),this.m=!0,this.g=e,this.h=i,this.__$buildParam(s)),this.mipmapEnabled=a}bindTexture(t,e,i){let s=r.TextureFormat.ToGL(t,this.internalFormat),a=r.TextureFormat.ToGL(t,this.srcFormat),n=r.TextureDataType.ToGL(t,this.dataType);switch(this.k){case r.TextureTarget.TEXTURE_2D:t.texImage2D(t.TEXTURE_2D,0,s,e,i,0,a,n,null);break;case r.TextureTarget.TEXTURE_CUBE:for(let r=0;r<6;++r)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,s,e,i,0,a,n,null);break;case r.TextureTarget.TEXTURE_SHADOW_2D:t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT16,e,i,0,t.DEPTH_COMPONENT,t.FLOAT,null);break;default:break}}toString(){return"[RTTTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},d1a0:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01"));class a{static PlaneCalcIntersectSphere(t,e,i,s){a.IntersectBoo=!1,a.IntersectSatus=0,e=t.dot(i)-e,e>r.default.MATH_MIN_POSITIVE?(a.IntersectBoo=e<=s,a.IntersectSatus=1):e<r.default.MATH_MAX_NEGATIVE&&(a.IntersectBoo=-e<=s,a.IntersectSatus=-1)}static CalcPVCloseV(t,e,i,s){let r=e-i.dot(t);s.setTo(r*t.x,r*t.y,r*t.z),s.addBy(i)}static CalcPVCloseV2(t,e,i,s){let r=e-i.dot(t);s.setTo(r*t.x,r*t.y,r*t.z),s.addBy(i)}static IntersectionSLV2(t,e,i,s,a){let n=t.dot(s);if(n>r.default.MATH_MIN_POSITIVE||n<r.default.MATH_MAX_NEGATIVE){let r=t.dot(i)-e;return a.x=1e5*s.x+i.x,a.y=1e5*s.y+i.y,a.z=1e5*s.z+i.z,n=t.dot(a)-e,n=r/(r-n),a.subtractBy(i),a.scaleBy(n),a.addBy(i),1}return n=t.dot(i)-e,n<=r.default.MATH_MIN_POSITIVE||n>=r.default.MATH_MAX_NEGATIVE?(a.copyFrom(i),2):0}}a.IntersectBoo=!1,a.IntersectSatus=0,e.default=a},d314:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("8d98"),a=s(i("0851"));class n extends a.default{constructor(t,e){super(t,e,!1),this.C_F=null,this.k=r.TextureTarget.TEXTURE_CUBE,this.n=r.TextureProxyType.ImageCube,this.internalFormat=r.TextureFormat.RGBA,this.srcFormat=r.TextureFormat.RGBA,this.dataType=r.TextureDataType.UNSIGNED_BYTE,this.mipmapEnabled=!0}setDataFromImageToFaceAt(t,e,i=0){null!=e&&(null==this.C_F&&(this.C_F=[null,null,null,null,null,null]),e.width>0&&e.height>0&&(0==t&&(this.g=e.width,this.h=e.height,this.f=i),this.C_F[t]={imgData:e,miplevel:i},this.m=null!=this.C_F[t]))}uploadData(t){let e=t.getRC(),i=null;for(let s=0;s<6;++s)i=this.C_F[s],e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+s,this.f,r.TextureFormat.ToGL(e,this.internalFormat),r.TextureFormat.ToGL(e,this.srcFormat),r.TextureDataType.ToGL(e,this.dataType),i.imgData)}toString(){return"[ImageCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.C_F)for(let t=0;t<6;++t)null!=this.C_F[t]&&(this.C_F[t].imgData=null);super.__$destroy()}}}e.default=n},d53d:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.uns="",this.program=null,this.types=null,this.uniformSize=0,this.uniformNameList=null,this.locations=null,this.dataSizeList=null,this.dataList=null,this.calcModels=null,this.always=!0,this.next=null}getDataRefFromUniformName(t){if(null!=this.uniformNameList){let e=this.uniformNameList,i=e.length;for(let s=0;s<i;++s)if(t==e[s])return this.dataList[s]}return null}setDataRefFromUniformName(t,e){if(null!=this.uniformNameList){let i=this.uniformNameList,s=i.length;for(let r=0;r<s;++r)if(t==i[r]){this.dataList[r]=e;break}}}copyDataFromProbe(t){this.types=[],this.dataSizeList=[];for(let e=0;e<t.uniformsTotal;++e)this.types.push(t.uniformTypes[e]),this.dataSizeList.push(t.dataSizeList[e]);this.uniformSize=t.uniformsTotal}useByLocation(t,e,i,s){}useByShd(t,e){}use(t){}updateData(){}destroy(){}}e.ShaderUniform=s;class r extends s{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV1(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e])}useByLocation(t,e,i,s){t.useUniformV1(i,e,this.dataList[s],this.dataSizeList[s])}useByShd(t,e){let i=0;for(;i<this.uniformSize;++i)t.useUniformV1(e.getUniformLocationByNS(this.uniformNameList[i]),this.types[i],this.dataList[i],this.dataSizeList[i])}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let i=0;i<t;++i)e=this.calcModels[i],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null}}e.ShaderUniformV1=r;class a extends s{constructor(){super()}use(t){let e=0;for(;e<this.uniformSize;++e)t.useUniformV2(this.locations[e],this.types[e],this.dataList[e],this.dataSizeList[e],0)}useByLocation(t,e,i,s){t.useUniformV2(i,e,this.dataList[s],this.dataSizeList[s],0)}useByShd(t,e){let i=0;for(;i<this.uniformSize;++i)t.useUniformV2(e.getUniformLocationByNS(this.uniformNameList[i]),this.types[i],this.dataList[i],this.dataSizeList[i],0)}updateData(){if(null!=this.calcModels){let t=this.calcModels.length,e=null;for(let i=0;i<t;++i)e=this.calcModels[i],e.buildData(),e.updateMaterialDataList(this.dataList),e.initializeParam()}}destroy(){let t=0,e=this.dataList.length;for(;t<e;++t)this.dataList[t]=null;if(null!=this.calcModels)for(e=this.calcModels.length,t=0;t<e;++t)this.calcModels[t].destroy(),this.calcModels[t]=null;this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null,this.calcModels=null,this.program=null}}e.ShaderUniformV2=a;class n extends s{constructor(){super()}use(t){t.useUniformMat4(this.locations[0],this.dataList[0])}useByLocation(t,e,i,s){t.useUniformMat4(i,this.dataList[0])}useByShd(t,e){t.useUniformMat4(e.getUniformLocationByNS(this.uniformNameList[0]),this.dataList[0])}destroy(){this.dataList[0]=null,this.dataList=null,this.types=null,this.locations=null,this.dataSizeList=null}}e.ShaderMat4Uniform=n,e.default=s},d63d:function(t,e,i){"use strict";i.r(e),i.d(e,"LambertLightShaderCode",(function(){return l}));var s="worldNormal.xyz = v_worldNormal;\r\nworldPosition.xyz = v_worldPosition;\r\nvec3 N = worldNormal.xyz;\r\nvec4 color = u_fragLocalParams[0];\r\n#ifdef VOX_DIFFUSE_MAP\r\n    color = color * VOX_Texture2D(VOX_DIFFUSE_MAP, v_uv.xy);\r\n#endif\r\n\r\ncolor.xyz += u_fragLocalParams[1].xyz;\r\n#ifdef VOX_USE_VTX_COLOR\r\n    color.xyz *= v_cv.xyz;\r\n#endif\r\n\r\nvec3 ao = vec3(1.0);\r\nvec2 texUV = v_uv.xy;\r\n#ifdef VOX_LIGHT_LOCAL_PARAMS_INDEX\r\n    vec4 param;\r\n    vec3 viewDir = normalize(u_cameraPosition.xyz - worldPosition.xyz);\r\n    #ifdef VOX_PARALLAX_MAP\r\n        #ifdef VOX_NORMAL_MAP\r\n            mat3 btnMat3 = getBTNMat3(v_uv, worldPosition.xyz, worldNormal.xyz);\r\n            vec3 tbnViewDir = btnMat3 * viewDir;\r\n            \r\n            //default value: vec4(1.0,10.0,2.0,0.1)\r\n            param = u_fragLocalParams[ VOX_PARALLAX_PARAMS_INDEX ];\r\n            texUV = parallaxOccRayMarchDepth(VOX_PARALLAX_MAP, v_uv, -tbnViewDir, param);\r\n            #ifdef VOX_NORMAL_MAP\r\n                N = btnMat3 * normalize(getNormalFromMap(VOX_NORMAL_MAP, texUV));\r\n            #endif\r\n        #endif\r\n    #else\r\n        #ifdef VOX_NORMAL_MAP\r\n            N = normalize(getNormalFromMap(VOX_NORMAL_MAP, texUV, worldNormal.xyz));\r\n        #endif\r\n    #endif\r\n\r\n    #ifdef VOX_AO_MAP\r\n        ao = VOX_Texture2D(VOX_AO_MAP, texUV).yyy;\r\n    #endif\r\n\r\n    int lightParamIndex = VOX_LIGHT_LOCAL_PARAMS_INDEX;\r\n    param = u_fragLocalParams[ VOX_LIGHT_LOCAL_PARAMS_INDEX ];\r\n    \r\n    LambertLight light;\r\n    light.normal = N;\r\n    light.viewDirec = viewDir;\r\n    light.diffuse = color.xyz;\r\n    light.specular = param.xyz;\r\n\r\n    light.specularPower = param.w;\r\n    param = u_fragLocalParams[ VOX_LIGHT_LOCAL_PARAMS_INDEX + 1 ];\r\n    light.param = param;\r\n    vec4 param4;\r\n    #ifdef VOX_SPECULAR_MAP\r\n        param4 = VOX_Texture2D(VOX_SPECULAR_MAP, texUV);\r\n        #if VOX_SPECULAR_MODE == 2\r\n            light.specular *= color.xyz;\r\n        #elif VOX_SPECULAR_MODE == 3\r\n            light.specular *= param4.xyz;\r\n        #endif\r\n        light.specularPower = max(1.0, light.specularPower * param4.z);\r\n    #endif\r\n    vec3 destColor = getLambertLightColor(light);\r\n\r\n    #ifdef VOX_ENV_AMBIENT_LIGHT_LIGHT_MAP\r\n        param4 = u_envLightParams[4];\r\n        param4.xyz = color.xyz * VOX_Texture2D(VOX_ENV_AMBIENT_LIGHT_LIGHT_MAP, (param4.xy + worldPosition.xz) / param4.zw).xyz;\r\n        destColor.xyz += param4.xyz * u_envLightParams[0].xyz * ao;\r\n    #endif\r\n    color.xyz = color.xyz * param.z + param.w * destColor;\r\n#else\r\n    #ifdef VOX_AO_MAP\r\n        ao = VOX_Texture2D(VOX_AO_MAP, texUV).yyy;\r\n    #endif\r\n#endif\r\n\r\ncolor.xyz *= ao;\r\ncolor.xyz += u_fragLocalParams[ VOX_LIGHT_LOCAL_PARAMS_INDEX + 2 ].xyz * ao;\r\n\r\nFragColor0 = color;\r\n//[x: displacement, y: ao, z: specular, w: occ]",r="#ifdef VOX_NORMAL_MAP\r\nvec3 getNormalFromMap(sampler2D texSampler, vec2 texUV, vec3 nv)\r\n{\r\n    vec3 tangentNormal = VOX_Texture2D(texSampler, texUV).xyz * 2.0 - 1.0;\r\n\r\n    vec3 Q1  = dFdx(worldPosition.xyz);\r\n    vec3 Q2  = dFdy(worldPosition.xyz);\r\n    vec2 st1 = dFdx(texUV);\r\n    vec2 st2 = dFdy(texUV);\r\n\r\n    vec3 N   = normalize(nv);\r\n    vec3 T  = normalize(Q1*st2.t - Q2*st1.t);\r\n    vec3 B  = normalize(cross(T, N));\r\n\r\n    mat3 TBN = mat3(T, B, N);\r\n\r\n    return TBN * tangentNormal;\r\n}\r\nvec3 getNormalFromMap(in sampler2D texSampler, in vec2 texUV)\r\n{\r\n    return VOX_Texture2D(texSampler, texUV).xyz * 2.0 - 1.0;\r\n}\r\n#endif\r\n#ifdef VOX_PARALLAX_MAP\r\nmat3 getBTNMat3(in vec2 texUV, in vec3 pos, in vec3 nv)\r\n{\r\n    vec3 Q1  = dFdx(pos);\r\n    vec3 Q2  = dFdy(pos);\r\n    vec2 st1 = dFdx(texUV);\r\n    vec2 st2 = dFdy(texUV);\r\n\r\n    vec3 N  = normalize(nv);\r\n    vec3 T  = normalize(Q1*st2.t - Q2*st1.t);    \r\n    vec3 B  = -normalize(cross(N, T));\r\n    return mat3(T, B, N);\r\n}\r\n//const vec4 occParam = vec4(1.0,10.0,2.0,0.1);\r\nvec2 parallaxOccRayMarchDepth(sampler2D texSampler, vec2 puvs, vec3 viewDir,vec4 occParam)\r\n{\r\n    float depthValue = 1.0 - VOX_Texture2D(texSampler, puvs).r;\r\n    float numLayers = mix(occParam.x, occParam.y, max(dot(vec3(0.0, 0.0, 1.0), viewDir),0.0));\r\n    float layerHeight = occParam.z / numLayers;\r\n    vec2 tuv = (viewDir.xy * occParam.w) / numLayers;  \r\n    float ph = 0.0;\r\n    #ifndef VOX_GLSL_ES2\r\n        while(ph < depthValue)\r\n        {\r\n            puvs -= tuv;\r\n            depthValue = 1.0 - VOX_Texture2D(texSampler, puvs).r;\r\n            ph += layerHeight;\r\n        }\r\n    #else\r\n        for(int i = 0; i < 10; i++) {\r\n            if(ph < depthValue)\r\n            {\r\n                puvs -= tuv;\r\n                depthValue = 1.0 - VOX_Texture2D(texSampler, puvs).r;\r\n                ph += layerHeight;\r\n            }\r\n            else {\r\n                break;\r\n            }\r\n        }\r\n    #endif\r\n    tuv += puvs;\r\n    depthValue -= ph;\r\n    ph = 1.0 - VOX_Texture2D(texSampler, tuv).r - ph + layerHeight;\r\n    float weight = depthValue / (depthValue - ph);\r\n    //return puvs * (1.0 - weight) + tuv * weight;\r\n    return mix(puvs, tuv, weight);\r\n}\r\n#endif\r\n#ifdef VOX_LIGHTS_TOTAL\r\n#if VOX_LIGHTS_TOTAL > 0\r\n\r\nstruct LambertLight {\r\n    // surface normal\r\n\tvec3 normal;\r\n    // diffuse color\r\n\tvec3 diffuse;\r\n    // specular color\r\n\tvec3 specular;\r\n    // view direction\r\n    vec3 viewDirec;\r\n    // light direction per pixel\r\n    vec3 direc;\r\n    // light color\r\n    vec3 color;\r\n    vec4 param;\r\n    float specularPower;\r\n};\r\nvec3 calcLambertLight(in LambertLight light) {\r\n\r\n    float nDotL = max(dot(light.normal, light.direc), 0.0);\r\n\tvec3 baseColor = nDotL * light.diffuse * light.color;\r\n\tvec3 viewDir = normalize(light.direc + light.viewDirec);\r\n\tvec3 specularColor = light.color * light.specular * nDotL * pow(max(dot(light.normal, viewDir), 0.0), light.specularPower);\r\n    vec2 param = light.param.xy;\r\n\treturn (baseColor * param.x + param.y * specularColor);\r\n}\r\n\r\n#endif\r\nvec3 getLambertLightColor(in LambertLight light) {\r\n    #if VOX_LIGHTS_TOTAL > 0\r\n        vec4 color4;\r\n        vec4 param4;\r\n        vec3 destColor = vec3(0.0);\r\n        // point light process\r\n        #if VOX_POINT_LIGHTS_TOTAL > 0\r\n            for(int i = 0; i < VOX_POINT_LIGHTS_TOTAL; ++i)\r\n            {\r\n                param4 = u_lightPositions[i];\r\n                color4 = u_lightColors[i];\r\n                light.color = color4.xyz;\r\n                // calculate per-light radiance\r\n                light.direc = (param4.xyz - worldPosition.xyz);\r\n                float distance = length(light.direc);\r\n                float attenuation = 1.0 / (1.0 + param4.w * distance + color4.w * distance * distance);\r\n                light.direc = normalize(light.direc);\r\n                light.color *= attenuation;\r\n                destColor += calcLambertLight( light );// * attenuation;\r\n            }\r\n        #endif\r\n        // direction light process\r\n        #if VOX_DIRECTION_LIGHTS_TOTAL > 0\r\n            for(int i = VOX_POINT_LIGHTS_TOTAL; i < (VOX_POINT_LIGHTS_TOTAL + VOX_DIRECTION_LIGHTS_TOTAL); ++i) \r\n            {\r\n                light.direc = normalize(-u_lightPositions[i].xyz);\r\n                light.color = u_lightColors[i].xyz;\r\n                destColor += calcLambertLight( light );\r\n            }\r\n        #endif\r\n        // spot light process\r\n        #if VOX_SPOT_LIGHTS_TOTAL > 0\r\n            \r\n            for(int i = (VOX_POINT_LIGHTS_TOTAL + VOX_DIRECTION_LIGHTS_TOTAL); i < VOX_LIGHTS_TOTAL; ++i) \r\n            {\r\n                param4 = u_lightPositions[i];\r\n                color4 = u_lightColors[i];\r\n                //light.color = color4.xyz;\r\n                light.direc = param4.xyz - worldPosition.xyz;\r\n\r\n                float factor = length( light.direc );\r\n                float attenuation = 1.0 / (1.0 + param4.w * factor + color4.w * factor * factor);\r\n                light.color = color4.xyz * attenuation;\r\n                \r\n                param4 = u_lightPositions[i + VOX_SPOT_LIGHTS_TOTAL];\r\n                param4.xyz = normalize( param4.xyz );\r\n                light.direc = normalize( light.direc );\r\n                float ft = abs(param4.w) + 0.001;\r\n                factor = (1.0 - max(dot(-param4.xyz, light.direc), 0.0));\r\n                factor = min(1.0 - (factor / ft), 1.0);\r\n                //factor = max(factor, 0.0001);\r\n                \r\n                destColor += calcLambertLight( light ) * factor;\r\n            }\r\n        #endif\r\n        return destColor;\r\n    #else\r\n        return srcColor.xyz;\r\n    #endif\r\n}\r\n#endif",a="    initLocalVtx();\r\n\r\n    worldPosition = u_objMat * localPosition;\r\n    viewPosition = u_viewMat * worldPosition;\r\n    gl_Position = u_projMat * viewPosition;\r\n    // temporary code plan\r\n    #ifdef VOX_DISPLACEMENT_MAP\r\n        v_worldPosition.xyz = (u_objMat * vec4(a_vs.xyz, 1.0)).xyz;\r\n    #else\r\n        v_worldPosition.xyz = worldPosition.xyz;\r\n    #endif\r\n\r\n    #ifdef VOX_USE_NORMAL\r\n        v_worldNormal.xyz = normalize(a_nvs.xyz * inverse(mat3(u_objMat)));\r\n    #endif\r\n    #ifdef VOX_USE_VTX_COLOR\r\n        v_cv.xyz = a_cvs.xyz;\r\n    #endif",n="\r\n#ifdef VOX_DISPLACEMENT_MAP\r\nvoid displaceLocalVtx(in vec2 param) {\r\n    float dispFactor = VOX_Texture2D(VOX_DISPLACEMENT_MAP, v_uv.xy).x;\r\n    localPosition.xyz += normalize( a_nvs.xyz ) * vec3( dispFactor * param.x + param.y );\r\n}\r\n#endif\r\n\r\nvoid initLocalVtx() {\r\n    localPosition = vec4(a_vs.xyz, 1.0);\r\n    int paramIndex = 0;\r\n    // vertex transform calculation\r\n    #ifdef VOX_VTX_CURVE_MOVE_PARAM_INDEX\r\n        vec4 params = u_vertLocalParams[VOX_VTX_CURVE_MOVE_PARAM_INDEX];\r\n        float index = abs(mod((a_vs.w + params[1]),params[2]));\r\n        index *= params[0];\r\n        vec2 puv = vec2(fract(index), floor(index) * params[0]);\r\n        localPosition.xyz += VOX_Texture2D(VTX_CURVE_MOVE_MAP, puv).xyz;\r\n    #endif\r\n        \r\n    #ifdef VOX_VTX_TRANSFORM_PARAM_INDEX\r\n        paramIndex = VOX_VTX_TRANSFORM_PARAM_INDEX;\r\n        v_uv = a_uvs.xy * u_vertLocalParams[paramIndex].xy + u_vertLocalParams[paramIndex].zw;\r\n    #elif VOX_USE_2D_MAP\r\n        v_uv = a_uvs.xy;\r\n    #endif\r\n\r\n    #ifdef VOX_DISPLACEMENT_MAP\r\n        displaceLocalVtx( u_vertLocalParams[VOX_DISPLACEMENT_PARAMS_INDEX].xy );\r\n    #endif\r\n}";const l={vert:"",vert_head:n,vert_body:a,frag:"",frag_head:r,frag_body:s,uuid:"lambert"}},d7e2:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17"));class a{constructor(t){this.A7=null,this.A7=t}sortRODisplay(t,e){let i=this.A7.getCamera().getPosition();for(let s=0;s<e;++s)t[s].value=-r.default.DistanceSquared(t[s].bounds.center,i);return 0}}e.default=a},d846:function(t,e,i){"use strict";i.r(e),i.d(e,"VSMShaderCode",(function(){return a}));var s="vec4 pack2HalfToRGBA( vec2 v ) {\r\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\r\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\r\n}\r\nvec2 unpackRGBATo2Half( vec4 v ) {\r\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\r\n}\r\n\r\nvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\r\n\r\n    return unpackRGBATo2Half( VOX_Texture2D( shadow, uv ) );\r\n\r\n}\r\n#ifdef VOX_USE_SHADOW\r\nfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ) {\r\n\r\n    float occlusion = 1.0;\r\n\r\n    vec2 distribution = texture2DDistribution( shadow, uv );\r\n\r\n    float hard_shadow = step( compare , distribution.x ); // Hard Shadow\r\n\r\n    if (hard_shadow != 1.0 ) {\r\n\r\n        float distance = compare - distribution.x ;\r\n        float variance = max( 0.0, distribution.y * distribution.y );\r\n        float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\r\n        softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\r\n        occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\r\n\r\n    }\r\n    return occlusion;\r\n\r\n}\r\nfloat getVSMShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\r\n\r\n    float shadow = 1.0;\r\n    \r\n    shadowCoord.xyz /= shadowCoord.w;\r\n    shadowCoord.z += shadowBias;\r\n    \r\n    // if ( something && something ) breaks ATI OpenGL shader compiler\r\n    // if ( all( something, something ) ) using this instead\r\n\r\n    bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\r\n    bool inFrustum = all( inFrustumVec );\r\n\r\n    bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\r\n\r\n    bool frustumTest = all( frustumTestVec );\r\n\r\n    if ( frustumTest ) {\r\n        shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\r\n    }\r\n    return shadow;\r\n}\r\nfloat getVSMShadowFactor(in vec4 shadowPos) {\r\n    \r\n    float shadow = getVSMShadow( VOX_VSM_SHADOW_MAP, u_vsmParams[1].xy, u_vsmParams[0].x, u_vsmParams[0].z, shadowPos );\r\n    float shadowIntensity = 1.0 - u_vsmParams[0].w;\r\n    shadow = clamp(shadow, 0.0, 1.0) * (1.0 - shadowIntensity) + shadowIntensity;\r\n    float f = clamp(dot(worldNormal,u_vsmParams[2].xyz),0.001,1.0);\r\n    shadow = f > 0.0001 ? min(shadow,clamp(f, shadowIntensity,1.0)) : shadowIntensity;\r\n    f = u_vsmParams[1].z;\r\n    return shadow * (1.0 - f) + f;\r\n}\r\nvoid useVSMShadow(inout vec4 color) {\r\n    \r\n    float factor = getVSMShadowFactor(v_shadowPos);\r\n    color.xyz *= vec3(factor);\r\n}\r\n#endif";let r="\nvoid calcShadowPos(in vec4 wpos) {\n    v_shadowPos = u_shadowMat * wpos;\n}\n";const a={vert:"",vert_head:r,vert_body:"\n#ifdef VOX_USE_SHADOW\n// calcShadowPos( worldPosition );// if use worldPosition , it make shadow calculation error.\ncalcShadowPos( u_objMat * vec4(a_vs.xyz, 1.0) );\n#endif\n",frag:"",frag_head:s,frag_body:"\n#ifdef VOX_USE_SHADOW\nuseVSMShadow( FragColor0 );\n#endif\n"}},d958:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("11e6")),a=s(i("36cb")),n=s(i("c497")),l=s(i("3c81")),h=s(i("1e15")),o=s(i("0e01")),m=i("eca0"),_=s(i("442e")),u=s(i("1264"));class d{constructor(){this.___$$$$$$$Author="VilyLei(vily313@126.com)",this.T=-1,this.Gq=null,this.Gr=[],this.Gs=0,this.Gt=[],this.Gu=0,this.d=null,this.AE=null,this.Aw=null,this.Gv=null,this.B_T=!0,this.Gw=!0,this.Av=new m.RPOUnitBuilder,this.B_R=new _.default,this.Ax=new l.default,this.B6=null,this.A_9=null,this.Gx=null,this.T=d.H0++,this.Gv=new o.default(this.T)}__$setStage3D(t){null!=t&&null==this.A_9&&(this.A_9=t)}getUid(){return this.T}getRCUid(){return this.T}getRPONodeBuilder(){return this.B_R}getDataBuilder(){return this.Aw}getRendererContext(){return this.Gv}getRenderProxy(){return null!=this.d||(this.d=this.Gv.getRenderProxy()),this.d}getStage3D(){return this.d.getStage3D()}getViewX(){return this.AE.getViewportX()}getViewY(){return this.AE.getViewportY()}getViewWidth(){return this.AE.getViewportWidth()}getViewHeight(){return this.AE.getViewportHeight()}getCamera(){return this.Gv.getCamera()}createCamera(){return null}useCamera(t,e=!1){}useMainCamera(){}updateCamera(){null!=this.d&&this.d.updateCamera()}initialize(t=null,e=null){null==this.Aw&&null!=e&&(null==t&&(t=new n.default),this.B_T=t.batchEnabled,this.Gw=t.processFixedState,this.d=this.Gv.getRenderProxy(),this.Aw=new a.default,this.B6=new h.default,this.Gv.setCameraParam(t.camProjParam.x,t.camProjParam.y,t.camProjParam.z),this.Gv.initialize(t,e,this.A_9,this.Aw,this.B6),this.AE=this.d.getRenderAdapter(),this.T=this.d.getUid(),this.Aw.initialize(this.d,this.Av,this.Ax,this.B6),this.Gv.initManager(this.Aw),this.Gq=new u.default(this.T,this.Aw,this.Av,this.Ax),this.Gx=this.createSeparatedProcess(),this.appendProcess(this.B_T,this.Gw))}getRendererStatus(){return this.Gq.version}update(){this.d.Texture.update(),this.d.Vertex.update(),this.Gq.update()}updateAllProcess(){for(let t=0;t<this.Gs;++t)this.Gr[t].update()}updateProcessAt(t){t>-1&&t<this.Gs&&this.Gr[t].update()}setEntityManaListener(t){this.Gq.setListener(t)}addEntity(t,e=0,i=!0){null!=t&&t.__$testRendererEnabled()&&e>-1&&e<this.Gs&&this.Gq.addEntity(t,this.Gr[e].getUid(),i)}addEntityToProcess(t,e,i=!0){null!=e&&null!=t&&t.__$testRendererEnabled()&&e.getRCUid()==this.T&&this.Gq.addEntity(t,e.getUid(),i)}moveEntityToProcessAt(t,e){if(null!=t&&t.getRendererUid()==this.T&&t.isInRendererProcess()&&e>-1&&e<this.Gs){let i=t.getDisplay().__$$runit.getRPROUid(),s=this.Ax.getNodeByUid(i),a=this.Gr[e];s!=a&&(s.removeDispUnit(t.getDisplay()),t.__$rseFlag=a.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),a.addDisp(t.getDisplay()))}}moveEntityToProcess(t,e){if(null!=e&&null!=t&&t.getRendererUid()==this.T&&t.isInRendererProcess()){let i=t.getDisplay().__$$runit.getRPROUid(),s=this.Ax.getNodeByUid(i);if(s!=e){let i=e;s.removeDispUnit(t.getDisplay()),t.__$rseFlag=e.getSortEnabled()?r.default.AddSortEnabled(t.__$rseFlag):r.default.RemoveSortEnabled(t.__$rseFlag),i.addDisp(t.getDisplay())}}}removeEntity(t){null!=t&&t.getRendererUid()==this.T&&(this.Gq.removeEntity(t),t.__$setRenderProxy(null))}removeEntityFromProcess(t,e){null!=e&&e.getRCUid()==this.T&&null!=t&&t.getRendererUid()==this.T&&(e.removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}removeEntityByProcessIndex(t,e){e>=0&&e<this.Gs&&null!=t&&t.getRendererUid()==this.T&&(this.Gr[e].removeDisp(t.getDisplay()),t.__$setRenderProxy(null))}setProcessSortEnabledAt(t,e){t>=0&&t<this.Gs&&this.Gr[t].setSortEnabled(e)}setProcessSortEnabled(t,e){if(null!=t&&t.getRCUid()==this.T){let i=t;i.setSortEnabled(e)}}getRenderProcessAt(t){return this.Gr[t]}appendProcess(t=!0,e=!1){this.Ax.setCreateParams(this.Aw.getRenderShader(),this.B_R,this.Av,this.d.Vertex,t,e);let i=this.Ax.create();return this.Gr.push(i),i.setRendererParam(this.d,this.Gs),++this.Gs,i}createSeparatedProcess(t=!0,e=!1){this.Ax.setCreateParams(this.Aw.getRenderShader(),this.B_R,this.Av,this.d.Vertex,t,e);let i=this.Ax.create();return this.Gt.push(i),i.setRendererParam(this.d,this.Gu),i}setRendererProcessParam(t,e,i){t>-1&&t<this.Gs&&this.Gr[t].setRenderParam(e,i)}getProcessAt(t){return t>-1&&t<this.Gs?this.Gr[t]:null}showInfoAt(t){t>-1&&t<this.Gs&&this.Gr[t].showInfo()}getProcessesTotal(){return this.Gs}updateMaterialUniformToCurrentShd(t){this.Aw.getRenderShader().useUniformToCurrentShd(t.__$uniform)}drawEntityByLockMaterial(t,e=!1,i=!0){null!=t&&t.getVisible()&&t.getRendererUid()==this.T&&!this.d.isContextLost()&&this.Gx.drawLockMaterialByDisp(t.getDisplay(),e,i)}drawEntity(t,e=!1,i=!0){null!=t&&t.getVisible()&&!this.d.isContextLost()&&(t.getRendererUid()==this.T?this.Gx.drawDisp(t.getDisplay(),e,i):t.__$testRendererEnabled()&&this.Gq.addEntity(t,this.Gx.getUid(),!1))}runAt(t){this.d.isContextLost()||this.Gr[t].run()}runProcess(t){t.getRCUid()!=this.T||this.d.isContextLost()||t.run()}runFromIndexTo(t){if(!this.d.isContextLost())for(let e=t;e<this.Gs;++e)this.Gr[e].run()}run(){if(this.Gq.isHaveEntity()&&!this.d.isContextLost())for(let t=0;t<this.Gs;++t)this.Gr[t].run()}getRenderUnitsTotal(){let t=0;for(let e=0;e<this.Gs;++e)t+=this.Gr[e].getUnitsTotal();return t}renderflush(){this.d.flush()}toString(){return"[RendererInstance(uid = "+this.T+")]"}}d.H0=0,e.RendererInstance=d,e.default=d},da6a:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){if(this.AS=null,this.Gy=null,this.Gz=0,this.G0=new Map,this.D_C=new Map,this.G1=0,this.G2=[],null!=s.H5)throw Error("This Class is a singleton class!!!");s.H5=null}static GetInstance(){return null!=s.H5||(s.H5=new s),s.H5}getFreeUid(){if(this.G2.length>0)return this.G2.pop();let t=this.G1++;return t}__$$addTexture(t){null==t||this.G0.has(t.getUid())||(this.G0.set(t.getUid(),t),this.Gz++)}getTextureByUid(t){return this.G0.get(t)}hasTextureByUid(t){return this.G0.has(t)}removeTextureByUid(t){if(this.G0.has(t)){let e=this.G0.get(t);if(e.getAttachCount()<1)return this.D_C.has(t)&&this.D_C.delete(t),e.__$destroy(),e.__$$removeFromSlot(),this.G0.delete(t),this.G2.push(t),this.Gz--,e}return null}getTextureTotal(){return this.Gz}setRenderProxy(t){this.AS=t.Texture}setBufferUpdater(t){this.Gy=t}getFreeResUidMap(){return this.D_C}isGpuEnabledByResUid(t){return this.AS.hasResUid(t)}addRenderBuffer(t,e){null!=this.Gy&&this.Gy.__$addBuf(t,e)}addFreeUid(t){this.D_C.set(t,0)}removeFreeUid(t){this.D_C.has(t)&&this.D_C.delete(t)}}s.H5=null,e.default=s},da82:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("f444")),a=s(i("a46e")),n=s(i("8e17")),l=s(i("53ea"));class h{constructor(){this.A8=null,this.stageDragCtrl=new r.default,this.cameraZoomController=new a.default,this.zoomLookAtPosition=null,this.zoomMinDistance=30,this.viewRay=new l.default,this.cameraCtrlEnabled=!0}initialize(t){null==this.A8&&(this.A8=t,this.viewRay.bindCameraAndStage(t.getCamera(),t.getStage3D()),this.viewRay.setPlaneParam(new n.default(0,1,0),0),t.enableMouseEvent(!0),this.stageDragCtrl.initialize(t.getStage3D(),t.getCamera()),this.cameraZoomController.bindCamera(t.getCamera()),this.cameraZoomController.initialize(t.getStage3D()),this.cameraZoomController.setLookAtCtrlEnabled(!1))}run(){this.cameraCtrlEnabled&&(this.stageDragCtrl.runWithYAxis(),this.cameraZoomController.run(this.zoomLookAtPosition,this.zoomMinDistance))}}e.UserInteraction=h},da9b:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("577c")),a=s(i("08ab")),n=s(i("9951")),l=s(i("28d0")),h=i("5216");class o{constructor(){this.r=null,this.G3=null,this.redCamp=new a.default,this.effectRenderProcessIndex=4}initialize(t){if(null==this.r){this.r=t,this.redCamp.initialize(t);let e=n.default.GetImageTexByUrl("static/assets/xulie_02_07.png"),i=n.default.GetImageTexByUrl("static/assets/color_05.jpg");this.G3=new l.default,this.G3.depthOffset=n.default.GetInstance().particleGroupDepthOffset,this.G3.materialPipeline=n.default.GetMaterialPipeline(),this.G3.pipeTypes=[h.MaterialPipeType.FOG_EXP2],this.G3.initialize(this.r,this.effectRenderProcessIndex,10,e,i,!0),this.G3.appendEffectSrc(20,!0),this.G3.appendEffectSrc(8,!0),this.G3.appendEffectSrc(10,!0),this.G3.appendEffectSrc(10,!0),this.G3.appendEffectSrc(10,!0),this.G3.appendEffect(null,null),this.G3.appendEffect(null,null),this.G3.appendEffect(null,null),this.G3.appendEffect(null,null),this.G3.appendEffect(null,null)}}run(){if(null!=this.G3){let t=r.default.GetInstance().dataList,e=t.length;if(e>0){let i;for(;e>0;)i=t.pop(),null!=i.attackDst&&i.attackDst.consume(i.value),this.G3.createEffect(i.dstPos),--e}this.G3.run(),this.redCamp.run()}}}e.default=o},dc2b:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("e08e"),a=s(i("29ef"));class n{constructor(){this.T=0,this.G4=null,this.G5=null,this.name="RODisplay",this.visible=!0,this.ivsIndex=0,this.ivsCount=0,this.trisNumber=0,this.insCount=0,this.drawMode=r.RenderDrawMode.ELEMENTS_TRIANGLES,this.vbuf=null,this.renderState=a.default.NORMAL_STATE,this.rcolorMask=a.default.COLOR_MASK_ALL_TRUE,this.mouseEnabled=!1,this.G6=null,this.G7=null,this.__$ruid=-1,this.__$rpuid=-1,this.__$$rsign=r.DisplayRenderSign.NOT_IN_RENDERER,this.__$$runit=null,this.T=n.H0++}getPartGroup(){return this.G6}createPartGroup(t){t<1&&(t=1),this.G6=new Uint16Array(2*t)}setDrawPartAt(t,e,i){t*=2,this.G6[t]=i,this.G6[++t]=e}getUid(){return this.T}setTransform(t){this.G7=t,this.G5=t.getLocalFS32()}getTransform(){return this.G7}getMatrixFS32(){return this.G5}enableDrawInstanced(t,e){this.drawMode=r.RenderDrawMode.ELEMENTS_INSTANCED_TRIANGLES,this.ivsIndex=t,this.insCount=e}disableDrawInstanced(){this.drawMode=r.RenderDrawMode.ELEMENTS_TRIANGLES}getMaterial(){return this.G4}setMaterial(t){null!=this.G4&&this.G4!=t&&(this.G4.__$detachThis(),null!=t&&t.__$attachThis()),this.G4=t}copyFrom(t){this.vbuf=t.vbuf,this.ivsIndex=t.ivsIndex,this.ivsCount=t.ivsCount,this.setMaterial(t.getMaterial())}toString(){return"RODisplay(name="+this.name+",uid="+this.getUid()+", __$ruid="+this.__$ruid+")"}destroy(){null!=this.G4&&(this.G4.__$detachThis(),this.G4.destroy(),this.G4=null),this.G5=null,this.vbuf=null,this.__$ruid=-1,this.__$rpuid=-1,this.__$$rsign=r.DisplayRenderSign.NOT_IN_RENDERER,this.ivsIndex=0,this.ivsCount=0,this.G6=null,this.__$$runit=null}static GetFreeId(){return n.j_.length>0?n.j_.pop():-1}static GetByUid(t){return n.k_[t]}static IsEnabledByUid(t){return n.l_[t]==n.S_FLAG_BUSY}static Create(){let t=null,e=n.GetFreeId();return e>=0?(t=n.k_[e],n.l_[e]=n.S_FLAG_BUSY):(t=new n,n.k_.push(t),n.l_.push(n.S_FLAG_BUSY),n.G8++),t}static Restore(t){if(null!=t&&n.l_[t.getUid()]==n.S_FLAG_BUSY){let e=t.getUid();n.j_.push(e),n.l_[e]=n.S_FLAG_FREE,t.destroy()}}}n.H0=0,n.S_FLAG_BUSY=1,n.S_FLAG_FREE=0,n.l_=[],n.G8=0,n.k_=[],n.j_=[],e.default=n},de9d:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("722e")),a=s(i("8333")),n=s(i("6e01")),l=s(i("8e17")),h=i("7c63"),o=s(i("090c")),m=s(i("1216")),_=s(i("56c5")),u=s(i("030e")),d=s(i("74c3")),c=s(i("984e")),f=s(i("29ef")),p=s(i("3077"));class g{constructor(t){this.RGBA=0,this.UNSIGNED_BYTE=0,this.TRIANGLE_STRIP=0,this.TRIANGLE_FAN=0,this.TRIANGLES=0,this.LINES=0,this.LINE_STRIP=0,this.UNSIGNED_SHORT=0,this.UNSIGNED_INT=0,this.COLOR=0,this.DEPTH=0,this.STENCIL=0,this.DEPTH_STENCIL=0,this.MAX=0,this.MIN=0,this.RContext=null,this.RState=null,this.Vertex=null,this.Texture=null,this.VtxBufUpdater=null,this.MaterialUpdater=null,this.adapter=null,this.T=0,this.G9=null,this.AE=null,this.G_A=new o.default,this.A7=null,this.Dh=!0,this.B=0,this.C=0,this.D=800,this.E=600,this.AG=.1,this.AH=5e3,this.AI=45,this.P_=2,this.G_B=2,this.A_=null,this.G_C=!1,this.G_D=!0,this.G_E=!0,this.T=t}getRC(){return this.A7}getUid(){return this.T}getRCUid(){return this.T}isAutoSynViewAndStage(){return this.G_D}enableSynViewAndStage(){this.G_D=!0}lockViewport(){this.AE.lockViewport()}unlockViewport(){this.AE.unlockViewport()}getDiv(){return this.AE.getDiv()}getCanvas(){return this.AE.getCanvas()}cameraLock(){this.A_.lock()}cameraUnlock(){this.A_.unlock()}getCamera(){return this.A_}updateCamera(){return this.A_.update()}createCameraUBO(t){}updateCameraDataFromCamera(t){null!=t&&(this.G_C||t!=this.A_)&&(this.G_C=t!=this.A_,t.updateCamMatToUProbe(this.A_.matUProbe),null!=this.G9&&(this.G9.setSubDataArrAt(0,t.matUProbe.getFS32At(0)),this.G9.setSubDataArrAt(16,t.matUProbe.getFS32At(1))))}useCameraData(){null!=this.G9&&this.G9.run()}getActiveAttachmentTotal(){return this.AE.getActiveAttachmentTotal()}drawInstanced(t,e,i){2==this.G_B?this.A7.drawElementsInstanced(this.TRIANGLES,t,this.UNSIGNED_SHORT,e,i):u.default.ANGLE_instanced_arrays.drawElementsInstancedANGLE(this.TRIANGLES,t,e,i)}createUBOBufferByBytesCount(t){let e=this.A7.createBuffer();return this.A7.bindBuffer(this.A7.UNIFORM_BUFFER,e),this.A7.bufferData(this.A7.UNIFORM_BUFFER,t,this.A7.DYNAMIC_DRAW),e}createUBOBufferByDataArray(t){let e=this.A7.createBuffer();return this.A7.bindBuffer(this.A7.UNIFORM_BUFFER,e),this.A7.bufferData(this.A7.UNIFORM_BUFFER,t,this.A7.DYNAMIC_DRAW),e}bindUBOBuffer(t){this.A7.bindBuffer(this.A7.UNIFORM_BUFFER,t)}deleteUBOBuffer(t){this.A7.deleteBuffer(t)}bufferDataUBOBuffer(t){this.A7.bufferData(this.A7.UNIFORM_BUFFER,t,this.A7.STATIC_DRAW)}bindBufferBaseUBOBuffer(t,e){this.A7.bindBufferBase(this.A7.UNIFORM_BUFFER,t,e)}setWebGLMaxVersion(t){1!=t&&2!=t||(this.P_=t)}getContext(){return this.G_A}getStage3D(){return this.G_A.getStage()}getRenderAdapter(){return this.AE}getRenderContext(){return this.AE.getRenderContext()}setCameraParam(t,e,i){this.AI=t,this.AG=e,this.AH=i}getMouseXYWorldRay(t,e){let i=this.G_A.getStage();this.A_.getWorldPickingRayByScreenXY(i.mouseX,i.mouseY,t,e)}testViewPortChanged(t,e,i,s){return this.B!=t||this.C!=e||this.D!=i||this.E!=s}testRCViewPortChanged(t,e,i,s){return this.G_A.testViewPortChanged(t,e,i,s)}getViewX(){return this.B}getViewY(){return this.C}getViewWidth(){return this.D}getViewHeight(){return this.E}setViewPort(t,e,i,s){this.G_D=!1,this.B=t,this.C=e,this.D=i,this.E=s;let r=this.G_A.getStage();null!=r&&(r.setViewPort(i,e,i,s),null!=this.A_&&(this.A_.setViewXY(this.B,this.C),this.A_.setViewSize(this.D,this.E))),this.G_A.setViewport(this.B,this.C,this.D,this.E)}setRCViewPort(t,e,i,s,r=!1){this.G_D=r,this.G_A.setViewport(t,e,i,s)}reseizeRCViewPort(){this.AE.unlockViewport(),this.AE.reseizeViewPort()}resizeCallback(){this.G_D&&(this.B=0,this.C=0,this.D=this.G_A.getRCanvasWidth(),this.E=this.G_A.getRCanvasHeight(),this.createMainCamera(),this.G_A.setViewport(this.B,this.C,this.D,this.E),this.A_.setViewXY(this.B,this.C),this.A_.setViewSize(this.D,this.E))}createMainCamera(){this.G_E&&(this.G_E=!1,this.A_.uniformEnabled=!0,this.Dh?this.A_.perspectiveRH(n.default.DegreeToRadian(this.AI),this.D/this.E,this.AG,this.AH):this.A_.orthoRH(this.AG,this.AH,-.5*this.E,.5*this.E,-.5*this.D,.5*this.D),this.A_.setViewXY(this.B,this.C),this.A_.setViewSize(this.D,this.E))}readPixels(t,e,i,s,r,a,n){this.AE.readPixels(t,e,i,s,r,a,n)}getGLVersion(){return this.G_B}initialize(t,e,i,s,n,h){if(null!=this.A7)return;this.A_=e,null==e.matUProbe&&(e.matUProbe=new p.default,e.matUProbe.bindSlotAt(this.T),e.matUProbe.addMat4Data(new Float32Array(16),1),e.matUProbe.addMat4Data(new Float32Array(16),1)),null==e.ufrustumProbe&&(e.ufrustumProbe=new p.default,e.ufrustumProbe.bindSlotAt(this.T),e.ufrustumProbe.addVec4Data(new Float32Array([e.getZNear(),e.getZFar(),.5*e.getNearPlaneWidth(),.5*e.getNearPlaneHeight()]),1)),null==e.ucameraPosProbe&&(e.ucameraPosProbe=new p.default,e.ucameraPosProbe.bindSlotAt(this.T),e.ucameraPosProbe.addVec4Data(new Float32Array([500,500,500,1]),1));let o=t.camPosition,g=t.camLookAtPos,v=t.camUpDirect;null==o&&(o=new l.default(500,500,500)),null==g&&(g=new l.default(0,0,0)),null==v&&(v=new l.default(0,1,0)),this.Dh=t.cameraPerspectiveEnabled,this.G_A.autoSyncRenderBufferAndWindowSize=t.autoSyncRenderBufferAndWindowSize,this.G_A.setResizeCallback(this,this.resizeCallback),this.G_A.setWebGLMaxVersion(this.P_),this.G_A.initialize(this.T,i,t.getDiv(),t.getRenderContextAttri()),this.G_B=this.G_A.getWebGLVersion(),this.A7=this.G_A.getRC(),f.default.Initialize(),f.default.Rstate.setRenderContext(this.G_A);let x=this,y=this.A7,T=new d.default(this.T,y,h),b=new c.default(this.T,y);if(this.B7=T,x.Vertex=T,x.Texture=b,x.MaterialUpdater=s,x.VtxBufUpdater=n,this.D=this.G_A.getViewportWidth(),this.E=this.G_A.getViewportHeight(),this.AE=new m.default(this.T,b),this.AE.initialize(this.G_A,t,f.default.Rstate),x.adapter=this.AE,this.G_D){let t=this.G_A.getStage();null!=t&&(this.D=t.stageWidth,this.E=t.stageHeight)}this.createMainCamera(),this.G_A.setViewport(this.B,this.C,this.D,this.E),this.A_.lookAtRH(o,g,v),this.A_.update(),this.AE.bgColor.setRGB3f(0,0,0),x.RGBA=y.RGBA,x.UNSIGNED_BYTE=y.UNSIGNED_BYTE,x.TRIANGLE_STRIP=y.TRIANGLE_STRIP,x.TRIANGLE_FAN=y.TRIANGLE_FAN,x.TRIANGLES=y.TRIANGLES,x.LINES=this.A7.LINES,x.LINE_STRIP=y.LINE_STRIP,x.UNSIGNED_SHORT=y.UNSIGNED_SHORT,x.UNSIGNED_INT=y.UNSIGNED_INT,x.COLOR=y.COLOR,x.DEPTH=y.DEPTH,x.STENCIL=y.STENCIL,x.DEPTH_STENCIL=y.DEPTH_STENCIL,this.G_B>1?(x.MIN=y.MIN,x.MAX=y.MAX):(x.MIN=u.default.EXT_blend_minmax.MIN_EXT,x.MAX=u.default.EXT_blend_minmax.MAX_EXT);let S=r.default;S.NEAREST=y.NEAREST,S.LINEAR=y.LINEAR,S.LINEAR_MIPMAP_LINEAR=y.LINEAR_MIPMAP_LINEAR,S.NEAREST_MIPMAP_NEAREST=y.NEAREST_MIPMAP_NEAREST,S.LINEAR_MIPMAP_NEAREST=y.LINEAR_MIPMAP_NEAREST,S.NEAREST_MIPMAP_LINEAR=y.NEAREST_MIPMAP_LINEAR;let E=a.default;E.COLOR_BUFFER_BIT=y.COLOR_BUFFER_BIT,E.DEPTH_BUFFER_BIT=y.DEPTH_BUFFER_BIT,E.STENCIL_BUFFER_BIT=y.STENCIL_BUFFER_BIT,_.default.SetRenderer(this.G_A),x.RState=f.default.Rstate,x.RContext=this.A7}flush(){this.A7.flush()}setClearRGBColor3f(t,e,i){this.AE.bgColor.setRGB3f(t,e,i)}setClearColor(t){this.AE.bgColor.copyFrom(t)}setClearUint24Color(t,e){this.AE.bgColor.setRGBUint24(t),this.AE.bgColor.a=e}setClearRGBAColor4f(t,e,i,s){this.AE.bgColor.setRGBA4f(t,e,i,s)}getClearRGBAColor4f(t){t.copyFrom(this.AE.bgColor)}getViewportWidth(){return this.AE.getViewportWidth()}getViewportHeight(){return this.AE.getViewportHeight()}setRenderToBackBuffer(){this.AE.setRenderToBackBuffer()}clearBackBuffer(){this.AE.clear()}renderBegin(){this.A_.update(),this.AE.renderBegin()}renderEnd(){}useRenderStateByName(t){h.RenderStateObject.UseRenderStateByName(t)}setScissorEnabled(t){this.G_A.setScissorEnabled(t)}setScissorRect(t,e,i,s){this.G_A.setScissorRect(t,e,i,s)}useRenderColorMask(t){h.RenderColorMask.UseRenderState(t)}unlockRenderColorMask(){h.RenderColorMask.Unlock()}lockRenderColorMask(){h.RenderColorMask.Lock()}useRenderState(t){h.RenderStateObject.UseRenderState(t)}unlockRenderState(){h.RenderStateObject.Unlock()}lockRenderState(){h.RenderStateObject.Lock()}setVtxUpdateTimesTotal(t){this.B7.setVtxUpdateTimesTotal(t)}setFrontFaceFlipped(t){this.AE.setFrontFaceFlipped(t)}enabledPolygonOffset(){this.AE.enabledPolygonOffset()}disabledPolygonOffset(){this.AE.disabledPolygonOffset()}setPolygonOffset(t,e=0){this.AE.setPolygonOffset(t,e)}resetPolygonOffset(){this.AE.resetPolygonOffset()}loseContext(){this.AE.loseContext()}isContextLost(){return this.AE.isContextLost()}setViewProbeValue(t,e,i,s){this.AE.setViewProbeValue(t,e,i,s)}toString(){return"[Object RenderProxy()]"}}e.default=g},debe:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i("3221");class r extends s.UniformComp{constructor(){super(),this.G_F=null,this.G_G=null,this.G_H=null,this.G_I=-1,this.G_J=-1,this.G_K=-1,this.uvTransformEnabled=!1,this.curveMoveMap=null,this.displacementMap=null}initialize(){if(null==this.B2){this.By="";let t=0;if(this.uvTransformEnabled&&(this.G_I=t,t++,this.By+="UV"),null!=this.curveMoveMap&&(this.G_J=t,t++,this.By+="CM"),null!=this.displacementMap&&(this.G_K=t,t++,this.By+="DC"),t>0){this.B2=new Float32Array(4*t);let e=this.G_I;e>=0&&(this.G_F=this.B2.subarray(4*e,4*(e+1)),this.G_F.set([1,1,0,0])),e=this.G_J,e>=0&&(this.G_G=this.B2.subarray(4*e,4*(e+1))),e=this.G_K,e>=0&&(this.G_H=this.B2.subarray(4*e,4*(e+1)),this.G_H.set([10,0,0,0]))}}}use(t){this.getParamsTotal()>0&&(t.addVertUniform("vec4","u_vertLocalParams",this.getParamsTotal()),this.G_J>=0&&t.addVertLayout("vec4","a_vs"),this.G_I>=0&&t.addDefine("VOX_VTX_TRANSFORM_PARAM_INDEX",""+this.G_I))}reset(){}destroy(){}getTextures(t,e=null){return this.getParamsTotal()>0?(null==e&&(e=[]),this.G_J>=0&&(e.push(this.curveMoveMap),t.uniform.add2DMap("VTX_CURVE_MOVE_MAP",!1,!1,!0),t.addDefine("VOX_VTX_CURVE_MOVE_PARAM_INDEX",""+this.G_J)),this.G_K>=0&&(e.push(this.displacementMap),t.uniform.addDisplacementMap(this.G_K)),e):null}setCurveMoveParam(t,e){null!=this.G_G&&(this.G_G[0]=1/t,this.G_G[2]=e)}setCurveMoveDistance(t){null!=this.G_G&&(this.G_G[1]=t)}setUVScale(t,e){null!=this.G_F&&(this.G_F[0]=t,this.G_F[1]=e)}getUVScale(t){null!=this.G_F&&(t.x=this.G_F[0],t.y=this.G_F[1])}setUVTranslation(t,e){null!=this.G_F&&(this.G_F[2]=t,this.G_F[3]=e)}setDisplacementParams(t,e){null!=this.G_H&&(this.G_H[0]=t,this.G_H[1]=e)}clone(){let t=new r;return t.uvTransformEnabled=this.uvTransformEnabled,t.displacementMap=this.displacementMap,t.curveMoveMap=this.curveMoveMap,t}buildShaderUniformData(t){this.getParamsTotal()>0&&(t.uniformNameList.push("u_vertLocalParams"),t.dataList.push(this.getParams()))}}e.VertUniformComp=r},df25:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("8d98"),a=s(i("68aa")),n=s(i("0851"));class l extends n.default{constructor(t,e,i=!1){super(t,e,i),this.C_Y=null,this.G_L=null,this.C_n=0,this.C_l=null,this.C_m=null,this.minFilter=r.TextureConst.LINEAR}setDataFromBytes(t,e=0,i=-1,s=-1,r=0,n=0,l=!1){if(null!=t&&i>0&&s>0){e<0&&(e=0),e>15&&(e=15),e>=this.C_n&&(this.C_n=e+1),this.m=!0;let h=this.C_l;null!=h?this.C_l.miplevel!=e&&(null==this.C_m&&(this.C_m=[this.C_l,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]),h=this.C_m[e],null==h&&(h=a.default.Create(),h.miplevel=e,l=!0,this.C_m[e]=h)):(this.C_l=h=a.default.Create(),h.miplevel=e,l=!0),h.data==t&&h.offsetx==r&&h.offsety==n||(0==e&&(this.g=i,this.h=s,this.C_Y=t),h.data=t,h.status=0,(h.width<i||h.height<s||l)&&(h.width=i,h.height=s,h.status=1),h.offsetx=r,h.offsety=n),this.version++}}uploadData(t){null!=this.C_l&&this.dataUploadToGpu(t.getRC(),this.C_l,this.C_m,!0)}__$updateToGpu(t){if(this.version>0&&t.hasResUid(this.getResUid())){let e=t.getRC(),i=null!=this.G_L?this.G_L.length:0;if(this.__$updateToGpuBegin(t),i>0){let t=0,s=null,n=r.TextureFormat.ToGL(e,this.internalFormat),l=r.TextureFormat.ToGL(e,this.srcFormat),h=r.TextureDataType.ToGL(e,this.dataType);for(;t<i;++t)s=this.G_L.pop(),s.updateToGpu(e,this.l,n,l,h,!1),a.default.Restore(s)}null!=this.C_l&&(this.dataUploadToGpu(e,this.C_l,this.C_m),this.__$buildParam(e),this.o=!0),this.__$updateToGpuEnd(e)}}setPartDataFromeBytes(t,e,i,s,r,n=0){null==this.G_L&&(this.G_L=[]);let l=a.default.Create();l.data=t,l.status=0,l.miplevel=n,l.offsetx=e,l.offsety=i,l.width=s,l.height=r,this.G_L.push(l),this.version++}getPixels(t,e,i,s,a){if(null!=this.C_Y&&null!=a){let n=this.unpackAlignment,l=i*s*n;if(a.length==l){let h=e,o=t,m=h+s,_=o+i,u=0;switch(this.srcFormat){case r.TextureFormat.ALPHA:for(;h<m;++h)for(o=t;o<_;++o)l=h*this.g+o,a[u]=this.C_Y[l],u++;break;case r.TextureFormat.RGBA:for(;h<m;++h)for(o=t;o<_;++o)l=(h*this.g+o)*n,a[u]=this.C_Y[l],a[u+1]=this.C_Y[l+1],a[u+2]=this.C_Y[l+2],a[u+3]=this.C_Y[l+3],u++;break;case r.TextureFormat.RGB:for(;h<m;++h)for(o=t;o<_;++o)l=(h*this.g+o)*n,a[u]=this.C_Y[l],a[u+1]=this.C_Y[l+1],a[u+2]=this.C_Y[l+2],u++;break;default:break}}}}__$destroy(){if(this.getAttachCount()<1){if(this.version=0,null!=this.C_m){for(let t=0;t<this.C_n;++t)a.default.Restore(this.C_m[t]);this.C_n=0,this.C_m=null,this.C_l=null}null!=this.C_l&&(a.default.Restore(this.C_l),this.C_l=null),this.C_Y=null,super.__$destroy()}}toString(){return"[RawDataTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=l},df9d:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.T=-1,this.A_0=null,this.A_1=null,this.G_M=new Map,this.G_N=new Map,this.G_O=1,this.G_P=0,this.G_Q=[],this.G_R=[],this.G_S=[],this.G_T=[],this.G_U=0,this.G_V=[],this.G_W=[],this.G_X=[],this.AP=[],this.AQ=0,this.T=s.H0++}getFreeVtxId(){return this.G_S.length>0?this.G_S.pop():-1}getVtxIndex(){let t=-1,e=this.getFreeVtxId();return e>=0?(t=e,this.G_T[e]=0,this.G_Q[e]=this.G_O):(t=this.G_U,this.G_T.push(0),this.G_R.push(this.G_P),this.G_Q.push(this.G_O),this.G_U++),t}restoreVtxIndex(t){this.G_Q[t]==this.G_O&&(this.G_S.push(t),this.G_Q[t]=this.G_P,this.G_T[t]=0)}attachVtxAt(t){++this.G_T[t]}detachVtxAt(t){this.G_T[t]>0&&(--this.G_T[t],this.G_T[t]<1&&this.restoreVtxIndex(t))}getVtxTotalAt(t){return this.G_T[t]}getFreeTexId(){return this.G_X.length>0?this.G_X.pop():-1}getTexIndex(){let t=-1,e=this.getFreeTexId();return e>=0?(t=e,this.AP[e]=0,this.G_V[e]=this.G_O):(t=this.AQ,this.AP.push(0),this.G_W.push(this.G_P),this.G_V.push(this.G_O),this.AQ++),t}restoreTexIndex(t){this.G_V[t]==this.G_O&&(this.G_X.push(t),this.G_V[t]=this.G_P,this.AP[t]=0)}attachTexAt(t){++this.AP[t]}detachTexAt(t){this.AP[t]>0&&(--this.AP[t],this.AP[t]<1&&this.restoreTexIndex(t))}getTexTotalAt(t){return this.AP[t]}destroy(){this.clear()}clear(){this.A_0=this.A_1=null,this.G_M=new Map,this.G_N=new Map,this.G_Q=[],this.G_R=[],this.G_T=[],this.G_S=[],this.G_U=0,this.G_V=[],this.G_W=[],this.AP=[],this.G_X=[],this.AQ=0}getBegin(){return this.A_0}containsNode(t){let e=this.G_M.get(t.vtxUid);if(null!=e){let i=131*(31+e.rvroI);return i*=i+e.texMid,t.rtokey==i}return!1}addNodeAndSort(t){let e=this.G_M.get(t.vtxUid);if(null==e){this.G_M.set(t.vtxUid,t),t.rvroI=this.getVtxIndex(),this.attachVtxAt(t.rvroI);let e=131*(31+t.rvroI);e*=e+t.texMid,t.rtokey=e,t.rtroI=this.getTexIndex(),this.G_N.set(e,t.rtroI),this.attachTexAt(t.rtroI)}else{t.rvroI=e.rvroI,this.attachVtxAt(t.rvroI);let i=131*(31+t.rvroI);if(i*=i+t.texMid,this.G_N.has(i)?t.rtroI=this.G_N.get(i):(t.rtroI=this.getTexIndex(),this.G_N.set(i,t.rtroI)),t.rtokey=i,this.attachTexAt(t.rtroI),e!=this.A_1)if(e.texMid==t.texMid)e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;else while(null!=e){if(e.vtxUid!=t.vtxUid){e=e.prev,e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.texMid==t.texMid){e.next.prev=t,t.next=e.next,t.prev=e,e.next=t;break}if(e.next==this.A_1){this.A_1.vtxUid!=t.vtxUid?(e.next.prev=t,t.next=e.next,t.prev=e,e.next=t):e=null;break}e=e.next}else e=null}null==e&&(null==this.A_0?this.A_1=this.A_0=t:null!=this.A_1.prev?(this.A_1.next=t,t.prev=this.A_1,this.A_1=t):(this.A_0.next=t,t.prev=this.A_1,this.A_1=t),this.A_1.next=null)}showInfo(){let t=this.getBegin();if(null!=t){let e="",i="",s="";while(null!=t)e+=t.vtxUid+",",i+=t.texMid+",",s+=t.ivsCount+",",t=t.next}}removeNodeAndSort(t){let e=this.G_M.get(t.vtxUid);e!=t?e=null:(this.G_M.set(t.vtxUid,null),null!=t.next&&t.next.vtxUid==t.vtxUid?this.G_M.set(t.vtxUid,t.next):null!=t.prev&&t.prev.vtxUid==t.vtxUid?this.G_M.set(t.vtxUid,t.prev):this.G_M.delete(t.vtxUid)),t==this.A_0?t==this.A_1?this.A_0=this.A_1=null:(this.A_0=t.next,this.A_0.prev=null):t==this.A_1?(this.A_1=t.prev,this.A_1.next=null):(t.next.prev=t.prev,t.prev.next=t.next),this.detachVtxAt(t.rvroI),this.detachTexAt(t.rtroI),t.prev=null,t.next=null}addNode(t){null==this.A_0?this.A_1=this.A_0=t:null!=this.A_1.prev?(this.A_1.next=t,t.prev=this.A_1,this.A_1=t):(this.A_0.next=t,t.prev=this.A_1,this.A_1=t),this.A_1.next=null}removeNode(t){t==this.A_0?t==this.A_1?this.A_0=this.A_1=null:(this.A_0=t.next,this.A_0.prev=null):t==this.A_1?(this.A_1=t.prev,this.A_1.next=null):(t.next.prev=t.prev,t.prev.next=t.next),t.prev=null,t.next=null}}s.H0=0,e.default=s},e08e:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.ELEMENTS_TRIANGLES=1,s.ELEMENTS_TRIANGLE_STRIP=2,s.ELEMENTS_TRIANGLE_FAN=3,s.ELEMENTS_INSTANCED_TRIANGLES=4,s.ARRAYS_LINES=5,s.ARRAYS_LINE_STRIP=6,s.ARRAYS_POINTS=7,s.ELEMENTS_LINES=8,s.DISABLE=0,e.RenderDrawMode=s;class r{}r.NORMAL=1,r.OPAQUE=1,r.TRANSPARENT=2,r.ALPHA_ADD=3,r.ADD=4,r.ADD_LINEAR=5,r.INVERSE_ALPHA=6,r.BLAZE=7,r.OVERLAY=8,r.OVERLAY2=8,r.DISABLE=0,e.RenderBlendMode=r;class a{}a.NEVER=1,a.LESS=1,a.EQUAL=1,a.GREATER=1,a.NOTEQUAL=1,a.GEQUAL=1,a.ALWAYS=1,e.GLStencilFunc=a;class n{}n.KEEP=1,n.ZERO=1,n.REPLACE=1,n.INCR=1,n.INCR_WRAP=1,n.DECR=1,n.DECR_WRAP=1,n.INVERT=1,e.GLStencilOp=n;class l{}l.ZERO=1,l.ONE=1,l.SRC_COLOR=1,l.DST_COLOR=1,l.SRC_ALPHA=1,l.DST_ALPHA=1,l.ONE_MINUS_SRC_ALPHA=1,e.GLBlendMode=l;class h{}h.FUNC_ADD=1,h.FUNC_SUBTRACT=1,h.FUNC_REVERSE_SUBTRACT=1,h.MIN_EXT=1,h.MAX_EXT=1,h.MIN=1,h.MAX=1,e.GLBlendEquation=h;class o{}o.BACK=1,o.FRONT=2,o.FRONT_AND_BACK=3,o.NONE=0,o.DISABLE=0,e.CullFaceMode=o;class m{}m.NEVER=1,m.ALWAYS=2,m.SKY=3,m.TRUE_LESS_EQUAL=3,m.OPAQUE=4,m.TRUE_LESS=4,m.OPAQUE_OVERHEAD=5,m.FALSE_EQUAL=5,m.FALSE_LESS=6,m.BLEND=6,m.BLEND_SORT=6,m.TRANSPARENT_SORT=6,m.TRUE_LEQUAL=7,m.WIRE_FRAME=7,m.FALSE_LEQUAL=8,m.DECALS=8,m.NEXT_LAYER=11,m.WIRE_FRAME_NEXT=12,m.TRUE_EQUAL=13,m.TRUE_GREATER=14,m.TRUE_GEQUAL=15,m.DISABLE=0,e.DepthTestMode=m;class _{}_.SCENE_RO_FILTER_BEGIN=1<<19,_.SCENE_RO_FILTER_FINISH=2<<19,_.SCENE_RO_ERASE=0,e.RenderConst=_,function(t){t[t["NOT_IN_RENDERER"]=-1]="NOT_IN_RENDERER",t[t["GO_TO_RENDERER"]=1]="GO_TO_RENDERER",t[t["LIVE_IN_RENDERER"]=2]="LIVE_IN_RENDERER"}(e.DisplayRenderSign||(e.DisplayRenderSign={}))},e16a:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("6e01"));class n{constructor(){this.C_y=1,this.G_Y=.03,this.G_Z=.03,this.G_a=1,this.G_b=1,this.G_c=0,this.G_d=new r.default(1,0,0,0),this.G_e=new r.default(1,0,0,1),this.spdv=new r.default(1,0,0,1)}setSpeed(t){this.C_y=t}getSpeed(){return this.C_y}setFactor(t,e){t>.9?t=.9:t<.001&&(t=.001),e>.9?e=.9:e<.001&&(e=.001),this.G_Y=t,this.G_Z=e}setDirecXZ(t,e,i=!1){this.spdv.getLengthSquared()>a.default.MATH_MIN_POSITIVE&&(this.spdv.normalize(),this.G_d.copyFrom(this.spdv)),i&&this.G_d.setXYZ(0,0,0),this.G_e.setXYZ(t,0,e),this.G_e.normalize(),this.G_b=1,this.G_c=0}isDirecChanged(){return this.G_c<1||this.G_b>0}stop(){this.spdv.normalize(),this.G_d.copyFrom(this.spdv),this.spdv.setXYZ(0,0,0)}updateDirecXZ(t,e){(this.G_c<1||this.G_b>0)&&(this.G_e.setXYZ(t,0,e),this.G_e.normalize())}run(){this.G_b=this.G_b>0?this.G_b-this.G_Y:0,this.G_c=this.G_c<1?this.G_c+this.G_Z:1,this.spdv.copyFrom(this.G_d),this.spdv.scaleBy(this.G_b),this.spdv.x+=this.G_e.x*this.G_c,this.spdv.y+=this.G_e.y*this.G_c,this.spdv.z+=this.G_e.z*this.G_c,this.spdv.normalize(),this.spdv.scaleBy(this.C_y)}}e.default=n},e214:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("8e17")),n=s(i("f48d")),l=s(i("81c4"));class h extends n.default{constructor(){super(...arguments),this.nv=new a.default(0,1,0),this.distance=0,this.intersectBoo=!1}intersectStraightLinePos(t,e){let i=this.nv.dot(t.tv);if(i>r.default.MATH_MIN_POSITIVE||i<r.default.MATH_MAX_NEGATIVE){let s=this.nv.dot(t.position)-this.distance;return e.x=1e5*t.tv.x+t.position.x,e.y=1e5*t.tv.y+t.position.y,e.z=1e5*t.tv.z+t.position.z,i=this.nv.dot(e)-this.distance,i=s/(s-i),e.subtractBy(t.position),e.scaleBy(i),e.addBy(t.position),1}return i=this.nv.dot(t.position)-this.distance,i<=r.default.MATH_MIN_POSITIVE||i>=r.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),2):0}intersectStraightLinePos2(t,e,i){let s=this.nv.dot(e);if(s>r.default.MATH_MIN_POSITIVE||s<r.default.MATH_MAX_NEGATIVE){let r=this.nv.dot(t)-this.distance;return i.x=1e5*e.x+t.x,i.y=1e5*e.y+t.y,i.z=1e5*e.z+t.z,s=this.nv.dot(i)-this.distance,s=r/(r-s),i.subtractBy(t),i.scaleBy(s),i.addBy(t),1}return s=this.nv.dot(t)-this.distance,s<=r.default.MATH_MIN_POSITIVE||s>=r.default.MATH_MAX_NEGATIVE?(i.copyFrom(t),2):0}intersectRadialLinePos(t,e){let i=this.nv.dot(t.position)-this.distance;if(i>r.default.MATH_MIN_POSITIVE){let i=this.nv.dot(t.tv);if(i<0)return this.intersectStraightLinePos2(t.position,t.tv,e)}else{if(!(i<r.default.MATH_MAX_NEGATIVE)){let i=this.nv.dot(t.tv);return i>r.default.MATH_MIN_POSITIVE||i<r.default.MATH_MAX_NEGATIVE?(e.copyFrom(t.position),1):(e.copyFrom(t.position),2)}{let i=this.nv.dot(t.tv);if(i>0)return this.intersectStraightLinePos2(t.position,t.tv,e)}}return-1}intersectRadialLinePos2(t,e,i){let s=this.nv.dot(t)-this.distance;if(s>r.default.MATH_MIN_POSITIVE){let s=this.nv.dot(e);if(s<0)return this.intersectStraightLinePos2(t,e,i)}else{if(!(s<r.default.MATH_MAX_NEGATIVE)){let s=this.nv.dot(e);return s>r.default.MATH_MIN_POSITIVE||s<r.default.MATH_MAX_NEGATIVE?(i.copyFrom(t),1):(i.copyFrom(t),2)}{let s=this.nv.dot(e);if(s>0)return this.intersectStraightLinePos2(t,e,i)}}return-1}containsPoint(t){let e=this.nv.dot(t)-this.distance;return e>r.default.MATH_MIN_POSITIVE?1:e<r.default.MATH_MAX_NEGATIVE?-1:0}intersectSphere(t,e){this.intersectBoo=!1;let i=this.nv.dot(t)-this.distance;return i>r.default.MATH_MIN_POSITIVE?(this.intersectBoo=i<=e,1):i<r.default.MATH_MAX_NEGATIVE?(this.intersectBoo=-i<=e,-1):0}intersectAABB(t,e){this.intersectBoo=!1;let i=n.default.__tV0;i.setXYZ(e.x,t.y,e.z);let s=this.containsPoint(i);return i.setXYZ(e.x,t.y,t.z),s+=this.containsPoint(i),i.setXYZ(t.x,t.y,t.z),s+=this.containsPoint(i),i.setXYZ(t.x,t.y,e.z),s+=this.containsPoint(i),i.setXYZ(e.x,e.y,e.z),s+=this.containsPoint(i),i.setXYZ(e.x,e.y,t.z),s+=this.containsPoint(i),i.setXYZ(t.x,e.y,t.z),s+=this.containsPoint(i),i.setXYZ(t.x,e.y,e.z),s+=this.containsPoint(i),this.intersectBoo=s<8,s<-7?-1:s>7?1:0}intersectSphNegSpace(t,e){this.intersectBoo=Math.abs(this.nv.dot(t)-this.distance)<e}update(){this.nv.normalize()}updateFast(){this.nv.normalize()}static PlaneIntersectSphere(t,e,i,s){h.IntersectBoo=!1,h.IntersectSatus=0,e=t.dot(i)-e,e>r.default.MATH_MIN_POSITIVE?(h.IntersectBoo=e<=s,h.IntersectSatus=1):e<r.default.MATH_MAX_NEGATIVE&&(h.IntersectBoo=-e<=s,h.IntersectSatus=-1)}static CalcPVCloseV(t,e,i){let s=t.distance-e.dot(t.nv);i.setTo(s*t.nv.x,s*t.nv.y,s*t.nv.z),i.addBy(e)}static CalcPVCloseV2(t,e,i,s){let r=e-i.dot(t);s.setTo(r*t.x,r*t.y,r*t.z),s.addBy(i)}static IntersectionSLV2(t,e,i,s,a){let n=t.dot(s);if(n>r.default.MATH_MIN_POSITIVE||n<r.default.MATH_MAX_NEGATIVE){let r=t.dot(i)-e;return a.x=1e5*s.x+i.x,a.y=1e5*s.y+i.y,a.z=1e5*s.z+i.z,n=t.dot(a)-e,n=r/(r-n),a.subtractBy(i),a.scaleBy(n),a.addBy(i),1}return n=t.dot(i)-e,n<=r.default.MATH_MIN_POSITIVE||n>=r.default.MATH_MAX_NEGATIVE?(a.copyFrom(i),2):0}toString(){return"Plane(position="+this.position.toString()+", nv="+this.nv.toString()+")"}}h.IntersectBoo=!1,h.IntersectSatus=0;class o extends h{constructor(){super(...arguments),this.v0=new a.default(100,0,0),this.v1=new a.default(0,0,-100),this.v2=new a.default(0,0,0),this.ls01=new l.default,this.ls12=new l.default,this.ls20=new l.default,this.radiusSquared=100}getRandomPosition(t){let e=this.ls01.length*Math.random();t.x=this.ls01.position.x+e*this.ls01.tv.x,t.y=this.ls01.position.y+e*this.ls01.tv.y,t.z=this.ls01.position.z+e*this.ls01.tv.z,e=this.ls12.length*Math.random(),t.x+=this.ls12.position.x+e*this.ls12.tv.x,t.y+=this.ls12.position.y+e*this.ls12.tv.y,t.z+=this.ls12.position.z+e*this.ls12.tv.z,e=this.ls20.length*Math.random(),t.x+=this.ls20.position.x+e*this.ls20.tv.x,t.y+=this.ls20.position.y+e*this.ls20.tv.y,t.z+=this.ls20.position.z+e*this.ls20.tv.z,t.x*=.33333,t.y*=.33333,t.z*=.33333}triIntersectStraightLinePos(t,e){let i=this.intersectStraightLinePos(t,e);return 1==i&&(i=this.triContainsPoint(e),i>0)?1:-1}triIntersectRadialLinePos(t,e){let i=this.intersectRadialLinePos(t,e);return 1==i&&(i=this.triContainsPoint(e),i>0)?1:-1}triIntersectStraightLinePos2(t,e,i){let s=this.intersectStraightLinePos2(t,e,i);return 1==s&&(s=this.triContainsPoint(i),s>0)?1:-1}triIntersectRadialLinePos2(t,e,i){let s=this.intersectStraightLinePos2(t,e,i);return 1==s&&(s=this.triContainsPoint(i),s>0)?1:-1}triContainsPoint(t){let e=this.nv.dot(t)-this.distance;return e>r.default.MATH_MIN_POSITIVE||e<r.default.MATH_MAX_NEGATIVE?-1:(n.default.__tV0.x=t.x-this.v0.x,n.default.__tV0.y=t.y-this.v0.y,n.default.__tV0.z=t.z-this.v0.z,a.default.Cross(this.ls01.tv,n.default.__tV0,n.default.__tV1),this.nv.dot(n.default.__tV1)<0?-1:(n.default.__tV0.x=t.x-this.v1.x,n.default.__tV0.y=t.y-this.v1.y,n.default.__tV0.z=t.z-this.v1.z,a.default.Cross(this.ls12.tv,n.default.__tV0,n.default.__tV1),this.nv.dot(n.default.__tV1)<0?-1:(n.default.__tV0.x=t.x-this.v2.x,n.default.__tV0.y=t.y-this.v2.y,n.default.__tV0.z=t.z-this.v2.z,a.default.Cross(this.ls20.tv,n.default.__tV0,n.default.__tV1),this.nv.dot(n.default.__tV1)<0?-1:1)))}update(){let t=1/3;this.position.x=t*(this.v0.x+this.v1.x+this.v2.x),this.position.y=t*(this.v0.y+this.v1.y+this.v2.y),this.position.z=t*(this.v0.z+this.v1.z+this.v2.z),this.nv.x=this.position.x-this.v0.x,this.nv.y=this.position.y-this.v0.y,this.nv.z=this.position.z-this.v0.z,this.radiusSquared=this.nv.getLengthSquared(),this.ls01.position.copyFrom(this.v0),this.ls01.anotherPosition.copyFrom(this.v1),this.ls12.position.copyFrom(this.v1),this.ls12.anotherPosition.copyFrom(this.v2),this.ls20.position.copyFrom(this.v2),this.ls20.anotherPosition.copyFrom(this.v0),this.ls01.update(),this.ls12.update(),this.ls20.update(),a.default.Cross(this.ls01.tv,this.ls12.tv,this.nv),this.nv.normalize(),this.distance=this.nv.dot(this.v0)}updateFast(){this.update()}}e.Triangle=o,e.default=h},e2fe:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t=0,e=0,i=100,s=100){this.G_f=100,this.G_g=100,this.x=0,this.y=0,this.width=100,this.height=100,this.x=t,this.y=e,this.width=i,this.height=s,this.update()}copyFrom(t){this.x=t.x,this.y=t.y,this.G_f=t.G_f,this.G_g=t.G_g,this.width=t.width,this.height=t.height}clone(){return new s(this.x,this.y,this.width,this.height)}containsXY(t,e){return!(t<this.x||t>this.G_f)&&!(e<this.y||e>this.G_g)}contains(t){return t.x>=this.x&&t.G_f<=this.G_f&&t.y>=this.y&&(t.G_g,this.G_g),!0}intersect(t){return!(t.x>this.G_f)&&(!(t.G_f<this.x)&&(!(t.y>this.G_g)&&!(t.G_g<this.y)))}setTo(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s,this.G_f=this.width+this.x,this.G_g=this.height+this.y}setSize(t,e){this.width=t,this.height=e,this.G_f=this.width+this.x,this.G_g=this.height+this.y}update(){this.G_f=this.width+this.x,this.G_g=this.height+this.y}flipY(t){this.y=this.y,this.G_f=this.width+this.x,this.G_g=this.height+this.y}getX(){return this.x}getY(){return this.y}getRight(){return this.G_f}getTop(){return this.G_g}}e.default=s},e439:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("bd6f")),n=s(i("c51d")),l=s(i("9bb7")),h=s(i("e8e6")),o=s(i("b498")),m=s(i("29ef")),_=s(i("829f"));class u{constructor(t){this.A8=null,this.G_h=null,this.G_i=null,this.G_j=null,this.G_k=null,this.G_l=null,this.G_m=null,this.G_n=null,this.F_o=new r.default(600,800,-600),this.G_o=-5e-4,this.G_p=2,this.G_q=.8,this.G_r=.1,this.G_s=128,this.G_t=128,this.Ae=1300,this.Af=1300,this.G_u=.01,this.G_v=3e3,this.G_w=null,this.G_x=null,this.AY=0,this.G_y=null,this.G_z=-1,this.G_0=-1,this.G_1=!1,this.G_2=-1,this.G_3=120,this.force=!0,this.AY=t}initialize(t,e,i=120,s=!1){null==this.A8&&(this.A8=t,this.G_3=i,this.G_y=e.slice(0),this.initConfig(e,!1))}setMapSize(t,e){this.G_s=t,this.G_t=e}setCameraPosition(t){this.F_o.copyFrom(t)}setCameraNear(t){this.G_u=t}setCameraFar(t){this.G_v=t}setCameraViewSize(t,e){this.Ae=t,this.Af=e}setShadowRadius(t){this.G_p=t}setShadowBias(t){this.G_o=t}setShadowIntensity(t){this.G_q=t,null!=this.G_h&&this.G_h.setShadowIntensity(this.G_q)}setColorIntensity(t){this.G_r=t,null!=this.G_h&&this.G_h.setColorIntensity(this.G_r)}getShadowMap(){return null!=this.G_n?this.G_n.getDstTexture():this.G_w}getVSMData(){return this.G_h}getCamera(){return this.G_i}setRendererProcessIDList(t){null!=this.G_j&&(this.G_y=t.slice(0),this.G_j.setRProcessIDList(t))}initConfig(t,e=!1){let i;this.G_h=new o.default,this.G_h.initialize(),this.G_h.setShadowIntensity(this.G_q),this.G_j=this.A8.createFBOInstance(),this.G_j.asynFBOSizeWithViewport(),this.G_j.setClearRGBAColor4f(1,1,1,1),this.G_j.createFBOAt(this.AY,this.G_s,this.G_t,!0,!1),this.G_w=this.G_j.setRenderToRGBATexture(null,0),this.G_j.setRProcessIDList(t),this.G_j.setGlobalRenderState(m.default.NORMAL_STATE),this.G_j.setGlobalMaterial(new l.default),this.G_k=this.A8.createFBOInstance(),this.G_k.asynFBOSizeWithViewport(),this.G_k.setClearRGBAColor4f(1,1,1,1),this.G_k.createFBOAt(this.AY,this.G_s,this.G_t,!0,!1),this.G_x=this.G_k.setRenderToRGBATexture(null,0),i=new h.default(!1),i.setShadowRadius(this.G_p);let s=new a.default;s.setMaterial(i),s.initializeXOY(-1,-1,2,2,[this.G_w]),this.G_l=s,i=new h.default(!0),i.setShadowRadius(this.G_p);let r=new a.default;r.copyMeshFrom(s),r.setMaterial(i),r.initializeXOY(-1,-1,2,2,[this.G_x]),this.G_m=r,this.G_1=e,e&&(this.G_n=new _.default(this.A8.getRenderer()),this.G_n.setBlurCount(2),this.G_n.setSyncViewSizeEnabled(!1),this.G_n.setFBOSize(this.G_s,this.G_t),this.G_n.setBlurDensity(1),this.G_n.bindDrawEntity(this.G_l),this.G_n.setBackbufferVisible(!1)),this.G_i=new n.default,this.G_h.setShadowMap(this.getShadowMap()),this.updateData()}updateData(){if(null!=this.G_i){let t=this.Ae,e=this.Af;this.G_i.lookAtRH(this.F_o,r.default.ZERO,r.default.Y_AXIS),this.G_i.orthoRH(this.G_u,this.G_v,-.5*e,.5*e,-.5*t,.5*t),this.G_i.setViewXY(0,0),this.G_i.setViewSize(t,e),this.G_i.update()}null!=this.G_h&&(this.G_j.resizeFBO(this.G_s,this.G_t),this.G_k.resizeFBO(this.G_s,this.G_t),this.G_1&&this.G_n.setFBOSize(this.G_s,this.G_t),this.G_h.updateShadowCamera(this.G_i),this.G_h.setShadowRadius(this.G_p),this.G_h.setShadowBias(this.G_o),this.G_h.setShadowSize(this.G_s,this.G_t),this.G_h.update())}upate(){this.G_3=32,this.G_2=this.G_i.version,this.updateData()}getRendererProcessStatus(){let t=31;for(let e=0;e<this.G_y.length;++e)t+=t*this.A8.getRenderProcessAt(e).getStatus();return t}run(){this.G_i.version!=this.G_2&&(this.G_2=this.G_i.version,this.G_h.updateShadowCamera(this.G_i),this.G_h.update());let t=this.force;if(t)this.buildShadow();else{if(this.G_z!=this.A8.getRendererStatus()){let e=this.getRendererProcessStatus();this.G_0!=e&&(this.G_0=e,t=!0),this.G_z=this.A8.getRendererStatus()}this.G_3>0&&(this.G_3%15==0&&(t=!0),this.G_3--),t&&this.buildShadow()}this.force=!1}buildShadow(){this.G_j.useCamera(this.G_i),this.G_j.run(!0,!0),this.G_j.useMainCamera(),this.G_k.setRenderToRGBATexture(this.G_x,0),this.G_k.runBegin(),this.G_k.drawEntity(this.G_l),this.G_k.runEnd(),this.G_k.setRenderToRGBATexture(this.G_w,0),this.G_k.runBegin(),this.G_k.drawEntity(this.G_m),this.G_k.runEnd(),null!=this.G_n&&this.G_n.run(),this.G_k.setRenderToBackBuffer()}}e.ShadowVSMModule=u,e.default=u},e753:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73")),a=s(i("3077")),n=i("5216"),l=i("c70f"),h=s(i("6e01")),o=i("8602"),m=i("6a30"),_=i("f043");class u{constructor(t=0){this.T=-1,this.D_i=new l.GlobalLightUniformParam,this.D_j=null,this.D_k=null,this.D_m=0,this.G_4=null,this.G_5=null,this.G_6=0,this.G_7=0,this.G_8=null,this.G_9=null,this.G_=null,this.D_m=t,this.T=u.H0++}getUid(){return this.T}getPointLightsTotal(){return null!=this.G_8?this.G_8.length:0}getDirecLightsTotal(){return null!=this.G_9?this.G_9.length:0}getSpotLightsTotal(){return null!=this.G_?this.G_.length:0}getPointLightAt(t){return null!=this.G_8&&t>=0&&t<this.G_8.length?this.G_8[t]:null}getDirectionLightAt(t){return null!=this.G_9&&t>=0&&t<this.G_9.length?this.G_9[t]:null}getSpotLightAt(t){return null!=this.G_&&t>=0&&t<this.G_.length?this.G_[t]:null}appendPointLight(){null==this.G_8&&(this.G_8=[]);let t=new o.PointLight;return this.G_8.push(t),this.G_7++,t}appendDirectionLight(){null==this.G_9&&(this.G_9=[]);let t=new m.DirectionLight;return this.G_9.push(t),this.G_7++,t}appendSpotLight(){null==this.G_&&(this.G_=[]);let t=new _.SpotLight;return this.G_.push(t),this.G_7++,t}updatePointLightData(){if(null!=this.G_8){let t,e=this.G_4,i=this.G_5,s=0;for(let r=0;r<this.G_8.length;++r)t=this.G_8[r],s=4*r,e[s]=t.position.x,e[s+1]=t.position.y,e[s+2]=t.position.z,e[s+3]=t.attenuationFactor1,i[s]=t.color.r,i[s+1]=t.color.g,i[s+2]=t.color.b,i[s+3]=t.attenuationFactor2}}updateDirecLighttData(){if(null!=this.G_9){let t,e=this.G_4,i=this.G_5,s=0,r=null!=this.G_8?this.G_8.length:0;r*=4;for(let a=0;a<this.G_9.length;++a)t=this.G_9[a],s=r+4*a,e[s]=t.direction.x,e[s+1]=t.direction.y,e[s+2]=t.direction.z,e[s+3]=t.attenuationFactor1,i[s]=t.color.r,i[s+1]=t.color.g,i[s+2]=t.color.b,i[s+3]=t.attenuationFactor2}}updateSpotLighttData(){if(null!=this.G_){let t,e=this.G_4,i=this.G_5,s=0,r=null!=this.G_8?this.G_8.length:0;r+=null!=this.G_9?this.G_9.length:0,r*=4;for(let a=0;a<this.G_.length;++a)t=this.G_[a],s=r+4*a,e[s]=t.position.x,e[s+1]=t.position.y,e[s+2]=t.position.z,e[s+3]=t.attenuationFactor1,i[s]=t.color.r,i[s+1]=t.color.g,i[s+2]=t.color.b,i[s+3]=t.attenuationFactor2;r+=4*this.G_.length;for(let a=0;a<this.G_.length;++a){t=this.G_[a];let i=90-h.default.Clamp(t.angleDegree,0,90);i=Math.cos(h.default.DegreeToRadian(i)),s=r+4*a,e[s]=t.direction.x,e[s+1]=t.direction.y,e[s+2]=t.direction.z,e[s+3]=i}}}buildData(){if(null==this.D_j){let t=this.G_7,e=this.G_7,i=4*t;this.G_6=this.G_7,null==this.G_||(i+=4*this.G_.length,this.G_6+=this.G_.length),null==this.G_4&&(this.G_4=new Float32Array(i)),null==this.G_5&&(this.G_5=new Float32Array(4*e)),this.D_j=new a.default,this.D_j.bindSlotAt(this.D_m),this.D_j.addVec4Data(this.G_4,this.G_6),this.D_j.addVec4Data(this.G_5,e),this.D_k=this.D_i.createGlobalUinform(this.D_j)}this.updatePointLightData(),this.updateDirecLighttData(),this.updateSpotLighttData()}update(){this.buildData(),this.D_j.update()}showInfo(){}resetPipe(){}getTextures(t,e,i){return null}useShaderPipe(t,e){if(null!=this.D_j){t.normalEnabled=!0;let e=this.getPointLightsTotal()+this.getDirecLightsTotal()+this.getSpotLightsTotal();e>0?(t.addDefine("VOX_LIGHTS_TOTAL",""+e),this.getPointLightsTotal()>0?t.addDefine("VOX_POINT_LIGHTS_TOTAL",""+this.getPointLightsTotal()):t.addDefine("VOX_POINT_LIGHTS_TOTAL","0"),this.getDirecLightsTotal()>0?t.addDefine("VOX_DIRECTION_LIGHTS_TOTAL",""+this.getDirecLightsTotal()):t.addDefine("VOX_DIRECTION_LIGHTS_TOTAL","0"),this.getSpotLightsTotal()>0?t.addDefine("VOX_SPOT_LIGHTS_TOTAL",""+this.getSpotLightsTotal()):t.addDefine("VOX_SPOT_LIGHTS_TOTAL","0")):t.addDefine("VOX_LIGHTS_TOTAL","0"),this.D_i.use(t,this.G_6,this.G_7)}}getPipeTypes(){return[n.MaterialPipeType.GLOBAL_LIGHT]}getPipeKey(t){switch(t){case n.MaterialPipeType.GLOBAL_LIGHT:let e="";if(this.getPointLightsTotal()>0&&(e=""+this.getPointLightsTotal()),this.getDirecLightsTotal()>0&&(e+=""+this.getDirecLightsTotal()),this.getSpotLightsTotal()>0&&(e+=""+this.getSpotLightsTotal()),""!=e)return"["+t+":"+e+"]";break;default:break}return""}useUniforms(t){null!=this.D_j&&(t.addFragUniform(r.default.GlobalLight.type,r.default.GlobalLight.positionName,this.G_6),t.addFragUniform(r.default.GlobalLight.type,r.default.GlobalLight.colorName,this.G_7))}getGlobalUinform(){return this.D_k.clone()}}u.H0=0,e.LightModule=u},e7ce:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("faa5")),a=s(i("b3bd")),n=s(i("0fc4"));class l extends r.default{constructor(){super(),this.n_=""}initialize(t){this.n_="PixelPickIndexShd"}getFragShaderCode(){let t="#version 300 es\nprecision highp float;\nuniform vec4 u_param;\nin vec3 v_viewPos;\n//in float v_length;\nlayout(location = 0) out vec4 FragColor0;\nvoid main()\n{\nvec4 p = vec4(length(v_viewPos.xyz));\np.x = floor(p.x)/256.0;\np.y = floor(fract(p.x) * 256.0)/255.0;\np.x = floor(p.x) / 255.0;\np.z = fract(p.z);\nFragColor0 = vec4(p.xyz,u_param.w);\n}\n";return t}getVertShaderCode(){let t="#version 300 es\nprecision highp float;\nlayout(location = 0) in vec3 a_vs;\nuniform mat4 u_objMat;\nuniform mat4 u_viewMat;\nuniform mat4 u_projMat;\nout vec3 v_viewPos;\n//out float v_length;\nvoid main(){\nmat4 viewMat4 = u_viewMat * u_objMat;\nvec4 viewPos = viewMat4 * vec4(a_vs, 1.0);\nv_viewPos = viewPos.xyz;\n//v_length = length(viewPos.xyz);\ngl_Position = u_projMat * viewPos;\n}\n";return t}getUniqueShaderName(){return this.n_}toString(){return"[PixelPickIndexShaderBuffer()]"}static GetInstance(){return l.H2}}l.H2=new l,e.PixelPickIndexShaderBuffer=l;class h extends n.default{constructor(){super(),this.HA=new Float32Array([1,1,1,1]),this.HB=1/255}getCodeBuf(){return l.GetInstance()}setIndex(t){this.HA[3]=t*this.HB}getIndex(){return this.HA[3]/this.HB}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_param"],t.dataList=[this.HA],t}}e.default=h},e7d2:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8a0a")),a=s(i("710f")),n=s(i("f0f0")),l=s(i("7a04")),h=i("e08e");class o{constructor(t=r.default.VTX_STATIC_DRAW){this.T=0,this.HC=null,this.B_O=null,this.Ge=0,this.HD=2,this.layoutBit=0,this.vertexVer=0,this.indicesVer=0,this.version=0,this.drawMode=h.RenderDrawMode.ELEMENTS_TRIANGLES,this.bufData=null,this.T=o.H0++,this.Ge=t}setVtxBuf(t){t!=this&&(this.HC=t,null!=t&&(t.layoutBit=this.layoutBit))}getUid(){return this.T}getType(){return this.HC.getType()}getIBufStep(){return this.HD}getBufDataUsage(){return this.Ge}setBufDataUsage(t){this.Ge=t}getBuffersTotal(){return this.HC.getBuffersTotal()}getF32DataAt(t){return this.HC.getF32DataAt(t)}getIvsData(){return this.B_O}setF32DataAt(t,e,i,s){this.HC.setF32DataAt(t,e,i,s),this.vertexVer++}setUintIVSData(t,e=r.default.VTX_STATIC_DRAW){if(t instanceof Uint16Array)this.HD=2;else{if(!(t instanceof Uint32Array))return;this.HD=4}this.B_O=t,null!=t&&this.indicesVer++}setUint16IVSData(t,e=r.default.VTX_STATIC_DRAW){t instanceof Uint16Array&&(this.B_O=t,this.indicesVer++,this.HD=2)}setUint32IVSData(t,e=r.default.VTX_STATIC_DRAW){t instanceof Uint32Array&&(this.B_O=t,this.indicesVer++,this.HD=4)}setData4fAt(t,e,i,s,r,a){null!=this.HC&&(this.HC.setData4fAt(t,e,i,s,r,a),this.vertexVer++)}setData3fAt(t,e,i,s,r){null!=this.HC&&(this.HC.setData3fAt(t,e,i,s,r),this.vertexVer++)}setData2fAt(t,e,i,s){null!=this.HC&&(this.HC.setData2fAt(t,e,i,s),this.vertexVer++)}destroy(){}__$destroy(){this.HC.destroy(),this.HC.getType()<1?o.IN.push(this.HC):o.IO.push(this.HC),this.HC=null,this.B_O=null,this.bufData=null}toString(){return"ROVertexBuffer(uid = "+this.T+")"}static GetFreeId(){return o.H_7.length>0?o.H_7.pop():-1}static GetVtxByUid(t){return o.H_8[t]}static Create(t=r.default.VTX_STATIC_DRAW){let e=null,i=o.GetFreeId();return i>=0?(e=o.H_8[i],e.setBufDataUsage(t),o.H_9[i]=o.S_FLAG_BUSY):(e=new o(t),o.H_8.push(e),o.H_9.push(o.S_FLAG_BUSY),o.H_++),e.vertexVer=0,e.indicesVer=0,e.version++,o.IP.__$attachAt(e.getUid()),e}static __$Restore(t){if(null!=t&&o.H_9[t.getUid()]==o.S_FLAG_BUSY){let e=t.getUid();o.H_7.push(e),o.H_9[e]=o.S_FLAG_FREE,t.__$destroy()}}static __$$AttachAt(t){o.IP.__$attachAt(t)}static __$$DetachAt(t){o.IP.__$detachAt(t)}static Reset(){o.BufDataList=[],o.IQ=0,o.BufStatusList=[],o.BufDataStepList=[],o.vtxFS32=null,o.vbWholeDataEnabled=!1,o.dynBufSegEnabled=!1,o.useBufByIndexEnabled=!1}static AddFloat32Data(t,e,i=r.default.VTX_STATIC_DRAW){o.BufDataList.push(t),o.BufDataStepList.push(e),o.BufStatusList.push(i),o.IQ+=e}static CreateBySaveData(t=r.default.VTX_STATIC_DRAW,e=0){let i=0,s=0,a=0,l=o.BufDataStepList.length,h=[];for(;i<l;i++)h.push(a),a+=o.BufDataStepList[i];let m=o.BufDataList[0].length/o.BufDataStepList[0],_=new Float32Array(a*m),u=0,d=0,c=null,f=null;for(i=0;i<m;++i)for(s=i*a,u=0;u<l;++u)d=o.BufDataStepList[u],c=o.BufDataList[u],f=c.subarray(i*d,(i+1)*d),_.set(f,s),s+=d;let p=o.Create(t);if(p.layoutBit=e,o.IN.length>0){let t=o.IN.pop();p.setVtxBuf(t)}else p.setVtxBuf(new n.default(p.getBufDataUsage()));return p.setF32DataAt(0,_,a,h),p}static CreateVtxCombinedBuf(t,e,i=r.default.VTX_STATIC_DRAW,s=0){let a=0,l=0,h=e.length,m=[];for(;a<h;a++)m.push(l),l+=e[a];let _=o.Create(i);if(_.layoutBit=s,o.IN.length>0){let t=o.IN.pop();_.setVtxBuf(t)}else _.setVtxBuf(new n.default(_.getBufDataUsage()));return _.setF32DataAt(0,t,l,m),_}static UpdateBufData(t){let e=0,i=0,s=0,r=o.BufDataStepList.length,a=o.BufDataList[0].length/o.BufDataStepList[0],n=t.getF32DataAt(0),l=o.IQ*a!=n.length,h=null;if(l)for(h=[],n=new Float32Array(o.IQ*a);e<r;e++)h.push(s),s+=o.BufDataStepList[e];else s=o.IQ;let m=0,_=0,u=null,d=null;for(e=0;e<a;++e)for(i=e*s,m=0;m<r;++m)_=o.BufDataStepList[m],u=o.BufDataList[m],d=u.subarray(e*_,(e+1)*_),n.set(d,i),i+=_;l?t.setF32DataAt(0,n,s,h):t.setF32DataAt(0,n,s,null)}static CreateByBufDataSeparate(t,e=r.default.VTX_STATIC_DRAW,i=0){let s=0,a=0,n=t.getAttributesTotal(),h=new Array(n);h.fill(0);let m=o.Create(e);if(m.layoutBit=i,o.IO.length>0){let t=o.IO.pop();m.setVtxBuf(t)}else m.setVtxBuf(new l.default);for(s=0;s<n;s++)m.setF32DataAt(s,t.getAttributeDataAt(s,0),a,h);return m.setUintIVSData(t.getIndexDataAt(0)),m.bufData=t,m}static CreateBySaveDataSeparate(t=r.default.VTX_STATIC_DRAW){let e=0,i=0,s=o.BufDataStepList.length,a=new Array(s);a.fill(0);let n=o.Create(t);if(o.IO.length>0){let t=o.IO.pop();n.setVtxBuf(t)}else n.setVtxBuf(new l.default);for(e=0;e<s;e++)n.setF32DataAt(e,o.BufDataList[e],i,a);return n}static GetVtxAttachCountAt(t){return o.IP.getAttachCountAt(t)}static GetVtxAttachAllCount(){return o.IP.getAttachAllCount()}static ClearTest(){if(--o.IR,o.IR<1){o.IR=128;let t=o.IP;if(t.__$getRemovedListLen()>0){let e=t.__$getRemovedList(),i=e.length,s=0,r=0,a=null,n=32;for(i=i>n?n:i;s<i;++s)r=e.shift(),t.getAttachCountAt(r)<1&&(a=o.GetVtxByUid(r),o.__$Restore(a))}}}}o.H0=0,o.IN=[],o.IO=[],o.S_FLAG_BUSY=1,o.S_FLAG_FREE=0,o.H_9=[],o.H_=0,o.H_8=[],o.H_7=[],o.IP=new a.default,o.IQ=0,o.BufDataList=null,o.BufDataStepList=null,o.BufStatusList=null,o.vtxDataFS32=null,o.vbWholeDataEnabled=!1,o.dynBufSegEnabled=!1,o.useBufByIndexEnabled=!1,o.vtxFS32=null,o.IR=128,e.default=o},e7e2:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("ae33")),n=s(i("54de")),l=s(i("6773")),h=i("a52f");class o{constructor(t=null){this.At=null,this.BD=0,this.BE=new r.default,this.BF=new r.default,this.BG=new r.default,this.BI=null,this.HE=null,this.BO=new l.default,this.degreeTween=new n.default,this.campType=h.CampType.Blue,this.BP=null,this.BQ=0,this.BI=null==t?new a.default:t}getContainer(){return this.BI}setVisible(t){this.BI.setVisible(t)}getVisible(){return this.BI.getVisible()}setRotationY(t){this.BI.setRotationY(t)}getRotationY(){return this.BI.getRotationY()}initialize(t,e,i,s=null){if(null==this.At){this.At=t,this.HE=i,this.HE.campType=this.campType,t.addContainer(this.BI,e);let a=new r.default;null!=s&&a.addBy(s),this.degreeTween.bindTarget(this.BI)}}setXYZ(t,e,i){this.BI.setXYZ(t,e,i)}setPosition(t){this.BI.setPosition(t)}getPosition(t){this.BI.getPosition(t)}isAttackLock(){return this.degreeTween.testDegreeDis(2)}direcByDegree(t,e){this.degreeTween.runRotY(t),this.degreeTween.isDegreeChanged()&&this.BI.update()}direcByPos(t,e){this.degreeTween.runRotYByDstPos(t),this.degreeTween.isDegreeChanged()&&this.BI.update()}setDstDirecDegree(t){this.BQ=t}setAttackDst(t){this.BP=t,null!=t&&this.BP.getHitPos(this.BE)}setAttPos(t){this.BE.copyFrom(t)}setAttPosXYZ(t,e,i){this.BE.setXYZ(t,e,i)}getAttPos(){return this.BE}attack(){this.HE.run(this.BP,this.degreeTween.getDegreeDis(),this.BE)}updateAttackPose(){this.direcByPos(this.BE,!1)}resetPose(){}resetNextOriginPose(){}run(t){let e=null!=this.BP;e?this.updateAttackPose():this.direcByDegree(this.BQ,!1),this.BI.update(),e&&this.attack()}update(){this.BI.update()}isResetFinish(){return!0}isPoseRunning(){return!0}runToReset(){}}e.default=o},e87b:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("ab73")),a=s(i("7279"));class n{create(t,e){let i=null,s=r.default.ViewportParam;return e.hasUniformByName(s.name)&&(i=new a.default,i.uns=s.name,i.uniformNameList=[s.name],i.copyDataFromProbe(t.getRenderAdapter().uViewProbe)),i}getIDNS(){return"ViewParamUniformBuilder"}}e.default=n},e8e6:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("faa5")),a=s(i("b3bd")),n=s(i("0fc4"));class l extends r.default{constructor(){super(),this.n_="",this.E8=!1,this.horizonal=!0}initialize(t){this.n_="OccBlurShd",this.E8=t,t&&(this.n_+="_tex")}buildThisCode(){let t=this.A_s;this.horizonal&&t.addDefine("HORIZONAL_PASS"),t.addDefine("SAMPLE_RATE","0.25"),t.addDefine("HALF_SAMPLE_RATE","0.125"),t.addTextureSample2D("",!1),t.uniform.useViewPort(!1,!0),t.addFragUniform("vec4","u_param")}getFragShaderCode(){this.buildThisCode();let t=this.A_s;return t.addFragMainCode("\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n    vec4 r = vec4( fract( v * PackFactors ), v );\n    r.yzw -= r.xyz * ShiftRight8; // tidy overflow\n    return r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n    return dot( v, UnpackFactors );\n}\n\nvec4 pack2HalfToRGBA( vec2 v ) {\n    vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n    return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n    return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nvoid main() {\n\n    float mean = 0.0;\n    float squared_mean = 0.0;\n    \n    vec2 resolution = u_viewParam.zw;\n    \n    float radius = u_param[3];\n    // This seems totally useless but it's a crazy work around for a Adreno compiler bug\n    float depth = unpackRGBAToDepth( VOX_Texture2D( u_sampler0, ( gl_FragCoord.xy ) / resolution ) );\n\n    for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\n        #ifdef HORIZONAL_PASS\n\n            vec2 distribution = unpackRGBATo2Half( VOX_Texture2D( u_sampler0, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n            mean += distribution.x;\n            squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\n        #else\n\n            float depth = unpackRGBAToDepth( VOX_Texture2D( u_sampler0, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n            mean += depth;\n            squared_mean += depth * depth;\n\n        #endif\n\n    }\n\n    mean = mean * HALF_SAMPLE_RATE;\n    squared_mean = squared_mean * HALF_SAMPLE_RATE;\n\n    float std_dev = sqrt( squared_mean - mean * mean );\n\n    FragColor0 = pack2HalfToRGBA( vec2( mean, std_dev ) );\n\n}\n"),this.A_s.buildFragCode()}getVertShaderCode(){let t=this.A_s;return t.addVertMainCode("\nvoid main() {\n    gl_Position =  vec4(a_vs,1.0);\n}\n"),this.A_s.buildVertCode()}getUniqueShaderName(){return this.n_+(this.horizonal?"_h":"_v")}toString(){return"[OccBlurShaderBuffer()]"}static GetInstance(){return null!=l.H2||(l.H2=new l),l.H2}}l.H2=null;class h extends n.default{constructor(t){super(),this.HF=!0,this.E9=new Float32Array([1,1,1,4]),this.HF=t}getCodeBuf(){let t=l.GetInstance();return t.horizonal=this.HF,t}setShadowRadius(t){this.E9[3]=t}createSelfUniformData(){let t=new a.default;return t.uniformNameList=["u_param"],t.dataList=[this.E9],t}}e.default=h},e9f0:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("61d7"));class n extends a.default{constructor(t,e,i,s,r=!1,a=!1){super(e,i),this.D_=null,this.C_J=null,this.A8=null,this.BB=null,this.HG=!1,this.HH=null;let n=document.createElement("canvas");n.width=e,n.height=i,n.style.display="bolck",n.style.left="0px",n.style.top="0px",n.style.position="absolute",n.style.pointerEvents="none",this.HG=r,r&&(n.style.backgroundColor="transparent"),this.HH=s,this.A8=t,this.D_=n,this.C_J=n.getContext("2d"),this.C_J.fillStyle=r?s.getCSSDecRGBAColor():s.getCSSHeXRGBColor(),this.C_J.fillRect(0,0,e,i),this.C_u=!0,this.BB=this.A8.textureBlock.createImageTex2D(32,32),this.BB.__$setRenderProxy(this.A8.getRenderProxy()),this.BB.setDataFromImage(this.D_),this.BB.premultiplyAlpha=!0,this.BB.__$attachThis()}clone(){let t=new n(this.A8,this.C_N,this.C_O,this.HH,this.HG);return t}getTexture(){return this.BB}getCanvas(){return this.D_}addSubImage(t,e){let i=this.getAreaByName(t);if(null!=i)return i;if(i=this.addSubTexArea(t,e.width,e.height),null!=i){let t=i.texRect;this.C_J.drawImage(e,t.x,t.y,t.width,t.height),this.BB.setDataFromImage(this.D_),this.BB.updateDataToGpu()}return i}static CreateCharsTexture(t,e,i="rgba(255,255,255,1.0)",s="rgba(64,0,64,1.0)"){if(null==t||""==t||e<8)return null;let a=t+"_"+e+"_"+i+"_"+s;if(n.H6.has(a))return n.H6.get(a);let l=e,h=e+2;t.length>1&&(l=e*t.length);let o=document.createElement("canvas");o.width=l,o.height=h,o.style.display="bolck",o.style.left="0px",o.style.top="0px",o.style.position="absolute",o.style.backgroundColor="transparent";let m=o.getContext("2d");m.font=e-4+"px Verdana",m.textBaseline="top";var _=m.measureText(t);let u=_.width;return t.length>1&&(l=Math.round(u+8),o.width=l,m=o.getContext("2d"),m.font=e-4+"px Verdana",m.textBaseline="top"),m.fillStyle=s,m.fillRect(0,0,l,h),m.textAlign="left",m.fillStyle=i,r.default.IsMobileWeb()&&r.default.IsIOS()?m.fillText(t,.5*(l-u),-4):m.fillText(t,.5*(l-u),4),n.H6.set(a,o),o}}n.H6=new Map,e.default=n},eaee:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("8d98"),a=s(i("0851"));class n extends a.default{constructor(t,e){super(t,e,!1),this.C_F=null,this.k=r.TextureTarget.TEXTURE_CUBE,this.n=r.TextureProxyType.FloatCube,this.internalFormat=r.TextureFormat.RGBA16F,this.dataType=r.TextureDataType.FLOAT,this.mipmapEnabled=!0}toRGBFormat(){this.unpackAlignment=1,this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB16F,this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.mipmapEnabled=!1}toRGBFormatFloat32F(){this.unpackAlignment=1,this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB32F,this.minFilter=r.TextureConst.NEAREST,this.magFilter=r.TextureConst.NEAREST,this.mipmapEnabled=!1}toRGBAFormat(){this.unpackAlignment=4,this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA16F}toRGBAFormatFloat32F(){this.unpackAlignment=4,this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA32F}toRGBAFormatHalfFloat(){this.unpackAlignment=1,this.srcFormat=r.TextureFormat.RGBA,this.dataType=r.TextureDataType.HALF_FLOAT,this.internalFormat=r.TextureFormat.RGBA16F}setDataFromBytesToFaceAt(t,e,i,s,r=0){if(null==this.C_F&&(this.C_F=[null,null,null,null,null,null]),i>0&&s>0){0==t&&r<1&&(this.g=i,this.h=s,this.f=r),null==this.C_F[t]&&(this.C_F[t]=new Array(16));let a=this.C_F[t];a[r]={width:i,height:s,imgData:e,miplevel:r},this.m=null!=a[r].imgData}}uploadData(t){let e,i,s=t.getRC(),a=null,n=this.getWidth(),l=this.getHeight();for(let h=0;h<6;++h){let t=this.C_F[h];if(this.mipmapEnabled&&this.o)a=t[0],s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,r.TextureFormat.ToGL(s,this.internalFormat),n,l,0,r.TextureFormat.ToGL(s,this.srcFormat),r.TextureDataType.ToGL(s,this.dataType),a.imgData);else{e=n,i=l;let o=0;for(;e>0||i>0;)null!=t[o]&&(a=t[o],s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+h,o,r.TextureFormat.ToGL(s,this.internalFormat),e,i,0,r.TextureFormat.ToGL(s,this.srcFormat),r.TextureDataType.ToGL(s,this.dataType),a.imgData)),e>0&&(e>>=1),i>0&&(i>>=1),++o}}this.version=0}toString(){return"[FloatCubeTextureProxy(name:"+this.name+",uid="+this.getUid()+",width="+this.getWidth()+",height="+this.getHeight()+")]"}__$destroy(){if(this.getAttachCount()<1){if(null!=this.C_F)for(let t=0;t<6;++t)null!=this.C_F[t]&&(this.C_F[t].imgData=null);super.__$destroy()}}}e.default=n},eca0:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("2be1")),a=s(i("c62b"));class n{constructor(){this.idsFlag=0,this.count=0,this.rprocessUid=-1}reset(){this.idsFlag=0}}n.RenerProcessMaxTotal=16,e.RCRPObj=n;class l extends r.default{constructor(){super(...arguments),this.HI=[]}createNode(){let t=new n;return t.reset(),this.HI.push(t),new a.default}restoreUid(t){this.HI[t].reset()}testRPNodeExists(t,e){return(this.HI[t].idsFlag&1<<e)>0}testRPNodeNotExists(t,e){return(this.HI[t].idsFlag&1<<e)<1}setRPNodeParam(t,e,i){let s=this.HI[t],r=1<<e;return i>-1?(s.idsFlag&r)<1&&(++s.count,s.rprocessUid=e,s.idsFlag=s.idsFlag|r):(s.idsFlag&r)>0&&(--s.count,s.idsFlag=s.idsFlag&~r),s.count}getRCRPObj(t){return this.HI[t]}}e.RPOUnitBuilder=l},edf2:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("f265")),a=s(i("9951")),n=s(i("425c")),l=s(i("46c6")),h=s(i("7b16")),o=s(i("8e17"));class m{constructor(){this.C_c=null,this.C_d=null,this.A8=null,this.Cw=0,this.HJ=null,this.C_e=null}setMaterialBuilder(t){this.C_e=t}initialize(t,e,i,s,r=50){this.A8=t,this.Cw=e,this.C_c=i,this.C_d=s,null==this.HJ&&(this.HJ=new n.default,this.HJ.animator.diffuseMapEnabled=!0,this.HJ.animator.normalEnabled=!0,this.HJ.setTrackScaleXYZ(.5,.4,1),this.HJ.setFactor(5,5,5),this.HJ.animator.setGroupPositions([new o.default(0,0,-.5*r),new o.default(0,0,.5*r)]),this.HJ.initialize(this.A8.textureBlock,5,[a.default.GetImageTexByUrl("static/assets/default.jpg")],.98),this.HJ.animator.setXYZ(0,20,0))}create(t,e,i,s,a){let n=new r.default;n.materialBuilder=this.C_e,n.roleCamp=this.C_c,n.terrainData=this.C_d,n.campType=s,n.attackDis=50,n.radius=80,n.lifeTime=200;let o=new l.default;o.materialBuilder=this.C_e,o.initWeap01(e),o.initialize(this.A8,n.getAttackModule().getContainer());let m=new h.default;return m.materialBuilder=this.C_e,m.initWeap02(t),m.initialize(this.A8,n.getMotionModule().getContainer()),n.initialize(this.A8,0,this.HJ,o,m,80),n}}e.default=m},ee5a:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.type=0,this.HK=[],this.HL=[],this.HM=[]}addListener(t,e,i){let s=this.HL.length-1;for(;s>=0;--s)if(t===this.HL[s])break;s<0&&(this.HL.push(t),this.HK.push(e),this.HM.push(i))}removeListener(t,e){let i=this.HL.length-1;for(;i>=0;--i)if(t===this.HL[i]){this.HL.splice(i,1),this.HK.splice(i,1),this.HM.splice(i,1);break}}dispatch(t){let e=0,i=this.HL.length;for(let s=0;s<i;++s)(this.HM[s]<1||t.phase==this.HM[s])&&(this.HK[s].call(this.HL[s],t),e=1);return e}passTestEvt(t){let e=this.HL.length;for(let i=0;i<e;++i)if(this.HM[i]<1||t.phase==this.HM[i])return 1;return 0}passTestPhase(t){let e=this.HL.length;for(let i=0;i<e;++i)if(this.HM[i]<1||t==this.HM[i])return 1;return 0}destroy(){this.HL=[],this.HK=[],this.HM=[]}}e.default=s},eebe:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("c497")),n=s(i("8e17")),l=s(i("5336")),h=s(i("1710")),o=i("3d6c"),m=i("ab2e"),_=s(i("1f1a"));class u{constructor(){this.A8=null,this.HN=null,this.HO=new l.default,this.HP=new o.SceneModule,this.B_a=new m.DebugMaterialContext,this.HQ=-1}updateShadow(){let t=this.B_a.vsmModule;null!=t&&(t.setRendererProcessIDList([3,1]),t.setCameraPosition(new n.default(1,1200,1)),t.setCameraNear(100),t.setCameraFar(2e3),t.setMapSize(300,300),t.setCameraViewSize(2600,2600),t.setShadowRadius(1),t.setShadowBias(-.001),t.setShadowIntensity(.85),t.setColorIntensity(.4),t.upate());let e=this.B_a.envData;e.setFogDensity(15e-5),e.update()}shaderLibLoadComplete(t,e){this.updateShadow();let i=5;this.B_a.envData.setAmbientColorRGB3f(i,i,i),this.B_a.envData.setEnvAmbientLightAreaOffset(-1200,-1200),this.B_a.envData.setEnvAmbientLightAreaSize(2400,2400),this.B_a.envData.setEnvAmbientMap(this.B_a.getTextureByUrl("static/assets/brn_03.jpg")),this.initScene()}initMaterialCtx(){let t=new m.MaterialContextParam;t.pointLightsTotal=0,t.directionLightsTotal=2,t.spotLightsTotal=0,t.pbrMaterialEnabled=!1,t.vsmEnabled=!0,t.loadAllShaderCode=!0,t.shaderCodeBinary=!0,this.B_a.addShaderLibListener(this),this.B_a.initialize(this.A8,t);let e=3,i=this.B_a.lightModule,s=i.getDirectionLightAt(0);s.color.setRGB3f(.3*e,1*e,.3*e),s.direction.setXYZ(-.5,-.5,.5),s=i.getDirectionLightAt(1),s.color.setRGB3f(1*e,.3*e,.3*e),s.direction.setXYZ(.5,-.5,.5),this.B_a.lightModule.update(),this.B_a.lightModule.update()}initialize(){if(null==this.HN){r.default.SHADERCODE_TRACE_ENABLED=!0,r.default.VERT_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0,r.default.FRAG_SHADER_PRECISION_GLOBAL_HIGHP_ENABLED=!0;let t=new a.default;t.setPolygonOffsetEanbled(!1),t.setAttriAlpha(!1),t.setAttriAntialias(!r.default.IsMobileWeb()),t.setCamProject(45,30,9e3),t.setCamPosition(1800,1800,1800),this.HN=new _.default,this.HN.initialize(t,5),this.HN.setProcessIdListAt(0,[0,1,2,4]),this.A8=this.HN.rscene,this.HO.initialize(),this.A8.addEventListener(h.default.MOUSE_DOWN,this,this.mouseDown),this.initMaterialCtx(),this.update()}}initScene(){this.HP.initialize(this.A8,this.B_a)}mouseDown(t){this.HN.interaction.viewRay.intersectPlane();this.HN.interaction.viewRay.position}update(){this.HQ>-1&&clearTimeout(this.HQ),this.HQ=setTimeout(this.update.bind(this),50),this.HP.run()}run(){this.HO.update(),this.HP.shadowEnabled&&(this.B_a.vsmModule.force=!0,this.B_a.run()),this.HN.run()}}e.RbtDrama=u,e.default=u},ef2f:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("402a")),a=s(i("8e17")),n=s(i("fecb")),l=s(i("91e2")),h=s(i("b8ff"));class o{constructor(){this.C_O=0,this.sizeScaleX=.7,this.sizeScaleZ=.7,this.srcEntity=null,this.entity=null,this.bounds=new n.default,this.type=0}initialize(){null==o.IS&&(o.IS=new l.default,o.IS.initializeCube(1)),null==o.IT&&(o.IT=new h.default,o.IT.initialize(1,6,6));let t=this.bounds;this.C_O=t.getHeight();let e=new r.default,i=o.IT;1==this.type&&(i=o.IS),e.copyMaterialFrom(i),e.copyMeshFrom(i),e.setScaleXYZ(t.getWidth()*this.sizeScaleX,.5*this.C_O,t.getLong()*this.sizeScaleZ),e.setXYZ(0,this.C_O,0),this.entity=e}setVisible(t){this.entity.setVisible(t)}update(){if(null!=this.srcEntity){let t=o.H_j,e=o.IU;this.srcEntity.getPosition(t),this.srcEntity.getRotationXYZ(e),t.y+=this.C_O,this.entity.setPosition(t),this.entity.setRotation3(e),this.entity.update()}}}o.IS=null,o.IT=null,o.H_j=new a.default,o.IU=new a.default,e.ShadowEntity=o},efce:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("e7d2")),a=s(i("8a0a")),n=s(i("fecb")),l=s(i("cb29")),h=s(i("725b"));class o extends l.default{constructor(t=a.default.VTX_DYNAMIC_DRAW){super(t),this.B_K=null,this.B_L=null,this.C_N=0,this.C_O=0,this.HR=0,this.Bm="",this.flipVerticalUV=!1,this.vtxUVEnabled=!0,this.vertColorEnabled=!1,this.alignFactorX=.5,this.alignFactorY=.5,this.fontSystem=null}getWidth(){return this.C_N}getHeight(){return this.C_O}createStrData(t){this.Bm=t;let e=t.length;this.HR=e;let i=!1,s=this.fontSystem;if(null==s&&(s=h.default.GetInstance()),e>0){s.createCharsTexFromStr(t),this.C_N=-1,this.C_O=0;let a=o.IX,l=0,h=0,m=0,_=0,u=0;i=null!=this.B_K&&8*e>this.B_K.length;let d=s.getCharTable();if(i){let i=o.IV;for(i.set(o.IW,0),this.B_O=new Uint16Array(6*e),this.B_L=new Float32Array(8*e),this.B_K=new Float32Array(8*e);l<e;++l)this.B_O.set(i,6*l),i[0]+=4,i[1]+=4,i[2]+=4,i[3]+=4,i[4]+=4,i[5]+=4,d.getUV8AndSizeFromChar(t.charAt(l),this.B_L,a,8*l),this.C_O<a[1]&&(this.C_O=a[1]),this.B_K[8*l]=a[0],this.C_N+=a[0]}else for(null==this.B_K&&(this.B_L=new Float32Array(8*e),this.B_K=new Float32Array(8*e));l<e;++l)d.getUV8AndSizeFromChar(t.charAt(l),this.B_L,a,8*l),this.C_O<a[1]&&(this.C_O=a[1]),this.B_K[8*l]=a[0],this.C_N+=a[0];let c=1;this.C_N+=e*c,_=-this.alignFactorX*this.C_N,u=-this.alignFactorY*this.C_O,m=u+this.C_O,null==this.bounds&&(this.bounds=new n.default),this.bounds.min.setXYZ(_,u,0),this.bounds.max.setXYZ(_+this.C_N,m,0);let f=0;for(l=0;l<e;++l)h=_+this.B_K[f],this.B_K[f]=_,this.B_K[f+1]=u,this.B_K[f+2]=h,this.B_K[f+3]=u,this.B_K[f+4]=h,this.B_K[f+5]=m,this.B_K[f+6]=_,this.B_K[f+7]=m,_=h+c,f+=8;r.default.Reset(),r.default.AddFloat32Data(this.B_K,2),r.default.AddFloat32Data(this.B_L,2)}i&&this.B_Q.setUint16IVSData(this.B_O),this.vtCount=6*e,this.vtxTotal=4*e,this.trisNumber=2*e}initialize(t){let e=t.length,i=o.IV;i.set(o.IW,0),null==this.B_O&&(this.B_O=new Uint16Array(6*e));for(let s=0;s<e;++s)this.B_O.set(i,6*s),i[0]+=4,i[1]+=4,i[2]+=4,i[3]+=4,i[4]+=4,i[5]+=4;this.createStrData(t),r.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.B_Q=r.default.CreateBySaveData(this.getBufDataUsage()),this.B_Q.setUint16IVSData(this.B_O),this.buildEnd()}updateCharStr(t){null!=this.B_Q&&this.Bm!=t&&(this.createStrData(t),this.buildEnd(),r.default.UpdateBufData(this.B_Q))}__$destroy(){this.isResFree()&&(this.bounds=null,this.B_K=null,this.B_L=null,super.__$destroy()),this.fontSystem=null}}o.IW=new Uint8Array([0,1,2,0,2,3]),o.IV=new Uint8Array([0,1,2,0,2,3]),o.IX=[0,0],e.default=o},f041:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("fecb"));class n{constructor(){this.HS=new r.default,this.rn=8,this.cn=8,this.gridSize=80,this.stvs=null,this.freeSTVS=null,this.terrainHeight=20,this.obstacleHeight=30,this.obstacleY=20,this.positionOffset=new r.default,this.minPosition=new r.default,this.maxPosition=new r.default,this.HT=new a.default}initialize(){let t=this.rn,e=this.cn,i=this.gridSize;this.minPosition.setXYZ(e*i*-.5,0,t*i*-.5),this.maxPosition.setXYZ(this.minPosition.x+e*i,0,this.minPosition.z+t*i),this.HT.min.copyFrom(this.minPosition),this.HT.max.copyFrom(this.maxPosition),this.HT.updateFast();let s=[];for(let r=0;r<this.stvs.length;++r)0==this.stvs[r]&&s.push(Math.floor(r/t),r%e);this.freeSTVS=new Uint16Array(s)}getRandomFreeRC(){let t=this.freeSTVS.length>>1,e=Math.round(1024*Math.random())%t;return e<<=1,[this.freeSTVS[e],this.freeSTVS[e+1]]}getRandomFreeGridPosition(){let t=this.getRandomFreeRC();return this.getGridPositionByRC(t[0],t[1])}getRCByPosition(t){this.HT.getClosePosition(t,this.HS,1),this.HS.subtractBy(this.HT.min);let e=Math.floor(this.HS.z/this.gridSize),i=Math.floor(this.HS.x/this.gridSize);return[e,i]}containsPosition(t){return this.HT.containsXZ(t.x,t.z)}isObstacleByRC(t,e){return 1==this.stvs[t*this.rn+e]}getGridStatusByRC(t,e){return this.stvs[t*this.rn+e]}getGridPositionByRC(t,e){let i=this.HS;return i.x=this.minPosition.x+e*this.gridSize+.5*this.gridSize,i.y=this.minPosition.y,i.z=this.minPosition.z+t*this.gridSize+.5*this.gridSize,i}getTerrainPositionByRC(t,e){let i=this.HS;return i.x=this.minPosition.x+e*this.gridSize+.5*this.gridSize,i.y=this.minPosition.y+this.terrainHeight,i.z=this.minPosition.z+t*this.gridSize+.5*this.gridSize,i}clone(){let t=new n;return t.rn=this.rn,t.cn=this.cn,null!=this.stvs&&(t.stvs=this.stvs.slice(0)),t}}e.TerrainData=n},f043:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("3930"));class n{constructor(){this.position=new r.default(0,100,0),this.direction=new r.default(0,-1,0,0),this.color=new a.default(1,1,1,1),this.angleDegree=30,this.attenuationFactor1=1e-4,this.attenuationFactor2=5e-4}}e.SpotLight=n},f044:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{static CreateNewID(){return s.__s_uid++}}s.__s_uid=0,e.default=s},f0d9:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("e7d2")),a=s(i("8a0a")),n=s(i("fecb")),l=s(i("cb29"));class h extends l.default{constructor(t=a.default.VTX_STATIC_DRAW){super(t),this.B_K=null,this.HU=null,this.B_L=null,this.HV=null,this.B_M=null,this.HW=null,this.C_G=0,this.HX=0,this.flipVerticalUV=!1}setUVSFloatArr(t){null==this.B_L&&(this.B_L=new Float32Array(8)),this.B_L.set(t,0)}setUVSArr(t){null==this.B_L&&(this.B_L=new Float32Array(8)),this.B_L.set(t,0)}createData(t){if(null==this.B_K&&t>0){this.HX=0,this.C_G=t;let e=0,i=0,s=[0,1,2,0,2,3],r=new Uint16Array(6*t),a=6*t;for(e=0;e<a;)r[e++]=s[0]+i,r[e++]=s[1]+i,r[e++]=s[2]+i,r[e++]=s[3]+i,r[e++]=s[4]+i,r[e++]=s[5]+i,i+=4;this.B_O=r,this.B_K=new Float32Array(16*t),this.HU=new Float32Array(16*t),this.HU.fill(1),this.B_L=new Float32Array(8*t),this.HV=new Float32Array(16*t),this.B_M=new Float32Array(16*t),this.HW=new Float32Array(16*t);let l=[0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1];for(e=0;e<t;++e)this.B_M.set(l,16*e);let h=[];for(h=this.flipVerticalUV?[0,0,1,0,1,1,0,1]:[0,1,1,1,1,0,0,0],e=0;e<t;++e)this.B_L.set(h,8*e);this.bounds=new n.default}}setSizeAndScaleAt(t,e,i,s,r){if(t>=0&&t<this.C_G){let a=.5*e,n=.5*i,l=-a,h=-n,o=r-s;t*=16,this.B_K[t++]=l,this.B_K[t++]=h,this.B_K[t++]=s,this.B_K[t++]=o,this.B_K[t++]=a,this.B_K[t++]=h,this.B_K[t++]=s,this.B_K[t++]=o,this.B_K[t++]=a,this.B_K[t++]=n,this.B_K[t++]=s,this.B_K[t++]=o,this.B_K[t++]=l,this.B_K[t++]=n,this.B_K[t++]=s,this.B_K[t++]=o,this.bounds.addXYZ(l,h,l),this.bounds.addXYZ(a,n,a)}}setPositionAt(t,e,i,s){if(t>=0&&t<this.C_G){t*=16;for(let r=0;r<4;++r)this.HU[t++]=e,this.HU[t++]=i,this.HU[t++]=s,t++}}setVelocityAt(t,e,i,s){if(t>=0&&t<this.C_G){t*=16;for(let r=0;r<4;++r)this.B_M[t++]=e,this.B_M[t++]=i,this.B_M[t++]=s,t++}}setAccelerationAt(t,e,i,s){if(t>=0&&t<this.C_G){t*=16;for(let r=0;r<4;++r)this.HW[t++]=e,this.HW[t++]=i,this.HW[t++]=s,t++}}setAlphaAt(t,e){if(t>=0&&t<this.C_G){t=16*t+3;for(let i=0;i<4;++i)this.HU[t]=e,t+=4}}setBrightnessAt(t,e){if(t>=0&&t<this.C_G){t=16*t+3;for(let i=0;i<4;++i)this.HU[t]=e,t+=4}}setUVRectAt(t,e,i,s,r){t>=0&&t<this.C_G&&(t*=8,this.flipVerticalUV?(this.B_L[t++]=e,this.B_L[t++]=i,this.B_L[t++]=e+s,this.B_L[t++]=i,this.B_L[t++]=e+s,this.B_L[t++]=i+r,this.B_L[t++]=e,this.B_L[t]=i+r):(this.B_L[t++]=e,this.B_L[t++]=i+r,this.B_L[t++]=e+s,this.B_L[t++]=i+r,this.B_L[t++]=e+s,this.B_L[t++]=i,this.B_L[t++]=e,this.B_L[t]=i))}setTimeAt(t,e,i,s,r=0){if(t>=0&&t<this.C_G){e<.1&&(e=.1),i>.9&&(i=.9),s<i&&(s=i),t*=16;for(let a=0;a<4;++a)this.HV[t++]=e,this.HV[t++]=i,this.HV[t++]=s,this.HV[t++]=r;this.HX<r+e&&(this.HX=r+e)}}setTimeSpeedAt(t,e){if(t>=0&&t<this.C_G){t=16*t+3;for(let i=0;i<4;++i)this.B_M[t]=e,t+=4}}getEndTime(){return this.HX}initialize(){r.default.Reset(),r.default.AddFloat32Data(this.B_K,4),r.default.AddFloat32Data(this.B_L,2),r.default.AddFloat32Data(this.B_M,4),r.default.AddFloat32Data(this.HU,4),r.default.AddFloat32Data(this.HV,4),r.default.AddFloat32Data(this.HW,4),r.default.vbWholeDataEnabled=this.vbWholeDataEnabled,this.B_Q=r.default.CreateBySaveData(this.getBufDataUsage()),this.B_Q.setUint16IVSData(this.B_O),this.vtCount=this.B_O.length,this.vtxTotal=4*this.C_G,this.trisNumber=2*this.C_G,this.buildEnd()}setUV(t,e,i,s){null!=this.B_Q&&(this.B_Q.setData2fAt(0,1,t,e+s),this.B_Q.setData2fAt(1,1,t+i,e+s),this.B_Q.setData2fAt(2,1,t+i,e),this.B_Q.setData2fAt(3,1,t,e))}__$destroy(){this.B_K=null,this.HU=null,this.B_L=null,this.HV=null,this.B_M=null,this.HW=null,super.__$destroy()}}e.default=h},f0f0:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("f044"));class a{constructor(t){this.T=-1,this.C_G=0,this.layoutBit=0,this.CC=null,this.HY=null,this.HZ=0,this.T=r.default.CreateNewID()}getUid(){return this.T}getType(){return 0}getBuffersTotal(){return 1}getF32DataAt(t){return this.HY}setF32DataAt(t,e,i,s){null!=s&&(this.CC=s),this.HZ=i,this.HY=e}setData4fAt(t,e,i,s,r,a){t=this.HZ*t+this.CC[e],this.HY[t++]=i,this.HY[t++]=s,this.HY[t++]=r,this.HY[t++]=a}setData3fAt(t,e,i,s,r){t=this.HZ*t+this.CC[e],this.HY[t++]=i,this.HY[t++]=s,this.HY[t++]=r}setData2fAt(t,e,i,s){t=this.HZ*t+this.CC[e],this.HY[t++]=i,this.HY[t++]=s}destroy(){this.CC=null,this.HY=null}toString(){return"VtxCombinedBuf(uid = "+this.T+")"}}e.default=a},f152:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("38de")),n=s(i("fecb")),l=s(i("35fa")),h=s(i("8a0a")),o=s(i("e7d2")),m=s(i("5282")),_=s(i("cb29"));class u extends _.default{constructor(t=h.default.VTX_STATIC_DRAW){super(t),this.F7=10,this.F8=10,this.B_y=50,this.B_K=null,this.B_L=null,this.B_M=null,this.B_N=null,this.inverseUV=!1,this.uvScale=1}getVS(){return this.B_K}getUVS(){return this.B_L}getNVS(){return this.B_M}getCVS(){return this.B_N}getIVS(){return this.B_O}initialize(t,e,i,s){if(this.vtxTotal<1){if(t<.01)return;this.bounds=new n.default,this.bounds.min.setXYZ(-t,-t,-t),this.bounds.max.setXYZ(t,t,t),this.bounds.updateFast(),e<2&&(e=2),i<2&&(i=2),this.B_y=Math.abs(t),this.F7=e,this.F8=i,(this.F8+1)%2==0&&(this.F8+=1),(this.F7=this.F8)&&(this.F7+=1);let r=1,a=0,_=0,u=0,d=0,c=0,f=0,p=new m.default(0,-this.B_y,0,_),g=[],v=[];v.push([]);let x=v[0],y=this.inverseUV?1:.5;p.u=p.v=y,p.nx=0,p.ny=-1,p.nz=0,x.push(p.cloneVertex()),g.push(x[0]);let T=0,b=(this.B_y,0),S=1/this.B_y;Math.PI,this.B_y,this.B_y;for(r=0;r<this.F8;++r){d=Math.PI*r/this.F8,c=Math.sin(d),f=Math.cos(d),p.y=-this.B_y*f,T=this.B_y*c,b=this.inverseUV?Math.abs(d/Math.PI-.5):.5-Math.abs(d/Math.PI-.5),b*=this.uvScale,v.push([]);let t=v[r];for(a=0;a<this.F7;++a)u=2*Math.PI*a/this.F7,++_,c=Math.sin(u),f=Math.cos(u),p.x=c*T,p.z=f*T,p.index=_,p.u=.5+c*b,p.v=.5+f*b,p.nx=p.x*S,p.ny=p.y*S,p.nz=p.z*S,t.push(p.cloneVertex()),g.push(t[a]);t.push(t[0])}++_,p.index=_,p.x=0,p.y=this.B_y,p.z=0,p.u=p.v=y,p.nx=0,p.ny=1,p.nz=0,v.push([]);let E=v[this.F8];E.push(p.cloneVertex()),g.push(E[0]);let M=null,A=[],R=null,L=null;for(r=1;r<=this.F8;++r)for(R=v[r-1],L=v[r],a=1;a<=this.F7;++a)1==r?(A.push(R[0].index),A.push(L[a].index),A.push(L[a-1].index)):r==this.F8?(A.push(R[a].index),A.push(L[0].index),A.push(R[a-1].index)):(A.push(R[a].index),A.push(L[a-1].index),A.push(R[a-1].index),A.push(R[a].index),A.push(L[a].index),A.push(L[a-1].index));for(this.vtxTotal=g.length,s?(this.B_O=new Uint16Array(2*A.length),this.B_O.set(A,0),A.reverse(),this.B_O.set(A,A.length)):this.B_O=new Uint16Array(A),this.B_K=new Float32Array(3*this.vtxTotal),r=0,a=0;a<this.vtxTotal;++a)M=g[a],this.B_K[r]=M.x,this.B_K[r+1]=M.y,this.B_K[r+2]=M.z,r+=3;if(o.default.Reset(),o.default.AddFloat32Data(this.B_K,3),this.isVBufEnabledAt(h.default.VBUF_UVS_INDEX)){for(this.B_L=new Float32Array(2*this.vtxTotal),r=0,a=0;a<this.vtxTotal;++a)M=g[a],this.B_L[r]=M.u,this.B_L[r+1]=M.v,r+=2;o.default.AddFloat32Data(this.B_L,2)}if(this.isVBufEnabledAt(h.default.VBUF_NVS_INDEX)){for(this.B_M=new Float32Array(3*this.vtxTotal),r=0,a=0;a<this.vtxTotal;++a)M=g[a],this.B_M[r]=M.nx,this.B_M[r+1]=M.ny,this.B_M[r+2]=M.nz,r+=3;o.default.AddFloat32Data(this.B_M,3)}if(this.isVBufEnabledAt(h.default.VBUF_CVS_INDEX)){for(this.B_N=new Float32Array(3*this.vtxTotal),r=0,a=0;a<this.vtxTotal;++a)this.B_N[r]=1,this.B_N[r+1]=1,this.B_N[r+2]=1,r+=3;o.default.AddFloat32Data(this.B_N,3)}if(this.isVBufEnabledAt(h.default.VBUF_TVS_INDEX)){let t=this.B_O.length/3,e=new Float32Array(this.B_K.length),i=new Float32Array(this.B_K.length);l.default.ClacTrisTangent(this.B_K,this.B_K.length,this.B_L,this.B_M,t,this.B_O,e,i),o.default.AddFloat32Data(e,3),o.default.AddFloat32Data(i,3)}this.updateWireframeIvs(),o.default.vbWholeDataEnabled=this.vbWholeDataEnabled,null==this.B_Q?(this.B_Q=o.default.CreateBySaveData(this.getBufDataUsage()),this.B_Q.setUint16IVSData(this.B_O)):(this.forceUpdateIVS&&this.B_Q.setUint16IVSData(this.B_O),o.default.UpdateBufData(this.B_Q)),this.vtCount=this.B_O.length,this.trisNumber=this.vtCount/3}}__$destroy(){this.isResFree()&&(this.bounds=null,this.B_K=null,this.B_L=null,this.B_M=null,this.B_N=null,super.__$destroy())}testRay(t,e,i,s){return a.default.IntersectioNearSphere2(t,e,r.default.ZERO,this.B_y,i)}toString(){return"Sphere3DMesh()"}}e.default=u},f208:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(){this.info=""}}e.default=s},f265:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17")),a=s(i("c06a")),n=s(i("e7e2")),l=s(i("63ff")),h=s(i("96af")),o=i("ef2f");class m extends l.default{constructor(){super(),this.Cw=0,this.Cx=null,this.Cy=null,this.Ha=null,this.materialBuilder=null,this.Cx=new a.default,this.Cy=new n.default,this.C2=this.Cx,this.C3=this.Cy}initializeFrom(t){null!=t&&(this.campType=t.campType,this.lifeTime=t.lifeTime,this.attackDis=t.attackDis,this.radius=t.radius)}initialize(t,e,i,s,a,n=50){if(null==this.A8&&null!=t){this.A8=t,this.Ha=i;let l=new r.default(0,6,0);this.Cx.materialBuilder=this.materialBuilder,this.Cx.initialize(t,e,a,this.Ha,n,l),l.setXYZ(0,0,0),this.Cy.initialize(t,e,s,l),this.C1.setSpeed(this.C_y),this.C1.syncTargetUpdate=!1,this.C1.syncDirecUpdate=!1,this.C1.setTarget(this.Cx.getContainer()),this.C1.setVelocityFactor(.02,.03);let m=new h.default;m.dstCamp=this.roleCamp,m.srcRole=this,m.campType=this.campType,this.C_a=m,this.C2.direcByDegree(0,!1);let _=this.Cx.getContainer();_.update();let u=_.getGlobalBounds();this.shadowEntity=new o.ShadowEntity;let d=this.shadowEntity;d.type=1,d.sizeScaleX=1,d.sizeScaleZ=1,d.srcEntity=_,d.bounds.copyFrom(u),d.initialize(),t.addEntity(d.entity,3)}}wake(){super.wake()}getHitPos(t){t.copyFrom(this.position),t.y+=50}getDestroyedPos(t){t.copyFrom(this.position),t.y+=30}consume(t){this.lifeTime-=t,this.lifeTime<1&&this.sleep()}attackTest(){return!0}destroy(){this.materialBuilder=null}}e.default=m},f367:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("29ef")),a=s(i("402a")),n=s(i("25cf")),l=s(i("8910"));class h extends a.default{constructor(t=null){super(t),this.A_u=!0,this.A_v=!1,this.C_7=null,this.flipVerticalUV=!1,this.flip90UV=!1,this.setRenderState(r.default.BACK_ADD_BLENDSORT_STATE)}createMaterial(t){null==this.getMaterial()?(this.C_7=new n.default(this.A_u,this.A_v),this.C_7.setTextureList(t),this.setMaterial(this.C_7)):(this.C_7=this.getMaterial(),this.C_7.setTextureList(t))}showDoubleFace(t=!0){t?this.setRenderState(r.default.NONE_CULLFACE_NORMAL_STATE):this.setRenderState(r.default.NORMAL_STATE)}toTransparentBlend(t=!1){this.A_u=!1,this.A_v=!0,t?this.setRenderState(r.default.BACK_TRANSPARENT_STATE):this.setRenderState(r.default.BACK_TRANSPARENT_ALWAYS_STATE)}toBrightnessBlend(t=!1){this.A_u=!0,this.A_v=!1,this.setRenderState(r.default.BACK_ADD_BLENDSORT_STATE)}setRGB3f(t,e,i){null!=this.C_7&&this.C_7.setRGB3f(t,e,i)}setRGBOffset3f(t,e,i){null!=this.C_7&&this.C_7.setRGBOffset3f(t,e,i)}setFadeFactor(t){null!=this.C_7&&this.C_7.setFadeFactor(t)}getFadeFactor(){return this.C_7.getFadeFactor()}setBeginAndEndPos(t,e){if(null!=this.C_7)return this.C_7.setBeginAndEndPos(t,e)}setBeginPos(t){if(null!=this.C_7)return this.C_7.setBeginPos(t)}setEndPos(t){if(null!=this.C_7)return this.C_7.setEndPos(t)}setLineWidth(t){if(null!=this.C_7)return this.C_7.setLineWidth(t)}getLineWidth(){return null!=this.C_7?this.C_7.getLineWidth():0}setUVParam(t,e,i,s){if(null!=this.C_7)return this.C_7.setUVParam(t,e,i,s)}setUVScale(t,e){if(null!=this.C_7)return this.C_7.setUVScale(t,e)}setUVOffset(t,e){if(null!=this.C_7)return this.C_7.setUVOffset(t,e)}setFadeRange(t,e){if(null!=this.C_7)return this.C_7.setFadeRange(t,e)}setUVRotation(t){if(null!=this.C_7)return this.C_7.setUVRotation(t)}initialize(t=null){this.createMaterial(t),this.activeDisplay()}__activeMesh(t){if(null==this.getMesh()){let e=new l.default;e.flipVerticalUV=this.flipVerticalUV,e.vbWholeDataEnabled=this.vbWholeDataEnabled,e.flip90UV=this.flip90UV,e.setBufSortFormat(t.getBufSortFormat()),e.initializeBill(),this.setMesh(e)}}toString(){return"[BillboardLine3DEntity]"}}e.default=h},f3a2:function(t,e,i){"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t["None"]="",t["Default"]="pbr",t["Lambert"]="lambert",t["PBR"]="pbr"}(s||(s={})),e.ShaderCodeUUID=s},f444:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("1710")),a=i("bcac"),n=i("278e");class l{constructor(){this.A_9=null,this.Hb=new a.CameraDragSwinger,this.Hc=new n.CameraDragSlide,this.Hd=!0}initialize(t,e){null==this.A_9&&(this.A_9=t,this.Hb.initialize(t,e),this.Hc.initialize(t,e),t.addEventListener(r.default.MOUSE_BG_DOWN,this,this.mouseDownListener,!0,!1),t.addEventListener(r.default.MOUSE_UP,this,this.mouseUpListener,!1,!0))}setSlideSpeed(t){this.Hc.slideSpeed=t}enableSwing(){this.Hd=!0}enableSlide(){this.Hd=!1}mouseDownListener(t){this.Hb.attach(),this.Hc.attach()}mouseUpListener(t){this.Hb.detach(),this.Hc.detach()}detach(){this.Hb.detach(),this.Hc.detach()}runWithYAxis(){this.Hd?this.Hb.runWithYAxis():this.Hc.run()}runWithZAxis(){this.Hd?this.Hb.runWithZAxis():this.Hc.run()}}e.default=l},f48d:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("8e17"));class a{constructor(){this.id=-1,this.position=new r.default}update(){}updateFast(){}}a.__tV0=new r.default,a.__tV1=new r.default,a.__tV2=new r.default,e.AbsGeomBase=a,e.default=a},f610:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("fecb"));class a{constructor(){this.B_K=null,this.B_L=null,this.B_M=null,this.C_C=null,this.C_D=null,this.B_N=null,this.B_O=null,this.bounds=new r.default,this.vtxTotal=0,this.trisNumber=0,this.vtCount=0}clone(){let t=new a;return t.copyFrom(this),t}copyFrom(t){let e=new a;null!=t.B_K&&(null!=this.B_K?this.B_K.set(t.B_K):this.B_K=t.B_K.slice(0)),null!=t.B_L&&(null!=this.B_L?this.B_L.set(t.B_L):this.B_L=t.B_L.slice(0)),null!=t.B_M&&(null!=this.B_M?this.B_M.set(t.B_M):this.B_M=t.B_M.slice(0)),null!=t.C_C&&(null!=this.C_C?this.C_C.set(t.C_C):this.C_C=t.C_C.slice(0)),null!=t.C_D&&(null!=this.C_D?this.C_D.set(t.C_D):this.C_D=t.C_D.slice(0)),null!=t.B_N&&(null!=this.B_N?this.B_N.set(t.B_N):this.B_N=t.B_N.slice(0)),null!=t.B_O&&(null!=this.B_O?this.B_O.set(t.B_O):this.B_O=t.B_O.slice(0)),e.vtxTotal=this.vtxTotal,e.trisNumber=this.trisNumber,e.vtCount=this.vtCount,e.bounds.copyFrom(this.bounds)}getVS(){return this.B_K}getUVS(){return this.B_L}getNVS(){return this.B_M}getTVS(){return this.C_C}getBTVS(){return this.C_D}getCVS(){return this.B_N}getIVS(){return this.B_O}reset(){this.B_K=null,this.B_L=null,this.B_M=null,this.C_C=null,this.C_D=null,this.B_O=null,this.vtxTotal=0,this.trisNumber=0,this.vtCount=0}toString(){return"GeometryBase()"}}e.default=a},f63b:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=i("8d98"),n=s(i("3b73"));function l(t,e,i){var s=document.createElement("canvas");s.width=e,s.height=i,s.style.backgroundColor="transparent",s.style.display="block",s.style.left="0px",s.style.top="0px",s.style.position="absolute";let r=s.getContext("2d");return r.drawImage(t,0,0,t.width,t.height,0,0,s.width,s.height),{canvas:s,ctx2d:r}}function h(t,e,i){var s=document.createElement("canvas");s.width=e,s.height=i,s.style.backgroundColor="transparent",s.style.display="block",s.style.left="0px",s.style.top="0px",s.style.position="absolute";let r=s.getContext("2d");return r.globalCompositeOperation="destination-atop",r.fillStyle="rgba(255, 255, 255, 1.0)",r.rect(0,0,s.width,s.height),r.fill(),r.drawImage(t,0,0,t.width,t.height,0,0,s.width,s.height),{canvas:s,ctx2d:r}}class o{constructor(t,e){this.He="",this.Hf=null,this.B_Z=!1,this.Hg=0,this.texture=null,this.bytesTex=null,this.powerOf2Fix=!1,this.offsetTex=null,this.premultipliedAlpha=!0,this.He=t,this.Hg=e}startLoad(){if(null==this.Hf){let t=this;this.Hf=new Image,this.Hf.onload=function(e){t.B_Z=!0,t.buildTex()},this.Hf.addEventListener("error",e=>{t.He}),this.Hf.crossOrigin="",this.Hf.src=this.He}}buildTex(){let t=this.Hf;if(null!=t&&this.B_Z){let e=this.texture,i=this.offsetTex,s=this.bytesTex,a=null,o=r.default.IsPowerOf2(t.width)&&r.default.IsPowerOf2(t.height),m=this.powerOf2Fix;if(n.default.IsWebGL1()&&(m=!0),!o&&m){let o=r.default.CalcCeilPowerOfTwo(t.width),m=r.default.CalcCeilPowerOfTwo(t.height);o>n.default.MAX_TEXTURE_SIZE&&(o=n.default.MAX_TEXTURE_SIZE),m>n.default.MAX_TEXTURE_SIZE&&(o=n.default.MAX_TEXTURE_SIZE);let _=l(t,o,m),u=this.Hg;if(null!=e&&(e.setDataFromImage(_.canvas,u),e.name=this.Hf.src,null!=i&&(_=h(t,o,m),i.setDataFromImage(_.canvas,u))),null!=s)if(this.premultipliedAlpha)a=_.ctx2d.getImageData(0,0,_.canvas.width,_.canvas.height),s.setDataFromBytes(a.data,u,_.canvas.width,_.canvas.height),s.name=this.Hf.src;else{a=_.ctx2d.getImageData(0,0,_.canvas.width,_.canvas.height);let e=a.data,i=h(t,o,m);a=i.ctx2d.getImageData(0,0,i.canvas.width,i.canvas.height);let r=a.data,n=0,l=0,d=0;for(;n<m;++n)for(l=0;l<o;++l)e[d]+=255-r[d],e[d+1]+=255-r[d+1],e[d+2]+=255-r[d+2],d+=4;s.setDataFromBytes(e,u,_.canvas.width,_.canvas.height),s.name=this.Hf.src}}else if(null!=e)this.powerOf2Fix,e.setDataFromImage(t,this.Hg),e.name=this.Hf.src;else if(null!=s){let e=r.default.CalcNearestCeilPow2(t.width),i=r.default.CalcNearestCeilPow2(t.height);e>2048&&(e=2048),i>2048&&(e=2048);let n=l(t,e,i),h=this.Hg;a=n.ctx2d.getImageData(0,0,n.canvas.width,n.canvas.height),s.setDataFromBytes(a.data,h,n.canvas.width,n.canvas.height),s.name=this.Hf.src}this.B_Z=!0}}getURL(){return this.He}getImage(){return this.Hf}isLoaded(){return this.B_Z}destroy(){this.B_Z=!1,this.He="",this.texture=null,this.Hf.src="",this.Hf=null}}class m{constructor(t){this.Hh=null,this.Hi=[],this.F_O=0,this.B_Z=!1,this.AP=[],this.Hj=[],this.Hh=t;var e=this;let i=0,s=null;for(;i<6;++i)s=new Image,s.onload=function(t){if(e.F_O++,e.F_O>=6){let t=0;for(t=0;t<6;++t)e.AP[0].setDataFromImageToFaceAt(t,e.Hi[t],e.Hj[0]);e.AP[0].name=e.Hi.src}},s.crossOrigin="",s.src=e.Hh[i],e.Hi.push(s)}addTex(t,e){this.AP.push(t),this.Hj.push(e)}getURLAt(t){return this.Hh[0]}getTexAt(t){return this.AP[t]}isLoaded(){return this.B_Z}destroy(){}}class _{constructor(t){this.Hk=new Map,this.D_B=new Map,this.Hl=[],this.Hm=[],this.Hn=[],this.Ho=5,this.Hp=17,this.Hq=17,this.Hr=512,this.Hs=512,this.Ht=null,this.Dj=0,this.Ht=t,null!=t&&t.addTexLoader(this)}getTexByUrl(t,e=!0,i=!0,s=!1){let r=this.getImageTexByUrl(t,0,!1,s);return r.mipmapEnabled=i,e&&r.setWrap(a.TextureConst.WRAP_REPEAT),r}getBytesNoPremultipliedAlphaTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let i=this.D_B.get(t);if(null==i){i=new o(t,e),i.premultipliedAlpha=!1,this.D_B.set(t,i);let s=this.Ht.createBytesTex(1,1);return s.name=t,i.bytesTex=s,this.Hm.push(i),s}return i.bytesTex.isDestroyed()&&(i.bytesTex=this.Ht.createBytesTex(1,1)),i.bytesTex}getBytesTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let i=this.D_B.get(t);if(null==i){i=new o(t,e),this.D_B.set(t,i);let s=this.Ht.createBytesTex(1,1);return s.name=t,i.bytesTex=s,this.Hm.push(i),s}return i.bytesTex.isDestroyed()&&(i.bytesTex=this.Ht.createBytesTex(1,1)),i.bytesTex}getImageOffsetTexByUrl(t,e=0){if(""==t)return null;e<0&&(e=0);let i=this.D_B.get(t);return null!=i?i.offsetTex:null}getImageTexByUrl(t,e=0,i=!1,s=!1){if(""==t)return null;e<0&&(e=0);let r=this.D_B.get(t);if(null==r){r=new o(t,e),r.powerOf2Fix=s,i&&(r.offsetTex=this.Ht.createImageTex2D(1,1)),this.D_B.set(t,r);let a=this.Ht.createImageTex2D(1,1);return a.name=t,r.texture=a,this.Hm.push(r),a}return r.texture.isDestroyed()&&(r.texture=this.Ht.createImageTex2D(1,1)),r.texture}getCubeTexAndLoadImg(t,e,i=0){if(""==t||null==e||e.length<6)return null;i<0&&(i=0);let s=this.Hk.get(t);if(null==s){s=new m(e),this.Hk.set(t,s);let r=this.Ht.createImageCubeTex(8,8);return s.addTex(r,i),r}return s.getTexAt(0)}setRunFlag(t){this.Dj=t}getRunFlag(){return this.Dj}isRunning(){return!0}isStopped(){return!1}run(){let t=0,e=null;if(--this.Hp,this.Hp<1){this.Hp=this.Hq;let i=this.Hn.length;if(i>0)for(;t<i;++t)this.Hn[t].isLoaded()&&(this.Hl.push(this.Hn[t]),this.Hn.splice(t,1),--t,--i);let s=this.Hm.length;if(s>0&&i<this.Ho)for(t=i;t<this.Ho;++t){if(!(this.Hm.length>0))break;e=this.Hm.pop(),this.Hn.push(e),e.startLoad()}}if(--this.Hr,this.Hr<1){this.Hr=this.Hs;let i=null,s=this.Hl.length;for(t=0;t<s;++t)e=this.Hl[t],i=null!=e.texture?e.texture:e.bytesTex,i.isDestroyed()&&(this.D_B.delete(e.getURL()),this.Hl.splice(t,1),e.destroy(),--t,--s)}}getWaitTotal(){return this.Hm.length}isLoadedAll(){return this.Hm.length<1}}e.default=_},f63e:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("b3bd")),a=s(i("0fc4")),n=s(i("faa5"));class l extends n.default{constructor(){super(),this.n_=""}initialize(t){super.initialize(t),this.n_="VOX_Default3DShd",this.Hv&&(this.n_+="_tex"),this.vertColorEnabled&&(this.n_+="_vtxColor"),this.premultiplyAlpha&&(this.n_+="_preMulAlpha"),this.adaptationShaderVersion=!1}buildShader(){let t=this.A_s;t.addVertLayout("vec3","a_vs"),t.addFragUniform("vec4","u_color"),t.useVertSpaceMats(!0,!0,!0),this.Hv&&(this.A_t.addDiffuseMap(),t.addVertLayout("vec2","a_uvs"),t.addVarying("vec2","v_uv")),this.vertColorEnabled&&(t.addVertLayout("vec3","a_cvs"),t.addVarying("vec3","v_cv")),t.addFragOutput("vec4","FragColor0"),t.addFragMainCode("\n    FragColor0 = vec4(1.0);\n    #ifdef VOX_USE_2D_MAP\n        //  FragColor0 *= VOX_Texture2D(VOX_DIFFUSE_MAP, vec2(v_uv[0],v_uv[1]));\n        FragColor0 *= VOX_Texture2D(VOX_DIFFUSE_MAP, v_uv.xy);\n    #endif\n    #ifdef VOX_USE_VTX_COLOR\n        FragColor0.xyz *= v_cv.xyz;\n    #endif\n    #ifdef VOX_PREMULTIPLY_ALPHA\n        FragColor0.rgb *= u_color.xyz;\n        FragColor0.a *= u_color.w;\n        FragColor0.rgb *= u_color.aaa;\n    #else\n        FragColor0 *= u_color;\n    #endif\n"),t.addVertMainCode("\n    localPosition = vec4(a_vs.xyz,1.0);\n    worldPosition = u_objMat * localPosition;\n    viewPosition = u_viewMat * worldPosition;\n    gl_Position = u_projMat * viewPosition;\n\n    #ifdef VOX_USE_2D_MAP\n        v_uv = a_uvs.xy;\n    #endif\n    #ifdef VOX_USE_VTX_COLOR\n        v_cv = a_cvs.xyz;\n    #endif\n")}getUniqueShaderName(){return this.n_}}class h extends a.default{constructor(){super(),this.B4=new Float32Array([1,1,1,1]),this.vertColorEnabled=!1,this.premultiplyAlpha=!1,null==h.IY&&(h.IY=new l)}buildBuf(){let t=h.IY;t.vertColorEnabled=this.vertColorEnabled,t.premultiplyAlpha=this.premultiplyAlpha}getCodeBuf(){return h.IY}setRGB3f(t,e,i){this.B4[0]=t,this.B4[1]=e,this.B4[2]=i}getRGB3f(t){let e=this.B4;t.setRGB3f(e[0],e[1],e[2])}setRGBA4f(t,e,i,s){this.B4[0]=t,this.B4[1]=e,this.B4[2]=i,this.B4[3]=s}getRGBA4f(t){let e=this.B4;t.setRGBA4f(e[0],e[1],e[2],e[3])}setAlpha(t){this.B4[3]=t}createSelfUniformData(){let t=new r.default;return t.uniformNameList=["u_color"],t.dataList=[this.B4],t}}h.IY=null,e.default=h},f928:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("8d98"),a=s(i("df25"));class n extends a.default{constructor(t,e,i=!1){super(t,e,i),this.n=r.TextureProxyType.Float,this.minFilter=r.TextureConst.LINEAR,this.internalFormat=r.TextureFormat.RGBA16F,this.dataType=r.TextureDataType.FLOAT,this.unpackAlignment=4}toAlphaFormat(){this.srcFormat=r.TextureFormat.ALPHA,this.internalFormat=r.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=r.TextureFormat.RED,this.internalFormat=r.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB16F,this.unpackAlignment=1}toRGBAFormat(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4}toRGBAFloatFormat(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA16F,this.unpackAlignment=4}setDataFromBytes(t,e=0,i=-1,s=-1,r=0,a=0,n=!1){super.setDataFromBytes(t,e,i,s,r,a,n)}setPartDataFromeBytes(t,e,i,s,r,a=0){super.setPartDataFromeBytes(t,e,i,s,r,a)}getPixels(t,e,i,s,r){super.getPixels(t,e,i,s,r)}toString(){return"[FloatTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},fa60:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("919c"));class a extends r.default{constructor(){super(),this.vao=null,this.T=a.H0++}run(){this.A7.testVROUid(this.T)&&(this.A7.bindVertexArray(this.vao),this.A7.testRIOUid(this.B_7)&&this.A7.bindEleBuf(this.ibuf))}__$destroy(){r.default.H_6.delete(this.EX),this.EX=0,this.B_7=-1,this.ibuf=null,this.vao=null,this.A7=null}restoreThis(){null!=this.vao&&this.A7.deleteVertexArray(this.vao),a.Restore(this)}toString(){return"VaoVertexRenderObj(uid = "+this.T+", type="+this.EX+")"}static HasMid(t){return r.default.H_6.has(t)}static GetByMid(t){return r.default.H_6.get(t)}static GetFreeId(){return a.H_7.length>0?a.H_7.pop():-1}static Create(t,e,i){let s=null,n=a.GetFreeId();return n>=0?(s=a.H_8[n],a.H_9[n]=a.S_FLAG_BUSY,s.setMidAndBufUid(e,i)):(s=new a,s.setMidAndBufUid(e,i),a.H_8.push(s),a.H_9.push(a.S_FLAG_BUSY),a.H_++),s.setRC(t),r.default.H_6.set(e,s),s}static Restore(t){if(null!=t&&t.c<1&&a.H_9[t.getUid()]==a.S_FLAG_BUSY){let e=t.getUid();a.H_7.push(e),a.H_9[e]=a.S_FLAG_FREE,t.__$destroy()}}}a.H0=0,a.S_FLAG_BUSY=1,a.S_FLAG_FREE=0,a.H_9=[],a.H_=0,a.H_8=[],a.H_7=[],e.default=a},faa5:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("f3a2"),a=s(i("4a54")),n=i("5216"),l=i("3113");class h{constructor(){this.A_s=null,this.Hu=null,this.AP=null,this.Hv=!0,this.pipeline=null,this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.shadowReceiveEnabled=!1,this.lightEnabled=!1,this.fogEnabled=!1,this.envAmbientLightEnabled=!1,this.brightnessOverlayEnabeld=!1,this.pipeTypes=null,this.keysString="",this.adaptationShaderVersion=!0,null==h.Ia&&(h.IZ=new l.ShaderCodeUniform,h.Ia=new a.default(h.IZ),h.IZ.__$setCodeBuilder(h.Ia))}reset(){this.A_s=h.Ia,this.A_t=h.IZ,this.BB=this.A_t,this.A_s.reset(),this.AP=null,this.pipeTypes=null,this.vertColorEnabled=!1,this.premultiplyAlpha=!1,this.shadowReceiveEnabled=!1,this.lightEnabled=!1,this.fogEnabled=!1,this.envAmbientLightEnabled=!1,this.brightnessOverlayEnabeld=!1,this.keysString=""}clear(){this.A_s=null}setShaderCodeObject(t){this.Hu=t}getShaderCodeObject(){return this.Hu}getShaderCodeObjectUUID(){return r.ShaderCodeUUID.None}getShaderCodeBuilder(){return h.Ia}static GetPreCompileInfo(){return h.Ia.getPreCompileInfo()}initialize(t){null!=h.__$s_csBuf&&h.__$s_csBuf!=this&&h.__$s_csBuf.initialize(t),this.Hv=t,this.bufInitWithPipeline()}buildDefine(){this.premultiplyAlpha&&this.A_s.addDefine("VOX_PREMULTIPLY_ALPHA"),this.vertColorEnabled&&this.A_s.addDefine("VOX_USE_VTX_COLOR"),this.brightnessOverlayEnabeld&&this.A_s.addDefine("VOX_USE_BRIGHTNESS_OVERLAY_COLOR")}buildPipelineParams(){null!=this.pipeline&&null==this.pipeTypes&&(this.pipeTypes=[],this.lightEnabled&&this.pipeTypes.push(n.MaterialPipeType.GLOBAL_LIGHT),this.shadowReceiveEnabled&&this.pipeTypes.push(n.MaterialPipeType.VSM_SHADOW),this.fogEnabled&&this.pipeTypes.push(n.MaterialPipeType.FOG_EXP2),this.envAmbientLightEnabled&&this.pipeTypes.push(n.MaterialPipeType.ENV_AMBIENT_LIGHT))}getTexturesFromPipeline(t){null!=this.pipeline&&this.pipeline.getTextures(this.A_s,t,this.pipeTypes)}bufInitWithPipeline(){null!=this.pipeline&&(this.buildPipelineParams(),this.pipeline.buildSharedUniforms(this.pipeTypes),this.pipeline.createKeys(this.pipeTypes),this.keysString=this.pipeline.getKeysString())}isTexEanbled(){return this.Hv}setIRenderTextureList(t){this.AP=t}getIRenderTextureList(){return this.AP}buildShader(){}getFragShaderCode(){return h.__$s_csBuf!=this?h.__$s_csBuf.getFragShaderCode():this.A_s.buildFragCode()}getVertShaderCode(){return h.__$s_csBuf!=this?h.__$s_csBuf.getVertShaderCode():this.A_s.buildVertCode()}getUniqueShaderName(){if(h.__$s_csBuf!=this)return h.__$s_csBuf.getUniqueShaderName()}toString(){return"[ShaderCodeBuffer()]"}static UseShaderBuffer(t){null!=h.__$s_csBuf&&h.__$s_csBuf.clear(),h.__$s_csBuf=t}}h.__$s_csBuf=null,e.default=h},fae3:function(t,e,i){"use strict";i.r(e);i("1eb2");var s=i("b88e");for(var r in s)["default"].indexOf(r)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(r)},fba3:function(t,e,i){"use strict";i.r(e),i.d(e,"BillboardGroupShaderCode",(function(){return l}));var s="    vec4 color = VOX_Texture2D(VOX_DIFFUSE_MAP, v_texUV.xy);\r\n    #ifdef VOX_USE_CLIP_MIX\r\n        color = mix(color, VOX_Texture2D(VOX_DIFFUSE_MAP, v_texUV.zw),v_factor.x);\r\n    #endif\r\n\r\n    vec3 offsetColor = getOffsetColor();\r\n    \r\n    blendBrightnessORAlpha( color, offsetColor );\r\n\r\n    #ifdef VOX_PREMULTIPLY_ALPHA\r\n        color.xyz *= color.a;\r\n    #endif\r\n    FragColor0 = color;\r\n    // for test\r\n    // FragColor0 = vec4(vec3(0.3), 1.0);",r="vec3 getOffsetColor() {\r\n    #ifdef VOX_OFFSET_COLOR_MAP\r\n        #ifdef VOX_USE_RAW_UV\r\n            vec3 offsetColor = clamp(v_colorOffset.xyz + VOX_Texture2D(VOX_OFFSET_COLOR_MAP, v_uv.xy).xyz,vec3(0.0),vec3(1.0));\r\n        #else\r\n            vec3 offsetColor = clamp(v_colorOffset.xyz + texture(VOX_OFFSET_COLOR_MAP, v_texUV.xy).xyz,vec3(0.0),vec3(1.0));\r\n        #endif\r\n    #else\r\n        vec3 offsetColor = v_colorOffset.xyz;\r\n    #endif\r\n    return offsetColor;\r\n}\r\n\r\nvoid blendBrightnessORAlpha(inout vec4 color, in vec3 offsetColor) {\r\n\r\n    #if FADE_STATUS == 11\r\n        color.rgb = color.rgb * v_colorMult.xyz + color.aaa * offsetColor;\r\n        color *= FADE_VAR.zzzz;\r\n    #elif FADE_STATUS == 10\r\n        color.rgb = min(color.rgb * v_colorMult.xyz + color.rgb * offsetColor, vec3(1.0));\r\n        color.rgb *= FADE_VAR.zzz;\r\n    #elif FADE_STATUS == 1\r\n        color.rgb = color.rgb * v_colorMult.xyz + color.aaa * offsetColor;\r\n        color.a *= FADE_VAR.z;\r\n    #else\r\n        color.rgb = color.rgb * v_colorMult.xyz + offsetColor;\r\n        color.a *= FADE_VAR.z;\r\n    #endif\r\n}",a="    vec4 temp = u_billParam[0];\r\n\r\n    #ifndef VOX_PARTICLE_FLARE\r\n        float time = max(a_nvs.w * temp.z - a_uvs2.w, 0.0);\r\n        #ifdef PLAY_ONCE\r\n            time = min(time, a_uvs2.x);\r\n        #endif\r\n        float kf = fract(time/a_uvs2.x);\r\n        time = kf * a_uvs2.x;\r\n    #else\r\n        float kf = fract(a_uvs2.w * temp.z/a_uvs2.x);\r\n    #endif\r\n\r\n    float fi = kf;\r\n    kf = min(kf/a_uvs2.y,1.0) * (1.0 - max((kf - a_uvs2.z)/(1.0 - a_uvs2.z), 0.0));\r\n    // scale\r\n    vec2 vtx = a_vs.xy * temp.xy * vec2(a_vs.z + kf * a_vs.w);\r\n    #ifndef VOX_PARTICLE_FLARE\r\n        viewPosition = motionCalc(time, vtx);\r\n    #else\r\n        viewPosition = u_viewMat * u_objMat * vec4(a_vs2.xyz,1.0);\r\n    #endif\r\n\r\n    viewPosition.xy += vtx.xy;\r\n    gl_Position =  u_projMat * viewPosition;\r\n    temp = u_billParam[0];\r\n    // use depth offset\r\n    gl_Position.z = ((gl_Position.z / gl_Position.w) + temp.w) * gl_Position.w;\r\n\r\n    v_factor = vec4(0.0,0.0, kf * a_vs2.w, fi);\r\n\r\n    #ifdef VOX_USE_RAW_UV\r\n        v_uv = vec4(a_uvs.xy,0.0,0.0);\r\n    #endif\r\n\r\n    #ifdef VOX_USE_CLIP\r\n        calculateClipUV( fi );\r\n    #else\r\n        v_texUV = vec4(a_uvs.xy, a_uvs.xy);\r\n    #endif\r\n    \r\n    v_colorMult = u_billParam[1];\r\n    v_colorOffset = u_billParam[2];\r\n",n="\r\n#ifdef ROTATION_DIRECT\r\n\r\n// 4.71238898038469\r\n#define MATH_3PER2PI 4.71238898\r\n// 1.5707963267948966\r\n#define MATH_1PER2PI 1.57079633\r\n\r\nfloat getRadianByXY(float dx, float dy) {\r\n\r\n    if(abs(dx) < 0.00001) {\r\n        return (dy >= 0.0) ? MATH_1PER2PI : MATH_3PER2PI;\r\n    }\r\n    float rad = atan(dy/dx);\r\n    return dx >= 0.0 ? rad: (PI + rad);\r\n}\r\n#endif\r\n\r\nconst vec3 biasV3 = vec3(0.1);\r\n\r\n#ifdef VOX_USE_CLIP\r\nvoid calculateClipUV(float fi) {\r\n    \r\n    #ifdef VOX_USE_CLIP_MIX\r\n        // calculate clip uv\r\n        vec4 temp = u_billParam[ BILL_PARAM_INDEX ];//(x:cn,y:total,z:du,w:dv)\r\n        float clipf0 = floor(fi * temp.y);\r\n        float clipf1 = min(clipf0 + 1.0, temp.y - 1.0);\r\n        clipf0 /= temp.x;\r\n        // vec2(floor(fract(clipf0) * temp.x), floor(clipf0)) -> vec2(cn u,rn v)\r\n        v_texUV.xy = (vec2(floor(fract(clipf0) * temp.x), floor(clipf0)) + a_uvs.xy) * temp.zw;\r\n\r\n        v_factor.x = fract(fi * temp.y);\r\n\r\n        clipf1 /= temp.x;\r\n        v_texUV.zw = (vec2(floor(fract(clipf1) * temp.x), floor(clipf1)) + a_uvs.xy) * temp.zw;\r\n    #else\r\n        // calculate clip uv\r\n        vec4 temp = u_billParam[ BILL_PARAM_INDEX ];//(x:cn,y:total,z:du,w:dv)\r\n        float clipf = floor(fi * temp.y);\r\n        clipf /= temp.x;\r\n        // vec2(floor(fract(clipf) * temp.x), floor(clipf)) -> vec2(cn u,rn v)\r\n        v_texUV.xy = (vec2(floor(fract(clipf) * temp.x), floor(clipf)) + a_uvs.xy) * temp.zw;\r\n    #endif\r\n}\r\n#endif\r\n#ifndef VOX_PARTICLE_FLARE\r\nvec4 motionCalc(float time, inout vec2 vtx) {\r\n    vec3 timeV = vec3(time);\r\n    vec3 acc3 = u_billParam[3].xyz + a_nvs2.xyz;\r\n    #ifdef ROTATION_DIRECT\r\n        #ifdef SPEED_SCALE\r\n            float v0scale = clamp(length(a_nvs.xyz + acc3 * timeV)/u_billParam[1].w,1.0,u_billParam[3].w);\r\n            vtx *= vec2(v0scale, 1.0);\r\n        #endif\r\n\r\n        vec3 pv0 = a_vs2.xyz + (a_nvs.xyz + acc3 * timeV) * timeV;\r\n        timeV += biasV3;\r\n        vec3 pv1 = a_vs2.xyz + (a_nvs.xyz + acc3 * timeV) * timeV;\r\n\r\n        mat4 voMat = u_viewMat * u_objMat;\r\n        vec4 pos = voMat * vec4(pv0,1.0);\r\n        vec4 pos1 = voMat * vec4(pv1,1.0);\r\n        float rad = getRadianByXY(pos1.x - pos.x, pos1.y - pos.y);\r\n        float cosv = cos(rad);\r\n        float sinv = sin(rad);\r\n\r\n        // rotate\r\n        vtx = vec2(vtx.x * cosv - vtx.y * sinv, vtx.x * sinv + vtx.y * cosv);\r\n    #else\r\n        vec4 pos = u_viewMat * u_objMat * vec4(a_vs2.xyz + (a_nvs.xyz + acc3 * timeV) * timeV,1.0);\r\n    #endif\r\n    return pos;\r\n}\r\n#endif";const l={vert:"",vert_head:n,vert_body:a,frag:"",frag_head:r,frag_body:s,uuid:"lambert"}},fc07:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("3b73")),a=s(i("2e8a")),n=s(i("78e9"));class l{constructor(){this.Hw=new Map,this.attriNSList=null,this.attriSizeList=null,this.uniformNameListStr="",this.texUniformNameListStr="",this.attributes=[null,null,null,null,null,null,null,null,null,null,null,null],this.uniforms=null,this.texTotal=0,this.fragOutputTotal=0}reset(){this.attriNSList=null,this.uniformNameListStr="",this.texUniformNameListStr="";let t=0;for(;t<12;++t)this.attributes[t]=null;this.uniforms=null,this.Hw.clear(),this.texTotal=0}parseVShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let i="\n",s=t.indexOf(i),r=0,l=[],h="",o="",m=new RegExp(" ","g");while(s>=0)h=t.slice(r,s),h.length>0&&(o=h.replace(m,""),0!=o.indexOf("//")&&l.push(h)),r=s+1,s=t.indexOf(i,r);h=t.slice(r,t.length),h.length>0&&(o=h.replace(m,""),0!=o.indexOf("//")&&l.push(h));let _="uniform ",u=l.length,d=null;for(s=0;s<12;++s)this.attributes[s]=null;this.attriNSList=[],this.attriSizeList=[];let c=null;null==this.uniforms&&(this.uniforms=[]),s=0;let f=!1,p=!1;while(s<u)h=l[s],f=h.indexOf("layout")>=0,p=h.indexOf("attribute ")>=0,f&&h.indexOf("location")>0||p?(d=new a.default,d.layoutEnabled=f,d.parseCode(h),this.attributes[d.attriType]=d,this.attriNSList.push(d.name),this.attriSizeList.push(d.typeSize)):h.indexOf(_)>=0&&(c=new n.default,c.parseCode(h)&&(this.uniforms.push(c),this.uniformNameListStr+=c.name+",",c.isTex&&!this.Hw.has(c.name)&&(this.Hw.set(c.name,1),this.texUniformNameListStr+=c.name+",",this.texTotal++))),++s}parseFShaderCode(t){let e=new RegExp(";","g");t=t.replace(e,";\n"),t=t.replace("{","{\n"),t=t.replace("}","\n}");let i="\n",s=t.indexOf(i),a=0,l=[],h="",o="",m=new RegExp(" ","g");while(s>=0)h=t.slice(a,s),h.length>0&&(o=h.replace(m,""),0!=o.indexOf("//")&&l.push(h)),a=s+1,s=t.indexOf(i,a);h=t.slice(a,t.length),h.length>0&&(o=o.replace(m,""),0!=o.indexOf("//")&&l.push(h));let _="uniform ",u=l.length,d=null;null==this.uniforms&&(this.uniforms=[]),s=0;while(s<u)h=l[s],h.indexOf(_)>=0&&this.uniformNameListStr.indexOf(_)<0&&(d=new n.default,d.parseCode(h)&&(this.uniforms.push(d),this.uniformNameListStr+=d.name+",",d.isTex&&!this.Hw.has(d.name)&&(this.Hw.set(d.name,1),this.texUniformNameListStr+=d.name+",",this.texTotal++))),++s;let c="layout";r.default.IsWebGL1()&&(c="gl_FragData"),s=t.indexOf(c),this.fragOutputTotal=0;while(s>0)this.fragOutputTotal++,s=t.indexOf(c,s+2);this.fragOutputTotal<1&&(this.fragOutputTotal=1)}}e.default=l},fe7f:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i("8d98"),a=s(i("df25"));class n extends a.default{constructor(t,e,i=!1){super(t,e,i),this.n=r.TextureProxyType.Bytes}toAlphaFormat(){this.srcFormat=r.TextureFormat.ALPHA,this.internalFormat=r.TextureFormat.ALPHA,this.unpackAlignment=1}toRedFormat(){this.srcFormat=r.TextureFormat.RED,this.internalFormat=r.TextureFormat.RED,this.unpackAlignment=1}toRGBFormat(){this.srcFormat=r.TextureFormat.RGB,this.internalFormat=r.TextureFormat.RGB,this.unpackAlignment=3}toRGBAFormat(){this.srcFormat=r.TextureFormat.RGBA,this.internalFormat=r.TextureFormat.RGBA,this.unpackAlignment=4}setDataFromBytes(t,e=0,i=-1,s=-1,r=0,a=0,n=!1){super.setDataFromBytes(t,e,i,s,r,a,n)}setPartDataFromeBytes(t,e,i,s,r,a=0){super.setPartDataFromeBytes(t,e,i,s,r,a)}getPixels(t,e,i,s,r){super.getPixels(t,e,i,s,r)}toString(){return"[BytesTextureProxy(width="+this.getWidth()+",height="+this.getHeight()+")]"}}e.default=n},fecb:function(t,e,i){"use strict";var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=s(i("6e01")),a=s(i("8e17"));class n{constructor(){this.min=new a.default(r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE),this.max=new a.default(r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE),this.version=-1,this.radius=50,this.radius2=2500,this.center=new a.default(0,0,0),this.Hx=100,this.C_N=100,this.C_O=100,this.Hy=50,this.A_c=50,this.Hz=50,this.BG=new a.default}getLong(){return this.Hx}getWidth(){return this.C_N}getHeight(){return this.C_O}reset(){this.min.setXYZ(r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE,r.default.MATH_MAX_POSITIVE),this.max.setXYZ(r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE,r.default.MATH_MIN_NEGATIVE)}equals(t){return this.min.equalsXYZ(t.min)&&this.max.equalsXYZ(t.max)}setVolume(t,e,i){this.C_N=t,this.C_O=e,this.Hx=i,this.Hy=.5*this.Hx,this.A_c=.5*this.C_N,this.Hz=.5*this.C_O,this.max.x=this.center.x+this.A_c,this.max.y=this.center.y+this.Hz,this.max.z=this.center.z+this.Hy,this.min.x=this.center.x-this.A_c,this.min.y=this.center.y-this.Hz,this.min.z=this.center.z-this.Hy,this.radius2=this.A_c*this.A_c+this.Hz*this.Hz+this.Hy*this.Hy,this.radius=Math.sqrt(this.radius2)}union(t){this.addPosition(t.min),this.addPosition(t.max)}addPosition(t){this.min.x>t.x&&(this.min.x=t.x),this.min.y>t.y&&(this.min.y=t.y),this.min.z>t.z&&(this.min.z=t.z),this.max.x<t.x&&(this.max.x=t.x),this.max.y<t.y&&(this.max.y=t.y),this.max.z<t.z&&(this.max.z=t.z)}addXYZ(t,e,i){this.min.x>t&&(this.min.x=t),this.min.y>e&&(this.min.y=e),this.min.z>i&&(this.min.z=i),this.max.x<t&&(this.max.x=t),this.max.y<e&&(this.max.y=e),this.max.z<i&&(this.max.z=i)}addXYZFloat32Arr(t,e=3){let i=t.length,s=0,r=0,a=0;for(let n=0;n<i;)s=t[n],r=t[n+1],a=t[n+2],n+=e,this.min.x>s&&(this.min.x=s),this.min.y>r&&(this.min.y=r),this.min.z>a&&(this.min.z=a),this.max.x<s&&(this.max.x=s),this.max.y<r&&(this.max.y=r),this.max.z<a&&(this.max.z=a)}addXYZFloat32AndIndicesArr(t,e){let i,s=e.length,r=0,a=0,n=0;for(let l=0;l<s;l++)i=3*l,r=t[i++],a=t[i++],n=t[i],this.min.x>r&&(this.min.x=r),this.min.y>a&&(this.min.y=a),this.min.z>n&&(this.min.z=n),this.max.x<r&&(this.max.x=r),this.max.y<a&&(this.max.y=a),this.max.z<n&&(this.max.z=n)}getClosePosition(t,e,i=0){e.copyFrom(t),e.x<this.min.x?e.x=this.min.x+i:e.x>this.max.x&&(e.x=this.max.x-i),e.y<this.min.y?e.y=this.min.y+i:e.y>this.max.y&&(e.y=this.max.y-i),e.z<this.min.z?e.z=this.min.z+i:e.z>this.max.z&&(e.z=this.max.z-i)}containsV(t){return!(t.x<this.max.x||t.x>this.max.x)&&(!(t.y<this.max.y||t.y>this.max.y)&&!(t.z<this.max.z||t.z>this.max.z))}containsXY(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.y||e>this.max.y)}containsXZ(t,e){return!(t<this.min.x||t>this.max.x)&&!(e<this.min.z||e>this.max.z)}containsYZ(t,e){return!(t<this.min.y||t>this.max.y)&&!(e<this.min.z||e>this.max.z)}update(){this.C_N=this.max.x,this.min.x>this.max.x&&(this.max.x=this.min.x,this.min.x=this.C_N),this.C_N=this.max.x-this.min.x,this.C_O=this.max.y,this.min.y>this.max.y&&(this.max.y=this.min.y,this.min.y=this.C_O),this.C_O=this.max.y-this.min.y,this.Hx=this.max.z,this.min.z>this.max.z&&(this.max.z=this.min.z,this.min.z=this.Hx),this.Hx=this.max.z-this.min.z,this.center.x=.5*this.C_N,this.center.y=.5*this.C_O,this.center.z=.5*this.Hx,this.Hy=this.center.z,this.A_c=this.center.x,this.Hz=this.center.y,this.radius2=this.A_c*this.A_c+this.Hz*this.Hz+this.Hy*this.Hy,this.radius=Math.sqrt(this.radius2),this.center.x+=this.min.x,this.center.y+=this.min.y,this.center.z+=this.min.z,++this.version}updateVolume(){this.C_N=this.max.x-this.min.x,this.C_O=this.max.y-this.min.y,this.Hx=this.max.z-this.min.z,this.Hy=.5*this.Hx,this.A_c=.5*this.C_N,this.Hz=.5*this.C_O,++this.version}copyFrom(t){this.radius=t.radius,this.radius2=t.radius2,this.min.copyFrom(t.min),this.max.copyFrom(t.max),this.center.copyFrom(t.center),this.updateVolume()}updateFast(){this.C_N=this.max.x-this.min.x,this.C_O=this.max.y-this.min.y,this.Hx=this.max.z-this.min.z,this.center.x=.5*this.C_N,this.center.y=.5*this.C_O,this.center.z=.5*this.Hx,this.Hy=this.center.z,this.A_c=this.center.x,this.Hz=this.center.y,this.radius2=this.A_c*this.A_c+this.Hz*this.Hz+this.Hy*this.Hy,this.radius=Math.sqrt(this.radius2),this.center.x+=this.min.x,this.center.y+=this.min.y,this.center.z+=this.min.z,++this.version}toString(){return"[AABB(min->"+this.min+",size("+this.C_N+","+this.C_O+","+this.Hx+"))]"}sphereIntersect(t,e){this.BG.x=this.center.x-t.x,this.BG.y=this.center.y-t.y,this.BG.z=this.center.z-t.z;let i=this.BG.getLengthSquared();return i<this.radius2||(e+=this.radius,e*=e,e>=i)}intersectRL(t,e){let i=0,s=(this.min.x-e.x)/t.x,r=(this.max.x-e.x)/t.x;s>r&&(i=r,r=s,s=i);let a=(this.min.y-e.y)/t.y,n=(this.max.y-e.y)/t.y;if(a>n&&(i=n,n=a,a=i),s>n||a>r)return!1;a>s&&(s=a),n<r&&(r=n);let l=(this.min.z-e.z)/t.z,h=(this.max.z-e.z)/t.z;return l>h&&(i=h,h=l,l=i),!(s>h||l>r)&&(l>s&&(s=l),h<r&&(r=h),!0)}static IntersectionRL3(t,e,i,s,r,a){return i.w=(t[e[0]].x-r.x)*i.x,s.w=(t[1-e[0]].x-r.x)*i.x,a.x=(t[e[1]].y-r.y)*i.y,a.y=(t[1-e[1]].y-r.y)*i.y,!(i.w>a.y||a.x>s.w)&&(a.x>i.w&&(i.w=a.x),a.y<s.w&&(s.w=a.y),a.x=(t[e[2]].z-r.z)*i.z,a.y=(t[1-e[2]].z-r.z)*i.z,!(i.w>a.y||a.x>s.w)&&(a.x>i.w&&(i.w=a.x),a.y<s.w&&(s.w=a.y),a.copyFrom(s),a.scaleBy(i.w),a.addBy(r),s.w=1,!0))}static IntersectionRL1(t,e,i,s){let r=0,a=(i.min.x-e.x)/t.x,n=(i.max.x-e.x)/t.x;a>n&&(r=n,n=a,a=r);let l=(i.min.y-e.y)/t.y,h=(i.max.y-e.y)/t.y;if(l>h&&(r=h,h=l,l=r),a>h||l>n)return!1;l>a&&(a=l),h<n&&(n=h);let o=(i.min.z-e.z)/t.z,m=(i.max.z-e.z)/t.z;return o>m&&(r=m,m=o,o=r),!(a>m||o>n)&&(o>a&&(a=o),m<n&&(n=m),s.copyFrom(t),s.scaleBy(a),s.addBy(e),!0)}static IntersectionRL2(t,e,i,s){s.x=i.center.x-e.x,s.y=i.center.y-e.y,s.z=i.center.z-e.z;let r=s.dot(t);if(s.x-=r*t.x,s.y-=r*t.y,s.z-=r*t.z,s.getLengthSquared()>i.radius2)return!1;if(i.containsV(e))return s.copyFrom(e),!0;if(e.x<i.min.x){if(t.x>0&&(r=(i.min.x-e.x)/t.x,s.copyFrom(t),s.scaleBy(r),s.addBy(e),i.containsYZ(s.y,s.z)))return!0}else if(e.x>i.max.x&&t.x<0&&(r=(i.max.x-e.x)/t.x,s.copyFrom(t),s.scaleBy(r),s.addBy(e),i.containsYZ(s.y,s.z)))return!0;if(e.y<i.min.y){if(t.y>0&&(r=(i.min.y-e.y)/t.y,s.copyFrom(t),s.scaleBy(r),s.addBy(e),i.containsXZ(s.x,s.z)))return!0}else if(e.y>i.max.y&&t.y<0&&(r=i.max.y,r=(i.max.y-e.y)/t.y,s.copyFrom(t),s.scaleBy(r),s.addBy(e),i.containsXZ(s.x,s.z)))return!0;if(e.z<i.min.z){if(t.z>0&&(r=(i.min.z-e.z)/t.z,s.copyFrom(t),s.scaleBy(r),s.addBy(e),i.containsXY(s.x,s.y)))return!0}else if(e.z>i.max.z&&t.z<0&&(r=(i.max.z-e.z)/t.z,s.copyFrom(t),s.scaleBy(r),s.addBy(e),i.containsXY(s.x,s.y)))return!0;return!1}}n.___pnV=new a.default,e.default=n}})}));